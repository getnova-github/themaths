<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;500;700&display=swap"
    />
    
    <script src="uv/uv.bundle.js"></script>
    <script src="uv.config.js"></script>
    <script type="module" crossorigin>
import "data:application/javascript;base64,dHJ1ZSYmKGZ1bmN0aW9uIHBvbHlmaWxsKCkgewogICAgY29uc3QgcmVsTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKS5yZWxMaXN0OwogICAgaWYgKHJlbExpc3QgJiYgcmVsTGlzdC5zdXBwb3J0cyAmJiByZWxMaXN0LnN1cHBvcnRzKCdtb2R1bGVwcmVsb2FkJykpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbGlua1tyZWw9Im1vZHVsZXByZWxvYWQiXScpKSB7CiAgICAgICAgcHJvY2Vzc1ByZWxvYWQobGluayk7CiAgICB9CiAgICBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7CiAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgIT09ICdjaGlsZExpc3QnKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgbXV0YXRpb24uYWRkZWROb2RlcykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gJ0xJTksnICYmIG5vZGUucmVsID09PSAnbW9kdWxlcHJlbG9hZCcpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1ByZWxvYWQobm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KS5vYnNlcnZlKGRvY3VtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKICAgIGZ1bmN0aW9uIGdldEZldGNoT3B0cyhsaW5rKSB7CiAgICAgICAgY29uc3QgZmV0Y2hPcHRzID0ge307CiAgICAgICAgaWYgKGxpbmsuaW50ZWdyaXR5KQogICAgICAgICAgICBmZXRjaE9wdHMuaW50ZWdyaXR5ID0gbGluay5pbnRlZ3JpdHk7CiAgICAgICAgaWYgKGxpbmsucmVmZXJyZXJQb2xpY3kpCiAgICAgICAgICAgIGZldGNoT3B0cy5yZWZlcnJlclBvbGljeSA9IGxpbmsucmVmZXJyZXJQb2xpY3k7CiAgICAgICAgaWYgKGxpbmsuY3Jvc3NPcmlnaW4gPT09ICd1c2UtY3JlZGVudGlhbHMnKQogICAgICAgICAgICBmZXRjaE9wdHMuY3JlZGVudGlhbHMgPSAnaW5jbHVkZSc7CiAgICAgICAgZWxzZSBpZiAobGluay5jcm9zc09yaWdpbiA9PT0gJ2Fub255bW91cycpCiAgICAgICAgICAgIGZldGNoT3B0cy5jcmVkZW50aWFscyA9ICdvbWl0JzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZldGNoT3B0cy5jcmVkZW50aWFscyA9ICdzYW1lLW9yaWdpbic7CiAgICAgICAgcmV0dXJuIGZldGNoT3B0czsKICAgIH0KICAgIGZ1bmN0aW9uIHByb2Nlc3NQcmVsb2FkKGxpbmspIHsKICAgICAgICBpZiAobGluay5lcCkKICAgICAgICAgICAgLy8gZXAgbWFya2VyID0gcHJvY2Vzc2VkCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBsaW5rLmVwID0gdHJ1ZTsKICAgICAgICAvLyBwcmVwb3B1bGF0ZSB0aGUgbG9hZCByZWNvcmQKICAgICAgICBjb25zdCBmZXRjaE9wdHMgPSBnZXRGZXRjaE9wdHMobGluayk7CiAgICAgICAgZmV0Y2gobGluay5ocmVmLCBmZXRjaE9wdHMpOwogICAgfQp9KCkpOwoKLy8gVW5pcXVlIElEIGNyZWF0aW9uIHJlcXVpcmVzIGEgaGlnaCBxdWFsaXR5IHJhbmRvbSAjIGdlbmVyYXRvci4gSW4gdGhlIGJyb3dzZXIgd2UgdGhlcmVmb3JlCi8vIHJlcXVpcmUgdGhlIGNyeXB0byBBUEkgYW5kIGRvIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGZhbGxiYWNrIHRvIGxvd2VyIHF1YWxpdHkgcmFuZG9tIG51bWJlcgovLyBnZW5lcmF0b3JzIChsaWtlIE1hdGgucmFuZG9tKCkpLgpsZXQgZ2V0UmFuZG9tVmFsdWVzOwpjb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTsKZnVuY3Rpb24gcm5nKCkgewogIC8vIGxhenkgbG9hZCBzbyB0aGF0IGVudmlyb25tZW50cyB0aGF0IG5lZWQgdG8gcG9seWZpbGwgaGF2ZSBhIGNoYW5jZSB0byBkbyBzbwogIGlmICghZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAvLyBnZXRSYW5kb21WYWx1ZXMgbmVlZHMgdG8gYmUgaW52b2tlZCBpbiBhIGNvbnRleHQgd2hlcmUgInRoaXMiIGlzIGEgQ3J5cHRvIGltcGxlbWVudGF0aW9uLgogICAgZ2V0UmFuZG9tVmFsdWVzID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQoY3J5cHRvKTsKCiAgICBpZiAoIWdldFJhbmRvbVZhbHVlcykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkJyk7CiAgICB9CiAgfQoKICByZXR1cm4gZ2V0UmFuZG9tVmFsdWVzKHJuZHM4KTsKfQoKLyoqCiAqIENvbnZlcnQgYXJyYXkgb2YgMTYgYnl0ZSB2YWx1ZXMgdG8gVVVJRCBzdHJpbmcgZm9ybWF0IG9mIHRoZSBmb3JtOgogKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFgKICovCgpjb25zdCBieXRlVG9IZXggPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICBieXRlVG9IZXgucHVzaCgoaSArIDB4MTAwKS50b1N0cmluZygxNikuc2xpY2UoMSkpOwp9CgpmdW5jdGlvbiB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7CiAgLy8gTm90ZTogQmUgY2FyZWZ1bCBlZGl0aW5nIHRoaXMgY29kZSEgIEl0J3MgYmVlbiB0dW5lZCBmb3IgcGVyZm9ybWFuY2UKICAvLyBhbmQgd29ya3MgaW4gd2F5cyB5b3UgbWF5IG5vdCBleHBlY3QuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQvcHVsbC80MzQKICByZXR1cm4gKGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDVdXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA3XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMV1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxM11dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNV1dKS50b0xvd2VyQ2FzZSgpOwp9Cgpjb25zdCByYW5kb21VVUlEID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLnJhbmRvbVVVSUQgJiYgY3J5cHRvLnJhbmRvbVVVSUQuYmluZChjcnlwdG8pOwpjb25zdCBuYXRpdmUgPSB7CiAgcmFuZG9tVVVJRAp9OwoKZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHsKICBpZiAobmF0aXZlLnJhbmRvbVVVSUQgJiYgIWJ1ZiAmJiAhb3B0aW9ucykgewogICAgcmV0dXJuIG5hdGl2ZS5yYW5kb21VVUlEKCk7CiAgfQoKICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBjb25zdCBybmRzID0gb3B0aW9ucy5yYW5kb20gfHwgKG9wdGlvbnMucm5nIHx8IHJuZykoKTsgLy8gUGVyIDQuNCwgc2V0IGJpdHMgZm9yIHZlcnNpb24gYW5kIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYAoKICBybmRzWzZdID0gcm5kc1s2XSAmIDB4MGYgfCAweDQwOwogIHJuZHNbOF0gPSBybmRzWzhdICYgMHgzZiB8IDB4ODA7IC8vIENvcHkgYnl0ZXMgdG8gYnVmZmVyLCBpZiBwcm92aWRlZAoKICBpZiAoYnVmKSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyArK2kpIHsKICAgICAgYnVmW29mZnNldCArIGldID0gcm5kc1tpXTsKICAgIH0KCiAgICByZXR1cm4gYnVmOwogIH0KCiAgcmV0dXJuIHVuc2FmZVN0cmluZ2lmeShybmRzKTsKfQoKLy8gVGhlIHVzZXIgbGlrZWx5IGhhcyBvdmVyd3JpdHRlbiBhbGwgbmV0d29ya2luZyBmdW5jdGlvbnMgYWZ0ZXIgaW1wb3J0aW5nIGJhcmUtY2xpZW50Ci8vIEl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUgY29tcG9uZW50cyBvZiBCYXJlLUNsaWVudCBhcmUgdXNpbmcgbmF0aXZlIG5ldHdvcmtpbmcgZnVuY3Rpb25zCi8vIFRoZXNlIGV4cG9ydHMgYXJlIHByb3ZpZGVkIHRvIHBsdWdpbnMgYnkgQHJvbGx1cC9wbHVnaW4taW5qZWN0CmNvbnN0IFdlYlNvY2tldCQyID0gZ2xvYmFsVGhpcy5XZWJTb2NrZXQ7CmNvbnN0IFJlcXVlc3QkMSA9IGdsb2JhbFRoaXMuUmVxdWVzdDsKY29uc3QgUmVzcG9uc2UkMiA9IGdsb2JhbFRoaXMuUmVzcG9uc2U7CmNvbnN0IFdlYlNvY2tldEZpZWxkcyA9IHsKICAgIHByb3RvdHlwZTogewogICAgICAgIHNlbmQ6IFdlYlNvY2tldCQyLnByb3RvdHlwZS5zZW5kLAogICAgfSwKICAgIENMT1NFRDogV2ViU29ja2V0JDIuQ0xPU0VELAogICAgQ0xPU0lORzogV2ViU29ja2V0JDIuQ0xPU0lORywKICAgIENPTk5FQ1RJTkc6IFdlYlNvY2tldCQyLkNPTk5FQ1RJTkcsCiAgICBPUEVOOiBXZWJTb2NrZXQkMi5PUEVOLAp9OwoKY29uc3QgbWF4UmVkaXJlY3RzID0gMjA7Cgpjb25zdCBzdGF0dXNFbXB0eSQxID0gWzEwMSwgMjA0LCAyMDUsIDMwNF07CmNvbnN0IHN0YXR1c1JlZGlyZWN0ID0gWzMwMSwgMzAyLCAzMDMsIDMwNywgMzA4XTsKbGV0IENsaWVudCQxID0gY2xhc3MgQ2xpZW50IHsKfTsKCi8qCiAqIFdlYlNvY2tldCBoZWxwZXJzCiAqLwpjb25zdCB2YWxpZENoYXJzID0gIiEjJCUmJyorLS4wMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpeX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5enx+IjsKZnVuY3Rpb24gdmFsaWRQcm90b2NvbChwcm90b2NvbCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm90b2NvbC5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNoYXIgPSBwcm90b2NvbFtpXTsKICAgICAgICBpZiAoIXZhbGlkQ2hhcnMuaW5jbHVkZXMoY2hhcikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwp9CgpsZXQgUmVtb3RlQ2xpZW50JDEgPSBjbGFzcyBSZW1vdGVDbGllbnQgZXh0ZW5kcyBDbGllbnQkMSB7CiAgICBjYWxsYmFja3MgPSB7fTsKICAgIHVpZCA9IHY0KCk7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIGlmICghKCJTZXJ2aWNlV29ya2VyR2xvYmFsU2NvcGUiIGluIHNlbGYpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkF0dGVtcHQgdG8gY29uc3RydWN0IFJlbW90ZUNsaWVudCBmcm9tIG91dHNpZGUgYSBzZXJ2aWNlIHdvcmtlciIpOwogICAgICAgIH0KICAgICAgICBhZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGlmIChldmVudC5kYXRhLl9fcmVtb3RlX3RhcmdldCA9PT0gdGhpcy51aWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5jYWxsYmFja3NbZXZlbnQuZGF0YS5fX3JlbW90ZV9pZF07CiAgICAgICAgICAgICAgICBjYWxsYmFjayhldmVudC5kYXRhLl9fcmVtb3RlX3ZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZChtZXNzYWdlLCBpZCkgewogICAgICAgIGNvbnN0IGNsaWVudHMgPSBhd2FpdCBzZWxmLmNsaWVudHMubWF0Y2hBbGwoKTsKICAgICAgICBpZiAoY2xpZW50cy5sZW5ndGggPCAxKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIGF2YWlsYWJsZSBjbGllbnRzIik7CiAgICAgICAgZm9yIChjb25zdCBjbGllbnQgb2YgY2xpZW50cykgewogICAgICAgICAgICBjbGllbnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgX19yZW1vdGVfdGFyZ2V0OiB0aGlzLnVpZCwKICAgICAgICAgICAgICAgIF9fcmVtb3RlX2lkOiBpZCwKICAgICAgICAgICAgICAgIF9fcmVtb3RlX3ZhbHVlOiBtZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHNlbmRXaXRoUmVzcG9uc2UobWVzc2FnZSkgewogICAgICAgIGNvbnN0IGlkID0gdjQoKTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbaWRdID0gcmVzb2x2ZTsKICAgICAgICAgICAgdGhpcy5zZW5kKG1lc3NhZ2UsIGlkKTsKICAgICAgICB9KTsKICAgIH0KICAgIGNvbm5lY3QocmVtb3RlLCBwcm90b2NvbHMsIGdldFJlcXVlc3RIZWFkZXJzLCBvbk1ldGEsIG9uUmVhZHlTdGF0ZSkgewogICAgICAgIHJldHVybiBuZXcgV2ViU29ja2V0JDIoIiIpOwogICAgfQogICAgYXN5bmMgcmVxdWVzdChtZXRob2QsIHJlcXVlc3RIZWFkZXJzLCBib2R5LCByZW1vdGUsIGNhY2hlLCBkdXBsZXgsIHNpZ25hbCkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZW5kV2l0aFJlc3BvbnNlKHsKICAgICAgICAgICAgdHlwZTogInJlcXVlc3QiLAogICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICBtZXRob2QsCiAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVycywKICAgICAgICAgICAgICAgIGJvZHksCiAgICAgICAgICAgICAgICByZW1vdGU6IHJlbW90ZS50b1N0cmluZygpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgICAgIC8vIGNvbnN0IHJlYWRSZXNwb25zZSA9IGF3YWl0IHRoaXMucmVhZEJhcmVSZXNwb25zZShyZXNwb25zZSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFJlc3BvbnNlJDIoc3RhdHVzRW1wdHkkMS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpID8gdW5kZWZpbmVkIDogcmVzcG9uc2UuYm9keSwgewogICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cywKICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCA/PyB1bmRlZmluZWQsCiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpLAogICAgICAgIH0pOwogICAgICAgIHJlc3VsdC5yYXdIZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgICByZXN1bHQucmF3UmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQp9OwoKLy8gZ2V0IHRoZSB1bmhvb2tlZCB2YWx1ZQpjb25zdCBnZXRSZWFsUmVhZHlTdGF0ZSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoV2ViU29ja2V0JDIucHJvdG90eXBlLCAncmVhZHlTdGF0ZScpLmdldDsKY29uc3Qgd3NQcm90b2NvbHMgPSBbJ3dzOicsICd3c3M6J107CnNlbGYuQkNDX1ZFUlNJT04gPSAiMS4yLjEiOwpjb25zb2xlLndhcm4oIkJDQ19WRVJTSU9OOiAiICsgc2VsZi5CQ0NfVkVSU0lPTik7CmZ1bmN0aW9uIHNldEJhcmVDbGllbnRJbXBsZW1lbnRhdGlvbiQxKGltcGxlbWVudGF0aW9uKSB7CiAgICBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24gPSBpbXBsZW1lbnRhdGlvbjsKfQppZiAoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikgewogICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEobmV3IFJlbW90ZUNsaWVudCQxKCkpOwp9CmVsc2UgewogICAgbGV0IHBhcmVudCA9IHNlbGY7CiAgICBjb25zb2xlLmxvZygiYXR0ZW1wdGluZyB0byBmaW5kIGFuIGltcGxlbWVudGF0aW9uIik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgICAgICAgICBpZiAocGFyZW50ICYmIHBhcmVudFsiZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbiJdKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oImZvdW5kIGltcGxlbWVudGF0aW9uIG9uIHBhcmVudCIpOwogICAgICAgICAgICAgICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEocGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImNvdWxkIG5vdCBmaW5kIGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBCYXJlQ2xpZW50IHsKICAgIGNvbnN0cnVjdG9yKC4uLnVudXNlZCkgewogICAgfQogICAgY3JlYXRlV2ViU29ja2V0KHJlbW90ZSwgcHJvdG9jb2xzID0gW10sIG9wdGlvbnMpIHsKICAgICAgICBpZiAoIXNlbGYuZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSByZXF1ZXN0IHdhcyBtYWRlIGJlZm9yZSB0aGUgY2xpZW50IHdhcyByZWFkeSEhIFRoaXMgaXMgYSBwcm9ibGVtIG9uIHRoZSBlbmQgb2Ygd2hvZXZlciBzZXQgdGhlIGJhcmUgY2xpZW50IGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVtb3RlID0gbmV3IFVSTChyZW1vdGUpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oYEZhaWlsZWQgdG8gY29uc3RydWN0ICdXZWJTb2NrZXQnOiBUaGUgVVJMICcke3JlbW90ZX0nIGlzIGludmFsaWQuYCk7CiAgICAgICAgfQogICAgICAgIGlmICghd3NQcm90b2NvbHMuaW5jbHVkZXMocmVtb3RlLnByb3RvY29sKSkKICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgRmFpbGVkIHRvIGNvbnN0cnVjdCAnV2ViU29ja2V0JzogVGhlIFVSTCdzIHNjaGVtZSBtdXN0IGJlIGVpdGhlciAnd3MnIG9yICd3c3MnLiAnJHtyZW1vdGUucHJvdG9jb2x9JyBpcyBub3QgYWxsb3dlZC5gKTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJvdG9jb2xzKSkKICAgICAgICAgICAgcHJvdG9jb2xzID0gW3Byb3RvY29sc107CiAgICAgICAgcHJvdG9jb2xzID0gcHJvdG9jb2xzLm1hcChTdHJpbmcpOwogICAgICAgIGZvciAoY29uc3QgcHJvdG8gb2YgcHJvdG9jb2xzKQogICAgICAgICAgICBpZiAoIXZhbGlkUHJvdG9jb2wocHJvdG8pKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgRmFpbGVkIHRvIGNvbnN0cnVjdCAnV2ViU29ja2V0JzogVGhlIHN1YnByb3RvY29sICcke3Byb3RvfScgaXMgaW52YWxpZC5gKTsKICAgICAgICBjb25zdCBzb2NrZXQgPSBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24uY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCByZXNvbHZlZEhlYWRlcnMgPSB0eXBlb2Ygb3B0aW9ucy5oZWFkZXJzID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgICA/IGF3YWl0IG9wdGlvbnMuaGVhZGVycygpCiAgICAgICAgICAgICAgICA6IG9wdGlvbnMuaGVhZGVycyB8fCB7fTsKICAgICAgICAgICAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSByZXNvbHZlZEhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzCiAgICAgICAgICAgICAgICA/IE9iamVjdC5mcm9tRW50cmllcyhyZXNvbHZlZEhlYWRlcnMpCiAgICAgICAgICAgICAgICA6IHJlc29sdmVkSGVhZGVyczsKICAgICAgICAgICAgLy8gdXNlciBpcyBleHBlY3RlZCB0byBzcGVjaWZ5IHVzZXItYWdlbnQgYW5kIG9yaWdpbgogICAgICAgICAgICAvLyBib3RoIGFyZSBpbiBzcGVjCiAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzWydIb3N0J10gPSByZW1vdGUuaG9zdDsKICAgICAgICAgICAgLy8gcmVxdWVzdEhlYWRlcnNbJ09yaWdpbiddID0gb3JpZ2luOwogICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1snUHJhZ21hJ10gPSAnbm8tY2FjaGUnOwogICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1snQ2FjaGUtQ29udHJvbCddID0gJ25vLWNhY2hlJzsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnNbJ1VwZ3JhZGUnXSA9ICd3ZWJzb2NrZXQnOwogICAgICAgICAgICAvLyByZXF1ZXN0SGVhZGVyc1snVXNlci1BZ2VudCddID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnNbJ0Nvbm5lY3Rpb24nXSA9ICdVcGdyYWRlJzsKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RIZWFkZXJzOwogICAgICAgIH0sIChtZXRhKSA9PiB7CiAgICAgICAgICAgIGZha2VQcm90b2NvbCA9IG1ldGEucHJvdG9jb2w7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnNldENvb2tpZXNDYWxsYmFjaykKICAgICAgICAgICAgICAgIG9wdGlvbnMuc2V0Q29va2llc0NhbGxiYWNrKG1ldGEuc2V0Q29va2llcyk7CiAgICAgICAgfSwgKHJlYWR5U3RhdGUpID0+IHsKICAgICAgICAgICAgZmFrZVJlYWR5U3RhdGUgPSByZWFkeVN0YXRlOwogICAgICAgIH0sIG9wdGlvbnMud2ViU29ja2V0SW1wbCB8fCBXZWJTb2NrZXQkMiwgQXJyYXlCdWZmZXIpOwogICAgICAgIC8vIHByb3RvY29sIGlzIGFsd2F5cyBhbiBlbXB0eSBiZWZvcmUgY29ubmVjdGluZwogICAgICAgIC8vIHVwZGF0ZWQgd2hlbiB3ZSByZWNlaXZlIHRoZSBtZXRhZGF0YQogICAgICAgIC8vIHRoaXMgdmFsdWUgZG9lc24ndCBjaGFuZ2Ugd2hlbiBpdCdzIENMT1NJTkcgb3IgQ0xPU0VEIGV0YwogICAgICAgIGxldCBmYWtlUHJvdG9jb2wgPSAnJzsKICAgICAgICBsZXQgZmFrZVJlYWR5U3RhdGUgPSBXZWJTb2NrZXRGaWVsZHMuQ09OTkVDVElORzsKICAgICAgICBjb25zdCBnZXRSZWFkeVN0YXRlID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCByZWFsUmVhZHlTdGF0ZSA9IGdldFJlYWxSZWFkeVN0YXRlLmNhbGwoc29ja2V0KTsKICAgICAgICAgICAgLy8gcmVhZHlTdGF0ZSBzaG91bGQgb25seSBiZSBmYWtlZCB3aGVuIHRoZSByZWFsIHJlYWR5U3RhdGUgaXMgT1BFTgogICAgICAgICAgICByZXR1cm4gcmVhbFJlYWR5U3RhdGUgPT09IFdlYlNvY2tldEZpZWxkcy5PUEVOCiAgICAgICAgICAgICAgICA/IGZha2VSZWFkeVN0YXRlCiAgICAgICAgICAgICAgICA6IHJlYWxSZWFkeVN0YXRlOwogICAgICAgIH07CiAgICAgICAgaWYgKG9wdGlvbnMucmVhZHlTdGF0ZUhvb2spCiAgICAgICAgICAgIG9wdGlvbnMucmVhZHlTdGF0ZUhvb2soc29ja2V0LCBnZXRSZWFkeVN0YXRlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBob29rIC5yZWFkeVN0YXRlIG91cnNlbHZlcwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc29ja2V0LCAncmVhZHlTdGF0ZScsIHsKICAgICAgICAgICAgICAgIGdldDogZ2V0UmVhZHlTdGF0ZSwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy51cmxIb29rKQogICAgICAgICAgICBvcHRpb25zLnVybEhvb2soc29ja2V0LCByZW1vdGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNvY2tldCwgJ3VybCcsIHsKICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVtb3RlLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICB9KTsKICAgICAgICBjb25zdCBnZXRQcm90b2NvbCA9ICgpID0+IGZha2VQcm90b2NvbDsKICAgICAgICBpZiAob3B0aW9ucy5wcm90b2NvbEhvb2spCiAgICAgICAgICAgIG9wdGlvbnMucHJvdG9jb2xIb29rKHNvY2tldCwgZ2V0UHJvdG9jb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNvY2tldCwgJ3Byb3RvY29sJywgewogICAgICAgICAgICAgICAgZ2V0OiBnZXRQcm90b2NvbCwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIH0pOwogICAgICAgIHJldHVybiBzb2NrZXQ7CiAgICB9CiAgICBhc3luYyBmZXRjaCh1cmwsIGluaXQpIHsKICAgICAgICAvLyBPbmx5IGNyZWF0ZSBhbiBpbnN0YW5jZSBvZiBSZXF1ZXN0IHRvIHBhcnNlIGNlcnRhaW4gcGFyYW1ldGVycyBvZiBpbml0IHN1Y2ggYXMgbWV0aG9kLCBoZWFkZXJzLCByZWRpcmVjdAogICAgICAgIC8vIEJ1dCB1c2UgaW5pdCB2YWx1ZXMgd2hlbmV2ZXIgcG9zc2libGUKICAgICAgICBjb25zdCByZXEgPSBuZXcgUmVxdWVzdCQxKHVybCwgaW5pdCk7CiAgICAgICAgLy8gdHJ5IHRvIHVzZSBpbml0LmhlYWRlcnMgYmVjYXVzZSBpdCBtYXkgY29udGFpbiBjYXBpdGFsaXplZCBoZWFkZXJzCiAgICAgICAgLy8gZnVydGhlcm1vcmUsIGltcG9ydGFudCBoZWFkZXJzIG9uIHRoZSBSZXF1ZXN0IGNsYXNzIGFyZSBibG9ja2VkLi4uCiAgICAgICAgLy8gd2Ugc2hvdWxkIHRyeSB0byBwcmVzZXJ2ZSB0aGUgY2FwaXRhbGl6YXRpb24gZHVlIHRvIHF1aXJrcyB3aXRoIGVhcmxpZXIgc2VydmVycwogICAgICAgIGNvbnN0IGlucHV0SGVhZGVycyA9IGluaXQ/LmhlYWRlcnMgfHwgcmVxLmhlYWRlcnM7CiAgICAgICAgY29uc3QgaGVhZGVycyA9IGlucHV0SGVhZGVycyBpbnN0YW5jZW9mIEhlYWRlcnMKICAgICAgICAgICAgPyBPYmplY3QuZnJvbUVudHJpZXMoaW5wdXRIZWFkZXJzKQogICAgICAgICAgICA6IGlucHV0SGVhZGVyczsKICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgY29uc3QgZHVwbGV4ID0gaW5pdD8uZHVwbGV4OwogICAgICAgIGNvbnN0IGJvZHkgPSBpbml0Py5ib2R5IHx8IHJlcS5ib2R5OwogICAgICAgIGxldCB1cmxPID0gbmV3IFVSTChyZXEudXJsKTsKICAgICAgICBpZiAoIXNlbGYuZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSByZXF1ZXN0IHdhcyBtYWRlIGJlZm9yZSB0aGUgY2xpZW50IHdhcyByZWFkeSEhIFRoaXMgaXMgYSBwcm9ibGVtIG9uIHRoZSBlbmQgb2Ygd2hvZXZlciBzZXQgdGhlIGJhcmUgY2xpZW50IGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7OyBpKyspIHsKICAgICAgICAgICAgaWYgKCdob3N0JyBpbiBoZWFkZXJzKQogICAgICAgICAgICAgICAgaGVhZGVycy5ob3N0ID0gdXJsTy5ob3N0OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBoZWFkZXJzLkhvc3QgPSB1cmxPLmhvc3Q7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VsZi5nQmFyZUNsaWVudEltcGxlbWVudGF0aW9uLnJlcXVlc3QocmVxLm1ldGhvZCwgaGVhZGVycywgYm9keSwgdXJsTywgcmVxLmNhY2hlLCBkdXBsZXgsIHJlcS5zaWduYWwsIEFycmF5QnVmZmVyKTsKICAgICAgICAgICAgcmVzcG9uc2UuZmluYWxVUkwgPSB1cmxPLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGNvbnN0IHJlZGlyZWN0ID0gaW5pdD8ucmVkaXJlY3QgfHwgcmVxLnJlZGlyZWN0OwogICAgICAgICAgICBpZiAoc3RhdHVzUmVkaXJlY3QuaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChyZWRpcmVjdCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvbGxvdyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSByZXNwb25zZS5oZWFkZXJzLmdldCgnbG9jYXRpb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1heFJlZGlyZWN0cyA+IGkgJiYgbG9jYXRpb24gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybE8gPSBuZXcgVVJMKGxvY2F0aW9uLCB1cmxPKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCcpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbnVhbCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBub29wJDQoKSB7fQoKY29uc3QgaWRlbnRpdHkgPSAoeCkgPT4geDsKCi8qKgogKiBAdGVtcGxhdGUgVAogKiBAdGVtcGxhdGUgUwogKiBAcGFyYW0ge1R9IHRhcgogKiBAcGFyYW0ge1N9IHNyYwogKiBAcmV0dXJucyB7VCAmIFN9CiAqLwpmdW5jdGlvbiBhc3NpZ24odGFyLCBzcmMpIHsKCS8vIEB0cy1pZ25vcmUKCWZvciAoY29uc3QgayBpbiBzcmMpIHRhcltrXSA9IHNyY1trXTsKCXJldHVybiAvKiogQHR5cGUge1QgJiBTfSAqLyAodGFyKTsKfQoKZnVuY3Rpb24gcnVuKGZuKSB7CglyZXR1cm4gZm4oKTsKfQoKZnVuY3Rpb24gYmxhbmtfb2JqZWN0KCkgewoJcmV0dXJuIE9iamVjdC5jcmVhdGUobnVsbCk7Cn0KCi8qKgogKiBAcGFyYW0ge0Z1bmN0aW9uW119IGZucwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHJ1bl9hbGwoZm5zKSB7CglmbnMuZm9yRWFjaChydW4pOwp9CgovKioKICogQHBhcmFtIHthbnl9IHRoaW5nCiAqIEByZXR1cm5zIHt0aGluZyBpcyBGdW5jdGlvbn0KICovCmZ1bmN0aW9uIGlzX2Z1bmN0aW9uKHRoaW5nKSB7CglyZXR1cm4gdHlwZW9mIHRoaW5nID09PSAnZnVuY3Rpb24nOwp9CgovKiogQHJldHVybnMge2Jvb2xlYW59ICovCmZ1bmN0aW9uIHNhZmVfbm90X2VxdWFsKGEsIGIpIHsKCXJldHVybiBhICE9IGEgPyBiID09IGIgOiBhICE9PSBiIHx8IChhICYmIHR5cGVvZiBhID09PSAnb2JqZWN0JykgfHwgdHlwZW9mIGEgPT09ICdmdW5jdGlvbic7Cn0KCi8qKiBAcmV0dXJucyB7Ym9vbGVhbn0gKi8KZnVuY3Rpb24gaXNfZW1wdHkob2JqKSB7CglyZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPT09IDA7Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9zbG90KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pIHsKCWlmIChkZWZpbml0aW9uKSB7CgkJY29uc3Qgc2xvdF9jdHggPSBnZXRfc2xvdF9jb250ZXh0KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pOwoJCXJldHVybiBkZWZpbml0aW9uWzBdKHNsb3RfY3R4KTsKCX0KfQoKZnVuY3Rpb24gZ2V0X3Nsb3RfY29udGV4dChkZWZpbml0aW9uLCBjdHgsICQkc2NvcGUsIGZuKSB7CglyZXR1cm4gZGVmaW5pdGlvblsxXSAmJiBmbiA/IGFzc2lnbigkJHNjb3BlLmN0eC5zbGljZSgpLCBkZWZpbml0aW9uWzFdKGZuKGN0eCkpKSA6ICQkc2NvcGUuY3R4Owp9CgpmdW5jdGlvbiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmluaXRpb24sICQkc2NvcGUsIGRpcnR5LCBmbikgewoJaWYgKGRlZmluaXRpb25bMl0gJiYgZm4pIHsKCQljb25zdCBsZXRzID0gZGVmaW5pdGlvblsyXShmbihkaXJ0eSkpOwoJCWlmICgkJHNjb3BlLmRpcnR5ID09PSB1bmRlZmluZWQpIHsKCQkJcmV0dXJuIGxldHM7CgkJfQoJCWlmICh0eXBlb2YgbGV0cyA9PT0gJ29iamVjdCcpIHsKCQkJY29uc3QgbWVyZ2VkID0gW107CgkJCWNvbnN0IGxlbiA9IE1hdGgubWF4KCQkc2NvcGUuZGlydHkubGVuZ3RoLCBsZXRzLmxlbmd0aCk7CgkJCWZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHsKCQkJCW1lcmdlZFtpXSA9ICQkc2NvcGUuZGlydHlbaV0gfCBsZXRzW2ldOwoJCQl9CgkJCXJldHVybiBtZXJnZWQ7CgkJfQoJCXJldHVybiAkJHNjb3BlLmRpcnR5IHwgbGV0czsKCX0KCXJldHVybiAkJHNjb3BlLmRpcnR5Owp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIHVwZGF0ZV9zbG90X2Jhc2UoCglzbG90LAoJc2xvdF9kZWZpbml0aW9uLAoJY3R4LAoJJCRzY29wZSwKCXNsb3RfY2hhbmdlcywKCWdldF9zbG90X2NvbnRleHRfZm4KKSB7CglpZiAoc2xvdF9jaGFuZ2VzKSB7CgkJY29uc3Qgc2xvdF9jb250ZXh0ID0gZ2V0X3Nsb3RfY29udGV4dChzbG90X2RlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZ2V0X3Nsb3RfY29udGV4dF9mbik7CgkJc2xvdC5wKHNsb3RfY29udGV4dCwgc2xvdF9jaGFuZ2VzKTsKCX0KfQoKLyoqIEByZXR1cm5zIHthbnlbXSB8IC0xfSAqLwpmdW5jdGlvbiBnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGUoJCRzY29wZSkgewoJaWYgKCQkc2NvcGUuY3R4Lmxlbmd0aCA+IDMyKSB7CgkJY29uc3QgZGlydHkgPSBbXTsKCQljb25zdCBsZW5ndGggPSAkJHNjb3BlLmN0eC5sZW5ndGggLyAzMjsKCQlmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CgkJCWRpcnR5W2ldID0gLTE7CgkJfQoJCXJldHVybiBkaXJ0eTsKCX0KCXJldHVybiAtMTsKfQoKLyoqIEByZXR1cm5zIHt7fX0gKi8KZnVuY3Rpb24gZXhjbHVkZV9pbnRlcm5hbF9wcm9wcyhwcm9wcykgewoJY29uc3QgcmVzdWx0ID0ge307Cglmb3IgKGNvbnN0IGsgaW4gcHJvcHMpIGlmIChrWzBdICE9PSAnJCcpIHJlc3VsdFtrXSA9IHByb3BzW2tdOwoJcmV0dXJuIHJlc3VsdDsKfQoKLyoqIEByZXR1cm5zIHt7fX0gKi8KZnVuY3Rpb24gY29tcHV0ZV9zbG90cyhzbG90cykgewoJY29uc3QgcmVzdWx0ID0ge307Cglmb3IgKGNvbnN0IGtleSBpbiBzbG90cykgewoJCXJlc3VsdFtrZXldID0gdHJ1ZTsKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmNvbnN0IGlzX2NsaWVudCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnOwoKLyoqIEB0eXBlIHsoKSA9PiBudW1iZXJ9ICovCmxldCBub3cgPSBpc19jbGllbnQgPyAoKSA9PiB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgOiAoKSA9PiBEYXRlLm5vdygpOwoKbGV0IHJhZiA9IGlzX2NsaWVudCA/IChjYikgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNiKSA6IG5vb3AkNDsKCmNvbnN0IHRhc2tzID0gbmV3IFNldCgpOwoKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSBub3cKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBydW5fdGFza3Mobm93KSB7Cgl0YXNrcy5mb3JFYWNoKCh0YXNrKSA9PiB7CgkJaWYgKCF0YXNrLmMobm93KSkgewoJCQl0YXNrcy5kZWxldGUodGFzayk7CgkJCXRhc2suZigpOwoJCX0KCX0pOwoJaWYgKHRhc2tzLnNpemUgIT09IDApIHJhZihydW5fdGFza3MpOwp9CgovKioKICogQ3JlYXRlcyBhIG5ldyB0YXNrIHRoYXQgcnVucyBvbiBlYWNoIHJhZiBmcmFtZQogKiB1bnRpbCBpdCByZXR1cm5zIGEgZmFsc3kgdmFsdWUgb3IgaXMgYWJvcnRlZAogKiBAcGFyYW0ge2ltcG9ydCgnLi9wcml2YXRlLmpzJykuVGFza0NhbGxiYWNrfSBjYWxsYmFjawogKiBAcmV0dXJucyB7aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5UYXNrfQogKi8KZnVuY3Rpb24gbG9vcChjYWxsYmFjaykgewoJLyoqIEB0eXBlIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLlRhc2tFbnRyeX0gKi8KCWxldCB0YXNrOwoJaWYgKHRhc2tzLnNpemUgPT09IDApIHJhZihydW5fdGFza3MpOwoJcmV0dXJuIHsKCQlwcm9taXNlOiBuZXcgUHJvbWlzZSgoZnVsZmlsbCkgPT4gewoJCQl0YXNrcy5hZGQoKHRhc2sgPSB7IGM6IGNhbGxiYWNrLCBmOiBmdWxmaWxsIH0pKTsKCQl9KSwKCQlhYm9ydCgpIHsKCQkJdGFza3MuZGVsZXRlKHRhc2spOwoJCX0KCX07Cn0KCi8qKgogKiBAcGFyYW0ge05vZGV9IHRhcmdldAogKiBAcGFyYW0ge05vZGV9IG5vZGUKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBhcHBlbmQodGFyZ2V0LCBub2RlKSB7Cgl0YXJnZXQuYXBwZW5kQ2hpbGQobm9kZSk7Cn0KCi8qKgogKiBAcGFyYW0ge05vZGV9IG5vZGUKICogQHJldHVybnMge1NoYWRvd1Jvb3QgfCBEb2N1bWVudH0KICovCmZ1bmN0aW9uIGdldF9yb290X2Zvcl9zdHlsZShub2RlKSB7CglpZiAoIW5vZGUpIHJldHVybiBkb2N1bWVudDsKCWNvbnN0IHJvb3QgPSBub2RlLmdldFJvb3ROb2RlID8gbm9kZS5nZXRSb290Tm9kZSgpIDogbm9kZS5vd25lckRvY3VtZW50OwoJaWYgKHJvb3QgJiYgLyoqIEB0eXBlIHtTaGFkb3dSb290fSAqLyAocm9vdCkuaG9zdCkgewoJCXJldHVybiAvKiogQHR5cGUge1NoYWRvd1Jvb3R9ICovIChyb290KTsKCX0KCXJldHVybiBub2RlLm93bmVyRG9jdW1lbnQ7Cn0KCi8qKgogKiBAcGFyYW0ge05vZGV9IG5vZGUKICogQHJldHVybnMge0NTU1N0eWxlU2hlZXR9CiAqLwpmdW5jdGlvbiBhcHBlbmRfZW1wdHlfc3R5bGVzaGVldChub2RlKSB7Cgljb25zdCBzdHlsZV9lbGVtZW50ID0gZWxlbWVudCgnc3R5bGUnKTsKCS8vIEZvciB0cmFuc2l0aW9ucyB0byB3b3JrIHdpdGhvdXQgJ3N0eWxlLXNyYzogdW5zYWZlLWlubGluZScgQ29udGVudCBTZWN1cml0eSBQb2xpY3ksCgkvLyB0aGVzZSBlbXB0eSB0YWdzIG5lZWQgdG8gYmUgYWxsb3dlZCB3aXRoIGEgaGFzaCBhcyBhIHdvcmthcm91bmQgdW50aWwgd2UgbW92ZSB0byB0aGUgV2ViIEFuaW1hdGlvbnMgQVBJLgoJLy8gVXNpbmcgdGhlIGhhc2ggZm9yIHRoZSBlbXB0eSBzdHJpbmcgKGZvciBhbiBlbXB0eSB0YWcpIHdvcmtzIGluIGFsbCBicm93c2VycyBleGNlcHQgU2FmYXJpLgoJLy8gU28gYXMgYSB3b3JrYXJvdW5kIGZvciB0aGUgd29ya2Fyb3VuZCwgd2hlbiB3ZSBhcHBlbmQgZW1wdHkgc3R5bGUgdGFncyB3ZSBzZXQgdGhlaXIgY29udGVudCB0byAvKiBlbXB0eSAqLy4KCS8vIFRoZSBoYXNoICdzaGEyNTYtOU9sTk8wRE5FZWFWekhMNFJad0NMc0JIQThXQlE4dG9CcC80RjVYVjJuYz0nIHdpbGwgdGhlbiB3b3JrIGV2ZW4gaW4gU2FmYXJpLgoJc3R5bGVfZWxlbWVudC50ZXh0Q29udGVudCA9ICcvKiBlbXB0eSAqLyc7CglhcHBlbmRfc3R5bGVzaGVldChnZXRfcm9vdF9mb3Jfc3R5bGUobm9kZSksIHN0eWxlX2VsZW1lbnQpOwoJcmV0dXJuIHN0eWxlX2VsZW1lbnQuc2hlZXQ7Cn0KCi8qKgogKiBAcGFyYW0ge1NoYWRvd1Jvb3QgfCBEb2N1bWVudH0gbm9kZQogKiBAcGFyYW0ge0hUTUxTdHlsZUVsZW1lbnR9IHN0eWxlCiAqIEByZXR1cm5zIHtDU1NTdHlsZVNoZWV0fQogKi8KZnVuY3Rpb24gYXBwZW5kX3N0eWxlc2hlZXQobm9kZSwgc3R5bGUpIHsKCWFwcGVuZCgvKiogQHR5cGUge0RvY3VtZW50fSAqLyAobm9kZSkuaGVhZCB8fCBub2RlLCBzdHlsZSk7CglyZXR1cm4gc3R5bGUuc2hlZXQ7Cn0KCi8qKgogKiBAcGFyYW0ge05vZGV9IHRhcmdldAogKiBAcGFyYW0ge05vZGV9IG5vZGUKICogQHBhcmFtIHtOb2RlfSBbYW5jaG9yXQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGluc2VydCh0YXJnZXQsIG5vZGUsIGFuY2hvcikgewoJdGFyZ2V0Lmluc2VydEJlZm9yZShub2RlLCBhbmNob3IgfHwgbnVsbCk7Cn0KCi8qKgogKiBAcGFyYW0ge05vZGV9IG5vZGUKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBkZXRhY2gobm9kZSkgewoJaWYgKG5vZGUucGFyZW50Tm9kZSkgewoJCW5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKCX0KfQoKLyoqCiAqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBkZXN0cm95X2VhY2goaXRlcmF0aW9ucywgZGV0YWNoaW5nKSB7Cglmb3IgKGxldCBpID0gMDsgaSA8IGl0ZXJhdGlvbnMubGVuZ3RoOyBpICs9IDEpIHsKCQlpZiAoaXRlcmF0aW9uc1tpXSkgaXRlcmF0aW9uc1tpXS5kKGRldGFjaGluZyk7Cgl9Cn0KCi8qKgogKiBAdGVtcGxhdGUge2tleW9mIEhUTUxFbGVtZW50VGFnTmFtZU1hcH0gSwogKiBAcGFyYW0ge0t9IG5hbWUKICogQHJldHVybnMge0hUTUxFbGVtZW50VGFnTmFtZU1hcFtLXX0KICovCmZ1bmN0aW9uIGVsZW1lbnQobmFtZSkgewoJcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQobmFtZSk7Cn0KCi8qKgogKiBAdGVtcGxhdGUge2tleW9mIFNWR0VsZW1lbnRUYWdOYW1lTWFwfSBLCiAqIEBwYXJhbSB7S30gbmFtZQogKiBAcmV0dXJucyB7U1ZHRWxlbWVudH0KICovCmZ1bmN0aW9uIHN2Z19lbGVtZW50KG5hbWUpIHsKCXJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgbmFtZSk7Cn0KCi8qKgogKiBAcGFyYW0ge3N0cmluZ30gZGF0YQogKiBAcmV0dXJucyB7VGV4dH0KICovCmZ1bmN0aW9uIHRleHQoZGF0YSkgewoJcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEpOwp9CgovKioKICogQHJldHVybnMge1RleHR9ICovCmZ1bmN0aW9uIHNwYWNlKCkgewoJcmV0dXJuIHRleHQoJyAnKTsKfQoKLyoqCiAqIEByZXR1cm5zIHtUZXh0fSAqLwpmdW5jdGlvbiBlbXB0eSgpIHsKCXJldHVybiB0ZXh0KCcnKTsKfQoKLyoqCiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR9IG5vZGUKICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50CiAqIEBwYXJhbSB7RXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdH0gaGFuZGxlcgogKiBAcGFyYW0ge2Jvb2xlYW4gfCBBZGRFdmVudExpc3RlbmVyT3B0aW9ucyB8IEV2ZW50TGlzdGVuZXJPcHRpb25zfSBbb3B0aW9uc10KICogQHJldHVybnMgeygpID0+IHZvaWR9CiAqLwpmdW5jdGlvbiBsaXN0ZW4obm9kZSwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpIHsKCW5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7CglyZXR1cm4gKCkgPT4gbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsKfQoKLyoqCiAqIEByZXR1cm5zIHsoZXZlbnQ6IGFueSkgPT4gYW55fSAqLwpmdW5jdGlvbiBzdG9wX3Byb3BhZ2F0aW9uKGZuKSB7CglyZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7CgkJZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgkJLy8gQHRzLWlnbm9yZQoJCXJldHVybiBmbi5jYWxsKHRoaXMsIGV2ZW50KTsKCX07Cn0KCi8qKgogKiBAcmV0dXJucyB7KGV2ZW50OiBhbnkpID0+IHZvaWR9ICovCmZ1bmN0aW9uIHNlbGYkMShmbikgewoJcmV0dXJuIGZ1bmN0aW9uIChldmVudCkgewoJCS8vIEB0cy1pZ25vcmUKCQlpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzKSBmbi5jYWxsKHRoaXMsIGV2ZW50KTsKCX07Cn0KCi8qKgogKiBAcGFyYW0ge0VsZW1lbnR9IG5vZGUKICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZQogKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGF0dHIobm9kZSwgYXR0cmlidXRlLCB2YWx1ZSkgewoJaWYgKHZhbHVlID09IG51bGwpIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZSk7CgllbHNlIGlmIChub2RlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpICE9PSB2YWx1ZSkgbm9kZS5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCB2YWx1ZSk7Cn0KLyoqCiAqIExpc3Qgb2YgYXR0cmlidXRlcyB0aGF0IHNob3VsZCBhbHdheXMgYmUgc2V0IHRocm91Z2ggdGhlIGF0dHIgbWV0aG9kLAogKiBiZWNhdXNlIHVwZGF0aW5nIHRoZW0gdGhyb3VnaCB0aGUgcHJvcGVydHkgc2V0dGVyIGRvZXNuJ3Qgd29yayByZWxpYWJseS4KICogSW4gdGhlIGV4YW1wbGUgb2YgYHdpZHRoYC9gaGVpZ2h0YCwgdGhlIHByb2JsZW0gaXMgdGhhdCB0aGUgc2V0dGVyIG9ubHkKICogYWNjZXB0cyBudW1lcmljIHZhbHVlcywgYnV0IHRoZSBhdHRyaWJ1dGUgY2FuIGFsc28gYmUgc2V0IHRvIGEgc3RyaW5nIGxpa2UgYDUwJWAuCiAqIElmIHRoaXMgbGlzdCBiZWNvbWVzIHRvbyBiaWcsIHJldGhpbmsgdGhpcyBhcHByb2FjaC4KICovCmNvbnN0IGFsd2F5c19zZXRfdGhyb3VnaF9zZXRfYXR0cmlidXRlID0gWyd3aWR0aCcsICdoZWlnaHQnXTsKCi8qKgogKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGUKICogQHBhcmFtIHt7IFt4OiBzdHJpbmddOiBzdHJpbmcgfX0gYXR0cmlidXRlcwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHNldF9hdHRyaWJ1dGVzKG5vZGUsIGF0dHJpYnV0ZXMpIHsKCS8vIEB0cy1pZ25vcmUKCWNvbnN0IGRlc2NyaXB0b3JzID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMobm9kZS5fX3Byb3RvX18pOwoJZm9yIChjb25zdCBrZXkgaW4gYXR0cmlidXRlcykgewoJCWlmIChhdHRyaWJ1dGVzW2tleV0gPT0gbnVsbCkgewoJCQlub2RlLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwoJCX0gZWxzZSBpZiAoa2V5ID09PSAnc3R5bGUnKSB7CgkJCW5vZGUuc3R5bGUuY3NzVGV4dCA9IGF0dHJpYnV0ZXNba2V5XTsKCQl9IGVsc2UgaWYgKGtleSA9PT0gJ19fdmFsdWUnKSB7CgkJCS8qKiBAdHlwZSB7YW55fSAqLyAobm9kZSkudmFsdWUgPSBub2RlW2tleV0gPSBhdHRyaWJ1dGVzW2tleV07CgkJfSBlbHNlIGlmICgKCQkJZGVzY3JpcHRvcnNba2V5XSAmJgoJCQlkZXNjcmlwdG9yc1trZXldLnNldCAmJgoJCQlhbHdheXNfc2V0X3Rocm91Z2hfc2V0X2F0dHJpYnV0ZS5pbmRleE9mKGtleSkgPT09IC0xCgkJKSB7CgkJCW5vZGVba2V5XSA9IGF0dHJpYnV0ZXNba2V5XTsKCQl9IGVsc2UgewoJCQlhdHRyKG5vZGUsIGtleSwgYXR0cmlidXRlc1trZXldKTsKCQl9Cgl9Cn0KCi8qKgogKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGUKICogQHBhcmFtIHt7IFt4OiBzdHJpbmddOiBzdHJpbmcgfX0gYXR0cmlidXRlcwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHNldF9zdmdfYXR0cmlidXRlcyhub2RlLCBhdHRyaWJ1dGVzKSB7Cglmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzKSB7CgkJYXR0cihub2RlLCBrZXksIGF0dHJpYnV0ZXNba2V5XSk7Cgl9Cn0KCi8qKgogKiBAcGFyYW0ge0hUTUxJbnB1dEVsZW1lbnRbXX0gZ3JvdXAKICogQHJldHVybnMge3sgcCguLi5pbnB1dHM6IEhUTUxJbnB1dEVsZW1lbnRbXSk6IHZvaWQ7IHIoKTogdm9pZDsgfX0KICovCmZ1bmN0aW9uIGluaXRfYmluZGluZ19ncm91cChncm91cCkgewoJLyoqCgkgKiBAdHlwZSB7SFRNTElucHV0RWxlbWVudFtdfSAqLwoJbGV0IF9pbnB1dHM7CglyZXR1cm4gewoJCS8qIHB1c2ggKi8gcCguLi5pbnB1dHMpIHsKCQkJX2lucHV0cyA9IGlucHV0czsKCQkJX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4gZ3JvdXAucHVzaChpbnB1dCkpOwoJCX0sCgkJLyogcmVtb3ZlICovIHIoKSB7CgkJCV9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IGdyb3VwLnNwbGljZShncm91cC5pbmRleE9mKGlucHV0KSwgMSkpOwoJCX0KCX07Cn0KCi8qKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQKICogQHJldHVybnMge0NoaWxkTm9kZVtdfQogKi8KZnVuY3Rpb24gY2hpbGRyZW4oZWxlbWVudCkgewoJcmV0dXJuIEFycmF5LmZyb20oZWxlbWVudC5jaGlsZE5vZGVzKTsKfQoKLyoqCiAqIEBwYXJhbSB7VGV4dH0gdGV4dAogKiBAcGFyYW0ge3Vua25vd259IGRhdGEKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBzZXRfZGF0YSh0ZXh0LCBkYXRhKSB7CglkYXRhID0gJycgKyBkYXRhOwoJaWYgKHRleHQuZGF0YSA9PT0gZGF0YSkgcmV0dXJuOwoJdGV4dC5kYXRhID0gLyoqIEB0eXBlIHtzdHJpbmd9ICovIChkYXRhKTsKfQoKLyoqCiAqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIHZhbHVlKSB7CglpbnB1dC52YWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlOwp9CgovKioKICogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIHRvZ2dsZV9jbGFzcyhlbGVtZW50LCBuYW1lLCB0b2dnbGUpIHsKCS8vIFRoZSBgISFgIGlzIHJlcXVpcmVkIGJlY2F1c2UgYW4gYHVuZGVmaW5lZGAgZmxhZyBtZWFucyBmbGlwcGluZyB0aGUgY3VycmVudCBzdGF0ZS4KCWVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShuYW1lLCAhIXRvZ2dsZSk7Cn0KCi8qKgogKiBAdGVtcGxhdGUgVAogKiBAcGFyYW0ge3N0cmluZ30gdHlwZQogKiBAcGFyYW0ge1R9IFtkZXRhaWxdCiAqIEBwYXJhbSB7eyBidWJibGVzPzogYm9vbGVhbiwgY2FuY2VsYWJsZT86IGJvb2xlYW4gfX0gW29wdGlvbnNdCiAqIEByZXR1cm5zIHtDdXN0b21FdmVudDxUPn0KICovCmZ1bmN0aW9uIGN1c3RvbV9ldmVudCh0eXBlLCBkZXRhaWwsIHsgYnViYmxlcyA9IGZhbHNlLCBjYW5jZWxhYmxlID0gZmFsc2UgfSA9IHt9KSB7CglyZXR1cm4gbmV3IEN1c3RvbUV2ZW50KHR5cGUsIHsgZGV0YWlsLCBidWJibGVzLCBjYW5jZWxhYmxlIH0pOwp9Ci8qKiAqLwpjbGFzcyBIdG1sVGFnIHsKCS8qKgoJICogQHByaXZhdGUKCSAqIEBkZWZhdWx0IGZhbHNlCgkgKi8KCWlzX3N2ZyA9IGZhbHNlOwoJLyoqIHBhcmVudCBmb3IgY3JlYXRpbmcgbm9kZSAqLwoJZSA9IHVuZGVmaW5lZDsKCS8qKiBodG1sIHRhZyBub2RlcyAqLwoJbiA9IHVuZGVmaW5lZDsKCS8qKiB0YXJnZXQgKi8KCXQgPSB1bmRlZmluZWQ7CgkvKiogYW5jaG9yICovCglhID0gdW5kZWZpbmVkOwoJY29uc3RydWN0b3IoaXNfc3ZnID0gZmFsc2UpIHsKCQl0aGlzLmlzX3N2ZyA9IGlzX3N2ZzsKCQl0aGlzLmUgPSB0aGlzLm4gPSBudWxsOwoJfQoKCS8qKgoJICogQHBhcmFtIHtzdHJpbmd9IGh0bWwKCSAqIEByZXR1cm5zIHt2b2lkfQoJICovCgljKGh0bWwpIHsKCQl0aGlzLmgoaHRtbCk7Cgl9CgoJLyoqCgkgKiBAcGFyYW0ge3N0cmluZ30gaHRtbAoJICogQHBhcmFtIHtIVE1MRWxlbWVudCB8IFNWR0VsZW1lbnR9IHRhcmdldAoJICogQHBhcmFtIHtIVE1MRWxlbWVudCB8IFNWR0VsZW1lbnR9IGFuY2hvcgoJICogQHJldHVybnMge3ZvaWR9CgkgKi8KCW0oaHRtbCwgdGFyZ2V0LCBhbmNob3IgPSBudWxsKSB7CgkJaWYgKCF0aGlzLmUpIHsKCQkJaWYgKHRoaXMuaXNfc3ZnKQoJCQkJdGhpcy5lID0gc3ZnX2VsZW1lbnQoLyoqIEB0eXBlIHtrZXlvZiBTVkdFbGVtZW50VGFnTmFtZU1hcH0gKi8gKHRhcmdldC5ub2RlTmFtZSkpOwoJCQkvKiogIzczNjQgIHRhcmdldCBmb3IgPHRlbXBsYXRlPiBtYXkgYmUgcHJvdmlkZWQgYXMgI2RvY3VtZW50LWZyYWdtZW50KDExKSAqLyBlbHNlCgkJCQl0aGlzLmUgPSBlbGVtZW50KAoJCQkJCS8qKiBAdHlwZSB7a2V5b2YgSFRNTEVsZW1lbnRUYWdOYW1lTWFwfSAqLyAoCgkJCQkJCXRhcmdldC5ub2RlVHlwZSA9PT0gMTEgPyAnVEVNUExBVEUnIDogdGFyZ2V0Lm5vZGVOYW1lCgkJCQkJKQoJCQkJKTsKCQkJdGhpcy50ID0KCQkJCXRhcmdldC50YWdOYW1lICE9PSAnVEVNUExBVEUnCgkJCQkJPyB0YXJnZXQKCQkJCQk6IC8qKiBAdHlwZSB7SFRNTFRlbXBsYXRlRWxlbWVudH0gKi8gKHRhcmdldCkuY29udGVudDsKCQkJdGhpcy5jKGh0bWwpOwoJCX0KCQl0aGlzLmkoYW5jaG9yKTsKCX0KCgkvKioKCSAqIEBwYXJhbSB7c3RyaW5nfSBodG1sCgkgKiBAcmV0dXJucyB7dm9pZH0KCSAqLwoJaChodG1sKSB7CgkJdGhpcy5lLmlubmVySFRNTCA9IGh0bWw7CgkJdGhpcy5uID0gQXJyYXkuZnJvbSgKCQkJdGhpcy5lLm5vZGVOYW1lID09PSAnVEVNUExBVEUnID8gdGhpcy5lLmNvbnRlbnQuY2hpbGROb2RlcyA6IHRoaXMuZS5jaGlsZE5vZGVzCgkJKTsKCX0KCgkvKioKCSAqIEByZXR1cm5zIHt2b2lkfSAqLwoJaShhbmNob3IpIHsKCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubi5sZW5ndGg7IGkgKz0gMSkgewoJCQlpbnNlcnQodGhpcy50LCB0aGlzLm5baV0sIGFuY2hvcik7CgkJfQoJfQoKCS8qKgoJICogQHBhcmFtIHtzdHJpbmd9IGh0bWwKCSAqIEByZXR1cm5zIHt2b2lkfQoJICovCglwKGh0bWwpIHsKCQl0aGlzLmQoKTsKCQl0aGlzLmgoaHRtbCk7CgkJdGhpcy5pKHRoaXMuYSk7Cgl9CgoJLyoqCgkgKiBAcmV0dXJucyB7dm9pZH0gKi8KCWQoKSB7CgkJdGhpcy5uLmZvckVhY2goZGV0YWNoKTsKCX0KfQoKLyoqCiAqIEB0eXBlZGVmIHtOb2RlICYgewogKiAJY2xhaW1fb3JkZXI/OiBudW1iZXI7CiAqIAloeWRyYXRlX2luaXQ/OiB0cnVlOwogKiAJYWN0dWFsX2VuZF9jaGlsZD86IE5vZGVFeDsKICogCWNoaWxkTm9kZXM6IE5vZGVMaXN0T2Y8Tm9kZUV4PjsKICogfX0gTm9kZUV4CiAqLwoKLyoqIEB0eXBlZGVmIHtDaGlsZE5vZGUgJiBOb2RlRXh9IENoaWxkTm9kZUV4ICovCgovKiogQHR5cGVkZWYge05vZGVFeCAmIHsgY2xhaW1fb3JkZXI6IG51bWJlciB9fSBOb2RlRXgyICovCgovKioKICogQHR5cGVkZWYge0NoaWxkTm9kZUV4W10gJiB7CiAqIAljbGFpbV9pbmZvPzogewogKiAJCWxhc3RfaW5kZXg6IG51bWJlcjsKICogCQl0b3RhbF9jbGFpbWVkOiBudW1iZXI7CiAqIAl9OwogKiB9fSBDaGlsZE5vZGVBcnJheQogKi8KCi8vIHdlIG5lZWQgdG8gc3RvcmUgdGhlIGluZm9ybWF0aW9uIGZvciBtdWx0aXBsZSBkb2N1bWVudHMgYmVjYXVzZSBhIFN2ZWx0ZSBhcHBsaWNhdGlvbiBjb3VsZCBhbHNvIGNvbnRhaW4gaWZyYW1lcwovLyBodHRwczovL2dpdGh1Yi5jb20vc3ZlbHRlanMvc3ZlbHRlL2lzc3Vlcy8zNjI0Ci8qKiBAdHlwZSB7TWFwPERvY3VtZW50IHwgU2hhZG93Um9vdCwgaW1wb3J0KCcuL3ByaXZhdGUuZC50cycpLlN0eWxlSW5mb3JtYXRpb24+fSAqLwpjb25zdCBtYW5hZ2VkX3N0eWxlcyA9IG5ldyBNYXAoKTsKCmxldCBhY3RpdmUgPSAwOwoKLy8gaHR0cHM6Ly9naXRodWIuY29tL2Rhcmtza3lhcHAvc3RyaW5nLWhhc2gvYmxvYi9tYXN0ZXIvaW5kZXguanMKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIKICogQHJldHVybnMge251bWJlcn0KICovCmZ1bmN0aW9uIGhhc2goc3RyKSB7CglsZXQgaGFzaCA9IDUzODE7CglsZXQgaSA9IHN0ci5sZW5ndGg7Cgl3aGlsZSAoaS0tKSBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgXiBzdHIuY2hhckNvZGVBdChpKTsKCXJldHVybiBoYXNoID4+PiAwOwp9CgovKioKICogQHBhcmFtIHtEb2N1bWVudCB8IFNoYWRvd1Jvb3R9IGRvYwogKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGUKICogQHJldHVybnMge3sgc3R5bGVzaGVldDogYW55OyBydWxlczoge307IH19CiAqLwpmdW5jdGlvbiBjcmVhdGVfc3R5bGVfaW5mb3JtYXRpb24oZG9jLCBub2RlKSB7Cgljb25zdCBpbmZvID0geyBzdHlsZXNoZWV0OiBhcHBlbmRfZW1wdHlfc3R5bGVzaGVldChub2RlKSwgcnVsZXM6IHt9IH07CgltYW5hZ2VkX3N0eWxlcy5zZXQoZG9jLCBpbmZvKTsKCXJldHVybiBpbmZvOwp9CgovKioKICogQHBhcmFtIHtFbGVtZW50ICYgRWxlbWVudENTU0lubGluZVN0eWxlfSBub2RlCiAqIEBwYXJhbSB7bnVtYmVyfSBhCiAqIEBwYXJhbSB7bnVtYmVyfSBiCiAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbgogKiBAcGFyYW0ge251bWJlcn0gZGVsYXkKICogQHBhcmFtIHsodDogbnVtYmVyKSA9PiBudW1iZXJ9IGVhc2UKICogQHBhcmFtIHsodDogbnVtYmVyLCB1OiBudW1iZXIpID0+IHN0cmluZ30gZm4KICogQHBhcmFtIHtudW1iZXJ9IHVpZAogKiBAcmV0dXJucyB7c3RyaW5nfQogKi8KZnVuY3Rpb24gY3JlYXRlX3J1bGUobm9kZSwgYSwgYiwgZHVyYXRpb24sIGRlbGF5LCBlYXNlLCBmbiwgdWlkID0gMCkgewoJY29uc3Qgc3RlcCA9IDE2LjY2NiAvIGR1cmF0aW9uOwoJbGV0IGtleWZyYW1lcyA9ICd7XG4nOwoJZm9yIChsZXQgcCA9IDA7IHAgPD0gMTsgcCArPSBzdGVwKSB7CgkJY29uc3QgdCA9IGEgKyAoYiAtIGEpICogZWFzZShwKTsKCQlrZXlmcmFtZXMgKz0gcCAqIDEwMCArIGAleyR7Zm4odCwgMSAtIHQpfX1cbmA7Cgl9Cgljb25zdCBydWxlID0ga2V5ZnJhbWVzICsgYDEwMCUgeyR7Zm4oYiwgMSAtIGIpfX1cbn1gOwoJY29uc3QgbmFtZSA9IGBfX3N2ZWx0ZV8ke2hhc2gocnVsZSl9XyR7dWlkfWA7Cgljb25zdCBkb2MgPSBnZXRfcm9vdF9mb3Jfc3R5bGUobm9kZSk7Cgljb25zdCB7IHN0eWxlc2hlZXQsIHJ1bGVzIH0gPSBtYW5hZ2VkX3N0eWxlcy5nZXQoZG9jKSB8fCBjcmVhdGVfc3R5bGVfaW5mb3JtYXRpb24oZG9jLCBub2RlKTsKCWlmICghcnVsZXNbbmFtZV0pIHsKCQlydWxlc1tuYW1lXSA9IHRydWU7CgkJc3R5bGVzaGVldC5pbnNlcnRSdWxlKGBAa2V5ZnJhbWVzICR7bmFtZX0gJHtydWxlfWAsIHN0eWxlc2hlZXQuY3NzUnVsZXMubGVuZ3RoKTsKCX0KCWNvbnN0IGFuaW1hdGlvbiA9IG5vZGUuc3R5bGUuYW5pbWF0aW9uIHx8ICcnOwoJbm9kZS5zdHlsZS5hbmltYXRpb24gPSBgJHsKCQlhbmltYXRpb24gPyBgJHthbmltYXRpb259LCBgIDogJycKCX0ke25hbWV9ICR7ZHVyYXRpb259bXMgbGluZWFyICR7ZGVsYXl9bXMgMSBib3RoYDsKCWFjdGl2ZSArPSAxOwoJcmV0dXJuIG5hbWU7Cn0KCi8qKgogKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGUKICogQHBhcmFtIHtzdHJpbmd9IFtuYW1lXQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGRlbGV0ZV9ydWxlKG5vZGUsIG5hbWUpIHsKCWNvbnN0IHByZXZpb3VzID0gKG5vZGUuc3R5bGUuYW5pbWF0aW9uIHx8ICcnKS5zcGxpdCgnLCAnKTsKCWNvbnN0IG5leHQgPSBwcmV2aW91cy5maWx0ZXIoCgkJbmFtZQoJCQk/IChhbmltKSA9PiBhbmltLmluZGV4T2YobmFtZSkgPCAwIC8vIHJlbW92ZSBzcGVjaWZpYyBhbmltYXRpb24KCQkJOiAoYW5pbSkgPT4gYW5pbS5pbmRleE9mKCdfX3N2ZWx0ZScpID09PSAtMSAvLyByZW1vdmUgYWxsIFN2ZWx0ZSBhbmltYXRpb25zCgkpOwoJY29uc3QgZGVsZXRlZCA9IHByZXZpb3VzLmxlbmd0aCAtIG5leHQubGVuZ3RoOwoJaWYgKGRlbGV0ZWQpIHsKCQlub2RlLnN0eWxlLmFuaW1hdGlvbiA9IG5leHQuam9pbignLCAnKTsKCQlhY3RpdmUgLT0gZGVsZXRlZDsKCQlpZiAoIWFjdGl2ZSkgY2xlYXJfcnVsZXMoKTsKCX0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBjbGVhcl9ydWxlcygpIHsKCXJhZigoKSA9PiB7CgkJaWYgKGFjdGl2ZSkgcmV0dXJuOwoJCW1hbmFnZWRfc3R5bGVzLmZvckVhY2goKGluZm8pID0+IHsKCQkJY29uc3QgeyBvd25lck5vZGUgfSA9IGluZm8uc3R5bGVzaGVldDsKCQkJLy8gdGhlcmUgaXMgbm8gb3duZXJOb2RlIGlmIGl0IHJ1bnMgb24ganNkb20uCgkJCWlmIChvd25lck5vZGUpIGRldGFjaChvd25lck5vZGUpOwoJCX0pOwoJCW1hbmFnZWRfc3R5bGVzLmNsZWFyKCk7Cgl9KTsKfQoKbGV0IGN1cnJlbnRfY29tcG9uZW50OwoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBzZXRfY3VycmVudF9jb21wb25lbnQoY29tcG9uZW50KSB7CgljdXJyZW50X2NvbXBvbmVudCA9IGNvbXBvbmVudDsKfQoKZnVuY3Rpb24gZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkgewoJaWYgKCFjdXJyZW50X2NvbXBvbmVudCkgdGhyb3cgbmV3IEVycm9yKCdGdW5jdGlvbiBjYWxsZWQgb3V0c2lkZSBjb21wb25lbnQgaW5pdGlhbGl6YXRpb24nKTsKCXJldHVybiBjdXJyZW50X2NvbXBvbmVudDsKfQoKLyoqCiAqIFRoZSBgb25Nb3VudGAgZnVuY3Rpb24gc2NoZWR1bGVzIGEgY2FsbGJhY2sgdG8gcnVuIGFzIHNvb24gYXMgdGhlIGNvbXBvbmVudCBoYXMgYmVlbiBtb3VudGVkIHRvIHRoZSBET00uCiAqIEl0IG11c3QgYmUgY2FsbGVkIGR1cmluZyB0aGUgY29tcG9uZW50J3MgaW5pdGlhbGlzYXRpb24gKGJ1dCBkb2Vzbid0IG5lZWQgdG8gbGl2ZSAqaW5zaWRlKiB0aGUgY29tcG9uZW50OwogKiBpdCBjYW4gYmUgY2FsbGVkIGZyb20gYW4gZXh0ZXJuYWwgbW9kdWxlKS4KICoKICogSWYgYSBmdW5jdGlvbiBpcyByZXR1cm5lZCBfc3luY2hyb25vdXNseV8gZnJvbSBgb25Nb3VudGAsIGl0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGNvbXBvbmVudCBpcyB1bm1vdW50ZWQuCiAqCiAqIGBvbk1vdW50YCBkb2VzIG5vdCBydW4gaW5zaWRlIGEgW3NlcnZlci1zaWRlIGNvbXBvbmVudF0oL2RvY3MjcnVuLXRpbWUtc2VydmVyLXNpZGUtY29tcG9uZW50LWFwaSkuCiAqCiAqIGh0dHBzOi8vc3ZlbHRlLmRldi9kb2NzL3N2ZWx0ZSNvbm1vdW50CiAqIEB0ZW1wbGF0ZSBUCiAqIEBwYXJhbSB7KCkgPT4gaW1wb3J0KCcuL3ByaXZhdGUuanMnKS5Ob3RGdW5jdGlvbjxUPiB8IFByb21pc2U8aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5Ob3RGdW5jdGlvbjxUPj4gfCAoKCkgPT4gYW55KX0gZm4KICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBvbk1vdW50KGZuKSB7CglnZXRfY3VycmVudF9jb21wb25lbnQoKS4kJC5vbl9tb3VudC5wdXNoKGZuKTsKfQoKLyoqCiAqIFNjaGVkdWxlcyBhIGNhbGxiYWNrIHRvIHJ1biBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIGNvbXBvbmVudCBpcyB1bm1vdW50ZWQuCiAqCiAqIE91dCBvZiBgb25Nb3VudGAsIGBiZWZvcmVVcGRhdGVgLCBgYWZ0ZXJVcGRhdGVgIGFuZCBgb25EZXN0cm95YCwgdGhpcyBpcyB0aGUKICogb25seSBvbmUgdGhhdCBydW5zIGluc2lkZSBhIHNlcnZlci1zaWRlIGNvbXBvbmVudC4KICoKICogaHR0cHM6Ly9zdmVsdGUuZGV2L2RvY3Mvc3ZlbHRlI29uZGVzdHJveQogKiBAcGFyYW0geygpID0+IGFueX0gZm4KICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBvbkRlc3Ryb3koZm4pIHsKCWdldF9jdXJyZW50X2NvbXBvbmVudCgpLiQkLm9uX2Rlc3Ryb3kucHVzaChmbik7Cn0KCi8qKgogKiBDcmVhdGVzIGFuIGV2ZW50IGRpc3BhdGNoZXIgdGhhdCBjYW4gYmUgdXNlZCB0byBkaXNwYXRjaCBbY29tcG9uZW50IGV2ZW50c10oL2RvY3MjdGVtcGxhdGUtc3ludGF4LWNvbXBvbmVudC1kaXJlY3RpdmVzLW9uLWV2ZW50bmFtZSkuCiAqIEV2ZW50IGRpc3BhdGNoZXJzIGFyZSBmdW5jdGlvbnMgdGhhdCBjYW4gdGFrZSB0d28gYXJndW1lbnRzOiBgbmFtZWAgYW5kIGBkZXRhaWxgLgogKgogKiBDb21wb25lbnQgZXZlbnRzIGNyZWF0ZWQgd2l0aCBgY3JlYXRlRXZlbnREaXNwYXRjaGVyYCBjcmVhdGUgYQogKiBbQ3VzdG9tRXZlbnRdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DdXN0b21FdmVudCkuCiAqIFRoZXNlIGV2ZW50cyBkbyBub3QgW2J1YmJsZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9MZWFybi9KYXZhU2NyaXB0L0J1aWxkaW5nX2Jsb2Nrcy9FdmVudHMjRXZlbnRfYnViYmxpbmdfYW5kX2NhcHR1cmUpLgogKiBUaGUgYGRldGFpbGAgYXJndW1lbnQgY29ycmVzcG9uZHMgdG8gdGhlIFtDdXN0b21FdmVudC5kZXRhaWxdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DdXN0b21FdmVudC9kZXRhaWwpCiAqIHByb3BlcnR5IGFuZCBjYW4gY29udGFpbiBhbnkgdHlwZSBvZiBkYXRhLgogKgogKiBUaGUgZXZlbnQgZGlzcGF0Y2hlciBjYW4gYmUgdHlwZWQgdG8gbmFycm93IHRoZSBhbGxvd2VkIGV2ZW50IG5hbWVzIGFuZCB0aGUgdHlwZSBvZiB0aGUgYGRldGFpbGAgYXJndW1lbnQ6CiAqIGBgYHRzCiAqIGNvbnN0IGRpc3BhdGNoID0gY3JlYXRlRXZlbnREaXNwYXRjaGVyPHsKICogIGxvYWRlZDogbmV2ZXI7IC8vIGRvZXMgbm90IHRha2UgYSBkZXRhaWwgYXJndW1lbnQKICogIGNoYW5nZTogc3RyaW5nOyAvLyB0YWtlcyBhIGRldGFpbCBhcmd1bWVudCBvZiB0eXBlIHN0cmluZywgd2hpY2ggaXMgcmVxdWlyZWQKICogIG9wdGlvbmFsOiBudW1iZXIgfCBudWxsOyAvLyB0YWtlcyBhbiBvcHRpb25hbCBkZXRhaWwgYXJndW1lbnQgb2YgdHlwZSBudW1iZXIKICogfT4oKTsKICogYGBgCiAqCiAqIGh0dHBzOi8vc3ZlbHRlLmRldi9kb2NzL3N2ZWx0ZSNjcmVhdGVldmVudGRpc3BhdGNoZXIKICogQHRlbXBsYXRlIHtSZWNvcmQ8c3RyaW5nLCBhbnk+fSBbRXZlbnRNYXA9YW55XQogKiBAcmV0dXJucyB7aW1wb3J0KCcuL3B1YmxpYy5qcycpLkV2ZW50RGlzcGF0Y2hlcjxFdmVudE1hcD59CiAqLwpmdW5jdGlvbiBjcmVhdGVFdmVudERpc3BhdGNoZXIoKSB7Cgljb25zdCBjb21wb25lbnQgPSBnZXRfY3VycmVudF9jb21wb25lbnQoKTsKCXJldHVybiAodHlwZSwgZGV0YWlsLCB7IGNhbmNlbGFibGUgPSBmYWxzZSB9ID0ge30pID0+IHsKCQljb25zdCBjYWxsYmFja3MgPSBjb21wb25lbnQuJCQuY2FsbGJhY2tzW3R5cGVdOwoJCWlmIChjYWxsYmFja3MpIHsKCQkJLy8gVE9ETyBhcmUgdGhlcmUgc2l0dWF0aW9ucyB3aGVyZSBldmVudHMgY291bGQgYmUgZGlzcGF0Y2hlZAoJCQkvLyBpbiBhIHNlcnZlciAobm9uLURPTSkgZW52aXJvbm1lbnQ/CgkJCWNvbnN0IGV2ZW50ID0gY3VzdG9tX2V2ZW50KC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAodHlwZSksIGRldGFpbCwgeyBjYW5jZWxhYmxlIH0pOwoJCQljYWxsYmFja3Muc2xpY2UoKS5mb3JFYWNoKChmbikgPT4gewoJCQkJZm4uY2FsbChjb21wb25lbnQsIGV2ZW50KTsKCQkJfSk7CgkJCXJldHVybiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZDsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9Owp9CgovLyBUT0RPIGZpZ3VyZSBvdXQgaWYgd2Ugc3RpbGwgd2FudCB0byBzdXBwb3J0Ci8vIHNob3J0aGFuZCBldmVudHMsIG9yIGlmIHdlIHdhbnQgdG8gaW1wbGVtZW50Ci8vIGEgcmVhbCBidWJibGluZyBtZWNoYW5pc20KLyoqCiAqIEBwYXJhbSBjb21wb25lbnQKICogQHBhcmFtIGV2ZW50CiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gYnViYmxlKGNvbXBvbmVudCwgZXZlbnQpIHsKCWNvbnN0IGNhbGxiYWNrcyA9IGNvbXBvbmVudC4kJC5jYWxsYmFja3NbZXZlbnQudHlwZV07CglpZiAoY2FsbGJhY2tzKSB7CgkJLy8gQHRzLWlnbm9yZQoJCWNhbGxiYWNrcy5zbGljZSgpLmZvckVhY2goKGZuKSA9PiBmbi5jYWxsKHRoaXMsIGV2ZW50KSk7Cgl9Cn0KCmNvbnN0IGRpcnR5X2NvbXBvbmVudHMgPSBbXTsKY29uc3QgYmluZGluZ19jYWxsYmFja3MgPSBbXTsKCmxldCByZW5kZXJfY2FsbGJhY2tzID0gW107Cgpjb25zdCBmbHVzaF9jYWxsYmFja3MgPSBbXTsKCmNvbnN0IHJlc29sdmVkX3Byb21pc2UgPSAvKiBAX19QVVJFX18gKi8gUHJvbWlzZS5yZXNvbHZlKCk7CgpsZXQgdXBkYXRlX3NjaGVkdWxlZCA9IGZhbHNlOwoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBzY2hlZHVsZV91cGRhdGUoKSB7CglpZiAoIXVwZGF0ZV9zY2hlZHVsZWQpIHsKCQl1cGRhdGVfc2NoZWR1bGVkID0gdHJ1ZTsKCQlyZXNvbHZlZF9wcm9taXNlLnRoZW4oZmx1c2gpOwoJfQp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGFkZF9yZW5kZXJfY2FsbGJhY2soZm4pIHsKCXJlbmRlcl9jYWxsYmFja3MucHVzaChmbik7Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gYWRkX2ZsdXNoX2NhbGxiYWNrKGZuKSB7CglmbHVzaF9jYWxsYmFja3MucHVzaChmbik7Cn0KCi8vIGZsdXNoKCkgY2FsbHMgY2FsbGJhY2tzIGluIHRoaXMgb3JkZXI6Ci8vIDEuIEFsbCBiZWZvcmVVcGRhdGUgY2FsbGJhY2tzLCBpbiBvcmRlcjogcGFyZW50cyBiZWZvcmUgY2hpbGRyZW4KLy8gMi4gQWxsIGJpbmQ6dGhpcyBjYWxsYmFja3MsIGluIHJldmVyc2Ugb3JkZXI6IGNoaWxkcmVuIGJlZm9yZSBwYXJlbnRzLgovLyAzLiBBbGwgYWZ0ZXJVcGRhdGUgY2FsbGJhY2tzLCBpbiBvcmRlcjogcGFyZW50cyBiZWZvcmUgY2hpbGRyZW4uIEVYQ0VQVAovLyAgICBmb3IgYWZ0ZXJVcGRhdGVzIGNhbGxlZCBkdXJpbmcgdGhlIGluaXRpYWwgb25Nb3VudCwgd2hpY2ggYXJlIGNhbGxlZCBpbgovLyAgICByZXZlcnNlIG9yZGVyOiBjaGlsZHJlbiBiZWZvcmUgcGFyZW50cy4KLy8gU2luY2UgY2FsbGJhY2tzIG1pZ2h0IHVwZGF0ZSBjb21wb25lbnQgdmFsdWVzLCB3aGljaCBjb3VsZCB0cmlnZ2VyIGFub3RoZXIKLy8gY2FsbCB0byBmbHVzaCgpLCB0aGUgZm9sbG93aW5nIHN0ZXBzIGd1YXJkIGFnYWluc3QgdGhpczoKLy8gMS4gRHVyaW5nIGJlZm9yZVVwZGF0ZSwgYW55IHVwZGF0ZWQgY29tcG9uZW50cyB3aWxsIGJlIGFkZGVkIHRvIHRoZQovLyAgICBkaXJ0eV9jb21wb25lbnRzIGFycmF5IGFuZCB3aWxsIGNhdXNlIGEgcmVlbnRyYW50IGNhbGwgdG8gZmx1c2goKS4gQmVjYXVzZQovLyAgICB0aGUgZmx1c2ggaW5kZXggaXMga2VwdCBvdXRzaWRlIHRoZSBmdW5jdGlvbiwgdGhlIHJlZW50cmFudCBjYWxsIHdpbGwgcGljawovLyAgICB1cCB3aGVyZSB0aGUgZWFybGllciBjYWxsIGxlZnQgb2ZmIGFuZCBnbyB0aHJvdWdoIGFsbCBkaXJ0eSBjb21wb25lbnRzLiBUaGUKLy8gICAgY3VycmVudF9jb21wb25lbnQgdmFsdWUgaXMgc2F2ZWQgYW5kIHJlc3RvcmVkIHNvIHRoYXQgdGhlIHJlZW50cmFudCBjYWxsIHdpbGwKLy8gICAgbm90IGludGVyZmVyZSB3aXRoIHRoZSAicGFyZW50IiBmbHVzaCgpIGNhbGwuCi8vIDIuIGJpbmQ6dGhpcyBjYWxsYmFja3MgY2Fubm90IHRyaWdnZXIgbmV3IGZsdXNoKCkgY2FsbHMuCi8vIDMuIER1cmluZyBhZnRlclVwZGF0ZSwgYW55IHVwZGF0ZWQgY29tcG9uZW50cyB3aWxsIE5PVCBoYXZlIHRoZWlyIGFmdGVyVXBkYXRlCi8vICAgIGNhbGxiYWNrIGNhbGxlZCBhIHNlY29uZCB0aW1lOyB0aGUgc2Vlbl9jYWxsYmFja3Mgc2V0LCBvdXRzaWRlIHRoZSBmbHVzaCgpCi8vICAgIGZ1bmN0aW9uLCBndWFyYW50ZWVzIHRoaXMgYmVoYXZpb3IuCmNvbnN0IHNlZW5fY2FsbGJhY2tzID0gbmV3IFNldCgpOwoKbGV0IGZsdXNoaWR4ID0gMDsgLy8gRG8gKm5vdCogbW92ZSB0aGlzIGluc2lkZSB0aGUgZmx1c2goKSBmdW5jdGlvbgoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBmbHVzaCgpIHsKCS8vIERvIG5vdCByZWVudGVyIGZsdXNoIHdoaWxlIGRpcnR5IGNvbXBvbmVudHMgYXJlIHVwZGF0ZWQsIGFzIHRoaXMgY2FuCgkvLyByZXN1bHQgaW4gYW4gaW5maW5pdGUgbG9vcC4gSW5zdGVhZCwgbGV0IHRoZSBpbm5lciBmbHVzaCBoYW5kbGUgaXQuCgkvLyBSZWVudHJhbmN5IGlzIG9rIGFmdGVyd2FyZHMgZm9yIGJpbmRpbmdzIGV0Yy4KCWlmIChmbHVzaGlkeCAhPT0gMCkgewoJCXJldHVybjsKCX0KCWNvbnN0IHNhdmVkX2NvbXBvbmVudCA9IGN1cnJlbnRfY29tcG9uZW50OwoJZG8gewoJCS8vIGZpcnN0LCBjYWxsIGJlZm9yZVVwZGF0ZSBmdW5jdGlvbnMKCQkvLyBhbmQgdXBkYXRlIGNvbXBvbmVudHMKCQl0cnkgewoJCQl3aGlsZSAoZmx1c2hpZHggPCBkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCkgewoJCQkJY29uc3QgY29tcG9uZW50ID0gZGlydHlfY29tcG9uZW50c1tmbHVzaGlkeF07CgkJCQlmbHVzaGlkeCsrOwoJCQkJc2V0X2N1cnJlbnRfY29tcG9uZW50KGNvbXBvbmVudCk7CgkJCQl1cGRhdGUoY29tcG9uZW50LiQkKTsKCQkJfQoJCX0gY2F0Y2ggKGUpIHsKCQkJLy8gcmVzZXQgZGlydHkgc3RhdGUgdG8gbm90IGVuZCB1cCBpbiBhIGRlYWRsb2NrZWQgc3RhdGUgYW5kIHRoZW4gcmV0aHJvdwoJCQlkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCA9IDA7CgkJCWZsdXNoaWR4ID0gMDsKCQkJdGhyb3cgZTsKCQl9CgkJc2V0X2N1cnJlbnRfY29tcG9uZW50KG51bGwpOwoJCWRpcnR5X2NvbXBvbmVudHMubGVuZ3RoID0gMDsKCQlmbHVzaGlkeCA9IDA7CgkJd2hpbGUgKGJpbmRpbmdfY2FsbGJhY2tzLmxlbmd0aCkgYmluZGluZ19jYWxsYmFja3MucG9wKCkoKTsKCQkvLyB0aGVuLCBvbmNlIGNvbXBvbmVudHMgYXJlIHVwZGF0ZWQsIGNhbGwKCQkvLyBhZnRlclVwZGF0ZSBmdW5jdGlvbnMuIFRoaXMgbWF5IGNhdXNlCgkJLy8gc3Vic2VxdWVudCB1cGRhdGVzLi4uCgkJZm9yIChsZXQgaSA9IDA7IGkgPCByZW5kZXJfY2FsbGJhY2tzLmxlbmd0aDsgaSArPSAxKSB7CgkJCWNvbnN0IGNhbGxiYWNrID0gcmVuZGVyX2NhbGxiYWNrc1tpXTsKCQkJaWYgKCFzZWVuX2NhbGxiYWNrcy5oYXMoY2FsbGJhY2spKSB7CgkJCQkvLyAuLi5zbyBndWFyZCBhZ2FpbnN0IGluZmluaXRlIGxvb3BzCgkJCQlzZWVuX2NhbGxiYWNrcy5hZGQoY2FsbGJhY2spOwoJCQkJY2FsbGJhY2soKTsKCQkJfQoJCX0KCQlyZW5kZXJfY2FsbGJhY2tzLmxlbmd0aCA9IDA7Cgl9IHdoaWxlIChkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCk7Cgl3aGlsZSAoZmx1c2hfY2FsbGJhY2tzLmxlbmd0aCkgewoJCWZsdXNoX2NhbGxiYWNrcy5wb3AoKSgpOwoJfQoJdXBkYXRlX3NjaGVkdWxlZCA9IGZhbHNlOwoJc2Vlbl9jYWxsYmFja3MuY2xlYXIoKTsKCXNldF9jdXJyZW50X2NvbXBvbmVudChzYXZlZF9jb21wb25lbnQpOwp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIHVwZGF0ZSgkJCkgewoJaWYgKCQkLmZyYWdtZW50ICE9PSBudWxsKSB7CgkJJCQudXBkYXRlKCk7CgkJcnVuX2FsbCgkJC5iZWZvcmVfdXBkYXRlKTsKCQljb25zdCBkaXJ0eSA9ICQkLmRpcnR5OwoJCSQkLmRpcnR5ID0gWy0xXTsKCQkkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5wKCQkLmN0eCwgZGlydHkpOwoJCSQkLmFmdGVyX3VwZGF0ZS5mb3JFYWNoKGFkZF9yZW5kZXJfY2FsbGJhY2spOwoJfQp9CgovKioKICogVXNlZnVsIGZvciBleGFtcGxlIHRvIGV4ZWN1dGUgcmVtYWluaW5nIGBhZnRlclVwZGF0ZWAgY2FsbGJhY2tzIGJlZm9yZSBleGVjdXRpbmcgYGRlc3Ryb3lgLgogKiBAcGFyYW0ge0Z1bmN0aW9uW119IGZucwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGZsdXNoX3JlbmRlcl9jYWxsYmFja3MoZm5zKSB7Cgljb25zdCBmaWx0ZXJlZCA9IFtdOwoJY29uc3QgdGFyZ2V0cyA9IFtdOwoJcmVuZGVyX2NhbGxiYWNrcy5mb3JFYWNoKChjKSA9PiAoZm5zLmluZGV4T2YoYykgPT09IC0xID8gZmlsdGVyZWQucHVzaChjKSA6IHRhcmdldHMucHVzaChjKSkpOwoJdGFyZ2V0cy5mb3JFYWNoKChjKSA9PiBjKCkpOwoJcmVuZGVyX2NhbGxiYWNrcyA9IGZpbHRlcmVkOwp9CgovKioKICogQHR5cGUge1Byb21pc2U8dm9pZD4gfCBudWxsfQogKi8KbGV0IHByb21pc2U7CgovKioKICogQHJldHVybnMge1Byb21pc2U8dm9pZD59CiAqLwpmdW5jdGlvbiB3YWl0KCkgewoJaWYgKCFwcm9taXNlKSB7CgkJcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpOwoJCXByb21pc2UudGhlbigoKSA9PiB7CgkJCXByb21pc2UgPSBudWxsOwoJCX0pOwoJfQoJcmV0dXJuIHByb21pc2U7Cn0KCi8qKgogKiBAcGFyYW0ge0VsZW1lbnR9IG5vZGUKICogQHBhcmFtIHtJTlRSTyB8IE9VVFJPIHwgYm9vbGVhbn0gZGlyZWN0aW9uCiAqIEBwYXJhbSB7J3N0YXJ0JyB8ICdlbmQnfSBraW5kCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gZGlzcGF0Y2gobm9kZSwgZGlyZWN0aW9uLCBraW5kKSB7Cglub2RlLmRpc3BhdGNoRXZlbnQoY3VzdG9tX2V2ZW50KGAke2RpcmVjdGlvbiA/ICdpbnRybycgOiAnb3V0cm8nfSR7a2luZH1gKSk7Cn0KCmNvbnN0IG91dHJvaW5nID0gbmV3IFNldCgpOwoKLyoqCiAqIEB0eXBlIHtPdXRyb30KICovCmxldCBvdXRyb3M7CgovKioKICogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGdyb3VwX291dHJvcygpIHsKCW91dHJvcyA9IHsKCQlyOiAwLAoJCWM6IFtdLAoJCXA6IG91dHJvcyAvLyBwYXJlbnQgZ3JvdXAKCX07Cn0KCi8qKgogKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gY2hlY2tfb3V0cm9zKCkgewoJaWYgKCFvdXRyb3MucikgewoJCXJ1bl9hbGwob3V0cm9zLmMpOwoJfQoJb3V0cm9zID0gb3V0cm9zLnA7Cn0KCi8qKgogKiBAcGFyYW0ge2ltcG9ydCgnLi9wcml2YXRlLmpzJykuRnJhZ21lbnR9IGJsb2NrCiAqIEBwYXJhbSB7MCB8IDF9IFtsb2NhbF0KICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiB0cmFuc2l0aW9uX2luKGJsb2NrLCBsb2NhbCkgewoJaWYgKGJsb2NrICYmIGJsb2NrLmkpIHsKCQlvdXRyb2luZy5kZWxldGUoYmxvY2spOwoJCWJsb2NrLmkobG9jYWwpOwoJfQp9CgovKioKICogQHBhcmFtIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLkZyYWdtZW50fSBibG9jawogKiBAcGFyYW0gezAgfCAxfSBsb2NhbAogKiBAcGFyYW0gezAgfCAxfSBbZGV0YWNoXQogKiBAcGFyYW0geygpID0+IHZvaWR9IFtjYWxsYmFja10KICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiB0cmFuc2l0aW9uX291dChibG9jaywgbG9jYWwsIGRldGFjaCwgY2FsbGJhY2spIHsKCWlmIChibG9jayAmJiBibG9jay5vKSB7CgkJaWYgKG91dHJvaW5nLmhhcyhibG9jaykpIHJldHVybjsKCQlvdXRyb2luZy5hZGQoYmxvY2spOwoJCW91dHJvcy5jLnB1c2goKCkgPT4gewoJCQlvdXRyb2luZy5kZWxldGUoYmxvY2spOwoJCQlpZiAoY2FsbGJhY2spIHsKCQkJCWlmIChkZXRhY2gpIGJsb2NrLmQoMSk7CgkJCQljYWxsYmFjaygpOwoJCQl9CgkJfSk7CgkJYmxvY2subyhsb2NhbCk7Cgl9IGVsc2UgaWYgKGNhbGxiYWNrKSB7CgkJY2FsbGJhY2soKTsKCX0KfQoKLyoqCiAqIEB0eXBlIHtpbXBvcnQoJy4uL3RyYW5zaXRpb24vcHVibGljLmpzJykuVHJhbnNpdGlvbkNvbmZpZ30KICovCmNvbnN0IG51bGxfdHJhbnNpdGlvbiA9IHsgZHVyYXRpb246IDAgfTsKCi8qKgogKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGUKICogQHBhcmFtIHtUcmFuc2l0aW9uRm59IGZuCiAqIEBwYXJhbSB7YW55fSBwYXJhbXMKICogQHJldHVybnMge3sgZW5kKHJlc2V0OiBhbnkpOiB2b2lkOyB9fQogKi8KZnVuY3Rpb24gY3JlYXRlX291dF90cmFuc2l0aW9uKG5vZGUsIGZuLCBwYXJhbXMpIHsKCS8qKiBAdHlwZSB7VHJhbnNpdGlvbk9wdGlvbnN9ICovCgljb25zdCBvcHRpb25zID0geyBkaXJlY3Rpb246ICdvdXQnIH07CglsZXQgY29uZmlnID0gZm4obm9kZSwgcGFyYW1zLCBvcHRpb25zKTsKCWxldCBydW5uaW5nID0gdHJ1ZTsKCWxldCBhbmltYXRpb25fbmFtZTsKCWNvbnN0IGdyb3VwID0gb3V0cm9zOwoJZ3JvdXAuciArPSAxOwoJLyoqIEB0eXBlIHtib29sZWFufSAqLwoJbGV0IG9yaWdpbmFsX2luZXJ0X3ZhbHVlOwoKCS8qKgoJICogQHJldHVybnMge3ZvaWR9ICovCglmdW5jdGlvbiBnbygpIHsKCQljb25zdCB7CgkJCWRlbGF5ID0gMCwKCQkJZHVyYXRpb24gPSAzMDAsCgkJCWVhc2luZyA9IGlkZW50aXR5LAoJCQl0aWNrID0gbm9vcCQ0LAoJCQljc3MKCQl9ID0gY29uZmlnIHx8IG51bGxfdHJhbnNpdGlvbjsKCgkJaWYgKGNzcykgYW5pbWF0aW9uX25hbWUgPSBjcmVhdGVfcnVsZShub2RlLCAxLCAwLCBkdXJhdGlvbiwgZGVsYXksIGVhc2luZywgY3NzKTsKCgkJY29uc3Qgc3RhcnRfdGltZSA9IG5vdygpICsgZGVsYXk7CgkJY29uc3QgZW5kX3RpbWUgPSBzdGFydF90aW1lICsgZHVyYXRpb247CgkJYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiBkaXNwYXRjaChub2RlLCBmYWxzZSwgJ3N0YXJ0JykpOwoKCQlpZiAoJ2luZXJ0JyBpbiBub2RlKSB7CgkJCW9yaWdpbmFsX2luZXJ0X3ZhbHVlID0gLyoqIEB0eXBlIHtIVE1MRWxlbWVudH0gKi8gKG5vZGUpLmluZXJ0OwoJCQlub2RlLmluZXJ0ID0gdHJ1ZTsKCQl9CgoJCWxvb3AoKG5vdykgPT4gewoJCQlpZiAocnVubmluZykgewoJCQkJaWYgKG5vdyA+PSBlbmRfdGltZSkgewoJCQkJCXRpY2soMCwgMSk7CgkJCQkJZGlzcGF0Y2gobm9kZSwgZmFsc2UsICdlbmQnKTsKCQkJCQlpZiAoIS0tZ3JvdXAucikgewoJCQkJCQkvLyB0aGlzIHdpbGwgcmVzdWx0IGluIGBlbmQoKWAgYmVpbmcgY2FsbGVkLAoJCQkJCQkvLyBzbyB3ZSBkb24ndCBuZWVkIHRvIGNsZWFuIHVwIGhlcmUKCQkJCQkJcnVuX2FsbChncm91cC5jKTsKCQkJCQl9CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQkJaWYgKG5vdyA+PSBzdGFydF90aW1lKSB7CgkJCQkJY29uc3QgdCA9IGVhc2luZygobm93IC0gc3RhcnRfdGltZSkgLyBkdXJhdGlvbik7CgkJCQkJdGljaygxIC0gdCwgdCk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHJ1bm5pbmc7CgkJfSk7Cgl9CgoJaWYgKGlzX2Z1bmN0aW9uKGNvbmZpZykpIHsKCQl3YWl0KCkudGhlbigoKSA9PiB7CgkJCS8vIEB0cy1pZ25vcmUKCQkJY29uZmlnID0gY29uZmlnKG9wdGlvbnMpOwoJCQlnbygpOwoJCX0pOwoJfSBlbHNlIHsKCQlnbygpOwoJfQoKCXJldHVybiB7CgkJZW5kKHJlc2V0KSB7CgkJCWlmIChyZXNldCAmJiAnaW5lcnQnIGluIG5vZGUpIHsKCQkJCW5vZGUuaW5lcnQgPSBvcmlnaW5hbF9pbmVydF92YWx1ZTsKCQkJfQoJCQlpZiAocmVzZXQgJiYgY29uZmlnLnRpY2spIHsKCQkJCWNvbmZpZy50aWNrKDEsIDApOwoJCQl9CgkJCWlmIChydW5uaW5nKSB7CgkJCQlpZiAoYW5pbWF0aW9uX25hbWUpIGRlbGV0ZV9ydWxlKG5vZGUsIGFuaW1hdGlvbl9uYW1lKTsKCQkJCXJ1bm5pbmcgPSBmYWxzZTsKCQkJfQoJCX0KCX07Cn0KCi8qKiBAdHlwZWRlZiB7MX0gSU5UUk8gKi8KLyoqIEB0eXBlZGVmIHswfSBPVVRSTyAqLwovKiogQHR5cGVkZWYge3sgZGlyZWN0aW9uOiAnaW4nIHwgJ291dCcgfCAnYm90aCcgfX0gVHJhbnNpdGlvbk9wdGlvbnMgKi8KLyoqIEB0eXBlZGVmIHsobm9kZTogRWxlbWVudCwgcGFyYW1zOiBhbnksIG9wdGlvbnM6IFRyYW5zaXRpb25PcHRpb25zKSA9PiBpbXBvcnQoJy4uL3RyYW5zaXRpb24vcHVibGljLmpzJykuVHJhbnNpdGlvbkNvbmZpZ30gVHJhbnNpdGlvbkZuICovCgovKioKICogQHR5cGVkZWYge09iamVjdH0gT3V0cm8KICogQHByb3BlcnR5IHtudW1iZXJ9IHIKICogQHByb3BlcnR5IHtGdW5jdGlvbltdfSBjCiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBwCiAqLwoKLyoqCiAqIEB0eXBlZGVmIHtPYmplY3R9IFBlbmRpbmdQcm9ncmFtCiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydAogKiBAcHJvcGVydHkge0lOVFJPfE9VVFJPfSBiCiAqIEBwcm9wZXJ0eSB7T3V0cm99IFtncm91cF0KICovCgovKioKICogQHR5cGVkZWYge09iamVjdH0gUHJvZ3JhbQogKiBAcHJvcGVydHkge251bWJlcn0gYQogKiBAcHJvcGVydHkge0lOVFJPfE9VVFJPfSBiCiAqIEBwcm9wZXJ0eSB7MXwtMX0gZAogKiBAcHJvcGVydHkge251bWJlcn0gZHVyYXRpb24KICogQHByb3BlcnR5IHtudW1iZXJ9IHN0YXJ0CiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBlbmQKICogQHByb3BlcnR5IHtPdXRyb30gW2dyb3VwXQogKi8KCi8vIGdlbmVyYWwgZWFjaCBmdW5jdGlvbnM6CgpmdW5jdGlvbiBlbnN1cmVfYXJyYXlfbGlrZShhcnJheV9saWtlX29yX2l0ZXJhdG9yKSB7CglyZXR1cm4gYXJyYXlfbGlrZV9vcl9pdGVyYXRvcj8ubGVuZ3RoICE9PSB1bmRlZmluZWQKCQk/IGFycmF5X2xpa2Vfb3JfaXRlcmF0b3IKCQk6IEFycmF5LmZyb20oYXJyYXlfbGlrZV9vcl9pdGVyYXRvcik7Cn0KCi8qKiBAcmV0dXJucyB7e319ICovCmZ1bmN0aW9uIGdldF9zcHJlYWRfdXBkYXRlKGxldmVscywgdXBkYXRlcykgewoJY29uc3QgdXBkYXRlID0ge307Cgljb25zdCB0b19udWxsX291dCA9IHt9OwoJY29uc3QgYWNjb3VudGVkX2ZvciA9IHsgJCRzY29wZTogMSB9OwoJbGV0IGkgPSBsZXZlbHMubGVuZ3RoOwoJd2hpbGUgKGktLSkgewoJCWNvbnN0IG8gPSBsZXZlbHNbaV07CgkJY29uc3QgbiA9IHVwZGF0ZXNbaV07CgkJaWYgKG4pIHsKCQkJZm9yIChjb25zdCBrZXkgaW4gbykgewoJCQkJaWYgKCEoa2V5IGluIG4pKSB0b19udWxsX291dFtrZXldID0gMTsKCQkJfQoJCQlmb3IgKGNvbnN0IGtleSBpbiBuKSB7CgkJCQlpZiAoIWFjY291bnRlZF9mb3Jba2V5XSkgewoJCQkJCXVwZGF0ZVtrZXldID0gbltrZXldOwoJCQkJCWFjY291bnRlZF9mb3Jba2V5XSA9IDE7CgkJCQl9CgkJCX0KCQkJbGV2ZWxzW2ldID0gbjsKCQl9IGVsc2UgewoJCQlmb3IgKGNvbnN0IGtleSBpbiBvKSB7CgkJCQlhY2NvdW50ZWRfZm9yW2tleV0gPSAxOwoJCQl9CgkJfQoJfQoJZm9yIChjb25zdCBrZXkgaW4gdG9fbnVsbF9vdXQpIHsKCQlpZiAoIShrZXkgaW4gdXBkYXRlKSkgdXBkYXRlW2tleV0gPSB1bmRlZmluZWQ7Cgl9CglyZXR1cm4gdXBkYXRlOwp9CgpmdW5jdGlvbiBnZXRfc3ByZWFkX29iamVjdChzcHJlYWRfcHJvcHMpIHsKCXJldHVybiB0eXBlb2Ygc3ByZWFkX3Byb3BzID09PSAnb2JqZWN0JyAmJiBzcHJlYWRfcHJvcHMgIT09IG51bGwgPyBzcHJlYWRfcHJvcHMgOiB7fTsKfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBiaW5kKGNvbXBvbmVudCwgbmFtZSwgY2FsbGJhY2spIHsKCWNvbnN0IGluZGV4ID0gY29tcG9uZW50LiQkLnByb3BzW25hbWVdOwoJaWYgKGluZGV4ICE9PSB1bmRlZmluZWQpIHsKCQljb21wb25lbnQuJCQuYm91bmRbaW5kZXhdID0gY2FsbGJhY2s7CgkJY2FsbGJhY2soY29tcG9uZW50LiQkLmN0eFtpbmRleF0pOwoJfQp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGNyZWF0ZV9jb21wb25lbnQoYmxvY2spIHsKCWJsb2NrICYmIGJsb2NrLmMoKTsKfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBtb3VudF9jb21wb25lbnQoY29tcG9uZW50LCB0YXJnZXQsIGFuY2hvcikgewoJY29uc3QgeyBmcmFnbWVudCwgYWZ0ZXJfdXBkYXRlIH0gPSBjb21wb25lbnQuJCQ7CglmcmFnbWVudCAmJiBmcmFnbWVudC5tKHRhcmdldCwgYW5jaG9yKTsKCS8vIG9uTW91bnQgaGFwcGVucyBiZWZvcmUgdGhlIGluaXRpYWwgYWZ0ZXJVcGRhdGUKCWFkZF9yZW5kZXJfY2FsbGJhY2soKCkgPT4gewoJCWNvbnN0IG5ld19vbl9kZXN0cm95ID0gY29tcG9uZW50LiQkLm9uX21vdW50Lm1hcChydW4pLmZpbHRlcihpc19mdW5jdGlvbik7CgkJLy8gaWYgdGhlIGNvbXBvbmVudCB3YXMgZGVzdHJveWVkIGltbWVkaWF0ZWx5CgkJLy8gaXQgd2lsbCB1cGRhdGUgdGhlIGAkJC5vbl9kZXN0cm95YCByZWZlcmVuY2UgdG8gYG51bGxgLgoJCS8vIHRoZSBkZXN0cnVjdHVyZWQgb25fZGVzdHJveSBtYXkgc3RpbGwgcmVmZXJlbmNlIHRvIHRoZSBvbGQgYXJyYXkKCQlpZiAoY29tcG9uZW50LiQkLm9uX2Rlc3Ryb3kpIHsKCQkJY29tcG9uZW50LiQkLm9uX2Rlc3Ryb3kucHVzaCguLi5uZXdfb25fZGVzdHJveSk7CgkJfSBlbHNlIHsKCQkJLy8gRWRnZSBjYXNlIC0gY29tcG9uZW50IHdhcyBkZXN0cm95ZWQgaW1tZWRpYXRlbHksCgkJCS8vIG1vc3QgbGlrZWx5IGFzIGEgcmVzdWx0IG9mIGEgYmluZGluZyBpbml0aWFsaXNpbmcKCQkJcnVuX2FsbChuZXdfb25fZGVzdHJveSk7CgkJfQoJCWNvbXBvbmVudC4kJC5vbl9tb3VudCA9IFtdOwoJfSk7CglhZnRlcl91cGRhdGUuZm9yRWFjaChhZGRfcmVuZGVyX2NhbGxiYWNrKTsKfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBkZXN0cm95X2NvbXBvbmVudChjb21wb25lbnQsIGRldGFjaGluZykgewoJY29uc3QgJCQgPSBjb21wb25lbnQuJCQ7CglpZiAoJCQuZnJhZ21lbnQgIT09IG51bGwpIHsKCQlmbHVzaF9yZW5kZXJfY2FsbGJhY2tzKCQkLmFmdGVyX3VwZGF0ZSk7CgkJcnVuX2FsbCgkJC5vbl9kZXN0cm95KTsKCQkkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5kKGRldGFjaGluZyk7CgkJLy8gVE9ETyBudWxsIG91dCBvdGhlciByZWZzLCBpbmNsdWRpbmcgY29tcG9uZW50LiQkIChidXQgbmVlZCB0bwoJCS8vIHByZXNlcnZlIGZpbmFsIHN0YXRlPykKCQkkJC5vbl9kZXN0cm95ID0gJCQuZnJhZ21lbnQgPSBudWxsOwoJCSQkLmN0eCA9IFtdOwoJfQp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIG1ha2VfZGlydHkoY29tcG9uZW50LCBpKSB7CglpZiAoY29tcG9uZW50LiQkLmRpcnR5WzBdID09PSAtMSkgewoJCWRpcnR5X2NvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwoJCXNjaGVkdWxlX3VwZGF0ZSgpOwoJCWNvbXBvbmVudC4kJC5kaXJ0eS5maWxsKDApOwoJfQoJY29tcG9uZW50LiQkLmRpcnR5WyhpIC8gMzEpIHwgMF0gfD0gMSA8PCBpICUgMzE7Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gaW5pdCgKCWNvbXBvbmVudCwKCW9wdGlvbnMsCglpbnN0YW5jZSwKCWNyZWF0ZV9mcmFnbWVudCwKCW5vdF9lcXVhbCwKCXByb3BzLAoJYXBwZW5kX3N0eWxlcywKCWRpcnR5ID0gWy0xXQopIHsKCWNvbnN0IHBhcmVudF9jb21wb25lbnQgPSBjdXJyZW50X2NvbXBvbmVudDsKCXNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpOwoJLyoqIEB0eXBlIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLlQkJH0gKi8KCWNvbnN0ICQkID0gKGNvbXBvbmVudC4kJCA9IHsKCQlmcmFnbWVudDogbnVsbCwKCQljdHg6IFtdLAoJCS8vIHN0YXRlCgkJcHJvcHMsCgkJdXBkYXRlOiBub29wJDQsCgkJbm90X2VxdWFsLAoJCWJvdW5kOiBibGFua19vYmplY3QoKSwKCQkvLyBsaWZlY3ljbGUKCQlvbl9tb3VudDogW10sCgkJb25fZGVzdHJveTogW10sCgkJb25fZGlzY29ubmVjdDogW10sCgkJYmVmb3JlX3VwZGF0ZTogW10sCgkJYWZ0ZXJfdXBkYXRlOiBbXSwKCQljb250ZXh0OiBuZXcgTWFwKG9wdGlvbnMuY29udGV4dCB8fCAocGFyZW50X2NvbXBvbmVudCA/IHBhcmVudF9jb21wb25lbnQuJCQuY29udGV4dCA6IFtdKSksCgkJLy8gZXZlcnl0aGluZyBlbHNlCgkJY2FsbGJhY2tzOiBibGFua19vYmplY3QoKSwKCQlkaXJ0eSwKCQlza2lwX2JvdW5kOiBmYWxzZSwKCQlyb290OiBvcHRpb25zLnRhcmdldCB8fCBwYXJlbnRfY29tcG9uZW50LiQkLnJvb3QKCX0pOwoJYXBwZW5kX3N0eWxlcyAmJiBhcHBlbmRfc3R5bGVzKCQkLnJvb3QpOwoJbGV0IHJlYWR5ID0gZmFsc2U7CgkkJC5jdHggPSBpbnN0YW5jZQoJCT8gaW5zdGFuY2UoY29tcG9uZW50LCBvcHRpb25zLnByb3BzIHx8IHt9LCAoaSwgcmV0LCAuLi5yZXN0KSA9PiB7CgkJCQljb25zdCB2YWx1ZSA9IHJlc3QubGVuZ3RoID8gcmVzdFswXSA6IHJldDsKCQkJCWlmICgkJC5jdHggJiYgbm90X2VxdWFsKCQkLmN0eFtpXSwgKCQkLmN0eFtpXSA9IHZhbHVlKSkpIHsKCQkJCQlpZiAoISQkLnNraXBfYm91bmQgJiYgJCQuYm91bmRbaV0pICQkLmJvdW5kW2ldKHZhbHVlKTsKCQkJCQlpZiAocmVhZHkpIG1ha2VfZGlydHkoY29tcG9uZW50LCBpKTsKCQkJCX0KCQkJCXJldHVybiByZXQ7CgkJICB9KQoJCTogW107CgkkJC51cGRhdGUoKTsKCXJlYWR5ID0gdHJ1ZTsKCXJ1bl9hbGwoJCQuYmVmb3JlX3VwZGF0ZSk7CgkvLyBgZmFsc2VgIGFzIGEgc3BlY2lhbCBjYXNlIG9mIG5vIERPTSBjb21wb25lbnQKCSQkLmZyYWdtZW50ID0gY3JlYXRlX2ZyYWdtZW50ID8gY3JlYXRlX2ZyYWdtZW50KCQkLmN0eCkgOiBmYWxzZTsKCWlmIChvcHRpb25zLnRhcmdldCkgewoJCWlmIChvcHRpb25zLmh5ZHJhdGUpIHsKCQkJY29uc3Qgbm9kZXMgPSBjaGlsZHJlbihvcHRpb25zLnRhcmdldCk7CgkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uCgkJCSQkLmZyYWdtZW50ICYmICQkLmZyYWdtZW50Lmwobm9kZXMpOwoJCQlub2Rlcy5mb3JFYWNoKGRldGFjaCk7CgkJfSBlbHNlIHsKCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KCQkJJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQuYygpOwoJCX0KCQlpZiAob3B0aW9ucy5pbnRybykgdHJhbnNpdGlvbl9pbihjb21wb25lbnQuJCQuZnJhZ21lbnQpOwoJCW1vdW50X2NvbXBvbmVudChjb21wb25lbnQsIG9wdGlvbnMudGFyZ2V0LCBvcHRpb25zLmFuY2hvcik7CgkJZmx1c2goKTsKCX0KCXNldF9jdXJyZW50X2NvbXBvbmVudChwYXJlbnRfY29tcG9uZW50KTsKfQoKLyoqCiAqIEJhc2UgY2xhc3MgZm9yIFN2ZWx0ZSBjb21wb25lbnRzLiBVc2VkIHdoZW4gZGV2PWZhbHNlLgogKgogKiBAdGVtcGxhdGUge1JlY29yZDxzdHJpbmcsIGFueT59IFtQcm9wcz1hbnldCiAqIEB0ZW1wbGF0ZSB7UmVjb3JkPHN0cmluZywgYW55Pn0gW0V2ZW50cz1hbnldCiAqLwpjbGFzcyBTdmVsdGVDb21wb25lbnQgewoJLyoqCgkgKiAjIyMgUFJJVkFURSBBUEkKCSAqCgkgKiBEbyBub3QgdXNlLCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lCgkgKgoJICogQHR5cGUge2FueX0KCSAqLwoJJCQgPSB1bmRlZmluZWQ7CgkvKioKCSAqICMjIyBQUklWQVRFIEFQSQoJICoKCSAqIERvIG5vdCB1c2UsIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUKCSAqCgkgKiBAdHlwZSB7YW55fQoJICovCgkkJHNldCA9IHVuZGVmaW5lZDsKCgkvKiogQHJldHVybnMge3ZvaWR9ICovCgkkZGVzdHJveSgpIHsKCQlkZXN0cm95X2NvbXBvbmVudCh0aGlzLCAxKTsKCQl0aGlzLiRkZXN0cm95ID0gbm9vcCQ0OwoJfQoKCS8qKgoJICogQHRlbXBsYXRlIHtFeHRyYWN0PGtleW9mIEV2ZW50cywgc3RyaW5nPn0gSwoJICogQHBhcmFtIHtLfSB0eXBlCgkgKiBAcGFyYW0geygoZTogRXZlbnRzW0tdKSA9PiB2b2lkKSB8IG51bGwgfCB1bmRlZmluZWR9IGNhbGxiYWNrCgkgKiBAcmV0dXJucyB7KCkgPT4gdm9pZH0KCSAqLwoJJG9uKHR5cGUsIGNhbGxiYWNrKSB7CgkJaWYgKCFpc19mdW5jdGlvbihjYWxsYmFjaykpIHsKCQkJcmV0dXJuIG5vb3AkNDsKCQl9CgkJY29uc3QgY2FsbGJhY2tzID0gdGhpcy4kJC5jYWxsYmFja3NbdHlwZV0gfHwgKHRoaXMuJCQuY2FsbGJhY2tzW3R5cGVdID0gW10pOwoJCWNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsKCQlyZXR1cm4gKCkgPT4gewoJCQljb25zdCBpbmRleCA9IGNhbGxiYWNrcy5pbmRleE9mKGNhbGxiYWNrKTsKCQkJaWYgKGluZGV4ICE9PSAtMSkgY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSk7CgkJfTsKCX0KCgkvKioKCSAqIEBwYXJhbSB7UGFydGlhbDxQcm9wcz59IHByb3BzCgkgKiBAcmV0dXJucyB7dm9pZH0KCSAqLwoJJHNldChwcm9wcykgewoJCWlmICh0aGlzLiQkc2V0ICYmICFpc19lbXB0eShwcm9wcykpIHsKCQkJdGhpcy4kJC5za2lwX2JvdW5kID0gdHJ1ZTsKCQkJdGhpcy4kJHNldChwcm9wcyk7CgkJCXRoaXMuJCQuc2tpcF9ib3VuZCA9IGZhbHNlOwoJCX0KCX0KfQoKLyoqCiAqIEB0eXBlZGVmIHtPYmplY3R9IEN1c3RvbUVsZW1lbnRQcm9wRGVmaW5pdGlvbgogKiBAcHJvcGVydHkge3N0cmluZ30gW2F0dHJpYnV0ZV0KICogQHByb3BlcnR5IHtib29sZWFufSBbcmVmbGVjdF0KICogQHByb3BlcnR5IHsnU3RyaW5nJ3wnQm9vbGVhbid8J051bWJlcid8J0FycmF5J3wnT2JqZWN0J30gW3R5cGVdCiAqLwoKLy8gZ2VuZXJhdGVkIGR1cmluZyByZWxlYXNlLCBkbyBub3QgbW9kaWZ5Cgpjb25zdCBQVUJMSUNfVkVSU0lPTiA9ICc0JzsKCmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykKCS8vIEB0cy1pZ25vcmUKCSh3aW5kb3cuX19zdmVsdGUgfHwgKHdpbmRvdy5fX3N2ZWx0ZSA9IHsgdjogbmV3IFNldCgpIH0pKS52LmFkZChQVUJMSUNfVkVSU0lPTik7Cgpjb25zdCBtYXRjaEljb25OYW1lID0gL15bYS16MC05XSsoLVthLXowLTldKykqJC87CmNvbnN0IHN0cmluZ1RvSWNvbiA9ICh2YWx1ZSwgdmFsaWRhdGUsIGFsbG93U2ltcGxlTmFtZSwgcHJvdmlkZXIgPSAiIikgPT4gewogIGNvbnN0IGNvbG9uU2VwYXJhdGVkID0gdmFsdWUuc3BsaXQoIjoiKTsKICBpZiAodmFsdWUuc2xpY2UoMCwgMSkgPT09ICJAIikgewogICAgaWYgKGNvbG9uU2VwYXJhdGVkLmxlbmd0aCA8IDIgfHwgY29sb25TZXBhcmF0ZWQubGVuZ3RoID4gMykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHByb3ZpZGVyID0gY29sb25TZXBhcmF0ZWQuc2hpZnQoKS5zbGljZSgxKTsKICB9CiAgaWYgKGNvbG9uU2VwYXJhdGVkLmxlbmd0aCA+IDMgfHwgIWNvbG9uU2VwYXJhdGVkLmxlbmd0aCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChjb2xvblNlcGFyYXRlZC5sZW5ndGggPiAxKSB7CiAgICBjb25zdCBuYW1lMiA9IGNvbG9uU2VwYXJhdGVkLnBvcCgpOwogICAgY29uc3QgcHJlZml4ID0gY29sb25TZXBhcmF0ZWQucG9wKCk7CiAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgIC8vIEFsbG93IHByb3ZpZGVyIHdpdGhvdXQgJ0AnOiAicHJvdmlkZXI6cHJlZml4Om5hbWUiCiAgICAgIHByb3ZpZGVyOiBjb2xvblNlcGFyYXRlZC5sZW5ndGggPiAwID8gY29sb25TZXBhcmF0ZWRbMF0gOiBwcm92aWRlciwKICAgICAgcHJlZml4LAogICAgICBuYW1lOiBuYW1lMgogICAgfTsKICAgIHJldHVybiB2YWxpZGF0ZSAmJiAhdmFsaWRhdGVJY29uTmFtZShyZXN1bHQpID8gbnVsbCA6IHJlc3VsdDsKICB9CiAgY29uc3QgbmFtZSA9IGNvbG9uU2VwYXJhdGVkWzBdOwogIGNvbnN0IGRhc2hTZXBhcmF0ZWQgPSBuYW1lLnNwbGl0KCItIik7CiAgaWYgKGRhc2hTZXBhcmF0ZWQubGVuZ3RoID4gMSkgewogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBwcm92aWRlciwKICAgICAgcHJlZml4OiBkYXNoU2VwYXJhdGVkLnNoaWZ0KCksCiAgICAgIG5hbWU6IGRhc2hTZXBhcmF0ZWQuam9pbigiLSIpCiAgICB9OwogICAgcmV0dXJuIHZhbGlkYXRlICYmICF2YWxpZGF0ZUljb25OYW1lKHJlc3VsdCkgPyBudWxsIDogcmVzdWx0OwogIH0KICBpZiAoYWxsb3dTaW1wbGVOYW1lICYmIHByb3ZpZGVyID09PSAiIikgewogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBwcm92aWRlciwKICAgICAgcHJlZml4OiAiIiwKICAgICAgbmFtZQogICAgfTsKICAgIHJldHVybiB2YWxpZGF0ZSAmJiAhdmFsaWRhdGVJY29uTmFtZShyZXN1bHQsIGFsbG93U2ltcGxlTmFtZSkgPyBudWxsIDogcmVzdWx0OwogIH0KICByZXR1cm4gbnVsbDsKfTsKY29uc3QgdmFsaWRhdGVJY29uTmFtZSA9IChpY29uLCBhbGxvd1NpbXBsZU5hbWUpID0+IHsKICBpZiAoIWljb24pIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuICEhKChpY29uLnByb3ZpZGVyID09PSAiIiB8fCBpY29uLnByb3ZpZGVyLm1hdGNoKG1hdGNoSWNvbk5hbWUpKSAmJiAoYWxsb3dTaW1wbGVOYW1lICYmIGljb24ucHJlZml4ID09PSAiIiB8fCBpY29uLnByZWZpeC5tYXRjaChtYXRjaEljb25OYW1lKSkgJiYgaWNvbi5uYW1lLm1hdGNoKG1hdGNoSWNvbk5hbWUpKTsKfTsKCmNvbnN0IGRlZmF1bHRJY29uRGltZW5zaW9ucyA9IE9iamVjdC5mcmVlemUoCiAgewogICAgbGVmdDogMCwKICAgIHRvcDogMCwKICAgIHdpZHRoOiAxNiwKICAgIGhlaWdodDogMTYKICB9Cik7CmNvbnN0IGRlZmF1bHRJY29uVHJhbnNmb3JtYXRpb25zID0gT2JqZWN0LmZyZWV6ZSh7CiAgcm90YXRlOiAwLAogIHZGbGlwOiBmYWxzZSwKICBoRmxpcDogZmFsc2UKfSk7CmNvbnN0IGRlZmF1bHRJY29uUHJvcHMgPSBPYmplY3QuZnJlZXplKHsKICAuLi5kZWZhdWx0SWNvbkRpbWVuc2lvbnMsCiAgLi4uZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMKfSk7CmNvbnN0IGRlZmF1bHRFeHRlbmRlZEljb25Qcm9wcyA9IE9iamVjdC5mcmVlemUoewogIC4uLmRlZmF1bHRJY29uUHJvcHMsCiAgYm9keTogIiIsCiAgaGlkZGVuOiBmYWxzZQp9KTsKCmZ1bmN0aW9uIG1lcmdlSWNvblRyYW5zZm9ybWF0aW9ucyhvYmoxLCBvYmoyKSB7CiAgY29uc3QgcmVzdWx0ID0ge307CiAgaWYgKCFvYmoxLmhGbGlwICE9PSAhb2JqMi5oRmxpcCkgewogICAgcmVzdWx0LmhGbGlwID0gdHJ1ZTsKICB9CiAgaWYgKCFvYmoxLnZGbGlwICE9PSAhb2JqMi52RmxpcCkgewogICAgcmVzdWx0LnZGbGlwID0gdHJ1ZTsKICB9CiAgY29uc3Qgcm90YXRlID0gKChvYmoxLnJvdGF0ZSB8fCAwKSArIChvYmoyLnJvdGF0ZSB8fCAwKSkgJSA0OwogIGlmIChyb3RhdGUpIHsKICAgIHJlc3VsdC5yb3RhdGUgPSByb3RhdGU7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIG1lcmdlSWNvbkRhdGEocGFyZW50LCBjaGlsZCkgewogIGNvbnN0IHJlc3VsdCA9IG1lcmdlSWNvblRyYW5zZm9ybWF0aW9ucyhwYXJlbnQsIGNoaWxkKTsKICBmb3IgKGNvbnN0IGtleSBpbiBkZWZhdWx0RXh0ZW5kZWRJY29uUHJvcHMpIHsKICAgIGlmIChrZXkgaW4gZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMpIHsKICAgICAgaWYgKGtleSBpbiBwYXJlbnQgJiYgIShrZXkgaW4gcmVzdWx0KSkgewogICAgICAgIHJlc3VsdFtrZXldID0gZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnNba2V5XTsKICAgICAgfQogICAgfSBlbHNlIGlmIChrZXkgaW4gY2hpbGQpIHsKICAgICAgcmVzdWx0W2tleV0gPSBjaGlsZFtrZXldOwogICAgfSBlbHNlIGlmIChrZXkgaW4gcGFyZW50KSB7CiAgICAgIHJlc3VsdFtrZXldID0gcGFyZW50W2tleV07CiAgICB9CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGdldEljb25zVHJlZShkYXRhLCBuYW1lcykgewogIGNvbnN0IGljb25zID0gZGF0YS5pY29uczsKICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHJlc29sdmVkID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZnVuY3Rpb24gcmVzb2x2ZShuYW1lKSB7CiAgICBpZiAoaWNvbnNbbmFtZV0pIHsKICAgICAgcmV0dXJuIHJlc29sdmVkW25hbWVdID0gW107CiAgICB9CiAgICBpZiAoIShuYW1lIGluIHJlc29sdmVkKSkgewogICAgICByZXNvbHZlZFtuYW1lXSA9IG51bGw7CiAgICAgIGNvbnN0IHBhcmVudCA9IGFsaWFzZXNbbmFtZV0gJiYgYWxpYXNlc1tuYW1lXS5wYXJlbnQ7CiAgICAgIGNvbnN0IHZhbHVlID0gcGFyZW50ICYmIHJlc29sdmUocGFyZW50KTsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmVzb2x2ZWRbbmFtZV0gPSBbcGFyZW50XS5jb25jYXQodmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzb2x2ZWRbbmFtZV07CiAgfQogIChuYW1lcyB8fCBPYmplY3Qua2V5cyhpY29ucykuY29uY2F0KE9iamVjdC5rZXlzKGFsaWFzZXMpKSkuZm9yRWFjaChyZXNvbHZlKTsKICByZXR1cm4gcmVzb2x2ZWQ7Cn0KCmZ1bmN0aW9uIGludGVybmFsR2V0SWNvbkRhdGEoZGF0YSwgbmFtZSwgdHJlZSkgewogIGNvbnN0IGljb25zID0gZGF0YS5pY29uczsKICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGxldCBjdXJyZW50UHJvcHMgPSB7fTsKICBmdW5jdGlvbiBwYXJzZShuYW1lMikgewogICAgY3VycmVudFByb3BzID0gbWVyZ2VJY29uRGF0YSgKICAgICAgaWNvbnNbbmFtZTJdIHx8IGFsaWFzZXNbbmFtZTJdLAogICAgICBjdXJyZW50UHJvcHMKICAgICk7CiAgfQogIHBhcnNlKG5hbWUpOwogIHRyZWUuZm9yRWFjaChwYXJzZSk7CiAgcmV0dXJuIG1lcmdlSWNvbkRhdGEoZGF0YSwgY3VycmVudFByb3BzKTsKfQoKZnVuY3Rpb24gcGFyc2VJY29uU2V0KGRhdGEsIGNhbGxiYWNrKSB7CiAgY29uc3QgbmFtZXMgPSBbXTsKICBpZiAodHlwZW9mIGRhdGEgIT09ICJvYmplY3QiIHx8IHR5cGVvZiBkYXRhLmljb25zICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIG5hbWVzOwogIH0KICBpZiAoZGF0YS5ub3RfZm91bmQgaW5zdGFuY2VvZiBBcnJheSkgewogICAgZGF0YS5ub3RfZm91bmQuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICBjYWxsYmFjayhuYW1lLCBudWxsKTsKICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgIH0pOwogIH0KICBjb25zdCB0cmVlID0gZ2V0SWNvbnNUcmVlKGRhdGEpOwogIGZvciAoY29uc3QgbmFtZSBpbiB0cmVlKSB7CiAgICBjb25zdCBpdGVtID0gdHJlZVtuYW1lXTsKICAgIGlmIChpdGVtKSB7CiAgICAgIGNhbGxiYWNrKG5hbWUsIGludGVybmFsR2V0SWNvbkRhdGEoZGF0YSwgbmFtZSwgaXRlbSkpOwogICAgICBuYW1lcy5wdXNoKG5hbWUpOwogICAgfQogIH0KICByZXR1cm4gbmFtZXM7Cn0KCmNvbnN0IG9wdGlvbmFsUHJvcGVydHlEZWZhdWx0cyA9IHsKICBwcm92aWRlcjogIiIsCiAgYWxpYXNlczoge30sCiAgbm90X2ZvdW5kOiB7fSwKICAuLi5kZWZhdWx0SWNvbkRpbWVuc2lvbnMKfTsKZnVuY3Rpb24gY2hlY2tPcHRpb25hbFByb3BzKGl0ZW0sIGRlZmF1bHRzKSB7CiAgZm9yIChjb25zdCBwcm9wIGluIGRlZmF1bHRzKSB7CiAgICBpZiAocHJvcCBpbiBpdGVtICYmIHR5cGVvZiBpdGVtW3Byb3BdICE9PSB0eXBlb2YgZGVmYXVsdHNbcHJvcF0pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBxdWlja2x5VmFsaWRhdGVJY29uU2V0KG9iaikgewogIGlmICh0eXBlb2Ygb2JqICE9PSAib2JqZWN0IiB8fCBvYmogPT09IG51bGwpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBkYXRhID0gb2JqOwogIGlmICh0eXBlb2YgZGF0YS5wcmVmaXggIT09ICJzdHJpbmciIHx8ICFvYmouaWNvbnMgfHwgdHlwZW9mIG9iai5pY29ucyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAoIWNoZWNrT3B0aW9uYWxQcm9wcyhvYmosIG9wdGlvbmFsUHJvcGVydHlEZWZhdWx0cykpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBpY29ucyA9IGRhdGEuaWNvbnM7CiAgZm9yIChjb25zdCBuYW1lIGluIGljb25zKSB7CiAgICBjb25zdCBpY29uID0gaWNvbnNbbmFtZV07CiAgICBpZiAoIW5hbWUubWF0Y2gobWF0Y2hJY29uTmFtZSkgfHwgdHlwZW9mIGljb24uYm9keSAhPT0gInN0cmluZyIgfHwgIWNoZWNrT3B0aW9uYWxQcm9wcygKICAgICAgaWNvbiwKICAgICAgZGVmYXVsdEV4dGVuZGVkSWNvblByb3BzCiAgICApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZvciAoY29uc3QgbmFtZSBpbiBhbGlhc2VzKSB7CiAgICBjb25zdCBpY29uID0gYWxpYXNlc1tuYW1lXTsKICAgIGNvbnN0IHBhcmVudCA9IGljb24ucGFyZW50OwogICAgaWYgKCFuYW1lLm1hdGNoKG1hdGNoSWNvbk5hbWUpIHx8IHR5cGVvZiBwYXJlbnQgIT09ICJzdHJpbmciIHx8ICFpY29uc1twYXJlbnRdICYmICFhbGlhc2VzW3BhcmVudF0gfHwgIWNoZWNrT3B0aW9uYWxQcm9wcygKICAgICAgaWNvbiwKICAgICAgZGVmYXVsdEV4dGVuZGVkSWNvblByb3BzCiAgICApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICByZXR1cm4gZGF0YTsKfQoKY29uc3QgZGF0YVN0b3JhZ2UgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gbmV3U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSB7CiAgcmV0dXJuIHsKICAgIHByb3ZpZGVyLAogICAgcHJlZml4LAogICAgaWNvbnM6IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgbWlzc2luZzogLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKQogIH07Cn0KZnVuY3Rpb24gZ2V0U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSB7CiAgY29uc3QgcHJvdmlkZXJTdG9yYWdlID0gZGF0YVN0b3JhZ2VbcHJvdmlkZXJdIHx8IChkYXRhU3RvcmFnZVtwcm92aWRlcl0gPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgcmV0dXJuIHByb3ZpZGVyU3RvcmFnZVtwcmVmaXhdIHx8IChwcm92aWRlclN0b3JhZ2VbcHJlZml4XSA9IG5ld1N0b3JhZ2UocHJvdmlkZXIsIHByZWZpeCkpOwp9CmZ1bmN0aW9uIGFkZEljb25TZXQoc3RvcmFnZSwgZGF0YSkgewogIGlmICghcXVpY2tseVZhbGlkYXRlSWNvblNldChkYXRhKSkgewogICAgcmV0dXJuIFtdOwogIH0KICByZXR1cm4gcGFyc2VJY29uU2V0KGRhdGEsIChuYW1lLCBpY29uKSA9PiB7CiAgICBpZiAoaWNvbikgewogICAgICBzdG9yYWdlLmljb25zW25hbWVdID0gaWNvbjsKICAgIH0gZWxzZSB7CiAgICAgIHN0b3JhZ2UubWlzc2luZy5hZGQobmFtZSk7CiAgICB9CiAgfSk7Cn0KZnVuY3Rpb24gYWRkSWNvblRvU3RvcmFnZShzdG9yYWdlLCBuYW1lLCBpY29uKSB7CiAgdHJ5IHsKICAgIGlmICh0eXBlb2YgaWNvbi5ib2R5ID09PSAic3RyaW5nIikgewogICAgICBzdG9yYWdlLmljb25zW25hbWVdID0geyAuLi5pY29uIH07CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogIH0KICByZXR1cm4gZmFsc2U7Cn0KCmxldCBzaW1wbGVOYW1lcyA9IGZhbHNlOwpmdW5jdGlvbiBhbGxvd1NpbXBsZU5hbWVzKGFsbG93KSB7CiAgaWYgKHR5cGVvZiBhbGxvdyA9PT0gImJvb2xlYW4iKSB7CiAgICBzaW1wbGVOYW1lcyA9IGFsbG93OwogIH0KICByZXR1cm4gc2ltcGxlTmFtZXM7Cn0KZnVuY3Rpb24gZ2V0SWNvbkRhdGEobmFtZSkgewogIGNvbnN0IGljb24gPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb0ljb24obmFtZSwgdHJ1ZSwgc2ltcGxlTmFtZXMpIDogbmFtZTsKICBpZiAoaWNvbikgewogICAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UoaWNvbi5wcm92aWRlciwgaWNvbi5wcmVmaXgpOwogICAgY29uc3QgaWNvbk5hbWUgPSBpY29uLm5hbWU7CiAgICByZXR1cm4gc3RvcmFnZS5pY29uc1tpY29uTmFtZV0gfHwgKHN0b3JhZ2UubWlzc2luZy5oYXMoaWNvbk5hbWUpID8gbnVsbCA6IHZvaWQgMCk7CiAgfQp9CmZ1bmN0aW9uIGFkZEljb24obmFtZSwgZGF0YSkgewogIGNvbnN0IGljb24gPSBzdHJpbmdUb0ljb24obmFtZSwgdHJ1ZSwgc2ltcGxlTmFtZXMpOwogIGlmICghaWNvbikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBzdG9yYWdlID0gZ2V0U3RvcmFnZShpY29uLnByb3ZpZGVyLCBpY29uLnByZWZpeCk7CiAgcmV0dXJuIGFkZEljb25Ub1N0b3JhZ2Uoc3RvcmFnZSwgaWNvbi5uYW1lLCBkYXRhKTsKfQpmdW5jdGlvbiBhZGRDb2xsZWN0aW9uKGRhdGEsIHByb3ZpZGVyKSB7CiAgaWYgKHR5cGVvZiBkYXRhICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAodHlwZW9mIHByb3ZpZGVyICE9PSAic3RyaW5nIikgewogICAgcHJvdmlkZXIgPSBkYXRhLnByb3ZpZGVyIHx8ICIiOwogIH0KICBpZiAoc2ltcGxlTmFtZXMgJiYgIXByb3ZpZGVyICYmICFkYXRhLnByZWZpeCkgewogICAgbGV0IGFkZGVkID0gZmFsc2U7CiAgICBpZiAocXVpY2tseVZhbGlkYXRlSWNvblNldChkYXRhKSkgewogICAgICBkYXRhLnByZWZpeCA9ICIiOwogICAgICBwYXJzZUljb25TZXQoZGF0YSwgKG5hbWUsIGljb24pID0+IHsKICAgICAgICBpZiAoaWNvbiAmJiBhZGRJY29uKG5hbWUsIGljb24pKSB7CiAgICAgICAgICBhZGRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBhZGRlZDsKICB9CiAgY29uc3QgcHJlZml4ID0gZGF0YS5wcmVmaXg7CiAgaWYgKCF2YWxpZGF0ZUljb25OYW1lKHsKICAgIHByb3ZpZGVyLAogICAgcHJlZml4LAogICAgbmFtZTogImEiCiAgfSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UocHJvdmlkZXIsIHByZWZpeCk7CiAgcmV0dXJuICEhYWRkSWNvblNldChzdG9yYWdlLCBkYXRhKTsKfQoKY29uc3QgZGVmYXVsdEljb25TaXplQ3VzdG9taXNhdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICB3aWR0aDogbnVsbCwKICBoZWlnaHQ6IG51bGwKfSk7CmNvbnN0IGRlZmF1bHRJY29uQ3VzdG9taXNhdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICAvLyBEaW1lbnNpb25zCiAgLi4uZGVmYXVsdEljb25TaXplQ3VzdG9taXNhdGlvbnMsCiAgLy8gVHJhbnNmb3JtYXRpb25zCiAgLi4uZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMKfSk7Cgpjb25zdCB1bml0c1NwbGl0ID0gLygtP1swLTkuXSpbMC05XStbMC05Ll0qKS9nOwpjb25zdCB1bml0c1Rlc3QgPSAvXi0/WzAtOS5dKlswLTldK1swLTkuXSokL2c7CmZ1bmN0aW9uIGNhbGN1bGF0ZVNpemUoc2l6ZSwgcmF0aW8sIHByZWNpc2lvbikgewogIGlmIChyYXRpbyA9PT0gMSkgewogICAgcmV0dXJuIHNpemU7CiAgfQogIHByZWNpc2lvbiA9IHByZWNpc2lvbiB8fCAxMDA7CiAgaWYgKHR5cGVvZiBzaXplID09PSAibnVtYmVyIikgewogICAgcmV0dXJuIE1hdGguY2VpbChzaXplICogcmF0aW8gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uOwogIH0KICBpZiAodHlwZW9mIHNpemUgIT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgY29uc3Qgb2xkUGFydHMgPSBzaXplLnNwbGl0KHVuaXRzU3BsaXQpOwogIGlmIChvbGRQYXJ0cyA9PT0gbnVsbCB8fCAhb2xkUGFydHMubGVuZ3RoKSB7CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgY29uc3QgbmV3UGFydHMgPSBbXTsKICBsZXQgY29kZSA9IG9sZFBhcnRzLnNoaWZ0KCk7CiAgbGV0IGlzTnVtYmVyID0gdW5pdHNUZXN0LnRlc3QoY29kZSk7CiAgd2hpbGUgKHRydWUpIHsKICAgIGlmIChpc051bWJlcikgewogICAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KGNvZGUpOwogICAgICBpZiAoaXNOYU4obnVtKSkgewogICAgICAgIG5ld1BhcnRzLnB1c2goY29kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3UGFydHMucHVzaChNYXRoLmNlaWwobnVtICogcmF0aW8gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbmV3UGFydHMucHVzaChjb2RlKTsKICAgIH0KICAgIGNvZGUgPSBvbGRQYXJ0cy5zaGlmdCgpOwogICAgaWYgKGNvZGUgPT09IHZvaWQgMCkgewogICAgICByZXR1cm4gbmV3UGFydHMuam9pbigiIik7CiAgICB9CiAgICBpc051bWJlciA9ICFpc051bWJlcjsKICB9Cn0KCmNvbnN0IGlzVW5zZXRLZXl3b3JkID0gKHZhbHVlKSA9PiB2YWx1ZSA9PT0gInVuc2V0IiB8fCB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgfHwgdmFsdWUgPT09ICJub25lIjsKZnVuY3Rpb24gaWNvblRvU1ZHKGljb24sIGN1c3RvbWlzYXRpb25zKSB7CiAgY29uc3QgZnVsbEljb24gPSB7CiAgICAuLi5kZWZhdWx0SWNvblByb3BzLAogICAgLi4uaWNvbgogIH07CiAgY29uc3QgZnVsbEN1c3RvbWlzYXRpb25zID0gewogICAgLi4uZGVmYXVsdEljb25DdXN0b21pc2F0aW9ucywKICAgIC4uLmN1c3RvbWlzYXRpb25zCiAgfTsKICBjb25zdCBib3ggPSB7CiAgICBsZWZ0OiBmdWxsSWNvbi5sZWZ0LAogICAgdG9wOiBmdWxsSWNvbi50b3AsCiAgICB3aWR0aDogZnVsbEljb24ud2lkdGgsCiAgICBoZWlnaHQ6IGZ1bGxJY29uLmhlaWdodAogIH07CiAgbGV0IGJvZHkgPSBmdWxsSWNvbi5ib2R5OwogIFtmdWxsSWNvbiwgZnVsbEN1c3RvbWlzYXRpb25zXS5mb3JFYWNoKChwcm9wcykgPT4gewogICAgY29uc3QgdHJhbnNmb3JtYXRpb25zID0gW107CiAgICBjb25zdCBoRmxpcCA9IHByb3BzLmhGbGlwOwogICAgY29uc3QgdkZsaXAgPSBwcm9wcy52RmxpcDsKICAgIGxldCByb3RhdGlvbiA9IHByb3BzLnJvdGF0ZTsKICAgIGlmIChoRmxpcCkgewogICAgICBpZiAodkZsaXApIHsKICAgICAgICByb3RhdGlvbiArPSAyOwogICAgICB9IGVsc2UgewogICAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKAogICAgICAgICAgInRyYW5zbGF0ZSgiICsgKGJveC53aWR0aCArIGJveC5sZWZ0KS50b1N0cmluZygpICsgIiAiICsgKDAgLSBib3gudG9wKS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgic2NhbGUoLTEgMSkiKTsKICAgICAgICBib3gudG9wID0gYm94LmxlZnQgPSAwOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHZGbGlwKSB7CiAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKAogICAgICAgICJ0cmFuc2xhdGUoIiArICgwIC0gYm94LmxlZnQpLnRvU3RyaW5nKCkgKyAiICIgKyAoYm94LmhlaWdodCArIGJveC50b3ApLnRvU3RyaW5nKCkgKyAiKSIKICAgICAgKTsKICAgICAgdHJhbnNmb3JtYXRpb25zLnB1c2goInNjYWxlKDEgLTEpIik7CiAgICAgIGJveC50b3AgPSBib3gubGVmdCA9IDA7CiAgICB9CiAgICBsZXQgdGVtcFZhbHVlOwogICAgaWYgKHJvdGF0aW9uIDwgMCkgewogICAgICByb3RhdGlvbiAtPSBNYXRoLmZsb29yKHJvdGF0aW9uIC8gNCkgKiA0OwogICAgfQogICAgcm90YXRpb24gPSByb3RhdGlvbiAlIDQ7CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB0ZW1wVmFsdWUgPSBib3guaGVpZ2h0IC8gMiArIGJveC50b3A7CiAgICAgICAgdHJhbnNmb3JtYXRpb25zLnVuc2hpZnQoCiAgICAgICAgICAicm90YXRlKDkwICIgKyB0ZW1wVmFsdWUudG9TdHJpbmcoKSArICIgIiArIHRlbXBWYWx1ZS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIHRyYW5zZm9ybWF0aW9ucy51bnNoaWZ0KAogICAgICAgICAgInJvdGF0ZSgxODAgIiArIChib3gud2lkdGggLyAyICsgYm94LmxlZnQpLnRvU3RyaW5nKCkgKyAiICIgKyAoYm94LmhlaWdodCAvIDIgKyBib3gudG9wKS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aCAvIDIgKyBib3gubGVmdDsKICAgICAgICB0cmFuc2Zvcm1hdGlvbnMudW5zaGlmdCgKICAgICAgICAgICJyb3RhdGUoLTkwICIgKyB0ZW1wVmFsdWUudG9TdHJpbmcoKSArICIgIiArIHRlbXBWYWx1ZS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChyb3RhdGlvbiAlIDIgPT09IDEpIHsKICAgICAgaWYgKGJveC5sZWZ0ICE9PSBib3gudG9wKSB7CiAgICAgICAgdGVtcFZhbHVlID0gYm94LmxlZnQ7CiAgICAgICAgYm94LmxlZnQgPSBib3gudG9wOwogICAgICAgIGJveC50b3AgPSB0ZW1wVmFsdWU7CiAgICAgIH0KICAgICAgaWYgKGJveC53aWR0aCAhPT0gYm94LmhlaWdodCkgewogICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aDsKICAgICAgICBib3gud2lkdGggPSBib3guaGVpZ2h0OwogICAgICAgIGJveC5oZWlnaHQgPSB0ZW1wVmFsdWU7CiAgICAgIH0KICAgIH0KICAgIGlmICh0cmFuc2Zvcm1hdGlvbnMubGVuZ3RoKSB7CiAgICAgIGJvZHkgPSAnPGcgdHJhbnNmb3JtPSInICsgdHJhbnNmb3JtYXRpb25zLmpvaW4oIiAiKSArICciPicgKyBib2R5ICsgIjwvZz4iOwogICAgfQogIH0pOwogIGNvbnN0IGN1c3RvbWlzYXRpb25zV2lkdGggPSBmdWxsQ3VzdG9taXNhdGlvbnMud2lkdGg7CiAgY29uc3QgY3VzdG9taXNhdGlvbnNIZWlnaHQgPSBmdWxsQ3VzdG9taXNhdGlvbnMuaGVpZ2h0OwogIGNvbnN0IGJveFdpZHRoID0gYm94LndpZHRoOwogIGNvbnN0IGJveEhlaWdodCA9IGJveC5oZWlnaHQ7CiAgbGV0IHdpZHRoOwogIGxldCBoZWlnaHQ7CiAgaWYgKGN1c3RvbWlzYXRpb25zV2lkdGggPT09IG51bGwpIHsKICAgIGhlaWdodCA9IGN1c3RvbWlzYXRpb25zSGVpZ2h0ID09PSBudWxsID8gIjFlbSIgOiBjdXN0b21pc2F0aW9uc0hlaWdodCA9PT0gImF1dG8iID8gYm94SGVpZ2h0IDogY3VzdG9taXNhdGlvbnNIZWlnaHQ7CiAgICB3aWR0aCA9IGNhbGN1bGF0ZVNpemUoaGVpZ2h0LCBib3hXaWR0aCAvIGJveEhlaWdodCk7CiAgfSBlbHNlIHsKICAgIHdpZHRoID0gY3VzdG9taXNhdGlvbnNXaWR0aCA9PT0gImF1dG8iID8gYm94V2lkdGggOiBjdXN0b21pc2F0aW9uc1dpZHRoOwogICAgaGVpZ2h0ID0gY3VzdG9taXNhdGlvbnNIZWlnaHQgPT09IG51bGwgPyBjYWxjdWxhdGVTaXplKHdpZHRoLCBib3hIZWlnaHQgLyBib3hXaWR0aCkgOiBjdXN0b21pc2F0aW9uc0hlaWdodCA9PT0gImF1dG8iID8gYm94SGVpZ2h0IDogY3VzdG9taXNhdGlvbnNIZWlnaHQ7CiAgfQogIGNvbnN0IGF0dHJpYnV0ZXMgPSB7fTsKICBjb25zdCBzZXRBdHRyID0gKHByb3AsIHZhbHVlKSA9PiB7CiAgICBpZiAoIWlzVW5zZXRLZXl3b3JkKHZhbHVlKSkgewogICAgICBhdHRyaWJ1dGVzW3Byb3BdID0gdmFsdWUudG9TdHJpbmcoKTsKICAgIH0KICB9OwogIHNldEF0dHIoIndpZHRoIiwgd2lkdGgpOwogIHNldEF0dHIoImhlaWdodCIsIGhlaWdodCk7CiAgYXR0cmlidXRlcy52aWV3Qm94ID0gYm94LmxlZnQudG9TdHJpbmcoKSArICIgIiArIGJveC50b3AudG9TdHJpbmcoKSArICIgIiArIGJveFdpZHRoLnRvU3RyaW5nKCkgKyAiICIgKyBib3hIZWlnaHQudG9TdHJpbmcoKTsKICByZXR1cm4gewogICAgYXR0cmlidXRlcywKICAgIGJvZHkKICB9Owp9Cgpjb25zdCByZWdleCA9IC9cc2lkPSIoXFMrKSIvZzsKY29uc3QgcmFuZG9tUHJlZml4ID0gIkljb25pZnlJZCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDE2KSArIChNYXRoLnJhbmRvbSgpICogMTY3NzcyMTYgfCAwKS50b1N0cmluZygxNik7CmxldCBjb3VudGVyID0gMDsKZnVuY3Rpb24gcmVwbGFjZUlEcyhib2R5LCBwcmVmaXggPSByYW5kb21QcmVmaXgpIHsKICBjb25zdCBpZHMgPSBbXTsKICBsZXQgbWF0Y2g7CiAgd2hpbGUgKG1hdGNoID0gcmVnZXguZXhlYyhib2R5KSkgewogICAgaWRzLnB1c2gobWF0Y2hbMV0pOwogIH0KICBpZiAoIWlkcy5sZW5ndGgpIHsKICAgIHJldHVybiBib2R5OwogIH0KICBjb25zdCBzdWZmaXggPSAic3VmZml4IiArIChNYXRoLnJhbmRvbSgpICogMTY3NzcyMTYgfCBEYXRlLm5vdygpKS50b1N0cmluZygxNik7CiAgaWRzLmZvckVhY2goKGlkKSA9PiB7CiAgICBjb25zdCBuZXdJRCA9IHR5cGVvZiBwcmVmaXggPT09ICJmdW5jdGlvbiIgPyBwcmVmaXgoaWQpIDogcHJlZml4ICsgKGNvdW50ZXIrKykudG9TdHJpbmcoKTsKICAgIGNvbnN0IGVzY2FwZWRJRCA9IGlkLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXVxcXS9nLCAiXFwkJiIpOwogICAgYm9keSA9IGJvZHkucmVwbGFjZSgKICAgICAgLy8gQWxsb3dlZCBjaGFyYWN0ZXJzIGJlZm9yZSBpZDogWyM7Il0KICAgICAgLy8gQWxsb3dlZCBjaGFyYWN0ZXJzIGFmdGVyIGlkOiBbKSJdLCAuW2Etel0KICAgICAgbmV3IFJlZ0V4cCgnKFsjOyJdKSgnICsgZXNjYXBlZElEICsgJykoWyIpXXxcXC5bYS16XSknLCAiZyIpLAogICAgICAiJDEiICsgbmV3SUQgKyBzdWZmaXggKyAiJDMiCiAgICApOwogIH0pOwogIGJvZHkgPSBib2R5LnJlcGxhY2UobmV3IFJlZ0V4cChzdWZmaXgsICJnIiksICIiKTsKICByZXR1cm4gYm9keTsKfQoKY29uc3Qgc3RvcmFnZSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwpmdW5jdGlvbiBzZXRBUElNb2R1bGUocHJvdmlkZXIsIGl0ZW0pIHsKICBzdG9yYWdlW3Byb3ZpZGVyXSA9IGl0ZW07Cn0KZnVuY3Rpb24gZ2V0QVBJTW9kdWxlKHByb3ZpZGVyKSB7CiAgcmV0dXJuIHN0b3JhZ2VbcHJvdmlkZXJdIHx8IHN0b3JhZ2VbIiJdOwp9CgpmdW5jdGlvbiBjcmVhdGVBUElDb25maWcoc291cmNlKSB7CiAgbGV0IHJlc291cmNlczsKICBpZiAodHlwZW9mIHNvdXJjZS5yZXNvdXJjZXMgPT09ICJzdHJpbmciKSB7CiAgICByZXNvdXJjZXMgPSBbc291cmNlLnJlc291cmNlc107CiAgfSBlbHNlIHsKICAgIHJlc291cmNlcyA9IHNvdXJjZS5yZXNvdXJjZXM7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBBcnJheSkgfHwgIXJlc291cmNlcy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogIGNvbnN0IHJlc3VsdCA9IHsKICAgIC8vIEFQSSBob3N0cwogICAgcmVzb3VyY2VzLAogICAgLy8gUm9vdCBwYXRoCiAgICBwYXRoOiBzb3VyY2UucGF0aCB8fCAiLyIsCiAgICAvLyBVUkwgbGVuZ3RoIGxpbWl0CiAgICBtYXhVUkw6IHNvdXJjZS5tYXhVUkwgfHwgNTAwLAogICAgLy8gVGltZW91dCBiZWZvcmUgbmV4dCBob3N0IGlzIHVzZWQuCiAgICByb3RhdGU6IHNvdXJjZS5yb3RhdGUgfHwgNzUwLAogICAgLy8gVGltZW91dCBiZWZvcmUgZmFpbGluZyBxdWVyeS4KICAgIHRpbWVvdXQ6IHNvdXJjZS50aW1lb3V0IHx8IDVlMywKICAgIC8vIFJhbmRvbWlzZSBkZWZhdWx0IEFQSSBlbmQgcG9pbnQuCiAgICByYW5kb206IHNvdXJjZS5yYW5kb20gPT09IHRydWUsCiAgICAvLyBTdGFydCBpbmRleAogICAgaW5kZXg6IHNvdXJjZS5pbmRleCB8fCAwLAogICAgLy8gUmVjZWl2ZSBkYXRhIGFmdGVyIHRpbWUgb3V0ICh1c2VkIGlmIHRpbWUgb3V0IGtpY2tzIGluIGZpcnN0LCB0aGVuIEFQSSBtb2R1bGUgc2VuZHMgZGF0YSBhbnl3YXkpLgogICAgZGF0YUFmdGVyVGltZW91dDogc291cmNlLmRhdGFBZnRlclRpbWVvdXQgIT09IGZhbHNlCiAgfTsKICByZXR1cm4gcmVzdWx0Owp9CmNvbnN0IGNvbmZpZ1N0b3JhZ2UgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKY29uc3QgZmFsbEJhY2tBUElTb3VyY2VzID0gWwogICJodHRwczovL2FwaS5zaW1wbGVzdmcuY29tIiwKICAiaHR0cHM6Ly9hcGkudW5pc3ZnLmNvbSIKXTsKY29uc3QgZmFsbEJhY2tBUEkgPSBbXTsKd2hpbGUgKGZhbGxCYWNrQVBJU291cmNlcy5sZW5ndGggPiAwKSB7CiAgaWYgKGZhbGxCYWNrQVBJU291cmNlcy5sZW5ndGggPT09IDEpIHsKICAgIGZhbGxCYWNrQVBJLnB1c2goZmFsbEJhY2tBUElTb3VyY2VzLnNoaWZ0KCkpOwogIH0gZWxzZSB7CiAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNSkgewogICAgICBmYWxsQmFja0FQSS5wdXNoKGZhbGxCYWNrQVBJU291cmNlcy5zaGlmdCgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGZhbGxCYWNrQVBJLnB1c2goZmFsbEJhY2tBUElTb3VyY2VzLnBvcCgpKTsKICAgIH0KICB9Cn0KY29uZmlnU3RvcmFnZVsiIl0gPSBjcmVhdGVBUElDb25maWcoewogIHJlc291cmNlczogWyJodHRwczovL2FwaS5pY29uaWZ5LmRlc2lnbiJdLmNvbmNhdChmYWxsQmFja0FQSSkKfSk7CmZ1bmN0aW9uIGFkZEFQSVByb3ZpZGVyKHByb3ZpZGVyLCBjdXN0b21Db25maWcpIHsKICBjb25zdCBjb25maWcgPSBjcmVhdGVBUElDb25maWcoY3VzdG9tQ29uZmlnKTsKICBpZiAoY29uZmlnID09PSBudWxsKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbmZpZ1N0b3JhZ2VbcHJvdmlkZXJdID0gY29uZmlnOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGdldEFQSUNvbmZpZyhwcm92aWRlcikgewogIHJldHVybiBjb25maWdTdG9yYWdlW3Byb3ZpZGVyXTsKfQoKY29uc3QgZGV0ZWN0RmV0Y2ggPSAoKSA9PiB7CiAgbGV0IGNhbGxiYWNrOwogIHRyeSB7CiAgICBjYWxsYmFjayA9IGZldGNoOwogICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gY2FsbGJhY2s7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgfQp9OwpsZXQgZmV0Y2hNb2R1bGUgPSBkZXRlY3RGZXRjaCgpOwpmdW5jdGlvbiBjYWxjdWxhdGVNYXhMZW5ndGgocHJvdmlkZXIsIHByZWZpeCkgewogIGNvbnN0IGNvbmZpZyA9IGdldEFQSUNvbmZpZyhwcm92aWRlcik7CiAgaWYgKCFjb25maWcpIHsKICAgIHJldHVybiAwOwogIH0KICBsZXQgcmVzdWx0OwogIGlmICghY29uZmlnLm1heFVSTCkgewogICAgcmVzdWx0ID0gMDsKICB9IGVsc2UgewogICAgbGV0IG1heEhvc3RMZW5ndGggPSAwOwogICAgY29uZmlnLnJlc291cmNlcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgIGNvbnN0IGhvc3QgPSBpdGVtOwogICAgICBtYXhIb3N0TGVuZ3RoID0gTWF0aC5tYXgobWF4SG9zdExlbmd0aCwgaG9zdC5sZW5ndGgpOwogICAgfSk7CiAgICBjb25zdCB1cmwgPSBwcmVmaXggKyAiLmpzb24/aWNvbnM9IjsKICAgIHJlc3VsdCA9IGNvbmZpZy5tYXhVUkwgLSBtYXhIb3N0TGVuZ3RoIC0gY29uZmlnLnBhdGgubGVuZ3RoIC0gdXJsLmxlbmd0aDsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQpmdW5jdGlvbiBzaG91bGRBYm9ydChzdGF0dXMpIHsKICByZXR1cm4gc3RhdHVzID09PSA0MDQ7Cn0KY29uc3QgcHJlcGFyZSA9IChwcm92aWRlciwgcHJlZml4LCBpY29ucykgPT4gewogIGNvbnN0IHJlc3VsdHMgPSBbXTsKICBjb25zdCBtYXhMZW5ndGggPSBjYWxjdWxhdGVNYXhMZW5ndGgocHJvdmlkZXIsIHByZWZpeCk7CiAgY29uc3QgdHlwZSA9ICJpY29ucyI7CiAgbGV0IGl0ZW0gPSB7CiAgICB0eXBlLAogICAgcHJvdmlkZXIsCiAgICBwcmVmaXgsCiAgICBpY29uczogW10KICB9OwogIGxldCBsZW5ndGggPSAwOwogIGljb25zLmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7CiAgICBsZW5ndGggKz0gbmFtZS5sZW5ndGggKyAxOwogICAgaWYgKGxlbmd0aCA+PSBtYXhMZW5ndGggJiYgaW5kZXggPiAwKSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVtKTsKICAgICAgaXRlbSA9IHsKICAgICAgICB0eXBlLAogICAgICAgIHByb3ZpZGVyLAogICAgICAgIHByZWZpeCwKICAgICAgICBpY29uczogW10KICAgICAgfTsKICAgICAgbGVuZ3RoID0gbmFtZS5sZW5ndGg7CiAgICB9CiAgICBpdGVtLmljb25zLnB1c2gobmFtZSk7CiAgfSk7CiAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogIHJldHVybiByZXN1bHRzOwp9OwpmdW5jdGlvbiBnZXRQYXRoKHByb3ZpZGVyKSB7CiAgaWYgKHR5cGVvZiBwcm92aWRlciA9PT0gInN0cmluZyIpIHsKICAgIGNvbnN0IGNvbmZpZyA9IGdldEFQSUNvbmZpZyhwcm92aWRlcik7CiAgICBpZiAoY29uZmlnKSB7CiAgICAgIHJldHVybiBjb25maWcucGF0aDsKICAgIH0KICB9CiAgcmV0dXJuICIvIjsKfQpjb25zdCBzZW5kID0gKGhvc3QsIHBhcmFtcywgY2FsbGJhY2spID0+IHsKICBpZiAoIWZldGNoTW9kdWxlKSB7CiAgICBjYWxsYmFjaygiYWJvcnQiLCA0MjQpOwogICAgcmV0dXJuOwogIH0KICBsZXQgcGF0aCA9IGdldFBhdGgocGFyYW1zLnByb3ZpZGVyKTsKICBzd2l0Y2ggKHBhcmFtcy50eXBlKSB7CiAgICBjYXNlICJpY29ucyI6IHsKICAgICAgY29uc3QgcHJlZml4ID0gcGFyYW1zLnByZWZpeDsKICAgICAgY29uc3QgaWNvbnMgPSBwYXJhbXMuaWNvbnM7CiAgICAgIGNvbnN0IGljb25zTGlzdCA9IGljb25zLmpvaW4oIiwiKTsKICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7CiAgICAgICAgaWNvbnM6IGljb25zTGlzdAogICAgICB9KTsKICAgICAgcGF0aCArPSBwcmVmaXggKyAiLmpzb24/IiArIHVybFBhcmFtcy50b1N0cmluZygpOwogICAgICBicmVhazsKICAgIH0KICAgIGNhc2UgImN1c3RvbSI6IHsKICAgICAgY29uc3QgdXJpID0gcGFyYW1zLnVyaTsKICAgICAgcGF0aCArPSB1cmkuc2xpY2UoMCwgMSkgPT09ICIvIiA/IHVyaS5zbGljZSgxKSA6IHVyaTsKICAgICAgYnJlYWs7CiAgICB9CiAgICBkZWZhdWx0OgogICAgICBjYWxsYmFjaygiYWJvcnQiLCA0MDApOwogICAgICByZXR1cm47CiAgfQogIGxldCBkZWZhdWx0RXJyb3IgPSA1MDM7CiAgZmV0Y2hNb2R1bGUoaG9zdCArIHBhdGgpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICBjb25zdCBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSAyMDApIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgY2FsbGJhY2soc2hvdWxkQWJvcnQoc3RhdHVzKSA/ICJhYm9ydCIgOiAibmV4dCIsIHN0YXR1cyk7CiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICBkZWZhdWx0RXJyb3IgPSA1MDE7CiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogIH0pLnRoZW4oKGRhdGEpID0+IHsKICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gIm9iamVjdCIgfHwgZGF0YSA9PT0gbnVsbCkgewogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBpZiAoZGF0YSA9PT0gNDA0KSB7CiAgICAgICAgICBjYWxsYmFjaygiYWJvcnQiLCBkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FsbGJhY2soIm5leHQiLCBkZWZhdWx0RXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBjYWxsYmFjaygic3VjY2VzcyIsIGRhdGEpOwogICAgfSk7CiAgfSkuY2F0Y2goKCkgPT4gewogICAgY2FsbGJhY2soIm5leHQiLCBkZWZhdWx0RXJyb3IpOwogIH0pOwp9Owpjb25zdCBmZXRjaEFQSU1vZHVsZSA9IHsKICBwcmVwYXJlLAogIHNlbmQKfTsKCmZ1bmN0aW9uIHNvcnRJY29ucyhpY29ucykgewogIGNvbnN0IHJlc3VsdCA9IHsKICAgIGxvYWRlZDogW10sCiAgICBtaXNzaW5nOiBbXSwKICAgIHBlbmRpbmc6IFtdCiAgfTsKICBjb25zdCBzdG9yYWdlID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgaWNvbnMuc29ydCgoYSwgYikgPT4gewogICAgaWYgKGEucHJvdmlkZXIgIT09IGIucHJvdmlkZXIpIHsKICAgICAgcmV0dXJuIGEucHJvdmlkZXIubG9jYWxlQ29tcGFyZShiLnByb3ZpZGVyKTsKICAgIH0KICAgIGlmIChhLnByZWZpeCAhPT0gYi5wcmVmaXgpIHsKICAgICAgcmV0dXJuIGEucHJlZml4LmxvY2FsZUNvbXBhcmUoYi5wcmVmaXgpOwogICAgfQogICAgcmV0dXJuIGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSk7CiAgfSk7CiAgbGV0IGxhc3RJY29uID0gewogICAgcHJvdmlkZXI6ICIiLAogICAgcHJlZml4OiAiIiwKICAgIG5hbWU6ICIiCiAgfTsKICBpY29ucy5mb3JFYWNoKChpY29uKSA9PiB7CiAgICBpZiAobGFzdEljb24ubmFtZSA9PT0gaWNvbi5uYW1lICYmIGxhc3RJY29uLnByZWZpeCA9PT0gaWNvbi5wcmVmaXggJiYgbGFzdEljb24ucHJvdmlkZXIgPT09IGljb24ucHJvdmlkZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGFzdEljb24gPSBpY29uOwogICAgY29uc3QgcHJvdmlkZXIgPSBpY29uLnByb3ZpZGVyOwogICAgY29uc3QgcHJlZml4ID0gaWNvbi5wcmVmaXg7CiAgICBjb25zdCBuYW1lID0gaWNvbi5uYW1lOwogICAgY29uc3QgcHJvdmlkZXJTdG9yYWdlID0gc3RvcmFnZVtwcm92aWRlcl0gfHwgKHN0b3JhZ2VbcHJvdmlkZXJdID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCkpOwogICAgY29uc3QgbG9jYWxTdG9yYWdlID0gcHJvdmlkZXJTdG9yYWdlW3ByZWZpeF0gfHwgKHByb3ZpZGVyU3RvcmFnZVtwcmVmaXhdID0gZ2V0U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSk7CiAgICBsZXQgbGlzdDsKICAgIGlmIChuYW1lIGluIGxvY2FsU3RvcmFnZS5pY29ucykgewogICAgICBsaXN0ID0gcmVzdWx0LmxvYWRlZDsKICAgIH0gZWxzZSBpZiAocHJlZml4ID09PSAiIiB8fCBsb2NhbFN0b3JhZ2UubWlzc2luZy5oYXMobmFtZSkpIHsKICAgICAgbGlzdCA9IHJlc3VsdC5taXNzaW5nOwogICAgfSBlbHNlIHsKICAgICAgbGlzdCA9IHJlc3VsdC5wZW5kaW5nOwogICAgfQogICAgY29uc3QgaXRlbSA9IHsKICAgICAgcHJvdmlkZXIsCiAgICAgIHByZWZpeCwKICAgICAgbmFtZQogICAgfTsKICAgIGxpc3QucHVzaChpdGVtKTsKICB9KTsKICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiByZW1vdmVDYWxsYmFjayhzdG9yYWdlcywgaWQpIHsKICBzdG9yYWdlcy5mb3JFYWNoKChzdG9yYWdlKSA9PiB7CiAgICBjb25zdCBpdGVtcyA9IHN0b3JhZ2UubG9hZGVyQ2FsbGJhY2tzOwogICAgaWYgKGl0ZW1zKSB7CiAgICAgIHN0b3JhZ2UubG9hZGVyQ2FsbGJhY2tzID0gaXRlbXMuZmlsdGVyKChyb3cpID0+IHJvdy5pZCAhPT0gaWQpOwogICAgfQogIH0pOwp9CmZ1bmN0aW9uIHVwZGF0ZUNhbGxiYWNrcyhzdG9yYWdlKSB7CiAgaWYgKCFzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnKSB7CiAgICBzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnID0gdHJ1ZTsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnID0gZmFsc2U7CiAgICAgIGNvbnN0IGl0ZW1zID0gc3RvcmFnZS5sb2FkZXJDYWxsYmFja3MgPyBzdG9yYWdlLmxvYWRlckNhbGxiYWNrcy5zbGljZSgwKSA6IFtdOwogICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgaGFzUGVuZGluZyA9IGZhbHNlOwogICAgICBjb25zdCBwcm92aWRlciA9IHN0b3JhZ2UucHJvdmlkZXI7CiAgICAgIGNvbnN0IHByZWZpeCA9IHN0b3JhZ2UucHJlZml4OwogICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgY29uc3QgaWNvbnMgPSBpdGVtLmljb25zOwogICAgICAgIGNvbnN0IG9sZExlbmd0aCA9IGljb25zLnBlbmRpbmcubGVuZ3RoOwogICAgICAgIGljb25zLnBlbmRpbmcgPSBpY29ucy5wZW5kaW5nLmZpbHRlcigoaWNvbikgPT4gewogICAgICAgICAgaWYgKGljb24ucHJlZml4ICE9PSBwcmVmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBuYW1lID0gaWNvbi5uYW1lOwogICAgICAgICAgaWYgKHN0b3JhZ2UuaWNvbnNbbmFtZV0pIHsKICAgICAgICAgICAgaWNvbnMubG9hZGVkLnB1c2goewogICAgICAgICAgICAgIHByb3ZpZGVyLAogICAgICAgICAgICAgIHByZWZpeCwKICAgICAgICAgICAgICBuYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChzdG9yYWdlLm1pc3NpbmcuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgIGljb25zLm1pc3NpbmcucHVzaCh7CiAgICAgICAgICAgICAgcHJvdmlkZXIsCiAgICAgICAgICAgICAgcHJlZml4LAogICAgICAgICAgICAgIG5hbWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoYXNQZW5kaW5nID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGljb25zLnBlbmRpbmcubGVuZ3RoICE9PSBvbGRMZW5ndGgpIHsKICAgICAgICAgIGlmICghaGFzUGVuZGluZykgewogICAgICAgICAgICByZW1vdmVDYWxsYmFjayhbc3RvcmFnZV0sIGl0ZW0uaWQpOwogICAgICAgICAgfQogICAgICAgICAgaXRlbS5jYWxsYmFjaygKICAgICAgICAgICAgaWNvbnMubG9hZGVkLnNsaWNlKDApLAogICAgICAgICAgICBpY29ucy5taXNzaW5nLnNsaWNlKDApLAogICAgICAgICAgICBpY29ucy5wZW5kaW5nLnNsaWNlKDApLAogICAgICAgICAgICBpdGVtLmFib3J0CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9Cn0KbGV0IGlkQ291bnRlciA9IDA7CmZ1bmN0aW9uIHN0b3JlQ2FsbGJhY2soY2FsbGJhY2ssIGljb25zLCBwZW5kaW5nU291cmNlcykgewogIGNvbnN0IGlkID0gaWRDb3VudGVyKys7CiAgY29uc3QgYWJvcnQgPSByZW1vdmVDYWxsYmFjay5iaW5kKG51bGwsIHBlbmRpbmdTb3VyY2VzLCBpZCk7CiAgaWYgKCFpY29ucy5wZW5kaW5nLmxlbmd0aCkgewogICAgcmV0dXJuIGFib3J0OwogIH0KICBjb25zdCBpdGVtID0gewogICAgaWQsCiAgICBpY29ucywKICAgIGNhbGxiYWNrLAogICAgYWJvcnQKICB9OwogIHBlbmRpbmdTb3VyY2VzLmZvckVhY2goKHN0b3JhZ2UpID0+IHsKICAgIChzdG9yYWdlLmxvYWRlckNhbGxiYWNrcyB8fCAoc3RvcmFnZS5sb2FkZXJDYWxsYmFja3MgPSBbXSkpLnB1c2goaXRlbSk7CiAgfSk7CiAgcmV0dXJuIGFib3J0Owp9CgpmdW5jdGlvbiBsaXN0VG9JY29ucyhsaXN0LCB2YWxpZGF0ZSA9IHRydWUsIHNpbXBsZU5hbWVzID0gZmFsc2UpIHsKICBjb25zdCByZXN1bHQgPSBbXTsKICBsaXN0LmZvckVhY2goKGl0ZW0pID0+IHsKICAgIGNvbnN0IGljb24gPSB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb0ljb24oaXRlbSwgdmFsaWRhdGUsIHNpbXBsZU5hbWVzKSA6IGl0ZW07CiAgICBpZiAoaWNvbikgewogICAgICByZXN1bHQucHVzaChpY29uKTsKICAgIH0KICB9KTsKICByZXR1cm4gcmVzdWx0Owp9CgovLyBzcmMvY29uZmlnLnRzCnZhciBkZWZhdWx0Q29uZmlnID0gewogIHJlc291cmNlczogW10sCiAgaW5kZXg6IDAsCiAgdGltZW91dDogMmUzLAogIHJvdGF0ZTogNzUwLAogIHJhbmRvbTogZmFsc2UsCiAgZGF0YUFmdGVyVGltZW91dDogZmFsc2UKfTsKCi8vIHNyYy9xdWVyeS50cwpmdW5jdGlvbiBzZW5kUXVlcnkoY29uZmlnLCBwYXlsb2FkLCBxdWVyeSwgZG9uZSkgewogIGNvbnN0IHJlc291cmNlc0NvdW50ID0gY29uZmlnLnJlc291cmNlcy5sZW5ndGg7CiAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbmZpZy5yYW5kb20gPyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXNvdXJjZXNDb3VudCkgOiBjb25maWcuaW5kZXg7CiAgbGV0IHJlc291cmNlczsKICBpZiAoY29uZmlnLnJhbmRvbSkgewogICAgbGV0IGxpc3QgPSBjb25maWcucmVzb3VyY2VzLnNsaWNlKDApOwogICAgcmVzb3VyY2VzID0gW107CiAgICB3aGlsZSAobGlzdC5sZW5ndGggPiAxKSB7CiAgICAgIGNvbnN0IG5leHRJbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxpc3QubGVuZ3RoKTsKICAgICAgcmVzb3VyY2VzLnB1c2gobGlzdFtuZXh0SW5kZXhdKTsKICAgICAgbGlzdCA9IGxpc3Quc2xpY2UoMCwgbmV4dEluZGV4KS5jb25jYXQobGlzdC5zbGljZShuZXh0SW5kZXggKyAxKSk7CiAgICB9CiAgICByZXNvdXJjZXMgPSByZXNvdXJjZXMuY29uY2F0KGxpc3QpOwogIH0gZWxzZSB7CiAgICByZXNvdXJjZXMgPSBjb25maWcucmVzb3VyY2VzLnNsaWNlKHN0YXJ0SW5kZXgpLmNvbmNhdChjb25maWcucmVzb3VyY2VzLnNsaWNlKDAsIHN0YXJ0SW5kZXgpKTsKICB9CiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICBsZXQgc3RhdHVzID0gInBlbmRpbmciOwogIGxldCBxdWVyaWVzU2VudCA9IDA7CiAgbGV0IGxhc3RFcnJvcjsKICBsZXQgdGltZXIgPSBudWxsOwogIGxldCBxdWV1ZSA9IFtdOwogIGxldCBkb25lQ2FsbGJhY2tzID0gW107CiAgaWYgKHR5cGVvZiBkb25lID09PSAiZnVuY3Rpb24iKSB7CiAgICBkb25lQ2FsbGJhY2tzLnB1c2goZG9uZSk7CiAgfQogIGZ1bmN0aW9uIHJlc2V0VGltZXIoKSB7CiAgICBpZiAodGltZXIpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgdGltZXIgPSBudWxsOwogICAgfQogIH0KICBmdW5jdGlvbiBhYm9ydCgpIHsKICAgIGlmIChzdGF0dXMgPT09ICJwZW5kaW5nIikgewogICAgICBzdGF0dXMgPSAiYWJvcnRlZCI7CiAgICB9CiAgICByZXNldFRpbWVyKCk7CiAgICBxdWV1ZS5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgIGlmIChpdGVtLnN0YXR1cyA9PT0gInBlbmRpbmciKSB7CiAgICAgICAgaXRlbS5zdGF0dXMgPSAiYWJvcnRlZCI7CiAgICAgIH0KICAgIH0pOwogICAgcXVldWUgPSBbXTsKICB9CiAgZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrLCBvdmVyd3JpdGUpIHsKICAgIGlmIChvdmVyd3JpdGUpIHsKICAgICAgZG9uZUNhbGxiYWNrcyA9IFtdOwogICAgfQogICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICBkb25lQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0KICBmdW5jdGlvbiBnZXRRdWVyeVN0YXR1cygpIHsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0VGltZSwKICAgICAgcGF5bG9hZCwKICAgICAgc3RhdHVzLAogICAgICBxdWVyaWVzU2VudCwKICAgICAgcXVlcmllc1BlbmRpbmc6IHF1ZXVlLmxlbmd0aCwKICAgICAgc3Vic2NyaWJlLAogICAgICBhYm9ydAogICAgfTsKICB9CiAgZnVuY3Rpb24gZmFpbFF1ZXJ5KCkgewogICAgc3RhdHVzID0gImZhaWxlZCI7CiAgICBkb25lQ2FsbGJhY2tzLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7CiAgICAgIGNhbGxiYWNrKHZvaWQgMCwgbGFzdEVycm9yKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBjbGVhclF1ZXVlKCkgewogICAgcXVldWUuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICJwZW5kaW5nIikgewogICAgICAgIGl0ZW0uc3RhdHVzID0gImFib3J0ZWQiOwogICAgICB9CiAgICB9KTsKICAgIHF1ZXVlID0gW107CiAgfQogIGZ1bmN0aW9uIG1vZHVsZVJlc3BvbnNlKGl0ZW0sIHJlc3BvbnNlLCBkYXRhKSB7CiAgICBjb25zdCBpc0Vycm9yID0gcmVzcG9uc2UgIT09ICJzdWNjZXNzIjsKICAgIHF1ZXVlID0gcXVldWUuZmlsdGVyKChxdWV1ZWQpID0+IHF1ZXVlZCAhPT0gaXRlbSk7CiAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICBjYXNlICJwZW5kaW5nIjoKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZmFpbGVkIjoKICAgICAgICBpZiAoaXNFcnJvciB8fCAhY29uZmlnLmRhdGFBZnRlclRpbWVvdXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJlc3BvbnNlID09PSAiYWJvcnQiKSB7CiAgICAgIGxhc3RFcnJvciA9IGRhdGE7CiAgICAgIGZhaWxRdWVyeSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaXNFcnJvcikgewogICAgICBsYXN0RXJyb3IgPSBkYXRhOwogICAgICBpZiAoIXF1ZXVlLmxlbmd0aCkgewogICAgICAgIGlmICghcmVzb3VyY2VzLmxlbmd0aCkgewogICAgICAgICAgZmFpbFF1ZXJ5KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4ZWNOZXh0KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHJlc2V0VGltZXIoKTsKICAgIGNsZWFyUXVldWUoKTsKICAgIGlmICghY29uZmlnLnJhbmRvbSkgewogICAgICBjb25zdCBpbmRleCA9IGNvbmZpZy5yZXNvdXJjZXMuaW5kZXhPZihpdGVtLnJlc291cmNlKTsKICAgICAgaWYgKGluZGV4ICE9PSAtMSAmJiBpbmRleCAhPT0gY29uZmlnLmluZGV4KSB7CiAgICAgICAgY29uZmlnLmluZGV4ID0gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHN0YXR1cyA9ICJjb21wbGV0ZWQiOwogICAgZG9uZUNhbGxiYWNrcy5mb3JFYWNoKChjYWxsYmFjaykgPT4gewogICAgICBjYWxsYmFjayhkYXRhKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBleGVjTmV4dCgpIHsKICAgIGlmIChzdGF0dXMgIT09ICJwZW5kaW5nIikgewogICAgICByZXR1cm47CiAgICB9CiAgICByZXNldFRpbWVyKCk7CiAgICBjb25zdCByZXNvdXJjZSA9IHJlc291cmNlcy5zaGlmdCgpOwogICAgaWYgKHJlc291cmNlID09PSB2b2lkIDApIHsKICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNldFRpbWVyKCk7CiAgICAgICAgICBpZiAoc3RhdHVzID09PSAicGVuZGluZyIpIHsKICAgICAgICAgICAgY2xlYXJRdWV1ZSgpOwogICAgICAgICAgICBmYWlsUXVlcnkoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBjb25maWcudGltZW91dCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZhaWxRdWVyeSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpdGVtID0gewogICAgICBzdGF0dXM6ICJwZW5kaW5nIiwKICAgICAgcmVzb3VyY2UsCiAgICAgIGNhbGxiYWNrOiAoc3RhdHVzMiwgZGF0YSkgPT4gewogICAgICAgIG1vZHVsZVJlc3BvbnNlKGl0ZW0sIHN0YXR1czIsIGRhdGEpOwogICAgICB9CiAgICB9OwogICAgcXVldWUucHVzaChpdGVtKTsKICAgIHF1ZXJpZXNTZW50Kys7CiAgICB0aW1lciA9IHNldFRpbWVvdXQoZXhlY05leHQsIGNvbmZpZy5yb3RhdGUpOwogICAgcXVlcnkocmVzb3VyY2UsIHBheWxvYWQsIGl0ZW0uY2FsbGJhY2spOwogIH0KICBzZXRUaW1lb3V0KGV4ZWNOZXh0KTsKICByZXR1cm4gZ2V0UXVlcnlTdGF0dXM7Cn0KCi8vIHNyYy9pbmRleC50cwpmdW5jdGlvbiBpbml0UmVkdW5kYW5jeShjZmcpIHsKICBjb25zdCBjb25maWcgPSB7CiAgICAuLi5kZWZhdWx0Q29uZmlnLAogICAgLi4uY2ZnCiAgfTsKICBsZXQgcXVlcmllcyA9IFtdOwogIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICBxdWVyaWVzID0gcXVlcmllcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0oKS5zdGF0dXMgPT09ICJwZW5kaW5nIik7CiAgfQogIGZ1bmN0aW9uIHF1ZXJ5KHBheWxvYWQsIHF1ZXJ5Q2FsbGJhY2ssIGRvbmVDYWxsYmFjaykgewogICAgY29uc3QgcXVlcnkyID0gc2VuZFF1ZXJ5KAogICAgICBjb25maWcsCiAgICAgIHBheWxvYWQsCiAgICAgIHF1ZXJ5Q2FsbGJhY2ssCiAgICAgIChkYXRhLCBlcnJvcikgPT4gewogICAgICAgIGNsZWFudXAoKTsKICAgICAgICBpZiAoZG9uZUNhbGxiYWNrKSB7CiAgICAgICAgICBkb25lQ2FsbGJhY2soZGF0YSwgZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgKTsKICAgIHF1ZXJpZXMucHVzaChxdWVyeTIpOwogICAgcmV0dXJuIHF1ZXJ5MjsKICB9CiAgZnVuY3Rpb24gZmluZChjYWxsYmFjaykgewogICAgcmV0dXJuIHF1ZXJpZXMuZmluZCgodmFsdWUpID0+IHsKICAgICAgcmV0dXJuIGNhbGxiYWNrKHZhbHVlKTsKICAgIH0pIHx8IG51bGw7CiAgfQogIGNvbnN0IGluc3RhbmNlID0gewogICAgcXVlcnksCiAgICBmaW5kLAogICAgc2V0SW5kZXg6IChpbmRleCkgPT4gewogICAgICBjb25maWcuaW5kZXggPSBpbmRleDsKICAgIH0sCiAgICBnZXRJbmRleDogKCkgPT4gY29uZmlnLmluZGV4LAogICAgY2xlYW51cAogIH07CiAgcmV0dXJuIGluc3RhbmNlOwp9CgpmdW5jdGlvbiBlbXB0eUNhbGxiYWNrJDEoKSB7Cn0KY29uc3QgcmVkdW5kYW5jeUNhY2hlID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CmZ1bmN0aW9uIGdldFJlZHVuZGFuY3lDYWNoZShwcm92aWRlcikgewogIGlmICghcmVkdW5kYW5jeUNhY2hlW3Byb3ZpZGVyXSkgewogICAgY29uc3QgY29uZmlnID0gZ2V0QVBJQ29uZmlnKHByb3ZpZGVyKTsKICAgIGlmICghY29uZmlnKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJlZHVuZGFuY3kgPSBpbml0UmVkdW5kYW5jeShjb25maWcpOwogICAgY29uc3QgY2FjaGVkUmV1bmRhbmN5ID0gewogICAgICBjb25maWcsCiAgICAgIHJlZHVuZGFuY3kKICAgIH07CiAgICByZWR1bmRhbmN5Q2FjaGVbcHJvdmlkZXJdID0gY2FjaGVkUmV1bmRhbmN5OwogIH0KICByZXR1cm4gcmVkdW5kYW5jeUNhY2hlW3Byb3ZpZGVyXTsKfQpmdW5jdGlvbiBzZW5kQVBJUXVlcnkodGFyZ2V0LCBxdWVyeSwgY2FsbGJhY2spIHsKICBsZXQgcmVkdW5kYW5jeTsKICBsZXQgc2VuZDsKICBpZiAodHlwZW9mIHRhcmdldCA9PT0gInN0cmluZyIpIHsKICAgIGNvbnN0IGFwaSA9IGdldEFQSU1vZHVsZSh0YXJnZXQpOwogICAgaWYgKCFhcGkpIHsKICAgICAgY2FsbGJhY2sodm9pZCAwLCA0MjQpOwogICAgICByZXR1cm4gZW1wdHlDYWxsYmFjayQxOwogICAgfQogICAgc2VuZCA9IGFwaS5zZW5kOwogICAgY29uc3QgY2FjaGVkID0gZ2V0UmVkdW5kYW5jeUNhY2hlKHRhcmdldCk7CiAgICBpZiAoY2FjaGVkKSB7CiAgICAgIHJlZHVuZGFuY3kgPSBjYWNoZWQucmVkdW5kYW5jeTsKICAgIH0KICB9IGVsc2UgewogICAgY29uc3QgY29uZmlnID0gY3JlYXRlQVBJQ29uZmlnKHRhcmdldCk7CiAgICBpZiAoY29uZmlnKSB7CiAgICAgIHJlZHVuZGFuY3kgPSBpbml0UmVkdW5kYW5jeShjb25maWcpOwogICAgICBjb25zdCBtb2R1bGVLZXkgPSB0YXJnZXQucmVzb3VyY2VzID8gdGFyZ2V0LnJlc291cmNlc1swXSA6ICIiOwogICAgICBjb25zdCBhcGkgPSBnZXRBUElNb2R1bGUobW9kdWxlS2V5KTsKICAgICAgaWYgKGFwaSkgewogICAgICAgIHNlbmQgPSBhcGkuc2VuZDsKICAgICAgfQogICAgfQogIH0KICBpZiAoIXJlZHVuZGFuY3kgfHwgIXNlbmQpIHsKICAgIGNhbGxiYWNrKHZvaWQgMCwgNDI0KTsKICAgIHJldHVybiBlbXB0eUNhbGxiYWNrJDE7CiAgfQogIHJldHVybiByZWR1bmRhbmN5LnF1ZXJ5KHF1ZXJ5LCBzZW5kLCBjYWxsYmFjaykoKS5hYm9ydDsKfQoKY29uc3QgYnJvd3NlckNhY2hlVmVyc2lvbiA9ICJpY29uaWZ5MiI7CmNvbnN0IGJyb3dzZXJDYWNoZVByZWZpeCA9ICJpY29uaWZ5IjsKY29uc3QgYnJvd3NlckNhY2hlQ291bnRLZXkgPSBicm93c2VyQ2FjaGVQcmVmaXggKyAiLWNvdW50IjsKY29uc3QgYnJvd3NlckNhY2hlVmVyc2lvbktleSA9IGJyb3dzZXJDYWNoZVByZWZpeCArICItdmVyc2lvbiI7CmNvbnN0IGJyb3dzZXJTdG9yYWdlSG91ciA9IDM2ZTU7CmNvbnN0IGJyb3dzZXJTdG9yYWdlQ2FjaGVFeHBpcmF0aW9uID0gMTY4OwoKZnVuY3Rpb24gZ2V0U3RvcmVkSXRlbShmdW5jLCBrZXkpIHsKICB0cnkgewogICAgcmV0dXJuIGZ1bmMuZ2V0SXRlbShrZXkpOwogIH0gY2F0Y2ggKGVycikgewogIH0KfQpmdW5jdGlvbiBzZXRTdG9yZWRJdGVtKGZ1bmMsIGtleSwgdmFsdWUpIHsKICB0cnkgewogICAgZnVuYy5zZXRJdGVtKGtleSwgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCAoZXJyKSB7CiAgfQp9CmZ1bmN0aW9uIHJlbW92ZVN0b3JlZEl0ZW0oZnVuYywga2V5KSB7CiAgdHJ5IHsKICAgIGZ1bmMucmVtb3ZlSXRlbShrZXkpOwogIH0gY2F0Y2ggKGVycikgewogIH0KfQoKZnVuY3Rpb24gc2V0QnJvd3NlclN0b3JhZ2VJdGVtc0NvdW50KHN0b3JhZ2UsIHZhbHVlKSB7CiAgcmV0dXJuIHNldFN0b3JlZEl0ZW0oc3RvcmFnZSwgYnJvd3NlckNhY2hlQ291bnRLZXksIHZhbHVlLnRvU3RyaW5nKCkpOwp9CmZ1bmN0aW9uIGdldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChzdG9yYWdlKSB7CiAgcmV0dXJuIHBhcnNlSW50KGdldFN0b3JlZEl0ZW0oc3RvcmFnZSwgYnJvd3NlckNhY2hlQ291bnRLZXkpKSB8fCAwOwp9Cgpjb25zdCBicm93c2VyU3RvcmFnZUNvbmZpZyA9IHsKICBsb2NhbDogdHJ1ZSwKICBzZXNzaW9uOiB0cnVlCn07CmNvbnN0IGJyb3dzZXJTdG9yYWdlRW1wdHlJdGVtcyA9IHsKICBsb2NhbDogLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSwKICBzZXNzaW9uOiAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpCn07CmxldCBicm93c2VyU3RvcmFnZVN0YXR1cyA9IGZhbHNlOwpmdW5jdGlvbiBzZXRCcm93c2VyU3RvcmFnZVN0YXR1cyhzdGF0dXMpIHsKICBicm93c2VyU3RvcmFnZVN0YXR1cyA9IHN0YXR1czsKfQoKbGV0IF93aW5kb3ckMSA9IHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8ge30gOiB3aW5kb3c7CmZ1bmN0aW9uIGdldEJyb3dzZXJTdG9yYWdlKGtleSkgewogIGNvbnN0IGF0dHIgPSBrZXkgKyAiU3RvcmFnZSI7CiAgdHJ5IHsKICAgIGlmIChfd2luZG93JDEgJiYgX3dpbmRvdyQxW2F0dHJdICYmIHR5cGVvZiBfd2luZG93JDFbYXR0cl0ubGVuZ3RoID09PSAibnVtYmVyIikgewogICAgICByZXR1cm4gX3dpbmRvdyQxW2F0dHJdOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogIH0KICBicm93c2VyU3RvcmFnZUNvbmZpZ1trZXldID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGl0ZXJhdGVCcm93c2VyU3RvcmFnZShrZXksIGNhbGxiYWNrKSB7CiAgY29uc3QgZnVuYyA9IGdldEJyb3dzZXJTdG9yYWdlKGtleSk7CiAgaWYgKCFmdW5jKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHZlcnNpb24gPSBnZXRTdG9yZWRJdGVtKGZ1bmMsIGJyb3dzZXJDYWNoZVZlcnNpb25LZXkpOwogIGlmICh2ZXJzaW9uICE9PSBicm93c2VyQ2FjaGVWZXJzaW9uKSB7CiAgICBpZiAodmVyc2lvbikgewogICAgICBjb25zdCB0b3RhbDIgPSBnZXRCcm93c2VyU3RvcmFnZUl0ZW1zQ291bnQoZnVuYyk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG90YWwyOyBpKyspIHsKICAgICAgICByZW1vdmVTdG9yZWRJdGVtKGZ1bmMsIGJyb3dzZXJDYWNoZVByZWZpeCArIGkudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICAgIHNldFN0b3JlZEl0ZW0oZnVuYywgYnJvd3NlckNhY2hlVmVyc2lvbktleSwgYnJvd3NlckNhY2hlVmVyc2lvbik7CiAgICBzZXRCcm93c2VyU3RvcmFnZUl0ZW1zQ291bnQoZnVuYywgMCk7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IG1pblRpbWUgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyBicm93c2VyU3RvcmFnZUhvdXIpIC0gYnJvd3NlclN0b3JhZ2VDYWNoZUV4cGlyYXRpb247CiAgY29uc3QgcGFyc2VJdGVtID0gKGluZGV4KSA9PiB7CiAgICBjb25zdCBuYW1lID0gYnJvd3NlckNhY2hlUHJlZml4ICsgaW5kZXgudG9TdHJpbmcoKTsKICAgIGNvbnN0IGl0ZW0gPSBnZXRTdG9yZWRJdGVtKGZ1bmMsIG5hbWUpOwogICAgaWYgKHR5cGVvZiBpdGVtICE9PSAic3RyaW5nIikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShpdGVtKTsKICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAib2JqZWN0IiAmJiB0eXBlb2YgZGF0YS5jYWNoZWQgPT09ICJudW1iZXIiICYmIGRhdGEuY2FjaGVkID4gbWluVGltZSAmJiB0eXBlb2YgZGF0YS5wcm92aWRlciA9PT0gInN0cmluZyIgJiYgdHlwZW9mIGRhdGEuZGF0YSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIGRhdGEuZGF0YS5wcmVmaXggPT09ICJzdHJpbmciICYmIC8vIFZhbGlkIGl0ZW06IHJ1biBjYWxsYmFjawogICAgICBjYWxsYmFjayhkYXRhLCBpbmRleCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSBjYXRjaCAoZXJyKSB7CiAgICB9CiAgICByZW1vdmVTdG9yZWRJdGVtKGZ1bmMsIG5hbWUpOwogIH07CiAgbGV0IHRvdGFsID0gZ2V0QnJvd3NlclN0b3JhZ2VJdGVtc0NvdW50KGZ1bmMpOwogIGZvciAobGV0IGkgPSB0b3RhbCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBpZiAoIXBhcnNlSXRlbShpKSkgewogICAgICBpZiAoaSA9PT0gdG90YWwgLSAxKSB7CiAgICAgICAgdG90YWwtLTsKICAgICAgICBzZXRCcm93c2VyU3RvcmFnZUl0ZW1zQ291bnQoZnVuYywgdG90YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIGJyb3dzZXJTdG9yYWdlRW1wdHlJdGVtc1trZXldLmFkZChpKTsKICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gaW5pdEJyb3dzZXJTdG9yYWdlKCkgewogIGlmIChicm93c2VyU3RvcmFnZVN0YXR1cykgewogICAgcmV0dXJuOwogIH0KICBzZXRCcm93c2VyU3RvcmFnZVN0YXR1cyh0cnVlKTsKICBmb3IgKGNvbnN0IGtleSBpbiBicm93c2VyU3RvcmFnZUNvbmZpZykgewogICAgaXRlcmF0ZUJyb3dzZXJTdG9yYWdlKGtleSwgKGl0ZW0pID0+IHsKICAgICAgY29uc3QgaWNvblNldCA9IGl0ZW0uZGF0YTsKICAgICAgY29uc3QgcHJvdmlkZXIgPSBpdGVtLnByb3ZpZGVyOwogICAgICBjb25zdCBwcmVmaXggPSBpY29uU2V0LnByZWZpeDsKICAgICAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UoCiAgICAgICAgcHJvdmlkZXIsCiAgICAgICAgcHJlZml4CiAgICAgICk7CiAgICAgIGlmICghYWRkSWNvblNldChzdG9yYWdlLCBpY29uU2V0KS5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgbGFzdE1vZGlmaWVkID0gaWNvblNldC5sYXN0TW9kaWZpZWQgfHwgLTE7CiAgICAgIHN0b3JhZ2UubGFzdE1vZGlmaWVkQ2FjaGVkID0gc3RvcmFnZS5sYXN0TW9kaWZpZWRDYWNoZWQgPyBNYXRoLm1pbihzdG9yYWdlLmxhc3RNb2RpZmllZENhY2hlZCwgbGFzdE1vZGlmaWVkKSA6IGxhc3RNb2RpZmllZDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxhc3RNb2RpZmllZChzdG9yYWdlLCBsYXN0TW9kaWZpZWQpIHsKICBjb25zdCBsYXN0VmFsdWUgPSBzdG9yYWdlLmxhc3RNb2RpZmllZENhY2hlZDsKICBpZiAoCiAgICAvLyBNYXRjaGVzIG9yIG5ld2VyCiAgICBsYXN0VmFsdWUgJiYgbGFzdFZhbHVlID49IGxhc3RNb2RpZmllZAogICkgewogICAgcmV0dXJuIGxhc3RWYWx1ZSA9PT0gbGFzdE1vZGlmaWVkOwogIH0KICBzdG9yYWdlLmxhc3RNb2RpZmllZENhY2hlZCA9IGxhc3RNb2RpZmllZDsKICBpZiAobGFzdFZhbHVlKSB7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBicm93c2VyU3RvcmFnZUNvbmZpZykgewogICAgICBpdGVyYXRlQnJvd3NlclN0b3JhZ2Uoa2V5LCAoaXRlbSkgPT4gewogICAgICAgIGNvbnN0IGljb25TZXQgPSBpdGVtLmRhdGE7CiAgICAgICAgcmV0dXJuIGl0ZW0ucHJvdmlkZXIgIT09IHN0b3JhZ2UucHJvdmlkZXIgfHwgaWNvblNldC5wcmVmaXggIT09IHN0b3JhZ2UucHJlZml4IHx8IGljb25TZXQubGFzdE1vZGlmaWVkID09PSBsYXN0TW9kaWZpZWQ7CiAgICAgIH0pOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBzdG9yZUluQnJvd3NlclN0b3JhZ2Uoc3RvcmFnZSwgZGF0YSkgewogIGlmICghYnJvd3NlclN0b3JhZ2VTdGF0dXMpIHsKICAgIGluaXRCcm93c2VyU3RvcmFnZSgpOwogIH0KICBmdW5jdGlvbiBzdG9yZShrZXkpIHsKICAgIGxldCBmdW5jOwogICAgaWYgKCFicm93c2VyU3RvcmFnZUNvbmZpZ1trZXldIHx8ICEoZnVuYyA9IGdldEJyb3dzZXJTdG9yYWdlKGtleSkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNldCA9IGJyb3dzZXJTdG9yYWdlRW1wdHlJdGVtc1trZXldOwogICAgbGV0IGluZGV4OwogICAgaWYgKHNldC5zaXplKSB7CiAgICAgIHNldC5kZWxldGUoaW5kZXggPSBBcnJheS5mcm9tKHNldCkuc2hpZnQoKSk7CiAgICB9IGVsc2UgewogICAgICBpbmRleCA9IGdldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChmdW5jKTsKICAgICAgaWYgKCFzZXRCcm93c2VyU3RvcmFnZUl0ZW1zQ291bnQoZnVuYywgaW5kZXggKyAxKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29uc3QgaXRlbSA9IHsKICAgICAgY2FjaGVkOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyBicm93c2VyU3RvcmFnZUhvdXIpLAogICAgICBwcm92aWRlcjogc3RvcmFnZS5wcm92aWRlciwKICAgICAgZGF0YQogICAgfTsKICAgIHJldHVybiBzZXRTdG9yZWRJdGVtKAogICAgICBmdW5jLAogICAgICBicm93c2VyQ2FjaGVQcmVmaXggKyBpbmRleC50b1N0cmluZygpLAogICAgICBKU09OLnN0cmluZ2lmeShpdGVtKQogICAgKTsKICB9CiAgaWYgKGRhdGEubGFzdE1vZGlmaWVkICYmICF1cGRhdGVMYXN0TW9kaWZpZWQoc3RvcmFnZSwgZGF0YS5sYXN0TW9kaWZpZWQpKSB7CiAgICByZXR1cm47CiAgfQogIGlmICghT2JqZWN0LmtleXMoZGF0YS5pY29ucykubGVuZ3RoKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChkYXRhLm5vdF9mb3VuZCkgewogICAgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpOwogICAgZGVsZXRlIGRhdGEubm90X2ZvdW5kOwogIH0KICBpZiAoIXN0b3JlKCJsb2NhbCIpKSB7CiAgICBzdG9yZSgic2Vzc2lvbiIpOwogIH0KfQoKZnVuY3Rpb24gZW1wdHlDYWxsYmFjaygpIHsKfQpmdW5jdGlvbiBsb2FkZWROZXdJY29ucyhzdG9yYWdlKSB7CiAgaWYgKCFzdG9yYWdlLmljb25zTG9hZGVyRmxhZykgewogICAgc3RvcmFnZS5pY29uc0xvYWRlckZsYWcgPSB0cnVlOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHN0b3JhZ2UuaWNvbnNMb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgIHVwZGF0ZUNhbGxiYWNrcyhzdG9yYWdlKTsKICAgIH0pOwogIH0KfQpmdW5jdGlvbiBsb2FkTmV3SWNvbnMoc3RvcmFnZSwgaWNvbnMpIHsKICBpZiAoIXN0b3JhZ2UuaWNvbnNUb0xvYWQpIHsKICAgIHN0b3JhZ2UuaWNvbnNUb0xvYWQgPSBpY29uczsKICB9IGVsc2UgewogICAgc3RvcmFnZS5pY29uc1RvTG9hZCA9IHN0b3JhZ2UuaWNvbnNUb0xvYWQuY29uY2F0KGljb25zKS5zb3J0KCk7CiAgfQogIGlmICghc3RvcmFnZS5pY29uc1F1ZXVlRmxhZykgewogICAgc3RvcmFnZS5pY29uc1F1ZXVlRmxhZyA9IHRydWU7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgc3RvcmFnZS5pY29uc1F1ZXVlRmxhZyA9IGZhbHNlOwogICAgICBjb25zdCB7IHByb3ZpZGVyLCBwcmVmaXggfSA9IHN0b3JhZ2U7CiAgICAgIGNvbnN0IGljb25zMiA9IHN0b3JhZ2UuaWNvbnNUb0xvYWQ7CiAgICAgIGRlbGV0ZSBzdG9yYWdlLmljb25zVG9Mb2FkOwogICAgICBsZXQgYXBpOwogICAgICBpZiAoIWljb25zMiB8fCAhKGFwaSA9IGdldEFQSU1vZHVsZShwcm92aWRlcikpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHBhcmFtcyA9IGFwaS5wcmVwYXJlKHByb3ZpZGVyLCBwcmVmaXgsIGljb25zMik7CiAgICAgIHBhcmFtcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgc2VuZEFQSVF1ZXJ5KHByb3ZpZGVyLCBpdGVtLCAoZGF0YSkgPT4gewogICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAib2JqZWN0IikgewogICAgICAgICAgICBpdGVtLmljb25zLmZvckVhY2goKG5hbWUpID0+IHsKICAgICAgICAgICAgICBzdG9yYWdlLm1pc3NpbmcuYWRkKG5hbWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gYWRkSWNvblNldCgKICAgICAgICAgICAgICAgIHN0b3JhZ2UsCiAgICAgICAgICAgICAgICBkYXRhCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBpZiAoIXBhcnNlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgcGVuZGluZyA9IHN0b3JhZ2UucGVuZGluZ0ljb25zOwogICAgICAgICAgICAgIGlmIChwZW5kaW5nKSB7CiAgICAgICAgICAgICAgICBwYXJzZWQuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICAgICAgICAgICAgICBwZW5kaW5nLmRlbGV0ZShuYW1lKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdG9yZUluQnJvd3NlclN0b3JhZ2Uoc3RvcmFnZSwgZGF0YSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbG9hZGVkTmV3SWNvbnMoc3RvcmFnZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQp9CmNvbnN0IGxvYWRJY29ucyA9IChpY29ucywgY2FsbGJhY2spID0+IHsKICBjb25zdCBjbGVhbmVkSWNvbnMgPSBsaXN0VG9JY29ucyhpY29ucywgdHJ1ZSwgYWxsb3dTaW1wbGVOYW1lcygpKTsKICBjb25zdCBzb3J0ZWRJY29ucyA9IHNvcnRJY29ucyhjbGVhbmVkSWNvbnMpOwogIGlmICghc29ydGVkSWNvbnMucGVuZGluZy5sZW5ndGgpIHsKICAgIGxldCBjYWxsQ2FsbGJhY2sgPSB0cnVlOwogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmIChjYWxsQ2FsbGJhY2spIHsKICAgICAgICAgIGNhbGxiYWNrKAogICAgICAgICAgICBzb3J0ZWRJY29ucy5sb2FkZWQsCiAgICAgICAgICAgIHNvcnRlZEljb25zLm1pc3NpbmcsCiAgICAgICAgICAgIHNvcnRlZEljb25zLnBlbmRpbmcsCiAgICAgICAgICAgIGVtcHR5Q2FsbGJhY2sKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiAoKSA9PiB7CiAgICAgIGNhbGxDYWxsYmFjayA9IGZhbHNlOwogICAgfTsKICB9CiAgY29uc3QgbmV3SWNvbnMgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBjb25zdCBzb3VyY2VzID0gW107CiAgbGV0IGxhc3RQcm92aWRlciwgbGFzdFByZWZpeDsKICBzb3J0ZWRJY29ucy5wZW5kaW5nLmZvckVhY2goKGljb24pID0+IHsKICAgIGNvbnN0IHsgcHJvdmlkZXIsIHByZWZpeCB9ID0gaWNvbjsKICAgIGlmIChwcmVmaXggPT09IGxhc3RQcmVmaXggJiYgcHJvdmlkZXIgPT09IGxhc3RQcm92aWRlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBsYXN0UHJvdmlkZXIgPSBwcm92aWRlcjsKICAgIGxhc3RQcmVmaXggPSBwcmVmaXg7CiAgICBzb3VyY2VzLnB1c2goZ2V0U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSk7CiAgICBjb25zdCBwcm92aWRlck5ld0ljb25zID0gbmV3SWNvbnNbcHJvdmlkZXJdIHx8IChuZXdJY29uc1twcm92aWRlcl0gPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgICBpZiAoIXByb3ZpZGVyTmV3SWNvbnNbcHJlZml4XSkgewogICAgICBwcm92aWRlck5ld0ljb25zW3ByZWZpeF0gPSBbXTsKICAgIH0KICB9KTsKICBzb3J0ZWRJY29ucy5wZW5kaW5nLmZvckVhY2goKGljb24pID0+IHsKICAgIGNvbnN0IHsgcHJvdmlkZXIsIHByZWZpeCwgbmFtZSB9ID0gaWNvbjsKICAgIGNvbnN0IHN0b3JhZ2UgPSBnZXRTdG9yYWdlKHByb3ZpZGVyLCBwcmVmaXgpOwogICAgY29uc3QgcGVuZGluZ1F1ZXVlID0gc3RvcmFnZS5wZW5kaW5nSWNvbnMgfHwgKHN0b3JhZ2UucGVuZGluZ0ljb25zID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSk7CiAgICBpZiAoIXBlbmRpbmdRdWV1ZS5oYXMobmFtZSkpIHsKICAgICAgcGVuZGluZ1F1ZXVlLmFkZChuYW1lKTsKICAgICAgbmV3SWNvbnNbcHJvdmlkZXJdW3ByZWZpeF0ucHVzaChuYW1lKTsKICAgIH0KICB9KTsKICBzb3VyY2VzLmZvckVhY2goKHN0b3JhZ2UpID0+IHsKICAgIGNvbnN0IHsgcHJvdmlkZXIsIHByZWZpeCB9ID0gc3RvcmFnZTsKICAgIGlmIChuZXdJY29uc1twcm92aWRlcl1bcHJlZml4XS5sZW5ndGgpIHsKICAgICAgbG9hZE5ld0ljb25zKHN0b3JhZ2UsIG5ld0ljb25zW3Byb3ZpZGVyXVtwcmVmaXhdKTsKICAgIH0KICB9KTsKICByZXR1cm4gY2FsbGJhY2sgPyBzdG9yZUNhbGxiYWNrKGNhbGxiYWNrLCBzb3J0ZWRJY29ucywgc291cmNlcykgOiBlbXB0eUNhbGxiYWNrOwp9OwoKZnVuY3Rpb24gbWVyZ2VDdXN0b21pc2F0aW9ucyhkZWZhdWx0cywgaXRlbSkgewogIGNvbnN0IHJlc3VsdCA9IHsKICAgIC4uLmRlZmF1bHRzCiAgfTsKICBmb3IgKGNvbnN0IGtleSBpbiBpdGVtKSB7CiAgICBjb25zdCB2YWx1ZSA9IGl0ZW1ba2V5XTsKICAgIGNvbnN0IHZhbHVlVHlwZSA9IHR5cGVvZiB2YWx1ZTsKICAgIGlmIChrZXkgaW4gZGVmYXVsdEljb25TaXplQ3VzdG9taXNhdGlvbnMpIHsKICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlICYmICh2YWx1ZVR5cGUgPT09ICJzdHJpbmciIHx8IHZhbHVlVHlwZSA9PT0gIm51bWJlciIpKSB7CiAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfSBlbHNlIGlmICh2YWx1ZVR5cGUgPT09IHR5cGVvZiByZXN1bHRba2V5XSkgewogICAgICByZXN1bHRba2V5XSA9IGtleSA9PT0gInJvdGF0ZSIgPyB2YWx1ZSAlIDQgOiB2YWx1ZTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdDsKfQoKY29uc3Qgc2VwYXJhdG9yID0gL1tccyxdKy87CmZ1bmN0aW9uIGZsaXBGcm9tU3RyaW5nKGN1c3RvbSwgZmxpcCkgewogIGZsaXAuc3BsaXQoc2VwYXJhdG9yKS5mb3JFYWNoKChzdHIpID0+IHsKICAgIGNvbnN0IHZhbHVlID0gc3RyLnRyaW0oKTsKICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgY2FzZSAiaG9yaXpvbnRhbCI6CiAgICAgICAgY3VzdG9tLmhGbGlwID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidmVydGljYWwiOgogICAgICAgIGN1c3RvbS52RmxpcCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHJvdGF0ZUZyb21TdHJpbmcodmFsdWUsIGRlZmF1bHRWYWx1ZSA9IDApIHsKICBjb25zdCB1bml0cyA9IHZhbHVlLnJlcGxhY2UoL14tP1swLTkuXSovLCAiIik7CiAgZnVuY3Rpb24gY2xlYW51cCh2YWx1ZTIpIHsKICAgIHdoaWxlICh2YWx1ZTIgPCAwKSB7CiAgICAgIHZhbHVlMiArPSA0OwogICAgfQogICAgcmV0dXJuIHZhbHVlMiAlIDQ7CiAgfQogIGlmICh1bml0cyA9PT0gIiIpIHsKICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KHZhbHVlKTsKICAgIHJldHVybiBpc05hTihudW0pID8gMCA6IGNsZWFudXAobnVtKTsKICB9IGVsc2UgaWYgKHVuaXRzICE9PSB2YWx1ZSkgewogICAgbGV0IHNwbGl0ID0gMDsKICAgIHN3aXRjaCAodW5pdHMpIHsKICAgICAgY2FzZSAiJSI6CiAgICAgICAgc3BsaXQgPSAyNTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZGVnIjoKICAgICAgICBzcGxpdCA9IDkwOwogICAgfQogICAgaWYgKHNwbGl0KSB7CiAgICAgIGxldCBudW0gPSBwYXJzZUZsb2F0KHZhbHVlLnNsaWNlKDAsIHZhbHVlLmxlbmd0aCAtIHVuaXRzLmxlbmd0aCkpOwogICAgICBpZiAoaXNOYU4obnVtKSkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIG51bSA9IG51bSAvIHNwbGl0OwogICAgICByZXR1cm4gbnVtICUgMSA9PT0gMCA/IGNsZWFudXAobnVtKSA6IDA7CiAgICB9CiAgfQogIHJldHVybiBkZWZhdWx0VmFsdWU7Cn0KCmZ1bmN0aW9uIGljb25Ub0hUTUwoYm9keSwgYXR0cmlidXRlcykgewogIGxldCByZW5kZXJBdHRyaWJzSFRNTCA9IGJvZHkuaW5kZXhPZigieGxpbms6IikgPT09IC0xID8gIiIgOiAnIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIic7CiAgZm9yIChjb25zdCBhdHRyIGluIGF0dHJpYnV0ZXMpIHsKICAgIHJlbmRlckF0dHJpYnNIVE1MICs9ICIgIiArIGF0dHIgKyAnPSInICsgYXR0cmlidXRlc1thdHRyXSArICciJzsKICB9CiAgcmV0dXJuICc8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyInICsgcmVuZGVyQXR0cmlic0hUTUwgKyAiPiIgKyBib2R5ICsgIjwvc3ZnPiI7Cn0KCmZ1bmN0aW9uIGVuY29kZVNWR2ZvclVSTChzdmcpIHsKICByZXR1cm4gc3ZnLnJlcGxhY2UoLyIvZywgIiciKS5yZXBsYWNlKC8lL2csICIlMjUiKS5yZXBsYWNlKC8jL2csICIlMjMiKS5yZXBsYWNlKC88L2csICIlM0MiKS5yZXBsYWNlKC8+L2csICIlM0UiKS5yZXBsYWNlKC9ccysvZywgIiAiKTsKfQpmdW5jdGlvbiBzdmdUb0RhdGEoc3ZnKSB7CiAgcmV0dXJuICJkYXRhOmltYWdlL3N2Zyt4bWwsIiArIGVuY29kZVNWR2ZvclVSTChzdmcpOwp9CmZ1bmN0aW9uIHN2Z1RvVVJMKHN2ZykgewogIHJldHVybiAndXJsKCInICsgc3ZnVG9EYXRhKHN2ZykgKyAnIiknOwp9Cgpjb25zdCBkZWZhdWx0RXh0ZW5kZWRJY29uQ3VzdG9taXNhdGlvbnMgPSB7CiAgICAuLi5kZWZhdWx0SWNvbkN1c3RvbWlzYXRpb25zLAogICAgaW5saW5lOiBmYWxzZSwKfTsKCi8qKgogKiBEZWZhdWx0IFNWRyBhdHRyaWJ1dGVzCiAqLwpjb25zdCBzdmdEZWZhdWx0cyA9IHsKICAgICd4bWxucyc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsCiAgICAneG1sbnM6eGxpbmsnOiAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsCiAgICAnYXJpYS1oaWRkZW4nOiB0cnVlLAogICAgJ3JvbGUnOiAnaW1nJywKfTsKLyoqCiAqIFN0eWxlIG1vZGVzCiAqLwpjb25zdCBjb21tb25Qcm9wcyA9IHsKICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAp9Owpjb25zdCBtb25vdG9uZVByb3BzID0gewogICAgJ2JhY2tncm91bmQtY29sb3InOiAnY3VycmVudENvbG9yJywKfTsKY29uc3QgY29sb3JlZFByb3BzID0gewogICAgJ2JhY2tncm91bmQtY29sb3InOiAndHJhbnNwYXJlbnQnLAp9OwovLyBEeW5hbWljYWxseSBhZGQgY29tbW9uIHByb3BzIHRvIHZhcmlhYmxlcyBhYm92ZQpjb25zdCBwcm9wc1RvQWRkID0gewogICAgaW1hZ2U6ICd2YXIoLS1zdmcpJywKICAgIHJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICBzaXplOiAnMTAwJSAxMDAlJywKfTsKY29uc3QgcHJvcHNUb0FkZFRvID0gewogICAgJy13ZWJraXQtbWFzayc6IG1vbm90b25lUHJvcHMsCiAgICAnbWFzayc6IG1vbm90b25lUHJvcHMsCiAgICAnYmFja2dyb3VuZCc6IGNvbG9yZWRQcm9wcywKfTsKZm9yIChjb25zdCBwcmVmaXggaW4gcHJvcHNUb0FkZFRvKSB7CiAgICBjb25zdCBsaXN0ID0gcHJvcHNUb0FkZFRvW3ByZWZpeF07CiAgICBmb3IgKGNvbnN0IHByb3AgaW4gcHJvcHNUb0FkZCkgewogICAgICAgIGxpc3RbcHJlZml4ICsgJy0nICsgcHJvcF0gPSBwcm9wc1RvQWRkW3Byb3BdOwogICAgfQp9Ci8qKgogKiBGaXggc2l6ZTogYWRkICdweCcgdG8gbnVtYmVycwogKi8KZnVuY3Rpb24gZml4U2l6ZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICsgKHZhbHVlLm1hdGNoKC9eWy0wLTkuXSskLykgPyAncHgnIDogJycpOwp9Ci8qKgogKiBHZW5lcmF0ZSBpY29uIGZyb20gcHJvcGVydGllcwogKi8KZnVuY3Rpb24gcmVuZGVyKAovLyBJY29uIG11c3QgYmUgdmFsaWRhdGVkIGJlZm9yZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24KaWNvbiwgCi8vIFByb3BlcnRpZXMKcHJvcHMpIHsKICAgIGNvbnN0IGN1c3RvbWlzYXRpb25zID0gbWVyZ2VDdXN0b21pc2F0aW9ucyhkZWZhdWx0RXh0ZW5kZWRJY29uQ3VzdG9taXNhdGlvbnMsIHByb3BzKTsKICAgIC8vIENoZWNrIG1vZGUKICAgIGNvbnN0IG1vZGUgPSBwcm9wcy5tb2RlIHx8ICdzdmcnOwogICAgY29uc3QgY29tcG9uZW50UHJvcHMgPSAobW9kZSA9PT0gJ3N2ZycgPyB7IC4uLnN2Z0RlZmF1bHRzIH0gOiB7fSk7CiAgICBpZiAoaWNvbi5ib2R5LmluZGV4T2YoJ3hsaW5rOicpID09PSAtMSkgewogICAgICAgIGRlbGV0ZSBjb21wb25lbnRQcm9wc1sneG1sbnM6eGxpbmsnXTsKICAgIH0KICAgIC8vIENyZWF0ZSBzdHlsZSBpZiBtaXNzaW5nCiAgICBsZXQgc3R5bGUgPSB0eXBlb2YgcHJvcHMuc3R5bGUgPT09ICdzdHJpbmcnID8gcHJvcHMuc3R5bGUgOiAnJzsKICAgIC8vIEdldCBlbGVtZW50IHByb3BlcnRpZXMKICAgIGZvciAobGV0IGtleSBpbiBwcm9wcykgewogICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcHNba2V5XTsKICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICAgICAgLy8gUHJvcGVydGllcyB0byBpZ25vcmUKICAgICAgICAgICAgY2FzZSAnaWNvbic6CiAgICAgICAgICAgIGNhc2UgJ3N0eWxlJzoKICAgICAgICAgICAgY2FzZSAnb25Mb2FkJzoKICAgICAgICAgICAgY2FzZSAnbW9kZSc6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8gQm9vbGVhbiBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgIGNhc2UgJ2hGbGlwJzoKICAgICAgICAgICAgY2FzZSAndkZsaXAnOgogICAgICAgICAgICAgICAgY3VzdG9taXNhdGlvbnNba2V5XSA9CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09ICd0cnVlJyB8fCB2YWx1ZSA9PT0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyBGbGlwIGFzIHN0cmluZzogJ2hvcml6b250YWwsdmVydGljYWwnCiAgICAgICAgICAgIGNhc2UgJ2ZsaXAnOgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBmbGlwRnJvbVN0cmluZyhjdXN0b21pc2F0aW9ucywgdmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIENvbG9yOiBjb3B5IHRvIHN0eWxlLCBhZGQgZXh0cmEgJzsnIGluIGNhc2Ugc3R5bGUgaXMgbWlzc2luZyBpdAogICAgICAgICAgICBjYXNlICdjb2xvcic6CiAgICAgICAgICAgICAgICBzdHlsZSA9CiAgICAgICAgICAgICAgICAgICAgc3R5bGUgKwogICAgICAgICAgICAgICAgICAgICAgICAoc3R5bGUubGVuZ3RoID4gMCAmJiBzdHlsZS50cmltKCkuc2xpY2UoLTEpICE9PSAnOycKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gJzsnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICcnKSArCiAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcjogJyArCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICsKICAgICAgICAgICAgICAgICAgICAgICAgJzsgJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyBSb3RhdGlvbiBhcyBzdHJpbmcKICAgICAgICAgICAgY2FzZSAncm90YXRlJzoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9taXNhdGlvbnNba2V5XSA9IHJvdGF0ZUZyb21TdHJpbmcodmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgICAgIGN1c3RvbWlzYXRpb25zW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyBSZW1vdmUgYXJpYS1oaWRkZW4KICAgICAgICAgICAgY2FzZSAnYXJpYUhpZGRlbic6CiAgICAgICAgICAgIGNhc2UgJ2FyaWEtaGlkZGVuJzoKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdHJ1ZSAmJiB2YWx1ZSAhPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbXBvbmVudFByb3BzWydhcmlhLWhpZGRlbiddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAoa2V5LnNsaWNlKDAsIDMpID09PSAnb246JykgewogICAgICAgICAgICAgICAgICAgIC8vIFN2ZWx0ZSBldmVudAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gQ29weSBtaXNzaW5nIHByb3BlcnR5IGlmIGl0IGRvZXMgbm90IGV4aXN0IGluIGN1c3RvbWlzYXRpb25zCiAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEV4dGVuZGVkSWNvbkN1c3RvbWlzYXRpb25zW2tleV0gPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFByb3BzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAvLyBHZW5lcmF0ZSBpY29uCiAgICBjb25zdCBpdGVtID0gaWNvblRvU1ZHKGljb24sIGN1c3RvbWlzYXRpb25zKTsKICAgIGNvbnN0IHJlbmRlckF0dHJpYnMgPSBpdGVtLmF0dHJpYnV0ZXM7CiAgICAvLyBJbmxpbmUgZGlzcGxheQogICAgaWYgKGN1c3RvbWlzYXRpb25zLmlubGluZSkgewogICAgICAgIC8vIFN0eWxlIG92ZXJyaWRlcyBpdAogICAgICAgIHN0eWxlID0gJ3ZlcnRpY2FsLWFsaWduOiAtMC4xMjVlbTsgJyArIHN0eWxlOwogICAgfQogICAgaWYgKG1vZGUgPT09ICdzdmcnKSB7CiAgICAgICAgLy8gQWRkIGljb24gc3R1ZmYKICAgICAgICBPYmplY3QuYXNzaWduKGNvbXBvbmVudFByb3BzLCByZW5kZXJBdHRyaWJzKTsKICAgICAgICAvLyBTdHlsZQogICAgICAgIGlmIChzdHlsZSAhPT0gJycpIHsKICAgICAgICAgICAgY29tcG9uZW50UHJvcHMuc3R5bGUgPSBzdHlsZTsKICAgICAgICB9CiAgICAgICAgLy8gQ291bnRlciBmb3IgaWRzIGJhc2VkIG9uICJpZCIgcHJvcGVydHkgdG8gcmVuZGVyIGljb25zIGNvbnNpc3RlbnRseSBvbiBzZXJ2ZXIgYW5kIGNsaWVudAogICAgICAgIGxldCBsb2NhbENvdW50ZXIgPSAwOwogICAgICAgIGxldCBpZCA9IHByb3BzLmlkOwogICAgICAgIGlmICh0eXBlb2YgaWQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIC8vIENvbnZlcnQgJy0nIHRvICdfJyB0byBhdm9pZCBlcnJvcnMgaW4gYW5pbWF0aW9ucwogICAgICAgICAgICBpZCA9IGlkLnJlcGxhY2UoLy0vZywgJ18nKTsKICAgICAgICB9CiAgICAgICAgLy8gR2VuZXJhdGUgSFRNTAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHN2ZzogdHJ1ZSwKICAgICAgICAgICAgYXR0cmlidXRlczogY29tcG9uZW50UHJvcHMsCiAgICAgICAgICAgIGJvZHk6IHJlcGxhY2VJRHMoaXRlbS5ib2R5LCBpZCA/ICgpID0+IGlkICsgJ0lEJyArIGxvY2FsQ291bnRlcisrIDogJ2ljb25pZnlTdmVsdGUnKSwKICAgICAgICB9OwogICAgfQogICAgLy8gUmVuZGVyIDxzcGFuPiB3aXRoIHN0eWxlCiAgICBjb25zdCB7IGJvZHksIHdpZHRoLCBoZWlnaHQgfSA9IGljb247CiAgICBjb25zdCB1c2VNYXNrID0gbW9kZSA9PT0gJ21hc2snIHx8CiAgICAgICAgKG1vZGUgPT09ICdiZycgPyBmYWxzZSA6IGJvZHkuaW5kZXhPZignY3VycmVudENvbG9yJykgIT09IC0xKTsKICAgIC8vIEdlbmVyYXRlIFNWRwogICAgY29uc3QgaHRtbCA9IGljb25Ub0hUTUwoYm9keSwgewogICAgICAgIC4uLnJlbmRlckF0dHJpYnMsCiAgICAgICAgd2lkdGg6IHdpZHRoICsgJycsCiAgICAgICAgaGVpZ2h0OiBoZWlnaHQgKyAnJywKICAgIH0pOwogICAgLy8gR2VuZXJhdGUgc3R5bGUKICAgIGNvbnN0IHVybCA9IHN2Z1RvVVJMKGh0bWwpOwogICAgY29uc3Qgc3R5bGVzID0gewogICAgICAgICctLXN2Zyc6IHVybCwKICAgIH07CiAgICBjb25zdCBzaXplID0gKHByb3ApID0+IHsKICAgICAgICBjb25zdCB2YWx1ZSA9IHJlbmRlckF0dHJpYnNbcHJvcF07CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHN0eWxlc1twcm9wXSA9IGZpeFNpemUodmFsdWUpOwogICAgICAgIH0KICAgIH07CiAgICBzaXplKCd3aWR0aCcpOwogICAgc2l6ZSgnaGVpZ2h0Jyk7CiAgICBPYmplY3QuYXNzaWduKHN0eWxlcywgY29tbW9uUHJvcHMsIHVzZU1hc2sgPyBtb25vdG9uZVByb3BzIDogY29sb3JlZFByb3BzKTsKICAgIGxldCBjdXN0b21TdHlsZSA9ICcnOwogICAgZm9yIChjb25zdCBrZXkgaW4gc3R5bGVzKSB7CiAgICAgICAgY3VzdG9tU3R5bGUgKz0ga2V5ICsgJzogJyArIHN0eWxlc1trZXldICsgJzsnOwogICAgfQogICAgY29tcG9uZW50UHJvcHMuc3R5bGUgPSBjdXN0b21TdHlsZSArIHN0eWxlOwogICAgcmV0dXJuIHsKICAgICAgICBzdmc6IGZhbHNlLAogICAgICAgIGF0dHJpYnV0ZXM6IGNvbXBvbmVudFByb3BzLAogICAgfTsKfQovKioKICogSW5pdGlhbGlzZSBzdHVmZgogKi8KLy8gRW5hYmxlIHNob3J0IG5hbWVzCmFsbG93U2ltcGxlTmFtZXModHJ1ZSk7Ci8vIFNldCBBUEkgbW9kdWxlCnNldEFQSU1vZHVsZSgnJywgZmV0Y2hBUElNb2R1bGUpOwovKioKICogQnJvd3NlciBzdHVmZgogKi8KaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIC8vIFNldCBjYWNoZSBhbmQgbG9hZCBleGlzdGluZyBjYWNoZQogICAgaW5pdEJyb3dzZXJTdG9yYWdlKCk7CiAgICBjb25zdCBfd2luZG93ID0gd2luZG93OwogICAgLy8gTG9hZCBpY29ucyBmcm9tIGdsb2JhbCAiSWNvbmlmeVByZWxvYWQiCiAgICBpZiAoX3dpbmRvdy5JY29uaWZ5UHJlbG9hZCAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc3QgcHJlbG9hZCA9IF93aW5kb3cuSWNvbmlmeVByZWxvYWQ7CiAgICAgICAgY29uc3QgZXJyID0gJ0ludmFsaWQgSWNvbmlmeVByZWxvYWQgc3ludGF4Lic7CiAgICAgICAgaWYgKHR5cGVvZiBwcmVsb2FkID09PSAnb2JqZWN0JyAmJiBwcmVsb2FkICE9PSBudWxsKSB7CiAgICAgICAgICAgIChwcmVsb2FkIGluc3RhbmNlb2YgQXJyYXkgPyBwcmVsb2FkIDogW3ByZWxvYWRdKS5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBpdGVtIGlzIGFuIG9iamVjdCBhbmQgbm90IG51bGwvYXJyYXkKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaXRlbSAhPT0gJ29iamVjdCcgfHwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9PT0gbnVsbCB8fAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtIGluc3RhbmNlb2YgQXJyYXkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yICdpY29ucycgYW5kICdwcmVmaXgnCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBpdGVtLmljb25zICE9PSAnb2JqZWN0JyB8fAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaXRlbS5wcmVmaXggIT09ICdzdHJpbmcnIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBpY29uIHNldAogICAgICAgICAgICAgICAgICAgICAgICAhYWRkQ29sbGVjdGlvbihpdGVtKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIC8vIFNldCBBUEkgZnJvbSBnbG9iYWwgIkljb25pZnlQcm92aWRlcnMiCiAgICBpZiAoX3dpbmRvdy5JY29uaWZ5UHJvdmlkZXJzICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zdCBwcm92aWRlcnMgPSBfd2luZG93Lkljb25pZnlQcm92aWRlcnM7CiAgICAgICAgaWYgKHR5cGVvZiBwcm92aWRlcnMgPT09ICdvYmplY3QnICYmIHByb3ZpZGVycyAhPT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gcHJvdmlkZXJzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSAnSWNvbmlmeVByb3ZpZGVyc1snICsga2V5ICsgJ10gaXMgaW52YWxpZC4nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3ZpZGVyc1trZXldOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICF2YWx1ZSB8fAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5yZXNvdXJjZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhZGRBUElQcm92aWRlcihrZXksIHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KLyoqCiAqIENoZWNrIGlmIGNvbXBvbmVudCBuZWVkcyB0byBiZSB1cGRhdGVkCiAqLwpmdW5jdGlvbiBjaGVja0ljb25TdGF0ZShpY29uLCBzdGF0ZSwgbW91bnRlZCwgY2FsbGJhY2ssIG9ubG9hZCkgewogICAgLy8gQWJvcnQgbG9hZGluZyBpY29uCiAgICBmdW5jdGlvbiBhYm9ydExvYWRpbmcoKSB7CiAgICAgICAgaWYgKHN0YXRlLmxvYWRpbmcpIHsKICAgICAgICAgICAgc3RhdGUubG9hZGluZy5hYm9ydCgpOwogICAgICAgICAgICBzdGF0ZS5sb2FkaW5nID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICAvLyBJY29uIGlzIGFuIG9iamVjdAogICAgaWYgKHR5cGVvZiBpY29uID09PSAnb2JqZWN0JyAmJgogICAgICAgIGljb24gIT09IG51bGwgJiYKICAgICAgICB0eXBlb2YgaWNvbi5ib2R5ID09PSAnc3RyaW5nJykgewogICAgICAgIC8vIFN0b3AgbG9hZGluZwogICAgICAgIHN0YXRlLm5hbWUgPSAnJzsKICAgICAgICBhYm9ydExvYWRpbmcoKTsKICAgICAgICByZXR1cm4geyBkYXRhOiB7IC4uLmRlZmF1bHRJY29uUHJvcHMsIC4uLmljb24gfSB9OwogICAgfQogICAgLy8gSW52YWxpZCBpY29uPwogICAgbGV0IGljb25OYW1lOwogICAgaWYgKHR5cGVvZiBpY29uICE9PSAnc3RyaW5nJyB8fAogICAgICAgIChpY29uTmFtZSA9IHN0cmluZ1RvSWNvbihpY29uLCBmYWxzZSwgdHJ1ZSkpID09PSBudWxsKSB7CiAgICAgICAgYWJvcnRMb2FkaW5nKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvLyBMb2FkIGljb24KICAgIGNvbnN0IGRhdGEgPSBnZXRJY29uRGF0YShpY29uTmFtZSk7CiAgICBpZiAoIWRhdGEpIHsKICAgICAgICAvLyBJY29uIGRhdGEgaXMgbm90IGF2YWlsYWJsZQogICAgICAgIC8vIERvIG5vdCBsb2FkIGljb24gdW50aWwgY29tcG9uZW50IGlzIG1vdW50ZWQKICAgICAgICBpZiAobW91bnRlZCAmJiAoIXN0YXRlLmxvYWRpbmcgfHwgc3RhdGUubG9hZGluZy5uYW1lICE9PSBpY29uKSkgewogICAgICAgICAgICAvLyBOZXcgaWNvbiB0byBsb2FkCiAgICAgICAgICAgIGFib3J0TG9hZGluZygpOwogICAgICAgICAgICBzdGF0ZS5uYW1lID0gJyc7CiAgICAgICAgICAgIHN0YXRlLmxvYWRpbmcgPSB7CiAgICAgICAgICAgICAgICBuYW1lOiBpY29uLAogICAgICAgICAgICAgICAgYWJvcnQ6IGxvYWRJY29ucyhbaWNvbk5hbWVdLCBjYWxsYmFjayksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLy8gSWNvbiBkYXRhIGlzIGF2YWlsYWJsZQogICAgYWJvcnRMb2FkaW5nKCk7CiAgICBpZiAoc3RhdGUubmFtZSAhPT0gaWNvbikgewogICAgICAgIHN0YXRlLm5hbWUgPSBpY29uOwogICAgICAgIGlmIChvbmxvYWQgJiYgIXN0YXRlLmRlc3Ryb3llZCkgewogICAgICAgICAgICBvbmxvYWQoaWNvbik7CiAgICAgICAgfQogICAgfQogICAgLy8gQWRkIGNsYXNzZXMKICAgIGNvbnN0IGNsYXNzZXMgPSBbJ2ljb25pZnknXTsKICAgIGlmIChpY29uTmFtZS5wcmVmaXggIT09ICcnKSB7CiAgICAgICAgY2xhc3Nlcy5wdXNoKCdpY29uaWZ5LS0nICsgaWNvbk5hbWUucHJlZml4KTsKICAgIH0KICAgIGlmIChpY29uTmFtZS5wcm92aWRlciAhPT0gJycpIHsKICAgICAgICBjbGFzc2VzLnB1c2goJ2ljb25pZnktLScgKyBpY29uTmFtZS5wcm92aWRlcik7CiAgICB9CiAgICByZXR1cm4geyBkYXRhLCBjbGFzc2VzIH07Cn0KLyoqCiAqIEdlbmVyYXRlIGljb24KICovCmZ1bmN0aW9uIGdlbmVyYXRlSWNvbihpY29uLCBwcm9wcykgewogICAgcmV0dXJuIGljb24KICAgICAgICA/IHJlbmRlcih7CiAgICAgICAgICAgIC4uLmRlZmF1bHRJY29uUHJvcHMsCiAgICAgICAgICAgIC4uLmljb24sCiAgICAgICAgfSwgcHJvcHMpCiAgICAgICAgOiBudWxsOwp9CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9AaWNvbmlmeStzdmVsdGVAMy4xLjRfc3ZlbHRlQDQuMi4wL25vZGVfbW9kdWxlcy9AaWNvbmlmeS9zdmVsdGUvZGlzdC9JY29uLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrJDYoY3R4KSB7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoKCWZ1bmN0aW9uIHNlbGVjdF9ibG9ja190eXBlKGN0eCwgZGlydHkpIHsKCQlpZiAoLypkYXRhKi8gY3R4WzBdLnN2ZykgcmV0dXJuIGNyZWF0ZV9pZl9ibG9ja18xJDQ7CgkJcmV0dXJuIGNyZWF0ZV9lbHNlX2Jsb2NrJDE7Cgl9CgoJbGV0IGN1cnJlbnRfYmxvY2tfdHlwZSA9IHNlbGVjdF9ibG9ja190eXBlKGN0eCk7CglsZXQgaWZfYmxvY2sgPSBjdXJyZW50X2Jsb2NrX3R5cGUoY3R4KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWlmX2Jsb2NrLmMoKTsKCQkJaWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaWZfYmxvY2subSh0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGlmX2Jsb2NrX2FuY2hvciwgYW5jaG9yKTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlpZiAoY3VycmVudF9ibG9ja190eXBlID09PSAoY3VycmVudF9ibG9ja190eXBlID0gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4KSkgJiYgaWZfYmxvY2spIHsKCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgkJCX0gZWxzZSB7CgkJCQlpZl9ibG9jay5kKDEpOwoJCQkJaWZfYmxvY2sgPSBjdXJyZW50X2Jsb2NrX3R5cGUoY3R4KTsKCgkJCQlpZiAoaWZfYmxvY2spIHsKCQkJCQlpZl9ibG9jay5jKCk7CgkJCQkJaWZfYmxvY2subShpZl9ibG9ja19hbmNob3IucGFyZW50Tm9kZSwgaWZfYmxvY2tfYW5jaG9yKTsKCQkJCX0KCQkJfQoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGlmX2Jsb2NrX2FuY2hvcik7CgkJCX0KCgkJCWlmX2Jsb2NrLmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMTEzOjEpIHs6ZWxzZX0KZnVuY3Rpb24gY3JlYXRlX2Vsc2VfYmxvY2skMShjdHgpIHsKCWxldCBzcGFuOwoJbGV0IHNwYW5fbGV2ZWxzID0gWy8qZGF0YSovIGN0eFswXS5hdHRyaWJ1dGVzXTsKCWxldCBzcGFuX2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IHNwYW5fbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJc3Bhbl9kYXRhID0gYXNzaWduKHNwYW5fZGF0YSwgc3Bhbl9sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJc3BhbiA9IGVsZW1lbnQoInNwYW4iKTsKCQkJc2V0X2F0dHJpYnV0ZXMoc3Bhbiwgc3Bhbl9kYXRhKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgc3BhbiwgYW5jaG9yKTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlzZXRfYXR0cmlidXRlcyhzcGFuLCBzcGFuX2RhdGEgPSBnZXRfc3ByZWFkX3VwZGF0ZShzcGFuX2xldmVscywgW2RpcnR5ICYgLypkYXRhKi8gMSAmJiAvKmRhdGEqLyBjdHhbMF0uYXR0cmlidXRlc10pKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChzcGFuKTsKCQkJfQoJCX0KCX07Cn0KCi8vICgxMDk6MSkgeyNpZiBkYXRhLnN2Z30KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzEkNChjdHgpIHsKCWxldCBzdmc7CglsZXQgcmF3X3ZhbHVlID0gLypkYXRhKi8gY3R4WzBdLmJvZHkgKyAiIjsKCWxldCBzdmdfbGV2ZWxzID0gWy8qZGF0YSovIGN0eFswXS5hdHRyaWJ1dGVzXTsKCWxldCBzdmdfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgc3ZnX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCXN2Z19kYXRhID0gYXNzaWduKHN2Z19kYXRhLCBzdmdfbGV2ZWxzW2ldKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCXN2ZyA9IHN2Z19lbGVtZW50KCJzdmciKTsKCQkJc2V0X3N2Z19hdHRyaWJ1dGVzKHN2Zywgc3ZnX2RhdGEpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBzdmcsIGFuY2hvcik7CgkJCXN2Zy5pbm5lckhUTUwgPSByYXdfdmFsdWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJaWYgKGRpcnR5ICYgLypkYXRhKi8gMSAmJiByYXdfdmFsdWUgIT09IChyYXdfdmFsdWUgPSAvKmRhdGEqLyBjdHhbMF0uYm9keSArICIiKSkgc3ZnLmlubmVySFRNTCA9IHJhd192YWx1ZTsJCQlzZXRfc3ZnX2F0dHJpYnV0ZXMoc3ZnLCBzdmdfZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKHN2Z19sZXZlbHMsIFtkaXJ0eSAmIC8qZGF0YSovIDEgJiYgLypkYXRhKi8gY3R4WzBdLmF0dHJpYnV0ZXNdKSk7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goc3ZnKTsKCQkJfQoJCX0KCX07Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCRmKGN0eCkgewoJbGV0IGlmX2Jsb2NrX2FuY2hvcjsKCWxldCBpZl9ibG9jayA9IC8qZGF0YSovIGN0eFswXSAmJiBjcmVhdGVfaWZfYmxvY2skNihjdHgpOwoKCXJldHVybiB7CgkJYygpIHsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5jKCk7CgkJCWlmX2Jsb2NrX2FuY2hvciA9IGVtcHR5KCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2subSh0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGlmX2Jsb2NrX2FuY2hvciwgYW5jaG9yKTsKCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmICgvKmRhdGEqLyBjdHhbMF0pIHsKCQkJCWlmIChpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrID0gY3JlYXRlX2lmX2Jsb2NrJDYoY3R4KTsKCQkJCQlpZl9ibG9jay5jKCk7CgkJCQkJaWZfYmxvY2subShpZl9ibG9ja19hbmNob3IucGFyZW50Tm9kZSwgaWZfYmxvY2tfYW5jaG9yKTsKCQkJCX0KCQkJfSBlbHNlIGlmIChpZl9ibG9jaykgewoJCQkJaWZfYmxvY2suZCgxKTsKCQkJCWlmX2Jsb2NrID0gbnVsbDsKCQkJfQoJCX0sCgkJaTogbm9vcCQ0LAoJCW86IG5vb3AkNCwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goaWZfYmxvY2tfYW5jaG9yKTsKCQkJfQoKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkZigkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJY29uc3Qgc3RhdGUgPSB7CgkJLy8gTGFzdCBpY29uIG5hbWUKCQluYW1lOiAnJywKCQkvLyBMb2FkaW5nIHN0YXR1cwoJCWxvYWRpbmc6IG51bGwsCgkJLy8gRGVzdHJveWVkIHN0YXR1cwoJCWRlc3Ryb3llZDogZmFsc2UKCX07CgoJLy8gTW91bnRlZCBzdGF0dXMKCWxldCBtb3VudGVkID0gZmFsc2U7CgoJLy8gQ2FsbGJhY2sgY291bnRlcgoJbGV0IGNvdW50ZXIgPSAwOwoKCS8vIEdlbmVyYXRlZCBkYXRhCglsZXQgZGF0YTsKCgljb25zdCBvbkxvYWQgPSBpY29uID0+IHsKCQkvLyBMZWdhY3kgb25Mb2FkIHByb3BlcnR5CgkJaWYgKHR5cGVvZiAkJHByb3BzLm9uTG9hZCA9PT0gJ2Z1bmN0aW9uJykgewoJCQkkJHByb3BzLm9uTG9hZChpY29uKTsKCQl9CgoJCS8vIG9uOmxvYWQgZXZlbnQKCQljb25zdCBkaXNwYXRjaCA9IGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcigpOwoKCQlkaXNwYXRjaCgnbG9hZCcsIHsgaWNvbiB9KTsKCX07CgoJLy8gSW5jcmVhc2UgY291bnRlciB3aGVuIGxvYWRlZCB0byBmb3JjZSByZS1jYWxjdWxhdGlvbiBvZiBkYXRhCglmdW5jdGlvbiBsb2FkZWQoKSB7CgkJJCRpbnZhbGlkYXRlKDMsIGNvdW50ZXIrKywgY291bnRlcik7Cgl9CgoJLy8gRm9yY2UgcmUtcmVuZGVyCglvbk1vdW50KCgpID0+IHsKCQkkJGludmFsaWRhdGUoMiwgbW91bnRlZCA9IHRydWUpOwoJfSk7CgoJLy8gQWJvcnQgbG9hZGluZyB3aGVuIGNvbXBvbmVudCBpcyBkZXN0cm95ZWQKCW9uRGVzdHJveSgoKSA9PiB7CgkJJCRpbnZhbGlkYXRlKDEsIHN0YXRlLmRlc3Ryb3llZCA9IHRydWUsIHN0YXRlKTsKCgkJaWYgKHN0YXRlLmxvYWRpbmcpIHsKCQkJc3RhdGUubG9hZGluZy5hYm9ydCgpOwoJCQkkJGludmFsaWRhdGUoMSwgc3RhdGUubG9hZGluZyA9IG51bGwsIHN0YXRlKTsKCQl9Cgl9KTsKCgkkJHNlbGYuJCRzZXQgPSAkJG5ld19wcm9wcyA9PiB7CgkJJCRpbnZhbGlkYXRlKDYsICQkcHJvcHMgPSBhc3NpZ24oYXNzaWduKHt9LCAkJHByb3BzKSwgZXhjbHVkZV9pbnRlcm5hbF9wcm9wcygkJG5ld19wcm9wcykpKTsKCX07CgoJJCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHsKCQl7CgkJCWNvbnN0IGljb25EYXRhID0gY2hlY2tJY29uU3RhdGUoJCRwcm9wcy5pY29uLCBzdGF0ZSwgbW91bnRlZCwgbG9hZGVkLCBvbkxvYWQpOwoJCQkkJGludmFsaWRhdGUoMCwgZGF0YSA9IGljb25EYXRhID8gZ2VuZXJhdGVJY29uKGljb25EYXRhLmRhdGEsICQkcHJvcHMpIDogbnVsbCk7CgoJCQlpZiAoZGF0YSAmJiBpY29uRGF0YS5jbGFzc2VzKSB7CgkJCQkvLyBBZGQgY2xhc3NlcwoJCQkJJCRpbnZhbGlkYXRlKAoJCQkJCTAsCgkJCQkJZGF0YS5hdHRyaWJ1dGVzWydjbGFzcyddID0gKHR5cGVvZiAkJHByb3BzWydjbGFzcyddID09PSAnc3RyaW5nJwoJCQkJCT8gJCRwcm9wc1snY2xhc3MnXSArICcgJwoJCQkJCTogJycpICsgaWNvbkRhdGEuY2xhc3Nlcy5qb2luKCcgJyksCgkJCQkJZGF0YQoJCQkJKTsKCQkJfQoJCX0KCX07CgoJJCRwcm9wcyA9IGV4Y2x1ZGVfaW50ZXJuYWxfcHJvcHMoJCRwcm9wcyk7CglyZXR1cm4gW2RhdGEsIHN0YXRlLCBtb3VudGVkLCBjb3VudGVyXTsKfQoKY2xhc3MgSWNvbiBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJGYsIGNyZWF0ZV9mcmFnbWVudCRmLCBzYWZlX25vdF9lcXVhbCwge30pOwoJfQp9Cgpjb25zdCBnZW5DU1MgPSAobGlnaHQsIGRhcmspID0+IHsKICAgIGNvbnN0IGdlbkNvbG9yVmFyaWFibGUgPSAobmFtZSwgYXJnYikgPT4gewogICAgICAgIGNvbnN0IGtlYmFiQ2FzZSA9IG5hbWUucmVwbGFjZSgvW0EtWl0vZywgKGxldHRlcikgPT4gYC0ke2xldHRlci50b0xvd2VyQ2FzZSgpfWApOwogICAgICAgIGNvbnN0IHJlZCA9IChhcmdiID4+IDE2KSAmIDI1NTsKICAgICAgICBjb25zdCBncmVlbiA9IChhcmdiID4+IDgpICYgMjU1OwogICAgICAgIGNvbnN0IGJsdWUgPSBhcmdiICYgMjU1OwogICAgICAgIHJldHVybiBgLS1tMy1zY2hlbWUtJHtrZWJhYkNhc2V9OiAke3JlZH0gJHtncmVlbn0gJHtibHVlfTtgOwogICAgfTsKICAgIGNvbnN0IGxpZ2h0Q29sb3JzID0gT2JqZWN0LmVudHJpZXMobGlnaHQpCiAgICAgICAgLm1hcCgoW25hbWUsIGFyZ2JdKSA9PiBnZW5Db2xvclZhcmlhYmxlKG5hbWUsIGFyZ2IpKQogICAgICAgIC5qb2luKCJcbiIpOwogICAgY29uc3QgZGFya0NvbG9ycyA9IE9iamVjdC5lbnRyaWVzKGRhcmspCiAgICAgICAgLm1hcCgoW25hbWUsIGFyZ2JdKSA9PiBnZW5Db2xvclZhcmlhYmxlKG5hbWUsIGFyZ2IpKQogICAgICAgIC5qb2luKCJcbiIpOwogICAgY29uc3QgY29sb3JzID0gYAo6cm9vdCB7CiAgYWNjZW50LWNvbG9yOiByZ2IodmFyKC0tbTMtc2NoZW1lLXByaW1hcnkpKTsKfQpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewogIDpyb290IHsKICAgIGNvbG9yLXNjaGVtZTogbGlnaHQ7CiAgfQogIDpyb290LCA6OmJhY2tkcm9wIHsKJHtsaWdodENvbG9yc30KICB9Cn0KQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogIDpyb290IHsKICAgIGNvbG9yLXNjaGVtZTogZGFyazsKICB9CiAgOnJvb3QsIDo6YmFja2Ryb3Agewoke2RhcmtDb2xvcnN9CiAgfQp9YDsKICAgIHJldHVybiBjb2xvcnM7Cn07CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL21pc2MvX3N0eWxpbmcuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkZShjdHgpIHsKCWxldCBtZXRhMDsKCWxldCBtZXRhMF9jb250ZW50X3ZhbHVlOwoJbGV0IG1ldGExOwoJbGV0IG1ldGExX2NvbnRlbnRfdmFsdWU7CglsZXQgdDsKCWxldCBodG1sX3RhZzsKCWxldCByYXdfdmFsdWUgPSBgPCR7IiJ9c3R5bGU+JHsvKnN0eWxpbmcqLyBjdHhbMl19PC8keyIifXN0eWxlPmAgKyAiIjsKCWxldCBodG1sX2FuY2hvcjsKCglyZXR1cm4gewoJCWMoKSB7CgkJCW1ldGEwID0gZWxlbWVudCgibWV0YSIpOwoJCQltZXRhMSA9IGVsZW1lbnQoIm1ldGEiKTsKCQkJdCA9IHNwYWNlKCk7CgkJCWh0bWxfdGFnID0gbmV3IEh0bWxUYWcoZmFsc2UpOwoJCQlodG1sX2FuY2hvciA9IGVtcHR5KCk7CgkJCWF0dHIobWV0YTAsICJuYW1lIiwgInRoZW1lLWNvbG9yIik7CgkJCWF0dHIobWV0YTAsICJjb250ZW50IiwgbWV0YTBfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdWyJwcmltYXJ5Il0pKTsKCQkJYXR0cihtZXRhMSwgIm5hbWUiLCAidGhlbWUtY29sb3IiKTsKCQkJYXR0cihtZXRhMSwgIm1lZGlhIiwgIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykiKTsKCQkJYXR0cihtZXRhMSwgImNvbnRlbnQiLCBtZXRhMV9jb250ZW50X3ZhbHVlID0gLypoZXhDb2RlKi8gY3R4WzNdKC8qZGFya1NjaGVtZSovIGN0eFsxXVsicHJpbWFyeSJdKSk7CgkJCWh0bWxfdGFnLmEgPSBodG1sX2FuY2hvcjsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJYXBwZW5kKGRvY3VtZW50LmhlYWQsIG1ldGEwKTsKCQkJYXBwZW5kKGRvY3VtZW50LmhlYWQsIG1ldGExKTsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQkJaHRtbF90YWcubShyYXdfdmFsdWUsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaHRtbF9hbmNob3IsIGFuY2hvcik7CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGlydHkgJiAvKmxpZ2h0U2NoZW1lKi8gMSAmJiBtZXRhMF9jb250ZW50X3ZhbHVlICE9PSAobWV0YTBfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdWyJwcmltYXJ5Il0pKSkgewoJCQkJYXR0cihtZXRhMCwgImNvbnRlbnQiLCBtZXRhMF9jb250ZW50X3ZhbHVlKTsKCQkJfQoKCQkJaWYgKGRpcnR5ICYgLypkYXJrU2NoZW1lKi8gMiAmJiBtZXRhMV9jb250ZW50X3ZhbHVlICE9PSAobWV0YTFfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmRhcmtTY2hlbWUqLyBjdHhbMV1bInByaW1hcnkiXSkpKSB7CgkJCQlhdHRyKG1ldGExLCAiY29udGVudCIsIG1ldGExX2NvbnRlbnRfdmFsdWUpOwoJCQl9CgoJCQlpZiAoZGlydHkgJiAvKnN0eWxpbmcqLyA0ICYmIHJhd192YWx1ZSAhPT0gKHJhd192YWx1ZSA9IGA8JHsiIn1zdHlsZT4key8qc3R5bGluZyovIGN0eFsyXX08LyR7IiJ9c3R5bGU+YCArICIiKSkgaHRtbF90YWcucChyYXdfdmFsdWUpOwoJCX0sCgkJaTogbm9vcCQ0LAoJCW86IG5vb3AkNCwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCQlkZXRhY2goaHRtbF9hbmNob3IpOwoJCQkJaHRtbF90YWcuZCgpOwoJCQl9CgoJCQlkZXRhY2gobWV0YTApOwoJCQlkZXRhY2gobWV0YTEpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJGUoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCBzdHlsaW5nOwoJbGV0IHsgbGlnaHRTY2hlbWUgfSA9ICQkcHJvcHM7CglsZXQgeyBkYXJrU2NoZW1lIH0gPSAkJHByb3BzOwoJY29uc3QgaGV4Q29kZSA9IGFyZ2IgPT4gIiMiICsgKChhcmdiICYgMTY3NzcyMTUpICsgMTY3NzcyMTYpLnRvU3RyaW5nKDE2KS5zbGljZSgxKTsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2xpZ2h0U2NoZW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgbGlnaHRTY2hlbWUgPSAkJHByb3BzLmxpZ2h0U2NoZW1lKTsKCQlpZiAoJ2RhcmtTY2hlbWUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBkYXJrU2NoZW1lID0gJCRwcm9wcy5kYXJrU2NoZW1lKTsKCX07CgoJJCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHsKCQlpZiAoJCRzZWxmLiQkLmRpcnR5ICYgLypsaWdodFNjaGVtZSwgZGFya1NjaGVtZSovIDMpIHsKCQkJJCRpbnZhbGlkYXRlKDIsIHN0eWxpbmcgPSBnZW5DU1MobGlnaHRTY2hlbWUsIGRhcmtTY2hlbWUpKTsKCQl9Cgl9OwoKCXJldHVybiBbbGlnaHRTY2hlbWUsIGRhcmtTY2hlbWUsIHN0eWxpbmcsIGhleENvZGVdOwp9CgpjbGFzcyBTdHlsaW5nIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkZSwgY3JlYXRlX2ZyYWdtZW50JGUsIHNhZmVfbm90X2VxdWFsLCB7IGxpZ2h0U2NoZW1lOiAwLCBkYXJrU2NoZW1lOiAxIH0pOwoJfQp9Cgpjb25zdCBTdHlsaW5nJDEgPSBTdHlsaW5nOwoKY29uc3Qgc3R5bGVzID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL21pc2MvU3R5bGVGcm9tU2NoZW1lLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JGQoY3R4KSB7CglsZXQgc3R5bGluZzsKCWxldCBjdXJyZW50OwoKCXN0eWxpbmcgPSBuZXcgU3R5bGluZyQxKHsKCQkJcHJvcHM6IHsKCQkJCWxpZ2h0U2NoZW1lOiAvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdLAoJCQkJZGFya1NjaGVtZTogLypkYXJrU2NoZW1lKi8gY3R4WzFdCgkJCX0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQoc3R5bGluZy4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudChzdHlsaW5nLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJY29uc3Qgc3R5bGluZ19jaGFuZ2VzID0ge307CgkJCWlmIChkaXJ0eSAmIC8qbGlnaHRTY2hlbWUqLyAxKSBzdHlsaW5nX2NoYW5nZXMubGlnaHRTY2hlbWUgPSAvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdOwoJCQlpZiAoZGlydHkgJiAvKmRhcmtTY2hlbWUqLyAyKSBzdHlsaW5nX2NoYW5nZXMuZGFya1NjaGVtZSA9IC8qZGFya1NjaGVtZSovIGN0eFsxXTsKCQkJc3R5bGluZy4kc2V0KHN0eWxpbmdfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oc3R5bGluZy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoc3R5bGluZy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChzdHlsaW5nLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJGQoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7IGxpZ2h0U2NoZW1lIH0gPSAkJHByb3BzOwoJbGV0IHsgZGFya1NjaGVtZSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2xpZ2h0U2NoZW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgbGlnaHRTY2hlbWUgPSAkJHByb3BzLmxpZ2h0U2NoZW1lKTsKCQlpZiAoJ2RhcmtTY2hlbWUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBkYXJrU2NoZW1lID0gJCRwcm9wcy5kYXJrU2NoZW1lKTsKCX07CgoJcmV0dXJuIFtsaWdodFNjaGVtZSwgZGFya1NjaGVtZV07Cn0KCmNsYXNzIFN0eWxlRnJvbVNjaGVtZSBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJGQsIGNyZWF0ZV9mcmFnbWVudCRkLCBzYWZlX25vdF9lcXVhbCwgeyBsaWdodFNjaGVtZTogMCwgZGFya1NjaGVtZTogMSB9KTsKCX0KfQoKY29uc3QgU3R5bGVGcm9tU2NoZW1lJDEgPSBTdHlsZUZyb21TY2hlbWU7Cgpjb25zdCBCdXR0b25fc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuNC9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvYnV0dG9ucy9CdXR0b24uc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkYyhjdHgpIHsKCWxldCBidXR0b247CglsZXQgZGl2OwoJbGV0IHQ7CglsZXQgYnV0dG9uX2NsYXNzX3ZhbHVlOwoJbGV0IGJ1dHRvbl9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzZdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzVdLCBudWxsKTsKCglsZXQgYnV0dG9uX2xldmVscyA9IFsKCQl7IGRpc2FibGVkOiAvKmRpc2FibGVkKi8gY3R4WzRdIH0sCgkJewoJCQljbGFzczogYnV0dG9uX2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciBtMy1mb250LWxhYmVsLWxhcmdlICIgKyAvKnR5cGUqLyBjdHhbM10gKyAiIGljb24tIiArIC8qaWNvblR5cGUqLyBjdHhbMl0KCQl9LAoJCXsKCQkJc3R5bGU6IGJ1dHRvbl9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiCgkJfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJXTsKCglsZXQgYnV0dG9uX2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGJ1dHRvbl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlidXR0b25fZGF0YSA9IGFzc2lnbihidXR0b25fZGF0YSwgYnV0dG9uX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlidXR0b24gPSBlbGVtZW50KCJidXR0b24iKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCXQgPSBzcGFjZSgpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQlhdHRyKGRpdiwgImNsYXNzIiwgImxheWVyIHN2ZWx0ZS0xbmZqY2RyIik7CgkJCXNldF9hdHRyaWJ1dGVzKGJ1dHRvbiwgYnV0dG9uX2RhdGEpOwoJCQl0b2dnbGVfY2xhc3MoYnV0dG9uLCAic3ZlbHRlLTFuZmpjZHIiLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgYnV0dG9uLCBhbmNob3IpOwoJCQlhcHBlbmQoYnV0dG9uLCBkaXYpOwoJCQlhcHBlbmQoYnV0dG9uLCB0KTsKCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWRlZmF1bHRfc2xvdC5tKGJ1dHRvbiwgbnVsbCk7CgkJCX0KCgkJCWlmIChidXR0b24uYXV0b2ZvY3VzKSBidXR0b24uZm9jdXMoKTsKCQkJY3VycmVudCA9IHRydWU7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uLCAiY2xpY2siLCBzdG9wX3Byb3BhZ2F0aW9uKC8qY2xpY2tfaGFuZGxlciovIGN0eFs3XSkpOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWlmIChkZWZhdWx0X3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyAzMikpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlkZWZhdWx0X3Nsb3QsCgkJCQkJCWRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbNV0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs1XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzVdLCBkaXJ0eSwgbnVsbCksCgkJCQkJCW51bGwKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhidXR0b24sIGJ1dHRvbl9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoYnV0dG9uX2xldmVscywgWwoJCQkJKCFjdXJyZW50IHx8IGRpcnR5ICYgLypkaXNhYmxlZCovIDE2KSAmJiB7IGRpc2FibGVkOiAvKmRpc2FibGVkKi8gY3R4WzRdIH0sCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKnR5cGUsIGljb25UeXBlKi8gMTIgJiYgYnV0dG9uX2NsYXNzX3ZhbHVlICE9PSAoYnV0dG9uX2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciBtMy1mb250LWxhYmVsLWxhcmdlICIgKyAvKnR5cGUqLyBjdHhbM10gKyAiIGljb24tIiArIC8qaWNvblR5cGUqLyBjdHhbMl0pKSAmJiB7IGNsYXNzOiBidXR0b25fY2xhc3NfdmFsdWUgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgYnV0dG9uX3N0eWxlX3ZhbHVlICE9PSAoYnV0dG9uX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIpKSAmJiB7IHN0eWxlOiBidXR0b25fc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhidXR0b24sICJzdmVsdGUtMW5mamNkciIsIHRydWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChidXR0b24pOwoJCQl9CgoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuZChkZXRhY2hpbmcpOwoJCQltb3VudGVkID0gZmFsc2U7CgkJCWRpc3Bvc2UoKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSRjKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyAkJHNsb3RzOiBzbG90cyA9IHt9LCAkJHNjb3BlIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzcGxheSA9ICJpbmxpbmUtZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IGljb25UeXBlID0gIm5vbmUiIH0gPSAkJHByb3BzOwoJbGV0IHsgdHlwZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc2FibGVkID0gZmFsc2UgfSA9ICQkcHJvcHM7CgoJZnVuY3Rpb24gY2xpY2tfaGFuZGxlcihldmVudCkgewoJCWJ1YmJsZS5jYWxsKHRoaXMsICQkc2VsZiwgZXZlbnQpOwoJfQoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZGlzcGxheScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGRpc3BsYXkgPSAkJHByb3BzLmRpc3BsYXkpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJCWlmICgnaWNvblR5cGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCBpY29uVHlwZSA9ICQkcHJvcHMuaWNvblR5cGUpOwoJCWlmICgndHlwZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDMsIHR5cGUgPSAkJHByb3BzLnR5cGUpOwoJCWlmICgnZGlzYWJsZWQnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg0LCBkaXNhYmxlZCA9ICQkcHJvcHMuZGlzYWJsZWQpOwoJCWlmICgnJCRzY29wZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDUsICQkc2NvcGUgPSAkJHByb3BzLiQkc2NvcGUpOwoJfTsKCglyZXR1cm4gW2Rpc3BsYXksIGV4dHJhT3B0aW9ucywgaWNvblR5cGUsIHR5cGUsIGRpc2FibGVkLCAkJHNjb3BlLCBzbG90cywgY2xpY2tfaGFuZGxlcl07Cn0KCmNsYXNzIEJ1dHRvbiBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSRjLCBjcmVhdGVfZnJhZ21lbnQkYywgc2FmZV9ub3RfZXF1YWwsIHsKCQkJZGlzcGxheTogMCwKCQkJZXh0cmFPcHRpb25zOiAxLAoJCQlpY29uVHlwZTogMiwKCQkJdHlwZTogMywKCQkJZGlzYWJsZWQ6IDQKCQl9KTsKCX0KfQoKY29uc3QgQnV0dG9uJDEgPSBCdXR0b247Cgpjb25zdCBDYXJkX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2NvbnRhaW5lcnMvQ2FyZC5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCRiKGN0eCkgewoJbGV0IGRpdjsKCWxldCBkaXZfY2xhc3NfdmFsdWU7CglsZXQgZGl2X3N0eWxlX3ZhbHVlOwoJbGV0IGN1cnJlbnQ7Cgljb25zdCBkZWZhdWx0X3Nsb3RfdGVtcGxhdGUgPSAvKiNzbG90cyovIGN0eFs0XS5kZWZhdWx0OwoJY29uc3QgZGVmYXVsdF9zbG90ID0gY3JlYXRlX3Nsb3QoZGVmYXVsdF9zbG90X3RlbXBsYXRlLCBjdHgsIC8qJCRzY29wZSovIGN0eFszXSwgbnVsbCk7CgoJbGV0IGRpdl9sZXZlbHMgPSBbCgkJewoJCQljbGFzczogZGl2X2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciB0eXBlLSIgKyAvKnR5cGUqLyBjdHhbMl0KCQl9LAoJCXsKCQkJc3R5bGU6IGRpdl9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiCgkJfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJXTsKCglsZXQgZGl2X2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGRpdl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlkaXZfZGF0YSA9IGFzc2lnbihkaXZfZGF0YSwgZGl2X2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJaWYgKGRlZmF1bHRfc2xvdCkgZGVmYXVsdF9zbG90LmMoKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2LCBkaXZfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYsICJzdmVsdGUtY3pyNTJkIiwgdHJ1ZSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWRlZmF1bHRfc2xvdC5tKGRpdiwgbnVsbCk7CgkJCX0KCgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJaWYgKGRlZmF1bHRfc2xvdC5wICYmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJCRzY29wZSovIDgpKSB7CgkJCQkJdXBkYXRlX3Nsb3RfYmFzZSgKCQkJCQkJZGVmYXVsdF9zbG90LAoJCQkJCQlkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsCgkJCQkJCWN0eCwKCQkJCQkJLyokJHNjb3BlKi8gY3R4WzNdLAoJCQkJCQkhY3VycmVudAoJCQkJCQk/IGdldF9hbGxfZGlydHlfZnJvbV9zY29wZSgvKiQkc2NvcGUqLyBjdHhbM10pCgkJCQkJCTogZ2V0X3Nsb3RfY2hhbmdlcyhkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIC8qJCRzY29wZSovIGN0eFszXSwgZGlydHksIG51bGwpLAoJCQkJCQludWxsCgkJCQkJKTsKCQkJCX0KCQkJfQoKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2LCBkaXZfZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKGRpdl9sZXZlbHMsIFsKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qdHlwZSovIDQgJiYgZGl2X2NsYXNzX3ZhbHVlICE9PSAoZGl2X2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciB0eXBlLSIgKyAvKnR5cGUqLyBjdHhbMl0pKSAmJiB7IGNsYXNzOiBkaXZfY2xhc3NfdmFsdWUgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgZGl2X3N0eWxlX3ZhbHVlICE9PSAoZGl2X3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIpKSAmJiB7IHN0eWxlOiBkaXZfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaXYsICJzdmVsdGUtY3pyNTJkIiwgdHJ1ZSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChkZWZhdWx0X3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkYigkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc3BsYXkgPSAiZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IHR5cGUgfSA9ICQkcHJvcHM7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCd0eXBlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgdHlwZSA9ICQkcHJvcHMudHlwZSk7CgkJaWYgKCckJHNjb3BlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMywgJCRzY29wZSA9ICQkcHJvcHMuJCRzY29wZSk7Cgl9OwoKCXJldHVybiBbZGlzcGxheSwgZXh0cmFPcHRpb25zLCB0eXBlLCAkJHNjb3BlLCBzbG90c107Cn0KCmNsYXNzIENhcmQgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewoJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCXN1cGVyKCk7CgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSRiLCBjcmVhdGVfZnJhZ21lbnQkYiwgc2FmZV9ub3RfZXF1YWwsIHsgZGlzcGxheTogMCwgZXh0cmFPcHRpb25zOiAxLCB0eXBlOiAyIH0pOwoJfQp9Cgpjb25zdCBDYXJkJDEgPSBDYXJkOwoKY29uc3QgRGlhbG9nX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2NvbnRhaW5lcnMvRGlhbG9nLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwpjb25zdCBnZXRfYnV0dG9uc19zbG90X2NoYW5nZXMgPSBkaXJ0eSA9PiAoe30pOwpjb25zdCBnZXRfYnV0dG9uc19zbG90X2NvbnRleHQgPSBjdHggPT4gKHt9KTsKCi8vICg0NDo0KSB7I2lmIGljb259CmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9jayQ1KGN0eCkgewoJbGV0IGljb25fMTsKCWxldCBjdXJyZW50OwoJaWNvbl8xID0gbmV3IEljb24oeyBwcm9wczogeyBpY29uOiAvKmljb24qLyBjdHhbM10gfSB9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQoaWNvbl8xLiQkLmZyYWdtZW50KTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJbW91bnRfY29tcG9uZW50KGljb25fMSwgdGFyZ2V0LCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBpY29uXzFfY2hhbmdlcyA9IHt9OwoJCQlpZiAoZGlydHkgJiAvKmljb24qLyA4KSBpY29uXzFfY2hhbmdlcy5pY29uID0gLyppY29uKi8gY3R4WzNdOwoJCQlpY29uXzEuJHNldChpY29uXzFfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbl8xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uXzEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbl8xLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCRhKGN0eCkgewoJbGV0IGRpYWxvZ18xOwoJbGV0IGRpdjI7CglsZXQgdDA7CglsZXQgcDsKCWxldCB0MTsKCWxldCB0MjsKCWxldCBkaXYwOwoJbGV0IHQzOwoJbGV0IGRpdjE7CglsZXQgZGlhbG9nXzFfc3R5bGVfdmFsdWU7CglsZXQgY3VycmVudDsKCWxldCBtb3VudGVkOwoJbGV0IGRpc3Bvc2U7CglsZXQgaWZfYmxvY2sgPSAvKmljb24qLyBjdHhbM10gJiYgY3JlYXRlX2lmX2Jsb2NrJDUoY3R4KTsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzEwXS5kZWZhdWx0OwoJY29uc3QgZGVmYXVsdF9zbG90ID0gY3JlYXRlX3Nsb3QoZGVmYXVsdF9zbG90X3RlbXBsYXRlLCBjdHgsIC8qJCRzY29wZSovIGN0eFs5XSwgbnVsbCk7Cgljb25zdCBidXR0b25zX3Nsb3RfdGVtcGxhdGUgPSAvKiNzbG90cyovIGN0eFsxMF0uYnV0dG9uczsKCWNvbnN0IGJ1dHRvbnNfc2xvdCA9IGNyZWF0ZV9zbG90KGJ1dHRvbnNfc2xvdF90ZW1wbGF0ZSwgY3R4LCAvKiQkc2NvcGUqLyBjdHhbOV0sIGdldF9idXR0b25zX3Nsb3RfY29udGV4dCk7CgoJbGV0IGRpYWxvZ18xX2xldmVscyA9IFsKCQl7CgkJCXN0eWxlOiBkaWFsb2dfMV9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzFdICsgIjsiCgkJfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsyXQoJXTsKCglsZXQgZGlhbG9nX2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGRpYWxvZ18xX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWRpYWxvZ19kYXRhID0gYXNzaWduKGRpYWxvZ19kYXRhLCBkaWFsb2dfMV9sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJZGlhbG9nXzEgPSBlbGVtZW50KCJkaWFsb2ciKTsKCQkJZGl2MiA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmMoKTsKCQkJdDAgPSBzcGFjZSgpOwoJCQlwID0gZWxlbWVudCgicCIpOwoJCQl0MSA9IHRleHQoLypoZWFkbGluZSovIGN0eFs0XSk7CgkJCXQyID0gc3BhY2UoKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJaWYgKGJ1dHRvbnNfc2xvdCkgYnV0dG9uc19zbG90LmMoKTsKCQkJYXR0cihwLCAiY2xhc3MiLCAiaGVhZGxpbmUgbTMtZm9udC1oZWFkbGluZS1zbWFsbCBzdmVsdGUtYnVmdnZlIik7CgkJCXRvZ2dsZV9jbGFzcyhwLCAiY2VudGVyIiwgLyppY29uKi8gY3R4WzNdKTsKCQkJYXR0cihkaXYwLCAiY2xhc3MiLCAiY29udGVudCBtMy1mb250LWJvZHktbWVkaXVtIHN2ZWx0ZS1idWZ2dmUiKTsKCQkJYXR0cihkaXYxLCAiY2xhc3MiLCAiYnV0dG9ucyBzdmVsdGUtYnVmdnZlIik7CgkJCWF0dHIoZGl2MiwgImNsYXNzIiwgIm0zLWNvbnRhaW5lciBzdmVsdGUtYnVmdnZlIik7CgkJCXNldF9hdHRyaWJ1dGVzKGRpYWxvZ18xLCBkaWFsb2dfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhkaWFsb2dfMSwgInN2ZWx0ZS1idWZ2dmUiLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGlhbG9nXzEsIGFuY2hvcik7CgkJCWFwcGVuZChkaWFsb2dfMSwgZGl2Mik7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2subShkaXYyLCBudWxsKTsKCQkJYXBwZW5kKGRpdjIsIHQwKTsKCQkJYXBwZW5kKGRpdjIsIHApOwoJCQlhcHBlbmQocCwgdDEpOwoJCQlhcHBlbmQoZGl2MiwgdDIpOwoJCQlhcHBlbmQoZGl2MiwgZGl2MCk7CgoJCQlpZiAoZGVmYXVsdF9zbG90KSB7CgkJCQlkZWZhdWx0X3Nsb3QubShkaXYwLCBudWxsKTsKCQkJfQoKCQkJYXBwZW5kKGRpdjIsIHQzKTsKCQkJYXBwZW5kKGRpdjIsIGRpdjEpOwoKCQkJaWYgKGJ1dHRvbnNfc2xvdCkgewoJCQkJYnV0dG9uc19zbG90Lm0oZGl2MSwgbnVsbCk7CgkJCX0KCgkJCS8qZGlhbG9nXzFfYmluZGluZyovIGN0eFsxM10oZGlhbG9nXzEpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCgkJCWlmICghbW91bnRlZCkgewoJCQkJZGlzcG9zZSA9IFsKCQkJCQlsaXN0ZW4oZGlhbG9nXzEsICJjYW5jZWwiLCAvKmNhbmNlbF9oYW5kbGVyKi8gY3R4WzExXSksCgkJCQkJbGlzdGVuKGRpYWxvZ18xLCAiY2xpY2siLCBzZWxmJDEoLypjbGlja19oYW5kbGVyKi8gY3R4WzEyXSkpCgkJCQldOwoKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoLyppY29uKi8gY3R4WzNdKSB7CgkJCQlpZiAoaWZfYmxvY2spIHsKCQkJCQlpZl9ibG9jay5wKGN0eCwgZGlydHkpOwoKCQkJCQlpZiAoZGlydHkgJiAvKmljb24qLyA4KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sgPSBjcmVhdGVfaWZfYmxvY2skNShjdHgpOwoJCQkJCWlmX2Jsb2NrLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrLCAxKTsKCQkJCQlpZl9ibG9jay5tKGRpdjIsIHQwKTsKCQkJCX0KCQkJfSBlbHNlIGlmIChpZl9ibG9jaykgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2ssIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jayA9IG51bGw7CgkJCQl9KTsKCgkJCQljaGVja19vdXRyb3MoKTsKCQkJfQoKCQkJaWYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLypoZWFkbGluZSovIDE2KSBzZXRfZGF0YSh0MSwgLypoZWFkbGluZSovIGN0eFs0XSk7CgoJCQlpZiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmljb24qLyA4KSB7CgkJCQl0b2dnbGVfY2xhc3MocCwgImNlbnRlciIsIC8qaWNvbiovIGN0eFszXSk7CgkJCX0KCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWlmIChkZWZhdWx0X3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyA1MTIpKSB7CgkJCQkJdXBkYXRlX3Nsb3RfYmFzZSgKCQkJCQkJZGVmYXVsdF9zbG90LAoJCQkJCQlkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsCgkJCQkJCWN0eCwKCQkJCQkJLyokJHNjb3BlKi8gY3R4WzldLAoJCQkJCQkhY3VycmVudAoJCQkJCQk/IGdldF9hbGxfZGlydHlfZnJvbV9zY29wZSgvKiQkc2NvcGUqLyBjdHhbOV0pCgkJCQkJCTogZ2V0X3Nsb3RfY2hhbmdlcyhkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIC8qJCRzY29wZSovIGN0eFs5XSwgZGlydHksIG51bGwpLAoJCQkJCQludWxsCgkJCQkJKTsKCQkJCX0KCQkJfQoKCQkJaWYgKGJ1dHRvbnNfc2xvdCkgewoJCQkJaWYgKGJ1dHRvbnNfc2xvdC5wICYmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJCRzY29wZSovIDUxMikpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlidXR0b25zX3Nsb3QsCgkJCQkJCWJ1dHRvbnNfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbOV0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs5XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGJ1dHRvbnNfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzldLCBkaXJ0eSwgZ2V0X2J1dHRvbnNfc2xvdF9jaGFuZ2VzKSwKCQkJCQkJZ2V0X2J1dHRvbnNfc2xvdF9jb250ZXh0CgkJCQkJKTsKCQkJCX0KCQkJfQoKCQkJc2V0X2F0dHJpYnV0ZXMoZGlhbG9nXzEsIGRpYWxvZ19kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoZGlhbG9nXzFfbGV2ZWxzLCBbCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmRpc3BsYXkqLyAyICYmIGRpYWxvZ18xX3N0eWxlX3ZhbHVlICE9PSAoZGlhbG9nXzFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFsxXSArICI7IikpICYmIHsgc3R5bGU6IGRpYWxvZ18xX3N0eWxlX3ZhbHVlIH0sCgkJCQlkaXJ0eSAmIC8qZXh0cmFPcHRpb25zKi8gNCAmJiAvKmV4dHJhT3B0aW9ucyovIGN0eFsyXQoJCQldKSk7CgoJCQl0b2dnbGVfY2xhc3MoZGlhbG9nXzEsICJzdmVsdGUtYnVmdnZlIiwgdHJ1ZSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2spOwoJCQl0cmFuc2l0aW9uX2luKGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbnNfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2spOwoJCQl0cmFuc2l0aW9uX291dChkZWZhdWx0X3Nsb3QsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uc19zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaWFsb2dfMSk7CgkJCX0KCgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2suZCgpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuZChkZXRhY2hpbmcpOwoJCQlpZiAoYnV0dG9uc19zbG90KSBidXR0b25zX3Nsb3QuZChkZXRhY2hpbmcpOwoJCQkvKmRpYWxvZ18xX2JpbmRpbmcqLyBjdHhbMTNdKG51bGwpOwoJCQltb3VudGVkID0gZmFsc2U7CgkJCXJ1bl9hbGwoZGlzcG9zZSk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkYSgkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc3BsYXkgPSAiZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IGljb24gPSB2b2lkIDAgfSA9ICQkcHJvcHM7CglsZXQgeyBoZWFkbGluZSB9ID0gJCRwcm9wczsKCWxldCB7IG9wZW4gfSA9ICQkcHJvcHM7CglsZXQgeyBjbG9zZU9uRXNjID0gdHJ1ZSB9ID0gJCRwcm9wczsKCWxldCB7IGNsb3NlT25DbGljayA9IHRydWUgfSA9ICQkcHJvcHM7Cgljb25zdCBkaXNwYXRjaCA9IGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcigpOwoJbGV0IGRpYWxvZzsKCgljb25zdCBjYW5jZWxfaGFuZGxlciA9IGUgPT4gewoJCWlmIChjbG9zZU9uRXNjKSB7CgkJCWRpc3BhdGNoKCJjbG9zZWRCeUVzYyIpOwoJCQkkJGludmFsaWRhdGUoMCwgb3BlbiA9IGZhbHNlKTsKCQl9IGVsc2UgewoJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyID0gKCkgPT4gewoJCWlmIChjbG9zZU9uQ2xpY2spIHsKCQkJZGlzcGF0Y2goImNsb3NlZEJ5Q2xpY2siKTsKCQkJJCRpbnZhbGlkYXRlKDAsIG9wZW4gPSBmYWxzZSk7CgkJfQoJfTsKCglmdW5jdGlvbiBkaWFsb2dfMV9iaW5kaW5nKCQkdmFsdWUpIHsKCQliaW5kaW5nX2NhbGxiYWNrc1skJHZhbHVlID8gJ3Vuc2hpZnQnIDogJ3B1c2gnXSgoKSA9PiB7CgkJCWRpYWxvZyA9ICQkdmFsdWU7CgkJCSQkaW52YWxpZGF0ZSg3LCBkaWFsb2cpOwoJCX0pOwoJfQoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZGlzcGxheScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGRpc3BsYXkgPSAkJHByb3BzLmRpc3BsYXkpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJCWlmICgnaWNvbicgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDMsIGljb24gPSAkJHByb3BzLmljb24pOwoJCWlmICgnaGVhZGxpbmUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg0LCBoZWFkbGluZSA9ICQkcHJvcHMuaGVhZGxpbmUpOwoJCWlmICgnb3BlbicgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIG9wZW4gPSAkJHByb3BzLm9wZW4pOwoJCWlmICgnY2xvc2VPbkVzYycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDUsIGNsb3NlT25Fc2MgPSAkJHByb3BzLmNsb3NlT25Fc2MpOwoJCWlmICgnY2xvc2VPbkNsaWNrJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoNiwgY2xvc2VPbkNsaWNrID0gJCRwcm9wcy5jbG9zZU9uQ2xpY2spOwoJCWlmICgnJCRzY29wZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDksICQkc2NvcGUgPSAkJHByb3BzLiQkc2NvcGUpOwoJfTsKCgkkJHNlbGYuJCQudXBkYXRlID0gKCkgPT4gewoJCWlmICgkJHNlbGYuJCQuZGlydHkgJiAvKmRpYWxvZywgb3BlbiovIDEyOSkgewoJCQkkOiB7CgkJCQlpZiAoIWRpYWxvZykgYnJlYWsgJDsKCQkJCWlmIChvcGVuKSBkaWFsb2cuc2hvd01vZGFsKCk7IGVsc2UgZGlhbG9nLmNsb3NlKCk7CgkJCX0KCQl9Cgl9OwoKCXJldHVybiBbCgkJb3BlbiwKCQlkaXNwbGF5LAoJCWV4dHJhT3B0aW9ucywKCQlpY29uLAoJCWhlYWRsaW5lLAoJCWNsb3NlT25Fc2MsCgkJY2xvc2VPbkNsaWNrLAoJCWRpYWxvZywKCQlkaXNwYXRjaCwKCQkkJHNjb3BlLAoJCXNsb3RzLAoJCWNhbmNlbF9oYW5kbGVyLAoJCWNsaWNrX2hhbmRsZXIsCgkJZGlhbG9nXzFfYmluZGluZwoJXTsKfQoKY2xhc3MgRGlhbG9nIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJGEsIGNyZWF0ZV9mcmFnbWVudCRhLCBzYWZlX25vdF9lcXVhbCwgewoJCQlkaXNwbGF5OiAxLAoJCQlleHRyYU9wdGlvbnM6IDIsCgkJCWljb246IDMsCgkJCWhlYWRsaW5lOiA0LAoJCQlvcGVuOiAwLAoJCQljbG9zZU9uRXNjOiA1LAoJCQljbG9zZU9uQ2xpY2s6IDYKCQl9KTsKCX0KfQoKY29uc3QgRGlhbG9nJDEgPSBEaWFsb2c7Cgpjb25zdCBMaXN0SXRlbUxhYmVsX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2NvbnRhaW5lcnMvTGlzdEl0ZW1MYWJlbC5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KY29uc3QgZ2V0X3RyYWlsaW5nX3Nsb3RfY2hhbmdlcyA9IGRpcnR5ID0+ICh7fSk7CmNvbnN0IGdldF90cmFpbGluZ19zbG90X2NvbnRleHQgPSBjdHggPT4gKHt9KTsKY29uc3QgZ2V0X2xlYWRpbmdfc2xvdF9jaGFuZ2VzID0gZGlydHkgPT4gKHt9KTsKY29uc3QgZ2V0X2xlYWRpbmdfc2xvdF9jb250ZXh0ID0gY3R4ID0+ICh7fSk7CgovLyAoMTI6MikgeyNpZiAkJHNsb3RzLmxlYWRpbmd9CmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9ja18zKGN0eCkgewoJbGV0IGRpdjsKCWxldCBjdXJyZW50OwoJY29uc3QgbGVhZGluZ19zbG90X3RlbXBsYXRlID0gLyojc2xvdHMqLyBjdHhbOV0ubGVhZGluZzsKCWNvbnN0IGxlYWRpbmdfc2xvdCA9IGNyZWF0ZV9zbG90KGxlYWRpbmdfc2xvdF90ZW1wbGF0ZSwgY3R4LCAvKiQkc2NvcGUqLyBjdHhbOF0sIGdldF9sZWFkaW5nX3Nsb3RfY29udGV4dCk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJaWYgKGxlYWRpbmdfc2xvdCkgbGVhZGluZ19zbG90LmMoKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJsZWFkaW5nIHN2ZWx0ZS14YnYwZG0iKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoKCQkJaWYgKGxlYWRpbmdfc2xvdCkgewoJCQkJbGVhZGluZ19zbG90Lm0oZGl2LCBudWxsKTsKCQkJfQoKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJaWYgKGxlYWRpbmdfc2xvdCkgewoJCQkJaWYgKGxlYWRpbmdfc2xvdC5wICYmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJCRzY29wZSovIDI1NikpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlsZWFkaW5nX3Nsb3QsCgkJCQkJCWxlYWRpbmdfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbOF0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs4XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGxlYWRpbmdfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzhdLCBkaXJ0eSwgZ2V0X2xlYWRpbmdfc2xvdF9jaGFuZ2VzKSwKCQkJCQkJZ2V0X2xlYWRpbmdfc2xvdF9jb250ZXh0CgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGxlYWRpbmdfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQobGVhZGluZ19zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlpZiAobGVhZGluZ19zbG90KSBsZWFkaW5nX3Nsb3QuZChkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCi8vICgxODo0KSB7I2lmIG92ZXJsaW5lfQpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMiQxKGN0eCkgewoJbGV0IHA7CglsZXQgdDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCXAgPSBlbGVtZW50KCJwIik7CgkJCXQgPSB0ZXh0KC8qb3ZlcmxpbmUqLyBjdHhbMl0pOwoJCQlhdHRyKHAsICJjbGFzcyIsICJvdmVybGluZSBtMy1mb250LWxhYmVsLXNtYWxsIHN2ZWx0ZS14YnYwZG0iKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgcCwgYW5jaG9yKTsKCQkJYXBwZW5kKHAsIHQpOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChkaXJ0eSAmIC8qb3ZlcmxpbmUqLyA0KSBzZXRfZGF0YSh0LCAvKm92ZXJsaW5lKi8gY3R4WzJdKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChwKTsKCQkJfQoJCX0KCX07Cn0KCi8vICgyMjo0KSB7I2lmIHN1cHBvcnRpbmd9CmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9ja18xJDMoY3R4KSB7CglsZXQgcDsKCWxldCB0OwoKCXJldHVybiB7CgkJYygpIHsKCQkJcCA9IGVsZW1lbnQoInAiKTsKCQkJdCA9IHRleHQoLypzdXBwb3J0aW5nKi8gY3R4WzRdKTsKCQkJYXR0cihwLCAiY2xhc3MiLCAic3VwcG9ydGluZyBtMy1mb250LWJvZHktbWVkaXVtIHN2ZWx0ZS14YnYwZG0iKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgcCwgYW5jaG9yKTsKCQkJYXBwZW5kKHAsIHQpOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChkaXJ0eSAmIC8qc3VwcG9ydGluZyovIDE2KSBzZXRfZGF0YSh0LCAvKnN1cHBvcnRpbmcqLyBjdHhbNF0pOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHApOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDI2OjIpIHsjaWYgJCRzbG90cy50cmFpbGluZ30KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrJDQoY3R4KSB7CglsZXQgZGl2OwoJbGV0IGN1cnJlbnQ7Cgljb25zdCB0cmFpbGluZ19zbG90X3RlbXBsYXRlID0gLyojc2xvdHMqLyBjdHhbOV0udHJhaWxpbmc7Cgljb25zdCB0cmFpbGluZ19zbG90ID0gY3JlYXRlX3Nsb3QodHJhaWxpbmdfc2xvdF90ZW1wbGF0ZSwgY3R4LCAvKiQkc2NvcGUqLyBjdHhbOF0sIGdldF90cmFpbGluZ19zbG90X2NvbnRleHQpOwoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmICh0cmFpbGluZ19zbG90KSB0cmFpbGluZ19zbG90LmMoKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJ0cmFpbGluZyBtMy1mb250LWxhYmVsLXNtYWxsIHN2ZWx0ZS14YnYwZG0iKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoKCQkJaWYgKHRyYWlsaW5nX3Nsb3QpIHsKCQkJCXRyYWlsaW5nX3Nsb3QubShkaXYsIG51bGwpOwoJCQl9CgoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlpZiAodHJhaWxpbmdfc2xvdCkgewoJCQkJaWYgKHRyYWlsaW5nX3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyAyNTYpKSB7CgkJCQkJdXBkYXRlX3Nsb3RfYmFzZSgKCQkJCQkJdHJhaWxpbmdfc2xvdCwKCQkJCQkJdHJhaWxpbmdfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbOF0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs4XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKHRyYWlsaW5nX3Nsb3RfdGVtcGxhdGUsIC8qJCRzY29wZSovIGN0eFs4XSwgZGlydHksIGdldF90cmFpbGluZ19zbG90X2NoYW5nZXMpLAoJCQkJCQlnZXRfdHJhaWxpbmdfc2xvdF9jb250ZXh0CgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKHRyYWlsaW5nX3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KHRyYWlsaW5nX3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWlmICh0cmFpbGluZ19zbG90KSB0cmFpbGluZ19zbG90LmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkOShjdHgpIHsKCWxldCBsYWJlbDsKCWxldCB0MDsKCWxldCBkaXY7CglsZXQgdDE7CglsZXQgcDsKCWxldCB0MjsKCWxldCB0MzsKCWxldCB0NDsKCWxldCBsYWJlbF9jbGFzc192YWx1ZTsKCWxldCBsYWJlbF9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJbGV0IGlmX2Jsb2NrMCA9IC8qJCRzbG90cyovIGN0eFs2XS5sZWFkaW5nICYmIGNyZWF0ZV9pZl9ibG9ja18zKGN0eCk7CglsZXQgaWZfYmxvY2sxID0gLypvdmVybGluZSovIGN0eFsyXSAmJiBjcmVhdGVfaWZfYmxvY2tfMiQxKGN0eCk7CglsZXQgaWZfYmxvY2syID0gLypzdXBwb3J0aW5nKi8gY3R4WzRdICYmIGNyZWF0ZV9pZl9ibG9ja18xJDMoY3R4KTsKCWxldCBpZl9ibG9jazMgPSAvKiQkc2xvdHMqLyBjdHhbNl0udHJhaWxpbmcgJiYgY3JlYXRlX2lmX2Jsb2NrJDQoY3R4KTsKCglsZXQgbGFiZWxfbGV2ZWxzID0gWwoJCXsKCQkJY2xhc3M6IGxhYmVsX2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciBsaW5lcy0iICsgLypfbGluZXMqLyBjdHhbNV0KCQl9LAoJCXsKCQkJc3R5bGU6IGxhYmVsX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0KCQl9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgldOwoKCWxldCBsYWJlbF9kYXRhID0ge307CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBsYWJlbF9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlsYWJlbF9kYXRhID0gYXNzaWduKGxhYmVsX2RhdGEsIGxhYmVsX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlsYWJlbCA9IGVsZW1lbnQoImxhYmVsIik7CgkJCWlmIChpZl9ibG9jazApIGlmX2Jsb2NrMC5jKCk7CgkJCXQwID0gc3BhY2UoKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChpZl9ibG9jazEpIGlmX2Jsb2NrMS5jKCk7CgkJCXQxID0gc3BhY2UoKTsKCQkJcCA9IGVsZW1lbnQoInAiKTsKCQkJdDIgPSB0ZXh0KC8qaGVhZGxpbmUqLyBjdHhbM10pOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWlmIChpZl9ibG9jazIpIGlmX2Jsb2NrMi5jKCk7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJaWYgKGlmX2Jsb2NrMykgaWZfYmxvY2szLmMoKTsKCQkJYXR0cihwLCAiY2xhc3MiLCAiaGVhZGxpbmUgbTMtZm9udC1ib2R5LWxhcmdlIHN2ZWx0ZS14YnYwZG0iKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJib2R5Iik7CgkJCXNldF9hdHRyaWJ1dGVzKGxhYmVsLCBsYWJlbF9kYXRhKTsKCQkJdG9nZ2xlX2NsYXNzKGxhYmVsLCAic3ZlbHRlLXhidjBkbSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBsYWJlbCwgYW5jaG9yKTsKCQkJaWYgKGlmX2Jsb2NrMCkgaWZfYmxvY2swLm0obGFiZWwsIG51bGwpOwoJCQlhcHBlbmQobGFiZWwsIHQwKTsKCQkJYXBwZW5kKGxhYmVsLCBkaXYpOwoJCQlpZiAoaWZfYmxvY2sxKSBpZl9ibG9jazEubShkaXYsIG51bGwpOwoJCQlhcHBlbmQoZGl2LCB0MSk7CgkJCWFwcGVuZChkaXYsIHApOwoJCQlhcHBlbmQocCwgdDIpOwoJCQlhcHBlbmQoZGl2LCB0Myk7CgkJCWlmIChpZl9ibG9jazIpIGlmX2Jsb2NrMi5tKGRpdiwgbnVsbCk7CgkJCWFwcGVuZChsYWJlbCwgdDQpOwoJCQlpZiAoaWZfYmxvY2szKSBpZl9ibG9jazMubShsYWJlbCwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKC8qJCRzbG90cyovIGN0eFs2XS5sZWFkaW5nKSB7CgkJCQlpZiAoaWZfYmxvY2swKSB7CgkJCQkJaWZfYmxvY2swLnAoY3R4LCBkaXJ0eSk7CgoJCQkJCWlmIChkaXJ0eSAmIC8qJCRzbG90cyovIDY0KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2swLCAxKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrMCA9IGNyZWF0ZV9pZl9ibG9ja18zKGN0eCk7CgkJCQkJaWZfYmxvY2swLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMCwgMSk7CgkJCQkJaWZfYmxvY2swLm0obGFiZWwsIHQwKTsKCQkJCX0KCQkJfSBlbHNlIGlmIChpZl9ibG9jazApIHsKCQkJCWdyb3VwX291dHJvcygpOwoKCQkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrMCwgMSwgMSwgKCkgPT4gewoJCQkJCWlmX2Jsb2NrMCA9IG51bGw7CgkJCQl9KTsKCgkJCQljaGVja19vdXRyb3MoKTsKCQkJfQoKCQkJaWYgKC8qb3ZlcmxpbmUqLyBjdHhbMl0pIHsKCQkJCWlmIChpZl9ibG9jazEpIHsKCQkJCQlpZl9ibG9jazEucChjdHgsIGRpcnR5KTsKCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sxID0gY3JlYXRlX2lmX2Jsb2NrXzIkMShjdHgpOwoJCQkJCWlmX2Jsb2NrMS5jKCk7CgkJCQkJaWZfYmxvY2sxLm0oZGl2LCB0MSk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2sxKSB7CgkJCQlpZl9ibG9jazEuZCgxKTsKCQkJCWlmX2Jsb2NrMSA9IG51bGw7CgkJCX0KCgkJCWlmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qaGVhZGxpbmUqLyA4KSBzZXRfZGF0YSh0MiwgLypoZWFkbGluZSovIGN0eFszXSk7CgoJCQlpZiAoLypzdXBwb3J0aW5nKi8gY3R4WzRdKSB7CgkJCQlpZiAoaWZfYmxvY2syKSB7CgkJCQkJaWZfYmxvY2syLnAoY3R4LCBkaXJ0eSk7CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrMiA9IGNyZWF0ZV9pZl9ibG9ja18xJDMoY3R4KTsKCQkJCQlpZl9ibG9jazIuYygpOwoJCQkJCWlmX2Jsb2NrMi5tKGRpdiwgbnVsbCk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2syKSB7CgkJCQlpZl9ibG9jazIuZCgxKTsKCQkJCWlmX2Jsb2NrMiA9IG51bGw7CgkJCX0KCgkJCWlmICgvKiQkc2xvdHMqLyBjdHhbNl0udHJhaWxpbmcpIHsKCQkJCWlmIChpZl9ibG9jazMpIHsKCQkJCQlpZl9ibG9jazMucChjdHgsIGRpcnR5KTsKCgkJCQkJaWYgKGRpcnR5ICYgLyokJHNsb3RzKi8gNjQpIHsKCQkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jazMsIDEpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2szID0gY3JlYXRlX2lmX2Jsb2NrJDQoY3R4KTsKCQkJCQlpZl9ibG9jazMuYygpOwoJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2szLCAxKTsKCQkJCQlpZl9ibG9jazMubShsYWJlbCwgbnVsbCk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2szKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jazMsIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jazMgPSBudWxsOwoJCQkJfSk7CgoJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCX0KCgkJCXNldF9hdHRyaWJ1dGVzKGxhYmVsLCBsYWJlbF9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUobGFiZWxfbGV2ZWxzLCBbCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKl9saW5lcyovIDMyICYmIGxhYmVsX2NsYXNzX3ZhbHVlICE9PSAobGFiZWxfY2xhc3NfdmFsdWUgPSAibTMtY29udGFpbmVyIGxpbmVzLSIgKyAvKl9saW5lcyovIGN0eFs1XSkpICYmIHsgY2xhc3M6IGxhYmVsX2NsYXNzX3ZhbHVlIH0sCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmRpc3BsYXkqLyAxICYmIGxhYmVsX3N0eWxlX3ZhbHVlICE9PSAobGFiZWxfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFswXSkpICYmIHsgc3R5bGU6IGxhYmVsX3N0eWxlX3ZhbHVlIH0sCgkJCQlkaXJ0eSAmIC8qZXh0cmFPcHRpb25zKi8gMiAmJiAvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJCQldKSk7CgoJCQl0b2dnbGVfY2xhc3MobGFiZWwsICJzdmVsdGUteGJ2MGRtIiwgdHJ1ZSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2swKTsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jazMpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2swKTsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2szKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGxhYmVsKTsKCQkJfQoKCQkJaWYgKGlmX2Jsb2NrMCkgaWZfYmxvY2swLmQoKTsKCQkJaWYgKGlmX2Jsb2NrMSkgaWZfYmxvY2sxLmQoKTsKCQkJaWYgKGlmX2Jsb2NrMikgaWZfYmxvY2syLmQoKTsKCQkJaWYgKGlmX2Jsb2NrMykgaWZfYmxvY2szLmQoKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ5KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgX2xpbmVzOwoJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKCWNvbnN0ICQkc2xvdHMgPSBjb21wdXRlX3Nsb3RzKHNsb3RzKTsKCWxldCB7IGRpc3BsYXkgPSAiZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IG92ZXJsaW5lID0gIiIgfSA9ICQkcHJvcHM7CglsZXQgeyBoZWFkbGluZSA9ICIiIH0gPSAkJHByb3BzOwoJbGV0IHsgc3VwcG9ydGluZyA9ICIiIH0gPSAkJHByb3BzOwoJbGV0IHsgbGluZXMgPSB2b2lkIDAgfSA9ICQkcHJvcHM7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCdvdmVybGluZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDIsIG92ZXJsaW5lID0gJCRwcm9wcy5vdmVybGluZSk7CgkJaWYgKCdoZWFkbGluZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDMsIGhlYWRsaW5lID0gJCRwcm9wcy5oZWFkbGluZSk7CgkJaWYgKCdzdXBwb3J0aW5nJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoNCwgc3VwcG9ydGluZyA9ICQkcHJvcHMuc3VwcG9ydGluZyk7CgkJaWYgKCdsaW5lcycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDcsIGxpbmVzID0gJCRwcm9wcy5saW5lcyk7CgkJaWYgKCckJHNjb3BlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoOCwgJCRzY29wZSA9ICQkcHJvcHMuJCRzY29wZSk7Cgl9OwoKCSQkc2VsZi4kJC51cGRhdGUgPSAoKSA9PiB7CgkJaWYgKCQkc2VsZi4kJC5kaXJ0eSAmIC8qbGluZXMsIG92ZXJsaW5lLCBzdXBwb3J0aW5nKi8gMTQ4KSB7CgkJCSQkaW52YWxpZGF0ZSg1LCBfbGluZXMgPSBsaW5lcyB8fCAob3ZlcmxpbmUgJiYgc3VwcG9ydGluZwoJCQk/IDMKCQkJOiBvdmVybGluZSB8fCBzdXBwb3J0aW5nID8gMiA6IDEpKTsKCQl9Cgl9OwoKCXJldHVybiBbCgkJZGlzcGxheSwKCQlleHRyYU9wdGlvbnMsCgkJb3ZlcmxpbmUsCgkJaGVhZGxpbmUsCgkJc3VwcG9ydGluZywKCQlfbGluZXMsCgkJJCRzbG90cywKCQlsaW5lcywKCQkkJHNjb3BlLAoJCXNsb3RzCgldOwp9CgpjbGFzcyBMaXN0SXRlbUxhYmVsIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDksIGNyZWF0ZV9mcmFnbWVudCQ5LCBzYWZlX25vdF9lcXVhbCwgewoJCQlkaXNwbGF5OiAwLAoJCQlleHRyYU9wdGlvbnM6IDEsCgkJCW92ZXJsaW5lOiAyLAoJCQloZWFkbGluZTogMywKCQkJc3VwcG9ydGluZzogNCwKCQkJbGluZXM6IDcKCQl9KTsKCX0KfQoKY29uc3QgTGlzdEl0ZW1MYWJlbCQxID0gTGlzdEl0ZW1MYWJlbDsKCi8qKgogKiBBbmltYXRlcyB0aGUgb3BhY2l0eSBvZiBhbiBlbGVtZW50IGZyb20gMCB0byB0aGUgY3VycmVudCBvcGFjaXR5IGZvciBgaW5gIHRyYW5zaXRpb25zIGFuZCBmcm9tIHRoZSBjdXJyZW50IG9wYWNpdHkgdG8gMCBmb3IgYG91dGAgdHJhbnNpdGlvbnMuCiAqCiAqIGh0dHBzOi8vc3ZlbHRlLmRldi9kb2NzL3N2ZWx0ZS10cmFuc2l0aW9uI2ZhZGUKICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAqIEBwYXJhbSB7aW1wb3J0KCcuL3B1YmxpYycpLkZhZGVQYXJhbXN9IFtwYXJhbXNdCiAqIEByZXR1cm5zIHtpbXBvcnQoJy4vcHVibGljJykuVHJhbnNpdGlvbkNvbmZpZ30KICovCmZ1bmN0aW9uIGZhZGUobm9kZSwgeyBkZWxheSA9IDAsIGR1cmF0aW9uID0gNDAwLCBlYXNpbmcgPSBpZGVudGl0eSB9ID0ge30pIHsKCWNvbnN0IG8gPSArZ2V0Q29tcHV0ZWRTdHlsZShub2RlKS5vcGFjaXR5OwoJcmV0dXJuIHsKCQlkZWxheSwKCQlkdXJhdGlvbiwKCQllYXNpbmcsCgkJY3NzOiAodCkgPT4gYG9wYWNpdHk6ICR7dCAqIG99YAoJfTsKfQoKY29uc3QgZGF0YSA9IHsKCSJ3aWR0aCI6IDI0LAoJImhlaWdodCI6IDI0LAoJImJvZHkiOiAiPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNMTkgNi40MUwxNy41OSA1TDEyIDEwLjU5TDYuNDEgNUw1IDYuNDFMMTAuNTkgMTJMNSAxNy41OUw2LjQxIDE5TDEyIDEzLjQxTDE3LjU5IDE5TDE5IDE3LjU5TDEzLjQxIDEyTDE5IDYuNDF6XCIvPiIKfTsKCmNvbnN0IFNuYWNrYmFySXRlbV9zdmVsdGVfc3ZlbHRlX3R5cGVfc3R5bGVfbGFuZyA9ICcnOwoKLyogaG9tZS9jZS9Eb2N1bWVudHMvR2l0SHViL2FkcmlmdC9ub2RlX21vZHVsZXMvLnBucG0vbTMtc3ZlbHRlQDIuMC40L25vZGVfbW9kdWxlcy9tMy1zdmVsdGUvcGFja2FnZS9jb250YWluZXJzL1NuYWNrYmFySXRlbS5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCQ4KGN0eCkgewoJbGV0IGRpdjsKCWxldCBkaXZfc3R5bGVfdmFsdWU7CglsZXQgY3VycmVudDsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzNdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzJdLCBudWxsKTsKCglsZXQgZGl2X2xldmVscyA9IFsKCQl7IGNsYXNzOiAibTMtY29udGFpbmVyIiB9LAoJCXsKCQkJc3R5bGU6IGRpdl9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiCgkJfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJXTsKCglsZXQgZGl2X2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGRpdl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlkaXZfZGF0YSA9IGFzc2lnbihkaXZfZGF0YSwgZGl2X2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJaWYgKGRlZmF1bHRfc2xvdCkgZGVmYXVsdF9zbG90LmMoKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2LCBkaXZfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYsICJzdmVsdGUtbDkycnRuIiwgdHJ1ZSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWRlZmF1bHRfc2xvdC5tKGRpdiwgbnVsbCk7CgkJCX0KCgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJaWYgKGRlZmF1bHRfc2xvdC5wICYmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJCRzY29wZSovIDQpKSB7CgkJCQkJdXBkYXRlX3Nsb3RfYmFzZSgKCQkJCQkJZGVmYXVsdF9zbG90LAoJCQkJCQlkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsCgkJCQkJCWN0eCwKCQkJCQkJLyokJHNjb3BlKi8gY3R4WzJdLAoJCQkJCQkhY3VycmVudAoJCQkJCQk/IGdldF9hbGxfZGlydHlfZnJvbV9zY29wZSgvKiQkc2NvcGUqLyBjdHhbMl0pCgkJCQkJCTogZ2V0X3Nsb3RfY2hhbmdlcyhkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIC8qJCRzY29wZSovIGN0eFsyXSwgZGlydHksIG51bGwpLAoJCQkJCQludWxsCgkJCQkJKTsKCQkJCX0KCQkJfQoKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2LCBkaXZfZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKGRpdl9sZXZlbHMsIFsKCQkJCXsgY2xhc3M6ICJtMy1jb250YWluZXIiIH0sCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmRpc3BsYXkqLyAxICYmIGRpdl9zdHlsZV92YWx1ZSAhPT0gKGRpdl9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiKSkgJiYgeyBzdHlsZTogZGl2X3N0eWxlX3ZhbHVlIH0sCgkJCQlkaXJ0eSAmIC8qZXh0cmFPcHRpb25zKi8gMiAmJiAvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJCQldKSk7CgoJCQl0b2dnbGVfY2xhc3MoZGl2LCAic3ZlbHRlLWw5MnJ0biIsIHRydWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuZChkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJDgoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7ICQkc2xvdHM6IHNsb3RzID0ge30sICQkc2NvcGUgfSA9ICQkcHJvcHM7CglsZXQgeyBkaXNwbGF5ID0gImZsZXgiIH0gPSAkJHByb3BzOwoJbGV0IHsgZXh0cmFPcHRpb25zID0ge30gfSA9ICQkcHJvcHM7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCckJHNjb3BlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgJCRzY29wZSA9ICQkcHJvcHMuJCRzY29wZSk7Cgl9OwoKCXJldHVybiBbZGlzcGxheSwgZXh0cmFPcHRpb25zLCAkJHNjb3BlLCBzbG90c107Cn0KCmNsYXNzIFNuYWNrYmFySXRlbSBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDgsIGNyZWF0ZV9mcmFnbWVudCQ4LCBzYWZlX25vdF9lcXVhbCwgeyBkaXNwbGF5OiAwLCBleHRyYU9wdGlvbnM6IDEgfSk7Cgl9Cn0KCmNvbnN0IFNuYWNrYmFySXRlbSQxID0gU25hY2tiYXJJdGVtOwoKY29uc3QgU25hY2tiYXJBbmltX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjQvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2NvbnRhaW5lcnMvU25hY2tiYXJBbmltLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gZ2V0X2VhY2hfY29udGV4dCQxKGN0eCwgbGlzdCwgaSkgewoJY29uc3QgY2hpbGRfY3R4ID0gY3R4LnNsaWNlKCk7CgljaGlsZF9jdHhbN10gPSBsaXN0W2ldWzBdOwoJY2hpbGRfY3R4WzhdID0gbGlzdFtpXVsxXTsKCXJldHVybiBjaGlsZF9jdHg7Cn0KCi8vICgyNTowKSB7I2lmIHNuYWNrYmFyfQpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2skMyhjdHgpIHsKCWxldCBkaXY7CglsZXQgcHJldmlvdXNfa2V5ID0gLypzbmFja2JhciovIGN0eFsyXTsKCWxldCBkaXZfb3V0cm87CglsZXQgY3VycmVudDsKCWxldCBrZXlfYmxvY2sgPSBjcmVhdGVfa2V5X2Jsb2NrKGN0eCk7CglsZXQgZGl2X2xldmVscyA9IFt7IGNsYXNzOiAiaG9sZGVyIiB9LCAvKmV4dHJhV3JhcHBlck9wdGlvbnMqLyBjdHhbMF1dOwoJbGV0IGRpdl9kYXRhID0ge307CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBkaXZfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJZGl2X2RhdGEgPSBhc3NpZ24oZGl2X2RhdGEsIGRpdl9sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWtleV9ibG9jay5jKCk7CgkJCXNldF9hdHRyaWJ1dGVzKGRpdiwgZGl2X2RhdGEpOwoJCQl0b2dnbGVfY2xhc3MoZGl2LCAic3ZlbHRlLWtkenB5ZyIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCWtleV9ibG9jay5tKGRpdiwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChkaXJ0eSAmIC8qc25hY2tiYXIqLyA0ICYmIHNhZmVfbm90X2VxdWFsKHByZXZpb3VzX2tleSwgcHJldmlvdXNfa2V5ID0gLypzbmFja2JhciovIGN0eFsyXSkpIHsKCQkJCWdyb3VwX291dHJvcygpOwoJCQkJdHJhbnNpdGlvbl9vdXQoa2V5X2Jsb2NrLCAxLCAxLCBub29wJDQpOwoJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCQlrZXlfYmxvY2sgPSBjcmVhdGVfa2V5X2Jsb2NrKGN0eCk7CgkJCQlrZXlfYmxvY2suYygpOwoJCQkJdHJhbnNpdGlvbl9pbihrZXlfYmxvY2ssIDEpOwoJCQkJa2V5X2Jsb2NrLm0oZGl2LCBudWxsKTsKCQkJfSBlbHNlIHsKCQkJCWtleV9ibG9jay5wKGN0eCwgZGlydHkpOwoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhkaXYsIGRpdl9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoZGl2X2xldmVscywgWwoJCQkJeyBjbGFzczogImhvbGRlciIgfSwKCQkJCWRpcnR5ICYgLypleHRyYVdyYXBwZXJPcHRpb25zKi8gMSAmJiAvKmV4dHJhV3JhcHBlck9wdGlvbnMqLyBjdHhbMF0KCQkJXSkpOwoKCQkJdG9nZ2xlX2NsYXNzKGRpdiwgInN2ZWx0ZS1rZHpweWciLCB0cnVlKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihrZXlfYmxvY2spOwoJCQlpZiAoZGl2X291dHJvKSBkaXZfb3V0cm8uZW5kKDEpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoa2V5X2Jsb2NrKTsKCgkJCWlmIChsb2NhbCkgewoJCQkJZGl2X291dHJvID0gY3JlYXRlX291dF90cmFuc2l0aW9uKGRpdiwgZmFkZSwgeyBkdXJhdGlvbjogMjAwIH0pOwoJCQl9CgoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2KTsKCQkJfQoKCQkJa2V5X2Jsb2NrLmQoZGV0YWNoaW5nKTsKCQkJaWYgKGRldGFjaGluZyAmJiBkaXZfb3V0cm8pIGRpdl9vdXRyby5lbmQoKTsKCQl9Cgl9Owp9CgovLyAoMzA6OCkgeyNlYWNoIE9iamVjdC5lbnRyaWVzKHNuYWNrYmFyLmFjdGlvbnMpIGFzIFtrZXksIGFjdGlvbl19CmZ1bmN0aW9uIGNyZWF0ZV9lYWNoX2Jsb2NrJDEoY3R4KSB7CglsZXQgYnV0dG9uOwoJbGV0IHRfdmFsdWUgPSAvKmtleSovIGN0eFs3XSArICIiOwoJbGV0IHQ7CglsZXQgbW91bnRlZDsKCWxldCBkaXNwb3NlOwoKCWZ1bmN0aW9uIGNsaWNrX2hhbmRsZXIoKSB7CgkJcmV0dXJuIC8qY2xpY2tfaGFuZGxlciovIGN0eFs0XSgvKmFjdGlvbiovIGN0eFs4XSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlidXR0b24gPSBlbGVtZW50KCJidXR0b24iKTsKCQkJdCA9IHRleHQodF92YWx1ZSk7CgkJCWF0dHIoYnV0dG9uLCAiY2xhc3MiLCAiYWN0aW9uIG0zLWZvbnQtbGFiZWwtbGFyZ2Ugc3ZlbHRlLWtkenB5ZyIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBidXR0b24sIGFuY2hvcik7CgkJCWFwcGVuZChidXR0b24sIHQpOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gbGlzdGVuKGJ1dHRvbiwgImNsaWNrIiwgY2xpY2tfaGFuZGxlcik7CgkJCQltb3VudGVkID0gdHJ1ZTsKCQkJfQoJCX0sCgkJcChuZXdfY3R4LCBkaXJ0eSkgewoJCQljdHggPSBuZXdfY3R4OwoJCQlpZiAoZGlydHkgJiAvKnNuYWNrYmFyKi8gNCAmJiB0X3ZhbHVlICE9PSAodF92YWx1ZSA9IC8qa2V5Ki8gY3R4WzddICsgIiIpKSBzZXRfZGF0YSh0LCB0X3ZhbHVlKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChidXR0b24pOwoJCQl9CgoJCQltb3VudGVkID0gZmFsc2U7CgkJCWRpc3Bvc2UoKTsKCQl9Cgl9Owp9CgovLyAoNDE6OCkgeyNpZiBzbmFja2Jhci5jbG9zYWJsZX0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzEkMihjdHgpIHsKCWxldCBidXR0b247CglsZXQgaWNvbjsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWljb24gPSBuZXcgSWNvbih7IHByb3BzOiB7IGljb246IGRhdGEgfSB9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWJ1dHRvbiA9IGVsZW1lbnQoImJ1dHRvbiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24uJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGJ1dHRvbiwgImNsYXNzIiwgImNsb3NlIHN2ZWx0ZS1rZHpweWciKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgYnV0dG9uLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbiwgYnV0dG9uLCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfMSovIGN0eFs1XSk7CgkJCQltb3VudGVkID0gdHJ1ZTsKCQkJfQoJCX0sCgkJcDogbm9vcCQ0LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChidXR0b24pOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uKTsKCQkJbW91bnRlZCA9IGZhbHNlOwoJCQlkaXNwb3NlKCk7CgkJfQoJfTsKfQoKLy8gKDI4OjYpIDxTbmFja2Jhckl0ZW0gey4uLmV4dHJhT3B0aW9uc30+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3QkMyhjdHgpIHsKCWxldCBwOwoJbGV0IHQwX3ZhbHVlID0gLypzbmFja2JhciovIGN0eFsyXS5tZXNzYWdlICsgIiI7CglsZXQgdDA7CglsZXQgdDE7CglsZXQgdDI7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoJbGV0IGN1cnJlbnQ7CglsZXQgZWFjaF92YWx1ZSA9IGVuc3VyZV9hcnJheV9saWtlKE9iamVjdC5lbnRyaWVzKC8qc25hY2tiYXIqLyBjdHhbMl0uYWN0aW9ucykpOwoJbGV0IGVhY2hfYmxvY2tzID0gW107CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7CgkJZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQxKGdldF9lYWNoX2NvbnRleHQkMShjdHgsIGVhY2hfdmFsdWUsIGkpKTsKCX0KCglsZXQgaWZfYmxvY2sgPSAvKnNuYWNrYmFyKi8gY3R4WzJdLmNsb3NhYmxlICYmIGNyZWF0ZV9pZl9ibG9ja18xJDIoY3R4KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCXAgPSBlbGVtZW50KCJwIik7CgkJCXQwID0gdGV4dCh0MF92YWx1ZSk7CgkJCXQxID0gc3BhY2UoKTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHsKCQkJCWVhY2hfYmxvY2tzW2ldLmMoKTsKCQkJfQoKCQkJdDIgPSBzcGFjZSgpOwoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmMoKTsKCQkJaWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTsKCQkJYXR0cihwLCAiY2xhc3MiLCAibTMtZm9udC1ib2R5LW1lZGl1bSBzdmVsdGUta2R6cHlnIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHAsIGFuY2hvcik7CgkJCWFwcGVuZChwLCB0MCk7CgkJCWluc2VydCh0YXJnZXQsIHQxLCBhbmNob3IpOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQkJaWYgKGVhY2hfYmxvY2tzW2ldKSB7CgkJCQkJZWFjaF9ibG9ja3NbaV0ubSh0YXJnZXQsIGFuY2hvcik7CgkJCQl9CgkJCX0KCgkJCWluc2VydCh0YXJnZXQsIHQyLCBhbmNob3IpOwoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLm0odGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBpZl9ibG9ja19hbmNob3IsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmICgoIWN1cnJlbnQgfHwgZGlydHkgJiAvKnNuYWNrYmFyKi8gNCkgJiYgdDBfdmFsdWUgIT09ICh0MF92YWx1ZSA9IC8qc25hY2tiYXIqLyBjdHhbMl0ubWVzc2FnZSArICIiKSkgc2V0X2RhdGEodDAsIHQwX3ZhbHVlKTsKCgkJCWlmIChkaXJ0eSAmIC8qc25hY2tiYXIsIHVuZGVmaW5lZCwgT2JqZWN0Ki8gNCkgewoJCQkJZWFjaF92YWx1ZSA9IGVuc3VyZV9hcnJheV9saWtlKE9iamVjdC5lbnRyaWVzKC8qc25hY2tiYXIqLyBjdHhbMl0uYWN0aW9ucykpOwoJCQkJbGV0IGk7CgoJCQkJZm9yIChpID0gMDsgaSA8IGVhY2hfdmFsdWUubGVuZ3RoOyBpICs9IDEpIHsKCQkJCQljb25zdCBjaGlsZF9jdHggPSBnZXRfZWFjaF9jb250ZXh0JDEoY3R4LCBlYWNoX3ZhbHVlLCBpKTsKCgkJCQkJaWYgKGVhY2hfYmxvY2tzW2ldKSB7CgkJCQkJCWVhY2hfYmxvY2tzW2ldLnAoY2hpbGRfY3R4LCBkaXJ0eSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQxKGNoaWxkX2N0eCk7CgkJCQkJCWVhY2hfYmxvY2tzW2ldLmMoKTsKCQkJCQkJZWFjaF9ibG9ja3NbaV0ubSh0Mi5wYXJlbnROb2RlLCB0Mik7CgkJCQkJfQoJCQkJfQoKCQkJCWZvciAoOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHsKCQkJCQllYWNoX2Jsb2Nrc1tpXS5kKDEpOwoJCQkJfQoKCQkJCWVhY2hfYmxvY2tzLmxlbmd0aCA9IGVhY2hfdmFsdWUubGVuZ3RoOwoJCQl9CgoJCQlpZiAoLypzbmFja2JhciovIGN0eFsyXS5jbG9zYWJsZSkgewoJCQkJaWYgKGlmX2Jsb2NrKSB7CgkJCQkJaWZfYmxvY2sucChjdHgsIGRpcnR5KTsKCgkJCQkJaWYgKGRpcnR5ICYgLypzbmFja2JhciovIDQpIHsKCQkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZl9ibG9jayA9IGNyZWF0ZV9pZl9ibG9ja18xJDIoY3R4KTsKCQkJCQlpZl9ibG9jay5jKCk7CgkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7CgkJCQkJaWZfYmxvY2subShpZl9ibG9ja19hbmNob3IucGFyZW50Tm9kZSwgaWZfYmxvY2tfYW5jaG9yKTsKCQkJCX0KCQkJfSBlbHNlIGlmIChpZl9ibG9jaykgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2ssIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jayA9IG51bGw7CgkJCQl9KTsKCgkJCQljaGVja19vdXRyb3MoKTsKCQkJfQoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHApOwoJCQkJZGV0YWNoKHQxKTsKCQkJCWRldGFjaCh0Mik7CgkJCQlkZXRhY2goaWZfYmxvY2tfYW5jaG9yKTsKCQkJfQoKCQkJZGVzdHJveV9lYWNoKGVhY2hfYmxvY2tzLCBkZXRhY2hpbmcpOwoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMjc6NCkgeyNrZXkgc25hY2tiYXJ9CmZ1bmN0aW9uIGNyZWF0ZV9rZXlfYmxvY2soY3R4KSB7CglsZXQgc25hY2tiYXJpdGVtOwoJbGV0IGN1cnJlbnQ7Cgljb25zdCBzbmFja2Jhcml0ZW1fc3ByZWFkX2xldmVscyA9IFsvKmV4dHJhT3B0aW9ucyovIGN0eFsxXV07CgoJbGV0IHNuYWNrYmFyaXRlbV9wcm9wcyA9IHsKCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90JDNdIH0sCgkJJCRzY29wZTogeyBjdHggfQoJfTsKCglmb3IgKGxldCBpID0gMDsgaSA8IHNuYWNrYmFyaXRlbV9zcHJlYWRfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJc25hY2tiYXJpdGVtX3Byb3BzID0gYXNzaWduKHNuYWNrYmFyaXRlbV9wcm9wcywgc25hY2tiYXJpdGVtX3NwcmVhZF9sZXZlbHNbaV0pOwoJfQoKCXNuYWNrYmFyaXRlbSA9IG5ldyBTbmFja2Jhckl0ZW0kMSh7IHByb3BzOiBzbmFja2Jhcml0ZW1fcHJvcHMgfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KHNuYWNrYmFyaXRlbS4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudChzbmFja2Jhcml0ZW0sIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3Qgc25hY2tiYXJpdGVtX2NoYW5nZXMgPSAoZGlydHkgJiAvKmV4dHJhT3B0aW9ucyovIDIpCgkJCT8gZ2V0X3NwcmVhZF91cGRhdGUoc25hY2tiYXJpdGVtX3NwcmVhZF9sZXZlbHMsIFtnZXRfc3ByZWFkX29iamVjdCgvKmV4dHJhT3B0aW9ucyovIGN0eFsxXSldKQoJCQk6IHt9OwoKCQkJaWYgKGRpcnR5ICYgLyokJHNjb3BlLCBzbmFja2JhciovIDIwNTIpIHsKCQkJCXNuYWNrYmFyaXRlbV9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJc25hY2tiYXJpdGVtLiRzZXQoc25hY2tiYXJpdGVtX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKHNuYWNrYmFyaXRlbS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoc25hY2tiYXJpdGVtLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWRlc3Ryb3lfY29tcG9uZW50KHNuYWNrYmFyaXRlbSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkNyhjdHgpIHsKCWxldCBpZl9ibG9ja19hbmNob3I7CglsZXQgY3VycmVudDsKCWxldCBpZl9ibG9jayA9IC8qc25hY2tiYXIqLyBjdHhbMl0gJiYgY3JlYXRlX2lmX2Jsb2NrJDMoY3R4KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2suYygpOwoJCQlpZl9ibG9ja19hbmNob3IgPSBlbXB0eSgpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLm0odGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBpZl9ibG9ja19hbmNob3IsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKC8qc25hY2tiYXIqLyBjdHhbMl0pIHsKCQkJCWlmIChpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgoJCQkJCWlmIChkaXJ0eSAmIC8qc25hY2tiYXIqLyA0KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sgPSBjcmVhdGVfaWZfYmxvY2skMyhjdHgpOwoJCQkJCWlmX2Jsb2NrLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrLCAxKTsKCQkJCQlpZl9ibG9jay5tKGlmX2Jsb2NrX2FuY2hvci5wYXJlbnROb2RlLCBpZl9ibG9ja19hbmNob3IpOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jaywgMSwgMSwgKCkgPT4gewoJCQkJCWlmX2Jsb2NrID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2spOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2spOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goaWZfYmxvY2tfYW5jaG9yKTsKCQkJfQoKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkNygkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgZXh0cmFXcmFwcGVyT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoJbGV0IHsgZXh0cmFPcHRpb25zID0ge30gfSA9ICQkcHJvcHM7CgoJY29uc3Qgc2hvdyA9ICh7IG1lc3NhZ2UsIGFjdGlvbnMgPSB7fSwgY2xvc2FibGUgPSBmYWxzZSwgdGltZW91dCA9IDRlMyB9KSA9PiB7CgkJJCRpbnZhbGlkYXRlKDIsIHNuYWNrYmFyID0geyBtZXNzYWdlLCBhY3Rpb25zLCBjbG9zYWJsZSwgdGltZW91dCB9KTsKCQljbGVhclRpbWVvdXQodGltZW91dElkKTsKCgkJaWYgKHRpbWVvdXQpIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoCgkJCSgpID0+IHsKCQkJCSQkaW52YWxpZGF0ZSgyLCBzbmFja2JhciA9IHZvaWQgMCk7CgkJCX0sCgkJCXRpbWVvdXQKCQkpOwoJfTsKCglsZXQgc25hY2tiYXI7CglsZXQgdGltZW91dElkOwoKCW9uRGVzdHJveSgoKSA9PiB7CgkJY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7Cgl9KTsKCgljb25zdCBjbGlja19oYW5kbGVyID0gYWN0aW9uID0+IHsKCQkkJGludmFsaWRhdGUoMiwgc25hY2tiYXIgPSB1bmRlZmluZWQpOwoJCWFjdGlvbigpOwoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyXzEgPSAoKSA9PiB7CgkJJCRpbnZhbGlkYXRlKDIsIHNuYWNrYmFyID0gdW5kZWZpbmVkKTsKCX07CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdleHRyYVdyYXBwZXJPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgZXh0cmFXcmFwcGVyT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFXcmFwcGVyT3B0aW9ucyk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7Cgl9OwoKCXJldHVybiBbCgkJZXh0cmFXcmFwcGVyT3B0aW9ucywKCQlleHRyYU9wdGlvbnMsCgkJc25hY2tiYXIsCgkJc2hvdywKCQljbGlja19oYW5kbGVyLAoJCWNsaWNrX2hhbmRsZXJfMQoJXTsKfQoKY2xhc3MgU25hY2tiYXJBbmltIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDcsIGNyZWF0ZV9mcmFnbWVudCQ3LCBzYWZlX25vdF9lcXVhbCwgewoJCQlleHRyYVdyYXBwZXJPcHRpb25zOiAwLAoJCQlleHRyYU9wdGlvbnM6IDEsCgkJCXNob3c6IDMKCQl9KTsKCX0KCglnZXQgc2hvdygpIHsKCQlyZXR1cm4gdGhpcy4kJC5jdHhbM107Cgl9Cn0KCmNvbnN0IFNuYWNrYmFyQW5pbSQxID0gU25hY2tiYXJBbmltOwoKY29uc3QgQ2lyY3VsYXJQcm9ncmVzc0luZGV0ZXJtaW5hdGVfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuNC9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvZm9ybXMvQ2lyY3VsYXJQcm9ncmVzc0luZGV0ZXJtaW5hdGUuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkNihjdHgpIHsKCWxldCBzdmc7CglsZXQgY2lyY2xlOwoJbGV0IHN2Z19zdHlsZV92YWx1ZTsKCglsZXQgc3ZnX2xldmVscyA9IFsKCQl7IHZpZXdCb3g6ICIwIDAgNDggNDgiIH0sCgkJeyB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB9LAoJCXsgY2xhc3M6ICJtMy1jb250YWluZXIiIH0sCgkJewoJCQlzdHlsZTogc3ZnX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIKCQl9LAoJCXsgcm9sZTogInByb2dyZXNzYmFyIiB9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgldOwoKCWxldCBzdmdfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgc3ZnX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCXN2Z19kYXRhID0gYXNzaWduKHN2Z19kYXRhLCBzdmdfbGV2ZWxzW2ldKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCXN2ZyA9IHN2Z19lbGVtZW50KCJzdmciKTsKCQkJY2lyY2xlID0gc3ZnX2VsZW1lbnQoImNpcmNsZSIpOwoJCQlhdHRyKGNpcmNsZSwgImN4IiwgIjI0Iik7CgkJCWF0dHIoY2lyY2xlLCAiY3kiLCAiMjQiKTsKCQkJYXR0cihjaXJjbGUsICJyIiwgIjIwIik7CgkJCWF0dHIoY2lyY2xlLCAic3Ryb2tlIiwgInJnYih2YXIoLS1tMy1zY2hlbWUtcHJpbWFyeSkpIik7CgkJCWF0dHIoY2lyY2xlLCAic3Ryb2tlLXdpZHRoIiwgIjQiKTsKCQkJYXR0cihjaXJjbGUsICJzdHJva2UtZGFzaGFycmF5IiwgIjEyNS42NiAxMjUuNjYiKTsKCQkJYXR0cihjaXJjbGUsICJmaWxsIiwgIm5vbmUiKTsKCQkJYXR0cihjaXJjbGUsICJjbGFzcyIsICJzdmVsdGUtMWxyeHJobSIpOwoJCQlzZXRfc3ZnX2F0dHJpYnV0ZXMoc3ZnLCBzdmdfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhzdmcsICJzdmVsdGUtMWxyeHJobSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBzdmcsIGFuY2hvcik7CgkJCWFwcGVuZChzdmcsIGNpcmNsZSk7CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlzZXRfc3ZnX2F0dHJpYnV0ZXMoc3ZnLCBzdmdfZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKHN2Z19sZXZlbHMsIFsKCQkJCXsgdmlld0JveDogIjAgMCA0OCA0OCIgfSwKCQkJCXsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgfSwKCQkJCXsgY2xhc3M6ICJtMy1jb250YWluZXIiIH0sCgkJCQlkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgc3ZnX3N0eWxlX3ZhbHVlICE9PSAoc3ZnX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIpICYmIHsgc3R5bGU6IHN2Z19zdHlsZV92YWx1ZSB9LAoJCQkJeyByb2xlOiAicHJvZ3Jlc3NiYXIiIH0sCgkJCQlkaXJ0eSAmIC8qZXh0cmFPcHRpb25zKi8gMiAmJiAvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJCQldKSk7CgoJCQl0b2dnbGVfY2xhc3Moc3ZnLCAic3ZlbHRlLTFscnhyaG0iLCB0cnVlKTsKCQl9LAoJCWk6IG5vb3AkNCwKCQlvOiBub29wJDQsCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHN2Zyk7CgkJCX0KCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ2KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyBkaXNwbGF5ID0gImlubGluZS1mbGV4IiB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZGlzcGxheScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGRpc3BsYXkgPSAkJHByb3BzLmRpc3BsYXkpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJfTsKCglyZXR1cm4gW2Rpc3BsYXksIGV4dHJhT3B0aW9uc107Cn0KCmNsYXNzIENpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkNiwgY3JlYXRlX2ZyYWdtZW50JDYsIHNhZmVfbm90X2VxdWFsLCB7IGRpc3BsYXk6IDAsIGV4dHJhT3B0aW9uczogMSB9KTsKCX0KfQoKY29uc3QgQ2lyY3VsYXJQcm9ncmVzc0luZGV0ZXJtaW5hdGUkMSA9IENpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlOwoKY29uc3QgUmFkaW9BbmltMl9zdmVsdGVfc3ZlbHRlX3R5cGVfc3R5bGVfbGFuZyA9ICcnOwoKLyogaG9tZS9jZS9Eb2N1bWVudHMvR2l0SHViL2FkcmlmdC9ub2RlX21vZHVsZXMvLnBucG0vbTMtc3ZlbHRlQDIuMC40L25vZGVfbW9kdWxlcy9tMy1zdmVsdGUvcGFja2FnZS9mb3Jtcy9SYWRpb0FuaW0yLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDUoY3R4KSB7CglsZXQgZGl2MTsKCWxldCB0OwoJbGV0IGRpdjA7CglsZXQgZGl2MV9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJY29uc3QgZGVmYXVsdF9zbG90X3RlbXBsYXRlID0gLyojc2xvdHMqLyBjdHhbM10uZGVmYXVsdDsKCWNvbnN0IGRlZmF1bHRfc2xvdCA9IGNyZWF0ZV9zbG90KGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgY3R4LCAvKiQkc2NvcGUqLyBjdHhbMl0sIG51bGwpOwoKCWxldCBkaXYxX2xldmVscyA9IFsKCQl7IGNsYXNzOiAibTMtY29udGFpbmVyIiB9LAoJCXsKCQkJc3R5bGU6IGRpdjFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFswXSArICI7IgoJCX0sCgkJLypleHRyYU9wdGlvbnMqLyBjdHhbMV0KCV07CgoJbGV0IGRpdl9kYXRhXzEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGRpdjFfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJZGl2X2RhdGFfMSA9IGFzc2lnbihkaXZfZGF0YV8xLCBkaXYxX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYxID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5jKCk7CgkJCXQgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCWF0dHIoZGl2MCwgImNsYXNzIiwgImxheWVyIHN2ZWx0ZS1qMDFsaGkiKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2MSwgZGl2X2RhdGFfMSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAic3ZlbHRlLWowMWxoaSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYxLCBhbmNob3IpOwoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJZGVmYXVsdF9zbG90Lm0oZGl2MSwgbnVsbCk7CgkJCX0KCgkJCWFwcGVuZChkaXYxLCB0KTsKCQkJYXBwZW5kKGRpdjEsIGRpdjApOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWlmIChkZWZhdWx0X3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyA0KSkgewoJCQkJCXVwZGF0ZV9zbG90X2Jhc2UoCgkJCQkJCWRlZmF1bHRfc2xvdCwKCQkJCQkJZGVmYXVsdF9zbG90X3RlbXBsYXRlLAoJCQkJCQljdHgsCgkJCQkJCS8qJCRzY29wZSovIGN0eFsyXSwKCQkJCQkJIWN1cnJlbnQKCQkJCQkJPyBnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGUoLyokJHNjb3BlKi8gY3R4WzJdKQoJCQkJCQk6IGdldF9zbG90X2NoYW5nZXMoZGVmYXVsdF9zbG90X3RlbXBsYXRlLCAvKiQkc2NvcGUqLyBjdHhbMl0sIGRpcnR5LCBudWxsKSwKCQkJCQkJbnVsbAoJCQkJCSk7CgkJCQl9CgkJCX0KCgkJCXNldF9hdHRyaWJ1dGVzKGRpdjEsIGRpdl9kYXRhXzEgPSBnZXRfc3ByZWFkX3VwZGF0ZShkaXYxX2xldmVscywgWwoJCQkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgZGl2MV9zdHlsZV92YWx1ZSAhPT0gKGRpdjFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFswXSArICI7IikpICYmIHsgc3R5bGU6IGRpdjFfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAic3ZlbHRlLWowMWxoaSIsIHRydWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYxKTsKCQkJfQoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgZGVmYXVsdF9zbG90LmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ1KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyAkJHNsb3RzOiBzbG90cyA9IHt9LCAkJHNjb3BlIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzcGxheSA9ICJpbmxpbmUtZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2Rpc3BsYXknIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCBkaXNwbGF5ID0gJCRwcm9wcy5kaXNwbGF5KTsKCQlpZiAoJ2V4dHJhT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGV4dHJhT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFPcHRpb25zKTsKCQlpZiAoJyQkc2NvcGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCAkJHNjb3BlID0gJCRwcm9wcy4kJHNjb3BlKTsKCX07CgoJcmV0dXJuIFtkaXNwbGF5LCBleHRyYU9wdGlvbnMsICQkc2NvcGUsIHNsb3RzXTsKfQoKY2xhc3MgUmFkaW9BbmltMiBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDUsIGNyZWF0ZV9mcmFnbWVudCQ1LCBzYWZlX25vdF9lcXVhbCwgeyBkaXNwbGF5OiAwLCBleHRyYU9wdGlvbnM6IDEgfSk7Cgl9Cn0KCmNvbnN0IFJhZGlvQW5pbTIkMSA9IFJhZGlvQW5pbTI7Cgpjb25zdCBUZXh0RmllbGRfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuNC9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvZm9ybXMvVGV4dEZpZWxkLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzEkMShjdHgpIHsKCWxldCBpY29uOwoJbGV0IGN1cnJlbnQ7CgoJaWNvbiA9IG5ldyBJY29uKHsKCQkJcHJvcHM6IHsKCQkJCWljb246IC8qbGVhZGluZ0ljb24qLyBjdHhbNV0sCgkJCQljbGFzczogImxlYWRpbmciCgkJCX0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQoaWNvbi4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudChpY29uLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IGljb25fY2hhbmdlcyA9IHt9OwoJCQlpZiAoZGlydHkgJiAvKmxlYWRpbmdJY29uKi8gMzIpIGljb25fY2hhbmdlcy5pY29uID0gLypsZWFkaW5nSWNvbiovIGN0eFs1XTsKCQkJaWNvbi4kc2V0KGljb25fY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCi8vICgyOToyKSB7I2lmIHRyYWlsaW5nSWNvbn0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrJDIoY3R4KSB7CglsZXQgYnV0dG9uOwoJbGV0IGljb247CglsZXQgY3VycmVudDsKCWxldCBtb3VudGVkOwoJbGV0IGRpc3Bvc2U7CglpY29uID0gbmV3IEljb24oeyBwcm9wczogeyBpY29uOiAvKnRyYWlsaW5nSWNvbiovIGN0eFs2XSB9IH0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJYnV0dG9uID0gZWxlbWVudCgiYnV0dG9uIik7CgkJCWNyZWF0ZV9jb21wb25lbnQoaWNvbi4kJC5mcmFnbWVudCk7CgkJCWF0dHIoYnV0dG9uLCAiY2xhc3MiLCAidHJhaWxpbmcgc3ZlbHRlLWdhdjNqeSIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBidXR0b24sIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChpY29uLCBidXR0b24sIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCgkJCWlmICghbW91bnRlZCkgewoJCQkJZGlzcG9zZSA9IGxpc3RlbihidXR0b24sICJjbGljayIsIC8qY2xpY2tfaGFuZGxlciovIGN0eFsxMl0pOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBpY29uX2NoYW5nZXMgPSB7fTsKCQkJaWYgKGRpcnR5ICYgLyp0cmFpbGluZ0ljb24qLyA2NCkgaWNvbl9jaGFuZ2VzLmljb24gPSAvKnRyYWlsaW5nSWNvbiovIGN0eFs2XTsKCQkJaWNvbi4kc2V0KGljb25fY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goYnV0dG9uKTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbik7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJZGlzcG9zZSgpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCQ0KGN0eCkgewoJbGV0IGRpdjE7CglsZXQgaW5wdXQ7CglsZXQgdDA7CglsZXQgbGFiZWw7CglsZXQgdDE7CglsZXQgdDI7CglsZXQgZGl2MDsKCWxldCB0MzsKCWxldCB0NDsKCWxldCBkaXYxX3N0eWxlX3ZhbHVlOwoJbGV0IGN1cnJlbnQ7CglsZXQgbW91bnRlZDsKCWxldCBkaXNwb3NlOwoKCWxldCBpbnB1dF9sZXZlbHMgPSBbCgkJeyBjbGFzczogIm0zLWZvbnQtYm9keS1sYXJnZSIgfSwKCQl7IHBsYWNlaG9sZGVyOiAiICIgfSwKCQl7IGlkOiAvKmlkKi8gY3R4WzEwXSB9LAoJCXsgZGlzYWJsZWQ6IC8qZGlzYWJsZWQqLyBjdHhbN10gfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFszXQoJXTsKCglsZXQgaW5wdXRfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJaW5wdXRfZGF0YSA9IGFzc2lnbihpbnB1dF9kYXRhLCBpbnB1dF9sZXZlbHNbaV0pOwoJfQoKCWxldCBpZl9ibG9jazAgPSAvKmxlYWRpbmdJY29uKi8gY3R4WzVdICYmIGNyZWF0ZV9pZl9ibG9ja18xJDEoY3R4KTsKCWxldCBpZl9ibG9jazEgPSAvKnRyYWlsaW5nSWNvbiovIGN0eFs2XSAmJiBjcmVhdGVfaWZfYmxvY2skMihjdHgpOwoKCWxldCBkaXYxX2xldmVscyA9IFsKCQl7IGNsYXNzOiAibTMtY29udGFpbmVyIiB9LAoJCXsKCQkJc3R5bGU6IGRpdjFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFsxXQoJCX0sCgkJLypleHRyYVdyYXBwZXJPcHRpb25zKi8gY3R4WzJdCgldOwoKCWxldCBkaXZfZGF0YV8xID0ge307CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBkaXYxX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWRpdl9kYXRhXzEgPSBhc3NpZ24oZGl2X2RhdGFfMSwgZGl2MV9sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQlpbnB1dCA9IGVsZW1lbnQoImlucHV0Iik7CgkJCXQwID0gc3BhY2UoKTsKCQkJbGFiZWwgPSBlbGVtZW50KCJsYWJlbCIpOwoJCQl0MSA9IHRleHQoLypuYW1lKi8gY3R4WzRdKTsKCQkJdDIgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCXQzID0gc3BhY2UoKTsKCQkJaWYgKGlmX2Jsb2NrMCkgaWZfYmxvY2swLmMoKTsKCQkJdDQgPSBzcGFjZSgpOwoJCQlpZiAoaWZfYmxvY2sxKSBpZl9ibG9jazEuYygpOwoJCQlzZXRfYXR0cmlidXRlcyhpbnB1dCwgaW5wdXRfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhpbnB1dCwgInN2ZWx0ZS1nYXYzankiLCB0cnVlKTsKCQkJYXR0cihsYWJlbCwgImNsYXNzIiwgIm0zLWZvbnQtYm9keS1sYXJnZSBzdmVsdGUtZ2F2M2p5Iik7CgkJCWF0dHIobGFiZWwsICJmb3IiLCAvKmlkKi8gY3R4WzEwXSk7CgkJCWF0dHIoZGl2MCwgImNsYXNzIiwgImxheWVyIHN2ZWx0ZS1nYXYzankiKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2MSwgZGl2X2RhdGFfMSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAibGVhZGluZy1pY29uIiwgLypsZWFkaW5nSWNvbiovIGN0eFs1XSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAiZXJyb3IiLCAvKmVycm9yKi8gY3R4WzhdKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdjEsICJzdmVsdGUtZ2F2M2p5IiwgdHJ1ZSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdjEsIGFuY2hvcik7CgkJCWFwcGVuZChkaXYxLCBpbnB1dCk7CgkJCWlmIChpbnB1dC5hdXRvZm9jdXMpIGlucHV0LmZvY3VzKCk7CgkJCXNldF9pbnB1dF92YWx1ZShpbnB1dCwgLyp2YWx1ZSovIGN0eFswXSk7CgkJCWFwcGVuZChkaXYxLCB0MCk7CgkJCWFwcGVuZChkaXYxLCBsYWJlbCk7CgkJCWFwcGVuZChsYWJlbCwgdDEpOwoJCQlhcHBlbmQoZGl2MSwgdDIpOwoJCQlhcHBlbmQoZGl2MSwgZGl2MCk7CgkJCWFwcGVuZChkaXYxLCB0Myk7CgkJCWlmIChpZl9ibG9jazApIGlmX2Jsb2NrMC5tKGRpdjEsIG51bGwpOwoJCQlhcHBlbmQoZGl2MSwgdDQpOwoJCQlpZiAoaWZfYmxvY2sxKSBpZl9ibG9jazEubShkaXYxLCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oaW5wdXQsICJpbnB1dCIsIC8qaW5wdXRfaW5wdXRfaGFuZGxlciovIGN0eFsxMV0pOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCXNldF9hdHRyaWJ1dGVzKGlucHV0LCBpbnB1dF9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoaW5wdXRfbGV2ZWxzLCBbCgkJCQl7IGNsYXNzOiAibTMtZm9udC1ib2R5LWxhcmdlIiB9LAoJCQkJeyBwbGFjZWhvbGRlcjogIiAiIH0sCgkJCQl7IGlkOiAvKmlkKi8gY3R4WzEwXSB9LAoJCQkJKCFjdXJyZW50IHx8IGRpcnR5ICYgLypkaXNhYmxlZCovIDEyOCkgJiYgeyBkaXNhYmxlZDogLypkaXNhYmxlZCovIGN0eFs3XSB9LAoJCQkJZGlydHkgJiAvKmV4dHJhT3B0aW9ucyovIDggJiYgLypleHRyYU9wdGlvbnMqLyBjdHhbM10KCQkJXSkpOwoKCQkJaWYgKGRpcnR5ICYgLyp2YWx1ZSovIDEgJiYgaW5wdXQudmFsdWUgIT09IC8qdmFsdWUqLyBjdHhbMF0pIHsKCQkJCXNldF9pbnB1dF92YWx1ZShpbnB1dCwgLyp2YWx1ZSovIGN0eFswXSk7CgkJCX0KCgkJCXRvZ2dsZV9jbGFzcyhpbnB1dCwgInN2ZWx0ZS1nYXYzankiLCB0cnVlKTsKCQkJaWYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLypuYW1lKi8gMTYpIHNldF9kYXRhKHQxLCAvKm5hbWUqLyBjdHhbNF0pOwoKCQkJaWYgKC8qbGVhZGluZ0ljb24qLyBjdHhbNV0pIHsKCQkJCWlmIChpZl9ibG9jazApIHsKCQkJCQlpZl9ibG9jazAucChjdHgsIGRpcnR5KTsKCgkJCQkJaWYgKGRpcnR5ICYgLypsZWFkaW5nSWNvbiovIDMyKSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2swLCAxKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrMCA9IGNyZWF0ZV9pZl9ibG9ja18xJDEoY3R4KTsKCQkJCQlpZl9ibG9jazAuYygpOwoJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2swLCAxKTsKCQkJCQlpZl9ibG9jazAubShkaXYxLCB0NCk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2swKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jazAsIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jazAgPSBudWxsOwoJCQkJfSk7CgoJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCX0KCgkJCWlmICgvKnRyYWlsaW5nSWNvbiovIGN0eFs2XSkgewoJCQkJaWYgKGlmX2Jsb2NrMSkgewoJCQkJCWlmX2Jsb2NrMS5wKGN0eCwgZGlydHkpOwoKCQkJCQlpZiAoZGlydHkgJiAvKnRyYWlsaW5nSWNvbiovIDY0KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2sxLCAxKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrMSA9IGNyZWF0ZV9pZl9ibG9jayQyKGN0eCk7CgkJCQkJaWZfYmxvY2sxLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMSwgMSk7CgkJCQkJaWZfYmxvY2sxLm0oZGl2MSwgbnVsbCk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2sxKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jazEsIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jazEgPSBudWxsOwoJCQkJfSk7CgoJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCX0KCgkJCXNldF9hdHRyaWJ1dGVzKGRpdjEsIGRpdl9kYXRhXzEgPSBnZXRfc3ByZWFkX3VwZGF0ZShkaXYxX2xldmVscywgWwoJCQkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDIgJiYgZGl2MV9zdHlsZV92YWx1ZSAhPT0gKGRpdjFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFsxXSkpICYmIHsgc3R5bGU6IGRpdjFfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYVdyYXBwZXJPcHRpb25zKi8gNCAmJiAvKmV4dHJhV3JhcHBlck9wdGlvbnMqLyBjdHhbMl0KCQkJXSkpOwoKCQkJdG9nZ2xlX2NsYXNzKGRpdjEsICJsZWFkaW5nLWljb24iLCAvKmxlYWRpbmdJY29uKi8gY3R4WzVdKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdjEsICJlcnJvciIsIC8qZXJyb3IqLyBjdHhbOF0pOwoJCQl0b2dnbGVfY2xhc3MoZGl2MSwgInN2ZWx0ZS1nYXYzankiLCB0cnVlKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jazApOwoJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMSk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jazApOwoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jazEpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2MSk7CgkJCX0KCgkJCWlmIChpZl9ibG9jazApIGlmX2Jsb2NrMC5kKCk7CgkJCWlmIChpZl9ibG9jazEpIGlmX2Jsb2NrMS5kKCk7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJZGlzcG9zZSgpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJDQoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7IGRpc3BsYXkgPSAiaW5saW5lLWZsZXgiIH0gPSAkJHByb3BzOwoJbGV0IHsgZXh0cmFXcmFwcGVyT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoJbGV0IHsgZXh0cmFPcHRpb25zID0ge30gfSA9ICQkcHJvcHM7CglsZXQgeyBuYW1lIH0gPSAkJHByb3BzOwoJbGV0IHsgbGVhZGluZ0ljb24gPSB2b2lkIDAgfSA9ICQkcHJvcHM7CglsZXQgeyB0cmFpbGluZ0ljb24gPSB2b2lkIDAgfSA9ICQkcHJvcHM7CglsZXQgeyBkaXNhYmxlZCA9IGZhbHNlIH0gPSAkJHByb3BzOwoJbGV0IHsgZXJyb3IgPSBmYWxzZSB9ID0gJCRwcm9wczsKCWxldCB7IHZhbHVlID0gIiIgfSA9ICQkcHJvcHM7Cgljb25zdCBkaXNwYXRjaCA9IGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcigpOwoJY29uc3QgaWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpOwoKCWZ1bmN0aW9uIGlucHV0X2lucHV0X2hhbmRsZXIoKSB7CgkJdmFsdWUgPSB0aGlzLnZhbHVlOwoJCSQkaW52YWxpZGF0ZSgwLCB2YWx1ZSk7Cgl9CgoJY29uc3QgY2xpY2tfaGFuZGxlciA9ICgpID0+IGRpc3BhdGNoKCJ0cmFpbGluZ0NsaWNrIik7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYVdyYXBwZXJPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgZXh0cmFXcmFwcGVyT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFXcmFwcGVyT3B0aW9ucyk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgzLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCduYW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoNCwgbmFtZSA9ICQkcHJvcHMubmFtZSk7CgkJaWYgKCdsZWFkaW5nSWNvbicgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDUsIGxlYWRpbmdJY29uID0gJCRwcm9wcy5sZWFkaW5nSWNvbik7CgkJaWYgKCd0cmFpbGluZ0ljb24nIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg2LCB0cmFpbGluZ0ljb24gPSAkJHByb3BzLnRyYWlsaW5nSWNvbik7CgkJaWYgKCdkaXNhYmxlZCcgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDcsIGRpc2FibGVkID0gJCRwcm9wcy5kaXNhYmxlZCk7CgkJaWYgKCdlcnJvcicgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDgsIGVycm9yID0gJCRwcm9wcy5lcnJvcik7CgkJaWYgKCd2YWx1ZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIHZhbHVlID0gJCRwcm9wcy52YWx1ZSk7Cgl9OwoKCXJldHVybiBbCgkJdmFsdWUsCgkJZGlzcGxheSwKCQlleHRyYVdyYXBwZXJPcHRpb25zLAoJCWV4dHJhT3B0aW9ucywKCQluYW1lLAoJCWxlYWRpbmdJY29uLAoJCXRyYWlsaW5nSWNvbiwKCQlkaXNhYmxlZCwKCQllcnJvciwKCQlkaXNwYXRjaCwKCQlpZCwKCQlpbnB1dF9pbnB1dF9oYW5kbGVyLAoJCWNsaWNrX2hhbmRsZXIKCV07Cn0KCmNsYXNzIFRleHRGaWVsZCBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQ0LCBjcmVhdGVfZnJhZ21lbnQkNCwgc2FmZV9ub3RfZXF1YWwsIHsKCQkJZGlzcGxheTogMSwKCQkJZXh0cmFXcmFwcGVyT3B0aW9uczogMiwKCQkJZXh0cmFPcHRpb25zOiAzLAoJCQluYW1lOiA0LAoJCQlsZWFkaW5nSWNvbjogNSwKCQkJdHJhaWxpbmdJY29uOiA2LAoJCQlkaXNhYmxlZDogNywKCQkJZXJyb3I6IDgsCgkJCXZhbHVlOiAwCgkJfSk7Cgl9Cn0KCmNvbnN0IFRleHRGaWVsZCQxID0gVGV4dEZpZWxkOwoKY29uc3QgRGl2aWRlcl9zdmVsdGVfc3ZlbHRlX3R5cGVfc3R5bGVfbGFuZyA9ICcnOwoKLyogaG9tZS9jZS9Eb2N1bWVudHMvR2l0SHViL2FkcmlmdC9ub2RlX21vZHVsZXMvLnBucG0vbTMtc3ZlbHRlQDIuMC40L25vZGVfbW9kdWxlcy9tMy1zdmVsdGUvcGFja2FnZS91dGlscy9EaXZpZGVyLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDMoY3R4KSB7CglsZXQgaHI7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlociA9IGVsZW1lbnQoImhyIik7CgkJCWF0dHIoaHIsICJjbGFzcyIsICJzdmVsdGUtcXM4N3JyIik7CgkJCXRvZ2dsZV9jbGFzcyhociwgImluc2V0IiwgLyppbnNldCovIGN0eFswXSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGhyLCBhbmNob3IpOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKGRpcnR5ICYgLyppbnNldCovIDEpIHsKCQkJCXRvZ2dsZV9jbGFzcyhociwgImluc2V0IiwgLyppbnNldCovIGN0eFswXSk7CgkJCX0KCQl9LAoJCWk6IG5vb3AkNCwKCQlvOiBub29wJDQsCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGhyKTsKCQkJfQoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJDMoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7IGluc2V0ID0gZmFsc2UgfSA9ICQkcHJvcHM7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdpbnNldCcgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGluc2V0ID0gJCRwcm9wcy5pbnNldCk7Cgl9OwoKCXJldHVybiBbaW5zZXRdOwp9CgpjbGFzcyBEaXZpZGVyIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkMywgY3JlYXRlX2ZyYWdtZW50JDMsIHNhZmVfbm90X2VxdWFsLCB7IGluc2V0OiAwIH0pOwoJfQp9Cgpjb25zdCBEaXZpZGVyJDEgPSBEaXZpZGVyOwoKLy8gVGhlIHVzZXIgbGlrZWx5IGhhcyBvdmVyd3JpdHRlbiBhbGwgbmV0d29ya2luZyBmdW5jdGlvbnMgYWZ0ZXIgaW1wb3J0aW5nIGJhcmUtY2xpZW50Ci8vIEl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUgY29tcG9uZW50cyBvZiBCYXJlLUNsaWVudCBhcmUgdXNpbmcgbmF0aXZlIG5ldHdvcmtpbmcgZnVuY3Rpb25zCi8vIFRoZXNlIGV4cG9ydHMgYXJlIHByb3ZpZGVkIHRvIHBsdWdpbnMgYnkgQHJvbGx1cC9wbHVnaW4taW5qZWN0CmNvbnN0IFdlYlNvY2tldCQxID0gZ2xvYmFsVGhpcy5XZWJTb2NrZXQ7CmNvbnN0IFJlc3BvbnNlJDEgPSBnbG9iYWxUaGlzLlJlc3BvbnNlOwoKY29uc3Qgc3RhdHVzRW1wdHkgPSBbMTAxLCAyMDQsIDIwNSwgMzA0XTsKY2xhc3MgQ2xpZW50IHsKfQoKY2xhc3MgUmVtb3RlQ2xpZW50IGV4dGVuZHMgQ2xpZW50IHsKICAgIGNhbGxiYWNrcyA9IHt9OwogICAgdWlkID0gdjQoKTsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgaWYgKCEoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXR0ZW1wdCB0byBjb25zdHJ1Y3QgUmVtb3RlQ2xpZW50IGZyb20gb3V0c2lkZSBhIHNlcnZpY2Ugd29ya2VyIik7CiAgICAgICAgfQogICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEuX19yZW1vdGVfdGFyZ2V0ID09PSB0aGlzLnVpZCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrc1tldmVudC5kYXRhLl9fcmVtb3RlX2lkXTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKGV2ZW50LmRhdGEuX19yZW1vdGVfdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kKG1lc3NhZ2UsIGlkKSB7CiAgICAgICAgY29uc3QgY2xpZW50cyA9IGF3YWl0IHNlbGYuY2xpZW50cy5tYXRjaEFsbCgpOwogICAgICAgIGlmIChjbGllbnRzLmxlbmd0aCA8IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibm8gYXZhaWxhYmxlIGNsaWVudHMiKTsKICAgICAgICBmb3IgKGNvbnN0IGNsaWVudCBvZiBjbGllbnRzKSB7CiAgICAgICAgICAgIGNsaWVudC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBfX3JlbW90ZV90YXJnZXQ6IHRoaXMudWlkLAogICAgICAgICAgICAgICAgX19yZW1vdGVfaWQ6IGlkLAogICAgICAgICAgICAgICAgX19yZW1vdGVfdmFsdWU6IG1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgc2VuZFdpdGhSZXNwb25zZShtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgaWQgPSB2NCgpOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tpZF0gPSByZXNvbHZlOwogICAgICAgICAgICB0aGlzLnNlbmQobWVzc2FnZSwgaWQpOwogICAgICAgIH0pOwogICAgfQogICAgY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgZ2V0UmVxdWVzdEhlYWRlcnMsIG9uTWV0YSwgb25SZWFkeVN0YXRlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBXZWJTb2NrZXQkMSgiIik7CiAgICB9CiAgICBhc3luYyByZXF1ZXN0KG1ldGhvZCwgcmVxdWVzdEhlYWRlcnMsIGJvZHksIHJlbW90ZSwgY2FjaGUsIGR1cGxleCwgc2lnbmFsKSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlbmRXaXRoUmVzcG9uc2UoewogICAgICAgICAgICB0eXBlOiAicmVxdWVzdCIsCiAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgIG1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLAogICAgICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgICAgIHJlbW90ZTogcmVtb3RlLnRvU3RyaW5nKCksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgICAgLy8gY29uc3QgcmVhZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5yZWFkQmFyZVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgUmVzcG9uc2UkMShzdGF0dXNFbXB0eS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpID8gdW5kZWZpbmVkIDogcmVzcG9uc2UuYm9keSwgewogICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cywKICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCA/PyB1bmRlZmluZWQsCiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpLAogICAgICAgIH0pOwogICAgICAgIHJlc3VsdC5yYXdIZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgICByZXN1bHQucmF3UmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQp9CgovLyBnZXQgdGhlIHVuaG9va2VkIHZhbHVlCk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoV2ViU29ja2V0JDEucHJvdG90eXBlLCAncmVhZHlTdGF0ZScpLmdldDsKc2VsZi5CQ0NfVkVSU0lPTiA9ICIxLjIuMSI7CmNvbnNvbGUud2FybigiQkNDX1ZFUlNJT046ICIgKyBzZWxmLkJDQ19WRVJTSU9OKTsKZnVuY3Rpb24gc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uKGltcGxlbWVudGF0aW9uKSB7CiAgICBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24gPSBpbXBsZW1lbnRhdGlvbjsKfQppZiAoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikgewogICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uKG5ldyBSZW1vdGVDbGllbnQoKSk7Cn0KZWxzZSB7CiAgICBsZXQgcGFyZW50ID0gc2VsZjsKICAgIGNvbnNvbGUubG9nKCJhdHRlbXB0aW5nIHRvIGZpbmQgYW4gaW1wbGVtZW50YXRpb24iKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiZm91bmQgaW1wbGVtZW50YXRpb24gb24gcGFyZW50Iik7CiAgICAgICAgICAgICAgICBzZXRCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24ocGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImNvdWxkIG5vdCBmaW5kIGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQoKY2xhc3MgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UpIHsKICAgIHRoaXMub25vcGVuID0gb25vcGVuOwogICAgdGhpcy5vbmNsb3NlID0gb25jbG9zZTsKICAgIHRoaXMub25kYXRhID0gKCkgPT4gewogICAgfTsKICB9Cn0KCmNvbnN0IEMyU1JlcXVlc3RUeXBlcyA9IHsKICBIVFRQUmVxdWVzdFN0YXJ0OiAwLAogIEhUVFBSZXF1ZXN0Q2h1bms6IDEsCiAgSFRUUFJlcXVlc3RFbmQ6IDIsCiAgV1NPcGVuOiAzLAogIFdTQ2xvc2U6IDQsCiAgV1NTZW5kVGV4dDogNSwKICBXU1NlbmRCaW5hcnk6IDYKfTsKY29uc3QgUzJDUmVxdWVzdFR5cGVzID0gewogIEhUVFBSZXNwb25zZVN0YXJ0OiAwLAogIEhUVFBSZXNwb25zZUNodW5rOiAxLAogIEhUVFBSZXNwb25zZUVuZDogMiwKICBXU09wZW46IDMsCiAgV1NDbG9zZTogNCwKICBXU1RleHRTdGFydDogNSwKICBXU0JpbmFyeVN0YXJ0OiA2LAogIFdTRGF0YUNodW5rOiA3LAogIFdTRGF0YUVuZDogOCwKICBXU0Vycm9yOiA5Cn07CmNvbnN0IE1BWF9DSFVOS19TSVpFID0gMTIgKiAxMDI0Owpjb25zdCBTMkNfSEVMTE9fT0sgPSAiOjMiOwpjb25zdCBDMlNfSEVMTE8gPSAiaGFpaWkgIjsKY29uc3QgUzJDX0hFTExPX0VSUiA9ICI6PCAiOwpjb25zdCBQUk9UT0NPTF9WRVJTSU9OJDEgPSAiMy4wIjsKCmNvbnN0IE5VTExfQk9EWV9TVEFUVVNFUyA9IFsxMDEsIDEwMywgMjA0LCAyMDUsIDMwNF07CmZ1bmN0aW9uIGNyZWF0ZUJvZHlTdHJlYW0oYm9keSwgYXJyYXlCdWZmZXJJbXBsKSB7CiAgaWYgKGJvZHkgPT09IG51bGwgfHwgdHlwZW9mIGJvZHkgPT09ICJ1bmRlZmluZWQiKQogICAgcmV0dXJuIG51bGw7CiAgaWYgKHR5cGVvZiBib2R5ID09PSAic3RyaW5nIikgewogICAgYm9keSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShib2R5KTsKICB9CiAgaWYgKHdpbmRvdy5BcnJheUJ1ZmZlci5pc1ZpZXcoYm9keSkpIHsKICAgIGJvZHkgPSBib2R5LmJ1ZmZlci5zbGljZSgKICAgICAgYm9keS5ieXRlT2Zmc2V0LAogICAgICBib2R5LmJ5dGVPZmZzZXQgKyBib2R5LmJ5dGVMZW5ndGgKICAgICk7CiAgfQogIGlmIChib2R5IGluc3RhbmNlb2Ygd2luZG93LkFycmF5QnVmZmVyKSB7CiAgICBpZiAoYm9keS5ieXRlTGVuZ3RoID09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgcmVtYWluaW5nID0gYm9keTsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICB0eXBlOiAiYnl0ZXMiLAogICAgICBwdWxsOiAoY29udHJvbGxlcikgPT4gewogICAgICAgIGlmIChyZW1haW5pbmcuYnl0ZUxlbmd0aCA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjdXJyZW50ID0gcmVtYWluaW5nLnNsaWNlKDAsIE1BWF9DSFVOS19TSVpFKTsKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc2xpY2UoTUFYX0NIVU5LX1NJWkUpOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShuZXcgVWludDhBcnJheShjdXJyZW50KSk7CiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAoYm9keSBpbnN0YW5jZW9mIEZvcm1EYXRhKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoImZvcm1kYXRhIHRvZG8iKTsKICB9CiAgY29uc3QgdHJhbnNmb3JtZXIgPSAoKSA9PiBuZXcgVHJhbnNmb3JtU3RyZWFtKHsKICAgIHRyYW5zZm9ybTogYXN5bmMgKGNodW5rLCBjb250cm9sbGVyKSA9PiB7CiAgICAgIGlmICh0eXBlb2YgY2h1bmsgPT09ICJzdHJpbmciKSB7CiAgICAgICAgY2h1bmsgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoY2h1bmspOwogICAgICB9CiAgICAgIGlmIChjaHVuayBpbnN0YW5jZW9mIEJsb2IpIHsKICAgICAgICBjaHVuayA9IGF3YWl0IGNodW5rLmFycmF5QnVmZmVyKCk7CiAgICAgIH0KICAgICAgaWYgKHdpbmRvdy5BcnJheUJ1ZmZlci5pc1ZpZXcoY2h1bmspKSB7CiAgICAgICAgY2h1bmsgPSBjaHVuay5idWZmZXIuc2xpY2UoCiAgICAgICAgICBjaHVuay5ieXRlT2Zmc2V0LAogICAgICAgICAgY2h1bmsuYnl0ZU9mZnNldCArIGNodW5rLmJ5dGVMZW5ndGgKICAgICAgICApOwogICAgICB9CiAgICAgIGlmICghKGNodW5rIGluc3RhbmNlb2Ygd2luZG93LkFycmF5QnVmZmVyKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoeyBjaHVuayB9KTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdHlwZSByZWFkIGZyb20gYm9keSBzdHJlYW06ICIgKyBjaHVuayk7CiAgICAgIH0KICAgICAgbGV0IGN1cnJlbnQgPSBudWxsOwogICAgICBsZXQgcmVtYWluaW5nID0gY2h1bms7CiAgICAgIGRvIHsKICAgICAgICBjdXJyZW50ID0gcmVtYWluaW5nLnNsaWNlKDAsIE1BWF9DSFVOS19TSVpFKTsKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc2xpY2UoTUFYX0NIVU5LX1NJWkUpOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShuZXcgVWludDhBcnJheShjdXJyZW50KSk7CiAgICAgIH0gd2hpbGUgKHJlbWFpbmluZy5ieXRlTGVuZ3RoID4gMCk7CiAgICB9CiAgfSk7CiAgaWYgKGJvZHkgaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkgewogICAgcmV0dXJuIGJvZHkucGlwZVRocm91Z2godHJhbnNmb3JtZXIoKSk7CiAgfQogIGlmIChib2R5IGluc3RhbmNlb2YgQmxvYikgewogICAgcmV0dXJuIGJvZHkuc3RyZWFtKCkucGlwZVRocm91Z2godHJhbnNmb3JtZXIoKSk7CiAgfQogIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBib2R5IHR5cGU6ICIgKyBib2R5KTsKfQpjbGFzcyBBZHJpZnRCYXJlQ2xpZW50IGV4dGVuZHMgQ2xpZW50IHsKICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjsKICB9CiAgYXN5bmMgcmVxdWVzdChtZXRob2QsIHJlcXVlc3RIZWFkZXJzLCBib2R5LCByZW1vdGUsIGNhY2hlLCBkdXBsZXgsIHNpZ25hbCwgYXJyYXlCdWZmZXJJbXBsKSB7CiAgICBjb25zdCBib2R5U3RyZWFtID0gY3JlYXRlQm9keVN0cmVhbShib2R5KTsKICAgIGxldCB7IHBheWxvYWQsIGJvZHk6IHJlc3BSYXdCb2R5IH0gPSBhd2FpdCB0aGlzLmNvbm5lY3Rpb24uaHR0cHJlcXVlc3QoCiAgICAgIHsKICAgICAgICBtZXRob2QsCiAgICAgICAgcmVxdWVzdEhlYWRlcnMsCiAgICAgICAgcmVtb3RlCiAgICAgIH0sCiAgICAgIGJvZHlTdHJlYW0KICAgICk7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTsKICAgIGZvciAoY29uc3QgW2hlYWRlciwgdmFsdWVzXSBvZiBPYmplY3QuZW50cmllcyhwYXlsb2FkLmhlYWRlcnMpKSB7CiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzKSB7CiAgICAgICAgaGVhZGVycy5hcHBlbmQoaGVhZGVyLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGxldCByZXNwQm9keSA9IHJlc3BSYXdCb2R5OwogICAgaWYgKHJlc3BCb2R5LmJ5dGVMZW5ndGggPT0gMCB8fCBOVUxMX0JPRFlfU1RBVFVTRVMuaW5jbHVkZXMocGF5bG9hZC5zdGF0dXMpKSB7CiAgICAgIHJlc3BCb2R5ID0gbnVsbDsKICAgIH0KICAgIHJldHVybiBuZXcgUmVzcG9uc2UocmVzcEJvZHksIHsKICAgICAgc3RhdHVzOiBwYXlsb2FkLnN0YXR1cywKICAgICAgc3RhdHVzVGV4dDogcGF5bG9hZC5zdGF0dXNUZXh0LAogICAgICBoZWFkZXJzCiAgICB9KTsKICB9CiAgY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgZ2V0UmVxdWVzdEhlYWRlcnMsIG9uTWV0YSwgb25SZWFkeVN0YXRlLCB3ZWJTb2NrZXRJbXBsLCBhcnJheUJ1ZmZlckltcGwpIHsKICAgIGNvbnN0IHdzID0gbmV3IHdlYlNvY2tldEltcGwoIndzczpudWxsIiwgcHJvdG9jb2xzKTsKICAgIGxldCBpbml0YWxDbG9zZUhhcHBlbmVkID0gZmFsc2U7CiAgICB3cy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsIChlKSA9PiB7CiAgICAgIGlmICghaW5pdGFsQ2xvc2VIYXBwZW5lZCkgewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ09OTkVDVElORyk7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICBpbml0YWxDbG9zZUhhcHBlbmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICBsZXQgaW5pdGlhbEVycm9ySGFwcGVuZWQgPSBmYWxzZTsKICAgIHdzLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgKGUpID0+IHsKICAgICAgaWYgKCFpbml0aWFsRXJyb3JIYXBwZW5lZCkgewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ09OTkVDVElORyk7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICBpbml0aWFsRXJyb3JIYXBwZW5lZCA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgbGV0IHsgc2VuZCwgY2xvc2UgfSA9IHRoaXMuY29ubmVjdGlvbi53c2Nvbm5lY3QoCiAgICAgIHJlbW90ZSwKICAgICAgcHJvdG9jb2xzLAogICAgICAocHJvdG9jb2wpID0+IHsKICAgICAgICBvblJlYWR5U3RhdGUoV2ViU29ja2V0Lk9QRU4pOwogICAgICAgIHdzLl9fZGVmaW5lR2V0dGVyX18oInByb3RvY29sIiwgKCkgPT4gewogICAgICAgICAgcmV0dXJuIHByb3RvY29sOwogICAgICAgIH0pOwogICAgICAgIHdzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJvcGVuIikpOwogICAgICB9LAogICAgICAoY29kZSwgcmVhc29uLCB3YXNDbGVhbikgPT4gewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ0xPU0VEKTsKICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBDbG9zZUV2ZW50KCJjbG9zZSIsIHsgY29kZSwgcmVhc29uLCB3YXNDbGVhbiB9KSk7CiAgICAgIH0sCiAgICAgIGFzeW5jIChzdHJlYW0sIGlzQmluYXJ5KSA9PiB7CiAgICAgICAgbGV0IGRhdGEgPSBhd2FpdCBuZXcgUmVzcG9uc2UoCiAgICAgICAgICBzdHJlYW0KICAgICAgICApLmFycmF5QnVmZmVyKCk7CiAgICAgICAgZGF0YS5fX3Byb3RvX18gPSBhcnJheUJ1ZmZlckltcGwucHJvdG90eXBlOwogICAgICAgIGlmICghaXNCaW5hcnkpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRhdGEgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBNZXNzYWdlRXZlbnQoIm1lc3NhZ2UiLCB7IGRhdGEgfSkpOwogICAgICB9LAogICAgICAobWVzc2FnZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHsgbWVzc2FnZSB9KTsKICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBFcnJvckV2ZW50KCJlcnJvciIsIHsgbWVzc2FnZSB9KSk7CiAgICAgIH0sCiAgICAgIGFycmF5QnVmZmVySW1wbAogICAgKTsKICAgIHdzLnNlbmQgPSAoZGF0YSkgPT4gewogICAgICBzZW5kKGRhdGEpOwogICAgfTsKICAgIHdzLmNsb3NlID0gKGNvZGUsIHJlYXNvbikgPT4gewogICAgICBjbG9zZShjb2RlLCByZWFzb24pOwogICAgICBvblJlYWR5U3RhdGUoV2ViU29ja2V0LkNMT1NJTkcpOwogICAgfTsKICAgIHJldHVybiB3czsKICB9Cn0KClJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBhc3luYyBmdW5jdGlvbiogKCkgewogIGNvbnN0IHJlYWRlciA9IHRoaXMuZ2V0UmVhZGVyKCk7CiAgdHJ5IHsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7CiAgICAgIGlmIChkb25lKQogICAgICAgIHJldHVybjsKICAgICAgeWllbGQgdmFsdWU7CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIHJlYWRlci5yZWxlYXNlTG9jaygpOwogIH0KfTsKbGV0IENvbm5lY3Rpb24kMSA9IGNsYXNzIENvbm5lY3Rpb24gewogIGNvbnN0cnVjdG9yKHRyYW5zcG9ydCkgewogICAgdGhpcy50cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICB0aGlzLnJlcXVlc3RDYWxsYmFja3MgPSB7fTsKICAgIHRoaXMub3BlblJlcXVlc3RTdHJlYW1zID0ge307CiAgICB0aGlzLm9wZW5pbmdTb2NrZXRzID0ge307CiAgICB0aGlzLm9wZW5Tb2NrZXRzID0ge307CiAgICB0aGlzLndzTXNnU3RyZWFtcyA9IHt9OwogICAgdGhpcy5jb3VudGVyID0gMDsKICAgIHRyYW5zcG9ydC5vbmRhdGEgPSBDb25uZWN0aW9uLnVuaW5pdGlhbGl6ZWRFcnJvcjsKICB9CiAgc3RhdGljIHVuaW5pdGlhbGl6ZWRFcnJvcigpIHsKICAgIHRocm93IG5ldyBFcnJvcigiQ29ubmVjdGlvbiBub3QgaW5pdGlhbGl6ZWQiKTsKICB9CiAgYXN5bmMgaW5pdGlhbGl6ZSgpIHsKICAgIGNvbnN0IG9uRGF0YVByb21pc2UgPSAoKSA9PiB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzKSA9PiB7CiAgICAgICAgdGhpcy50cmFuc3BvcnQub25kYXRhID0gcmVzOwogICAgICB9KTsKICAgIH07CiAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShDMlNfSEVMTE8gKyBQUk9UT0NPTF9WRVJTSU9OJDEpKTsKICAgIGNvbnN0IG1zZyA9IGF3YWl0IG9uRGF0YVByb21pc2UoKTsKICAgIGNvbnN0IG1zZ1RleHQgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUobXNnKTsKICAgIGlmIChtc2dUZXh0ID09PSBTMkNfSEVMTE9fT0spIHsKICAgICAgdGhpcy50cmFuc3BvcnQub25kYXRhID0gdGhpcy5vbmRhdGEuYmluZCh0aGlzKTsKICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKG1zZ1RleHQuc3RhcnRzV2l0aChTMkNfSEVMTE9fRVJSKSkgewogICAgICBjb25zdCBleHBlY3RlZFZlcnNpb24gPSBtc2dUZXh0LnNsaWNlKFMyQ19IRUxMT19FUlIubGVuZ3RoKTsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGBXZSBhcmUgcnVubmluZyBwcm90b2NvbCB2ZXJzaW9uICR7UFJPVE9DT0xfVkVSU0lPTiQxfSwgYnV0IHNlcnZlciBleHBlY3RlZCAke2V4cGVjdGVkVmVyc2lvbn1gCiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgc2VydmVyIGhlbGxvIHJlc3BvbnNlIik7CiAgICB9CiAgfQogIG5leHRTZXEoKSB7CiAgICByZXR1cm4gKyt0aGlzLmNvdW50ZXI7CiAgfQogIG9uZGF0YShkYXRhKSB7CiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpCiAgICAgIHJldHVybjsKICAgIGxldCBjdXJzb3IgPSAwOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhkYXRhKTsKICAgIGxldCByZXF1ZXN0SUQgPSB2aWV3LmdldFVpbnQxNihjdXJzb3IpOwogICAgY3Vyc29yICs9IDI7CiAgICBsZXQgcmVxdWVzdFR5cGUgPSB2aWV3LmdldFVpbnQ4KGN1cnNvcik7CiAgICBjdXJzb3IgKz0gMTsKICAgIGNvbnN0IG1zZ1RleHQgPSAoKSA9PiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZGF0YS5zbGljZShjdXJzb3IpKTsKICAgIGNvbnN0IG1zZ0pTT04gPSAoKSA9PiBKU09OLnBhcnNlKG1zZ1RleHQoKSk7CiAgICBzd2l0Y2ggKHJlcXVlc3RUeXBlKSB7CiAgICAgIGNhc2UgUzJDUmVxdWVzdFR5cGVzLkhUVFBSZXNwb25zZVN0YXJ0OgogICAgICAgIGNvbnN0IHBheWxvYWQgPSBtc2dKU09OKCk7CiAgICAgICAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHsKICAgICAgICAgIHN0YXJ0OiAoY29udHJvbGxlcikgPT4gewogICAgICAgICAgICB0aGlzLm9wZW5SZXF1ZXN0U3RyZWFtc1tyZXF1ZXN0SURdID0gY29udHJvbGxlcjsKICAgICAgICAgIH0sCiAgICAgICAgICBwdWxsOiAoY29udHJvbGxlcikgPT4gewogICAgICAgICAgfSwKICAgICAgICAgIGNhbmNlbDogKCkgPT4gewogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVxdWVzdENhbGxiYWNrc1tyZXF1ZXN0SURdKHsgcGF5bG9hZCwgYm9keTogc3RyZWFtIH0pOwogICAgICAgIGRlbGV0ZSB0aGlzLnJlcXVlc3RDYWxsYmFja3NbcmVxdWVzdElEXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuSFRUUFJlc3BvbnNlQ2h1bms6CiAgICAgICAgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXT8uZW5xdWV1ZSgKICAgICAgICAgIG5ldyBVaW50OEFycmF5KGRhdGEuc2xpY2UoY3Vyc29yKSkKICAgICAgICApOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5IVFRQUmVzcG9uc2VFbmQ6CiAgICAgICAgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXT8uY2xvc2UoKTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuV1NPcGVuOiB7CiAgICAgICAgY29uc3Qgc29ja2V0TWV0YSA9IHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBpZiAoIXNvY2tldE1ldGEpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSBtc2dKU09OKCk7CiAgICAgICAgZGVsZXRlIHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF0gPSBzb2NrZXRNZXRhOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc29ja2V0TWV0YS5vbm9wZW4ocGF5bG9hZDIucHJvdG9jb2wpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0JpbmFyeVN0YXJ0OgogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU1RleHRTdGFydDogewogICAgICAgIGNvbnN0IHNvY2tldE1ldGEgPSB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF07CiAgICAgICAgaWYgKCFzb2NrZXRNZXRhKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHN0cmVhbTIgPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgc3RhcnQ6IChjb250cm9sbGVyKSA9PiB7CiAgICAgICAgICAgIHRoaXMud3NNc2dTdHJlYW1zW3JlcXVlc3RJRF0gPSBjb250cm9sbGVyOwogICAgICAgICAgfSwKICAgICAgICAgIHB1bGw6IChjb25zdHJvbGxlcikgPT4gewogICAgICAgICAgfSwKICAgICAgICAgIGNhbmNlbDogKCkgPT4gewogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBzb2NrZXRNZXRhLm9ubWVzc2FnZSgKICAgICAgICAgICAgc3RyZWFtMiwKICAgICAgICAgICAgcmVxdWVzdFR5cGUgPT09IFMyQ1JlcXVlc3RUeXBlcy5XU0JpbmFyeVN0YXJ0ID8gdHJ1ZSA6IHJlcXVlc3RUeXBlID09PSBTMkNSZXF1ZXN0VHlwZXMuV1NUZXh0U3RhcnQgPyBmYWxzZSA6ICgoKSA9PiB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnJlYWNoYWJsZSIpOwogICAgICAgICAgICB9KSgpCiAgICAgICAgICApCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0RhdGFDaHVuazogewogICAgICAgIGNvbnN0IHN0cmVhbTIgPSB0aGlzLndzTXNnU3RyZWFtc1tyZXF1ZXN0SURdOwogICAgICAgIHN0cmVhbTI/LmVucXVldWUobmV3IFVpbnQ4QXJyYXkoZGF0YS5zbGljZShjdXJzb3IpKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuV1NEYXRhRW5kOiB7CiAgICAgICAgY29uc3Qgc3RyZWFtMiA9IHRoaXMud3NNc2dTdHJlYW1zW3JlcXVlc3RJRF07CiAgICAgICAgc3RyZWFtMj8uY2xvc2UoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0Nsb3NlOiB7CiAgICAgICAgY29uc3Qgc29ja2V0TWV0YSA9IHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXSB8fCB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF07CiAgICAgICAgaWYgKCFzb2NrZXRNZXRhKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHBheWxvYWQyID0gbXNnSlNPTigpOwogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBzb2NrZXRNZXRhLm9uY2xvc2UoCiAgICAgICAgICAgIHBheWxvYWQyLmNvZGUgfHwgMTAwNSwKICAgICAgICAgICAgcGF5bG9hZDIucmVhc29uIHx8ICIiLAogICAgICAgICAgICAid2FzQ2xlYW4iIGluIHBheWxvYWQyID8gQm9vbGVhbihwYXlsb2FkMi53YXNDbGVhbikgOiBmYWxzZQogICAgICAgICAgKQogICAgICAgICk7CiAgICAgICAgZGVsZXRlIHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tyZXF1ZXN0SURdOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNhc2UgUzJDUmVxdWVzdFR5cGVzLldTRXJyb3I6IHsKICAgICAgICBjb25zdCBzb2NrZXRNZXRhID0gdGhpcy5vcGVuaW5nU29ja2V0c1tyZXF1ZXN0SURdIHx8IHRoaXMub3BlblNvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBpZiAoIXNvY2tldE1ldGEpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSBtc2dKU09OKCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzb2NrZXRNZXRhLm9uZXJyb3IocGF5bG9hZDIubWVzc2FnZSkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGFzeW5jIHNlbmQocmVxdWVzdElELCB0eXBlLCBkYXRhKSB7CiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHsKICAgICAgQ29ubmVjdGlvbi51bmluaXRpYWxpemVkRXJyb3IoKTsKICAgIH0KICAgIGxldCBoZWFkZXIgPSBuZXcgd2luZG93LkFycmF5QnVmZmVyKDIgKyAxKTsKICAgIGxldCB2aWV3ID0gbmV3IERhdGFWaWV3KGhlYWRlcik7CiAgICBsZXQgY3Vyc29yID0gMDsKICAgIHZpZXcuc2V0VWludDE2KGN1cnNvciwgcmVxdWVzdElEKTsKICAgIGN1cnNvciArPSAyOwogICAgdmlldy5zZXRVaW50OChjdXJzb3IsIHR5cGUpOwogICAgY3Vyc29yICs9IDE7CiAgICBsZXQgYnVmID0gaGVhZGVyOwogICAgaWYgKGRhdGEpIHsKICAgICAgYnVmID0gYXdhaXQgbmV3IEJsb2IoW2hlYWRlciwgZGF0YV0pLmFycmF5QnVmZmVyKCk7CiAgICB9CiAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKGJ1Zik7CiAgfQogIGh0dHByZXF1ZXN0KGRhdGEsIGJvZHkpIHsKICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkgewogICAgICBDb25uZWN0aW9uLnVuaW5pdGlhbGl6ZWRFcnJvcigpOwogICAgfQogICAgY29uc3QgcGF5bG9hZCA9IHsgLi4uZGF0YSwgaGFzQm9keTogQm9vbGVhbihib2R5KSB9OwogICAgbGV0IGpzb24gPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4gewogICAgICBsZXQgc2VxID0gdGhpcy5uZXh0U2VxKCk7CiAgICAgIHRoaXMucmVxdWVzdENhbGxiYWNrc1tzZXFdID0gcmVzb2x2ZTsKICAgICAgYXdhaXQgdGhpcy5zZW5kKHNlcSwgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0U3RhcnQsIG5ldyBCbG9iKFtqc29uXSkpOwogICAgICBpZiAocGF5bG9hZC5oYXNCb2R5KSB7CiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiBib2R5KSB7CiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmQoCiAgICAgICAgICAgIHNlcSwKICAgICAgICAgICAgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0Q2h1bmssCiAgICAgICAgICAgIG5ldyBVaW50OEFycmF5KGNodW5rKQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgdGhpcy5zZW5kKHNlcSwgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0RW5kKTsKICAgICAgfQogICAgfSk7CiAgfQogIHdzY29ubmVjdCh1cmwsIHByb3RvY29scywgb25vcGVuLCBvbmNsb3NlLCBvbm1lc3NhZ2UsIG9uZXJyb3IsIGFycmF5QnVmZmVySW1wbCkgewogICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7CiAgICAgIENvbm5lY3Rpb24udW5pbml0aWFsaXplZEVycm9yKCk7CiAgICB9CiAgICBjb25zdCBwYXlsb2FkID0geyB1cmw6IHVybC50b1N0cmluZygpLCBwcm90b2NvbHMgfTsKICAgIGNvbnN0IHBheWxvYWRKU09OID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7CiAgICBsZXQgc2VxID0gdGhpcy5uZXh0U2VxKCk7CiAgICBjb25zdCBjbG9zZVdpdGhFcnJvciA9ICgpID0+IG9uY2xvc2UoMTAwNiwgIiIsIGZhbHNlKTsKICAgIHRoaXMuc2VuZCgKICAgICAgc2VxLAogICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NPcGVuLAogICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocGF5bG9hZEpTT04pCiAgICApLmNhdGNoKChlKSA9PiB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIGNsb3NlV2l0aEVycm9yKCk7CiAgICB9KTsKICAgIHRoaXMub3BlbmluZ1NvY2tldHNbc2VxXSA9IHsKICAgICAgb25vcGVuLAogICAgICBvbm1lc3NhZ2UsCiAgICAgIG9uY2xvc2UsCiAgICAgIG9uZXJyb3IKICAgIH07CiAgICByZXR1cm4gewogICAgICBzZW5kOiAoZGF0YSkgPT4gewogICAgICAgIGlmICghdGhpcy5vcGVuU29ja2V0c1tzZXFdKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInNlbmQgb24gY2xvc2VkIHNvY2tldCIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjbGVhbnVwID0gKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tzZXFdOwogICAgICAgIH07CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgdGhpcy5zZW5kKAogICAgICAgICAgICBzZXEsCiAgICAgICAgICAgIEMyU1JlcXVlc3RUeXBlcy5XU1NlbmRUZXh0LAogICAgICAgICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZGF0YSkKICAgICAgICAgICkuY2F0Y2goY2xlYW51cCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgYXJyYXlCdWZmZXJJbXBsKSB7CiAgICAgICAgICB0aGlzLnNlbmQoc2VxLCBDMlNSZXF1ZXN0VHlwZXMuV1NTZW5kQmluYXJ5LCBkYXRhKS5jYXRjaChjbGVhbnVwKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGFycmF5QnVmZmVySW1wbC5pc1ZpZXcoZGF0YSkpIHsKICAgICAgICAgIHRoaXMuc2VuZCgKICAgICAgICAgICAgc2VxLAogICAgICAgICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NTZW5kQmluYXJ5LAogICAgICAgICAgICBkYXRhLmJ1ZmZlci5zbGljZSgKICAgICAgICAgICAgICBkYXRhLmJ5dGVPZmZzZXQsCiAgICAgICAgICAgICAgZGF0YS5ieXRlT2Zmc2V0ICsgZGF0YS5ieXRlTGVuZ3RoCiAgICAgICAgICAgICkKICAgICAgICAgICkuY2F0Y2goY2xlYW51cCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUuZXJyb3IoeyBkYXRhIH0pOwogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCB0eXBlIHBhc3NlZCB0byBzZW5kIik7CiAgICAgIH0sCiAgICAgIGNsb3NlOiAoY29kZSwgcmVhc29uKSA9PiB7CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSB7IGNvZGUsIHJlYXNvbiB9OwogICAgICAgIGNvbnN0IHBheWxvYWRKU09OMiA9IEpTT04uc3RyaW5naWZ5KHBheWxvYWQyKTsKICAgICAgICB0aGlzLnNlbmQoCiAgICAgICAgICBzZXEsCiAgICAgICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NDbG9zZSwKICAgICAgICAgIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShwYXlsb2FkSlNPTjIpCiAgICAgICAgKS5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB9KTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tzZXFdOwogICAgICB9CiAgICB9OwogIH0KfTsKCmNsYXNzIERldldzVHJhbnNwb3J0IGV4dGVuZHMgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UpIHsKICAgIHN1cGVyKG9ub3Blbiwgb25jbG9zZSk7CiAgICB0aGlzLndzID0gbmV3IFdlYlNvY2tldCgid3M6Ly9sb2NhbGhvc3Q6MzAwMC9kZXYtd3MiKTsKICAgIHRoaXMud3MuYmluYXJ5VHlwZSA9ICJhcnJheWJ1ZmZlciI7CiAgICB0aGlzLndzLm9ub3BlbiA9IG9ub3BlbjsKICAgIHRoaXMud3Mub25jbG9zZSA9IG9uY2xvc2U7CiAgICB0aGlzLndzLm9ubWVzc2FnZSA9IHRoaXMub25tZXNzYWdlLmJpbmQodGhpcyk7CiAgfQogIG9ubWVzc2FnZShtc2cpIHsKICAgIGlmIChtc2cuZGF0YSBpbnN0YW5jZW9mIHdpbmRvdy5BcnJheUJ1ZmZlcikgewogICAgICB0aGlzLm9uZGF0YShtc2cuZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICB9CiAgc2VuZChkYXRhKSB7CiAgICB0aGlzLndzLnNlbmQoZGF0YSk7CiAgfQogIGNsb3NlKCkgewogICAgdGhpcy53cy5jbG9zZSgpOwogIH0KfQoKY29uc3QgcnRjQ29uZiA9IHsKICBpY2VTZXJ2ZXJzOiBbCiAgICB7CiAgICAgIHVybHM6ICJzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyIgogICAgfQogIF0KfTsKY2xhc3MgUlRDVHJhbnNwb3J0IGV4dGVuZHMgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UsIG9uY29ubmVjdGlvbnN0YXRlY2hhbmdlLCBvbnNpZ25hbGluZ3N0YXRlY2hhbmdlLCBvbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlKSB7CiAgICBzdXBlcihvbm9wZW4sIG9uY2xvc2UpOwogICAgdGhpcy5vbm9wZW4gPSBvbm9wZW47CiAgICB0aGlzLm9uY2xvc2UgPSBvbmNsb3NlOwogICAgdGhpcy5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IG9uY29ubmVjdGlvbnN0YXRlY2hhbmdlOwogICAgdGhpcy5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlID0gb25zaWduYWxpbmdzdGF0ZWNoYW5nZTsKICAgIHRoaXMub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSA9IG9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2U7CiAgICB0aGlzLnBlZXIgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24ocnRjQ29uZik7CiAgICB0aGlzLnBlZXIub25jb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSBvbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZTsKICAgIHRoaXMucGVlci5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlID0gb25zaWduYWxpbmdzdGF0ZWNoYW5nZTsKICAgIHRoaXMucGVlci5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IChldmVudCkgPT4gewogICAgICBjb25zb2xlLmxvZygiSUNFIGNvbm5lY3Rpb24gc3RhdGU6IiwgdGhpcy5wZWVyLmljZUNvbm5lY3Rpb25TdGF0ZSk7CiAgICAgIGlmICh0aGlzLnBlZXIuaWNlQ29ubmVjdGlvblN0YXRlID09ICJkaXNjb25uZWN0ZWQiIHx8IHRoaXMucGVlci5pY2VDb25uZWN0aW9uU3RhdGUgPT0gImZhaWxlZCIpIHsKICAgICAgICBjb25zb2xlLmxvZygiZGlzY29ubmVjdGVkIik7CiAgICAgICAgb25jbG9zZSgpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5wZWVyLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UgPSBvbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlOwogICAgdGhpcy5kYXRhQ2hhbm5lbCA9IHRoaXMucGVlci5jcmVhdGVEYXRhQ2hhbm5lbCgiaG9zdC1zZXJ2ZXIiKTsKICAgIHRoaXMuZGF0YUNoYW5uZWwub25vcGVuID0gb25vcGVuOwogICAgdGhpcy5kYXRhQ2hhbm5lbC5iaW5hcnlUeXBlID0gImFycmF5YnVmZmVyIjsKICAgIHRoaXMuZGF0YUNoYW5uZWwub25jbG9zZSA9IG9uY2xvc2U7CiAgICB0aGlzLmRhdGFDaGFubmVsLm9ubWVzc2FnZSA9IGFzeW5jIChldmVudCkgPT4gewogICAgICBsZXQgYnVmID0gZXZlbnQuZGF0YTsKICAgICAgdGhpcy5vbmRhdGEoYnVmKTsKICAgIH07CiAgfQogIHNlbmQoZGF0YSkgewogICAgdGhpcy5kYXRhQ2hhbm5lbC5zZW5kKGRhdGEpOwogIH0KICBjbG9zZSgpIHsKICAgIHRoaXMuZGF0YUNoYW5uZWwuY2xvc2UoKTsKICB9CiAgYXN5bmMgY3JlYXRlT2ZmZXIoKSB7CiAgICBjb25zdCBsb2NhbENhbmRpZGF0ZXMgPSBbXTsKICAgIGxldCByZWFkeVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHRoaXMucGVlci5vbmljZWNhbmRpZGF0ZSA9IGFzeW5jIChldmVudCkgPT4gewogICAgICAgIGlmIChldmVudC5jYW5kaWRhdGUpIHsKICAgICAgICAgIGxvY2FsQ2FuZGlkYXRlcy5wdXNoKGV2ZW50LmNhbmRpZGF0ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoeyBvZmZlciwgbG9jYWxDYW5kaWRhdGVzIH0pOwogICAgICB9OwogICAgfSk7CiAgICBjb25zdCBvZmZlciA9IGF3YWl0IHRoaXMucGVlci5jcmVhdGVPZmZlcigpOwogICAgYXdhaXQgdGhpcy5wZWVyLnNldExvY2FsRGVzY3JpcHRpb24ob2ZmZXIpOwogICAgcmV0dXJuIHJlYWR5UHJvbWlzZTsKICB9CiAgYXN5bmMgYW5zd2VyKGFuc3dlciwgY2FuZGlkYXRlcykgewogICAgYXdhaXQgdGhpcy5wZWVyLnNldFJlbW90ZURlc2NyaXB0aW9uKGFuc3dlcik7CiAgICBmb3IgKGxldCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykgewogICAgICBhd2FpdCB0aGlzLnBlZXIuYWRkSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7CiAgICB9CiAgfQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS4NCiAqLw0KY29uc3QgQ09OU1RBTlRTID0gew0KICAgIC8qKg0KICAgICAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBpcyB0aGUgY2xpZW50IE5vZGUuanMgU0RLLg0KICAgICAqLw0KICAgIE5PREVfQ0xJRU5UOiBmYWxzZSwNCiAgICAvKioNCiAgICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIEFkbWluIE5vZGUuanMgU0RLLg0KICAgICAqLw0KICAgIE5PREVfQURNSU46IGZhbHNlLA0KICAgIC8qKg0KICAgICAqIEZpcmViYXNlIFNESyBWZXJzaW9uDQogICAgICovDQogICAgU0RLX1ZFUlNJT046ICcke0pTQ09SRV9WRVJTSU9OfScNCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgcHJvdmlkZWQgYXNzZXJ0aW9uIGlzIGZhbHN5DQogKi8NCmNvbnN0IGFzc2VydCA9IGZ1bmN0aW9uIChhc3NlcnRpb24sIG1lc3NhZ2UpIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcihtZXNzYWdlKTsNCiAgICB9DQp9Ow0KLyoqDQogKiBSZXR1cm5zIGFuIEVycm9yIG9iamVjdCBzdWl0YWJsZSBmb3IgdGhyb3dpbmcuDQogKi8NCmNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICByZXR1cm4gbmV3IEVycm9yKCdGaXJlYmFzZSBEYXRhYmFzZSAoJyArDQogICAgICAgIENPTlNUQU5UUy5TREtfVkVSU0lPTiArDQogICAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgKw0KICAgICAgICBtZXNzYWdlKTsNCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBzdHJpbmdUb0J5dGVBcnJheSQxID0gZnVuY3Rpb24gKHN0cikgew0KICAgIC8vIFRPRE8odXNlcik6IFVzZSBuYXRpdmUgaW1wbGVtZW50YXRpb25zIGlmL3doZW4gYXZhaWxhYmxlDQogICAgY29uc3Qgb3V0ID0gW107DQogICAgbGV0IHAgPSAwOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIGlmIChjIDwgMTI4KSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IGM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gNikgfCAxOTI7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4Ow0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmDQogICAgICAgICAgICBpICsgMSA8IHN0ci5sZW5ndGggJiYNCiAgICAgICAgICAgIChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZjMDApID09PSAweGRjMDApIHsNCiAgICAgICAgICAgIC8vIFN1cnJvZ2F0ZSBQYWlyDQogICAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAmIDB4MDNmZikgPDwgMTApICsgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweDAzZmYpOw0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7DQogICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiAxMikgJiA2MykgfCAxMjg7DQogICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDsNCiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb3V0Ow0KfTsNCi8qKg0KICogVHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyBpbnRvIHRoZSBzdHJpbmcgZ2l2ZW4gYnkgdGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlDQogKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuDQogKiBAcGFyYW0gYnl0ZXMgQXJyYXkgb2YgbnVtYmVycyByZXByZXNlbnRpbmcgY2hhcmFjdGVycy4NCiAqIEByZXR1cm4gU3RyaW5naWZpY2F0aW9uIG9mIHRoZSBhcnJheS4NCiAqLw0KY29uc3QgYnl0ZUFycmF5VG9TdHJpbmcgPSBmdW5jdGlvbiAoYnl0ZXMpIHsNCiAgICAvLyBUT0RPKHVzZXIpOiBVc2UgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBpZi93aGVuIGF2YWlsYWJsZQ0KICAgIGNvbnN0IG91dCA9IFtdOw0KICAgIGxldCBwb3MgPSAwLCBjID0gMDsNCiAgICB3aGlsZSAocG9zIDwgYnl0ZXMubGVuZ3RoKSB7DQogICAgICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICBpZiAoYzEgPCAxMjgpIHsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjMSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYzEgPiAxOTEgJiYgYzEgPCAyMjQpIHsNCiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGMxID4gMjM5ICYmIGMxIDwgMzY1KSB7DQogICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpcg0KICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107DQogICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTsNCiAgICAgICAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICAgICAgY29uc3QgdSA9ICgoKGMxICYgNykgPDwgMTgpIHwgKChjMiAmIDYzKSA8PCAxMikgfCAoKGMzICYgNjMpIDw8IDYpIHwgKGM0ICYgNjMpKSAtDQogICAgICAgICAgICAgICAgMHgxMDAwMDsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGQ4MDAgKyAodSA+PiAxMCkpOw0KICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZGMwMCArICh1ICYgMTAyMykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107DQogICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvdXQuam9pbignJyk7DQp9Ow0KLy8gV2UgZGVmaW5lIGl0IGFzIGFuIG9iamVjdCBsaXRlcmFsIGluc3RlYWQgb2YgYSBjbGFzcyBiZWNhdXNlIGEgY2xhc3MgY29tcGlsZWQgZG93biB0byBlczUgY2FuJ3QNCi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxDQovLyBTdGF0aWMgbG9va3VwIG1hcHMsIGxhemlseSBwb3B1bGF0ZWQgYnkgaW5pdF8oKQ0KY29uc3QgYmFzZTY0JDMgPSB7DQogICAgLyoqDQogICAgICogTWFwcyBieXRlcyB0byBjaGFyYWN0ZXJzLg0KICAgICAqLw0KICAgIGJ5dGVUb0NoYXJNYXBfOiBudWxsLA0KICAgIC8qKg0KICAgICAqIE1hcHMgY2hhcmFjdGVycyB0byBieXRlcy4NCiAgICAgKi8NCiAgICBjaGFyVG9CeXRlTWFwXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBNYXBzIGJ5dGVzIHRvIHdlYnNhZmUgY2hhcmFjdGVycy4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGJ5dGVUb0NoYXJNYXBXZWJTYWZlXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBNYXBzIHdlYnNhZmUgY2hhcmFjdGVycyB0byBieXRlcy4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGNoYXJUb0J5dGVNYXBXZWJTYWZlXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldCwgc2hhcmVkIGJldHdlZW4NCiAgICAgKiBFTkNPREVEX1ZBTFMgYW5kIEVOQ09ERURfVkFMU19XRUJTQUZFDQogICAgICovDQogICAgRU5DT0RFRF9WQUxTX0JBU0U6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWicgKyAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonICsgJzAxMjM0NTY3ODknLA0KICAgIC8qKg0KICAgICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LiBWYWx1ZSA2NCAoPSkgaXMgc3BlY2lhbDsgaXQgbWVhbnMgIm5vdGhpbmcuIg0KICAgICAqLw0KICAgIGdldCBFTkNPREVEX1ZBTFMoKSB7DQogICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJysvPSc7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBPdXIgd2Vic2FmZSBhbHBoYWJldC4NCiAgICAgKi8NCiAgICBnZXQgRU5DT0RFRF9WQUxTX1dFQlNBRkUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJy1fLic7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBXaGV0aGVyIHRoaXMgYnJvd3NlciBzdXBwb3J0cyB0aGUgYXRvYiBhbmQgYnRvYSBmdW5jdGlvbnMuIFRoaXMgZXh0ZW5zaW9uDQogICAgICogc3RhcnRlZCBhdCBNb3ppbGxhIGJ1dCBpcyBub3cgaW1wbGVtZW50ZWQgYnkgbWFueSBicm93c2Vycy4gV2UgdXNlIHRoZQ0KICAgICAqIEFTU1VNRV8qIHZhcmlhYmxlcyB0byBhdm9pZCBwdWxsaW5nIGluIHRoZSBmdWxsIHVzZXJhZ2VudCBkZXRlY3Rpb24gbGlicmFyeQ0KICAgICAqIGJ1dCBzdGlsbCBhbGxvd2luZyB0aGUgc3RhbmRhcmQgcGVyLWJyb3dzZXIgY29tcGlsYXRpb25zLg0KICAgICAqDQogICAgICovDQogICAgSEFTX05BVElWRV9TVVBQT1JUOiB0eXBlb2YgYXRvYiA9PT0gJ2Z1bmN0aW9uJywNCiAgICAvKioNCiAgICAgKiBCYXNlNjQtZW5jb2RlIGFuIGFycmF5IG9mIGJ5dGVzLg0KICAgICAqDQogICAgICogQHBhcmFtIGlucHV0IEFuIGFycmF5IG9mIGJ5dGVzIChudW1iZXJzIHdpdGgNCiAgICAgKiAgICAgdmFsdWUgaW4gWzAsIDI1NV0pIHRvIGVuY29kZS4NCiAgICAgKiBAcGFyYW0gd2ViU2FmZSBCb29sZWFuIGluZGljYXRpbmcgd2Ugc2hvdWxkIHVzZSB0aGUNCiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuDQogICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLg0KICAgICAqLw0KICAgIGVuY29kZUJ5dGVBcnJheShpbnB1dCwgd2ViU2FmZSkgew0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaW5wdXQpKSB7DQogICAgICAgICAgICB0aHJvdyBFcnJvcignZW5jb2RlQnl0ZUFycmF5IHRha2VzIGFuIGFycmF5IGFzIGEgcGFyYW1ldGVyJyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5pbml0XygpOw0KICAgICAgICBjb25zdCBieXRlVG9DaGFyTWFwID0gd2ViU2FmZQ0KICAgICAgICAgICAgPyB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXw0KICAgICAgICAgICAgOiB0aGlzLmJ5dGVUb0NoYXJNYXBfOw0KICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkgKz0gMykgew0KICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBpbnB1dFtpXTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgKyAxIDwgaW5wdXQubGVuZ3RoOw0KICAgICAgICAgICAgY29uc3QgYnl0ZTIgPSBoYXZlQnl0ZTIgPyBpbnB1dFtpICsgMV0gOiAwOw0KICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUzID0gaSArIDIgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGlucHV0W2kgKyAyXSA6IDA7DQogICAgICAgICAgICBjb25zdCBvdXRCeXRlMSA9IGJ5dGUxID4+IDI7DQogICAgICAgICAgICBjb25zdCBvdXRCeXRlMiA9ICgoYnl0ZTEgJiAweDAzKSA8PCA0KSB8IChieXRlMiA+PiA0KTsNCiAgICAgICAgICAgIGxldCBvdXRCeXRlMyA9ICgoYnl0ZTIgJiAweDBmKSA8PCAyKSB8IChieXRlMyA+PiA2KTsNCiAgICAgICAgICAgIGxldCBvdXRCeXRlNCA9IGJ5dGUzICYgMHgzZjsNCiAgICAgICAgICAgIGlmICghaGF2ZUJ5dGUzKSB7DQogICAgICAgICAgICAgICAgb3V0Qnl0ZTQgPSA2NDsNCiAgICAgICAgICAgICAgICBpZiAoIWhhdmVCeXRlMikgew0KICAgICAgICAgICAgICAgICAgICBvdXRCeXRlMyA9IDY0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG91dHB1dC5wdXNoKGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTFdLCBieXRlVG9DaGFyTWFwW291dEJ5dGUyXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlM10sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTRdKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb3V0cHV0LmpvaW4oJycpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQmFzZTY0LWVuY29kZSBhIHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpbnB1dCBBIHN0cmluZyB0byBlbmNvZGUuDQogICAgICogQHBhcmFtIHdlYlNhZmUgSWYgdHJ1ZSwgd2Ugc2hvdWxkIHVzZSB0aGUNCiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuDQogICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLg0KICAgICAqLw0KICAgIGVuY29kZVN0cmluZyhpbnB1dCwgd2ViU2FmZSkgew0KICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudA0KICAgICAgICAvLyBhIG5hdGl2ZSBiYXNlNjQgZW5jb2RlciBpbiB0aGUgZm9ybSBvZiAiYnRvYS9hdG9iIg0KICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHsNCiAgICAgICAgICAgIHJldHVybiBidG9hKGlucHV0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVCeXRlQXJyYXkoc3RyaW5nVG9CeXRlQXJyYXkkMShpbnB1dCksIHdlYlNhZmUpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpbnB1dCB0byBkZWNvZGUuDQogICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZQ0KICAgICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC4NCiAgICAgKiBAcmV0dXJuIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuDQogICAgICovDQogICAgZGVjb2RlU3RyaW5nKGlucHV0LCB3ZWJTYWZlKSB7DQogICAgICAgIC8vIFNob3J0Y3V0IGZvciBNb3ppbGxhIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50DQogICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mICJidG9hL2F0b2IiDQogICAgICAgIGlmICh0aGlzLkhBU19OQVRJVkVfU1VQUE9SVCAmJiAhd2ViU2FmZSkgew0KICAgICAgICAgICAgcmV0dXJuIGF0b2IoaW5wdXQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBieXRlQXJyYXlUb1N0cmluZyh0aGlzLmRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBCYXNlNjQtZGVjb2RlIGEgc3RyaW5nLg0KICAgICAqDQogICAgICogSW4gYmFzZS02NCBkZWNvZGluZywgZ3JvdXBzIG9mIGZvdXIgY2hhcmFjdGVycyBhcmUgY29udmVydGVkIGludG8gdGhyZWUNCiAgICAgKiBieXRlcy4gIElmIHRoZSBlbmNvZGVyIGRpZCBub3QgYXBwbHkgcGFkZGluZywgdGhlIGlucHV0IGxlbmd0aCBtYXkgbm90DQogICAgICogYmUgYSBtdWx0aXBsZSBvZiA0Lg0KICAgICAqDQogICAgICogSW4gdGhpcyBjYXNlLCB0aGUgbGFzdCBncm91cCB3aWxsIGhhdmUgZmV3ZXIgdGhhbiA0IGNoYXJhY3RlcnMsIGFuZA0KICAgICAqIHBhZGRpbmcgd2lsbCBiZSBpbmZlcnJlZC4gIElmIHRoZSBncm91cCBoYXMgb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzDQogICAgICogdG8gb25lIGJ5dGUuICBJZiB0aGUgZ3JvdXAgaGFzIHRocmVlIGNoYXJhY3RlcnMsIGl0IGRlY29kZXMgdG8gdHdvIGJ5dGVzLg0KICAgICAqDQogICAgICogQHBhcmFtIGlucHV0IElucHV0IHRvIGRlY29kZS4NCiAgICAgKiBAcGFyYW0gd2ViU2FmZSBUcnVlIGlmIHdlIHNob3VsZCB1c2UgdGhlIHdlYi1zYWZlIGFscGhhYmV0Lg0KICAgICAqIEByZXR1cm4gYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSBkZWNvZGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSB7DQogICAgICAgIHRoaXMuaW5pdF8oKTsNCiAgICAgICAgY29uc3QgY2hhclRvQnl0ZU1hcCA9IHdlYlNhZmUNCiAgICAgICAgICAgID8gdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV8NCiAgICAgICAgICAgIDogdGhpcy5jaGFyVG9CeXRlTWFwXzsNCiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOykgew0KICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKyspXTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlMiA9IGhhdmVCeXRlMiA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDA7DQogICAgICAgICAgICArK2k7DQogICAgICAgICAgICBjb25zdCBoYXZlQnl0ZTMgPSBpIDwgaW5wdXQubGVuZ3RoOw0KICAgICAgICAgICAgY29uc3QgYnl0ZTMgPSBoYXZlQnl0ZTMgPyBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKV0gOiA2NDsNCiAgICAgICAgICAgICsraTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlNCA9IGkgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlNCA9IGhhdmVCeXRlNCA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0Ow0KICAgICAgICAgICAgKytpOw0KICAgICAgICAgICAgaWYgKGJ5dGUxID09IG51bGwgfHwgYnl0ZTIgPT0gbnVsbCB8fCBieXRlMyA9PSBudWxsIHx8IGJ5dGU0ID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlQmFzZTY0U3RyaW5nRXJyb3IoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gKGJ5dGUxIDw8IDIpIHwgKGJ5dGUyID4+IDQpOw0KICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTEpOw0KICAgICAgICAgICAgaWYgKGJ5dGUzICE9PSA2NCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUyID0gKChieXRlMiA8PCA0KSAmIDB4ZjApIHwgKGJ5dGUzID4+IDIpOw0KICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUyKTsNCiAgICAgICAgICAgICAgICBpZiAoYnl0ZTQgIT09IDY0KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUzID0gKChieXRlMyA8PCA2KSAmIDB4YzApIHwgYnl0ZTQ7DQogICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIExhenkgc3RhdGljIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uLiBDYWxsZWQgYmVmb3JlDQogICAgICogYWNjZXNzaW5nIGFueSBvZiB0aGUgc3RhdGljIG1hcCB2YXJpYWJsZXMuDQogICAgICogQHByaXZhdGUNCiAgICAgKi8NCiAgICBpbml0XygpIHsNCiAgICAgICAgaWYgKCF0aGlzLmJ5dGVUb0NoYXJNYXBfKSB7DQogICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBfID0ge307DQogICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfID0ge307DQogICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXyA9IHt9Ow0KICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV8gPSB7fTsNCiAgICAgICAgICAgIC8vIFdlIHdhbnQgcXVpY2sgbWFwcGluZ3MgYmFjayBhbmQgZm9ydGgsIHNvIHdlIHByZWNvbXB1dGUgdHdvIG1hcHMuDQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuRU5DT0RFRF9WQUxTLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTLmNoYXJBdChpKTsNCiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuYnl0ZVRvQ2hhck1hcF9baV1dID0gaTsNCiAgICAgICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpOw0KICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfW3RoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfW2ldXSA9IGk7DQogICAgICAgICAgICAgICAgLy8gQmUgZm9yZ2l2aW5nIHdoZW4gZGVjb2RpbmcgYW5kIGNvcnJlY3RseSBkZWNvZGUgYm90aCBlbmNvZGluZ3MuDQogICAgICAgICAgICAgICAgaWYgKGkgPj0gdGhpcy5FTkNPREVEX1ZBTFNfQkFTRS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwX1t0aGlzLkVOQ09ERURfVkFMU19XRUJTQUZFLmNoYXJBdChpKV0gPSBpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSldID0gaTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9Ow0KLyoqDQogKiBBbiBlcnJvciBlbmNvdW50ZXJlZCB3aGlsZSBkZWNvZGluZyBiYXNlNjQgc3RyaW5nLg0KICovDQpjbGFzcyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvciBleHRlbmRzIEVycm9yIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsNCiAgICAgICAgdGhpcy5uYW1lID0gJ0RlY29kZUJhc2U2NFN0cmluZ0Vycm9yJzsNCiAgICB9DQp9DQovKioNCiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZw0KICovDQpjb25zdCBiYXNlNjRFbmNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgY29uc3QgdXRmOEJ5dGVzID0gc3RyaW5nVG9CeXRlQXJyYXkkMShzdHIpOw0KICAgIHJldHVybiBiYXNlNjQkMy5lbmNvZGVCeXRlQXJyYXkodXRmOEJ5dGVzLCB0cnVlKTsNCn07DQovKioNCiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZyAod2l0aG91dCAiLiIgcGFkZGluZyBpbiB0aGUgZW5kKS4NCiAqIGUuZy4gVXNlZCBpbiBKU09OIFdlYiBUb2tlbiAoSldUKSBwYXJ0cy4NCiAqLw0KY29uc3QgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgLy8gVXNlIGJhc2U2NHVybCBlbmNvZGluZyBhbmQgcmVtb3ZlIHBhZGRpbmcgaW4gdGhlIGVuZCAoZG90IGNoYXJhY3RlcnMpLg0KICAgIHJldHVybiBiYXNlNjRFbmNvZGUoc3RyKS5yZXBsYWNlKC9cLi9nLCAnJyk7DQp9Ow0KLyoqDQogKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmcNCiAqDQogKiBOT1RFOiBETyBOT1QgdXNlIHRoZSBnbG9iYWwgYXRvYigpIGZ1bmN0aW9uIC0gaXQgZG9lcyBOT1Qgc3VwcG9ydCB0aGUNCiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLg0KICoNCiAqIEBwYXJhbSBzdHIgVG8gYmUgZGVjb2RlZA0KICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGUNCiAqLw0KY29uc3QgYmFzZTY0RGVjb2RlID0gZnVuY3Rpb24gKHN0cikgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiBiYXNlNjQkMy5kZWNvZGVTdHJpbmcoc3RyLCB0cnVlKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignYmFzZTY0RGVjb2RlIGZhaWxlZDogJywgZSk7DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRG8gYSBkZWVwLWNvcHkgb2YgYmFzaWMgSmF2YVNjcmlwdCBPYmplY3RzIG9yIEFycmF5cy4NCiAqLw0KZnVuY3Rpb24gZGVlcENvcHkodmFsdWUpIHsNCiAgICByZXR1cm4gZGVlcEV4dGVuZCh1bmRlZmluZWQsIHZhbHVlKTsNCn0NCi8qKg0KICogQ29weSBwcm9wZXJ0aWVzIGZyb20gc291cmNlIHRvIHRhcmdldCAocmVjdXJzaXZlbHkgYWxsb3dzIGV4dGVuc2lvbg0KICogb2YgT2JqZWN0cyBhbmQgQXJyYXlzKS4gIFNjYWxhciB2YWx1ZXMgaW4gdGhlIHRhcmdldCBhcmUgb3Zlci13cml0dGVuLg0KICogSWYgdGFyZ2V0IGlzIHVuZGVmaW5lZCwgYW4gb2JqZWN0IG9mIHRoZSBhcHByb3ByaWF0ZSB0eXBlIHdpbGwgYmUgY3JlYXRlZA0KICogKGFuZCByZXR1cm5lZCkuDQogKg0KICogV2UgcmVjdXJzaXZlbHkgY29weSBhbGwgY2hpbGQgcHJvcGVydGllcyBvZiBwbGFpbiBPYmplY3RzIGluIHRoZSBzb3VyY2UtIHNvDQogKiB0aGF0IG5hbWVzcGFjZS0gbGlrZSBkaWN0aW9uYXJpZXMgYXJlIG1lcmdlZC4NCiAqDQogKiBOb3RlIHRoYXQgdGhlIHRhcmdldCBjYW4gYmUgYSBmdW5jdGlvbiwgaW4gd2hpY2ggY2FzZSB0aGUgcHJvcGVydGllcyBpbg0KICogdGhlIHNvdXJjZSBPYmplY3QgYXJlIGNvcGllZCBvbnRvIGl0IGFzIHN0YXRpYyBwcm9wZXJ0aWVzIG9mIHRoZSBGdW5jdGlvbi4NCiAqDQogKiBOb3RlOiB3ZSBkb24ndCBtZXJnZSBfX3Byb3RvX18gdG8gcHJldmVudCBwcm90b3R5cGUgcG9sbHV0aW9uDQogKi8NCmZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0LCBzb3VyY2UpIHsNCiAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBPYmplY3QpKSB7DQogICAgICAgIHJldHVybiBzb3VyY2U7DQogICAgfQ0KICAgIHN3aXRjaCAoc291cmNlLmNvbnN0cnVjdG9yKSB7DQogICAgICAgIGNhc2UgRGF0ZToNCiAgICAgICAgICAgIC8vIFRyZWF0IERhdGVzIGxpa2Ugc2NhbGFyczsgaWYgdGhlIHRhcmdldCBkYXRlIG9iamVjdCBoYWQgYW55IGNoaWxkDQogICAgICAgICAgICAvLyBwcm9wZXJ0aWVzIC0gdGhleSB3aWxsIGJlIGxvc3QhDQogICAgICAgICAgICBjb25zdCBkYXRlVmFsdWUgPSBzb3VyY2U7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZVZhbHVlLmdldFRpbWUoKSk7DQogICAgICAgIGNhc2UgT2JqZWN0Og0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgdGFyZ2V0ID0ge307DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBBcnJheToNCiAgICAgICAgICAgIC8vIEFsd2F5cyBjb3B5IHRoZSBhcnJheSBzb3VyY2UgYW5kIG92ZXJ3cml0ZSB0aGUgdGFyZ2V0Lg0KICAgICAgICAgICAgdGFyZ2V0ID0gW107DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIC8vIE5vdCBhIHBsYWluIE9iamVjdCAtIHRyZWF0IGl0IGFzIGEgc2NhbGFyLg0KICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTsNCiAgICB9DQogICAgZm9yIChjb25zdCBwcm9wIGluIHNvdXJjZSkgew0KICAgICAgICAvLyB1c2UgaXNWYWxpZEtleSB0byBndWFyZCBhZ2FpbnN0IHByb3RvdHlwZSBwb2xsdXRpb24uIFNlZSBodHRwczovL3NueWsuaW8vdnVsbi9TTllLLUpTLUxPREFTSC00NTAyMDINCiAgICAgICAgaWYgKCFzb3VyY2UuaGFzT3duUHJvcGVydHkocHJvcCkgfHwgIWlzVmFsaWRLZXkkMShwcm9wKSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgdGFyZ2V0W3Byb3BdID0gZGVlcEV4dGVuZCh0YXJnZXRbcHJvcF0sIHNvdXJjZVtwcm9wXSk7DQogICAgfQ0KICAgIHJldHVybiB0YXJnZXQ7DQp9DQpmdW5jdGlvbiBpc1ZhbGlkS2V5JDEoa2V5KSB7DQogICAgcmV0dXJuIGtleSAhPT0gJ19fcHJvdG9fXyc7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFBvbHlmaWxsIGZvciBgZ2xvYmFsVGhpc2Agb2JqZWN0Lg0KICogQHJldHVybnMgdGhlIGBnbG9iYWxUaGlzYCBvYmplY3QgZm9yIHRoZSBnaXZlbiBlbnZpcm9ubWVudC4NCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gZ2V0R2xvYmFsKCkgew0KICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm4gd2luZG93Ow0KICAgIH0NCiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgcmV0dXJuIGdsb2JhbDsNCiAgICB9DQogICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9jYXRlIGdsb2JhbCBvYmplY3QuJyk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBnZXREZWZhdWx0c0Zyb21HbG9iYWwgPSAoKSA9PiBnZXRHbG9iYWwoKS5fX0ZJUkVCQVNFX0RFRkFVTFRTX187DQovKioNCiAqIEF0dGVtcHQgdG8gcmVhZCBkZWZhdWx0cyBmcm9tIGEgSlNPTiBzdHJpbmcgcHJvdmlkZWQgdG8NCiAqIHByb2Nlc3MoLillbnYoLilfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb3IgYSBKU09OIGZpbGUgd2hvc2UgcGF0aCBpcyBpbg0KICogcHJvY2VzcyguKWVudiguKV9fRklSRUJBU0VfREVGQVVMVFNfUEFUSF9fDQogKiBUaGUgZG90cyBhcmUgaW4gcGFyZW5zIGJlY2F1c2UgY2VydGFpbiBjb21waWxlcnMgKFZpdGU/KSBjYW5ub3QNCiAqIGhhbmRsZSBzZWVpbmcgdGhhdCB2YXJpYWJsZSBpbiBjb21tZW50cy4NCiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82ODM4DQogKi8NCmNvbnN0IGdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlID0gKCkgPT4gew0KICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb2Nlc3MuZW52ID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnN0IGRlZmF1bHRzSnNvblN0cmluZyA9ICh7fSkuX19GSVJFQkFTRV9ERUZBVUxUU19fOw0KICAgIGlmIChkZWZhdWx0c0pzb25TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVmYXVsdHNKc29uU3RyaW5nKTsNCiAgICB9DQp9Ow0KY29uc3QgZ2V0RGVmYXVsdHNGcm9tQ29va2llID0gKCkgPT4gew0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgbGV0IG1hdGNoOw0KICAgIHRyeSB7DQogICAgICAgIG1hdGNoID0gZG9jdW1lbnQuY29va2llLm1hdGNoKC9fX0ZJUkVCQVNFX0RFRkFVTFRTX189KFteO10rKS8pOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvLyBTb21lIGVudmlyb25tZW50cyBzdWNoIGFzIEFuZ3VsYXIgVW5pdmVyc2FsIFNTUiBoYXZlIGENCiAgICAgICAgLy8gYGRvY3VtZW50YCBvYmplY3QgYnV0IGVycm9yIG9uIGFjY2Vzc2luZyBgZG9jdW1lbnQuY29va2llYC4NCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBjb25zdCBkZWNvZGVkID0gbWF0Y2ggJiYgYmFzZTY0RGVjb2RlKG1hdGNoWzFdKTsNCiAgICByZXR1cm4gZGVjb2RlZCAmJiBKU09OLnBhcnNlKGRlY29kZWQpOw0KfTsNCi8qKg0KICogR2V0IHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LiBJdCBjaGVja3MgaW4gb3JkZXI6DQogKiAoMSkgaWYgc3VjaCBhbiBvYmplY3QgZXhpc3RzIGFzIGEgcHJvcGVydHkgb2YgYGdsb2JhbFRoaXNgDQogKiAoMikgaWYgc3VjaCBhbiBvYmplY3Qgd2FzIHByb3ZpZGVkIG9uIGEgc2hlbGwgZW52aXJvbm1lbnQgdmFyaWFibGUNCiAqICgzKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgaW4gYSBjb29raWUNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7DQogICAgdHJ5IHsNCiAgICAgICAgcmV0dXJuIChnZXREZWZhdWx0c0Zyb21HbG9iYWwoKSB8fA0KICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tRW52VmFyaWFibGUoKSB8fA0KICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tQ29va2llKCkpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQ2F0Y2gtYWxsIGZvciBiZWluZyB1bmFibGUgdG8gZ2V0IF9fRklSRUJBU0VfREVGQVVMVFNfXyBkdWUNCiAgICAgICAgICogdG8gYW55IGVudmlyb25tZW50IGNhc2Ugd2UgaGF2ZSBub3QgYWNjb3VudGVkIGZvci4gTG9nIHRvDQogICAgICAgICAqIGluZm8gaW5zdGVhZCBvZiBzd2FsbG93aW5nIHNvIHdlIGNhbiBmaW5kIHRoZXNlIHVua25vd24gY2FzZXMNCiAgICAgICAgICogYW5kIGFkZCBwYXRocyBmb3IgdGhlbSBpZiBuZWVkZWQuDQogICAgICAgICAqLw0KICAgICAgICBjb25zb2xlLmluZm8oYFVuYWJsZSB0byBnZXQgX19GSVJFQkFTRV9ERUZBVUxUU19fIGR1ZSB0bzogJHtlfWApOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KfTsNCi8qKg0KICogUmV0dXJucyBlbXVsYXRvciBob3N0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdA0KICogZm9yIHRoZSBnaXZlbiBwcm9kdWN0Lg0KICogQHJldHVybnMgYSBVUkwgaG9zdCBmb3JtYXR0ZWQgbGlrZSBgMTI3LjAuMC4xOjk5OTlgIG9yIGBbOjoxXTo0MDAwYCBpZiBhdmFpbGFibGUNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCA9IChwcm9kdWN0TmFtZSkgPT4geyB2YXIgX2EsIF9iOyByZXR1cm4gKF9iID0gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVtdWxhdG9ySG9zdHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltwcm9kdWN0TmFtZV07IH07DQovKioNCiAqIFJldHVybnMgZW11bGF0b3IgaG9zdG5hbWUgYW5kIHBvcnQgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0DQogKiBmb3IgdGhlIGdpdmVuIHByb2R1Y3QuDQogKiBAcmV0dXJucyBhIHBhaXIgb2YgaG9zdG5hbWUgYW5kIHBvcnQgbGlrZSBgWyI6OjEiLCA0MDAwXWAgaWYgYXZhaWxhYmxlDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCA9IChwcm9kdWN0TmFtZSkgPT4gew0KICAgIGNvbnN0IGhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KHByb2R1Y3ROYW1lKTsNCiAgICBpZiAoIWhvc3QpIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQogICAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBob3N0Lmxhc3RJbmRleE9mKCc6Jyk7IC8vIEZpbmRpbmcgdGhlIGxhc3Qgc2luY2UgSVB2NiBhZGRyIGFsc28gaGFzIGNvbG9ucy4NCiAgICBpZiAoc2VwYXJhdG9ySW5kZXggPD0gMCB8fCBzZXBhcmF0b3JJbmRleCArIDEgPT09IGhvc3QubGVuZ3RoKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBob3N0ICR7aG9zdH0gd2l0aCBubyBzZXBhcmF0ZSBob3N0bmFtZSBhbmQgcG9ydCFgKTsNCiAgICB9DQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscw0KICAgIGNvbnN0IHBvcnQgPSBwYXJzZUludChob3N0LnN1YnN0cmluZyhzZXBhcmF0b3JJbmRleCArIDEpLCAxMCk7DQogICAgaWYgKGhvc3RbMF0gPT09ICdbJykgew0KICAgICAgICAvLyBCcmFja2V0LXF1b3RlZCBgW2lwdjZhZGRyXTpwb3J0YCA9PiByZXR1cm4gImlwdjZhZGRyIiAod2l0aG91dCBicmFja2V0cykuDQogICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMSwgc2VwYXJhdG9ySW5kZXggLSAxKSwgcG9ydF07DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gW2hvc3Quc3Vic3RyaW5nKDAsIHNlcGFyYXRvckluZGV4KSwgcG9ydF07DQogICAgfQ0KfTsNCi8qKg0KICogUmV0dXJucyBGaXJlYmFzZSBhcHAgY29uZmlnIHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdC4NCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdEFwcENvbmZpZyA9ICgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbmZpZzsgfTsNCi8qKg0KICogUmV0dXJucyBhbiBleHBlcmltZW50YWwgc2V0dGluZyBvbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdCAocHJvcGVydGllcw0KICogcHJlZml4ZWQgYnkgIl8iKQ0KICogQHB1YmxpYw0KICovDQpjb25zdCBnZXRFeHBlcmltZW50YWxTZXR0aW5nID0gKG5hbWUpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2BfJHtuYW1lfWBdOyB9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgRGVmZXJyZWQgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLnJlamVjdCA9ICgpID0+IHsgfTsNCiAgICAgICAgdGhpcy5yZXNvbHZlID0gKCkgPT4geyB9Ow0KICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlOw0KICAgICAgICAgICAgdGhpcy5yZWplY3QgPSByZWplY3Q7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBPdXIgQVBJIGludGVybmFscyBhcmUgbm90IHByb21pc2VpZmllZCBhbmQgY2Fubm90IGJlY2F1c2Ugb3VyIGNhbGxiYWNrIEFQSXMgaGF2ZSBzdWJ0bGUgZXhwZWN0YXRpb25zIGFyb3VuZA0KICAgICAqIGludm9raW5nIHByb21pc2VzIGlubGluZSwgd2hpY2ggUHJvbWlzZXMgYXJlIGZvcmJpZGRlbiB0byBkby4gVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBvcHRpb25hbCBub2RlLXN0eWxlIGNhbGxiYWNrDQogICAgICogYW5kIHJldHVybnMgYSBub2RlLXN0eWxlIGNhbGxiYWNrIHdoaWNoIHdpbGwgcmVzb2x2ZSBvciByZWplY3QgdGhlIERlZmVycmVkJ3MgcHJvbWlzZS4NCiAgICAgKi8NCiAgICB3cmFwQ2FsbGJhY2soY2FsbGJhY2spIHsNCiAgICAgICAgcmV0dXJuIChlcnJvciwgdmFsdWUpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG5vb3AgaGFuZGxlciBqdXN0IGluIGNhc2UgZGV2ZWxvcGVyIHdhc24ndCBleHBlY3RpbmcNCiAgICAgICAgICAgICAgICAvLyBwcm9taXNlcw0KICAgICAgICAgICAgICAgIHRoaXMucHJvbWlzZS5jYXRjaCgoKSA9PiB7IH0pOw0KICAgICAgICAgICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0cw0KICAgICAgICAgICAgICAgIC8vIGFzc2VydCB0aGF0IHRoZSBwYXJhbWV0ZXIgbGVuZ3RoIGlzIDENCiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2subGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNyZWF0ZU1vY2tVc2VyVG9rZW4odG9rZW4sIHByb2plY3RJZCkgew0KICAgIGlmICh0b2tlbi51aWQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgInVpZCIgZmllbGQgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCBieSBtb2NrVXNlclRva2VuLiBQbGVhc2UgdXNlICJzdWIiIGluc3RlYWQgZm9yIEZpcmViYXNlIEF1dGggVXNlciBJRC4nKTsNCiAgICB9DQogICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlICJub25lIiBhcyB0aGUgYWxnb3JpdGhtLg0KICAgIGNvbnN0IGhlYWRlciA9IHsNCiAgICAgICAgYWxnOiAnbm9uZScsDQogICAgICAgIHR5cGU6ICdKV1QnDQogICAgfTsNCiAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdElkIHx8ICdkZW1vLXByb2plY3QnOw0KICAgIGNvbnN0IGlhdCA9IHRva2VuLmlhdCB8fCAwOw0KICAgIGNvbnN0IHN1YiA9IHRva2VuLnN1YiB8fCB0b2tlbi51c2VyX2lkOw0KICAgIGlmICghc3ViKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkISIpOw0KICAgIH0NCiAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IA0KICAgICAgICAvLyBTZXQgYWxsIHJlcXVpcmVkIGZpZWxkcyB0byBkZWNlbnQgZGVmYXVsdHMNCiAgICAgICAgaXNzOiBgaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tLyR7cHJvamVjdH1gLCBhdWQ6IHByb2plY3QsIGlhdCwgZXhwOiBpYXQgKyAzNjAwLCBhdXRoX3RpbWU6IGlhdCwgc3ViLCB1c2VyX2lkOiBzdWIsIGZpcmViYXNlOiB7DQogICAgICAgICAgICBzaWduX2luX3Byb3ZpZGVyOiAnY3VzdG9tJywNCiAgICAgICAgICAgIGlkZW50aXRpZXM6IHt9DQogICAgICAgIH0gfSwgdG9rZW4pOw0KICAgIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSB0aGUgZW1wdHkgc3RyaW5nIGFzIGEgc2lnbmF0dXJlLg0KICAgIGNvbnN0IHNpZ25hdHVyZSA9ICcnOw0KICAgIHJldHVybiBbDQogICAgICAgIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KGhlYWRlcikpLA0KICAgICAgICBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhKU09OLnN0cmluZ2lmeShwYXlsb2FkKSksDQogICAgICAgIHNpZ25hdHVyZQ0KICAgIF0uam9pbignLicpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBSZXR1cm5zIG5hdmlnYXRvci51c2VyQWdlbnQgc3RyaW5nIG9yICcnIGlmIGl0J3Mgbm90IGRlZmluZWQuDQogKiBAcmV0dXJuIHVzZXIgYWdlbnQgc3RyaW5nDQogKi8NCmZ1bmN0aW9uIGdldFVBKCkgew0KICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICB0eXBlb2YgbmF2aWdhdG9yWyd1c2VyQWdlbnQnXSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgcmV0dXJuIG5hdmlnYXRvclsndXNlckFnZW50J107DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KfQ0KLyoqDQogKiBEZXRlY3QgQ29yZG92YSAvIFBob25lR2FwIC8gSW9uaWMgZnJhbWV3b3JrcyBvbiBhIG1vYmlsZSBkZXZpY2UuDQogKg0KICogRGVsaWJlcmF0ZWx5IGRvZXMgbm90IHJlbHkgb24gY2hlY2tpbmcgYGZpbGU6Ly9gIFVSTHMgKGFzIHRoaXMgZmFpbHMgUGhvbmVHYXANCiAqIGluIHRoZSBSaXBwbGUgZW11bGF0b3IpIG5vciBDb3Jkb3ZhIGBvbkRldmljZVJlYWR5YCwgd2hpY2ggd291bGQgbm9ybWFsbHkNCiAqIHdhaXQgZm9yIGEgY2FsbGJhY2suDQogKi8NCmZ1bmN0aW9uIGlzTW9iaWxlQ29yZG92YSgpIHsNCiAgICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgIC8vIEB0cy1pZ25vcmUgU2V0dGluZyB1cCBhbiBicm9hZGx5IGFwcGxpY2FibGUgaW5kZXggc2lnbmF0dXJlIGZvciBXaW5kb3cNCiAgICAgICAgLy8ganVzdCB0byBkZWFsIHdpdGggdGhpcyBjYXNlIHdvdWxkIHByb2JhYmx5IGJlIGEgYmFkIGlkZWEuDQogICAgICAgICEhKHdpbmRvd1snY29yZG92YSddIHx8IHdpbmRvd1sncGhvbmVnYXAnXSB8fCB3aW5kb3dbJ1Bob25lR2FwJ10pICYmDQogICAgICAgIC9pb3N8aXBob25lfGlwb2R8aXBhZHxhbmRyb2lkfGJsYWNrYmVycnl8aWVtb2JpbGUvaS50ZXN0KGdldFVBKCkpKTsNCn0NCmZ1bmN0aW9uIGlzQnJvd3NlckV4dGVuc2lvbigpIHsNCiAgICBjb25zdCBydW50aW1lID0gdHlwZW9mIGNocm9tZSA9PT0gJ29iamVjdCcNCiAgICAgICAgPyBjaHJvbWUucnVudGltZQ0KICAgICAgICA6IHR5cGVvZiBicm93c2VyID09PSAnb2JqZWN0Jw0KICAgICAgICAgICAgPyBicm93c2VyLnJ1bnRpbWUNCiAgICAgICAgICAgIDogdW5kZWZpbmVkOw0KICAgIHJldHVybiB0eXBlb2YgcnVudGltZSA9PT0gJ29iamVjdCcgJiYgcnVudGltZS5pZCAhPT0gdW5kZWZpbmVkOw0KfQ0KLyoqDQogKiBEZXRlY3QgUmVhY3QgTmF0aXZlLg0KICoNCiAqIEByZXR1cm4gdHJ1ZSBpZiBSZWFjdE5hdGl2ZSBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZC4NCiAqLw0KZnVuY3Rpb24gaXNSZWFjdE5hdGl2ZSgpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvclsncHJvZHVjdCddID09PSAnUmVhY3ROYXRpdmUnKTsNCn0NCi8qKiBEZXRlY3RzIEludGVybmV0IEV4cGxvcmVyLiAqLw0KZnVuY3Rpb24gaXNJRSgpIHsNCiAgICBjb25zdCB1YSA9IGdldFVBKCk7DQogICAgcmV0dXJuIHVhLmluZGV4T2YoJ01TSUUgJykgPj0gMCB8fCB1YS5pbmRleE9mKCdUcmlkZW50LycpID49IDA7DQp9DQovKioNCiAqIERldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IFNESyBidWlsZCBpcyB0aGUgTm9kZSB2ZXJzaW9uLg0KICoNCiAqIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIHRoZSBOb2RlIFNESyBidWlsZC4NCiAqLw0KZnVuY3Rpb24gaXNOb2RlU2RrKCkgew0KICAgIHJldHVybiBDT05TVEFOVFMuTk9ERV9BRE1JTiA9PT0gdHJ1ZTsNCn0NCi8qKg0KICogVGhpcyBtZXRob2QgY2hlY2tzIGlmIGluZGV4ZWREQiBpcyBzdXBwb3J0ZWQgYnkgY3VycmVudCBicm93c2VyL3NlcnZpY2Ugd29ya2VyIGNvbnRleHQNCiAqIEByZXR1cm4gdHJ1ZSBpZiBpbmRleGVkREIgaXMgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3Nlci9zZXJ2aWNlIHdvcmtlciBjb250ZXh0DQogKi8NCmZ1bmN0aW9uIGlzSW5kZXhlZERCQXZhaWxhYmxlKCkgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhlZERCID09PSAnb2JqZWN0JzsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCi8qKg0KICogVGhpcyBtZXRob2QgdmFsaWRhdGVzIGJyb3dzZXIvc3cgY29udGV4dCBmb3IgaW5kZXhlZERCIGJ5IG9wZW5pbmcgYSBkdW1teSBpbmRleGVkREIgZGF0YWJhc2UgYW5kIHJlamVjdA0KICogaWYgZXJyb3JzIG9jY3VyIGR1cmluZyB0aGUgZGF0YWJhc2Ugb3BlbiBvcGVyYXRpb24uDQogKg0KICogQHRocm93cyBleGNlcHRpb24gaWYgY3VycmVudCBicm93c2VyL3N3IGNvbnRleHQgY2FuJ3QgcnVuIGlkYi5vcGVuIChleDogU2FmYXJpIGlmcmFtZSwgRmlyZWZveA0KICogcHJpdmF0ZSBicm93c2luZykNCiAqLw0KZnVuY3Rpb24gdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSgpIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgbGV0IHByZUV4aXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgIGNvbnN0IERCX0NIRUNLX05BTUUgPSAndmFsaWRhdGUtYnJvd3Nlci1jb250ZXh0LWZvci1pbmRleGVkZGItYW5hbHl0aWNzLW1vZHVsZSc7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihEQl9DSEVDS19OQU1FKTsNCiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzdWx0LmNsb3NlKCk7DQogICAgICAgICAgICAgICAgLy8gZGVsZXRlIGRhdGFiYXNlIG9ubHkgd2hlbiBpdCBkb2Vzbid0IHByZS1leGlzdA0KICAgICAgICAgICAgICAgIGlmICghcHJlRXhpc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoREJfQ0hFQ0tfTkFNRSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgcHJlRXhpc3QgPSBmYWxzZTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIF9hOw0KICAgICAgICAgICAgICAgIHJlamVjdCgoKF9hID0gcmVxdWVzdC5lcnJvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1lc3NhZ2UpIHx8ICcnKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAZmlsZW92ZXJ2aWV3IFN0YW5kYXJkaXplZCBGaXJlYmFzZSBFcnJvci4NCiAqDQogKiBVc2FnZToNCiAqDQogKiAgIC8vIFR5cGVzY3JpcHQgc3RyaW5nIGxpdGVyYWxzIGZvciB0eXBlLXNhZmUgY29kZXMNCiAqICAgdHlwZSBFcnIgPQ0KICogICAgICd1bmtub3duJyB8DQogKiAgICAgJ29iamVjdC1ub3QtZm91bmQnDQogKiAgICAgOw0KICoNCiAqICAgLy8gQ2xvc3VyZSBlbnVtIGZvciB0eXBlLXNhZmUgZXJyb3IgY29kZXMNCiAqICAgLy8gYXQtZW51bSB7c3RyaW5nfQ0KICogICB2YXIgRXJyID0gew0KICogICAgIFVOS05PV046ICd1bmtub3duJywNCiAqICAgICBPQkpFQ1RfTk9UX0ZPVU5EOiAnb2JqZWN0LW5vdC1mb3VuZCcsDQogKiAgIH0NCiAqDQogKiAgIGxldCBlcnJvcnM6IE1hcDxFcnIsIHN0cmluZz4gPSB7DQogKiAgICAgJ2dlbmVyaWMtZXJyb3InOiAiVW5rbm93biBlcnJvciIsDQogKiAgICAgJ2ZpbGUtbm90LWZvdW5kJzogIkNvdWxkIG5vdCBmaW5kIGZpbGU6IHskZmlsZX0iLA0KICogICB9Ow0KICoNCiAqICAgLy8gVHlwZS1zYWZlIGZ1bmN0aW9uIC0gbXVzdCBwYXNzIGEgdmFsaWQgZXJyb3IgY29kZSBhcyBwYXJhbS4NCiAqICAgbGV0IGVycm9yID0gbmV3IEVycm9yRmFjdG9yeTxFcnI+KCdzZXJ2aWNlJywgJ1NlcnZpY2UnLCBlcnJvcnMpOw0KICoNCiAqICAgLi4uDQogKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuR0VORVJJQyk7DQogKiAgIC4uLg0KICogICB0aHJvdyBlcnJvci5jcmVhdGUoRXJyLkZJTEVfTk9UX0ZPVU5ELCB7J2ZpbGUnOiBmaWxlTmFtZX0pOw0KICogICAuLi4NCiAqICAgLy8gU2VydmljZTogQ291bGQgbm90IGZpbGUgZmlsZTogZm9vLnR4dCAoc2VydmljZS9maWxlLW5vdC1mb3VuZCkuDQogKg0KICogICBjYXRjaCAoZSkgew0KICogICAgIGFzc2VydChlLm1lc3NhZ2UgPT09ICJDb3VsZCBub3QgZmluZCBmaWxlOiBmb28udHh0LiIpOw0KICogICAgIGlmICgoZSBhcyBGaXJlYmFzZUVycm9yKT8uY29kZSA9PT0gJ3NlcnZpY2UvZmlsZS1ub3QtZm91bmQnKSB7DQogKiAgICAgICBjb25zb2xlLmxvZygiQ291bGQgbm90IHJlYWQgZmlsZTogIiArIGVbJ2ZpbGUnXSk7DQogKiAgICAgfQ0KICogICB9DQogKi8NCmNvbnN0IEVSUk9SX05BTUUgPSAnRmlyZWJhc2VFcnJvcic7DQovLyBCYXNlZCBvbiBjb2RlIGZyb206DQovLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9FcnJvciNDdXN0b21fRXJyb3JfVHlwZXMNCmNsYXNzIEZpcmViYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7DQogICAgY29uc3RydWN0b3IoDQogICAgLyoqIFRoZSBlcnJvciBjb2RlIGZvciB0aGlzIGVycm9yLiAqLw0KICAgIGNvZGUsIG1lc3NhZ2UsIA0KICAgIC8qKiBDdXN0b20gZGF0YSBmb3IgdGhpcyBlcnJvci4gKi8NCiAgICBjdXN0b21EYXRhKSB7DQogICAgICAgIHN1cGVyKG1lc3NhZ2UpOw0KICAgICAgICB0aGlzLmNvZGUgPSBjb2RlOw0KICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSBjdXN0b21EYXRhOw0KICAgICAgICAvKiogVGhlIGN1c3RvbSBuYW1lIGZvciBhbGwgRmlyZWJhc2VFcnJvcnMuICovDQogICAgICAgIHRoaXMubmFtZSA9IEVSUk9SX05BTUU7DQogICAgICAgIC8vIEZpeCBGb3IgRVM1DQogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrDQogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBGaXJlYmFzZUVycm9yLnByb3RvdHlwZSk7DQogICAgICAgIC8vIE1haW50YWlucyBwcm9wZXIgc3RhY2sgdHJhY2UgZm9yIHdoZXJlIG91ciBlcnJvciB3YXMgdGhyb3duLg0KICAgICAgICAvLyBPbmx5IGF2YWlsYWJsZSBvbiBWOC4NCiAgICAgICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7DQogICAgICAgICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBFcnJvckZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpjbGFzcyBFcnJvckZhY3Rvcnkgew0KICAgIGNvbnN0cnVjdG9yKHNlcnZpY2UsIHNlcnZpY2VOYW1lLCBlcnJvcnMpIHsNCiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTsNCiAgICAgICAgdGhpcy5zZXJ2aWNlTmFtZSA9IHNlcnZpY2VOYW1lOw0KICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczsNCiAgICB9DQogICAgY3JlYXRlKGNvZGUsIC4uLmRhdGEpIHsNCiAgICAgICAgY29uc3QgY3VzdG9tRGF0YSA9IGRhdGFbMF0gfHwge307DQogICAgICAgIGNvbnN0IGZ1bGxDb2RlID0gYCR7dGhpcy5zZXJ2aWNlfS8ke2NvZGV9YDsNCiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmVycm9yc1tjb2RlXTsNCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRlbXBsYXRlID8gcmVwbGFjZVRlbXBsYXRlKHRlbXBsYXRlLCBjdXN0b21EYXRhKSA6ICdFcnJvcic7DQogICAgICAgIC8vIFNlcnZpY2UgTmFtZTogRXJyb3IgbWVzc2FnZSAoc2VydmljZS9jb2RlKS4NCiAgICAgICAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgJHt0aGlzLnNlcnZpY2VOYW1lfTogJHttZXNzYWdlfSAoJHtmdWxsQ29kZX0pLmA7DQogICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEZpcmViYXNlRXJyb3IoZnVsbENvZGUsIGZ1bGxNZXNzYWdlLCBjdXN0b21EYXRhKTsNCiAgICAgICAgcmV0dXJuIGVycm9yOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgZGF0YSkgew0KICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKFBBVFRFUk4sIChfLCBrZXkpID0+IHsNCiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2tleV07DQogICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsID8gU3RyaW5nKHZhbHVlKSA6IGA8JHtrZXl9Pz5gOw0KICAgIH0pOw0KfQ0KY29uc3QgUEFUVEVSTiA9IC9ce1wkKFtefV0rKX0vZzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRXZhbHVhdGVzIGEgSlNPTiBzdHJpbmcgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0Lg0KICoNCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcgY29udGFpbmluZyBKU09OLg0KICogQHJldHVybiB7Kn0gVGhlIGphdmFzY3JpcHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc3BlY2lmaWVkIEpTT04uDQogKi8NCmZ1bmN0aW9uIGpzb25FdmFsKHN0cikgew0KICAgIHJldHVybiBKU09OLnBhcnNlKHN0cik7DQp9DQovKioNCiAqIFJldHVybnMgSlNPTiByZXByZXNlbnRpbmcgYSBqYXZhc2NyaXB0IG9iamVjdC4NCiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhc2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC4NCiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEpTT04gY29udGVudHMgb2YgdGhlIG9iamVjdC4NCiAqLw0KZnVuY3Rpb24gc3RyaW5naWZ5KGRhdGEpIHsNCiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBpbnRvIGNvbnN0aXR1ZW50IHBhcnRzLg0KICoNCiAqIE5vdGVzOg0KICogLSBNYXkgcmV0dXJuIHdpdGggaW52YWxpZCAvIGluY29tcGxldGUgY2xhaW1zIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0Lg0KICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC4NCiAqLw0KY29uc3QgZGVjb2RlJDQgPSBmdW5jdGlvbiAodG9rZW4pIHsNCiAgICBsZXQgaGVhZGVyID0ge30sIGNsYWltcyA9IHt9LCBkYXRhID0ge30sIHNpZ25hdHVyZSA9ICcnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHBhcnRzID0gdG9rZW4uc3BsaXQoJy4nKTsNCiAgICAgICAgaGVhZGVyID0ganNvbkV2YWwoYmFzZTY0RGVjb2RlKHBhcnRzWzBdKSB8fCAnJyk7DQogICAgICAgIGNsYWltcyA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1sxXSkgfHwgJycpOw0KICAgICAgICBzaWduYXR1cmUgPSBwYXJ0c1syXTsNCiAgICAgICAgZGF0YSA9IGNsYWltc1snZCddIHx8IHt9Ow0KICAgICAgICBkZWxldGUgY2xhaW1zWydkJ107DQogICAgfQ0KICAgIGNhdGNoIChlKSB7IH0NCiAgICByZXR1cm4gew0KICAgICAgICBoZWFkZXIsDQogICAgICAgIGNsYWltcywNCiAgICAgICAgZGF0YSwNCiAgICAgICAgc2lnbmF0dXJlDQogICAgfTsNCn07DQovKioNCiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBpdHMgZm9ybWF0LiBFeHBlY3RzIGEgdmFsaWQgaXNzdWVkLWF0IHRpbWUuDQogKg0KICogTm90ZXM6DQogKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC4NCiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuDQogKi8NCmNvbnN0IGlzVmFsaWRGb3JtYXQgPSBmdW5jdGlvbiAodG9rZW4pIHsNCiAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlJDQodG9rZW4pLCBjbGFpbXMgPSBkZWNvZGVkLmNsYWltczsNCiAgICByZXR1cm4gISFjbGFpbXMgJiYgdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKTsNCn07DQovKioNCiAqIEF0dGVtcHRzIHRvIHBlZXIgaW50byBhbiBhdXRoIHRva2VuIGFuZCBkZXRlcm1pbmUgaWYgaXQncyBhbiBhZG1pbiBhdXRoIHRva2VuIGJ5IGxvb2tpbmcgYXQgdGhlIGNsYWltcyBwb3J0aW9uLg0KICoNCiAqIE5vdGVzOg0KICogLSBNYXkgcmV0dXJuIGEgZmFsc2UgbmVnYXRpdmUgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuDQogKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLg0KICovDQpjb25zdCBpc0FkbWluID0gZnVuY3Rpb24gKHRva2VuKSB7DQogICAgY29uc3QgY2xhaW1zID0gZGVjb2RlJDQodG9rZW4pLmNsYWltczsNCiAgICByZXR1cm4gdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zWydhZG1pbiddID09PSB0cnVlOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNvbnRhaW5zKG9iaiwga2V5KSB7DQogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7DQp9DQpmdW5jdGlvbiBzYWZlR2V0KG9iaiwga2V5KSB7DQogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsNCiAgICAgICAgcmV0dXJuIG9ialtrZXldOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQp9DQpmdW5jdGlvbiBpc0VtcHR5KG9iaikgew0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KZnVuY3Rpb24gbWFwJDEob2JqLCBmbiwgY29udGV4dE9iaikgew0KICAgIGNvbnN0IHJlcyA9IHt9Ow0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgew0KICAgICAgICAgICAgcmVzW2tleV0gPSBmbi5jYWxsKGNvbnRleHRPYmosIG9ialtrZXldLCBrZXksIG9iaik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlczsNCn0NCi8qKg0KICogRGVlcCBlcXVhbCB0d28gb2JqZWN0cy4gU3VwcG9ydCBBcnJheXMgYW5kIE9iamVjdHMuDQogKi8NCmZ1bmN0aW9uIGRlZXBFcXVhbChhLCBiKSB7DQogICAgaWYgKGEgPT09IGIpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGNvbnN0IGFLZXlzID0gT2JqZWN0LmtleXMoYSk7DQogICAgY29uc3QgYktleXMgPSBPYmplY3Qua2V5cyhiKTsNCiAgICBmb3IgKGNvbnN0IGsgb2YgYUtleXMpIHsNCiAgICAgICAgaWYgKCFiS2V5cy5pbmNsdWRlcyhrKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGFQcm9wID0gYVtrXTsNCiAgICAgICAgY29uc3QgYlByb3AgPSBiW2tdOw0KICAgICAgICBpZiAoaXNPYmplY3QkMShhUHJvcCkgJiYgaXNPYmplY3QkMShiUHJvcCkpIHsNCiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYVByb3AgIT09IGJQcm9wKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yIChjb25zdCBrIG9mIGJLZXlzKSB7DQogICAgICAgIGlmICghYUtleXMuaW5jbHVkZXMoaykpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCmZ1bmN0aW9uIGlzT2JqZWN0JDEodGhpbmcpIHsNCiAgICByZXR1cm4gdGhpbmcgIT09IG51bGwgJiYgdHlwZW9mIHRoaW5nID09PSAnb2JqZWN0JzsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUmV0dXJucyBhIHF1ZXJ5c3RyaW5nLWZvcm1hdHRlZCBzdHJpbmcgKGUuZy4gJmFyZz12YWwmYXJnMj12YWwyKSBmcm9tIGENCiAqIHBhcmFtcyBvYmplY3QgKGUuZy4ge2FyZzogJ3ZhbCcsIGFyZzI6ICd2YWwyJ30pDQogKiBOb3RlOiBZb3UgbXVzdCBwcmVwZW5kIGl0IHdpdGggPyB3aGVuIGFkZGluZyBpdCB0byBhIFVSTC4NCiAqLw0KZnVuY3Rpb24gcXVlcnlzdHJpbmckMShxdWVyeXN0cmluZ1BhcmFtcykgew0KICAgIGNvbnN0IHBhcmFtcyA9IFtdOw0KICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5c3RyaW5nUGFyYW1zKSkgew0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgICAgIHZhbHVlLmZvckVhY2goYXJyYXlWYWwgPT4gew0KICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFycmF5VmFsKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHBhcmFtcy5sZW5ndGggPyAnJicgKyBwYXJhbXMuam9pbignJicpIDogJyc7DQp9DQovKioNCiAqIERlY29kZXMgYSBxdWVyeXN0cmluZyAoZS5nLiA/YXJnPXZhbCZhcmcyPXZhbDIpIGludG8gYSBwYXJhbXMgb2JqZWN0DQogKiAoZS5nLiB7YXJnOiAndmFsJywgYXJnMjogJ3ZhbDInfSkNCiAqLw0KZnVuY3Rpb24gcXVlcnlzdHJpbmdEZWNvZGUocXVlcnlzdHJpbmcpIHsNCiAgICBjb25zdCBvYmogPSB7fTsNCiAgICBjb25zdCB0b2tlbnMgPSBxdWVyeXN0cmluZy5yZXBsYWNlKC9eXD8vLCAnJykuc3BsaXQoJyYnKTsNCiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7DQogICAgICAgIGlmICh0b2tlbikgew0KICAgICAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gdG9rZW4uc3BsaXQoJz0nKTsNCiAgICAgICAgICAgIG9ialtkZWNvZGVVUklDb21wb25lbnQoa2V5KV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIG9iajsNCn0NCi8qKg0KICogRXh0cmFjdCB0aGUgcXVlcnkgc3RyaW5nIHBhcnQgb2YgYSBVUkwsIGluY2x1ZGluZyB0aGUgbGVhZGluZyBxdWVzdGlvbiBtYXJrIChpZiBwcmVzZW50KS4NCiAqLw0KZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkgew0KICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSB1cmwuaW5kZXhPZignPycpOw0KICAgIGlmICghcXVlcnlTdGFydCkgew0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICAgIGNvbnN0IGZyYWdtZW50U3RhcnQgPSB1cmwuaW5kZXhPZignIycsIHF1ZXJ5U3RhcnQpOw0KICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHF1ZXJ5U3RhcnQsIGZyYWdtZW50U3RhcnQgPiAwID8gZnJhZ21lbnRTdGFydCA6IHVuZGVmaW5lZCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEBmaWxlb3ZlcnZpZXcgU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoLg0KICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzoNCiAqIGh0dHA6Ly9jc3JjLm5pc3QuZ292L3B1YmxpY2F0aW9ucy9maXBzL2ZpcHMxODAtMy9maXBzMTgwLTNfZmluYWwucGRmLg0KICoNCiAqIFVzYWdlOg0KICogICB2YXIgc2hhMSA9IG5ldyBzaGExKCk7DQogKiAgIHNoYTEudXBkYXRlKGJ5dGVzKTsNCiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpOw0KICoNCiAqIFBlcmZvcm1hbmNlOg0KICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3MNCiAqICAgRmlyZWZveCAxNjogIH4yNTAgTWJpdC9zDQogKg0KICovDQovKioNCiAqIFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaCBjb25zdHJ1Y3Rvci4NCiAqDQogKiBUaGUgcHJvcGVydGllcyBkZWNsYXJlZCBoZXJlIGFyZSBkaXNjdXNzZWQgaW4gdGhlIGFib3ZlIGFsZ29yaXRobSBkb2N1bWVudC4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGZpbmFsDQogKiBAc3RydWN0DQogKi8NCmNsYXNzIFNoYTEgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc18NCiAgICAgICAgICogZnVuY3Rpb24uDQogICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYWluXyA9IFtdOw0KICAgICAgICAvKioNCiAgICAgICAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0Lg0KICAgICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5idWZfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBbiBhcnJheSBvZiA4MCBieXRlcywgZWFjaCBhIHBhcnQgb2YgdGhlIG1lc3NhZ2UgdG8gYmUgaGFzaGVkLiAgUmVmZXJyZWQgdG8NCiAgICAgICAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuDQogICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLldfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb250YWlucyBkYXRhIG5lZWRlZCB0byBwYWQgbWVzc2FnZXMgbGVzcyB0aGFuIDY0IGJ5dGVzLg0KICAgICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wYWRfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBAcHJpdmF0ZSB7bnVtYmVyfQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwOw0KICAgICAgICAvKioNCiAgICAgICAgICogQHByaXZhdGUge251bWJlcn0NCiAgICAgICAgICovDQogICAgICAgIHRoaXMudG90YWxfID0gMDsNCiAgICAgICAgdGhpcy5ibG9ja1NpemUgPSA1MTIgLyA4Ow0KICAgICAgICB0aGlzLnBhZF9bMF0gPSAxMjg7DQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5ibG9ja1NpemU7ICsraSkgew0KICAgICAgICAgICAgdGhpcy5wYWRfW2ldID0gMDsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgfQ0KICAgIHJlc2V0KCkgew0KICAgICAgICB0aGlzLmNoYWluX1swXSA9IDB4Njc0NTIzMDE7DQogICAgICAgIHRoaXMuY2hhaW5fWzFdID0gMHhlZmNkYWI4OTsNCiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlOw0KICAgICAgICB0aGlzLmNoYWluX1szXSA9IDB4MTAzMjU0NzY7DQogICAgICAgIHRoaXMuY2hhaW5fWzRdID0gMHhjM2QyZTFmMDsNCiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwOw0KICAgICAgICB0aGlzLnRvdGFsXyA9IDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEludGVybmFsIGNvbXByZXNzIGhlbHBlciBmdW5jdGlvbi4NCiAgICAgKiBAcGFyYW0gYnVmIEJsb2NrIHRvIGNvbXByZXNzLg0KICAgICAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9mIHRoZSBibG9jayBpbiB0aGUgYnVmZmVyLg0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgY29tcHJlc3NfKGJ1Ziwgb2Zmc2V0KSB7DQogICAgICAgIGlmICghb2Zmc2V0KSB7DQogICAgICAgICAgICBvZmZzZXQgPSAwOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IFcgPSB0aGlzLldfOw0KICAgICAgICAvLyBnZXQgMTYgYmlnIGVuZGlhbiB3b3Jkcw0KICAgICAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgew0KICAgICAgICAgICAgICAgIC8vIFRPRE8odXNlcik6IFtidWcgODE0MDEyMl0gUmVjZW50IHZlcnNpb25zIG9mIFNhZmFyaSBmb3IgTWFjIE9TIGFuZCBpT1MNCiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgYnVnIHRoYXQgdHVybnMgdGhlIHBvc3QtaW5jcmVtZW50ICsrIG9wZXJhdG9yIGludG8gcHJlLWluY3JlbWVudA0KICAgICAgICAgICAgICAgIC8vIGR1cmluZyBKSVQgY29tcGlsYXRpb24uICBXZSBoYXZlIGNvZGUgdGhhdCBkZXBlbmRzIGhlYXZpbHkgb24gU0hBLTEgZm9yDQogICAgICAgICAgICAgICAgLy8gY29ycmVjdG5lc3MgYW5kIHdoaWNoIGlzIGFmZmVjdGVkIGJ5IHRoaXMgYnVnLCBzbyBJJ3ZlIHJlbW92ZWQgYWxsIHVzZXMNCiAgICAgICAgICAgICAgICAvLyBvZiBwb3N0LWluY3JlbWVudCArKyBpbiB3aGljaCB0aGUgcmVzdWx0IHZhbHVlIGlzIHVzZWQuICBXZSBjYW4gcmV2ZXJ0DQogICAgICAgICAgICAgICAgLy8gdGhpcyBjaGFuZ2Ugb25jZSB0aGUgU2FmYXJpIGJ1Zw0KICAgICAgICAgICAgICAgIC8vIChodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTA5MDM2KSBoYXMgYmVlbiBmaXhlZCBhbmQNCiAgICAgICAgICAgICAgICAvLyBtb3N0IGNsaWVudHMgaGF2ZSBiZWVuIHVwZGF0ZWQuDQogICAgICAgICAgICAgICAgV1tpXSA9DQogICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQpIDw8IDI0KSB8DQogICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQgKyAyKSA8PCA4KSB8DQogICAgICAgICAgICAgICAgICAgICAgICBidWYuY2hhckNvZGVBdChvZmZzZXQgKyAzKTsNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgew0KICAgICAgICAgICAgICAgIFdbaV0gPQ0KICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldF0gPDwgMjQpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMV0gPDwgMTYpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMl0gPDwgOCkgfA0KICAgICAgICAgICAgICAgICAgICAgICAgYnVmW29mZnNldCArIDNdOw0KICAgICAgICAgICAgICAgIG9mZnNldCArPSA0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIGV4cGFuZCB0byA4MCB3b3Jkcw0KICAgICAgICBmb3IgKGxldCBpID0gMTY7IGkgPCA4MDsgaSsrKSB7DQogICAgICAgICAgICBjb25zdCB0ID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTsNCiAgICAgICAgICAgIFdbaV0gPSAoKHQgPDwgMSkgfCAodCA+Pj4gMzEpKSAmIDB4ZmZmZmZmZmY7DQogICAgICAgIH0NCiAgICAgICAgbGV0IGEgPSB0aGlzLmNoYWluX1swXTsNCiAgICAgICAgbGV0IGIgPSB0aGlzLmNoYWluX1sxXTsNCiAgICAgICAgbGV0IGMgPSB0aGlzLmNoYWluX1syXTsNCiAgICAgICAgbGV0IGQgPSB0aGlzLmNoYWluX1szXTsNCiAgICAgICAgbGV0IGUgPSB0aGlzLmNoYWluX1s0XTsNCiAgICAgICAgbGV0IGYsIGs7DQogICAgICAgIC8vIFRPRE8odXNlcik6IFRyeSB0byB1bnJvbGwgdGhpcyBsb29wIHRvIHNwZWVkIHVwIHRoZSBjb21wdXRhdGlvbi4NCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaSA8IDQwKSB7DQogICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkgew0KICAgICAgICAgICAgICAgICAgICBmID0gZCBeIChiICYgKGMgXiBkKSk7DQogICAgICAgICAgICAgICAgICAgIGsgPSAweDVhODI3OTk5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDsNCiAgICAgICAgICAgICAgICAgICAgayA9IDB4NmVkOWViYTE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGkgPCA2MCkgew0KICAgICAgICAgICAgICAgICAgICBmID0gKGIgJiBjKSB8IChkICYgKGIgfCBjKSk7DQogICAgICAgICAgICAgICAgICAgIGsgPSAweDhmMWJiY2RjOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDsNCiAgICAgICAgICAgICAgICAgICAgayA9IDB4Y2E2MmMxZDY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdCA9ICgoKGEgPDwgNSkgfCAoYSA+Pj4gMjcpKSArIGYgKyBlICsgayArIFdbaV0pICYgMHhmZmZmZmZmZjsNCiAgICAgICAgICAgIGUgPSBkOw0KICAgICAgICAgICAgZCA9IGM7DQogICAgICAgICAgICBjID0gKChiIDw8IDMwKSB8IChiID4+PiAyKSkgJiAweGZmZmZmZmZmOw0KICAgICAgICAgICAgYiA9IGE7DQogICAgICAgICAgICBhID0gdDsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNoYWluX1swXSA9ICh0aGlzLmNoYWluX1swXSArIGEpICYgMHhmZmZmZmZmZjsNCiAgICAgICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7DQogICAgICAgIHRoaXMuY2hhaW5fWzJdID0gKHRoaXMuY2hhaW5fWzJdICsgYykgJiAweGZmZmZmZmZmOw0KICAgICAgICB0aGlzLmNoYWluX1szXSA9ICh0aGlzLmNoYWluX1szXSArIGQpICYgMHhmZmZmZmZmZjsNCiAgICAgICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7DQogICAgfQ0KICAgIHVwZGF0ZShieXRlcywgbGVuZ3RoKSB7DQogICAgICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrDQogICAgICAgIGlmIChieXRlcyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBsZW5ndGggPSBieXRlcy5sZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgbGVuZ3RoTWludXNCbG9jayA9IGxlbmd0aCAtIHRoaXMuYmxvY2tTaXplOw0KICAgICAgICBsZXQgbiA9IDA7DQogICAgICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2Lg0KICAgICAgICBjb25zdCBidWYgPSB0aGlzLmJ1Zl87DQogICAgICAgIGxldCBpbmJ1ZiA9IHRoaXMuaW5idWZfOw0KICAgICAgICAvLyBUaGUgb3V0ZXIgd2hpbGUgbG9vcCBzaG91bGQgZXhlY3V0ZSBhdCBtb3N0IHR3aWNlLg0KICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgLy8gV2hlbiB3ZSBoYXZlIG5vIGRhdGEgaW4gdGhlIGJsb2NrIHRvIHRvcCB1cCwgd2UgY2FuIGRpcmVjdGx5IHByb2Nlc3MgdGhlDQogICAgICAgICAgICAvLyBpbnB1dCBidWZmZXIgKGFzc3VtaW5nIGl0IGNvbnRhaW5zIHN1ZmZpY2llbnQgZGF0YSkuIFRoaXMgZ2l2ZXMgfjI1JQ0KICAgICAgICAgICAgLy8gc3BlZWR1cCBvbiBDaHJvbWUgMjMgYW5kIH4xNSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LCBidXQgcmVxdWlyZXMgdGhhdA0KICAgICAgICAgICAgLy8gdGhlIGRhdGEgaXMgcHJvdmlkZWQgaW4gbGFyZ2UgY2h1bmtzIChvciBpbiBtdWx0aXBsZXMgb2YgNjQgYnl0ZXMpLg0KICAgICAgICAgICAgaWYgKGluYnVmID09PSAwKSB7DQogICAgICAgICAgICAgICAgd2hpbGUgKG4gPD0gbGVuZ3RoTWludXNCbG9jaykgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhieXRlcywgbik7DQogICAgICAgICAgICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXMuY2hhckNvZGVBdChuKTsNCiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjsNCiAgICAgICAgICAgICAgICAgICAgKytuOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5idWYgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXNbbl07DQogICAgICAgICAgICAgICAgICAgICsraW5idWY7DQogICAgICAgICAgICAgICAgICAgICsrbjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wcmVzc18oYnVmKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluYnVmID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMuaW5idWZfID0gaW5idWY7DQogICAgICAgIHRoaXMudG90YWxfICs9IGxlbmd0aDsNCiAgICB9DQogICAgLyoqIEBvdmVycmlkZSAqLw0KICAgIGRpZ2VzdCgpIHsNCiAgICAgICAgY29uc3QgZGlnZXN0ID0gW107DQogICAgICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7DQogICAgICAgIC8vIEFkZCBwYWQgMHg4MCAweDAwKi4NCiAgICAgICAgaWYgKHRoaXMuaW5idWZfIDwgNTYpIHsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLnBhZF8sIHRoaXMuYmxvY2tTaXplIC0gKHRoaXMuaW5idWZfIC0gNTYpKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBZGQgIyBiaXRzLg0KICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ibG9ja1NpemUgLSAxOyBpID49IDU2OyBpLS0pIHsNCiAgICAgICAgICAgIHRoaXMuYnVmX1tpXSA9IHRvdGFsQml0cyAmIDI1NTsNCiAgICAgICAgICAgIHRvdGFsQml0cyAvPSAyNTY7IC8vIERvbid0IHVzZSBiaXQtc2hpZnRpbmcgaGVyZSENCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNvbXByZXNzXyh0aGlzLmJ1Zl8pOw0KICAgICAgICBsZXQgbiA9IDA7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMjQ7IGogPj0gMDsgaiAtPSA4KSB7DQogICAgICAgICAgICAgICAgZGlnZXN0W25dID0gKHRoaXMuY2hhaW5fW2ldID4+IGopICYgMjU1Ow0KICAgICAgICAgICAgICAgICsrbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZGlnZXN0Ow0KICAgIH0NCn0KCi8qKg0KICogSGVscGVyIHRvIG1ha2UgYSBTdWJzY3JpYmUgZnVuY3Rpb24gKGp1c3QgbGlrZSBQcm9taXNlIGhlbHBzIG1ha2UgYQ0KICogVGhlbmFibGUpLg0KICoNCiAqIEBwYXJhbSBleGVjdXRvciBGdW5jdGlvbiB3aGljaCBjYW4gbWFrZSBjYWxscyB0byBhIHNpbmdsZSBPYnNlcnZlcg0KICogICAgIGFzIGEgcHJveHkuDQogKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uDQogKi8NCmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZShleGVjdXRvciwgb25Ob09ic2VydmVycykgew0KICAgIGNvbnN0IHByb3h5ID0gbmV3IE9ic2VydmVyUHJveHkoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpOw0KICAgIHJldHVybiBwcm94eS5zdWJzY3JpYmUuYmluZChwcm94eSk7DQp9DQovKioNCiAqIEltcGxlbWVudCBmYW4tb3V0IGZvciBhbnkgbnVtYmVyIG9mIE9ic2VydmVycyBhdHRhY2hlZCB2aWEgYSBzdWJzY3JpYmUNCiAqIGZ1bmN0aW9uLg0KICovDQpjbGFzcyBPYnNlcnZlclByb3h5IHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXINCiAgICAgKiAgICAgYXMgYSBwcm94eS4NCiAgICAgKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uDQogICAgICovDQogICAgY29uc3RydWN0b3IoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpIHsNCiAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTsNCiAgICAgICAgdGhpcy51bnN1YnNjcmliZXMgPSBbXTsNCiAgICAgICAgdGhpcy5vYnNlcnZlckNvdW50ID0gMDsNCiAgICAgICAgLy8gTWljcm8tdGFzayBzY2hlZHVsaW5nIGJ5IGNhbGxpbmcgdGFzay50aGVuKCkuDQogICAgICAgIHRoaXMudGFzayA9IFByb21pc2UucmVzb2x2ZSgpOw0KICAgICAgICB0aGlzLmZpbmFsaXplZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLm9uTm9PYnNlcnZlcnMgPSBvbk5vT2JzZXJ2ZXJzOw0KICAgICAgICAvLyBDYWxsIHRoZSBleGVjdXRvciBhc3luY2hyb25vdXNseSBzbyBzdWJzY3JpYmVycyB0aGF0IGFyZSBjYWxsZWQNCiAgICAgICAgLy8gc3luY2hyb25vdXNseSBhZnRlciB0aGUgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmliZSBmdW5jdGlvbg0KICAgICAgICAvLyBjYW4gc3RpbGwgcmVjZWl2ZSB0aGUgdmVyeSBmaXJzdCB2YWx1ZSBnZW5lcmF0ZWQgaW4gdGhlIGV4ZWN1dG9yLg0KICAgICAgICB0aGlzLnRhc2sNCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIGV4ZWN1dG9yKHRoaXMpOw0KICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgdGhpcy5lcnJvcihlKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIG5leHQodmFsdWUpIHsNCiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7DQogICAgICAgICAgICBvYnNlcnZlci5uZXh0KHZhbHVlKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGVycm9yKGVycm9yKSB7DQogICAgICAgIHRoaXMuZm9yRWFjaE9ic2VydmVyKChvYnNlcnZlcikgPT4gew0KICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5jbG9zZShlcnJvcik7DQogICAgfQ0KICAgIGNvbXBsZXRlKCkgew0KICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHsNCiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNsb3NlKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFN1YnNjcmliZSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBhbiBPYnNlcnZlciB0byB0aGUgZmFuLW91dCBsaXN0Lg0KICAgICAqDQogICAgICogLSBXZSByZXF1aXJlIHRoYXQgbm8gZXZlbnQgaXMgc2VudCB0byBhIHN1YnNjcmliZXIgc3ljaHJvbm91c2x5IHRvIHRoZWlyDQogICAgICogICBjYWxsIHRvIHN1YnNjcmliZSgpLg0KICAgICAqLw0KICAgIHN1YnNjcmliZShuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlKSB7DQogICAgICAgIGxldCBvYnNlcnZlcjsNCiAgICAgICAgaWYgKG5leHRPck9ic2VydmVyID09PSB1bmRlZmluZWQgJiYNCiAgICAgICAgICAgIGVycm9yID09PSB1bmRlZmluZWQgJiYNCiAgICAgICAgICAgIGNvbXBsZXRlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPYnNlcnZlci4nKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBc3NlbWJsZSBhbiBPYnNlcnZlciBvYmplY3Qgd2hlbiBwYXNzZWQgYXMgY2FsbGJhY2sgZnVuY3Rpb25zLg0KICAgICAgICBpZiAoaW1wbGVtZW50c0FueU1ldGhvZHMobmV4dE9yT2JzZXJ2ZXIsIFsNCiAgICAgICAgICAgICduZXh0JywNCiAgICAgICAgICAgICdlcnJvcicsDQogICAgICAgICAgICAnY29tcGxldGUnDQogICAgICAgIF0pKSB7DQogICAgICAgICAgICBvYnNlcnZlciA9IG5leHRPck9ic2VydmVyOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgb2JzZXJ2ZXIgPSB7DQogICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsDQogICAgICAgICAgICAgICAgZXJyb3IsDQogICAgICAgICAgICAgICAgY29tcGxldGUNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9ic2VydmVyLm5leHQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCA9IG5vb3AkMzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob2JzZXJ2ZXIuZXJyb3IgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IgPSBub29wJDM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9ic2VydmVyLmNvbXBsZXRlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlID0gbm9vcCQzOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHVuc3ViID0gdGhpcy51bnN1YnNjcmliZU9uZS5iaW5kKHRoaXMsIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCk7DQogICAgICAgIC8vIEF0dGVtcHQgdG8gc3Vic2NyaWJlIHRvIGEgdGVybWluYXRlZCBPYnNlcnZhYmxlIC0gd2UNCiAgICAgICAgLy8ganVzdCByZXNwb25kIHRvIHRoZSBPYnNlcnZlciB3aXRoIHRoZSBmaW5hbCBlcnJvciBvciBjb21wbGV0ZQ0KICAgICAgICAvLyBldmVudC4NCiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5maW5hbEVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTsNCiAgICAgICAgcmV0dXJuIHVuc3ViOw0KICAgIH0NCiAgICAvLyBVbnN1YnNjcmliZSBpcyBzeW5jaHJvbm91cyAtIHdlIGd1YXJhbnRlZSB0aGF0IG5vIGV2ZW50cyBhcmUgc2VudCB0bw0KICAgIC8vIGFueSB1bnN1YnNjcmliZWQgT2JzZXJ2ZXIuDQogICAgdW5zdWJzY3JpYmVPbmUoaSkgew0KICAgICAgICBpZiAodGhpcy5vYnNlcnZlcnMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLm9ic2VydmVyc1tpXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2ldOw0KICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgLT0gMTsNCiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJDb3VudCA9PT0gMCAmJiB0aGlzLm9uTm9PYnNlcnZlcnMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzKHRoaXMpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZvckVhY2hPYnNlcnZlcihmbikgew0KICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHsNCiAgICAgICAgICAgIC8vIEFscmVhZHkgY2xvc2VkIGJ5IHByZXZpb3VzIGV2ZW50Li4uLmp1c3QgZWF0IHRoZSBhZGRpdGlvbmFsIHZhbHVlcy4NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBTaW5jZSBzZW5kT25lIGNhbGxzIGFzeW5jaHJvbm91c2x5IC0gdGhlcmUgaXMgbm8gY2hhbmNlIHRoYXQNCiAgICAgICAgLy8gdGhpcy5vYnNlcnZlcnMgd2lsbCBiZWNvbWUgdW5kZWZpbmVkLg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRPbmUoaSwgZm4pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIENhbGwgdGhlIE9ic2VydmVyIHZpYSBvbmUgb2YgaXQncyBjYWxsYmFjayBmdW5jdGlvbi4gV2UgYXJlIGNhcmVmdWwgdG8NCiAgICAvLyBjb25maXJtIHRoYXQgdGhlIG9ic2VydmUgaGFzIG5vdCBiZWVuIHVuc3Vic2NyaWJlZCBzaW5jZSB0aGlzIGFzeW5jaHJvbm91cw0KICAgIC8vIGZ1bmN0aW9uIGhhZCBiZWVuIHF1ZXVlZC4NCiAgICBzZW5kT25lKGksIGZuKSB7DQogICAgICAgIC8vIEV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFzeW5jaHJvbm91c2x5DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMNCiAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vYnNlcnZlcnNbaV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGZuKHRoaXMub2JzZXJ2ZXJzW2ldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGV4Y2VwdGlvbnMgcmFpc2VkIGluIE9ic2VydmVycyBvciBtaXNzaW5nIG1ldGhvZHMgb2YgYW4NCiAgICAgICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZXIuDQogICAgICAgICAgICAgICAgICAgIC8vIExvZyBlcnJvciB0byBjb25zb2xlLiBiLzMxNDA0ODA2DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5lcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNsb3NlKGVycikgew0KICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmZpbmFsaXplZCA9IHRydWU7DQogICAgICAgIGlmIChlcnIgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5maW5hbEVycm9yID0gZXJyOw0KICAgICAgICB9DQogICAgICAgIC8vIFByb3h5IGlzIG5vIGxvbmdlciBuZWVkZWQgLSBnYXJiYWdlIGNvbGxlY3QgcmVmZXJlbmNlcw0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gdW5kZWZpbmVkOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybiB0cnVlIGlmIHRoZSBvYmplY3QgcGFzc2VkIGluIGltcGxlbWVudHMgYW55IG9mIHRoZSBuYW1lZCBtZXRob2RzLg0KICovDQpmdW5jdGlvbiBpbXBsZW1lbnRzQW55TWV0aG9kcyhvYmosIG1ldGhvZHMpIHsNCiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgZm9yIChjb25zdCBtZXRob2Qgb2YgbWV0aG9kcykgew0KICAgICAgICBpZiAobWV0aG9kIGluIG9iaiAmJiB0eXBlb2Ygb2JqW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIG5vb3AkMygpIHsNCiAgICAvLyBkbyBub3RoaW5nDQp9Ci8qKg0KICogR2VuZXJhdGVzIGEgc3RyaW5nIHRvIHByZWZpeCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IGZhaWxlZCBhcmd1bWVudCB2YWxpZGF0aW9uDQogKg0KICogQHBhcmFtIGZuTmFtZSBUaGUgZnVuY3Rpb24gbmFtZQ0KICogQHBhcmFtIGFyZ05hbWUgVGhlIG5hbWUgb2YgdGhlIGFyZ3VtZW50DQogKiBAcmV0dXJuIFRoZSBwcmVmaXggdG8gYWRkIHRvIHRoZSBlcnJvciB0aHJvd24gZm9yIHZhbGlkYXRpb24uDQogKi8NCmZ1bmN0aW9uIGVycm9yUHJlZml4KGZuTmFtZSwgYXJnTmFtZSkgew0KICAgIHJldHVybiBgJHtmbk5hbWV9IGZhaWxlZDogJHthcmdOYW1lfSBhcmd1bWVudCBgOw0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIENvZGUgb3JpZ2luYWxseSBjYW1lIGZyb20gZ29vZy5jcnlwdC5zdHJpbmdUb1V0ZjhCeXRlQXJyYXksIGJ1dCBmb3Igc29tZSByZWFzb24gdGhleQ0KLy8gYXV0b21hdGljYWxseSByZXBsYWNlZCAnXHJcbicgd2l0aCAnXG4nLCBhbmQgdGhleSBkaWRuJ3QgaGFuZGxlIHN1cnJvZ2F0ZSBwYWlycywNCi8vIHNvIGl0J3MgYmVlbiBtb2RpZmllZC4NCi8vIE5vdGUgdGhhdCBub3QgYWxsIFVuaWNvZGUgY2hhcmFjdGVycyBhcHBlYXIgYXMgc2luZ2xlIGNoYXJhY3RlcnMgaW4gSmF2YVNjcmlwdCBzdHJpbmdzLg0KLy8gZnJvbUNoYXJDb2RlIHJldHVybnMgdGhlIFVURi0xNiBlbmNvZGluZyBvZiBhIGNoYXJhY3RlciAtIHNvIHNvbWUgVW5pY29kZSBjaGFyYWN0ZXJzDQovLyB1c2UgMiBjaGFyYWN0ZXJzIGluIEphdmFzY3JpcHQuICBBbGwgNC1ieXRlIFVURi04IGNoYXJhY3RlcnMgYmVnaW4gd2l0aCBhIGZpcnN0DQovLyBjaGFyYWN0ZXIgaW4gdGhlIHJhbmdlIDB4RDgwMCAtIDB4REJGRiAodGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIHNvLWNhbGxlZCBzdXJyb2dhdGUNCi8vIHBhaXIpLg0KLy8gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xLjMNCi8qKg0KICogQHBhcmFtIHtzdHJpbmd9IHN0cg0KICogQHJldHVybiB7QXJyYXl9DQogKi8NCmNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHN0cikgew0KICAgIGNvbnN0IG91dCA9IFtdOw0KICAgIGxldCBwID0gMDsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgew0KICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOw0KICAgICAgICAvLyBJcyB0aGlzIHRoZSBsZWFkIHN1cnJvZ2F0ZSBpbiBhIHN1cnJvZ2F0ZSBwYWlyPw0KICAgICAgICBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHsNCiAgICAgICAgICAgIGNvbnN0IGhpZ2ggPSBjIC0gMHhkODAwOyAvLyB0aGUgaGlnaCAxMCBiaXRzLg0KICAgICAgICAgICAgaSsrOw0KICAgICAgICAgICAgYXNzZXJ0KGkgPCBzdHIubGVuZ3RoLCAnU3Vycm9nYXRlIHBhaXIgbWlzc2luZyB0cmFpbCBzdXJyb2dhdGUuJyk7DQogICAgICAgICAgICBjb25zdCBsb3cgPSBzdHIuY2hhckNvZGVBdChpKSAtIDB4ZGMwMDsgLy8gdGhlIGxvdyAxMCBiaXRzLg0KICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoaGlnaCA8PCAxMCkgKyBsb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGMgPCAxMjgpIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gYzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkgew0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA8IDY1NTM2KSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDsNCiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwOw0KICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvdXQ7DQp9Ow0KLyoqDQogKiBDYWxjdWxhdGUgbGVuZ3RoIHdpdGhvdXQgYWN0dWFsbHkgY29udmVydGluZzsgdXNlZnVsIGZvciBkb2luZyBjaGVhcGVyIHZhbGlkYXRpb24uDQogKiBAcGFyYW0ge3N0cmluZ30gc3RyDQogKiBAcmV0dXJuIHtudW1iZXJ9DQogKi8NCmNvbnN0IHN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIChzdHIpIHsNCiAgICBsZXQgcCA9IDA7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOw0KICAgICAgICBpZiAoYyA8IDEyOCkgew0KICAgICAgICAgICAgcCsrOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGMgPCAyMDQ4KSB7DQogICAgICAgICAgICBwICs9IDI7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHsNCiAgICAgICAgICAgIC8vIExlYWQgc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIuICBUaGUgcGFpciB0b2dldGhlciB3aWxsIHRha2UgNCBieXRlcyB0byByZXByZXNlbnQuDQogICAgICAgICAgICBwICs9IDQ7DQogICAgICAgICAgICBpKys7IC8vIHNraXAgdHJhaWwgc3Vycm9nYXRlLg0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcCArPSAzOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGdldE1vZHVsYXJJbnN0YW5jZShzZXJ2aWNlKSB7DQogICAgaWYgKHNlcnZpY2UgJiYgc2VydmljZS5fZGVsZWdhdGUpIHsNCiAgICAgICAgcmV0dXJuIHNlcnZpY2UuX2RlbGVnYXRlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHNlcnZpY2U7DQogICAgfQ0KfQoKLyoqDQogKiBDb21wb25lbnQgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgDQogKi8NCmNsYXNzIENvbXBvbmVudCB7DQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgcHVibGljIHNlcnZpY2UgbmFtZSwgZS5nLiBhcHAsIGF1dGgsIGZpcmVzdG9yZSwgZGF0YWJhc2UNCiAgICAgKiBAcGFyYW0gaW5zdGFuY2VGYWN0b3J5IFNlcnZpY2UgZmFjdG9yeSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIHB1YmxpYyBpbnRlcmZhY2UNCiAgICAgKiBAcGFyYW0gdHlwZSB3aGV0aGVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVkIGJ5IHRoZSBjb21wb25lbnQgaXMgcHVibGljIG9yIHByaXZhdGUNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihuYW1lLCBpbnN0YW5jZUZhY3RvcnksIHR5cGUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZUZhY3RvcnkgPSBpbnN0YW5jZUZhY3Rvcnk7DQogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7DQogICAgICAgIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgPSBmYWxzZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFByb3BlcnRpZXMgdG8gYmUgYWRkZWQgdG8gdGhlIHNlcnZpY2UgbmFtZXNwYWNlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNlcnZpY2VQcm9wcyA9IHt9Ow0KICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gIkxBWlkiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkxBWlkgKi87DQogICAgICAgIHRoaXMub25JbnN0YW5jZUNyZWF0ZWQgPSBudWxsOw0KICAgIH0NCiAgICBzZXRJbnN0YW50aWF0aW9uTW9kZShtb2RlKSB7DQogICAgICAgIHRoaXMuaW5zdGFudGlhdGlvbk1vZGUgPSBtb2RlOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgc2V0TXVsdGlwbGVJbnN0YW5jZXMobXVsdGlwbGVJbnN0YW5jZXMpIHsNCiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IG11bHRpcGxlSW5zdGFuY2VzOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgc2V0U2VydmljZVByb3BzKHByb3BzKSB7DQogICAgICAgIHRoaXMuc2VydmljZVByb3BzID0gcHJvcHM7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICBzZXRJbnN0YW5jZUNyZWF0ZWRDYWxsYmFjayhjYWxsYmFjaykgew0KICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gY2FsbGJhY2s7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSQxID0gJ1tERUZBVUxUXSc7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFByb3ZpZGVyIGZvciBpbnN0YW5jZSBmb3Igc2VydmljZSBuYW1lIFQsIGUuZy4gJ2F1dGgnLCAnYXV0aC1pbnRlcm5hbCcNCiAqIE5hbWVTZXJ2aWNlTWFwcGluZ1tUXSBpcyBhbiBhbGlhcyBmb3IgdGhlIHR5cGUgb2YgdGhlIGluc3RhbmNlDQogKi8NCmNsYXNzIFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb250YWluZXIpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7DQogICAgICAgIHRoaXMuY29tcG9uZW50ID0gbnVsbDsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5vbkluaXRDYWxsYmFja3MgPSBuZXcgTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEEgcHJvdmlkZXIgY2FuIHByb3ZpZGUgbXVsaXRwbGUgaW5zdGFuY2VzIG9mIGEgc2VydmljZQ0KICAgICAqIGlmIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzIGlzIHRydWUuDQogICAgICovDQogICAgZ2V0KGlkZW50aWZpZXIpIHsNCiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWUNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlc0RlZmVycmVkLmhhcyhub3JtYWxpemVkSWRlbnRpZmllcikpIHsNCiAgICAgICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7DQogICAgICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZGVmZXJyZWQpOw0KICAgICAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHwNCiAgICAgICAgICAgICAgICB0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzZXJ2aWNlIGlmIGl0IGNhbiBiZSBhdXRvLWluaXRpYWxpemVkDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIGdldCgpLCBpdCBzaG91bGQgbm90IGNhdXNlDQogICAgICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgcmV0dXJuIHRoZSB1bnJlc29sdmVkIHByb21pc2UgaW4gdGhpcyBjYXNlLg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpLnByb21pc2U7DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZShvcHRpb25zKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWUNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuaWRlbnRpZmllcik7DQogICAgICAgIGNvbnN0IG9wdGlvbmFsID0gKF9hID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLm9wdGlvbmFsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZTsNCiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHwNCiAgICAgICAgICAgIHRoaXMuc2hvdWxkQXV0b0luaXRpYWxpemUoKSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHsNCiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIEluIGNhc2UgYSBjb21wb25lbnQgaXMgbm90IGluaXRpYWxpemVkIGFuZCBzaG91bGQvY2FuIG5vdCBiZSBhdXRvLWluaXRpYWxpemVkIGF0IHRoZSBtb21lbnQsIHJldHVybiBudWxsIGlmIHRoZSBvcHRpb25hbCBmbGFnIGlzIHNldCwgb3IgdGhyb3cNCiAgICAgICAgICAgIGlmIChvcHRpb25hbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYFNlcnZpY2UgJHt0aGlzLm5hbWV9IGlzIG5vdCBhdmFpbGFibGVgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRDb21wb25lbnQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudDsNCiAgICB9DQogICAgc2V0Q29tcG9uZW50KGNvbXBvbmVudCkgew0KICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgIT09IHRoaXMubmFtZSkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1pc21hdGNoaW5nIENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmb3IgUHJvdmlkZXIgJHt0aGlzLm5hbWV9LmApOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvbXBvbmVudCBmb3IgJHt0aGlzLm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcHJvdmlkZWRgKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudDsNCiAgICAgICAgLy8gcmV0dXJuIGVhcmx5IHdpdGhvdXQgYXR0ZW1wdGluZyB0byBpbml0aWFsaXplIHRoZSBjb21wb25lbnQgaWYgdGhlIGNvbXBvbmVudCByZXF1aXJlcyBleHBsaWNpdCBpbml0aWFsaXphdGlvbiAoY2FsbGluZyBgUHJvdmlkZXIuaW5pdGlhbGl6ZSgpYCkNCiAgICAgICAgaWYgKCF0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBpZiB0aGUgc2VydmljZSBpcyBlYWdlciwgaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZQ0KICAgICAgICBpZiAoaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7IGluc3RhbmNlSWRlbnRpZmllcjogREVGQVVMVF9FTlRSWV9OQU1FJDEgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgZm9yIGFuIGVhZ2VyIENvbXBvbmVudCB0aHJvd3MgYW4gZXhjZXB0aW9uIGR1cmluZyB0aGUgZWFnZXINCiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZSBhIGZhdGFsIGVycm9yLg0KICAgICAgICAgICAgICAgIC8vIFRPRE86IEludmVzdGlnYXRlIGlmIHdlIG5lZWQgdG8gbWFrZSBpdCBjb25maWd1cmFibGUsIGJlY2F1c2Ugc29tZSBjb21wb25lbnQgbWF5IHdhbnQgdG8gY2F1c2UNCiAgICAgICAgICAgICAgICAvLyBhIGZhdGFsIGVycm9yIGluIHRoaXMgY2FzZT8NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBDcmVhdGUgc2VydmljZSBpbnN0YW5jZXMgZm9yIHRoZSBwZW5kaW5nIHByb21pc2VzIGFuZCByZXNvbHZlIHRoZW0NCiAgICAgICAgLy8gTk9URTogaWYgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyBpcyBmYWxzZSwgb25seSB0aGUgZGVmYXVsdCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWQNCiAgICAgICAgLy8gYW5kIGFsbCBwcm9taXNlcyB3aXRoIHJlc29sdmUgd2l0aCBpdCByZWdhcmRsZXNzIG9mIHRoZSBpZGVudGlmaWVyLg0KICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIGBnZXRPckluaXRpYWxpemVTZXJ2aWNlKClgIHNob3VsZCBhbHdheXMgcmV0dXJuIGEgdmFsaWQgaW5zdGFuY2Ugc2luY2UgYSBjb21wb25lbnQgaXMgZ3VhcmFudGVlZC4gdXNlICEgdG8gbWFrZSB0eXBlc2NyaXB0IGhhcHB5Lg0KICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHsNCiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZQ0KICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgbGVhdmUgdGhlIHByb21pc2UgdW5yZXNvbHZlZC4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjbGVhckluc3RhbmNlKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUkMSkgew0KICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmRlbGV0ZShpZGVudGlmaWVyKTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXNPcHRpb25zLmRlbGV0ZShpZGVudGlmaWVyKTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXMuZGVsZXRlKGlkZW50aWZpZXIpOw0KICAgIH0NCiAgICAvLyBhcHAuZGVsZXRlKCkgd2lsbCBjYWxsIHRoaXMgbWV0aG9kIG9uIGV2ZXJ5IHByb3ZpZGVyIHRvIGRlbGV0ZSB0aGUgc2VydmljZXMNCiAgICAvLyBUT0RPOiBzaG91bGQgd2UgbWFyayB0aGUgcHJvdmlkZXIgYXMgZGVsZXRlZD8NCiAgICBhc3luYyBkZWxldGUoKSB7DQogICAgICAgIGNvbnN0IHNlcnZpY2VzID0gQXJyYXkuZnJvbSh0aGlzLmluc3RhbmNlcy52YWx1ZXMoKSk7DQogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgIC4uLnNlcnZpY2VzDQogICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdJTlRFUk5BTCcgaW4gc2VydmljZSkgLy8gbGVnYWN5IHNlcnZpY2VzDQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAubWFwKHNlcnZpY2UgPT4gc2VydmljZS5JTlRFUk5BTC5kZWxldGUoKSksDQogICAgICAgICAgICAuLi5zZXJ2aWNlcw0KICAgICAgICAgICAgICAgIC5maWx0ZXIoc2VydmljZSA9PiAnX2RlbGV0ZScgaW4gc2VydmljZSkgLy8gbW9kdWxhcml6ZWQgc2VydmljZXMNCiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLl9kZWxldGUoKSkNCiAgICAgICAgXSk7DQogICAgfQ0KICAgIGlzQ29tcG9uZW50U2V0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQgIT0gbnVsbDsNCiAgICB9DQogICAgaXNJbml0aWFsaXplZChpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FJDEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTsNCiAgICB9DQogICAgZ2V0T3B0aW9ucyhpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FJDEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5nZXQoaWRlbnRpZmllcikgfHwge307DQogICAgfQ0KICAgIGluaXRpYWxpemUob3B0cyA9IHt9KSB7DQogICAgICAgIGNvbnN0IHsgb3B0aW9ucyA9IHt9IH0gPSBvcHRzOw0KICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdHMuaW5zdGFuY2VJZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikpIHsNCiAgICAgICAgICAgIHRocm93IEVycm9yKGAke3RoaXMubmFtZX0oJHtub3JtYWxpemVkSWRlbnRpZmllcn0pIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWRgKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRoaXMuaXNDb21wb25lbnRTZXQoKSkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvbXBvbmVudCAke3RoaXMubmFtZX0gaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQgeWV0YCk7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoew0KICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllciwNCiAgICAgICAgICAgIG9wdGlvbnMNCiAgICAgICAgfSk7DQogICAgICAgIC8vIHJlc29sdmUgYW55IHBlbmRpbmcgcHJvbWlzZSB3YWl0aW5nIGZvciB0aGUgc2VydmljZSBpbnN0YW5jZQ0KICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkRGVmZXJyZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaW5zdGFuY2VJZGVudGlmaWVyKTsNCiAgICAgICAgICAgIGlmIChub3JtYWxpemVkSWRlbnRpZmllciA9PT0gbm9ybWFsaXplZERlZmVycmVkSWRlbnRpZmllcikgew0KICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGluc3RhbmNlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKg0KICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGludm9rZWQgIGFmdGVyIHRoZSBwcm92aWRlciBoYXMgYmVlbiBpbml0aWFsaXplZCBieSBjYWxsaW5nIHByb3ZpZGVyLmluaXRpYWxpemUoKS4NCiAgICAgKiBUaGUgZnVuY3Rpb24gaXMgaW52b2tlZCBTWU5DSFJPTk9VU0xZLCBzbyBpdCBzaG91bGQgbm90IGV4ZWN1dGUgYW55IGxvbmdydW5uaW5nIHRhc2tzIGluIG9yZGVyIHRvIG5vdCBibG9jayB0aGUgcHJvZ3JhbS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEFuIG9wdGlvbmFsIGluc3RhbmNlIGlkZW50aWZpZXINCiAgICAgKiBAcmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgdGhlIGNhbGxiYWNrDQogICAgICovDQogICAgb25Jbml0KGNhbGxiYWNrLCBpZGVudGlmaWVyKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTsNCiAgICAgICAgY29uc3QgZXhpc3RpbmdDYWxsYmFja3MgPSAoX2EgPSB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBuZXcgU2V0KCk7DQogICAgICAgIGV4aXN0aW5nQ2FsbGJhY2tzLmFkZChjYWxsYmFjayk7DQogICAgICAgIHRoaXMub25Jbml0Q2FsbGJhY2tzLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZXhpc3RpbmdDYWxsYmFja3MpOw0KICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKGV4aXN0aW5nSW5zdGFuY2UpIHsNCiAgICAgICAgICAgIGNhbGxiYWNrKGV4aXN0aW5nSW5zdGFuY2UsIG5vcm1hbGl6ZWRJZGVudGlmaWVyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCkgPT4gew0KICAgICAgICAgICAgZXhpc3RpbmdDYWxsYmFja3MuZGVsZXRlKGNhbGxiYWNrKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgLyoqDQogICAgICogSW52b2tlIG9uSW5pdCBjYWxsYmFja3Mgc3luY2hyb25vdXNseQ0KICAgICAqIEBwYXJhbSBpbnN0YW5jZSB0aGUgc2VydmljZSBpbnN0YW5jZWANCiAgICAgKi8NCiAgICBpbnZva2VPbkluaXRDYWxsYmFja3MoaW5zdGFuY2UsIGlkZW50aWZpZXIpIHsNCiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gdGhpcy5vbkluaXRDYWxsYmFja3MuZ2V0KGlkZW50aWZpZXIpOw0KICAgICAgICBpZiAoIWNhbGxiYWNrcykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgY2FsbGJhY2tzKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGluc3RhbmNlLCBpZGVudGlmaWVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBlcnJvcnMgaW4gdGhlIG9uSW5pdCBjYWxsYmFjaw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXIsIG9wdGlvbnMgPSB7fSB9KSB7DQogICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VzLmdldChpbnN0YW5jZUlkZW50aWZpZXIpOw0KICAgICAgICBpZiAoIWluc3RhbmNlICYmIHRoaXMuY29tcG9uZW50KSB7DQogICAgICAgICAgICBpbnN0YW5jZSA9IHRoaXMuY29tcG9uZW50Lmluc3RhbmNlRmFjdG9yeSh0aGlzLmNvbnRhaW5lciwgew0KICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaW5zdGFuY2VJZGVudGlmaWVyKSwNCiAgICAgICAgICAgICAgICBvcHRpb25zDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTsNCiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBvcHRpb25zKTsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW52b2tlIG9uSW5pdCBsaXN0ZW5lcnMuDQogICAgICAgICAgICAgKiBOb3RlIHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkIGlzIGRpZmZlcmVudCwgd2hpY2ggaXMgdXNlZCBieSB0aGUgY29tcG9uZW50IGNyZWF0b3IsDQogICAgICAgICAgICAgKiB3aGlsZSBvbkluaXQgbGlzdGVuZXJzIGFyZSByZWdpc3RlcmVkIGJ5IGNvbnN1bWVycyBvZiB0aGUgcHJvdmlkZXIuDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHRoaXMuaW52b2tlT25Jbml0Q2FsbGJhY2tzKGluc3RhbmNlLCBpbnN0YW5jZUlkZW50aWZpZXIpOw0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBPcmRlciBpcyBpbXBvcnRhbnQNCiAgICAgICAgICAgICAqIG9uSW5zdGFuY2VDcmVhdGVkKCkgc2hvdWxkIGJlIGNhbGxlZCBhZnRlciB0aGlzLmluc3RhbmNlcy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7IHdoaWNoDQogICAgICAgICAgICAgKiBtYWtlcyBgaXNJbml0aWFsaXplZCgpYCByZXR1cm4gdHJ1ZS4NCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQodGhpcy5jb250YWluZXIsIGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIGVycm9ycyBpbiB0aGUgb25JbnN0YW5jZUNyZWF0ZWRDYWxsYmFjaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaW5zdGFuY2UgfHwgbnVsbDsNCiAgICB9DQogICAgbm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUkMSkgew0KICAgICAgICBpZiAodGhpcy5jb21wb25lbnQpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudC5tdWx0aXBsZUluc3RhbmNlcyA/IGlkZW50aWZpZXIgOiBERUZBVUxUX0VOVFJZX05BTUUkMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyOyAvLyBhc3N1bWUgbXVsdGlwbGUgaW5zdGFuY2VzIGFyZSBzdXBwb3J0ZWQgYmVmb3JlIHRoZSBjb21wb25lbnQgaXMgcHJvdmlkZWQuDQogICAgICAgIH0NCiAgICB9DQogICAgc2hvdWxkQXV0b0luaXRpYWxpemUoKSB7DQogICAgICAgIHJldHVybiAoISF0aGlzLmNvbXBvbmVudCAmJg0KICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgIT09ICJFWFBMSUNJVCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pOw0KICAgIH0NCn0NCi8vIHVuZGVmaW5lZCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBzZXJ2aWNlIGZhY3RvcnkgZm9yIHRoZSBkZWZhdWx0IGluc3RhbmNlDQpmdW5jdGlvbiBub3JtYWxpemVJZGVudGlmaWVyRm9yRmFjdG9yeShpZGVudGlmaWVyKSB7DQogICAgcmV0dXJuIGlkZW50aWZpZXIgPT09IERFRkFVTFRfRU5UUllfTkFNRSQxID8gdW5kZWZpbmVkIDogaWRlbnRpZmllcjsNCn0NCmZ1bmN0aW9uIGlzQ29tcG9uZW50RWFnZXIoY29tcG9uZW50KSB7DQogICAgcmV0dXJuIGNvbXBvbmVudC5pbnN0YW50aWF0aW9uTW9kZSA9PT0gIkVBR0VSIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FQUdFUiAqLzsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQ29tcG9uZW50Q29udGFpbmVyIHRoYXQgcHJvdmlkZXMgUHJvdmlkZXJzIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiBgYXV0aGAsIGBhdXRoLWludGVybmFsYA0KICovDQpjbGFzcyBDb21wb25lbnRDb250YWluZXIgew0KICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5wcm92aWRlcnMgPSBuZXcgTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIGNvbXBvbmVudCBDb21wb25lbnQgYmVpbmcgYWRkZWQNCiAgICAgKiBAcGFyYW0gb3ZlcndyaXRlIFdoZW4gYSBjb21wb25lbnQgd2l0aCB0aGUgc2FtZSBuYW1lIGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCwNCiAgICAgKiBpZiBvdmVyd3JpdGUgaXMgdHJ1ZTogb3ZlcndyaXRlIHRoZSBleGlzdGluZyBjb21wb25lbnQgd2l0aCB0aGUgbmV3IGNvbXBvbmVudCBhbmQgY3JlYXRlIGEgbmV3DQogICAgICogcHJvdmlkZXIgd2l0aCB0aGUgbmV3IGNvbXBvbmVudC4gSXQgY2FuIGJlIHVzZWZ1bCBpbiB0ZXN0cyB3aGVyZSB5b3Ugd2FudCB0byB1c2UgZGlmZmVyZW50IG1vY2tzDQogICAgICogZm9yIGRpZmZlcmVudCB0ZXN0cy4NCiAgICAgKiBpZiBvdmVyd3JpdGUgaXMgZmFsc2U6IHRocm93IGFuIGV4Y2VwdGlvbg0KICAgICAqLw0KICAgIGFkZENvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTsNCiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCB3aXRoICR7dGhpcy5uYW1lfWApOw0KICAgICAgICB9DQogICAgICAgIHByb3ZpZGVyLnNldENvbXBvbmVudChjb21wb25lbnQpOw0KICAgIH0NCiAgICBhZGRPck92ZXJ3cml0ZUNvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTsNCiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHsNCiAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgZXhpc3RpbmcgcHJvdmlkZXIgZnJvbSB0aGUgY29udGFpbmVyLCBzbyB3ZSBjYW4gcmVnaXN0ZXIgdGhlIG5ldyBjb21wb25lbnQNCiAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLmRlbGV0ZShjb21wb25lbnQubmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5hZGRDb21wb25lbnQoY29tcG9uZW50KTsNCiAgICB9DQogICAgLyoqDQogICAgICogZ2V0UHJvdmlkZXIgcHJvdmlkZXMgYSB0eXBlIHNhZmUgaW50ZXJmYWNlIHdoZXJlIGl0IGNhbiBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgZmllbGQgbmFtZQ0KICAgICAqIHByZXNlbnQgaW4gTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEZpcmViYXNlIFNES3MgcHJvdmlkaW5nIHNlcnZpY2VzIHNob3VsZCBleHRlbmQgTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZSB0byByZWdpc3Rlcg0KICAgICAqIHRoZW1zZWx2ZXMuDQogICAgICovDQogICAgZ2V0UHJvdmlkZXIobmFtZSkgew0KICAgICAgICBpZiAodGhpcy5wcm92aWRlcnMuaGFzKG5hbWUpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5wcm92aWRlcnMuZ2V0KG5hbWUpOw0KICAgICAgICB9DQogICAgICAgIC8vIGNyZWF0ZSBhIFByb3ZpZGVyIGZvciBhIHNlcnZpY2UgdGhhdCBoYXNuJ3QgcmVnaXN0ZXJlZCB3aXRoIEZpcmViYXNlDQogICAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IFByb3ZpZGVyKG5hbWUsIHRoaXMpOw0KICAgICAgICB0aGlzLnByb3ZpZGVycy5zZXQobmFtZSwgcHJvdmlkZXIpOw0KICAgICAgICByZXR1cm4gcHJvdmlkZXI7DQogICAgfQ0KICAgIGdldFByb3ZpZGVycygpIHsNCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm92aWRlcnMudmFsdWVzKCkpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBjb250YWluZXIgZm9yIGFsbCBvZiB0aGUgTG9nZ2VyIGluc3RhbmNlcw0KICovDQovKioNCiAqIFRoZSBKUyBTREsgc3VwcG9ydHMgNSBsb2cgbGV2ZWxzIGFuZCBhbHNvIGFsbG93cyBhIHVzZXIgdGhlIGFiaWxpdHkgdG8NCiAqIHNpbGVuY2UgdGhlIGxvZ3MgYWx0b2dldGhlci4NCiAqDQogKiBUaGUgb3JkZXIgaXMgYSBmb2xsb3dzOg0KICogREVCVUcgPCBWRVJCT1NFIDwgSU5GTyA8IFdBUk4gPCBFUlJPUg0KICoNCiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCB3aWxsIGJlIGNhcHR1cmVkIChpLmUuIGlmDQogKiB5b3Ugc2V0IHRoZSBsb2cgbGV2ZWwgdG8gYElORk9gLCBlcnJvcnMgd2lsbCBzdGlsbCBiZSBsb2dnZWQsIGJ1dCBgREVCVUdgIGFuZA0KICogYFZFUkJPU0VgIGxvZ3Mgd2lsbCBub3QpDQogKi8NCnZhciBMb2dMZXZlbDsNCihmdW5jdGlvbiAoTG9nTGV2ZWwpIHsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiREVCVUciXSA9IDBdID0gIkRFQlVHIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiVkVSQk9TRSJdID0gMV0gPSAiVkVSQk9TRSI7DQogICAgTG9nTGV2ZWxbTG9nTGV2ZWxbIklORk8iXSA9IDJdID0gIklORk8iOw0KICAgIExvZ0xldmVsW0xvZ0xldmVsWyJXQVJOIl0gPSAzXSA9ICJXQVJOIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiRVJST1IiXSA9IDRdID0gIkVSUk9SIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiU0lMRU5UIl0gPSA1XSA9ICJTSUxFTlQiOw0KfSkoTG9nTGV2ZWwgfHwgKExvZ0xldmVsID0ge30pKTsNCmNvbnN0IGxldmVsU3RyaW5nVG9FbnVtID0gew0KICAgICdkZWJ1Zyc6IExvZ0xldmVsLkRFQlVHLA0KICAgICd2ZXJib3NlJzogTG9nTGV2ZWwuVkVSQk9TRSwNCiAgICAnaW5mbyc6IExvZ0xldmVsLklORk8sDQogICAgJ3dhcm4nOiBMb2dMZXZlbC5XQVJOLA0KICAgICdlcnJvcic6IExvZ0xldmVsLkVSUk9SLA0KICAgICdzaWxlbnQnOiBMb2dMZXZlbC5TSUxFTlQNCn07DQovKioNCiAqIFRoZSBkZWZhdWx0IGxvZyBsZXZlbA0KICovDQpjb25zdCBkZWZhdWx0TG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPOw0KLyoqDQogKiBCeSBkZWZhdWx0LCBgY29uc29sZS5kZWJ1Z2AgaXMgbm90IGRpc3BsYXllZCBpbiB0aGUgZGV2ZWxvcGVyIGNvbnNvbGUgKGluDQogKiBjaHJvbWUpLiBUbyBhdm9pZCBmb3JjaW5nIHVzZXJzIHRvIGhhdmUgdG8gb3B0LWluIHRvIHRoZXNlIGxvZ3MgdHdpY2UNCiAqIChpLmUuIG9uY2UgZm9yIGZpcmViYXNlLCBhbmQgb25jZSBpbiB0aGUgY29uc29sZSksIHdlIGFyZSBzZW5kaW5nIGBERUJVR2ANCiAqIGxvZ3MgdG8gdGhlIGBjb25zb2xlLmxvZ2AgZnVuY3Rpb24uDQogKi8NCmNvbnN0IENvbnNvbGVNZXRob2QgPSB7DQogICAgW0xvZ0xldmVsLkRFQlVHXTogJ2xvZycsDQogICAgW0xvZ0xldmVsLlZFUkJPU0VdOiAnbG9nJywNCiAgICBbTG9nTGV2ZWwuSU5GT106ICdpbmZvJywNCiAgICBbTG9nTGV2ZWwuV0FSTl06ICd3YXJuJywNCiAgICBbTG9nTGV2ZWwuRVJST1JdOiAnZXJyb3InDQp9Ow0KLyoqDQogKiBUaGUgZGVmYXVsdCBsb2cgaGFuZGxlciB3aWxsIGZvcndhcmQgREVCVUcsIFZFUkJPU0UsIElORk8sIFdBUk4sIGFuZCBFUlJPUg0KICogbWVzc2FnZXMgb24gdG8gdGhlaXIgY29ycmVzcG9uZGluZyBjb25zb2xlIGNvdW50ZXJwYXJ0cyAoaWYgdGhlIGxvZyBtZXRob2QNCiAqIGlzIHN1cHBvcnRlZCBieSB0aGUgY3VycmVudCBsb2cgbGV2ZWwpDQogKi8NCmNvbnN0IGRlZmF1bHRMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsb2dUeXBlLCAuLi5hcmdzKSA9PiB7DQogICAgaWYgKGxvZ1R5cGUgPCBpbnN0YW5jZS5sb2dMZXZlbCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsNCiAgICBjb25zdCBtZXRob2QgPSBDb25zb2xlTWV0aG9kW2xvZ1R5cGVdOw0KICAgIGlmIChtZXRob2QpIHsNCiAgICAgICAgY29uc29sZVttZXRob2RdKGBbJHtub3d9XSAgJHtpbnN0YW5jZS5uYW1lfTpgLCAuLi5hcmdzKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgQXR0ZW1wdGVkIHRvIGxvZyBhIG1lc3NhZ2Ugd2l0aCBhbiBpbnZhbGlkIGxvZ1R5cGUgKHZhbHVlOiAke2xvZ1R5cGV9KWApOw0KICAgIH0NCn07DQpjbGFzcyBMb2dnZXIgew0KICAgIC8qKg0KICAgICAqIEdpdmVzIHlvdSBhbiBpbnN0YW5jZSBvZiBhIExvZ2dlciB0byBjYXB0dXJlIG1lc3NhZ2VzIGFjY29yZGluZyB0bw0KICAgICAqIEZpcmViYXNlJ3MgbG9nZ2luZyBzY2hlbWUuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0aGF0IHRoZSBsb2dzIHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoDQogICAgICovDQogICAgY29uc3RydWN0b3IobmFtZSkgew0KICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIGxvZyBsZXZlbCBvZiB0aGUgZ2l2ZW4gTG9nZ2VyIGluc3RhbmNlLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5fbG9nTGV2ZWwgPSBkZWZhdWx0TG9nTGV2ZWw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgbWFpbiAoaW50ZXJuYWwpIGxvZyBoYW5kbGVyIGZvciB0aGUgTG9nZ2VyIGluc3RhbmNlLg0KICAgICAgICAgKiBDYW4gYmUgc2V0IHRvIGEgbmV3IGZ1bmN0aW9uIGluIGludGVybmFsIHBhY2thZ2UgY29kZSBidXQgbm90IGJ5IHVzZXIuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyID0gZGVmYXVsdExvZ0hhbmRsZXI7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgb3B0aW9uYWwsIGFkZGl0aW9uYWwsIHVzZXItZGVmaW5lZCBsb2cgaGFuZGxlciBmb3IgdGhlIExvZ2dlciBpbnN0YW5jZS4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyID0gbnVsbDsNCiAgICB9DQogICAgZ2V0IGxvZ0xldmVsKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbG9nTGV2ZWw7DQogICAgfQ0KICAgIHNldCBsb2dMZXZlbCh2YWwpIHsNCiAgICAgICAgaWYgKCEodmFsIGluIExvZ0xldmVsKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCB2YWx1ZSAiJHt2YWx9IiBhc3NpZ25lZCB0byBcYGxvZ0xldmVsXGBgKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IHZhbDsNCiAgICB9DQogICAgLy8gV29ya2Fyb3VuZCBmb3Igc2V0dGVyL2dldHRlciBoYXZpbmcgdG8gYmUgdGhlIHNhbWUgdHlwZS4NCiAgICBzZXRMb2dMZXZlbCh2YWwpIHsNCiAgICAgICAgdGhpcy5fbG9nTGV2ZWwgPSB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyA/IGxldmVsU3RyaW5nVG9FbnVtW3ZhbF0gOiB2YWw7DQogICAgfQ0KICAgIGdldCBsb2dIYW5kbGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbG9nSGFuZGxlcjsNCiAgICB9DQogICAgc2V0IGxvZ0hhbmRsZXIodmFsKSB7DQogICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5fbG9nSGFuZGxlciA9IHZhbDsNCiAgICB9DQogICAgZ2V0IHVzZXJMb2dIYW5kbGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fdXNlckxvZ0hhbmRsZXI7DQogICAgfQ0KICAgIHNldCB1c2VyTG9nSGFuZGxlcih2YWwpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgPSB2YWw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRoZSBmdW5jdGlvbnMgYmVsb3cgYXJlIGFsbCBiYXNlZCBvbiB0aGUgYGNvbnNvbGVgIGludGVyZmFjZQ0KICAgICAqLw0KICAgIGRlYnVnKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuREVCVUcsIC4uLmFyZ3MpOw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTsNCiAgICB9DQogICAgbG9nKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYNCiAgICAgICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpOw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpOw0KICAgIH0NCiAgICBpbmZvKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7DQogICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7DQogICAgfQ0KICAgIHdhcm4oLi4uYXJncykgew0KICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTsNCiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTsNCiAgICB9DQogICAgZXJyb3IoLi4uYXJncykgew0KICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5FUlJPUiwgLi4uYXJncyk7DQogICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuRVJST1IsIC4uLmFyZ3MpOw0KICAgIH0NCn0KCmNvbnN0IGluc3RhbmNlT2ZBbnkgPSAob2JqZWN0LCBjb25zdHJ1Y3RvcnMpID0+IGNvbnN0cnVjdG9ycy5zb21lKChjKSA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTsKCmxldCBpZGJQcm94eWFibGVUeXBlczsKbGV0IGN1cnNvckFkdmFuY2VNZXRob2RzOwovLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy4KZnVuY3Rpb24gZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSB7CiAgICByZXR1cm4gKGlkYlByb3h5YWJsZVR5cGVzIHx8CiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gWwogICAgICAgICAgICBJREJEYXRhYmFzZSwKICAgICAgICAgICAgSURCT2JqZWN0U3RvcmUsCiAgICAgICAgICAgIElEQkluZGV4LAogICAgICAgICAgICBJREJDdXJzb3IsCiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLAogICAgICAgIF0pKTsKfQovLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy4KZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7CiAgICByZXR1cm4gKGN1cnNvckFkdmFuY2VNZXRob2RzIHx8CiAgICAgICAgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gWwogICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsCiAgICAgICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWUsCiAgICAgICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LAogICAgICAgIF0pKTsKfQpjb25zdCBjdXJzb3JSZXF1ZXN0TWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpOwpjb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpOwpmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHsKICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7CiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpOwogICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpOwogICAgICAgIH07CiAgICAgICAgY29uc3Qgc3VjY2VzcyA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSh3cmFwKHJlcXVlc3QucmVzdWx0KSk7CiAgICAgICAgICAgIHVubGlzdGVuKCk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpOwogICAgICAgICAgICB1bmxpc3RlbigpOwogICAgICAgIH07CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgIH0pOwogICAgcHJvbWlzZQogICAgICAgIC50aGVuKCh2YWx1ZSkgPT4gewogICAgICAgIC8vIFNpbmNlIGN1cnNvcmluZyByZXVzZXMgdGhlIElEQlJlcXVlc3QgKCpzaWdoKiksIHdlIGNhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwKICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuCiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCQ3Vyc29yKSB7CiAgICAgICAgICAgIGN1cnNvclJlcXVlc3RNYXAuc2V0KHZhbHVlLCByZXF1ZXN0KTsKICAgICAgICB9CiAgICAgICAgLy8gQ2F0Y2hpbmcgdG8gYXZvaWQgIlVuY2F1Z2h0IFByb21pc2UgZXhjZXB0aW9ucyIKICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7CiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzCiAgICAvLyBpcyBiZWNhdXNlIHdlIGNyZWF0ZSBtYW55IHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdC4KICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7CiAgICByZXR1cm4gcHJvbWlzZTsKfQpmdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHsKICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLgogICAgaWYgKHRyYW5zYWN0aW9uRG9uZU1hcC5oYXModHgpKQogICAgICAgIHJldHVybjsKICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7CiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpOwogICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB1bmxpc3RlbigpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvciB8fCBuZXcgRE9NRXhjZXB0aW9uKCdBYm9ydEVycm9yJywgJ0Fib3J0RXJyb3InKSk7CiAgICAgICAgICAgIHVubGlzdGVuKCk7CiAgICAgICAgfTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTsKICAgIH0pOwogICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC4KICAgIHRyYW5zYWN0aW9uRG9uZU1hcC5zZXQodHgsIGRvbmUpOwp9CmxldCBpZGJQcm94eVRyYXBzID0gewogICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHsKICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHsKICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdkb25lJykKICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7CiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvYmplY3RTdG9yZU5hbWVzJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBNYWtlIHR4LnN0b3JlIHJldHVybiB0aGUgb25seSBzdG9yZSBpbiB0aGUgdHJhbnNhY3Rpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbWFueS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdCiAgICAgICAgICAgICAgICAgICAgPyB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICA6IHJlY2VpdmVyLm9iamVjdFN0b3JlKHJlY2VpdmVyLm9iamVjdFN0b3JlTmFtZXNbMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEVsc2UgdHJhbnNmb3JtIHdoYXRldmVyIHdlIGdldCBiYWNrLgogICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7CiAgICB9LAogICAgc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUpIHsKICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBoYXModGFyZ2V0LCBwcm9wKSB7CiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uICYmCiAgICAgICAgICAgIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDsKICAgIH0sCn07CmZ1bmN0aW9uIHJlcGxhY2VUcmFwcyhjYWxsYmFjaykgewogICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpOwp9CmZ1bmN0aW9uIHdyYXBGdW5jdGlvbihmdW5jKSB7CiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZQogICAgLy8gb25seSBjcmVhdGUgb25lIG5ldyBmdW5jIHBlciBmdW5jLgogICAgLy8gRWRnZSBkb2Vzbid0IHN1cHBvcnQgb2JqZWN0U3RvcmVOYW1lcyAoYm9vbyksIHNvIHdlIHBvbHlmaWxsIGl0IGhlcmUuCiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmCiAgICAgICAgISgnb2JqZWN0U3RvcmVOYW1lcycgaW4gSURCVHJhbnNhY3Rpb24ucHJvdG90eXBlKSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RvcmVOYW1lcywgLi4uYXJncykgewogICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpOwogICAgICAgICAgICB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuc2V0KHR4LCBzdG9yZU5hbWVzLnNvcnQgPyBzdG9yZU5hbWVzLnNvcnQoKSA6IFtzdG9yZU5hbWVzXSk7CiAgICAgICAgICAgIHJldHVybiB3cmFwKHR4KTsKICAgICAgICB9OwogICAgfQogICAgLy8gQ3Vyc29yIG1ldGhvZHMgYXJlIHNwZWNpYWwsIGFzIHRoZSBiZWhhdmlvdXIgaXMgYSBsaXR0bGUgbW9yZSBkaWZmZXJlbnQgdG8gc3RhbmRhcmQgSURCLiBJbgogICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGUKICAgIC8vIGN1cnNvci4gSXQncyBraW5kYSBsaWtlIGEgcHJvbWlzZSB0aGF0IGNhbiByZXNvbHZlIHdpdGggbWFueSB2YWx1ZXMuIFRoYXQgZG9lc24ndCBtYWtlIHNlbnNlCiAgICAvLyB3aXRoIHJlYWwgcHJvbWlzZXMsIHNvIGVhY2ggYWR2YW5jZSBtZXRob2RzIHJldHVybnMgYSBuZXcgcHJvbWlzZSBmb3IgdGhlIGN1cnNvciBvYmplY3QsIG9yCiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuCiAgICBpZiAoZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKS5pbmNsdWRlcyhmdW5jKSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykgewogICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlCiAgICAgICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuCiAgICAgICAgICAgIGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpOwogICAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHsKICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlCiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC4KICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpOwogICAgfTsKfQpmdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKQogICAgICAgIHJldHVybiB3cmFwRnVuY3Rpb24odmFsdWUpOwogICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbiwKICAgIC8vIHdoaWNoIGlzIGxhdGVyIHJldHVybmVkIGZvciB0cmFuc2FjdGlvbi5kb25lIChzZWUgaWRiT2JqZWN0SGFuZGxlcikuCiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikKICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpOwogICAgaWYgKGluc3RhbmNlT2ZBbnkodmFsdWUsIGdldElkYlByb3h5YWJsZVR5cGVzKCkpKQogICAgICAgIHJldHVybiBuZXcgUHJveHkodmFsdWUsIGlkYlByb3h5VHJhcHMpOwogICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC4KICAgIHJldHVybiB2YWx1ZTsKfQpmdW5jdGlvbiB3cmFwKHZhbHVlKSB7CiAgICAvLyBXZSBzb21ldGltZXMgZ2VuZXJhdGUgbXVsdGlwbGUgcHJvbWlzZXMgZnJvbSBhIHNpbmdsZSBJREJSZXF1ZXN0IChlZyB3aGVuIGN1cnNvcmluZyksIGJlY2F1c2UKICAgIC8vIElEQiBpcyB3ZWlyZCBhbmQgYSBzaW5nbGUgSURCUmVxdWVzdCBjYW4geWllbGQgbWFueSByZXNwb25zZXMsIHNvIHRoZXNlIGNhbid0IGJlIGNhY2hlZC4KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpCiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QodmFsdWUpOwogICAgLy8gSWYgd2UndmUgYWxyZWFkeSB0cmFuc2Zvcm1lZCB0aGlzIHZhbHVlIGJlZm9yZSwgcmV1c2UgdGhlIHRyYW5zZm9ybWVkIHZhbHVlLgogICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS4KICAgIGlmICh0cmFuc2Zvcm1DYWNoZS5oYXModmFsdWUpKQogICAgICAgIHJldHVybiB0cmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpOwogICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTsKICAgIC8vIE5vdCBhbGwgdHlwZXMgYXJlIHRyYW5zZm9ybWVkLgogICAgLy8gVGhlc2UgbWF5IGJlIHByaW1pdGl2ZSB0eXBlcywgc28gdGhleSBjYW4ndCBiZSBXZWFrTWFwIGtleXMuCiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgdHJhbnNmb3JtQ2FjaGUuc2V0KHZhbHVlLCBuZXdWYWx1ZSk7CiAgICAgICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChuZXdWYWx1ZSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIG5ld1ZhbHVlOwp9CmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7CgovKioKICogT3BlbiBhIGRhdGFiYXNlLgogKgogKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS4KICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uCiAqIEBwYXJhbSBjYWxsYmFja3MgQWRkaXRpb25hbCBjYWxsYmFja3MuCiAqLwpmdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZywgdGVybWluYXRlZCB9ID0ge30pIHsKICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihuYW1lLCB2ZXJzaW9uKTsKICAgIGNvbnN0IG9wZW5Qcm9taXNlID0gd3JhcChyZXF1ZXN0KTsKICAgIGlmICh1cGdyYWRlKSB7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd1cGdyYWRlbmVlZGVkJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIHVwZ3JhZGUod3JhcChyZXF1ZXN0LnJlc3VsdCksIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIHdyYXAocmVxdWVzdC50cmFuc2FjdGlvbiksIGV2ZW50KTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChibG9ja2VkKSB7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKAogICAgICAgIC8vIENhc3RpbmcgZHVlIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC1ET00tbGliLWdlbmVyYXRvci9wdWxsLzE0MDUKICAgICAgICBldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpOwogICAgfQogICAgb3BlblByb21pc2UKICAgICAgICAudGhlbigoZGIpID0+IHsKICAgICAgICBpZiAodGVybWluYXRlZCkKICAgICAgICAgICAgZGIuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB0ZXJtaW5hdGVkKCkpOwogICAgICAgIGlmIChibG9ja2luZykgewogICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKGV2ZW50KSA9PiBibG9ja2luZyhldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpOwogICAgICAgIH0KICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7CiAgICByZXR1cm4gb3BlblByb21pc2U7Cn0KCmNvbnN0IHJlYWRNZXRob2RzID0gWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J107CmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTsKY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTsKZnVuY3Rpb24gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgewogICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiYKICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJgogICAgICAgIHR5cGVvZiBwcm9wID09PSAnc3RyaW5nJykpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoY2FjaGVkTWV0aG9kcy5nZXQocHJvcCkpCiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApOwogICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7CiAgICBjb25zdCB1c2VJbmRleCA9IHByb3AgIT09IHRhcmdldEZ1bmNOYW1lOwogICAgY29uc3QgaXNXcml0ZSA9IHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSk7CiAgICBpZiAoCiAgICAvLyBCYWlsIGlmIHRoZSB0YXJnZXQgZG9lc24ndCBleGlzdCBvbiB0aGUgdGFyZ2V0LiBFZywgZ2V0QWxsIGlzbid0IGluIEVkZ2UuCiAgICAhKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkgfHwKICAgICAgICAhKGlzV3JpdGUgfHwgcmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1ldGhvZCA9IGFzeW5jIGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHsKICAgICAgICAvLyBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiB1bmRlZmluZWQgZ3ppcHBzIGJldHRlciwgYnV0IGZhaWxzIGluIEVkZ2UgOigKICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKTsKICAgICAgICBsZXQgdGFyZ2V0ID0gdHguc3RvcmU7CiAgICAgICAgaWYgKHVzZUluZGV4KQogICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTsKICAgICAgICAvLyBNdXN0IHJlamVjdCBpZiBvcCByZWplY3RzLgogICAgICAgIC8vIElmIGl0J3MgYSB3cml0ZSBvcGVyYXRpb24sIG11c3QgcmVqZWN0IGlmIHR4LmRvbmUgcmVqZWN0cy4KICAgICAgICAvLyBNdXN0IHJlamVjdCB3aXRoIG9wIHJlamVjdGlvbiBmaXJzdC4KICAgICAgICAvLyBNdXN0IHJlc29sdmUgd2l0aCBvcCB2YWx1ZS4KICAgICAgICAvLyBNdXN0IGhhbmRsZSBib3RoIHByb21pc2VzIChubyB1bmhhbmRsZWQgcmVqZWN0aW9ucykKICAgICAgICByZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgICAgdGFyZ2V0W3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKSwKICAgICAgICAgICAgaXNXcml0ZSAmJiB0eC5kb25lLAogICAgICAgIF0pKVswXTsKICAgIH07CiAgICBjYWNoZWRNZXRob2RzLnNldChwcm9wLCBtZXRob2QpOwogICAgcmV0dXJuIG1ldGhvZDsKfQpyZXBsYWNlVHJhcHMoKG9sZFRyYXBzKSA9PiAoewogICAgLi4ub2xkVHJhcHMsCiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksCiAgICBoYXM6ICh0YXJnZXQsIHByb3ApID0+ICEhZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuaGFzKHRhcmdldCwgcHJvcCksCn0pKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwgew0KICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikgew0KICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjsNCiAgICB9DQogICAgLy8gSW4gaW5pdGlhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3aWxsIGJlIGNhbGxlZCBieSBpbnN0YWxsYXRpb25zIG9uDQogICAgLy8gYXV0aCB0b2tlbiByZWZyZXNoLCBhbmQgaW5zdGFsbGF0aW9ucyB3aWxsIHNlbmQgdGhpcyBzdHJpbmcuDQogICAgZ2V0UGxhdGZvcm1JbmZvU3RyaW5nKCkgew0KICAgICAgICBjb25zdCBwcm92aWRlcnMgPSB0aGlzLmNvbnRhaW5lci5nZXRQcm92aWRlcnMoKTsNCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIHByb3ZpZGVycyBhbmQgZ2V0IGxpYnJhcnkvdmVyc2lvbiBwYWlycyBmcm9tIGFueSB0aGF0IGFyZQ0KICAgICAgICAvLyB2ZXJzaW9uIGNvbXBvbmVudHMuDQogICAgICAgIHJldHVybiBwcm92aWRlcnMNCiAgICAgICAgICAgIC5tYXAocHJvdmlkZXIgPT4gew0KICAgICAgICAgICAgaWYgKGlzVmVyc2lvblNlcnZpY2VQcm92aWRlcihwcm92aWRlcikpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2aWNlID0gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGAke3NlcnZpY2UubGlicmFyeX0vJHtzZXJ2aWNlLnZlcnNpb259YDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAgICAgLmZpbHRlcihsb2dTdHJpbmcgPT4gbG9nU3RyaW5nKQ0KICAgICAgICAgICAgLmpvaW4oJyAnKTsNCiAgICB9DQp9DQovKioNCiAqDQogKiBAcGFyYW0gcHJvdmlkZXIgY2hlY2sgaWYgdGhpcyBwcm92aWRlciBwcm92aWRlcyBhIFZlcnNpb25TZXJ2aWNlDQogKg0KICogTk9URTogVXNpbmcgUHJvdmlkZXI8J2FwcC12ZXJzaW9uJz4gaXMgYSBoYWNrIHRvIGluZGljYXRlIHRoYXQgdGhlIHByb3ZpZGVyDQogKiBwcm92aWRlcyBWZXJzaW9uU2VydmljZS4gVGhlIHByb3ZpZGVyIGlzIG5vdCBuZWNlc3NhcmlseSBhICdhcHAtdmVyc2lvbicNCiAqIHByb3ZpZGVyLg0KICovDQpmdW5jdGlvbiBpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpIHsNCiAgICBjb25zdCBjb21wb25lbnQgPSBwcm92aWRlci5nZXRDb21wb25lbnQoKTsNCiAgICByZXR1cm4gKGNvbXBvbmVudCA9PT0gbnVsbCB8fCBjb21wb25lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbXBvbmVudC50eXBlKSA9PT0gIlZFUlNJT04iIC8qIENvbXBvbmVudFR5cGUuVkVSU0lPTiAqLzsNCn0KCmNvbnN0IG5hbWUkbyQxID0gIkBmaXJlYmFzZS9hcHAiOwpjb25zdCB2ZXJzaW9uJDEkMSA9ICIwLjkuMTgiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgbG9nZ2VyJDEgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXBwJyk7Cgpjb25zdCBuYW1lJG4kMSA9ICJAZmlyZWJhc2UvYXBwLWNvbXBhdCI7Cgpjb25zdCBuYW1lJG0kMSA9ICJAZmlyZWJhc2UvYW5hbHl0aWNzLWNvbXBhdCI7Cgpjb25zdCBuYW1lJGwkMSA9ICJAZmlyZWJhc2UvYW5hbHl0aWNzIjsKCmNvbnN0IG5hbWUkayQxID0gIkBmaXJlYmFzZS9hcHAtY2hlY2stY29tcGF0IjsKCmNvbnN0IG5hbWUkaiQxID0gIkBmaXJlYmFzZS9hcHAtY2hlY2siOwoKY29uc3QgbmFtZSRpJDEgPSAiQGZpcmViYXNlL2F1dGgiOwoKY29uc3QgbmFtZSRoJDEgPSAiQGZpcmViYXNlL2F1dGgtY29tcGF0IjsKCmNvbnN0IG5hbWUkZyQxID0gIkBmaXJlYmFzZS9kYXRhYmFzZSI7Cgpjb25zdCBuYW1lJGYkMSA9ICJAZmlyZWJhc2UvZGF0YWJhc2UtY29tcGF0IjsKCmNvbnN0IG5hbWUkZSQxID0gIkBmaXJlYmFzZS9mdW5jdGlvbnMiOwoKY29uc3QgbmFtZSRkJDEgPSAiQGZpcmViYXNlL2Z1bmN0aW9ucy1jb21wYXQiOwoKY29uc3QgbmFtZSRjJDEgPSAiQGZpcmViYXNlL2luc3RhbGxhdGlvbnMiOwoKY29uc3QgbmFtZSRiJDEgPSAiQGZpcmViYXNlL2luc3RhbGxhdGlvbnMtY29tcGF0IjsKCmNvbnN0IG5hbWUkYSQxID0gIkBmaXJlYmFzZS9tZXNzYWdpbmciOwoKY29uc3QgbmFtZSQ5JDEgPSAiQGZpcmViYXNlL21lc3NhZ2luZy1jb21wYXQiOwoKY29uc3QgbmFtZSQ4JDEgPSAiQGZpcmViYXNlL3BlcmZvcm1hbmNlIjsKCmNvbnN0IG5hbWUkNyQxID0gIkBmaXJlYmFzZS9wZXJmb3JtYW5jZS1jb21wYXQiOwoKY29uc3QgbmFtZSQ2JDEgPSAiQGZpcmViYXNlL3JlbW90ZS1jb25maWciOwoKY29uc3QgbmFtZSQ1JDEgPSAiQGZpcmViYXNlL3JlbW90ZS1jb25maWctY29tcGF0IjsKCmNvbnN0IG5hbWUkNCQxID0gIkBmaXJlYmFzZS9zdG9yYWdlIjsKCmNvbnN0IG5hbWUkMyQxID0gIkBmaXJlYmFzZS9zdG9yYWdlLWNvbXBhdCI7Cgpjb25zdCBuYW1lJDIkMSA9ICJAZmlyZWJhc2UvZmlyZXN0b3JlIjsKCmNvbnN0IG5hbWUkMSQxID0gIkBmaXJlYmFzZS9maXJlc3RvcmUtY29tcGF0IjsKCmNvbnN0IG5hbWUkSiA9ICJmaXJlYmFzZSI7CmNvbnN0IHZlcnNpb24kNSA9ICIxMC4zLjEiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgZGVmYXVsdCBhcHAgbmFtZQ0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpjb25zdCBERUZBVUxUX0VOVFJZX05BTUUgPSAnW0RFRkFVTFRdJzsNCmNvbnN0IFBMQVRGT1JNX0xPR19TVFJJTkcgPSB7DQogICAgW25hbWUkbyQxXTogJ2ZpcmUtY29yZScsDQogICAgW25hbWUkbiQxXTogJ2ZpcmUtY29yZS1jb21wYXQnLA0KICAgIFtuYW1lJGwkMV06ICdmaXJlLWFuYWx5dGljcycsDQogICAgW25hbWUkbSQxXTogJ2ZpcmUtYW5hbHl0aWNzLWNvbXBhdCcsDQogICAgW25hbWUkaiQxXTogJ2ZpcmUtYXBwLWNoZWNrJywNCiAgICBbbmFtZSRrJDFdOiAnZmlyZS1hcHAtY2hlY2stY29tcGF0JywNCiAgICBbbmFtZSRpJDFdOiAnZmlyZS1hdXRoJywNCiAgICBbbmFtZSRoJDFdOiAnZmlyZS1hdXRoLWNvbXBhdCcsDQogICAgW25hbWUkZyQxXTogJ2ZpcmUtcnRkYicsDQogICAgW25hbWUkZiQxXTogJ2ZpcmUtcnRkYi1jb21wYXQnLA0KICAgIFtuYW1lJGUkMV06ICdmaXJlLWZuJywNCiAgICBbbmFtZSRkJDFdOiAnZmlyZS1mbi1jb21wYXQnLA0KICAgIFtuYW1lJGMkMV06ICdmaXJlLWlpZCcsDQogICAgW25hbWUkYiQxXTogJ2ZpcmUtaWlkLWNvbXBhdCcsDQogICAgW25hbWUkYSQxXTogJ2ZpcmUtZmNtJywNCiAgICBbbmFtZSQ5JDFdOiAnZmlyZS1mY20tY29tcGF0JywNCiAgICBbbmFtZSQ4JDFdOiAnZmlyZS1wZXJmJywNCiAgICBbbmFtZSQ3JDFdOiAnZmlyZS1wZXJmLWNvbXBhdCcsDQogICAgW25hbWUkNiQxXTogJ2ZpcmUtcmMnLA0KICAgIFtuYW1lJDUkMV06ICdmaXJlLXJjLWNvbXBhdCcsDQogICAgW25hbWUkNCQxXTogJ2ZpcmUtZ2NzJywNCiAgICBbbmFtZSQzJDFdOiAnZmlyZS1nY3MtY29tcGF0JywNCiAgICBbbmFtZSQyJDFdOiAnZmlyZS1mc3QnLA0KICAgIFtuYW1lJDEkMV06ICdmaXJlLWZzdC1jb21wYXQnLA0KICAgICdmaXJlLWpzJzogJ2ZpcmUtanMnLA0KICAgIFtuYW1lJEpdOiAnZmlyZS1qcy1hbGwnDQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgX2FwcHMgPSBuZXcgTWFwKCk7DQovKioNCiAqIFJlZ2lzdGVyZWQgY29tcG9uZW50cy4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCmNvbnN0IF9jb21wb25lbnRzID0gbmV3IE1hcCgpOw0KLyoqDQogKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lcg0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBfYWRkQ29tcG9uZW50KGFwcCwgY29tcG9uZW50KSB7DQogICAgdHJ5IHsNCiAgICAgICAgYXBwLmNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgbG9nZ2VyJDEuZGVidWcoYENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBGaXJlYmFzZUFwcCAke2FwcC5uYW1lfWAsIGUpOw0KICAgIH0NCn0NCi8qKg0KICoNCiAqIEBwYXJhbSBjb21wb25lbnQgLSB0aGUgY29tcG9uZW50IHRvIHJlZ2lzdGVyDQogKiBAcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgY29tcG9uZW50IGlzIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5DQogKg0KICogQGludGVybmFsDQogKi8NCmZ1bmN0aW9uIF9yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICBjb25zdCBjb21wb25lbnROYW1lID0gY29tcG9uZW50Lm5hbWU7DQogICAgaWYgKF9jb21wb25lbnRzLmhhcyhjb21wb25lbnROYW1lKSkgew0KICAgICAgICBsb2dnZXIkMS5kZWJ1ZyhgVGhlcmUgd2VyZSBtdWx0aXBsZSBhdHRlbXB0cyB0byByZWdpc3RlciBjb21wb25lbnQgJHtjb21wb25lbnROYW1lfS5gKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBfY29tcG9uZW50cy5zZXQoY29tcG9uZW50TmFtZSwgY29tcG9uZW50KTsNCiAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCB0byBleGlzdGluZyBhcHAgaW5zdGFuY2VzDQogICAgZm9yIChjb25zdCBhcHAgb2YgX2FwcHMudmFsdWVzKCkpIHsNCiAgICAgICAgX2FkZENvbXBvbmVudChhcHAsIGNvbXBvbmVudCk7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyoqDQogKg0KICogQHBhcmFtIGFwcCAtIEZpcmViYXNlQXBwIGluc3RhbmNlDQogKiBAcGFyYW0gbmFtZSAtIHNlcnZpY2UgbmFtZQ0KICoNCiAqIEByZXR1cm5zIHRoZSBwcm92aWRlciBmb3IgdGhlIHNlcnZpY2Ugd2l0aCB0aGUgbWF0Y2hpbmcgbmFtZQ0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBfZ2V0UHJvdmlkZXIoYXBwLCBuYW1lKSB7DQogICAgY29uc3QgaGVhcnRiZWF0Q29udHJvbGxlciA9IGFwcC5jb250YWluZXINCiAgICAgICAgLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKQ0KICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7DQogICAgaWYgKGhlYXJ0YmVhdENvbnRyb2xsZXIpIHsNCiAgICAgICAgdm9pZCBoZWFydGJlYXRDb250cm9sbGVyLnRyaWdnZXJIZWFydGJlYXQoKTsNCiAgICB9DQogICAgcmV0dXJuIGFwcC5jb250YWluZXIuZ2V0UHJvdmlkZXIobmFtZSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgRVJST1JTID0gew0KICAgIFsibm8tYXBwIiAvKiBBcHBFcnJvci5OT19BUFAgKi9dOiAiTm8gRmlyZWJhc2UgQXBwICd7JGFwcE5hbWV9JyBoYXMgYmVlbiBjcmVhdGVkIC0gIiArDQogICAgICAgICdjYWxsIGluaXRpYWxpemVBcHAoKSBmaXJzdCcsDQogICAgWyJiYWQtYXBwLW5hbWUiIC8qIEFwcEVycm9yLkJBRF9BUFBfTkFNRSAqL106ICJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfSIsDQogICAgWyJkdXBsaWNhdGUtYXBwIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovXTogIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBleGlzdHMgd2l0aCBkaWZmZXJlbnQgb3B0aW9ucyBvciBjb25maWciLA0KICAgIFsiYXBwLWRlbGV0ZWQiIC8qIEFwcEVycm9yLkFQUF9ERUxFVEVEICovXTogIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBkZWxldGVkIiwNCiAgICBbIm5vLW9wdGlvbnMiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi9dOiAnTmVlZCB0byBwcm92aWRlIG9wdGlvbnMsIHdoZW4gbm90IGJlaW5nIGRlcGxveWVkIHRvIGhvc3RpbmcgdmlhIHNvdXJjZS4nLA0KICAgIFsiaW52YWxpZC1hcHAtYXJndW1lbnQiIC8qIEFwcEVycm9yLklOVkFMSURfQVBQX0FSR1VNRU5UICovXTogJ2ZpcmViYXNlLnskYXBwTmFtZX0oKSB0YWtlcyBlaXRoZXIgbm8gYXJndW1lbnQgb3IgYSAnICsNCiAgICAgICAgJ0ZpcmViYXNlIEFwcCBpbnN0YW5jZS4nLA0KICAgIFsiaW52YWxpZC1sb2ctYXJndW1lbnQiIC8qIEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UICovXTogJ0ZpcnN0IGFyZ3VtZW50IHRvIGBvbkxvZ2AgbXVzdCBiZSBudWxsIG9yIGEgZnVuY3Rpb24uJywNCiAgICBbImlkYi1vcGVuIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqL106ICdFcnJvciB0aHJvd24gd2hlbiBvcGVuaW5nIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsDQogICAgWyJpZGItZ2V0IiAvKiBBcHBFcnJvci5JREJfR0VUICovXTogJ0Vycm9yIHRocm93biB3aGVuIHJlYWRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLA0KICAgIFsiaWRiLXNldCIgLyogQXBwRXJyb3IuSURCX1dSSVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIHdyaXRpbmcgdG8gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJywNCiAgICBbImlkYi1kZWxldGUiIC8qIEFwcEVycm9yLklEQl9ERUxFVEUgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gZGVsZXRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nDQp9Ow0KY29uc3QgRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2FwcCcsICdGaXJlYmFzZScsIEVSUk9SUyk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBGaXJlYmFzZUFwcEltcGwgew0KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKSB7DQogICAgICAgIHRoaXMuX2lzRGVsZXRlZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLl9vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyk7DQogICAgICAgIHRoaXMuX2NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7DQogICAgICAgIHRoaXMuX25hbWUgPSBjb25maWcubmFtZTsNCiAgICAgICAgdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0NCiAgICAgICAgICAgIGNvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ7DQogICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjsNCiAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ2FwcCcsICgpID0+IHRoaXMsICJQVUJMSUMiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKSk7DQogICAgfQ0KICAgIGdldCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQoKSB7DQogICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDsNCiAgICB9DQogICAgc2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCh2YWwpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICB0aGlzLl9hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPSB2YWw7DQogICAgfQ0KICAgIGdldCBuYW1lKCkgew0KICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7DQogICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgIH0NCiAgICBnZXQgb3B0aW9ucygpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9uczsNCiAgICB9DQogICAgZ2V0IGNvbmZpZygpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnOw0KICAgIH0NCiAgICBnZXQgY29udGFpbmVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyOw0KICAgIH0NCiAgICBnZXQgaXNEZWxldGVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5faXNEZWxldGVkOw0KICAgIH0NCiAgICBzZXQgaXNEZWxldGVkKHZhbCkgew0KICAgICAgICB0aGlzLl9pc0RlbGV0ZWQgPSB2YWw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRoaXMgZnVuY3Rpb24gd2lsbCB0aHJvdyBhbiBFcnJvciBpZiB0aGUgQXBwIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZCAtDQogICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuDQogICAgICovDQogICAgY2hlY2tEZXN0cm95ZWQoKSB7DQogICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkgew0KICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImFwcC1kZWxldGVkIiAvKiBBcHBFcnJvci5BUFBfREVMRVRFRCAqLywgeyBhcHBOYW1lOiB0aGlzLl9uYW1lIH0pOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IFNES19WRVJTSU9OJDEgPSB2ZXJzaW9uJDU7DQpmdW5jdGlvbiBpbml0aWFsaXplQXBwKF9vcHRpb25zLCByYXdDb25maWcgPSB7fSkgew0KICAgIGxldCBvcHRpb25zID0gX29wdGlvbnM7DQogICAgaWYgKHR5cGVvZiByYXdDb25maWcgIT09ICdvYmplY3QnKSB7DQogICAgICAgIGNvbnN0IG5hbWUgPSByYXdDb25maWc7DQogICAgICAgIHJhd0NvbmZpZyA9IHsgbmFtZSB9Ow0KICAgIH0NCiAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHsgbmFtZTogREVGQVVMVF9FTlRSWV9OQU1FLCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sIHJhd0NvbmZpZyk7DQogICAgY29uc3QgbmFtZSA9IGNvbmZpZy5uYW1lOw0KICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgIW5hbWUpIHsNCiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImJhZC1hcHAtbmFtZSIgLyogQXBwRXJyb3IuQkFEX0FQUF9OQU1FICovLCB7DQogICAgICAgICAgICBhcHBOYW1lOiBTdHJpbmcobmFtZSkNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSBnZXREZWZhdWx0QXBwQ29uZmlnKCkpOw0KICAgIGlmICghb3B0aW9ucykgew0KICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgibm8tb3B0aW9ucyIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqLyk7DQogICAgfQ0KICAgIGNvbnN0IGV4aXN0aW5nQXBwID0gX2FwcHMuZ2V0KG5hbWUpOw0KICAgIGlmIChleGlzdGluZ0FwcCkgew0KICAgICAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLg0KICAgICAgICBpZiAoZGVlcEVxdWFsKG9wdGlvbnMsIGV4aXN0aW5nQXBwLm9wdGlvbnMpICYmDQogICAgICAgICAgICBkZWVwRXF1YWwoY29uZmlnLCBleGlzdGluZ0FwcC5jb25maWcpKSB7DQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdBcHA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgiZHVwbGljYXRlLWFwcCIgLyogQXBwRXJyb3IuRFVQTElDQVRFX0FQUCAqLywgeyBhcHBOYW1lOiBuYW1lIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBDb21wb25lbnRDb250YWluZXIobmFtZSk7DQogICAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgX2NvbXBvbmVudHMudmFsdWVzKCkpIHsNCiAgICAgICAgY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpOw0KICAgIH0NCiAgICBjb25zdCBuZXdBcHAgPSBuZXcgRmlyZWJhc2VBcHBJbXBsKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKTsNCiAgICBfYXBwcy5zZXQobmFtZSwgbmV3QXBwKTsNCiAgICByZXR1cm4gbmV3QXBwOw0KfQ0KLyoqDQogKiBSZXRyaWV2ZXMgYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UuDQogKg0KICogV2hlbiBjYWxsZWQgd2l0aCBubyBhcmd1bWVudHMsIHRoZSBkZWZhdWx0IGFwcCBpcyByZXR1cm5lZC4gV2hlbiBhbiBhcHAgbmFtZQ0KICogaXMgcHJvdmlkZWQsIHRoZSBhcHAgY29ycmVzcG9uZGluZyB0byB0aGF0IG5hbWUgaXMgcmV0dXJuZWQuDQogKg0KICogQW4gZXhjZXB0aW9uIGlzIHRocm93biBpZiB0aGUgYXBwIGJlaW5nIHJldHJpZXZlZCBoYXMgbm90IHlldCBiZWVuDQogKiBpbml0aWFsaXplZC4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGFwcA0KICogY29uc3QgYXBwID0gZ2V0QXBwKCk7DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gUmV0dXJuIGEgbmFtZWQgYXBwDQogKiBjb25zdCBvdGhlckFwcCA9IGdldEFwcCgib3RoZXJBcHAiKTsNCiAqIGBgYA0KICoNCiAqIEBwYXJhbSBuYW1lIC0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgYXBwIHRvIHJldHVybi4gSWYgbm8gbmFtZSBpcw0KICogICBwcm92aWRlZCwgdGhlIGRlZmF1bHQgaXMgYCJbREVGQVVMVF0iYC4NCiAqDQogKiBAcmV0dXJucyBUaGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIGFwcCBuYW1lLg0KICogICBJZiBubyBhcHAgbmFtZSBpcyBwcm92aWRlZCwgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gZ2V0QXBwKG5hbWUgPSBERUZBVUxUX0VOVFJZX05BTUUpIHsNCiAgICBjb25zdCBhcHAgPSBfYXBwcy5nZXQobmFtZSk7DQogICAgaWYgKCFhcHAgJiYgbmFtZSA9PT0gREVGQVVMVF9FTlRSWV9OQU1FICYmIGdldERlZmF1bHRBcHBDb25maWcoKSkgew0KICAgICAgICByZXR1cm4gaW5pdGlhbGl6ZUFwcCgpOw0KICAgIH0NCiAgICBpZiAoIWFwcCkgew0KICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgibm8tYXBwIiAvKiBBcHBFcnJvci5OT19BUFAgKi8sIHsgYXBwTmFtZTogbmFtZSB9KTsNCiAgICB9DQogICAgcmV0dXJuIGFwcDsNCn0NCi8qKg0KICogUmVnaXN0ZXJzIGEgbGlicmFyeSdzIG5hbWUgYW5kIHZlcnNpb24gZm9yIHBsYXRmb3JtIGxvZ2dpbmcgcHVycG9zZXMuDQogKiBAcGFyYW0gbGlicmFyeSAtIE5hbWUgb2YgMXAgb3IgM3AgbGlicmFyeSAoZS5nLiBmaXJlc3RvcmUsIGFuZ3VsYXJmaXJlKQ0KICogQHBhcmFtIHZlcnNpb24gLSBDdXJyZW50IHZlcnNpb24gb2YgdGhhdCBsaWJyYXJ5Lg0KICogQHBhcmFtIHZhcmlhbnQgLSBCdW5kbGUgdmFyaWFudCwgZS5nLiwgbm9kZSwgcm4sIGV0Yy4NCiAqDQogKiBAcHVibGljDQogKi8NCmZ1bmN0aW9uIHJlZ2lzdGVyVmVyc2lvbihsaWJyYXJ5S2V5T3JOYW1lLCB2ZXJzaW9uLCB2YXJpYW50KSB7DQogICAgdmFyIF9hOw0KICAgIC8vIFRPRE86IFdlIGNhbiB1c2UgdGhpcyBjaGVjayB0byB3aGl0ZWxpc3Qgc3RyaW5ncyB3aGVuL2lmIHdlIHNldCB1cA0KICAgIC8vIGEgZ29vZCB3aGl0ZWxpc3Qgc3lzdGVtLg0KICAgIGxldCBsaWJyYXJ5ID0gKF9hID0gUExBVEZPUk1fTE9HX1NUUklOR1tsaWJyYXJ5S2V5T3JOYW1lXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGlicmFyeUtleU9yTmFtZTsNCiAgICBpZiAodmFyaWFudCkgew0KICAgICAgICBsaWJyYXJ5ICs9IGAtJHt2YXJpYW50fWA7DQogICAgfQ0KICAgIGNvbnN0IGxpYnJhcnlNaXNtYXRjaCA9IGxpYnJhcnkubWF0Y2goL1xzfFwvLyk7DQogICAgY29uc3QgdmVyc2lvbk1pc21hdGNoID0gdmVyc2lvbi5tYXRjaCgvXHN8XC8vKTsNCiAgICBpZiAobGlicmFyeU1pc21hdGNoIHx8IHZlcnNpb25NaXNtYXRjaCkgew0KICAgICAgICBjb25zdCB3YXJuaW5nID0gWw0KICAgICAgICAgICAgYFVuYWJsZSB0byByZWdpc3RlciBsaWJyYXJ5ICIke2xpYnJhcnl9IiB3aXRoIHZlcnNpb24gIiR7dmVyc2lvbn0iOmANCiAgICAgICAgXTsNCiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCkgew0KICAgICAgICAgICAgd2FybmluZy5wdXNoKGBsaWJyYXJ5IG5hbWUgIiR7bGlicmFyeX0iIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciAiLyIpYCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCAmJiB2ZXJzaW9uTWlzbWF0Y2gpIHsNCiAgICAgICAgICAgIHdhcm5pbmcucHVzaCgnYW5kJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHZlcnNpb25NaXNtYXRjaCkgew0KICAgICAgICAgICAgd2FybmluZy5wdXNoKGB2ZXJzaW9uIG5hbWUgIiR7dmVyc2lvbn0iIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciAiLyIpYCk7DQogICAgICAgIH0NCiAgICAgICAgbG9nZ2VyJDEud2Fybih3YXJuaW5nLmpvaW4oJyAnKSk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoYCR7bGlicmFyeX0tdmVyc2lvbmAsICgpID0+ICh7IGxpYnJhcnksIHZlcnNpb24gfSksICJWRVJTSU9OIiAvKiBDb21wb25lbnRUeXBlLlZFUlNJT04gKi8pKTsNCn0NCgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBEQl9OQU1FJDEgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LWRhdGFiYXNlJzsNCmNvbnN0IERCX1ZFUlNJT04kMSA9IDE7DQpjb25zdCBTVE9SRV9OQU1FID0gJ2ZpcmViYXNlLWhlYXJ0YmVhdC1zdG9yZSc7DQpsZXQgZGJQcm9taXNlID0gbnVsbDsNCmZ1bmN0aW9uIGdldERiUHJvbWlzZSgpIHsNCiAgICBpZiAoIWRiUHJvbWlzZSkgew0KICAgICAgICBkYlByb21pc2UgPSBvcGVuREIoREJfTkFNRSQxLCBEQl9WRVJTSU9OJDEsIHsNCiAgICAgICAgICAgIHVwZ3JhZGU6IChkYiwgb2xkVmVyc2lvbikgPT4gew0KICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaA0KICAgICAgICAgICAgICAgIC8vIGJlaGF2aW9yIGlzIHdoYXQgd2Ugd2FudCwgYmVjYXVzZSBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgdmVyc2lvbnMgYmV0d2Vlbg0KICAgICAgICAgICAgICAgIC8vIHRoZSBvbGQgdmVyc2lvbiBhbmQgdGhlIGN1cnJlbnQgdmVyc2lvbiwgd2Ugd2FudCBBTEwgdGhlIG1pZ3JhdGlvbnMNCiAgICAgICAgICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuDQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZQ0KICAgICAgICAgICAgICAgIHN3aXRjaCAob2xkVmVyc2lvbikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShTVE9SRV9OQU1FKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImlkYi1vcGVuIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqLywgew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlLm1lc3NhZ2UNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgcmV0dXJuIGRiUHJvbWlzZTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQihhcHApIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpOw0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYg0KICAgICAgICAgICAgLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUpDQogICAgICAgICAgICAub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSkNCiAgICAgICAgICAgIC5nZXQoY29tcHV0ZUtleShhcHApKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7DQogICAgICAgICAgICBsb2dnZXIkMS53YXJuKGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKCJpZGItZ2V0IiAvKiBBcHBFcnJvci5JREJfR0VUICovLCB7DQogICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5tZXNzYWdlDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGxvZ2dlciQxLndhcm4oaWRiR2V0RXJyb3IubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQphc3luYyBmdW5jdGlvbiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQihhcHAsIGhlYXJ0YmVhdE9iamVjdCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7DQogICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpOw0KICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpOw0KICAgICAgICBhd2FpdCBvYmplY3RTdG9yZS5wdXQoaGVhcnRiZWF0T2JqZWN0LCBjb21wdXRlS2V5KGFwcCkpOw0KICAgICAgICBhd2FpdCB0eC5kb25lOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHsNCiAgICAgICAgICAgIGxvZ2dlciQxLndhcm4oZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGlkYkdldEVycm9yID0gRVJST1JfRkFDVE9SWS5jcmVhdGUoImlkYi1zZXQiIC8qIEFwcEVycm9yLklEQl9XUklURSAqLywgew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBsb2dnZXIkMS53YXJuKGlkYkdldEVycm9yLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gY29tcHV0ZUtleShhcHApIHsNCiAgICByZXR1cm4gYCR7YXBwLm5hbWV9ISR7YXBwLm9wdGlvbnMuYXBwSWR9YDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IE1BWF9IRUFERVJfQllURVMgPSAxMDI0Ow0KLy8gMzAgZGF5cw0KY29uc3QgU1RPUkVEX0hFQVJUQkVBVF9SRVRFTlRJT05fTUFYX01JTExJUyA9IDMwICogMjQgKiA2MCAqIDYwICogMTAwMDsNCmNsYXNzIEhlYXJ0YmVhdFNlcnZpY2VJbXBsIHsNCiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHsNCiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbi1tZW1vcnkgY2FjaGUgZm9yIGhlYXJ0YmVhdHMsIHVzZWQgYnkgZ2V0SGVhcnRiZWF0c0hlYWRlcigpIHRvIGdlbmVyYXRlDQogICAgICAgICAqIHRoZSBoZWFkZXIgc3RyaW5nLg0KICAgICAgICAgKiBTdG9yZXMgb25lIHJlY29yZCBwZXIgZGF0ZS4gVGhpcyB3aWxsIGJlIGNvbnNvbGlkYXRlZCBpbnRvIHRoZSBzdGFuZGFyZA0KICAgICAgICAgKiBmb3JtYXQgb2Ygb25lIHJlY29yZCBwZXIgdXNlciBhZ2VudCBzdHJpbmcgYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBoZWFkZXIuDQogICAgICAgICAqIFBvcHVsYXRlZCBmcm9tIGluZGV4ZWREQiB3aGVuIHRoZSBjb250cm9sbGVyIGlzIGluc3RhbnRpYXRlZCBhbmQgc2hvdWxkDQogICAgICAgICAqIGJlIGtlcHQgaW4gc3luYyB3aXRoIGluZGV4ZWREQi4NCiAgICAgICAgICogTGVhdmUgcHVibGljIGZvciBlYXNpZXIgdGVzdGluZy4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IG51bGw7DQogICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IG5ldyBIZWFydGJlYXRTdG9yYWdlSW1wbChhcHApOw0KICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlID0gdGhpcy5fc3RvcmFnZS5yZWFkKCkudGhlbihyZXN1bHQgPT4gew0KICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gcmVzdWx0Ow0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbGxlZCB0byByZXBvcnQgYSBoZWFydGJlYXQuIFRoZSBmdW5jdGlvbiB3aWxsIGdlbmVyYXRlDQogICAgICogYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgb2JqZWN0LCB1cGRhdGUgaGVhcnRiZWF0c0NhY2hlLCBhbmQgcGVyc2lzdCBpdA0KICAgICAqIHRvIEluZGV4ZWREQi4NCiAgICAgKiBOb3RlIHRoYXQgd2Ugb25seSBzdG9yZSBvbmUgaGVhcnRiZWF0IHBlciBkYXkuIFNvIGlmIGEgaGVhcnRiZWF0IGZvciB0b2RheSBpcw0KICAgICAqIGFscmVhZHkgbG9nZ2VkLCBzdWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgZnVuY3Rpb24gaW4gdGhlIHNhbWUgZGF5IHdpbGwgYmUgaWdub3JlZC4NCiAgICAgKi8NCiAgICBhc3luYyB0cmlnZ2VySGVhcnRiZWF0KCkgew0KICAgICAgICBjb25zdCBwbGF0Zm9ybUxvZ2dlciA9IHRoaXMuY29udGFpbmVyDQogICAgICAgICAgICAuZ2V0UHJvdmlkZXIoJ3BsYXRmb3JtLWxvZ2dlcicpDQogICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKCk7DQogICAgICAgIC8vIFRoaXMgaXMgdGhlICJGaXJlYmFzZSB1c2VyIGFnZW50IiBzdHJpbmcgZnJvbSB0aGUgcGxhdGZvcm0gbG9nZ2VyDQogICAgICAgIC8vIHNlcnZpY2UsIG5vdCB0aGUgYnJvd3NlciB1c2VyIGFnZW50Lg0KICAgICAgICBjb25zdCBhZ2VudCA9IHBsYXRmb3JtTG9nZ2VyLmdldFBsYXRmb3JtSW5mb1N0cmluZygpOw0KICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpOw0KICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSBhd2FpdCB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlOw0KICAgICAgICB9DQogICAgICAgIC8vIERvIG5vdCBzdG9yZSBhIGhlYXJ0YmVhdCBpZiBvbmUgaXMgYWxyZWFkeSBzdG9yZWQgZm9yIHRoaXMgZGF5DQogICAgICAgIC8vIG9yIGlmIGEgaGVhZGVyIGhhcyBhbHJlYWR5IGJlZW4gc2VudCB0b2RheS4NCiAgICAgICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPT09IGRhdGUgfHwNCiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnNvbWUoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiBzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUgPT09IGRhdGUpKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGVyZSBpcyBubyBlbnRyeSBmb3IgdGhpcyBkYXRlLiBDcmVhdGUgb25lLg0KICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMucHVzaCh7IGRhdGUsIGFnZW50IH0pOw0KICAgICAgICB9DQogICAgICAgIC8vIFJlbW92ZSBlbnRyaWVzIG9sZGVyIHRoYW4gMzAgZGF5cy4NCiAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5maWx0ZXIoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiB7DQogICAgICAgICAgICBjb25zdCBoYlRpbWVzdGFtcCA9IG5ldyBEYXRlKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSkudmFsdWVPZigpOw0KICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICAgIHJldHVybiBub3cgLSBoYlRpbWVzdGFtcCA8PSBTVE9SRURfSEVBUlRCRUFUX1JFVEVOVElPTl9NQVhfTUlMTElTOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgd2hpY2ggY2FuIGJlIGF0dGFjaGVkIHRvIHRoZSBoZWFydGJlYXQtc3BlY2lmaWMgaGVhZGVyIGRpcmVjdGx5Lg0KICAgICAqIEl0IGFsc28gY2xlYXJzIGFsbCBoZWFydGJlYXRzIGZyb20gbWVtb3J5IGFzIHdlbGwgYXMgaW4gSW5kZXhlZERCLg0KICAgICAqDQogICAgICogTk9URTogQ29uc3VtaW5nIHByb2R1Y3QgU0RLcyBzaG91bGQgbm90IHNlbmQgdGhlIGhlYWRlciBpZiB0aGlzIG1ldGhvZA0KICAgICAqIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLg0KICAgICAqLw0KICAgIGFzeW5jIGdldEhlYXJ0YmVhdHNIZWFkZXIoKSB7DQogICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2U7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgaXQncyBzdGlsbCBudWxsIG9yIHRoZSBhcnJheSBpcyBlbXB0eSwgdGhlcmUgaXMgbm8gZGF0YSB0byBzZW5kLg0KICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsIHx8DQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpOw0KICAgICAgICAvLyBFeHRyYWN0IGFzIG1hbnkgaGVhcnRiZWF0cyBmcm9tIHRoZSBjYWNoZSBhcyB3aWxsIGZpdCB1bmRlciB0aGUgc2l6ZSBsaW1pdC4NCiAgICAgICAgY29uc3QgeyBoZWFydGJlYXRzVG9TZW5kLCB1bnNlbnRFbnRyaWVzIH0gPSBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcih0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyk7DQogICAgICAgIGNvbnN0IGhlYWRlclN0cmluZyA9IGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMiwgaGVhcnRiZWF0czogaGVhcnRiZWF0c1RvU2VuZCB9KSk7DQogICAgICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5Lg0KICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUubGFzdFNlbnRIZWFydGJlYXREYXRlID0gZGF0ZTsNCiAgICAgICAgaWYgKHVuc2VudEVudHJpZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgLy8gU3RvcmUgYW55IHVuc2VudCBlbnRyaWVzIGlmIHRoZXkgZXhpc3QuDQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyA9IHVuc2VudEVudHJpZXM7DQogICAgICAgICAgICAvLyBUaGlzIHNlZW1zIG1vcmUgbGlrZWx5IHRoYW4gZW1wdHlpbmcgdGhlIGFycmF5IChiZWxvdykgdG8gbGVhZCB0byBzb21lIG9kZCBzdGF0ZQ0KICAgICAgICAgICAgLy8gc2luY2UgdGhlIGNhY2hlIGlzbid0IGVtcHR5IGFuZCB0aGlzIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IHJlcXVlc3QsDQogICAgICAgICAgICAvLyBhbmQgaXMgcHJvYmFibHkgc2FmZXN0IGlmIHdlIGF3YWl0IGl0Lg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gW107DQogICAgICAgICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuDQogICAgICAgICAgICB2b2lkIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGhlYWRlclN0cmluZzsNCiAgICB9DQp9DQpmdW5jdGlvbiBnZXRVVENEYXRlU3RyaW5nKCkgew0KICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTsNCiAgICAvLyBSZXR1cm5zIGRhdGUgZm9ybWF0ICdZWVlZLU1NLUREJw0KICAgIHJldHVybiB0b2RheS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7DQp9DQpmdW5jdGlvbiBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcihoZWFydGJlYXRzQ2FjaGUsIG1heFNpemUgPSBNQVhfSEVBREVSX0JZVEVTKSB7DQogICAgLy8gSGVhcnRiZWF0cyBncm91cGVkIGJ5IHVzZXIgYWdlbnQgaW4gdGhlIHN0YW5kYXJkIGZvcm1hdCB0byBiZSBzZW50IGluDQogICAgLy8gdGhlIGhlYWRlci4NCiAgICBjb25zdCBoZWFydGJlYXRzVG9TZW5kID0gW107DQogICAgLy8gU2luZ2xlIGRhdGUgZm9ybWF0IGhlYXJ0YmVhdHMgdGhhdCBhcmUgbm90IHNlbnQuDQogICAgbGV0IHVuc2VudEVudHJpZXMgPSBoZWFydGJlYXRzQ2FjaGUuc2xpY2UoKTsNCiAgICBmb3IgKGNvbnN0IHNpbmdsZURhdGVIZWFydGJlYXQgb2YgaGVhcnRiZWF0c0NhY2hlKSB7DQogICAgICAgIC8vIExvb2sgZm9yIGFuIGV4aXN0aW5nIGVudHJ5IHdpdGggdGhlIHNhbWUgdXNlciBhZ2VudC4NCiAgICAgICAgY29uc3QgaGVhcnRiZWF0RW50cnkgPSBoZWFydGJlYXRzVG9TZW5kLmZpbmQoaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQpOw0KICAgICAgICBpZiAoIWhlYXJ0YmVhdEVudHJ5KSB7DQogICAgICAgICAgICAvLyBJZiBubyBlbnRyeSBmb3IgdGhpcyB1c2VyIGFnZW50IGV4aXN0cywgY3JlYXRlIG9uZS4NCiAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucHVzaCh7DQogICAgICAgICAgICAgICAgYWdlbnQ6IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQsDQogICAgICAgICAgICAgICAgZGF0ZXM6IFtzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGVdDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkgew0KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGhlYXJ0YmVhdA0KICAgICAgICAgICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLg0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucG9wKCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wdXNoKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSk7DQogICAgICAgICAgICAvLyBJZiB0aGUgaGVhZGVyIHdvdWxkIGV4Y2VlZCBtYXggc2l6ZSwgcmVtb3ZlIHRoZSBhZGRlZCBkYXRlDQogICAgICAgICAgICAvLyBhbmQgc3RvcCBhZGRpbmcgdG8gdGhlIGhlYWRlci4NCiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkgew0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdEVudHJ5LmRhdGVzLnBvcCgpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIFBvcCB1bnNlbnQgZW50cnkgZnJvbSBxdWV1ZS4gKFNraXBwZWQgaWYgYWRkaW5nIHRoZSBlbnRyeSBleGNlZWRlZA0KICAgICAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LikNCiAgICAgICAgdW5zZW50RW50cmllcyA9IHVuc2VudEVudHJpZXMuc2xpY2UoMSk7DQogICAgfQ0KICAgIHJldHVybiB7DQogICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQsDQogICAgICAgIHVuc2VudEVudHJpZXMNCiAgICB9Ow0KfQ0KY2xhc3MgSGVhcnRiZWF0U3RvcmFnZUltcGwgew0KICAgIGNvbnN0cnVjdG9yKGFwcCkgew0KICAgICAgICB0aGlzLmFwcCA9IGFwcDsNCiAgICAgICAgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZSA9IHRoaXMucnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpOw0KICAgIH0NCiAgICBhc3luYyBydW5JbmRleGVkREJFbnZpcm9ubWVudENoZWNrKCkgew0KICAgICAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKCkNCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0cnVlKQ0KICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy4NCiAgICAgKi8NCiAgICBhc3luYyByZWFkKCkgew0KICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlOw0KICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikgew0KICAgICAgICAgICAgcmV0dXJuIHsgaGVhcnRiZWF0czogW10gfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGlkYkhlYXJ0YmVhdE9iamVjdCA9IGF3YWl0IHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQih0aGlzLmFwcCk7DQogICAgICAgICAgICByZXR1cm4gaWRiSGVhcnRiZWF0T2JqZWN0IHx8IHsgaGVhcnRiZWF0czogW10gfTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyBvdmVyd3JpdGUgdGhlIHN0b3JhZ2Ugd2l0aCB0aGUgcHJvdmlkZWQgaGVhcnRiZWF0cw0KICAgIGFzeW5jIG92ZXJ3cml0ZShoZWFydGJlYXRzT2JqZWN0KSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgY29uc3QgY2FuVXNlSW5kZXhlZERCID0gYXdhaXQgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZTsNCiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpOw0KICAgICAgICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7DQogICAgICAgICAgICAgICAgbGFzdFNlbnRIZWFydGJlYXREYXRlOiAoX2EgPSBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSwNCiAgICAgICAgICAgICAgICBoZWFydGJlYXRzOiBoZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIGFkZCBoZWFydGJlYXRzDQogICAgYXN5bmMgYWRkKGhlYXJ0YmVhdHNPYmplY3QpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlOw0KICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0ID0gYXdhaXQgdGhpcy5yZWFkKCk7DQogICAgICAgICAgICByZXR1cm4gd3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIodGhpcy5hcHAsIHsNCiAgICAgICAgICAgICAgICBsYXN0U2VudEhlYXJ0YmVhdERhdGU6IChfYSA9IGhlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlLA0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHM6IFsNCiAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMsDQogICAgICAgICAgICAgICAgICAgIC4uLmhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0cw0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBDYWxjdWxhdGUgYnl0ZXMgb2YgYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgYXJyYXkgYWZ0ZXIgYmVpbmcgd3JhcHBlZA0KICogaW4gYSBwbGF0Zm9ybSBsb2dnaW5nIGhlYWRlciBKU09OIG9iamVjdCwgc3RyaW5naWZpZWQsIGFuZCBjb252ZXJ0ZWQNCiAqIHRvIGJhc2UgNjQuDQogKi8NCmZ1bmN0aW9uIGNvdW50Qnl0ZXMoaGVhcnRiZWF0c0NhY2hlKSB7DQogICAgLy8gYmFzZTY0IGhhcyBhIHJlc3RyaWN0ZWQgc2V0IG9mIGNoYXJhY3RlcnMsIGFsbCBvZiB3aGljaCBzaG91bGQgYmUgMSBieXRlLg0KICAgIHJldHVybiBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZygNCiAgICAvLyBoZWFydGJlYXRzQ2FjaGUgd3JhcHBlciBwcm9wZXJ0aWVzDQogICAgSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzQ2FjaGUgfSkpLmxlbmd0aDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIHJlZ2lzdGVyQ29yZUNvbXBvbmVudHModmFyaWFudCkgew0KICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdwbGF0Zm9ybS1sb2dnZXInLCBjb250YWluZXIgPT4gbmV3IFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwoY29udGFpbmVyKSwgIlBSSVZBVEUiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpOw0KICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdoZWFydGJlYXQnLCBjb250YWluZXIgPT4gbmV3IEhlYXJ0YmVhdFNlcnZpY2VJbXBsKGNvbnRhaW5lciksICJQUklWQVRFIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTsNCiAgICAvLyBSZWdpc3RlciBgYXBwYCBwYWNrYWdlLg0KICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJG8kMSwgdmVyc2lvbiQxJDEsIHZhcmlhbnQpOw0KICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uDQogICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkbyQxLCB2ZXJzaW9uJDEkMSwgJ2VzbTIwMTcnKTsNCiAgICAvLyBSZWdpc3RlciBwbGF0Zm9ybSBTREsgaWRlbnRpZmllciAobm8gdmVyc2lvbikuDQogICAgcmVnaXN0ZXJWZXJzaW9uKCdmaXJlLWpzJywgJycpOw0KfQoKLyoqDQogKiBGaXJlYmFzZSBBcHANCiAqDQogKiBAcmVtYXJrcyBUaGlzIHBhY2thZ2UgY29vcmRpbmF0ZXMgdGhlIGNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUgZGlmZmVyZW50IEZpcmViYXNlIGNvbXBvbmVudHMNCiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvbg0KICovDQpyZWdpc3RlckNvcmVDb21wb25lbnRzKCcnKTsKCmNvbnN0IG5hbWUkSSA9ICJAZmlyZWJhc2UvZGF0YWJhc2UiOwpjb25zdCB2ZXJzaW9uJDQgPSAiMS4wLjEiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqIFRoZSBzZW12ZXIgKHd3dy5zZW12ZXIub3JnKSB2ZXJzaW9uIG9mIHRoZSBTREsuICovDQpsZXQgU0RLX1ZFUlNJT04gPSAnJzsNCi8qKg0KICogU0RLX1ZFUlNJT04gc2hvdWxkIGJlIHNldCBiZWZvcmUgYW55IGRhdGFiYXNlIGluc3RhbmNlIGlzIGNyZWF0ZWQNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBzZXRTREtWZXJzaW9uKHZlcnNpb24pIHsNCiAgICBTREtfVkVSU0lPTiA9IHZlcnNpb247DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFdyYXBzIGEgRE9NIFN0b3JhZ2Ugb2JqZWN0IGFuZDoNCiAqIC0gYXV0b21hdGljYWxseSBlbmNvZGUgb2JqZWN0cyBhcyBKU09OIHN0cmluZ3MgYmVmb3JlIHN0b3JpbmcgdGhlbSB0byBhbGxvdyB1cyB0byBzdG9yZSBhcmJpdHJhcnkgdHlwZXMuDQogKiAtIHByZWZpeGVzIG5hbWVzIHdpdGggImZpcmViYXNlOiIgdG8gYXZvaWQgY29sbGlzaW9ucyB3aXRoIGFwcCBkYXRhLg0KICoNCiAqIFdlIGF1dG9tYXRpY2FsbHkgKHNlZSBzdG9yYWdlLmpzKSBjcmVhdGUgdHdvIHN1Y2ggd3JhcHBlcnMsIG9uZSBmb3Igc2Vzc2lvblN0b3JhZ2UsDQogKiBhbmQgb25lIGZvciBsb2NhbFN0b3JhZ2UuDQogKg0KICovDQpjbGFzcyBET01TdG9yYWdlV3JhcHBlciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGRvbVN0b3JhZ2VfIC0gVGhlIHVuZGVybHlpbmcgc3RvcmFnZSBvYmplY3QgKGUuZy4gbG9jYWxTdG9yYWdlIG9yIHNlc3Npb25TdG9yYWdlKQ0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGRvbVN0b3JhZ2VfKSB7DQogICAgICAgIHRoaXMuZG9tU3RvcmFnZV8gPSBkb21TdG9yYWdlXzsNCiAgICAgICAgLy8gVXNlIGEgcHJlZml4IHRvIGF2b2lkIGNvbGxpc2lvbnMgd2l0aCBvdGhlciBzdHVmZiBzYXZlZCBieSB0aGUgYXBwLg0KICAgICAgICB0aGlzLnByZWZpeF8gPSAnZmlyZWJhc2U6JzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gc2F2ZSB0aGUgdmFsdWUgdW5kZXINCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgYmVpbmcgc3RvcmVkLCBvciBudWxsIHRvIHJlbW92ZSB0aGUga2V5Lg0KICAgICAqLw0KICAgIHNldChrZXksIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLmRvbVN0b3JhZ2VfLnJlbW92ZUl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5kb21TdG9yYWdlXy5zZXRJdGVtKHRoaXMucHJlZml4ZWROYW1lXyhrZXkpLCBzdHJpbmdpZnkodmFsdWUpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgdGhhdCB3YXMgc3RvcmVkIHVuZGVyIHRoaXMga2V5LCBvciBudWxsDQogICAgICovDQogICAgZ2V0KGtleSkgew0KICAgICAgICBjb25zdCBzdG9yZWRWYWwgPSB0aGlzLmRvbVN0b3JhZ2VfLmdldEl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgICAgICBpZiAoc3RvcmVkVmFsID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGpzb25FdmFsKHN0b3JlZFZhbCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVtb3ZlKGtleSkgew0KICAgICAgICB0aGlzLmRvbVN0b3JhZ2VfLnJlbW92ZUl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgIH0NCiAgICBwcmVmaXhlZE5hbWVfKG5hbWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucHJlZml4XyArIG5hbWU7DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5kb21TdG9yYWdlXy50b1N0cmluZygpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW4tbWVtb3J5IHN0b3JhZ2UgaW1wbGVtZW50YXRpb24gdGhhdCBtYXRjaGVzIHRoZSBBUEkgb2YgRE9NU3RvcmFnZVdyYXBwZXINCiAqIChUT0RPOiBjcmVhdGUgaW50ZXJmYWNlIGZvciBib3RoIHRvIGltcGxlbWVudCkuDQogKi8NCmNsYXNzIE1lbW9yeVN0b3JhZ2Ugew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmNhY2hlXyA9IHt9Ow0KICAgICAgICB0aGlzLmlzSW5NZW1vcnlTdG9yYWdlID0gdHJ1ZTsNCiAgICB9DQogICAgc2V0KGtleSwgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlX1trZXldOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5jYWNoZV9ba2V5XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldChrZXkpIHsNCiAgICAgICAgaWYgKGNvbnRhaW5zKHRoaXMuY2FjaGVfLCBrZXkpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZV9ba2V5XTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgcmVtb3ZlKGtleSkgew0KICAgICAgICBkZWxldGUgdGhpcy5jYWNoZV9ba2V5XTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEhlbHBlciB0byBjcmVhdGUgYSBET01TdG9yYWdlV3JhcHBlciBvciBlbHNlIGZhbGwgYmFjayB0byBNZW1vcnlTdG9yYWdlLg0KICogVE9ETzogT25jZSBNZW1vcnlTdG9yYWdlIGFuZCBET01TdG9yYWdlV3JhcHBlciBoYXZlIGEgc2hhcmVkIGludGVyZmFjZSB0aGlzIG1ldGhvZCBhbm5vdGF0aW9uIHNob3VsZCBjaGFuZ2UNCiAqIHRvIHJlZmxlY3QgdGhpcyB0eXBlDQogKg0KICogQHBhcmFtIGRvbVN0b3JhZ2VOYW1lIC0gTmFtZSBvZiB0aGUgdW5kZXJseWluZyBzdG9yYWdlIG9iamVjdA0KICogICAoZS5nLiAnbG9jYWxTdG9yYWdlJyBvciAnc2Vzc2lvblN0b3JhZ2UnKS4NCiAqIEByZXR1cm5zIFR1cm5pbmcgb2ZmIHR5cGUgaW5mb3JtYXRpb24gdW50aWwgYSBjb21tb24gaW50ZXJmYWNlIGlzIGRlZmluZWQuDQogKi8NCmNvbnN0IGNyZWF0ZVN0b3JhZ2Vmb3IgPSBmdW5jdGlvbiAoZG9tU3RvcmFnZU5hbWUpIHsNCiAgICB0cnkgew0KICAgICAgICAvLyBOT1RFOiBqdXN0IGFjY2Vzc2luZyAibG9jYWxTdG9yYWdlIiBvciAid2luZG93Wydsb2NhbFN0b3JhZ2UnXSIgbWF5IHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uLA0KICAgICAgICAvLyBzbyBpdCBtdXN0IGJlIGluc2lkZSB0aGUgdHJ5L2NhdGNoLg0KICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYNCiAgICAgICAgICAgIHR5cGVvZiB3aW5kb3dbZG9tU3RvcmFnZU5hbWVdICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgLy8gTmVlZCB0byB0ZXN0IGNhY2hlLiBKdXN0IGJlY2F1c2UgaXQncyBoZXJlIGRvZXNuJ3QgbWVhbiBpdCB3b3Jrcw0KICAgICAgICAgICAgY29uc3QgZG9tU3RvcmFnZSA9IHdpbmRvd1tkb21TdG9yYWdlTmFtZV07DQogICAgICAgICAgICBkb21TdG9yYWdlLnNldEl0ZW0oJ2ZpcmViYXNlOnNlbnRpbmVsJywgJ2NhY2hlJyk7DQogICAgICAgICAgICBkb21TdG9yYWdlLnJlbW92ZUl0ZW0oJ2ZpcmViYXNlOnNlbnRpbmVsJyk7DQogICAgICAgICAgICByZXR1cm4gbmV3IERPTVN0b3JhZ2VXcmFwcGVyKGRvbVN0b3JhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIChlKSB7IH0NCiAgICAvLyBGYWlsZWQgdG8gY3JlYXRlIHdyYXBwZXIuICBKdXN0IHJldHVybiBpbi1tZW1vcnkgc3RvcmFnZS4NCiAgICAvLyBUT0RPOiBsb2c/DQogICAgcmV0dXJuIG5ldyBNZW1vcnlTdG9yYWdlKCk7DQp9Ow0KLyoqIEEgc3RvcmFnZSBvYmplY3QgdGhhdCBsYXN0cyBhY3Jvc3Mgc2Vzc2lvbnMgKi8NCmNvbnN0IFBlcnNpc3RlbnRTdG9yYWdlID0gY3JlYXRlU3RvcmFnZWZvcignbG9jYWxTdG9yYWdlJyk7DQovKiogQSBzdG9yYWdlIG9iamVjdCB0aGF0IG9ubHkgbGFzdHMgb25lIHNlc3Npb24gKi8NCmNvbnN0IFNlc3Npb25TdG9yYWdlID0gY3JlYXRlU3RvcmFnZWZvcignc2Vzc2lvblN0b3JhZ2UnKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGxvZ0NsaWVudCQxID0gbmV3IExvZ2dlcignQGZpcmViYXNlL2RhdGFiYXNlJyk7DQovKioNCiAqIFJldHVybnMgYSBsb2NhbGx5LXVuaXF1ZSBJRCAoZ2VuZXJhdGVkIGJ5IGp1c3QgaW5jcmVtZW50aW5nIHVwIGZyb20gMCBlYWNoIHRpbWUgaXRzIGNhbGxlZCkuDQogKi8NCmNvbnN0IExVSURHZW5lcmF0b3IgPSAoZnVuY3Rpb24gKCkgew0KICAgIGxldCBpZCA9IDE7DQogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIGlkKys7DQogICAgfTsNCn0pKCk7DQovKioNCiAqIFNoYTEgaGFzaCBvZiB0aGUgaW5wdXQgc3RyaW5nDQogKiBAcGFyYW0gc3RyIC0gVGhlIHN0cmluZyB0byBoYXNoDQogKiBAcmV0dXJucyB7IXN0cmluZ30gVGhlIHJlc3VsdGluZyBoYXNoDQogKi8NCmNvbnN0IHNoYTEgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgY29uc3QgdXRmOEJ5dGVzID0gc3RyaW5nVG9CeXRlQXJyYXkoc3RyKTsNCiAgICBjb25zdCBzaGExID0gbmV3IFNoYTEoKTsNCiAgICBzaGExLnVwZGF0ZSh1dGY4Qnl0ZXMpOw0KICAgIGNvbnN0IHNoYTFCeXRlcyA9IHNoYTEuZGlnZXN0KCk7DQogICAgcmV0dXJuIGJhc2U2NCQzLmVuY29kZUJ5dGVBcnJheShzaGExQnl0ZXMpOw0KfTsNCmNvbnN0IGJ1aWxkTG9nTWVzc2FnZV8gPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGxldCBtZXNzYWdlID0gJyc7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJBcmdzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IGFyZyA9IHZhckFyZ3NbaV07DQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZykgfHwNCiAgICAgICAgICAgIChhcmcgJiYNCiAgICAgICAgICAgICAgICB0eXBlb2YgYXJnID09PSAnb2JqZWN0JyAmJg0KICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgdHlwZW9mIGFyZy5sZW5ndGggPT09ICdudW1iZXInKSkgew0KICAgICAgICAgICAgbWVzc2FnZSArPSBidWlsZExvZ01lc3NhZ2VfLmFwcGx5KG51bGwsIGFyZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFyZyA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgIG1lc3NhZ2UgKz0gc3RyaW5naWZ5KGFyZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBtZXNzYWdlICs9IGFyZzsNCiAgICAgICAgfQ0KICAgICAgICBtZXNzYWdlICs9ICcgJzsNCiAgICB9DQogICAgcmV0dXJuIG1lc3NhZ2U7DQp9Ow0KLyoqDQogKiBVc2UgdGhpcyBmb3IgYWxsIGRlYnVnIG1lc3NhZ2VzIGluIEZpcmViYXNlLg0KICovDQpsZXQgbG9nZ2VyID0gbnVsbDsNCi8qKg0KICogRmxhZyB0byBjaGVjayBmb3IgbG9nIGF2YWlsYWJpbGl0eSBvbiBmaXJzdCBsb2cgbWVzc2FnZQ0KICovDQpsZXQgZmlyc3RMb2dfID0gdHJ1ZTsNCi8qKg0KICogVGhlIGltcGxlbWVudGF0aW9uIG9mIEZpcmViYXNlLmVuYWJsZUxvZ2dpbmcgKGRlZmluZWQgaGVyZSB0byBicmVhayBkZXBlbmRlbmNpZXMpDQogKiBAcGFyYW0gbG9nZ2VyXyAtIEEgZmxhZyB0byB0dXJuIG9uIGxvZ2dpbmcsIG9yIGEgY3VzdG9tIGxvZ2dlcg0KICogQHBhcmFtIHBlcnNpc3RlbnQgLSBXaGV0aGVyIG9yIG5vdCB0byBwZXJzaXN0IGxvZ2dpbmcgc2V0dGluZ3MgYWNyb3NzIHJlZnJlc2hlcw0KICovDQpjb25zdCBlbmFibGVMb2dnaW5nJDEgPSBmdW5jdGlvbiAobG9nZ2VyXywgcGVyc2lzdGVudCkgew0KICAgIGFzc2VydCghcGVyc2lzdGVudCB8fCBsb2dnZXJfID09PSB0cnVlIHx8IGxvZ2dlcl8gPT09IGZhbHNlLCAiQ2FuJ3QgdHVybiBvbiBjdXN0b20gbG9nZ2VycyBwZXJzaXN0ZW50bHkuIik7DQogICAgaWYgKGxvZ2dlcl8gPT09IHRydWUpIHsNCiAgICAgICAgbG9nQ2xpZW50JDEubG9nTGV2ZWwgPSBMb2dMZXZlbC5WRVJCT1NFOw0KICAgICAgICBsb2dnZXIgPSBsb2dDbGllbnQkMS5sb2cuYmluZChsb2dDbGllbnQkMSk7DQogICAgICAgIGlmIChwZXJzaXN0ZW50KSB7DQogICAgICAgICAgICBTZXNzaW9uU3RvcmFnZS5zZXQoJ2xvZ2dpbmdfZW5hYmxlZCcsIHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGVvZiBsb2dnZXJfID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGxvZ2dlciA9IGxvZ2dlcl87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBsb2dnZXIgPSBudWxsOw0KICAgICAgICBTZXNzaW9uU3RvcmFnZS5yZW1vdmUoJ2xvZ2dpbmdfZW5hYmxlZCcpOw0KICAgIH0NCn07DQpjb25zdCBsb2cgPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGlmIChmaXJzdExvZ18gPT09IHRydWUpIHsNCiAgICAgICAgZmlyc3RMb2dfID0gZmFsc2U7DQogICAgICAgIGlmIChsb2dnZXIgPT09IG51bGwgJiYgU2Vzc2lvblN0b3JhZ2UuZ2V0KCdsb2dnaW5nX2VuYWJsZWQnKSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgZW5hYmxlTG9nZ2luZyQxKHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChsb2dnZXIpIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGJ1aWxkTG9nTWVzc2FnZV8uYXBwbHkobnVsbCwgdmFyQXJncyk7DQogICAgICAgIGxvZ2dlcihtZXNzYWdlKTsNCiAgICB9DQp9Ow0KY29uc3QgbG9nV3JhcHBlciA9IGZ1bmN0aW9uIChwcmVmaXgpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHsNCiAgICAgICAgbG9nKHByZWZpeCwgLi4udmFyQXJncyk7DQogICAgfTsNCn07DQpjb25zdCBlcnJvciQxID0gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHsNCiAgICBjb25zdCBtZXNzYWdlID0gJ0ZJUkVCQVNFIElOVEVSTkFMIEVSUk9SOiAnICsgYnVpbGRMb2dNZXNzYWdlXyguLi52YXJBcmdzKTsNCiAgICBsb2dDbGllbnQkMS5lcnJvcihtZXNzYWdlKTsNCn07DQpjb25zdCBmYXRhbCA9IGZ1bmN0aW9uICguLi52YXJBcmdzKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IGBGSVJFQkFTRSBGQVRBTCBFUlJPUjogJHtidWlsZExvZ01lc3NhZ2VfKC4uLnZhckFyZ3MpfWA7DQogICAgbG9nQ2xpZW50JDEuZXJyb3IobWVzc2FnZSk7DQogICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOw0KfTsNCmNvbnN0IHdhcm4gPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSAnRklSRUJBU0UgV0FSTklORzogJyArIGJ1aWxkTG9nTWVzc2FnZV8oLi4udmFyQXJncyk7DQogICAgbG9nQ2xpZW50JDEud2FybihtZXNzYWdlKTsNCn07DQovKioNCiAqIExvZ3MgYSB3YXJuaW5nIGlmIHRoZSBjb250YWluaW5nIHBhZ2UgdXNlcyBodHRwcy4gQ2FsbGVkIHdoZW4gYSBjYWxsIHRvIG5ldyBGaXJlYmFzZQ0KICogZG9lcyBub3QgdXNlIGh0dHBzLg0KICovDQpjb25zdCB3YXJuSWZQYWdlSXNTZWN1cmUgPSBmdW5jdGlvbiAoKSB7DQogICAgLy8gQmUgdmVyeSBjYXJlZnVsIGFjY2Vzc2luZyBicm93c2VyIGdsb2JhbHMuIFdobyBrbm93cyB3aGF0IG1heSBvciBtYXkgbm90IGV4aXN0Lg0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICB3aW5kb3cubG9jYXRpb24gJiYNCiAgICAgICAgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICYmDQogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSAhPT0gLTEpIHsNCiAgICAgICAgd2FybignSW5zZWN1cmUgRmlyZWJhc2UgYWNjZXNzIGZyb20gYSBzZWN1cmUgcGFnZS4gJyArDQogICAgICAgICAgICAnUGxlYXNlIHVzZSBodHRwcyBpbiBjYWxscyB0byBuZXcgRmlyZWJhc2UoKS4nKTsNCiAgICB9DQp9Ow0KLyoqDQogKiBSZXR1cm5zIHRydWUgaWYgZGF0YSBpcyBOYU4sIG9yICsvLSBJbmZpbml0eS4NCiAqLw0KY29uc3QgaXNJbnZhbGlkSlNPTk51bWJlciA9IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgcmV0dXJuICh0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicgJiYNCiAgICAgICAgKGRhdGEgIT09IGRhdGEgfHwgLy8gTmFODQogICAgICAgICAgICBkYXRhID09PSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgfHwNCiAgICAgICAgICAgIGRhdGEgPT09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkpOw0KfTsNCmNvbnN0IGV4ZWN1dGVXaGVuRE9NUmVhZHkgPSBmdW5jdGlvbiAoZm4pIHsNCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgew0KICAgICAgICBmbigpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgLy8gTW9kZWxlZCBhZnRlciBqUXVlcnkuIFRyeSBET01Db250ZW50TG9hZGVkIGFuZCBvbnJlYWR5c3RhdGVjaGFuZ2UgKHdoaWNoDQogICAgICAgIC8vIGZpcmUgYmVmb3JlIG9ubG9hZCksIGJ1dCBmYWxsIGJhY2sgdG8gb25sb2FkLg0KICAgICAgICBsZXQgY2FsbGVkID0gZmFsc2U7DQogICAgICAgIGNvbnN0IHdyYXBwZWRGbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuYm9keSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQod3JhcHBlZEZuLCBNYXRoLmZsb29yKDEwKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFjYWxsZWQpIHsNCiAgICAgICAgICAgICAgICBjYWxsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGZuKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgd3JhcHBlZEZuLCBmYWxzZSk7DQogICAgICAgICAgICAvLyBmYWxsYmFjayB0byBvbmxvYWQuDQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHdyYXBwZWRGbiwgZmFsc2UpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgew0KICAgICAgICAgICAgLy8gSUUuDQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoJ29ucmVhZHlzdGF0ZWNoYW5nZScsICgpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgew0KICAgICAgICAgICAgICAgICAgICB3cmFwcGVkRm4oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIC8vIGZhbGxiYWNrIHRvIG9ubG9hZC4NCiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29ubG9hZCcsIHdyYXBwZWRGbik7DQogICAgICAgICAgICAvLyBqUXVlcnkgaGFzIGFuIGV4dHJhIGhhY2sgZm9yIElFIHRoYXQgd2UgY291bGQgZW1wbG95IChiYXNlZCBvbg0KICAgICAgICAgICAgLy8gaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC8pIEJ1dCBpdCBsb29rcyByZWFsbHkgb2xkLg0KICAgICAgICAgICAgLy8gSSdtIGhvcGluZyB3ZSBkb24ndCBuZWVkIGl0Lg0KICAgICAgICB9DQogICAgfQ0KfTsNCi8qKg0KICogTWluaW11bSBrZXkgbmFtZS4gSW52YWxpZCBmb3IgYWN0dWFsIGRhdGEsIHVzZWQgYXMgYSBtYXJrZXIgdG8gc29ydCBiZWZvcmUgYW55IHZhbGlkIG5hbWVzDQogKi8NCmNvbnN0IE1JTl9OQU1FID0gJ1tNSU5fTkFNRV0nOw0KLyoqDQogKiBNYXhpbXVtIGtleSBuYW1lLiBJbnZhbGlkIGZvciBhY3R1YWwgZGF0YSwgdXNlZCBhcyBhIG1hcmtlciB0byBzb3J0IGFib3ZlIGFueSB2YWxpZCBuYW1lcw0KICovDQpjb25zdCBNQVhfTkFNRSA9ICdbTUFYX05BTUVdJzsNCi8qKg0KICogQ29tcGFyZXMgdmFsaWQgRmlyZWJhc2Uga2V5IG5hbWVzLCBwbHVzIG1pbiBhbmQgbWF4IG5hbWUNCiAqLw0KY29uc3QgbmFtZUNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikgew0KICAgIGlmIChhID09PSBiKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgIH0NCiAgICBlbHNlIGlmIChhID09PSBNSU5fTkFNRSB8fCBiID09PSBNQVhfTkFNRSkgew0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KICAgIGVsc2UgaWYgKGIgPT09IE1JTl9OQU1FIHx8IGEgPT09IE1BWF9OQU1FKSB7DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgYUFzSW50ID0gdHJ5UGFyc2VJbnQoYSksIGJBc0ludCA9IHRyeVBhcnNlSW50KGIpOw0KICAgICAgICBpZiAoYUFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICBpZiAoYkFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFBc0ludCAtIGJBc0ludCA9PT0gMCA/IGEubGVuZ3RoIC0gYi5sZW5ndGggOiBhQXNJbnQgLSBiQXNJbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYkFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogMTsNCiAgICAgICAgfQ0KICAgIH0NCn07DQovKioNCiAqIEByZXR1cm5zIHshbnVtYmVyfSBjb21wYXJpc29uIHJlc3VsdC4NCiAqLw0KY29uc3Qgc3RyaW5nQ29tcGFyZSA9IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKGEgPT09IGIpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIGVsc2UgaWYgKGEgPCBiKSB7DQogICAgICAgIHJldHVybiAtMTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCn07DQpjb25zdCByZXF1aXJlS2V5ID0gZnVuY3Rpb24gKGtleSwgb2JqKSB7DQogICAgaWYgKG9iaiAmJiBrZXkgaW4gb2JqKSB7DQogICAgICAgIHJldHVybiBvYmpba2V5XTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyByZXF1aXJlZCBrZXkgKCcgKyBrZXkgKyAnKSBpbiBvYmplY3Q6ICcgKyBzdHJpbmdpZnkob2JqKSk7DQogICAgfQ0KfTsNCmNvbnN0IE9iamVjdFRvVW5pcXVlS2V5ID0gZnVuY3Rpb24gKG9iaikgew0KICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHN0cmluZ2lmeShvYmopOw0KICAgIH0NCiAgICBjb25zdCBrZXlzID0gW107DQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGd1YXJkLWZvci1pbg0KICAgIGZvciAoY29uc3QgayBpbiBvYmopIHsNCiAgICAgICAga2V5cy5wdXNoKGspOw0KICAgIH0NCiAgICAvLyBFeHBvcnQgYXMganNvbiwgYnV0IHdpdGggdGhlIGtleXMgc29ydGVkLg0KICAgIGtleXMuc29ydCgpOw0KICAgIGxldCBrZXkgPSAneyc7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChpICE9PSAwKSB7DQogICAgICAgICAgICBrZXkgKz0gJywnOw0KICAgICAgICB9DQogICAgICAgIGtleSArPSBzdHJpbmdpZnkoa2V5c1tpXSk7DQogICAgICAgIGtleSArPSAnOic7DQogICAgICAgIGtleSArPSBPYmplY3RUb1VuaXF1ZUtleShvYmpba2V5c1tpXV0pOw0KICAgIH0NCiAgICBrZXkgKz0gJ30nOw0KICAgIHJldHVybiBrZXk7DQp9Ow0KLyoqDQogKiBTcGxpdHMgYSBzdHJpbmcgaW50byBhIG51bWJlciBvZiBzbWFsbGVyIHNlZ21lbnRzIG9mIG1heGltdW0gc2l6ZQ0KICogQHBhcmFtIHN0ciAtIFRoZSBzdHJpbmcNCiAqIEBwYXJhbSBzZWdzaXplIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGNoYXJzIGluIHRoZSBzdHJpbmcuDQogKiBAcmV0dXJucyBUaGUgc3RyaW5nLCBzcGxpdCBpbnRvIGFwcHJvcHJpYXRlbHktc2l6ZWQgY2h1bmtzDQogKi8NCmNvbnN0IHNwbGl0U3RyaW5nQnlTaXplID0gZnVuY3Rpb24gKHN0ciwgc2Vnc2l6ZSkgew0KICAgIGNvbnN0IGxlbiA9IHN0ci5sZW5ndGg7DQogICAgaWYgKGxlbiA8PSBzZWdzaXplKSB7DQogICAgICAgIHJldHVybiBbc3RyXTsNCiAgICB9DQogICAgY29uc3QgZGF0YVNlZ3MgPSBbXTsNCiAgICBmb3IgKGxldCBjID0gMDsgYyA8IGxlbjsgYyArPSBzZWdzaXplKSB7DQogICAgICAgIGlmIChjICsgc2Vnc2l6ZSA+IGxlbikgew0KICAgICAgICAgICAgZGF0YVNlZ3MucHVzaChzdHIuc3Vic3RyaW5nKGMsIGxlbikpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZGF0YVNlZ3MucHVzaChzdHIuc3Vic3RyaW5nKGMsIGMgKyBzZWdzaXplKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRhdGFTZWdzOw0KfTsNCi8qKg0KICogQXBwbHkgYSBmdW5jdGlvbiB0byBlYWNoIChrZXksIHZhbHVlKSBwYWlyIGluIGFuIG9iamVjdCBvcg0KICogYXBwbHkgYSBmdW5jdGlvbiB0byBlYWNoIChpbmRleCwgdmFsdWUpIHBhaXIgaW4gYW4gYXJyYXkNCiAqIEBwYXJhbSBvYmogLSBUaGUgb2JqZWN0IG9yIGFycmF5IHRvIGl0ZXJhdGUgb3Zlcg0KICogQHBhcmFtIGZuIC0gVGhlIGZ1bmN0aW9uIHRvIGFwcGx5DQogKi8NCmZ1bmN0aW9uIGVhY2gob2JqLCBmbikgew0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgIGZuKGtleSwgb2JqW2tleV0pOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBCb3Jyb3dlZCBmcm9tIGh0dHA6Ly9oZy5zZWNvbmRsaWZlLmNvbS9sbHNkL3NyYy90aXAvanMvdHlwZWRhcnJheS5qcyAoTUlUIExpY2Vuc2UpDQogKiBJIG1hZGUgb25lIG1vZGlmaWNhdGlvbiBhdCB0aGUgZW5kIGFuZCByZW1vdmVkIHRoZSBOYU4gLyBJbmZpbml0eQ0KICogaGFuZGxpbmcgKHNpbmNlIGl0IHNlZW1lZCBicm9rZW4gW2NhdXNlZCBhbiBvdmVyZmxvd10gYW5kIHdlIGRvbid0IG5lZWQgaXQpLiAgU2VlIE1KTCBjb21tZW50cy4NCiAqIEBwYXJhbSB2IC0gQSBkb3VibGUNCiAqDQogKi8NCmNvbnN0IGRvdWJsZVRvSUVFRTc1NFN0cmluZyA9IGZ1bmN0aW9uICh2KSB7DQogICAgYXNzZXJ0KCFpc0ludmFsaWRKU09OTnVtYmVyKHYpLCAnSW52YWxpZCBKU09OIG51bWJlcicpOyAvLyBNSkwNCiAgICBjb25zdCBlYml0cyA9IDExLCBmYml0cyA9IDUyOw0KICAgIGNvbnN0IGJpYXMgPSAoMSA8PCAoZWJpdHMgLSAxKSkgLSAxOw0KICAgIGxldCBzLCBlLCBmLCBsbiwgaTsNCiAgICAvLyBDb21wdXRlIHNpZ24sIGV4cG9uZW50LCBmcmFjdGlvbg0KICAgIC8vIFNraXAgTmFOIC8gSW5maW5pdHkgaGFuZGxpbmcgLS1NSkwuDQogICAgaWYgKHYgPT09IDApIHsNCiAgICAgICAgZSA9IDA7DQogICAgICAgIGYgPSAwOw0KICAgICAgICBzID0gMSAvIHYgPT09IC1JbmZpbml0eSA/IDEgOiAwOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcyA9IHYgPCAwOw0KICAgICAgICB2ID0gTWF0aC5hYnModik7DQogICAgICAgIGlmICh2ID49IE1hdGgucG93KDIsIDEgLSBiaWFzKSkgew0KICAgICAgICAgICAgLy8gTm9ybWFsaXplZA0KICAgICAgICAgICAgbG4gPSBNYXRoLm1pbihNYXRoLmZsb29yKE1hdGgubG9nKHYpIC8gTWF0aC5MTjIpLCBiaWFzKTsNCiAgICAgICAgICAgIGUgPSBsbiArIGJpYXM7DQogICAgICAgICAgICBmID0gTWF0aC5yb3VuZCh2ICogTWF0aC5wb3coMiwgZmJpdHMgLSBsbikgLSBNYXRoLnBvdygyLCBmYml0cykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gRGVub3JtYWxpemVkDQogICAgICAgICAgICBlID0gMDsNCiAgICAgICAgICAgIGYgPSBNYXRoLnJvdW5kKHYgLyBNYXRoLnBvdygyLCAxIC0gYmlhcyAtIGZiaXRzKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLy8gUGFjayBzaWduLCBleHBvbmVudCwgZnJhY3Rpb24NCiAgICBjb25zdCBiaXRzID0gW107DQogICAgZm9yIChpID0gZmJpdHM7IGk7IGkgLT0gMSkgew0KICAgICAgICBiaXRzLnB1c2goZiAlIDIgPyAxIDogMCk7DQogICAgICAgIGYgPSBNYXRoLmZsb29yKGYgLyAyKTsNCiAgICB9DQogICAgZm9yIChpID0gZWJpdHM7IGk7IGkgLT0gMSkgew0KICAgICAgICBiaXRzLnB1c2goZSAlIDIgPyAxIDogMCk7DQogICAgICAgIGUgPSBNYXRoLmZsb29yKGUgLyAyKTsNCiAgICB9DQogICAgYml0cy5wdXNoKHMgPyAxIDogMCk7DQogICAgYml0cy5yZXZlcnNlKCk7DQogICAgY29uc3Qgc3RyID0gYml0cy5qb2luKCcnKTsNCiAgICAvLyBSZXR1cm4gdGhlIGRhdGEgYXMgYSBoZXggc3RyaW5nLiAtLU1KTA0KICAgIGxldCBoZXhCeXRlU3RyaW5nID0gJyc7DQogICAgZm9yIChpID0gMDsgaSA8IDY0OyBpICs9IDgpIHsNCiAgICAgICAgbGV0IGhleEJ5dGUgPSBwYXJzZUludChzdHIuc3Vic3RyKGksIDgpLCAyKS50b1N0cmluZygxNik7DQogICAgICAgIGlmIChoZXhCeXRlLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgaGV4Qnl0ZSA9ICcwJyArIGhleEJ5dGU7DQogICAgICAgIH0NCiAgICAgICAgaGV4Qnl0ZVN0cmluZyA9IGhleEJ5dGVTdHJpbmcgKyBoZXhCeXRlOw0KICAgIH0NCiAgICByZXR1cm4gaGV4Qnl0ZVN0cmluZy50b0xvd2VyQ2FzZSgpOw0KfTsNCi8qKg0KICogVXNlZCB0byBkZXRlY3QgaWYgd2UncmUgaW4gYSBDaHJvbWUgY29udGVudCBzY3JpcHQgKHdoaWNoIGV4ZWN1dGVzIGluIGFuDQogKiBpc29sYXRlZCBlbnZpcm9ubWVudCB3aGVyZSBsb25nLXBvbGxpbmcgZG9lc24ndCB3b3JrKS4NCiAqLw0KY29uc3QgaXNDaHJvbWVFeHRlbnNpb25Db250ZW50U2NyaXB0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiAhISh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJg0KICAgICAgICB3aW5kb3dbJ2Nocm9tZSddICYmDQogICAgICAgIHdpbmRvd1snY2hyb21lJ11bJ2V4dGVuc2lvbiddICYmDQogICAgICAgICEvXmNocm9tZS8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpOw0KfTsNCi8qKg0KICogVXNlZCB0byBkZXRlY3QgaWYgd2UncmUgaW4gYSBXaW5kb3dzIDggU3RvcmUgYXBwLg0KICovDQpjb25zdCBpc1dpbmRvd3NTdG9yZUFwcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAvLyBDaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGEgY291cGxlIFdpblJUIGdsb2JhbHMNCiAgICByZXR1cm4gdHlwZW9mIFdpbmRvd3MgPT09ICdvYmplY3QnICYmIHR5cGVvZiBXaW5kb3dzLlVJID09PSAnb2JqZWN0JzsNCn07DQovKioNCiAqIENvbnZlcnRzIGEgc2VydmVyIGVycm9yIGNvZGUgdG8gYSBKYXZhc2NyaXB0IEVycm9yDQogKi8NCmZ1bmN0aW9uIGVycm9yRm9yU2VydmVyQ29kZShjb2RlLCBxdWVyeSkgew0KICAgIGxldCByZWFzb24gPSAnVW5rbm93biBFcnJvcic7DQogICAgaWYgKGNvZGUgPT09ICd0b29fYmlnJykgew0KICAgICAgICByZWFzb24gPQ0KICAgICAgICAgICAgJ1RoZSBkYXRhIHJlcXVlc3RlZCBleGNlZWRzIHRoZSBtYXhpbXVtIHNpemUgJyArDQogICAgICAgICAgICAgICAgJ3RoYXQgY2FuIGJlIGFjY2Vzc2VkIHdpdGggYSBzaW5nbGUgcmVxdWVzdC4nOw0KICAgIH0NCiAgICBlbHNlIGlmIChjb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgIHJlYXNvbiA9ICJDbGllbnQgZG9lc24ndCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoZSBkZXNpcmVkIGRhdGEuIjsNCiAgICB9DQogICAgZWxzZSBpZiAoY29kZSA9PT0gJ3VuYXZhaWxhYmxlJykgew0KICAgICAgICByZWFzb24gPSAnVGhlIHNlcnZpY2UgaXMgdW5hdmFpbGFibGUnOw0KICAgIH0NCiAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihjb2RlICsgJyBhdCAnICsgcXVlcnkuX3BhdGgudG9TdHJpbmcoKSArICc6ICcgKyByZWFzb24pOw0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgZXJyb3IuY29kZSA9IGNvZGUudG9VcHBlckNhc2UoKTsNCiAgICByZXR1cm4gZXJyb3I7DQp9DQovKioNCiAqIFVzZWQgdG8gdGVzdCBmb3IgaW50ZWdlci1sb29raW5nIHN0cmluZ3MNCiAqLw0KY29uc3QgSU5URUdFUl9SRUdFWFBfID0gbmV3IFJlZ0V4cCgnXi0/KDAqKVxcZHsxLDEwfSQnKTsNCi8qKg0KICogRm9yIHVzZSBpbiBrZXlzLCB0aGUgbWluaW11bSBwb3NzaWJsZSAzMi1iaXQgaW50ZWdlci4NCiAqLw0KY29uc3QgSU5URUdFUl8zMl9NSU4gPSAtMjE0NzQ4MzY0ODsNCi8qKg0KICogRm9yIHVzZSBpbiBreWVzLCB0aGUgbWF4aW11bSBwb3NzaWJsZSAzMi1iaXQgaW50ZWdlci4NCiAqLw0KY29uc3QgSU5URUdFUl8zMl9NQVggPSAyMTQ3NDgzNjQ3Ow0KLyoqDQogKiBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGEgMzItYml0IGludGVnZXIsIHJldHVybiBpdC4gIEVsc2UgcmV0dXJuIG51bGwuDQogKi8NCmNvbnN0IHRyeVBhcnNlSW50ID0gZnVuY3Rpb24gKHN0cikgew0KICAgIGlmIChJTlRFR0VSX1JFR0VYUF8udGVzdChzdHIpKSB7DQogICAgICAgIGNvbnN0IGludFZhbCA9IE51bWJlcihzdHIpOw0KICAgICAgICBpZiAoaW50VmFsID49IElOVEVHRVJfMzJfTUlOICYmIGludFZhbCA8PSBJTlRFR0VSXzMyX01BWCkgew0KICAgICAgICAgICAgcmV0dXJuIGludFZhbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCn07DQovKioNCiAqIEhlbHBlciB0byBydW4gc29tZSBjb2RlIGJ1dCBjYXRjaCBhbnkgZXhjZXB0aW9ucyBhbmQgcmUtdGhyb3cgdGhlbSBsYXRlci4NCiAqIFVzZWZ1bCBmb3IgcHJldmVudGluZyB1c2VyIGNhbGxiYWNrcyBmcm9tIGJyZWFraW5nIGludGVybmFsIGNvZGUuDQogKg0KICogUmUtdGhyb3dpbmcgdGhlIGV4Y2VwdGlvbiBmcm9tIGEgc2V0VGltZW91dCBpcyBhIGxpdHRsZSBldmlsLCBidXQgaXQncyB2ZXJ5DQogKiBjb252ZW5pZW50ICh3ZSBkb24ndCBoYXZlIHRvIHRyeSB0byBmaWd1cmUgb3V0IHdoZW4gaXMgYSBzYWZlIHBvaW50IHRvDQogKiByZS10aHJvdyBpdCksIGFuZCB0aGUgYmVoYXZpb3Igc2VlbXMgcmVhc29uYWJsZToNCiAqDQogKiAqIElmIHlvdSBhcmVuJ3QgcGF1c2luZyBvbiBleGNlcHRpb25zLCB5b3UgZ2V0IGFuIGVycm9yIGluIHRoZSBjb25zb2xlIHdpdGgNCiAqICAgdGhlIGNvcnJlY3Qgc3RhY2sgdHJhY2UuDQogKiAqIElmIHlvdSdyZSBwYXVzaW5nIG9uIGFsbCBleGNlcHRpb25zLCB0aGUgZGVidWdnZXIgd2lsbCBwYXVzZSBvbiB5b3VyDQogKiAgIGV4Y2VwdGlvbiBhbmQgdGhlbiBhZ2FpbiB3aGVuIHdlIHJldGhyb3cgaXQuDQogKiAqIElmIHlvdSdyZSBvbmx5IHBhdXNpbmcgb24gdW5jYXVnaHQgZXhjZXB0aW9ucywgdGhlIGRlYnVnZ2VyIHdpbGwgb25seSBwYXVzZQ0KICogICBvbiB1cyByZS10aHJvd2luZyBpdC4NCiAqDQogKiBAcGFyYW0gZm4gLSBUaGUgY29kZSB0byBndWFyZC4NCiAqLw0KY29uc3QgZXhjZXB0aW9uR3VhcmQgPSBmdW5jdGlvbiAoZm4pIHsNCiAgICB0cnkgew0KICAgICAgICBmbigpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvLyBSZS10aHJvdyBleGNlcHRpb24gd2hlbiBpdCdzIHNhZmUuDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgLy8gSXQgdXNlZCB0byBiZSB0aGF0ICJ0aHJvdyBlIiB3b3VsZCByZXN1bHQgaW4gYSBnb29kIGNvbnNvbGUgZXJyb3Igd2l0aA0KICAgICAgICAgICAgLy8gcmVsZXZhbnQgY29udGV4dCwgYnV0IGFzIG9mIENocm9tZSAzOSwgeW91IGp1c3QgZ2V0IHRoZSBmaXJlYmFzZS5qcw0KICAgICAgICAgICAgLy8gZmlsZS9saW5lIG51bWJlciB3aGVyZSB3ZSByZS10aHJvdyBpdCwgd2hpY2ggaXMgdXNlbGVzcy4gU28gd2UgbG9nDQogICAgICAgICAgICAvLyBlLnN0YWNrIGV4cGxpY2l0bHkuDQogICAgICAgICAgICBjb25zdCBzdGFjayA9IGUuc3RhY2sgfHwgJyc7DQogICAgICAgICAgICB3YXJuKCdFeGNlcHRpb24gd2FzIHRocm93biBieSB1c2VyIGNhbGxiYWNrLicsIHN0YWNrKTsNCiAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgIH0sIE1hdGguZmxvb3IoMCkpOw0KICAgIH0NCn07DQovKioNCiAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHdlIHRoaW5rIHdlJ3JlIGN1cnJlbnRseSBiZWluZyBjcmF3bGVkLg0KICovDQpjb25zdCBiZWluZ0NyYXdsZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgdXNlckFnZW50ID0gKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnICYmDQogICAgICAgIHdpbmRvd1snbmF2aWdhdG9yJ10gJiYNCiAgICAgICAgd2luZG93WyduYXZpZ2F0b3InXVsndXNlckFnZW50J10pIHx8DQogICAgICAgICcnOw0KICAgIC8vIEZvciBub3cgd2Ugd2hpdGVsaXN0IHRoZSBtb3N0IHBvcHVsYXIgY3Jhd2xlcnMuICBXZSBzaG91bGQgcmVmaW5lIHRoaXMgdG8gYmUgdGhlIHNldCBvZiBjcmF3bGVycyB3ZQ0KICAgIC8vIGJlbGlldmUgdG8gc3VwcG9ydCBKYXZhU2NyaXB0L0FKQVggcmVuZGVyaW5nLg0KICAgIC8vIE5PVEU6IEdvb2dsZSBXZWJtYXN0ZXIgVG9vbHMgZG9lc24ndCByZWFsbHkgYmVsb25nLCBidXQgdGhlaXIgIlRoaXMgaXMgaG93IGEgdmlzaXRvciB0byB5b3VyIHdlYnNpdGUNCiAgICAvLyB3b3VsZCBoYXZlIHNlZW4gdGhlIHBhZ2UiIGlzIGZsYWt5IGlmIHdlIGRvbid0IHRyZWF0IGl0IGFzIGEgY3Jhd2xlci4NCiAgICByZXR1cm4gKHVzZXJBZ2VudC5zZWFyY2goL2dvb2dsZWJvdHxnb29nbGUgd2VibWFzdGVyIHRvb2xzfGJpbmdib3R8eWFob28hIHNsdXJwfGJhaWR1c3BpZGVyfHlhbmRleGJvdHxkdWNrZHVja2JvdC9pKSA+PSAwKTsNCn07DQovKioNCiAqIFNhbWUgYXMgc2V0VGltZW91dCgpIGV4Y2VwdCBvbiBOb2RlLkpTIGl0IHdpbGwgL25vdC8gcHJldmVudCB0aGUgcHJvY2VzcyBmcm9tIGV4aXRpbmcuDQogKg0KICogSXQgaXMgcmVtb3ZlZCB3aXRoIGNsZWFyVGltZW91dCgpIGFzIG5vcm1hbC4NCiAqDQogKiBAcGFyYW0gZm4gLSBGdW5jdGlvbiB0byBydW4uDQogKiBAcGFyYW0gdGltZSAtIE1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBydW5uaW5nLg0KICogQHJldHVybnMgVGhlIHNldFRpbWVvdXQoKSByZXR1cm4gdmFsdWUuDQogKi8NCmNvbnN0IHNldFRpbWVvdXROb25CbG9ja2luZyA9IGZ1bmN0aW9uIChmbiwgdGltZSkgew0KICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZuLCB0aW1lKTsNCiAgICAvLyBOb3RlOiBhdCB0aGUgdGltZSBvZiB0aGlzIGNvbW1lbnQsIHVucmVmVGltZXIgaXMgdW5kZXIgdGhlIHVuc3RhYmxlIHNldCBvZiBBUElzLiBSdW4gd2l0aCAtLXVuc3RhYmxlIHRvIGVuYWJsZSB0aGUgQVBJLg0KICAgIGlmICh0eXBlb2YgdGltZW91dCA9PT0gJ251bWJlcicgJiYNCiAgICAgICAgLy8gQHRzLWlnbm9yZSBJcyBvbmx5IGRlZmluZWQgaW4gRGVubyBlbnZpcm9ubWVudHMuDQogICAgICAgIHR5cGVvZiBEZW5vICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAvLyBAdHMtaWdub3JlIERlbm8gYW5kIHVucmVmVGltZXIgYXJlIG9ubHkgZGVmaW5lZCBpbiBEZW5vIGVudmlyb25tZW50cy4NCiAgICAgICAgRGVub1sndW5yZWZUaW1lciddKSB7DQogICAgICAgIC8vIEB0cy1pZ25vcmUgRGVubyBhbmQgdW5yZWZUaW1lciBhcmUgb25seSBkZWZpbmVkIGluIERlbm8gZW52aXJvbm1lbnRzLg0KICAgICAgICBEZW5vLnVucmVmVGltZXIodGltZW91dCk7DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSAnb2JqZWN0JyAmJiB0aW1lb3V0Wyd1bnJlZiddKSB7DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgIHRpbWVvdXRbJ3VucmVmJ10oKTsNCiAgICB9DQogICAgcmV0dXJuIHRpbWVvdXQ7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBYnN0cmFjdGlvbiBhcm91bmQgQXBwQ2hlY2sncyB0b2tlbiBmZXRjaGluZyBjYXBhYmlsaXRpZXMuDQogKi8NCmNsYXNzIEFwcENoZWNrVG9rZW5Qcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoYXBwTmFtZV8sIGFwcENoZWNrUHJvdmlkZXIpIHsNCiAgICAgICAgdGhpcy5hcHBOYW1lXyA9IGFwcE5hbWVfOw0KICAgICAgICB0aGlzLmFwcENoZWNrUHJvdmlkZXIgPSBhcHBDaGVja1Byb3ZpZGVyOw0KICAgICAgICB0aGlzLmFwcENoZWNrID0gYXBwQ2hlY2tQcm92aWRlciA9PT0gbnVsbCB8fCBhcHBDaGVja1Byb3ZpZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Byb3ZpZGVyLmdldEltbWVkaWF0ZSh7IG9wdGlvbmFsOiB0cnVlIH0pOw0KICAgICAgICBpZiAoIXRoaXMuYXBwQ2hlY2spIHsNCiAgICAgICAgICAgIGFwcENoZWNrUHJvdmlkZXIgPT09IG51bGwgfHwgYXBwQ2hlY2tQcm92aWRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tQcm92aWRlci5nZXQoKS50aGVuKGFwcENoZWNrID0+ICh0aGlzLmFwcENoZWNrID0gYXBwQ2hlY2spKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUFwcENoZWNrLiBUaGlzIGFsbG93cyBvdXINCiAgICAgICAgICAgICAgICAvLyBjdXN0b21lcnMgdG8gaW5pdGlhbGl6ZSB0aGUgUlREQiBTREsgYmVmb3JlIGluaXRpYWxpemluZyBGaXJlYmFzZQ0KICAgICAgICAgICAgICAgIC8vIEFwcENoZWNrIGFuZCBlbnN1cmVzIHRoYXQgYWxsIHJlcXVlc3RzIGFyZSBhdXRoZW50aWNhdGVkIGlmIGEgdG9rZW4NCiAgICAgICAgICAgICAgICAvLyBiZWNvbWVzIGF2YWlsYWJsZSBiZWZvcmUgdGhlIHRpbW9lb3V0IGJlbG93IGV4cGlyZXMuDQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKGZvcmNlUmVmcmVzaCkudGhlbihyZXNvbHZlLCByZWplY3QpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuYXBwQ2hlY2suZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKTsNCiAgICB9DQogICAgYWRkVG9rZW5DaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcikgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIChfYSA9IHRoaXMuYXBwQ2hlY2tQcm92aWRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldCgpLnRoZW4oYXBwQ2hlY2sgPT4gYXBwQ2hlY2suYWRkVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgIH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7DQogICAgICAgIHdhcm4oYFByb3ZpZGVkIEFwcENoZWNrIGNyZWRlbnRpYWxzIGZvciB0aGUgYXBwIG5hbWVkICIke3RoaXMuYXBwTmFtZV99IiBgICsNCiAgICAgICAgICAgICdhcmUgaW52YWxpZC4gVGhpcyB1c3VhbGx5IGluZGljYXRlcyB5b3VyIGFwcCB3YXMgbm90IGluaXRpYWxpemVkIGNvcnJlY3RseS4nKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEFic3RyYWN0aW9uIGFyb3VuZCBGaXJlYmFzZUFwcCdzIHRva2VuIGZldGNoaW5nIGNhcGFiaWxpdGllcy4NCiAqLw0KY2xhc3MgRmlyZWJhc2VBdXRoVG9rZW5Qcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoYXBwTmFtZV8sIGZpcmViYXNlT3B0aW9uc18sIGF1dGhQcm92aWRlcl8pIHsNCiAgICAgICAgdGhpcy5hcHBOYW1lXyA9IGFwcE5hbWVfOw0KICAgICAgICB0aGlzLmZpcmViYXNlT3B0aW9uc18gPSBmaXJlYmFzZU9wdGlvbnNfOw0KICAgICAgICB0aGlzLmF1dGhQcm92aWRlcl8gPSBhdXRoUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmF1dGhfID0gbnVsbDsNCiAgICAgICAgdGhpcy5hdXRoXyA9IGF1dGhQcm92aWRlcl8uZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7DQogICAgICAgIGlmICghdGhpcy5hdXRoXykgew0KICAgICAgICAgICAgYXV0aFByb3ZpZGVyXy5vbkluaXQoYXV0aCA9PiAodGhpcy5hdXRoXyA9IGF1dGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgaWYgKCF0aGlzLmF1dGhfKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUF1dGguIFRoaXMgYWxsb3dzIG91cg0KICAgICAgICAgICAgICAgIC8vIGN1c3RvbWVycyB0byBpbml0aWFsaXplIHRoZSBSVERCIFNESyBiZWZvcmUgaW5pdGlhbGl6aW5nIEZpcmViYXNlDQogICAgICAgICAgICAgICAgLy8gQXV0aCBhbmQgZW5zdXJlcyB0aGF0IGFsbCByZXF1ZXN0cyBhcmUgYXV0aGVudGljYXRlZCBpZiBhIHRva2VuDQogICAgICAgICAgICAgICAgLy8gYmVjb21lcyBhdmFpbGFibGUgYmVmb3JlIHRoZSB0aW1vZW91dCBiZWxvdyBleHBpcmVzLg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdXRoXykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbihmb3JjZVJlZnJlc2gpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmF1dGhfLmdldFRva2VuKGZvcmNlUmVmcmVzaCkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgLy8gVE9ETzogTmVlZCB0byBmaWd1cmUgb3V0IGFsbCB0aGUgY2FzZXMgdGhpcyBpcyByYWlzZWQgYW5kIHdoZXRoZXINCiAgICAgICAgICAgIC8vIHRoaXMgbWFrZXMgc2Vuc2UuDQogICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSA9PT0gJ2F1dGgvdG9rZW4tbm90LWluaXRpYWxpemVkJykgew0KICAgICAgICAgICAgICAgIGxvZygnR290IGF1dGgvdG9rZW4tbm90LWluaXRpYWxpemVkIGVycm9yLiAgVHJlYXRpbmcgYXMgbnVsbCB0b2tlbi4nKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhZGRUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7DQogICAgICAgIC8vIFRPRE86IFdlIG1pZ2h0IHdhbnQgdG8gd3JhcCB0aGUgbGlzdGVuZXIgYW5kIGNhbGwgaXQgd2l0aCBubyBhcmdzIHRvDQogICAgICAgIC8vIGF2b2lkIGEgbGVha3kgYWJzdHJhY3Rpb24sIGJ1dCB0aGF0IG1ha2VzIHJlbW92aW5nIHRoZSBsaXN0ZW5lciBoYXJkZXIuDQogICAgICAgIGlmICh0aGlzLmF1dGhfKSB7DQogICAgICAgICAgICB0aGlzLmF1dGhfLmFkZEF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aFByb3ZpZGVyXw0KICAgICAgICAgICAgICAgIC5nZXQoKQ0KICAgICAgICAgICAgICAgIC50aGVuKGF1dGggPT4gYXV0aC5hZGRBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJlbW92ZVRva2VuQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXIpIHsNCiAgICAgICAgdGhpcy5hdXRoUHJvdmlkZXJfDQogICAgICAgICAgICAuZ2V0KCkNCiAgICAgICAgICAgIC50aGVuKGF1dGggPT4gYXV0aC5yZW1vdmVBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgIH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7DQogICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSAnUHJvdmlkZWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgZm9yIHRoZSBhcHAgbmFtZWQgIicgKw0KICAgICAgICAgICAgdGhpcy5hcHBOYW1lXyArDQogICAgICAgICAgICAnIiBhcmUgaW52YWxpZC4gVGhpcyB1c3VhbGx5IGluZGljYXRlcyB5b3VyIGFwcCB3YXMgbm90ICcgKw0KICAgICAgICAgICAgJ2luaXRpYWxpemVkIGNvcnJlY3RseS4gJzsNCiAgICAgICAgaWYgKCdjcmVkZW50aWFsJyBpbiB0aGlzLmZpcmViYXNlT3B0aW9uc18pIHsNCiAgICAgICAgICAgIGVycm9yTWVzc2FnZSArPQ0KICAgICAgICAgICAgICAgICdNYWtlIHN1cmUgdGhlICJjcmVkZW50aWFsIiBwcm9wZXJ0eSBwcm92aWRlZCB0byBpbml0aWFsaXplQXBwKCkgJyArDQogICAgICAgICAgICAgICAgICAgICdpcyBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGUgc3BlY2lmaWVkICJkYXRhYmFzZVVSTCIgYW5kIGlzIGZyb20gdGhlIGNvcnJlY3QgJyArDQogICAgICAgICAgICAgICAgICAgICdwcm9qZWN0Lic7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoJ3NlcnZpY2VBY2NvdW50JyBpbiB0aGlzLmZpcmViYXNlT3B0aW9uc18pIHsNCiAgICAgICAgICAgIGVycm9yTWVzc2FnZSArPQ0KICAgICAgICAgICAgICAgICdNYWtlIHN1cmUgdGhlICJzZXJ2aWNlQWNjb3VudCIgcHJvcGVydHkgcHJvdmlkZWQgdG8gaW5pdGlhbGl6ZUFwcCgpICcgKw0KICAgICAgICAgICAgICAgICAgICAnaXMgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhlIHNwZWNpZmllZCAiZGF0YWJhc2VVUkwiIGFuZCBpcyBmcm9tIHRoZSBjb3JyZWN0ICcgKw0KICAgICAgICAgICAgICAgICAgICAncHJvamVjdC4nOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZXJyb3JNZXNzYWdlICs9DQogICAgICAgICAgICAgICAgJ01ha2Ugc3VyZSB0aGUgImFwaUtleSIgYW5kICJkYXRhYmFzZVVSTCIgcHJvcGVydGllcyBwcm92aWRlZCB0byAnICsNCiAgICAgICAgICAgICAgICAgICAgJ2luaXRpYWxpemVBcHAoKSBtYXRjaCB0aGUgdmFsdWVzIHByb3ZpZGVkIGZvciB5b3VyIGFwcCBhdCAnICsNCiAgICAgICAgICAgICAgICAgICAgJ2h0dHBzOi8vY29uc29sZS5maXJlYmFzZS5nb29nbGUuY29tLy4nOw0KICAgICAgICB9DQogICAgICAgIHdhcm4oZXJyb3JNZXNzYWdlKTsNCiAgICB9DQp9DQovKiBBdXRoVG9rZW5Qcm92aWRlciB0aGF0IHN1cHBsaWVzIGEgY29uc3RhbnQgdG9rZW4uIFVzZWQgYnkgQWRtaW4gU0RLIG9yIG1vY2tVc2VyVG9rZW4gd2l0aCBlbXVsYXRvcnMuICovDQpjbGFzcyBFbXVsYXRvclRva2VuUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKGFjY2Vzc1Rva2VuKSB7DQogICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjsNCiAgICB9DQogICAgZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSB7DQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoew0KICAgICAgICAgICAgYWNjZXNzVG9rZW46IHRoaXMuYWNjZXNzVG9rZW4NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGFkZFRva2VuQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXIpIHsNCiAgICAgICAgLy8gSW52b2tlIHRoZSBsaXN0ZW5lciBpbW1lZGlhdGVseSB0byBtYXRjaCB0aGUgYmVoYXZpb3IgaW4gRmlyZWJhc2UgQXV0aA0KICAgICAgICAvLyAoc2VlIHBhY2thZ2VzL2F1dGgvc3JjL2F1dGguanMjTDE4MDcpDQogICAgICAgIGxpc3RlbmVyKHRoaXMuYWNjZXNzVG9rZW4pOw0KICAgIH0NCiAgICByZW1vdmVUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7IH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7IH0NCn0NCi8qKiBBIHN0cmluZyB0aGF0IGlzIHRyZWF0ZWQgYXMgYW4gYWRtaW4gYWNjZXNzIHRva2VuIGJ5IHRoZSBSVERCIGVtdWxhdG9yLiBVc2VkIGJ5IEFkbWluIFNESy4gKi8NCkVtdWxhdG9yVG9rZW5Qcm92aWRlci5PV05FUiA9ICdvd25lcic7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBQUk9UT0NPTF9WRVJTSU9OID0gJzUnOw0KY29uc3QgVkVSU0lPTl9QQVJBTSA9ICd2JzsNCmNvbnN0IFRSQU5TUE9SVF9TRVNTSU9OX1BBUkFNID0gJ3MnOw0KY29uc3QgUkVGRVJFUl9QQVJBTSA9ICdyJzsNCmNvbnN0IEZPUkdFX1JFRiA9ICdmJzsNCi8vIE1hdGNoZXMgY29uc29sZS5maXJlYmFzZS5nb29nbGUuY29tLCBmaXJlYmFzZS1jb25zb2xlLSouY29ycC5nb29nbGUuY29tIGFuZA0KLy8gZmlyZWJhc2UuY29ycC5nb29nbGUuY29tDQpjb25zdCBGT1JHRV9ET01BSU5fUkUgPSAvKGNvbnNvbGVcLmZpcmViYXNlfGZpcmViYXNlLWNvbnNvbGUtXHcrXC5jb3JwfGZpcmViYXNlXC5jb3JwKVwuZ29vZ2xlXC5jb20vOw0KY29uc3QgTEFTVF9TRVNTSU9OX1BBUkFNID0gJ2xzJzsNCmNvbnN0IEFQUExJQ0FUSU9OX0lEX1BBUkFNID0gJ3AnOw0KY29uc3QgQVBQX0NIRUNLX1RPS0VOX1BBUkFNID0gJ2FjJzsNCmNvbnN0IFdFQlNPQ0tFVCA9ICd3ZWJzb2NrZXQnOw0KY29uc3QgTE9OR19QT0xMSU5HID0gJ2xvbmdfcG9sbGluZyc7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEEgY2xhc3MgdGhhdCBob2xkcyBtZXRhZGF0YSBhYm91dCBhIFJlcG8gb2JqZWN0DQogKi8NCmNsYXNzIFJlcG9JbmZvIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaG9zdCAtIEhvc3RuYW1lIHBvcnRpb24gb2YgdGhlIHVybCBmb3IgdGhlIHJlcG8NCiAgICAgKiBAcGFyYW0gc2VjdXJlIC0gV2hldGhlciBvciBub3QgdGhpcyByZXBvIGlzIGFjY2Vzc2VkIG92ZXIgc3NsDQogICAgICogQHBhcmFtIG5hbWVzcGFjZSAtIFRoZSBuYW1lc3BhY2UgcmVwcmVzZW50ZWQgYnkgdGhlIHJlcG8NCiAgICAgKiBAcGFyYW0gd2ViU29ja2V0T25seSAtIFdoZXRoZXIgdG8gcHJlZmVyIHdlYnNvY2tldHMgb3ZlciBhbGwgb3RoZXIgdHJhbnNwb3J0cyAodXNlZCBieSBOZXN0KS4NCiAgICAgKiBAcGFyYW0gbm9kZUFkbWluIC0gV2hldGhlciB0aGlzIGluc3RhbmNlIHVzZXMgQWRtaW4gU0RLIGNyZWRlbnRpYWxzDQogICAgICogQHBhcmFtIHBlcnNpc3RlbmNlS2V5IC0gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2Vzc2lvbiBwZXJzaXN0ZW5jZSBzdG9yYWdlIGtleQ0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGhvc3QsIHNlY3VyZSwgbmFtZXNwYWNlLCB3ZWJTb2NrZXRPbmx5LCBub2RlQWRtaW4gPSBmYWxzZSwgcGVyc2lzdGVuY2VLZXkgPSAnJywgaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMgPSBmYWxzZSwgaXNVc2luZ0VtdWxhdG9yID0gZmFsc2UpIHsNCiAgICAgICAgdGhpcy5zZWN1cmUgPSBzZWN1cmU7DQogICAgICAgIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlOw0KICAgICAgICB0aGlzLndlYlNvY2tldE9ubHkgPSB3ZWJTb2NrZXRPbmx5Ow0KICAgICAgICB0aGlzLm5vZGVBZG1pbiA9IG5vZGVBZG1pbjsNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IHBlcnNpc3RlbmNlS2V5Ow0KICAgICAgICB0aGlzLmluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zID0gaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXM7DQogICAgICAgIHRoaXMuaXNVc2luZ0VtdWxhdG9yID0gaXNVc2luZ0VtdWxhdG9yOw0KICAgICAgICB0aGlzLl9ob3N0ID0gaG9zdC50b0xvd2VyQ2FzZSgpOw0KICAgICAgICB0aGlzLl9kb21haW4gPSB0aGlzLl9ob3N0LnN1YnN0cih0aGlzLl9ob3N0LmluZGV4T2YoJy4nKSArIDEpOw0KICAgICAgICB0aGlzLmludGVybmFsSG9zdCA9DQogICAgICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5nZXQoJ2hvc3Q6JyArIGhvc3QpIHx8IHRoaXMuX2hvc3Q7DQogICAgfQ0KICAgIGlzQ2FjaGVhYmxlSG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxIb3N0LnN1YnN0cigwLCAyKSA9PT0gJ3MtJzsNCiAgICB9DQogICAgaXNDdXN0b21Ib3N0KCkgew0KICAgICAgICByZXR1cm4gKHRoaXMuX2RvbWFpbiAhPT0gJ2ZpcmViYXNlaW8uY29tJyAmJg0KICAgICAgICAgICAgdGhpcy5fZG9tYWluICE9PSAnZmlyZWJhc2Vpby1kZW1vLmNvbScpOw0KICAgIH0NCiAgICBnZXQgaG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2hvc3Q7DQogICAgfQ0KICAgIHNldCBob3N0KG5ld0hvc3QpIHsNCiAgICAgICAgaWYgKG5ld0hvc3QgIT09IHRoaXMuaW50ZXJuYWxIb3N0KSB7DQogICAgICAgICAgICB0aGlzLmludGVybmFsSG9zdCA9IG5ld0hvc3Q7DQogICAgICAgICAgICBpZiAodGhpcy5pc0NhY2hlYWJsZUhvc3QoKSkgew0KICAgICAgICAgICAgICAgIFBlcnNpc3RlbnRTdG9yYWdlLnNldCgnaG9zdDonICsgdGhpcy5faG9zdCwgdGhpcy5pbnRlcm5hbEhvc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICBsZXQgc3RyID0gdGhpcy50b1VSTFN0cmluZygpOw0KICAgICAgICBpZiAodGhpcy5wZXJzaXN0ZW5jZUtleSkgew0KICAgICAgICAgICAgc3RyICs9ICc8JyArIHRoaXMucGVyc2lzdGVuY2VLZXkgKyAnPic7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cjsNCiAgICB9DQogICAgdG9VUkxTdHJpbmcoKSB7DQogICAgICAgIGNvbnN0IHByb3RvY29sID0gdGhpcy5zZWN1cmUgPyAnaHR0cHM6Ly8nIDogJ2h0dHA6Ly8nOw0KICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMuaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMNCiAgICAgICAgICAgID8gYD9ucz0ke3RoaXMubmFtZXNwYWNlfWANCiAgICAgICAgICAgIDogJyc7DQogICAgICAgIHJldHVybiBgJHtwcm90b2NvbH0ke3RoaXMuaG9zdH0vJHtxdWVyeX1gOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHJlcG9JbmZvTmVlZHNRdWVyeVBhcmFtKHJlcG9JbmZvKSB7DQogICAgcmV0dXJuIChyZXBvSW5mby5ob3N0ICE9PSByZXBvSW5mby5pbnRlcm5hbEhvc3QgfHwNCiAgICAgICAgcmVwb0luZm8uaXNDdXN0b21Ib3N0KCkgfHwNCiAgICAgICAgcmVwb0luZm8uaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMpOw0KfQ0KLyoqDQogKiBSZXR1cm5zIHRoZSB3ZWJzb2NrZXQgVVJMIGZvciB0aGlzIHJlcG8NCiAqIEBwYXJhbSByZXBvSW5mbyAtIFJlcG9JbmZvIG9iamVjdA0KICogQHBhcmFtIHR5cGUgLSBvZiBjb25uZWN0aW9uDQogKiBAcGFyYW0gcGFyYW1zIC0gbGlzdA0KICogQHJldHVybnMgVGhlIFVSTCBmb3IgdGhpcyByZXBvDQogKi8NCmZ1bmN0aW9uIHJlcG9JbmZvQ29ubmVjdGlvblVSTChyZXBvSW5mbywgdHlwZSwgcGFyYW1zKSB7DQogICAgYXNzZXJ0KHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJywgJ3R5cGVvZiB0eXBlIG11c3QgPT0gc3RyaW5nJyk7DQogICAgYXNzZXJ0KHR5cGVvZiBwYXJhbXMgPT09ICdvYmplY3QnLCAndHlwZW9mIHBhcmFtcyBtdXN0ID09IG9iamVjdCcpOw0KICAgIGxldCBjb25uVVJMOw0KICAgIGlmICh0eXBlID09PSBXRUJTT0NLRVQpIHsNCiAgICAgICAgY29ublVSTCA9DQogICAgICAgICAgICAocmVwb0luZm8uc2VjdXJlID8gJ3dzczovLycgOiAnd3M6Ly8nKSArIHJlcG9JbmZvLmludGVybmFsSG9zdCArICcvLndzPyc7DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGUgPT09IExPTkdfUE9MTElORykgew0KICAgICAgICBjb25uVVJMID0NCiAgICAgICAgICAgIChyZXBvSW5mby5zZWN1cmUgPyAnaHR0cHM6Ly8nIDogJ2h0dHA6Ly8nKSArDQogICAgICAgICAgICAgICAgcmVwb0luZm8uaW50ZXJuYWxIb3N0ICsNCiAgICAgICAgICAgICAgICAnLy5scD8nOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNvbm5lY3Rpb24gdHlwZTogJyArIHR5cGUpOw0KICAgIH0NCiAgICBpZiAocmVwb0luZm9OZWVkc1F1ZXJ5UGFyYW0ocmVwb0luZm8pKSB7DQogICAgICAgIHBhcmFtc1snbnMnXSA9IHJlcG9JbmZvLm5hbWVzcGFjZTsNCiAgICB9DQogICAgY29uc3QgcGFpcnMgPSBbXTsNCiAgICBlYWNoKHBhcmFtcywgKGtleSwgdmFsdWUpID0+IHsNCiAgICAgICAgcGFpcnMucHVzaChrZXkgKyAnPScgKyB2YWx1ZSk7DQogICAgfSk7DQogICAgcmV0dXJuIGNvbm5VUkwgKyBwYWlycy5qb2luKCcmJyk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRyYWNrcyBhIGNvbGxlY3Rpb24gb2Ygc3RhdHMuDQogKi8NCmNsYXNzIFN0YXRzQ29sbGVjdGlvbiB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuY291bnRlcnNfID0ge307DQogICAgfQ0KICAgIGluY3JlbWVudENvdW50ZXIobmFtZSwgYW1vdW50ID0gMSkgew0KICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuY291bnRlcnNfLCBuYW1lKSkgew0KICAgICAgICAgICAgdGhpcy5jb3VudGVyc19bbmFtZV0gPSAwOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY291bnRlcnNfW25hbWVdICs9IGFtb3VudDsNCiAgICB9DQogICAgZ2V0KCkgew0KICAgICAgICByZXR1cm4gZGVlcENvcHkodGhpcy5jb3VudGVyc18pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGNvbGxlY3Rpb25zID0ge307DQpjb25zdCByZXBvcnRlcnMgPSB7fTsNCmZ1bmN0aW9uIHN0YXRzTWFuYWdlckdldENvbGxlY3Rpb24ocmVwb0luZm8pIHsNCiAgICBjb25zdCBoYXNoU3RyaW5nID0gcmVwb0luZm8udG9TdHJpbmcoKTsNCiAgICBpZiAoIWNvbGxlY3Rpb25zW2hhc2hTdHJpbmddKSB7DQogICAgICAgIGNvbGxlY3Rpb25zW2hhc2hTdHJpbmddID0gbmV3IFN0YXRzQ29sbGVjdGlvbigpOw0KICAgIH0NCiAgICByZXR1cm4gY29sbGVjdGlvbnNbaGFzaFN0cmluZ107DQp9DQpmdW5jdGlvbiBzdGF0c01hbmFnZXJHZXRPckNyZWF0ZVJlcG9ydGVyKHJlcG9JbmZvLCBjcmVhdG9yRnVuY3Rpb24pIHsNCiAgICBjb25zdCBoYXNoU3RyaW5nID0gcmVwb0luZm8udG9TdHJpbmcoKTsNCiAgICBpZiAoIXJlcG9ydGVyc1toYXNoU3RyaW5nXSkgew0KICAgICAgICByZXBvcnRlcnNbaGFzaFN0cmluZ10gPSBjcmVhdG9yRnVuY3Rpb24oKTsNCiAgICB9DQogICAgcmV0dXJuIHJlcG9ydGVyc1toYXNoU3RyaW5nXTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogVGhpcyBjbGFzcyBlbnN1cmVzIHRoZSBwYWNrZXRzIGZyb20gdGhlIHNlcnZlciBhcnJpdmUgaW4gb3JkZXINCiAqIFRoaXMgY2xhc3MgdGFrZXMgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgYW5kIGVuc3VyZXMgaXQgZ2V0cyBwYXNzZWQgaW50byB0aGUgY2FsbGJhY2tzIGluIG9yZGVyLg0KICovDQpjbGFzcyBQYWNrZXRSZWNlaXZlciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG9uTWVzc2FnZV8NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihvbk1lc3NhZ2VfKSB7DQogICAgICAgIHRoaXMub25NZXNzYWdlXyA9IG9uTWVzc2FnZV87DQogICAgICAgIHRoaXMucGVuZGluZ1Jlc3BvbnNlcyA9IFtdOw0KICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSA9IDA7DQogICAgICAgIHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlID0gLTE7DQogICAgICAgIHRoaXMub25DbG9zZSA9IG51bGw7DQogICAgfQ0KICAgIGNsb3NlQWZ0ZXIocmVzcG9uc2VOdW0sIGNhbGxiYWNrKSB7DQogICAgICAgIHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlID0gcmVzcG9uc2VOdW07DQogICAgICAgIHRoaXMub25DbG9zZSA9IGNhbGxiYWNrOw0KICAgICAgICBpZiAodGhpcy5jbG9zZUFmdGVyUmVzcG9uc2UgPCB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSkgew0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlKCk7DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2UgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVhY2ggbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXIgY29tZXMgd2l0aCBhIHJlc3BvbnNlIG51bWJlciwgYW5kIGFuIGFycmF5IG9mIGRhdGEuIFRoZSByZXNwb25zZU51bWJlcg0KICAgICAqIGFsbG93cyB1cyB0byBlbnN1cmUgdGhhdCB3ZSBwcm9jZXNzIHRoZW0gaW4gdGhlIHJpZ2h0IG9yZGVyLCBzaW5jZSB3ZSBjYW4ndCBiZSBndWFyYW50ZWVkIHRoYXQgYWxsDQogICAgICogYnJvd3NlcnMgd2lsbCByZXNwb25kIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSByZXF1ZXN0cyB3ZSBzZW50DQogICAgICovDQogICAgaGFuZGxlUmVzcG9uc2UocmVxdWVzdE51bSwgZGF0YSkgew0KICAgICAgICB0aGlzLnBlbmRpbmdSZXNwb25zZXNbcmVxdWVzdE51bV0gPSBkYXRhOw0KICAgICAgICB3aGlsZSAodGhpcy5wZW5kaW5nUmVzcG9uc2VzW3RoaXMuY3VycmVudFJlc3BvbnNlTnVtXSkgew0KICAgICAgICAgICAgY29uc3QgdG9Qcm9jZXNzID0gdGhpcy5wZW5kaW5nUmVzcG9uc2VzW3RoaXMuY3VycmVudFJlc3BvbnNlTnVtXTsNCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBlbmRpbmdSZXNwb25zZXNbdGhpcy5jdXJyZW50UmVzcG9uc2VOdW1dOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b1Byb2Nlc3MubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzW2ldKSB7DQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbkd1YXJkKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25NZXNzYWdlXyh0b1Byb2Nlc3NbaV0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UmVzcG9uc2VOdW0gPT09IHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlKSB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25DbG9zZSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSsrOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLy8gVVJMIHF1ZXJ5IHBhcmFtZXRlcnMgYXNzb2NpYXRlZCB3aXRoIGxvbmdwb2xsaW5nDQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9TVEFSVF9QQVJBTSA9ICdzdGFydCc7DQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9DTE9TRV9DT01NQU5EID0gJ2Nsb3NlJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0NPTU1BTkRfQ0JfTkFNRSA9ICdwTFBDb21tYW5kJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0RBVEFfQ0JfTkFNRSA9ICdwUlRMUENCJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0lEX1BBUkFNID0gJ2lkJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1BXX1BBUkFNID0gJ3B3JzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1NFUklBTF9QQVJBTSA9ICdzZXInOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfQ0FMTEJBQ0tfSURfUEFSQU0gPSAnY2InOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVF9OVU1fUEFSQU0gPSAnc2VnJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1NFR01FTlRTX0lOX1BBQ0tFVCA9ICd0cyc7DQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9EQVRBX1BBUkFNID0gJ2QnOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfRElTQ09OTl9GUkFNRV9SRVFVRVNUX1BBUkFNID0gJ2RmcmFtZSc7DQovL0RhdGEgc2l6ZSBjb25zdGFudHMuDQovL1RPRE86IFBlcmY6IHRoZSBtYXhpbXVtIGxlbmd0aCBhY3R1YWxseSBkaWZmZXJzIGZyb20gYnJvd3NlciB0byBicm93c2VyLg0KLy8gV2Ugc2hvdWxkIGNoZWNrIHdoYXQgYnJvd3NlciB3ZSdyZSBvbiBhbmQgc2V0IGFjY29yZGluZ2x5Lg0KY29uc3QgTUFYX1VSTF9EQVRBX1NJWkUgPSAxODcwOw0KY29uc3QgU0VHX0hFQURFUl9TSVpFID0gMzA7IC8vaWU6ICZzZWc9ODI5OTIzNCZ0cz05ODIzODkxMjMmZD0NCmNvbnN0IE1BWF9QQVlMT0FEX1NJWkUgPSBNQVhfVVJMX0RBVEFfU0laRSAtIFNFR19IRUFERVJfU0laRTsNCi8qKg0KICogS2VlcGFsaXZlIHBlcmlvZA0KICogc2VuZCBhIGZyZXNoIHJlcXVlc3QgYXQgbWluaW11bSBldmVyeSAyNSBzZWNvbmRzLiBPcGVyYSBoYXMgYSBtYXhpbXVtIHJlcXVlc3QNCiAqIGxlbmd0aCBvZiAzMCBzZWNvbmRzIHRoYXQgd2UgY2FuJ3QgZXhjZWVkLg0KICovDQpjb25zdCBLRUVQQUxJVkVfUkVRVUVTVF9JTlRFUlZBTCA9IDI1MDAwOw0KLyoqDQogKiBIb3cgbG9uZyB0byB3YWl0IGJlZm9yZSBhYm9ydGluZyBhIGxvbmctcG9sbGluZyBjb25uZWN0aW9uIGF0dGVtcHQuDQogKi8NCmNvbnN0IExQX0NPTk5FQ1RfVElNRU9VVCA9IDMwMDAwOw0KLyoqDQogKiBUaGlzIGNsYXNzIG1hbmFnZXMgYSBzaW5nbGUgbG9uZy1wb2xsaW5nIGNvbm5lY3Rpb24uDQogKi8NCmNsYXNzIEJyb3dzZXJQb2xsQ29ubmVjdGlvbiB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGNvbm5JZCBBbiBpZGVudGlmaWVyIGZvciB0aGlzIGNvbm5lY3Rpb24sIHVzZWQgZm9yIGxvZ2dpbmcNCiAgICAgKiBAcGFyYW0gcmVwb0luZm8gVGhlIGluZm8gZm9yIHRoZSBlbmRwb2ludCB0byBzZW5kIGRhdGEgdG8uDQogICAgICogQHBhcmFtIGFwcGxpY2F0aW9uSWQgVGhlIEZpcmViYXNlIEFwcCBJRCBmb3IgdGhpcyBwcm9qZWN0Lg0KICAgICAqIEBwYXJhbSBhcHBDaGVja1Rva2VuIFRoZSBBcHBDaGVjayB0b2tlbiBmb3IgdGhpcyBjbGllbnQuDQogICAgICogQHBhcmFtIGF1dGhUb2tlbiBUaGUgQXV0aFRva2VuIHRvIHVzZSBmb3IgdGhpcyBjb25uZWN0aW9uLg0KICAgICAqIEBwYXJhbSB0cmFuc3BvcnRTZXNzaW9uSWQgT3B0aW9uYWwgdHJhbnNwb3J0U2Vzc2lvbmlkIGlmIHdlIGFyZQ0KICAgICAqIHJlY29ubmVjdGluZyBmb3IgYW4gZXhpc3RpbmcgdHJhbnNwb3J0IHNlc3Npb24NCiAgICAgKiBAcGFyYW0gbGFzdFNlc3Npb25JZCBPcHRpb25hbCBsYXN0U2Vzc2lvbklkIGlmIHRoZSBQZXJzaXN0ZW50Q29ubmVjdGlvbiBoYXMNCiAgICAgKiBhbHJlYWR5IGNyZWF0ZWQgYSBjb25uZWN0aW9uIHByZXZpb3VzbHkNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihjb25uSWQsIHJlcG9JbmZvLCBhcHBsaWNhdGlvbklkLCBhcHBDaGVja1Rva2VuLCBhdXRoVG9rZW4sIHRyYW5zcG9ydFNlc3Npb25JZCwgbGFzdFNlc3Npb25JZCkgew0KICAgICAgICB0aGlzLmNvbm5JZCA9IGNvbm5JZDsNCiAgICAgICAgdGhpcy5yZXBvSW5mbyA9IHJlcG9JbmZvOw0KICAgICAgICB0aGlzLmFwcGxpY2F0aW9uSWQgPSBhcHBsaWNhdGlvbklkOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW4gPSBhcHBDaGVja1Rva2VuOw0KICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IGF1dGhUb2tlbjsNCiAgICAgICAgdGhpcy50cmFuc3BvcnRTZXNzaW9uSWQgPSB0cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgIHRoaXMubGFzdFNlc3Npb25JZCA9IGxhc3RTZXNzaW9uSWQ7DQogICAgICAgIHRoaXMuYnl0ZXNTZW50ID0gMDsNCiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkID0gMDsNCiAgICAgICAgdGhpcy5ldmVyQ29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmxvZ18gPSBsb2dXcmFwcGVyKGNvbm5JZCk7DQogICAgICAgIHRoaXMuc3RhdHNfID0gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvSW5mbyk7DQogICAgICAgIHRoaXMudXJsRm4gPSAocGFyYW1zKSA9PiB7DQogICAgICAgICAgICAvLyBBbHdheXMgYWRkIHRoZSB0b2tlbiBpZiB3ZSBoYXZlIG9uZS4NCiAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBwYXJhbXNbQVBQX0NIRUNLX1RPS0VOX1BBUkFNXSA9IHRoaXMuYXBwQ2hlY2tUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXBvSW5mb0Nvbm5lY3Rpb25VUkwocmVwb0luZm8sIExPTkdfUE9MTElORywgcGFyYW1zKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIG9uTWVzc2FnZSAtIENhbGxiYWNrIHdoZW4gbWVzc2FnZXMgYXJyaXZlDQogICAgICogQHBhcmFtIG9uRGlzY29ubmVjdCAtIENhbGxiYWNrIHdpdGggY29ubmVjdGlvbiBsb3N0Lg0KICAgICAqLw0KICAgIG9wZW4ob25NZXNzYWdlLCBvbkRpc2Nvbm5lY3QpIHsNCiAgICAgICAgdGhpcy5jdXJTZWdtZW50TnVtID0gMDsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gb25EaXNjb25uZWN0Ow0KICAgICAgICB0aGlzLm15UGFja2V0T3JkZXJlciA9IG5ldyBQYWNrZXRSZWNlaXZlcihvbk1lc3NhZ2UpOw0KICAgICAgICB0aGlzLmlzQ2xvc2VkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmNvbm5lY3RUaW1lb3V0VGltZXJfID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1RpbWVkIG91dCB0cnlpbmcgdG8gY29ubmVjdC4nKTsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBjbGVhciB0aGUgaG9zdCBjYWNoZQ0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTsNCiAgICAgICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBudWxsOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfSwgTWF0aC5mbG9vcihMUF9DT05ORUNUX1RJTUVPVVQpKTsNCiAgICAgICAgLy8gRW5zdXJlIHdlIGRlbGF5IHRoZSBjcmVhdGlvbiBvZiB0aGUgaWZyYW1lIHVudGlsIHRoZSBET00gaXMgbG9hZGVkLg0KICAgICAgICBleGVjdXRlV2hlbkRPTVJlYWR5KCgpID0+IHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2xvc2VkXykgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vU2V0IHVwIGEgY2FsbGJhY2sgdGhhdCBnZXRzIHRyaWdnZXJlZCBvbmNlIGEgY29ubmVjdGlvbiBpcyBzZXQgdXAuDQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlciA9IG5ldyBGaXJlYmFzZUlGcmFtZVNjcmlwdEhvbGRlcigoLi4uYXJncykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtjb21tYW5kLCBhcmcxLCBhcmcyLCBhcmczLCBhcmc0XSA9IGFyZ3M7DQogICAgICAgICAgICAgICAgdGhpcy5pbmNyZW1lbnRJbmNvbWluZ0J5dGVzXyhhcmdzKTsNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2NyaXB0VGFnSG9sZGVyKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gd2UgY2xvc2VkIHRoZSBjb25uZWN0aW9uLg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXykgew0KICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLmV2ZXJDb25uZWN0ZWRfID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBpZiAoY29tbWFuZCA9PT0gRklSRUJBU0VfTE9OR1BPTExfU1RBUlRfUEFSQU0pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCA9IGFyZzE7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBhcmcyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb21tYW5kID09PSBGSVJFQkFTRV9MT05HUE9MTF9DTE9TRV9DT01NQU5EKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGNsZWFyIHRoZSBob3N0IGNhY2hlLiBXZSBnb3QgYSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIsIHNvIHdlIGtub3cgaXQncyByZWFjaGFibGUNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZzEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGFyZW4ndCBleHBlY3RpbmcgYW55IG1vcmUgZGF0YSAob3RoZXIgdGhhbiB3aGF0IHRoZSBzZXJ2ZXIncyBhbHJlYWR5IGluIHRoZSBwcm9jZXNzIG9mIHNlbmRpbmcgdXMNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRocm91Z2ggb3VyIGFscmVhZHkgb3BlbiBwb2xscyksIHNvIGRvbid0IHNlbmQgYW55IG1vcmUuDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5zZW5kTmV3UG9sbHMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFyZzEgaW4gdGhpcyBjYXNlIGlzIHRoZSBsYXN0IHJlc3BvbnNlIG51bWJlciBzZW50IGJ5IHRoZSBzZXJ2ZXIuIFdlIHNob3VsZCB0cnkgdG8gcmVjZWl2ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxsIG9mIHRoZSByZXNwb25zZXMgdXAgdG8gdGhpcyBvbmUgYmVmb3JlIGNsb3NpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubXlQYWNrZXRPcmRlcmVyLmNsb3NlQWZ0ZXIoYXJnMSwgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5yZWNvZ25pemVkIGNvbW1hbmQgcmVjZWl2ZWQ6ICcgKyBjb21tYW5kKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCAoLi4uYXJncykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtwTiwgZGF0YV0gPSBhcmdzOw0KICAgICAgICAgICAgICAgIHRoaXMuaW5jcmVtZW50SW5jb21pbmdCeXRlc18oYXJncyk7DQogICAgICAgICAgICAgICAgdGhpcy5teVBhY2tldE9yZGVyZXIuaGFuZGxlUmVzcG9uc2UocE4sIGRhdGEpOw0KICAgICAgICAgICAgfSwgKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICB9LCB0aGlzLnVybEZuKTsNCiAgICAgICAgICAgIC8vU2VuZCB0aGUgaW5pdGlhbCByZXF1ZXN0IHRvIGNvbm5lY3QuIFRoZSBzZXJpYWwgbnVtYmVyIGlzIHNpbXBseSB0byBrZWVwIHRoZSBicm93c2VyIGZyb20gcHVsbGluZyBwcmV2aW91cyByZXN1bHRzDQogICAgICAgICAgICAvL2Zyb20gY2FjaGUuDQogICAgICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9TVEFSVF9QQVJBTV0gPSAndCc7DQogICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfU0VSSUFMX1BBUkFNXSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDAwMCk7DQogICAgICAgICAgICBpZiAodGhpcy5zY3JpcHRUYWdIb2xkZXIudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX0NBTExCQUNLX0lEX1BBUkFNXSA9DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLnVuaXF1ZUNhbGxiYWNrSWRlbnRpZmllcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVybFBhcmFtc1tWRVJTSU9OX1BBUkFNXSA9IFBST1RPQ09MX1ZFUlNJT047DQogICAgICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbVFJBTlNQT1JUX1NFU1NJT05fUEFSQU1dID0gdGhpcy50cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5sYXN0U2Vzc2lvbklkKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0xBU1RfU0VTU0lPTl9QQVJBTV0gPSB0aGlzLmxhc3RTZXNzaW9uSWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbklkKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0FQUExJQ0FUSU9OX0lEX1BBUkFNXSA9IHRoaXMuYXBwbGljYXRpb25JZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrVG9rZW4pIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbQVBQX0NIRUNLX1RPS0VOX1BBUkFNXSA9IHRoaXMuYXBwQ2hlY2tUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2YgbG9jYXRpb24gIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgICAgICAgICAgbG9jYXRpb24uaG9zdG5hbWUgJiYNCiAgICAgICAgICAgICAgICBGT1JHRV9ET01BSU5fUkUudGVzdChsb2NhdGlvbi5ob3N0bmFtZSkpIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbUkVGRVJFUl9QQVJBTV0gPSBGT1JHRV9SRUY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBjb25uZWN0VVJMID0gdGhpcy51cmxGbih1cmxQYXJhbXMpOw0KICAgICAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW5nIHZpYSBsb25nLXBvbGwgdG8gJyArIGNvbm5lY3RVUkwpOw0KICAgICAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIuYWRkVGFnKGNvbm5lY3RVUkwsICgpID0+IHsNCiAgICAgICAgICAgICAgICAvKiBkbyBub3RoaW5nICovDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbGwgdGhpcyB3aGVuIGEgaGFuZHNoYWtlIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IGFuZCB3ZSB3YW50IHRvIGNvbnNpZGVyIHRoZSBjb25uZWN0aW9uIGVzdGFibGlzaGVkDQogICAgICovDQogICAgc3RhcnQoKSB7DQogICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLnN0YXJ0TG9uZ1BvbGwodGhpcy5pZCwgdGhpcy5wYXNzd29yZCk7DQogICAgICAgIHRoaXMuYWRkRGlzY29ubmVjdFBpbmdGcmFtZSh0aGlzLmlkLCB0aGlzLnBhc3N3b3JkKTsNCiAgICB9DQogICAgLyoqDQogICAgICogRm9yY2VzIGxvbmcgcG9sbGluZyB0byBiZSBjb25zaWRlcmVkIGFzIGEgcG90ZW50aWFsIHRyYW5zcG9ydA0KICAgICAqLw0KICAgIHN0YXRpYyBmb3JjZUFsbG93KCkgew0KICAgICAgICBCcm93c2VyUG9sbENvbm5lY3Rpb24uZm9yY2VBbGxvd18gPSB0cnVlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBGb3JjZXMgbG9uZ3BvbGxpbmcgdG8gbm90IGJlIGNvbnNpZGVyZWQgYXMgYSBwb3RlbnRpYWwgdHJhbnNwb3J0DQogICAgICovDQogICAgc3RhdGljIGZvcmNlRGlzYWxsb3coKSB7DQogICAgICAgIEJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyA9IHRydWU7DQogICAgfQ0KICAgIC8vIFN0YXRpYyBtZXRob2QsIHVzZSBzdHJpbmcgbGl0ZXJhbCBzbyBpdCBjYW4gYmUgYWNjZXNzZWQgaW4gYSBnZW5lcmljIHdheQ0KICAgIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgaWYgKEJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZUFsbG93Xykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBOT1RFOiBJbiBSZWFjdC1OYXRpdmUgdGhlcmUncyBub3JtYWxseSBubyAnZG9jdW1lbnQnLCBidXQgaWYgeW91IGRlYnVnIGEgUmVhY3QtTmF0aXZlIGFwcCBpbg0KICAgICAgICAgICAgLy8gdGhlIENocm9tZSBkZWJ1Z2dlciwgJ2RvY3VtZW50JyBpcyBkZWZpbmVkLCBidXQgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyBudWxsICgyMDE1LzA2LzA4KS4NCiAgICAgICAgICAgIHJldHVybiAoIUJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyAmJg0KICAgICAgICAgICAgICAgIHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9IG51bGwgJiYNCiAgICAgICAgICAgICAgICAhaXNDaHJvbWVFeHRlbnNpb25Db250ZW50U2NyaXB0KCkgJiYNCiAgICAgICAgICAgICAgICAhaXNXaW5kb3dzU3RvcmVBcHAoKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogTm8tb3AgZm9yIHBvbGxpbmcNCiAgICAgKi8NCiAgICBtYXJrQ29ubmVjdGlvbkhlYWx0aHkoKSB7IH0NCiAgICAvKioNCiAgICAgKiBTdG9wcyBwb2xsaW5nIGFuZCBjbGVhbnMgdXAgdGhlIGlmcmFtZQ0KICAgICAqLw0KICAgIHNodXRkb3duXygpIHsNCiAgICAgICAgdGhpcy5pc0Nsb3NlZF8gPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5zY3JpcHRUYWdIb2xkZXIpIHsNCiAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLmNsb3NlKCk7DQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlciA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgLy9yZW1vdmUgdGhlIGRpc2Nvbm5lY3QgZnJhbWUsIHdoaWNoIHdpbGwgdHJpZ2dlciBhbiBYSFIgY2FsbCB0byB0aGUgc2VydmVyIHRvIHRlbGwgaXQgd2UncmUgbGVhdmluZy4NCiAgICAgICAgaWYgKHRoaXMubXlEaXNjb25uRnJhbWUpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5teURpc2Nvbm5GcmFtZSk7DQogICAgICAgICAgICB0aGlzLm15RGlzY29ubkZyYW1lID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXykgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8pOw0KICAgICAgICAgICAgdGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyA9IG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogVHJpZ2dlcmVkIHdoZW4gdGhpcyB0cmFuc3BvcnQgaXMgY2xvc2VkDQogICAgICovDQogICAgb25DbG9zZWRfKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0xvbmdwb2xsIGlzIGNsb3NpbmcgaXRzZWxmJyk7DQogICAgICAgICAgICB0aGlzLnNodXRkb3duXygpOw0KICAgICAgICAgICAgaWYgKHRoaXMub25EaXNjb25uZWN0Xykgew0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0Xyh0aGlzLmV2ZXJDb25uZWN0ZWRfKTsNCiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4dGVybmFsLWZhY2luZyBjbG9zZSBoYW5kbGVyLiBSZWFsVGltZSBoYXMgcmVxdWVzdGVkIHdlIHNodXQgZG93bi4gS2lsbCBvdXIgY29ubmVjdGlvbiBhbmQgdGVsbCB0aGUgc2VydmVyDQogICAgICogdGhhdCB3ZSd2ZSBsZWZ0Lg0KICAgICAqLw0KICAgIGNsb3NlKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0xvbmdwb2xsIGlzIGJlaW5nIGNsb3NlZC4nKTsNCiAgICAgICAgICAgIHRoaXMuc2h1dGRvd25fKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogU2VuZCB0aGUgSlNPTiBvYmplY3QgZG93biB0byB0aGUgc2VydmVyLiBJdCB3aWxsIG5lZWQgdG8gYmUgc3RyaW5naWZpZWQsIGJhc2U2NCBlbmNvZGVkLCBhbmQgdGhlbg0KICAgICAqIGJyb2tlbiBpbnRvIGNodW5rcyAoc2luY2UgVVJMcyBoYXZlIGEgc21hbGwgbWF4aW11bSBsZW5ndGgpLg0KICAgICAqIEBwYXJhbSBkYXRhIC0gVGhlIEpTT04gZGF0YSB0byB0cmFuc21pdC4NCiAgICAgKi8NCiAgICBzZW5kKGRhdGEpIHsNCiAgICAgICAgY29uc3QgZGF0YVN0ciA9IHN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgdGhpcy5ieXRlc1NlbnQgKz0gZGF0YVN0ci5sZW5ndGg7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3NlbnQnLCBkYXRhU3RyLmxlbmd0aCk7DQogICAgICAgIC8vZmlyc3QsIGxldHMgZ2V0IHRoZSBiYXNlNjQtZW5jb2RlZCBkYXRhDQogICAgICAgIGNvbnN0IGJhc2U2NGRhdGEgPSBiYXNlNjRFbmNvZGUoZGF0YVN0cik7DQogICAgICAgIC8vV2UgY2FuIG9ubHkgZml0IGEgY2VydGFpbiBhbW91bnQgaW4gZWFjaCBVUkwsIHNvIHdlIG5lZWQgdG8gc3BsaXQgdGhpcyByZXF1ZXN0DQogICAgICAgIC8vdXAgaW50byBtdWx0aXBsZSBwaWVjZXMgaWYgaXQgZG9lc24ndCBmaXQgaW4gb25lIHJlcXVlc3QuDQogICAgICAgIGNvbnN0IGRhdGFTZWdzID0gc3BsaXRTdHJpbmdCeVNpemUoYmFzZTY0ZGF0YSwgTUFYX1BBWUxPQURfU0laRSk7DQogICAgICAgIC8vRW5xdWV1ZSBlYWNoIHNlZ21lbnQgZm9yIHRyYW5zbWlzc2lvbi4gV2UgYXNzaWduIGVhY2ggY2h1bmsgYSBzZXF1ZW50aWFsIElEIGFuZCBhIHRvdGFsIG51bWJlcg0KICAgICAgICAvL29mIHNlZ21lbnRzIHNvIHRoYXQgd2UgY2FuIHJlYXNzZW1ibGUgdGhlIHBhY2tldCBvbiB0aGUgc2VydmVyLg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFTZWdzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5lbnF1ZXVlU2VnbWVudCh0aGlzLmN1clNlZ21lbnROdW0sIGRhdGFTZWdzLmxlbmd0aCwgZGF0YVNlZ3NbaV0pOw0KICAgICAgICAgICAgdGhpcy5jdXJTZWdtZW50TnVtKys7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogVGhpcyBpcyBob3cgd2Ugbm90aWZ5IHRoZSBzZXJ2ZXIgdGhhdCB3ZSdyZSBsZWF2aW5nLg0KICAgICAqIFdlIGFyZW4ndCBhYmxlIHRvIHNlbmQgcmVxdWVzdHMgd2l0aCBESFRNTCBvbiBhIHdpbmRvdyBjbG9zZSBldmVudCwgYnV0IHdlIGNhbg0KICAgICAqIHRyaWdnZXIgWEhSIHJlcXVlc3RzIGluIHNvbWUgYnJvd3NlcnMgKGV2ZXJ5dGhpbmcgYnV0IE9wZXJhIGJhc2ljYWxseSkuDQogICAgICovDQogICAgYWRkRGlzY29ubmVjdFBpbmdGcmFtZShpZCwgcHcpIHsNCiAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOw0KICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX0RJU0NPTk5fRlJBTUVfUkVRVUVTVF9QQVJBTV0gPSAndCc7DQogICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9JRF9QQVJBTV0gPSBpZDsNCiAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX1BXX1BBUkFNXSA9IHB3Ow0KICAgICAgICB0aGlzLm15RGlzY29ubkZyYW1lLnNyYyA9IHRoaXMudXJsRm4odXJsUGFyYW1zKTsNCiAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubXlEaXNjb25uRnJhbWUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIHRyYWNrIHRoZSBieXRlcyByZWNlaXZlZCBieSB0aGlzIGNsaWVudA0KICAgICAqLw0KICAgIGluY3JlbWVudEluY29taW5nQnl0ZXNfKGFyZ3MpIHsNCiAgICAgICAgLy8gVE9ETzogVGhpcyBpcyBhbiBhbm5veWluZyBwZXJmIGhpdCBqdXN0IHRvIHRyYWNrIHRoZSBudW1iZXIgb2YgaW5jb21pbmcgYnl0ZXMuICBNYXliZSBpdCBzaG91bGQgYmUgb3B0LWluLg0KICAgICAgICBjb25zdCBieXRlc1JlY2VpdmVkID0gc3RyaW5naWZ5KGFyZ3MpLmxlbmd0aDsNCiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkICs9IGJ5dGVzUmVjZWl2ZWQ7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3JlY2VpdmVkJywgYnl0ZXNSZWNlaXZlZCk7DQogICAgfQ0KfQ0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogQSB3cmFwcGVyIGFyb3VuZCBhbiBpZnJhbWUgdGhhdCBpcyB1c2VkIGFzIGEgbG9uZy1wb2xsaW5nIHNjcmlwdCBob2xkZXIuDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KY2xhc3MgRmlyZWJhc2VJRnJhbWVTY3JpcHRIb2xkZXIgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBjb21tYW5kQ0IgLSBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gY29udHJvbCBjb21tYW5kcyBhcmUgcmVjZXZpZWQgZnJvbSB0aGUgc2VydmVyLg0KICAgICAqIEBwYXJhbSBvbk1lc3NhZ2VDQiAtIFRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiByZXNwb25zZXMgYXJyaXZlIGZyb20gdGhlIHNlcnZlci4NCiAgICAgKiBAcGFyYW0gb25EaXNjb25uZWN0IC0gVGhlIGNhbGxiYWNrIHRvIGJlIHRyaWdnZXJlZCB3aGVuIHRoaXMgdGFnIGhvbGRlciBpcyBjbG9zZWQNCiAgICAgKiBAcGFyYW0gdXJsRm4gLSBBIGZ1bmN0aW9uIHRoYXQgcHJvdmlkZXMgdGhlIFVSTCBvZiB0aGUgZW5kcG9pbnQgdG8gc2VuZCBkYXRhIHRvLg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGNvbW1hbmRDQiwgb25NZXNzYWdlQ0IsIG9uRGlzY29ubmVjdCwgdXJsRm4pIHsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3QgPSBvbkRpc2Nvbm5lY3Q7DQogICAgICAgIHRoaXMudXJsRm4gPSB1cmxGbjsNCiAgICAgICAgLy9XZSBtYWludGFpbiBhIGNvdW50IG9mIGFsbCBvZiB0aGUgb3V0c3RhbmRpbmcgcmVxdWVzdHMsIGJlY2F1c2UgaWYgd2UgaGF2ZSB0b28gbWFueSBhY3RpdmUgYXQgb25jZSBpdCBjYW4gY2F1c2UNCiAgICAgICAgLy9wcm9ibGVtcyBpbiBzb21lIGJyb3dzZXJzLg0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUmVxdWVzdHMgPSBuZXcgU2V0KCk7DQogICAgICAgIC8vQSBxdWV1ZSBvZiB0aGUgcGVuZGluZyBzZWdtZW50cyB3YWl0aW5nIGZvciB0cmFuc21pc3Npb24gdG8gdGhlIHNlcnZlci4NCiAgICAgICAgdGhpcy5wZW5kaW5nU2VncyA9IFtdOw0KICAgICAgICAvL0Egc2VyaWFsIG51bWJlci4gV2UgdXNlIHRoaXMgZm9yIHR3byB0aGluZ3M6DQogICAgICAgIC8vIDEpIEEgd2F5IHRvIGVuc3VyZSB0aGUgYnJvd3NlciBkb2Vzbid0IGNhY2hlIHJlc3BvbnNlcyB0byBwb2xscw0KICAgICAgICAvLyAyKSBBIHdheSB0byBtYWtlIHRoZSBzZXJ2ZXIgYXdhcmUgd2hlbiBsb25nLXBvbGxzIGFycml2ZSBpbiBhIGRpZmZlcmVudCBvcmRlciB0aGFuIHdlIHN0YXJ0ZWQgdGhlbS4gVGhlDQogICAgICAgIC8vICAgIHNlcnZlciBuZWVkcyB0byByZWxlYXNlIGJvdGggcG9sbHMgaW4gdGhpcyBjYXNlIG9yIGl0IHdpbGwgY2F1c2UgcHJvYmxlbXMgaW4gT3BlcmEgc2luY2UgT3BlcmEgY2FuIG9ubHkgZXhlY3V0ZQ0KICAgICAgICAvLyAgICBKU09OUCBjb2RlIGluIHRoZSBvcmRlciBpdCB3YXMgYWRkZWQgdG8gdGhlIGlmcmFtZS4NCiAgICAgICAgdGhpcy5jdXJyZW50U2VyaWFsID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKTsNCiAgICAgICAgLy8gVGhpcyBnZXRzIHNldCB0byBmYWxzZSB3aGVuIHdlJ3JlICJjbG9zaW5nIGRvd24iIHRoZSBjb25uZWN0aW9uIChlLmcuIHdlJ3JlIHN3aXRjaGluZyB0cmFuc3BvcnRzIGJ1dCB0aGVyZSdzIHN0aWxsDQogICAgICAgIC8vIGluY29taW5nIGRhdGEgZnJvbSB0aGUgc2VydmVyIHRoYXQgd2UncmUgd2FpdGluZyBmb3IpLg0KICAgICAgICB0aGlzLnNlbmROZXdQb2xscyA9IHRydWU7DQogICAgICAgIHsNCiAgICAgICAgICAgIC8vRWFjaCBzY3JpcHQgaG9sZGVyIHJlZ2lzdGVycyBhIGNvdXBsZSBvZiB1bmlxdWVseSBuYW1lZCBjYWxsYmFja3Mgd2l0aCB0aGUgd2luZG93LiBUaGVzZSBhcmUgY2FsbGVkIGZyb20gdGhlDQogICAgICAgICAgICAvL2lmcmFtZXMgd2hlcmUgd2UgcHV0IHRoZSBsb25nLXBvbGxpbmcgc2NyaXB0IHRhZ3MuIFdlIGhhdmUgdHdvIGNhbGxiYWNrczoNCiAgICAgICAgICAgIC8vICAgMSkgQ29tbWFuZCBDYWxsYmFjayAtIFRyaWdnZXJlZCBmb3IgY29udHJvbCBpc3N1ZXMsIGxpa2Ugc3RhcnRpbmcgYSBjb25uZWN0aW9uLg0KICAgICAgICAgICAgLy8gICAyKSBNZXNzYWdlIENhbGxiYWNrIC0gVHJpZ2dlcmVkIHdoZW4gbmV3IGRhdGEgYXJyaXZlcy4NCiAgICAgICAgICAgIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyID0gTFVJREdlbmVyYXRvcigpOw0KICAgICAgICAgICAgd2luZG93W0ZJUkVCQVNFX0xPTkdQT0xMX0NPTU1BTkRfQ0JfTkFNRSArIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyXSA9IGNvbW1hbmRDQjsNCiAgICAgICAgICAgIHdpbmRvd1tGSVJFQkFTRV9MT05HUE9MTF9EQVRBX0NCX05BTUUgKyB0aGlzLnVuaXF1ZUNhbGxiYWNrSWRlbnRpZmllcl0gPQ0KICAgICAgICAgICAgICAgIG9uTWVzc2FnZUNCOw0KICAgICAgICAgICAgLy9DcmVhdGUgYW4gaWZyYW1lIGZvciB1cyB0byBhZGQgc2NyaXB0IHRhZ3MgdG8uDQogICAgICAgICAgICB0aGlzLm15SUZyYW1lID0gRmlyZWJhc2VJRnJhbWVTY3JpcHRIb2xkZXIuY3JlYXRlSUZyYW1lXygpOw0KICAgICAgICAgICAgLy8gU2V0IHRoZSBpZnJhbWUncyBjb250ZW50cy4NCiAgICAgICAgICAgIGxldCBzY3JpcHQgPSAnJzsNCiAgICAgICAgICAgIC8vIGlmIHdlIHNldCBhIGphdmFzY3JpcHQgdXJsLCBpdCdzIElFIGFuZCB3ZSBuZWVkIHRvIHNldCB0aGUgZG9jdW1lbnQgZG9tYWluLiBUaGUgamF2YXNjcmlwdCB1cmwgaXMgc3VmZmljaWVudA0KICAgICAgICAgICAgLy8gZm9yIGllOSwgYnV0IGllOCBuZWVkcyB0byBkbyBpdCBhZ2FpbiBpbiB0aGUgZG9jdW1lbnQgaXRzZWxmLg0KICAgICAgICAgICAgaWYgKHRoaXMubXlJRnJhbWUuc3JjICYmDQogICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5zcmMuc3Vic3RyKDAsICdqYXZhc2NyaXB0OicubGVuZ3RoKSA9PT0gJ2phdmFzY3JpcHQ6Jykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREb21haW4gPSBkb2N1bWVudC5kb21haW47DQogICAgICAgICAgICAgICAgc2NyaXB0ID0gJzxzY3JpcHQ+ZG9jdW1lbnQuZG9tYWluPSInICsgY3VycmVudERvbWFpbiArICciOzwvc2NyaXB0Pic7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBpZnJhbWVDb250ZW50cyA9ICc8aHRtbD48Ym9keT4nICsgc2NyaXB0ICsgJzwvYm9keT48L2h0bWw+JzsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2Mub3BlbigpOw0KICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLndyaXRlKGlmcmFtZUNvbnRlbnRzKTsNCiAgICAgICAgICAgICAgICB0aGlzLm15SUZyYW1lLmRvYy5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBsb2coJ2ZyYW1lIHdyaXRpbmcgZXhjZXB0aW9uJyk7DQogICAgICAgICAgICAgICAgaWYgKGUuc3RhY2spIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nKGUuc3RhY2spOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsb2coZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogRWFjaCBicm93c2VyIGhhcyBpdHMgb3duIGZ1bm55IHdheSB0byBoYW5kbGUgaWZyYW1lcy4gSGVyZSB3ZSBtdXNoIHRoZW0gYWxsIHRvZ2V0aGVyIGludG8gb25lIG9iamVjdCB0aGF0IEkgY2FuDQogICAgICogYWN0dWFsbHkgdXNlLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVhdGVJRnJhbWVfKCkgew0KICAgICAgICBjb25zdCBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsNCiAgICAgICAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGluIG9yZGVyIHRvIGluaXRpYWxpemUgdGhlIGRvY3VtZW50IGluc2lkZSB0aGUgaWZyYW1lDQogICAgICAgIGlmIChkb2N1bWVudC5ib2R5KSB7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIElmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBtb2RpZmllZCBpbiBJRSwgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yLCBhbmQgd2UgbmVlZCB0byBzZXQgdGhlDQogICAgICAgICAgICAgICAgLy8gZG9tYWluIG9mIHRoZSBpZnJhbWUncyBkb2N1bWVudCBtYW51YWxseS4gV2UgY2FuIGRvIHRoaXMgdmlhIGEgamF2YXNjcmlwdDogdXJsIGFzIHRoZSBzcmMgYXR0cmlidXRlDQogICAgICAgICAgICAgICAgLy8gQWxzbyBub3RlIHRoYXQgd2UgbXVzdCBkbyB0aGlzICphZnRlciogdGhlIGlmcmFtZSBoYXMgYmVlbiBhcHBlbmRlZCB0byB0aGUgcGFnZS4gT3RoZXJ3aXNlIGl0IGRvZXNuJ3Qgd29yay4NCiAgICAgICAgICAgICAgICBjb25zdCBhID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgaWYgKCFhKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEFwb2xvZ2llcyBmb3IgdGhlIGxvZy1zcGFtLCBJIG5lZWQgdG8gZG8gc29tZXRoaW5nIHRvIGtlZXAgY2xvc3VyZSBmcm9tIG9wdGltaXppbmcgb3V0IHRoZSBhc3NpZ25tZW50IGFib3ZlLg0KICAgICAgICAgICAgICAgICAgICBsb2coJ05vIElFIGRvbWFpbiBzZXR0aW5nIHJlcXVpcmVkJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBkb21haW4gPSBkb2N1bWVudC5kb21haW47DQogICAgICAgICAgICAgICAgaWZyYW1lLnNyYyA9DQogICAgICAgICAgICAgICAgICAgICJqYXZhc2NyaXB0OnZvaWQoKGZ1bmN0aW9uKCl7ZG9jdW1lbnQub3BlbigpO2RvY3VtZW50LmRvbWFpbj0nIiArDQogICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gKw0KICAgICAgICAgICAgICAgICAgICAgICAgIic7ZG9jdW1lbnQuY2xvc2UoKTt9KSgpKSI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBMb25nUG9sbENvbm5lY3Rpb24gYXR0ZW1wdHMgdG8gZGVsYXkgaW5pdGlhbGl6YXRpb24gdW50aWwgdGhlIGRvY3VtZW50IGlzIHJlYWR5LCBzbyBob3BlZnVsbHkgdGhpcw0KICAgICAgICAgICAgLy8gbmV2ZXIgZ2V0cyBoaXQuDQogICAgICAgICAgICB0aHJvdyAnRG9jdW1lbnQgYm9keSBoYXMgbm90IGluaXRpYWxpemVkLiBXYWl0IHRvIGluaXRpYWxpemUgRmlyZWJhc2UgdW50aWwgYWZ0ZXIgdGhlIGRvY3VtZW50IGlzIHJlYWR5Lic7DQogICAgICAgIH0NCiAgICAgICAgLy8gR2V0IHRoZSBkb2N1bWVudCBvZiB0aGUgaWZyYW1lIGluIGEgYnJvd3Nlci1zcGVjaWZpYyB3YXkuDQogICAgICAgIGlmIChpZnJhbWUuY29udGVudERvY3VtZW50KSB7DQogICAgICAgICAgICBpZnJhbWUuZG9jID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudDsgLy8gRmlyZWZveCwgT3BlcmEsIFNhZmFyaQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGlmcmFtZS5jb250ZW50V2luZG93KSB7DQogICAgICAgICAgICBpZnJhbWUuZG9jID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7IC8vIEludGVybmV0IEV4cGxvcmVyDQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGlmcmFtZS5kb2N1bWVudCkgew0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIGlmcmFtZS5kb2MgPSBpZnJhbWUuZG9jdW1lbnQ7IC8vb3RoZXJzPw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpZnJhbWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbmNlbCBhbGwgb3V0c3RhbmRpbmcgcXVlcmllcyBhbmQgcmVtb3ZlIHRoZSBmcmFtZS4NCiAgICAgKi8NCiAgICBjbG9zZSgpIHsNCiAgICAgICAgLy9NYXJrIHRoaXMgaWZyYW1lIGFzIGRlYWQsIHNvIG5vIG5ldyByZXF1ZXN0cyBhcmUgc2VudC4NCiAgICAgICAgdGhpcy5hbGl2ZSA9IGZhbHNlOw0KICAgICAgICBpZiAodGhpcy5teUlGcmFtZSkgew0KICAgICAgICAgICAgLy9XZSBoYXZlIHRvIGFjdHVhbGx5IHJlbW92ZSBhbGwgb2YgdGhlIGh0bWwgaW5zaWRlIHRoaXMgaWZyYW1lIGJlZm9yZSByZW1vdmluZyBpdCBmcm9tIHRoZQ0KICAgICAgICAgICAgLy93aW5kb3csIG9yIElFIHdpbGwgY29udGludWUgbG9hZGluZyBhbmQgZXhlY3V0aW5nIHRoZSBzY3JpcHQgdGFncyB3ZSd2ZSBhbHJlYWR5IGFkZGVkLCB3aGljaA0KICAgICAgICAgICAgLy9jYW4gbGVhZCB0byBzb21lIGVycm9ycyBiZWluZyB0aHJvd24uIFNldHRpbmcgdGV4dENvbnRlbnQgc2VlbXMgdG8gYmUgdGhlIHNhZmVzdCB3YXkgdG8gZG8gdGhpcy4NCiAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLmJvZHkudGV4dENvbnRlbnQgPSAnJzsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLm15SUZyYW1lICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5teUlGcmFtZSk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoMCkpOw0KICAgICAgICB9DQogICAgICAgIC8vIFByb3RlY3QgZnJvbSBiZWluZyBjYWxsZWQgcmVjdXJzaXZlbHkuDQogICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMub25EaXNjb25uZWN0Ow0KICAgICAgICBpZiAob25EaXNjb25uZWN0KSB7DQogICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdCA9IG51bGw7DQogICAgICAgICAgICBvbkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBY3R1YWxseSBzdGFydCB0aGUgbG9uZy1wb2xsaW5nIHNlc3Npb24gYnkgYWRkaW5nIHRoZSBmaXJzdCBzY3JpcHQgdGFnKHMpIHRvIHRoZSBpZnJhbWUuDQogICAgICogQHBhcmFtIGlkIC0gVGhlIElEIG9mIHRoaXMgY29ubmVjdGlvbg0KICAgICAqIEBwYXJhbSBwdyAtIFRoZSBwYXNzd29yZCBmb3IgdGhpcyBjb25uZWN0aW9uDQogICAgICovDQogICAgc3RhcnRMb25nUG9sbChpZCwgcHcpIHsNCiAgICAgICAgdGhpcy5teUlEID0gaWQ7DQogICAgICAgIHRoaXMubXlQVyA9IHB3Ow0KICAgICAgICB0aGlzLmFsaXZlID0gdHJ1ZTsNCiAgICAgICAgLy9zZW5kIHRoZSBpbml0aWFsIHJlcXVlc3QuIElmIHRoZXJlIGFyZSByZXF1ZXN0cyBxdWV1ZWQsIG1ha2Ugc3VyZSB0aGF0IHdlIHRyYW5zbWl0IGFzIG1hbnkgYXMgd2UgYXJlIGN1cnJlbnRseSBhYmxlIHRvLg0KICAgICAgICB3aGlsZSAodGhpcy5uZXdSZXF1ZXN0XygpKSB7IH0NCiAgICB9DQogICAgLyoqDQogICAgICogVGhpcyBpcyBjYWxsZWQgYW55IHRpbWUgc29tZW9uZSBtaWdodCB3YW50IGEgc2NyaXB0IHRhZyB0byBiZSBhZGRlZC4gSXQgYWRkcyBhIHNjcmlwdCB0YWcgd2hlbiB0aGVyZSBhcmVuJ3QNCiAgICAgKiB0b28gbWFueSBvdXRzdGFuZGluZyByZXF1ZXN0cyBhbmQgd2UgYXJlIHN0aWxsIGFsaXZlLg0KICAgICAqDQogICAgICogSWYgdGhlcmUgYXJlIG91dHN0YW5kaW5nIHBhY2tldCBzZWdtZW50cyB0byBzZW5kLCBpdCBzZW5kcyBvbmUuIElmIHRoZXJlIGFyZW4ndCwgaXQgc2VuZHMgYSBsb25nLXBvbGwgYW55d2F5cyBpZg0KICAgICAqIG5lZWRlZC4NCiAgICAgKi8NCiAgICBuZXdSZXF1ZXN0XygpIHsNCiAgICAgICAgLy8gV2Uga2VlcCBvbmUgb3V0c3RhbmRpbmcgcmVxdWVzdCBvcGVuIGFsbCB0aGUgdGltZSB0byByZWNlaXZlIGRhdGEsIGJ1dCBpZiB3ZSBuZWVkIHRvIHNlbmQgZGF0YQ0KICAgICAgICAvLyAocGVuZGluZ1NlZ3MubGVuZ3RoID4gMCkgdGhlbiB3ZSBjcmVhdGUgYSBuZXcgcmVxdWVzdCB0byBzZW5kIHRoZSBkYXRhLiAgVGhlIHNlcnZlciB3aWxsIGF1dG9tYXRpY2FsbHkNCiAgICAgICAgLy8gY2xvc2UgdGhlIG9sZCByZXF1ZXN0Lg0KICAgICAgICBpZiAodGhpcy5hbGl2ZSAmJg0KICAgICAgICAgICAgdGhpcy5zZW5kTmV3UG9sbHMgJiYNCiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdSZXF1ZXN0cy5zaXplIDwgKHRoaXMucGVuZGluZ1NlZ3MubGVuZ3RoID4gMCA/IDIgOiAxKSkgew0KICAgICAgICAgICAgLy9jb25zdHJ1Y3Qgb3VyIHVybA0KICAgICAgICAgICAgdGhpcy5jdXJyZW50U2VyaWFsKys7DQogICAgICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9JRF9QQVJBTV0gPSB0aGlzLm15SUQ7DQogICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfUFdfUEFSQU1dID0gdGhpcy5teVBXOw0KICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX1NFUklBTF9QQVJBTV0gPSB0aGlzLmN1cnJlbnRTZXJpYWw7DQogICAgICAgICAgICBsZXQgdGhlVVJMID0gdGhpcy51cmxGbih1cmxQYXJhbXMpOw0KICAgICAgICAgICAgLy9Ob3cgYWRkIGFzIG11Y2ggZGF0YSBhcyB3ZSBjYW4uDQogICAgICAgICAgICBsZXQgY3VyRGF0YVN0cmluZyA9ICcnOw0KICAgICAgICAgICAgbGV0IGkgPSAwOw0KICAgICAgICAgICAgd2hpbGUgKHRoaXMucGVuZGluZ1NlZ3MubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIC8vZmlyc3QsIGxldHMgc2VlIGlmIHRoZSBuZXh0IHNlZ21lbnQgd2lsbCBmaXQuDQogICAgICAgICAgICAgICAgY29uc3QgbmV4dFNlZyA9IHRoaXMucGVuZGluZ1NlZ3NbMF07DQogICAgICAgICAgICAgICAgaWYgKG5leHRTZWcuZC5sZW5ndGggKw0KICAgICAgICAgICAgICAgICAgICBTRUdfSEVBREVSX1NJWkUgKw0KICAgICAgICAgICAgICAgICAgICBjdXJEYXRhU3RyaW5nLmxlbmd0aCA8PQ0KICAgICAgICAgICAgICAgICAgICBNQVhfVVJMX0RBVEFfU0laRSkgew0KICAgICAgICAgICAgICAgICAgICAvL2dyZWF0LCB0aGUgc2VnbWVudCB3aWxsIGZpdC4gTGV0cyBhcHBlbmQgaXQuDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoZVNlZyA9IHRoaXMucGVuZGluZ1NlZ3Muc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgY3VyRGF0YVN0cmluZyA9DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJEYXRhU3RyaW5nICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZJUkVCQVNFX0xPTkdQT0xMX1NFR01FTlRfTlVNX1BBUkFNICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy5zZWcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVFNfSU5fUEFDS0VUICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy50cyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJyYnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGSVJFQkFTRV9MT05HUE9MTF9EQVRBX1BBUkFNICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy5kOw0KICAgICAgICAgICAgICAgICAgICBpKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGVVUkwgPSB0aGVVUkwgKyBjdXJEYXRhU3RyaW5nOw0KICAgICAgICAgICAgdGhpcy5hZGRMb25nUG9sbFRhZ18odGhlVVJMLCB0aGlzLmN1cnJlbnRTZXJpYWwpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUXVldWUgYSBwYWNrZXQgZm9yIHRyYW5zbWlzc2lvbiB0byB0aGUgc2VydmVyLg0KICAgICAqIEBwYXJhbSBzZWdudW0gLSBBIHNlcXVlbnRpYWwgaWQgZm9yIHRoaXMgcGFja2V0IHNlZ21lbnQgdXNlZCBmb3IgcmVhc3NlbWJseQ0KICAgICAqIEBwYXJhbSB0b3RhbHNlZ3MgLSBUaGUgdG90YWwgbnVtYmVyIG9mIHNlZ21lbnRzIGluIHRoaXMgcGFja2V0DQogICAgICogQHBhcmFtIGRhdGEgLSBUaGUgZGF0YSBmb3IgdGhpcyBzZWdtZW50Lg0KICAgICAqLw0KICAgIGVucXVldWVTZWdtZW50KHNlZ251bSwgdG90YWxzZWdzLCBkYXRhKSB7DQogICAgICAgIC8vYWRkIHRoaXMgdG8gdGhlIHF1ZXVlIG9mIHNlZ21lbnRzIHRvIHNlbmQuDQogICAgICAgIHRoaXMucGVuZGluZ1NlZ3MucHVzaCh7IHNlZzogc2VnbnVtLCB0czogdG90YWxzZWdzLCBkOiBkYXRhIH0pOw0KICAgICAgICAvL3NlbmQgdGhlIGRhdGEgaW1tZWRpYXRlbHkgaWYgdGhlcmUgaXNuJ3QgYWxyZWFkeSBkYXRhIGJlaW5nIHRyYW5zbWl0dGVkLCB1bmxlc3MNCiAgICAgICAgLy9zdGFydExvbmdQb2xsIGhhc24ndCBiZWVuIGNhbGxlZCB5ZXQuDQogICAgICAgIGlmICh0aGlzLmFsaXZlKSB7DQogICAgICAgICAgICB0aGlzLm5ld1JlcXVlc3RfKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQWRkIGEgc2NyaXB0IHRhZyBmb3IgYSByZWd1bGFyIGxvbmctcG9sbCByZXF1ZXN0Lg0KICAgICAqIEBwYXJhbSB1cmwgLSBUaGUgVVJMIG9mIHRoZSBzY3JpcHQgdGFnLg0KICAgICAqIEBwYXJhbSBzZXJpYWwgLSBUaGUgc2VyaWFsIG51bWJlciBvZiB0aGUgcmVxdWVzdC4NCiAgICAgKi8NCiAgICBhZGRMb25nUG9sbFRhZ18odXJsLCBzZXJpYWwpIHsNCiAgICAgICAgLy9yZW1lbWJlciB0aGF0IHdlIHNlbnQgdGhpcyByZXF1ZXN0Lg0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUmVxdWVzdHMuYWRkKHNlcmlhbCk7DQogICAgICAgIGNvbnN0IGRvTmV3UmVxdWVzdCA9ICgpID0+IHsNCiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdSZXF1ZXN0cy5kZWxldGUoc2VyaWFsKTsNCiAgICAgICAgICAgIHRoaXMubmV3UmVxdWVzdF8oKTsNCiAgICAgICAgfTsNCiAgICAgICAgLy8gSWYgdGhpcyByZXF1ZXN0IGRvZXNuJ3QgcmV0dXJuIG9uIGl0cyBvd24gYWNjb3JkIChieSB0aGUgc2VydmVyIHNlbmRpbmcgdXMgc29tZSBkYXRhKSwgd2UnbGwNCiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IG9uZSBhZnRlciB0aGUgS0VFUEFMSVZFIGludGVydmFsIHRvIG1ha2Ugc3VyZSB3ZSBhbHdheXMga2VlcCBhIGZyZXNoIHJlcXVlc3Qgb3Blbi4NCiAgICAgICAgY29uc3Qga2VlcGFsaXZlVGltZW91dCA9IHNldFRpbWVvdXQoZG9OZXdSZXF1ZXN0LCBNYXRoLmZsb29yKEtFRVBBTElWRV9SRVFVRVNUX0lOVEVSVkFMKSk7DQogICAgICAgIGNvbnN0IHJlYWR5U3RhdGVDQiA9ICgpID0+IHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3QgY29tcGxldGVkLiAgQ2FuY2VsIHRoZSBrZWVwYWxpdmUuDQogICAgICAgICAgICBjbGVhclRpbWVvdXQoa2VlcGFsaXZlVGltZW91dCk7DQogICAgICAgICAgICAvLyBUcmlnZ2VyIGEgbmV3IHJlcXVlc3Qgc28gd2UgY2FuIGNvbnRpbnVlIHJlY2VpdmluZyBkYXRhLg0KICAgICAgICAgICAgZG9OZXdSZXF1ZXN0KCk7DQogICAgICAgIH07DQogICAgICAgIHRoaXMuYWRkVGFnKHVybCwgcmVhZHlTdGF0ZUNCKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQWRkIGFuIGFyYml0cmFyeSBzY3JpcHQgdGFnIHRvIHRoZSBpZnJhbWUuDQogICAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgZm9yIHRoZSBzY3JpcHQgdGFnIHNvdXJjZS4NCiAgICAgKiBAcGFyYW0gbG9hZENCIC0gQSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgb25jZSB0aGUgc2NyaXB0IGhhcyBsb2FkZWQuDQogICAgICovDQogICAgYWRkVGFnKHVybCwgbG9hZENCKSB7DQogICAgICAgIHsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGFscmVhZHkgY2xvc2VkLCBkb24ndCBhZGQgdGhpcyBwb2xsDQogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZW5kTmV3UG9sbHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTY3JpcHQgPSB0aGlzLm15SUZyYW1lLmRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LmFzeW5jID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LnNyYyA9IHVybDsNCiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9ubG9hZCA9IG5ld1NjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcnN0YXRlID0gbmV3U2NyaXB0LnJlYWR5U3RhdGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyc3RhdGUgfHwgcnN0YXRlID09PSAnbG9hZGVkJyB8fCByc3RhdGUgPT09ICdjb21wbGV0ZScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9ubG9hZCA9IG5ld1NjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3U2NyaXB0LnBhcmVudE5vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5ld1NjcmlwdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZENCKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2coJ0xvbmctcG9sbCBzY3JpcHQgZmFpbGVkIHRvIGxvYWQ6ICcgKyB1cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTmV3UG9sbHMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2MuYm9keS5hcHBlbmRDaGlsZChuZXdTY3JpcHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiB3ZSBzaG91bGQgbWFrZSB0aGlzIGVycm9yIHZpc2libGUgc29tZWhvdw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoMSkpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgV0VCU09DS0VUX01BWF9GUkFNRV9TSVpFID0gMTYzODQ7DQpjb25zdCBXRUJTT0NLRVRfS0VFUEFMSVZFX0lOVEVSVkFMID0gNDUwMDA7DQpsZXQgV2ViU29ja2V0SW1wbCA9IG51bGw7DQppZiAodHlwZW9mIE1veldlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBXZWJTb2NrZXRJbXBsID0gTW96V2ViU29ja2V0Ow0KfQ0KZWxzZSBpZiAodHlwZW9mIFdlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBXZWJTb2NrZXRJbXBsID0gV2ViU29ja2V0Ow0KfQ0KLyoqDQogKiBDcmVhdGUgYSBuZXcgd2Vic29ja2V0IGNvbm5lY3Rpb24gd2l0aCB0aGUgZ2l2ZW4gY2FsbGJhY2tzLg0KICovDQpjbGFzcyBXZWJTb2NrZXRDb25uZWN0aW9uIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gY29ubklkIGlkZW50aWZpZXIgZm9yIHRoaXMgdHJhbnNwb3J0DQogICAgICogQHBhcmFtIHJlcG9JbmZvIFRoZSBpbmZvIGZvciB0aGUgd2Vic29ja2V0IGVuZHBvaW50Lg0KICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvbklkIFRoZSBGaXJlYmFzZSBBcHAgSUQgZm9yIHRoaXMgcHJvamVjdC4NCiAgICAgKiBAcGFyYW0gYXBwQ2hlY2tUb2tlbiBUaGUgQXBwIENoZWNrIFRva2VuIGZvciB0aGlzIGNsaWVudC4NCiAgICAgKiBAcGFyYW0gYXV0aFRva2VuIFRoZSBBdXRoIFRva2VuIGZvciB0aGlzIGNsaWVudC4NCiAgICAgKiBAcGFyYW0gdHJhbnNwb3J0U2Vzc2lvbklkIE9wdGlvbmFsIHRyYW5zcG9ydFNlc3Npb25JZCBpZiB0aGlzIGlzIGNvbm5lY3RpbmcNCiAgICAgKiB0byBhbiBleGlzdGluZyB0cmFuc3BvcnQgc2Vzc2lvbg0KICAgICAqIEBwYXJhbSBsYXN0U2Vzc2lvbklkIE9wdGlvbmFsIGxhc3RTZXNzaW9uSWQgaWYgdGhlcmUgd2FzIGEgcHJldmlvdXMNCiAgICAgKiBjb25uZWN0aW9uDQogICAgICovDQogICAgY29uc3RydWN0b3IoY29ubklkLCByZXBvSW5mbywgYXBwbGljYXRpb25JZCwgYXBwQ2hlY2tUb2tlbiwgYXV0aFRva2VuLCB0cmFuc3BvcnRTZXNzaW9uSWQsIGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgdGhpcy5jb25uSWQgPSBjb25uSWQ7DQogICAgICAgIHRoaXMuYXBwbGljYXRpb25JZCA9IGFwcGxpY2F0aW9uSWQ7DQogICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbiA9IGFwcENoZWNrVG9rZW47DQogICAgICAgIHRoaXMuYXV0aFRva2VuID0gYXV0aFRva2VuOw0KICAgICAgICB0aGlzLmtlZXBhbGl2ZVRpbWVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5mcmFtZXMgPSBudWxsOw0KICAgICAgICB0aGlzLnRvdGFsRnJhbWVzID0gMDsNCiAgICAgICAgdGhpcy5ieXRlc1NlbnQgPSAwOw0KICAgICAgICB0aGlzLmJ5dGVzUmVjZWl2ZWQgPSAwOw0KICAgICAgICB0aGlzLmxvZ18gPSBsb2dXcmFwcGVyKHRoaXMuY29ubklkKTsNCiAgICAgICAgdGhpcy5zdGF0c18gPSBzdGF0c01hbmFnZXJHZXRDb2xsZWN0aW9uKHJlcG9JbmZvKTsNCiAgICAgICAgdGhpcy5jb25uVVJMID0gV2ViU29ja2V0Q29ubmVjdGlvbi5jb25uZWN0aW9uVVJMXyhyZXBvSW5mbywgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkLCBhcHBDaGVja1Rva2VuLCBhcHBsaWNhdGlvbklkKTsNCiAgICAgICAgdGhpcy5ub2RlQWRtaW4gPSByZXBvSW5mby5ub2RlQWRtaW47DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mbyAtIFRoZSBpbmZvIGZvciB0aGUgd2Vic29ja2V0IGVuZHBvaW50Lg0KICAgICAqIEBwYXJhbSB0cmFuc3BvcnRTZXNzaW9uSWQgLSBPcHRpb25hbCB0cmFuc3BvcnRTZXNzaW9uSWQgaWYgdGhpcyBpcyBjb25uZWN0aW5nIHRvIGFuIGV4aXN0aW5nIHRyYW5zcG9ydA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uDQogICAgICogQHBhcmFtIGxhc3RTZXNzaW9uSWQgLSBPcHRpb25hbCBsYXN0U2Vzc2lvbklkIGlmIHRoZXJlIHdhcyBhIHByZXZpb3VzIGNvbm5lY3Rpb24NCiAgICAgKiBAcmV0dXJucyBjb25uZWN0aW9uIHVybA0KICAgICAqLw0KICAgIHN0YXRpYyBjb25uZWN0aW9uVVJMXyhyZXBvSW5mbywgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkLCBhcHBDaGVja1Rva2VuLCBhcHBsaWNhdGlvbklkKSB7DQogICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IHt9Ow0KICAgICAgICB1cmxQYXJhbXNbVkVSU0lPTl9QQVJBTV0gPSBQUk9UT0NPTF9WRVJTSU9OOw0KICAgICAgICBpZiAodHlwZW9mIGxvY2F0aW9uICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgbG9jYXRpb24uaG9zdG5hbWUgJiYNCiAgICAgICAgICAgIEZPUkdFX0RPTUFJTl9SRS50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKSkgew0KICAgICAgICAgICAgdXJsUGFyYW1zW1JFRkVSRVJfUEFSQU1dID0gRk9SR0VfUkVGOw0KICAgICAgICB9DQogICAgICAgIGlmICh0cmFuc3BvcnRTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgIHVybFBhcmFtc1tUUkFOU1BPUlRfU0VTU0lPTl9QQVJBTV0gPSB0cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgIHVybFBhcmFtc1tMQVNUX1NFU1NJT05fUEFSQU1dID0gbGFzdFNlc3Npb25JZDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlbikgew0KICAgICAgICAgICAgdXJsUGFyYW1zW0FQUF9DSEVDS19UT0tFTl9QQVJBTV0gPSBhcHBDaGVja1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcHBsaWNhdGlvbklkKSB7DQogICAgICAgICAgICB1cmxQYXJhbXNbQVBQTElDQVRJT05fSURfUEFSQU1dID0gYXBwbGljYXRpb25JZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVwb0luZm9Db25uZWN0aW9uVVJMKHJlcG9JbmZvLCBXRUJTT0NLRVQsIHVybFBhcmFtcyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBvbk1lc3NhZ2UgLSBDYWxsYmFjayB3aGVuIG1lc3NhZ2VzIGFycml2ZQ0KICAgICAqIEBwYXJhbSBvbkRpc2Nvbm5lY3QgLSBDYWxsYmFjayB3aXRoIGNvbm5lY3Rpb24gbG9zdC4NCiAgICAgKi8NCiAgICBvcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KSB7DQogICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gb25EaXNjb25uZWN0Ow0KICAgICAgICB0aGlzLm9uTWVzc2FnZSA9IG9uTWVzc2FnZTsNCiAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGluZyB0byAnICsgdGhpcy5jb25uVVJMKTsNCiAgICAgICAgdGhpcy5ldmVyQ29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICAvLyBBc3N1bWUgZmFpbHVyZSB1bnRpbCBwcm92ZW4gb3RoZXJ3aXNlLg0KICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5zZXQoJ3ByZXZpb3VzX3dlYnNvY2tldF9mYWlsdXJlJywgdHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBsZXQgb3B0aW9uczsNCiAgICAgICAgICAgIGlmIChpc05vZGVTZGsoKSkgOw0KICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBuZXcgV2ViU29ja2V0SW1wbCh0aGlzLmNvbm5VUkwsIFtdLCBvcHRpb25zKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdFcnJvciBpbnN0YW50aWF0aW5nIFdlYlNvY2tldC4nKTsNCiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubXlTb2NrLm9ub3BlbiA9ICgpID0+IHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2Vic29ja2V0IGNvbm5lY3RlZC4nKTsNCiAgICAgICAgICAgIHRoaXMuZXZlckNvbm5lY3RlZF8gPSB0cnVlOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLm15U29jay5vbmNsb3NlID0gKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGlvbiB3YXMgZGlzY29ubmVjdGVkLicpOw0KICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBudWxsOw0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5teVNvY2sub25tZXNzYWdlID0gbSA9PiB7DQogICAgICAgICAgICB0aGlzLmhhbmRsZUluY29taW5nRnJhbWUobSk7DQogICAgICAgIH07DQogICAgICAgIHRoaXMubXlTb2NrLm9uZXJyb3IgPSBlID0+IHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2ViU29ja2V0IGVycm9yLiAgQ2xvc2luZyBjb25uZWN0aW9uLicpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBOby1vcCBmb3Igd2Vic29ja2V0cywgd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZyBvbmNlIHRoZSBjb25uZWN0aW9uIGlzIGNvbmZpcm1lZCBhcyBvcGVuDQogICAgICovDQogICAgc3RhcnQoKSB7IH0NCiAgICBzdGF0aWMgZm9yY2VEaXNhbGxvdygpIHsNCiAgICAgICAgV2ViU29ja2V0Q29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyA9IHRydWU7DQogICAgfQ0KICAgIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgbGV0IGlzT2xkQW5kcm9pZCA9IGZhbHNlOw0KICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCkgew0KICAgICAgICAgICAgY29uc3Qgb2xkQW5kcm9pZFJlZ2V4ID0gL0FuZHJvaWQgKFswLTldezAsfVwuWzAtOV17MCx9KS87DQogICAgICAgICAgICBjb25zdCBvbGRBbmRyb2lkTWF0Y2ggPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKG9sZEFuZHJvaWRSZWdleCk7DQogICAgICAgICAgICBpZiAob2xkQW5kcm9pZE1hdGNoICYmIG9sZEFuZHJvaWRNYXRjaC5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQob2xkQW5kcm9pZE1hdGNoWzFdKSA8IDQuNCkgew0KICAgICAgICAgICAgICAgICAgICBpc09sZEFuZHJvaWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCFpc09sZEFuZHJvaWQgJiYNCiAgICAgICAgICAgIFdlYlNvY2tldEltcGwgIT09IG51bGwgJiYNCiAgICAgICAgICAgICFXZWJTb2NrZXRDb25uZWN0aW9uLmZvcmNlRGlzYWxsb3dfKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHdlIHByZXZpb3VzbHkgZmFpbGVkIHRvIGNvbm5lY3Qgd2l0aCB0aGlzIHRyYW5zcG9ydC4NCiAgICAgKi8NCiAgICBzdGF0aWMgcHJldmlvdXNseUZhaWxlZCgpIHsNCiAgICAgICAgLy8gSWYgb3VyIHBlcnNpc3RlbnQgc3RvcmFnZSBpcyBhY3R1YWxseSBvbmx5IGluLW1lbW9yeSBzdG9yYWdlLA0KICAgICAgICAvLyB3ZSBkZWZhdWx0IHRvIGFzc3VtaW5nIHRoYXQgaXQgcHJldmlvdXNseSBmYWlsZWQgdG8gYmUgc2FmZS4NCiAgICAgICAgcmV0dXJuIChQZXJzaXN0ZW50U3RvcmFnZS5pc0luTWVtb3J5U3RvcmFnZSB8fA0KICAgICAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2UuZ2V0KCdwcmV2aW91c193ZWJzb2NrZXRfZmFpbHVyZScpID09PSB0cnVlKTsNCiAgICB9DQogICAgbWFya0Nvbm5lY3Rpb25IZWFsdGh5KCkgew0KICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5yZW1vdmUoJ3ByZXZpb3VzX3dlYnNvY2tldF9mYWlsdXJlJyk7DQogICAgfQ0KICAgIGFwcGVuZEZyYW1lXyhkYXRhKSB7DQogICAgICAgIHRoaXMuZnJhbWVzLnB1c2goZGF0YSk7DQogICAgICAgIGlmICh0aGlzLmZyYW1lcy5sZW5ndGggPT09IHRoaXMudG90YWxGcmFtZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGZ1bGxNZXNzID0gdGhpcy5mcmFtZXMuam9pbignJyk7DQogICAgICAgICAgICB0aGlzLmZyYW1lcyA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBqc29uTWVzcyA9IGpzb25FdmFsKGZ1bGxNZXNzKTsNCiAgICAgICAgICAgIC8vaGFuZGxlIHRoZSBtZXNzYWdlDQogICAgICAgICAgICB0aGlzLm9uTWVzc2FnZShqc29uTWVzcyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGZyYW1lQ291bnQgLSBUaGUgbnVtYmVyIG9mIGZyYW1lcyB3ZSBhcmUgZXhwZWN0aW5nIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIGhhbmRsZU5ld0ZyYW1lQ291bnRfKGZyYW1lQ291bnQpIHsNCiAgICAgICAgdGhpcy50b3RhbEZyYW1lcyA9IGZyYW1lQ291bnQ7DQogICAgICAgIHRoaXMuZnJhbWVzID0gW107DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEF0dGVtcHRzIHRvIHBhcnNlIGEgZnJhbWUgY291bnQgb3V0IG9mIHNvbWUgdGV4dC4gSWYgaXQgY2FuJ3QsIGFzc3VtZXMgYSB2YWx1ZSBvZiAxDQogICAgICogQHJldHVybnMgQW55IHJlbWFpbmluZyBkYXRhIHRvIGJlIHByb2Nlc3MsIG9yIG51bGwgaWYgdGhlcmUgaXMgbm9uZQ0KICAgICAqLw0KICAgIGV4dHJhY3RGcmFtZUNvdW50XyhkYXRhKSB7DQogICAgICAgIGFzc2VydCh0aGlzLmZyYW1lcyA9PT0gbnVsbCwgJ1dlIGFscmVhZHkgaGF2ZSBhIGZyYW1lIGJ1ZmZlcicpOw0KICAgICAgICAvLyBUT0RPOiBUaGUgc2VydmVyIGlzIG9ubHkgc3VwcG9zZWQgdG8gc2VuZCB1cCB0byA5OTk5IGZyYW1lcyAoaS5lLiBsZW5ndGggPD0gNCksIGJ1dCB0aGF0IGlzbid0IGJlaW5nIGVuZm9yY2VkDQogICAgICAgIC8vIGN1cnJlbnRseS4gIFNvIGFsbG93aW5nIGxhcmdlciBmcmFtZSBjb3VudHMgKGxlbmd0aCA8PSA2KS4gIFNlZSBodHRwczovL2FwcC5hc2FuYS5jb20vMC9zZWFyY2gvODY4ODU5ODk5ODM4MC84MjM3NjA4MDQyNTA4DQogICAgICAgIGlmIChkYXRhLmxlbmd0aCA8PSA2KSB7DQogICAgICAgICAgICBjb25zdCBmcmFtZUNvdW50ID0gTnVtYmVyKGRhdGEpOw0KICAgICAgICAgICAgaWYgKCFpc05hTihmcmFtZUNvdW50KSkgew0KICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTmV3RnJhbWVDb3VudF8oZnJhbWVDb3VudCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5oYW5kbGVOZXdGcmFtZUNvdW50XygxKTsNCiAgICAgICAgcmV0dXJuIGRhdGE7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb2Nlc3MgYSB3ZWJzb2NrZXQgZnJhbWUgdGhhdCBoYXMgYXJyaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuDQogICAgICogQHBhcmFtIG1lc3MgLSBUaGUgZnJhbWUgZGF0YQ0KICAgICAqLw0KICAgIGhhbmRsZUluY29taW5nRnJhbWUobWVzcykgew0KICAgICAgICBpZiAodGhpcy5teVNvY2sgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsgLy8gQ2hyb21lIGFwcGFyZW50bHkgZGVsaXZlcnMgaW5jb21pbmcgcGFja2V0cyBldmVuIGFmdGVyIHdlIC5jbG9zZSgpIHRoZSBjb25uZWN0aW9uIHNvbWV0aW1lcy4NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBkYXRhID0gbWVzc1snZGF0YSddOw0KICAgICAgICB0aGlzLmJ5dGVzUmVjZWl2ZWQgKz0gZGF0YS5sZW5ndGg7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3JlY2VpdmVkJywgZGF0YS5sZW5ndGgpOw0KICAgICAgICB0aGlzLnJlc2V0S2VlcEFsaXZlKCk7DQogICAgICAgIGlmICh0aGlzLmZyYW1lcyAhPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gd2UncmUgYnVmZmVyaW5nDQogICAgICAgICAgICB0aGlzLmFwcGVuZEZyYW1lXyhkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIHRyeSB0byBwYXJzZSBvdXQgYSBmcmFtZSBjb3VudCwgb3RoZXJ3aXNlLCBhc3N1bWUgMSBhbmQgcHJvY2VzcyBpdA0KICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nRGF0YSA9IHRoaXMuZXh0cmFjdEZyYW1lQ291bnRfKGRhdGEpOw0KICAgICAgICAgICAgaWYgKHJlbWFpbmluZ0RhdGEgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEZyYW1lXyhyZW1haW5pbmdEYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgc2VydmVyDQogICAgICogQHBhcmFtIGRhdGEgLSBUaGUgSlNPTiBvYmplY3QgdG8gdHJhbnNtaXQNCiAgICAgKi8NCiAgICBzZW5kKGRhdGEpIHsNCiAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZSgpOw0KICAgICAgICBjb25zdCBkYXRhU3RyID0gc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICB0aGlzLmJ5dGVzU2VudCArPSBkYXRhU3RyLmxlbmd0aDsNCiAgICAgICAgdGhpcy5zdGF0c18uaW5jcmVtZW50Q291bnRlcignYnl0ZXNfc2VudCcsIGRhdGFTdHIubGVuZ3RoKTsNCiAgICAgICAgLy9XZSBjYW4gb25seSBmaXQgYSBjZXJ0YWluIGFtb3VudCBpbiBlYWNoIHdlYnNvY2tldCBmcmFtZSwgc28gd2UgbmVlZCB0byBzcGxpdCB0aGlzIHJlcXVlc3QNCiAgICAgICAgLy91cCBpbnRvIG11bHRpcGxlIHBpZWNlcyBpZiBpdCBkb2Vzbid0IGZpdCBpbiBvbmUgcmVxdWVzdC4NCiAgICAgICAgY29uc3QgZGF0YVNlZ3MgPSBzcGxpdFN0cmluZ0J5U2l6ZShkYXRhU3RyLCBXRUJTT0NLRVRfTUFYX0ZSQU1FX1NJWkUpOw0KICAgICAgICAvL1NlbmQgdGhlIGxlbmd0aCBoZWFkZXINCiAgICAgICAgaWYgKGRhdGFTZWdzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFN0cmluZ18oU3RyaW5nKGRhdGFTZWdzLmxlbmd0aCkpOw0KICAgICAgICB9DQogICAgICAgIC8vU2VuZCB0aGUgYWN0dWFsIGRhdGEgaW4gc2VnbWVudHMuDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YVNlZ3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFN0cmluZ18oZGF0YVNlZ3NbaV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNodXRkb3duXygpIHsNCiAgICAgICAgdGhpcy5pc0Nsb3NlZF8gPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5rZWVwYWxpdmVUaW1lcikgew0KICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmtlZXBhbGl2ZVRpbWVyKTsNCiAgICAgICAgICAgIHRoaXMua2VlcGFsaXZlVGltZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLm15U29jaykgew0KICAgICAgICAgICAgdGhpcy5teVNvY2suY2xvc2UoKTsNCiAgICAgICAgICAgIHRoaXMubXlTb2NrID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkNsb3NlZF8oKSB7DQogICAgICAgIGlmICghdGhpcy5pc0Nsb3NlZF8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2ViU29ja2V0IGlzIGNsb3NpbmcgaXRzZWxmJyk7DQogICAgICAgICAgICB0aGlzLnNodXRkb3duXygpOw0KICAgICAgICAgICAgLy8gc2luY2UgdGhpcyBpcyBhbiBpbnRlcm5hbCBjbG9zZSwgdHJpZ2dlciB0aGUgY2xvc2UgbGlzdGVuZXINCiAgICAgICAgICAgIGlmICh0aGlzLm9uRGlzY29ubmVjdCkgew0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0KHRoaXMuZXZlckNvbm5lY3RlZF8pOw0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBFeHRlcm5hbC1mYWNpbmcgY2xvc2UgaGFuZGxlci4NCiAgICAgKiBDbG9zZSB0aGUgd2Vic29ja2V0IGFuZCBraWxsIHRoZSBjb25uZWN0aW9uLg0KICAgICAqLw0KICAgIGNsb3NlKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1dlYlNvY2tldCBpcyBiZWluZyBjbG9zZWQnKTsNCiAgICAgICAgICAgIHRoaXMuc2h1dGRvd25fKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogS2lsbCB0aGUgY3VycmVudCBrZWVwYWxpdmUgdGltZXIgYW5kIHN0YXJ0IGEgbmV3IG9uZSwgdG8gZW5zdXJlIHRoYXQgaXQgYWx3YXlzIGZpcmVzIE4gc2Vjb25kcyBhZnRlcg0KICAgICAqIHRoZSBsYXN0IGFjdGl2aXR5Lg0KICAgICAqLw0KICAgIHJlc2V0S2VlcEFsaXZlKCkgew0KICAgICAgICBjbGVhckludGVydmFsKHRoaXMua2VlcGFsaXZlVGltZXIpOw0KICAgICAgICB0aGlzLmtlZXBhbGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgLy9JZiB0aGVyZSBoYXMgYmVlbiBubyB3ZWJzb2NrZXQgYWN0aXZpdHkgZm9yIGEgd2hpbGUsIHNlbmQgYSBuby1vcA0KICAgICAgICAgICAgaWYgKHRoaXMubXlTb2NrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kU3RyaW5nXygnMCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZSgpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfSwgTWF0aC5mbG9vcihXRUJTT0NLRVRfS0VFUEFMSVZFX0lOVEVSVkFMKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFNlbmQgYSBzdHJpbmcgb3ZlciB0aGUgd2Vic29ja2V0Lg0KICAgICAqDQogICAgICogQHBhcmFtIHN0ciAtIFN0cmluZyB0byBzZW5kLg0KICAgICAqLw0KICAgIHNlbmRTdHJpbmdfKHN0cikgew0KICAgICAgICAvLyBGaXJlZm94IHNlZW1zIHRvIHNvbWV0aW1lcyB0aHJvdyBleGNlcHRpb25zIChOU19FUlJPUl9VTkVYUEVDVEVEKSBmcm9tIHdlYnNvY2tldCAuc2VuZCgpDQogICAgICAgIC8vIGNhbGxzIGZvciBzb21lIHVua25vd24gcmVhc29uLiAgV2UgdHJlYXQgdGhlc2UgYXMgYW4gZXJyb3IgYW5kIGRpc2Nvbm5lY3QuDQogICAgICAgIC8vIFNlZSBodHRwczovL2FwcC5hc2FuYS5jb20vMC81ODkyNjExMTQwMjI5Mi82ODAyMTM0MDI1MDQxMA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdGhpcy5teVNvY2suc2VuZChzdHIpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0V4Y2VwdGlvbiB0aHJvd24gZnJvbSBXZWJTb2NrZXQuc2VuZCgpOicsIGUubWVzc2FnZSB8fCBlLmRhdGEsICdDbG9zaW5nIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICBzZXRUaW1lb3V0KHRoaXMub25DbG9zZWRfLmJpbmQodGhpcyksIDApOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBOdW1iZXIgb2YgcmVzcG9uc2UgYmVmb3JlIHdlIGNvbnNpZGVyIHRoZSBjb25uZWN0aW9uICJoZWFsdGh5LiINCiAqLw0KV2ViU29ja2V0Q29ubmVjdGlvbi5yZXNwb25zZXNSZXF1aXJlZFRvQmVIZWFsdGh5ID0gMjsNCi8qKg0KICogVGltZSB0byB3YWl0IGZvciB0aGUgY29ubmVjdGlvbiB0ZSBiZWNvbWUgaGVhbHRoeSBiZWZvcmUgZ2l2aW5nIHVwLg0KICovDQpXZWJTb2NrZXRDb25uZWN0aW9uLmhlYWx0aHlUaW1lb3V0ID0gMzAwMDA7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEN1cnJlbnRseSBzaW1wbGlzdGljLCB0aGlzIGNsYXNzIG1hbmFnZXMgd2hhdCB0cmFuc3BvcnQgYSBDb25uZWN0aW9uIHNob3VsZCB1c2UgYXQgdmFyaW91cyBzdGFnZXMgb2YgaXRzDQogKiBsaWZlY3ljbGUuDQogKg0KICogSXQgc3RhcnRzIHdpdGggbG9uZ3BvbGxpbmcgaW4gYSBicm93c2VyLCBhbmQgaHR0cHBvbGxpbmcgb24gbm9kZS4gSXQgdGhlbiB1cGdyYWRlcyB0byB3ZWJzb2NrZXRzIGlmDQogKiB0aGV5IGFyZSBhdmFpbGFibGUuDQogKi8NCmNsYXNzIFRyYW5zcG9ydE1hbmFnZXIgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mbyAtIE1ldGFkYXRhIGFyb3VuZCB0aGUgbmFtZXNwYWNlIHdlJ3JlIGNvbm5lY3RpbmcgdG8NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mbykgew0KICAgICAgICB0aGlzLmluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbyk7DQogICAgfQ0KICAgIHN0YXRpYyBnZXQgQUxMX1RSQU5TUE9SVFMoKSB7DQogICAgICAgIHJldHVybiBbQnJvd3NlclBvbGxDb25uZWN0aW9uLCBXZWJTb2NrZXRDb25uZWN0aW9uXTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB3aGV0aGVyIHRyYW5zcG9ydCBoYXMgYmVlbiBzZWxlY3RlZCB0byBlbnN1cmUgV2ViU29ja2V0Q29ubmVjdGlvbiBvciBCcm93c2VyUG9sbENvbm5lY3Rpb24gYXJlIG5vdCBjYWxsZWQgYWZ0ZXINCiAgICAgKiBUcmFuc3BvcnRNYW5hZ2VyIGhhcyBhbHJlYWR5IHNldCB1cCB0cmFuc3BvcnRzXw0KICAgICAqLw0KICAgIHN0YXRpYyBnZXQgSVNfVFJBTlNQT1JUX0lOSVRJQUxJWkVEKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxUcmFuc3BvcnRJbml0aWFsaXplZF87DQogICAgfQ0KICAgIGluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbykgew0KICAgICAgICBjb25zdCBpc1dlYlNvY2tldHNBdmFpbGFibGUgPSBXZWJTb2NrZXRDb25uZWN0aW9uICYmIFdlYlNvY2tldENvbm5lY3Rpb25bJ2lzQXZhaWxhYmxlJ10oKTsNCiAgICAgICAgbGV0IGlzU2tpcFBvbGxDb25uZWN0aW9uID0gaXNXZWJTb2NrZXRzQXZhaWxhYmxlICYmICFXZWJTb2NrZXRDb25uZWN0aW9uLnByZXZpb3VzbHlGYWlsZWQoKTsNCiAgICAgICAgaWYgKHJlcG9JbmZvLndlYlNvY2tldE9ubHkpIHsNCiAgICAgICAgICAgIGlmICghaXNXZWJTb2NrZXRzQXZhaWxhYmxlKSB7DQogICAgICAgICAgICAgICAgd2Fybigid3NzOi8vIFVSTCB1c2VkLCBidXQgYnJvd3NlciBpc24ndCBrbm93biB0byBzdXBwb3J0IHdlYnNvY2tldHMuICBUcnlpbmcgYW55d2F5LiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaXNTa2lwUG9sbENvbm5lY3Rpb24gPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc1NraXBQb2xsQ29ubmVjdGlvbikgew0KICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzXyA9IFtXZWJTb2NrZXRDb25uZWN0aW9uXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IHRyYW5zcG9ydHMgPSAodGhpcy50cmFuc3BvcnRzXyA9IFtdKTsNCiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhbnNwb3J0IG9mIFRyYW5zcG9ydE1hbmFnZXIuQUxMX1RSQU5TUE9SVFMpIHsNCiAgICAgICAgICAgICAgICBpZiAodHJhbnNwb3J0ICYmIHRyYW5zcG9ydFsnaXNBdmFpbGFibGUnXSgpKSB7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydHMucHVzaCh0cmFuc3BvcnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFRyYW5zcG9ydE1hbmFnZXIuZ2xvYmFsVHJhbnNwb3J0SW5pdGlhbGl6ZWRfID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBpbml0aWFsIHRyYW5zcG9ydCB0byB1c2UNCiAgICAgKi8NCiAgICBpbml0aWFsVHJhbnNwb3J0KCkgew0KICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRzXy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnRzX1swXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdHJhbnNwb3J0cyBhdmFpbGFibGUnKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBuZXh0IHRyYW5zcG9ydCwgb3IgbnVsbA0KICAgICAqLw0KICAgIHVwZ3JhZGVUcmFuc3BvcnQoKSB7DQogICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHNfLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNfWzFdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovLyBLZWVwcyB0cmFjayBvZiB3aGV0aGVyIHRoZSBUcmFuc3BvcnRNYW5hZ2VyIGhhcyBhbHJlYWR5IGNob3NlbiBhIHRyYW5zcG9ydCB0byB1c2UNClRyYW5zcG9ydE1hbmFnZXIuZ2xvYmFsVHJhbnNwb3J0SW5pdGlhbGl6ZWRfID0gZmFsc2U7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovLyBBYm9ydCB1cGdyYWRlIGF0dGVtcHQgaWYgaXQgdGFrZXMgbG9uZ2VyIHRoYW4gNjBzLg0KY29uc3QgVVBHUkFERV9USU1FT1VUID0gNjAwMDA7DQovLyBGb3Igc29tZSB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byAidmFsaWRhdGUiIHRoZSB0cmFuc3BvcnQgYnkgZXhjaGFuZ2luZyBhIGZldyByZXF1ZXN0cyBhbmQgcmVzcG9uc2VzLg0KLy8gSWYgd2UgaGF2ZW4ndCBzZW50IGVub3VnaCByZXF1ZXN0cyB3aXRoaW4gNXMsIHdlJ2xsIHN0YXJ0IHNlbmRpbmcgbm9vcCBwaW5nIHJlcXVlc3RzLg0KY29uc3QgREVMQVlfQkVGT1JFX1NFTkRJTkdfRVhUUkFfUkVRVUVTVFMgPSA1MDAwOw0KLy8gSWYgdGhlIGluaXRpYWwgZGF0YSBzZW50IHRyaWdnZXJzIGEgbG90IG9mIGJhbmR3aWR0aCAoaS5lLiBpdCdzIGEgbGFyZ2UgcHV0IG9yIGEgbGlzdGVuIGZvciBhIGxhcmdlIGFtb3VudCBvZiBkYXRhKQ0KLy8gdGhlbiB3ZSBtYXkgbm90IGJlIGFibGUgdG8gZXhjaGFuZ2Ugb3VyIHBpbmcvcG9uZyByZXF1ZXN0cyB3aXRoaW4gdGhlIGhlYWx0aHkgdGltZW91dC4gIFNvIGlmIHdlIHJlYWNoIHRoZSB0aW1lb3V0DQovLyBidXQgd2UndmUgc2VudC9yZWNlaXZlZCBlbm91Z2ggYnl0ZXMsIHdlIGRvbid0IGNhbmNlbCB0aGUgY29ubmVjdGlvbi4NCmNvbnN0IEJZVEVTX1NFTlRfSEVBTFRIWV9PVkVSUklERSA9IDEwICogMTAyNDsNCmNvbnN0IEJZVEVTX1JFQ0VJVkVEX0hFQUxUSFlfT1ZFUlJJREUgPSAxMDAgKiAxMDI0Ow0KY29uc3QgTUVTU0FHRV9UWVBFID0gJ3QnOw0KY29uc3QgTUVTU0FHRV9EQVRBID0gJ2QnOw0KY29uc3QgQ09OVFJPTF9TSFVURE9XTiA9ICdzJzsNCmNvbnN0IENPTlRST0xfUkVTRVQgPSAncic7DQpjb25zdCBDT05UUk9MX0VSUk9SID0gJ2UnOw0KY29uc3QgQ09OVFJPTF9QT05HID0gJ28nOw0KY29uc3QgU1dJVENIX0FDSyA9ICdhJzsNCmNvbnN0IEVORF9UUkFOU01JU1NJT04gPSAnbic7DQpjb25zdCBQSU5HID0gJ3AnOw0KY29uc3QgU0VSVkVSX0hFTExPID0gJ2gnOw0KLyoqDQogKiBDcmVhdGVzIGEgbmV3IHJlYWwtdGltZSBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgdXNpbmcgd2hpY2hldmVyIG1ldGhvZCB3b3Jrcw0KICogYmVzdCBpbiB0aGUgY3VycmVudCBicm93c2VyLg0KICovDQpjbGFzcyBDb25uZWN0aW9uIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaWQgLSBhbiBpZCBmb3IgdGhpcyBjb25uZWN0aW9uDQogICAgICogQHBhcmFtIHJlcG9JbmZvXyAtIHRoZSBpbmZvIGZvciB0aGUgZW5kcG9pbnQgdG8gY29ubmVjdCB0bw0KICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvbklkXyAtIHRoZSBGaXJlYmFzZSBBcHAgSUQgZm9yIHRoaXMgcHJvamVjdA0KICAgICAqIEBwYXJhbSBhcHBDaGVja1Rva2VuXyAtIFRoZSBBcHAgQ2hlY2sgVG9rZW4gZm9yIHRoaXMgZGV2aWNlLg0KICAgICAqIEBwYXJhbSBhdXRoVG9rZW5fIC0gVGhlIGF1dGggdG9rZW4gZm9yIHRoaXMgc2Vzc2lvbi4NCiAgICAgKiBAcGFyYW0gb25NZXNzYWdlXyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiBhIHNlcnZlci1wdXNoIG1lc3NhZ2UgYXJyaXZlcw0KICAgICAqIEBwYXJhbSBvblJlYWR5XyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGlzIGNvbm5lY3Rpb24gaXMgcmVhZHkgdG8gc2VuZCBtZXNzYWdlcy4NCiAgICAgKiBAcGFyYW0gb25EaXNjb25uZWN0XyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiBhIGNvbm5lY3Rpb24gd2FzIGxvc3QNCiAgICAgKiBAcGFyYW0gb25LaWxsXyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGlzIGNvbm5lY3Rpb24gaGFzIHBlcm1hbmVudGx5IHNodXQgZG93bi4NCiAgICAgKiBAcGFyYW0gbGFzdFNlc3Npb25JZCAtIGxhc3Qgc2Vzc2lvbiBpZCBpbiBwZXJzaXN0ZW50IGNvbm5lY3Rpb24uIGlzIHVzZWQgdG8gY2xlYW4gdXAgb2xkIHNlc3Npb24gaW4gcmVhbC10aW1lIHNlcnZlcg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGlkLCByZXBvSW5mb18sIGFwcGxpY2F0aW9uSWRfLCBhcHBDaGVja1Rva2VuXywgYXV0aFRva2VuXywgb25NZXNzYWdlXywgb25SZWFkeV8sIG9uRGlzY29ubmVjdF8sIG9uS2lsbF8sIGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgdGhpcy5pZCA9IGlkOw0KICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXzsNCiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbklkXyA9IGFwcGxpY2F0aW9uSWRfOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gYXBwQ2hlY2tUb2tlbl87DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IGF1dGhUb2tlbl87DQogICAgICAgIHRoaXMub25NZXNzYWdlXyA9IG9uTWVzc2FnZV87DQogICAgICAgIHRoaXMub25SZWFkeV8gPSBvblJlYWR5XzsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gb25EaXNjb25uZWN0XzsNCiAgICAgICAgdGhpcy5vbktpbGxfID0gb25LaWxsXzsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbGFzdFNlc3Npb25JZDsNCiAgICAgICAgdGhpcy5jb25uZWN0aW9uQ291bnQgPSAwOw0KICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMgPSBbXTsNCiAgICAgICAgdGhpcy5zdGF0ZV8gPSAwIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVElORyAqLzsNCiAgICAgICAgdGhpcy5sb2dfID0gbG9nV3JhcHBlcignYzonICsgdGhpcy5pZCArICc6Jyk7DQogICAgICAgIHRoaXMudHJhbnNwb3J0TWFuYWdlcl8gPSBuZXcgVHJhbnNwb3J0TWFuYWdlcihyZXBvSW5mb18pOw0KICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gY3JlYXRlZCcpOw0KICAgICAgICB0aGlzLnN0YXJ0XygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTdGFydHMgYSBjb25uZWN0aW9uIGF0dGVtcHQNCiAgICAgKi8NCiAgICBzdGFydF8oKSB7DQogICAgICAgIGNvbnN0IGNvbm4gPSB0aGlzLnRyYW5zcG9ydE1hbmFnZXJfLmluaXRpYWxUcmFuc3BvcnQoKTsNCiAgICAgICAgdGhpcy5jb25uXyA9IG5ldyBjb25uKHRoaXMubmV4dFRyYW5zcG9ydElkXygpLCB0aGlzLnJlcG9JbmZvXywgdGhpcy5hcHBsaWNhdGlvbklkXywgdGhpcy5hcHBDaGVja1Rva2VuXywgdGhpcy5hdXRoVG9rZW5fLCBudWxsLCB0aGlzLmxhc3RTZXNzaW9uSWQpOw0KICAgICAgICAvLyBGb3IgY2VydGFpbiB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byBzZW5kIGFuZCByZWNlaXZlIHNldmVyYWwgbWVzc2FnZXMgYmFjayBhbmQgZm9ydGggYmVmb3JlIHdlDQogICAgICAgIC8vIGNhbiBjb25zaWRlciB0aGUgdHJhbnNwb3J0IGhlYWx0aHkuDQogICAgICAgIHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXyA9IGNvbm5bJ3Jlc3BvbnNlc1JlcXVpcmVkVG9CZUhlYWx0aHknXSB8fCAwOw0KICAgICAgICBjb25zdCBvbk1lc3NhZ2VSZWNlaXZlZCA9IHRoaXMuY29ublJlY2VpdmVyXyh0aGlzLmNvbm5fKTsNCiAgICAgICAgY29uc3Qgb25Db25uZWN0aW9uTG9zdCA9IHRoaXMuZGlzY29ublJlY2VpdmVyXyh0aGlzLmNvbm5fKTsNCiAgICAgICAgdGhpcy50eF8gPSB0aGlzLmNvbm5fOw0KICAgICAgICB0aGlzLnJ4XyA9IHRoaXMuY29ubl87DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSBmYWxzZTsNCiAgICAgICAgLyoNCiAgICAgICAgICogRmlyZWZveCBkb2Vzbid0IGxpa2Ugd2hlbiBjb2RlIGZyb20gb25lIGlmcmFtZSB0cmllcyB0byBjcmVhdGUgYW5vdGhlciBpZnJhbWUgYnkgd2F5IG9mIHRoZSBwYXJlbnQgZnJhbWUuDQogICAgICAgICAqIFRoaXMgY2FuIG9jY3VyIGluIHRoZSBjYXNlIG9mIGEgcmVkaXJlY3QsIGkuZS4gd2UgZ3Vlc3NlZCB3cm9uZyBvbiB3aGF0IHNlcnZlciB0byBjb25uZWN0IHRvIGFuZCByZWNlaXZlZCBhIHJlc2V0Lg0KICAgICAgICAgKiBTb21laG93LCBzZXRUaW1lb3V0IHNlZW1zIHRvIG1ha2UgdGhpcyBvay4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZnJvbSBhIHNlY3VyaXR5IHBlcnNwZWN0aXZlLCBzaW5jZSB5b3Ugc2hvdWxkDQogICAgICAgICAqIHN0aWxsIGhhdmUgdGhlIGNvbnRleHQgb2YgeW91ciBvcmlnaW5hdGluZyBmcmFtZS4NCiAgICAgICAgICovDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgLy8gdGhpcy5jb25uXyBnZXRzIHNldCB0byBudWxsIGluIHNvbWUgb2YgdGhlIHRlc3RzLiBDaGVjayB0byBtYWtlIHN1cmUgaXQgc3RpbGwgZXhpc3RzIGJlZm9yZSB1c2luZyBpdA0KICAgICAgICAgICAgdGhpcy5jb25uXyAmJiB0aGlzLmNvbm5fLm9wZW4ob25NZXNzYWdlUmVjZWl2ZWQsIG9uQ29ubmVjdGlvbkxvc3QpOw0KICAgICAgICB9LCBNYXRoLmZsb29yKDApKTsNCiAgICAgICAgY29uc3QgaGVhbHRoeVRpbWVvdXRNUyA9IGNvbm5bJ2hlYWx0aHlUaW1lb3V0J10gfHwgMDsNCiAgICAgICAgaWYgKGhlYWx0aHlUaW1lb3V0TVMgPiAwKSB7DQogICAgICAgICAgICB0aGlzLmhlYWx0aHlUaW1lb3V0XyA9IHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5oZWFsdGh5VGltZW91dF8gPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0hlYWx0aHlfKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5fICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5fLmJ5dGVzUmVjZWl2ZWQgPiBCWVRFU19SRUNFSVZFRF9IRUFMVEhZX09WRVJSSURFKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gZXhjZWVkZWQgaGVhbHRoeSB0aW1lb3V0IGJ1dCBoYXMgcmVjZWl2ZWQgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1JlY2VpdmVkICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGJ5dGVzLiAgTWFya2luZyBjb25uZWN0aW9uIGhlYWx0aHkuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5tYXJrQ29ubmVjdGlvbkhlYWx0aHkoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbm5fICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5fLmJ5dGVzU2VudCA+IEJZVEVTX1NFTlRfSEVBTFRIWV9PVkVSUklERSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW9uIGV4Y2VlZGVkIGhlYWx0aHkgdGltZW91dCBidXQgaGFzIHNlbnQgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1NlbnQgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgYnl0ZXMuICBMZWF2aW5nIGNvbm5lY3Rpb24gYWxpdmUuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB3YW50IHRvIG1hcmsgaXQgaGVhbHRoeSwgc2luY2Ugd2UgaGF2ZSBubyBndWFyYW50ZWUgdGhhdCB0aGUgYnl0ZXMgaGF2ZSBtYWRlIGl0IHRvDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyLg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdDbG9zaW5nIHVuaGVhbHRoeSBjb25uZWN0aW9uIGFmdGVyIHRpbWVvdXQuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoaGVhbHRoeVRpbWVvdXRNUykpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG5leHRUcmFuc3BvcnRJZF8oKSB7DQogICAgICAgIHJldHVybiAnYzonICsgdGhpcy5pZCArICc6JyArIHRoaXMuY29ubmVjdGlvbkNvdW50Kys7DQogICAgfQ0KICAgIGRpc2Nvbm5SZWNlaXZlcl8oY29ubikgew0KICAgICAgICByZXR1cm4gZXZlckNvbm5lY3RlZCA9PiB7DQogICAgICAgICAgICBpZiAoY29ubiA9PT0gdGhpcy5jb25uXykgew0KICAgICAgICAgICAgICAgIHRoaXMub25Db25uZWN0aW9uTG9zdF8oZXZlckNvbm5lY3RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjb25uID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdTZWNvbmRhcnkgY29ubmVjdGlvbiBsb3N0LicpOw0KICAgICAgICAgICAgICAgIHRoaXMub25TZWNvbmRhcnlDb25uZWN0aW9uTG9zdF8oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXygnY2xvc2luZyBhbiBvbGQgY29ubmVjdGlvbicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICBjb25uUmVjZWl2ZXJfKGNvbm4pIHsNCiAgICAgICAgcmV0dXJuIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZV8gIT09IDIgLyogUmVhbHRpbWVTdGF0ZS5ESVNDT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgICAgICBpZiAoY29ubiA9PT0gdGhpcy5yeF8pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblByaW1hcnlNZXNzYWdlUmVjZWl2ZWRfKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25uID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMub25TZWNvbmRhcnlNZXNzYWdlUmVjZWl2ZWRfKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdtZXNzYWdlIG9uIG9sZCBjb25uZWN0aW9uJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcGFyYW0gZGF0YU1zZyAtIEFuIGFyYml0cmFyeSBkYXRhIG1lc3NhZ2UgdG8gYmUgc2VudCB0byB0aGUgc2VydmVyDQogICAgICovDQogICAgc2VuZFJlcXVlc3QoZGF0YU1zZykgew0KICAgICAgICAvLyB3cmFwIGluIGEgZGF0YSBtZXNzYWdlIGVudmVsb3BlIGFuZCBzZW5kIGl0IG9uDQogICAgICAgIGNvbnN0IG1zZyA9IHsgdDogJ2QnLCBkOiBkYXRhTXNnIH07DQogICAgICAgIHRoaXMuc2VuZERhdGFfKG1zZyk7DQogICAgfQ0KICAgIHRyeUNsZWFudXBDb25uZWN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy50eF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8gJiYgdGhpcy5yeF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnY2xlYW5pbmcgdXAgYW5kIHByb21vdGluZyBhIGNvbm5lY3Rpb246ICcgKyB0aGlzLnNlY29uZGFyeUNvbm5fLmNvbm5JZCk7DQogICAgICAgICAgICB0aGlzLmNvbm5fID0gdGhpcy5zZWNvbmRhcnlDb25uXzsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICAgICAgLy8gdGhlIHNlcnZlciB3aWxsIHNodXRkb3duIHRoZSBvbGQgY29ubmVjdGlvbg0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2Vjb25kYXJ5Q29udHJvbF8oY29udHJvbERhdGEpIHsNCiAgICAgICAgaWYgKE1FU1NBR0VfVFlQRSBpbiBjb250cm9sRGF0YSkgew0KICAgICAgICAgICAgY29uc3QgY21kID0gY29udHJvbERhdGFbTUVTU0FHRV9UWVBFXTsNCiAgICAgICAgICAgIGlmIChjbWQgPT09IFNXSVRDSF9BQ0spIHsNCiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVJZlNlY29uZGFyeUhlYWx0aHlfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfUkVTRVQpIHsNCiAgICAgICAgICAgICAgICAvLyBNb3N0IGxpa2VseSB0aGUgc2Vzc2lvbiB3YXNuJ3QgdmFsaWQuIEFiYW5kb24gdGhlIHN3aXRjaCBhdHRlbXB0DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdHb3QgYSByZXNldCBvbiBzZWNvbmRhcnksIGNsb3NpbmcgaXQnKTsNCiAgICAgICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgLy8gSWYgd2Ugd2VyZSBhbHJlYWR5IHVzaW5nIHRoaXMgY29ubmVjdGlvbiBmb3Igc29tZXRoaW5nLCB0aGFuIHdlIG5lZWQgdG8gZnVsbHkgY2xvc2UNCiAgICAgICAgICAgICAgICBpZiAodGhpcy50eF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8gfHwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yeF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gQ09OVFJPTF9QT05HKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdnb3QgcG9uZyBvbiBzZWNvbmRhcnkuJyk7DQogICAgICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlSZXNwb25zZXNSZXF1aXJlZF8tLTsNCiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVJZlNlY29uZGFyeUhlYWx0aHlfKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgb25TZWNvbmRhcnlNZXNzYWdlUmVjZWl2ZWRfKHBhcnNlZERhdGEpIHsNCiAgICAgICAgY29uc3QgbGF5ZXIgPSByZXF1aXJlS2V5KCd0JywgcGFyc2VkRGF0YSk7DQogICAgICAgIGNvbnN0IGRhdGEgPSByZXF1aXJlS2V5KCdkJywgcGFyc2VkRGF0YSk7DQogICAgICAgIGlmIChsYXllciA9PT0gJ2MnKSB7DQogICAgICAgICAgICB0aGlzLm9uU2Vjb25kYXJ5Q29udHJvbF8oZGF0YSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobGF5ZXIgPT09ICdkJykgew0KICAgICAgICAgICAgLy8gZ290IGEgZGF0YSBtZXNzYWdlLCBidXQgd2UncmUgc3RpbGwgc2Vjb25kIGNvbm5lY3Rpb24uIE5lZWQgdG8gYnVmZmVyIGl0IHVwDQogICAgICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMucHVzaChkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBwcm90b2NvbCBsYXllcjogJyArIGxheWVyKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB1cGdyYWRlSWZTZWNvbmRhcnlIZWFsdGh5XygpIHsNCiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfIDw9IDApIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnU2Vjb25kYXJ5IGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4nKTsNCiAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLm1hcmtDb25uZWN0aW9uSGVhbHRoeSgpOw0KICAgICAgICAgICAgdGhpcy5wcm9jZWVkV2l0aFVwZ3JhZGVfKCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBTZW5kIGEgcGluZyB0byBtYWtlIHN1cmUgdGhlIGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4NCiAgICAgICAgICAgIHRoaXMubG9nXygnc2VuZGluZyBwaW5nIG9uIHNlY29uZGFyeS4nKTsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc2VuZCh7IHQ6ICdjJywgZDogeyB0OiBQSU5HLCBkOiB7fSB9IH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHByb2NlZWRXaXRoVXBncmFkZV8oKSB7DQogICAgICAgIC8vIHRlbGwgdGhpcyBjb25uZWN0aW9uIHRvIGNvbnNpZGVyIGl0c2VsZiBvcGVuDQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc3RhcnQoKTsNCiAgICAgICAgLy8gc2VuZCBhY2sNCiAgICAgICAgdGhpcy5sb2dfKCdzZW5kaW5nIGNsaWVudCBhY2sgb24gc2Vjb25kYXJ5Jyk7DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc2VuZCh7IHQ6ICdjJywgZDogeyB0OiBTV0lUQ0hfQUNLLCBkOiB7fSB9IH0pOw0KICAgICAgICAvLyBzZW5kIGVuZCBwYWNrZXQgb24gcHJpbWFyeSB0cmFuc3BvcnQsIHN3aXRjaCB0byBzZW5kaW5nIG9uIHRoaXMgb25lDQogICAgICAgIC8vIGNhbiByZWNlaXZlIG9uIHRoaXMgb25lLCBidWZmZXIgcmVzcG9uc2VzIHVudGlsIGVuZCByZWNlaXZlZCBvbiBwcmltYXJ5IHRyYW5zcG9ydA0KICAgICAgICB0aGlzLmxvZ18oJ0VuZGluZyB0cmFuc21pc3Npb24gb24gcHJpbWFyeScpOw0KICAgICAgICB0aGlzLmNvbm5fLnNlbmQoeyB0OiAnYycsIGQ6IHsgdDogRU5EX1RSQU5TTUlTU0lPTiwgZDoge30gfSB9KTsNCiAgICAgICAgdGhpcy50eF8gPSB0aGlzLnNlY29uZGFyeUNvbm5fOw0KICAgICAgICB0aGlzLnRyeUNsZWFudXBDb25uZWN0aW9uKCk7DQogICAgfQ0KICAgIG9uUHJpbWFyeU1lc3NhZ2VSZWNlaXZlZF8ocGFyc2VkRGF0YSkgew0KICAgICAgICAvLyBNdXN0IHJlZmVyIHRvIHBhcnNlZERhdGEgcHJvcGVydGllcyBpbiBxdW90ZXMsIHNvIGNsb3N1cmUgZG9lc24ndCB0b3VjaCB0aGVtLg0KICAgICAgICBjb25zdCBsYXllciA9IHJlcXVpcmVLZXkoJ3QnLCBwYXJzZWREYXRhKTsNCiAgICAgICAgY29uc3QgZGF0YSA9IHJlcXVpcmVLZXkoJ2QnLCBwYXJzZWREYXRhKTsNCiAgICAgICAgaWYgKGxheWVyID09PSAnYycpIHsNCiAgICAgICAgICAgIHRoaXMub25Db250cm9sXyhkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChsYXllciA9PT0gJ2QnKSB7DQogICAgICAgICAgICB0aGlzLm9uRGF0YU1lc3NhZ2VfKGRhdGEpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uRGF0YU1lc3NhZ2VfKG1lc3NhZ2UpIHsNCiAgICAgICAgdGhpcy5vblByaW1hcnlSZXNwb25zZV8oKTsNCiAgICAgICAgLy8gV2UgZG9uJ3QgZG8gYW55dGhpbmcgd2l0aCBkYXRhIG1lc3NhZ2VzLCBqdXN0IGtpY2sgdGhlbSB1cCBhIGxldmVsDQogICAgICAgIHRoaXMub25NZXNzYWdlXyhtZXNzYWdlKTsNCiAgICB9DQogICAgb25QcmltYXJ5UmVzcG9uc2VfKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNIZWFsdGh5Xykgew0KICAgICAgICAgICAgdGhpcy5wcmltYXJ5UmVzcG9uc2VzUmVxdWlyZWRfLS07DQogICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5UmVzcG9uc2VzUmVxdWlyZWRfIDw9IDApIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ1ByaW1hcnkgY29ubmVjdGlvbiBpcyBoZWFsdGh5LicpOw0KICAgICAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgICAgICAgICAgdGhpcy5jb25uXy5tYXJrQ29ubmVjdGlvbkhlYWx0aHkoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkNvbnRyb2xfKGNvbnRyb2xEYXRhKSB7DQogICAgICAgIGNvbnN0IGNtZCA9IHJlcXVpcmVLZXkoTUVTU0FHRV9UWVBFLCBjb250cm9sRGF0YSk7DQogICAgICAgIGlmIChNRVNTQUdFX0RBVEEgaW4gY29udHJvbERhdGEpIHsNCiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBjb250cm9sRGF0YVtNRVNTQUdFX0RBVEFdOw0KICAgICAgICAgICAgaWYgKGNtZCA9PT0gU0VSVkVSX0hFTExPKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaGFuZHNoYWtlUGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oe30sIHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcG9JbmZvXy5pc1VzaW5nRW11bGF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXBvbiBjb25uZWN0aW5nLCB0aGUgZW11bGF0b3Igd2lsbCBwYXNzIHRoZSBob3N0bmFtZSB0aGF0IGl0J3MgYXdhcmUgb2YsIGJ1dCB3ZSBwcmVmZXIgdGhlIHVzZXIncyBzZXQgaG9zdG5hbWUgdmlhIGBjb25uZWN0RGF0YWJhc2VFbXVsYXRvcmAgb3ZlciB3aGF0IHRoZSBlbXVsYXRvciBwYXNzZXMuDQogICAgICAgICAgICAgICAgICAgIGhhbmRzaGFrZVBheWxvYWQuaCA9IHRoaXMucmVwb0luZm9fLmhvc3Q7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMub25IYW5kc2hha2VfKGhhbmRzaGFrZVBheWxvYWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBFTkRfVFJBTlNNSVNTSU9OKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdyZWN2ZCBlbmQgdHJhbnNtaXNzaW9uIG9uIHByaW1hcnknKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJ4XyA9IHRoaXMuc2Vjb25kYXJ5Q29ubl87DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFNZXNzYWdlXyh0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMgPSBbXTsNCiAgICAgICAgICAgICAgICB0aGlzLnRyeUNsZWFudXBDb25uZWN0aW9uKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfU0hVVERPV04pIHsNCiAgICAgICAgICAgICAgICAvLyBUaGlzIHdhcyBwcmV2aW91c2x5IHRoZSAnb25LaWxsJyBjYWxsYmFjayBwYXNzZWQgdG8gdGhlIGxvd2VyLWxldmVsIGNvbm5lY3Rpb24NCiAgICAgICAgICAgICAgICAvLyBwYXlsb2FkIGluIHRoaXMgY2FzZSBpcyB0aGUgcmVhc29uIGZvciB0aGUgc2h1dGRvd24uIEdlbmVyYWxseSBhIGh1bWFuLXJlYWRhYmxlIGVycm9yDQogICAgICAgICAgICAgICAgdGhpcy5vbkNvbm5lY3Rpb25TaHV0ZG93bl8ocGF5bG9hZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfUkVTRVQpIHsNCiAgICAgICAgICAgICAgICAvLyBwYXlsb2FkIGluIHRoaXMgY2FzZSBpcyB0aGUgaG9zdCB3ZSBzaG91bGQgY29udGFjdA0KICAgICAgICAgICAgICAgIHRoaXMub25SZXNldF8ocGF5bG9hZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfRVJST1IpIHsNCiAgICAgICAgICAgICAgICBlcnJvciQxKCdTZXJ2ZXIgRXJyb3I6ICcgKyBwYXlsb2FkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gQ09OVFJPTF9QT05HKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdnb3QgcG9uZyBvbiBwcmltYXJ5LicpOw0KICAgICAgICAgICAgICAgIHRoaXMub25QcmltYXJ5UmVzcG9uc2VfKCk7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kUGluZ09uUHJpbWFyeUlmTmVjZXNzYXJ5XygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZXJyb3IkMSgnVW5rbm93biBjb250cm9sIHBhY2tldCBjb21tYW5kOiAnICsgY21kKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaGFuZHNoYWtlIC0gVGhlIGhhbmRzaGFrZSBkYXRhIHJldHVybmVkIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIG9uSGFuZHNoYWtlXyhoYW5kc2hha2UpIHsNCiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gaGFuZHNoYWtlLnRzOw0KICAgICAgICBjb25zdCB2ZXJzaW9uID0gaGFuZHNoYWtlLnY7DQogICAgICAgIGNvbnN0IGhvc3QgPSBoYW5kc2hha2UuaDsNCiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSBoYW5kc2hha2UuczsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18uaG9zdCA9IGhvc3Q7DQogICAgICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgY2xvc2VkIHRoZSBjb25uZWN0aW9uLCB0aGVuIGRvbid0IGJvdGhlciB0cnlpbmcgdG8gcHJvZ3Jlc3MgZnVydGhlcg0KICAgICAgICBpZiAodGhpcy5zdGF0ZV8gPT09IDAgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HICovKSB7DQogICAgICAgICAgICB0aGlzLmNvbm5fLnN0YXJ0KCk7DQogICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvbkVzdGFibGlzaGVkXyh0aGlzLmNvbm5fLCB0aW1lc3RhbXApOw0KICAgICAgICAgICAgaWYgKFBST1RPQ09MX1ZFUlNJT04gIT09IHZlcnNpb24pIHsNCiAgICAgICAgICAgICAgICB3YXJuKCdQcm90b2NvbCB2ZXJzaW9uIG1pc21hdGNoIGRldGVjdGVkJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBUT0RPOiBkbyB3ZSB3YW50IHRvIHVwZ3JhZGU/IHdoZW4/IG1heWJlIGEgZGVsYXk/DQogICAgICAgICAgICB0aGlzLnRyeVN0YXJ0VXBncmFkZV8oKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0cnlTdGFydFVwZ3JhZGVfKCkgew0KICAgICAgICBjb25zdCBjb25uID0gdGhpcy50cmFuc3BvcnRNYW5hZ2VyXy51cGdyYWRlVHJhbnNwb3J0KCk7DQogICAgICAgIGlmIChjb25uKSB7DQogICAgICAgICAgICB0aGlzLnN0YXJ0VXBncmFkZV8oY29ubik7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhcnRVcGdyYWRlXyhjb25uKSB7DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBuZXcgY29ubih0aGlzLm5leHRUcmFuc3BvcnRJZF8oKSwgdGhpcy5yZXBvSW5mb18sIHRoaXMuYXBwbGljYXRpb25JZF8sIHRoaXMuYXBwQ2hlY2tUb2tlbl8sIHRoaXMuYXV0aFRva2VuXywgdGhpcy5zZXNzaW9uSWQpOw0KICAgICAgICAvLyBGb3IgY2VydGFpbiB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byBzZW5kIGFuZCByZWNlaXZlIHNldmVyYWwgbWVzc2FnZXMgYmFjayBhbmQgZm9ydGggYmVmb3JlIHdlDQogICAgICAgIC8vIGNhbiBjb25zaWRlciB0aGUgdHJhbnNwb3J0IGhlYWx0aHkuDQogICAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfID0NCiAgICAgICAgICAgIGNvbm5bJ3Jlc3BvbnNlc1JlcXVpcmVkVG9CZUhlYWx0aHknXSB8fCAwOw0KICAgICAgICBjb25zdCBvbk1lc3NhZ2UgPSB0aGlzLmNvbm5SZWNlaXZlcl8odGhpcy5zZWNvbmRhcnlDb25uXyk7DQogICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMuZGlzY29ublJlY2VpdmVyXyh0aGlzLnNlY29uZGFyeUNvbm5fKTsNCiAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5vcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KTsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgdXBncmFkZWQgYWZ0ZXIgVVBHUkFERV9USU1FT1VULCBnaXZlIHVwIGFuZCBraWxsIHRoZSBzZWNvbmRhcnkuDQogICAgICAgIHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5zZWNvbmRhcnlDb25uXykgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXygnVGltZWQgb3V0IHRyeWluZyB0byB1cGdyYWRlLicpOw0KICAgICAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uY2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgTWF0aC5mbG9vcihVUEdSQURFX1RJTUVPVVQpKTsNCiAgICB9DQogICAgb25SZXNldF8oaG9zdCkgew0KICAgICAgICB0aGlzLmxvZ18oJ1Jlc2V0IHBhY2tldCByZWNlaXZlZC4gIE5ldyBob3N0OiAnICsgaG9zdCk7DQogICAgICAgIHRoaXMucmVwb0luZm9fLmhvc3QgPSBob3N0Ow0KICAgICAgICAvLyBUT0RPOiBpZiB3ZSdyZSBhbHJlYWR5ICJjb25uZWN0ZWQiLCB3ZSBuZWVkIHRvIHRyaWdnZXIgYSBkaXNjb25uZWN0IGF0IHRoZSBuZXh0IGxheWVyIHVwLg0KICAgICAgICAvLyBXZSBkb24ndCBjdXJyZW50bHkgc3VwcG9ydCByZXNldHMgYWZ0ZXIgdGhlIGNvbm5lY3Rpb24gaGFzIGFscmVhZHkgYmVlbiBlc3RhYmxpc2hlZA0KICAgICAgICBpZiAodGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIENsb3NlIHdoYXRldmVyIGNvbm5lY3Rpb25zIHdlIGhhdmUgb3BlbiBhbmQgc3RhcnQgYWdhaW4uDQogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbnNfKCk7DQogICAgICAgICAgICB0aGlzLnN0YXJ0XygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uQ29ubmVjdGlvbkVzdGFibGlzaGVkXyhjb25uLCB0aW1lc3RhbXApIHsNCiAgICAgICAgdGhpcy5sb2dfKCdSZWFsdGltZSBjb25uZWN0aW9uIGVzdGFibGlzaGVkLicpOw0KICAgICAgICB0aGlzLmNvbm5fID0gY29ubjsNCiAgICAgICAgdGhpcy5zdGF0ZV8gPSAxIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVEVEICovOw0KICAgICAgICBpZiAodGhpcy5vblJlYWR5Xykgew0KICAgICAgICAgICAgdGhpcy5vblJlYWR5Xyh0aW1lc3RhbXAsIHRoaXMuc2Vzc2lvbklkKTsNCiAgICAgICAgICAgIHRoaXMub25SZWFkeV8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIGFmdGVyIDUgc2Vjb25kcyB3ZSBoYXZlbid0IHNlbnQgZW5vdWdoIHJlcXVlc3RzIHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBjb25uZWN0aW9uIGhlYWx0aHksDQogICAgICAgIC8vIHNlbmQgc29tZSBwaW5ncy4NCiAgICAgICAgaWYgKHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXyA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdQcmltYXJ5IGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4nKTsNCiAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0Tm9uQmxvY2tpbmcoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFBpbmdPblByaW1hcnlJZk5lY2Vzc2FyeV8oKTsNCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoREVMQVlfQkVGT1JFX1NFTkRJTkdfRVhUUkFfUkVRVUVTVFMpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzZW5kUGluZ09uUHJpbWFyeUlmTmVjZXNzYXJ5XygpIHsNCiAgICAgICAgLy8gSWYgdGhlIGNvbm5lY3Rpb24gaXNuJ3QgY29uc2lkZXJlZCBoZWFsdGh5IHlldCwgd2UnbGwgc2VuZCBhIG5vb3AgcGluZyBwYWNrZXQgcmVxdWVzdC4NCiAgICAgICAgaWYgKCF0aGlzLmlzSGVhbHRoeV8gJiYgdGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnc2VuZGluZyBwaW5nIG9uIHByaW1hcnkuJyk7DQogICAgICAgICAgICB0aGlzLnNlbmREYXRhXyh7IHQ6ICdjJywgZDogeyB0OiBQSU5HLCBkOiB7fSB9IH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2Vjb25kYXJ5Q29ubmVjdGlvbkxvc3RfKCkgew0KICAgICAgICBjb25zdCBjb25uID0gdGhpcy5zZWNvbmRhcnlDb25uXzsNCiAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXyA9IG51bGw7DQogICAgICAgIGlmICh0aGlzLnR4XyA9PT0gY29ubiB8fCB0aGlzLnJ4XyA9PT0gY29ubikgew0KICAgICAgICAgICAgLy8gd2UgYXJlIHJlbHlpbmcgb24gdGhpcyBjb25uZWN0aW9uIGFscmVhZHkgaW4gc29tZSBjYXBhY2l0eS4gVGhlcmVmb3JlLCBhIGZhaWx1cmUgaXMgcmVhbA0KICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBldmVyQ29ubmVjdGVkIC0gV2hldGhlciBvciBub3QgdGhlIGNvbm5lY3Rpb24gZXZlciByZWFjaGVkIGEgc2VydmVyLiBVc2VkIHRvIGRldGVybWluZSBpZg0KICAgICAqIHdlIHNob3VsZCBmbHVzaCB0aGUgaG9zdCBjYWNoZQ0KICAgICAqLw0KICAgIG9uQ29ubmVjdGlvbkxvc3RfKGV2ZXJDb25uZWN0ZWQpIHsNCiAgICAgICAgdGhpcy5jb25uXyA9IG51bGw7DQogICAgICAgIC8vIE5PVEU6IElGIHlvdSdyZSBzZWVpbmcgYSBGaXJlZm94IGVycm9yIGZvciB0aGlzIGxpbmUsIEkgdGhpbmsgaXQgbWlnaHQgYmUgYmVjYXVzZSBpdCdzIGdldHRpbmcNCiAgICAgICAgLy8gY2FsbGVkIG9uIHdpbmRvdyBjbG9zZSBhbmQgUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HIGlzIG5vIGxvbmdlciBkZWZpbmVkLiAgSnVzdCBhIGd1ZXNzLg0KICAgICAgICBpZiAoIWV2ZXJDb25uZWN0ZWQgJiYgdGhpcy5zdGF0ZV8gPT09IDAgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HICovKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1JlYWx0aW1lIGNvbm5lY3Rpb24gZmFpbGVkLicpOw0KICAgICAgICAgICAgLy8gU2luY2Ugd2UgZmFpbGVkIHRvIGNvbm5lY3QgYXQgYWxsLCBjbGVhciBhbnkgY2FjaGVkIGVudHJ5IGZvciB0aGlzIG5hbWVzcGFjZSBpbiBjYXNlIHRoZSBtYWNoaW5lIHdlbnQgYXdheQ0KICAgICAgICAgICAgaWYgKHRoaXMucmVwb0luZm9fLmlzQ2FjaGVhYmxlSG9zdCgpKSB7DQogICAgICAgICAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2UucmVtb3ZlKCdob3N0OicgKyB0aGlzLnJlcG9JbmZvXy5ob3N0KTsNCiAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgaW50ZXJuYWwgaG9zdCB0byB3aGF0IHdlIHdvdWxkIHNob3cgdGhlIHVzZXIsIGkuZS4gPG5zPi5maXJlYmFzZWlvLmNvbQ0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLmludGVybmFsSG9zdCA9IHRoaXMucmVwb0luZm9fLmhvc3Q7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnUmVhbHRpbWUgY29ubmVjdGlvbiBsb3N0LicpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICB9DQogICAgb25Db25uZWN0aW9uU2h1dGRvd25fKHJlYXNvbikgew0KICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gc2h1dGRvd24gY29tbWFuZCByZWNlaXZlZC4gU2h1dHRpbmcgZG93bi4uLicpOw0KICAgICAgICBpZiAodGhpcy5vbktpbGxfKSB7DQogICAgICAgICAgICB0aGlzLm9uS2lsbF8ocmVhc29uKTsNCiAgICAgICAgICAgIHRoaXMub25LaWxsXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgLy8gV2UgaW50ZW50aW9uYWxseSBkb24ndCB3YW50IHRvIGZpcmUgb25EaXNjb25uZWN0IChraWxsIGlzIGEgZGlmZmVyZW50IGNhc2UpLA0KICAgICAgICAvLyBzbyBjbGVhciB0aGUgY2FsbGJhY2suDQogICAgICAgIHRoaXMub25EaXNjb25uZWN0XyA9IG51bGw7DQogICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICB9DQogICAgc2VuZERhdGFfKGRhdGEpIHsNCiAgICAgICAgaWYgKHRoaXMuc3RhdGVfICE9PSAxIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVEVEICovKSB7DQogICAgICAgICAgICB0aHJvdyAnQ29ubmVjdGlvbiBpcyBub3QgY29ubmVjdGVkJzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMudHhfLnNlbmQoZGF0YSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQ2xlYW5zIHVwIHRoaXMgY29ubmVjdGlvbiwgY2FsbGluZyB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzDQogICAgICovDQogICAgY2xvc2UoKSB7DQogICAgICAgIGlmICh0aGlzLnN0YXRlXyAhPT0gMiAvKiBSZWFsdGltZVN0YXRlLkRJU0NPTk5FQ1RFRCAqLykgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdDbG9zaW5nIHJlYWx0aW1lIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICB0aGlzLnN0YXRlXyA9IDIgLyogUmVhbHRpbWVTdGF0ZS5ESVNDT05ORUNURUQgKi87DQogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbnNfKCk7DQogICAgICAgICAgICBpZiAodGhpcy5vbkRpc2Nvbm5lY3RfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfKCk7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjbG9zZUNvbm5lY3Rpb25zXygpIHsNCiAgICAgICAgdGhpcy5sb2dfKCdTaHV0dGluZyBkb3duIGFsbCBjb25uZWN0aW9ucycpOw0KICAgICAgICBpZiAodGhpcy5jb25uXykgew0KICAgICAgICAgICAgdGhpcy5jb25uXy5jbG9zZSgpOw0KICAgICAgICAgICAgdGhpcy5jb25uXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uY2xvc2UoKTsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmhlYWx0aHlUaW1lb3V0Xykgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaGVhbHRoeVRpbWVvdXRfKTsNCiAgICAgICAgICAgIHRoaXMuaGVhbHRoeVRpbWVvdXRfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogSW50ZXJmYWNlIGRlZmluaW5nIHRoZSBzZXQgb2YgYWN0aW9ucyB0aGF0IGNhbiBiZSBwZXJmb3JtZWQgYWdhaW5zdCB0aGUgRmlyZWJhc2Ugc2VydmVyDQogKiAoYmFzaWNhbGx5IGNvcnJlc3BvbmRzIHRvIG91ciB3aXJlIHByb3RvY29sKS4NCiAqDQogKiBAaW50ZXJmYWNlDQogKi8NCmNsYXNzIFNlcnZlckFjdGlvbnMgew0KICAgIHB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7IH0NCiAgICBtZXJnZShwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7IH0NCiAgICAvKioNCiAgICAgKiBSZWZyZXNoZXMgdGhlIGF1dGggdG9rZW4gZm9yIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24uDQogICAgICogQHBhcmFtIHRva2VuIC0gVGhlIGF1dGhlbnRpY2F0aW9uIHRva2VuDQogICAgICovDQogICAgcmVmcmVzaEF1dGhUb2tlbih0b2tlbikgeyB9DQogICAgLyoqDQogICAgICogUmVmcmVzaGVzIHRoZSBhcHAgY2hlY2sgdG9rZW4gZm9yIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24uDQogICAgICogQHBhcmFtIHRva2VuIFRoZSBhcHAgY2hlY2sgdG9rZW4NCiAgICAgKi8NCiAgICByZWZyZXNoQXBwQ2hlY2tUb2tlbih0b2tlbikgeyB9DQogICAgb25EaXNjb25uZWN0UHV0KHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpIHsgfQ0KICAgIG9uRGlzY29ubmVjdE1lcmdlKHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpIHsgfQ0KICAgIG9uRGlzY29ubmVjdENhbmNlbChwYXRoU3RyaW5nLCBvbkNvbXBsZXRlKSB7IH0NCiAgICByZXBvcnRTdGF0cyhzdGF0cykgeyB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEJhc2UgY2xhc3MgdG8gYmUgdXNlZCBpZiB5b3Ugd2FudCB0byBlbWl0IGV2ZW50cy4gQ2FsbCB0aGUgY29uc3RydWN0b3Igd2l0aA0KICogdGhlIHNldCBvZiBhbGxvd2VkIGV2ZW50IG5hbWVzLg0KICovDQpjbGFzcyBFdmVudEVtaXR0ZXIgew0KICAgIGNvbnN0cnVjdG9yKGFsbG93ZWRFdmVudHNfKSB7DQogICAgICAgIHRoaXMuYWxsb3dlZEV2ZW50c18gPSBhbGxvd2VkRXZlbnRzXzsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfID0ge307DQogICAgICAgIGFzc2VydChBcnJheS5pc0FycmF5KGFsbG93ZWRFdmVudHNfKSAmJiBhbGxvd2VkRXZlbnRzXy5sZW5ndGggPiAwLCAnUmVxdWlyZXMgYSBub24tZW1wdHkgYXJyYXknKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVG8gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY2xhc3NlcyB0byB0cmlnZ2VyIGV2ZW50cy4NCiAgICAgKi8NCiAgICB0cmlnZ2VyKGV2ZW50VHlwZSwgLi4udmFyQXJncykgew0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXSkpIHsNCiAgICAgICAgICAgIC8vIENsb25lIHRoZSBsaXN0LCBzaW5jZSBjYWxsYmFja3MgY291bGQgYWRkL3JlbW92ZSBsaXN0ZW5lcnMuDQogICAgICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSBbLi4udGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV1dOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBsaXN0ZW5lcnNbaV0uY2FsbGJhY2suYXBwbHkobGlzdGVuZXJzW2ldLmNvbnRleHQsIHZhckFyZ3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIG9uKGV2ZW50VHlwZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsNCiAgICAgICAgdGhpcy52YWxpZGF0ZUV2ZW50VHlwZV8oZXZlbnRUeXBlKTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV0gPSB0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXSB8fCBbXTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV0ucHVzaCh7IGNhbGxiYWNrLCBjb250ZXh0IH0pOw0KICAgICAgICBjb25zdCBldmVudERhdGEgPSB0aGlzLmdldEluaXRpYWxFdmVudChldmVudFR5cGUpOw0KICAgICAgICBpZiAoZXZlbnREYXRhKSB7DQogICAgICAgICAgICBjYWxsYmFjay5hcHBseShjb250ZXh0LCBldmVudERhdGEpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9mZihldmVudFR5cGUsIGNhbGxiYWNrLCBjb250ZXh0KSB7DQogICAgICAgIHRoaXMudmFsaWRhdGVFdmVudFR5cGVfKGV2ZW50VHlwZSk7DQogICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzX1tldmVudFR5cGVdIHx8IFtdOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGxpc3RlbmVyc1tpXS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYNCiAgICAgICAgICAgICAgICAoIWNvbnRleHQgfHwgY29udGV4dCA9PT0gbGlzdGVuZXJzW2ldLmNvbnRleHQpKSB7DQogICAgICAgICAgICAgICAgbGlzdGVuZXJzLnNwbGljZShpLCAxKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgdmFsaWRhdGVFdmVudFR5cGVfKGV2ZW50VHlwZSkgew0KICAgICAgICBhc3NlcnQodGhpcy5hbGxvd2VkRXZlbnRzXy5maW5kKGV0ID0+IHsNCiAgICAgICAgICAgIHJldHVybiBldCA9PT0gZXZlbnRUeXBlOw0KICAgICAgICB9KSwgJ1Vua25vd24gZXZlbnQ6ICcgKyBldmVudFR5cGUpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTW9uaXRvcnMgb25saW5lIHN0YXRlIChhcyByZXBvcnRlZCBieSB3aW5kb3cub25saW5lL29mZmxpbmUgZXZlbnRzKS4NCiAqDQogKiBUaGUgZXhwZWN0YXRpb24gaXMgdGhhdCB0aGlzIGNvdWxkIGhhdmUgbWFueSBmYWxzZSBwb3NpdGl2ZXMgKHRoaW5rcyB3ZSBhcmUgb25saW5lDQogKiB3aGVuIHdlJ3JlIG5vdCksIGJ1dCBubyBmYWxzZSBuZWdhdGl2ZXMuICBTbyB3ZSBjYW4gc2FmZWx5IHVzZSBpdCB0byBkZXRlcm1pbmUgd2hlbg0KICogd2UgZGVmaW5pdGVseSBjYW5ub3QgcmVhY2ggdGhlIGludGVybmV0Lg0KICovDQpjbGFzcyBPbmxpbmVNb25pdG9yIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoWydvbmxpbmUnXSk7DQogICAgICAgIHRoaXMub25saW5lXyA9IHRydWU7DQogICAgICAgIC8vIFdlJ3ZlIGhhZCByZXBlYXRlZCBjb21wbGFpbnRzIHRoYXQgQ29yZG92YSBhcHBzIGNhbiBnZXQgc3R1Y2sgIm9mZmxpbmUiLCBlLmcuDQogICAgICAgIC8vIGh0dHBzOi8vZm9ydW0uaW9uaWNmcmFtZXdvcmsuY29tL3QvZmlyZWJhc2UtY29ubmVjdGlvbi1pcy1sb3N0LWFuZC1uZXZlci1jb21lLWJhY2svNDM4MTANCiAgICAgICAgLy8gSXQgd291bGQgc2VlbSB0aGF0IHRoZSAnb25saW5lJyBldmVudCBkb2VzIG5vdCBhbHdheXMgZmlyZSBjb25zaXN0ZW50bHkuIFNvIHdlIGRpc2FibGUgaXQNCiAgICAgICAgLy8gZm9yIENvcmRvdmEuDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgdHlwZW9mIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgIWlzTW9iaWxlQ29yZG92YSgpKSB7DQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5vbmxpbmVfKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMub25saW5lXyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignb25saW5lJywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgZmFsc2UpOw0KICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25saW5lXykgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9ubGluZV8gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdvbmxpbmUnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBPbmxpbmVNb25pdG9yKCk7DQogICAgfQ0KICAgIGdldEluaXRpYWxFdmVudChldmVudFR5cGUpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50VHlwZSA9PT0gJ29ubGluZScsICdVbmtub3duIGV2ZW50IHR5cGU6ICcgKyBldmVudFR5cGUpOw0KICAgICAgICByZXR1cm4gW3RoaXMub25saW5lX107DQogICAgfQ0KICAgIGN1cnJlbnRseU9ubGluZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMub25saW5lXzsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKiogTWF4aW11bSBrZXkgZGVwdGguICovDQpjb25zdCBNQVhfUEFUSF9ERVBUSCA9IDMyOw0KLyoqIE1heGltdW0gbnVtYmVyIG9mIChVVEY4KSBieXRlcyBpbiBhIEZpcmViYXNlIHBhdGguICovDQpjb25zdCBNQVhfUEFUSF9MRU5HVEhfQllURVMgPSA3Njg7DQovKioNCiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgcGFyc2VkIHBhdGguICBJdCdzIGltbXV0YWJsZSBzbyB0aGF0IHlvdQ0KICogY2FuIHBhc3MgdGhlbSBhcm91bmQgdG8gb3RoZXIgZnVuY3Rpb25zIHdpdGhvdXQgd29ycnlpbmcgYWJvdXQgdGhlbSBjaGFuZ2luZw0KICogaXQuDQogKi8NCmNsYXNzIFBhdGggew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBwYXRoT3JTdHJpbmcgLSBQYXRoIHN0cmluZyB0byBwYXJzZSwgb3IgYW5vdGhlciBwYXRoLCBvciB0aGUgcmF3DQogICAgICogdG9rZW5zIGFycmF5DQogICAgICovDQogICAgY29uc3RydWN0b3IocGF0aE9yU3RyaW5nLCBwaWVjZU51bSkgew0KICAgICAgICBpZiAocGllY2VOdW0gPT09IHZvaWQgMCkgew0KICAgICAgICAgICAgdGhpcy5waWVjZXNfID0gcGF0aE9yU3RyaW5nLnNwbGl0KCcvJyk7DQogICAgICAgICAgICAvLyBSZW1vdmUgZW1wdHkgcGllY2VzLg0KICAgICAgICAgICAgbGV0IGNvcHlUbyA9IDA7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnBpZWNlc19baV0ubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBpZWNlc19bY29weVRvXSA9IHRoaXMucGllY2VzX1tpXTsNCiAgICAgICAgICAgICAgICAgICAgY29weVRvKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5waWVjZXNfLmxlbmd0aCA9IGNvcHlUbzsNCiAgICAgICAgICAgIHRoaXMucGllY2VOdW1fID0gMDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMucGllY2VzXyA9IHBhdGhPclN0cmluZzsNCiAgICAgICAgICAgIHRoaXMucGllY2VOdW1fID0gcGllY2VOdW07DQogICAgICAgIH0NCiAgICB9DQogICAgdG9TdHJpbmcoKSB7DQogICAgICAgIGxldCBwYXRoU3RyaW5nID0gJyc7DQogICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnBpZWNlTnVtXzsgaSA8IHRoaXMucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHRoaXMucGllY2VzX1tpXSAhPT0gJycpIHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nICs9ICcvJyArIHRoaXMucGllY2VzX1tpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGF0aFN0cmluZyB8fCAnLyc7DQogICAgfQ0KfQ0KZnVuY3Rpb24gbmV3RW1wdHlQYXRoKCkgew0KICAgIHJldHVybiBuZXcgUGF0aCgnJyk7DQp9DQpmdW5jdGlvbiBwYXRoR2V0RnJvbnQocGF0aCkgew0KICAgIGlmIChwYXRoLnBpZWNlTnVtXyA+PSBwYXRoLnBpZWNlc18ubGVuZ3RoKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICByZXR1cm4gcGF0aC5waWVjZXNfW3BhdGgucGllY2VOdW1fXTsNCn0NCi8qKg0KICogQHJldHVybnMgVGhlIG51bWJlciBvZiBzZWdtZW50cyBpbiB0aGlzIHBhdGgNCiAqLw0KZnVuY3Rpb24gcGF0aEdldExlbmd0aChwYXRoKSB7DQogICAgcmV0dXJuIHBhdGgucGllY2VzXy5sZW5ndGggLSBwYXRoLnBpZWNlTnVtXzsNCn0NCmZ1bmN0aW9uIHBhdGhQb3BGcm9udChwYXRoKSB7DQogICAgbGV0IHBpZWNlTnVtID0gcGF0aC5waWVjZU51bV87DQogICAgaWYgKHBpZWNlTnVtIDwgcGF0aC5waWVjZXNfLmxlbmd0aCkgew0KICAgICAgICBwaWVjZU51bSsrOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IFBhdGgocGF0aC5waWVjZXNfLCBwaWVjZU51bSk7DQp9DQpmdW5jdGlvbiBwYXRoR2V0QmFjayhwYXRoKSB7DQogICAgaWYgKHBhdGgucGllY2VOdW1fIDwgcGF0aC5waWVjZXNfLmxlbmd0aCkgew0KICAgICAgICByZXR1cm4gcGF0aC5waWVjZXNfW3BhdGgucGllY2VzXy5sZW5ndGggLSAxXTsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9DQpmdW5jdGlvbiBwYXRoVG9VcmxFbmNvZGVkU3RyaW5nKHBhdGgpIHsNCiAgICBsZXQgcGF0aFN0cmluZyA9ICcnOw0KICAgIGZvciAobGV0IGkgPSBwYXRoLnBpZWNlTnVtXzsgaSA8IHBhdGgucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAocGF0aC5waWVjZXNfW2ldICE9PSAnJykgew0KICAgICAgICAgICAgcGF0aFN0cmluZyArPSAnLycgKyBlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHBhdGgucGllY2VzX1tpXSkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwYXRoU3RyaW5nIHx8ICcvJzsNCn0NCi8qKg0KICogU2hhbGxvdyBjb3B5IG9mIHRoZSBwYXJ0cyBvZiB0aGUgcGF0aC4NCiAqDQogKi8NCmZ1bmN0aW9uIHBhdGhTbGljZShwYXRoLCBiZWdpbiA9IDApIHsNCiAgICByZXR1cm4gcGF0aC5waWVjZXNfLnNsaWNlKHBhdGgucGllY2VOdW1fICsgYmVnaW4pOw0KfQ0KZnVuY3Rpb24gcGF0aFBhcmVudChwYXRoKSB7DQogICAgaWYgKHBhdGgucGllY2VOdW1fID49IHBhdGgucGllY2VzXy5sZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGNvbnN0IHBpZWNlcyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSBwYXRoLnBpZWNlTnVtXzsgaSA8IHBhdGgucGllY2VzXy5sZW5ndGggLSAxOyBpKyspIHsNCiAgICAgICAgcGllY2VzLnB1c2gocGF0aC5waWVjZXNfW2ldKTsNCiAgICB9DQogICAgcmV0dXJuIG5ldyBQYXRoKHBpZWNlcywgMCk7DQp9DQpmdW5jdGlvbiBwYXRoQ2hpbGQocGF0aCwgY2hpbGRQYXRoT2JqKSB7DQogICAgY29uc3QgcGllY2VzID0gW107DQogICAgZm9yIChsZXQgaSA9IHBhdGgucGllY2VOdW1fOyBpIDwgcGF0aC5waWVjZXNfLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHBpZWNlcy5wdXNoKHBhdGgucGllY2VzX1tpXSk7DQogICAgfQ0KICAgIGlmIChjaGlsZFBhdGhPYmogaW5zdGFuY2VvZiBQYXRoKSB7DQogICAgICAgIGZvciAobGV0IGkgPSBjaGlsZFBhdGhPYmoucGllY2VOdW1fOyBpIDwgY2hpbGRQYXRoT2JqLnBpZWNlc18ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHBpZWNlcy5wdXNoKGNoaWxkUGF0aE9iai5waWVjZXNfW2ldKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgY2hpbGRQaWVjZXMgPSBjaGlsZFBhdGhPYmouc3BsaXQoJy8nKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZFBpZWNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGNoaWxkUGllY2VzW2ldLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBwaWVjZXMucHVzaChjaGlsZFBpZWNlc1tpXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG5ldyBQYXRoKHBpZWNlcywgMCk7DQp9DQovKioNCiAqIEByZXR1cm5zIFRydWUgaWYgdGhlcmUgYXJlIG5vIHNlZ21lbnRzIGluIHRoaXMgcGF0aA0KICovDQpmdW5jdGlvbiBwYXRoSXNFbXB0eShwYXRoKSB7DQogICAgcmV0dXJuIHBhdGgucGllY2VOdW1fID49IHBhdGgucGllY2VzXy5sZW5ndGg7DQp9DQovKioNCiAqIEByZXR1cm5zIFRoZSBwYXRoIGZyb20gb3V0ZXJQYXRoIHRvIGlubmVyUGF0aA0KICovDQpmdW5jdGlvbiBuZXdSZWxhdGl2ZVBhdGgob3V0ZXJQYXRoLCBpbm5lclBhdGgpIHsNCiAgICBjb25zdCBvdXRlciA9IHBhdGhHZXRGcm9udChvdXRlclBhdGgpLCBpbm5lciA9IHBhdGhHZXRGcm9udChpbm5lclBhdGgpOw0KICAgIGlmIChvdXRlciA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gaW5uZXJQYXRoOw0KICAgIH0NCiAgICBlbHNlIGlmIChvdXRlciA9PT0gaW5uZXIpIHsNCiAgICAgICAgcmV0dXJuIG5ld1JlbGF0aXZlUGF0aChwYXRoUG9wRnJvbnQob3V0ZXJQYXRoKSwgcGF0aFBvcEZyb250KGlubmVyUGF0aCkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJTlRFUk5BTCBFUlJPUjogaW5uZXJQYXRoICgnICsNCiAgICAgICAgICAgIGlubmVyUGF0aCArDQogICAgICAgICAgICAnKSBpcyBub3Qgd2l0aGluICcgKw0KICAgICAgICAgICAgJ291dGVyUGF0aCAoJyArDQogICAgICAgICAgICBvdXRlclBhdGggKw0KICAgICAgICAgICAgJyknKTsNCiAgICB9DQp9DQovKioNCiAqIEByZXR1cm5zIHRydWUgaWYgcGF0aHMgYXJlIHRoZSBzYW1lLg0KICovDQpmdW5jdGlvbiBwYXRoRXF1YWxzKHBhdGgsIG90aGVyKSB7DQogICAgaWYgKHBhdGhHZXRMZW5ndGgocGF0aCkgIT09IHBhdGhHZXRMZW5ndGgob3RoZXIpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgZm9yIChsZXQgaSA9IHBhdGgucGllY2VOdW1fLCBqID0gb3RoZXIucGllY2VOdW1fOyBpIDw9IHBhdGgucGllY2VzXy5sZW5ndGg7IGkrKywgaisrKSB7DQogICAgICAgIGlmIChwYXRoLnBpZWNlc19baV0gIT09IG90aGVyLnBpZWNlc19bal0pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qKg0KICogQHJldHVybnMgVHJ1ZSBpZiB0aGlzIHBhdGggaXMgYSBwYXJlbnQgb2YgKG9yIHRoZSBzYW1lIGFzKSBvdGhlcg0KICovDQpmdW5jdGlvbiBwYXRoQ29udGFpbnMocGF0aCwgb3RoZXIpIHsNCiAgICBsZXQgaSA9IHBhdGgucGllY2VOdW1fOw0KICAgIGxldCBqID0gb3RoZXIucGllY2VOdW1fOw0KICAgIGlmIChwYXRoR2V0TGVuZ3RoKHBhdGgpID4gcGF0aEdldExlbmd0aChvdGhlcikpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICB3aGlsZSAoaSA8IHBhdGgucGllY2VzXy5sZW5ndGgpIHsNCiAgICAgICAgaWYgKHBhdGgucGllY2VzX1tpXSAhPT0gb3RoZXIucGllY2VzX1tqXSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICsraTsNCiAgICAgICAgKytqOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qKg0KICogRHluYW1pYyAobXV0YWJsZSkgcGF0aCB1c2VkIHRvIGNvdW50IHBhdGggbGVuZ3Rocy4NCiAqDQogKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gZWZmaWNpZW50bHkgY2hlY2sgcGF0aHMgZm9yIHZhbGlkDQogKiBsZW5ndGggKGluIFVURjggYnl0ZXMpIGFuZCBkZXB0aCAodXNlZCBpbiBwYXRoIHZhbGlkYXRpb24pLg0KICoNCiAqIFRocm93cyBFcnJvciBleGNlcHRpb24gaWYgcGF0aCBpcyBldmVyIGludmFsaWQuDQogKg0KICogVGhlIGRlZmluaXRpb24gb2YgYSBwYXRoIGFsd2F5cyBiZWdpbnMgd2l0aCAnLycuDQogKi8NCmNsYXNzIFZhbGlkYXRpb25QYXRoIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gcGF0aCAtIEluaXRpYWwgUGF0aC4NCiAgICAgKiBAcGFyYW0gZXJyb3JQcmVmaXhfIC0gUHJlZml4IGZvciBhbnkgZXJyb3IgbWVzc2FnZXMuDQogICAgICovDQogICAgY29uc3RydWN0b3IocGF0aCwgZXJyb3JQcmVmaXhfKSB7DQogICAgICAgIHRoaXMuZXJyb3JQcmVmaXhfID0gZXJyb3JQcmVmaXhfOw0KICAgICAgICB0aGlzLnBhcnRzXyA9IHBhdGhTbGljZShwYXRoLCAwKTsNCiAgICAgICAgLyoqIEluaXRpYWxpemUgdG8gbnVtYmVyIG9mICcvJyBjaGFycyBuZWVkZWQgaW4gcGF0aC4gKi8NCiAgICAgICAgdGhpcy5ieXRlTGVuZ3RoXyA9IE1hdGgubWF4KDEsIHRoaXMucGFydHNfLmxlbmd0aCk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJ0c18ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXMuYnl0ZUxlbmd0aF8gKz0gc3RyaW5nTGVuZ3RoKHRoaXMucGFydHNfW2ldKTsNCiAgICAgICAgfQ0KICAgICAgICB2YWxpZGF0aW9uUGF0aENoZWNrVmFsaWQodGhpcyk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmFsaWRhdGlvblBhdGhQdXNoKHZhbGlkYXRpb25QYXRoLCBjaGlsZCkgew0KICAgIC8vIENvdW50IHRoZSBuZWVkZWQgJy8nDQogICAgaWYgKHZhbGlkYXRpb25QYXRoLnBhcnRzXy5sZW5ndGggPiAwKSB7DQogICAgICAgIHZhbGlkYXRpb25QYXRoLmJ5dGVMZW5ndGhfICs9IDE7DQogICAgfQ0KICAgIHZhbGlkYXRpb25QYXRoLnBhcnRzXy5wdXNoKGNoaWxkKTsNCiAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyArPSBzdHJpbmdMZW5ndGgoY2hpbGQpOw0KICAgIHZhbGlkYXRpb25QYXRoQ2hlY2tWYWxpZCh2YWxpZGF0aW9uUGF0aCk7DQp9DQpmdW5jdGlvbiB2YWxpZGF0aW9uUGF0aFBvcCh2YWxpZGF0aW9uUGF0aCkgew0KICAgIGNvbnN0IGxhc3QgPSB2YWxpZGF0aW9uUGF0aC5wYXJ0c18ucG9wKCk7DQogICAgdmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gLT0gc3RyaW5nTGVuZ3RoKGxhc3QpOw0KICAgIC8vIFVuLWNvdW50IHRoZSBwcmV2aW91cyAnLycNCiAgICBpZiAodmFsaWRhdGlvblBhdGgucGFydHNfLmxlbmd0aCA+IDApIHsNCiAgICAgICAgdmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gLT0gMTsNCiAgICB9DQp9DQpmdW5jdGlvbiB2YWxpZGF0aW9uUGF0aENoZWNrVmFsaWQodmFsaWRhdGlvblBhdGgpIHsNCiAgICBpZiAodmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gPiBNQVhfUEFUSF9MRU5HVEhfQllURVMpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHZhbGlkYXRpb25QYXRoLmVycm9yUHJlZml4XyArDQogICAgICAgICAgICAnaGFzIGEga2V5IHBhdGggbG9uZ2VyIHRoYW4gJyArDQogICAgICAgICAgICBNQVhfUEFUSF9MRU5HVEhfQllURVMgKw0KICAgICAgICAgICAgJyBieXRlcyAoJyArDQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyArDQogICAgICAgICAgICAnKS4nKTsNCiAgICB9DQogICAgaWYgKHZhbGlkYXRpb25QYXRoLnBhcnRzXy5sZW5ndGggPiBNQVhfUEFUSF9ERVBUSCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IodmFsaWRhdGlvblBhdGguZXJyb3JQcmVmaXhfICsNCiAgICAgICAgICAgICdwYXRoIHNwZWNpZmllZCBleGNlZWRzIHRoZSBtYXhpbXVtIGRlcHRoIHRoYXQgY2FuIGJlIHdyaXR0ZW4gKCcgKw0KICAgICAgICAgICAgTUFYX1BBVEhfREVQVEggKw0KICAgICAgICAgICAgJykgb3Igb2JqZWN0IGNvbnRhaW5zIGEgY3ljbGUgJyArDQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFRvRXJyb3JTdHJpbmcodmFsaWRhdGlvblBhdGgpKTsNCiAgICB9DQp9DQovKioNCiAqIFN0cmluZyBmb3IgdXNlIGluIGVycm9yIG1lc3NhZ2VzIC0gdXNlcyAnLicgbm90YXRpb24gZm9yIHBhdGguDQogKi8NCmZ1bmN0aW9uIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyh2YWxpZGF0aW9uUGF0aCkgew0KICAgIGlmICh2YWxpZGF0aW9uUGF0aC5wYXJ0c18ubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybiAnJzsNCiAgICB9DQogICAgcmV0dXJuICJpbiBwcm9wZXJ0eSAnIiArIHZhbGlkYXRpb25QYXRoLnBhcnRzXy5qb2luKCcuJykgKyAiJyI7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBWaXNpYmlsaXR5TW9uaXRvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKFsndmlzaWJsZSddKTsNCiAgICAgICAgbGV0IGhpZGRlbjsNCiAgICAgICAgbGV0IHZpc2liaWxpdHlDaGFuZ2U7DQogICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgICAgICB0eXBlb2YgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnRbJ2hpZGRlbiddICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgIC8vIE9wZXJhIDEyLjEwIGFuZCBGaXJlZm94IDE4IGFuZCBsYXRlciBzdXBwb3J0DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICd2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnaGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnbW96SGlkZGVuJ10gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICdtb3p2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnbW96SGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnbXNIaWRkZW4nXSAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5Q2hhbmdlID0gJ21zdmlzaWJpbGl0eWNoYW5nZSc7DQogICAgICAgICAgICAgICAgaGlkZGVuID0gJ21zSGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnd2Via2l0SGlkZGVuJ10gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICd3ZWJraXR2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnd2Via2l0SGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBJbml0aWFsbHksIHdlIGFsd2F5cyBhc3N1bWUgd2UgYXJlIHZpc2libGUuIFRoaXMgZW5zdXJlcyB0aGF0IGluIGJyb3dzZXJzDQogICAgICAgIC8vIHdpdGhvdXQgcGFnZSB2aXNpYmlsaXR5IHN1cHBvcnQgb3IgaW4gY2FzZXMgd2hlcmUgd2UgYXJlIG5ldmVyIHZpc2libGUNCiAgICAgICAgLy8gKGUuZy4gY2hyb21lIGV4dGVuc2lvbiksIHdlIGFjdCBhcyBpZiB3ZSBhcmUgdmlzaWJsZSwgaS5lLiBkb24ndCBkZWxheQ0KICAgICAgICAvLyByZWNvbm5lY3RzDQogICAgICAgIHRoaXMudmlzaWJsZV8gPSB0cnVlOw0KICAgICAgICBpZiAodmlzaWJpbGl0eUNoYW5nZSkgew0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih2aXNpYmlsaXR5Q2hhbmdlLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZSA9ICFkb2N1bWVudFtoaWRkZW5dOw0KICAgICAgICAgICAgICAgIGlmICh2aXNpYmxlICE9PSB0aGlzLnZpc2libGVfKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZV8gPSB2aXNpYmxlOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Zpc2libGUnLCB2aXNpYmxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCBmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGdldEluc3RhbmNlKCkgew0KICAgICAgICByZXR1cm4gbmV3IFZpc2liaWxpdHlNb25pdG9yKCk7DQogICAgfQ0KICAgIGdldEluaXRpYWxFdmVudChldmVudFR5cGUpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50VHlwZSA9PT0gJ3Zpc2libGUnLCAnVW5rbm93biBldmVudCB0eXBlOiAnICsgZXZlbnRUeXBlKTsNCiAgICAgICAgcmV0dXJuIFt0aGlzLnZpc2libGVfXTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBSRUNPTk5FQ1RfTUlOX0RFTEFZID0gMTAwMDsNCmNvbnN0IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVCA9IDYwICogNSAqIDEwMDA7IC8vIDUgbWludXRlcyBpbiBtaWxsaXNlY29uZHMgKENhc2U6IDE4NTgpDQpjb25zdCBSRUNPTk5FQ1RfTUFYX0RFTEFZX0ZPUl9BRE1JTlMgPSAzMCAqIDEwMDA7IC8vIDMwIHNlY29uZHMgZm9yIGFkbWluIGNsaWVudHMgKGxpa2VseSB0byBiZSBhIGJhY2tlbmQgc2VydmVyKQ0KY29uc3QgUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIgPSAxLjM7DQpjb25zdCBSRUNPTk5FQ1RfREVMQVlfUkVTRVRfVElNRU9VVCA9IDMwMDAwOyAvLyBSZXNldCBkZWxheSBiYWNrIHRvIE1JTl9ERUxBWSBhZnRlciBiZWluZyBjb25uZWN0ZWQgZm9yIDMwc2VjLg0KY29uc3QgU0VSVkVSX0tJTExfSU5URVJSVVBUX1JFQVNPTiA9ICdzZXJ2ZXJfa2lsbCc7DQovLyBJZiBhdXRoIGZhaWxzIHJlcGVhdGVkbHksIHdlJ2xsIGFzc3VtZSBzb21ldGhpbmcgaXMgd3JvbmcgYW5kIGxvZyBhIHdhcm5pbmcgLyBiYWNrIG9mZi4NCmNvbnN0IElOVkFMSURfVE9LRU5fVEhSRVNIT0xEID0gMzsNCi8qKg0KICogRmlyZWJhc2UgY29ubmVjdGlvbi4gIEFic3RyYWN0cyB3aXJlIHByb3RvY29sIGFuZCBoYW5kbGVzIHJlY29ubmVjdGluZy4NCiAqDQogKiBOT1RFOiBBbGwgSlNPTiBvYmplY3RzIHNlbnQgdG8gdGhlIHJlYWx0aW1lIGNvbm5lY3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5IG5hbWVzIGVuY2xvc2VkDQogKiBpbiBxdW90ZXMgdG8gbWFrZSBzdXJlIHRoZSBjbG9zdXJlIGNvbXBpbGVyIGRvZXMgbm90IG1pbmlmeSB0aGVtLg0KICovDQpjbGFzcyBQZXJzaXN0ZW50Q29ubmVjdGlvbiBleHRlbmRzIFNlcnZlckFjdGlvbnMgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mb18gLSBEYXRhIGFib3V0IHRoZSBuYW1lc3BhY2Ugd2UgYXJlIGNvbm5lY3RpbmcgdG8NCiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZF8gLSBUaGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3QNCiAgICAgKiBAcGFyYW0gb25EYXRhVXBkYXRlXyAtIEEgY2FsbGJhY2sgZm9yIG5ldyBkYXRhIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKHJlcG9JbmZvXywgYXBwbGljYXRpb25JZF8sIG9uRGF0YVVwZGF0ZV8sIG9uQ29ubmVjdFN0YXR1c18sIG9uU2VydmVySW5mb1VwZGF0ZV8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tUb2tlblByb3ZpZGVyXywgYXV0aE92ZXJyaWRlXykgew0KICAgICAgICBzdXBlcigpOw0KICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXzsNCiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbklkXyA9IGFwcGxpY2F0aW9uSWRfOw0KICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8gPSBvbkRhdGFVcGRhdGVfOw0KICAgICAgICB0aGlzLm9uQ29ubmVjdFN0YXR1c18gPSBvbkNvbm5lY3RTdGF0dXNfOw0KICAgICAgICB0aGlzLm9uU2VydmVySW5mb1VwZGF0ZV8gPSBvblNlcnZlckluZm9VcGRhdGVfOw0KICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXyA9IGF1dGhUb2tlblByb3ZpZGVyXzsNCiAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfID0gYXBwQ2hlY2tUb2tlblByb3ZpZGVyXzsNCiAgICAgICAgdGhpcy5hdXRoT3ZlcnJpZGVfID0gYXV0aE92ZXJyaWRlXzsNCiAgICAgICAgLy8gVXNlZCBmb3IgZGlhZ25vc3RpYyBsb2dnaW5nLg0KICAgICAgICB0aGlzLmlkID0gUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dFBlcnNpc3RlbnRDb25uZWN0aW9uSWRfKys7DQogICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ3A6JyArIHRoaXMuaWQgKyAnOicpOw0KICAgICAgICB0aGlzLmludGVycnVwdFJlYXNvbnNfID0ge307DQogICAgICAgIHRoaXMubGlzdGVucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dHNfID0gW107DQogICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRzXyA9IFtdOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfID0gMDsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldENvdW50XyA9IDA7DQogICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXyA9IFtdOw0KICAgICAgICB0aGlzLmNvbm5lY3RlZF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5yZWNvbm5lY3REZWxheV8gPSBSRUNPTk5FQ1RfTUlOX0RFTEFZOw0KICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVDsNCiAgICAgICAgdGhpcy5zZWN1cml0eURlYnVnQ2FsbGJhY2tfID0gbnVsbDsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbnVsbDsNCiAgICAgICAgdGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfID0gbnVsbDsNCiAgICAgICAgdGhpcy52aXNpYmxlXyA9IGZhbHNlOw0KICAgICAgICAvLyBCZWZvcmUgd2UgZ2V0IGNvbm5lY3RlZCwgd2Uga2VlcCBhIHF1ZXVlIG9mIHBlbmRpbmcgbWVzc2FnZXMgdG8gc2VuZC4NCiAgICAgICAgdGhpcy5yZXF1ZXN0Q0JIYXNoXyA9IHt9Ow0KICAgICAgICB0aGlzLnJlcXVlc3ROdW1iZXJfID0gMDsNCiAgICAgICAgdGhpcy5yZWFsdGltZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmF1dGhUb2tlbl8gPSBudWxsOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gbnVsbDsNCiAgICAgICAgdGhpcy5mb3JjZVRva2VuUmVmcmVzaF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDsNCiAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7DQogICAgICAgIHRoaXMuZmlyc3RDb25uZWN0aW9uXyA9IHRydWU7DQogICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25BdHRlbXB0VGltZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7DQogICAgICAgIGlmIChhdXRoT3ZlcnJpZGVfICYmICFpc05vZGVTZGsoKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoIG92ZXJyaWRlIHNwZWNpZmllZCBpbiBvcHRpb25zLCBidXQgbm90IHN1cHBvcnRlZCBvbiBub24gTm9kZS5qcyBwbGF0Zm9ybXMnKTsNCiAgICAgICAgfQ0KICAgICAgICBWaXNpYmlsaXR5TW9uaXRvci5nZXRJbnN0YW5jZSgpLm9uKCd2aXNpYmxlJywgdGhpcy5vblZpc2libGVfLCB0aGlzKTsNCiAgICAgICAgaWYgKHJlcG9JbmZvXy5ob3N0LmluZGV4T2YoJ2ZibG9jYWwnKSA9PT0gLTEpIHsNCiAgICAgICAgICAgIE9ubGluZU1vbml0b3IuZ2V0SW5zdGFuY2UoKS5vbignb25saW5lJywgdGhpcy5vbk9ubGluZV8sIHRoaXMpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRSZXF1ZXN0KGFjdGlvbiwgYm9keSwgb25SZXNwb25zZSkgew0KICAgICAgICBjb25zdCBjdXJSZXFOdW0gPSArK3RoaXMucmVxdWVzdE51bWJlcl87DQogICAgICAgIGNvbnN0IG1zZyA9IHsgcjogY3VyUmVxTnVtLCBhOiBhY3Rpb24sIGI6IGJvZHkgfTsNCiAgICAgICAgdGhpcy5sb2dfKHN0cmluZ2lmeShtc2cpKTsNCiAgICAgICAgYXNzZXJ0KHRoaXMuY29ubmVjdGVkXywgInNlbmRSZXF1ZXN0IGNhbGwgd2hlbiB3ZSdyZSBub3QgY29ubmVjdGVkIG5vdCBhbGxvd2VkLiIpOw0KICAgICAgICB0aGlzLnJlYWx0aW1lXy5zZW5kUmVxdWVzdChtc2cpOw0KICAgICAgICBpZiAob25SZXNwb25zZSkgew0KICAgICAgICAgICAgdGhpcy5yZXF1ZXN0Q0JIYXNoX1tjdXJSZXFOdW1dID0gb25SZXNwb25zZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXQocXVlcnkpIHsNCiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbl8oKTsNCiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsNCiAgICAgICAgICAgIHA6IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCksDQogICAgICAgICAgICBxOiBxdWVyeS5fcXVlcnlPYmplY3QNCiAgICAgICAgfTsNCiAgICAgICAgY29uc3Qgb3V0c3RhbmRpbmdHZXQgPSB7DQogICAgICAgICAgICBhY3Rpb246ICdnJywNCiAgICAgICAgICAgIHJlcXVlc3QsDQogICAgICAgICAgICBvbkNvbXBsZXRlOiAobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBtZXNzYWdlWydkJ107DQogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VbJ3MnXSA9PT0gJ29rJykgew0KICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldHNfLnB1c2gob3V0c3RhbmRpbmdHZXQpOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nR2V0Q291bnRfKys7DQogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5vdXRzdGFuZGluZ0dldHNfLmxlbmd0aCAtIDE7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZEdldF8oaW5kZXgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOw0KICAgIH0NCiAgICBsaXN0ZW4ocXVlcnksIGN1cnJlbnRIYXNoRm4sIHRhZywgb25Db21wbGV0ZSkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBjb25zdCBxdWVyeUlkID0gcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjsNCiAgICAgICAgY29uc3QgcGF0aFN0cmluZyA9IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCk7DQogICAgICAgIHRoaXMubG9nXygnTGlzdGVuIGNhbGxlZCBmb3IgJyArIHBhdGhTdHJpbmcgKyAnICcgKyBxdWVyeUlkKTsNCiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbnMuaGFzKHBhdGhTdHJpbmcpKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbnMuc2V0KHBhdGhTdHJpbmcsIG5ldyBNYXAoKSk7DQogICAgICAgIH0NCiAgICAgICAgYXNzZXJ0KHF1ZXJ5Ll9xdWVyeVBhcmFtcy5pc0RlZmF1bHQoKSB8fCAhcXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpLCAnbGlzdGVuKCkgY2FsbGVkIGZvciBub24tZGVmYXVsdCBidXQgY29tcGxldGUgcXVlcnknKTsNCiAgICAgICAgYXNzZXJ0KCF0aGlzLmxpc3RlbnMuZ2V0KHBhdGhTdHJpbmcpLmhhcyhxdWVyeUlkKSwgYGxpc3RlbigpIGNhbGxlZCB0d2ljZSBmb3Igc2FtZSBwYXRoL3F1ZXJ5SWQuYCk7DQogICAgICAgIGNvbnN0IGxpc3RlblNwZWMgPSB7DQogICAgICAgICAgICBvbkNvbXBsZXRlLA0KICAgICAgICAgICAgaGFzaEZuOiBjdXJyZW50SGFzaEZuLA0KICAgICAgICAgICAgcXVlcnksDQogICAgICAgICAgICB0YWcNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5saXN0ZW5zLmdldChwYXRoU3RyaW5nKS5zZXQocXVlcnlJZCwgbGlzdGVuU3BlYyk7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZExpc3Rlbl8obGlzdGVuU3BlYyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc2VuZEdldF8oaW5kZXgpIHsNCiAgICAgICAgY29uc3QgZ2V0ID0gdGhpcy5vdXRzdGFuZGluZ0dldHNfW2luZGV4XTsNCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdCgnZycsIGdldC5yZXF1ZXN0LCAobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgZGVsZXRlIHRoaXMub3V0c3RhbmRpbmdHZXRzX1tpbmRleF07DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nR2V0Q291bnRfLS07DQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ0dldENvdW50XyA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRzXyA9IFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGdldC5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgZ2V0Lm9uQ29tcGxldGUobWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBzZW5kTGlzdGVuXyhsaXN0ZW5TcGVjKSB7DQogICAgICAgIGNvbnN0IHF1ZXJ5ID0gbGlzdGVuU3BlYy5xdWVyeTsNCiAgICAgICAgY29uc3QgcGF0aFN0cmluZyA9IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCk7DQogICAgICAgIGNvbnN0IHF1ZXJ5SWQgPSBxdWVyeS5fcXVlcnlJZGVudGlmaWVyOw0KICAgICAgICB0aGlzLmxvZ18oJ0xpc3RlbiBvbiAnICsgcGF0aFN0cmluZyArICcgZm9yICcgKyBxdWVyeUlkKTsNCiAgICAgICAgY29uc3QgcmVxID0geyAvKnBhdGgqLyBwOiBwYXRoU3RyaW5nIH07DQogICAgICAgIGNvbnN0IGFjdGlvbiA9ICdxJzsNCiAgICAgICAgLy8gT25seSBib3RoZXIgdG8gc2VuZCBxdWVyeSBpZiBpdCdzIG5vbi1kZWZhdWx0Lg0KICAgICAgICBpZiAobGlzdGVuU3BlYy50YWcpIHsNCiAgICAgICAgICAgIHJlcVsncSddID0gcXVlcnkuX3F1ZXJ5T2JqZWN0Ow0KICAgICAgICAgICAgcmVxWyd0J10gPSBsaXN0ZW5TcGVjLnRhZzsNCiAgICAgICAgfQ0KICAgICAgICByZXFbIC8qaGFzaCovJ2gnXSA9IGxpc3RlblNwZWMuaGFzaEZuKCk7DQogICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoYWN0aW9uLCByZXEsIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gbWVzc2FnZVsgLypkYXRhKi8nZCddOw0KICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gbWVzc2FnZVsgLypzdGF0dXMqLydzJ107DQogICAgICAgICAgICAvLyBwcmludCB3YXJuaW5ncyBpbiBhbnkgY2FzZS4uLg0KICAgICAgICAgICAgUGVyc2lzdGVudENvbm5lY3Rpb24ud2Fybk9uTGlzdGVuV2FybmluZ3NfKHBheWxvYWQsIHF1ZXJ5KTsNCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5TcGVjID0gdGhpcy5saXN0ZW5zLmdldChwYXRoU3RyaW5nKSAmJg0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVucy5nZXQocGF0aFN0cmluZykuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICAgICAgLy8gb25seSB0cmlnZ2VyIGFjdGlvbnMgaWYgdGhlIGxpc3RlbiBoYXNuJ3QgYmVlbiByZW1vdmVkIGFuZCByZWFkZGVkDQogICAgICAgICAgICBpZiAoY3VycmVudExpc3RlblNwZWMgPT09IGxpc3RlblNwZWMpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ2xpc3RlbiByZXNwb25zZScsIG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5fKHBhdGhTdHJpbmcsIHF1ZXJ5SWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGlzdGVuU3BlYy5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgICAgIGxpc3RlblNwZWMub25Db21wbGV0ZShzdGF0dXMsIHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHN0YXRpYyB3YXJuT25MaXN0ZW5XYXJuaW5nc18ocGF5bG9hZCwgcXVlcnkpIHsNCiAgICAgICAgaWYgKHBheWxvYWQgJiYgdHlwZW9mIHBheWxvYWQgPT09ICdvYmplY3QnICYmIGNvbnRhaW5zKHBheWxvYWQsICd3JykpIHsNCiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICBjb25zdCB3YXJuaW5ncyA9IHNhZmVHZXQocGF5bG9hZCwgJ3cnKTsNCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHdhcm5pbmdzKSAmJiB+d2FybmluZ3MuaW5kZXhPZignbm9faW5kZXgnKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4U3BlYyA9ICciLmluZGV4T24iOiAiJyArIHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpLnRvU3RyaW5nKCkgKyAnIic7DQogICAgICAgICAgICAgICAgY29uc3QgaW5kZXhQYXRoID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICB3YXJuKGBVc2luZyBhbiB1bnNwZWNpZmllZCBpbmRleC4gWW91ciBkYXRhIHdpbGwgYmUgZG93bmxvYWRlZCBhbmQgYCArDQogICAgICAgICAgICAgICAgICAgIGBmaWx0ZXJlZCBvbiB0aGUgY2xpZW50LiBDb25zaWRlciBhZGRpbmcgJHtpbmRleFNwZWN9IGF0IGAgKw0KICAgICAgICAgICAgICAgICAgICBgJHtpbmRleFBhdGh9IHRvIHlvdXIgc2VjdXJpdHkgcnVsZXMgZm9yIGJldHRlciBwZXJmb3JtYW5jZS5gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZWZyZXNoQXV0aFRva2VuKHRva2VuKSB7DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IHRva2VuOw0KICAgICAgICB0aGlzLmxvZ18oJ0F1dGggdG9rZW4gcmVmcmVzaGVkJyk7DQogICAgICAgIGlmICh0aGlzLmF1dGhUb2tlbl8pIHsNCiAgICAgICAgICAgIHRoaXMudHJ5QXV0aCgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLiBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlDQogICAgICAgICAgICAvL3RoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lIGF1dGhlbnRpY2F0ZWQgbmV4dCB0aW1lIHdlIGNvbm5lY3QuDQogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdCgndW5hdXRoJywge30sICgpID0+IHsgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZWR1Y2VSZWNvbm5lY3REZWxheUlmQWRtaW5DcmVkZW50aWFsXyh0b2tlbik7DQogICAgfQ0KICAgIHJlZHVjZVJlY29ubmVjdERlbGF5SWZBZG1pbkNyZWRlbnRpYWxfKGNyZWRlbnRpYWwpIHsNCiAgICAgICAgLy8gTk9URTogVGhpcyBpc24ndCBpbnRlbmRlZCB0byBiZSBidWxsZXRwcm9vZiAoYSBtYWxpY2lvdXMgZGV2ZWxvcGVyIGNhbiBhbHdheXMganVzdCBtb2RpZnkgdGhlIGNsaWVudCkuDQogICAgICAgIC8vIEFkZGl0aW9uYWxseSwgd2UgZG9uJ3QgYm90aGVyIHJlc2V0dGluZyB0aGUgbWF4IGRlbGF5IGJhY2sgdG8gdGhlIGRlZmF1bHQgaWYgYXV0aCBmYWlscyAvIGV4cGlyZXMuDQogICAgICAgIGNvbnN0IGlzRmlyZWJhc2VTZWNyZXQgPSBjcmVkZW50aWFsICYmIGNyZWRlbnRpYWwubGVuZ3RoID09PSA0MDsNCiAgICAgICAgaWYgKGlzRmlyZWJhc2VTZWNyZXQgfHwgaXNBZG1pbihjcmVkZW50aWFsKSkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdBZG1pbiBhdXRoIGNyZWRlbnRpYWwgZGV0ZWN0ZWQuICBSZWR1Y2luZyBtYXggcmVjb25uZWN0IHRpbWUuJyk7DQogICAgICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZWZyZXNoQXBwQ2hlY2tUb2tlbih0b2tlbikgew0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gdG9rZW47DQogICAgICAgIHRoaXMubG9nXygnQXBwIGNoZWNrIHRva2VuIHJlZnJlc2hlZCcpOw0KICAgICAgICBpZiAodGhpcy5hcHBDaGVja1Rva2VuXykgew0KICAgICAgICAgICAgdGhpcy50cnlBcHBDaGVjaygpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLg0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlIHRoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lDQogICAgICAgICAgICAvLyBhdXRoZW50aWNhdGVkIG5leHQgdGltZSB3ZSBjb25uZWN0Lg0KICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykgew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ3VuYXBwZWNrJywge30sICgpID0+IHsgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIGNyZWRlbnRpYWxzLiBJZiB0aGUgYXV0aGVudGljYXRpb24gYXR0ZW1wdCBmYWlscywgaXQncyB0cmlnZ2VyZWQgbGlrZQ0KICAgICAqIGEgYXV0aCByZXZva2VkICh0aGUgY29ubmVjdGlvbiBpcyBjbG9zZWQpLg0KICAgICAqLw0KICAgIHRyeUF1dGgoKSB7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8gJiYgdGhpcy5hdXRoVG9rZW5fKSB7DQogICAgICAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aFRva2VuXzsNCiAgICAgICAgICAgIGNvbnN0IGF1dGhNZXRob2QgPSBpc1ZhbGlkRm9ybWF0KHRva2VuKSA/ICdhdXRoJyA6ICdnYXV0aCc7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHsgY3JlZDogdG9rZW4gfTsNCiAgICAgICAgICAgIGlmICh0aGlzLmF1dGhPdmVycmlkZV8gPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnbm9hdXRoJ10gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRoaXMuYXV0aE92ZXJyaWRlXyA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnYXV0aHZhciddID0gdGhpcy5hdXRoT3ZlcnJpZGVfOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhdXRoTWV0aG9kLCByZXF1ZXN0RGF0YSwgKHJlcykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IHJlc1sgLypzdGF0dXMqLydzJ107DQogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc1sgLypkYXRhKi8nZCddIHx8ICdlcnJvcic7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0aFRva2VuXyA9PT0gdG9rZW4pIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXJzIHJlY29ubmVjdCBhbmQgZm9yY2UgcmVmcmVzaCBmb3IgYXV0aCB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkF1dGhSZXZva2VkXyhzdGF0dXMsIGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIHRva2VuLiBJZiB0aGUgYXV0aGVudGljYXRpb24NCiAgICAgKiBhdHRlbXB0IGZhaWxzLCBpdCdzIHRyaWdnZXJlZCBsaWtlIHRoZSB0b2tlbiB3YXMgcmV2b2tlZCAodGhlIGNvbm5lY3Rpb24gaXMNCiAgICAgKiBjbG9zZWQpLg0KICAgICAqLw0KICAgIHRyeUFwcENoZWNrKCkgew0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfICYmIHRoaXMuYXBwQ2hlY2tUb2tlbl8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ2FwcGNoZWNrJywgeyAndG9rZW4nOiB0aGlzLmFwcENoZWNrVG9rZW5fIH0sIChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXNbIC8qc3RhdHVzKi8ncyddOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNbIC8qZGF0YSovJ2QnXSB8fCAnZXJyb3InOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQXBwQ2hlY2tSZXZva2VkXyhzdGF0dXMsIGRhdGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBpbmhlcml0RG9jDQogICAgICovDQogICAgdW5saXN0ZW4ocXVlcnksIHRhZykgew0KICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gY2FsbGVkIGZvciAnICsgcGF0aFN0cmluZyArICcgJyArIHF1ZXJ5SWQpOw0KICAgICAgICBhc3NlcnQocXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpIHx8ICFxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCksICd1bmxpc3RlbigpIGNhbGxlZCBmb3Igbm9uLWRlZmF1bHQgYnV0IGNvbXBsZXRlIHF1ZXJ5Jyk7DQogICAgICAgIGNvbnN0IGxpc3RlbiA9IHRoaXMucmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKTsNCiAgICAgICAgaWYgKGxpc3RlbiAmJiB0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeS5fcXVlcnlPYmplY3QsIHRhZyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeU9iaiwgdGFnKSB7DQogICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gb24gJyArIHBhdGhTdHJpbmcgKyAnIGZvciAnICsgcXVlcnlJZCk7DQogICAgICAgIGNvbnN0IHJlcSA9IHsgLypwYXRoKi8gcDogcGF0aFN0cmluZyB9Ow0KICAgICAgICBjb25zdCBhY3Rpb24gPSAnbic7DQogICAgICAgIC8vIE9ubHkgYm90aGVyIHNlbmRpbmcgcXVlcnlJZCBpZiBpdCdzIG5vbi1kZWZhdWx0Lg0KICAgICAgICBpZiAodGFnKSB7DQogICAgICAgICAgICByZXFbJ3EnXSA9IHF1ZXJ5T2JqOw0KICAgICAgICAgICAgcmVxWyd0J10gPSB0YWc7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcSk7DQogICAgfQ0KICAgIG9uRGlzY29ubmVjdFB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKSB7DQogICAgICAgIHRoaXMuaW5pdENvbm5lY3Rpb25fKCk7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZE9uRGlzY29ubmVjdF8oJ28nLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICAgICAgICAgIGFjdGlvbjogJ28nLA0KICAgICAgICAgICAgICAgIGRhdGEsDQogICAgICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EaXNjb25uZWN0TWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRPbkRpc2Nvbm5lY3RfKCdvbScsIHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RSZXF1ZXN0UXVldWVfLnB1c2goew0KICAgICAgICAgICAgICAgIHBhdGhTdHJpbmcsDQogICAgICAgICAgICAgICAgYWN0aW9uOiAnb20nLA0KICAgICAgICAgICAgICAgIGRhdGEsDQogICAgICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EaXNjb25uZWN0Q2FuY2VsKHBhdGhTdHJpbmcsIG9uQ29tcGxldGUpIHsNCiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbl8oKTsNCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykgew0KICAgICAgICAgICAgdGhpcy5zZW5kT25EaXNjb25uZWN0Xygnb2MnLCBwYXRoU3RyaW5nLCBudWxsLCBvbkNvbXBsZXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICAgICAgICAgIGFjdGlvbjogJ29jJywNCiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLA0KICAgICAgICAgICAgICAgIG9uQ29tcGxldGUNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRPbkRpc2Nvbm5lY3RfKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgew0KICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKnBhdGgqLyBwOiBwYXRoU3RyaW5nLCAvKmRhdGEqLyBkOiBkYXRhIH07DQogICAgICAgIHRoaXMubG9nXygnb25EaXNjb25uZWN0ICcgKyBhY3Rpb24sIHJlcXVlc3QpOw0KICAgICAgICB0aGlzLnNlbmRSZXF1ZXN0KGFjdGlvbiwgcmVxdWVzdCwgKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICBpZiAob25Db21wbGV0ZSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKHJlc3BvbnNlWyAvKnN0YXR1cyovJ3MnXSwgcmVzcG9uc2VbIC8qIGRhdGEgKi8nZCddKTsNCiAgICAgICAgICAgICAgICB9LCBNYXRoLmZsb29yKDApKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7DQogICAgICAgIHRoaXMucHV0SW50ZXJuYWwoJ3AnLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKTsNCiAgICB9DQogICAgbWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkgew0KICAgICAgICB0aGlzLnB1dEludGVybmFsKCdtJywgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCk7DQogICAgfQ0KICAgIHB1dEludGVybmFsKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gew0KICAgICAgICAgICAgLypwYXRoKi8gcDogcGF0aFN0cmluZywNCiAgICAgICAgICAgIC8qZGF0YSovIGQ6IGRhdGENCiAgICAgICAgfTsNCiAgICAgICAgaWYgKGhhc2ggIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgcmVxdWVzdFsgLypoYXNoKi8naCddID0gaGFzaDsNCiAgICAgICAgfQ0KICAgICAgICAvLyBUT0RPOiBPbmx5IGtlZXAgdHJhY2sgb2YgdGhlIG1vc3QgcmVjZW50IHB1dCBmb3IgYSBnaXZlbiBwYXRoPw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c18ucHVzaCh7DQogICAgICAgICAgICBhY3Rpb24sDQogICAgICAgICAgICByZXF1ZXN0LA0KICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XysrOw0KICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGggLSAxOw0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRQdXRfKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnQnVmZmVyaW5nIHB1dDogJyArIHBhdGhTdHJpbmcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRQdXRfKGluZGV4KSB7DQogICAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF0uYWN0aW9uOw0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5yZXF1ZXN0Ow0KICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5vbkNvbXBsZXRlOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c19baW5kZXhdLnF1ZXVlZCA9IHRoaXMuY29ubmVjdGVkXzsNCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcXVlc3QsIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvZ18oYWN0aW9uICsgJyByZXNwb25zZScsIG1lc3NhZ2UpOw0KICAgICAgICAgICAgZGVsZXRlIHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF07DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfLS07DQogICAgICAgICAgICAvLyBDbGVhbiB1cCBhcnJheSBvY2Nhc2lvbmFsbHkuDQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XyA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRzXyA9IFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKG1lc3NhZ2VbIC8qc3RhdHVzKi8ncyddLCBtZXNzYWdlWyAvKiBkYXRhICovJ2QnXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICByZXBvcnRTdGF0cyhzdGF0cykgew0KICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCB3ZSBqdXN0IGRyb3AgdGhlIHN0YXRzLg0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKmNvdW50ZXJzKi8gYzogc3RhdHMgfTsNCiAgICAgICAgICAgIHRoaXMubG9nXygncmVwb3J0U3RhdHMnLCByZXF1ZXN0KTsNCiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoLypzdGF0cyovICdzJywgcmVxdWVzdCwgcmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXN1bHRbIC8qc3RhdHVzKi8ncyddOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JSZWFzb24gPSByZXN1bHRbIC8qIGRhdGEgKi8nZCddOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ3JlcG9ydFN0YXRzJywgJ0Vycm9yIHNlbmRpbmcgc3RhdHM6ICcgKyBlcnJvclJlYXNvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EYXRhTWVzc2FnZV8obWVzc2FnZSkgew0KICAgICAgICBpZiAoJ3InIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIC8vIHRoaXMgaXMgYSByZXNwb25zZQ0KICAgICAgICAgICAgdGhpcy5sb2dfKCdmcm9tIHNlcnZlcjogJyArIHN0cmluZ2lmeShtZXNzYWdlKSk7DQogICAgICAgICAgICBjb25zdCByZXFOdW0gPSBtZXNzYWdlWydyJ107DQogICAgICAgICAgICBjb25zdCBvblJlc3BvbnNlID0gdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dOw0KICAgICAgICAgICAgaWYgKG9uUmVzcG9uc2UpIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dOw0KICAgICAgICAgICAgICAgIG9uUmVzcG9uc2UobWVzc2FnZVsgLypib2R5Ki8nYiddKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgnZXJyb3InIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIHRocm93ICdBIHNlcnZlci1zaWRlIGVycm9yIGhhcyBvY2N1cnJlZDogJyArIG1lc3NhZ2VbJ2Vycm9yJ107DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoJ2EnIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIC8vIGEgYW5kIGIgYXJlIGFjdGlvbiBhbmQgYm9keSwgcmVzcGVjdGl2ZWx5DQogICAgICAgICAgICB0aGlzLm9uRGF0YVB1c2hfKG1lc3NhZ2VbJ2EnXSwgbWVzc2FnZVsnYiddKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkRhdGFQdXNoXyhhY3Rpb24sIGJvZHkpIHsNCiAgICAgICAgdGhpcy5sb2dfKCdoYW5kbGVTZXJ2ZXJNZXNzYWdlJywgYWN0aW9uLCBib2R5KTsNCiAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2QnKSB7DQogICAgICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8oYm9keVsgLypwYXRoKi8ncCddLCBib2R5WyAvKmRhdGEqLydkJ10sIA0KICAgICAgICAgICAgLyppc01lcmdlKi8gZmFsc2UsIGJvZHlbJ3QnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnbScpIHsNCiAgICAgICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyhib2R5WyAvKnBhdGgqLydwJ10sIGJvZHlbIC8qZGF0YSovJ2QnXSwgDQogICAgICAgICAgICAvKmlzTWVyZ2U9Ki8gdHJ1ZSwgYm9keVsndCddKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdjJykgew0KICAgICAgICAgICAgdGhpcy5vbkxpc3RlblJldm9rZWRfKGJvZHlbIC8qcGF0aCovJ3AnXSwgYm9keVsgLypxdWVyeSovJ3EnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYWMnKSB7DQogICAgICAgICAgICB0aGlzLm9uQXV0aFJldm9rZWRfKGJvZHlbIC8qc3RhdHVzIGNvZGUqLydzJ10sIGJvZHlbIC8qIGV4cGxhbmF0aW9uICovJ2QnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYXBjJykgew0KICAgICAgICAgICAgdGhpcy5vbkFwcENoZWNrUmV2b2tlZF8oYm9keVsgLypzdGF0dXMgY29kZSovJ3MnXSwgYm9keVsgLyogZXhwbGFuYXRpb24gKi8nZCddKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdzZCcpIHsNCiAgICAgICAgICAgIHRoaXMub25TZWN1cml0eURlYnVnUGFja2V0Xyhib2R5KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGVycm9yJDEoJ1VucmVjb2duaXplZCBhY3Rpb24gcmVjZWl2ZWQgZnJvbSBzZXJ2ZXI6ICcgKw0KICAgICAgICAgICAgICAgIHN0cmluZ2lmeShhY3Rpb24pICsNCiAgICAgICAgICAgICAgICAnXG5BcmUgeW91IHVzaW5nIHRoZSBsYXRlc3QgY2xpZW50PycpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uUmVhZHlfKHRpbWVzdGFtcCwgc2Vzc2lvbklkKSB7DQogICAgICAgIHRoaXMubG9nXygnY29ubmVjdGlvbiByZWFkeScpOw0KICAgICAgICB0aGlzLmNvbm5lY3RlZF8gPSB0cnVlOw0KICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICB0aGlzLmhhbmRsZVRpbWVzdGFtcF8odGltZXN0YW1wKTsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gc2Vzc2lvbklkOw0KICAgICAgICBpZiAodGhpcy5maXJzdENvbm5lY3Rpb25fKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRDb25uZWN0U3RhdHNfKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZXN0b3JlU3RhdGVfKCk7DQogICAgICAgIHRoaXMuZmlyc3RDb25uZWN0aW9uXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLm9uQ29ubmVjdFN0YXR1c18odHJ1ZSk7DQogICAgfQ0KICAgIHNjaGVkdWxlQ29ubmVjdF8odGltZW91dCkgew0KICAgICAgICBhc3NlcnQoIXRoaXMucmVhbHRpbWVfLCAiU2NoZWR1bGluZyBhIGNvbm5lY3Qgd2hlbiB3ZSdyZSBhbHJlYWR5IGNvbm5lY3RlZC9pbmc/Iik7DQogICAgICAgIGlmICh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pOw0KICAgICAgICB9DQogICAgICAgIC8vIE5PVEU6IEV2ZW4gd2hlbiB0aW1lb3V0IGlzIDAsIGl0J3MgaW1wb3J0YW50IHRvIGRvIGEgc2V0VGltZW91dCB0byB3b3JrIGFyb3VuZCBhbiBpbmZ1cmlhdGluZyAiU2VjdXJpdHkgRXJyb3IiIGluDQogICAgICAgIC8vIEZpcmVmb3ggd2hlbiB0cnlpbmcgdG8gd3JpdGUgdG8gb3VyIGxvbmctcG9sbGluZyBpZnJhbWUgaW4gc29tZSBzY2VuYXJpb3MgKGUuZy4gRm9yZ2Ugb3Igb3VyIHVuaXQgdGVzdHMpLg0KICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8gPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyA9IG51bGw7DQogICAgICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25fKCk7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB9LCBNYXRoLmZsb29yKHRpbWVvdXQpKTsNCiAgICB9DQogICAgaW5pdENvbm5lY3Rpb25fKCkgew0KICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfICYmIHRoaXMuZmlyc3RDb25uZWN0aW9uXykgew0KICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uVmlzaWJsZV8odmlzaWJsZSkgew0KICAgICAgICAvLyBOT1RFOiBUYWJiaW5nIGF3YXkgYW5kIGJhY2sgdG8gYSB3aW5kb3cgd2lsbCBkZWZlYXQgb3VyIHJlY29ubmVjdCBiYWNrb2ZmLCBidXQgSSB0aGluayB0aGF0J3MgZmluZS4NCiAgICAgICAgaWYgKHZpc2libGUgJiYNCiAgICAgICAgICAgICF0aGlzLnZpc2libGVfICYmDQogICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9PT0gdGhpcy5tYXhSZWNvbm5lY3REZWxheV8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2luZG93IGJlY2FtZSB2aXNpYmxlLiAgUmVkdWNpbmcgZGVsYXkuJyk7DQogICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NSU5fREVMQVk7DQogICAgICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMudmlzaWJsZV8gPSB2aXNpYmxlOw0KICAgIH0NCiAgICBvbk9ubGluZV8ob25saW5lKSB7DQogICAgICAgIGlmIChvbmxpbmUpIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnQnJvd3NlciB3ZW50IG9ubGluZS4nKTsNCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTsNCiAgICAgICAgICAgIGlmICghdGhpcy5yZWFsdGltZV8pIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQ29ubmVjdF8oMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0Jyb3dzZXIgd2VudCBvZmZsaW5lLiAgS2lsbGluZyBjb25uZWN0aW9uLicpOw0KICAgICAgICAgICAgaWYgKHRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5yZWFsdGltZV8uY2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvblJlYWx0aW1lRGlzY29ubmVjdF8oKSB7DQogICAgICAgIHRoaXMubG9nXygnZGF0YSBjbGllbnQgZGlzY29ubmVjdGVkJyk7DQogICAgICAgIHRoaXMuY29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnJlYWx0aW1lXyA9IG51bGw7DQogICAgICAgIC8vIFNpbmNlIHdlIGRvbid0IGtub3cgaWYgb3VyIHNlbnQgdHJhbnNhY3Rpb25zIHN1Y2NlZWRlZCBvciBub3QsIHdlIG5lZWQgdG8gY2FuY2VsIHRoZW0uDQogICAgICAgIHRoaXMuY2FuY2VsU2VudFRyYW5zYWN0aW9uc18oKTsNCiAgICAgICAgLy8gQ2xlYXIgb3V0IHRoZSBwZW5kaW5nIHJlcXVlc3RzLg0KICAgICAgICB0aGlzLnJlcXVlc3RDQkhhc2hfID0ge307DQogICAgICAgIGlmICh0aGlzLnNob3VsZFJlY29ubmVjdF8oKSkgew0KICAgICAgICAgICAgaWYgKCF0aGlzLnZpc2libGVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCJXaW5kb3cgaXNuJ3QgdmlzaWJsZS4gIERlbGF5aW5nIHJlY29ubmVjdC4iKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IHRoaXMubWF4UmVjb25uZWN0RGVsYXlfOw0KICAgICAgICAgICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25BdHRlbXB0VGltZV8gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfKSB7DQogICAgICAgICAgICAgICAgLy8gSWYgd2UndmUgYmVlbiBjb25uZWN0ZWQgbG9uZyBlbm91Z2gsIHJlc2V0IHJlY29ubmVjdCBkZWxheSB0byBtaW5pbXVtLg0KICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDb25uZWN0U3VjY2VlZGVkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXzsNCiAgICAgICAgICAgICAgICBpZiAodGltZVNpbmNlTGFzdENvbm5lY3RTdWNjZWVkZWQgPiBSRUNPTk5FQ1RfREVMQVlfUkVTRVRfVElNRU9VVCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NSU5fREVMQVk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDb25uZWN0QXR0ZW1wdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5sYXN0Q29ubmVjdGlvbkF0dGVtcHRUaW1lXzsNCiAgICAgICAgICAgIGxldCByZWNvbm5lY3REZWxheSA9IE1hdGgubWF4KDAsIHRoaXMucmVjb25uZWN0RGVsYXlfIC0gdGltZVNpbmNlTGFzdENvbm5lY3RBdHRlbXB0KTsNCiAgICAgICAgICAgIHJlY29ubmVjdERlbGF5ID0gTWF0aC5yYW5kb20oKSAqIHJlY29ubmVjdERlbGF5Ow0KICAgICAgICAgICAgdGhpcy5sb2dfKCdUcnlpbmcgdG8gcmVjb25uZWN0IGluICcgKyByZWNvbm5lY3REZWxheSArICdtcycpOw0KICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKHJlY29ubmVjdERlbGF5KTsNCiAgICAgICAgICAgIC8vIEFkanVzdCByZWNvbm5lY3QgZGVsYXkgZm9yIG5leHQgdGltZS4NCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gTWF0aC5taW4odGhpcy5tYXhSZWNvbm5lY3REZWxheV8sIHRoaXMucmVjb25uZWN0RGVsYXlfICogUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMub25Db25uZWN0U3RhdHVzXyhmYWxzZSk7DQogICAgfQ0KICAgIGFzeW5jIGVzdGFibGlzaENvbm5lY3Rpb25fKCkgew0KICAgICAgICBpZiAodGhpcy5zaG91bGRSZWNvbm5lY3RfKCkpIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnTWFraW5nIGEgY29ubmVjdGlvbiBhdHRlbXB0Jyk7DQogICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uQXR0ZW1wdFRpbWVfID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBvbkRhdGFNZXNzYWdlID0gdGhpcy5vbkRhdGFNZXNzYWdlXy5iaW5kKHRoaXMpOw0KICAgICAgICAgICAgY29uc3Qgb25SZWFkeSA9IHRoaXMub25SZWFkeV8uYmluZCh0aGlzKTsNCiAgICAgICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMub25SZWFsdGltZURpc2Nvbm5lY3RfLmJpbmQodGhpcyk7DQogICAgICAgICAgICBjb25zdCBjb25uSWQgPSB0aGlzLmlkICsgJzonICsgUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dENvbm5lY3Rpb25JZF8rKzsNCiAgICAgICAgICAgIGNvbnN0IGxhc3RTZXNzaW9uSWQgPSB0aGlzLmxhc3RTZXNzaW9uSWQ7DQogICAgICAgICAgICBsZXQgY2FuY2VsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGxldCBjb25uZWN0aW9uID0gbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IGNsb3NlRm4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBvbkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgY29uc3Qgc2VuZFJlcXVlc3RGbiA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICAgICAgICAgICAgICBhc3NlcnQoY29ubmVjdGlvbiwgInNlbmRSZXF1ZXN0IGNhbGwgd2hlbiB3ZSdyZSBub3QgY29ubmVjdGVkIG5vdCBhbGxvd2VkLiIpOw0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VuZFJlcXVlc3QobXNnKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0aGlzLnJlYWx0aW1lXyA9IHsNCiAgICAgICAgICAgICAgICBjbG9zZTogY2xvc2VGbiwNCiAgICAgICAgICAgICAgICBzZW5kUmVxdWVzdDogc2VuZFJlcXVlc3RGbg0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGNvbnN0IGZvcmNlUmVmcmVzaCA9IHRoaXMuZm9yY2VUb2tlblJlZnJlc2hfOw0KICAgICAgICAgICAgdGhpcy5mb3JjZVRva2VuUmVmcmVzaF8gPSBmYWxzZTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgLy8gRmlyc3QgZmV0Y2ggYXV0aCBhbmQgYXBwIGNoZWNrIHRva2VuLCBhbmQgZXN0YWJsaXNoIGNvbm5lY3Rpb24gYWZ0ZXINCiAgICAgICAgICAgICAgICAvLyBmZXRjaGluZyB0aGUgdG9rZW4gd2FzIHN1Y2Nlc3NmdWwNCiAgICAgICAgICAgICAgICBjb25zdCBbYXV0aFRva2VuLCBhcHBDaGVja1Rva2VuXSA9IGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfLmdldFRva2VuKGZvcmNlUmVmcmVzaCkNCiAgICAgICAgICAgICAgICBdKTsNCiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbGVkKSB7DQogICAgICAgICAgICAgICAgICAgIGxvZygnZ2V0VG9rZW4oKSBjb21wbGV0ZWQuIENyZWF0aW5nIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IGF1dGhUb2tlbiAmJiBhdXRoVG9rZW4uYWNjZXNzVG9rZW47DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbl8gPSBhcHBDaGVja1Rva2VuICYmIGFwcENoZWNrVG9rZW4udG9rZW47DQogICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbihjb25uSWQsIHRoaXMucmVwb0luZm9fLCB0aGlzLmFwcGxpY2F0aW9uSWRfLCB0aGlzLmFwcENoZWNrVG9rZW5fLCB0aGlzLmF1dGhUb2tlbl8sIG9uRGF0YU1lc3NhZ2UsIG9uUmVhZHksIG9uRGlzY29ubmVjdCwgDQogICAgICAgICAgICAgICAgICAgIC8qIG9uS2lsbD0gKi8gcmVhc29uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm4ocmVhc29uICsgJyAoJyArIHRoaXMucmVwb0luZm9fLnRvU3RyaW5nKCkgKyAnKScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQoU0VSVkVSX0tJTExfSU5URVJSVVBUX1JFQVNPTik7DQogICAgICAgICAgICAgICAgICAgIH0sIGxhc3RTZXNzaW9uSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nKCdnZXRUb2tlbigpIGNvbXBsZXRlZCBidXQgd2FzIGNhbmNlbGVkJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdGYWlsZWQgdG8gZ2V0IHRva2VuOiAnICsgZXJyb3IpOw0KICAgICAgICAgICAgICAgIGlmICghY2FuY2VsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVwb0luZm9fLm5vZGVBZG1pbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtYXkgYmUgYSBjcml0aWNhbCBlcnJvciBmb3IgdGhlIEFkbWluIE5vZGUuanMgU0RLLCBzbyBsb2cgYSB3YXJuaW5nLg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnV0IGdldFRva2VuKCkgbWF5IGFsc28ganVzdCBoYXZlIHRlbXBvcmFyaWx5IGZhaWxlZCwgc28gd2Ugc3RpbGwgd2FudCB0bw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgcmV0cnlpbmcuDQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuKGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjbG9zZUZuKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGludGVycnVwdChyZWFzb24pIHsNCiAgICAgICAgbG9nKCdJbnRlcnJ1cHRpbmcgY29ubmVjdGlvbiBmb3IgcmVhc29uOiAnICsgcmVhc29uKTsNCiAgICAgICAgdGhpcy5pbnRlcnJ1cHRSZWFzb25zX1tyZWFzb25dID0gdHJ1ZTsNCiAgICAgICAgaWYgKHRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICB0aGlzLnJlYWx0aW1lXy5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXykgew0KICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pOw0KICAgICAgICAgICAgICAgIHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vblJlYWx0aW1lRGlzY29ubmVjdF8oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXN1bWUocmVhc29uKSB7DQogICAgICAgIGxvZygnUmVzdW1pbmcgY29ubmVjdGlvbiBmb3IgcmVhc29uOiAnICsgcmVhc29uKTsNCiAgICAgICAgZGVsZXRlIHRoaXMuaW50ZXJydXB0UmVhc29uc19bcmVhc29uXTsNCiAgICAgICAgaWYgKGlzRW1wdHkodGhpcy5pbnRlcnJ1cHRSZWFzb25zXykpIHsNCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTsNCiAgICAgICAgICAgIGlmICghdGhpcy5yZWFsdGltZV8pIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQ29ubmVjdF8oMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaGFuZGxlVGltZXN0YW1wXyh0aW1lc3RhbXApIHsNCiAgICAgICAgY29uc3QgZGVsdGEgPSB0aW1lc3RhbXAgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgICAgdGhpcy5vblNlcnZlckluZm9VcGRhdGVfKHsgc2VydmVyVGltZU9mZnNldDogZGVsdGEgfSk7DQogICAgfQ0KICAgIGNhbmNlbFNlbnRUcmFuc2FjdGlvbnNfKCkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgY29uc3QgcHV0ID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2ldOw0KICAgICAgICAgICAgaWYgKHB1dCAmJiAvKmhhc2gqLyAnaCcgaW4gcHV0LnJlcXVlc3QgJiYgcHV0LnF1ZXVlZCkgew0KICAgICAgICAgICAgICAgIGlmIChwdXQub25Db21wbGV0ZSkgew0KICAgICAgICAgICAgICAgICAgICBwdXQub25Db21wbGV0ZSgnZGlzY29ubmVjdCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2ldOw0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRDb3VudF8tLTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBDbGVhbiB1cCBhcnJheSBvY2Nhc2lvbmFsbHkuDQogICAgICAgIGlmICh0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfID09PSAwKSB7DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c18gPSBbXTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkxpc3RlblJldm9rZWRfKHBhdGhTdHJpbmcsIHF1ZXJ5KSB7DQogICAgICAgIC8vIFJlbW92ZSB0aGUgbGlzdGVuIGFuZCBtYW51ZmFjdHVyZSBhICJwZXJtaXNzaW9uX2RlbmllZCIgZXJyb3IgZm9yIHRoZSBmYWlsZWQgbGlzdGVuLg0KICAgICAgICBsZXQgcXVlcnlJZDsNCiAgICAgICAgaWYgKCFxdWVyeSkgew0KICAgICAgICAgICAgcXVlcnlJZCA9ICdkZWZhdWx0JzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHF1ZXJ5SWQgPSBxdWVyeS5tYXAocSA9PiBPYmplY3RUb1VuaXF1ZUtleShxKSkuam9pbignJCcpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGxpc3RlbiA9IHRoaXMucmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKTsNCiAgICAgICAgaWYgKGxpc3RlbiAmJiBsaXN0ZW4ub25Db21wbGV0ZSkgew0KICAgICAgICAgICAgbGlzdGVuLm9uQ29tcGxldGUoJ3Blcm1pc3Npb25fZGVuaWVkJyk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKSB7DQogICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoU3RyaW5nID0gbmV3IFBhdGgocGF0aFN0cmluZykudG9TdHJpbmcoKTsgLy8gbm9ybWFsaXplIHBhdGguDQogICAgICAgIGxldCBsaXN0ZW47DQogICAgICAgIGlmICh0aGlzLmxpc3RlbnMuaGFzKG5vcm1hbGl6ZWRQYXRoU3RyaW5nKSkgew0KICAgICAgICAgICAgY29uc3QgbWFwID0gdGhpcy5saXN0ZW5zLmdldChub3JtYWxpemVkUGF0aFN0cmluZyk7DQogICAgICAgICAgICBsaXN0ZW4gPSBtYXAuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICAgICAgbWFwLmRlbGV0ZShxdWVyeUlkKTsNCiAgICAgICAgICAgIGlmIChtYXAuc2l6ZSA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVucy5kZWxldGUobm9ybWFsaXplZFBhdGhTdHJpbmcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gYWxsIGxpc3RlbnMgZm9yIHRoaXMgcGF0aCBoYXMgYWxyZWFkeSBiZWVuIHJlbW92ZWQNCiAgICAgICAgICAgIGxpc3RlbiA9IHVuZGVmaW5lZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGlzdGVuOw0KICAgIH0NCiAgICBvbkF1dGhSZXZva2VkXyhzdGF0dXNDb2RlLCBleHBsYW5hdGlvbikgew0KICAgICAgICBsb2coJ0F1dGggdG9rZW4gcmV2b2tlZDogJyArIHN0YXR1c0NvZGUgKyAnLycgKyBleHBsYW5hdGlvbik7DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IG51bGw7DQogICAgICAgIHRoaXMuZm9yY2VUb2tlblJlZnJlc2hfID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5yZWFsdGltZV8uY2xvc2UoKTsNCiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09ICdpbnZhbGlkX3Rva2VuJyB8fCBzdGF0dXNDb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgICAgICAvLyBXZSdsbCB3YWl0IGEgY291cGxlIHRpbWVzIGJlZm9yZSBsb2dnaW5nIHRoZSB3YXJuaW5nIC8gaW5jcmVhc2luZyB0aGUNCiAgICAgICAgICAgIC8vIHJldHJ5IHBlcmlvZCBzaW5jZSBvYXV0aCB0b2tlbnMgd2lsbCByZXBvcnQgYXMgImludmFsaWQiIGlmIHRoZXkncmUNCiAgICAgICAgICAgIC8vIGp1c3QgZXhwaXJlZC4gUGx1cyB0aGVyZSBtYXkgYmUgdHJhbnNpZW50IGlzc3VlcyB0aGF0IHJlc29sdmUgdGhlbXNlbHZlcy4NCiAgICAgICAgICAgIHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XysrOw0KICAgICAgICAgICAgaWYgKHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XyA+PSBJTlZBTElEX1RPS0VOX1RIUkVTSE9MRCkgew0KICAgICAgICAgICAgICAgIC8vIFNldCBhIGxvbmcgcmVjb25uZWN0IGRlbGF5IGJlY2F1c2UgcmVjb3ZlcnkgaXMgdW5saWtlbHkNCiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUzsNCiAgICAgICAgICAgICAgICAvLyBOb3RpZnkgdGhlIGF1dGggdG9rZW4gcHJvdmlkZXIgdGhhdCB0aGUgdG9rZW4gaXMgaW52YWxpZCwgd2hpY2ggd2lsbCBsb2cNCiAgICAgICAgICAgICAgICAvLyBhIHdhcm5pbmcNCiAgICAgICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5ub3RpZnlGb3JJbnZhbGlkVG9rZW4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkFwcENoZWNrUmV2b2tlZF8oc3RhdHVzQ29kZSwgZXhwbGFuYXRpb24pIHsNCiAgICAgICAgbG9nKCdBcHAgY2hlY2sgdG9rZW4gcmV2b2tlZDogJyArIHN0YXR1c0NvZGUgKyAnLycgKyBleHBsYW5hdGlvbik7DQogICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbl8gPSBudWxsOw0KICAgICAgICB0aGlzLmZvcmNlVG9rZW5SZWZyZXNoXyA9IHRydWU7DQogICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGNsb3NlIHRoZSBjb25uZWN0aW9uIGFzIHRoZSBkZXZlbG9wZXIgbWF5IG5vdCBoYXZlDQogICAgICAgIC8vIGVuZm9yY2VtZW50IGVuYWJsZWQuIFRoZSBiYWNrZW5kIGNsb3NlcyBjb25uZWN0aW9ucyB3aXRoIGVuZm9yY2VtZW50cy4NCiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09ICdpbnZhbGlkX3Rva2VuJyB8fCBzdGF0dXNDb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgICAgICAvLyBXZSdsbCB3YWl0IGEgY291cGxlIHRpbWVzIGJlZm9yZSBsb2dnaW5nIHRoZSB3YXJuaW5nIC8gaW5jcmVhc2luZyB0aGUNCiAgICAgICAgICAgIC8vIHJldHJ5IHBlcmlvZCBzaW5jZSBvYXV0aCB0b2tlbnMgd2lsbCByZXBvcnQgYXMgImludmFsaWQiIGlmIHRoZXkncmUNCiAgICAgICAgICAgIC8vIGp1c3QgZXhwaXJlZC4gUGx1cyB0aGVyZSBtYXkgYmUgdHJhbnNpZW50IGlzc3VlcyB0aGF0IHJlc29sdmUgdGhlbXNlbHZlcy4NCiAgICAgICAgICAgIHRoaXMuaW52YWxpZEFwcENoZWNrVG9rZW5Db3VudF8rKzsNCiAgICAgICAgICAgIGlmICh0aGlzLmludmFsaWRBcHBDaGVja1Rva2VuQ291bnRfID49IElOVkFMSURfVE9LRU5fVEhSRVNIT0xEKSB7DQogICAgICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfLm5vdGlmeUZvckludmFsaWRUb2tlbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2VjdXJpdHlEZWJ1Z1BhY2tldF8oYm9keSkgew0KICAgICAgICBpZiAodGhpcy5zZWN1cml0eURlYnVnQ2FsbGJhY2tfKSB7DQogICAgICAgICAgICB0aGlzLnNlY3VyaXR5RGVidWdDYWxsYmFja18oYm9keSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAoJ21zZycgaW4gYm9keSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGSVJFQkFTRTogJyArIGJvZHlbJ21zZyddLnJlcGxhY2UoJ1xuJywgJ1xuRklSRUJBU0U6ICcpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXN0b3JlU3RhdGVfKCkgew0KICAgICAgICAvL1JlLWF1dGhlbnRpY2F0ZSBvdXJzZWx2ZXMgaWYgd2UgaGF2ZSBhIGNyZWRlbnRpYWwgc3RvcmVkLg0KICAgICAgICB0aGlzLnRyeUF1dGgoKTsNCiAgICAgICAgdGhpcy50cnlBcHBDaGVjaygpOw0KICAgICAgICAvLyBQdXRzIGRlcGVuZCBvbiBoYXZpbmcgcmVjZWl2ZWQgdGhlIGNvcnJlc3BvbmRpbmcgZGF0YSB1cGRhdGUgZnJvbSB0aGUgc2VydmVyIGJlZm9yZSB0aGV5IGNvbXBsZXRlLCBzbyB3ZSBtdXN0DQogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBzZW5kIGxpc3RlbnMgYmVmb3JlIHB1dHMuDQogICAgICAgIGZvciAoY29uc3QgcXVlcmllcyBvZiB0aGlzLmxpc3RlbnMudmFsdWVzKCkpIHsNCiAgICAgICAgICAgIGZvciAoY29uc3QgbGlzdGVuU3BlYyBvZiBxdWVyaWVzLnZhbHVlcygpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kTGlzdGVuXyhsaXN0ZW5TcGVjKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpXSkgew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFB1dF8oaSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgd2hpbGUgKHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLm9uRGlzY29ubmVjdFJlcXVlc3RRdWV1ZV8uc2hpZnQoKTsNCiAgICAgICAgICAgIHRoaXMuc2VuZE9uRGlzY29ubmVjdF8ocmVxdWVzdC5hY3Rpb24sIHJlcXVlc3QucGF0aFN0cmluZywgcmVxdWVzdC5kYXRhLCByZXF1ZXN0Lm9uQ29tcGxldGUpOw0KICAgICAgICB9DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vdXRzdGFuZGluZ0dldHNfLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ0dldHNfW2ldKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kR2V0XyhpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZW5kcyBjbGllbnQgc3RhdHMgZm9yIGZpcnN0IGNvbm5lY3Rpb24NCiAgICAgKi8NCiAgICBzZW5kQ29ubmVjdFN0YXRzXygpIHsNCiAgICAgICAgY29uc3Qgc3RhdHMgPSB7fTsNCiAgICAgICAgbGV0IGNsaWVudE5hbWUgPSAnanMnOw0KICAgICAgICBzdGF0c1snc2RrLicgKyBjbGllbnROYW1lICsgJy4nICsgU0RLX1ZFUlNJT04ucmVwbGFjZSgvXC4vZywgJy0nKV0gPSAxOw0KICAgICAgICBpZiAoaXNNb2JpbGVDb3Jkb3ZhKCkpIHsNCiAgICAgICAgICAgIHN0YXRzWydmcmFtZXdvcmsuY29yZG92YSddID0gMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChpc1JlYWN0TmF0aXZlKCkpIHsNCiAgICAgICAgICAgIHN0YXRzWydmcmFtZXdvcmsucmVhY3RuYXRpdmUnXSA9IDE7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZXBvcnRTdGF0cyhzdGF0cyk7DQogICAgfQ0KICAgIHNob3VsZFJlY29ubmVjdF8oKSB7DQogICAgICAgIGNvbnN0IG9ubGluZSA9IE9ubGluZU1vbml0b3IuZ2V0SW5zdGFuY2UoKS5jdXJyZW50bHlPbmxpbmUoKTsNCiAgICAgICAgcmV0dXJuIGlzRW1wdHkodGhpcy5pbnRlcnJ1cHRSZWFzb25zXykgJiYgb25saW5lOw0KICAgIH0NCn0NClBlcnNpc3RlbnRDb25uZWN0aW9uLm5leHRQZXJzaXN0ZW50Q29ubmVjdGlvbklkXyA9IDA7DQovKioNCiAqIENvdW50ZXIgZm9yIG51bWJlciBvZiBjb25uZWN0aW9ucyBjcmVhdGVkLiBNYWlubHkgdXNlZCBmb3IgdGFnZ2luZyBpbiB0aGUgbG9ncw0KICovDQpQZXJzaXN0ZW50Q29ubmVjdGlvbi5uZXh0Q29ubmVjdGlvbklkXyA9IDA7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBOYW1lZE5vZGUgew0KICAgIGNvbnN0cnVjdG9yKG5hbWUsIG5vZGUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTsNCiAgICB9DQogICAgc3RhdGljIFdyYXAobmFtZSwgbm9kZSkgew0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCBub2RlKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBJbmRleCB7DQogICAgLyoqDQogICAgICogQHJldHVybnMgQSBzdGFuZGFsb25lIGNvbXBhcmlzb24gZnVuY3Rpb24gZm9yDQogICAgICogdGhpcyBpbmRleA0KICAgICAqLw0KICAgIGdldENvbXBhcmUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUuYmluZCh0aGlzKTsNCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYSBiZWZvcmUgYW5kIGFmdGVyIHZhbHVlIGZvciBhIG5vZGUsIGRldGVybWluZSBpZiB0aGUgaW5kZXhlZCB2YWx1ZSBoYXMgY2hhbmdlZC4gRXZlbiBpZiB0aGV5IGFyZSBkaWZmZXJlbnQsDQogICAgICogaXQncyBwb3NzaWJsZSB0aGF0IHRoZSBjaGFuZ2VzIGFyZSBpc29sYXRlZCB0byBwYXJ0cyBvZiB0aGUgc25hcHNob3QgdGhhdCBhcmUgbm90IGluZGV4ZWQuDQogICAgICoNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHBvcnRpb24gb2YgdGhlIHNuYXBzaG90IGJlaW5nIGluZGV4ZWQgY2hhbmdlZCBiZXR3ZWVuIG9sZE5vZGUgYW5kIG5ld05vZGUNCiAgICAgKi8NCiAgICBpbmRleGVkVmFsdWVDaGFuZ2VkKG9sZE5vZGUsIG5ld05vZGUpIHsNCiAgICAgICAgY29uc3Qgb2xkV3JhcHBlZCA9IG5ldyBOYW1lZE5vZGUoTUlOX05BTUUsIG9sZE5vZGUpOw0KICAgICAgICBjb25zdCBuZXdXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShNSU5fTkFNRSwgbmV3Tm9kZSk7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUob2xkV3JhcHBlZCwgbmV3V3JhcHBlZCkgIT09IDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIGEgbm9kZSB3cmFwcGVyIHRoYXQgd2lsbCBzb3J0IGVxdWFsIHRvIG9yIGxlc3MgdGhhbg0KICAgICAqIGFueSBvdGhlciBub2RlIHdyYXBwZXIsIHVzaW5nIHRoaXMgaW5kZXgNCiAgICAgKi8NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgX19FTVBUWV9OT0RFOw0KY2xhc3MgS2V5SW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgc3RhdGljIGdldCBfX0VNUFRZX05PREUoKSB7DQogICAgICAgIHJldHVybiBfX0VNUFRZX05PREU7DQogICAgfQ0KICAgIHN0YXRpYyBzZXQgX19FTVBUWV9OT0RFKHZhbCkgew0KICAgICAgICBfX0VNUFRZX05PREUgPSB2YWw7DQogICAgfQ0KICAgIGNvbXBhcmUoYSwgYikgew0KICAgICAgICByZXR1cm4gbmFtZUNvbXBhcmUoYS5uYW1lLCBiLm5hbWUpOw0KICAgIH0NCiAgICBpc0RlZmluZWRPbihub2RlKSB7DQogICAgICAgIC8vIFdlIGNvdWxkIHByb2JhYmx5IHJldHVybiB0cnVlIGhlcmUgKHNpbmNlIGV2ZXJ5IG5vZGUgaGFzIGEga2V5KSwgYnV0IGl0J3MgbmV2ZXIgY2FsbGVkDQogICAgICAgIC8vIHNvIGp1c3QgbGVhdmluZyB1bmltcGxlbWVudGVkIGZvciBub3cuDQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdLZXlJbmRleC5pc0RlZmluZWRPbiBub3QgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkLicpOw0KICAgIH0NCiAgICBpbmRleGVkVmFsdWVDaGFuZ2VkKG9sZE5vZGUsIG5ld05vZGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBUaGUga2V5IGZvciBhIG5vZGUgbmV2ZXIgY2hhbmdlcy4NCiAgICB9DQogICAgbWluUG9zdCgpIHsNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgcmV0dXJuIE5hbWVkTm9kZS5NSU47DQogICAgfQ0KICAgIG1heFBvc3QoKSB7DQogICAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIHJlYWxseSBiZSBjcmVhdGVkIG9uY2UgYW5kIGNhY2hlZCBpbiBhIHN0YXRpYyBwcm9wZXJ0eSwgYnV0DQogICAgICAgIC8vIE5hbWVkTm9kZSBpc24ndCBkZWZpbmVkIHlldCwgc28gSSBjYW4ndCB1c2UgaXQgaW4gYSBzdGF0aWMuICBCbGVoLg0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShNQVhfTkFNRSwgX19FTVBUWV9OT0RFKTsNCiAgICB9DQogICAgbWFrZVBvc3QoaW5kZXhWYWx1ZSwgbmFtZSkgew0KICAgICAgICBhc3NlcnQodHlwZW9mIGluZGV4VmFsdWUgPT09ICdzdHJpbmcnLCAnS2V5SW5kZXggaW5kZXhWYWx1ZSBtdXN0IGFsd2F5cyBiZSBhIHN0cmluZy4nKTsNCiAgICAgICAgLy8gV2UganVzdCB1c2UgZW1wdHkgbm9kZSwgYnV0IGl0J2xsIG5ldmVyIGJlIGNvbXBhcmVkLCBzaW5jZSBvdXIgY29tcGFyYXRvciBvbmx5IGxvb2tzIGF0IG5hbWUuDQogICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKGluZGV4VmFsdWUsIF9fRU1QVFlfTk9ERSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFN0cmluZyByZXByZXNlbnRhdGlvbiBmb3IgaW5jbHVzaW9uIGluIGEgcXVlcnkgc3BlYw0KICAgICAqLw0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gJy5rZXknOw0KICAgIH0NCn0NCmNvbnN0IEtFWV9JTkRFWCA9IG5ldyBLZXlJbmRleCgpOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBbiBpdGVyYXRvciBvdmVyIGFuIExMUkJOb2RlLg0KICovDQpjbGFzcyBTb3J0ZWRNYXBJdGVyYXRvciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG5vZGUgLSBOb2RlIHRvIGl0ZXJhdGUuDQogICAgICogQHBhcmFtIGlzUmV2ZXJzZV8gLSBXaGV0aGVyIG9yIG5vdCB0byBpdGVyYXRlIGluIHJldmVyc2UNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihub2RlLCBzdGFydEtleSwgY29tcGFyYXRvciwgaXNSZXZlcnNlXywgcmVzdWx0R2VuZXJhdG9yXyA9IG51bGwpIHsNCiAgICAgICAgdGhpcy5pc1JldmVyc2VfID0gaXNSZXZlcnNlXzsNCiAgICAgICAgdGhpcy5yZXN1bHRHZW5lcmF0b3JfID0gcmVzdWx0R2VuZXJhdG9yXzsNCiAgICAgICAgdGhpcy5ub2RlU3RhY2tfID0gW107DQogICAgICAgIGxldCBjbXAgPSAxOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBub2RlID0gbm9kZTsNCiAgICAgICAgICAgIGNtcCA9IHN0YXJ0S2V5ID8gY29tcGFyYXRvcihub2RlLmtleSwgc3RhcnRLZXkpIDogMTsNCiAgICAgICAgICAgIC8vIGZsaXAgdGhlIGNvbXBhcmlzb24gaWYgd2UncmUgZ29pbmcgaW4gcmV2ZXJzZQ0KICAgICAgICAgICAgaWYgKGlzUmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICBjbXAgKj0gLTE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY21wIDwgMCkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBsZXNzIHRoYW4gb3VyIHN0YXJ0IGtleS4gaWdub3JlIGl0DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlXykgew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21wID09PSAwKSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGV4YWN0bHkgZXF1YWwgdG8gb3VyIHN0YXJ0IGtleS4gUHVzaCBpdCBvbiB0aGUgc3RhY2ssIGJ1dCBzdG9wIGl0ZXJhdGluZzsNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBncmVhdGVyIHRoYW4gb3VyIHN0YXJ0IGtleSwgYWRkIGl0IHRvIHRoZSBzdGFjayBhbmQgbW92ZSB0byB0aGUgbmV4dCBvbmUNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1JldmVyc2VfKSB7DQogICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnJpZ2h0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZ2V0TmV4dCgpIHsNCiAgICAgICAgaWYgKHRoaXMubm9kZVN0YWNrXy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGxldCBub2RlID0gdGhpcy5ub2RlU3RhY2tfLnBvcCgpOw0KICAgICAgICBsZXQgcmVzdWx0Ow0KICAgICAgICBpZiAodGhpcy5yZXN1bHRHZW5lcmF0b3JfKSB7DQogICAgICAgICAgICByZXN1bHQgPSB0aGlzLnJlc3VsdEdlbmVyYXRvcl8obm9kZS5rZXksIG5vZGUudmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmVzdWx0ID0geyBrZXk6IG5vZGUua2V5LCB2YWx1ZTogbm9kZS52YWx1ZSB9Ow0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmlzUmV2ZXJzZV8pIHsNCiAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7DQogICAgICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2tfLnB1c2gobm9kZSk7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDsNCiAgICAgICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KICAgIGhhc05leHQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm5vZGVTdGFja18ubGVuZ3RoID4gMDsNCiAgICB9DQogICAgcGVlaygpIHsNCiAgICAgICAgaWYgKHRoaXMubm9kZVN0YWNrXy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGVTdGFja19bdGhpcy5ub2RlU3RhY2tfLmxlbmd0aCAtIDFdOw0KICAgICAgICBpZiAodGhpcy5yZXN1bHRHZW5lcmF0b3JfKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRHZW5lcmF0b3JfKG5vZGUua2V5LCBub2RlLnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB7IGtleTogbm9kZS5rZXksIHZhbHVlOiBub2RlLnZhbHVlIH07DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFJlcHJlc2VudHMgYSBub2RlIGluIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFjayB0cmVlLg0KICovDQpjbGFzcyBMTFJCTm9kZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIEtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBub2RlLg0KICAgICAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG5vZGUuDQogICAgICogQHBhcmFtIGNvbG9yIC0gV2hldGhlciB0aGlzIG5vZGUgaXMgcmVkLg0KICAgICAqIEBwYXJhbSBsZWZ0IC0gTGVmdCBjaGlsZC4NCiAgICAgKiBAcGFyYW0gcmlnaHQgLSBSaWdodCBjaGlsZC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgdGhpcy5rZXkgPSBrZXk7DQogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yICE9IG51bGwgPyBjb2xvciA6IExMUkJOb2RlLlJFRDsNCiAgICAgICAgdGhpcy5sZWZ0ID0NCiAgICAgICAgICAgIGxlZnQgIT0gbnVsbCA/IGxlZnQgOiBTb3J0ZWRNYXAuRU1QVFlfTk9ERTsNCiAgICAgICAgdGhpcy5yaWdodCA9DQogICAgICAgICAgICByaWdodCAhPSBudWxsID8gcmlnaHQgOiBTb3J0ZWRNYXAuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgbm9kZSwgb3B0aW9uYWxseSByZXBsYWNpbmcgcGllY2VzIG9mIGl0Lg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIE5ldyBrZXkgZm9yIHRoZSBub2RlLCBvciBudWxsLg0KICAgICAqIEBwYXJhbSB2YWx1ZSAtIE5ldyB2YWx1ZSBmb3IgdGhlIG5vZGUsIG9yIG51bGwuDQogICAgICogQHBhcmFtIGNvbG9yIC0gTmV3IGNvbG9yIGZvciB0aGUgbm9kZSwgb3IgbnVsbC4NCiAgICAgKiBAcGFyYW0gbGVmdCAtIE5ldyBsZWZ0IGNoaWxkIGZvciB0aGUgbm9kZSwgb3IgbnVsbC4NCiAgICAgKiBAcGFyYW0gcmlnaHQgLSBOZXcgcmlnaHQgY2hpbGQgZm9yIHRoZSBub2RlLCBvciBudWxsLg0KICAgICAqIEByZXR1cm5zIFRoZSBub2RlIGNvcHkuDQogICAgICovDQogICAgY29weShrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXkgIT0gbnVsbCA/IGtleSA6IHRoaXMua2V5LCB2YWx1ZSAhPSBudWxsID8gdmFsdWUgOiB0aGlzLnZhbHVlLCBjb2xvciAhPSBudWxsID8gY29sb3IgOiB0aGlzLmNvbG9yLCBsZWZ0ICE9IG51bGwgPyBsZWZ0IDogdGhpcy5sZWZ0LCByaWdodCAhPSBudWxsID8gcmlnaHQgOiB0aGlzLnJpZ2h0KTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBjb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5jb3VudCgpICsgMSArIHRoaXMucmlnaHQuY291bnQoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdHJlZSBpcyBlbXB0eS4NCiAgICAgKi8NCiAgICBpc0VtcHR5KCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2ggbm9kZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBhY3Rpb24gLSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2gNCiAgICAgKiAgIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXkNCiAgICAgKiAgIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbg0KICAgICAqLw0KICAgIGlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiAodGhpcy5sZWZ0Lmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB8fA0KICAgICAgICAgICAgISFhY3Rpb24odGhpcy5rZXksIHRoaXMudmFsdWUpIHx8DQogICAgICAgICAgICB0aGlzLnJpZ2h0Lmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb24NCiAgICAgKiBmb3IgZWFjaCBub2RlLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaA0KICAgICAqIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiAodGhpcy5yaWdodC5yZXZlcnNlVHJhdmVyc2FsKGFjdGlvbikgfHwNCiAgICAgICAgICAgIGFjdGlvbih0aGlzLmtleSwgdGhpcy52YWx1ZSkgfHwNCiAgICAgICAgICAgIHRoaXMubGVmdC5yZXZlcnNlVHJhdmVyc2FsKGFjdGlvbikpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWluaW11bSBub2RlIGluIHRoZSB0cmVlLg0KICAgICAqLw0KICAgIG1pbl8oKSB7DQogICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlZnQubWluXygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBtaW5LZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm1pbl8oKS5rZXk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBtYXhLZXkoKSB7DQogICAgICAgIGlmICh0aGlzLnJpZ2h0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMua2V5Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQubWF4S2V5KCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIEtleSB0byBpbnNlcnQuDQogICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gaW5zZXJ0Lg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUga2V5L3ZhbHVlIGFkZGVkLg0KICAgICAqLw0KICAgIGluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSB7DQogICAgICAgIGxldCBuID0gdGhpczsNCiAgICAgICAgY29uc3QgY21wID0gY29tcGFyYXRvcihrZXksIG4ua2V5KTsNCiAgICAgICAgaWYgKGNtcCA8IDApIHsNCiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbi5sZWZ0Lmluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoY21wID09PSAwKSB7DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIHZhbHVlLCBudWxsLCBudWxsLCBudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbi5yaWdodC5pbnNlcnQoa2V5LCB2YWx1ZSwgY29tcGFyYXRvcikpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuLmZpeFVwXygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUgbWluaW11bSBrZXkgcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmVNaW5fKCkgew0KICAgICAgICBpZiAodGhpcy5sZWZ0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIFNvcnRlZE1hcC5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGxldCBuID0gdGhpczsNCiAgICAgICAgaWYgKCFuLmxlZnQuaXNSZWRfKCkgJiYgIW4ubGVmdC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5tb3ZlUmVkTGVmdF8oKTsNCiAgICAgICAgfQ0KICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG4ubGVmdC5yZW1vdmVNaW5fKCksIG51bGwpOw0KICAgICAgICByZXR1cm4gbi5maXhVcF8oKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgb2YgdGhlIGl0ZW0gdG8gcmVtb3ZlLg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGl0ZW0gcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmUoa2V5LCBjb21wYXJhdG9yKSB7DQogICAgICAgIGxldCBuLCBzbWFsbGVzdDsNCiAgICAgICAgbiA9IHRoaXM7DQogICAgICAgIGlmIChjb21wYXJhdG9yKGtleSwgbi5rZXkpIDwgMCkgew0KICAgICAgICAgICAgaWYgKCFuLmxlZnQuaXNFbXB0eSgpICYmICFuLmxlZnQuaXNSZWRfKCkgJiYgIW4ubGVmdC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICAgICAgbiA9IG4ubW92ZVJlZExlZnRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG4ubGVmdC5yZW1vdmUoa2V5LCBjb21wYXJhdG9yKSwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAobi5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICAgICAgbiA9IG4ucm90YXRlUmlnaHRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW4ucmlnaHQuaXNFbXB0eSgpICYmICFuLnJpZ2h0LmlzUmVkXygpICYmICFuLnJpZ2h0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgICAgICBuID0gbi5tb3ZlUmVkUmlnaHRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY29tcGFyYXRvcihrZXksIG4ua2V5KSA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChuLnJpZ2h0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gU29ydGVkTWFwLkVNUFRZX05PREU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzbWFsbGVzdCA9IG4ucmlnaHQubWluXygpOw0KICAgICAgICAgICAgICAgICAgICBuID0gbi5jb3B5KHNtYWxsZXN0LmtleSwgc21hbGxlc3QudmFsdWUsIG51bGwsIG51bGwsIG4ucmlnaHQucmVtb3ZlTWluXygpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIG4ucmlnaHQucmVtb3ZlKGtleSwgY29tcGFyYXRvcikpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuLmZpeFVwXygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgaXMgYSBSRUQgbm9kZS4NCiAgICAgKi8NCiAgICBpc1JlZF8oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbG9yOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSBhZnRlciBwZXJmb3JtaW5nIGFueSBuZWVkZWQgcm90YXRpb25zLg0KICAgICAqLw0KICAgIGZpeFVwXygpIHsNCiAgICAgICAgbGV0IG4gPSB0aGlzOw0KICAgICAgICBpZiAobi5yaWdodC5pc1JlZF8oKSAmJiAhbi5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5yb3RhdGVMZWZ0XygpOw0KICAgICAgICB9DQogICAgICAgIGlmIChuLmxlZnQuaXNSZWRfKCkgJiYgbi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIG4gPSBuLnJvdGF0ZVJpZ2h0XygpOw0KICAgICAgICB9DQogICAgICAgIGlmIChuLmxlZnQuaXNSZWRfKCkgJiYgbi5yaWdodC5pc1JlZF8oKSkgew0KICAgICAgICAgICAgbiA9IG4uY29sb3JGbGlwXygpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgbW92ZVJlZExlZnQuDQogICAgICovDQogICAgbW92ZVJlZExlZnRfKCkgew0KICAgICAgICBsZXQgbiA9IHRoaXMuY29sb3JGbGlwXygpOw0KICAgICAgICBpZiAobi5yaWdodC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIG4ucmlnaHQucm90YXRlUmlnaHRfKCkpOw0KICAgICAgICAgICAgbiA9IG4ucm90YXRlTGVmdF8oKTsNCiAgICAgICAgICAgIG4gPSBuLmNvbG9yRmxpcF8oKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbjsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIGFmdGVyIG1vdmVSZWRSaWdodC4NCiAgICAgKi8NCiAgICBtb3ZlUmVkUmlnaHRfKCkgew0KICAgICAgICBsZXQgbiA9IHRoaXMuY29sb3JGbGlwXygpOw0KICAgICAgICBpZiAobi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIG4gPSBuLnJvdGF0ZVJpZ2h0XygpOw0KICAgICAgICAgICAgbiA9IG4uY29sb3JGbGlwXygpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgcm90YXRlTGVmdC4NCiAgICAgKi8NCiAgICByb3RhdGVMZWZ0XygpIHsNCiAgICAgICAgY29uc3QgbmwgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuUkVELCBudWxsLCB0aGlzLnJpZ2h0LmxlZnQpOw0KICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIG5sLCBudWxsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIGFmdGVyIHJvdGF0ZVJpZ2h0Lg0KICAgICAqLw0KICAgIHJvdGF0ZVJpZ2h0XygpIHsNCiAgICAgICAgY29uc3QgbnIgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuUkVELCB0aGlzLmxlZnQucmlnaHQsIG51bGwpOw0KICAgICAgICByZXR1cm4gdGhpcy5sZWZ0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgbnVsbCwgbnIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXd0IHJlZSwgYWZ0ZXIgY29sb3JGbGlwLg0KICAgICAqLw0KICAgIGNvbG9yRmxpcF8oKSB7DQogICAgICAgIGNvbnN0IGxlZnQgPSB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCAhdGhpcy5sZWZ0LmNvbG9yLCBudWxsLCBudWxsKTsNCiAgICAgICAgY29uc3QgcmlnaHQgPSB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgIXRoaXMucmlnaHQuY29sb3IsIG51bGwsIG51bGwpOw0KICAgICAgICByZXR1cm4gdGhpcy5jb3B5KG51bGwsIG51bGwsICF0aGlzLmNvbG9yLCBsZWZ0LCByaWdodCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEZvciB0ZXN0aW5nLg0KICAgICAqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBhbGwgaXMgd2VsbC4NCiAgICAgKi8NCiAgICBjaGVja01heERlcHRoXygpIHsNCiAgICAgICAgY29uc3QgYmxhY2tEZXB0aCA9IHRoaXMuY2hlY2tfKCk7DQogICAgICAgIHJldHVybiBNYXRoLnBvdygyLjAsIGJsYWNrRGVwdGgpIDw9IHRoaXMuY291bnQoKSArIDE7DQogICAgfQ0KICAgIGNoZWNrXygpIHsNCiAgICAgICAgaWYgKHRoaXMuaXNSZWRfKCkgJiYgdGhpcy5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZCBub2RlIGhhcyByZWQgY2hpbGQoJyArIHRoaXMua2V5ICsgJywnICsgdGhpcy52YWx1ZSArICcpJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMucmlnaHQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmlnaHQgY2hpbGQgb2YgKCcgKyB0aGlzLmtleSArICcsJyArIHRoaXMudmFsdWUgKyAnKSBpcyByZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBibGFja0RlcHRoID0gdGhpcy5sZWZ0LmNoZWNrXygpOw0KICAgICAgICBpZiAoYmxhY2tEZXB0aCAhPT0gdGhpcy5yaWdodC5jaGVja18oKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCbGFjayBkZXB0aHMgZGlmZmVyJyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gYmxhY2tEZXB0aCArICh0aGlzLmlzUmVkXygpID8gMCA6IDEpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KTExSQk5vZGUuUkVEID0gdHJ1ZTsNCkxMUkJOb2RlLkJMQUNLID0gZmFsc2U7DQovKioNCiAqIFJlcHJlc2VudHMgYW4gZW1wdHkgbm9kZSAoYSBsZWFmIG5vZGUgaW4gdGhlIFJlZC1CbGFjayBUcmVlKS4NCiAqLw0KY2xhc3MgTExSQkVtcHR5Tm9kZSB7DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgbm9kZS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRoZSBub2RlIGNvcHkuDQogICAgICovDQogICAgY29weShrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSB0cmVlLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5L3ZhbHVlIGFkZGVkLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIEtleSB0byBiZSBhZGRlZC4NCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byBiZSBhZGRlZC4NCiAgICAgKiBAcGFyYW0gY29tcGFyYXRvciAtIENvbXBhcmF0b3IuDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIHdpdGggaXRlbSBhZGRlZC4NCiAgICAgKi8NCiAgICBpbnNlcnQoa2V5LCB2YWx1ZSwgY29tcGFyYXRvcikgew0KICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKGtleSwgdmFsdWUsIG51bGwpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gcmVtb3ZlLg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCBpdGVtIHJlbW92ZWQuDQogICAgICovDQogICAgcmVtb3ZlKGtleSwgY29tcGFyYXRvcikgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBjb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRyZWUgaXMgZW1wdHkuDQogICAgICovDQogICAgaXNFbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2ggbm9kZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBhY3Rpb24gLSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2gNCiAgICAgKiBub2RlLiAgSWYgaXQgcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC4NCiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRyYXZlcnNhbCB3YXMgYWJvcnRlZC4NCiAgICAgKi8NCiAgICBpbm9yZGVyVHJhdmVyc2FsKGFjdGlvbikgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb24NCiAgICAgKiBmb3IgZWFjaCBub2RlLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaA0KICAgICAqIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgbWluS2V5KCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbWF4S2V5KCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgY2hlY2tfKCkgew0KICAgICAgICByZXR1cm4gMDsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgV2hldGhlciB0aGlzIG5vZGUgaXMgcmVkLg0KICAgICAqLw0KICAgIGlzUmVkXygpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCi8qKg0KICogQW4gaW1tdXRhYmxlIHNvcnRlZCBtYXAgaW1wbGVtZW50YXRpb24sIGJhc2VkIG9uIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFjaw0KICogdHJlZS4NCiAqLw0KY2xhc3MgU29ydGVkTWFwIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gY29tcGFyYXRvcl8gLSBLZXkgY29tcGFyYXRvci4NCiAgICAgKiBAcGFyYW0gcm9vdF8gLSBPcHRpb25hbCByb290IG5vZGUgZm9yIHRoZSBtYXAuDQogICAgICovDQogICAgY29uc3RydWN0b3IoY29tcGFyYXRvcl8sIHJvb3RfID0gU29ydGVkTWFwLkVNUFRZX05PREUpIHsNCiAgICAgICAgdGhpcy5jb21wYXJhdG9yXyA9IGNvbXBhcmF0b3JfOw0KICAgICAgICB0aGlzLnJvb3RfID0gcm9vdF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQgb3IgcmVwbGFjZWQuDQogICAgICogKFRPRE86IFdlIHNob3VsZCBwZXJoYXBzIHJlbmFtZSB0aGlzIG1ldGhvZCB0byAncHV0JykNCiAgICAgKg0KICAgICAqIEBwYXJhbSBrZXkgLSBLZXkgdG8gYmUgYWRkZWQuDQogICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gYmUgYWRkZWQuDQogICAgICogQHJldHVybnMgTmV3IG1hcCwgd2l0aCBpdGVtIGFkZGVkLg0KICAgICAqLw0KICAgIGluc2VydChrZXksIHZhbHVlKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvcl8sIHRoaXMucm9vdF8NCiAgICAgICAgICAgIC5pbnNlcnQoa2V5LCB2YWx1ZSwgdGhpcy5jb21wYXJhdG9yXykNCiAgICAgICAgICAgIC5jb3B5KG51bGwsIG51bGwsIExMUkJOb2RlLkJMQUNLLCBudWxsLCBudWxsKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkgcmVtb3ZlZC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBrZXkgLSBUaGUga2V5IHRvIHJlbW92ZS4NCiAgICAgKiBAcmV0dXJucyBOZXcgbWFwLCB3aXRoIGl0ZW0gcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmUoa2V5KSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvcl8sIHRoaXMucm9vdF8NCiAgICAgICAgICAgIC5yZW1vdmUoa2V5LCB0aGlzLmNvbXBhcmF0b3JfKQ0KICAgICAgICAgICAgLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuQkxBQ0ssIG51bGwsIG51bGwpKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG5vZGUgd2l0aCB0aGUgZ2l2ZW4ga2V5LCBvciBudWxsLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gbG9vayB1cC4NCiAgICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgb2YgdGhlIG5vZGUgd2l0aCB0aGUgZ2l2ZW4ga2V5LCBvciBudWxsIGlmIHRoZQ0KICAgICAqIGtleSBkb2Vzbid0IGV4aXN0Lg0KICAgICAqLw0KICAgIGdldChrZXkpIHsNCiAgICAgICAgbGV0IGNtcDsNCiAgICAgICAgbGV0IG5vZGUgPSB0aGlzLnJvb3RfOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBjbXAgPSB0aGlzLmNvbXBhcmF0b3JfKGtleSwgbm9kZS5rZXkpOw0KICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBub2RlLnZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21wIDwgMCkgew0KICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbXAgPiAwKSB7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIGtleSBvZiB0aGUgaXRlbSAqYmVmb3JlKiB0aGUgc3BlY2lmaWVkIGtleSwgb3IgbnVsbCBpZiBrZXkgaXMgdGhlIGZpcnN0IGl0ZW0uDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gZmluZCB0aGUgcHJlZGVjZXNzb3Igb2YNCiAgICAgKiBAcmV0dXJucyBUaGUgcHJlZGVjZXNzb3Iga2V5Lg0KICAgICAqLw0KICAgIGdldFByZWRlY2Vzc29yS2V5KGtleSkgew0KICAgICAgICBsZXQgY21wLCBub2RlID0gdGhpcy5yb290XywgcmlnaHRQYXJlbnQgPSBudWxsOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBjbXAgPSB0aGlzLmNvbXBhcmF0b3JfKGtleSwgbm9kZS5rZXkpOw0KICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGlmICghbm9kZS5sZWZ0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIW5vZGUucmlnaHQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5rZXk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJpZ2h0UGFyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByaWdodFBhcmVudC5rZXk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gZmlyc3QgaXRlbS4NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbXAgPCAwKSB7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA+IDApIHsNCiAgICAgICAgICAgICAgICByaWdodFBhcmVudCA9IG5vZGU7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gZmluZCBwcmVkZWNlc3NvciBrZXkgZm9yIGEgbm9uZXhpc3RlbnQga2V5LiAgV2hhdCBnaXZlcz8nKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWFwIGlzIGVtcHR5Lg0KICAgICAqLw0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLmlzRW1wdHkoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgbWFwLg0KICAgICAqLw0KICAgIGNvdW50KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yb290Xy5jb3VudCgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWluaW11bSBrZXkgaW4gdGhlIG1hcC4NCiAgICAgKi8NCiAgICBtaW5LZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLm1pbktleSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWF4aW11bSBrZXkgaW4gdGhlIG1hcC4NCiAgICAgKi8NCiAgICBtYXhLZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLm1heEtleSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBUcmF2ZXJzZXMgdGhlIG1hcCBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkDQogICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuICBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC4NCiAgICAgKiBAcmV0dXJucyBUaGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5DQogICAgICogICB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24NCiAgICAgKi8NCiAgICBpbm9yZGVyVHJhdmVyc2FsKGFjdGlvbikgew0KICAgICAgICByZXR1cm4gdGhpcy5yb290Xy5pbm9yZGVyVHJhdmVyc2FsKGFjdGlvbik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgbWFwIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvbg0KICAgICAqIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZA0KICAgICAqIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiAgSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLnJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhbiBpdGVyYXRvciBvdmVyIHRoZSBTb3J0ZWRNYXAuDQogICAgICogQHJldHVybnMgVGhlIGl0ZXJhdG9yLg0KICAgICAqLw0KICAgIGdldEl0ZXJhdG9yKHJlc3VsdEdlbmVyYXRvcikgew0KICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcEl0ZXJhdG9yKHRoaXMucm9vdF8sIG51bGwsIHRoaXMuY29tcGFyYXRvcl8sIGZhbHNlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRJdGVyYXRvckZyb20oa2V5LCByZXN1bHRHZW5lcmF0b3IpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3RfLCBrZXksIHRoaXMuY29tcGFyYXRvcl8sIGZhbHNlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3JGcm9tKGtleSwgcmVzdWx0R2VuZXJhdG9yKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290Xywga2V5LCB0aGlzLmNvbXBhcmF0b3JfLCB0cnVlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3IocmVzdWx0R2VuZXJhdG9yKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290XywgbnVsbCwgdGhpcy5jb21wYXJhdG9yXywgdHJ1ZSwgcmVzdWx0R2VuZXJhdG9yKTsNCiAgICB9DQp9DQovKioNCiAqIEFsd2F5cyB1c2UgdGhlIHNhbWUgZW1wdHkgbm9kZSwgdG8gcmVkdWNlIG1lbW9yeS4NCiAqLw0KU29ydGVkTWFwLkVNUFRZX05PREUgPSBuZXcgTExSQkVtcHR5Tm9kZSgpOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gTkFNRV9PTkxZX0NPTVBBUkFUT1IobGVmdCwgcmlnaHQpIHsNCiAgICByZXR1cm4gbmFtZUNvbXBhcmUobGVmdC5uYW1lLCByaWdodC5uYW1lKTsNCn0NCmZ1bmN0aW9uIE5BTUVfQ09NUEFSQVRPUihsZWZ0LCByaWdodCkgew0KICAgIHJldHVybiBuYW1lQ29tcGFyZShsZWZ0LCByaWdodCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgTUFYX05PREUkMjsNCmZ1bmN0aW9uIHNldE1heE5vZGUkMSh2YWwpIHsNCiAgICBNQVhfTk9ERSQyID0gdmFsOw0KfQ0KY29uc3QgcHJpb3JpdHlIYXNoVGV4dCA9IGZ1bmN0aW9uIChwcmlvcml0eSkgew0KICAgIGlmICh0eXBlb2YgcHJpb3JpdHkgPT09ICdudW1iZXInKSB7DQogICAgICAgIHJldHVybiAnbnVtYmVyOicgKyBkb3VibGVUb0lFRUU3NTRTdHJpbmcocHJpb3JpdHkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuICdzdHJpbmc6JyArIHByaW9yaXR5Ow0KICAgIH0NCn07DQovKioNCiAqIFZhbGlkYXRlcyB0aGF0IGEgcHJpb3JpdHkgc25hcHNob3QgTm9kZSBpcyB2YWxpZC4NCiAqLw0KY29uc3QgdmFsaWRhdGVQcmlvcml0eU5vZGUgPSBmdW5jdGlvbiAocHJpb3JpdHlOb2RlKSB7DQogICAgaWYgKHByaW9yaXR5Tm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgY29uc3QgdmFsID0gcHJpb3JpdHlOb2RlLnZhbCgpOw0KICAgICAgICBhc3NlcnQodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgfHwNCiAgICAgICAgICAgIHR5cGVvZiB2YWwgPT09ICdudW1iZXInIHx8DQogICAgICAgICAgICAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgJiYgY29udGFpbnModmFsLCAnLnN2JykpLCAnUHJpb3JpdHkgbXVzdCBiZSBhIHN0cmluZyBvciBudW1iZXIuJyk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBhc3NlcnQocHJpb3JpdHlOb2RlID09PSBNQVhfTk9ERSQyIHx8IHByaW9yaXR5Tm9kZS5pc0VtcHR5KCksICdwcmlvcml0eSBvZiB1bmV4cGVjdGVkIHR5cGUuJyk7DQogICAgfQ0KICAgIC8vIERvbid0IGNhbGwgZ2V0UHJpb3JpdHkoKSBvbiBNQVhfTk9ERSB0byBhdm9pZCBoaXR0aW5nIGFzc2VydGlvbi4NCiAgICBhc3NlcnQocHJpb3JpdHlOb2RlID09PSBNQVhfTk9ERSQyIHx8IHByaW9yaXR5Tm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKSwgIlByaW9yaXR5IG5vZGVzIGNhbid0IGhhdmUgYSBwcmlvcml0eSBvZiB0aGVpciBvd24uIik7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IF9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3I7DQovKioNCiAqIExlYWZOb2RlIGlzIGEgY2xhc3MgZm9yIHN0b3JpbmcgbGVhZiBub2RlcyBpbiBhIERhdGFTbmFwc2hvdC4gIEl0DQogKiBpbXBsZW1lbnRzIE5vZGUgYW5kIHN0b3JlcyB0aGUgdmFsdWUgb2YgdGhlIG5vZGUgKGEgc3RyaW5nLA0KICogbnVtYmVyLCBvciBib29sZWFuKSBhY2Nlc3NpYmxlIHZpYSBnZXRWYWx1ZSgpLg0KICovDQpjbGFzcyBMZWFmTm9kZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIHZhbHVlXyAtIFRoZSB2YWx1ZSB0byBzdG9yZSBpbiB0aGlzIGxlYWYgbm9kZS4gVGhlIG9iamVjdCB0eXBlIGlzDQogICAgICogcG9zc2libGUgaW4gdGhlIGV2ZW50IG9mIGEgZGVmZXJyZWQgdmFsdWUNCiAgICAgKiBAcGFyYW0gcHJpb3JpdHlOb2RlXyAtIFRoZSBwcmlvcml0eSBvZiB0aGlzIG5vZGUuDQogICAgICovDQogICAgY29uc3RydWN0b3IodmFsdWVfLCBwcmlvcml0eU5vZGVfID0gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFKSB7DQogICAgICAgIHRoaXMudmFsdWVfID0gdmFsdWVfOw0KICAgICAgICB0aGlzLnByaW9yaXR5Tm9kZV8gPSBwcmlvcml0eU5vZGVfOw0KICAgICAgICB0aGlzLmxhenlIYXNoXyA9IG51bGw7DQogICAgICAgIGFzc2VydCh0aGlzLnZhbHVlXyAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmFsdWVfICE9PSBudWxsLCAiTGVhZk5vZGUgc2hvdWxkbid0IGJlIGNyZWF0ZWQgd2l0aCBudWxsL3VuZGVmaW5lZCB2YWx1ZS4iKTsNCiAgICAgICAgdmFsaWRhdGVQcmlvcml0eU5vZGUodGhpcy5wcmlvcml0eU5vZGVfKTsNCiAgICB9DQogICAgc3RhdGljIHNldCBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yKHZhbCkgew0KICAgICAgICBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yID0gdmFsOw0KICAgIH0NCiAgICBzdGF0aWMgZ2V0IF9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IoKSB7DQogICAgICAgIHJldHVybiBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBpc0xlYWZOb2RlKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0UHJpb3JpdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVwZGF0ZVByaW9yaXR5KG5ld1ByaW9yaXR5Tm9kZSkgew0KICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHRoaXMudmFsdWVfLCBuZXdQcmlvcml0eU5vZGUpOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgLy8gSGFjayB0byB0cmVhdCBwcmlvcml0eSBhcyBhIHJlZ3VsYXIgY2hpbGQNCiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldENoaWxkKHBhdGgpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYXRoR2V0RnJvbnQocGF0aCkgPT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5wcmlvcml0eU5vZGVfOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIExlYWZOb2RlLl9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IuRU1QVFlfTk9ERTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBoYXNDaGlsZCgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBnZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGlsZE5hbWUsIGNoaWxkTm9kZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpIHsNCiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVByaW9yaXR5KG5ld0NoaWxkTm9kZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBjaGlsZE5hbWUgIT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpLnVwZGF0ZVByaW9yaXR5KHRoaXMucHJpb3JpdHlOb2RlXyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlQ2hpbGQocGF0aCwgbmV3Q2hpbGROb2RlKSB7DQogICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpOw0KICAgICAgICBpZiAoZnJvbnQgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXdDaGlsZE5vZGU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBmcm9udCAhPT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KGZyb250ICE9PSAnLnByaW9yaXR5JyB8fCBwYXRoR2V0TGVuZ3RoKHBhdGgpID09PSAxLCAnLnByaW9yaXR5IG11c3QgYmUgdGhlIGxhc3QgdG9rZW4gaW4gYSBwYXRoJyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVJbW1lZGlhdGVDaGlsZChmcm9udCwgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFLnVwZGF0ZUNoaWxkKHBhdGhQb3BGcm9udChwYXRoKSwgbmV3Q2hpbGROb2RlKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaXNFbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBudW1DaGlsZHJlbigpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGZvckVhY2hDaGlsZChpbmRleCwgYWN0aW9uKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgdmFsKGV4cG9ydEZvcm1hdCkgew0KICAgICAgICBpZiAoZXhwb3J0Rm9ybWF0ICYmICF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICcudmFsdWUnOiB0aGlzLmdldFZhbHVlKCksDQogICAgICAgICAgICAgICAgJy5wcmlvcml0eSc6IHRoaXMuZ2V0UHJpb3JpdHkoKS52YWwoKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzaCgpIHsNCiAgICAgICAgaWYgKHRoaXMubGF6eUhhc2hfID09PSBudWxsKSB7DQogICAgICAgICAgICBsZXQgdG9IYXNoID0gJyc7DQogICAgICAgICAgICBpZiAoIXRoaXMucHJpb3JpdHlOb2RlXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0b0hhc2ggKz0NCiAgICAgICAgICAgICAgICAgICAgJ3ByaW9yaXR5OicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlIYXNoVGV4dCh0aGlzLnByaW9yaXR5Tm9kZV8udmFsKCkpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICc6JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87DQogICAgICAgICAgICB0b0hhc2ggKz0gdHlwZSArICc6JzsNCiAgICAgICAgICAgIGlmICh0eXBlID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgIHRvSGFzaCArPSBkb3VibGVUb0lFRUU3NTRTdHJpbmcodGhpcy52YWx1ZV8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdG9IYXNoICs9IHRoaXMudmFsdWVfOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSBzaGExKHRvSGFzaCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMubGF6eUhhc2hfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbGVhZiBub2RlLg0KICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBvZiB0aGUgbm9kZS4NCiAgICAgKi8NCiAgICBnZXRWYWx1ZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVfOw0KICAgIH0NCiAgICBjb21wYXJlVG8ob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKG90aGVyIGluc3RhbmNlb2YgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvcikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG90aGVyLmlzTGVhZk5vZGUoKSwgJ1Vua25vd24gbm9kZSB0eXBlJyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlVG9MZWFmTm9kZV8ob3RoZXIpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENvbXBhcmlzb24gc3BlY2lmaWNhbGx5IGZvciB0d28gbGVhZiBub2Rlcw0KICAgICAqLw0KICAgIGNvbXBhcmVUb0xlYWZOb2RlXyhvdGhlckxlYWYpIHsNCiAgICAgICAgY29uc3Qgb3RoZXJMZWFmVHlwZSA9IHR5cGVvZiBvdGhlckxlYWYudmFsdWVfOw0KICAgICAgICBjb25zdCB0aGlzTGVhZlR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87DQogICAgICAgIGNvbnN0IG90aGVySW5kZXggPSBMZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSLmluZGV4T2Yob3RoZXJMZWFmVHlwZSk7DQogICAgICAgIGNvbnN0IHRoaXNJbmRleCA9IExlYWZOb2RlLlZBTFVFX1RZUEVfT1JERVIuaW5kZXhPZih0aGlzTGVhZlR5cGUpOw0KICAgICAgICBhc3NlcnQob3RoZXJJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyBvdGhlckxlYWZUeXBlKTsNCiAgICAgICAgYXNzZXJ0KHRoaXNJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyB0aGlzTGVhZlR5cGUpOw0KICAgICAgICBpZiAob3RoZXJJbmRleCA9PT0gdGhpc0luZGV4KSB7DQogICAgICAgICAgICAvLyBTYW1lIHR5cGUsIGNvbXBhcmUgdmFsdWVzDQogICAgICAgICAgICBpZiAodGhpc0xlYWZUeXBlID09PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgICAgIC8vIERlZmVycmVkIHZhbHVlIG5vZGVzIGFyZSBhbGwgZXF1YWwsIGJ1dCB3ZSBzaG91bGQgYWxzbyBuZXZlciBnZXQgdG8gdGhpcyBwb2ludC4uLg0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgd29ya3MgYmVjYXVzZSB0cnVlID4gZmFsc2UsIGFsbCBvdGhlcnMgYXJlIG51bWJlciBvciBzdHJpbmcgY29tcGFyaXNvbnMNCiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZV8gPCBvdGhlckxlYWYudmFsdWVfKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy52YWx1ZV8gPT09IG90aGVyTGVhZi52YWx1ZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpc0luZGV4IC0gb3RoZXJJbmRleDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB3aXRoSW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICBpc0luZGV4ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChvdGhlci5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IG90aGVyTGVhZiA9IG90aGVyOw0KICAgICAgICAgICAgcmV0dXJuICh0aGlzLnZhbHVlXyA9PT0gb3RoZXJMZWFmLnZhbHVlXyAmJg0KICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdHlOb2RlXy5lcXVhbHMob3RoZXJMZWFmLnByaW9yaXR5Tm9kZV8pKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogVGhlIHNvcnQgb3JkZXIgZm9yIGNvbXBhcmluZyBsZWFmIG5vZGVzIG9mIGRpZmZlcmVudCB0eXBlcy4gSWYgdHdvIGxlYWYgbm9kZXMgaGF2ZQ0KICogdGhlIHNhbWUgdHlwZSwgdGhlIGNvbXBhcmlzb24gZmFsbHMgYmFjayB0byB0aGVpciB2YWx1ZQ0KICovDQpMZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSID0gWydvYmplY3QnLCAnYm9vbGVhbicsICdudW1iZXInLCAnc3RyaW5nJ107CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgbm9kZUZyb21KU09OJDE7DQpsZXQgTUFYX05PREUkMTsNCmZ1bmN0aW9uIHNldE5vZGVGcm9tSlNPTih2YWwpIHsNCiAgICBub2RlRnJvbUpTT04kMSA9IHZhbDsNCn0NCmZ1bmN0aW9uIHNldE1heE5vZGUodmFsKSB7DQogICAgTUFYX05PREUkMSA9IHZhbDsNCn0NCmNsYXNzIFByaW9yaXR5SW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgY29tcGFyZShhLCBiKSB7DQogICAgICAgIGNvbnN0IGFQcmlvcml0eSA9IGEubm9kZS5nZXRQcmlvcml0eSgpOw0KICAgICAgICBjb25zdCBiUHJpb3JpdHkgPSBiLm5vZGUuZ2V0UHJpb3JpdHkoKTsNCiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhUHJpb3JpdHkuY29tcGFyZVRvKGJQcmlvcml0eSk7DQogICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpc0RlZmluZWRPbihub2RlKSB7DQogICAgICAgIHJldHVybiAhbm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKTsNCiAgICB9DQogICAgaW5kZXhlZFZhbHVlQ2hhbmdlZChvbGROb2RlLCBuZXdOb2RlKSB7DQogICAgICAgIHJldHVybiAhb2xkTm9kZS5nZXRQcmlvcml0eSgpLmVxdWFscyhuZXdOb2RlLmdldFByaW9yaXR5KCkpOw0KICAgIH0NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQogICAgbWF4UG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIG5ldyBMZWFmTm9kZSgnW1BSSU9SSVRZLVBPU1RdJywgTUFYX05PREUkMSkpOw0KICAgIH0NCiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7DQogICAgICAgIGNvbnN0IHByaW9yaXR5Tm9kZSA9IG5vZGVGcm9tSlNPTiQxKGluZGV4VmFsdWUpOw0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCBuZXcgTGVhZk5vZGUoJ1tQUklPUklUWS1QT1NUXScsIHByaW9yaXR5Tm9kZSkpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBTdHJpbmcgcmVwcmVzZW50YXRpb24gZm9yIGluY2x1c2lvbiBpbiBhIHF1ZXJ5IHNwZWMNCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICcucHJpb3JpdHknOw0KICAgIH0NCn0NCmNvbnN0IFBSSU9SSVRZX0lOREVYID0gbmV3IFByaW9yaXR5SW5kZXgoKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IExPR18yID0gTWF0aC5sb2coMik7DQpjbGFzcyBCYXNlMTJOdW0gew0KICAgIGNvbnN0cnVjdG9yKGxlbmd0aCkgew0KICAgICAgICBjb25zdCBsb2dCYXNlMiA9IChudW0pID0+IA0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICBwYXJzZUludCgoTWF0aC5sb2cobnVtKSAvIExPR18yKSwgMTApOw0KICAgICAgICBjb25zdCBiaXRNYXNrID0gKGJpdHMpID0+IHBhcnNlSW50KEFycmF5KGJpdHMgKyAxKS5qb2luKCcxJyksIDIpOw0KICAgICAgICB0aGlzLmNvdW50ID0gbG9nQmFzZTIobGVuZ3RoICsgMSk7DQogICAgICAgIHRoaXMuY3VycmVudF8gPSB0aGlzLmNvdW50IC0gMTsNCiAgICAgICAgY29uc3QgbWFzayA9IGJpdE1hc2sodGhpcy5jb3VudCk7DQogICAgICAgIHRoaXMuYml0c18gPSAobGVuZ3RoICsgMSkgJiBtYXNrOw0KICAgIH0NCiAgICBuZXh0Qml0SXNPbmUoKSB7DQogICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTQml0d2lzZU9wZXJhdG9yVXNhZ2UNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gISh0aGlzLmJpdHNfICYgKDB4MSA8PCB0aGlzLmN1cnJlbnRfKSk7DQogICAgICAgIHRoaXMuY3VycmVudF8tLTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQp9DQovKioNCiAqIFRha2VzIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBhbmQgY29uc3RydWN0cyBhIFNvcnRlZFNldCB1c2luZyB0aGUgZ2l2ZW4gY29tcGFyaXNvbg0KICogZnVuY3Rpb24NCiAqDQogKiBVc2VzIHRoZSBhbGdvcml0aG0gZGVzY3JpYmVkIGluIHRoZSBwYXBlciBsaW5rZWQgaGVyZToNCiAqIGh0dHA6Ly9jaXRlc2VlcnguaXN0LnBzdS5lZHUvdmlld2RvYy9zdW1tYXJ5P2RvaT0xMC4xLjEuNDYuMTQ1OA0KICoNCiAqIEBwYXJhbSBjaGlsZExpc3QgLSBVbnNvcnRlZCBsaXN0IG9mIGNoaWxkcmVuDQogKiBAcGFyYW0gY21wIC0gVGhlIGNvbXBhcmlzb24gbWV0aG9kIHRvIGJlIHVzZWQNCiAqIEBwYXJhbSBrZXlGbiAtIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRvIGV4dHJhY3QgSyBmcm9tIGEgbm9kZSB3cmFwcGVyLCBpZiBLJ3MNCiAqIHR5cGUgaXMgbm90IE5hbWVkTm9kZQ0KICogQHBhcmFtIG1hcFNvcnRGbiAtIEFuIG9wdGlvbmFsIG92ZXJyaWRlIGZvciBjb21wYXJhdG9yIHVzZWQgYnkgdGhlIGdlbmVyYXRlZCBzb3J0ZWQgbWFwDQogKi8NCmNvbnN0IGJ1aWxkQ2hpbGRTZXQgPSBmdW5jdGlvbiAoY2hpbGRMaXN0LCBjbXAsIGtleUZuLCBtYXBTb3J0Rm4pIHsNCiAgICBjaGlsZExpc3Quc29ydChjbXApOw0KICAgIGNvbnN0IGJ1aWxkQmFsYW5jZWRUcmVlID0gZnVuY3Rpb24gKGxvdywgaGlnaCkgew0KICAgICAgICBjb25zdCBsZW5ndGggPSBoaWdoIC0gbG93Ow0KICAgICAgICBsZXQgbmFtZWROb2RlOw0KICAgICAgICBsZXQga2V5Ow0KICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChsZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFtsb3ddOw0KICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgY29uc3QgbWlkZGxlID0gcGFyc2VJbnQoKGxlbmd0aCAvIDIpLCAxMCkgKyBsb3c7DQogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnVpbGRCYWxhbmNlZFRyZWUobG93LCBtaWRkbGUpOw0KICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBidWlsZEJhbGFuY2VkVHJlZShtaWRkbGUgKyAxLCBoaWdoKTsNCiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFttaWRkbGVdOw0KICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbGVmdCwgcmlnaHQpOw0KICAgICAgICB9DQogICAgfTsNCiAgICBjb25zdCBidWlsZEZyb20xMkFycmF5ID0gZnVuY3Rpb24gKGJhc2UxMikgew0KICAgICAgICBsZXQgbm9kZSA9IG51bGw7DQogICAgICAgIGxldCByb290ID0gbnVsbDsNCiAgICAgICAgbGV0IGluZGV4ID0gY2hpbGRMaXN0Lmxlbmd0aDsNCiAgICAgICAgY29uc3QgYnVpbGRQZW5uYW50ID0gZnVuY3Rpb24gKGNodW5rU2l6ZSwgY29sb3IpIHsNCiAgICAgICAgICAgIGNvbnN0IGxvdyA9IGluZGV4IC0gY2h1bmtTaXplOw0KICAgICAgICAgICAgY29uc3QgaGlnaCA9IGluZGV4Ow0KICAgICAgICAgICAgaW5kZXggLT0gY2h1bmtTaXplOw0KICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gYnVpbGRCYWxhbmNlZFRyZWUobG93ICsgMSwgaGlnaCk7DQogICAgICAgICAgICBjb25zdCBuYW1lZE5vZGUgPSBjaGlsZExpc3RbbG93XTsNCiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleUZuID8ga2V5Rm4obmFtZWROb2RlKSA6IG5hbWVkTm9kZTsNCiAgICAgICAgICAgIGF0dGFjaFBlbm5hbnQobmV3IExMUkJOb2RlKGtleSwgbmFtZWROb2RlLm5vZGUsIGNvbG9yLCBudWxsLCBjaGlsZFRyZWUpKTsNCiAgICAgICAgfTsNCiAgICAgICAgY29uc3QgYXR0YWNoUGVubmFudCA9IGZ1bmN0aW9uIChwZW5uYW50KSB7DQogICAgICAgICAgICBpZiAobm9kZSkgew0KICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IHBlbm5hbnQ7DQogICAgICAgICAgICAgICAgbm9kZSA9IHBlbm5hbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByb290ID0gcGVubmFudDsNCiAgICAgICAgICAgICAgICBub2RlID0gcGVubmFudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiYXNlMTIuY291bnQ7ICsraSkgew0KICAgICAgICAgICAgY29uc3QgaXNPbmUgPSBiYXNlMTIubmV4dEJpdElzT25lKCk7DQogICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIG5vZGVzIHRha2VuIGluIGVhY2ggc2xpY2UgaXMgMl4oYXJyLmxlbmd0aCAtIChpICsgMSkpDQogICAgICAgICAgICBjb25zdCBjaHVua1NpemUgPSBNYXRoLnBvdygyLCBiYXNlMTIuY291bnQgLSAoaSArIDEpKTsNCiAgICAgICAgICAgIGlmIChpc09uZSkgew0KICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgPT0gMg0KICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTsNCiAgICAgICAgICAgICAgICBidWlsZFBlbm5hbnQoY2h1bmtTaXplLCBMTFJCTm9kZS5SRUQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByb290Ow0KICAgIH07DQogICAgY29uc3QgYmFzZTEyID0gbmV3IEJhc2UxMk51bShjaGlsZExpc3QubGVuZ3RoKTsNCiAgICBjb25zdCByb290ID0gYnVpbGRGcm9tMTJBcnJheShiYXNlMTIpOw0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAobWFwU29ydEZuIHx8IGNtcCwgcm9vdCk7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IF9kZWZhdWx0SW5kZXhNYXA7DQpjb25zdCBmYWxsYmFja09iamVjdCA9IHt9Ow0KY2xhc3MgSW5kZXhNYXAgew0KICAgIGNvbnN0cnVjdG9yKGluZGV4ZXNfLCBpbmRleFNldF8pIHsNCiAgICAgICAgdGhpcy5pbmRleGVzXyA9IGluZGV4ZXNfOw0KICAgICAgICB0aGlzLmluZGV4U2V0XyA9IGluZGV4U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogVGhlIGRlZmF1bHQgSW5kZXhNYXAgZm9yIG5vZGVzIHdpdGhvdXQgYSBwcmlvcml0eQ0KICAgICAqLw0KICAgIHN0YXRpYyBnZXQgRGVmYXVsdCgpIHsNCiAgICAgICAgYXNzZXJ0KGZhbGxiYWNrT2JqZWN0ICYmIFBSSU9SSVRZX0lOREVYLCAnQ2hpbGRyZW5Ob2RlLnRzIGhhcyBub3QgYmVlbiBsb2FkZWQnKTsNCiAgICAgICAgX2RlZmF1bHRJbmRleE1hcCA9DQogICAgICAgICAgICBfZGVmYXVsdEluZGV4TWFwIHx8DQogICAgICAgICAgICAgICAgbmV3IEluZGV4TWFwKHsgJy5wcmlvcml0eSc6IGZhbGxiYWNrT2JqZWN0IH0sIHsgJy5wcmlvcml0eSc6IFBSSU9SSVRZX0lOREVYIH0pOw0KICAgICAgICByZXR1cm4gX2RlZmF1bHRJbmRleE1hcDsNCiAgICB9DQogICAgZ2V0KGluZGV4S2V5KSB7DQogICAgICAgIGNvbnN0IHNvcnRlZE1hcCA9IHNhZmVHZXQodGhpcy5pbmRleGVzXywgaW5kZXhLZXkpOw0KICAgICAgICBpZiAoIXNvcnRlZE1hcCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBpbmRleCBkZWZpbmVkIGZvciAnICsgaW5kZXhLZXkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChzb3J0ZWRNYXAgaW5zdGFuY2VvZiBTb3J0ZWRNYXApIHsNCiAgICAgICAgICAgIHJldHVybiBzb3J0ZWRNYXA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGUgaW5kZXggZXhpc3RzLCBidXQgaXQgZmFsbHMgYmFjayB0byBqdXN0IG5hbWUgY29tcGFyaXNvbi4gUmV0dXJuIG51bGwgc28gdGhhdCB0aGUgY2FsbGluZyBjb2RlIHVzZXMgdGhlDQogICAgICAgICAgICAvLyByZWd1bGFyIGNoaWxkIG1hcA0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzSW5kZXgoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIHJldHVybiBjb250YWlucyh0aGlzLmluZGV4U2V0XywgaW5kZXhEZWZpbml0aW9uLnRvU3RyaW5nKCkpOw0KICAgIH0NCiAgICBhZGRJbmRleChpbmRleERlZmluaXRpb24sIGV4aXN0aW5nQ2hpbGRyZW4pIHsNCiAgICAgICAgYXNzZXJ0KGluZGV4RGVmaW5pdGlvbiAhPT0gS0VZX0lOREVYLCAiS2V5SW5kZXggYWx3YXlzIGV4aXN0cyBhbmQgaXNuJ3QgbWVhbnQgdG8gYmUgYWRkZWQgdG8gdGhlIEluZGV4TWFwLiIpOw0KICAgICAgICBjb25zdCBjaGlsZExpc3QgPSBbXTsNCiAgICAgICAgbGV0IHNhd0luZGV4ZWRWYWx1ZSA9IGZhbHNlOw0KICAgICAgICBjb25zdCBpdGVyID0gZXhpc3RpbmdDaGlsZHJlbi5nZXRJdGVyYXRvcihOYW1lZE5vZGUuV3JhcCk7DQogICAgICAgIGxldCBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgIHdoaWxlIChuZXh0KSB7DQogICAgICAgICAgICBzYXdJbmRleGVkVmFsdWUgPQ0KICAgICAgICAgICAgICAgIHNhd0luZGV4ZWRWYWx1ZSB8fCBpbmRleERlZmluaXRpb24uaXNEZWZpbmVkT24obmV4dC5ub2RlKTsNCiAgICAgICAgICAgIGNoaWxkTGlzdC5wdXNoKG5leHQpOw0KICAgICAgICAgICAgbmV4dCA9IGl0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICB9DQogICAgICAgIGxldCBuZXdJbmRleDsNCiAgICAgICAgaWYgKHNhd0luZGV4ZWRWYWx1ZSkgew0KICAgICAgICAgICAgbmV3SW5kZXggPSBidWlsZENoaWxkU2V0KGNoaWxkTGlzdCwgaW5kZXhEZWZpbml0aW9uLmdldENvbXBhcmUoKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBuZXdJbmRleCA9IGZhbGxiYWNrT2JqZWN0Ow0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGluZGV4TmFtZSA9IGluZGV4RGVmaW5pdGlvbi50b1N0cmluZygpOw0KICAgICAgICBjb25zdCBuZXdJbmRleFNldCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5kZXhTZXRfKTsNCiAgICAgICAgbmV3SW5kZXhTZXRbaW5kZXhOYW1lXSA9IGluZGV4RGVmaW5pdGlvbjsNCiAgICAgICAgY29uc3QgbmV3SW5kZXhlcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5kZXhlc18pOw0KICAgICAgICBuZXdJbmRleGVzW2luZGV4TmFtZV0gPSBuZXdJbmRleDsNCiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE1hcChuZXdJbmRleGVzLCBuZXdJbmRleFNldCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVuc3VyZSB0aGF0IHRoaXMgbm9kZSBpcyBwcm9wZXJseSB0cmFja2VkIGluIGFueSBpbmRleGVzIHRoYXQgd2UncmUgbWFpbnRhaW5pbmcNCiAgICAgKi8NCiAgICBhZGRUb0luZGV4ZXMobmFtZWROb2RlLCBleGlzdGluZ0NoaWxkcmVuKSB7DQogICAgICAgIGNvbnN0IG5ld0luZGV4ZXMgPSBtYXAkMSh0aGlzLmluZGV4ZXNfLCAoaW5kZXhlZENoaWxkcmVuLCBpbmRleE5hbWUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc2FmZUdldCh0aGlzLmluZGV4U2V0XywgaW5kZXhOYW1lKTsNCiAgICAgICAgICAgIGFzc2VydChpbmRleCwgJ01pc3NpbmcgaW5kZXggaW1wbGVtZW50YXRpb24gZm9yICcgKyBpbmRleE5hbWUpOw0KICAgICAgICAgICAgaWYgKGluZGV4ZWRDaGlsZHJlbiA9PT0gZmFsbGJhY2tPYmplY3QpIHsNCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byBpbmRleCBldmVyeXRoaW5nDQogICAgICAgICAgICAgICAgaWYgKGluZGV4LmlzRGVmaW5lZE9uKG5hbWVkTm9kZS5ub2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGJ1aWxkIHRoaXMgaW5kZXgNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRMaXN0ID0gW107DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZXIgPSBleGlzdGluZ0NoaWxkcmVuLmdldEl0ZXJhdG9yKE5hbWVkTm9kZS5XcmFwKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5leHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0Lm5hbWUgIT09IG5hbWVkTm9kZS5uYW1lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmFtZWROb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkQ2hpbGRTZXQoY2hpbGRMaXN0LCBpbmRleC5nZXRDb21wYXJlKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTm8gY2hhbmdlLCB0aGlzIHJlbWFpbnMgYSBmYWxsYmFjaw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2tPYmplY3Q7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwID0gZXhpc3RpbmdDaGlsZHJlbi5nZXQobmFtZWROb2RlLm5hbWUpOw0KICAgICAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbiA9IGluZGV4ZWRDaGlsZHJlbjsNCiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTbmFwKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gbmV3Q2hpbGRyZW4ucmVtb3ZlKG5ldyBOYW1lZE5vZGUobmFtZWROb2RlLm5hbWUsIGV4aXN0aW5nU25hcCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3Q2hpbGRyZW4uaW5zZXJ0KG5hbWVkTm9kZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE1hcChuZXdJbmRleGVzLCB0aGlzLmluZGV4U2V0Xyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBhIG5ldyBJbmRleE1hcCBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiB2YWx1ZSByZW1vdmVkDQogICAgICovDQogICAgcmVtb3ZlRnJvbUluZGV4ZXMobmFtZWROb2RlLCBleGlzdGluZ0NoaWxkcmVuKSB7DQogICAgICAgIGNvbnN0IG5ld0luZGV4ZXMgPSBtYXAkMSh0aGlzLmluZGV4ZXNfLCAoaW5kZXhlZENoaWxkcmVuKSA9PiB7DQogICAgICAgICAgICBpZiAoaW5kZXhlZENoaWxkcmVuID09PSBmYWxsYmFja09iamVjdCkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZhbGxiYWNrLiBKdXN0IHJldHVybiBpdCwgbm90aGluZyB0byBkbyBpbiB0aGlzIGNhc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXhlZENoaWxkcmVuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwID0gZXhpc3RpbmdDaGlsZHJlbi5nZXQobmFtZWROb2RlLm5hbWUpOw0KICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1NuYXApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWRDaGlsZHJlbi5yZW1vdmUobmV3IE5hbWVkTm9kZShuYW1lZE5vZGUubmFtZSwgZXhpc3RpbmdTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBObyByZWNvcmQgb2YgdGhpcyBjaGlsZA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXhlZENoaWxkcmVuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBuZXcgSW5kZXhNYXAobmV3SW5kZXhlcywgdGhpcy5pbmRleFNldF8pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIFRPRE86IEZvciBtZW1vcnkgc2F2aW5ncywgZG9uJ3Qgc3RvcmUgcHJpb3JpdHlOb2RlXyBpZiBpdCdzIGVtcHR5Lg0KbGV0IEVNUFRZX05PREU7DQovKioNCiAqIENoaWxkcmVuTm9kZSBpcyBhIGNsYXNzIGZvciBzdG9yaW5nIGludGVybmFsIG5vZGVzIGluIGEgRGF0YVNuYXBzaG90DQogKiAoaS5lLiBub2RlcyB3aXRoIGNoaWxkcmVuKS4gIEl0IGltcGxlbWVudHMgTm9kZSBhbmQgc3RvcmVzIHRoZQ0KICogbGlzdCBvZiBjaGlsZHJlbiBpbiB0aGUgY2hpbGRyZW4gcHJvcGVydHksIHNvcnRlZCBieSBjaGlsZCBuYW1lLg0KICovDQpjbGFzcyBDaGlsZHJlbk5vZGUgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBjaGlsZHJlbl8gLSBMaXN0IG9mIGNoaWxkcmVuIG9mIHRoaXMgbm9kZS4uDQogICAgICogQHBhcmFtIHByaW9yaXR5Tm9kZV8gLSBUaGUgcHJpb3JpdHkgb2YgdGhpcyBub2RlIChhcyBhIHNuYXBzaG90IG5vZGUpLg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGNoaWxkcmVuXywgcHJpb3JpdHlOb2RlXywgaW5kZXhNYXBfKSB7DQogICAgICAgIHRoaXMuY2hpbGRyZW5fID0gY2hpbGRyZW5fOw0KICAgICAgICB0aGlzLnByaW9yaXR5Tm9kZV8gPSBwcmlvcml0eU5vZGVfOw0KICAgICAgICB0aGlzLmluZGV4TWFwXyA9IGluZGV4TWFwXzsNCiAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogTm90ZTogVGhlIG9ubHkgcmVhc29uIHdlIGFsbG93IG51bGwgcHJpb3JpdHkgaXMgZm9yIEVNUFRZX05PREUsIHNpbmNlIHdlIGNhbid0IHVzZQ0KICAgICAgICAgKiBFTVBUWV9OT0RFIGFzIHRoZSBwcmlvcml0eSBvZiBFTVBUWV9OT0RFLiAgV2UgbWlnaHQgd2FudCB0byBjb25zaWRlciBtYWtpbmcgRU1QVFlfTk9ERSBpdHMgb3duDQogICAgICAgICAqIGNsYXNzIGluc3RlYWQgb2YgYW4gZW1wdHkgQ2hpbGRyZW5Ob2RlLg0KICAgICAgICAgKi8NCiAgICAgICAgaWYgKHRoaXMucHJpb3JpdHlOb2RlXykgew0KICAgICAgICAgICAgdmFsaWRhdGVQcmlvcml0eU5vZGUodGhpcy5wcmlvcml0eU5vZGVfKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jaGlsZHJlbl8uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBhc3NlcnQoIXRoaXMucHJpb3JpdHlOb2RlXyB8fCB0aGlzLnByaW9yaXR5Tm9kZV8uaXNFbXB0eSgpLCAnQW4gZW1wdHkgbm9kZSBjYW5ub3QgaGF2ZSBhIHByaW9yaXR5Jyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGdldCBFTVBUWV9OT0RFKCkgew0KICAgICAgICByZXR1cm4gKEVNUFRZX05PREUgfHwNCiAgICAgICAgICAgIChFTVBUWV9OT0RFID0gbmV3IENoaWxkcmVuTm9kZShuZXcgU29ydGVkTWFwKE5BTUVfQ09NUEFSQVRPUiksIG51bGwsIEluZGV4TWFwLkRlZmF1bHQpKSk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGlzTGVhZk5vZGUoKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0UHJpb3JpdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV8gfHwgRU1QVFlfTk9ERTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlUHJpb3JpdHkobmV3UHJpb3JpdHlOb2RlKSB7DQogICAgICAgIGlmICh0aGlzLmNoaWxkcmVuXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIC8vIERvbid0IGFsbG93IHByaW9yaXRpZXMgb24gZW1wdHkgbm9kZXMNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGlsZHJlbk5vZGUodGhpcy5jaGlsZHJlbl8sIG5ld1ByaW9yaXR5Tm9kZSwgdGhpcy5pbmRleE1hcF8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICAvLyBIYWNrIHRvIHRyZWF0IHByaW9yaXR5IGFzIGEgcmVndWxhciBjaGlsZA0KICAgICAgICBpZiAoY2hpbGROYW1lID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJpb3JpdHkoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbl8uZ2V0KGNoaWxkTmFtZSk7DQogICAgICAgICAgICByZXR1cm4gY2hpbGQgPT09IG51bGwgPyBFTVBUWV9OT0RFIDogY2hpbGQ7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0Q2hpbGQocGF0aCkgew0KICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoKTsNCiAgICAgICAgaWYgKGZyb250ID09PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5nZXRJbW1lZGlhdGVDaGlsZChmcm9udCkuZ2V0Q2hpbGQocGF0aFBvcEZyb250KHBhdGgpKTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzQ2hpbGQoY2hpbGROYW1lKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5nZXQoY2hpbGROYW1lKSAhPT0gbnVsbDsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpIHsNCiAgICAgICAgYXNzZXJ0KG5ld0NoaWxkTm9kZSwgJ1dlIHNob3VsZCBhbHdheXMgYmUgcGFzc2luZyBzbmFwc2hvdCBub2RlcycpOw0KICAgICAgICBpZiAoY2hpbGROYW1lID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlUHJpb3JpdHkobmV3Q2hpbGROb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IG5hbWVkTm9kZSA9IG5ldyBOYW1lZE5vZGUoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpOw0KICAgICAgICAgICAgbGV0IG5ld0NoaWxkcmVuLCBuZXdJbmRleE1hcDsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZE5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuXy5yZW1vdmUoY2hpbGROYW1lKTsNCiAgICAgICAgICAgICAgICBuZXdJbmRleE1hcCA9IHRoaXMuaW5kZXhNYXBfLnJlbW92ZUZyb21JbmRleGVzKG5hbWVkTm9kZSwgdGhpcy5jaGlsZHJlbl8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuXy5pbnNlcnQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpOw0KICAgICAgICAgICAgICAgIG5ld0luZGV4TWFwID0gdGhpcy5pbmRleE1hcF8uYWRkVG9JbmRleGVzKG5hbWVkTm9kZSwgdGhpcy5jaGlsZHJlbl8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbmV3UHJpb3JpdHkgPSBuZXdDaGlsZHJlbi5pc0VtcHR5KCkNCiAgICAgICAgICAgICAgICA/IEVNUFRZX05PREUNCiAgICAgICAgICAgICAgICA6IHRoaXMucHJpb3JpdHlOb2RlXzsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKG5ld0NoaWxkcmVuLCBuZXdQcmlvcml0eSwgbmV3SW5kZXhNYXApOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVwZGF0ZUNoaWxkKHBhdGgsIG5ld0NoaWxkTm9kZSkgew0KICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoKTsNCiAgICAgICAgaWYgKGZyb250ID09PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3Q2hpbGROb2RlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KHBhdGhHZXRGcm9udChwYXRoKSAhPT0gJy5wcmlvcml0eScgfHwgcGF0aEdldExlbmd0aChwYXRoKSA9PT0gMSwgJy5wcmlvcml0eSBtdXN0IGJlIHRoZSBsYXN0IHRva2VuIGluIGEgcGF0aCcpOw0KICAgICAgICAgICAgY29uc3QgbmV3SW1tZWRpYXRlQ2hpbGQgPSB0aGlzLmdldEltbWVkaWF0ZUNoaWxkKGZyb250KS51cGRhdGVDaGlsZChwYXRoUG9wRnJvbnQocGF0aCksIG5ld0NoaWxkTm9kZSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVJbW1lZGlhdGVDaGlsZChmcm9udCwgbmV3SW1tZWRpYXRlQ2hpbGQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIG51bUNoaWxkcmVuKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8uY291bnQoKTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdmFsKGV4cG9ydEZvcm1hdCkgew0KICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IG9iaiA9IHt9Ow0KICAgICAgICBsZXQgbnVtS2V5cyA9IDAsIG1heEtleSA9IDAsIGFsbEludGVnZXJLZXlzID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgb2JqW2tleV0gPSBjaGlsZE5vZGUudmFsKGV4cG9ydEZvcm1hdCk7DQogICAgICAgICAgICBudW1LZXlzKys7DQogICAgICAgICAgICBpZiAoYWxsSW50ZWdlcktleXMgJiYgQ2hpbGRyZW5Ob2RlLklOVEVHRVJfUkVHRVhQXy50ZXN0KGtleSkpIHsNCiAgICAgICAgICAgICAgICBtYXhLZXkgPSBNYXRoLm1heChtYXhLZXksIE51bWJlcihrZXkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFsbEludGVnZXJLZXlzID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoIWV4cG9ydEZvcm1hdCAmJiBhbGxJbnRlZ2VyS2V5cyAmJiBtYXhLZXkgPCAyICogbnVtS2V5cykgew0KICAgICAgICAgICAgLy8gY29udmVydCB0byBhcnJheS4NCiAgICAgICAgICAgIGNvbnN0IGFycmF5ID0gW107DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ3VhcmQtZm9yLWluDQogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHsNCiAgICAgICAgICAgICAgICBhcnJheVtrZXldID0gb2JqW2tleV07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYXJyYXk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAoZXhwb3J0Rm9ybWF0ICYmICF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgb2JqWycucHJpb3JpdHknXSA9IHRoaXMuZ2V0UHJpb3JpdHkoKS52YWwoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzaCgpIHsNCiAgICAgICAgaWYgKHRoaXMubGF6eUhhc2hfID09PSBudWxsKSB7DQogICAgICAgICAgICBsZXQgdG9IYXNoID0gJyc7DQogICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UHJpb3JpdHkoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0b0hhc2ggKz0NCiAgICAgICAgICAgICAgICAgICAgJ3ByaW9yaXR5OicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlIYXNoVGV4dCh0aGlzLmdldFByaW9yaXR5KCkudmFsKCkpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICc6JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEhhc2ggPSBjaGlsZE5vZGUuaGFzaCgpOw0KICAgICAgICAgICAgICAgIGlmIChjaGlsZEhhc2ggIT09ICcnKSB7DQogICAgICAgICAgICAgICAgICAgIHRvSGFzaCArPSAnOicgKyBrZXkgKyAnOicgKyBjaGlsZEhhc2g7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLmxhenlIYXNoXyA9IHRvSGFzaCA9PT0gJycgPyAnJyA6IHNoYTEodG9IYXNoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5sYXp5SGFzaF87DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldFByZWRlY2Vzc29yQ2hpbGROYW1lKGNoaWxkTmFtZSwgY2hpbGROb2RlLCBpbmRleCkgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXgpOw0KICAgICAgICBpZiAoaWR4KSB7DQogICAgICAgICAgICBjb25zdCBwcmVkZWNlc3NvciA9IGlkeC5nZXRQcmVkZWNlc3NvcktleShuZXcgTmFtZWROb2RlKGNoaWxkTmFtZSwgY2hpbGROb2RlKSk7DQogICAgICAgICAgICByZXR1cm4gcHJlZGVjZXNzb3IgPyBwcmVkZWNlc3Nvci5uYW1lIDogbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5nZXRQcmVkZWNlc3NvcktleShjaGlsZE5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldEZpcnN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgY29uc3QgbWluS2V5ID0gaWR4Lm1pbktleSgpOw0KICAgICAgICAgICAgcmV0dXJuIG1pbktleSAmJiBtaW5LZXkubmFtZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5taW5LZXkoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRGaXJzdENoaWxkKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBtaW5LZXkgPSB0aGlzLmdldEZpcnN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbik7DQogICAgICAgIGlmIChtaW5LZXkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKG1pbktleSwgdGhpcy5jaGlsZHJlbl8uZ2V0KG1pbktleSkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYW4gaW5kZXgsIHJldHVybiB0aGUga2V5IG5hbWUgb2YgdGhlIGxhcmdlc3QgdmFsdWUgd2UgaGF2ZSwgYWNjb3JkaW5nIHRvIHRoYXQgaW5kZXgNCiAgICAgKi8NCiAgICBnZXRMYXN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgY29uc3QgbWF4S2V5ID0gaWR4Lm1heEtleSgpOw0KICAgICAgICAgICAgcmV0dXJuIG1heEtleSAmJiBtYXhLZXkubmFtZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5tYXhLZXkoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRMYXN0Q2hpbGQoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIGNvbnN0IG1heEtleSA9IHRoaXMuZ2V0TGFzdENoaWxkTmFtZShpbmRleERlZmluaXRpb24pOw0KICAgICAgICBpZiAobWF4S2V5KSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShtYXhLZXksIHRoaXMuY2hpbGRyZW5fLmdldChtYXhLZXkpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZvckVhY2hDaGlsZChpbmRleCwgYWN0aW9uKSB7DQogICAgICAgIGNvbnN0IGlkeCA9IHRoaXMucmVzb2x2ZUluZGV4XyhpbmRleCk7DQogICAgICAgIGlmIChpZHgpIHsNCiAgICAgICAgICAgIHJldHVybiBpZHguaW5vcmRlclRyYXZlcnNhbCh3cmFwcGVkTm9kZSA9PiB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbih3cmFwcGVkTm9kZS5uYW1lLCB3cmFwcGVkTm9kZS5ub2RlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5fLmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRJdGVyYXRvcihpbmRleERlZmluaXRpb24pIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlcmF0b3JGcm9tKGluZGV4RGVmaW5pdGlvbi5taW5Qb3N0KCksIGluZGV4RGVmaW5pdGlvbik7DQogICAgfQ0KICAgIGdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QsIGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgcmV0dXJuIGlkeC5nZXRJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBrZXkgPT4ga2V5KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdG9yID0gdGhpcy5jaGlsZHJlbl8uZ2V0SXRlcmF0b3JGcm9tKHN0YXJ0UG9zdC5uYW1lLCBOYW1lZE5vZGUuV3JhcCk7DQogICAgICAgICAgICBsZXQgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIHdoaWxlIChuZXh0ICE9IG51bGwgJiYgaW5kZXhEZWZpbml0aW9uLmNvbXBhcmUobmV4dCwgc3RhcnRQb3N0KSA8IDApIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRvci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvcjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3IoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIHJldHVybiB0aGlzLmdldFJldmVyc2VJdGVyYXRvckZyb20oaW5kZXhEZWZpbml0aW9uLm1heFBvc3QoKSwgaW5kZXhEZWZpbml0aW9uKTsNCiAgICB9DQogICAgZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0LCBpbmRleERlZmluaXRpb24pIHsNCiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbik7DQogICAgICAgIGlmIChpZHgpIHsNCiAgICAgICAgICAgIHJldHVybiBpZHguZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0LCBrZXkgPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiBrZXk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdG9yID0gdGhpcy5jaGlsZHJlbl8uZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0Lm5hbWUsIE5hbWVkTm9kZS5XcmFwKTsNCiAgICAgICAgICAgIGxldCBuZXh0ID0gaXRlcmF0b3IucGVlaygpOw0KICAgICAgICAgICAgd2hpbGUgKG5leHQgIT0gbnVsbCAmJiBpbmRleERlZmluaXRpb24uY29tcGFyZShuZXh0LCBlbmRQb3N0KSA+IDApIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRvci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvcjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb21wYXJlVG8ob3RoZXIpIHsNCiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBpZiAob3RoZXIuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAob3RoZXIuaXNMZWFmTm9kZSgpIHx8IG90aGVyLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAob3RoZXIgPT09IE1BWF9OT0RFKSB7DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBNdXN0IGJlIGFub3RoZXIgbm9kZSB3aXRoIGNoaWxkcmVuLg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICB9DQogICAgd2l0aEluZGV4KGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBpZiAoaW5kZXhEZWZpbml0aW9uID09PSBLRVlfSU5ERVggfHwNCiAgICAgICAgICAgIHRoaXMuaW5kZXhNYXBfLmhhc0luZGV4KGluZGV4RGVmaW5pdGlvbikpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgbmV3SW5kZXhNYXAgPSB0aGlzLmluZGV4TWFwXy5hZGRJbmRleChpbmRleERlZmluaXRpb24sIHRoaXMuY2hpbGRyZW5fKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKHRoaXMuY2hpbGRyZW5fLCB0aGlzLnByaW9yaXR5Tm9kZV8sIG5ld0luZGV4TWFwKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpc0luZGV4ZWQoaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGluZGV4ID09PSBLRVlfSU5ERVggfHwgdGhpcy5pbmRleE1hcF8uaGFzSW5kZXgoaW5kZXgpOw0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChvdGhlci5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IG90aGVyQ2hpbGRyZW5Ob2RlID0gb3RoZXI7DQogICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UHJpb3JpdHkoKS5lcXVhbHMob3RoZXJDaGlsZHJlbk5vZGUuZ2V0UHJpb3JpdHkoKSkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNoaWxkcmVuXy5jb3VudCgpID09PSBvdGhlckNoaWxkcmVuTm9kZS5jaGlsZHJlbl8uY291bnQoKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHRoaXNJdGVyID0gdGhpcy5nZXRJdGVyYXRvcihQUklPUklUWV9JTkRFWCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJJdGVyID0gb3RoZXJDaGlsZHJlbk5vZGUuZ2V0SXRlcmF0b3IoUFJJT1JJVFlfSU5ERVgpOw0KICAgICAgICAgICAgICAgIGxldCB0aGlzQ3VycmVudCA9IHRoaXNJdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICBsZXQgb3RoZXJDdXJyZW50ID0gb3RoZXJJdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAodGhpc0N1cnJlbnQgJiYgb3RoZXJDdXJyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzQ3VycmVudC5uYW1lICE9PSBvdGhlckN1cnJlbnQubmFtZSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgIXRoaXNDdXJyZW50Lm5vZGUuZXF1YWxzKG90aGVyQ3VycmVudC5ub2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXNDdXJyZW50ID0gdGhpc0l0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBvdGhlckN1cnJlbnQgPSBvdGhlckl0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc0N1cnJlbnQgPT09IG51bGwgJiYgb3RoZXJDdXJyZW50ID09PSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBTb3J0ZWRNYXAgb3JkZXJlZCBieSBpbmRleCwgb3IgbnVsbCBpZiB0aGUgZGVmYXVsdCAoYnkta2V5KSBvcmRlcmluZyBjYW4gYmUgdXNlZA0KICAgICAqIGluc3RlYWQuDQogICAgICoNCiAgICAgKi8NCiAgICByZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBpZiAoaW5kZXhEZWZpbml0aW9uID09PSBLRVlfSU5ERVgpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYXBfLmdldChpbmRleERlZmluaXRpb24udG9TdHJpbmcoKSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpDaGlsZHJlbk5vZGUuSU5URUdFUl9SRUdFWFBfID0gL14oMHxbMS05XVxkKikkLzsNCmNsYXNzIE1heE5vZGUgZXh0ZW5kcyBDaGlsZHJlbk5vZGUgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcihuZXcgU29ydGVkTWFwKE5BTUVfQ09NUEFSQVRPUiksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLCBJbmRleE1hcC5EZWZhdWx0KTsNCiAgICB9DQogICAgY29tcGFyZVRvKG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PT0gdGhpcykgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgLy8gTm90IHRoYXQgd2UgZXZlcnkgY29tcGFyZSBpdCwgYnV0IE1BWF9OT0RFIGlzIG9ubHkgZXZlciBlcXVhbCB0byBpdHNlbGYNCiAgICAgICAgcmV0dXJuIG90aGVyID09PSB0aGlzOw0KICAgIH0NCiAgICBnZXRQcmlvcml0eSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICByZXR1cm4gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgfQ0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQp9DQovKioNCiAqIE1hcmtlciB0aGF0IHdpbGwgc29ydCBoaWdoZXIgdGhhbiBhbnkgb3RoZXIgc25hcHNob3QuDQogKi8NCmNvbnN0IE1BWF9OT0RFID0gbmV3IE1heE5vZGUoKTsNCk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKE5hbWVkTm9kZSwgew0KICAgIE1JTjogew0KICAgICAgICB2YWx1ZTogbmV3IE5hbWVkTm9kZShNSU5fTkFNRSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpDQogICAgfSwNCiAgICBNQVg6IHsNCiAgICAgICAgdmFsdWU6IG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIE1BWF9OT0RFKQ0KICAgIH0NCn0pOw0KLyoqDQogKiBSZWZlcmVuY2UgRXh0ZW5zaW9ucw0KICovDQpLZXlJbmRleC5fX0VNUFRZX05PREUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCkxlYWZOb2RlLl9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IgPSBDaGlsZHJlbk5vZGU7DQpzZXRNYXhOb2RlJDEoTUFYX05PREUpOw0Kc2V0TWF4Tm9kZShNQVhfTk9ERSk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBVU0VfSElOWkUgPSB0cnVlOw0KLyoqDQogKiBDb25zdHJ1Y3RzIGEgc25hcHNob3Qgbm9kZSByZXByZXNlbnRpbmcgdGhlIHBhc3NlZCBKU09OIGFuZCByZXR1cm5zIGl0Lg0KICogQHBhcmFtIGpzb24gLSBKU09OIHRvIGNyZWF0ZSBhIG5vZGUgZm9yLg0KICogQHBhcmFtIHByaW9yaXR5IC0gT3B0aW9uYWwgcHJpb3JpdHkgdG8gdXNlLiAgVGhpcyB3aWxsIGJlIGlnbm9yZWQgaWYgdGhlDQogKiBwYXNzZWQgSlNPTiBjb250YWlucyBhIC5wcmlvcml0eSBwcm9wZXJ0eS4NCiAqLw0KZnVuY3Rpb24gbm9kZUZyb21KU09OKGpzb24sIHByaW9yaXR5ID0gbnVsbCkgew0KICAgIGlmIChqc29uID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBqc29uID09PSAnb2JqZWN0JyAmJiAnLnByaW9yaXR5JyBpbiBqc29uKSB7DQogICAgICAgIHByaW9yaXR5ID0ganNvblsnLnByaW9yaXR5J107DQogICAgfQ0KICAgIGFzc2VydChwcmlvcml0eSA9PT0gbnVsbCB8fA0KICAgICAgICB0eXBlb2YgcHJpb3JpdHkgPT09ICdzdHJpbmcnIHx8DQogICAgICAgIHR5cGVvZiBwcmlvcml0eSA9PT0gJ251bWJlcicgfHwNCiAgICAgICAgKHR5cGVvZiBwcmlvcml0eSA9PT0gJ29iamVjdCcgJiYgJy5zdicgaW4gcHJpb3JpdHkpLCAnSW52YWxpZCBwcmlvcml0eSB0eXBlIGZvdW5kOiAnICsgdHlwZW9mIHByaW9yaXR5KTsNCiAgICBpZiAodHlwZW9mIGpzb24gPT09ICdvYmplY3QnICYmICcudmFsdWUnIGluIGpzb24gJiYganNvblsnLnZhbHVlJ10gIT09IG51bGwpIHsNCiAgICAgICAganNvbiA9IGpzb25bJy52YWx1ZSddOw0KICAgIH0NCiAgICAvLyBWYWxpZCBsZWFmIG5vZGVzIGluY2x1ZGUgbm9uLW9iamVjdHMgb3Igc2VydmVyLXZhbHVlIHdyYXBwZXIgb2JqZWN0cw0KICAgIGlmICh0eXBlb2YganNvbiAhPT0gJ29iamVjdCcgfHwgJy5zdicgaW4ganNvbikgew0KICAgICAgICBjb25zdCBqc29uTGVhZiA9IGpzb247DQogICAgICAgIHJldHVybiBuZXcgTGVhZk5vZGUoanNvbkxlYWYsIG5vZGVGcm9tSlNPTihwcmlvcml0eSkpOw0KICAgIH0NCiAgICBpZiAoIShqc29uIGluc3RhbmNlb2YgQXJyYXkpICYmIFVTRV9ISU5aRSkgew0KICAgICAgICBjb25zdCBjaGlsZHJlbiA9IFtdOw0KICAgICAgICBsZXQgY2hpbGRyZW5IYXZlUHJpb3JpdHkgPSBmYWxzZTsNCiAgICAgICAgY29uc3QgaGluemVKc29uT2JqID0ganNvbjsNCiAgICAgICAgZWFjaChoaW56ZUpzb25PYmosIChrZXksIGNoaWxkKSA9PiB7DQogICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAxKSAhPT0gJy4nKSB7DQogICAgICAgICAgICAgICAgLy8gSWdub3JlIG1ldGFkYXRhIG5vZGVzDQogICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gbm9kZUZyb21KU09OKGNoaWxkKTsNCiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkTm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5IYXZlUHJpb3JpdHkgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5IYXZlUHJpb3JpdHkgfHwgIWNoaWxkTm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKTsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChuZXcgTmFtZWROb2RlKGtleSwgY2hpbGROb2RlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGNoaWxkU2V0ID0gYnVpbGRDaGlsZFNldChjaGlsZHJlbiwgTkFNRV9PTkxZX0NPTVBBUkFUT1IsIG5hbWVkTm9kZSA9PiBuYW1lZE5vZGUubmFtZSwgTkFNRV9DT01QQVJBVE9SKTsNCiAgICAgICAgaWYgKGNoaWxkcmVuSGF2ZVByaW9yaXR5KSB7DQogICAgICAgICAgICBjb25zdCBzb3J0ZWRDaGlsZFNldCA9IGJ1aWxkQ2hpbGRTZXQoY2hpbGRyZW4sIFBSSU9SSVRZX0lOREVYLmdldENvbXBhcmUoKSk7DQogICAgICAgICAgICByZXR1cm4gbmV3IENoaWxkcmVuTm9kZShjaGlsZFNldCwgbm9kZUZyb21KU09OKHByaW9yaXR5KSwgbmV3IEluZGV4TWFwKHsgJy5wcmlvcml0eSc6IHNvcnRlZENoaWxkU2V0IH0sIHsgJy5wcmlvcml0eSc6IFBSSU9SSVRZX0lOREVYIH0pKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKGNoaWxkU2V0LCBub2RlRnJvbUpTT04ocHJpb3JpdHkpLCBJbmRleE1hcC5EZWZhdWx0KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgbGV0IG5vZGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgZWFjaChqc29uLCAoa2V5LCBjaGlsZERhdGEpID0+IHsNCiAgICAgICAgICAgIGlmIChjb250YWlucyhqc29uLCBrZXkpKSB7DQogICAgICAgICAgICAgICAgaWYgKGtleS5zdWJzdHJpbmcoMCwgMSkgIT09ICcuJykgew0KICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgbWV0YWRhdGEgbm9kZXMuDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkTm9kZSA9IG5vZGVGcm9tSlNPTihjaGlsZERhdGEpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLmlzTGVhZk5vZGUoKSB8fCAhY2hpbGROb2RlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoa2V5LCBjaGlsZE5vZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIG5vZGUudXBkYXRlUHJpb3JpdHkobm9kZUZyb21KU09OKHByaW9yaXR5KSk7DQogICAgfQ0KfQ0Kc2V0Tm9kZUZyb21KU09OKG5vZGVGcm9tSlNPTik7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBQYXRoSW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgY29uc3RydWN0b3IoaW5kZXhQYXRoXykgew0KICAgICAgICBzdXBlcigpOw0KICAgICAgICB0aGlzLmluZGV4UGF0aF8gPSBpbmRleFBhdGhfOw0KICAgICAgICBhc3NlcnQoIXBhdGhJc0VtcHR5KGluZGV4UGF0aF8pICYmIHBhdGhHZXRGcm9udChpbmRleFBhdGhfKSAhPT0gJy5wcmlvcml0eScsICJDYW4ndCBjcmVhdGUgUGF0aEluZGV4IHdpdGggZW1wdHkgcGF0aCBvciAucHJpb3JpdHkga2V5Iik7DQogICAgfQ0KICAgIGV4dHJhY3RDaGlsZChzbmFwKSB7DQogICAgICAgIHJldHVybiBzbmFwLmdldENoaWxkKHRoaXMuaW5kZXhQYXRoXyk7DQogICAgfQ0KICAgIGlzRGVmaW5lZE9uKG5vZGUpIHsNCiAgICAgICAgcmV0dXJuICFub2RlLmdldENoaWxkKHRoaXMuaW5kZXhQYXRoXykuaXNFbXB0eSgpOw0KICAgIH0NCiAgICBjb21wYXJlKGEsIGIpIHsNCiAgICAgICAgY29uc3QgYUNoaWxkID0gdGhpcy5leHRyYWN0Q2hpbGQoYS5ub2RlKTsNCiAgICAgICAgY29uc3QgYkNoaWxkID0gdGhpcy5leHRyYWN0Q2hpbGQoYi5ub2RlKTsNCiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhQ2hpbGQuY29tcGFyZVRvKGJDaGlsZCk7DQogICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7DQogICAgICAgIGNvbnN0IHZhbHVlTm9kZSA9IG5vZGVGcm9tSlNPTihpbmRleFZhbHVlKTsNCiAgICAgICAgY29uc3Qgbm9kZSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLnVwZGF0ZUNoaWxkKHRoaXMuaW5kZXhQYXRoXywgdmFsdWVOb2RlKTsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUobmFtZSwgbm9kZSk7DQogICAgfQ0KICAgIG1heFBvc3QoKSB7DQogICAgICAgIGNvbnN0IG5vZGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERS51cGRhdGVDaGlsZCh0aGlzLmluZGV4UGF0aF8sIE1BWF9OT0RFKTsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIG5vZGUpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuIHBhdGhTbGljZSh0aGlzLmluZGV4UGF0aF8sIDApLmpvaW4oJy8nKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBWYWx1ZUluZGV4IGV4dGVuZHMgSW5kZXggew0KICAgIGNvbXBhcmUoYSwgYikgew0KICAgICAgICBjb25zdCBpbmRleENtcCA9IGEubm9kZS5jb21wYXJlVG8oYi5ub2RlKTsNCiAgICAgICAgaWYgKGluZGV4Q21wID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gbmFtZUNvbXBhcmUoYS5uYW1lLCBiLm5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Q21wOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlzRGVmaW5lZE9uKG5vZGUpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGluZGV4ZWRWYWx1ZUNoYW5nZWQob2xkTm9kZSwgbmV3Tm9kZSkgew0KICAgICAgICByZXR1cm4gIW9sZE5vZGUuZXF1YWxzKG5ld05vZGUpOw0KICAgIH0NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQogICAgbWF4UG9zdCgpIHsNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgcmV0dXJuIE5hbWVkTm9kZS5NQVg7DQogICAgfQ0KICAgIG1ha2VQb3N0KGluZGV4VmFsdWUsIG5hbWUpIHsNCiAgICAgICAgY29uc3QgdmFsdWVOb2RlID0gbm9kZUZyb21KU09OKGluZGV4VmFsdWUpOw0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCB2YWx1ZU5vZGUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBTdHJpbmcgcmVwcmVzZW50YXRpb24gZm9yIGluY2x1c2lvbiBpbiBhIHF1ZXJ5IHNwZWMNCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICcudmFsdWUnOw0KICAgIH0NCn0NCmNvbnN0IFZBTFVFX0lOREVYID0gbmV3IFZhbHVlSW5kZXgoKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNoYW5nZVZhbHVlKHNuYXBzaG90Tm9kZSkgew0KICAgIHJldHVybiB7IHR5cGU6ICJ2YWx1ZSIgLyogQ2hhbmdlVHlwZS5WQUxVRSAqLywgc25hcHNob3ROb2RlIH07DQp9DQpmdW5jdGlvbiBjaGFuZ2VDaGlsZEFkZGVkKGNoaWxkTmFtZSwgc25hcHNob3ROb2RlKSB7DQogICAgcmV0dXJuIHsgdHlwZTogImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovLCBzbmFwc2hvdE5vZGUsIGNoaWxkTmFtZSB9Ow0KfQ0KZnVuY3Rpb24gY2hhbmdlQ2hpbGRSZW1vdmVkKGNoaWxkTmFtZSwgc25hcHNob3ROb2RlKSB7DQogICAgcmV0dXJuIHsgdHlwZTogImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLywgc25hcHNob3ROb2RlLCBjaGlsZE5hbWUgfTsNCn0NCmZ1bmN0aW9uIGNoYW5nZUNoaWxkQ2hhbmdlZChjaGlsZE5hbWUsIHNuYXBzaG90Tm9kZSwgb2xkU25hcCkgew0KICAgIHJldHVybiB7DQogICAgICAgIHR5cGU6ICJjaGlsZF9jaGFuZ2VkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8sDQogICAgICAgIHNuYXBzaG90Tm9kZSwNCiAgICAgICAgY2hpbGROYW1lLA0KICAgICAgICBvbGRTbmFwDQogICAgfTsNCn0NCmZ1bmN0aW9uIGNoYW5nZUNoaWxkTW92ZWQoY2hpbGROYW1lLCBzbmFwc2hvdE5vZGUpIHsNCiAgICByZXR1cm4geyB0eXBlOiAiY2hpbGRfbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfTU9WRUQgKi8sIHNuYXBzaG90Tm9kZSwgY2hpbGROYW1lIH07DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIERvZXNuJ3QgcmVhbGx5IGZpbHRlciBub2RlcyBidXQgYXBwbGllcyBhbiBpbmRleCB0byB0aGUgbm9kZSBhbmQga2VlcHMgdHJhY2sgb2YgYW55IGNoYW5nZXMNCiAqLw0KY2xhc3MgSW5kZXhlZEZpbHRlciB7DQogICAgY29uc3RydWN0b3IoaW5kZXhfKSB7DQogICAgICAgIHRoaXMuaW5kZXhfID0gaW5kZXhfOw0KICAgIH0NCiAgICB1cGRhdGVDaGlsZChzbmFwLCBrZXksIG5ld0NoaWxkLCBhZmZlY3RlZFBhdGgsIHNvdXJjZSwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpIHsNCiAgICAgICAgYXNzZXJ0KHNuYXAuaXNJbmRleGVkKHRoaXMuaW5kZXhfKSwgJ0Egbm9kZSBtdXN0IGJlIGluZGV4ZWQgaWYgb25seSBhIGNoaWxkIGlzIHVwZGF0ZWQnKTsNCiAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBzbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSk7DQogICAgICAgIC8vIENoZWNrIGlmIGFueXRoaW5nIGFjdHVhbGx5IGNoYW5nZWQuDQogICAgICAgIGlmIChvbGRDaGlsZC5nZXRDaGlsZChhZmZlY3RlZFBhdGgpLmVxdWFscyhuZXdDaGlsZC5nZXRDaGlsZChhZmZlY3RlZFBhdGgpKSkgew0KICAgICAgICAgICAgLy8gVGhlcmUncyBhbiBlZGdlIGNhc2Ugd2hlcmUgYSBjaGlsZCBjYW4gZW50ZXIgb3IgbGVhdmUgdGhlIHZpZXcgYmVjYXVzZSBhZmZlY3RlZFBhdGggd2FzIHNldCB0byBudWxsLg0KICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlLCBhZmZlY3RlZFBhdGggd2lsbCBhcHBlYXIgbnVsbCBpbiBib3RoIHRoZSBvbGQgYW5kIG5ldyBzbmFwc2hvdHMuICBTbyB3ZSBuZWVkDQogICAgICAgICAgICAvLyB0byBhdm9pZCB0cmVhdGluZyB0aGVzZSBjYXNlcyBhcyAibm90aGluZyBjaGFuZ2VkLiINCiAgICAgICAgICAgIGlmIChvbGRDaGlsZC5pc0VtcHR5KCkgPT09IG5ld0NoaWxkLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgY2hhbmdlZC4NCiAgICAgICAgICAgICAgICAvLyBUaGlzIGFzc2VydCBzaG91bGQgYmUgdmFsaWQsIGJ1dCBpdCdzIGV4cGVuc2l2ZSAoY2FuIGRvbWluYXRlIHBlcmYgdGVzdGluZykgc28gZG9uJ3QgYWN0dWFsbHkgZG8gaXQuDQogICAgICAgICAgICAgICAgLy9hc3NlcnQob2xkQ2hpbGQuZXF1YWxzKG5ld0NoaWxkKSwgJ09sZCBhbmQgbmV3IHNuYXBzaG90cyBzaG91bGQgYmUgZXF1YWwuJyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9wdENoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoc25hcC5oYXNDaGlsZChrZXkpKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdENoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRSZW1vdmVkKGtleSwgb2xkQ2hpbGQpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFzc2VydChzbmFwLmlzTGVhZk5vZGUoKSwgJ0EgY2hpbGQgcmVtb3ZlIHdpdGhvdXQgYW4gb2xkIGNoaWxkIG9ubHkgbWFrZXMgc2Vuc2Ugb24gYSBsZWFmIG5vZGUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChvbGRDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBvcHRDaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBuZXdDaGlsZCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoa2V5LCBuZXdDaGlsZCwgb2xkQ2hpbGQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoc25hcC5pc0xlYWZOb2RlKCkgJiYgbmV3Q2hpbGQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgbm9kZSBpcyBpbmRleGVkDQogICAgICAgICAgICByZXR1cm4gc25hcC51cGRhdGVJbW1lZGlhdGVDaGlsZChrZXksIG5ld0NoaWxkKS53aXRoSW5kZXgodGhpcy5pbmRleF8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIG5ld1NuYXAsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmIChvcHRDaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7DQogICAgICAgICAgICBpZiAoIW9sZFNuYXAuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgICAgICAgICAgb2xkU25hcC5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld1NuYXAuaGFzQ2hpbGQoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZFJlbW92ZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFuZXdTbmFwLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgICAgIG5ld1NuYXAuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFNuYXAuaGFzQ2hpbGQoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBvbGRTbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9sZENoaWxkLmVxdWFscyhjaGlsZE5vZGUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoa2V5LCBjaGlsZE5vZGUsIG9sZENoaWxkKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcHRDaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIGlmIChvbGRTbmFwLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG9sZFNuYXAudXBkYXRlUHJpb3JpdHkobmV3UHJpb3JpdHkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZpbHRlcnNOb2RlcygpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEZpbHRlcnMgbm9kZXMgYnkgcmFuZ2UgYW5kIHVzZXMgYW4gSW5kZXhGaWx0ZXIgdG8gdHJhY2sgYW55IGNoYW5nZXMgYWZ0ZXIgZmlsdGVyaW5nIHRoZSBub2RlDQogKi8NCmNsYXNzIFJhbmdlZEZpbHRlciB7DQogICAgY29uc3RydWN0b3IocGFyYW1zKSB7DQogICAgICAgIHRoaXMuaW5kZXhlZEZpbHRlcl8gPSBuZXcgSW5kZXhlZEZpbHRlcihwYXJhbXMuZ2V0SW5kZXgoKSk7DQogICAgICAgIHRoaXMuaW5kZXhfID0gcGFyYW1zLmdldEluZGV4KCk7DQogICAgICAgIHRoaXMuc3RhcnRQb3N0XyA9IFJhbmdlZEZpbHRlci5nZXRTdGFydFBvc3RfKHBhcmFtcyk7DQogICAgICAgIHRoaXMuZW5kUG9zdF8gPSBSYW5nZWRGaWx0ZXIuZ2V0RW5kUG9zdF8ocGFyYW1zKTsNCiAgICAgICAgdGhpcy5zdGFydElzSW5jbHVzaXZlXyA9ICFwYXJhbXMuc3RhcnRBZnRlclNldF87DQogICAgICAgIHRoaXMuZW5kSXNJbmNsdXNpdmVfID0gIXBhcmFtcy5lbmRCZWZvcmVTZXRfOw0KICAgIH0NCiAgICBnZXRTdGFydFBvc3QoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0YXJ0UG9zdF87DQogICAgfQ0KICAgIGdldEVuZFBvc3QoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmVuZFBvc3RfOw0KICAgIH0NCiAgICBtYXRjaGVzKG5vZGUpIHsNCiAgICAgICAgY29uc3QgaXNXaXRoaW5TdGFydCA9IHRoaXMuc3RhcnRJc0luY2x1c2l2ZV8NCiAgICAgICAgICAgID8gdGhpcy5pbmRleF8uY29tcGFyZSh0aGlzLmdldFN0YXJ0UG9zdCgpLCBub2RlKSA8PSAwDQogICAgICAgICAgICA6IHRoaXMuaW5kZXhfLmNvbXBhcmUodGhpcy5nZXRTdGFydFBvc3QoKSwgbm9kZSkgPCAwOw0KICAgICAgICBjb25zdCBpc1dpdGhpbkVuZCA9IHRoaXMuZW5kSXNJbmNsdXNpdmVfDQogICAgICAgICAgICA/IHRoaXMuaW5kZXhfLmNvbXBhcmUobm9kZSwgdGhpcy5nZXRFbmRQb3N0KCkpIDw9IDANCiAgICAgICAgICAgIDogdGhpcy5pbmRleF8uY29tcGFyZShub2RlLCB0aGlzLmdldEVuZFBvc3QoKSkgPCAwOw0KICAgICAgICByZXR1cm4gaXNXaXRoaW5TdGFydCAmJiBpc1dpdGhpbkVuZDsNCiAgICB9DQogICAgdXBkYXRlQ2hpbGQoc25hcCwga2V5LCBuZXdDaGlsZCwgYWZmZWN0ZWRQYXRoLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmICghdGhpcy5tYXRjaGVzKG5ldyBOYW1lZE5vZGUoa2V5LCBuZXdDaGlsZCkpKSB7DQogICAgICAgICAgICBuZXdDaGlsZCA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4ZWRGaWx0ZXJfLnVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIG5ld1NuYXAsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmIChuZXdTbmFwLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBjaGlsZHJlbiBub2RlIHdpdGggdGhlIGNvcnJlY3QgaW5kZXgsIG5vdCBhIGxlYWYgbm9kZTsNCiAgICAgICAgICAgIG5ld1NuYXAgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgZmlsdGVyZWQgPSBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlUHJpb3JpdHkoQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICBjb25zdCBzZWxmID0gdGhpczsNCiAgICAgICAgbmV3U25hcC5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgaWYgKCFzZWxmLm1hdGNoZXMobmV3IE5hbWVkTm9kZShrZXksIGNoaWxkTm9kZSkpKSB7DQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC51cGRhdGVJbW1lZGlhdGVDaGlsZChrZXksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4ZWRGaWx0ZXJfLnVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIGZpbHRlcmVkLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIHJldHVybiBvbGRTbmFwOw0KICAgIH0NCiAgICBmaWx0ZXJzTm9kZXMoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleGVkRmlsdGVyXzsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQogICAgc3RhdGljIGdldFN0YXJ0UG9zdF8ocGFyYW1zKSB7DQogICAgICAgIGlmIChwYXJhbXMuaGFzU3RhcnQoKSkgew0KICAgICAgICAgICAgY29uc3Qgc3RhcnROYW1lID0gcGFyYW1zLmdldEluZGV4U3RhcnROYW1lKCk7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWFrZVBvc3QocGFyYW1zLmdldEluZGV4U3RhcnRWYWx1ZSgpLCBzdGFydE5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5nZXRJbmRleCgpLm1pblBvc3QoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGF0aWMgZ2V0RW5kUG9zdF8ocGFyYW1zKSB7DQogICAgICAgIGlmIChwYXJhbXMuaGFzRW5kKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGVuZE5hbWUgPSBwYXJhbXMuZ2V0SW5kZXhFbmROYW1lKCk7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWFrZVBvc3QocGFyYW1zLmdldEluZGV4RW5kVmFsdWUoKSwgZW5kTmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWF4UG9zdCgpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBcHBsaWVzIGEgbGltaXQgYW5kIGEgcmFuZ2UgdG8gYSBub2RlIGFuZCB1c2VzIFJhbmdlZEZpbHRlciB0byBkbyB0aGUgaGVhdnkgbGlmdGluZyB3aGVyZSBwb3NzaWJsZQ0KICovDQpjbGFzcyBMaW1pdGVkRmlsdGVyIHsNCiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsNCiAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbFN0YXJ0ID0gKG5vZGUpID0+IHRoaXMucmV2ZXJzZV8gPyB0aGlzLndpdGhpbkVuZFBvc3Qobm9kZSkgOiB0aGlzLndpdGhpblN0YXJ0UG9zdChub2RlKTsNCiAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbEVuZCA9IChub2RlKSA9PiB0aGlzLnJldmVyc2VfID8gdGhpcy53aXRoaW5TdGFydFBvc3Qobm9kZSkgOiB0aGlzLndpdGhpbkVuZFBvc3Qobm9kZSk7DQogICAgICAgIHRoaXMud2l0aGluU3RhcnRQb3N0ID0gKG5vZGUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVSZXMgPSB0aGlzLmluZGV4Xy5jb21wYXJlKHRoaXMucmFuZ2VkRmlsdGVyXy5nZXRTdGFydFBvc3QoKSwgbm9kZSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydElzSW5jbHVzaXZlXyA/IGNvbXBhcmVSZXMgPD0gMCA6IGNvbXBhcmVSZXMgPCAwOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLndpdGhpbkVuZFBvc3QgPSAobm9kZSkgPT4gew0KICAgICAgICAgICAgY29uc3QgY29tcGFyZVJlcyA9IHRoaXMuaW5kZXhfLmNvbXBhcmUobm9kZSwgdGhpcy5yYW5nZWRGaWx0ZXJfLmdldEVuZFBvc3QoKSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5lbmRJc0luY2x1c2l2ZV8gPyBjb21wYXJlUmVzIDw9IDAgOiBjb21wYXJlUmVzIDwgMDsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5yYW5nZWRGaWx0ZXJfID0gbmV3IFJhbmdlZEZpbHRlcihwYXJhbXMpOw0KICAgICAgICB0aGlzLmluZGV4XyA9IHBhcmFtcy5nZXRJbmRleCgpOw0KICAgICAgICB0aGlzLmxpbWl0XyA9IHBhcmFtcy5nZXRMaW1pdCgpOw0KICAgICAgICB0aGlzLnJldmVyc2VfID0gIXBhcmFtcy5pc1ZpZXdGcm9tTGVmdCgpOw0KICAgICAgICB0aGlzLnN0YXJ0SXNJbmNsdXNpdmVfID0gIXBhcmFtcy5zdGFydEFmdGVyU2V0XzsNCiAgICAgICAgdGhpcy5lbmRJc0luY2x1c2l2ZV8gPSAhcGFyYW1zLmVuZEJlZm9yZVNldF87DQogICAgfQ0KICAgIHVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikgew0KICAgICAgICBpZiAoIXRoaXMucmFuZ2VkRmlsdGVyXy5tYXRjaGVzKG5ldyBOYW1lZE5vZGUoa2V5LCBuZXdDaGlsZCkpKSB7DQogICAgICAgICAgICBuZXdDaGlsZCA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGlmIChzbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSkuZXF1YWxzKG5ld0NoaWxkKSkgew0KICAgICAgICAgICAgLy8gTm8gY2hhbmdlDQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChzbmFwLm51bUNoaWxkcmVuKCkgPCB0aGlzLmxpbWl0Xykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2VkRmlsdGVyXw0KICAgICAgICAgICAgICAgIC5nZXRJbmRleGVkRmlsdGVyKCkNCiAgICAgICAgICAgICAgICAudXBkYXRlQ2hpbGQoc25hcCwga2V5LCBuZXdDaGlsZCwgYWZmZWN0ZWRQYXRoLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmZ1bGxMaW1pdFVwZGF0ZUNoaWxkXyhzbmFwLCBrZXksIG5ld0NoaWxkLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB1cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBuZXdTbmFwLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikgew0KICAgICAgICBsZXQgZmlsdGVyZWQ7DQogICAgICAgIGlmIChuZXdTbmFwLmlzTGVhZk5vZGUoKSB8fCBuZXdTbmFwLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBjaGlsZHJlbiBub2RlIHdpdGggdGhlIGNvcnJlY3QgaW5kZXgsIG5vdCBhIGxlYWYgbm9kZTsNCiAgICAgICAgICAgIGZpbHRlcmVkID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUud2l0aEluZGV4KHRoaXMuaW5kZXhfKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmxpbWl0XyAqIDIgPCBuZXdTbmFwLm51bUNoaWxkcmVuKCkgJiYNCiAgICAgICAgICAgICAgICBuZXdTbmFwLmlzSW5kZXhlZCh0aGlzLmluZGV4XykpIHsNCiAgICAgICAgICAgICAgICAvLyBFYXNpZXIgdG8gYnVpbGQgdXAgYSBzbmFwc2hvdCwgc2luY2Ugd2hhdCB3ZSdyZSBnaXZlbiBoYXMgbW9yZSB0aGFuIHR3aWNlIHRoZSBlbGVtZW50cyB3ZSB3YW50DQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERS53aXRoSW5kZXgodGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIC8vIGFuY2hvciB0byB0aGUgc3RhcnRQb3N0LCBlbmRQb3N0LCBvciBsYXN0IGVsZW1lbnQgYXMgYXBwcm9wcmlhdGUNCiAgICAgICAgICAgICAgICBsZXQgaXRlcmF0b3I7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBuZXdTbmFwLmdldFJldmVyc2VJdGVyYXRvckZyb20odGhpcy5yYW5nZWRGaWx0ZXJfLmdldEVuZFBvc3QoKSwgdGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBuZXdTbmFwLmdldEl0ZXJhdG9yRnJvbSh0aGlzLnJhbmdlZEZpbHRlcl8uZ2V0U3RhcnRQb3N0KCksIHRoaXMuaW5kZXhfKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoaXRlcmF0b3IuaGFzTmV4dCgpICYmIGNvdW50IDwgdGhpcy5saW1pdF8pIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IGl0ZXJhdG9yLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLndpdGhpbkRpcmVjdGlvbmFsU3RhcnQobmV4dCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgbm90IHJlYWNoZWQgdGhlIHN0YXJ0LCBza2lwIHRvIHRoZSBuZXh0IGVsZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLndpdGhpbkRpcmVjdGlvbmFsRW5kKG5leHQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHJlYWNoZWQgdGhlIGVuZCwgc3RvcCBhZGRpbmcgZWxlbWVudHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC51cGRhdGVJbW1lZGlhdGVDaGlsZChuZXh0Lm5hbWUsIG5leHQubm9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhlIHNuYXAgY29udGFpbnMgbGVzcyB0aGFuIHR3aWNlIHRoZSBsaW1pdC4gRmFzdGVyIHRvIGRlbGV0ZSBmcm9tIHRoZSBzbmFwIHRoYW4gYnVpbGQgdXAgYSBuZXcgb25lDQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgICAgICAgICAgICAgLy8gRG9uJ3Qgc3VwcG9ydCBwcmlvcml0aWVzIG9uIHF1ZXJpZXMNCiAgICAgICAgICAgICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLnVwZGF0ZVByaW9yaXR5KENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTsNCiAgICAgICAgICAgICAgICBsZXQgaXRlcmF0b3I7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBmaWx0ZXJlZC5nZXRSZXZlcnNlSXRlcmF0b3IodGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBmaWx0ZXJlZC5nZXRJdGVyYXRvcih0aGlzLmluZGV4Xyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLmhhc05leHQoKSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gaXRlcmF0b3IuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpblJhbmdlID0gY291bnQgPCB0aGlzLmxpbWl0XyAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbFN0YXJ0KG5leHQpICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpdGhpbkRpcmVjdGlvbmFsRW5kKG5leHQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5SYW5nZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlSW1tZWRpYXRlQ2hpbGQobmV4dC5uYW1lLCBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2VkRmlsdGVyXw0KICAgICAgICAgICAgLmdldEluZGV4ZWRGaWx0ZXIoKQ0KICAgICAgICAgICAgLnVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIGZpbHRlcmVkLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIHJldHVybiBvbGRTbmFwOw0KICAgIH0NCiAgICBmaWx0ZXJzTm9kZXMoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yYW5nZWRGaWx0ZXJfLmdldEluZGV4ZWRGaWx0ZXIoKTsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQogICAgZnVsbExpbWl0VXBkYXRlQ2hpbGRfKHNuYXAsIGNoaWxkS2V5LCBjaGlsZFNuYXAsIHNvdXJjZSwgY2hhbmdlQWNjdW11bGF0b3IpIHsNCiAgICAgICAgLy8gVE9ETzogcmVuYW1lIGFsbCBjYWNoZSBzdHVmZiBldGMgdG8gZ2VuZXJhbCBzbmFwIHRlcm1pbm9sb2d5DQogICAgICAgIGxldCBjbXA7DQogICAgICAgIGlmICh0aGlzLnJldmVyc2VfKSB7DQogICAgICAgICAgICBjb25zdCBpbmRleENtcCA9IHRoaXMuaW5kZXhfLmdldENvbXBhcmUoKTsNCiAgICAgICAgICAgIGNtcCA9IChhLCBiKSA9PiBpbmRleENtcChiLCBhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNtcCA9IHRoaXMuaW5kZXhfLmdldENvbXBhcmUoKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBvbGRFdmVudENhY2hlID0gc25hcDsNCiAgICAgICAgYXNzZXJ0KG9sZEV2ZW50Q2FjaGUubnVtQ2hpbGRyZW4oKSA9PT0gdGhpcy5saW1pdF8sICcnKTsNCiAgICAgICAgY29uc3QgbmV3Q2hpbGROYW1lZE5vZGUgPSBuZXcgTmFtZWROb2RlKGNoaWxkS2V5LCBjaGlsZFNuYXApOw0KICAgICAgICBjb25zdCB3aW5kb3dCb3VuZGFyeSA9IHRoaXMucmV2ZXJzZV8NCiAgICAgICAgICAgID8gb2xkRXZlbnRDYWNoZS5nZXRGaXJzdENoaWxkKHRoaXMuaW5kZXhfKQ0KICAgICAgICAgICAgOiBvbGRFdmVudENhY2hlLmdldExhc3RDaGlsZCh0aGlzLmluZGV4Xyk7DQogICAgICAgIGNvbnN0IGluUmFuZ2UgPSB0aGlzLnJhbmdlZEZpbHRlcl8ubWF0Y2hlcyhuZXdDaGlsZE5hbWVkTm9kZSk7DQogICAgICAgIGlmIChvbGRFdmVudENhY2hlLmhhc0NoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGRTbmFwID0gb2xkRXZlbnRDYWNoZS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgICAgICBsZXQgbmV4dENoaWxkID0gc291cmNlLmdldENoaWxkQWZ0ZXJDaGlsZCh0aGlzLmluZGV4Xywgd2luZG93Qm91bmRhcnksIHRoaXMucmV2ZXJzZV8pOw0KICAgICAgICAgICAgd2hpbGUgKG5leHRDaGlsZCAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgKG5leHRDaGlsZC5uYW1lID09PSBjaGlsZEtleSB8fCBvbGRFdmVudENhY2hlLmhhc0NoaWxkKG5leHRDaGlsZC5uYW1lKSkpIHsNCiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBhIHdlaXJkIGVkZ2UgY2FzZSB3aGVyZSBhIG5vZGUgaXMgdXBkYXRlZCBhcyBwYXJ0IG9mIGEgbWVyZ2UgaW4gdGhlIHdyaXRlIHRyZWUsIGJ1dCBoYXNuJ3QNCiAgICAgICAgICAgICAgICAvLyBiZWVuIGFwcGxpZWQgdG8gdGhlIGxpbWl0ZWQgZmlsdGVyIHlldC4gSWdub3JlIHRoaXMgbmV4dCBjaGlsZCB3aGljaCB3aWxsIGJlIHVwZGF0ZWQgbGF0ZXIgaW4NCiAgICAgICAgICAgICAgICAvLyB0aGUgbGltaXRlZCBmaWx0ZXIuLi4NCiAgICAgICAgICAgICAgICBuZXh0Q2hpbGQgPSBzb3VyY2UuZ2V0Q2hpbGRBZnRlckNoaWxkKHRoaXMuaW5kZXhfLCBuZXh0Q2hpbGQsIHRoaXMucmV2ZXJzZV8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgY29tcGFyZU5leHQgPSBuZXh0Q2hpbGQgPT0gbnVsbCA/IDEgOiBjbXAobmV4dENoaWxkLCBuZXdDaGlsZE5hbWVkTm9kZSk7DQogICAgICAgICAgICBjb25zdCByZW1haW5zSW5XaW5kb3cgPSBpblJhbmdlICYmICFjaGlsZFNuYXAuaXNFbXB0eSgpICYmIGNvbXBhcmVOZXh0ID49IDA7DQogICAgICAgICAgICBpZiAocmVtYWluc0luV2luZG93KSB7DQogICAgICAgICAgICAgICAgaWYgKGNoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoY2hpbGRLZXksIGNoaWxkU25hcCwgb2xkQ2hpbGRTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBvbGRFdmVudENhY2hlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5LCBjaGlsZFNuYXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGNoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGRLZXksIG9sZENoaWxkU25hcCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBuZXdFdmVudENhY2hlID0gb2xkRXZlbnRDYWNoZS51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZEtleSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGlsZEluUmFuZ2UgPSBuZXh0Q2hpbGQgIT0gbnVsbCAmJiB0aGlzLnJhbmdlZEZpbHRlcl8ubWF0Y2hlcyhuZXh0Q2hpbGQpOw0KICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hpbGRJblJhbmdlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQobmV4dENoaWxkLm5hbWUsIG5leHRDaGlsZC5ub2RlKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0V2ZW50Q2FjaGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQobmV4dENoaWxkLm5hbWUsIG5leHRDaGlsZC5ub2RlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdFdmVudENhY2hlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChjaGlsZFNuYXAuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAvLyB3ZSdyZSBkZWxldGluZyBhIG5vZGUsIGJ1dCBpdCB3YXMgbm90IGluIHRoZSB3aW5kb3csIHNvIGlnbm9yZSBpdA0KICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaW5SYW5nZSkgew0KICAgICAgICAgICAgaWYgKGNtcCh3aW5kb3dCb3VuZGFyeSwgbmV3Q2hpbGROYW1lZE5vZGUpID49IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlQWNjdW11bGF0b3IgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBjaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkUmVtb3ZlZCh3aW5kb3dCb3VuZGFyeS5uYW1lLCB3aW5kb3dCb3VuZGFyeS5ub2RlKSk7DQogICAgICAgICAgICAgICAgICAgIGNoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRBZGRlZChjaGlsZEtleSwgY2hpbGRTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBvbGRFdmVudENhY2hlDQogICAgICAgICAgICAgICAgICAgIC51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZEtleSwgY2hpbGRTbmFwKQ0KICAgICAgICAgICAgICAgICAgICAudXBkYXRlSW1tZWRpYXRlQ2hpbGQod2luZG93Qm91bmRhcnkubmFtZSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogVGhpcyBjbGFzcyBpcyBhbiBpbW11dGFibGUtZnJvbS10aGUtcHVibGljLWFwaSBzdHJ1Y3QgY29udGFpbmluZyBhIHNldCBvZiBxdWVyeSBwYXJhbWV0ZXJzIGRlZmluaW5nIGENCiAqIHJhbmdlIHRvIGJlIHJldHVybmVkIGZvciBhIHBhcnRpY3VsYXIgbG9jYXRpb24uIEl0IGlzIGFzc3VtZWQgdGhhdCB2YWxpZGF0aW9uIG9mIHBhcmFtZXRlcnMgaXMgZG9uZSBhdCB0aGUNCiAqIHVzZXItZmFjaW5nIEFQSSBsZXZlbCwgc28gaXQgaXMgbm90IGRvbmUgaGVyZS4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgUXVlcnlQYXJhbXMgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmxpbWl0U2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnN0YXJ0U2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnN0YXJ0TmFtZVNldF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5zdGFydEFmdGVyU2V0XyA9IGZhbHNlOyAvLyBjYW4gb25seSBiZSB0cnVlIGlmIHN0YXJ0U2V0XyBpcyB0cnVlDQogICAgICAgIHRoaXMuZW5kU2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmVuZE5hbWVTZXRfID0gZmFsc2U7DQogICAgICAgIHRoaXMuZW5kQmVmb3JlU2V0XyA9IGZhbHNlOyAvLyBjYW4gb25seSBiZSB0cnVlIGlmIGVuZFNldF8gaXMgdHJ1ZQ0KICAgICAgICB0aGlzLmxpbWl0XyA9IDA7DQogICAgICAgIHRoaXMudmlld0Zyb21fID0gJyc7DQogICAgICAgIHRoaXMuaW5kZXhTdGFydFZhbHVlXyA9IG51bGw7DQogICAgICAgIHRoaXMuaW5kZXhTdGFydE5hbWVfID0gJyc7DQogICAgICAgIHRoaXMuaW5kZXhFbmRWYWx1ZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmluZGV4RW5kTmFtZV8gPSAnJzsNCiAgICAgICAgdGhpcy5pbmRleF8gPSBQUklPUklUWV9JTkRFWDsNCiAgICB9DQogICAgaGFzU3RhcnQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0YXJ0U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBpdCB3b3VsZCByZXR1cm4gZnJvbSBsZWZ0Lg0KICAgICAqLw0KICAgIGlzVmlld0Zyb21MZWZ0KCkgew0KICAgICAgICBpZiAodGhpcy52aWV3RnJvbV8gPT09ICcnKSB7DQogICAgICAgICAgICAvLyBsaW1pdCgpLCByYXRoZXIgdGhhbiBsaW1pdFRvRmlyc3Qgb3IgbGltaXRUb0xhc3Qgd2FzIGNhbGxlZC4NCiAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCBvbmx5IG9uZSBvZiBzdGFydFNldF8gYW5kIGVuZFNldF8gaXMgdHJ1ZS4gVXNlIHRoZW0NCiAgICAgICAgICAgIC8vIHRvIGNhbGN1bGF0ZSB3aGljaCBzaWRlIG9mIHRoZSB2aWV3IHRvIGFuY2hvciB0by4gSWYgbmVpdGhlciBpcyBzZXQsDQogICAgICAgICAgICAvLyBhbmNob3IgdG8gdGhlIGVuZC4NCiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0U2V0XzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdGcm9tXyA9PT0gImwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9MRUZUICovOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNTdGFydCgpIHJldHVybnMgdHJ1ZQ0KICAgICAqLw0KICAgIGdldEluZGV4U3RhcnRWYWx1ZSgpIHsNCiAgICAgICAgYXNzZXJ0KHRoaXMuc3RhcnRTZXRfLCAnT25seSB2YWxpZCBpZiBzdGFydCBoYXMgYmVlbiBzZXQnKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICB9DQogICAgLyoqDQogICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc1N0YXJ0KCkgcmV0dXJucyB0cnVlLg0KICAgICAqIFJldHVybnMgdGhlIHN0YXJ0aW5nIGtleSBuYW1lIGZvciB0aGUgcmFuZ2UgZGVmaW5lZCBieSB0aGVzZSBxdWVyeSBwYXJhbWV0ZXJzDQogICAgICovDQogICAgZ2V0SW5kZXhTdGFydE5hbWUoKSB7DQogICAgICAgIGFzc2VydCh0aGlzLnN0YXJ0U2V0XywgJ09ubHkgdmFsaWQgaWYgc3RhcnQgaGFzIGJlZW4gc2V0Jyk7DQogICAgICAgIGlmICh0aGlzLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4U3RhcnROYW1lXzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBNSU5fTkFNRTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBoYXNFbmQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmVuZFNldF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNFbmQoKSByZXR1cm5zIHRydWUuDQogICAgICovDQogICAgZ2V0SW5kZXhFbmRWYWx1ZSgpIHsNCiAgICAgICAgYXNzZXJ0KHRoaXMuZW5kU2V0XywgJ09ubHkgdmFsaWQgaWYgZW5kIGhhcyBiZWVuIHNldCcpOw0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleEVuZFZhbHVlXzsNCiAgICB9DQogICAgLyoqDQogICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc0VuZCgpIHJldHVybnMgdHJ1ZS4NCiAgICAgKiBSZXR1cm5zIHRoZSBlbmQga2V5IG5hbWUgZm9yIHRoZSByYW5nZSBkZWZpbmVkIGJ5IHRoZXNlIHF1ZXJ5IHBhcmFtZXRlcnMNCiAgICAgKi8NCiAgICBnZXRJbmRleEVuZE5hbWUoKSB7DQogICAgICAgIGFzc2VydCh0aGlzLmVuZFNldF8sICdPbmx5IHZhbGlkIGlmIGVuZCBoYXMgYmVlbiBzZXQnKTsNCiAgICAgICAgaWYgKHRoaXMuZW5kTmFtZVNldF8pIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4RW5kTmFtZV87DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gTUFYX05BTUU7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzTGltaXQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGxpbWl0IGhhcyBiZWVuIHNldCBhbmQgaXQgaGFzIGJlZW4gZXhwbGljaXRseSBhbmNob3JlZA0KICAgICAqLw0KICAgIGhhc0FuY2hvcmVkTGltaXQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XyAmJiB0aGlzLnZpZXdGcm9tXyAhPT0gJyc7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNMaW1pdCgpIHJldHVybnMgdHJ1ZQ0KICAgICAqLw0KICAgIGdldExpbWl0KCkgew0KICAgICAgICBhc3NlcnQodGhpcy5saW1pdFNldF8sICdPbmx5IHZhbGlkIGlmIGxpbWl0IGhhcyBiZWVuIHNldCcpOw0KICAgICAgICByZXR1cm4gdGhpcy5saW1pdF87DQogICAgfQ0KICAgIGdldEluZGV4KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87DQogICAgfQ0KICAgIGxvYWRzQWxsRGF0YSgpIHsNCiAgICAgICAgcmV0dXJuICEodGhpcy5zdGFydFNldF8gfHwgdGhpcy5lbmRTZXRfIHx8IHRoaXMubGltaXRTZXRfKTsNCiAgICB9DQogICAgaXNEZWZhdWx0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5sb2Fkc0FsbERhdGEoKSAmJiB0aGlzLmluZGV4XyA9PT0gUFJJT1JJVFlfSU5ERVg7DQogICAgfQ0KICAgIGNvcHkoKSB7DQogICAgICAgIGNvbnN0IGNvcHkgPSBuZXcgUXVlcnlQYXJhbXMoKTsNCiAgICAgICAgY29weS5saW1pdFNldF8gPSB0aGlzLmxpbWl0U2V0XzsNCiAgICAgICAgY29weS5saW1pdF8gPSB0aGlzLmxpbWl0XzsNCiAgICAgICAgY29weS5zdGFydFNldF8gPSB0aGlzLnN0YXJ0U2V0XzsNCiAgICAgICAgY29weS5zdGFydEFmdGVyU2V0XyA9IHRoaXMuc3RhcnRBZnRlclNldF87DQogICAgICAgIGNvcHkuaW5kZXhTdGFydFZhbHVlXyA9IHRoaXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICAgICAgY29weS5zdGFydE5hbWVTZXRfID0gdGhpcy5zdGFydE5hbWVTZXRfOw0KICAgICAgICBjb3B5LmluZGV4U3RhcnROYW1lXyA9IHRoaXMuaW5kZXhTdGFydE5hbWVfOw0KICAgICAgICBjb3B5LmVuZFNldF8gPSB0aGlzLmVuZFNldF87DQogICAgICAgIGNvcHkuZW5kQmVmb3JlU2V0XyA9IHRoaXMuZW5kQmVmb3JlU2V0XzsNCiAgICAgICAgY29weS5pbmRleEVuZFZhbHVlXyA9IHRoaXMuaW5kZXhFbmRWYWx1ZV87DQogICAgICAgIGNvcHkuZW5kTmFtZVNldF8gPSB0aGlzLmVuZE5hbWVTZXRfOw0KICAgICAgICBjb3B5LmluZGV4RW5kTmFtZV8gPSB0aGlzLmluZGV4RW5kTmFtZV87DQogICAgICAgIGNvcHkuaW5kZXhfID0gdGhpcy5pbmRleF87DQogICAgICAgIGNvcHkudmlld0Zyb21fID0gdGhpcy52aWV3RnJvbV87DQogICAgICAgIHJldHVybiBjb3B5Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIHF1ZXJ5UGFyYW1zR2V0Tm9kZUZpbHRlcihxdWVyeVBhcmFtcykgew0KICAgIGlmIChxdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICByZXR1cm4gbmV3IEluZGV4ZWRGaWx0ZXIocXVlcnlQYXJhbXMuZ2V0SW5kZXgoKSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHF1ZXJ5UGFyYW1zLmhhc0xpbWl0KCkpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBMaW1pdGVkRmlsdGVyKHF1ZXJ5UGFyYW1zKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHJldHVybiBuZXcgUmFuZ2VkRmlsdGVyKHF1ZXJ5UGFyYW1zKTsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgYSBzZXQgb2YgUkVTVCBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyByZXByZXNlbnRpbmcgdGhpcyBxdWVyeS4NCiAqDQogKiBAcmV0dXJucyBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycw0KICovDQpmdW5jdGlvbiBxdWVyeVBhcmFtc1RvUmVzdFF1ZXJ5U3RyaW5nUGFyYW1ldGVycyhxdWVyeVBhcmFtcykgew0KICAgIGNvbnN0IHFzID0ge307DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpKSB7DQogICAgICAgIHJldHVybiBxczsNCiAgICB9DQogICAgbGV0IG9yZGVyQnk7DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyA9PT0gUFJJT1JJVFlfSU5ERVgpIHsNCiAgICAgICAgb3JkZXJCeSA9ICIkcHJpb3JpdHkiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLlBSSU9SSVRZX0lOREVYICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChxdWVyeVBhcmFtcy5pbmRleF8gPT09IFZBTFVFX0lOREVYKSB7DQogICAgICAgIG9yZGVyQnkgPSAiJHZhbHVlIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5WQUxVRV9JTkRFWCAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAocXVlcnlQYXJhbXMuaW5kZXhfID09PSBLRVlfSU5ERVgpIHsNCiAgICAgICAgb3JkZXJCeSA9ICIka2V5IiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5LRVlfSU5ERVggKi87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBhc3NlcnQocXVlcnlQYXJhbXMuaW5kZXhfIGluc3RhbmNlb2YgUGF0aEluZGV4LCAnVW5yZWNvZ25pemVkIGluZGV4IHR5cGUhJyk7DQogICAgICAgIG9yZGVyQnkgPSBxdWVyeVBhcmFtcy5pbmRleF8udG9TdHJpbmcoKTsNCiAgICB9DQogICAgcXNbIm9yZGVyQnkiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLk9SREVSX0JZICovXSA9IHN0cmluZ2lmeShvcmRlckJ5KTsNCiAgICBpZiAocXVlcnlQYXJhbXMuc3RhcnRTZXRfKSB7DQogICAgICAgIGNvbnN0IHN0YXJ0UGFyYW0gPSBxdWVyeVBhcmFtcy5zdGFydEFmdGVyU2V0Xw0KICAgICAgICAgICAgPyAic3RhcnRBZnRlciIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuU1RBUlRfQUZURVIgKi8NCiAgICAgICAgICAgIDogInN0YXJ0QXQiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLlNUQVJUX0FUICovOw0KICAgICAgICBxc1tzdGFydFBhcmFtXSA9IHN0cmluZ2lmeShxdWVyeVBhcmFtcy5pbmRleFN0YXJ0VmFsdWVfKTsNCiAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIHFzW3N0YXJ0UGFyYW1dICs9ICcsJyArIHN0cmluZ2lmeShxdWVyeVBhcmFtcy5pbmRleFN0YXJ0TmFtZV8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChxdWVyeVBhcmFtcy5lbmRTZXRfKSB7DQogICAgICAgIGNvbnN0IGVuZFBhcmFtID0gcXVlcnlQYXJhbXMuZW5kQmVmb3JlU2V0Xw0KICAgICAgICAgICAgPyAiZW5kQmVmb3JlIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5FTkRfQkVGT1JFICovDQogICAgICAgICAgICA6ICJlbmRBdCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuRU5EX0FUICovOw0KICAgICAgICBxc1tlbmRQYXJhbV0gPSBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV8pOw0KICAgICAgICBpZiAocXVlcnlQYXJhbXMuZW5kTmFtZVNldF8pIHsNCiAgICAgICAgICAgIHFzW2VuZFBhcmFtXSArPSAnLCcgKyBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmROYW1lXyk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmxpbWl0U2V0Xykgew0KICAgICAgICBpZiAocXVlcnlQYXJhbXMuaXNWaWV3RnJvbUxlZnQoKSkgew0KICAgICAgICAgICAgcXNbImxpbWl0VG9GaXJzdCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuTElNSVRfVE9fRklSU1QgKi9dID0gcXVlcnlQYXJhbXMubGltaXRfOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcXNbImxpbWl0VG9MYXN0IiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5MSU1JVF9UT19MQVNUICovXSA9IHF1ZXJ5UGFyYW1zLmxpbWl0XzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcXM7DQp9DQpmdW5jdGlvbiBxdWVyeVBhcmFtc0dldFF1ZXJ5T2JqZWN0KHF1ZXJ5UGFyYW1zKSB7DQogICAgY29uc3Qgb2JqID0ge307DQogICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0U2V0Xykgew0KICAgICAgICBvYmpbInNwIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9TVEFSVF9WQUxVRSAqL10gPQ0KICAgICAgICAgICAgcXVlcnlQYXJhbXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIG9ialsic24iIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYX1NUQVJUX05BTUUgKi9dID0NCiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtcy5pbmRleFN0YXJ0TmFtZV87DQogICAgICAgIH0NCiAgICAgICAgb2JqWyJzaW4iIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYX1NUQVJUX0lTX0lOQ0xVU0lWRSAqL10gPQ0KICAgICAgICAgICAgIXF1ZXJ5UGFyYW1zLnN0YXJ0QWZ0ZXJTZXRfOw0KICAgIH0NCiAgICBpZiAocXVlcnlQYXJhbXMuZW5kU2V0Xykgew0KICAgICAgICBvYmpbImVwIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9FTkRfVkFMVUUgKi9dID0gcXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV87DQogICAgICAgIGlmIChxdWVyeVBhcmFtcy5lbmROYW1lU2V0Xykgew0KICAgICAgICAgICAgb2JqWyJlbiIgLyogV0lSRV9QUk9UT0NPTF9DT05TVEFOVFMuSU5ERVhfRU5EX05BTUUgKi9dID0gcXVlcnlQYXJhbXMuaW5kZXhFbmROYW1lXzsNCiAgICAgICAgfQ0KICAgICAgICBvYmpbImVpbiIgLyogV0lSRV9QUk9UT0NPTF9DT05TVEFOVFMuSU5ERVhfRU5EX0lTX0lOQ0xVU0lWRSAqL10gPQ0KICAgICAgICAgICAgIXF1ZXJ5UGFyYW1zLmVuZEJlZm9yZVNldF87DQogICAgfQ0KICAgIGlmIChxdWVyeVBhcmFtcy5saW1pdFNldF8pIHsNCiAgICAgICAgb2JqWyJsIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5MSU1JVCAqL10gPSBxdWVyeVBhcmFtcy5saW1pdF87DQogICAgICAgIGxldCB2aWV3RnJvbSA9IHF1ZXJ5UGFyYW1zLnZpZXdGcm9tXzsNCiAgICAgICAgaWYgKHZpZXdGcm9tID09PSAnJykgew0KICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLmlzVmlld0Zyb21MZWZ0KCkpIHsNCiAgICAgICAgICAgICAgICB2aWV3RnJvbSA9ICJsIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST01fTEVGVCAqLzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHZpZXdGcm9tID0gInIiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9SSUdIVCAqLzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBvYmpbInZmIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST00gKi9dID0gdmlld0Zyb207DQogICAgfQ0KICAgIC8vIEZvciBub3csIHByaW9yaXR5IGluZGV4IGlzIHRoZSBkZWZhdWx0LCBzbyB3ZSBvbmx5IHNwZWNpZnkgaWYgaXQncyBzb21lIG90aGVyIGluZGV4DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyAhPT0gUFJJT1JJVFlfSU5ERVgpIHsNCiAgICAgICAgb2JqWyJpIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWCAqL10gPSBxdWVyeVBhcmFtcy5pbmRleF8udG9TdHJpbmcoKTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgU2VydmVyQWN0aW9ucyB0aGF0IGNvbW11bmljYXRlcyB3aXRoIHRoZSBzZXJ2ZXIgdmlhIFJFU1QgcmVxdWVzdHMuDQogKiBUaGlzIGlzIG1vc3RseSB1c2VmdWwgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBjcmF3bGVycywgd2hlcmUgd2UgZG9uJ3Qgd2FudCB0byBzcGluIHVwIGEgZnVsbA0KICogcGVyc2lzdGVudCBjb25uZWN0aW9uICh1c2luZyBXZWJTb2NrZXRzIG9yIGxvbmctcG9sbGluZykNCiAqLw0KY2xhc3MgUmVhZG9ubHlSZXN0Q2xpZW50IGV4dGVuZHMgU2VydmVyQWN0aW9ucyB7DQogICAgLyoqDQogICAgICogQHBhcmFtIHJlcG9JbmZvXyAtIERhdGEgYWJvdXQgdGhlIG5hbWVzcGFjZSB3ZSBhcmUgY29ubmVjdGluZyB0bw0KICAgICAqIEBwYXJhbSBvbkRhdGFVcGRhdGVfIC0gQSBjYWxsYmFjayBmb3IgbmV3IGRhdGEgZnJvbSB0aGUgc2VydmVyDQogICAgICovDQogICAgY29uc3RydWN0b3IocmVwb0luZm9fLCBvbkRhdGFVcGRhdGVfLCBhdXRoVG9rZW5Qcm92aWRlcl8sIGFwcENoZWNrVG9rZW5Qcm92aWRlcl8pIHsNCiAgICAgICAgc3VwZXIoKTsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18gPSByZXBvSW5mb187DQogICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyA9IG9uRGF0YVVwZGF0ZV87DQogICAgICAgIHRoaXMuYXV0aFRva2VuUHJvdmlkZXJfID0gYXV0aFRva2VuUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8gPSBhcHBDaGVja1Rva2VuUHJvdmlkZXJfOw0KICAgICAgICAvKiogQHByaXZhdGUge2Z1bmN0aW9uKC4uLlsqXSl9ICovDQogICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ3A6cmVzdDonKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFdlIGRvbid0IGFjdHVhbGx5IG5lZWQgdG8gdHJhY2sgbGlzdGVucywgZXhjZXB0IHRvIHByZXZlbnQgdXMgY2FsbGluZyBhbiBvbkNvbXBsZXRlIGZvciBhIGxpc3Rlbg0KICAgICAgICAgKiB0aGF0J3MgYmVlbiByZW1vdmVkLiA6LS8NCiAgICAgICAgICovDQogICAgICAgIHRoaXMubGlzdGVuc18gPSB7fTsNCiAgICB9DQogICAgcmVwb3J0U3RhdHMoc3RhdHMpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpOw0KICAgIH0NCiAgICBzdGF0aWMgZ2V0TGlzdGVuSWRfKHF1ZXJ5LCB0YWcpIHsNCiAgICAgICAgaWYgKHRhZyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICByZXR1cm4gJ3RhZyQnICsgdGFnOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KHF1ZXJ5Ll9xdWVyeVBhcmFtcy5pc0RlZmF1bHQoKSwgInNob3VsZCBoYXZlIGEgdGFnIGlmIGl0J3Mgbm90IGEgZGVmYXVsdCBxdWVyeS4iKTsNCiAgICAgICAgICAgIHJldHVybiBxdWVyeS5fcGF0aC50b1N0cmluZygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGxpc3RlbihxdWVyeSwgY3VycmVudEhhc2hGbiwgdGFnLCBvbkNvbXBsZXRlKSB7DQogICAgICAgIGNvbnN0IHBhdGhTdHJpbmcgPSBxdWVyeS5fcGF0aC50b1N0cmluZygpOw0KICAgICAgICB0aGlzLmxvZ18oJ0xpc3RlbiBjYWxsZWQgZm9yICcgKyBwYXRoU3RyaW5nICsgJyAnICsgcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcik7DQogICAgICAgIC8vIE1hcmsgdGhpcyBsaXN0ZW5lciBzbyB3ZSBjYW4gdGVsbCBpZiBpdCdzIHJlbW92ZWQuDQogICAgICAgIGNvbnN0IGxpc3RlbklkID0gUmVhZG9ubHlSZXN0Q2xpZW50LmdldExpc3RlbklkXyhxdWVyeSwgdGFnKTsNCiAgICAgICAgY29uc3QgdGhpc0xpc3RlbiA9IHt9Ow0KICAgICAgICB0aGlzLmxpc3RlbnNfW2xpc3RlbklkXSA9IHRoaXNMaXN0ZW47DQogICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nUGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1zVG9SZXN0UXVlcnlTdHJpbmdQYXJhbWV0ZXJzKHF1ZXJ5Ll9xdWVyeVBhcmFtcyk7DQogICAgICAgIHRoaXMucmVzdFJlcXVlc3RfKHBhdGhTdHJpbmcgKyAnLmpzb24nLCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMsIChlcnJvciwgcmVzdWx0KSA9PiB7DQogICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdDsNCiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gNDA0KSB7DQogICAgICAgICAgICAgICAgZGF0YSA9IG51bGw7DQogICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGVycm9yID09PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFVcGRhdGVfKHBhdGhTdHJpbmcsIGRhdGEsIC8qaXNNZXJnZT0qLyBmYWxzZSwgdGFnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzYWZlR2V0KHRoaXMubGlzdGVuc18sIGxpc3RlbklkKSA9PT0gdGhpc0xpc3Rlbikgew0KICAgICAgICAgICAgICAgIGxldCBzdGF0dXM7DQogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAnb2snOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnJvciA9PT0gNDAxKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICdwZXJtaXNzaW9uX2RlbmllZCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAncmVzdF9lcnJvcjonICsgZXJyb3I7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoc3RhdHVzLCBudWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVubGlzdGVuKHF1ZXJ5LCB0YWcpIHsNCiAgICAgICAgY29uc3QgbGlzdGVuSWQgPSBSZWFkb25seVJlc3RDbGllbnQuZ2V0TGlzdGVuSWRfKHF1ZXJ5LCB0YWcpOw0KICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5zX1tsaXN0ZW5JZF07DQogICAgfQ0KICAgIGdldChxdWVyeSkgew0KICAgICAgICBjb25zdCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMgPSBxdWVyeVBhcmFtc1RvUmVzdFF1ZXJ5U3RyaW5nUGFyYW1ldGVycyhxdWVyeS5fcXVlcnlQYXJhbXMpOw0KICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTsNCiAgICAgICAgdGhpcy5yZXN0UmVxdWVzdF8ocGF0aFN0cmluZyArICcuanNvbicsIHF1ZXJ5U3RyaW5nUGFyYW1ldGVycywgKGVycm9yLCByZXN1bHQpID0+IHsNCiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzdWx0Ow0KICAgICAgICAgICAgaWYgKGVycm9yID09PSA0MDQpIHsNCiAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDsNCiAgICAgICAgICAgICAgICBlcnJvciA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZXJyb3IgPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8ocGF0aFN0cmluZywgZGF0YSwgDQogICAgICAgICAgICAgICAgLyppc01lcmdlPSovIGZhbHNlLCANCiAgICAgICAgICAgICAgICAvKnRhZz0qLyBudWxsKTsNCiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KG5ldyBFcnJvcihkYXRhKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgcmVmcmVzaEF1dGhUb2tlbih0b2tlbikgew0KICAgICAgICAvLyBuby1vcCBzaW5jZSB3ZSBqdXN0IGFsd2F5cyBjYWxsIGdldFRva2VuLg0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQZXJmb3JtcyBhIFJFU1QgcmVxdWVzdCB0byB0aGUgZ2l2ZW4gcGF0aCwgd2l0aCB0aGUgcHJvdmlkZWQgcXVlcnkgc3RyaW5nIHBhcmFtZXRlcnMsDQogICAgICogYW5kIGFueSBhdXRoIGNyZWRlbnRpYWxzIHdlIGhhdmUuDQogICAgICovDQogICAgcmVzdFJlcXVlc3RfKHBhdGhTdHJpbmcsIHF1ZXJ5U3RyaW5nUGFyYW1ldGVycyA9IHt9LCBjYWxsYmFjaykgew0KICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnNbJ2Zvcm1hdCddID0gJ2V4cG9ydCc7DQogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbDQogICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5nZXRUb2tlbigvKmZvcmNlUmVmcmVzaD0qLyBmYWxzZSksDQogICAgICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oLypmb3JjZVJlZnJlc2g9Ki8gZmFsc2UpDQogICAgICAgIF0pLnRoZW4oKFthdXRoVG9rZW4sIGFwcENoZWNrVG9rZW5dKSA9PiB7DQogICAgICAgICAgICBpZiAoYXV0aFRva2VuICYmIGF1dGhUb2tlbi5hY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1snYXV0aCddID0gYXV0aFRva2VuLmFjY2Vzc1Rva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFwcENoZWNrVG9rZW4gJiYgYXBwQ2hlY2tUb2tlbi50b2tlbikgew0KICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1snYWMnXSA9IGFwcENoZWNrVG9rZW4udG9rZW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB1cmwgPSAodGhpcy5yZXBvSW5mb18uc2VjdXJlID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykgKw0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLmhvc3QgKw0KICAgICAgICAgICAgICAgIHBhdGhTdHJpbmcgKw0KICAgICAgICAgICAgICAgICc/JyArDQogICAgICAgICAgICAgICAgJ25zPScgKw0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLm5hbWVzcGFjZSArDQogICAgICAgICAgICAgICAgcXVlcnlzdHJpbmckMShxdWVyeVN0cmluZ1BhcmFtZXRlcnMpOw0KICAgICAgICAgICAgdGhpcy5sb2dfKCdTZW5kaW5nIFJFU1QgcmVxdWVzdCBmb3IgJyArIHVybCk7DQogICAgICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIHhoci5yZWFkeVN0YXRlID09PSA0KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nXygnUkVTVCBSZXNwb25zZSBmb3IgJyArIHVybCArICcgcmVjZWl2ZWQuIHN0YXR1czonLCB4aHIuc3RhdHVzLCAncmVzcG9uc2U6JywgeGhyLnJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXMgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBqc29uRXZhbCh4aHIucmVzcG9uc2VUZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybignRmFpbGVkIHRvIHBhcnNlIEpTT04gcmVzcG9uc2UgZm9yICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnOiAnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gNDAxIGFuZCA0MDQgYXJlIGV4cGVjdGVkLg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgIT09IDQwMSAmJiB4aHIuc3RhdHVzICE9PSA0MDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCdHb3QgdW5zdWNjZXNzZnVsIFJFU1QgcmVzcG9uc2UgZm9yICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIFN0YXR1czogJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zdGF0dXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGhyLnN0YXR1cyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCAvKmFzeW5jaHJvbm91cz0qLyB0cnVlKTsNCiAgICAgICAgICAgIHhoci5zZW5kKCk7DQogICAgICAgIH0pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTXV0YWJsZSBvYmplY3Qgd2hpY2ggYmFzaWNhbGx5IGp1c3Qgc3RvcmVzIGEgcmVmZXJlbmNlIHRvIHRoZSAibGF0ZXN0IiBpbW11dGFibGUgc25hcHNob3QuDQogKi8NCmNsYXNzIFNuYXBzaG90SG9sZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy5yb290Tm9kZV8gPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgZ2V0Tm9kZShwYXRoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3ROb2RlXy5nZXRDaGlsZChwYXRoKTsNCiAgICB9DQogICAgdXBkYXRlU25hcHNob3QocGF0aCwgbmV3U25hcHNob3ROb2RlKSB7DQogICAgICAgIHRoaXMucm9vdE5vZGVfID0gdGhpcy5yb290Tm9kZV8udXBkYXRlQ2hpbGQocGF0aCwgbmV3U25hcHNob3ROb2RlKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgdmFsdWU6IG51bGwsDQogICAgICAgIGNoaWxkcmVuOiBuZXcgTWFwKCkNCiAgICB9Ow0KfQ0KLyoqDQogKiBTdG9yZXMgdGhlIGdpdmVuIG5vZGUgYXQgdGhlIHNwZWNpZmllZCBwYXRoLiBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgbm9kZQ0KICogYXQgYSBzaGFsbG93ZXIgcGF0aCwgaXQgbWVyZ2VzIHRoZSBuZXcgZGF0YSBpbnRvIHRoYXQgc25hcHNob3Qgbm9kZS4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFBhdGggdG8gbG9vayB1cCBzbmFwc2hvdCBmb3IuDQogKiBAcGFyYW0gZGF0YSAtIFRoZSBuZXcgZGF0YSwgb3IgbnVsbC4NCiAqLw0KZnVuY3Rpb24gc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIoc3BhcnNlU25hcHNob3RUcmVlLCBwYXRoLCBkYXRhKSB7DQogICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSA9IGRhdGE7DQogICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5jbGVhcigpOw0KICAgIH0NCiAgICBlbHNlIGlmIChzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUgIT09IG51bGwpIHsNCiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlID0gc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlLnVwZGF0ZUNoaWxkKHBhdGgsIGRhdGEpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgIGlmICghc3BhcnNlU25hcHNob3RUcmVlLmNoaWxkcmVuLmhhcyhjaGlsZEtleSkpIHsNCiAgICAgICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5zZXQoY2hpbGRLZXksIG5ld1NwYXJzZVNuYXBzaG90VHJlZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5nZXQoY2hpbGRLZXkpOw0KICAgICAgICBwYXRoID0gcGF0aFBvcEZyb250KHBhdGgpOw0KICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihjaGlsZCwgcGF0aCwgZGF0YSk7DQogICAgfQ0KfQ0KLyoqDQogKiBSZWN1cnNpdmVseSBpdGVyYXRlcyB0aHJvdWdoIGFsbCBvZiB0aGUgc3RvcmVkIHRyZWUgYW5kIGNhbGxzIHRoZQ0KICogY2FsbGJhY2sgb24gZWFjaCBvbmUuDQogKg0KICogQHBhcmFtIHByZWZpeFBhdGggLSBQYXRoIHRvIGxvb2sgdXAgbm9kZSBmb3IuDQogKiBAcGFyYW0gZnVuYyAtIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggdHJlZS4NCiAqLw0KZnVuY3Rpb24gc3BhcnNlU25hcHNob3RUcmVlRm9yRWFjaFRyZWUoc3BhcnNlU25hcHNob3RUcmVlLCBwcmVmaXhQYXRoLCBmdW5jKSB7DQogICAgaWYgKHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSAhPT0gbnVsbCkgew0KICAgICAgICBmdW5jKHByZWZpeFBhdGgsIHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoQ2hpbGQoc3BhcnNlU25hcHNob3RUcmVlLCAoa2V5LCB0cmVlKSA9PiB7DQogICAgICAgICAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgocHJlZml4UGF0aC50b1N0cmluZygpICsgJy8nICsga2V5KTsNCiAgICAgICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHRyZWUsIHBhdGgsIGZ1bmMpOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEl0ZXJhdGVzIHRocm91Z2ggZWFjaCBpbW1lZGlhdGUgY2hpbGQgYW5kIHRyaWdnZXJzIHRoZSBjYWxsYmFjay4NCiAqIE9ubHkgc2VlbXMgdG8gYmUgdXNlZCBpbiB0ZXN0cy4NCiAqDQogKiBAcGFyYW0gZnVuYyAtIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggY2hpbGQuDQogKi8NCmZ1bmN0aW9uIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hDaGlsZChzcGFyc2VTbmFwc2hvdFRyZWUsIGZ1bmMpIHsNCiAgICBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uZm9yRWFjaCgodHJlZSwga2V5KSA9PiB7DQogICAgICAgIGZ1bmMoa2V5LCB0cmVlKTsNCiAgICB9KTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUmV0dXJucyB0aGUgZGVsdGEgZnJvbSB0aGUgcHJldmlvdXMgY2FsbCB0byBnZXQgc3RhdHMuDQogKg0KICogQHBhcmFtIGNvbGxlY3Rpb25fIC0gVGhlIGNvbGxlY3Rpb24gdG8gImxpc3RlbiIgdG8uDQogKi8NCmNsYXNzIFN0YXRzTGlzdGVuZXIgew0KICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb25fKSB7DQogICAgICAgIHRoaXMuY29sbGVjdGlvbl8gPSBjb2xsZWN0aW9uXzsNCiAgICAgICAgdGhpcy5sYXN0XyA9IG51bGw7DQogICAgfQ0KICAgIGdldCgpIHsNCiAgICAgICAgY29uc3QgbmV3U3RhdHMgPSB0aGlzLmNvbGxlY3Rpb25fLmdldCgpOw0KICAgICAgICBjb25zdCBkZWx0YSA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1N0YXRzKTsNCiAgICAgICAgaWYgKHRoaXMubGFzdF8pIHsNCiAgICAgICAgICAgIGVhY2godGhpcy5sYXN0XywgKHN0YXQsIHZhbHVlKSA9PiB7DQogICAgICAgICAgICAgICAgZGVsdGFbc3RhdF0gPSBkZWx0YVtzdGF0XSAtIHZhbHVlOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5sYXN0XyA9IG5ld1N0YXRzOw0KICAgICAgICByZXR1cm4gZGVsdGE7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLy8gQXNzdW1pbmcgc29tZSBhcHBzIG1heSBoYXZlIGEgc2hvcnQgYW1vdW50IG9mIHRpbWUgb24gcGFnZSwgYW5kIGEgYnVsayBvZiBmaXJlYmFzZSBvcGVyYXRpb25zIHByb2JhYmx5DQovLyBoYXBwZW4gb24gcGFnZSBsb2FkLCB3ZSB0cnkgdG8gcmVwb3J0IG91ciBmaXJzdCBzZXQgb2Ygc3RhdHMgcHJldHR5IHF1aWNrbHksIGJ1dCB3ZSB3YWl0IGF0IGxlYXN0IDEwDQovLyBzZWNvbmRzIHRvIHRyeSB0byBlbnN1cmUgdGhlIEZpcmViYXNlIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQgLyBzZXR0bGVkLg0KY29uc3QgRklSU1RfU1RBVFNfTUlOX1RJTUUgPSAxMCAqIDEwMDA7DQpjb25zdCBGSVJTVF9TVEFUU19NQVhfVElNRSA9IDMwICogMTAwMDsNCi8vIFdlJ2xsIGNvbnRpbnVlIHRvIHJlcG9ydCBzdGF0cyBvbiBhdmVyYWdlIGV2ZXJ5IDUgbWludXRlcy4NCmNvbnN0IFJFUE9SVF9TVEFUU19JTlRFUlZBTCA9IDUgKiA2MCAqIDEwMDA7DQpjbGFzcyBTdGF0c1JlcG9ydGVyIHsNCiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBzZXJ2ZXJfKSB7DQogICAgICAgIHRoaXMuc2VydmVyXyA9IHNlcnZlcl87DQogICAgICAgIHRoaXMuc3RhdHNUb1JlcG9ydF8gPSB7fTsNCiAgICAgICAgdGhpcy5zdGF0c0xpc3RlbmVyXyA9IG5ldyBTdGF0c0xpc3RlbmVyKGNvbGxlY3Rpb24pOw0KICAgICAgICBjb25zdCB0aW1lb3V0ID0gRklSU1RfU1RBVFNfTUlOX1RJTUUgKw0KICAgICAgICAgICAgKEZJUlNUX1NUQVRTX01BWF9USU1FIC0gRklSU1RfU1RBVFNfTUlOX1RJTUUpICogTWF0aC5yYW5kb20oKTsNCiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IodGltZW91dCkpOw0KICAgIH0NCiAgICByZXBvcnRTdGF0c18oKSB7DQogICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zdGF0c0xpc3RlbmVyXy5nZXQoKTsNCiAgICAgICAgY29uc3QgcmVwb3J0ZWRTdGF0cyA9IHt9Ow0KICAgICAgICBsZXQgaGF2ZVN0YXRzVG9SZXBvcnQgPSBmYWxzZTsNCiAgICAgICAgZWFjaChzdGF0cywgKHN0YXQsIHZhbHVlKSA9PiB7DQogICAgICAgICAgICBpZiAodmFsdWUgPiAwICYmIGNvbnRhaW5zKHRoaXMuc3RhdHNUb1JlcG9ydF8sIHN0YXQpKSB7DQogICAgICAgICAgICAgICAgcmVwb3J0ZWRTdGF0c1tzdGF0XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIGhhdmVTdGF0c1RvUmVwb3J0ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIGlmIChoYXZlU3RhdHNUb1JlcG9ydCkgew0KICAgICAgICAgICAgdGhpcy5zZXJ2ZXJfLnJlcG9ydFN0YXRzKHJlcG9ydGVkU3RhdHMpOw0KICAgICAgICB9DQogICAgICAgIC8vIHF1ZXVlIG91ciBuZXh0IHJ1bi4NCiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIgKiBSRVBPUlRfU1RBVFNfSU5URVJWQUwpKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqDQogKiBAZW51bQ0KICovDQp2YXIgT3BlcmF0aW9uVHlwZTsNCihmdW5jdGlvbiAoT3BlcmF0aW9uVHlwZSkgew0KICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVsiT1ZFUldSSVRFIl0gPSAwXSA9ICJPVkVSV1JJVEUiOw0KICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVsiTUVSR0UiXSA9IDFdID0gIk1FUkdFIjsNCiAgICBPcGVyYXRpb25UeXBlW09wZXJhdGlvblR5cGVbIkFDS19VU0VSX1dSSVRFIl0gPSAyXSA9ICJBQ0tfVVNFUl9XUklURSI7DQogICAgT3BlcmF0aW9uVHlwZVtPcGVyYXRpb25UeXBlWyJMSVNURU5fQ09NUExFVEUiXSA9IDNdID0gIkxJU1RFTl9DT01QTEVURSI7DQp9KShPcGVyYXRpb25UeXBlIHx8IChPcGVyYXRpb25UeXBlID0ge30pKTsNCmZ1bmN0aW9uIG5ld09wZXJhdGlvblNvdXJjZVVzZXIoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgZnJvbVVzZXI6IHRydWUsDQogICAgICAgIGZyb21TZXJ2ZXI6IGZhbHNlLA0KICAgICAgICBxdWVyeUlkOiBudWxsLA0KICAgICAgICB0YWdnZWQ6IGZhbHNlDQogICAgfTsNCn0NCmZ1bmN0aW9uIG5ld09wZXJhdGlvblNvdXJjZVNlcnZlcigpIHsNCiAgICByZXR1cm4gew0KICAgICAgICBmcm9tVXNlcjogZmFsc2UsDQogICAgICAgIGZyb21TZXJ2ZXI6IHRydWUsDQogICAgICAgIHF1ZXJ5SWQ6IG51bGwsDQogICAgICAgIHRhZ2dlZDogZmFsc2UNCiAgICB9Ow0KfQ0KZnVuY3Rpb24gbmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCkgew0KICAgIHJldHVybiB7DQogICAgICAgIGZyb21Vc2VyOiBmYWxzZSwNCiAgICAgICAgZnJvbVNlcnZlcjogdHJ1ZSwNCiAgICAgICAgcXVlcnlJZCwNCiAgICAgICAgdGFnZ2VkOiB0cnVlDQogICAgfTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIEFja1VzZXJXcml0ZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGFmZmVjdGVkVHJlZSAtIEEgdHJlZSBjb250YWluaW5nIHRydWUgZm9yIGVhY2ggYWZmZWN0ZWQgcGF0aC4gQWZmZWN0ZWQgcGF0aHMgY2FuJ3Qgb3ZlcmxhcC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcigNCiAgICAvKiogQGluaGVyaXREb2MgKi8gcGF0aCwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIGFmZmVjdGVkVHJlZSwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIHJldmVydCkgew0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgICAgICB0aGlzLmFmZmVjdGVkVHJlZSA9IGFmZmVjdGVkVHJlZTsNCiAgICAgICAgdGhpcy5yZXZlcnQgPSByZXZlcnQ7DQogICAgICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgICAgICB0aGlzLnR5cGUgPSBPcGVyYXRpb25UeXBlLkFDS19VU0VSX1dSSVRFOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy5zb3VyY2UgPSBuZXdPcGVyYXRpb25Tb3VyY2VVc2VyKCk7DQogICAgfQ0KICAgIG9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBpZiAoIXBhdGhJc0VtcHR5KHRoaXMucGF0aCkpIHsNCiAgICAgICAgICAgIGFzc2VydChwYXRoR2V0RnJvbnQodGhpcy5wYXRoKSA9PT0gY2hpbGROYW1lLCAnb3BlcmF0aW9uRm9yQ2hpbGQgY2FsbGVkIGZvciB1bnJlbGF0ZWQgY2hpbGQuJyk7DQogICAgICAgICAgICByZXR1cm4gbmV3IEFja1VzZXJXcml0ZShwYXRoUG9wRnJvbnQodGhpcy5wYXRoKSwgdGhpcy5hZmZlY3RlZFRyZWUsIHRoaXMucmV2ZXJ0KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0aGlzLmFmZmVjdGVkVHJlZS52YWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICBhc3NlcnQodGhpcy5hZmZlY3RlZFRyZWUuY2hpbGRyZW4uaXNFbXB0eSgpLCAnYWZmZWN0ZWRUcmVlIHNob3VsZCBub3QgaGF2ZSBvdmVybGFwcGluZyBhZmZlY3RlZCBwYXRocy4nKTsNCiAgICAgICAgICAgIC8vIEFsbCBjaGlsZCBsb2NhdGlvbnMgYXJlIGFmZmVjdGVkIGFzIHdlbGw7IGp1c3QgcmV0dXJuIHNhbWUgb3BlcmF0aW9uLg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSB0aGlzLmFmZmVjdGVkVHJlZS5zdWJ0cmVlKG5ldyBQYXRoKGNoaWxkTmFtZSkpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBBY2tVc2VyV3JpdGUobmV3RW1wdHlQYXRoKCksIGNoaWxkVHJlZSwgdGhpcy5yZXZlcnQpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgTGlzdGVuQ29tcGxldGUgew0KICAgIGNvbnN0cnVjdG9yKHNvdXJjZSwgcGF0aCkgew0KICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsNCiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDsNCiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgICAgIHRoaXMudHlwZSA9IE9wZXJhdGlvblR5cGUuTElTVEVOX0NPTVBMRVRFOw0KICAgIH0NCiAgICBvcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHRoaXMucGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdGVuQ29tcGxldGUodGhpcy5zb3VyY2UsIG5ld0VtcHR5UGF0aCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdGVuQ29tcGxldGUodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIE92ZXJ3cml0ZSB7DQogICAgY29uc3RydWN0b3Ioc291cmNlLCBwYXRoLCBzbmFwKSB7DQogICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOw0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgICAgICB0aGlzLnNuYXAgPSBzbmFwOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy50eXBlID0gT3BlcmF0aW9uVHlwZS5PVkVSV1JJVEU7DQogICAgfQ0KICAgIG9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkodGhpcy5wYXRoKSkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBPdmVyd3JpdGUodGhpcy5zb3VyY2UsIG5ld0VtcHR5UGF0aCgpLCB0aGlzLnNuYXAuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE92ZXJ3cml0ZSh0aGlzLnNvdXJjZSwgcGF0aFBvcEZyb250KHRoaXMucGF0aCksIHRoaXMuc25hcCk7DQogICAgICAgIH0NCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBNZXJnZSB7DQogICAgY29uc3RydWN0b3IoDQogICAgLyoqIEBpbmhlcml0RG9jICovIHNvdXJjZSwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIHBhdGgsIA0KICAgIC8qKiBAaW5oZXJpdERvYyAqLyBjaGlsZHJlbikgew0KICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsNCiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDsNCiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy50eXBlID0gT3BlcmF0aW9uVHlwZS5NRVJHRTsNCiAgICB9DQogICAgb3BlcmF0aW9uRm9yQ2hpbGQoY2hpbGROYW1lKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eSh0aGlzLnBhdGgpKSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSB0aGlzLmNoaWxkcmVuLnN1YnRyZWUobmV3IFBhdGgoY2hpbGROYW1lKSk7DQogICAgICAgICAgICBpZiAoY2hpbGRUcmVlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgY2hpbGQgaXMgdW5hZmZlY3RlZA0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGRUcmVlLnZhbHVlKSB7DQogICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIHNuYXBzaG90IGZvciB0aGUgY2hpbGQgaW4gcXVlc3Rpb24uICBUaGlzIGJlY29tZXMgYW4gb3ZlcndyaXRlIG9mIHRoZSBjaGlsZC4NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE92ZXJ3cml0ZSh0aGlzLnNvdXJjZSwgbmV3RW1wdHlQYXRoKCksIGNoaWxkVHJlZS52YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbWVyZ2UgYXQgYSBkZWVwZXIgbGV2ZWwNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1lcmdlKHRoaXMuc291cmNlLCBuZXdFbXB0eVBhdGgoKSwgY2hpbGRUcmVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGFzc2VydChwYXRoR2V0RnJvbnQodGhpcy5wYXRoKSA9PT0gY2hpbGROYW1lLCAiQ2FuJ3QgZ2V0IGEgbWVyZ2UgZm9yIGEgY2hpbGQgbm90IG9uIHRoZSBwYXRoIG9mIHRoZSBvcGVyYXRpb24iKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2UodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpLCB0aGlzLmNoaWxkcmVuKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICgnT3BlcmF0aW9uKCcgKw0KICAgICAgICAgICAgdGhpcy5wYXRoICsNCiAgICAgICAgICAgICc6ICcgKw0KICAgICAgICAgICAgdGhpcy5zb3VyY2UudG9TdHJpbmcoKSArDQogICAgICAgICAgICAnIG1lcmdlOiAnICsNCiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4udG9TdHJpbmcoKSArDQogICAgICAgICAgICAnKScpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBjYWNoZSBub2RlIG9ubHkgc3RvcmVzIGNvbXBsZXRlIGNoaWxkcmVuLiBBZGRpdGlvbmFsbHkgaXQgaG9sZHMgYSBmbGFnIHdoZXRoZXIgdGhlIG5vZGUgY2FuIGJlIGNvbnNpZGVyZWQgZnVsbHkNCiAqIGluaXRpYWxpemVkIGluIHRoZSBzZW5zZSB0aGF0IHdlIGtub3cgYXQgb25lIHBvaW50IGluIHRpbWUgdGhpcyByZXByZXNlbnRlZCBhIHZhbGlkIHN0YXRlIG9mIHRoZSB3b3JsZCwgZS5nLg0KICogaW5pdGlhbGl6ZWQgd2l0aCBkYXRhIGZyb20gdGhlIHNlcnZlciwgb3IgYSBjb21wbGV0ZSBvdmVyd3JpdGUgYnkgdGhlIGNsaWVudC4gVGhlIGZpbHRlcmVkIGZsYWcgYWxzbyB0cmFja3MNCiAqIHdoZXRoZXIgYSBub2RlIHBvdGVudGlhbGx5IGhhZCBjaGlsZHJlbiByZW1vdmVkIGR1ZSB0byBhIGZpbHRlci4NCiAqLw0KY2xhc3MgQ2FjaGVOb2RlIHsNCiAgICBjb25zdHJ1Y3Rvcihub2RlXywgZnVsbHlJbml0aWFsaXplZF8sIGZpbHRlcmVkXykgew0KICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87DQogICAgICAgIHRoaXMuZnVsbHlJbml0aWFsaXplZF8gPSBmdWxseUluaXRpYWxpemVkXzsNCiAgICAgICAgdGhpcy5maWx0ZXJlZF8gPSBmaWx0ZXJlZF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIG5vZGUgd2FzIGZ1bGx5IGluaXRpYWxpemVkIHdpdGggZWl0aGVyIHNlcnZlciBkYXRhIG9yIGEgY29tcGxldGUgb3ZlcndyaXRlIGJ5IHRoZSBjbGllbnQNCiAgICAgKi8NCiAgICBpc0Z1bGx5SW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZ1bGx5SW5pdGlhbGl6ZWRfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBub2RlIGlzIHBvdGVudGlhbGx5IG1pc3NpbmcgY2hpbGRyZW4gZHVlIHRvIGEgZmlsdGVyIGFwcGxpZWQgdG8gdGhlIG5vZGUNCiAgICAgKi8NCiAgICBpc0ZpbHRlcmVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJlZF87DQogICAgfQ0KICAgIGlzQ29tcGxldGVGb3JQYXRoKHBhdGgpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF87DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgIHJldHVybiB0aGlzLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSk7DQogICAgfQ0KICAgIGlzQ29tcGxldGVGb3JDaGlsZChrZXkpIHsNCiAgICAgICAgcmV0dXJuICgodGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF8pIHx8IHRoaXMubm9kZV8uaGFzQ2hpbGQoa2V5KSk7DQogICAgfQ0KICAgIGdldE5vZGUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm5vZGVfOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gRXZlbnRHZW5lcmF0b3IgaXMgdXNlZCB0byBjb252ZXJ0ICJyYXciIGNoYW5nZXMgKENoYW5nZSkgYXMgY29tcHV0ZWQgYnkgdGhlDQogKiBDYWNoZURpZmZlciBpbnRvIGFjdHVhbCBldmVudHMgKEV2ZW50KSB0aGF0IGNhbiBiZSByYWlzZWQuICBTZWUgZ2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzKCkNCiAqIGZvciBkZXRhaWxzLg0KICoNCiAqLw0KY2xhc3MgRXZlbnRHZW5lcmF0b3Igew0KICAgIGNvbnN0cnVjdG9yKHF1ZXJ5Xykgew0KICAgICAgICB0aGlzLnF1ZXJ5XyA9IHF1ZXJ5XzsNCiAgICAgICAgdGhpcy5pbmRleF8gPSB0aGlzLnF1ZXJ5Xy5fcXVlcnlQYXJhbXMuZ2V0SW5kZXgoKTsNCiAgICB9DQp9DQovKioNCiAqIEdpdmVuIGEgc2V0IG9mIHJhdyBjaGFuZ2VzIChubyBtb3ZlZCBldmVudHMgYW5kIHByZXZOYW1lIG5vdCBzcGVjaWZpZWQgeWV0KSwgYW5kIGEgc2V0IG9mDQogKiBFdmVudFJlZ2lzdHJhdGlvbnMgdGhhdCBzaG91bGQgYmUgbm90aWZpZWQgb2YgdGhlc2UgY2hhbmdlcywgZ2VuZXJhdGUgdGhlIGFjdHVhbCBldmVudHMgdG8gYmUgcmFpc2VkLg0KICoNCiAqIE5vdGVzOg0KICogIC0gY2hpbGRfbW92ZWQgZXZlbnRzIHdpbGwgYmUgc3ludGhlc2l6ZWQgYXQgdGhpcyB0aW1lIGZvciBhbnkgY2hpbGRfY2hhbmdlZCBldmVudHMgdGhhdCBhZmZlY3QNCiAqICAgIG91ciBpbmRleC4NCiAqICAtIHByZXZOYW1lIHdpbGwgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgaW5kZXggb3JkZXJpbmcuDQogKi8NCmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2VzLCBldmVudENhY2hlLCBldmVudFJlZ2lzdHJhdGlvbnMpIHsNCiAgICBjb25zdCBldmVudHMgPSBbXTsNCiAgICBjb25zdCBtb3ZlcyA9IFtdOw0KICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4gew0KICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICJjaGlsZF9jaGFuZ2VkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8gJiYNCiAgICAgICAgICAgIGV2ZW50R2VuZXJhdG9yLmluZGV4Xy5pbmRleGVkVmFsdWVDaGFuZ2VkKGNoYW5nZS5vbGRTbmFwLCBjaGFuZ2Uuc25hcHNob3ROb2RlKSkgew0KICAgICAgICAgICAgbW92ZXMucHVzaChjaGFuZ2VDaGlsZE1vdmVkKGNoYW5nZS5jaGlsZE5hbWUsIGNoYW5nZS5zbmFwc2hvdE5vZGUpKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsICJjaGlsZF9yZW1vdmVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovLCBjaGFuZ2VzLCBldmVudFJlZ2lzdHJhdGlvbnMsIGV2ZW50Q2FjaGUpOw0KICAgIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsICJjaGlsZF9tb3ZlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9NT1ZFRCAqLywgbW92ZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLywgY2hhbmdlcywgZXZlbnRSZWdpc3RyYXRpb25zLCBldmVudENhY2hlKTsNCiAgICBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCAidmFsdWUiIC8qIENoYW5nZVR5cGUuVkFMVUUgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgcmV0dXJuIGV2ZW50czsNCn0NCi8qKg0KICogR2l2ZW4gY2hhbmdlcyBvZiBhIHNpbmdsZSBjaGFuZ2UgdHlwZSwgZ2VuZXJhdGUgdGhlIGNvcnJlc3BvbmRpbmcgZXZlbnRzLg0KICovDQpmdW5jdGlvbiBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCBldmVudFR5cGUsIGNoYW5nZXMsIHJlZ2lzdHJhdGlvbnMsIGV2ZW50Q2FjaGUpIHsNCiAgICBjb25zdCBmaWx0ZXJlZENoYW5nZXMgPSBjaGFuZ2VzLmZpbHRlcihjaGFuZ2UgPT4gY2hhbmdlLnR5cGUgPT09IGV2ZW50VHlwZSk7DQogICAgZmlsdGVyZWRDaGFuZ2VzLnNvcnQoKGEsIGIpID0+IGV2ZW50R2VuZXJhdG9yQ29tcGFyZUNoYW5nZXMoZXZlbnRHZW5lcmF0b3IsIGEsIGIpKTsNCiAgICBmaWx0ZXJlZENoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4gew0KICAgICAgICBjb25zdCBtYXRlcmlhbGl6ZWRDaGFuZ2UgPSBldmVudEdlbmVyYXRvck1hdGVyaWFsaXplU2luZ2xlQ2hhbmdlKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2UsIGV2ZW50Q2FjaGUpOw0KICAgICAgICByZWdpc3RyYXRpb25zLmZvckVhY2gocmVnaXN0cmF0aW9uID0+IHsNCiAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24ucmVzcG9uZHNUbyhjaGFuZ2UudHlwZSkpIHsNCiAgICAgICAgICAgICAgICBldmVudHMucHVzaChyZWdpc3RyYXRpb24uY3JlYXRlRXZlbnQobWF0ZXJpYWxpemVkQ2hhbmdlLCBldmVudEdlbmVyYXRvci5xdWVyeV8pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQpmdW5jdGlvbiBldmVudEdlbmVyYXRvck1hdGVyaWFsaXplU2luZ2xlQ2hhbmdlKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2UsIGV2ZW50Q2FjaGUpIHsNCiAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICd2YWx1ZScgfHwgY2hhbmdlLnR5cGUgPT09ICdjaGlsZF9yZW1vdmVkJykgew0KICAgICAgICByZXR1cm4gY2hhbmdlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY2hhbmdlLnByZXZOYW1lID0gZXZlbnRDYWNoZS5nZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGFuZ2UuY2hpbGROYW1lLCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBldmVudEdlbmVyYXRvci5pbmRleF8pOw0KICAgICAgICByZXR1cm4gY2hhbmdlOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yQ29tcGFyZUNoYW5nZXMoZXZlbnRHZW5lcmF0b3IsIGEsIGIpIHsNCiAgICBpZiAoYS5jaGlsZE5hbWUgPT0gbnVsbCB8fCBiLmNoaWxkTmFtZSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdTaG91bGQgb25seSBjb21wYXJlIGNoaWxkXyBldmVudHMuJyk7DQogICAgfQ0KICAgIGNvbnN0IGFXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShhLmNoaWxkTmFtZSwgYS5zbmFwc2hvdE5vZGUpOw0KICAgIGNvbnN0IGJXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShiLmNoaWxkTmFtZSwgYi5zbmFwc2hvdE5vZGUpOw0KICAgIHJldHVybiBldmVudEdlbmVyYXRvci5pbmRleF8uY29tcGFyZShhV3JhcHBlZCwgYldyYXBwZWQpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gbmV3Vmlld0NhY2hlKGV2ZW50Q2FjaGUsIHNlcnZlckNhY2hlKSB7DQogICAgcmV0dXJuIHsgZXZlbnRDYWNoZSwgc2VydmVyQ2FjaGUgfTsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIGV2ZW50U25hcCwgY29tcGxldGUsIGZpbHRlcmVkKSB7DQogICAgcmV0dXJuIG5ld1ZpZXdDYWNoZShuZXcgQ2FjaGVOb2RlKGV2ZW50U25hcCwgY29tcGxldGUsIGZpbHRlcmVkKSwgdmlld0NhY2hlLnNlcnZlckNhY2hlKTsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZVVwZGF0ZVNlcnZlclNuYXAodmlld0NhY2hlLCBzZXJ2ZXJTbmFwLCBjb21wbGV0ZSwgZmlsdGVyZWQpIHsNCiAgICByZXR1cm4gbmV3Vmlld0NhY2hlKHZpZXdDYWNoZS5ldmVudENhY2hlLCBuZXcgQ2FjaGVOb2RlKHNlcnZlclNuYXAsIGNvbXBsZXRlLCBmaWx0ZXJlZCkpOw0KfQ0KZnVuY3Rpb24gdmlld0NhY2hlR2V0Q29tcGxldGVFdmVudFNuYXAodmlld0NhY2hlKSB7DQogICAgcmV0dXJuIHZpZXdDYWNoZS5ldmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpDQogICAgICAgID8gdmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpDQogICAgICAgIDogbnVsbDsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpIHsNCiAgICByZXR1cm4gdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpDQogICAgICAgID8gdmlld0NhY2hlLnNlcnZlckNhY2hlLmdldE5vZGUoKQ0KICAgICAgICA6IG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgZW1wdHlDaGlsZHJlblNpbmdsZXRvbjsNCi8qKg0KICogU2luZ2xldG9uIGVtcHR5IGNoaWxkcmVuIGNvbGxlY3Rpb24uDQogKg0KICovDQpjb25zdCBFbXB0eUNoaWxkcmVuID0gKCkgPT4gew0KICAgIGlmICghZW1wdHlDaGlsZHJlblNpbmdsZXRvbikgew0KICAgICAgICBlbXB0eUNoaWxkcmVuU2luZ2xldG9uID0gbmV3IFNvcnRlZE1hcChzdHJpbmdDb21wYXJlKTsNCiAgICB9DQogICAgcmV0dXJuIGVtcHR5Q2hpbGRyZW5TaW5nbGV0b247DQp9Ow0KLyoqDQogKiBBIHRyZWUgd2l0aCBpbW11dGFibGUgZWxlbWVudHMuDQogKi8NCmNsYXNzIEltbXV0YWJsZVRyZWUgew0KICAgIGNvbnN0cnVjdG9yKHZhbHVlLCBjaGlsZHJlbiA9IEVtcHR5Q2hpbGRyZW4oKSkgew0KICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7DQogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsNCiAgICB9DQogICAgc3RhdGljIGZyb21PYmplY3Qob2JqKSB7DQogICAgICAgIGxldCB0cmVlID0gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgIGVhY2gob2JqLCAoY2hpbGRQYXRoLCBjaGlsZFNuYXApID0+IHsNCiAgICAgICAgICAgIHRyZWUgPSB0cmVlLnNldChuZXcgUGF0aChjaGlsZFBhdGgpLCBjaGlsZFNuYXApOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHRyZWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRydWUgaWYgdGhlIHZhbHVlIGlzIGVtcHR5IGFuZCB0aGVyZSBhcmUgbm8gY2hpbGRyZW4NCiAgICAgKi8NCiAgICBpc0VtcHR5KCkgew0KICAgICAgICByZXR1cm4gdGhpcy52YWx1ZSA9PT0gbnVsbCAmJiB0aGlzLmNoaWxkcmVuLmlzRW1wdHkoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYSBwYXRoIGFuZCBwcmVkaWNhdGUsIHJldHVybiB0aGUgZmlyc3Qgbm9kZSBhbmQgdGhlIHBhdGggdG8gdGhhdCBub2RlDQogICAgICogd2hlcmUgdGhlIHByZWRpY2F0ZSByZXR1cm5zIHRydWUuDQogICAgICoNCiAgICAgKiBUT0RPIERvIGEgcGVyZiB0ZXN0IC0tIElmIHdlJ3JlIGNyZWF0aW5nIGEgYnVuY2ggb2YgYHtwYXRoOiB2YWx1ZTp9YA0KICAgICAqIG9iamVjdHMgb24gdGhlIHdheSBiYWNrIG91dCwgaXQgbWF5IGJlIGJldHRlciB0byBwYXNzIGRvd24gYSBwYXRoU29GYXIgb2JqLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlbGF0aXZlUGF0aCAtIFRoZSByZW1haW5kZXIgb2YgdGhlIHBhdGgNCiAgICAgKiBAcGFyYW0gcHJlZGljYXRlIC0gVGhlIHByZWRpY2F0ZSB0byBzYXRpc2Z5IHRvIHJldHVybiBhIG5vZGUNCiAgICAgKi8NCiAgICBmaW5kUm9vdE1vc3RNYXRjaGluZ1BhdGhBbmRWYWx1ZShyZWxhdGl2ZVBhdGgsIHByZWRpY2F0ZSkgew0KICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsICYmIHByZWRpY2F0ZSh0aGlzLnZhbHVlKSkgew0KICAgICAgICAgICAgcmV0dXJuIHsgcGF0aDogbmV3RW1wdHlQYXRoKCksIHZhbHVlOiB0aGlzLnZhbHVlIH07DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZSA9IGNoaWxkLmZpbmRSb290TW9zdE1hdGNoaW5nUGF0aEFuZFZhbHVlKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpLCBwcmVkaWNhdGUpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IHBhdGhDaGlsZChuZXcgUGF0aChmcm9udCksIGNoaWxkRXhpc3RpbmdQYXRoQW5kVmFsdWUucGF0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXRoOiBmdWxsUGF0aCwgdmFsdWU6IGNoaWxkRXhpc3RpbmdQYXRoQW5kVmFsdWUudmFsdWUgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogRmluZCwgaWYgaXQgZXhpc3RzLCB0aGUgc2hvcnRlc3Qgc3VicGF0aCBvZiB0aGUgZ2l2ZW4gcGF0aCB0aGF0IHBvaW50cyBhIGRlZmluZWQNCiAgICAgKiB2YWx1ZSBpbiB0aGUgdHJlZQ0KICAgICAqLw0KICAgIGZpbmRSb290TW9zdFZhbHVlQW5kUGF0aChyZWxhdGl2ZVBhdGgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFJvb3RNb3N0TWF0Y2hpbmdQYXRoQW5kVmFsdWUocmVsYXRpdmVQYXRoLCAoKSA9PiB0cnVlKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHN1YnRyZWUgYXQgdGhlIGdpdmVuIHBhdGgNCiAgICAgKi8NCiAgICBzdWJ0cmVlKHJlbGF0aXZlUGF0aCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpOw0KICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpOw0KICAgICAgICAgICAgaWYgKGNoaWxkVHJlZSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZFRyZWUuc3VidHJlZShwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogU2V0cyBhIHZhbHVlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIHNldCB2YWx1ZSBhdC4NCiAgICAgKiBAcGFyYW0gdG9TZXQgLSBWYWx1ZSB0byBzZXQuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgc2V0KHJlbGF0aXZlUGF0aCwgdG9TZXQpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZSh0b1NldCwgdGhpcy5jaGlsZHJlbik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpOw0KICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCkgfHwgbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IGNoaWxkLnNldChwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSwgdG9TZXQpOw0KICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmluc2VydChmcm9udCwgbmV3Q2hpbGQpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRoaXMudmFsdWUsIG5ld0NoaWxkcmVuKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZW1vdmVzIHRoZSB2YWx1ZSBhdCB0aGUgc3BlY2lmaWVkIHBhdGguDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIC0gUGF0aCB0byB2YWx1ZSB0byByZW1vdmUuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgcmVtb3ZlKHJlbGF0aXZlUGF0aCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwsIHRoaXMuY2hpbGRyZW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpOw0KICAgICAgICAgICAgaWYgKGNoaWxkKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSBjaGlsZC5yZW1vdmUocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCkpOw0KICAgICAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbjsNCiAgICAgICAgICAgICAgICBpZiAobmV3Q2hpbGQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5yZW1vdmUoZnJvbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmluc2VydChmcm9udCwgbmV3Q2hpbGQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gbnVsbCAmJiBuZXdDaGlsZHJlbi5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRoaXMudmFsdWUsIG5ld0NoaWxkcmVuKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBHZXRzIGEgdmFsdWUgZnJvbSB0aGUgdHJlZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIGdldCB2YWx1ZSBmb3IuDQogICAgICogQHJldHVybnMgVmFsdWUgYXQgcGF0aCwgb3IgbnVsbC4NCiAgICAgKi8NCiAgICBnZXQocmVsYXRpdmVQYXRoKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHJlbGF0aXZlUGF0aCk7DQogICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgIGlmIChjaGlsZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5nZXQocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmVwbGFjZSB0aGUgc3VidHJlZSBhdCB0aGUgc3BlY2lmaWVkIHBhdGggd2l0aCB0aGUgZ2l2ZW4gbmV3IHRyZWUuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIC0gUGF0aCB0byByZXBsYWNlIHN1YnRyZWUgZm9yLg0KICAgICAqIEBwYXJhbSBuZXdUcmVlIC0gTmV3IHRyZWUuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgc2V0VHJlZShyZWxhdGl2ZVBhdGgsIG5ld1RyZWUpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXdUcmVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpIHx8IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSBjaGlsZC5zZXRUcmVlKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpLCBuZXdUcmVlKTsNCiAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbjsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBuZXdDaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW4ucmVtb3ZlKGZyb250KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5pbnNlcnQoZnJvbnQsIG5ld0NoaWxkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZSh0aGlzLnZhbHVlLCBuZXdDaGlsZHJlbik7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUGVyZm9ybXMgYSBkZXB0aCBmaXJzdCBmb2xkIG9uIHRoaXMgdHJlZS4gVHJhbnNmb3JtcyBhIHRyZWUgaW50byBhIHNpbmdsZQ0KICAgICAqIHZhbHVlLCBnaXZlbiBhIGZ1bmN0aW9uIHRoYXQgb3BlcmF0ZXMgb24gdGhlIHBhdGggdG8gYSBub2RlLCBhbiBvcHRpb25hbA0KICAgICAqIGN1cnJlbnQgdmFsdWUsIGFuZCBhIG1hcCBvZiBjaGlsZCBuYW1lcyB0byBmb2xkZWQgc3VidHJlZXMNCiAgICAgKi8NCiAgICBmb2xkKGZuKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZvbGRfKG5ld0VtcHR5UGF0aCgpLCBmbik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgZm9yIHB1YmxpYy1mYWNpbmcgZm9sZCgpIG1ldGhvZA0KICAgICAqLw0KICAgIGZvbGRfKHBhdGhTb0ZhciwgZm4pIHsNCiAgICAgICAgY29uc3QgYWNjdW0gPSB7fTsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZEtleSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgICAgICBhY2N1bVtjaGlsZEtleV0gPSBjaGlsZFRyZWUuZm9sZF8ocGF0aENoaWxkKHBhdGhTb0ZhciwgY2hpbGRLZXkpLCBmbik7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gZm4ocGF0aFNvRmFyLCB0aGlzLnZhbHVlLCBhY2N1bSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEZpbmQgdGhlIGZpcnN0IG1hdGNoaW5nIHZhbHVlIG9uIHRoZSBnaXZlbiBwYXRoLiBSZXR1cm4gdGhlIHJlc3VsdCBvZiBhcHBseWluZyBmIHRvIGl0Lg0KICAgICAqLw0KICAgIGZpbmRPblBhdGgocGF0aCwgZikgew0KICAgICAgICByZXR1cm4gdGhpcy5maW5kT25QYXRoXyhwYXRoLCBuZXdFbXB0eVBhdGgoKSwgZik7DQogICAgfQ0KICAgIGZpbmRPblBhdGhfKHBhdGhUb0ZvbGxvdywgcGF0aFNvRmFyLCBmKSB7DQogICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMudmFsdWUgPyBmKHBhdGhTb0ZhciwgdGhpcy52YWx1ZSkgOiBmYWxzZTsNCiAgICAgICAgaWYgKHJlc3VsdCkgew0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShwYXRoVG9Gb2xsb3cpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoVG9Gb2xsb3cpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgICAgICBpZiAobmV4dENoaWxkKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0Q2hpbGQuZmluZE9uUGF0aF8ocGF0aFBvcEZyb250KHBhdGhUb0ZvbGxvdyksIHBhdGhDaGlsZChwYXRoU29GYXIsIGZyb250KSwgZik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yZWFjaE9uUGF0aChwYXRoLCBmKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZvcmVhY2hPblBhdGhfKHBhdGgsIG5ld0VtcHR5UGF0aCgpLCBmKTsNCiAgICB9DQogICAgZm9yZWFjaE9uUGF0aF8ocGF0aFRvRm9sbG93LCBjdXJyZW50UmVsYXRpdmVQYXRoLCBmKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eShwYXRoVG9Gb2xsb3cpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlKSB7DQogICAgICAgICAgICAgICAgZihjdXJyZW50UmVsYXRpdmVQYXRoLCB0aGlzLnZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGhUb0ZvbGxvdyk7DQogICAgICAgICAgICBjb25zdCBuZXh0Q2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCk7DQogICAgICAgICAgICBpZiAobmV4dENoaWxkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5leHRDaGlsZC5mb3JlYWNoT25QYXRoXyhwYXRoUG9wRnJvbnQocGF0aFRvRm9sbG93KSwgcGF0aENoaWxkKGN1cnJlbnRSZWxhdGl2ZVBhdGgsIGZyb250KSwgZik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQ2FsbHMgdGhlIGdpdmVuIGZ1bmN0aW9uIGZvciBlYWNoIG5vZGUgaW4gdGhlIHRyZWUgdGhhdCBoYXMgYSB2YWx1ZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBmIC0gQSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2l0aCB0aGUgcGF0aCBmcm9tIHRoZSByb290IG9mIHRoZSB0cmVlIHRvDQogICAgICogYSBub2RlLCBhbmQgdGhlIHZhbHVlIGF0IHRoYXQgbm9kZS4gQ2FsbGVkIGluIGRlcHRoLWZpcnN0IG9yZGVyLg0KICAgICAqLw0KICAgIGZvcmVhY2goZikgew0KICAgICAgICB0aGlzLmZvcmVhY2hfKG5ld0VtcHR5UGF0aCgpLCBmKTsNCiAgICB9DQogICAgZm9yZWFjaF8oY3VycmVudFJlbGF0aXZlUGF0aCwgZikgew0KICAgICAgICB0aGlzLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkTmFtZSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgICAgICBjaGlsZFRyZWUuZm9yZWFjaF8ocGF0aENoaWxkKGN1cnJlbnRSZWxhdGl2ZVBhdGgsIGNoaWxkTmFtZSksIGYpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKHRoaXMudmFsdWUpIHsNCiAgICAgICAgICAgIGYoY3VycmVudFJlbGF0aXZlUGF0aCwgdGhpcy52YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yZWFjaENoaWxkKGYpIHsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZE5hbWUsIGNoaWxkVHJlZSkgPT4gew0KICAgICAgICAgICAgaWYgKGNoaWxkVHJlZS52YWx1ZSkgew0KICAgICAgICAgICAgICAgIGYoY2hpbGROYW1lLCBjaGlsZFRyZWUudmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoaXMgY2xhc3MgaG9sZHMgYSBjb2xsZWN0aW9uIG9mIHdyaXRlcyB0aGF0IGNhbiBiZSBhcHBsaWVkIHRvIG5vZGVzIGluIHVuaXNvbi4gSXQgYWJzdHJhY3RzIGF3YXkgdGhlIGxvZ2ljIHdpdGgNCiAqIGRlYWxpbmcgd2l0aCBwcmlvcml0eSB3cml0ZXMgYW5kIG11bHRpcGxlIG5lc3RlZCB3cml0ZXMuIEF0IGFueSBnaXZlbiBwYXRoIHRoZXJlIGlzIG9ubHkgYWxsb3dlZCB0byBiZSBvbmUgd3JpdGUNCiAqIG1vZGlmeWluZyB0aGF0IHBhdGguIEFueSB3cml0ZSB0byBhbiBleGlzdGluZyBwYXRoIG9yIHNoYWRvd2luZyBhbiBleGlzdGluZyBwYXRoIHdpbGwgbW9kaWZ5IHRoYXQgZXhpc3Rpbmcgd3JpdGUNCiAqIHRvIHJlZmxlY3QgdGhlIHdyaXRlIGFkZGVkLg0KICovDQpjbGFzcyBDb21wb3VuZFdyaXRlIHsNCiAgICBjb25zdHJ1Y3Rvcih3cml0ZVRyZWVfKSB7DQogICAgICAgIHRoaXMud3JpdGVUcmVlXyA9IHdyaXRlVHJlZV87DQogICAgfQ0KICAgIHN0YXRpYyBlbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBDb21wb3VuZFdyaXRlKG5ldyBJbW11dGFibGVUcmVlKG51bGwpKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlQWRkV3JpdGUoY29tcG91bmRXcml0ZSwgcGF0aCwgbm9kZSkgew0KICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkgew0KICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUobmV3IEltbXV0YWJsZVRyZWUobm9kZSkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgcm9vdG1vc3QgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uZmluZFJvb3RNb3N0VmFsdWVBbmRQYXRoKHBhdGgpOw0KICAgICAgICBpZiAocm9vdG1vc3QgIT0gbnVsbCkgew0KICAgICAgICAgICAgY29uc3Qgcm9vdE1vc3RQYXRoID0gcm9vdG1vc3QucGF0aDsNCiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJvb3Rtb3N0LnZhbHVlOw0KICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHJvb3RNb3N0UGF0aCwgcGF0aCk7DQogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgbm9kZSk7DQogICAgICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUoY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnNldChyb290TW9zdFBhdGgsIHZhbHVlKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBzdWJ0cmVlID0gbmV3IEltbXV0YWJsZVRyZWUobm9kZSk7DQogICAgICAgICAgICBjb25zdCBuZXdXcml0ZVRyZWUgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uc2V0VHJlZShwYXRoLCBzdWJ0cmVlKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXdXcml0ZVRyZWUpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gY29tcG91bmRXcml0ZUFkZFdyaXRlcyhjb21wb3VuZFdyaXRlLCBwYXRoLCB1cGRhdGVzKSB7DQogICAgbGV0IG5ld1dyaXRlID0gY29tcG91bmRXcml0ZTsNCiAgICBlYWNoKHVwZGF0ZXMsIChjaGlsZEtleSwgbm9kZSkgPT4gew0KICAgICAgICBuZXdXcml0ZSA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZShuZXdXcml0ZSwgcGF0aENoaWxkKHBhdGgsIGNoaWxkS2V5KSwgbm9kZSk7DQogICAgfSk7DQogICAgcmV0dXJuIG5ld1dyaXRlOw0KfQ0KLyoqDQogKiBXaWxsIHJlbW92ZSBhIHdyaXRlIGF0IHRoZSBnaXZlbiBwYXRoIGFuZCBkZWVwZXIgcGF0aHMuIFRoaXMgd2lsbCA8ZW0+bm90PC9lbT4gbW9kaWZ5IGEgd3JpdGUgYXQgYSBoaWdoZXINCiAqIGxvY2F0aW9uLCB3aGljaCBtdXN0IGJlIHJlbW92ZWQgYnkgY2FsbGluZyB0aGlzIG1ldGhvZCB3aXRoIHRoYXQgcGF0aC4NCiAqDQogKiBAcGFyYW0gY29tcG91bmRXcml0ZSAtIFRoZSBDb21wb3VuZFdyaXRlIHRvIHJlbW92ZS4NCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggYXQgd2hpY2ggYSB3cml0ZSBhbmQgYWxsIGRlZXBlciB3cml0ZXMgc2hvdWxkIGJlIHJlbW92ZWQNCiAqIEByZXR1cm5zIFRoZSBuZXcgQ29tcG91bmRXcml0ZSB3aXRoIHRoZSByZW1vdmVkIHBhdGgNCiAqLw0KZnVuY3Rpb24gY29tcG91bmRXcml0ZVJlbW92ZVdyaXRlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICBpZiAocGF0aElzRW1wdHkocGF0aCkpIHsNCiAgICAgICAgcmV0dXJuIENvbXBvdW5kV3JpdGUuZW1wdHkoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG5ld1dyaXRlVHJlZSA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5zZXRUcmVlKHBhdGgsIG5ldyBJbW11dGFibGVUcmVlKG51bGwpKTsNCiAgICAgICAgcmV0dXJuIG5ldyBDb21wb3VuZFdyaXRlKG5ld1dyaXRlVHJlZSk7DQogICAgfQ0KfQ0KLyoqDQogKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBDb21wb3VuZFdyaXRlIHdpbGwgZnVsbHkgb3ZlcndyaXRlIGEgbm9kZSBhdCBhIGdpdmVuIGxvY2F0aW9uIGFuZCBjYW4gdGhlcmVmb3JlIGJlDQogKiBjb25zaWRlcmVkICJjb21wbGV0ZSIuDQogKg0KICogQHBhcmFtIGNvbXBvdW5kV3JpdGUgLSBUaGUgQ29tcG91bmRXcml0ZSB0byBjaGVjay4NCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gY2hlY2sgZm9yDQogKiBAcmV0dXJucyBXaGV0aGVyIHRoZXJlIGlzIGEgY29tcGxldGUgd3JpdGUgYXQgdGhhdCBwYXRoDQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVIYXNDb21wbGV0ZVdyaXRlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZShjb21wb3VuZFdyaXRlLCBwYXRoKSAhPSBudWxsOw0KfQ0KLyoqDQogKiBSZXR1cm5zIGEgbm9kZSBmb3IgYSBwYXRoIGlmIGFuZCBvbmx5IGlmIHRoZSBub2RlIGlzIGEgImNvbXBsZXRlIiBvdmVyd3JpdGUgYXQgdGhhdCBwYXRoLiBUaGlzIHdpbGwgbm90IGFnZ3JlZ2F0ZQ0KICogd3JpdGVzIGZyb20gZGVlcGVyIHBhdGhzLCBidXQgd2lsbCByZXR1cm4gY2hpbGQgbm9kZXMgZnJvbSBhIG1vcmUgc2hhbGxvdyBwYXRoLg0KICoNCiAqIEBwYXJhbSBjb21wb3VuZFdyaXRlIC0gVGhlIENvbXBvdW5kV3JpdGUgdG8gZ2V0IHRoZSBub2RlIGZyb20uDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGdldCBhIGNvbXBsZXRlIHdyaXRlDQogKiBAcmV0dXJucyBUaGUgbm9kZSBpZiBjb21wbGV0ZSBhdCB0aGF0IHBhdGgsIG9yIG51bGwgb3RoZXJ3aXNlLg0KICovDQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICBjb25zdCByb290bW9zdCA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5maW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGgocGF0aCk7DQogICAgaWYgKHJvb3Rtb3N0ICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXw0KICAgICAgICAgICAgLmdldChyb290bW9zdC5wYXRoKQ0KICAgICAgICAgICAgLmdldENoaWxkKG5ld1JlbGF0aXZlUGF0aChyb290bW9zdC5wYXRoLCBwYXRoKSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgYWxsIGNoaWxkcmVuIHRoYXQgYXJlIGd1YXJhbnRlZWQgdG8gYmUgYSBjb21wbGV0ZSBvdmVyd3JpdGUuDQogKg0KICogQHBhcmFtIGNvbXBvdW5kV3JpdGUgLSBUaGUgQ29tcG91bmRXcml0ZSB0byBnZXQgY2hpbGRyZW4gZnJvbS4NCiAqIEByZXR1cm5zIEEgbGlzdCBvZiBhbGwgY29tcGxldGUgY2hpbGRyZW4uDQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKGNvbXBvdW5kV3JpdGUpIHsNCiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOw0KICAgIGNvbnN0IG5vZGUgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8udmFsdWU7DQogICAgaWYgKG5vZGUgIT0gbnVsbCkgew0KICAgICAgICAvLyBJZiBpdCdzIGEgbGVhZiBub2RlLCBpdCBoYXMgbm8gY2hpbGRyZW47IHNvIG5vdGhpbmcgdG8gZG8uDQogICAgICAgIGlmICghbm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIG5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBOYW1lZE5vZGUoY2hpbGROYW1lLCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGROYW1lLCBjaGlsZFRyZWUpID0+IHsNCiAgICAgICAgICAgIGlmIChjaGlsZFRyZWUudmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2gobmV3IE5hbWVkTm9kZShjaGlsZE5hbWUsIGNoaWxkVHJlZS52YWx1ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgcmV0dXJuIGNoaWxkcmVuOw0KfQ0KZnVuY3Rpb24gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZShjb21wb3VuZFdyaXRlLCBwYXRoKSB7DQogICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgc2hhZG93aW5nTm9kZSA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUoY29tcG91bmRXcml0ZSwgcGF0aCk7DQogICAgICAgIGlmIChzaGFkb3dpbmdOb2RlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXcgSW1tdXRhYmxlVHJlZShzaGFkb3dpbmdOb2RlKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUoY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnN1YnRyZWUocGF0aCkpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5IGFuZCB0aGVyZWZvcmUgZG9lcyBub3QgbW9kaWZ5IGFueSBub2Rlcy4NCiAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5DQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNvbXBvdW5kV3JpdGUpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLmlzRW1wdHkoKTsNCn0NCi8qKg0KICogQXBwbGllcyB0aGlzIENvbXBvdW5kV3JpdGUgdG8gYSBub2RlLiBUaGUgbm9kZSBpcyByZXR1cm5lZCB3aXRoIGFsbCB3cml0ZXMgZnJvbSB0aGlzIENvbXBvdW5kV3JpdGUgYXBwbGllZCB0byB0aGUNCiAqIG5vZGUNCiAqIEBwYXJhbSBub2RlIC0gVGhlIG5vZGUgdG8gYXBwbHkgdGhpcyBDb21wb3VuZFdyaXRlIHRvDQogKiBAcmV0dXJucyBUaGUgbm9kZSB3aXRoIGFsbCB3cml0ZXMgYXBwbGllZA0KICovDQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlQXBwbHkoY29tcG91bmRXcml0ZSwgbm9kZSkgew0KICAgIHJldHVybiBhcHBseVN1YnRyZWVXcml0ZShuZXdFbXB0eVBhdGgoKSwgY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLCBub2RlKTsNCn0NCmZ1bmN0aW9uIGFwcGx5U3VidHJlZVdyaXRlKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLCBub2RlKSB7DQogICAgaWYgKHdyaXRlVHJlZS52YWx1ZSAhPSBudWxsKSB7DQogICAgICAgIC8vIFNpbmNlIHRoZXJlIGEgd3JpdGUgaXMgYWx3YXlzIGEgbGVhZiwgd2UncmUgZG9uZSBoZXJlDQogICAgICAgIHJldHVybiBub2RlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLnZhbHVlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBwcmlvcml0eVdyaXRlID0gbnVsbDsNCiAgICAgICAgd3JpdGVUcmVlLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkS2V5LCBjaGlsZFRyZWUpID0+IHsNCiAgICAgICAgICAgIGlmIChjaGlsZEtleSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgICAgICAvLyBBcHBseSBwcmlvcml0aWVzIGF0IHRoZSBlbmQgc28gd2UgZG9uJ3QgdXBkYXRlIHByaW9yaXRpZXMgZm9yIGVpdGhlciBlbXB0eSBub2RlcyBvciBmb3JnZXQNCiAgICAgICAgICAgICAgICAvLyB0byBhcHBseSBwcmlvcml0aWVzIHRvIGVtcHR5IG5vZGVzIHRoYXQgYXJlIGxhdGVyIGZpbGxlZA0KICAgICAgICAgICAgICAgIGFzc2VydChjaGlsZFRyZWUudmFsdWUgIT09IG51bGwsICdQcmlvcml0eSB3cml0ZXMgbXVzdCBhbHdheXMgYmUgbGVhZiBub2RlcycpOw0KICAgICAgICAgICAgICAgIHByaW9yaXR5V3JpdGUgPSBjaGlsZFRyZWUudmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBub2RlID0gYXBwbHlTdWJ0cmVlV3JpdGUocGF0aENoaWxkKHJlbGF0aXZlUGF0aCwgY2hpbGRLZXkpLCBjaGlsZFRyZWUsIG5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8gSWYgdGhlcmUgd2FzIGEgcHJpb3JpdHkgd3JpdGUsIHdlIG9ubHkgYXBwbHkgaXQgaWYgdGhlIG5vZGUgaXMgbm90IGVtcHR5DQogICAgICAgIGlmICghbm9kZS5nZXRDaGlsZChyZWxhdGl2ZVBhdGgpLmlzRW1wdHkoKSAmJiBwcmlvcml0eVdyaXRlICE9PSBudWxsKSB7DQogICAgICAgICAgICBub2RlID0gbm9kZS51cGRhdGVDaGlsZChwYXRoQ2hpbGQocmVsYXRpdmVQYXRoLCAnLnByaW9yaXR5JyksIHByaW9yaXR5V3JpdGUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBub2RlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQ3JlYXRlIGEgbmV3IFdyaXRlVHJlZVJlZiBmb3IgdGhlIGdpdmVuIHBhdGguIEZvciB1c2Ugd2l0aCBhIG5ldyBzeW5jIHBvaW50IGF0IHRoZSBnaXZlbiBwYXRoLg0KICoNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2hpbGRXcml0ZXMod3JpdGVUcmVlLCBwYXRoKSB7DQogICAgcmV0dXJuIG5ld1dyaXRlVHJlZVJlZihwYXRoLCB3cml0ZVRyZWUpOw0KfQ0KLyoqDQogKiBSZWNvcmQgYSBuZXcgb3ZlcndyaXRlIGZyb20gdXNlciBjb2RlLg0KICoNCiAqIEBwYXJhbSB2aXNpYmxlIC0gVGhpcyBpcyBzZXQgdG8gZmFsc2UgYnkgc29tZSB0cmFuc2FjdGlvbnMuIEl0IHNob3VsZCBiZSBleGNsdWRlZCBmcm9tIGV2ZW50IGNhY2hlcw0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVBZGRPdmVyd3JpdGUod3JpdGVUcmVlLCBwYXRoLCBzbmFwLCB3cml0ZUlkLCB2aXNpYmxlKSB7DQogICAgYXNzZXJ0KHdyaXRlSWQgPiB3cml0ZVRyZWUubGFzdFdyaXRlSWQsICdTdGFja2luZyBhbiBvbGRlciB3cml0ZSBvbiB0b3Agb2YgbmV3ZXIgb25lcycpOw0KICAgIGlmICh2aXNpYmxlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdmlzaWJsZSA9IHRydWU7DQogICAgfQ0KICAgIHdyaXRlVHJlZS5hbGxXcml0ZXMucHVzaCh7DQogICAgICAgIHBhdGgsDQogICAgICAgIHNuYXAsDQogICAgICAgIHdyaXRlSWQsDQogICAgICAgIHZpc2libGUNCiAgICB9KTsNCiAgICBpZiAodmlzaWJsZSkgew0KICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCwgc25hcCk7DQogICAgfQ0KICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IHdyaXRlSWQ7DQp9DQpmdW5jdGlvbiB3cml0ZVRyZWVHZXRXcml0ZSh3cml0ZVRyZWUsIHdyaXRlSWQpIHsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdyaXRlVHJlZS5hbGxXcml0ZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgcmVjb3JkID0gd3JpdGVUcmVlLmFsbFdyaXRlc1tpXTsNCiAgICAgICAgaWYgKHJlY29yZC53cml0ZUlkID09PSB3cml0ZUlkKSB7DQogICAgICAgICAgICByZXR1cm4gcmVjb3JkOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KfQ0KLyoqDQogKiBSZW1vdmUgYSB3cml0ZSAoZWl0aGVyIGFuIG92ZXJ3cml0ZSBvciBtZXJnZSkgdGhhdCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYWNrbm93bGVkZ2UgYnkgdGhlIHNlcnZlci4gUmVjYWxjdWxhdGVzDQogKiB0aGUgdHJlZSBpZiBuZWNlc3NhcnkuICBXZSByZXR1cm4gdHJ1ZSBpZiBpdCBtYXkgaGF2ZSBiZWVuIHZpc2libGUsIG1lYW5pbmcgdmlld3MgbmVlZCB0byByZWV2YWx1YXRlLg0KICoNCiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHdyaXRlIG1heSBoYXZlIGJlZW4gdmlzaWJsZSAobWVhbmluZyB3ZSdsbCBuZWVkIHRvIHJlZXZhbHVhdGUgLyByYWlzZQ0KICogZXZlbnRzIGFzIGEgcmVzdWx0KS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVtb3ZlV3JpdGUod3JpdGVUcmVlLCB3cml0ZUlkKSB7DQogICAgLy8gTm90ZTogZGlzYWJsaW5nIHRoaXMgY2hlY2suIEl0IGNvdWxkIGJlIGEgdHJhbnNhY3Rpb24gdGhhdCBwcmVlbXB0ZWQgYW5vdGhlciB0cmFuc2FjdGlvbiwgYW5kIHRodXMgd2FzIGFwcGxpZWQNCiAgICAvLyBvdXQgb2Ygb3JkZXIuDQogICAgLy9jb25zdCB2YWxpZENsZWFyID0gcmV2ZXJ0IHx8IHRoaXMuYWxsV3JpdGVzXy5sZW5ndGggPT09IDAgfHwgd3JpdGVJZCA8PSB0aGlzLmFsbFdyaXRlc19bMF0ud3JpdGVJZDsNCiAgICAvL2Fzc2VydCh2YWxpZENsZWFyLCAiRWl0aGVyIHdlIGRvbid0IGhhdmUgdGhpcyB3cml0ZSwgb3IgaXQncyB0aGUgZmlyc3Qgb25lIGluIHRoZSBxdWV1ZSIpOw0KICAgIGNvbnN0IGlkeCA9IHdyaXRlVHJlZS5hbGxXcml0ZXMuZmluZEluZGV4KHMgPT4gew0KICAgICAgICByZXR1cm4gcy53cml0ZUlkID09PSB3cml0ZUlkOw0KICAgIH0pOw0KICAgIGFzc2VydChpZHggPj0gMCwgJ3JlbW92ZVdyaXRlIGNhbGxlZCB3aXRoIG5vbmV4aXN0ZW50IHdyaXRlSWQuJyk7DQogICAgY29uc3Qgd3JpdGVUb1JlbW92ZSA9IHdyaXRlVHJlZS5hbGxXcml0ZXNbaWR4XTsNCiAgICB3cml0ZVRyZWUuYWxsV3JpdGVzLnNwbGljZShpZHgsIDEpOw0KICAgIGxldCByZW1vdmVkV3JpdGVXYXNWaXNpYmxlID0gd3JpdGVUb1JlbW92ZS52aXNpYmxlOw0KICAgIGxldCByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IGZhbHNlOw0KICAgIGxldCBpID0gd3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggLSAxOw0KICAgIHdoaWxlIChyZW1vdmVkV3JpdGVXYXNWaXNpYmxlICYmIGkgPj0gMCkgew0KICAgICAgICBjb25zdCBjdXJyZW50V3JpdGUgPSB3cml0ZVRyZWUuYWxsV3JpdGVzW2ldOw0KICAgICAgICBpZiAoY3VycmVudFdyaXRlLnZpc2libGUpIHsNCiAgICAgICAgICAgIGlmIChpID49IGlkeCAmJg0KICAgICAgICAgICAgICAgIHdyaXRlVHJlZVJlY29yZENvbnRhaW5zUGF0aF8oY3VycmVudFdyaXRlLCB3cml0ZVRvUmVtb3ZlLnBhdGgpKSB7DQogICAgICAgICAgICAgICAgLy8gVGhlIHJlbW92ZWQgd3JpdGUgd2FzIGNvbXBsZXRlbHkgc2hhZG93ZWQgYnkgYSBzdWJzZXF1ZW50IHdyaXRlLg0KICAgICAgICAgICAgICAgIHJlbW92ZWRXcml0ZVdhc1Zpc2libGUgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVRvUmVtb3ZlLnBhdGgsIGN1cnJlbnRXcml0ZS5wYXRoKSkgew0KICAgICAgICAgICAgICAgIC8vIEVpdGhlciB3ZSdyZSBjb3ZlcmluZyBzb21lIHdyaXRlcyBvciB0aGV5J3JlIGNvdmVyaW5nIHBhcnQgb2YgdXMgKGRlcGVuZGluZyBvbiB3aGljaCBjYW1lIGZpcnN0KS4NCiAgICAgICAgICAgICAgICByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaS0tOw0KICAgIH0NCiAgICBpZiAoIXJlbW92ZWRXcml0ZVdhc1Zpc2libGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBlbHNlIGlmIChyZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcykgew0KICAgICAgICAvLyBUaGVyZSdzIHNvbWUgc2hhZG93aW5nIGdvaW5nIG9uLiBKdXN0IHJlYnVpbGQgdGhlIHZpc2libGUgd3JpdGVzIGZyb20gc2NyYXRjaC4NCiAgICAgICAgd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFRoZXJlJ3Mgbm8gc2hhZG93aW5nLiAgV2UgY2FuIHNhZmVseSBqdXN0IHJlbW92ZSB0aGUgd3JpdGUocykgZnJvbSB2aXNpYmxlV3JpdGVzLg0KICAgICAgICBpZiAod3JpdGVUb1JlbW92ZS5zbmFwKSB7DQogICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgd3JpdGVUb1JlbW92ZS5wYXRoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gd3JpdGVUb1JlbW92ZS5jaGlsZHJlbjsNCiAgICAgICAgICAgIGVhY2goY2hpbGRyZW4sIChjaGlsZE5hbWUpID0+IHsNCiAgICAgICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aENoaWxkKHdyaXRlVG9SZW1vdmUucGF0aCwgY2hpbGROYW1lKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQp9DQpmdW5jdGlvbiB3cml0ZVRyZWVSZWNvcmRDb250YWluc1BhdGhfKHdyaXRlUmVjb3JkLCBwYXRoKSB7DQogICAgaWYgKHdyaXRlUmVjb3JkLnNuYXApIHsNCiAgICAgICAgcmV0dXJuIHBhdGhDb250YWlucyh3cml0ZVJlY29yZC5wYXRoLCBwYXRoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGZvciAoY29uc3QgY2hpbGROYW1lIGluIHdyaXRlUmVjb3JkLmNoaWxkcmVuKSB7DQogICAgICAgICAgICBpZiAod3JpdGVSZWNvcmQuY2hpbGRyZW4uaGFzT3duUHJvcGVydHkoY2hpbGROYW1lKSAmJg0KICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyhwYXRoQ2hpbGQod3JpdGVSZWNvcmQucGF0aCwgY2hpbGROYW1lKSwgcGF0aCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KfQ0KLyoqDQogKiBSZS1sYXllciB0aGUgd3JpdGVzIGFuZCBtZXJnZXMgaW50byBhIHRyZWUgc28gd2UgY2FuIGVmZmljaWVudGx5IGNhbGN1bGF0ZSBldmVudCBzbmFwc2hvdHMNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpIHsNCiAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IHdyaXRlVHJlZUxheWVyVHJlZV8od3JpdGVUcmVlLmFsbFdyaXRlcywgd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8sIG5ld0VtcHR5UGF0aCgpKTsNCiAgICBpZiAod3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9DQogICAgICAgICAgICB3cml0ZVRyZWUuYWxsV3JpdGVzW3dyaXRlVHJlZS5hbGxXcml0ZXMubGVuZ3RoIC0gMV0ud3JpdGVJZDsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IC0xOw0KICAgIH0NCn0NCi8qKg0KICogVGhlIGRlZmF1bHQgZmlsdGVyIHVzZWQgd2hlbiBjb25zdHJ1Y3RpbmcgdGhlIHRyZWUuIEtlZXAgZXZlcnl0aGluZyB0aGF0J3MgdmlzaWJsZS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8od3JpdGUpIHsNCiAgICByZXR1cm4gd3JpdGUudmlzaWJsZTsNCn0NCi8qKg0KICogU3RhdGljIG1ldGhvZC4gR2l2ZW4gYW4gYXJyYXkgb2YgV3JpdGVSZWNvcmRzLCBhIGZpbHRlciBmb3Igd2hpY2ggb25lcyB0byBpbmNsdWRlLCBhbmQgYSBwYXRoLCBjb25zdHJ1Y3QgdGhlIHRyZWUgb2YNCiAqIGV2ZW50IGRhdGEgYXQgdGhhdCBwYXRoLg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVMYXllclRyZWVfKHdyaXRlcywgZmlsdGVyLCB0cmVlUm9vdCkgew0KICAgIGxldCBjb21wb3VuZFdyaXRlID0gQ29tcG91bmRXcml0ZS5lbXB0eSgpOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd3JpdGVzLmxlbmd0aDsgKytpKSB7DQogICAgICAgIGNvbnN0IHdyaXRlID0gd3JpdGVzW2ldOw0KICAgICAgICAvLyBUaGVvcnksIGEgbGF0ZXIgc2V0IHdpbGwgZWl0aGVyOg0KICAgICAgICAvLyBhKSBhYm9ydCBhIHJlbGV2YW50IHRyYW5zYWN0aW9uLCBzbyBubyBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBpdCBmcm9tIGNhbGN1bGF0aW5nIHRoYXQgdHJhbnNhY3Rpb24NCiAgICAgICAgLy8gYikgbm90IGJlIHJlbGV2YW50IHRvIGEgdHJhbnNhY3Rpb24gKHNlcGFyYXRlIGJyYW5jaCksIHNvIGFnYWluIHdpbGwgbm90IGFmZmVjdCB0aGUgZGF0YSBmb3IgdGhhdCB0cmFuc2FjdGlvbg0KICAgICAgICBpZiAoZmlsdGVyKHdyaXRlKSkgew0KICAgICAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gd3JpdGUucGF0aDsNCiAgICAgICAgICAgIGxldCByZWxhdGl2ZVBhdGg7DQogICAgICAgICAgICBpZiAod3JpdGUuc25hcCkgew0KICAgICAgICAgICAgICAgIGlmIChwYXRoQ29udGFpbnModHJlZVJvb3QsIHdyaXRlUGF0aCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHRyZWVSb290LCB3cml0ZVBhdGgpOw0KICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIHJlbGF0aXZlUGF0aCwgd3JpdGUuc25hcCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkgew0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7DQogICAgICAgICAgICAgICAgICAgIGNvbXBvdW5kV3JpdGUgPSBjb21wb3VuZFdyaXRlQWRkV3JpdGUoY29tcG91bmRXcml0ZSwgbmV3RW1wdHlQYXRoKCksIHdyaXRlLnNuYXAuZ2V0Q2hpbGQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAod3JpdGUuY2hpbGRyZW4pIHsNCiAgICAgICAgICAgICAgICBpZiAocGF0aENvbnRhaW5zKHRyZWVSb290LCB3cml0ZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aCh0cmVlUm9vdCwgd3JpdGVQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgY29tcG91bmRXcml0ZSA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZXMoY29tcG91bmRXcml0ZSwgcmVsYXRpdmVQYXRoLCB3cml0ZS5jaGlsZHJlbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkgew0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlcyhjb21wb3VuZFdyaXRlLCBuZXdFbXB0eVBhdGgoKSwgd3JpdGUuY2hpbGRyZW4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBzYWZlR2V0KHdyaXRlLmNoaWxkcmVuLCBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBleGlzdHMgYSBjaGlsZCBpbiB0aGlzIG5vZGUgdGhhdCBtYXRjaGVzIHRoZSByb290IHBhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWVwTm9kZSA9IGNoaWxkLmdldENoaWxkKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIG5ld0VtcHR5UGF0aCgpLCBkZWVwTm9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcignV3JpdGVSZWNvcmQgc2hvdWxkIGhhdmUgLnNuYXAgb3IgLmNoaWxkcmVuJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGNvbXBvdW5kV3JpdGU7DQp9DQovKioNCiAqIEdpdmVuIG9wdGlvbmFsLCB1bmRlcmx5aW5nIHNlcnZlciBkYXRhLCBhbmQgYW4gb3B0aW9uYWwgc2V0IG9mIGNvbnN0cmFpbnRzIChleGNsdWRlIHNvbWUgc2V0cywgaW5jbHVkZSBoaWRkZW4NCiAqIHdyaXRlcyksIGF0dGVtcHQgdG8gY2FsY3VsYXRlIGEgY29tcGxldGUgc25hcHNob3QgZm9yIHRoZSBnaXZlbiBwYXRoDQogKg0KICogQHBhcmFtIHdyaXRlSWRzVG9FeGNsdWRlIC0gQW4gb3B0aW9uYWwgc2V0IHRvIGJlIGV4Y2x1ZGVkDQogKiBAcGFyYW0gaW5jbHVkZUhpZGRlbldyaXRlcyAtIERlZmF1bHRzIHRvIGZhbHNlLCB3aGV0aGVyIG9yIG5vdCB0byBsYXllciBvbiB3cml0ZXMgd2l0aCB2aXNpYmxlIHNldCB0byBmYWxzZQ0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyQ2FjaGUsIHdyaXRlSWRzVG9FeGNsdWRlLCBpbmNsdWRlSGlkZGVuV3JpdGVzKSB7DQogICAgaWYgKCF3cml0ZUlkc1RvRXhjbHVkZSAmJiAhaW5jbHVkZUhpZGRlbldyaXRlcykgew0KICAgICAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgICAgICBpZiAoc2hhZG93aW5nTm9kZSAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IHN1Yk1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgICAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KHN1Yk1lcmdlKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDYWNoZSA9PSBudWxsICYmDQogICAgICAgICAgICAgICAgIWNvbXBvdW5kV3JpdGVIYXNDb21wbGV0ZVdyaXRlKHN1Yk1lcmdlLCBuZXdFbXB0eVBhdGgoKSkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSB3b3VsZG4ndCBoYXZlIGEgY29tcGxldGUgc25hcHNob3QsIHNpbmNlIHRoZXJlJ3Mgbm8gdW5kZXJseWluZyBkYXRhIGFuZCBubyBjb21wbGV0ZSBzaGFkb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyZWRDYWNoZSA9IGNvbXBsZXRlU2VydmVyQ2FjaGUgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShzdWJNZXJnZSwgbGF5ZXJlZENhY2hlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7DQogICAgICAgIGlmICghaW5jbHVkZUhpZGRlbldyaXRlcyAmJiBjb21wb3VuZFdyaXRlSXNFbXB0eShtZXJnZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gSWYgdGhlIHNlcnZlciBjYWNoZSBpcyBudWxsLCBhbmQgd2UgZG9uJ3QgaGF2ZSBhIGNvbXBsZXRlIGNhY2hlLCB3ZSBuZWVkIHRvIHJldHVybiBudWxsDQogICAgICAgICAgICBpZiAoIWluY2x1ZGVIaWRkZW5Xcml0ZXMgJiYNCiAgICAgICAgICAgICAgICBjb21wbGV0ZVNlcnZlckNhY2hlID09IG51bGwgJiYNCiAgICAgICAgICAgICAgICAhY29tcG91bmRXcml0ZUhhc0NvbXBsZXRlV3JpdGUobWVyZ2UsIG5ld0VtcHR5UGF0aCgpKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZnVuY3Rpb24gKHdyaXRlKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHdyaXRlLnZpc2libGUgfHwgaW5jbHVkZUhpZGRlbldyaXRlcykgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICghd3JpdGVJZHNUb0V4Y2x1ZGUgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhfndyaXRlSWRzVG9FeGNsdWRlLmluZGV4T2Yod3JpdGUud3JpdGVJZCkpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAocGF0aENvbnRhaW5zKHdyaXRlLnBhdGgsIHRyZWVQYXRoKSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyh0cmVlUGF0aCwgd3JpdGUucGF0aCkpKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlQXRQYXRoID0gd3JpdGVUcmVlTGF5ZXJUcmVlXyh3cml0ZVRyZWUuYWxsV3JpdGVzLCBmaWx0ZXIsIHRyZWVQYXRoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBsYXllcmVkQ2FjaGUgPSBjb21wbGV0ZVNlcnZlckNhY2hlIHx8IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICAgICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2VBdFBhdGgsIGxheWVyZWRDYWNoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFdpdGggb3B0aW9uYWwsIHVuZGVybHlpbmcgc2VydmVyIGRhdGEsIGF0dGVtcHQgdG8gcmV0dXJuIGEgY2hpbGRyZW4gbm9kZSBvZiBjaGlsZHJlbiB0aGF0IHdlIGhhdmUgY29tcGxldGUgZGF0YSBmb3IuDQogKiBVc2VkIHdoZW4gY3JlYXRpbmcgbmV3IHZpZXdzLCB0byBwcmUtZmlsbCB0aGVpciBjb21wbGV0ZSBldmVudCBjaGlsZHJlbiBzbmFwc2hvdC4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZVRyZWUsIHRyZWVQYXRoLCBjb21wbGV0ZVNlcnZlckNoaWxkcmVuKSB7DQogICAgbGV0IGNvbXBsZXRlQ2hpbGRyZW4gPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICBjb25zdCB0b3BMZXZlbFNldCA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTsNCiAgICBpZiAodG9wTGV2ZWxTZXQpIHsNCiAgICAgICAgaWYgKCF0b3BMZXZlbFNldC5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIC8vIHdlJ3JlIHNoYWRvd2luZyBldmVyeXRoaW5nLiBSZXR1cm4gdGhlIGNoaWxkcmVuLg0KICAgICAgICAgICAgdG9wTGV2ZWxTZXQuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZFNuYXApID0+IHsNCiAgICAgICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUsIGNoaWxkU25hcCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY29tcGxldGVDaGlsZHJlbjsNCiAgICB9DQogICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikgew0KICAgICAgICAvLyBMYXllciBhbnkgY2hpbGRyZW4gd2UgaGF2ZSBvbiB0b3Agb2YgdGhpcw0KICAgICAgICAvLyBXZSBrbm93IHdlIGRvbid0IGhhdmUgYSB0b3AtbGV2ZWwgc2V0LCBzbyBqdXN0IGVudW1lcmF0ZSBleGlzdGluZyBjaGlsZHJlbg0KICAgICAgICBjb25zdCBtZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTsNCiAgICAgICAgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbi5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChjaGlsZE5hbWUsIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNvbXBvdW5kV3JpdGVBcHBseShjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKG1lcmdlLCBuZXcgUGF0aChjaGlsZE5hbWUpKSwgY2hpbGROb2RlKTsNCiAgICAgICAgICAgIGNvbXBsZXRlQ2hpbGRyZW4gPSBjb21wbGV0ZUNoaWxkcmVuLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbm9kZSk7DQogICAgICAgIH0pOw0KICAgICAgICAvLyBBZGQgYW55IGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZnJvbSB0aGUgc2V0DQogICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7DQogICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBXZSBkb24ndCBoYXZlIGFueXRoaW5nIHRvIGxheWVyIG9uIHRvcCBvZi4gTGF5ZXIgb24gYW55IGNoaWxkcmVuIHdlIGhhdmUNCiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGNhbiByZXR1cm4gYW4gZW1wdHkgc25hcCBpZiB3ZSBoYXZlIGEgZGVmaW5lZCBkZWxldGUNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7DQogICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7DQogICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47DQogICAgfQ0KfQ0KLyoqDQogKiBHaXZlbiB0aGF0IHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCwgaWYgYW55dGhpbmcsIG5lZWRzIHRvIGJlDQogKiBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS4NCiAqDQogKiBQb3NzaWJpbGl0aWVzOg0KICoNCiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YQ0KICoNCiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWQNCiAqDQogKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50cw0KICoNCiAqIEVpdGhlciBleGlzdGluZ0V2ZW50U25hcCBvciBleGlzdGluZ1NlcnZlclNuYXAgbXVzdCBleGlzdA0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNoaWxkUGF0aCwgZXhpc3RpbmdFdmVudFNuYXAsIGV4aXN0aW5nU2VydmVyU25hcCkgew0KICAgIGFzc2VydChleGlzdGluZ0V2ZW50U25hcCB8fCBleGlzdGluZ1NlcnZlclNuYXAsICdFaXRoZXIgZXhpc3RpbmdFdmVudFNuYXAgb3IgZXhpc3RpbmdTZXJ2ZXJTbmFwIG11c3QgZXhpc3QnKTsNCiAgICBjb25zdCBwYXRoID0gcGF0aENoaWxkKHRyZWVQYXRoLCBjaGlsZFBhdGgpOw0KICAgIGlmIChjb21wb3VuZFdyaXRlSGFzQ29tcGxldGVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCkpIHsNCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB3ZSBjYW4gcHJvYmFibHkgZ3VhcmFudGVlIHRoYXQgd2UncmUgaW4gY2FzZSAyLCBtZWFuaW5nIG5vIGV2ZW50cw0KICAgICAgICAvLyBNYXkgbmVlZCB0byBjaGVjayB2aXNpYmlsaXR5IHdoaWxlIGRvaW5nIHRoZSBmaW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGggY2FsbA0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIE5vIGNvbXBsZXRlIHNoYWRvd2luZy4gV2UncmUgZWl0aGVyIHBhcnRpYWxseSBzaGFkb3dpbmcgb3Igbm90IHNoYWRvd2luZyBhdCBhbGwuDQogICAgICAgIGNvbnN0IGNoaWxkTWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCBwYXRoKTsNCiAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNoaWxkTWVyZ2UpKSB7DQogICAgICAgICAgICAvLyBXZSdyZSBub3Qgc2hhZG93aW5nIGF0IGFsbC4gQ2FzZSAxDQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdTZXJ2ZXJTbmFwLmdldENoaWxkKGNoaWxkUGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIG1vcmUgZWZmaWNpZW50IGlmIHRoZSBzZXJ2ZXJOb2RlICsgdXBkYXRlcyBkb2Vzbid0IGNoYW5nZSB0aGUgZXZlbnRTbmFwDQogICAgICAgICAgICAvLyBIb3dldmVyIHRoaXMgaXMgdHJpY2t5IHRvIGZpbmQgb3V0LCBzaW5jZSB1c2VyIHVwZGF0ZXMgZG9uJ3QgbmVjZXNzYXJ5IGNoYW5nZSB0aGUgc2VydmVyDQogICAgICAgICAgICAvLyBzbmFwLCBlLmcuIHByaW9yaXR5IHVwZGF0ZXMgb24gZW1wdHkgbm9kZXMsIG9yIGRlZXAgZGVsZXRlcy4gQW5vdGhlciBzcGVjaWFsIGNhc2UgaXMgaWYgdGhlIHNlcnZlcg0KICAgICAgICAgICAgLy8gYWRkcyBub2RlcywgYnV0IGRvZXNuJ3QgY2hhbmdlIGFueSBleGlzdGluZyB3cml0ZXMuIEl0IGlzIHRoZXJlZm9yZSBub3QgZW5vdWdoIHRvDQogICAgICAgICAgICAvLyBvbmx5IGNoZWNrIGlmIHRoZSB1cGRhdGVzIGNoYW5nZSB0aGUgc2VydmVyTm9kZS4NCiAgICAgICAgICAgIC8vIE1heWJlIGNoZWNrIGlmIHRoZSBtZXJnZSB0cmVlIGNvbnRhaW5zIHRoZXNlIHNwZWNpYWwgY2FzZXMgYW5kIG9ubHkgZG8gYSBmdWxsIG92ZXJ3cml0ZSBpbiB0aGF0IGNhc2U/DQogICAgICAgICAgICByZXR1cm4gY29tcG91bmRXcml0ZUFwcGx5KGNoaWxkTWVyZ2UsIGV4aXN0aW5nU2VydmVyU25hcC5nZXRDaGlsZChjaGlsZFBhdGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIGNvbXBsZXRlIGNoaWxkIGZvciBhIGdpdmVuIHNlcnZlciBzbmFwIGFmdGVyIGFwcGx5aW5nIGFsbCB1c2VyIHdyaXRlcyBvciBudWxsIGlmIHRoZXJlIGlzIG5vDQogKiBjb21wbGV0ZSBjaGlsZCBmb3IgdGhpcyBDaGlsZEtleS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlLCB0cmVlUGF0aCwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyU25hcCkgew0KICAgIGNvbnN0IHBhdGggPSBwYXRoQ2hpbGQodHJlZVBhdGgsIGNoaWxkS2V5KTsNCiAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7DQogICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmIChleGlzdGluZ1NlcnZlclNuYXAuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3QgY2hpbGRNZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHBhdGgpOw0KICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShjaGlsZE1lcmdlLCBleGlzdGluZ1NlcnZlclNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIG5vZGUgaWYgdGhlcmUgaXMgYSBjb21wbGV0ZSBvdmVyd3JpdGUgZm9yIHRoaXMgcGF0aC4gTW9yZSBzcGVjaWZpY2FsbHksIGlmIHRoZXJlIGlzIGEgd3JpdGUgYXQNCiAqIGEgaGlnaGVyIHBhdGgsIHRoaXMgd2lsbCByZXR1cm4gdGhlIGNoaWxkIG9mIHRoYXQgd3JpdGUgcmVsYXRpdmUgdG8gdGhlIHdyaXRlIGFuZCB0aGlzIHBhdGguDQogKiBSZXR1cm5zIG51bGwgaWYgdGhlcmUgaXMgbm8gd3JpdGUgYXQgdGhpcyBwYXRoLg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWUsIHBhdGgpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7DQp9DQovKioNCiAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgd2hlbiBwcm9jZXNzaW5nIGNoaWxkIHJlbW92ZSBldmVudHMgb24gYSBxdWVyeS4gSWYgd2UgY2FuLCB3ZSBwdWxsIGluIGNoaWxkcmVuIHRoYXQgd2VyZSBvdXRzaWRlDQogKiB0aGUgd2luZG93LCBidXQgbWF5IG5vdyBiZSBpbiB0aGUgd2luZG93Lg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyRGF0YSwgc3RhcnRQb3N0LCBjb3VudCwgcmV2ZXJzZSwgaW5kZXgpIHsNCiAgICBsZXQgdG9JdGVyYXRlOw0KICAgIGNvbnN0IG1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgIGNvbnN0IHNoYWRvd2luZ05vZGUgPSBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKG1lcmdlLCBuZXdFbXB0eVBhdGgoKSk7DQogICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkgew0KICAgICAgICB0b0l0ZXJhdGUgPSBzaGFkb3dpbmdOb2RlOw0KICAgIH0NCiAgICBlbHNlIGlmIChjb21wbGV0ZVNlcnZlckRhdGEgIT0gbnVsbCkgew0KICAgICAgICB0b0l0ZXJhdGUgPSBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2UsIGNvbXBsZXRlU2VydmVyRGF0YSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBubyBjaGlsZHJlbiB0byBpdGVyYXRlIG9uDQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgdG9JdGVyYXRlID0gdG9JdGVyYXRlLndpdGhJbmRleChpbmRleCk7DQogICAgaWYgKCF0b0l0ZXJhdGUuaXNFbXB0eSgpICYmICF0b0l0ZXJhdGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgIGNvbnN0IG5vZGVzID0gW107DQogICAgICAgIGNvbnN0IGNtcCA9IGluZGV4LmdldENvbXBhcmUoKTsNCiAgICAgICAgY29uc3QgaXRlciA9IHJldmVyc2UNCiAgICAgICAgICAgID8gdG9JdGVyYXRlLmdldFJldmVyc2VJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBpbmRleCkNCiAgICAgICAgICAgIDogdG9JdGVyYXRlLmdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QsIGluZGV4KTsNCiAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTsNCiAgICAgICAgd2hpbGUgKG5leHQgJiYgbm9kZXMubGVuZ3RoIDwgY291bnQpIHsNCiAgICAgICAgICAgIGlmIChjbXAobmV4dCwgc3RhcnRQb3N0KSAhPT0gMCkgew0KICAgICAgICAgICAgICAgIG5vZGVzLnB1c2gobmV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGVzOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCmZ1bmN0aW9uIG5ld1dyaXRlVHJlZSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgICB2aXNpYmxlV3JpdGVzOiBDb21wb3VuZFdyaXRlLmVtcHR5KCksDQogICAgICAgIGFsbFdyaXRlczogW10sDQogICAgICAgIGxhc3RXcml0ZUlkOiAtMQ0KICAgIH07DQp9DQovKioNCiAqIElmIHBvc3NpYmxlLCByZXR1cm5zIGEgY29tcGxldGUgZXZlbnQgY2FjaGUsIHVzaW5nIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGlmIHBvc3NpYmxlLiBJbiBhZGRpdGlvbiwgY2FuIGJlIHVzZWQNCiAqIHRvIGdldCBhIGNhY2hlIHRoYXQgaW5jbHVkZXMgaGlkZGVuIHdyaXRlcywgYW5kIGV4Y2x1ZGVzIGFyYml0cmFyeSB3cml0ZXMuIE5vdGUgdGhhdCBjdXN0b21pemluZyB0aGUgcmV0dXJuZWQgbm9kZQ0KICogY2FuIGxlYWQgdG8gYSBtb3JlIGV4cGVuc2l2ZSBjYWxjdWxhdGlvbi4NCiAqDQogKiBAcGFyYW0gd3JpdGVJZHNUb0V4Y2x1ZGUgLSBPcHRpb25hbCB3cml0ZXMgdG8gZXhjbHVkZS4NCiAqIEBwYXJhbSBpbmNsdWRlSGlkZGVuV3JpdGVzIC0gRGVmYXVsdHMgdG8gZmFsc2UsIHdoZXRoZXIgb3Igbm90IHRvIGxheWVyIG9uIHdyaXRlcyB3aXRoIHZpc2libGUgc2V0IHRvIGZhbHNlDQogKi8NCmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVUcmVlUmVmLCBjb21wbGV0ZVNlcnZlckNhY2hlLCB3cml0ZUlkc1RvRXhjbHVkZSwgaW5jbHVkZUhpZGRlbldyaXRlcykgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDYWNoZSwgd3JpdGVJZHNUb0V4Y2x1ZGUsIGluY2x1ZGVIaWRkZW5Xcml0ZXMpOw0KfQ0KLyoqDQogKiBJZiBwb3NzaWJsZSwgcmV0dXJucyBhIGNoaWxkcmVuIG5vZGUgY29udGFpbmluZyBhbGwgb2YgdGhlIGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZGF0YSBmb3IuIFRoZSByZXR1cm5lZCBkYXRhIGlzIGENCiAqIG1peCBvZiB0aGUgZ2l2ZW4gc2VydmVyIGRhdGEgYW5kIHdyaXRlIGRhdGEuDQogKg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbik7DQp9DQovKioNCiAqIEdpdmVuIHRoYXQgZWl0aGVyIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkIG9yIHRoZSBvdXRzdGFuZGluZyB3cml0ZXMgaGF2ZSB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCwNCiAqIGlmIGFueXRoaW5nLCBuZWVkcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS4NCiAqDQogKiBQb3NzaWJpbGl0aWVzOg0KICoNCiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YQ0KICoNCiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWQNCiAqDQogKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50cyBzaG91bGQgYmUgcmFpc2VkDQogKg0KICogRWl0aGVyIGV4aXN0aW5nRXZlbnRTbmFwIG9yIGV4aXN0aW5nU2VydmVyU25hcCBtdXN0IGV4aXN0LCB0aGlzIGlzIHZhbGlkYXRlZCB2aWEgYW4gYXNzZXJ0DQogKg0KICoNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYud3JpdGVUcmVlLCB3cml0ZVRyZWVSZWYudHJlZVBhdGgsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApOw0KfQ0KLyoqDQogKiBSZXR1cm5zIGEgbm9kZSBpZiB0aGVyZSBpcyBhIGNvbXBsZXRlIG92ZXJ3cml0ZSBmb3IgdGhpcyBwYXRoLiBNb3JlIHNwZWNpZmljYWxseSwgaWYgdGhlcmUgaXMgYSB3cml0ZSBhdA0KICogYSBoaWdoZXIgcGF0aCwgdGhpcyB3aWxsIHJldHVybiB0aGUgY2hpbGQgb2YgdGhhdCB3cml0ZSByZWxhdGl2ZSB0byB0aGUgd3JpdGUgYW5kIHRoaXMgcGF0aC4NCiAqIFJldHVybnMgbnVsbCBpZiB0aGVyZSBpcyBubyB3cml0ZSBhdCB0aGlzIHBhdGguDQogKg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgpIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlU2hhZG93aW5nV3JpdGUod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgcGF0aENoaWxkKHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgcGF0aCkpOw0KfQ0KLyoqDQogKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHdoZW4gcHJvY2Vzc2luZyBjaGlsZCByZW1vdmUgZXZlbnRzIG9uIGEgcXVlcnkuIElmIHdlIGNhbiwgd2UgcHVsbCBpbiBjaGlsZHJlbiB0aGF0IHdlcmUgb3V0c2lkZQ0KICogdGhlIHdpbmRvdywgYnV0IG1heSBub3cgYmUgaW4gdGhlIHdpbmRvdw0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCkgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCk7DQp9DQovKioNCiAqIFJldHVybnMgYSBjb21wbGV0ZSBjaGlsZCBmb3IgYSBnaXZlbiBzZXJ2ZXIgc25hcCBhZnRlciBhcHBseWluZyBhbGwgdXNlciB3cml0ZXMgb3IgbnVsbCBpZiB0aGVyZSBpcyBubw0KICogY29tcGxldGUgY2hpbGQgZm9yIHRoaXMgQ2hpbGRLZXkuDQogKi8NCmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUNoaWxkKHdyaXRlVHJlZVJlZiwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyQ2FjaGUpIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgd3JpdGVUcmVlUmVmLnRyZWVQYXRoLCBjaGlsZEtleSwgZXhpc3RpbmdTZXJ2ZXJDYWNoZSk7DQp9DQovKioNCiAqIFJldHVybiBhIFdyaXRlVHJlZVJlZiBmb3IgYSBjaGlsZC4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVUcmVlUmVmLCBjaGlsZE5hbWUpIHsNCiAgICByZXR1cm4gbmV3V3JpdGVUcmVlUmVmKHBhdGhDaGlsZCh3cml0ZVRyZWVSZWYudHJlZVBhdGgsIGNoaWxkTmFtZSksIHdyaXRlVHJlZVJlZi53cml0ZVRyZWUpOw0KfQ0KZnVuY3Rpb24gbmV3V3JpdGVUcmVlUmVmKHBhdGgsIHdyaXRlVHJlZSkgew0KICAgIHJldHVybiB7DQogICAgICAgIHRyZWVQYXRoOiBwYXRoLA0KICAgICAgICB3cml0ZVRyZWUNCiAgICB9Ow0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgQ2hpbGRDaGFuZ2VBY2N1bXVsYXRvciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuY2hhbmdlTWFwID0gbmV3IE1hcCgpOw0KICAgIH0NCiAgICB0cmFja0NoaWxkQ2hhbmdlKGNoYW5nZSkgew0KICAgICAgICBjb25zdCB0eXBlID0gY2hhbmdlLnR5cGU7DQogICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gY2hhbmdlLmNoaWxkTmFtZTsNCiAgICAgICAgYXNzZXJ0KHR5cGUgPT09ICJjaGlsZF9hZGRlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9BRERFRCAqLyB8fA0KICAgICAgICAgICAgdHlwZSA9PT0gImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLyB8fA0KICAgICAgICAgICAgdHlwZSA9PT0gImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLywgJ09ubHkgY2hpbGQgY2hhbmdlcyBzdXBwb3J0ZWQgZm9yIHRyYWNraW5nJyk7DQogICAgICAgIGFzc2VydChjaGlsZEtleSAhPT0gJy5wcmlvcml0eScsICdPbmx5IG5vbi1wcmlvcml0eSBjaGlsZCBjaGFuZ2VzIGNhbiBiZSB0cmFja2VkLicpOw0KICAgICAgICBjb25zdCBvbGRDaGFuZ2UgPSB0aGlzLmNoYW5nZU1hcC5nZXQoY2hpbGRLZXkpOw0KICAgICAgICBpZiAob2xkQ2hhbmdlKSB7DQogICAgICAgICAgICBjb25zdCBvbGRUeXBlID0gb2xkQ2hhbmdlLnR5cGU7DQogICAgICAgICAgICBpZiAodHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLykgew0KICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlQ2hpbGRDaGFuZ2VkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBvbGRDaGFuZ2Uuc25hcHNob3ROb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfcmVtb3ZlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9SRU1PVkVEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuZGVsZXRlKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICJjaGlsZF9yZW1vdmVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8gJiYNCiAgICAgICAgICAgICAgICBvbGRUeXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGRLZXksIG9sZENoYW5nZS5vbGRTbmFwKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZEFkZGVkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLykgew0KICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlQ2hpbGRDaGFuZ2VkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBvbGRDaGFuZ2Uub2xkU25hcCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgYXNzZXJ0aW9uRXJyb3IoJ0lsbGVnYWwgY29tYmluYXRpb24gb2YgY2hhbmdlczogJyArDQogICAgICAgICAgICAgICAgICAgIGNoYW5nZSArDQogICAgICAgICAgICAgICAgICAgICcgb2NjdXJyZWQgYWZ0ZXIgJyArDQogICAgICAgICAgICAgICAgICAgIG9sZENoYW5nZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLmNoYW5nZU1hcC5zZXQoY2hpbGRLZXksIGNoYW5nZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZ2V0Q2hhbmdlcygpIHsNCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5jaGFuZ2VNYXAudmFsdWVzKCkpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgQ29tcGxldGVDaGlsZFNvdXJjZSB0aGF0IG5ldmVyIHJldHVybnMgYW55IGFkZGl0aW9uYWwgY2hpbGRyZW4NCiAqLw0KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvbg0KY2xhc3MgTm9Db21wbGV0ZUNoaWxkU291cmNlXyB7DQogICAgZ2V0Q29tcGxldGVDaGlsZChjaGlsZEtleSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgZ2V0Q2hpbGRBZnRlckNoaWxkKGluZGV4LCBjaGlsZCwgcmV2ZXJzZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFNpbmdsZXRvbiBpbnN0YW5jZS4NCiAqLw0KY29uc3QgTk9fQ09NUExFVEVfQ0hJTERfU09VUkNFID0gbmV3IE5vQ29tcGxldGVDaGlsZFNvdXJjZV8oKTsNCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgQ29tcGxldGVDaGlsZFNvdXJjZSB0aGF0IHVzZXMgYSBXcml0ZVRyZWUgaW4gYWRkaXRpb24gdG8gYW55IG90aGVyIHNlcnZlciBkYXRhIG9yDQogKiBvbGQgZXZlbnQgY2FjaGVzIGF2YWlsYWJsZSB0byBjYWxjdWxhdGUgY29tcGxldGUgY2hpbGRyZW4uDQogKi8NCmNsYXNzIFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Ugew0KICAgIGNvbnN0cnVjdG9yKHdyaXRlc18sIHZpZXdDYWNoZV8sIG9wdENvbXBsZXRlU2VydmVyQ2FjaGVfID0gbnVsbCkgew0KICAgICAgICB0aGlzLndyaXRlc18gPSB3cml0ZXNfOw0KICAgICAgICB0aGlzLnZpZXdDYWNoZV8gPSB2aWV3Q2FjaGVfOw0KICAgICAgICB0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfID0gb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV87DQogICAgfQ0KICAgIGdldENvbXBsZXRlQ2hpbGQoY2hpbGRLZXkpIHsNCiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMudmlld0NhY2hlXy5ldmVudENhY2hlOw0KICAgICAgICBpZiAobm9kZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpKSB7DQogICAgICAgICAgICByZXR1cm4gbm9kZS5nZXROb2RlKCkuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyTm9kZSA9IHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gIT0gbnVsbA0KICAgICAgICAgICAgICAgID8gbmV3IENhY2hlTm9kZSh0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfLCB0cnVlLCBmYWxzZSkNCiAgICAgICAgICAgICAgICA6IHRoaXMudmlld0NhY2hlXy5zZXJ2ZXJDYWNoZTsNCiAgICAgICAgICAgIHJldHVybiB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh0aGlzLndyaXRlc18sIGNoaWxkS2V5LCBzZXJ2ZXJOb2RlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRDaGlsZEFmdGVyQ2hpbGQoaW5kZXgsIGNoaWxkLCByZXZlcnNlKSB7DQogICAgICAgIGNvbnN0IGNvbXBsZXRlU2VydmVyRGF0YSA9IHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gIT0gbnVsbA0KICAgICAgICAgICAgPyB0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfDQogICAgICAgICAgICA6IHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh0aGlzLnZpZXdDYWNoZV8pOw0KICAgICAgICBjb25zdCBub2RlcyA9IHdyaXRlVHJlZVJlZkNhbGNJbmRleGVkU2xpY2UodGhpcy53cml0ZXNfLCBjb21wbGV0ZVNlcnZlckRhdGEsIGNoaWxkLCAxLCByZXZlcnNlLCBpbmRleCk7DQogICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG5vZGVzWzBdOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gbmV3Vmlld1Byb2Nlc3NvcihmaWx0ZXIpIHsNCiAgICByZXR1cm4geyBmaWx0ZXIgfTsNCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBc3NlcnRJbmRleGVkKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSkgew0KICAgIGFzc2VydCh2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCkuaXNJbmRleGVkKHZpZXdQcm9jZXNzb3IuZmlsdGVyLmdldEluZGV4KCkpLCAnRXZlbnQgc25hcCBub3QgaW5kZXhlZCcpOw0KICAgIGFzc2VydCh2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmlzSW5kZXhlZCh2aWV3UHJvY2Vzc29yLmZpbHRlci5nZXRJbmRleCgpKSwgJ1NlcnZlciBzbmFwIG5vdCBpbmRleGVkJyk7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlPcGVyYXRpb24odmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlKSB7DQogICAgY29uc3QgYWNjdW11bGF0b3IgPSBuZXcgQ2hpbGRDaGFuZ2VBY2N1bXVsYXRvcigpOw0KICAgIGxldCBuZXdWaWV3Q2FjaGUsIGZpbHRlclNlcnZlck5vZGU7DQogICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLk9WRVJXUklURSkgew0KICAgICAgICBjb25zdCBvdmVyd3JpdGUgPSBvcGVyYXRpb247DQogICAgICAgIGlmIChvdmVyd3JpdGUuc291cmNlLmZyb21Vc2VyKSB7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlVc2VyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgb3ZlcndyaXRlLnBhdGgsIG92ZXJ3cml0ZS5zbmFwLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG92ZXJ3cml0ZS5zb3VyY2UuZnJvbVNlcnZlciwgJ1Vua25vd24gc291cmNlLicpOw0KICAgICAgICAgICAgLy8gV2UgZmlsdGVyIHRoZSBub2RlIGlmIGl0J3MgYSB0YWdnZWQgdXBkYXRlIG9yIHRoZSBub2RlIGhhcyBiZWVuIHByZXZpb3VzbHkgZmlsdGVyZWQgIGFuZCB0aGUNCiAgICAgICAgICAgIC8vIHVwZGF0ZSBpcyBub3QgYXQgdGhlIHJvb3QgaW4gd2hpY2ggY2FzZSBpdCBpcyBvayAoYW5kIG5lY2Vzc2FyeSkgdG8gbWFyayB0aGUgbm9kZSB1bmZpbHRlcmVkDQogICAgICAgICAgICAvLyBhZ2Fpbg0KICAgICAgICAgICAgZmlsdGVyU2VydmVyTm9kZSA9DQogICAgICAgICAgICAgICAgb3ZlcndyaXRlLnNvdXJjZS50YWdnZWQgfHwNCiAgICAgICAgICAgICAgICAgICAgKG9sZFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCkgJiYgIXBhdGhJc0VtcHR5KG92ZXJ3cml0ZS5wYXRoKSk7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJPdmVyd3JpdGUodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvdmVyd3JpdGUucGF0aCwgb3ZlcndyaXRlLnNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAob3BlcmF0aW9uLnR5cGUgPT09IE9wZXJhdGlvblR5cGUuTUVSR0UpIHsNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBvcGVyYXRpb247DQogICAgICAgIGlmIChtZXJnZS5zb3VyY2UuZnJvbVVzZXIpIHsNCiAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG1lcmdlLnBhdGgsIG1lcmdlLmNoaWxkcmVuLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG1lcmdlLnNvdXJjZS5mcm9tU2VydmVyLCAnVW5rbm93biBzb3VyY2UuJyk7DQogICAgICAgICAgICAvLyBXZSBmaWx0ZXIgdGhlIG5vZGUgaWYgaXQncyBhIHRhZ2dlZCB1cGRhdGUgb3IgdGhlIG5vZGUgaGFzIGJlZW4gcHJldmlvdXNseSBmaWx0ZXJlZA0KICAgICAgICAgICAgZmlsdGVyU2VydmVyTm9kZSA9DQogICAgICAgICAgICAgICAgbWVyZ2Uuc291cmNlLnRhZ2dlZCB8fCBvbGRWaWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGaWx0ZXJlZCgpOw0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyTWVyZ2Uodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBtZXJnZS5wYXRoLCBtZXJnZS5jaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmIChvcGVyYXRpb24udHlwZSA9PT0gT3BlcmF0aW9uVHlwZS5BQ0tfVVNFUl9XUklURSkgew0KICAgICAgICBjb25zdCBhY2tVc2VyV3JpdGUgPSBvcGVyYXRpb247DQogICAgICAgIGlmICghYWNrVXNlcldyaXRlLnJldmVydCkgew0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFja1VzZXJXcml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGFja1VzZXJXcml0ZS5wYXRoLCBhY2tVc2VyV3JpdGUuYWZmZWN0ZWRUcmVlLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvclJldmVydFVzZXJXcml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGFja1VzZXJXcml0ZS5wYXRoLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLkxJU1RFTl9DT01QTEVURSkgew0KICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yTGlzdGVuQ29tcGxldGUodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvcGVyYXRpb24ucGF0aCwgd3JpdGVzQ2FjaGUsIGFjY3VtdWxhdG9yKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdVbmtub3duIG9wZXJhdGlvbiB0eXBlOiAnICsgb3BlcmF0aW9uLnR5cGUpOw0KICAgIH0NCiAgICBjb25zdCBjaGFuZ2VzID0gYWNjdW11bGF0b3IuZ2V0Q2hhbmdlcygpOw0KICAgIHZpZXdQcm9jZXNzb3JNYXliZUFkZFZhbHVlRXZlbnQob2xkVmlld0NhY2hlLCBuZXdWaWV3Q2FjaGUsIGNoYW5nZXMpOw0KICAgIHJldHVybiB7IHZpZXdDYWNoZTogbmV3Vmlld0NhY2hlLCBjaGFuZ2VzIH07DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yTWF5YmVBZGRWYWx1ZUV2ZW50KG9sZFZpZXdDYWNoZSwgbmV3Vmlld0NhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGNvbnN0IGV2ZW50U25hcCA9IG5ld1ZpZXdDYWNoZS5ldmVudENhY2hlOw0KICAgIGlmIChldmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgY29uc3QgaXNMZWFmT3JFbXB0eSA9IGV2ZW50U25hcC5nZXROb2RlKCkuaXNMZWFmTm9kZSgpIHx8IGV2ZW50U25hcC5nZXROb2RlKCkuaXNFbXB0eSgpOw0KICAgICAgICBjb25zdCBvbGRDb21wbGV0ZVNuYXAgPSB2aWV3Q2FjaGVHZXRDb21wbGV0ZUV2ZW50U25hcChvbGRWaWV3Q2FjaGUpOw0KICAgICAgICBpZiAoYWNjdW11bGF0b3IubGVuZ3RoID4gMCB8fA0KICAgICAgICAgICAgIW9sZFZpZXdDYWNoZS5ldmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpIHx8DQogICAgICAgICAgICAoaXNMZWFmT3JFbXB0eSAmJiAhZXZlbnRTbmFwLmdldE5vZGUoKS5lcXVhbHMob2xkQ29tcGxldGVTbmFwKSkgfHwNCiAgICAgICAgICAgICFldmVudFNuYXAuZ2V0Tm9kZSgpLmdldFByaW9yaXR5KCkuZXF1YWxzKG9sZENvbXBsZXRlU25hcC5nZXRQcmlvcml0eSgpKSkgew0KICAgICAgICAgICAgYWNjdW11bGF0b3IucHVzaChjaGFuZ2VWYWx1ZSh2aWV3Q2FjaGVHZXRDb21wbGV0ZUV2ZW50U25hcChuZXdWaWV3Q2FjaGUpKSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yR2VuZXJhdGVFdmVudENhY2hlQWZ0ZXJTZXJ2ZXJFdmVudCh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIGNoYW5nZVBhdGgsIHdyaXRlc0NhY2hlLCBzb3VyY2UsIGFjY3VtdWxhdG9yKSB7DQogICAgY29uc3Qgb2xkRXZlbnRTbmFwID0gdmlld0NhY2hlLmV2ZW50Q2FjaGU7DQogICAgaWYgKHdyaXRlVHJlZVJlZlNoYWRvd2luZ1dyaXRlKHdyaXRlc0NhY2hlLCBjaGFuZ2VQYXRoKSAhPSBudWxsKSB7DQogICAgICAgIC8vIHdlIGhhdmUgYSBzaGFkb3dpbmcgd3JpdGUsIGlnbm9yZSBjaGFuZ2VzDQogICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBsZXQgbmV3RXZlbnRDYWNoZSwgc2VydmVyTm9kZTsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgICAgICAvLyBUT0RPOiBmaWd1cmUgb3V0IGhvdyB0aGlzIHBsYXlzIHdpdGggInNsaWRpbmcgYWNrIHdpbmRvd3MiDQogICAgICAgICAgICBhc3NlcnQodmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpLCAnSWYgY2hhbmdlIHBhdGggaXMgZW1wdHksIHdlIG11c3QgaGF2ZSBjb21wbGV0ZSBzZXJ2ZXIgZGF0YScpOw0KICAgICAgICAgICAgaWYgKHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHNwZWNpYWwgY2FzZSB0aGlzLCBiZWNhdXNlIHdlIG5lZWQgdG8gb25seSBhcHBseSB3cml0ZXMgdG8gY29tcGxldGUgY2hpbGRyZW4sIG9yDQogICAgICAgICAgICAgICAgLy8gd2UgbWlnaHQgZW5kIHVwIHJhaXNpbmcgZXZlbnRzIGZvciBpbmNvbXBsZXRlIGNoaWxkcmVuLiBJZiB0aGUgc2VydmVyIGRhdGEgaXMgZmlsdGVyZWQgZGVlcA0KICAgICAgICAgICAgICAgIC8vIHdyaXRlcyBjYW5ub3QgYmUgZ3VhcmFudGVlZCB0byBiZSBjb21wbGV0ZQ0KICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckNhY2hlID0gdmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSk7DQogICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGVDaGlsZHJlbiA9IHNlcnZlckNhY2hlIGluc3RhbmNlb2YgQ2hpbGRyZW5Ob2RlDQogICAgICAgICAgICAgICAgICAgID8gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAgICAgOiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0ZUV2ZW50Q2hpbGRyZW4gPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNoaWxkcmVuKTsNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUodmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjb21wbGV0ZUV2ZW50Q2hpbGRyZW4sIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlTm9kZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpKTsNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUodmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjb21wbGV0ZU5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICAgICAgaWYgKGNoaWxkS2V5ID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgICAgIGFzc2VydChwYXRoR2V0TGVuZ3RoKGNoYW5nZVBhdGgpID09PSAxLCAiQ2FuJ3QgaGF2ZSBhIHByaW9yaXR5IHdpdGggYWRkaXRpb25hbCBwYXRoIGNvbXBvbmVudHMiKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvbGRFdmVudE5vZGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIHNlcnZlck5vZGUgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIC8vIHdlIG1pZ2h0IGhhdmUgb3ZlcndyaXRlcyBmb3IgdGhpcyBwcmlvcml0eQ0KICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcmlvcml0eSA9IHdyaXRlVHJlZVJlZkNhbGNFdmVudENhY2hlQWZ0ZXJTZXJ2ZXJPdmVyd3JpdGUod3JpdGVzQ2FjaGUsIGNoYW5nZVBhdGgsIG9sZEV2ZW50Tm9kZSwgc2VydmVyTm9kZSk7DQogICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWRQcmlvcml0eSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVQcmlvcml0eShvbGRFdmVudE5vZGUsIHVwZGF0ZWRQcmlvcml0eSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBwcmlvcml0eSBkaWRuJ3QgY2hhbmdlLCBrZWVwIG9sZCBub2RlDQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkQ2hhbmdlUGF0aCA9IHBhdGhQb3BGcm9udChjaGFuZ2VQYXRoKTsNCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hpbGQNCiAgICAgICAgICAgICAgICBsZXQgbmV3RXZlbnRDaGlsZDsNCiAgICAgICAgICAgICAgICBpZiAob2xkRXZlbnRTbmFwLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50Q2hpbGRVcGRhdGUgPSB3cml0ZVRyZWVSZWZDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlc0NhY2hlLCBjaGFuZ2VQYXRoLCBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBzZXJ2ZXJOb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Q2hpbGRVcGRhdGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDaGlsZCA9IG9sZEV2ZW50U25hcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXROb2RlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZUNoaWxkKGNoaWxkQ2hhbmdlUGF0aCwgZXZlbnRDaGlsZFVwZGF0ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIGNoYW5nZWQsIGp1c3Qga2VlcCB0aGUgb2xkIGNoaWxkDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENoaWxkID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2hpbGQgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh3cml0ZXNDYWNoZSwgY2hpbGRLZXksIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChuZXdFdmVudENoaWxkICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50U25hcC5nZXROb2RlKCksIGNoaWxkS2V5LCBuZXdFdmVudENoaWxkLCBjaGlsZENoYW5nZVBhdGgsIHNvdXJjZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gY29tcGxldGUgY2hpbGQgYXZhaWxhYmxlIG9yIG5vIGNoYW5nZQ0KICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIG9sZEV2ZW50U25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgdmlld1Byb2Nlc3Nvci5maWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGNoYW5nZVBhdGgsIGNoYW5nZWRTbmFwLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpIHsNCiAgICBjb25zdCBvbGRTZXJ2ZXJTbmFwID0gb2xkVmlld0NhY2hlLnNlcnZlckNhY2hlOw0KICAgIGxldCBuZXdTZXJ2ZXJDYWNoZTsNCiAgICBjb25zdCBzZXJ2ZXJGaWx0ZXIgPSBmaWx0ZXJTZXJ2ZXJOb2RlDQogICAgICAgID8gdmlld1Byb2Nlc3Nvci5maWx0ZXINCiAgICAgICAgOiB2aWV3UHJvY2Vzc29yLmZpbHRlci5nZXRJbmRleGVkRmlsdGVyKCk7DQogICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgIG5ld1NlcnZlckNhY2hlID0gc2VydmVyRmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKG9sZFNlcnZlclNuYXAuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCwgbnVsbCk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHNlcnZlckZpbHRlci5maWx0ZXJzTm9kZXMoKSAmJiAhb2xkU2VydmVyU25hcC5pc0ZpbHRlcmVkKCkpIHsNCiAgICAgICAgLy8gd2Ugd2FudCB0byBmaWx0ZXIgdGhlIHNlcnZlciBub2RlLCBidXQgd2UgZGlkbid0IGZpbHRlciB0aGUgc2VydmVyIG5vZGUgeWV0LCBzbyBzaW11bGF0ZSBhIGZ1bGwgdXBkYXRlDQogICAgICAgIGNvbnN0IG5ld1NlcnZlck5vZGUgPSBvbGRTZXJ2ZXJTbmFwDQogICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAudXBkYXRlQ2hpbGQoY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXApOw0KICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgbmV3U2VydmVyTm9kZSwgbnVsbCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBjaGlsZEtleSA9IHBhdGhHZXRGcm9udChjaGFuZ2VQYXRoKTsNCiAgICAgICAgaWYgKCFvbGRTZXJ2ZXJTbmFwLmlzQ29tcGxldGVGb3JQYXRoKGNoYW5nZVBhdGgpICYmDQogICAgICAgICAgICBwYXRoR2V0TGVuZ3RoKGNoYW5nZVBhdGgpID4gMSkgew0KICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdXBkYXRlIGluY29tcGxldGUgbm9kZXMgd2l0aCB1cGRhdGVzIGludGVuZGVkIGZvciBvdGhlciBsaXN0ZW5lcnMNCiAgICAgICAgICAgIHJldHVybiBvbGRWaWV3Q2FjaGU7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTsNCiAgICAgICAgaWYgKGNoaWxkS2V5ID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgbmV3U2VydmVyQ2FjaGUgPSBzZXJ2ZXJGaWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkU2VydmVyU25hcC5nZXROb2RlKCksIG5ld0NoaWxkTm9kZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVDaGlsZChvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgY2hpbGRLZXksIG5ld0NoaWxkTm9kZSwgY2hpbGRDaGFuZ2VQYXRoLCBOT19DT01QTEVURV9DSElMRF9TT1VSQ0UsIG51bGwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZVNlcnZlclNuYXAob2xkVmlld0NhY2hlLCBuZXdTZXJ2ZXJDYWNoZSwgb2xkU2VydmVyU25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgc2VydmVyRmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICBjb25zdCBzb3VyY2UgPSBuZXcgV3JpdGVUcmVlQ29tcGxldGVDaGlsZFNvdXJjZSh3cml0ZXNDYWNoZSwgbmV3Vmlld0NhY2hlLCBjb21wbGV0ZUNhY2hlKTsNCiAgICByZXR1cm4gdmlld1Byb2Nlc3NvckdlbmVyYXRlRXZlbnRDYWNoZUFmdGVyU2VydmVyRXZlbnQodmlld1Byb2Nlc3NvciwgbmV3Vmlld0NhY2hlLCBjaGFuZ2VQYXRoLCB3cml0ZXNDYWNoZSwgc291cmNlLCBhY2N1bXVsYXRvcik7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlVc2VyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGNvbnN0IG9sZEV2ZW50U25hcCA9IG9sZFZpZXdDYWNoZS5ldmVudENhY2hlOw0KICAgIGxldCBuZXdWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGU7DQogICAgY29uc3Qgc291cmNlID0gbmV3IFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Uod3JpdGVzQ2FjaGUsIG9sZFZpZXdDYWNoZSwgY29tcGxldGVDYWNoZSk7DQogICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRWaWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCksIGNoYW5nZWRTbmFwLCBhY2N1bXVsYXRvcik7DQogICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcChvbGRWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIHRydWUsIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICBpZiAoY2hpbGRLZXkgPT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkVmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCk7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3Q2FjaGVVcGRhdGVFdmVudFNuYXAob2xkVmlld0NhY2hlLCBuZXdFdmVudENhY2hlLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIG9sZEV2ZW50U25hcC5pc0ZpbHRlcmVkKCkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGxldCBuZXdDaGlsZDsNCiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShjaGlsZENoYW5nZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hpbGQgb3ZlcndyaXRlLCB3ZSBjYW4gcmVwbGFjZSB0aGUgY2hpbGQNCiAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoYW5nZWRTbmFwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc291cmNlLmdldENvbXBsZXRlQ2hpbGQoY2hpbGRLZXkpOw0KICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocGF0aEdldEJhY2soY2hpbGRDaGFuZ2VQYXRoKSA9PT0gJy5wcmlvcml0eScgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZS5nZXRDaGlsZChwYXRoUGFyZW50KGNoaWxkQ2hhbmdlUGF0aCkpLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHByaW9yaXR5IHVwZGF0ZSBvbiBhbiBlbXB0eSBub2RlLiBJZiB0aGlzIG5vZGUgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIsIHRoZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VydmVyIHdpbGwgc2VuZCBkb3duIHRoZSBwcmlvcml0eSBpbiB0aGUgdXBkYXRlLCBzbyBpZ25vcmUgZm9yIG5vdw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBjaGlsZE5vZGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gY29tcGxldGUgY2hpbGQgbm9kZSBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW9sZENoaWxkLmVxdWFscyhuZXdDaGlsZCkpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBuZXdFdmVudFNuYXAgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVDaGlsZChvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBjaGlsZEtleSwgbmV3Q2hpbGQsIGNoaWxkQ2hhbmdlUGF0aCwgc291cmNlLCBhY2N1bXVsYXRvcik7DQogICAgICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKG9sZFZpZXdDYWNoZSwgbmV3RXZlbnRTbmFwLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IG9sZFZpZXdDYWNoZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3Vmlld0NhY2hlOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBjaGlsZEtleSkgew0KICAgIHJldHVybiB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFwcGx5VXNlck1lcmdlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgLy8gSEFDSzogSW4gdGhlIGNhc2Ugb2YgYSBsaW1pdCBxdWVyeSwgdGhlcmUgbWF5IGJlIHNvbWUgY2hhbmdlcyB0aGF0IGJ1bXAgdGhpbmdzIG91dCBvZiB0aGUNCiAgICAvLyB3aW5kb3cgbGVhdmluZyByb29tIGZvciBuZXcgaXRlbXMuICBJdCdzIGltcG9ydGFudCB3ZSBwcm9jZXNzIHRoZXNlIGNoYW5nZXMgZmlyc3QsIHNvIHdlDQogICAgLy8gaXRlcmF0ZSB0aGUgY2hhbmdlcyB0d2ljZSwgZmlyc3QgcHJvY2Vzc2luZyBhbnkgdGhhdCBhZmZlY3QgaXRlbXMgY3VycmVudGx5IGluIHZpZXcuDQogICAgLy8gVE9ETzogSSBjb25zaWRlciBhbiBpdGVtICJpbiB2aWV3IiBpZiBjYWNoZUhhc0NoaWxkIGlzIHRydWUsIHdoaWNoIGNoZWNrcyBib3RoIHRoZSBzZXJ2ZXINCiAgICAvLyBhbmQgZXZlbnQgc25hcC4gIEknbSBub3Qgc3VyZSBpZiB0aGlzIHdpbGwgcmVzdWx0IGluIGVkZ2UgY2FzZXMgd2hlbiBhIGNoaWxkIGlzIGluIG9uZSBidXQNCiAgICAvLyBub3QgdGhlIG90aGVyLg0KICAgIGxldCBjdXJWaWV3Q2FjaGUgPSB2aWV3Q2FjaGU7DQogICAgY2hhbmdlZENoaWxkcmVuLmZvcmVhY2goKHJlbGF0aXZlUGF0aCwgY2hpbGROb2RlKSA9PiB7DQogICAgICAgIGNvbnN0IHdyaXRlUGF0aCA9IHBhdGhDaGlsZChwYXRoLCByZWxhdGl2ZVBhdGgpOw0KICAgICAgICBpZiAodmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBwYXRoR2V0RnJvbnQod3JpdGVQYXRoKSkpIHsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCB3cml0ZVBhdGgsIGNoaWxkTm9kZSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICBjaGFuZ2VkQ2hpbGRyZW4uZm9yZWFjaCgocmVsYXRpdmVQYXRoLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gcGF0aENoaWxkKHBhdGgsIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIGlmICghdmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBwYXRoR2V0RnJvbnQod3JpdGVQYXRoKSkpIHsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCB3cml0ZVBhdGgsIGNoaWxkTm9kZSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gY3VyVmlld0NhY2hlOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgbm9kZSwgbWVyZ2UpIHsNCiAgICBtZXJnZS5mb3JlYWNoKChyZWxhdGl2ZVBhdGgsIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICBub2RlID0gbm9kZS51cGRhdGVDaGlsZChyZWxhdGl2ZVBhdGgsIGNoaWxkTm9kZSk7DQogICAgfSk7DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIHBhdGgsIGNoYW5nZWRDaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcikgew0KICAgIC8vIElmIHdlIGRvbid0IGhhdmUgYSBjYWNoZSB5ZXQsIHRoaXMgbWVyZ2Ugd2FzIGludGVuZGVkIGZvciBhIHByZXZpb3VzbHkgbGlzdGVuIGluIHRoZSBzYW1lIGxvY2F0aW9uLiBJZ25vcmUgaXQgYW5kDQogICAgLy8gd2FpdCBmb3IgdGhlIGNvbXBsZXRlIGRhdGEgdXBkYXRlIGNvbWluZyBzb29uLg0KICAgIGlmICh2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmlzRW1wdHkoKSAmJg0KICAgICAgICAhdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpKSB7DQogICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgfQ0KICAgIC8vIEhBQ0s6IEluIHRoZSBjYXNlIG9mIGEgbGltaXQgcXVlcnksIHRoZXJlIG1heSBiZSBzb21lIGNoYW5nZXMgdGhhdCBidW1wIHRoaW5ncyBvdXQgb2YgdGhlDQogICAgLy8gd2luZG93IGxlYXZpbmcgcm9vbSBmb3IgbmV3IGl0ZW1zLiAgSXQncyBpbXBvcnRhbnQgd2UgcHJvY2VzcyB0aGVzZSBjaGFuZ2VzIGZpcnN0LCBzbyB3ZQ0KICAgIC8vIGl0ZXJhdGUgdGhlIGNoYW5nZXMgdHdpY2UsIGZpcnN0IHByb2Nlc3NpbmcgYW55IHRoYXQgYWZmZWN0IGl0ZW1zIGN1cnJlbnRseSBpbiB2aWV3Lg0KICAgIC8vIFRPRE86IEkgY29uc2lkZXIgYW4gaXRlbSAiaW4gdmlldyIgaWYgY2FjaGVIYXNDaGlsZCBpcyB0cnVlLCB3aGljaCBjaGVja3MgYm90aCB0aGUgc2VydmVyDQogICAgLy8gYW5kIGV2ZW50IHNuYXAuICBJJ20gbm90IHN1cmUgaWYgdGhpcyB3aWxsIHJlc3VsdCBpbiBlZGdlIGNhc2VzIHdoZW4gYSBjaGlsZCBpcyBpbiBvbmUgYnV0DQogICAgLy8gbm90IHRoZSBvdGhlci4NCiAgICBsZXQgY3VyVmlld0NhY2hlID0gdmlld0NhY2hlOw0KICAgIGxldCB2aWV3TWVyZ2VUcmVlOw0KICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkgew0KICAgICAgICB2aWV3TWVyZ2VUcmVlID0gY2hhbmdlZENoaWxkcmVuOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmlld01lcmdlVHJlZSA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpLnNldFRyZWUocGF0aCwgY2hhbmdlZENoaWxkcmVuKTsNCiAgICB9DQogICAgY29uc3Qgc2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQogICAgdmlld01lcmdlVHJlZS5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZEtleSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgIGlmIChzZXJ2ZXJOb2RlLmhhc0NoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2hpbGQgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAgICAgLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkID0gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgc2VydmVyQ2hpbGQsIGNoaWxkVHJlZSk7DQogICAgICAgICAgICBjdXJWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCBuZXcgUGF0aChjaGlsZEtleSksIG5ld0NoaWxkLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHZpZXdNZXJnZVRyZWUuY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGRLZXksIGNoaWxkTWVyZ2VUcmVlKSA9PiB7DQogICAgICAgIGNvbnN0IGlzVW5rbm93bkRlZXBNZXJnZSA9ICF2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSAmJg0KICAgICAgICAgICAgY2hpbGRNZXJnZVRyZWUudmFsdWUgPT09IG51bGw7DQogICAgICAgIGlmICghc2VydmVyTm9kZS5oYXNDaGlsZChjaGlsZEtleSkgJiYgIWlzVW5rbm93bkRlZXBNZXJnZSkgew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2hpbGQgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAgICAgLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkID0gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgc2VydmVyQ2hpbGQsIGNoaWxkTWVyZ2VUcmVlKTsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBjdXJWaWV3Q2FjaGUsIG5ldyBQYXRoKGNoaWxkS2V5KSwgbmV3Q2hpbGQsIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGN1clZpZXdDYWNoZTsNCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBY2tVc2VyV3JpdGUodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlLCBhY2tQYXRoLCBhZmZlY3RlZFRyZWUsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGlmICh3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZXNDYWNoZSwgYWNrUGF0aCkgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdmlld0NhY2hlOw0KICAgIH0NCiAgICAvLyBPbmx5IGZpbHRlciBzZXJ2ZXIgbm9kZSBpZiBpdCBpcyBjdXJyZW50bHkgZmlsdGVyZWQNCiAgICBjb25zdCBmaWx0ZXJTZXJ2ZXJOb2RlID0gdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRmlsdGVyZWQoKTsNCiAgICAvLyBFc3NlbnRpYWxseSB3ZSdsbCBqdXN0IGdldCBvdXIgZXhpc3Rpbmcgc2VydmVyIGNhY2hlIGZvciB0aGUgYWZmZWN0ZWQgcGF0aHMgYW5kIHJlLWFwcGx5IGl0IGFzIGEgc2VydmVyIHVwZGF0ZQ0KICAgIC8vIG5vdyB0aGF0IGl0IHdvbid0IGJlIHNoYWRvd2VkLg0KICAgIGNvbnN0IHNlcnZlckNhY2hlID0gdmlld0NhY2hlLnNlcnZlckNhY2hlOw0KICAgIGlmIChhZmZlY3RlZFRyZWUudmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAvLyBUaGlzIGlzIGFuIG92ZXJ3cml0ZS4NCiAgICAgICAgaWYgKChwYXRoSXNFbXB0eShhY2tQYXRoKSAmJiBzZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSkgfHwNCiAgICAgICAgICAgIHNlcnZlckNhY2hlLmlzQ29tcGxldGVGb3JQYXRoKGFja1BhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgYWNrUGF0aCwgc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmdldENoaWxkKGFja1BhdGgpLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhdGhJc0VtcHR5KGFja1BhdGgpKSB7DQogICAgICAgICAgICAvLyBUaGlzIGlzIGEgZ29vZnkgZWRnZSBjYXNlIHdoZXJlIHdlIGFyZSBhY2tpbmcgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGJ1dCBkb24ndCBoYXZlIGZ1bGwgZGF0YS4gIFdlDQogICAgICAgICAgICAvLyBzaG91bGQganVzdCByZS1hcHBseSB3aGF0ZXZlciB3ZSBoYXZlIGluIG91ciBjYWNoZSBhcyBhIG1lcmdlLg0KICAgICAgICAgICAgbGV0IGNoYW5nZWRDaGlsZHJlbiA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmZvckVhY2hDaGlsZChLRVlfSU5ERVgsIChuYW1lLCBub2RlKSA9PiB7DQogICAgICAgICAgICAgICAgY2hhbmdlZENoaWxkcmVuID0gY2hhbmdlZENoaWxkcmVuLnNldChuZXcgUGF0aChuYW1lKSwgbm9kZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIGFja1BhdGgsIGNoYW5nZWRDaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFRoaXMgaXMgYSBtZXJnZS4NCiAgICAgICAgbGV0IGNoYW5nZWRDaGlsZHJlbiA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICBhZmZlY3RlZFRyZWUuZm9yZWFjaCgobWVyZ2VQYXRoLCB2YWx1ZSkgPT4gew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2FjaGVQYXRoID0gcGF0aENoaWxkKGFja1BhdGgsIG1lcmdlUGF0aCk7DQogICAgICAgICAgICBpZiAoc2VydmVyQ2FjaGUuaXNDb21wbGV0ZUZvclBhdGgoc2VydmVyQ2FjaGVQYXRoKSkgew0KICAgICAgICAgICAgICAgIGNoYW5nZWRDaGlsZHJlbiA9IGNoYW5nZWRDaGlsZHJlbi5zZXQobWVyZ2VQYXRoLCBzZXJ2ZXJDYWNoZS5nZXROb2RlKCkuZ2V0Q2hpbGQoc2VydmVyQ2FjaGVQYXRoKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyTWVyZ2Uodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlLCBhY2tQYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3Nvckxpc3RlbkNvbXBsZXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgd3JpdGVzQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgY29uc3Qgb2xkU2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZTsNCiAgICBjb25zdCBuZXdWaWV3Q2FjaGUgPSB2aWV3Q2FjaGVVcGRhdGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSwgb2xkU2VydmVyTm9kZS5nZXROb2RlKCksIG9sZFNlcnZlck5vZGUuaXNGdWxseUluaXRpYWxpemVkKCkgfHwgcGF0aElzRW1wdHkocGF0aCksIG9sZFNlcnZlck5vZGUuaXNGaWx0ZXJlZCgpKTsNCiAgICByZXR1cm4gdmlld1Byb2Nlc3NvckdlbmVyYXRlRXZlbnRDYWNoZUFmdGVyU2VydmVyRXZlbnQodmlld1Byb2Nlc3NvciwgbmV3Vmlld0NhY2hlLCBwYXRoLCB3cml0ZXNDYWNoZSwgTk9fQ09NUExFVEVfQ0hJTERfU09VUkNFLCBhY2N1bXVsYXRvcik7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yUmV2ZXJ0VXNlcldyaXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgbGV0IGNvbXBsZXRlOw0KICAgIGlmICh3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZXNDYWNoZSwgcGF0aCkgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdmlld0NhY2hlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgc291cmNlID0gbmV3IFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Uod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZSwgY29tcGxldGVTZXJ2ZXJDYWNoZSk7DQogICAgICAgIGNvbnN0IG9sZEV2ZW50Q2FjaGUgPSB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCk7DQogICAgICAgIGxldCBuZXdFdmVudENhY2hlOw0KICAgICAgICBpZiAocGF0aElzRW1wdHkocGF0aCkgfHwgcGF0aEdldEZyb250KHBhdGgpID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgbGV0IG5ld05vZGU7DQogICAgICAgICAgICBpZiAodmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgICAgICAgbmV3Tm9kZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckNoaWxkcmVuID0gdmlld0NhY2hlLnNlcnZlckNhY2hlLmdldE5vZGUoKTsNCiAgICAgICAgICAgICAgICBhc3NlcnQoc2VydmVyQ2hpbGRyZW4gaW5zdGFuY2VvZiBDaGlsZHJlbk5vZGUsICdzZXJ2ZXJDaGlsZHJlbiB3b3VsZCBiZSBjb21wbGV0ZSBpZiBsZWFmIG5vZGUnKTsNCiAgICAgICAgICAgICAgICBuZXdOb2RlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZXNDYWNoZSwgc2VydmVyQ2hpbGRyZW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbmV3Tm9kZSA9IG5ld05vZGU7DQogICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUob2xkRXZlbnRDYWNoZSwgbmV3Tm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgICAgICBsZXQgbmV3Q2hpbGQgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh3cml0ZXNDYWNoZSwgY2hpbGRLZXksIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZSk7DQogICAgICAgICAgICBpZiAobmV3Q2hpbGQgPT0gbnVsbCAmJg0KICAgICAgICAgICAgICAgIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpKSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBvbGRFdmVudENhY2hlLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChuZXdDaGlsZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50Q2FjaGUsIGNoaWxkS2V5LCBuZXdDaGlsZCwgcGF0aFBvcEZyb250KHBhdGgpLCBzb3VyY2UsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKS5oYXNDaGlsZChjaGlsZEtleSkpIHsNCiAgICAgICAgICAgICAgICAvLyBObyBjb21wbGV0ZSBjaGlsZCBhdmFpbGFibGUsIGRlbGV0ZSB0aGUgZXhpc3Rpbmcgb25lLCBpZiBhbnkNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlQ2hpbGQob2xkRXZlbnRDYWNoZSwgY2hpbGRLZXksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLCBwYXRoUG9wRnJvbnQocGF0aCksIHNvdXJjZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IG9sZEV2ZW50Q2FjaGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobmV3RXZlbnRDYWNoZS5pc0VtcHR5KCkgJiYNCiAgICAgICAgICAgICAgICB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSBtaWdodCBoYXZlIHJldmVydGVkIGFsbCBjaGlsZCB3cml0ZXMuIE1heWJlIHRoZSBvbGQgZXZlbnQgd2FzIGEgbGVhZiBub2RlDQogICAgICAgICAgICAgICAgY29tcGxldGUgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlc0NhY2hlLCB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlld0NhY2hlKSk7DQogICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUobmV3RXZlbnRDYWNoZSwgY29tcGxldGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29tcGxldGUgPQ0KICAgICAgICAgICAgdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpIHx8DQogICAgICAgICAgICAgICAgd3JpdGVUcmVlUmVmU2hhZG93aW5nV3JpdGUod3JpdGVzQ2FjaGUsIG5ld0VtcHR5UGF0aCgpKSAhPSBudWxsOw0KICAgICAgICByZXR1cm4gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKHZpZXdDYWNoZSwgbmV3RXZlbnRDYWNoZSwgY29tcGxldGUsIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEEgdmlldyByZXByZXNlbnRzIGEgc3BlY2lmaWMgbG9jYXRpb24gYW5kIHF1ZXJ5IHRoYXQgaGFzIDEgb3IgbW9yZSBldmVudCByZWdpc3RyYXRpb25zLg0KICoNCiAqIEl0IGRvZXMgc2V2ZXJhbCB0aGluZ3M6DQogKiAgLSBNYWludGFpbnMgdGhlIGxpc3Qgb2YgZXZlbnQgcmVnaXN0cmF0aW9ucyBmb3IgdGhpcyBsb2NhdGlvbi9xdWVyeS4NCiAqICAtIE1haW50YWlucyBhIGNhY2hlIG9mIHRoZSBkYXRhIHZpc2libGUgZm9yIHRoaXMgbG9jYXRpb24vcXVlcnkuDQogKiAgLSBBcHBsaWVzIG5ldyBvcGVyYXRpb25zICh2aWEgYXBwbHlPcGVyYXRpb24pLCB1cGRhdGVzIHRoZSBjYWNoZSwgYW5kIGJhc2VkIG9uIHRoZSBldmVudA0KICogICAgcmVnaXN0cmF0aW9ucyByZXR1cm5zIHRoZSBzZXQgb2YgZXZlbnRzIHRvIGJlIHJhaXNlZC4NCiAqLw0KY2xhc3MgVmlldyB7DQogICAgY29uc3RydWN0b3IocXVlcnlfLCBpbml0aWFsVmlld0NhY2hlKSB7DQogICAgICAgIHRoaXMucXVlcnlfID0gcXVlcnlfOw0KICAgICAgICB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uc18gPSBbXTsNCiAgICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5xdWVyeV8uX3F1ZXJ5UGFyYW1zOw0KICAgICAgICBjb25zdCBpbmRleEZpbHRlciA9IG5ldyBJbmRleGVkRmlsdGVyKHBhcmFtcy5nZXRJbmRleCgpKTsNCiAgICAgICAgY29uc3QgZmlsdGVyID0gcXVlcnlQYXJhbXNHZXROb2RlRmlsdGVyKHBhcmFtcyk7DQogICAgICAgIHRoaXMucHJvY2Vzc29yXyA9IG5ld1ZpZXdQcm9jZXNzb3IoZmlsdGVyKTsNCiAgICAgICAgY29uc3QgaW5pdGlhbFNlcnZlckNhY2hlID0gaW5pdGlhbFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZTsNCiAgICAgICAgY29uc3QgaW5pdGlhbEV2ZW50Q2FjaGUgPSBpbml0aWFsVmlld0NhY2hlLmV2ZW50Q2FjaGU7DQogICAgICAgIC8vIERvbid0IGZpbHRlciBzZXJ2ZXIgbm9kZSB3aXRoIG90aGVyIGZpbHRlciB0aGFuIGluZGV4LCB3YWl0IGZvciB0YWdnZWQgbGlzdGVuDQogICAgICAgIGNvbnN0IHNlcnZlclNuYXAgPSBpbmRleEZpbHRlci51cGRhdGVGdWxsTm9kZShDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSwgaW5pdGlhbFNlcnZlckNhY2hlLmdldE5vZGUoKSwgbnVsbCk7DQogICAgICAgIGNvbnN0IGV2ZW50U25hcCA9IGZpbHRlci51cGRhdGVGdWxsTm9kZShDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSwgaW5pdGlhbEV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBudWxsKTsNCiAgICAgICAgY29uc3QgbmV3U2VydmVyQ2FjaGUgPSBuZXcgQ2FjaGVOb2RlKHNlcnZlclNuYXAsIGluaXRpYWxTZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgaW5kZXhGaWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgICAgICBjb25zdCBuZXdFdmVudENhY2hlID0gbmV3IENhY2hlTm9kZShldmVudFNuYXAsIGluaXRpYWxFdmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpLCBmaWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgICAgICB0aGlzLnZpZXdDYWNoZV8gPSBuZXdWaWV3Q2FjaGUobmV3RXZlbnRDYWNoZSwgbmV3U2VydmVyQ2FjaGUpOw0KICAgICAgICB0aGlzLmV2ZW50R2VuZXJhdG9yXyA9IG5ldyBFdmVudEdlbmVyYXRvcih0aGlzLnF1ZXJ5Xyk7DQogICAgfQ0KICAgIGdldCBxdWVyeSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlfOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHZpZXdHZXRTZXJ2ZXJDYWNoZSh2aWV3KSB7DQogICAgcmV0dXJuIHZpZXcudmlld0NhY2hlXy5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQp9DQpmdW5jdGlvbiB2aWV3R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZSh2aWV3LCBwYXRoKSB7DQogICAgY29uc3QgY2FjaGUgPSB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlldy52aWV3Q2FjaGVfKTsNCiAgICBpZiAoY2FjaGUpIHsNCiAgICAgICAgLy8gSWYgdGhpcyBpc24ndCBhICJsb2Fkc0FsbERhdGEiIHZpZXcsIHRoZW4gY2FjaGUgaXNuJ3QgYWN0dWFsbHkgYSBjb21wbGV0ZSBjYWNoZSBhbmQNCiAgICAgICAgLy8gd2UgbmVlZCB0byBzZWUgaWYgaXQgY29udGFpbnMgdGhlIGNoaWxkIHdlJ3JlIGludGVyZXN0ZWQgaW4uDQogICAgICAgIGlmICh2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSB8fA0KICAgICAgICAgICAgKCFwYXRoSXNFbXB0eShwYXRoKSAmJg0KICAgICAgICAgICAgICAgICFjYWNoZS5nZXRJbW1lZGlhdGVDaGlsZChwYXRoR2V0RnJvbnQocGF0aCkpLmlzRW1wdHkoKSkpIHsNCiAgICAgICAgICAgIHJldHVybiBjYWNoZS5nZXRDaGlsZChwYXRoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCn0NCmZ1bmN0aW9uIHZpZXdJc0VtcHR5KHZpZXcpIHsNCiAgICByZXR1cm4gdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmxlbmd0aCA9PT0gMDsNCn0NCmZ1bmN0aW9uIHZpZXdBZGRFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbikgew0KICAgIHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zXy5wdXNoKGV2ZW50UmVnaXN0cmF0aW9uKTsNCn0NCi8qKg0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uIC0gSWYgbnVsbCwgcmVtb3ZlIGFsbCBjYWxsYmFja3MuDQogKiBAcGFyYW0gY2FuY2VsRXJyb3IgLSBJZiBhIGNhbmNlbEVycm9yIGlzIHByb3ZpZGVkLCBhcHByb3ByaWF0ZSBjYW5jZWwgZXZlbnRzIHdpbGwgYmUgcmV0dXJuZWQuDQogKiBAcmV0dXJucyBDYW5jZWwgZXZlbnRzLCBpZiBjYW5jZWxFcnJvciB3YXMgcHJvdmlkZWQuDQogKi8NCmZ1bmN0aW9uIHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpIHsNCiAgICBjb25zdCBjYW5jZWxFdmVudHMgPSBbXTsNCiAgICBpZiAoY2FuY2VsRXJyb3IpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50UmVnaXN0cmF0aW9uID09IG51bGwsICdBIGNhbmNlbCBzaG91bGQgY2FuY2VsIGFsbCBldmVudCByZWdpc3RyYXRpb25zLicpOw0KICAgICAgICBjb25zdCBwYXRoID0gdmlldy5xdWVyeS5fcGF0aDsNCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmZvckVhY2gocmVnaXN0cmF0aW9uID0+IHsNCiAgICAgICAgICAgIGNvbnN0IG1heWJlRXZlbnQgPSByZWdpc3RyYXRpb24uY3JlYXRlQ2FuY2VsRXZlbnQoY2FuY2VsRXJyb3IsIHBhdGgpOw0KICAgICAgICAgICAgaWYgKG1heWJlRXZlbnQpIHsNCiAgICAgICAgICAgICAgICBjYW5jZWxFdmVudHMucHVzaChtYXliZUV2ZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChldmVudFJlZ2lzdHJhdGlvbikgew0KICAgICAgICBsZXQgcmVtYWluaW5nID0gW107DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zX1tpXTsNCiAgICAgICAgICAgIGlmICghZXhpc3RpbmcubWF0Y2hlcyhldmVudFJlZ2lzdHJhdGlvbikpIHsNCiAgICAgICAgICAgICAgICByZW1haW5pbmcucHVzaChleGlzdGluZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChldmVudFJlZ2lzdHJhdGlvbi5oYXNBbnlDYWxsYmFjaygpKSB7DQogICAgICAgICAgICAgICAgLy8gV2UncmUgcmVtb3ZpbmcganVzdCB0aGlzIG9uZQ0KICAgICAgICAgICAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZy5jb25jYXQodmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLnNsaWNlKGkgKyAxKSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfID0gcmVtYWluaW5nOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfID0gW107DQogICAgfQ0KICAgIHJldHVybiBjYW5jZWxFdmVudHM7DQp9DQovKioNCiAqIEFwcGxpZXMgdGhlIGdpdmVuIE9wZXJhdGlvbiwgdXBkYXRlcyBvdXIgY2FjaGUsIGFuZCByZXR1cm5zIHRoZSBhcHByb3ByaWF0ZSBldmVudHMuDQogKi8NCmZ1bmN0aW9uIHZpZXdBcHBseU9wZXJhdGlvbih2aWV3LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZVNlcnZlckNhY2hlKSB7DQogICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLk1FUkdFICYmDQogICAgICAgIG9wZXJhdGlvbi5zb3VyY2UucXVlcnlJZCAhPT0gbnVsbCkgew0KICAgICAgICBhc3NlcnQodmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXcudmlld0NhY2hlXyksICdXZSBzaG91bGQgYWx3YXlzIGhhdmUgYSBmdWxsIGNhY2hlIGJlZm9yZSBoYW5kbGluZyBtZXJnZXMnKTsNCiAgICAgICAgYXNzZXJ0KHZpZXdDYWNoZUdldENvbXBsZXRlRXZlbnRTbmFwKHZpZXcudmlld0NhY2hlXyksICdNaXNzaW5nIGV2ZW50IGNhY2hlLCBldmVuIHRob3VnaCB3ZSBoYXZlIGEgc2VydmVyIGNhY2hlJyk7DQogICAgfQ0KICAgIGNvbnN0IG9sZFZpZXdDYWNoZSA9IHZpZXcudmlld0NhY2hlXzsNCiAgICBjb25zdCByZXN1bHQgPSB2aWV3UHJvY2Vzc29yQXBwbHlPcGVyYXRpb24odmlldy5wcm9jZXNzb3JfLCBvbGRWaWV3Q2FjaGUsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUpOw0KICAgIHZpZXdQcm9jZXNzb3JBc3NlcnRJbmRleGVkKHZpZXcucHJvY2Vzc29yXywgcmVzdWx0LnZpZXdDYWNoZSk7DQogICAgYXNzZXJ0KHJlc3VsdC52aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkgfHwNCiAgICAgICAgIW9sZFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgJ09uY2UgYSBzZXJ2ZXIgc25hcCBpcyBjb21wbGV0ZSwgaXQgc2hvdWxkIG5ldmVyIGdvIGJhY2snKTsNCiAgICB2aWV3LnZpZXdDYWNoZV8gPSByZXN1bHQudmlld0NhY2hlOw0KICAgIHJldHVybiB2aWV3R2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzXyh2aWV3LCByZXN1bHQuY2hhbmdlcywgcmVzdWx0LnZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKSwgbnVsbCk7DQp9DQpmdW5jdGlvbiB2aWV3R2V0SW5pdGlhbEV2ZW50cyh2aWV3LCByZWdpc3RyYXRpb24pIHsNCiAgICBjb25zdCBldmVudFNuYXAgPSB2aWV3LnZpZXdDYWNoZV8uZXZlbnRDYWNoZTsNCiAgICBjb25zdCBpbml0aWFsQ2hhbmdlcyA9IFtdOw0KICAgIGlmICghZXZlbnRTbmFwLmdldE5vZGUoKS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgY29uc3QgZXZlbnROb2RlID0gZXZlbnRTbmFwLmdldE5vZGUoKTsNCiAgICAgICAgZXZlbnROb2RlLmZvckVhY2hDaGlsZChQUklPUklUWV9JTkRFWCwgKGtleSwgY2hpbGROb2RlKSA9PiB7DQogICAgICAgICAgICBpbml0aWFsQ2hhbmdlcy5wdXNoKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChldmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgaW5pdGlhbENoYW5nZXMucHVzaChjaGFuZ2VWYWx1ZShldmVudFNuYXAuZ2V0Tm9kZSgpKSk7DQogICAgfQ0KICAgIHJldHVybiB2aWV3R2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzXyh2aWV3LCBpbml0aWFsQ2hhbmdlcywgZXZlbnRTbmFwLmdldE5vZGUoKSwgcmVnaXN0cmF0aW9uKTsNCn0NCmZ1bmN0aW9uIHZpZXdHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXNfKHZpZXcsIGNoYW5nZXMsIGV2ZW50Q2FjaGUsIGV2ZW50UmVnaXN0cmF0aW9uKSB7DQogICAgY29uc3QgcmVnaXN0cmF0aW9ucyA9IGV2ZW50UmVnaXN0cmF0aW9uDQogICAgICAgID8gW2V2ZW50UmVnaXN0cmF0aW9uXQ0KICAgICAgICA6IHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zXzsNCiAgICByZXR1cm4gZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXModmlldy5ldmVudEdlbmVyYXRvcl8sIGNoYW5nZXMsIGV2ZW50Q2FjaGUsIHJlZ2lzdHJhdGlvbnMpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IHJlZmVyZW5jZUNvbnN0cnVjdG9yJDE7DQovKioNCiAqIFN5bmNQb2ludCByZXByZXNlbnRzIGEgc2luZ2xlIGxvY2F0aW9uIGluIGEgU3luY1RyZWUgd2l0aCAxIG9yIG1vcmUgZXZlbnQgcmVnaXN0cmF0aW9ucywgbWVhbmluZyB3ZSBuZWVkIHRvDQogKiBtYWludGFpbiAxIG9yIG1vcmUgVmlld3MgYXQgdGhpcyBsb2NhdGlvbiB0byBjYWNoZSBzZXJ2ZXIgZGF0YSBhbmQgcmFpc2UgYXBwcm9wcmlhdGUgZXZlbnRzIGZvciBzZXJ2ZXIgY2hhbmdlcw0KICogYW5kIHVzZXIgd3JpdGVzIChzZXQsIHRyYW5zYWN0aW9uLCB1cGRhdGUpLg0KICoNCiAqIEl0J3MgcmVzcG9uc2libGUgZm9yOg0KICogIC0gTWFpbnRhaW5pbmcgdGhlIHNldCBvZiAxIG9yIG1vcmUgdmlld3MgbmVjZXNzYXJ5IGF0IHRoaXMgbG9jYXRpb24gKGEgU3luY1BvaW50IHdpdGggMCB2aWV3cyBzaG91bGQgYmUgcmVtb3ZlZCkuDQogKiAgLSBQcm94eWluZyB1c2VyIC8gc2VydmVyIG9wZXJhdGlvbnMgdG8gdGhlIHZpZXdzIGFzIGFwcHJvcHJpYXRlIChpLmUuIGFwcGx5U2VydmVyT3ZlcndyaXRlLA0KICogICAgYXBwbHlVc2VyT3ZlcndyaXRlLCBldGMuKQ0KICovDQpjbGFzcyBTeW5jUG9pbnQgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIFZpZXdzIGJlaW5nIHRyYWNrZWQgYXQgdGhpcyBsb2NhdGlvbiBpbiB0aGUgdHJlZSwgc3RvcmVkIGFzIGEgbWFwIHdoZXJlIHRoZSBrZXkgaXMgYQ0KICAgICAgICAgKiBxdWVyeUlkIGFuZCB0aGUgdmFsdWUgaXMgdGhlIFZpZXcgZm9yIHRoYXQgcXVlcnkuDQogICAgICAgICAqDQogICAgICAgICAqIE5PVEU6IFRoaXMgbGlzdCB3aWxsIGJlIHF1aXRlIHNtYWxsICh1c3VhbGx5IDEsIGJ1dCBwZXJoYXBzIDIgb3IgMzsgYW55IG1vcmUgaXMgYW4gb2RkIHVzZSBjYXNlKS4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlld3MgPSBuZXcgTWFwKCk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gc3luY1BvaW50U2V0UmVmZXJlbmNlQ29uc3RydWN0b3IodmFsKSB7DQogICAgYXNzZXJ0KCFyZWZlcmVuY2VDb25zdHJ1Y3RvciQxLCAnX19yZWZlcmVuY2VDb25zdHJ1Y3RvciBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWQnKTsNCiAgICByZWZlcmVuY2VDb25zdHJ1Y3RvciQxID0gdmFsOw0KfQ0KZnVuY3Rpb24gc3luY1BvaW50R2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoKSB7DQogICAgYXNzZXJ0KHJlZmVyZW5jZUNvbnN0cnVjdG9yJDEsICdSZWZlcmVuY2UudHMgaGFzIG5vdCBiZWVuIGxvYWRlZCcpOw0KICAgIHJldHVybiByZWZlcmVuY2VDb25zdHJ1Y3RvciQxOw0KfQ0KZnVuY3Rpb24gc3luY1BvaW50SXNFbXB0eShzeW5jUG9pbnQpIHsNCiAgICByZXR1cm4gc3luY1BvaW50LnZpZXdzLnNpemUgPT09IDA7DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRBcHBseU9wZXJhdGlvbihzeW5jUG9pbnQsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIG9wdENvbXBsZXRlU2VydmVyQ2FjaGUpIHsNCiAgICBjb25zdCBxdWVyeUlkID0gb3BlcmF0aW9uLnNvdXJjZS5xdWVyeUlkOw0KICAgIGlmIChxdWVyeUlkICE9PSBudWxsKSB7DQogICAgICAgIGNvbnN0IHZpZXcgPSBzeW5jUG9pbnQudmlld3MuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICBhc3NlcnQodmlldyAhPSBudWxsLCAnU3luY1RyZWUgZ2F2ZSB1cyBhbiBvcCBmb3IgYW4gaW52YWxpZCBxdWVyeS4nKTsNCiAgICAgICAgcmV0dXJuIHZpZXdBcHBseU9wZXJhdGlvbih2aWV3LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBvcHRDb21wbGV0ZVNlcnZlckNhY2hlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAgICAgZm9yIChjb25zdCB2aWV3IG9mIHN5bmNQb2ludC52aWV3cy52YWx1ZXMoKSkgew0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdCh2aWV3QXBwbHlPcGVyYXRpb24odmlldywgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZSkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBldmVudHM7DQogICAgfQ0KfQ0KLyoqDQogKiBHZXQgYSB2aWV3IGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5Lg0KICoNCiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBxdWVyeSB0byByZXR1cm4gYSB2aWV3IGZvcg0KICogQHBhcmFtIHdyaXRlc0NhY2hlDQogKiBAcGFyYW0gc2VydmVyQ2FjaGUNCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZUNvbXBsZXRlDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNQb2ludEdldFZpZXcoc3luY1BvaW50LCBxdWVyeSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBzZXJ2ZXJDYWNoZUNvbXBsZXRlKSB7DQogICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgY29uc3QgdmlldyA9IHN5bmNQb2ludC52aWV3cy5nZXQocXVlcnlJZCk7DQogICAgaWYgKCF2aWV3KSB7DQogICAgICAgIC8vIFRPRE86IG1ha2Ugd3JpdGVzQ2FjaGUgdGFrZSBmbGFnIGZvciBjb21wbGV0ZSBzZXJ2ZXIgbm9kZQ0KICAgICAgICBsZXQgZXZlbnRDYWNoZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUgPyBzZXJ2ZXJDYWNoZSA6IG51bGwpOw0KICAgICAgICBsZXQgZXZlbnRDYWNoZUNvbXBsZXRlID0gZmFsc2U7DQogICAgICAgIGlmIChldmVudENhY2hlKSB7DQogICAgICAgICAgICBldmVudENhY2hlQ29tcGxldGUgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHNlcnZlckNhY2hlIGluc3RhbmNlb2YgQ2hpbGRyZW5Ob2RlKSB7DQogICAgICAgICAgICBldmVudENhY2hlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUpOw0KICAgICAgICAgICAgZXZlbnRDYWNoZUNvbXBsZXRlID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBldmVudENhY2hlID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICBldmVudENhY2hlQ29tcGxldGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB2aWV3Q2FjaGUgPSBuZXdWaWV3Q2FjaGUobmV3IENhY2hlTm9kZShldmVudENhY2hlLCBldmVudENhY2hlQ29tcGxldGUsIGZhbHNlKSwgbmV3IENhY2hlTm9kZShzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSwgZmFsc2UpKTsNCiAgICAgICAgcmV0dXJuIG5ldyBWaWV3KHF1ZXJ5LCB2aWV3Q2FjaGUpOw0KICAgIH0NCiAgICByZXR1cm4gdmlldzsNCn0NCi8qKg0KICogQWRkIGFuIGV2ZW50IGNhbGxiYWNrIGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5Lg0KICoNCiAqIEBwYXJhbSBxdWVyeQ0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uDQogKiBAcGFyYW0gd3JpdGVzQ2FjaGUNCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZSAtIENvbXBsZXRlIHNlcnZlciBjYWNoZSwgaWYgd2UgaGF2ZSBpdC4NCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZUNvbXBsZXRlDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNQb2ludEFkZEV2ZW50UmVnaXN0cmF0aW9uKHN5bmNQb2ludCwgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUpIHsNCiAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50R2V0VmlldyhzeW5jUG9pbnQsIHF1ZXJ5LCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUpOw0KICAgIGlmICghc3luY1BvaW50LnZpZXdzLmhhcyhxdWVyeS5fcXVlcnlJZGVudGlmaWVyKSkgew0KICAgICAgICBzeW5jUG9pbnQudmlld3Muc2V0KHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXIsIHZpZXcpOw0KICAgIH0NCiAgICAvLyBUaGlzIGlzIGd1YXJhbnRlZWQgdG8gZXhpc3Qgbm93LCB3ZSBqdXN0IGNyZWF0ZWQgYW55dGhpbmcgdGhhdCB3YXMgbWlzc2luZw0KICAgIHZpZXdBZGRFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbik7DQogICAgcmV0dXJuIHZpZXdHZXRJbml0aWFsRXZlbnRzKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uKTsNCn0NCi8qKg0KICogUmVtb3ZlIGV2ZW50IGNhbGxiYWNrKHMpLiAgUmV0dXJuIGNhbmNlbEV2ZW50cyBpZiBhIGNhbmNlbEVycm9yIGlzIHNwZWNpZmllZC4NCiAqDQogKiBJZiBxdWVyeSBpcyB0aGUgZGVmYXVsdCBxdWVyeSwgd2UnbGwgY2hlY2sgYWxsIHZpZXdzIGZvciB0aGUgc3BlY2lmaWVkIGV2ZW50UmVnaXN0cmF0aW9uLg0KICogSWYgZXZlbnRSZWdpc3RyYXRpb24gaXMgbnVsbCwgd2UnbGwgcmVtb3ZlIGFsbCBjYWxsYmFja3MgZm9yIHRoZSBzcGVjaWZpZWQgdmlldyhzKS4NCiAqDQogKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBJZiBudWxsLCByZW1vdmUgYWxsIGNhbGxiYWNrcy4NCiAqIEBwYXJhbSBjYW5jZWxFcnJvciAtIElmIGEgY2FuY2VsRXJyb3IgaXMgcHJvdmlkZWQsIGFwcHJvcHJpYXRlIGNhbmNlbCBldmVudHMgd2lsbCBiZSByZXR1cm5lZC4NCiAqIEByZXR1cm5zIHJlbW92ZWQgcXVlcmllcyBhbmQgYW55IGNhbmNlbCBldmVudHMNCiAqLw0KZnVuY3Rpb24gc3luY1BvaW50UmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24oc3luY1BvaW50LCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIGNhbmNlbEVycm9yKSB7DQogICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgY29uc3QgcmVtb3ZlZCA9IFtdOw0KICAgIGxldCBjYW5jZWxFdmVudHMgPSBbXTsNCiAgICBjb25zdCBoYWRDb21wbGV0ZVZpZXcgPSBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3luY1BvaW50KTsNCiAgICBpZiAocXVlcnlJZCA9PT0gJ2RlZmF1bHQnKSB7DQogICAgICAgIC8vIFdoZW4geW91IGRvIHJlZi5vZmYoLi4uKSwgd2Ugc2VhcmNoIGFsbCB2aWV3cyBmb3IgdGhlIHJlZ2lzdHJhdGlvbiB0byByZW1vdmUuDQogICAgICAgIGZvciAoY29uc3QgW3ZpZXdRdWVyeUlkLCB2aWV3XSBvZiBzeW5jUG9pbnQudmlld3MuZW50cmllcygpKSB7DQogICAgICAgICAgICBjYW5jZWxFdmVudHMgPSBjYW5jZWxFdmVudHMuY29uY2F0KHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpKTsNCiAgICAgICAgICAgIGlmICh2aWV3SXNFbXB0eSh2aWV3KSkgew0KICAgICAgICAgICAgICAgIHN5bmNQb2ludC52aWV3cy5kZWxldGUodmlld1F1ZXJ5SWQpOw0KICAgICAgICAgICAgICAgIC8vIFdlJ2xsIGRlYWwgd2l0aCBjb21wbGV0ZSB2aWV3cyBsYXRlci4NCiAgICAgICAgICAgICAgICBpZiAoIXZpZXcucXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZWQucHVzaCh2aWV3LnF1ZXJ5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIHJlbW92ZSB0aGUgY2FsbGJhY2sgZnJvbSB0aGUgc3BlY2lmaWMgdmlldy4NCiAgICAgICAgY29uc3QgdmlldyA9IHN5bmNQb2ludC52aWV3cy5nZXQocXVlcnlJZCk7DQogICAgICAgIGlmICh2aWV3KSB7DQogICAgICAgICAgICBjYW5jZWxFdmVudHMgPSBjYW5jZWxFdmVudHMuY29uY2F0KHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpKTsNCiAgICAgICAgICAgIGlmICh2aWV3SXNFbXB0eSh2aWV3KSkgew0KICAgICAgICAgICAgICAgIHN5bmNQb2ludC52aWV3cy5kZWxldGUocXVlcnlJZCk7DQogICAgICAgICAgICAgICAgLy8gV2UnbGwgZGVhbCB3aXRoIGNvbXBsZXRlIHZpZXdzIGxhdGVyLg0KICAgICAgICAgICAgICAgIGlmICghdmlldy5xdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKHZpZXcucXVlcnkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoaGFkQ29tcGxldGVWaWV3ICYmICFzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3luY1BvaW50KSkgew0KICAgICAgICAvLyBXZSByZW1vdmVkIG91ciBsYXN0IGNvbXBsZXRlIHZpZXcuDQogICAgICAgIHJlbW92ZWQucHVzaChuZXcgKHN5bmNQb2ludEdldFJlZmVyZW5jZUNvbnN0cnVjdG9yKCkpKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCkpOw0KICAgIH0NCiAgICByZXR1cm4geyByZW1vdmVkLCBldmVudHM6IGNhbmNlbEV2ZW50cyB9Ow0KfQ0KZnVuY3Rpb24gc3luY1BvaW50R2V0UXVlcnlWaWV3cyhzeW5jUG9pbnQpIHsNCiAgICBjb25zdCByZXN1bHQgPSBbXTsNCiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7DQogICAgICAgIGlmICghdmlldy5xdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkpIHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZpZXcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQp9DQovKioNCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIGRlc2lyZWQgY29tcGxldGUgc25hcHNob3QNCiAqIEByZXR1cm5zIEEgY29tcGxldGUgY2FjaGUsIGlmIGl0IGV4aXN0cw0KICovDQpmdW5jdGlvbiBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgcGF0aCkgew0KICAgIGxldCBzZXJ2ZXJDYWNoZSA9IG51bGw7DQogICAgZm9yIChjb25zdCB2aWV3IG9mIHN5bmNQb2ludC52aWV3cy52YWx1ZXMoKSkgew0KICAgICAgICBzZXJ2ZXJDYWNoZSA9IHNlcnZlckNhY2hlIHx8IHZpZXdHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHZpZXcsIHBhdGgpOw0KICAgIH0NCiAgICByZXR1cm4gc2VydmVyQ2FjaGU7DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRWaWV3Rm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgew0KICAgIGNvbnN0IHBhcmFtcyA9IHF1ZXJ5Ll9xdWVyeVBhcmFtczsNCiAgICBpZiAocGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgIHJldHVybiBzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcoc3luY1BvaW50KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IHF1ZXJ5SWQgPSBxdWVyeS5fcXVlcnlJZGVudGlmaWVyOw0KICAgICAgICByZXR1cm4gc3luY1BvaW50LnZpZXdzLmdldChxdWVyeUlkKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRWaWV3RXhpc3RzRm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgew0KICAgIHJldHVybiBzeW5jUG9pbnRWaWV3Rm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgIT0gbnVsbDsNCn0NCmZ1bmN0aW9uIHN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzeW5jUG9pbnQpIHsNCiAgICByZXR1cm4gc3luY1BvaW50R2V0Q29tcGxldGVWaWV3KHN5bmNQb2ludCkgIT0gbnVsbDsNCn0NCmZ1bmN0aW9uIHN5bmNQb2ludEdldENvbXBsZXRlVmlldyhzeW5jUG9pbnQpIHsNCiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7DQogICAgICAgIGlmICh2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHZpZXc7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgcmVmZXJlbmNlQ29uc3RydWN0b3I7DQpmdW5jdGlvbiBzeW5jVHJlZVNldFJlZmVyZW5jZUNvbnN0cnVjdG9yKHZhbCkgew0KICAgIGFzc2VydCghcmVmZXJlbmNlQ29uc3RydWN0b3IsICdfX3JlZmVyZW5jZUNvbnN0cnVjdG9yIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZCcpOw0KICAgIHJlZmVyZW5jZUNvbnN0cnVjdG9yID0gdmFsOw0KfQ0KZnVuY3Rpb24gc3luY1RyZWVHZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcigpIHsNCiAgICBhc3NlcnQocmVmZXJlbmNlQ29uc3RydWN0b3IsICdSZWZlcmVuY2UudHMgaGFzIG5vdCBiZWVuIGxvYWRlZCcpOw0KICAgIHJldHVybiByZWZlcmVuY2VDb25zdHJ1Y3RvcjsNCn0NCi8qKg0KICogU3RhdGljIHRyYWNrZXIgZm9yIG5leHQgcXVlcnkgdGFnLg0KICovDQpsZXQgc3luY1RyZWVOZXh0UXVlcnlUYWdfID0gMTsNCi8qKg0KICogU3luY1RyZWUgaXMgdGhlIGNlbnRyYWwgY2xhc3MgZm9yIG1hbmFnaW5nIGV2ZW50IGNhbGxiYWNrIHJlZ2lzdHJhdGlvbiwgZGF0YSBjYWNoaW5nLCB2aWV3cw0KICogKHF1ZXJ5IHByb2Nlc3NpbmcpLCBhbmQgZXZlbnQgZ2VuZXJhdGlvbi4gIFRoZXJlIGFyZSB0eXBpY2FsbHkgdHdvIFN5bmNUcmVlIGluc3RhbmNlcyBmb3INCiAqIGVhY2ggUmVwbywgb25lIGZvciB0aGUgbm9ybWFsIEZpcmViYXNlIGRhdGEsIGFuZCBvbmUgZm9yIHRoZSAuaW5mbyBkYXRhLg0KICoNCiAqIEl0IGhhcyBhIG51bWJlciBvZiByZXNwb25zaWJpbGl0aWVzLCBpbmNsdWRpbmc6DQogKiAgLSBUcmFja2luZyBhbGwgdXNlciBldmVudCBjYWxsYmFja3MgKHJlZ2lzdGVyZWQgdmlhIGFkZEV2ZW50UmVnaXN0cmF0aW9uKCkgYW5kIHJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKCkpLg0KICogIC0gQXBwbHlpbmcgYW5kIGNhY2hpbmcgZGF0YSBjaGFuZ2VzIGZvciB1c2VyIHNldCgpLCB0cmFuc2FjdGlvbigpLCBhbmQgdXBkYXRlKCkgY2FsbHMNCiAqICAgIChhcHBseVVzZXJPdmVyd3JpdGUoKSwgYXBwbHlVc2VyTWVyZ2UoKSkuDQogKiAgLSBBcHBseWluZyBhbmQgY2FjaGluZyBkYXRhIGNoYW5nZXMgZm9yIHNlcnZlciBkYXRhIGNoYW5nZXMgKGFwcGx5U2VydmVyT3ZlcndyaXRlKCksDQogKiAgICBhcHBseVNlcnZlck1lcmdlKCkpLg0KICogIC0gR2VuZXJhdGluZyB1c2VyLWZhY2luZyBldmVudHMgZm9yIHNlcnZlciBhbmQgdXNlciBjaGFuZ2VzIChhbGwgb2YgdGhlIGFwcGx5KiBtZXRob2RzDQogKiAgICByZXR1cm4gdGhlIHNldCBvZiBldmVudHMgdGhhdCBuZWVkIHRvIGJlIHJhaXNlZCBhcyBhIHJlc3VsdCkuDQogKiAgLSBNYWludGFpbmluZyB0aGUgYXBwcm9wcmlhdGUgc2V0IG9mIHNlcnZlciBsaXN0ZW5zIHRvIGVuc3VyZSB3ZSBhcmUgYWx3YXlzIHN1YnNjcmliZWQNCiAqICAgIHRvIHRoZSBjb3JyZWN0IHNldCBvZiBwYXRocyBhbmQgcXVlcmllcyB0byBzYXRpc2Z5IHRoZSBjdXJyZW50IHNldCBvZiB1c2VyIGV2ZW50DQogKiAgICBjYWxsYmFja3MgKGxpc3RlbnMgYXJlIHN0YXJ0ZWQvc3RvcHBlZCB1c2luZyB0aGUgcHJvdmlkZWQgbGlzdGVuUHJvdmlkZXIpLg0KICoNCiAqIE5PVEU6IEFsdGhvdWdoIFN5bmNUcmVlIHRyYWNrcyBldmVudCBjYWxsYmFja3MgYW5kIGNhbGN1bGF0ZXMgZXZlbnRzIHRvIHJhaXNlLCB0aGUgYWN0dWFsDQogKiBldmVudHMgYXJlIHJldHVybmVkIHRvIHRoZSBjYWxsZXIgcmF0aGVyIHRoYW4gcmFpc2VkIHN5bmNocm9ub3VzbHkuDQogKg0KICovDQpjbGFzcyBTeW5jVHJlZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGxpc3RlblByb3ZpZGVyXyAtIFVzZWQgYnkgU3luY1RyZWUgdG8gc3RhcnQgLyBzdG9wIGxpc3RlbmluZw0KICAgICAqICAgdG8gc2VydmVyIGRhdGEuDQogICAgICovDQogICAgY29uc3RydWN0b3IobGlzdGVuUHJvdmlkZXJfKSB7DQogICAgICAgIHRoaXMubGlzdGVuUHJvdmlkZXJfID0gbGlzdGVuUHJvdmlkZXJfOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJlZSBvZiBTeW5jUG9pbnRzLiAgVGhlcmUncyBhIFN5bmNQb2ludCBhdCBhbnkgbG9jYXRpb24gdGhhdCBoYXMgMSBvciBtb3JlIHZpZXdzLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zeW5jUG9pbnRUcmVlXyA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAvKioNCiAgICAgICAgICogQSB0cmVlIG9mIGFsbCBwZW5kaW5nIHVzZXIgd3JpdGVzICh1c2VyLWluaXRpYXRlZCBzZXQoKSdzLCB0cmFuc2FjdGlvbigpJ3MsIHVwZGF0ZSgpJ3MsIGV0Yy4pLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVUcmVlXyA9IG5ld1dyaXRlVHJlZSgpOw0KICAgICAgICB0aGlzLnRhZ1RvUXVlcnlNYXAgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMucXVlcnlUb1RhZ01hcCA9IG5ldyBNYXAoKTsNCiAgICB9DQp9DQovKioNCiAqIEFwcGx5IHRoZSBkYXRhIGNoYW5nZXMgZm9yIGEgdXNlci1nZW5lcmF0ZWQgc2V0KCkgb3IgdHJhbnNhY3Rpb24oKSBjYWxsLg0KICoNCiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIG5ld0RhdGEsIHdyaXRlSWQsIHZpc2libGUpIHsNCiAgICAvLyBSZWNvcmQgcGVuZGluZyB3cml0ZS4NCiAgICB3cml0ZVRyZWVBZGRPdmVyd3JpdGUoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHBhdGgsIG5ld0RhdGEsIHdyaXRlSWQsIHZpc2libGUpOw0KICAgIGlmICghdmlzaWJsZSkgew0KICAgICAgICByZXR1cm4gW107DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlVXNlcigpLCBwYXRoLCBuZXdEYXRhKSk7DQogICAgfQ0KfQ0KLyoqDQogKiBBY2tub3dsZWRnZSBhIHBlbmRpbmcgdXNlciB3cml0ZSB0aGF0IHdhcyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgd2l0aCBhcHBseVVzZXJPdmVyd3JpdGUoKSBvciBhcHBseVVzZXJNZXJnZSgpLg0KICoNCiAqIEBwYXJhbSByZXZlcnQgLSBUcnVlIGlmIHRoZSBnaXZlbiB3cml0ZSBmYWlsZWQgYW5kIG5lZWRzIHRvIGJlIHJldmVydGVkDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQWNrVXNlcldyaXRlKHN5bmNUcmVlLCB3cml0ZUlkLCByZXZlcnQgPSBmYWxzZSkgew0KICAgIGNvbnN0IHdyaXRlID0gd3JpdGVUcmVlR2V0V3JpdGUoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHdyaXRlSWQpOw0KICAgIGNvbnN0IG5lZWRUb1JlZXZhbHVhdGUgPSB3cml0ZVRyZWVSZW1vdmVXcml0ZShzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgd3JpdGVJZCk7DQogICAgaWYgKCFuZWVkVG9SZWV2YWx1YXRlKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBhZmZlY3RlZFRyZWUgPSBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTsNCiAgICAgICAgaWYgKHdyaXRlLnNuYXAgIT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gb3ZlcndyaXRlDQogICAgICAgICAgICBhZmZlY3RlZFRyZWUgPSBhZmZlY3RlZFRyZWUuc2V0KG5ld0VtcHR5UGF0aCgpLCB0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGVhY2god3JpdGUuY2hpbGRyZW4sIChwYXRoU3RyaW5nKSA9PiB7DQogICAgICAgICAgICAgICAgYWZmZWN0ZWRUcmVlID0gYWZmZWN0ZWRUcmVlLnNldChuZXcgUGF0aChwYXRoU3RyaW5nKSwgdHJ1ZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBBY2tVc2VyV3JpdGUod3JpdGUucGF0aCwgYWZmZWN0ZWRUcmVlLCByZXZlcnQpKTsNCiAgICB9DQp9DQovKioNCiAqIEFwcGx5IG5ldyBzZXJ2ZXIgZGF0YSBmb3IgdGhlIHNwZWNpZmllZCBwYXRoLi4NCiAqDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlTZXJ2ZXJPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIG5ld0RhdGEpIHsNCiAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyKCksIHBhdGgsIG5ld0RhdGEpKTsNCn0NCi8qKg0KICogQXBwbHkgbmV3IHNlcnZlciBkYXRhIHRvIGJlIG1lcmdlZCBpbiBhdCB0aGUgc3BlY2lmaWVkIHBhdGguDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5U2VydmVyTWVyZ2Uoc3luY1RyZWUsIHBhdGgsIGNoYW5nZWRDaGlsZHJlbikgew0KICAgIGNvbnN0IGNoYW5nZVRyZWUgPSBJbW11dGFibGVUcmVlLmZyb21PYmplY3QoY2hhbmdlZENoaWxkcmVuKTsNCiAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBNZXJnZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXIoKSwgcGF0aCwgY2hhbmdlVHJlZSkpOw0KfQ0KLyoqDQogKiBBcHBseSBhIGxpc3RlbiBjb21wbGV0ZSBmb3IgYSBxdWVyeQ0KICoNCiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseUxpc3RlbkNvbXBsZXRlKHN5bmNUcmVlLCBwYXRoKSB7DQogICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfKHN5bmNUcmVlLCBuZXcgTGlzdGVuQ29tcGxldGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyKCksIHBhdGgpKTsNCn0NCi8qKg0KICogQXBwbHkgYSBsaXN0ZW4gY29tcGxldGUgZm9yIGEgdGFnZ2VkIHF1ZXJ5DQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5VGFnZ2VkTGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHBhdGgsIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5KSB7DQogICAgICAgIGNvbnN0IHIgPSBzeW5jVHJlZVBhcnNlUXVlcnlLZXlfKHF1ZXJ5S2V5KTsNCiAgICAgICAgY29uc3QgcXVlcnlQYXRoID0gci5wYXRoLCBxdWVyeUlkID0gci5xdWVyeUlkOw0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocXVlcnlQYXRoLCBwYXRoKTsNCiAgICAgICAgY29uc3Qgb3AgPSBuZXcgTGlzdGVuQ29tcGxldGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCksIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5VGFnZ2VkT3BlcmF0aW9uXyhzeW5jVHJlZSwgcXVlcnlQYXRoLCBvcCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBXZSd2ZSBhbHJlYWR5IHJlbW92ZWQgdGhlIHF1ZXJ5LiBObyBiaWcgZGVhbCwgaWdub3JlIHRoZSB1cGRhdGUNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCi8qKg0KICogUmVtb3ZlIGV2ZW50IGNhbGxiYWNrKHMpLg0KICoNCiAqIElmIHF1ZXJ5IGlzIHRoZSBkZWZhdWx0IHF1ZXJ5LCB3ZSdsbCBjaGVjayBhbGwgcXVlcmllcyBmb3IgdGhlIHNwZWNpZmllZCBldmVudFJlZ2lzdHJhdGlvbi4NCiAqIElmIGV2ZW50UmVnaXN0cmF0aW9uIGlzIG51bGwsIHdlJ2xsIHJlbW92ZSBhbGwgY2FsbGJhY2tzIGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5L3F1ZXJpZXMuDQogKg0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uIC0gSWYgbnVsbCwgYWxsIGNhbGxiYWNrcyBhcmUgcmVtb3ZlZC4NCiAqIEBwYXJhbSBjYW5jZWxFcnJvciAtIElmIGEgY2FuY2VsRXJyb3IgaXMgcHJvdmlkZWQsIGFwcHJvcHJpYXRlIGNhbmNlbCBldmVudHMgd2lsbCBiZSByZXR1cm5lZC4NCiAqIEBwYXJhbSBza2lwTGlzdGVuZXJEZWR1cCAtIFdoZW4gcGVyZm9ybWluZyBhIGBnZXQoKWAsIHdlIGRvbid0IGFkZCBhbnkgbmV3IGxpc3RlbmVycywgc28gbm8NCiAqICBkZWR1cGluZyBuZWVkcyB0byB0YWtlIHBsYWNlLiBUaGlzIGZsYWcgYWxsb3dzIHRvZ2dsaW5nIG9mIHRoYXQgYmVoYXZpb3INCiAqIEByZXR1cm5zIENhbmNlbCBldmVudHMsIGlmIGNhbmNlbEVycm9yIHdhcyBwcm92aWRlZC4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jVHJlZSwgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvciwgc2tpcExpc3RlbmVyRGVkdXAgPSBmYWxzZSkgew0KICAgIC8vIEZpbmQgdGhlIHN5bmNQb2ludCBmaXJzdC4gVGhlbiBkZWFsIHdpdGggd2hldGhlciBvciBub3QgaXQgaGFzIG1hdGNoaW5nIGxpc3RlbmVycw0KICAgIGNvbnN0IHBhdGggPSBxdWVyeS5fcGF0aDsNCiAgICBjb25zdCBtYXliZVN5bmNQb2ludCA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmdldChwYXRoKTsNCiAgICBsZXQgY2FuY2VsRXZlbnRzID0gW107DQogICAgLy8gQSByZW1vdmFsIG9uIGEgZGVmYXVsdCBxdWVyeSBhZmZlY3RzIGFsbCBxdWVyaWVzIGF0IHRoYXQgbG9jYXRpb24uIEEgcmVtb3ZhbCBvbiBhbiBpbmRleGVkIHF1ZXJ5LCBldmVuIG9uZSB3aXRob3V0DQogICAgLy8gb3RoZXIgcXVlcnkgY29uc3RyYWludHMsIGRvZXMgKm5vdCogYWZmZWN0IGFsbCBxdWVyaWVzIGF0IHRoYXQgbG9jYXRpb24uIFNvIHRoaXMgY2hlY2sgbXVzdCBiZSBmb3IgJ2RlZmF1bHQnLCBhbmQNCiAgICAvLyBub3QgbG9hZHNBbGxEYXRhKCkuDQogICAgaWYgKG1heWJlU3luY1BvaW50ICYmDQogICAgICAgIChxdWVyeS5fcXVlcnlJZGVudGlmaWVyID09PSAnZGVmYXVsdCcgfHwNCiAgICAgICAgICAgIHN5bmNQb2ludFZpZXdFeGlzdHNGb3JRdWVyeShtYXliZVN5bmNQb2ludCwgcXVlcnkpKSkgew0KICAgICAgICBjb25zdCByZW1vdmVkQW5kRXZlbnRzID0gc3luY1BvaW50UmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24obWF5YmVTeW5jUG9pbnQsIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpOw0KICAgICAgICBpZiAoc3luY1BvaW50SXNFbXB0eShtYXliZVN5bmNQb2ludCkpIHsNCiAgICAgICAgICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8ucmVtb3ZlKHBhdGgpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHJlbW92ZWQgPSByZW1vdmVkQW5kRXZlbnRzLnJlbW92ZWQ7DQogICAgICAgIGNhbmNlbEV2ZW50cyA9IHJlbW92ZWRBbmRFdmVudHMuZXZlbnRzOw0KICAgICAgICBpZiAoIXNraXBMaXN0ZW5lckRlZHVwKSB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFdlIG1heSBoYXZlIGp1c3QgcmVtb3ZlZCBvbmUgb2YgbWFueSBsaXN0ZW5lcnMgYW5kIGNhbiBzaG9ydC1jaXJjdWl0IHRoaXMgd2hvbGUgcHJvY2Vzcw0KICAgICAgICAgICAgICogV2UgbWF5IGFsc28gbm90IGhhdmUgcmVtb3ZlZCBhIGRlZmF1bHQgbGlzdGVuZXIsIGluIHdoaWNoIGNhc2UgYWxsIG9mIHRoZSBkZXNjZW5kYW50IGxpc3RlbmVycyBzaG91bGQgYWxyZWFkeSBiZQ0KICAgICAgICAgICAgICogcHJvcGVybHkgc2V0IHVwLg0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAvLyBTaW5jZSBpbmRleGVkIHF1ZXJpZXMgY2FuIHNoYWRvdyBpZiB0aGV5IGRvbid0IGhhdmUgb3RoZXIgcXVlcnkgY29uc3RyYWludHMsIGNoZWNrIGZvciBsb2Fkc0FsbERhdGEoKSwgaW5zdGVhZCBvZg0KICAgICAgICAgICAgLy8gcXVlcnlJZCA9PT0gJ2RlZmF1bHQnDQogICAgICAgICAgICBjb25zdCByZW1vdmluZ0RlZmF1bHQgPSAtMSAhPT0NCiAgICAgICAgICAgICAgICByZW1vdmVkLmZpbmRJbmRleChxdWVyeSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb25zdCBjb3ZlcmVkID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZmluZE9uUGF0aChwYXRoLCAocmVsYXRpdmVQYXRoLCBwYXJlbnRTeW5jUG9pbnQpID0+IHN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhwYXJlbnRTeW5jUG9pbnQpKTsNCiAgICAgICAgICAgIGlmIChyZW1vdmluZ0RlZmF1bHQgJiYgIWNvdmVyZWQpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdWJ0cmVlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc3VidHJlZShwYXRoKTsNCiAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgcG90ZW50aWFsbHkgY2hpbGQgbGlzdGVuZXJzLiBEZXRlcm1pbmUgd2hhdCBpZiBhbnkgbGlzdGVucyB3ZSBuZWVkIHRvIHNlbmQgYmVmb3JlIGV4ZWN1dGluZyB0aGUNCiAgICAgICAgICAgICAgICAvLyByZW1vdmFsDQogICAgICAgICAgICAgICAgaWYgKCFzdWJ0cmVlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGZvbGQgb3ZlciBvdXIgc3VidHJlZSBhbmQgY29sbGVjdCB0aGUgbGlzdGVuZXJzIHRvIHNlbmQNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Vmlld3MgPSBzeW5jVHJlZUNvbGxlY3REaXN0aW5jdFZpZXdzRm9yU3ViVHJlZV8oc3VidHJlZSk7DQogICAgICAgICAgICAgICAgICAgIC8vIE9rLCB3ZSd2ZSBjb2xsZWN0ZWQgYWxsIHRoZSBsaXN0ZW5zIHdlIG5lZWQuIFNldCB0aGVtIHVwLg0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld1ZpZXdzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3Vmlld3NbaV0sIG5ld1F1ZXJ5ID0gdmlldy5xdWVyeTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVyID0gc3luY1RyZWVDcmVhdGVMaXN0ZW5lckZvclZpZXdfKHN5bmNUcmVlLCB2aWV3KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdGFydExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhuZXdRdWVyeSksIHN5bmNUcmVlVGFnRm9yUXVlcnkoc3luY1RyZWUsIG5ld1F1ZXJ5KSwgbGlzdGVuZXIuaGFzaEZuLCBsaXN0ZW5lci5vbkNvbXBsZXRlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgdGhlcmUncyBub3RoaW5nIGJlbG93IHVzLCBzbyBub3RoaW5nIHdlIG5lZWQgdG8gc3RhcnQgbGlzdGVuaW5nIG9uDQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBJZiB3ZSByZW1vdmVkIGFueXRoaW5nIGFuZCB3ZSdyZSBub3QgY292ZXJlZCBieSBhIGhpZ2hlciB1cCBsaXN0ZW4sIHdlIG5lZWQgdG8gc3RvcCBsaXN0ZW5pbmcgb24gdGhpcyBxdWVyeQ0KICAgICAgICAgICAgLy8gVGhlIGFib3ZlIGJsb2NrIGhhcyB1cyBjb3ZlcmVkIGluIHRlcm1zIG9mIG1ha2luZyBzdXJlIHdlJ3JlIHNldCB1cCBvbiBsaXN0ZW5zIGxvd2VyIGluIHRoZSB0cmVlLg0KICAgICAgICAgICAgLy8gQWxzbywgbm90ZSB0aGF0IGlmIHdlIGhhdmUgYSBjYW5jZWxFcnJvciwgaXQncyBhbHJlYWR5IGJlZW4gcmVtb3ZlZCBhdCB0aGUgcHJvdmlkZXIgbGV2ZWwuDQogICAgICAgICAgICBpZiAoIWNvdmVyZWQgJiYgcmVtb3ZlZC5sZW5ndGggPiAwICYmICFjYW5jZWxFcnJvcikgew0KICAgICAgICAgICAgICAgIC8vIElmIHdlIHJlbW92ZWQgYSBkZWZhdWx0LCB0aGVuIHdlIHdlcmVuJ3QgbGlzdGVuaW5nIG9uIGFueSBvZiB0aGUgb3RoZXIgcXVlcmllcyBoZXJlLiBKdXN0IGNhbmNlbCB0aGUgb25lDQogICAgICAgICAgICAgICAgLy8gZGVmYXVsdC4gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIGl0ZXJhdGUgdGhyb3VnaCBhbmQgY2FuY2VsIGVhY2ggaW5kaXZpZHVhbCBxdWVyeQ0KICAgICAgICAgICAgICAgIGlmIChyZW1vdmluZ0RlZmF1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdGFnIGRlZmF1bHQgbGlzdGVuZXJzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRUYWcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBzeW5jVHJlZS5saXN0ZW5Qcm92aWRlcl8uc3RvcExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeSksIGRlZmF1bHRUYWcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5mb3JFYWNoKChxdWVyeVRvUmVtb3ZlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdUb1JlbW92ZSA9IHN5bmNUcmVlLnF1ZXJ5VG9UYWdNYXAuZ2V0KHN5bmNUcmVlTWFrZVF1ZXJ5S2V5XyhxdWVyeVRvUmVtb3ZlKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzeW5jVHJlZS5saXN0ZW5Qcm92aWRlcl8uc3RvcExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeVRvUmVtb3ZlKSwgdGFnVG9SZW1vdmUpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gTm93LCBjbGVhciBhbGwgb2YgdGhlIHRhZ3Mgd2UncmUgdHJhY2tpbmcgZm9yIHRoZSByZW1vdmVkIGxpc3RlbnMNCiAgICAgICAgc3luY1RyZWVSZW1vdmVUYWdzXyhzeW5jVHJlZSwgcmVtb3ZlZCk7DQogICAgfQ0KICAgIHJldHVybiBjYW5jZWxFdmVudHM7DQp9DQovKioNCiAqIEFwcGx5IG5ldyBzZXJ2ZXIgZGF0YSBmb3IgdGhlIHNwZWNpZmllZCB0YWdnZWQgcXVlcnkuDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5VGFnZ2VkUXVlcnlPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIHNuYXAsIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5ICE9IG51bGwpIHsNCiAgICAgICAgY29uc3QgciA9IHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpOw0KICAgICAgICBjb25zdCBxdWVyeVBhdGggPSByLnBhdGgsIHF1ZXJ5SWQgPSByLnF1ZXJ5SWQ7DQogICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChxdWVyeVBhdGgsIHBhdGgpOw0KICAgICAgICBjb25zdCBvcCA9IG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCksIHJlbGF0aXZlUGF0aCwgc25hcCk7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5VGFnZ2VkT3BlcmF0aW9uXyhzeW5jVHJlZSwgcXVlcnlQYXRoLCBvcCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBRdWVyeSBtdXN0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCi8qKg0KICogQXBwbHkgc2VydmVyIGRhdGEgdG8gYmUgbWVyZ2VkIGluIGZvciB0aGUgc3BlY2lmaWVkIHRhZ2dlZCBxdWVyeS4NCiAqDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRRdWVyeU1lcmdlKHN5bmNUcmVlLCBwYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5KSB7DQogICAgICAgIGNvbnN0IHIgPSBzeW5jVHJlZVBhcnNlUXVlcnlLZXlfKHF1ZXJ5S2V5KTsNCiAgICAgICAgY29uc3QgcXVlcnlQYXRoID0gci5wYXRoLCBxdWVyeUlkID0gci5xdWVyeUlkOw0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocXVlcnlQYXRoLCBwYXRoKTsNCiAgICAgICAgY29uc3QgY2hhbmdlVHJlZSA9IEltbXV0YWJsZVRyZWUuZnJvbU9iamVjdChjaGFuZ2VkQ2hpbGRyZW4pOw0KICAgICAgICBjb25zdCBvcCA9IG5ldyBNZXJnZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXJUYWdnZWRRdWVyeShxdWVyeUlkKSwgcmVsYXRpdmVQYXRoLCBjaGFuZ2VUcmVlKTsNCiAgICAgICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFdlJ3ZlIGFscmVhZHkgcmVtb3ZlZCB0aGUgcXVlcnkuIE5vIGJpZyBkZWFsLCBpZ25vcmUgdGhlIHVwZGF0ZQ0KICAgICAgICByZXR1cm4gW107DQogICAgfQ0KfQ0KLyoqDQogKiBBZGQgYW4gZXZlbnQgY2FsbGJhY2sgZm9yIHRoZSBzcGVjaWZpZWQgcXVlcnkuDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFkZEV2ZW50UmVnaXN0cmF0aW9uKHN5bmNUcmVlLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIHNraXBTZXR1cExpc3RlbmVyID0gZmFsc2UpIHsNCiAgICBjb25zdCBwYXRoID0gcXVlcnkuX3BhdGg7DQogICAgbGV0IHNlcnZlckNhY2hlID0gbnVsbDsNCiAgICBsZXQgZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ID0gZmFsc2U7DQogICAgLy8gQW55IGNvdmVyaW5nIHdyaXRlcyB3aWxsIG5lY2Vzc2FyaWx5IGJlIGF0IHRoZSByb290LCBzbyByZWFsbHkgYWxsIHdlIG5lZWQgdG8gZmluZCBpcyB0aGUgc2VydmVyIGNhY2hlLg0KICAgIC8vIENvbnNpZGVyIG9wdGltaXppbmcgdGhpcyBvbmNlIHRoZXJlJ3MgYSBiZXR0ZXIgdW5kZXJzdGFuZGluZyBvZiB3aGF0IGFjdHVhbCBiZWhhdmlvciB3aWxsIGJlLg0KICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmZvcmVhY2hPblBhdGgocGF0aCwgKHBhdGhUb1N5bmNQb2ludCwgc3ApID0+IHsNCiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGhUb1N5bmNQb2ludCwgcGF0aCk7DQogICAgICAgIHNlcnZlckNhY2hlID0NCiAgICAgICAgICAgIHNlcnZlckNhY2hlIHx8IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3AsIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyA9DQogICAgICAgICAgICBmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgfHwgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHNwKTsNCiAgICB9KTsNCiAgICBsZXQgc3luY1BvaW50ID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZ2V0KHBhdGgpOw0KICAgIGlmICghc3luY1BvaW50KSB7DQogICAgICAgIHN5bmNQb2ludCA9IG5ldyBTeW5jUG9pbnQoKTsNCiAgICAgICAgc3luY1RyZWUuc3luY1BvaW50VHJlZV8gPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zZXQocGF0aCwgc3luY1BvaW50KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyA9DQogICAgICAgICAgICBmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgfHwgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHN5bmNQb2ludCk7DQogICAgICAgIHNlcnZlckNhY2hlID0NCiAgICAgICAgICAgIHNlcnZlckNhY2hlIHx8IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgfQ0KICAgIGxldCBzZXJ2ZXJDYWNoZUNvbXBsZXRlOw0KICAgIGlmIChzZXJ2ZXJDYWNoZSAhPSBudWxsKSB7DQogICAgICAgIHNlcnZlckNhY2hlQ29tcGxldGUgPSB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgc2VydmVyQ2FjaGVDb21wbGV0ZSA9IGZhbHNlOw0KICAgICAgICBzZXJ2ZXJDYWNoZSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICBjb25zdCBzdWJ0cmVlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc3VidHJlZShwYXRoKTsNCiAgICAgICAgc3VidHJlZS5mb3JlYWNoQ2hpbGQoKGNoaWxkTmFtZSwgY2hpbGRTeW5jUG9pbnQpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKGNoaWxkU3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgICAgICBpZiAoY29tcGxldGVDYWNoZSkgew0KICAgICAgICAgICAgICAgIHNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBjb21wbGV0ZUNhY2hlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNvbnN0IHZpZXdBbHJlYWR5RXhpc3RzID0gc3luY1BvaW50Vmlld0V4aXN0c0ZvclF1ZXJ5KHN5bmNQb2ludCwgcXVlcnkpOw0KICAgIGlmICghdmlld0FscmVhZHlFeGlzdHMgJiYgIXF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICAvLyBXZSBuZWVkIHRvIHRyYWNrIGEgdGFnIGZvciB0aGlzIHF1ZXJ5DQogICAgICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KTsNCiAgICAgICAgYXNzZXJ0KCFzeW5jVHJlZS5xdWVyeVRvVGFnTWFwLmhhcyhxdWVyeUtleSksICdWaWV3IGRvZXMgbm90IGV4aXN0LCBidXQgd2UgaGF2ZSBhIHRhZycpOw0KICAgICAgICBjb25zdCB0YWcgPSBzeW5jVHJlZUdldE5leHRRdWVyeVRhZ18oKTsNCiAgICAgICAgc3luY1RyZWUucXVlcnlUb1RhZ01hcC5zZXQocXVlcnlLZXksIHRhZyk7DQogICAgICAgIHN5bmNUcmVlLnRhZ1RvUXVlcnlNYXAuc2V0KHRhZywgcXVlcnlLZXkpOw0KICAgIH0NCiAgICBjb25zdCB3cml0ZXNDYWNoZSA9IHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBwYXRoKTsNCiAgICBsZXQgZXZlbnRzID0gc3luY1BvaW50QWRkRXZlbnRSZWdpc3RyYXRpb24oc3luY1BvaW50LCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSk7DQogICAgaWYgKCF2aWV3QWxyZWFkeUV4aXN0cyAmJiAhZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ICYmICFza2lwU2V0dXBMaXN0ZW5lcikgew0KICAgICAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50Vmlld0ZvclF1ZXJ5KHN5bmNQb2ludCwgcXVlcnkpOw0KICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlU2V0dXBMaXN0ZW5lcl8oc3luY1RyZWUsIHF1ZXJ5LCB2aWV3KSk7DQogICAgfQ0KICAgIHJldHVybiBldmVudHM7DQp9DQovKioNCiAqIFJldHVybnMgYSBjb21wbGV0ZSBjYWNoZSwgaWYgd2UgaGF2ZSBvbmUsIG9mIHRoZSBkYXRhIGF0IGEgcGFydGljdWxhciBwYXRoLiBJZiB0aGUgbG9jYXRpb24gZG9lcyBub3QgaGF2ZSBhDQogKiBsaXN0ZW5lciBhYm92ZSBpdCwgd2Ugd2lsbCBnZXQgYSBmYWxzZSAibnVsbCIuIFRoaXMgc2hvdWxkbid0IGJlIGEgcHJvYmxlbSBiZWNhdXNlIHRyYW5zYWN0aW9ucyB3aWxsIGFsd2F5cw0KICogaGF2ZSBhIGxpc3RlbmVyIGFib3ZlLCBhbmQgYXRvbWljIG9wZXJhdGlvbnMgd291bGQgY29ycmVjdGx5IHNob3cgYSBqaXR0ZXIgb2YgPGluY3JlbWVudCB2YWx1ZT4gLT4NCiAqICAgICA8aW5jcmVtZW50ZWQgdG90YWw+IGFzIHRoZSB3cml0ZSBpcyBhcHBsaWVkIGxvY2FsbHkgYW5kIHRoZW4gYWNrbm93bGVkZ2VkIGF0IHRoZSBzZXJ2ZXIuDQogKg0KICogTm90ZTogdGhpcyBtZXRob2Qgd2lsbCAqaW5jbHVkZSogaGlkZGVuIHdyaXRlcyBmcm9tIHRyYW5zYWN0aW9uIHdpdGggYXBwbHlMb2NhbGx5IHNldCB0byBmYWxzZS4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIHRoZSBkYXRhIHdlIHdhbnQNCiAqIEBwYXJhbSB3cml0ZUlkc1RvRXhjbHVkZSAtIEEgc3BlY2lmaWMgc2V0IHRvIGJlIGV4Y2x1ZGVkDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZShzeW5jVHJlZSwgcGF0aCwgd3JpdGVJZHNUb0V4Y2x1ZGUpIHsNCiAgICBjb25zdCBpbmNsdWRlSGlkZGVuU2V0cyA9IHRydWU7DQogICAgY29uc3Qgd3JpdGVUcmVlID0gc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV87DQogICAgY29uc3Qgc2VydmVyQ2FjaGUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5maW5kT25QYXRoKHBhdGgsIChwYXRoU29GYXIsIHN5bmNQb2ludCkgPT4gew0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocGF0aFNvRmFyLCBwYXRoKTsNCiAgICAgICAgY29uc3Qgc2VydmVyQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgcmVsYXRpdmVQYXRoKTsNCiAgICAgICAgaWYgKHNlcnZlckNhY2hlKSB7DQogICAgICAgICAgICByZXR1cm4gc2VydmVyQ2FjaGU7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZSh3cml0ZVRyZWUsIHBhdGgsIHNlcnZlckNhY2hlLCB3cml0ZUlkc1RvRXhjbHVkZSwgaW5jbHVkZUhpZGRlblNldHMpOw0KfQ0KLyoqDQogKiBBIGhlbHBlciBtZXRob2QgdGhhdCB2aXNpdHMgYWxsIGRlc2NlbmRhbnQgYW5kIGFuY2VzdG9yIFN5bmNQb2ludHMsIGFwcGx5aW5nIHRoZSBvcGVyYXRpb24uDQogKg0KICogTk9URVM6DQogKiAtIERlc2NlbmRhbnQgU3luY1BvaW50cyB3aWxsIGJlIHZpc2l0ZWQgZmlyc3QgKHNpbmNlIHdlIHJhaXNlIGV2ZW50cyBkZXB0aC1maXJzdCkuDQogKg0KICogLSBXZSBjYWxsIGFwcGx5T3BlcmF0aW9uKCkgb24gZWFjaCBTeW5jUG9pbnQgcGFzc2luZyB0aHJlZSB0aGluZ3M6DQogKiAgIDEuIEEgdmVyc2lvbiBvZiB0aGUgT3BlcmF0aW9uIHRoYXQgaGFzIGJlZW4gbWFkZSByZWxhdGl2ZSB0byB0aGUgU3luY1BvaW50IGxvY2F0aW9uLg0KICogICAyLiBBIFdyaXRlVHJlZVJlZiBvZiBhbnkgd3JpdGVzIHdlIGhhdmUgY2FjaGVkIGF0IHRoZSBTeW5jUG9pbnQgbG9jYXRpb24uDQogKiAgIDMuIEEgc25hcHNob3QgTm9kZSB3aXRoIGNhY2hlZCBzZXJ2ZXIgZGF0YSwgaWYgd2UgaGF2ZSBpdC4NCiAqDQogKiAtIFdlIGNvbmNhdGVuYXRlIGFsbCBvZiB0aGUgZXZlbnRzIHJldHVybmVkIGJ5IGVhY2ggU3luY1BvaW50IGFuZCByZXR1cm4gdGhlIHJlc3VsdC4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG9wZXJhdGlvbikgew0KICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uSGVscGVyXyhvcGVyYXRpb24sIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLCANCiAgICAvKnNlcnZlckNhY2hlPSovIG51bGwsIHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBuZXdFbXB0eVBhdGgoKSkpOw0KfQ0KLyoqDQogKiBSZWN1cnNpdmUgaGVscGVyIGZvciBhcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvbkhlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHsNCiAgICBpZiAocGF0aElzRW1wdHkob3BlcmF0aW9uLnBhdGgpKSB7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKG9wZXJhdGlvbiwgc3luY1BvaW50VHJlZSwgc2VydmVyQ2FjaGUsIHdyaXRlc0NhY2hlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IHN5bmNQb2ludCA9IHN5bmNQb2ludFRyZWUuZ2V0KG5ld0VtcHR5UGF0aCgpKTsNCiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuDQogICAgICAgIGlmIChzZXJ2ZXJDYWNoZSA9PSBudWxsICYmIHN5bmNQb2ludCAhPSBudWxsKSB7DQogICAgICAgICAgICBzZXJ2ZXJDYWNoZSA9IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgIH0NCiAgICAgICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgICAgICBjb25zdCBjaGlsZE5hbWUgPSBwYXRoR2V0RnJvbnQob3BlcmF0aW9uLnBhdGgpOw0KICAgICAgICBjb25zdCBjaGlsZE9wZXJhdGlvbiA9IG9wZXJhdGlvbi5vcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpOw0KICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSBzeW5jUG9pbnRUcmVlLmNoaWxkcmVuLmdldChjaGlsZE5hbWUpOw0KICAgICAgICBpZiAoY2hpbGRUcmVlICYmIGNoaWxkT3BlcmF0aW9uKSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICA/IHNlcnZlckNhY2hlLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkNCiAgICAgICAgICAgICAgICA6IG51bGw7DQogICAgICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7DQogICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQXBwbHlPcGVyYXRpb25IZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3luY1BvaW50KSB7DQogICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNQb2ludEFwcGx5T3BlcmF0aW9uKHN5bmNQb2ludCwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZXZlbnRzOw0KICAgIH0NCn0NCi8qKg0KICogUmVjdXJzaXZlIGhlbHBlciBmb3IgYXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25EZXNjZW5kYW50c0hlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHsNCiAgICBjb25zdCBzeW5jUG9pbnQgPSBzeW5jUG9pbnRUcmVlLmdldChuZXdFbXB0eVBhdGgoKSk7DQogICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuDQogICAgaWYgKHNlcnZlckNhY2hlID09IG51bGwgJiYgc3luY1BvaW50ICE9IG51bGwpIHsNCiAgICAgICAgc2VydmVyQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgbmV3RW1wdHlQYXRoKCkpOw0KICAgIH0NCiAgICBsZXQgZXZlbnRzID0gW107DQogICAgc3luY1BvaW50VHJlZS5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZE5hbWUsIGNoaWxkVHJlZSkgPT4gew0KICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgID8gc2VydmVyQ2FjaGUuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKQ0KICAgICAgICAgICAgOiBudWxsOw0KICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7DQogICAgICAgIGNvbnN0IGNoaWxkT3BlcmF0aW9uID0gb3BlcmF0aW9uLm9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSk7DQogICAgICAgIGlmIChjaGlsZE9wZXJhdGlvbikgew0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIGlmIChzeW5jUG9pbnQpIHsNCiAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jUG9pbnRBcHBseU9wZXJhdGlvbihzeW5jUG9pbnQsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlKSk7DQogICAgfQ0KICAgIHJldHVybiBldmVudHM7DQp9DQpmdW5jdGlvbiBzeW5jVHJlZUNyZWF0ZUxpc3RlbmVyRm9yVmlld18oc3luY1RyZWUsIHZpZXcpIHsNCiAgICBjb25zdCBxdWVyeSA9IHZpZXcucXVlcnk7DQogICAgY29uc3QgdGFnID0gc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnkpOw0KICAgIHJldHVybiB7DQogICAgICAgIGhhc2hGbjogKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB2aWV3R2V0U2VydmVyQ2FjaGUodmlldykgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICByZXR1cm4gY2FjaGUuaGFzaCgpOw0KICAgICAgICB9LA0KICAgICAgICBvbkNvbXBsZXRlOiAoc3RhdHVzKSA9PiB7DQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7DQogICAgICAgICAgICAgICAgaWYgKHRhZykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseVRhZ2dlZExpc3RlbkNvbXBsZXRlKHN5bmNUcmVlLCBxdWVyeS5fcGF0aCwgdGFnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5TGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHF1ZXJ5Ll9wYXRoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBJZiBhIGxpc3RlbiBmYWlsZWQsIGtpbGwgYWxsIG9mIHRoZSBsaXN0ZW5lcnMgaGVyZSwgbm90IGp1c3QgdGhlIG9uZSB0aGF0IHRyaWdnZXJlZCB0aGUgZXJyb3IuDQogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgbWF5IG5lZWQgdG8gYmUgc2NvcGVkIHRvIGp1c3QgdGhpcyBsaXN0ZW5lciBpZiB3ZSBjaGFuZ2UgcGVybWlzc2lvbnMgb24gZmlsdGVyZWQgY2hpbGRyZW4NCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IGVycm9yRm9yU2VydmVyQ29kZShzdGF0dXMsIHF1ZXJ5KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jVHJlZSwgcXVlcnksIA0KICAgICAgICAgICAgICAgIC8qZXZlbnRSZWdpc3RyYXRpb24qLyBudWxsLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KfQ0KLyoqDQogKiBSZXR1cm4gdGhlIHRhZyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHF1ZXJ5Lg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZVRhZ0ZvclF1ZXJ5KHN5bmNUcmVlLCBxdWVyeSkgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KTsNCiAgICByZXR1cm4gc3luY1RyZWUucXVlcnlUb1RhZ01hcC5nZXQocXVlcnlLZXkpOw0KfQ0KLyoqDQogKiBHaXZlbiBhIHF1ZXJ5LCBjb21wdXRlcyBhICJxdWVyeUtleSIgc3VpdGFibGUgZm9yIHVzZSBpbiBvdXIgcXVlcnlUb1RhZ01hcF8uDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlTWFrZVF1ZXJ5S2V5XyhxdWVyeSkgew0KICAgIHJldHVybiBxdWVyeS5fcGF0aC50b1N0cmluZygpICsgJyQnICsgcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjsNCn0NCi8qKg0KICogUmV0dXJuIHRoZSBxdWVyeSBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHRhZywgaWYgd2UgaGF2ZSBvbmUNCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZykgew0KICAgIHJldHVybiBzeW5jVHJlZS50YWdUb1F1ZXJ5TWFwLmdldCh0YWcpOw0KfQ0KLyoqDQogKiBHaXZlbiBhIHF1ZXJ5S2V5IChjcmVhdGVkIGJ5IG1ha2VRdWVyeUtleSksIHBhcnNlIGl0IGJhY2sgaW50byBhIHBhdGggYW5kIHF1ZXJ5SWQuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpIHsNCiAgICBjb25zdCBzcGxpdEluZGV4ID0gcXVlcnlLZXkuaW5kZXhPZignJCcpOw0KICAgIGFzc2VydChzcGxpdEluZGV4ICE9PSAtMSAmJiBzcGxpdEluZGV4IDwgcXVlcnlLZXkubGVuZ3RoIC0gMSwgJ0JhZCBxdWVyeUtleS4nKTsNCiAgICByZXR1cm4gew0KICAgICAgICBxdWVyeUlkOiBxdWVyeUtleS5zdWJzdHIoc3BsaXRJbmRleCArIDEpLA0KICAgICAgICBwYXRoOiBuZXcgUGF0aChxdWVyeUtleS5zdWJzdHIoMCwgc3BsaXRJbmRleCkpDQogICAgfTsNCn0NCi8qKg0KICogQSBoZWxwZXIgbWV0aG9kIHRvIGFwcGx5IHRhZ2dlZCBvcGVyYXRpb25zDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wZXJhdGlvbikgew0KICAgIGNvbnN0IHN5bmNQb2ludCA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmdldChxdWVyeVBhdGgpOw0KICAgIGFzc2VydChzeW5jUG9pbnQsICJNaXNzaW5nIHN5bmMgcG9pbnQgZm9yIHF1ZXJ5IHRhZyB0aGF0IHdlJ3JlIHRyYWNraW5nIik7DQogICAgY29uc3Qgd3JpdGVzQ2FjaGUgPSB3cml0ZVRyZWVDaGlsZFdyaXRlcyhzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgcXVlcnlQYXRoKTsNCiAgICByZXR1cm4gc3luY1BvaW50QXBwbHlPcGVyYXRpb24oc3luY1BvaW50LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBudWxsKTsNCn0NCi8qKg0KICogVGhpcyBjb2xsYXBzZXMgbXVsdGlwbGUgdW5maWx0ZXJlZCB2aWV3cyBpbnRvIGEgc2luZ2xlIHZpZXcsIHNpbmNlIHdlIG9ubHkgbmVlZCBhIHNpbmdsZQ0KICogbGlzdGVuZXIgZm9yIHRoZW0uDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQ29sbGVjdERpc3RpbmN0Vmlld3NGb3JTdWJUcmVlXyhzdWJ0cmVlKSB7DQogICAgcmV0dXJuIHN1YnRyZWUuZm9sZCgocmVsYXRpdmVQYXRoLCBtYXliZUNoaWxkU3luY1BvaW50LCBjaGlsZE1hcCkgPT4gew0KICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCAmJiBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlVmlldyA9IHN5bmNQb2ludEdldENvbXBsZXRlVmlldyhtYXliZUNoaWxkU3luY1BvaW50KTsNCiAgICAgICAgICAgIHJldHVybiBbY29tcGxldGVWaWV3XTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIE5vIGNvbXBsZXRlIHZpZXcgaGVyZSwgZmxhdHRlbiBhbnkgZGVlcGVyIGxpc3RlbnMgaW50byBhbiBhcnJheQ0KICAgICAgICAgICAgbGV0IHZpZXdzID0gW107DQogICAgICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCkgew0KICAgICAgICAgICAgICAgIHZpZXdzID0gc3luY1BvaW50R2V0UXVlcnlWaWV3cyhtYXliZUNoaWxkU3luY1BvaW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVhY2goY2hpbGRNYXAsIChfa2V5LCBjaGlsZFZpZXdzKSA9PiB7DQogICAgICAgICAgICAgICAgdmlld3MgPSB2aWV3cy5jb25jYXQoY2hpbGRWaWV3cyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiB2aWV3czsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KLyoqDQogKiBOb3JtYWxpemVzIGEgcXVlcnkgdG8gYSBxdWVyeSB3ZSBzZW5kIHRoZSBzZXJ2ZXIgZm9yIGxpc3RlbmluZw0KICoNCiAqIEByZXR1cm5zIFRoZSBub3JtYWxpemVkIHF1ZXJ5DQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5KSB7DQogICAgaWYgKHF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSAmJiAhcXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpKSB7DQogICAgICAgIC8vIFdlIHRyZWF0IHF1ZXJpZXMgdGhhdCBsb2FkIGFsbCBkYXRhIGFzIGRlZmF1bHQgcXVlcmllcw0KICAgICAgICAvLyBDYXN0IGlzIG5lY2Vzc2FyeSBiZWNhdXNlIHJlZigpIHRlY2huaWNhbGx5IHJldHVybnMgRmlyZWJhc2Ugd2hpY2ggaXMgYWN0dWFsbHkgZmIuYXBpLkZpcmViYXNlIHdoaWNoIGluaGVyaXRzDQogICAgICAgIC8vIGZyb20gUXVlcnkNCiAgICAgICAgcmV0dXJuIG5ldyAoc3luY1RyZWVHZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcigpKShxdWVyeS5fcmVwbywgcXVlcnkuX3BhdGgpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHF1ZXJ5Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIHN5bmNUcmVlUmVtb3ZlVGFnc18oc3luY1RyZWUsIHF1ZXJpZXMpIHsNCiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHF1ZXJpZXMubGVuZ3RoOyArK2opIHsNCiAgICAgICAgY29uc3QgcmVtb3ZlZFF1ZXJ5ID0gcXVlcmllc1tqXTsNCiAgICAgICAgaWYgKCFyZW1vdmVkUXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgICAgICAvLyBXZSBzaG91bGQgaGF2ZSBhIHRhZyBmb3IgdGhpcw0KICAgICAgICAgICAgY29uc3QgcmVtb3ZlZFF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHJlbW92ZWRRdWVyeSk7DQogICAgICAgICAgICBjb25zdCByZW1vdmVkUXVlcnlUYWcgPSBzeW5jVHJlZS5xdWVyeVRvVGFnTWFwLmdldChyZW1vdmVkUXVlcnlLZXkpOw0KICAgICAgICAgICAgc3luY1RyZWUucXVlcnlUb1RhZ01hcC5kZWxldGUocmVtb3ZlZFF1ZXJ5S2V5KTsNCiAgICAgICAgICAgIHN5bmNUcmVlLnRhZ1RvUXVlcnlNYXAuZGVsZXRlKHJlbW92ZWRRdWVyeVRhZyk7DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFN0YXRpYyBhY2Nlc3NvciBmb3IgcXVlcnkgdGFncy4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVHZXROZXh0UXVlcnlUYWdfKCkgew0KICAgIHJldHVybiBzeW5jVHJlZU5leHRRdWVyeVRhZ18rKzsNCn0NCi8qKg0KICogRm9yIGEgZ2l2ZW4gbmV3IGxpc3RlbiwgbWFuYWdlIHRoZSBkZS1kdXBsaWNhdGlvbiBvZiBvdXRzdGFuZGluZyBzdWJzY3JpcHRpb25zLg0KICoNCiAqIEByZXR1cm5zIFRoaXMgbWV0aG9kIGNhbiByZXR1cm4gZXZlbnRzIHRvIHN1cHBvcnQgc3luY2hyb25vdXMgZGF0YSBzb3VyY2VzDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlU2V0dXBMaXN0ZW5lcl8oc3luY1RyZWUsIHF1ZXJ5LCB2aWV3KSB7DQogICAgY29uc3QgcGF0aCA9IHF1ZXJ5Ll9wYXRoOw0KICAgIGNvbnN0IHRhZyA9IHN5bmNUcmVlVGFnRm9yUXVlcnkoc3luY1RyZWUsIHF1ZXJ5KTsNCiAgICBjb25zdCBsaXN0ZW5lciA9IHN5bmNUcmVlQ3JlYXRlTGlzdGVuZXJGb3JWaWV3XyhzeW5jVHJlZSwgdmlldyk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWUubGlzdGVuUHJvdmlkZXJfLnN0YXJ0TGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5KSwgdGFnLCBsaXN0ZW5lci5oYXNoRm4sIGxpc3RlbmVyLm9uQ29tcGxldGUpOw0KICAgIGNvbnN0IHN1YnRyZWUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zdWJ0cmVlKHBhdGgpOw0KICAgIC8vIFRoZSByb290IG9mIHRoaXMgc3VidHJlZSBoYXMgb3VyIHF1ZXJ5LiBXZSdyZSBoZXJlIGJlY2F1c2Ugd2UgZGVmaW5pdGVseSBuZWVkIHRvIHNlbmQgYSBsaXN0ZW4gZm9yIHRoYXQsIGJ1dCB3ZQ0KICAgIC8vIG1heSBuZWVkIHRvIHNoYWRvdyBvdGhlciBsaXN0ZW5zIGFzIHdlbGwuDQogICAgaWYgKHRhZykgew0KICAgICAgICBhc3NlcnQoIXN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzdWJ0cmVlLnZhbHVlKSwgIklmIHdlJ3JlIGFkZGluZyBhIHF1ZXJ5LCBpdCBzaG91bGRuJ3QgYmUgc2hhZG93ZWQiKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFNoYWRvdyBldmVyeXRoaW5nIGF0IG9yIGJlbG93IHRoaXMgbG9jYXRpb24sIHRoaXMgaXMgYSBkZWZhdWx0IGxpc3RlbmVyLg0KICAgICAgICBjb25zdCBxdWVyaWVzVG9TdG9wID0gc3VidHJlZS5mb2xkKChyZWxhdGl2ZVBhdGgsIG1heWJlQ2hpbGRTeW5jUG9pbnQsIGNoaWxkTWFwKSA9PiB7DQogICAgICAgICAgICBpZiAoIXBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkgJiYNCiAgICAgICAgICAgICAgICBtYXliZUNoaWxkU3luY1BvaW50ICYmDQogICAgICAgICAgICAgICAgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KG1heWJlQ2hpbGRTeW5jUG9pbnQpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFtzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCkucXVlcnldOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gTm8gZGVmYXVsdCBsaXN0ZW5lciBoZXJlLCBmbGF0dGVuIGFueSBkZWVwZXIgcXVlcmllcyBpbnRvIGFuIGFycmF5DQogICAgICAgICAgICAgICAgbGV0IHF1ZXJpZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCkgew0KICAgICAgICAgICAgICAgICAgICBxdWVyaWVzID0gcXVlcmllcy5jb25jYXQoc3luY1BvaW50R2V0UXVlcnlWaWV3cyhtYXliZUNoaWxkU3luY1BvaW50KS5tYXAodmlldyA9PiB2aWV3LnF1ZXJ5KSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVhY2goY2hpbGRNYXAsIChfa2V5LCBjaGlsZFF1ZXJpZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcXVlcmllcyA9IHF1ZXJpZXMuY29uY2F0KGNoaWxkUXVlcmllcyk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJpZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXJpZXNUb1N0b3AubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5VG9TdG9wID0gcXVlcmllc1RvU3RvcFtpXTsNCiAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdG9wTGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5VG9TdG9wKSwgc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnlUb1N0b3ApKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZXZlbnRzOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3Rvcihub2RlXykgew0KICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMubm9kZV8uZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKTsNCiAgICAgICAgcmV0dXJuIG5ldyBFeGlzdGluZ1ZhbHVlUHJvdmlkZXIoY2hpbGQpOw0KICAgIH0NCiAgICBub2RlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5ub2RlXzsNCiAgICB9DQp9DQpjbGFzcyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKHN5bmNUcmVlLCBwYXRoKSB7DQogICAgICAgIHRoaXMuc3luY1RyZWVfID0gc3luY1RyZWU7DQogICAgICAgIHRoaXMucGF0aF8gPSBwYXRoOw0KICAgIH0NCiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gcGF0aENoaWxkKHRoaXMucGF0aF8sIGNoaWxkTmFtZSk7DQogICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWRWYWx1ZVByb3ZpZGVyKHRoaXMuc3luY1RyZWVfLCBjaGlsZFBhdGgpOw0KICAgIH0NCiAgICBub2RlKCkgew0KICAgICAgICByZXR1cm4gc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHRoaXMuc3luY1RyZWVfLCB0aGlzLnBhdGhfKTsNCiAgICB9DQp9DQovKioNCiAqIEdlbmVyYXRlIHBsYWNlaG9sZGVycyBmb3IgZGVmZXJyZWQgdmFsdWVzLg0KICovDQpjb25zdCBnZW5lcmF0ZVdpdGhWYWx1ZXMgPSBmdW5jdGlvbiAodmFsdWVzKSB7DQogICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9Ow0KICAgIHZhbHVlc1sndGltZXN0YW1wJ10gPSB2YWx1ZXNbJ3RpbWVzdGFtcCddIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIHJldHVybiB2YWx1ZXM7DQp9Ow0KLyoqDQogKiBWYWx1ZSB0byB1c2Ugd2hlbiBmaXJpbmcgbG9jYWwgZXZlbnRzLiBXaGVuIHdyaXRpbmcgc2VydmVyIHZhbHVlcywgZmlyZQ0KICogbG9jYWwgZXZlbnRzIHdpdGggYW4gYXBwcm94aW1hdGUgdmFsdWUsIG90aGVyd2lzZSByZXR1cm4gdmFsdWUgYXMtaXMuDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZExlYWZWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgZXhpc3RpbmdWYWwsIHNlcnZlclZhbHVlcykgew0KICAgIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0Jykgew0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgfQ0KICAgIGFzc2VydCgnLnN2JyBpbiB2YWx1ZSwgJ1VuZXhwZWN0ZWQgbGVhZiBub2RlIG9yIHByaW9yaXR5IGNvbnRlbnRzJyk7DQogICAgaWYgKHR5cGVvZiB2YWx1ZVsnLnN2J10gPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHJldHVybiByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSh2YWx1ZVsnLnN2J10sIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWVbJy5zdiddID09PSAnb2JqZWN0Jykgew0KICAgICAgICByZXR1cm4gcmVzb2x2ZUNvbXBsZXhEZWZlcnJlZFZhbHVlKHZhbHVlWycuc3YnXSwgZXhpc3RpbmdWYWwpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSwgbnVsbCwgMikpOw0KICAgIH0NCn07DQpjb25zdCByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykgew0KICAgIHN3aXRjaCAob3ApIHsNCiAgICAgICAgY2FzZSAndGltZXN0YW1wJzoNCiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWx1ZXNbJ3RpbWVzdGFtcCddOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBvcCk7DQogICAgfQ0KfTsNCmNvbnN0IHJlc29sdmVDb21wbGV4RGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHVudXNlZCkgew0KICAgIGlmICghb3AuaGFzT3duUHJvcGVydHkoJ2luY3JlbWVudCcpKSB7DQogICAgICAgIGFzc2VydChmYWxzZSwgJ1VuZXhwZWN0ZWQgc2VydmVyIHZhbHVlOiAnICsgSlNPTi5zdHJpbmdpZnkob3AsIG51bGwsIDIpKTsNCiAgICB9DQogICAgY29uc3QgZGVsdGEgPSBvcFsnaW5jcmVtZW50J107DQogICAgaWYgKHR5cGVvZiBkZWx0YSAhPT0gJ251bWJlcicpIHsNCiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBpbmNyZW1lbnQgdmFsdWU6ICcgKyBkZWx0YSk7DQogICAgfQ0KICAgIGNvbnN0IGV4aXN0aW5nTm9kZSA9IGV4aXN0aW5nLm5vZGUoKTsNCiAgICBhc3NlcnQoZXhpc3RpbmdOb2RlICE9PSBudWxsICYmIHR5cGVvZiBleGlzdGluZ05vZGUgIT09ICd1bmRlZmluZWQnLCAnRXhwZWN0ZWQgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUgZm9yIG51bGxzJyk7DQogICAgLy8gSW5jcmVtZW50aW5nIGEgbm9uLW51bWJlciBzZXRzIHRoZSB2YWx1ZSB0byB0aGUgaW5jcmVtZW50ZWQgYW1vdW50DQogICAgaWYgKCFleGlzdGluZ05vZGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgIHJldHVybiBkZWx0YTsNCiAgICB9DQogICAgY29uc3QgbGVhZiA9IGV4aXN0aW5nTm9kZTsNCiAgICBjb25zdCBleGlzdGluZ1ZhbCA9IGxlYWYuZ2V0VmFsdWUoKTsNCiAgICBpZiAodHlwZW9mIGV4aXN0aW5nVmFsICE9PSAnbnVtYmVyJykgew0KICAgICAgICByZXR1cm4gZGVsdGE7DQogICAgfQ0KICAgIC8vIE5vIG5lZWQgdG8gZG8gb3Zlci91bmRlcmZsb3cgYXJpdGhtZXRpYyBoZXJlIGJlY2F1c2UgSlMgb25seSBoYW5kbGVzIGZsb2F0cyB1bmRlciB0aGUgY292ZXJzDQogICAgcmV0dXJuIGV4aXN0aW5nVmFsICsgZGVsdGE7DQp9Ow0KLyoqDQogKiBSZWN1cnNpdmVseSByZXBsYWNlIGFsbCBkZWZlcnJlZCB2YWx1ZXMgYW5kIHByaW9yaXRpZXMgaW4gdGhlIHRyZWUgd2l0aCB0aGUNCiAqIHNwZWNpZmllZCBnZW5lcmF0ZWQgcmVwbGFjZW1lbnQgdmFsdWVzLg0KICogQHBhcmFtIHBhdGggLSBwYXRoIHRvIHdoaWNoIHdyaXRlIGlzIHJlbGF0aXZlDQogKiBAcGFyYW0gbm9kZSAtIG5ldyBkYXRhIHdyaXR0ZW4gYXQgcGF0aA0KICogQHBhcmFtIHN5bmNUcmVlIC0gY3VycmVudCBkYXRhDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlVHJlZSA9IGZ1bmN0aW9uIChwYXRoLCBub2RlLCBzeW5jVHJlZSwgc2VydmVyVmFsdWVzKSB7DQogICAgcmV0dXJuIHJlc29sdmVEZWZlcnJlZFZhbHVlKG5vZGUsIG5ldyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIoc3luY1RyZWUsIHBhdGgpLCBzZXJ2ZXJWYWx1ZXMpOw0KfTsNCi8qKg0KICogUmVjdXJzaXZlbHkgcmVwbGFjZSBhbGwgZGVmZXJyZWQgdmFsdWVzIGFuZCBwcmlvcml0aWVzIGluIHRoZSBub2RlIHdpdGggdGhlDQogKiBzcGVjaWZpZWQgZ2VuZXJhdGVkIHJlcGxhY2VtZW50IHZhbHVlcy4gIElmIHRoZXJlIGFyZSBubyBzZXJ2ZXIgdmFsdWVzIGluIHRoZSBub2RlLA0KICogaXQnbGwgYmUgcmV0dXJuZWQgYXMtaXMuDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QgPSBmdW5jdGlvbiAobm9kZSwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykgew0KICAgIHJldHVybiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBuZXcgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyKGV4aXN0aW5nKSwgc2VydmVyVmFsdWVzKTsNCn07DQpmdW5jdGlvbiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBleGlzdGluZ1ZhbCwgc2VydmVyVmFsdWVzKSB7DQogICAgY29uc3QgcmF3UHJpID0gbm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpOw0KICAgIGNvbnN0IHByaW9yaXR5ID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKHJhd1ByaSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoJy5wcmlvcml0eScpLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIGxldCBuZXdOb2RlOw0KICAgIGlmIChub2RlLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICBjb25zdCBsZWFmTm9kZSA9IG5vZGU7DQogICAgICAgIGNvbnN0IHZhbHVlID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKGxlYWZOb2RlLmdldFZhbHVlKCksIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgICAgICBpZiAodmFsdWUgIT09IGxlYWZOb2RlLmdldFZhbHVlKCkgfHwNCiAgICAgICAgICAgIHByaW9yaXR5ICE9PSBsZWFmTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHZhbHVlLCBub2RlRnJvbUpTT04ocHJpb3JpdHkpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSBub2RlOw0KICAgICAgICBuZXdOb2RlID0gY2hpbGRyZW5Ob2RlOw0KICAgICAgICBpZiAocHJpb3JpdHkgIT09IGNoaWxkcmVuTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7DQogICAgICAgICAgICBuZXdOb2RlID0gbmV3Tm9kZS51cGRhdGVQcmlvcml0eShuZXcgTGVhZk5vZGUocHJpb3JpdHkpKTsNCiAgICAgICAgfQ0KICAgICAgICBjaGlsZHJlbk5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlKGNoaWxkTm9kZSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSwgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZE5vZGUgIT09IGNoaWxkTm9kZSkgew0KICAgICAgICAgICAgICAgIG5ld05vZGUgPSBuZXdOb2RlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBuZXdOb2RlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBsaWdodC13ZWlnaHQgdHJlZSwgdHJhdmVyc2FibGUgYnkgcGF0aC4gIE5vZGVzIGNhbiBoYXZlIGJvdGggdmFsdWVzIGFuZCBjaGlsZHJlbi4NCiAqIE5vZGVzIGFyZSBub3QgZW51bWVyYXRlZCAoYnkgZm9yRWFjaENoaWxkKSB1bmxlc3MgdGhleSBoYXZlIGEgdmFsdWUgb3Igbm9uLWVtcHR5DQogKiBjaGlsZHJlbi4NCiAqLw0KY2xhc3MgVHJlZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG5hbWUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBub2RlLg0KICAgICAqIEBwYXJhbSBwYXJlbnQgLSBPcHRpb25hbCBwYXJlbnQgbm9kZS4NCiAgICAgKiBAcGFyYW0gbm9kZSAtIE9wdGlvbmFsIG5vZGUgdG8gd3JhcC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihuYW1lID0gJycsIHBhcmVudCA9IG51bGwsIG5vZGUgPSB7IGNoaWxkcmVuOiB7fSwgY2hpbGRDb3VudDogMCB9KSB7DQogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7DQogICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50Ow0KICAgICAgICB0aGlzLm5vZGUgPSBub2RlOw0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIHN1Yi1UcmVlIGZvciB0aGUgZ2l2ZW4gcGF0aC4NCiAqDQogKiBAcGFyYW0gcGF0aE9iaiAtIFBhdGggdG8gbG9vayB1cC4NCiAqIEByZXR1cm5zIFRyZWUgZm9yIHBhdGguDQogKi8NCmZ1bmN0aW9uIHRyZWVTdWJUcmVlKHRyZWUsIHBhdGhPYmopIHsNCiAgICAvLyBUT0RPOiBSZXF1aXJlIHBhdGhPYmogdG8gYmUgUGF0aD8NCiAgICBsZXQgcGF0aCA9IHBhdGhPYmogaW5zdGFuY2VvZiBQYXRoID8gcGF0aE9iaiA6IG5ldyBQYXRoKHBhdGhPYmopOw0KICAgIGxldCBjaGlsZCA9IHRyZWUsIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgd2hpbGUgKG5leHQgIT09IG51bGwpIHsNCiAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc2FmZUdldChjaGlsZC5ub2RlLmNoaWxkcmVuLCBuZXh0KSB8fCB7DQogICAgICAgICAgICBjaGlsZHJlbjoge30sDQogICAgICAgICAgICBjaGlsZENvdW50OiAwDQogICAgICAgIH07DQogICAgICAgIGNoaWxkID0gbmV3IFRyZWUobmV4dCwgY2hpbGQsIGNoaWxkTm9kZSk7DQogICAgICAgIHBhdGggPSBwYXRoUG9wRnJvbnQocGF0aCk7DQogICAgICAgIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgfQ0KICAgIHJldHVybiBjaGlsZDsNCn0NCi8qKg0KICogUmV0dXJucyB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHJldHVybnMgVGhlIGRhdGEgb3IgbnVsbCBpZiBubyBkYXRhIGV4aXN0cy4NCiAqLw0KZnVuY3Rpb24gdHJlZUdldFZhbHVlKHRyZWUpIHsNCiAgICByZXR1cm4gdHJlZS5ub2RlLnZhbHVlOw0KfQ0KLyoqDQogKiBTZXRzIGRhdGEgdG8gdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gc2V0Lg0KICovDQpmdW5jdGlvbiB0cmVlU2V0VmFsdWUodHJlZSwgdmFsdWUpIHsNCiAgICB0cmVlLm5vZGUudmFsdWUgPSB2YWx1ZTsNCiAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTsNCn0NCi8qKg0KICogQHJldHVybnMgV2hldGhlciB0aGUgdHJlZSBoYXMgYW55IGNoaWxkcmVuLg0KICovDQpmdW5jdGlvbiB0cmVlSGFzQ2hpbGRyZW4odHJlZSkgew0KICAgIHJldHVybiB0cmVlLm5vZGUuY2hpbGRDb3VudCA+IDA7DQp9DQovKioNCiAqIEByZXR1cm5zIFdoZXRoZSBydGhlIHRyZWUgaXMgZW1wdHkgKG5vIHZhbHVlIG9yIGNoaWxkcmVuKS4NCiAqLw0KZnVuY3Rpb24gdHJlZUlzRW1wdHkodHJlZSkgew0KICAgIHJldHVybiB0cmVlR2V0VmFsdWUodHJlZSkgPT09IHVuZGVmaW5lZCAmJiAhdHJlZUhhc0NoaWxkcmVuKHRyZWUpOw0KfQ0KLyoqDQogKiBDYWxscyBhY3Rpb24gZm9yIGVhY2ggY2hpbGQgb2YgdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2ggY2hpbGQuDQogKi8NCmZ1bmN0aW9uIHRyZWVGb3JFYWNoQ2hpbGQodHJlZSwgYWN0aW9uKSB7DQogICAgZWFjaCh0cmVlLm5vZGUuY2hpbGRyZW4sIChjaGlsZCwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgIGFjdGlvbihuZXcgVHJlZShjaGlsZCwgdHJlZSwgY2hpbGRUcmVlKSk7DQogICAgfSk7DQp9DQovKioNCiAqIERvZXMgYSBkZXB0aC1maXJzdCB0cmF2ZXJzYWwgb2YgdGhpcyBub2RlJ3MgZGVzY2VuZGFudHMsIGNhbGxpbmcgYWN0aW9uIGZvciBlYWNoIG9uZS4NCiAqDQogKiBAcGFyYW0gYWN0aW9uIC0gQWN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaCBjaGlsZC4NCiAqIEBwYXJhbSBpbmNsdWRlU2VsZiAtIFdoZXRoZXIgdG8gY2FsbCBhY3Rpb24gb24gdGhpcyBub2RlIGFzIHdlbGwuIERlZmF1bHRzIHRvDQogKiAgIGZhbHNlLg0KICogQHBhcmFtIGNoaWxkcmVuRmlyc3QgLSBXaGV0aGVyIHRvIGNhbGwgYWN0aW9uIG9uIGNoaWxkcmVuIGJlZm9yZSBjYWxsaW5nIGl0IG9uDQogKiAgIHBhcmVudC4NCiAqLw0KZnVuY3Rpb24gdHJlZUZvckVhY2hEZXNjZW5kYW50KHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYsIGNoaWxkcmVuRmlyc3QpIHsNCiAgICBpZiAoaW5jbHVkZVNlbGYgJiYgIWNoaWxkcmVuRmlyc3QpIHsNCiAgICAgICAgYWN0aW9uKHRyZWUpOw0KICAgIH0NCiAgICB0cmVlRm9yRWFjaENoaWxkKHRyZWUsIGNoaWxkID0+IHsNCiAgICAgICAgdHJlZUZvckVhY2hEZXNjZW5kYW50KGNoaWxkLCBhY3Rpb24sIHRydWUsIGNoaWxkcmVuRmlyc3QpOw0KICAgIH0pOw0KICAgIGlmIChpbmNsdWRlU2VsZiAmJiBjaGlsZHJlbkZpcnN0KSB7DQogICAgICAgIGFjdGlvbih0cmVlKTsNCiAgICB9DQp9DQovKioNCiAqIENhbGxzIGFjdGlvbiBvbiBlYWNoIGFuY2VzdG9yIG5vZGUuDQogKg0KICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgb24gZWFjaCBwYXJlbnQ7IHJldHVybg0KICogICB0cnVlIHRvIGFib3J0Lg0KICogQHBhcmFtIGluY2x1ZGVTZWxmIC0gV2hldGhlciB0byBjYWxsIGFjdGlvbiBvbiB0aGlzIG5vZGUgYXMgd2VsbC4NCiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGlvbiBjYWxsYmFjayByZXR1cm5lZCB0cnVlLg0KICovDQpmdW5jdGlvbiB0cmVlRm9yRWFjaEFuY2VzdG9yKHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYpIHsNCiAgICBsZXQgbm9kZSA9IGluY2x1ZGVTZWxmID8gdHJlZSA6IHRyZWUucGFyZW50Ow0KICAgIHdoaWxlIChub2RlICE9PSBudWxsKSB7DQogICAgICAgIGlmIChhY3Rpb24obm9kZSkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KLyoqDQogKiBAcmV0dXJucyBUaGUgcGF0aCBvZiB0aGlzIHRyZWUgbm9kZSwgYXMgYSBQYXRoLg0KICovDQpmdW5jdGlvbiB0cmVlR2V0UGF0aCh0cmVlKSB7DQogICAgcmV0dXJuIG5ldyBQYXRoKHRyZWUucGFyZW50ID09PSBudWxsDQogICAgICAgID8gdHJlZS5uYW1lDQogICAgICAgIDogdHJlZUdldFBhdGgodHJlZS5wYXJlbnQpICsgJy8nICsgdHJlZS5uYW1lKTsNCn0NCi8qKg0KICogQWRkcyBvciByZW1vdmVzIHRoaXMgY2hpbGQgZnJvbSBpdHMgcGFyZW50IGJhc2VkIG9uIHdoZXRoZXIgaXQncyBlbXB0eSBvciBub3QuDQogKi8NCmZ1bmN0aW9uIHRyZWVVcGRhdGVQYXJlbnRzKHRyZWUpIHsNCiAgICBpZiAodHJlZS5wYXJlbnQgIT09IG51bGwpIHsNCiAgICAgICAgdHJlZVVwZGF0ZUNoaWxkKHRyZWUucGFyZW50LCB0cmVlLm5hbWUsIHRyZWUpOw0KICAgIH0NCn0NCi8qKg0KICogQWRkcyBvciByZW1vdmVzIHRoZSBwYXNzZWQgY2hpbGQgdG8gdGhpcyB0cmVlIG5vZGUsIGRlcGVuZGluZyBvbiB3aGV0aGVyIGl0J3MgZW1wdHkuDQogKg0KICogQHBhcmFtIGNoaWxkTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjaGlsZCB0byB1cGRhdGUuDQogKiBAcGFyYW0gY2hpbGQgLSBUaGUgY2hpbGQgdG8gdXBkYXRlLg0KICovDQpmdW5jdGlvbiB0cmVlVXBkYXRlQ2hpbGQodHJlZSwgY2hpbGROYW1lLCBjaGlsZCkgew0KICAgIGNvbnN0IGNoaWxkRW1wdHkgPSB0cmVlSXNFbXB0eShjaGlsZCk7DQogICAgY29uc3QgY2hpbGRFeGlzdHMgPSBjb250YWlucyh0cmVlLm5vZGUuY2hpbGRyZW4sIGNoaWxkTmFtZSk7DQogICAgaWYgKGNoaWxkRW1wdHkgJiYgY2hpbGRFeGlzdHMpIHsNCiAgICAgICAgZGVsZXRlIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdOw0KICAgICAgICB0cmVlLm5vZGUuY2hpbGRDb3VudC0tOw0KICAgICAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTsNCiAgICB9DQogICAgZWxzZSBpZiAoIWNoaWxkRW1wdHkgJiYgIWNoaWxkRXhpc3RzKSB7DQogICAgICAgIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdID0gY2hpbGQubm9kZTsNCiAgICAgICAgdHJlZS5ub2RlLmNoaWxkQ291bnQrKzsNCiAgICAgICAgdHJlZVVwZGF0ZVBhcmVudHModHJlZSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUcnVlIGZvciBpbnZhbGlkIEZpcmViYXNlIGtleXMNCiAqLw0KY29uc3QgSU5WQUxJRF9LRVlfUkVHRVhfID0gL1tcW1xdLiMkXC9cdTAwMDAtXHUwMDFGXHUwMDdGXS87DQovKioNCiAqIFRydWUgZm9yIGludmFsaWQgRmlyZWJhc2UgcGF0aHMuDQogKiBBbGxvd3MgJy8nIGluIHBhdGhzLg0KICovDQpjb25zdCBJTlZBTElEX1BBVEhfUkVHRVhfID0gL1tcW1xdLiMkXHUwMDAwLVx1MDAxRlx1MDA3Rl0vOw0KLyoqDQogKiBNYXhpbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIGFsbG93IGluIGxlYWYgdmFsdWUNCiAqLw0KY29uc3QgTUFYX0xFQUZfU0laRV8gPSAxMCAqIDEwMjQgKiAxMDI0Ow0KY29uc3QgaXNWYWxpZEtleSA9IGZ1bmN0aW9uIChrZXkpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmIGtleS5sZW5ndGggIT09IDAgJiYgIUlOVkFMSURfS0VZX1JFR0VYXy50ZXN0KGtleSkpOw0KfTsNCmNvbnN0IGlzVmFsaWRQYXRoU3RyaW5nID0gZnVuY3Rpb24gKHBhdGhTdHJpbmcpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBwYXRoU3RyaW5nID09PSAnc3RyaW5nJyAmJg0KICAgICAgICBwYXRoU3RyaW5nLmxlbmd0aCAhPT0gMCAmJg0KICAgICAgICAhSU5WQUxJRF9QQVRIX1JFR0VYXy50ZXN0KHBhdGhTdHJpbmcpKTsNCn07DQpjb25zdCBpc1ZhbGlkUm9vdFBhdGhTdHJpbmcgPSBmdW5jdGlvbiAocGF0aFN0cmluZykgew0KICAgIGlmIChwYXRoU3RyaW5nKSB7DQogICAgICAgIC8vIEFsbG93ICcvLmluZm8vJyBhdCB0aGUgYmVnaW5uaW5nLg0KICAgICAgICBwYXRoU3RyaW5nID0gcGF0aFN0cmluZy5yZXBsYWNlKC9eXC8qXC5pbmZvKFwvfCQpLywgJy8nKTsNCiAgICB9DQogICAgcmV0dXJuIGlzVmFsaWRQYXRoU3RyaW5nKHBhdGhTdHJpbmcpOw0KfTsNCi8qKg0KICogUHJlLXZhbGlkYXRlIGEgZGF0dW0gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIEZpcmViYXNlIGZ1bmN0aW9uLg0KICovDQpjb25zdCB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZyA9IGZ1bmN0aW9uIChmbk5hbWUsIHZhbHVlLCBwYXRoLCBvcHRpb25hbCkgew0KICAgIGlmIChvcHRpb25hbCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoZXJyb3JQcmVmaXgoZm5OYW1lLCAndmFsdWUnKSwgdmFsdWUsIHBhdGgpOw0KfTsNCi8qKg0KICogVmFsaWRhdGUgYSBkYXRhIG9iamVjdCBjbGllbnQtc2lkZSBiZWZvcmUgc2VuZGluZyB0byBzZXJ2ZXIuDQogKi8NCmNvbnN0IHZhbGlkYXRlRmlyZWJhc2VEYXRhID0gZnVuY3Rpb24gKGVycm9yUHJlZml4LCBkYXRhLCBwYXRoXykgew0KICAgIGNvbnN0IHBhdGggPSBwYXRoXyBpbnN0YW5jZW9mIFBhdGggPyBuZXcgVmFsaWRhdGlvblBhdGgocGF0aF8sIGVycm9yUHJlZml4KSA6IHBhdGhfOw0KICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsgJ2NvbnRhaW5zIHVuZGVmaW5lZCAnICsgdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHBhdGgpKTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArDQogICAgICAgICAgICAnY29udGFpbnMgYSBmdW5jdGlvbiAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAnIHdpdGggY29udGVudHMgPSAnICsNCiAgICAgICAgICAgIGRhdGEudG9TdHJpbmcoKSk7DQogICAgfQ0KICAgIGlmIChpc0ludmFsaWRKU09OTnVtYmVyKGRhdGEpKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArDQogICAgICAgICAgICAnY29udGFpbnMgJyArDQogICAgICAgICAgICBkYXRhLnRvU3RyaW5nKCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSk7DQogICAgfQ0KICAgIC8vIENoZWNrIG1heCBsZWFmIHNpemUsIGJ1dCB0cnkgdG8gYXZvaWQgdGhlIHV0ZjggY29udmVyc2lvbiBpZiB3ZSBjYW4uDQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyAmJg0KICAgICAgICBkYXRhLmxlbmd0aCA+IE1BWF9MRUFGX1NJWkVfIC8gMyAmJg0KICAgICAgICBzdHJpbmdMZW5ndGgoZGF0YSkgPiBNQVhfTEVBRl9TSVpFXykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggKw0KICAgICAgICAgICAgJ2NvbnRhaW5zIGEgc3RyaW5nIGdyZWF0ZXIgdGhhbiAnICsNCiAgICAgICAgICAgIE1BWF9MRUFGX1NJWkVfICsNCiAgICAgICAgICAgICcgdXRmOCBieXRlcyAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAiICgnIiArDQogICAgICAgICAgICBkYXRhLnN1YnN0cmluZygwLCA1MCkgKw0KICAgICAgICAgICAgIi4uLicpIik7DQogICAgfQ0KICAgIC8vIFRPRE8gPSBQZXJmID0gQ29uc2lkZXIgY29tYmluaW5nIHRoZSByZWN1cnNpdmUgdmFsaWRhdGlvbiBvZiBrZXlzIGludG8gTm9kZUZyb21KU09ODQogICAgLy8gdG8gc2F2ZSBleHRyYSB3YWxraW5nIG9mIGxhcmdlIG9iamVjdHMuDQogICAgaWYgKGRhdGEgJiYgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnKSB7DQogICAgICAgIGxldCBoYXNEb3RWYWx1ZSA9IGZhbHNlOw0KICAgICAgICBsZXQgaGFzQWN0dWFsQ2hpbGQgPSBmYWxzZTsNCiAgICAgICAgZWFjaChkYXRhLCAoa2V5LCB2YWx1ZSkgPT4gew0KICAgICAgICAgICAgaWYgKGtleSA9PT0gJy52YWx1ZScpIHsNCiAgICAgICAgICAgICAgICBoYXNEb3RWYWx1ZSA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChrZXkgIT09ICcucHJpb3JpdHknICYmIGtleSAhPT0gJy5zdicpIHsNCiAgICAgICAgICAgICAgICBoYXNBY3R1YWxDaGlsZCA9IHRydWU7DQogICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkS2V5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcgY29udGFpbnMgYW4gaW52YWxpZCBrZXkgKCcgKw0KICAgICAgICAgICAgICAgICAgICAgICAga2V5ICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcpICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHBhdGgpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcuICBLZXlzIG11c3QgYmUgbm9uLWVtcHR5IHN0cmluZ3MgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAnYW5kIGNhblwndCBjb250YWluICIuIiwgIiMiLCAiJCIsICIvIiwgIlsiLCBvciAiXSInKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFB1c2gocGF0aCwga2V5KTsNCiAgICAgICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhKGVycm9yUHJlZml4LCB2YWx1ZSwgcGF0aCk7DQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFBvcChwYXRoKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChoYXNEb3RWYWx1ZSAmJiBoYXNBY3R1YWxDaGlsZCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsNCiAgICAgICAgICAgICAgICAnIGNvbnRhaW5zICIudmFsdWUiIGNoaWxkICcgKw0KICAgICAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAgICAgJyBpbiBhZGRpdGlvbiB0byBhY3R1YWwgY2hpbGRyZW4uJyk7DQogICAgICAgIH0NCiAgICB9DQp9Ow0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgdmFsaWRhdGVQYXRoU3RyaW5nID0gZnVuY3Rpb24gKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCkgew0KICAgIGlmIChvcHRpb25hbCAmJiBwYXRoU3RyaW5nID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBpZiAoIWlzVmFsaWRQYXRoU3RyaW5nKHBhdGhTdHJpbmcpKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKw0KICAgICAgICAgICAgJ3dhcyBhbiBpbnZhbGlkIHBhdGggPSAiJyArDQogICAgICAgICAgICBwYXRoU3RyaW5nICsNCiAgICAgICAgICAgICciLiBQYXRocyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzIGFuZCAnICsNCiAgICAgICAgICAgICdjYW5cJ3QgY29udGFpbiAiLiIsICIjIiwgIiQiLCAiWyIsIG9yICJdIicpOw0KICAgIH0NCn07DQpjb25zdCB2YWxpZGF0ZVJvb3RQYXRoU3RyaW5nID0gZnVuY3Rpb24gKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCkgew0KICAgIGlmIChwYXRoU3RyaW5nKSB7DQogICAgICAgIC8vIEFsbG93ICcvLmluZm8vJyBhdCB0aGUgYmVnaW5uaW5nLg0KICAgICAgICBwYXRoU3RyaW5nID0gcGF0aFN0cmluZy5yZXBsYWNlKC9eXC8qXC5pbmZvKFwvfCQpLywgJy8nKTsNCiAgICB9DQogICAgdmFsaWRhdGVQYXRoU3RyaW5nKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCk7DQp9Ow0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgdmFsaWRhdGVXcml0YWJsZVBhdGggPSBmdW5jdGlvbiAoZm5OYW1lLCBwYXRoKSB7DQogICAgaWYgKHBhdGhHZXRGcm9udChwYXRoKSA9PT0gJy5pbmZvJykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm5OYW1lICsgIiBmYWlsZWQgPSBDYW4ndCBtb2RpZnkgZGF0YSB1bmRlciAvLmluZm8vIik7DQogICAgfQ0KfTsNCmNvbnN0IHZhbGlkYXRlVXJsID0gZnVuY3Rpb24gKGZuTmFtZSwgcGFyc2VkVXJsKSB7DQogICAgLy8gVE9ETyA9IFZhbGlkYXRlIHNlcnZlciBiZXR0ZXIuDQogICAgY29uc3QgcGF0aFN0cmluZyA9IHBhcnNlZFVybC5wYXRoLnRvU3RyaW5nKCk7DQogICAgaWYgKCEodHlwZW9mIHBhcnNlZFVybC5yZXBvSW5mby5ob3N0ID09PSAnc3RyaW5nJykgfHwNCiAgICAgICAgcGFyc2VkVXJsLnJlcG9JbmZvLmhvc3QubGVuZ3RoID09PSAwIHx8DQogICAgICAgICghaXNWYWxpZEtleShwYXJzZWRVcmwucmVwb0luZm8ubmFtZXNwYWNlKSAmJg0KICAgICAgICAgICAgcGFyc2VkVXJsLnJlcG9JbmZvLmhvc3Quc3BsaXQoJzonKVswXSAhPT0gJ2xvY2FsaG9zdCcpIHx8DQogICAgICAgIChwYXRoU3RyaW5nLmxlbmd0aCAhPT0gMCAmJiAhaXNWYWxpZFJvb3RQYXRoU3RyaW5nKHBhdGhTdHJpbmcpKSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCAndXJsJykgKw0KICAgICAgICAgICAgJ211c3QgYmUgYSB2YWxpZCBmaXJlYmFzZSBVUkwgYW5kICcgKw0KICAgICAgICAgICAgJ3RoZSBwYXRoIGNhblwndCBjb250YWluICIuIiwgIiMiLCAiJCIsICJbIiwgb3IgIl0iLicpOw0KICAgIH0NCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoZSBldmVudCBxdWV1ZSBzZXJ2ZXMgYSBmZXcgcHVycG9zZXM6DQogKiAxLiBJdCBlbnN1cmVzIHdlIG1haW50YWluIGV2ZW50IG9yZGVyIGluIHRoZSBmYWNlIG9mIGV2ZW50IGNhbGxiYWNrcyBkb2luZyBvcGVyYXRpb25zIHRoYXQgcmVzdWx0IGluIG1vcmUNCiAqICAgIGV2ZW50cyBiZWluZyBxdWV1ZWQuDQogKiAyLiByYWlzZVF1ZXVlZEV2ZW50cygpIGhhbmRsZXMgYmVpbmcgY2FsbGVkIHJlZW50cmFudGx5IG5pY2VseS4gIFRoYXQgaXMsIGlmIGluIHRoZSBjb3Vyc2Ugb2YgcmFpc2luZyBldmVudHMsDQogKiAgICByYWlzZVF1ZXVlZEV2ZW50cygpIGlzIGNhbGxlZCBhZ2FpbiwgdGhlICJpbm5lciIgY2FsbCB3aWxsIHBpY2sgdXAgcmFpc2luZyBldmVudHMgd2hlcmUgdGhlICJvdXRlciIgY2FsbA0KICogICAgbGVmdCBvZmYsIGVuc3VyaW5nIHRoYXQgdGhlIGV2ZW50cyBhcmUgc3RpbGwgcmFpc2VkIHN5bmNocm9ub3VzbHkgYW5kIGluIG9yZGVyLg0KICogMy4gWW91IGNhbiB1c2UgcmFpc2VFdmVudHNBdFBhdGggYW5kIHJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGggdG8gZW5zdXJlIG9ubHkgcmVsZXZhbnQgcHJldmlvdXNseS1xdWV1ZWQNCiAqICAgIGV2ZW50cyBhcmUgcmFpc2VkIHN5bmNocm9ub3VzbHkuDQogKg0KICogTk9URTogVGhpcyBjYW4gYWxsIGdvIGF3YXkgaWYvd2hlbiB3ZSBtb3ZlIHRvIGFzeW5jIGV2ZW50cy4NCiAqDQogKi8NCmNsYXNzIEV2ZW50UXVldWUgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmV2ZW50TGlzdHNfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFja3MgcmVjdXJzaW9uIGRlcHRoIG9mIHJhaXNlUXVldWVkRXZlbnRzXywgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlcy4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMucmVjdXJzaW9uRGVwdGhfID0gMDsNCiAgICB9DQp9DQovKioNCiAqIEBwYXJhbSBldmVudERhdGFMaXN0IC0gVGhlIG5ldyBldmVudHMgdG8gcXVldWUuDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhldmVudFF1ZXVlLCBldmVudERhdGFMaXN0KSB7DQogICAgLy8gV2UgZ3JvdXAgZXZlbnRzIGJ5IHBhdGgsIHN0b3JpbmcgdGhlbSBpbiBhIHNpbmdsZSBFdmVudExpc3QsIHRvIG1ha2UgaXQgZWFzaWVyIHRvIHNraXAgb3ZlciB0aGVtIHF1aWNrbHkuDQogICAgbGV0IGN1cnJMaXN0ID0gbnVsbDsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50RGF0YUxpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgZGF0YSA9IGV2ZW50RGF0YUxpc3RbaV07DQogICAgICAgIGNvbnN0IHBhdGggPSBkYXRhLmdldFBhdGgoKTsNCiAgICAgICAgaWYgKGN1cnJMaXN0ICE9PSBudWxsICYmICFwYXRoRXF1YWxzKHBhdGgsIGN1cnJMaXN0LnBhdGgpKSB7DQogICAgICAgICAgICBldmVudFF1ZXVlLmV2ZW50TGlzdHNfLnB1c2goY3Vyckxpc3QpOw0KICAgICAgICAgICAgY3Vyckxpc3QgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmIChjdXJyTGlzdCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgY3Vyckxpc3QgPSB7IGV2ZW50czogW10sIHBhdGggfTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJyTGlzdC5ldmVudHMucHVzaChkYXRhKTsNCiAgICB9DQogICAgaWYgKGN1cnJMaXN0KSB7DQogICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c18ucHVzaChjdXJyTGlzdCk7DQogICAgfQ0KfQ0KLyoqDQogKiBRdWV1ZXMgdGhlIHNwZWNpZmllZCBldmVudHMgYW5kIHN5bmNocm9ub3VzbHkgcmFpc2VzIGFsbCBldmVudHMgKGluY2x1ZGluZyBwcmV2aW91c2x5IHF1ZXVlZCBvbmVzKQ0KICogZm9yIHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAqDQogKiBJdCBpcyBhc3N1bWVkIHRoYXQgdGhlIG5ldyBldmVudHMgYXJlIGFsbCBmb3IgdGhlIHNwZWNpZmllZCBwYXRoLg0KICoNCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gcmFpc2UgZXZlbnRzIGZvci4NCiAqIEBwYXJhbSBldmVudERhdGFMaXN0IC0gVGhlIG5ldyBldmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZUV2ZW50c0F0UGF0aChldmVudFF1ZXVlLCBwYXRoLCBldmVudERhdGFMaXN0KSB7DQogICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKGV2ZW50UXVldWUsIGV2ZW50RGF0YUxpc3QpOw0KICAgIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIGV2ZW50UGF0aCA9PiBwYXRoRXF1YWxzKGV2ZW50UGF0aCwgcGF0aCkpOw0KfQ0KLyoqDQogKiBRdWV1ZXMgdGhlIHNwZWNpZmllZCBldmVudHMgYW5kIHN5bmNocm9ub3VzbHkgcmFpc2VzIGFsbCBldmVudHMgKGluY2x1ZGluZyBwcmV2aW91c2x5IHF1ZXVlZCBvbmVzKSBmb3INCiAqIGxvY2F0aW9ucyByZWxhdGVkIHRvIHRoZSBzcGVjaWZpZWQgY2hhbmdlIHBhdGggKGkuZS4gYWxsIGFuY2VzdG9ycyBhbmQgZGVzY2VuZGFudHMpLg0KICoNCiAqIEl0IGlzIGFzc3VtZWQgdGhhdCB0aGUgbmV3IGV2ZW50cyBhcmUgYWxsIHJlbGF0ZWQgKGFuY2VzdG9yIG9yIGRlc2NlbmRhbnQpIHRvIHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAqDQogKiBAcGFyYW0gY2hhbmdlZFBhdGggLSBUaGUgcGF0aCB0byByYWlzZSBldmVudHMgZm9yLg0KICogQHBhcmFtIGV2ZW50RGF0YUxpc3QgLSBUaGUgZXZlbnRzIHRvIHJhaXNlDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKGV2ZW50UXVldWUsIGNoYW5nZWRQYXRoLCBldmVudERhdGFMaXN0KSB7DQogICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKGV2ZW50UXVldWUsIGV2ZW50RGF0YUxpc3QpOw0KICAgIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIGV2ZW50UGF0aCA9PiBwYXRoQ29udGFpbnMoZXZlbnRQYXRoLCBjaGFuZ2VkUGF0aCkgfHwNCiAgICAgICAgcGF0aENvbnRhaW5zKGNoYW5nZWRQYXRoLCBldmVudFBhdGgpKTsNCn0NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIHByZWRpY2F0ZSkgew0KICAgIGV2ZW50UXVldWUucmVjdXJzaW9uRGVwdGhfKys7DQogICAgbGV0IHNlbnRBbGwgPSB0cnVlOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXZlbnRRdWV1ZS5ldmVudExpc3RzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICBjb25zdCBldmVudExpc3QgPSBldmVudFF1ZXVlLmV2ZW50TGlzdHNfW2ldOw0KICAgICAgICBpZiAoZXZlbnRMaXN0KSB7DQogICAgICAgICAgICBjb25zdCBldmVudFBhdGggPSBldmVudExpc3QucGF0aDsNCiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZXZlbnRQYXRoKSkgew0KICAgICAgICAgICAgICAgIGV2ZW50TGlzdFJhaXNlKGV2ZW50UXVldWUuZXZlbnRMaXN0c19baV0pOw0KICAgICAgICAgICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c19baV0gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgc2VudEFsbCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChzZW50QWxsKSB7DQogICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c18gPSBbXTsNCiAgICB9DQogICAgZXZlbnRRdWV1ZS5yZWN1cnNpb25EZXB0aF8tLTsNCn0NCi8qKg0KICogSXRlcmF0ZXMgdGhyb3VnaCB0aGUgbGlzdCBhbmQgcmFpc2VzIGVhY2ggZXZlbnQNCiAqLw0KZnVuY3Rpb24gZXZlbnRMaXN0UmFpc2UoZXZlbnRMaXN0KSB7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBldmVudExpc3QuZXZlbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV2ZW50TGlzdC5ldmVudHNbaV07DQogICAgICAgIGlmIChldmVudERhdGEgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGV2ZW50TGlzdC5ldmVudHNbaV0gPSBudWxsOw0KICAgICAgICAgICAgY29uc3QgZXZlbnRGbiA9IGV2ZW50RGF0YS5nZXRFdmVudFJ1bm5lcigpOw0KICAgICAgICAgICAgaWYgKGxvZ2dlcikgew0KICAgICAgICAgICAgICAgIGxvZygnZXZlbnQ6ICcgKyBldmVudERhdGEudG9TdHJpbmcoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBleGNlcHRpb25HdWFyZChldmVudEZuKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IElOVEVSUlVQVF9SRUFTT04gPSAncmVwb19pbnRlcnJ1cHQnOw0KLyoqDQogKiBJZiBhIHRyYW5zYWN0aW9uIGRvZXMgbm90IHN1Y2NlZWQgYWZ0ZXIgMjUgcmV0cmllcywgd2UgYWJvcnQgaXQuIEFtb25nIG90aGVyDQogKiB0aGluZ3MgdGhpcyBlbnN1cmUgdGhhdCBpZiB0aGVyZSdzIGV2ZXIgYSBidWcgY2F1c2luZyBhIG1pc21hdGNoIGJldHdlZW4NCiAqIGNsaWVudCAvIHNlcnZlciBoYXNoZXMgZm9yIHNvbWUgZGF0YSwgd2Ugd29uJ3QgcmV0cnkgaW5kZWZpbml0ZWx5Lg0KICovDQpjb25zdCBNQVhfVFJBTlNBQ1RJT05fUkVUUklFUyA9IDI1Ow0KLyoqDQogKiBBIGNvbm5lY3Rpb24gdG8gYSBzaW5nbGUgZGF0YSByZXBvc2l0b3J5Lg0KICovDQpjbGFzcyBSZXBvIHsNCiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mb18sIGZvcmNlUmVzdENsaWVudF8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tQcm92aWRlcl8pIHsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18gPSByZXBvSW5mb187DQogICAgICAgIHRoaXMuZm9yY2VSZXN0Q2xpZW50XyA9IGZvcmNlUmVzdENsaWVudF87DQogICAgICAgIHRoaXMuYXV0aFRva2VuUHJvdmlkZXJfID0gYXV0aFRva2VuUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmFwcENoZWNrUHJvdmlkZXJfID0gYXBwQ2hlY2tQcm92aWRlcl87DQogICAgICAgIHRoaXMuZGF0YVVwZGF0ZUNvdW50ID0gMDsNCiAgICAgICAgdGhpcy5zdGF0c0xpc3RlbmVyXyA9IG51bGw7DQogICAgICAgIHRoaXMuZXZlbnRRdWV1ZV8gPSBuZXcgRXZlbnRRdWV1ZSgpOw0KICAgICAgICB0aGlzLm5leHRXcml0ZUlkXyA9IDE7DQogICAgICAgIHRoaXMuaW50ZXJjZXB0U2VydmVyRGF0YUNhbGxiYWNrXyA9IG51bGw7DQogICAgICAgIC8qKiBBIGxpc3Qgb2YgZGF0YSBwaWVjZXMgYW5kIHBhdGhzIHRvIGJlIHNldCB3aGVuIHRoaXMgY2xpZW50IGRpc2Nvbm5lY3RzLiAqLw0KICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKTsNCiAgICAgICAgLyoqIFN0b3JlcyBxdWV1ZXMgb2Ygb3V0c3RhbmRpbmcgdHJhbnNhY3Rpb25zIGZvciBGaXJlYmFzZSBsb2NhdGlvbnMuICovDQogICAgICAgIHRoaXMudHJhbnNhY3Rpb25RdWV1ZVRyZWVfID0gbmV3IFRyZWUoKTsNCiAgICAgICAgLy8gVE9ETzogVGhpcyBzaG91bGQgYmUgQHByaXZhdGUgYnV0IGl0J3MgdXNlZCBieSB0ZXN0X2FjY2Vzcy5qcyBhbmQgaW50ZXJuYWwuanMNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW50Q29ubmVjdGlvbl8gPSBudWxsOw0KICAgICAgICAvLyBUaGlzIGtleSBpcyBpbnRlbnRpb25hbGx5IG5vdCB1cGRhdGVkIGlmIFJlcG9JbmZvIGlzIGxhdGVyIGNoYW5nZWQgb3IgcmVwbGFjZWQNCiAgICAgICAgdGhpcy5rZXkgPSB0aGlzLnJlcG9JbmZvXy50b1VSTFN0cmluZygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgVVJMIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHJvb3Qgb2YgdGhpcyBGaXJlYmFzZS4NCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICgodGhpcy5yZXBvSW5mb18uc2VjdXJlID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykgKyB0aGlzLnJlcG9JbmZvXy5ob3N0KTsNCiAgICB9DQp9DQpmdW5jdGlvbiByZXBvU3RhcnQocmVwbywgYXBwSWQsIGF1dGhPdmVycmlkZSkgew0KICAgIHJlcG8uc3RhdHNfID0gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvLnJlcG9JbmZvXyk7DQogICAgaWYgKHJlcG8uZm9yY2VSZXN0Q2xpZW50XyB8fCBiZWluZ0NyYXdsZWQoKSkgew0KICAgICAgICByZXBvLnNlcnZlcl8gPSBuZXcgUmVhZG9ubHlSZXN0Q2xpZW50KHJlcG8ucmVwb0luZm9fLCAocGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKSA9PiB7DQogICAgICAgICAgICByZXBvT25EYXRhVXBkYXRlKHJlcG8sIHBhdGhTdHJpbmcsIGRhdGEsIGlzTWVyZ2UsIHRhZyk7DQogICAgICAgIH0sIHJlcG8uYXV0aFRva2VuUHJvdmlkZXJfLCByZXBvLmFwcENoZWNrUHJvdmlkZXJfKTsNCiAgICAgICAgLy8gTWlub3IgaGFjazogRmlyZSBvbkNvbm5lY3QgaW1tZWRpYXRlbHksIHNpbmNlIHRoZXJlJ3Mgbm8gYWN0dWFsIGNvbm5lY3Rpb24uDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVwb09uQ29ubmVjdFN0YXR1cyhyZXBvLCAvKiBjb25uZWN0U3RhdHVzPSAqLyB0cnVlKSwgMCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBWYWxpZGF0ZSBhdXRoT3ZlcnJpZGUNCiAgICAgICAgaWYgKHR5cGVvZiBhdXRoT3ZlcnJpZGUgIT09ICd1bmRlZmluZWQnICYmIGF1dGhPdmVycmlkZSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBhdXRoT3ZlcnJpZGUgIT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IG9iamVjdHMgYXJlIHN1cHBvcnRlZCBmb3Igb3B0aW9uIGRhdGFiYXNlQXV0aFZhcmlhYmxlT3ZlcnJpZGUnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgc3RyaW5naWZ5KGF1dGhPdmVycmlkZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhdXRoT3ZlcnJpZGUgcHJvdmlkZWQ6ICcgKyBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXyA9IG5ldyBQZXJzaXN0ZW50Q29ubmVjdGlvbihyZXBvLnJlcG9JbmZvXywgYXBwSWQsIChwYXRoU3RyaW5nLCBkYXRhLCBpc01lcmdlLCB0YWcpID0+IHsNCiAgICAgICAgICAgIHJlcG9PbkRhdGFVcGRhdGUocmVwbywgcGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKTsNCiAgICAgICAgfSwgKGNvbm5lY3RTdGF0dXMpID0+IHsNCiAgICAgICAgICAgIHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgY29ubmVjdFN0YXR1cyk7DQogICAgICAgIH0sICh1cGRhdGVzKSA9PiB7DQogICAgICAgICAgICByZXBvT25TZXJ2ZXJJbmZvVXBkYXRlKHJlcG8sIHVwZGF0ZXMpOw0KICAgICAgICB9LCByZXBvLmF1dGhUb2tlblByb3ZpZGVyXywgcmVwby5hcHBDaGVja1Byb3ZpZGVyXywgYXV0aE92ZXJyaWRlKTsNCiAgICAgICAgcmVwby5zZXJ2ZXJfID0gcmVwby5wZXJzaXN0ZW50Q29ubmVjdGlvbl87DQogICAgfQ0KICAgIHJlcG8uYXV0aFRva2VuUHJvdmlkZXJfLmFkZFRva2VuQ2hhbmdlTGlzdGVuZXIodG9rZW4gPT4gew0KICAgICAgICByZXBvLnNlcnZlcl8ucmVmcmVzaEF1dGhUb2tlbih0b2tlbik7DQogICAgfSk7DQogICAgcmVwby5hcHBDaGVja1Byb3ZpZGVyXy5hZGRUb2tlbkNoYW5nZUxpc3RlbmVyKHJlc3VsdCA9PiB7DQogICAgICAgIHJlcG8uc2VydmVyXy5yZWZyZXNoQXBwQ2hlY2tUb2tlbihyZXN1bHQudG9rZW4pOw0KICAgIH0pOw0KICAgIC8vIEluIHRoZSBjYXNlIG9mIG11bHRpcGxlIFJlcG9zIGZvciB0aGUgc2FtZSByZXBvSW5mbyAoaS5lLiB0aGVyZSBhcmUgbXVsdGlwbGUgRmlyZWJhc2UuQ29udGV4dHMgYmVpbmcgdXNlZCksDQogICAgLy8gd2Ugb25seSB3YW50IHRvIGNyZWF0ZSBvbmUgU3RhdHNSZXBvcnRlci4gIEFzIHN1Y2gsIHdlJ2xsIHJlcG9ydCBzdGF0cyBvdmVyIHRoZSBmaXJzdCBSZXBvIGNyZWF0ZWQuDQogICAgcmVwby5zdGF0c1JlcG9ydGVyXyA9IHN0YXRzTWFuYWdlckdldE9yQ3JlYXRlUmVwb3J0ZXIocmVwby5yZXBvSW5mb18sICgpID0+IG5ldyBTdGF0c1JlcG9ydGVyKHJlcG8uc3RhdHNfLCByZXBvLnNlcnZlcl8pKTsNCiAgICAvLyBVc2VkIGZvciAuaW5mby4NCiAgICByZXBvLmluZm9EYXRhXyA9IG5ldyBTbmFwc2hvdEhvbGRlcigpOw0KICAgIHJlcG8uaW5mb1N5bmNUcmVlXyA9IG5ldyBTeW5jVHJlZSh7DQogICAgICAgIHN0YXJ0TGlzdGVuaW5nOiAocXVlcnksIHRhZywgY3VycmVudEhhc2hGbiwgb25Db21wbGV0ZSkgPT4gew0KICAgICAgICAgICAgbGV0IGluZm9FdmVudHMgPSBbXTsNCiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSByZXBvLmluZm9EYXRhXy5nZXROb2RlKHF1ZXJ5Ll9wYXRoKTsNCiAgICAgICAgICAgIC8vIFRoaXMgaXMgcG9zc2libHkgYSBoYWNrLCBidXQgd2UgaGF2ZSBkaWZmZXJlbnQgc2VtYW50aWNzIGZvciAuaW5mbyBlbmRwb2ludHMuIFdlIGRvbid0IHJhaXNlIG51bGwgZXZlbnRzDQogICAgICAgICAgICAvLyBvbiBpbml0aWFsIGRhdGEuLi4NCiAgICAgICAgICAgIGlmICghbm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBpbmZvRXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLmluZm9TeW5jVHJlZV8sIHF1ZXJ5Ll9wYXRoLCBub2RlKTsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSgnb2snKTsNCiAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpbmZvRXZlbnRzOw0KICAgICAgICB9LA0KICAgICAgICBzdG9wTGlzdGVuaW5nOiAoKSA9PiB7IH0NCiAgICB9KTsNCiAgICByZXBvVXBkYXRlSW5mbyhyZXBvLCAnY29ubmVjdGVkJywgZmFsc2UpOw0KICAgIHJlcG8uc2VydmVyU3luY1RyZWVfID0gbmV3IFN5bmNUcmVlKHsNCiAgICAgICAgc3RhcnRMaXN0ZW5pbmc6IChxdWVyeSwgdGFnLCBjdXJyZW50SGFzaEZuLCBvbkNvbXBsZXRlKSA9PiB7DQogICAgICAgICAgICByZXBvLnNlcnZlcl8ubGlzdGVuKHF1ZXJ5LCBjdXJyZW50SGFzaEZuLCB0YWcsIChzdGF0dXMsIGRhdGEpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBldmVudHMgPSBvbkNvbXBsZXRlKHN0YXR1cywgZGF0YSk7DQogICAgICAgICAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcXVlcnkuX3BhdGgsIGV2ZW50cyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIC8vIE5vIHN5bmNocm9ub3VzIGV2ZW50cyBmb3IgbmV0d29yay1iYWNrZWQgc3luYyB0cmVlcw0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB9LA0KICAgICAgICBzdG9wTGlzdGVuaW5nOiAocXVlcnksIHRhZykgPT4gew0KICAgICAgICAgICAgcmVwby5zZXJ2ZXJfLnVubGlzdGVuKHF1ZXJ5LCB0YWcpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQovKioNCiAqIEByZXR1cm5zIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcywgdGFraW5nIHRoZSBzZXJ2ZXIgb2Zmc2V0IGludG8gYWNjb3VudCBpZiB3ZSBoYXZlIG9uZS4NCiAqLw0KZnVuY3Rpb24gcmVwb1NlcnZlclRpbWUocmVwbykgew0KICAgIGNvbnN0IG9mZnNldE5vZGUgPSByZXBvLmluZm9EYXRhXy5nZXROb2RlKG5ldyBQYXRoKCcuaW5mby9zZXJ2ZXJUaW1lT2Zmc2V0JykpOw0KICAgIGNvbnN0IG9mZnNldCA9IG9mZnNldE5vZGUudmFsKCkgfHwgMDsNCiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBvZmZzZXQ7DQp9DQovKioNCiAqIEdlbmVyYXRlIFNlcnZlclZhbHVlcyB1c2luZyBzb21lIHZhcmlhYmxlcyBmcm9tIHRoZSByZXBvIG9iamVjdC4NCiAqLw0KZnVuY3Rpb24gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pIHsNCiAgICByZXR1cm4gZ2VuZXJhdGVXaXRoVmFsdWVzKHsNCiAgICAgICAgdGltZXN0YW1wOiByZXBvU2VydmVyVGltZShyZXBvKQ0KICAgIH0pOw0KfQ0KLyoqDQogKiBDYWxsZWQgYnkgcmVhbHRpbWUgd2hlbiB3ZSBnZXQgbmV3IG1lc3NhZ2VzIGZyb20gdGhlIHNlcnZlci4NCiAqLw0KZnVuY3Rpb24gcmVwb09uRGF0YVVwZGF0ZShyZXBvLCBwYXRoU3RyaW5nLCBkYXRhLCBpc01lcmdlLCB0YWcpIHsNCiAgICAvLyBGb3IgdGVzdGluZy4NCiAgICByZXBvLmRhdGFVcGRhdGVDb3VudCsrOw0KICAgIGNvbnN0IHBhdGggPSBuZXcgUGF0aChwYXRoU3RyaW5nKTsNCiAgICBkYXRhID0gcmVwby5pbnRlcmNlcHRTZXJ2ZXJEYXRhQ2FsbGJhY2tfDQogICAgICAgID8gcmVwby5pbnRlcmNlcHRTZXJ2ZXJEYXRhQ2FsbGJhY2tfKHBhdGhTdHJpbmcsIGRhdGEpDQogICAgICAgIDogZGF0YTsNCiAgICBsZXQgZXZlbnRzID0gW107DQogICAgaWYgKHRhZykgew0KICAgICAgICBpZiAoaXNNZXJnZSkgew0KICAgICAgICAgICAgY29uc3QgdGFnZ2VkQ2hpbGRyZW4gPSBtYXAkMShkYXRhLCAocmF3KSA9PiBub2RlRnJvbUpTT04ocmF3KSk7DQogICAgICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5VGFnZ2VkUXVlcnlNZXJnZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgdGFnZ2VkQ2hpbGRyZW4sIHRhZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCB0YWdnZWRTbmFwID0gbm9kZUZyb21KU09OKGRhdGEpOw0KICAgICAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBcHBseVRhZ2dlZFF1ZXJ5T3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCB0YWdnZWRTbmFwLCB0YWcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKGlzTWVyZ2UpIHsNCiAgICAgICAgY29uc3QgY2hhbmdlZENoaWxkcmVuID0gbWFwJDEoZGF0YSwgKHJhdykgPT4gbm9kZUZyb21KU09OKHJhdykpOw0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyTWVyZ2UocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIGNoYW5nZWRDaGlsZHJlbik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBzbmFwID0gbm9kZUZyb21KU09OKGRhdGEpOw0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBzbmFwKTsNCiAgICB9DQogICAgbGV0IGFmZmVjdGVkUGF0aCA9IHBhdGg7DQogICAgaWYgKGV2ZW50cy5sZW5ndGggPiAwKSB7DQogICAgICAgIC8vIFNpbmNlIHdlIGhhdmUgYSBsaXN0ZW5lciBvdXRzdGFuZGluZyBmb3IgZWFjaCB0cmFuc2FjdGlvbiwgcmVjZWl2aW5nIGFueSBldmVudHMNCiAgICAgICAgLy8gaXMgYSBwcm94eSBmb3Igc29tZSBjaGFuZ2UgaGF2aW5nIG9jY3VycmVkLg0KICAgICAgICBhZmZlY3RlZFBhdGggPSByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgfQ0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIGFmZmVjdGVkUGF0aCwgZXZlbnRzKTsNCn0NCmZ1bmN0aW9uIHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgY29ubmVjdFN0YXR1cykgew0KICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sICdjb25uZWN0ZWQnLCBjb25uZWN0U3RhdHVzKTsNCiAgICBpZiAoY29ubmVjdFN0YXR1cyA9PT0gZmFsc2UpIHsNCiAgICAgICAgcmVwb1J1bk9uRGlzY29ubmVjdEV2ZW50cyhyZXBvKTsNCiAgICB9DQp9DQpmdW5jdGlvbiByZXBvT25TZXJ2ZXJJbmZvVXBkYXRlKHJlcG8sIHVwZGF0ZXMpIHsNCiAgICBlYWNoKHVwZGF0ZXMsIChrZXksIHZhbHVlKSA9PiB7DQogICAgICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sIGtleSwgdmFsdWUpOw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcmVwb1VwZGF0ZUluZm8ocmVwbywgcGF0aFN0cmluZywgdmFsdWUpIHsNCiAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgoJy8uaW5mby8nICsgcGF0aFN0cmluZyk7DQogICAgY29uc3QgbmV3Tm9kZSA9IG5vZGVGcm9tSlNPTih2YWx1ZSk7DQogICAgcmVwby5pbmZvRGF0YV8udXBkYXRlU25hcHNob3QocGF0aCwgbmV3Tm9kZSk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLmluZm9TeW5jVHJlZV8sIHBhdGgsIG5ld05vZGUpOw0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHBhdGgsIGV2ZW50cyk7DQp9DQpmdW5jdGlvbiByZXBvR2V0TmV4dFdyaXRlSWQocmVwbykgew0KICAgIHJldHVybiByZXBvLm5leHRXcml0ZUlkXysrOw0KfQ0KZnVuY3Rpb24gcmVwb1NldFdpdGhQcmlvcml0eShyZXBvLCBwYXRoLCBuZXdWYWwsIG5ld1ByaW9yaXR5LCBvbkNvbXBsZXRlKSB7DQogICAgcmVwb0xvZyhyZXBvLCAnc2V0Jywgew0KICAgICAgICBwYXRoOiBwYXRoLnRvU3RyaW5nKCksDQogICAgICAgIHZhbHVlOiBuZXdWYWwsDQogICAgICAgIHByaW9yaXR5OiBuZXdQcmlvcml0eQ0KICAgIH0pOw0KICAgIC8vIFRPRE86IE9wdGltaXplIHRoaXMgYmVoYXZpb3IgdG8gZWl0aGVyIChhKSBzdG9yZSBmbGFnIHRvIHNraXAgcmVzb2x2aW5nIHdoZXJlIHBvc3NpYmxlIGFuZCAvIG9yDQogICAgLy8gKGIpIHN0b3JlIHVucmVzb2x2ZWQgcGF0aHMgb24gSlNPTiBwYXJzZQ0KICAgIGNvbnN0IHNlcnZlclZhbHVlcyA9IHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKTsNCiAgICBjb25zdCBuZXdOb2RlVW5yZXNvbHZlZCA9IG5vZGVGcm9tSlNPTihuZXdWYWwsIG5ld1ByaW9yaXR5KTsNCiAgICBjb25zdCBleGlzdGluZyA9IHN5bmNUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCk7DQogICAgY29uc3QgbmV3Tm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QobmV3Tm9kZVVucmVzb2x2ZWQsIGV4aXN0aW5nLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIGNvbnN0IHdyaXRlSWQgPSByZXBvR2V0TmV4dFdyaXRlSWQocmVwbyk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIG5ld05vZGUsIHdyaXRlSWQsIHRydWUpOw0KICAgIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhyZXBvLmV2ZW50UXVldWVfLCBldmVudHMpOw0KICAgIHJlcG8uc2VydmVyXy5wdXQocGF0aC50b1N0cmluZygpLCBuZXdOb2RlVW5yZXNvbHZlZC52YWwoLypleHBvcnQ9Ki8gdHJ1ZSksIChzdGF0dXMsIGVycm9yUmVhc29uKSA9PiB7DQogICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBzdGF0dXMgPT09ICdvayc7DQogICAgICAgIGlmICghc3VjY2Vzcykgew0KICAgICAgICAgICAgd2Fybignc2V0IGF0ICcgKyBwYXRoICsgJyBmYWlsZWQ6ICcgKyBzdGF0dXMpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGNsZWFyRXZlbnRzID0gc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHdyaXRlSWQsICFzdWNjZXNzKTsNCiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgY2xlYXJFdmVudHMpOw0KICAgICAgICByZXBvQ2FsbE9uQ29tcGxldGVDYWxsYmFjayhyZXBvLCBvbkNvbXBsZXRlLCBzdGF0dXMsIGVycm9yUmVhc29uKTsNCiAgICB9KTsNCiAgICBjb25zdCBhZmZlY3RlZFBhdGggPSByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIGFmZmVjdGVkUGF0aCk7DQogICAgLy8gV2UgcXVldWVkIHRoZSBldmVudHMgYWJvdmUsIHNvIGp1c3QgZmx1c2ggdGhlIHF1ZXVlIGhlcmUNCiAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCBhZmZlY3RlZFBhdGgsIFtdKTsNCn0NCi8qKg0KICogQXBwbGllcyBhbGwgb2YgdGhlIGNoYW5nZXMgc3RvcmVkIHVwIGluIHRoZSBvbkRpc2Nvbm5lY3RfIHRyZWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9SdW5PbkRpc2Nvbm5lY3RFdmVudHMocmVwbykgew0KICAgIHJlcG9Mb2cocmVwbywgJ29uRGlzY29ubmVjdEV2ZW50cycpOw0KICAgIGNvbnN0IHNlcnZlclZhbHVlcyA9IHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKTsNCiAgICBjb25zdCByZXNvbHZlZE9uRGlzY29ubmVjdFRyZWUgPSBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKTsNCiAgICBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoVHJlZShyZXBvLm9uRGlzY29ubmVjdF8sIG5ld0VtcHR5UGF0aCgpLCAocGF0aCwgbm9kZSkgPT4gew0KICAgICAgICBjb25zdCByZXNvbHZlZCA9IHJlc29sdmVEZWZlcnJlZFZhbHVlVHJlZShwYXRoLCBub2RlLCByZXBvLnNlcnZlclN5bmNUcmVlXywgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIocmVzb2x2ZWRPbkRpc2Nvbm5lY3RUcmVlLCBwYXRoLCByZXNvbHZlZCk7DQogICAgfSk7DQogICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHJlc29sdmVkT25EaXNjb25uZWN0VHJlZSwgbmV3RW1wdHlQYXRoKCksIChwYXRoLCBzbmFwKSA9PiB7DQogICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgc25hcCkpOw0KICAgICAgICBjb25zdCBhZmZlY3RlZFBhdGggPSByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgICAgIHJlcG9SZXJ1blRyYW5zYWN0aW9ucyhyZXBvLCBhZmZlY3RlZFBhdGgpOw0KICAgIH0pOw0KICAgIHJlcG8ub25EaXNjb25uZWN0XyA9IG5ld1NwYXJzZVNuYXBzaG90VHJlZSgpOw0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIG5ld0VtcHR5UGF0aCgpLCBldmVudHMpOw0KfQ0KZnVuY3Rpb24gcmVwb0FkZEV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHsNCiAgICBsZXQgZXZlbnRzOw0KICAgIGlmIChwYXRoR2V0RnJvbnQocXVlcnkuX3BhdGgpID09PSAnLmluZm8nKSB7DQogICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlQWRkRXZlbnRSZWdpc3RyYXRpb24ocmVwby5pbmZvU3luY1RyZWVfLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBZGRFdmVudFJlZ2lzdHJhdGlvbihyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTsNCiAgICB9DQogICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzQXRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHF1ZXJ5Ll9wYXRoLCBldmVudHMpOw0KfQ0KZnVuY3Rpb24gcmVwb1JlbW92ZUV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHsNCiAgICAvLyBUaGVzZSBhcmUgZ3VhcmFudGVlZCBub3QgdG8gcmFpc2UgZXZlbnRzLCBzaW5jZSB3ZSdyZSBub3QgcGFzc2luZyBpbiBhIGNhbmNlbEVycm9yLiBIb3dldmVyLCB3ZSBjYW4gZnV0dXJlLXByb29mDQogICAgLy8gYSBsaXR0bGUgYml0IGJ5IGhhbmRsaW5nIHRoZSByZXR1cm4gdmFsdWVzIGFueXdheXMuDQogICAgbGV0IGV2ZW50czsNCiAgICBpZiAocGF0aEdldEZyb250KHF1ZXJ5Ll9wYXRoKSA9PT0gJy5pbmZvJykgew0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZVJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHJlcG8uaW5mb1N5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlUmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24ocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbik7DQogICAgfQ0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0F0UGF0aChyZXBvLmV2ZW50UXVldWVfLCBxdWVyeS5fcGF0aCwgZXZlbnRzKTsNCn0NCmZ1bmN0aW9uIHJlcG9JbnRlcnJ1cHQocmVwbykgew0KICAgIGlmIChyZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXykgew0KICAgICAgICByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXy5pbnRlcnJ1cHQoSU5URVJSVVBUX1JFQVNPTik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcmVwb0xvZyhyZXBvLCAuLi52YXJBcmdzKSB7DQogICAgbGV0IHByZWZpeCA9ICcnOw0KICAgIGlmIChyZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXykgew0KICAgICAgICBwcmVmaXggPSByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXy5pZCArICc6JzsNCiAgICB9DQogICAgbG9nKHByZWZpeCwgLi4udmFyQXJncyk7DQp9DQpmdW5jdGlvbiByZXBvQ2FsbE9uQ29tcGxldGVDYWxsYmFjayhyZXBvLCBjYWxsYmFjaywgc3RhdHVzLCBlcnJvclJlYXNvbikgew0KICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgICBleGNlcHRpb25HdWFyZCgoKSA9PiB7DQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7DQogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gKHN0YXR1cyB8fCAnZXJyb3InKS50b1VwcGVyQ2FzZSgpOw0KICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gY29kZTsNCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JSZWFzb24pIHsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSAnOiAnICsgZXJyb3JSZWFzb247DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgZXJyb3IuY29kZSA9IGNvZGU7DQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEBwYXJhbSBleGNsdWRlU2V0cyAtIEEgc3BlY2lmaWMgc2V0IHRvIGV4Y2x1ZGUNCiAqLw0KZnVuY3Rpb24gcmVwb0dldExhdGVzdFN0YXRlKHJlcG8sIHBhdGgsIGV4Y2x1ZGVTZXRzKSB7DQogICAgcmV0dXJuIChzeW5jVHJlZUNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIGV4Y2x1ZGVTZXRzKSB8fA0KICAgICAgICBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7DQp9DQovKioNCiAqIFNlbmRzIGFueSBhbHJlYWR5LXJ1biB0cmFuc2FjdGlvbnMgdGhhdCBhcmVuJ3Qgd2FpdGluZyBmb3Igb3V0c3RhbmRpbmcNCiAqIHRyYW5zYWN0aW9ucyB0byBjb21wbGV0ZS4NCiAqDQogKiBFeHRlcm5hbGx5IGl0J3MgY2FsbGVkIHdpdGggbm8gYXJndW1lbnRzLCBidXQgaXQgY2FsbHMgaXRzZWxmIHJlY3Vyc2l2ZWx5DQogKiB3aXRoIGEgcGFydGljdWxhciB0cmFuc2FjdGlvblF1ZXVlVHJlZSBub2RlIHRvIHJlY3Vyc2UgdGhyb3VnaCB0aGUgdHJlZS4NCiAqDQogKiBAcGFyYW0gbm9kZSAtIHRyYW5zYWN0aW9uUXVldWVUcmVlIG5vZGUgdG8gc3RhcnQgYXQuDQogKi8NCmZ1bmN0aW9uIHJlcG9TZW5kUmVhZHlUcmFuc2FjdGlvbnMocmVwbywgbm9kZSA9IHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfKSB7DQogICAgLy8gQmVmb3JlIHJlY3Vyc2luZywgbWFrZSBzdXJlIGFueSBjb21wbGV0ZWQgdHJhbnNhY3Rpb25zIGFyZSByZW1vdmVkLg0KICAgIGlmICghbm9kZSkgew0KICAgICAgICByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgbm9kZSk7DQogICAgfQ0KICAgIGlmICh0cmVlR2V0VmFsdWUobm9kZSkpIHsNCiAgICAgICAgY29uc3QgcXVldWUgPSByZXBvQnVpbGRUcmFuc2FjdGlvblF1ZXVlKHJlcG8sIG5vZGUpOw0KICAgICAgICBhc3NlcnQocXVldWUubGVuZ3RoID4gMCwgJ1NlbmRpbmcgemVybyBsZW5ndGggdHJhbnNhY3Rpb24gcXVldWUnKTsNCiAgICAgICAgY29uc3QgYWxsUnVuID0gcXVldWUuZXZlcnkoKHRyYW5zYWN0aW9uKSA9PiB0cmFuc2FjdGlvbi5zdGF0dXMgPT09IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovKTsNCiAgICAgICAgLy8gSWYgdGhleSdyZSBhbGwgcnVuIChhbmQgbm90IHNlbnQpLCB3ZSBjYW4gc2VuZCB0aGVtLiAgRWxzZSwgd2UgbXVzdCB3YWl0Lg0KICAgICAgICBpZiAoYWxsUnVuKSB7DQogICAgICAgICAgICByZXBvU2VuZFRyYW5zYWN0aW9uUXVldWUocmVwbywgdHJlZUdldFBhdGgobm9kZSksIHF1ZXVlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmICh0cmVlSGFzQ2hpbGRyZW4obm9kZSkpIHsNCiAgICAgICAgdHJlZUZvckVhY2hDaGlsZChub2RlLCBjaGlsZE5vZGUgPT4gew0KICAgICAgICAgICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCBjaGlsZE5vZGUpOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEdpdmVuIGEgbGlzdCBvZiBydW4gdHJhbnNhY3Rpb25zLCBzZW5kIHRoZW0gdG8gdGhlIHNlcnZlciBhbmQgdGhlbiBoYW5kbGUNCiAqIHRoZSByZXN1bHQgKHN1Y2Nlc3Mgb3IgZmFpbHVyZSkuDQogKg0KICogQHBhcmFtIHBhdGggLSBUaGUgbG9jYXRpb24gb2YgdGhlIHF1ZXVlLg0KICogQHBhcmFtIHF1ZXVlIC0gUXVldWUgb2YgdHJhbnNhY3Rpb25zIHVuZGVyIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24uDQogKi8NCmZ1bmN0aW9uIHJlcG9TZW5kVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCBwYXRoLCBxdWV1ZSkgew0KICAgIC8vIE1hcmsgdHJhbnNhY3Rpb25zIGFzIHNlbnQgYW5kIGluY3JlbWVudCByZXRyeSBjb3VudCENCiAgICBjb25zdCBzZXRzVG9JZ25vcmUgPSBxdWV1ZS5tYXAodHhuID0+IHsNCiAgICAgICAgcmV0dXJuIHR4bi5jdXJyZW50V3JpdGVJZDsNCiAgICB9KTsNCiAgICBjb25zdCBsYXRlc3RTdGF0ZSA9IHJlcG9HZXRMYXRlc3RTdGF0ZShyZXBvLCBwYXRoLCBzZXRzVG9JZ25vcmUpOw0KICAgIGxldCBzbmFwVG9TZW5kID0gbGF0ZXN0U3RhdGU7DQogICAgY29uc3QgbGF0ZXN0SGFzaCA9IGxhdGVzdFN0YXRlLmhhc2goKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IHR4biA9IHF1ZXVlW2ldOw0KICAgICAgICBhc3NlcnQodHhuLnN0YXR1cyA9PT0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi8sICd0cnlUb1NlbmRUcmFuc2FjdGlvblF1ZXVlXzogaXRlbXMgaW4gcXVldWUgc2hvdWxkIGFsbCBiZSBydW4uJyk7DQogICAgICAgIHR4bi5zdGF0dXMgPSAxIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlNFTlQgKi87DQogICAgICAgIHR4bi5yZXRyeUNvdW50Kys7DQogICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChwYXRoLCB0eG4ucGF0aCk7DQogICAgICAgIC8vIElmIHdlJ3ZlIGdvdHRlbiB0byB0aGlzIHBvaW50LCB0aGUgb3V0cHV0IHNuYXBzaG90IG11c3QgYmUgZGVmaW5lZC4NCiAgICAgICAgc25hcFRvU2VuZCA9IHNuYXBUb1NlbmQudXBkYXRlQ2hpbGQocmVsYXRpdmVQYXRoIC8qKiBAdHlwZSB7IU5vZGV9ICovLCB0eG4uY3VycmVudE91dHB1dFNuYXBzaG90UmF3KTsNCiAgICB9DQogICAgY29uc3QgZGF0YVRvU2VuZCA9IHNuYXBUb1NlbmQudmFsKHRydWUpOw0KICAgIGNvbnN0IHBhdGhUb1NlbmQgPSBwYXRoOw0KICAgIC8vIFNlbmQgdGhlIHB1dC4NCiAgICByZXBvLnNlcnZlcl8ucHV0KHBhdGhUb1NlbmQudG9TdHJpbmcoKSwgZGF0YVRvU2VuZCwgKHN0YXR1cykgPT4gew0KICAgICAgICByZXBvTG9nKHJlcG8sICd0cmFuc2FjdGlvbiBwdXQgcmVzcG9uc2UnLCB7DQogICAgICAgICAgICBwYXRoOiBwYXRoVG9TZW5kLnRvU3RyaW5nKCksDQogICAgICAgICAgICBzdGF0dXMNCiAgICAgICAgfSk7DQogICAgICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykgew0KICAgICAgICAgICAgLy8gUXVldWUgdXAgdGhlIGNhbGxiYWNrcyBhbmQgZmlyZSB0aGVtIGFmdGVyIGNsZWFuaW5nIHVwIGFsbCBvZiBvdXINCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHN0YXRlLCBzaW5jZSB0aGUgY2FsbGJhY2sgY291bGQgdHJpZ2dlciBtb3JlDQogICAgICAgICAgICAvLyB0cmFuc2FjdGlvbnMgb3Igc2V0cy4NCiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtdOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDIgLyogVHJhbnNhY3Rpb25TdGF0dXMuQ09NUExFVEVEICovOw0KICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXVlW2ldLmN1cnJlbnRXcml0ZUlkKSk7DQogICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLm9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmV2ZXIgdW5zZXQgdGhlIG91dHB1dCBzbmFwc2hvdCwgYW5kIGdpdmVuIHRoYXQgdGhpcw0KICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiBpcyBjb21wbGV0ZSwgaXQgc2hvdWxkIGJlIHNldA0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MucHVzaCgoKSA9PiBxdWV1ZVtpXS5vbkNvbXBsZXRlKG51bGwsIHRydWUsIHF1ZXVlW2ldLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJlc29sdmVkKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnVud2F0Y2hlcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gTm93IHJlbW92ZSB0aGUgY29tcGxldGVkIHRyYW5zYWN0aW9ucy4NCiAgICAgICAgICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCB0cmVlU3ViVHJlZShyZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXywgcGF0aCkpOw0KICAgICAgICAgICAgLy8gVGhlcmUgbWF5IGJlIHBlbmRpbmcgdHJhbnNhY3Rpb25zIHRoYXQgd2UgY2FuIG5vdyBzZW5kLg0KICAgICAgICAgICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7DQogICAgICAgICAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCBwYXRoLCBldmVudHMpOw0KICAgICAgICAgICAgLy8gRmluYWxseSwgdHJpZ2dlciBvbkNvbXBsZXRlIGNhbGxiYWNrcy4NCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoY2FsbGJhY2tzW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9ucyBhcmUgbm8gbG9uZ2VyIHNlbnQuICBVcGRhdGUgdGhlaXIgc3RhdHVzIGFwcHJvcHJpYXRlbHkuDQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnZGF0YXN0YWxlJykgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLnN0YXR1cyA9PT0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZVtpXS5zdGF0dXMgPSA0IC8qIFRyYW5zYWN0aW9uU3RhdHVzLk5FRURTX0FCT1JUICovOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi87DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB3YXJuKCd0cmFuc2FjdGlvbiBhdCAnICsgcGF0aFRvU2VuZC50b1N0cmluZygpICsgJyBmYWlsZWQ6ICcgKyBzdGF0dXMpOw0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gNCAvKiBUcmFuc2FjdGlvblN0YXR1cy5ORUVEU19BQk9SVCAqLzsNCiAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uYWJvcnRSZWFzb24gPSBzdGF0dXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIHBhdGgpOw0KICAgICAgICB9DQogICAgfSwgbGF0ZXN0SGFzaCk7DQp9DQovKioNCiAqIEZpbmRzIGFsbCB0cmFuc2FjdGlvbnMgZGVwZW5kZW50IG9uIHRoZSBkYXRhIGF0IGNoYW5nZWRQYXRoIGFuZCByZXJ1bnMgdGhlbS4NCiAqDQogKiBTaG91bGQgYmUgY2FsbGVkIGFueSB0aW1lIGNhY2hlZCBkYXRhIGNoYW5nZXMuDQogKg0KICogUmV0dXJuIHRoZSBoaWdoZXN0IHBhdGggdGhhdCB3YXMgYWZmZWN0ZWQgYnkgcmVydW5uaW5nIHRyYW5zYWN0aW9ucy4gVGhpcw0KICogaXMgdGhlIHBhdGggYXQgd2hpY2ggZXZlbnRzIG5lZWQgdG8gYmUgcmFpc2VkIGZvci4NCiAqDQogKiBAcGFyYW0gY2hhbmdlZFBhdGggLSBUaGUgcGF0aCBpbiBtZXJnZWREYXRhIHRoYXQgY2hhbmdlZC4NCiAqIEByZXR1cm5zIFRoZSByb290bW9zdCBwYXRoIHRoYXQgd2FzIGFmZmVjdGVkIGJ5IHJlcnVubmluZyB0cmFuc2FjdGlvbnMuDQogKi8NCmZ1bmN0aW9uIHJlcG9SZXJ1blRyYW5zYWN0aW9ucyhyZXBvLCBjaGFuZ2VkUGF0aCkgew0KICAgIGNvbnN0IHJvb3RNb3N0VHJhbnNhY3Rpb25Ob2RlID0gcmVwb0dldEFuY2VzdG9yVHJhbnNhY3Rpb25Ob2RlKHJlcG8sIGNoYW5nZWRQYXRoKTsNCiAgICBjb25zdCBwYXRoID0gdHJlZUdldFBhdGgocm9vdE1vc3RUcmFuc2FjdGlvbk5vZGUpOw0KICAgIGNvbnN0IHF1ZXVlID0gcmVwb0J1aWxkVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCByb290TW9zdFRyYW5zYWN0aW9uTm9kZSk7DQogICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCBxdWV1ZSwgcGF0aCk7DQogICAgcmV0dXJuIHBhdGg7DQp9DQovKioNCiAqIERvZXMgYWxsIHRoZSB3b3JrIG9mIHJlcnVubmluZyB0cmFuc2FjdGlvbnMgKGFzIHdlbGwgYXMgY2xlYW5zIHVwIGFib3J0ZWQNCiAqIHRyYW5zYWN0aW9ucyBhbmQgd2hhdG5vdCkuDQogKg0KICogQHBhcmFtIHF1ZXVlIC0gVGhlIHF1ZXVlIG9mIHRyYW5zYWN0aW9ucyB0byBydW4uDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRoZSBxdWV1ZSBpcyBmb3IuDQogKi8NCmZ1bmN0aW9uIHJlcG9SZXJ1blRyYW5zYWN0aW9uUXVldWUocmVwbywgcXVldWUsIHBhdGgpIHsNCiAgICBpZiAocXVldWUubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybjsgLy8gTm90aGluZyB0byBkbyENCiAgICB9DQogICAgLy8gUXVldWUgdXAgdGhlIGNhbGxiYWNrcyBhbmQgZmlyZSB0aGVtIGFmdGVyIGNsZWFuaW5nIHVwIGFsbCBvZiBvdXINCiAgICAvLyB0cmFuc2FjdGlvbiBzdGF0ZSwgc2luY2UgdGhlIGNhbGxiYWNrIGNvdWxkIHRyaWdnZXIgbW9yZSB0cmFuc2FjdGlvbnMgb3INCiAgICAvLyBzZXRzLg0KICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtdOw0KICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAvLyBJZ25vcmUgYWxsIG9mIHRoZSBzZXRzIHdlJ3JlIGdvaW5nIHRvIHJlLXJ1bi4NCiAgICBjb25zdCB0eG5zVG9SZXJ1biA9IHF1ZXVlLmZpbHRlcihxID0+IHsNCiAgICAgICAgcmV0dXJuIHEuc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLzsNCiAgICB9KTsNCiAgICBjb25zdCBzZXRzVG9JZ25vcmUgPSB0eG5zVG9SZXJ1bi5tYXAocSA9PiB7DQogICAgICAgIHJldHVybiBxLmN1cnJlbnRXcml0ZUlkOw0KICAgIH0pOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBxdWV1ZVtpXTsNCiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGgsIHRyYW5zYWN0aW9uLnBhdGgpOw0KICAgICAgICBsZXQgYWJvcnRUcmFuc2FjdGlvbiA9IGZhbHNlLCBhYm9ydFJlYXNvbjsNCiAgICAgICAgYXNzZXJ0KHJlbGF0aXZlUGF0aCAhPT0gbnVsbCwgJ3JlcnVuVHJhbnNhY3Rpb25zVW5kZXJOb2RlXzogcmVsYXRpdmVQYXRoIHNob3VsZCBub3QgYmUgbnVsbC4nKTsNCiAgICAgICAgaWYgKHRyYW5zYWN0aW9uLnN0YXR1cyA9PT0gNCAvKiBUcmFuc2FjdGlvblN0YXR1cy5ORUVEU19BQk9SVCAqLykgew0KICAgICAgICAgICAgYWJvcnRUcmFuc2FjdGlvbiA9IHRydWU7DQogICAgICAgICAgICBhYm9ydFJlYXNvbiA9IHRyYW5zYWN0aW9uLmFib3J0UmVhc29uOw0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRydWUpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0cmFuc2FjdGlvbi5zdGF0dXMgPT09IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovKSB7DQogICAgICAgICAgICBpZiAodHJhbnNhY3Rpb24ucmV0cnlDb3VudCA+PSBNQVhfVFJBTlNBQ1RJT05fUkVUUklFUykgew0KICAgICAgICAgICAgICAgIGFib3J0VHJhbnNhY3Rpb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGFib3J0UmVhc29uID0gJ21heHJldHJ5JzsNCiAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZCwgdHJ1ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBjb2RlIHJlcnVucyBhIHRyYW5zYWN0aW9uDQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE5vZGUgPSByZXBvR2V0TGF0ZXN0U3RhdGUocmVwbywgdHJhbnNhY3Rpb24ucGF0aCwgc2V0c1RvSWdub3JlKTsNCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50SW5wdXRTbmFwc2hvdCA9IGN1cnJlbnROb2RlOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBxdWV1ZVtpXS51cGRhdGUoY3VycmVudE5vZGUudmFsKCkpOw0KICAgICAgICAgICAgICAgIGlmIChuZXdEYXRhICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoJ3RyYW5zYWN0aW9uIGZhaWxlZDogRGF0YSByZXR1cm5lZCAnLCBuZXdEYXRhLCB0cmFuc2FjdGlvbi5wYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0RhdGFOb2RlID0gbm9kZUZyb21KU09OKG5ld0RhdGEpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNFeHBsaWNpdFByaW9yaXR5ID0gdHlwZW9mIG5ld0RhdGEgPT09ICdvYmplY3QnICYmDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhICE9IG51bGwgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zKG5ld0RhdGEsICcucHJpb3JpdHknKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNFeHBsaWNpdFByaW9yaXR5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHRoZSBvbGQgcHJpb3JpdHkgaWYgdGhlcmUgd2Fzbid0IGEgcHJpb3JpdHkgZXhwbGljaXRseSBzcGVjaWZpZWQuDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhTm9kZSA9IG5ld0RhdGFOb2RlLnVwZGF0ZVByaW9yaXR5KGN1cnJlbnROb2RlLmdldFByaW9yaXR5KCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFdyaXRlSWQgPSB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VydmVyVmFsdWVzID0gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdOb2RlUmVzb2x2ZWQgPSByZXNvbHZlRGVmZXJyZWRWYWx1ZVNuYXBzaG90KG5ld0RhdGFOb2RlLCBjdXJyZW50Tm9kZSwgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudE91dHB1dFNuYXBzaG90UmF3ID0gbmV3RGF0YU5vZGU7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJlc29sdmVkID0gbmV3Tm9kZVJlc29sdmVkOw0KICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZCA9IHJlcG9HZXROZXh0V3JpdGVJZChyZXBvKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gTXV0YXRlcyBzZXRzVG9JZ25vcmUgaW4gcGxhY2UNCiAgICAgICAgICAgICAgICAgICAgc2V0c1RvSWdub3JlLnNwbGljZShzZXRzVG9JZ25vcmUuaW5kZXhPZihvbGRXcml0ZUlkKSwgMSk7DQogICAgICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHRyYW5zYWN0aW9uLnBhdGgsIG5ld05vZGVSZXNvbHZlZCwgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRyYW5zYWN0aW9uLmFwcGx5TG9jYWxseSkpOw0KICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBvbGRXcml0ZUlkLCB0cnVlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhYm9ydFRyYW5zYWN0aW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgYWJvcnRSZWFzb24gPSAnbm9kYXRhJzsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRydWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgZXZlbnRzKTsNCiAgICAgICAgZXZlbnRzID0gW107DQogICAgICAgIGlmIChhYm9ydFRyYW5zYWN0aW9uKSB7DQogICAgICAgICAgICAvLyBBYm9ydC4NCiAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDIgLyogVHJhbnNhY3Rpb25TdGF0dXMuQ09NUExFVEVEICovOw0KICAgICAgICAgICAgLy8gUmVtb3ZpbmcgYSBsaXN0ZW5lciBjYW4gdHJpZ2dlciBwcnVuaW5nIHdoaWNoIGNhbiBtdWNrIHdpdGgNCiAgICAgICAgICAgIC8vIG1lcmdlZERhdGEvdmlzaWJsZURhdGEgKGFzIGl0IHBydW5lcyBkYXRhKS4gU28gZGVmZXIgdGhlIHVud2F0Y2hlcg0KICAgICAgICAgICAgLy8gdW50aWwgd2UncmUgZG9uZS4NCiAgICAgICAgICAgIChmdW5jdGlvbiAodW53YXRjaGVyKSB7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dCh1bndhdGNoZXIsIE1hdGguZmxvb3IoMCkpOw0KICAgICAgICAgICAgfSkocXVldWVbaV0udW53YXRjaGVyKTsNCiAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgaWYgKGFib3J0UmVhc29uID09PSAnbm9kYXRhJykgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MucHVzaCgoKSA9PiBxdWV1ZVtpXS5vbkNvbXBsZXRlKG51bGwsIGZhbHNlLCBxdWV1ZVtpXS5jdXJyZW50SW5wdXRTbmFwc2hvdCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goKCkgPT4gcXVldWVbaV0ub25Db21wbGV0ZShuZXcgRXJyb3IoYWJvcnRSZWFzb24pLCBmYWxzZSwgbnVsbCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyBDbGVhbiB1cCBjb21wbGV0ZWQgdHJhbnNhY3Rpb25zLg0KICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7DQogICAgLy8gTm93IGZpcmUgY2FsbGJhY2tzLCBub3cgdGhhdCB3ZSdyZSBpbiBhIGdvb2QsIGtub3duIHN0YXRlLg0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGV4Y2VwdGlvbkd1YXJkKGNhbGxiYWNrc1tpXSk7DQogICAgfQ0KICAgIC8vIFRyeSB0byBzZW5kIHRoZSB0cmFuc2FjdGlvbiByZXN1bHQgdG8gdGhlIHNlcnZlci4NCiAgICByZXBvU2VuZFJlYWR5VHJhbnNhY3Rpb25zKHJlcG8sIHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfKTsNCn0NCi8qKg0KICogUmV0dXJucyB0aGUgcm9vdG1vc3QgYW5jZXN0b3Igbm9kZSBvZiB0aGUgc3BlY2lmaWVkIHBhdGggdGhhdCBoYXMgYSBwZW5kaW5nDQogKiB0cmFuc2FjdGlvbiBvbiBpdCwgb3IganVzdCByZXR1cm5zIHRoZSBub2RlIGZvciB0aGUgZ2l2ZW4gcGF0aCBpZiB0aGVyZSBhcmUNCiAqIG5vIHBlbmRpbmcgdHJhbnNhY3Rpb25zIG9uIGFueSBhbmNlc3Rvci4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBsb2NhdGlvbiB0byBzdGFydCBhdC4NCiAqIEByZXR1cm5zIFRoZSByb290bW9zdCBub2RlIHdpdGggYSB0cmFuc2FjdGlvbi4NCiAqLw0KZnVuY3Rpb24gcmVwb0dldEFuY2VzdG9yVHJhbnNhY3Rpb25Ob2RlKHJlcG8sIHBhdGgpIHsNCiAgICBsZXQgZnJvbnQ7DQogICAgLy8gU3RhcnQgYXQgdGhlIHJvb3QgYW5kIHdhbGsgZGVlcGVyIGludG8gdGhlIHRyZWUgdG93YXJkcyBwYXRoIHVudGlsIHdlDQogICAgLy8gZmluZCBhIG5vZGUgd2l0aCBwZW5kaW5nIHRyYW5zYWN0aW9ucy4NCiAgICBsZXQgdHJhbnNhY3Rpb25Ob2RlID0gcmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV87DQogICAgZnJvbnQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgd2hpbGUgKGZyb250ICE9PSBudWxsICYmIHRyZWVHZXRWYWx1ZSh0cmFuc2FjdGlvbk5vZGUpID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdHJhbnNhY3Rpb25Ob2RlID0gdHJlZVN1YlRyZWUodHJhbnNhY3Rpb25Ob2RlLCBmcm9udCk7DQogICAgICAgIHBhdGggPSBwYXRoUG9wRnJvbnQocGF0aCk7DQogICAgICAgIGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpOw0KICAgIH0NCiAgICByZXR1cm4gdHJhbnNhY3Rpb25Ob2RlOw0KfQ0KLyoqDQogKiBCdWlsZHMgdGhlIHF1ZXVlIG9mIGFsbCB0cmFuc2FjdGlvbnMgYXQgb3IgYmVsb3cgdGhlIHNwZWNpZmllZA0KICogdHJhbnNhY3Rpb25Ob2RlLg0KICoNCiAqIEBwYXJhbSB0cmFuc2FjdGlvbk5vZGUNCiAqIEByZXR1cm5zIFRoZSBnZW5lcmF0ZWQgcXVldWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9CdWlsZFRyYW5zYWN0aW9uUXVldWUocmVwbywgdHJhbnNhY3Rpb25Ob2RlKSB7DQogICAgLy8gV2FsayBhbnkgY2hpbGQgdHJhbnNhY3Rpb24gcXVldWVzIGFuZCBhZ2dyZWdhdGUgdGhlbSBpbnRvIGEgc2luZ2xlIHF1ZXVlLg0KICAgIGNvbnN0IHRyYW5zYWN0aW9uUXVldWUgPSBbXTsNCiAgICByZXBvQWdncmVnYXRlVHJhbnNhY3Rpb25RdWV1ZXNGb3JOb2RlKHJlcG8sIHRyYW5zYWN0aW9uTm9kZSwgdHJhbnNhY3Rpb25RdWV1ZSk7DQogICAgLy8gU29ydCB0aGVtIGJ5IHRoZSBvcmRlciB0aGUgdHJhbnNhY3Rpb25zIHdlcmUgY3JlYXRlZC4NCiAgICB0cmFuc2FjdGlvblF1ZXVlLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTsNCiAgICByZXR1cm4gdHJhbnNhY3Rpb25RdWV1ZTsNCn0NCmZ1bmN0aW9uIHJlcG9BZ2dyZWdhdGVUcmFuc2FjdGlvblF1ZXVlc0Zvck5vZGUocmVwbywgbm9kZSwgcXVldWUpIHsNCiAgICBjb25zdCBub2RlUXVldWUgPSB0cmVlR2V0VmFsdWUobm9kZSk7DQogICAgaWYgKG5vZGVRdWV1ZSkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVRdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgcXVldWUucHVzaChub2RlUXVldWVbaV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHRyZWVGb3JFYWNoQ2hpbGQobm9kZSwgY2hpbGQgPT4gew0KICAgICAgICByZXBvQWdncmVnYXRlVHJhbnNhY3Rpb25RdWV1ZXNGb3JOb2RlKHJlcG8sIGNoaWxkLCBxdWV1ZSk7DQogICAgfSk7DQp9DQovKioNCiAqIFJlbW92ZSBDT01QTEVURUQgdHJhbnNhY3Rpb25zIGF0IG9yIGJlbG93IHRoaXMgbm9kZSBpbiB0aGUgdHJhbnNhY3Rpb25RdWV1ZVRyZWVfLg0KICovDQpmdW5jdGlvbiByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgbm9kZSkgew0KICAgIGNvbnN0IHF1ZXVlID0gdHJlZUdldFZhbHVlKG5vZGUpOw0KICAgIGlmIChxdWV1ZSkgew0KICAgICAgICBsZXQgdG8gPSAwOw0KICAgICAgICBmb3IgKGxldCBmcm9tID0gMDsgZnJvbSA8IHF1ZXVlLmxlbmd0aDsgZnJvbSsrKSB7DQogICAgICAgICAgICBpZiAocXVldWVbZnJvbV0uc3RhdHVzICE9PSAyIC8qIFRyYW5zYWN0aW9uU3RhdHVzLkNPTVBMRVRFRCAqLykgew0KICAgICAgICAgICAgICAgIHF1ZXVlW3RvXSA9IHF1ZXVlW2Zyb21dOw0KICAgICAgICAgICAgICAgIHRvKys7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcXVldWUubGVuZ3RoID0gdG87DQogICAgICAgIHRyZWVTZXRWYWx1ZShub2RlLCBxdWV1ZS5sZW5ndGggPiAwID8gcXVldWUgOiB1bmRlZmluZWQpOw0KICAgIH0NCiAgICB0cmVlRm9yRWFjaENoaWxkKG5vZGUsIGNoaWxkTm9kZSA9PiB7DQogICAgICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCBjaGlsZE5vZGUpOw0KICAgIH0pOw0KfQ0KLyoqDQogKiBBYm9ydHMgYWxsIHRyYW5zYWN0aW9ucyBvbiBhbmNlc3RvcnMgb3IgZGVzY2VuZGFudHMgb2YgdGhlIHNwZWNpZmllZCBwYXRoLg0KICogQ2FsbGVkIHdoZW4gZG9pbmcgYSBzZXQoKSBvciB1cGRhdGUoKSBzaW5jZSB3ZSBjb25zaWRlciB0aGVtIGluY29tcGF0aWJsZQ0KICogd2l0aCB0cmFuc2FjdGlvbnMuDQogKg0KICogQHBhcmFtIHBhdGggLSBQYXRoIGZvciB3aGljaCB3ZSB3YW50IHRvIGFib3J0IHJlbGF0ZWQgdHJhbnNhY3Rpb25zLg0KICovDQpmdW5jdGlvbiByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCkgew0KICAgIGNvbnN0IGFmZmVjdGVkUGF0aCA9IHRyZWVHZXRQYXRoKHJlcG9HZXRBbmNlc3RvclRyYW5zYWN0aW9uTm9kZShyZXBvLCBwYXRoKSk7DQogICAgY29uc3QgdHJhbnNhY3Rpb25Ob2RlID0gdHJlZVN1YlRyZWUocmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV8sIHBhdGgpOw0KICAgIHRyZWVGb3JFYWNoQW5jZXN0b3IodHJhbnNhY3Rpb25Ob2RlLCAobm9kZSkgPT4gew0KICAgICAgICByZXBvQWJvcnRUcmFuc2FjdGlvbnNPbk5vZGUocmVwbywgbm9kZSk7DQogICAgfSk7DQogICAgcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIHRyYW5zYWN0aW9uTm9kZSk7DQogICAgdHJlZUZvckVhY2hEZXNjZW5kYW50KHRyYW5zYWN0aW9uTm9kZSwgKG5vZGUpID0+IHsNCiAgICAgICAgcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIG5vZGUpOw0KICAgIH0pOw0KICAgIHJldHVybiBhZmZlY3RlZFBhdGg7DQp9DQovKioNCiAqIEFib3J0IHRyYW5zYWN0aW9ucyBzdG9yZWQgaW4gdGhpcyB0cmFuc2FjdGlvbiBxdWV1ZSBub2RlLg0KICoNCiAqIEBwYXJhbSBub2RlIC0gTm9kZSB0byBhYm9ydCB0cmFuc2FjdGlvbnMgZm9yLg0KICovDQpmdW5jdGlvbiByZXBvQWJvcnRUcmFuc2FjdGlvbnNPbk5vZGUocmVwbywgbm9kZSkgew0KICAgIGNvbnN0IHF1ZXVlID0gdHJlZUdldFZhbHVlKG5vZGUpOw0KICAgIGlmIChxdWV1ZSkgew0KICAgICAgICAvLyBRdWV1ZSB1cCB0aGUgY2FsbGJhY2tzIGFuZCBmaXJlIHRoZW0gYWZ0ZXIgY2xlYW5pbmcgdXAgYWxsIG9mIG91cg0KICAgICAgICAvLyB0cmFuc2FjdGlvbiBzdGF0ZSwgc2luY2UgdGhlIGNhbGxiYWNrIGNvdWxkIHRyaWdnZXIgbW9yZSB0cmFuc2FjdGlvbnMNCiAgICAgICAgLy8gb3Igc2V0cy4NCiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gW107DQogICAgICAgIC8vIEdvIHRocm91Z2ggcXVldWUuICBBbnkgYWxyZWFkeS1zZW50IHRyYW5zYWN0aW9ucyBtdXN0IGJlIG1hcmtlZCBmb3INCiAgICAgICAgLy8gYWJvcnQsIHdoaWxlIHRoZSB1bnNlbnQgb25lcyBjYW4gYmUgaW1tZWRpYXRlbHkgYWJvcnRlZCBhbmQgcmVtb3ZlZC4NCiAgICAgICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgICAgICBsZXQgbGFzdFNlbnQgPSAtMTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLnN0YXR1cyA9PT0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovKSA7DQogICAgICAgICAgICBlbHNlIGlmIChxdWV1ZVtpXS5zdGF0dXMgPT09IDEgLyogVHJhbnNhY3Rpb25TdGF0dXMuU0VOVCAqLykgew0KICAgICAgICAgICAgICAgIGFzc2VydChsYXN0U2VudCA9PT0gaSAtIDEsICdBbGwgU0VOVCBpdGVtcyBzaG91bGQgYmUgYXQgYmVnaW5uaW5nIG9mIHF1ZXVlLicpOw0KICAgICAgICAgICAgICAgIGxhc3RTZW50ID0gaTsNCiAgICAgICAgICAgICAgICAvLyBNYXJrIHRyYW5zYWN0aW9uIGZvciBhYm9ydCB3aGVuIGl0IGNvbWVzIGJhY2suDQogICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovOw0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLmFib3J0UmVhc29uID0gJ3NldCc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhc3NlcnQocXVldWVbaV0uc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLywgJ1VuZXhwZWN0ZWQgdHJhbnNhY3Rpb24gc3RhdHVzIGluIGFib3J0Jyk7DQogICAgICAgICAgICAgICAgLy8gV2UgY2FuIGFib3J0IGl0IGltbWVkaWF0ZWx5Lg0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnVud2F0Y2hlcigpOw0KICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXVlW2ldLmN1cnJlbnRXcml0ZUlkLCB0cnVlKSk7DQogICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLm9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2gocXVldWVbaV0ub25Db21wbGV0ZS5iaW5kKG51bGwsIG5ldyBFcnJvcignc2V0JyksIGZhbHNlLCBudWxsKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChsYXN0U2VudCA9PT0gLTEpIHsNCiAgICAgICAgICAgIC8vIFdlJ3JlIG5vdCB3YWl0aW5nIGZvciBhbnkgc2VudCB0cmFuc2FjdGlvbnMuICBXZSBjYW4gY2xlYXIgdGhlIHF1ZXVlLg0KICAgICAgICAgICAgdHJlZVNldFZhbHVlKG5vZGUsIHVuZGVmaW5lZCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHRyYW5zYWN0aW9ucyB3ZSBhYm9ydGVkLg0KICAgICAgICAgICAgcXVldWUubGVuZ3RoID0gbGFzdFNlbnQgKyAxOw0KICAgICAgICB9DQogICAgICAgIC8vIE5vdyBmaXJlIHRoZSBjYWxsYmFja3MuDQogICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHRyZWVHZXRQYXRoKG5vZGUpLCBldmVudHMpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoY2FsbGJhY2tzW2ldKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGRlY29kZVBhdGgocGF0aFN0cmluZykgew0KICAgIGxldCBwYXRoU3RyaW5nRGVjb2RlZCA9ICcnOw0KICAgIGNvbnN0IHBpZWNlcyA9IHBhdGhTdHJpbmcuc3BsaXQoJy8nKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBpZWNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAocGllY2VzW2ldLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGxldCBwaWVjZSA9IHBpZWNlc1tpXTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGllY2UgPSBkZWNvZGVVUklDb21wb25lbnQocGllY2UucmVwbGFjZSgvXCsvZywgJyAnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgeyB9DQogICAgICAgICAgICBwYXRoU3RyaW5nRGVjb2RlZCArPSAnLycgKyBwaWVjZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcGF0aFN0cmluZ0RlY29kZWQ7DQp9DQovKioNCiAqIEByZXR1cm5zIGtleSB2YWx1ZSBoYXNoDQogKi8NCmZ1bmN0aW9uIGRlY29kZVF1ZXJ5KHF1ZXJ5U3RyaW5nKSB7DQogICAgY29uc3QgcmVzdWx0cyA9IHt9Ow0KICAgIGlmIChxdWVyeVN0cmluZy5jaGFyQXQoMCkgPT09ICc/Jykgew0KICAgICAgICBxdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLnN1YnN0cmluZygxKTsNCiAgICB9DQogICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHF1ZXJ5U3RyaW5nLnNwbGl0KCcmJykpIHsNCiAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBrdiA9IHNlZ21lbnQuc3BsaXQoJz0nKTsNCiAgICAgICAgaWYgKGt2Lmxlbmd0aCA9PT0gMikgew0KICAgICAgICAgICAgcmVzdWx0c1tkZWNvZGVVUklDb21wb25lbnQoa3ZbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChrdlsxXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB3YXJuKGBJbnZhbGlkIHF1ZXJ5IHNlZ21lbnQgJyR7c2VnbWVudH0nIGluIHF1ZXJ5ICcke3F1ZXJ5U3RyaW5nfSdgKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0czsNCn0NCmNvbnN0IHBhcnNlUmVwb0luZm8gPSBmdW5jdGlvbiAoZGF0YVVSTCwgbm9kZUFkbWluKSB7DQogICAgY29uc3QgcGFyc2VkVXJsID0gcGFyc2VEYXRhYmFzZVVSTChkYXRhVVJMKSwgbmFtZXNwYWNlID0gcGFyc2VkVXJsLm5hbWVzcGFjZTsNCiAgICBpZiAocGFyc2VkVXJsLmRvbWFpbiA9PT0gJ2ZpcmViYXNlLmNvbScpIHsNCiAgICAgICAgZmF0YWwocGFyc2VkVXJsLmhvc3QgKw0KICAgICAgICAgICAgJyBpcyBubyBsb25nZXIgc3VwcG9ydGVkLiAnICsNCiAgICAgICAgICAgICdQbGVhc2UgdXNlIDxZT1VSIEZJUkVCQVNFPi5maXJlYmFzZWlvLmNvbSBpbnN0ZWFkJyk7DQogICAgfQ0KICAgIC8vIENhdGNoIGNvbW1vbiBlcnJvciBvZiB1bmluaXRpYWxpemVkIG5hbWVzcGFjZSB2YWx1ZS4NCiAgICBpZiAoKCFuYW1lc3BhY2UgfHwgbmFtZXNwYWNlID09PSAndW5kZWZpbmVkJykgJiYNCiAgICAgICAgcGFyc2VkVXJsLmRvbWFpbiAhPT0gJ2xvY2FsaG9zdCcpIHsNCiAgICAgICAgZmF0YWwoJ0Nhbm5vdCBwYXJzZSBGaXJlYmFzZSB1cmwuIFBsZWFzZSB1c2UgaHR0cHM6Ly88WU9VUiBGSVJFQkFTRT4uZmlyZWJhc2Vpby5jb20nKTsNCiAgICB9DQogICAgaWYgKCFwYXJzZWRVcmwuc2VjdXJlKSB7DQogICAgICAgIHdhcm5JZlBhZ2VJc1NlY3VyZSgpOw0KICAgIH0NCiAgICBjb25zdCB3ZWJTb2NrZXRPbmx5ID0gcGFyc2VkVXJsLnNjaGVtZSA9PT0gJ3dzJyB8fCBwYXJzZWRVcmwuc2NoZW1lID09PSAnd3NzJzsNCiAgICByZXR1cm4gew0KICAgICAgICByZXBvSW5mbzogbmV3IFJlcG9JbmZvKHBhcnNlZFVybC5ob3N0LCBwYXJzZWRVcmwuc2VjdXJlLCBuYW1lc3BhY2UsIHdlYlNvY2tldE9ubHksIG5vZGVBZG1pbiwgDQogICAgICAgIC8qcGVyc2lzdGVuY2VLZXk9Ki8gJycsIA0KICAgICAgICAvKmluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zPSovIG5hbWVzcGFjZSAhPT0gcGFyc2VkVXJsLnN1YmRvbWFpbiksDQogICAgICAgIHBhdGg6IG5ldyBQYXRoKHBhcnNlZFVybC5wYXRoU3RyaW5nKQ0KICAgIH07DQp9Ow0KY29uc3QgcGFyc2VEYXRhYmFzZVVSTCA9IGZ1bmN0aW9uIChkYXRhVVJMKSB7DQogICAgLy8gRGVmYXVsdCB0byBlbXB0eSBzdHJpbmdzIGluIHRoZSBldmVudCBvZiBhIG1hbGZvcm1lZCBzdHJpbmcuDQogICAgbGV0IGhvc3QgPSAnJywgZG9tYWluID0gJycsIHN1YmRvbWFpbiA9ICcnLCBwYXRoU3RyaW5nID0gJycsIG5hbWVzcGFjZSA9ICcnOw0KICAgIC8vIEFsd2F5cyBkZWZhdWx0IHRvIFNTTCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuDQogICAgbGV0IHNlY3VyZSA9IHRydWUsIHNjaGVtZSA9ICdodHRwcycsIHBvcnQgPSA0NDM7DQogICAgLy8gRG9uJ3QgZG8gYW55IHZhbGlkYXRpb24gaGVyZS4gVGhlIGNhbGxlciBpcyByZXNwb25zaWJsZSBmb3IgdmFsaWRhdGluZyB0aGUgcmVzdWx0IG9mIHBhcnNpbmcuDQogICAgaWYgKHR5cGVvZiBkYXRhVVJMID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBQYXJzZSBzY2hlbWUuDQogICAgICAgIGxldCBjb2xvbkluZCA9IGRhdGFVUkwuaW5kZXhPZignLy8nKTsNCiAgICAgICAgaWYgKGNvbG9uSW5kID49IDApIHsNCiAgICAgICAgICAgIHNjaGVtZSA9IGRhdGFVUkwuc3Vic3RyaW5nKDAsIGNvbG9uSW5kIC0gMSk7DQogICAgICAgICAgICBkYXRhVVJMID0gZGF0YVVSTC5zdWJzdHJpbmcoY29sb25JbmQgKyAyKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBQYXJzZSBob3N0LCBwYXRoLCBhbmQgcXVlcnkgc3RyaW5nLg0KICAgICAgICBsZXQgc2xhc2hJbmQgPSBkYXRhVVJMLmluZGV4T2YoJy8nKTsNCiAgICAgICAgaWYgKHNsYXNoSW5kID09PSAtMSkgew0KICAgICAgICAgICAgc2xhc2hJbmQgPSBkYXRhVVJMLmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgcXVlc3Rpb25NYXJrSW5kID0gZGF0YVVSTC5pbmRleE9mKCc/Jyk7DQogICAgICAgIGlmIChxdWVzdGlvbk1hcmtJbmQgPT09IC0xKSB7DQogICAgICAgICAgICBxdWVzdGlvbk1hcmtJbmQgPSBkYXRhVVJMLmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBob3N0ID0gZGF0YVVSTC5zdWJzdHJpbmcoMCwgTWF0aC5taW4oc2xhc2hJbmQsIHF1ZXN0aW9uTWFya0luZCkpOw0KICAgICAgICBpZiAoc2xhc2hJbmQgPCBxdWVzdGlvbk1hcmtJbmQpIHsNCiAgICAgICAgICAgIC8vIEZvciBwYXRoU3RyaW5nLCBxdWVzdGlvbk1hcmtJbmQgd2lsbCBhbHdheXMgY29tZSBhZnRlciBzbGFzaEluZA0KICAgICAgICAgICAgcGF0aFN0cmluZyA9IGRlY29kZVBhdGgoZGF0YVVSTC5zdWJzdHJpbmcoc2xhc2hJbmQsIHF1ZXN0aW9uTWFya0luZCkpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gZGVjb2RlUXVlcnkoZGF0YVVSTC5zdWJzdHJpbmcoTWF0aC5taW4oZGF0YVVSTC5sZW5ndGgsIHF1ZXN0aW9uTWFya0luZCkpKTsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHBvcnQsIHVzZSBzY2hlbWUgZm9yIGRldGVybWluaW5nIGlmIGl0J3Mgc2VjdXJlLg0KICAgICAgICBjb2xvbkluZCA9IGhvc3QuaW5kZXhPZignOicpOw0KICAgICAgICBpZiAoY29sb25JbmQgPj0gMCkgew0KICAgICAgICAgICAgc2VjdXJlID0gc2NoZW1lID09PSAnaHR0cHMnIHx8IHNjaGVtZSA9PT0gJ3dzcyc7DQogICAgICAgICAgICBwb3J0ID0gcGFyc2VJbnQoaG9zdC5zdWJzdHJpbmcoY29sb25JbmQgKyAxKSwgMTApOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29sb25JbmQgPSBob3N0Lmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBob3N0V2l0aG91dFBvcnQgPSBob3N0LnNsaWNlKDAsIGNvbG9uSW5kKTsNCiAgICAgICAgaWYgKGhvc3RXaXRob3V0UG9ydC50b0xvd2VyQ2FzZSgpID09PSAnbG9jYWxob3N0Jykgew0KICAgICAgICAgICAgZG9tYWluID0gJ2xvY2FsaG9zdCc7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaG9zdFdpdGhvdXRQb3J0LnNwbGl0KCcuJykubGVuZ3RoIDw9IDIpIHsNCiAgICAgICAgICAgIGRvbWFpbiA9IGhvc3RXaXRob3V0UG9ydDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIEludGVycHJldCB0aGUgc3ViZG9tYWluIG9mIGEgMyBvciBtb3JlIGNvbXBvbmVudCBVUkwgYXMgdGhlIG5hbWVzcGFjZSBuYW1lLg0KICAgICAgICAgICAgY29uc3QgZG90SW5kID0gaG9zdC5pbmRleE9mKCcuJyk7DQogICAgICAgICAgICBzdWJkb21haW4gPSBob3N0LnN1YnN0cmluZygwLCBkb3RJbmQpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBkb21haW4gPSBob3N0LnN1YnN0cmluZyhkb3RJbmQgKyAxKTsNCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBuYW1lc3BhY2VzIHRvIGxvd2VyY2FzZSB0byBzaGFyZSBzdG9yYWdlIC8gY29ubmVjdGlvbi4NCiAgICAgICAgICAgIG5hbWVzcGFjZSA9IHN1YmRvbWFpbjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBbHdheXMgdHJlYXQgdGhlIHZhbHVlIG9mIHRoZSBgbnNgIGFzIHRoZSBuYW1lc3BhY2UgbmFtZSBpZiBpdCBpcyBwcmVzZW50Lg0KICAgICAgICBpZiAoJ25zJyBpbiBxdWVyeVBhcmFtcykgew0KICAgICAgICAgICAgbmFtZXNwYWNlID0gcXVlcnlQYXJhbXNbJ25zJ107DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHsNCiAgICAgICAgaG9zdCwNCiAgICAgICAgcG9ydCwNCiAgICAgICAgZG9tYWluLA0KICAgICAgICBzdWJkb21haW4sDQogICAgICAgIHNlY3VyZSwNCiAgICAgICAgc2NoZW1lLA0KICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICBuYW1lc3BhY2UNCiAgICB9Ow0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRW5jYXBzdWxhdGVzIHRoZSBkYXRhIG5lZWRlZCB0byByYWlzZSBhbiBldmVudA0KICovDQpjbGFzcyBEYXRhRXZlbnQgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBldmVudFR5cGUgLSBPbmUgb2Y6IHZhbHVlLCBjaGlsZF9hZGRlZCwgY2hpbGRfY2hhbmdlZCwgY2hpbGRfbW92ZWQsIGNoaWxkX3JlbW92ZWQNCiAgICAgKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBUaGUgZnVuY3Rpb24gdG8gY2FsbCB0byB3aXRoIHRoZSBldmVudCBkYXRhLiBVc2VyIHByb3ZpZGVkDQogICAgICogQHBhcmFtIHNuYXBzaG90IC0gVGhlIGRhdGEgYmFja2luZyB0aGUgZXZlbnQNCiAgICAgKiBAcGFyYW0gcHJldk5hbWUgLSBPcHRpb25hbCwgdGhlIG5hbWUgb2YgdGhlIHByZXZpb3VzIGNoaWxkIGZvciBjaGlsZF8qIGV2ZW50cy4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihldmVudFR5cGUsIGV2ZW50UmVnaXN0cmF0aW9uLCBzbmFwc2hvdCwgcHJldk5hbWUpIHsNCiAgICAgICAgdGhpcy5ldmVudFR5cGUgPSBldmVudFR5cGU7DQogICAgICAgIHRoaXMuZXZlbnRSZWdpc3RyYXRpb24gPSBldmVudFJlZ2lzdHJhdGlvbjsNCiAgICAgICAgdGhpcy5zbmFwc2hvdCA9IHNuYXBzaG90Ow0KICAgICAgICB0aGlzLnByZXZOYW1lID0gcHJldk5hbWU7DQogICAgfQ0KICAgIGdldFBhdGgoKSB7DQogICAgICAgIGNvbnN0IHJlZiA9IHRoaXMuc25hcHNob3QucmVmOw0KICAgICAgICBpZiAodGhpcy5ldmVudFR5cGUgPT09ICd2YWx1ZScpIHsNCiAgICAgICAgICAgIHJldHVybiByZWYuX3BhdGg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gcmVmLnBhcmVudC5fcGF0aDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRFdmVudFR5cGUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50VHlwZTsNCiAgICB9DQogICAgZ2V0RXZlbnRSdW5uZXIoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uLmdldEV2ZW50UnVubmVyKHRoaXMpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICh0aGlzLmdldFBhdGgoKS50b1N0cmluZygpICsNCiAgICAgICAgICAgICc6JyArDQogICAgICAgICAgICB0aGlzLmV2ZW50VHlwZSArDQogICAgICAgICAgICAnOicgKw0KICAgICAgICAgICAgc3RyaW5naWZ5KHRoaXMuc25hcHNob3QuZXhwb3J0VmFsKCkpKTsNCiAgICB9DQp9DQpjbGFzcyBDYW5jZWxFdmVudCB7DQogICAgY29uc3RydWN0b3IoZXZlbnRSZWdpc3RyYXRpb24sIGVycm9yLCBwYXRoKSB7DQogICAgICAgIHRoaXMuZXZlbnRSZWdpc3RyYXRpb24gPSBldmVudFJlZ2lzdHJhdGlvbjsNCiAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yOw0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgIH0NCiAgICBnZXRQYXRoKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5wYXRoOw0KICAgIH0NCiAgICBnZXRFdmVudFR5cGUoKSB7DQogICAgICAgIHJldHVybiAnY2FuY2VsJzsNCiAgICB9DQogICAgZ2V0RXZlbnRSdW5uZXIoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uLmdldEV2ZW50UnVubmVyKHRoaXMpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC50b1N0cmluZygpICsgJzpjYW5jZWwnOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSB3cmFwcGVyIGNsYXNzIHRoYXQgY29udmVydHMgZXZlbnRzIGZyb20gdGhlIGRhdGFiYXNlQGV4cCBTREsgdG8gdGhlIGxlZ2FjeQ0KICogRGF0YWJhc2UgU0RLLiBFdmVudHMgYXJlIG5vdCBjb252ZXJ0ZWQgZGlyZWN0bHkgYXMgZXZlbnQgcmVnaXN0cmF0aW9uIHJlbGllcw0KICogb24gcmVmZXJlbmNlIGNvbXBhcmlzb24gb2YgdGhlIG9yaWdpbmFsIHVzZXIgY2FsbGJhY2sgKHNlZSBgbWF0Y2hlcygpYCkgYW5kDQogKiByZWxpZXMgb24gZXF1YWxpdHkgb2YgdGhlIGxlZ2FjeSBTREsncyBgY29udGV4dGAgb2JqZWN0Lg0KICovDQpjbGFzcyBDYWxsYmFja0NvbnRleHQgew0KICAgIGNvbnN0cnVjdG9yKHNuYXBzaG90Q2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrKSB7DQogICAgICAgIHRoaXMuc25hcHNob3RDYWxsYmFjayA9IHNuYXBzaG90Q2FsbGJhY2s7DQogICAgICAgIHRoaXMuY2FuY2VsQ2FsbGJhY2sgPSBjYW5jZWxDYWxsYmFjazsNCiAgICB9DQogICAgb25WYWx1ZShleHBEYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKSB7DQogICAgICAgIHRoaXMuc25hcHNob3RDYWxsYmFjay5jYWxsKG51bGwsIGV4cERhdGFTbmFwc2hvdCwgcHJldmlvdXNDaGlsZE5hbWUpOw0KICAgIH0NCiAgICBvbkNhbmNlbChlcnJvcikgew0KICAgICAgICBhc3NlcnQodGhpcy5oYXNDYW5jZWxDYWxsYmFjaywgJ1JhaXNpbmcgYSBjYW5jZWwgZXZlbnQgb24gYSBsaXN0ZW5lciB3aXRoIG5vIGNhbmNlbCBjYWxsYmFjaycpOw0KICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDYWxsYmFjay5jYWxsKG51bGwsIGVycm9yKTsNCiAgICB9DQogICAgZ2V0IGhhc0NhbmNlbENhbGxiYWNrKCkgew0KICAgICAgICByZXR1cm4gISF0aGlzLmNhbmNlbENhbGxiYWNrOw0KICAgIH0NCiAgICBtYXRjaGVzKG90aGVyKSB7DQogICAgICAgIHJldHVybiAodGhpcy5zbmFwc2hvdENhbGxiYWNrID09PSBvdGhlci5zbmFwc2hvdENhbGxiYWNrIHx8DQogICAgICAgICAgICAodGhpcy5zbmFwc2hvdENhbGxiYWNrLnVzZXJDYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmDQogICAgICAgICAgICAgICAgdGhpcy5zbmFwc2hvdENhbGxiYWNrLnVzZXJDYWxsYmFjayA9PT0NCiAgICAgICAgICAgICAgICAgICAgb3RoZXIuc25hcHNob3RDYWxsYmFjay51c2VyQ2FsbGJhY2sgJiYNCiAgICAgICAgICAgICAgICB0aGlzLnNuYXBzaG90Q2FsbGJhY2suY29udGV4dCA9PT0gb3RoZXIuc25hcHNob3RDYWxsYmFjay5jb250ZXh0KSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgUXVlcnlJbXBsIHsNCiAgICAvKioNCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yDQogICAgICovDQogICAgY29uc3RydWN0b3IoX3JlcG8sIF9wYXRoLCBfcXVlcnlQYXJhbXMsIF9vcmRlckJ5Q2FsbGVkKSB7DQogICAgICAgIHRoaXMuX3JlcG8gPSBfcmVwbzsNCiAgICAgICAgdGhpcy5fcGF0aCA9IF9wYXRoOw0KICAgICAgICB0aGlzLl9xdWVyeVBhcmFtcyA9IF9xdWVyeVBhcmFtczsNCiAgICAgICAgdGhpcy5fb3JkZXJCeUNhbGxlZCA9IF9vcmRlckJ5Q2FsbGVkOw0KICAgIH0NCiAgICBnZXQga2V5KCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkodGhpcy5fcGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHBhdGhHZXRCYWNrKHRoaXMuX3BhdGgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldCByZWYoKSB7DQogICAgICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSW1wbCh0aGlzLl9yZXBvLCB0aGlzLl9wYXRoKTsNCiAgICB9DQogICAgZ2V0IF9xdWVyeUlkZW50aWZpZXIoKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHF1ZXJ5UGFyYW1zR2V0UXVlcnlPYmplY3QodGhpcy5fcXVlcnlQYXJhbXMpOw0KICAgICAgICBjb25zdCBpZCA9IE9iamVjdFRvVW5pcXVlS2V5KG9iaik7DQogICAgICAgIHJldHVybiBpZCA9PT0gJ3t9JyA/ICdkZWZhdWx0JyA6IGlkOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIHF1ZXJ5IHBhcmFtZXRlcnMgdXNlZCBieSB0aGlzIFF1ZXJ5Lg0KICAgICAqLw0KICAgIGdldCBfcXVlcnlPYmplY3QoKSB7DQogICAgICAgIHJldHVybiBxdWVyeVBhcmFtc0dldFF1ZXJ5T2JqZWN0KHRoaXMuX3F1ZXJ5UGFyYW1zKTsNCiAgICB9DQogICAgaXNFcXVhbChvdGhlcikgew0KICAgICAgICBvdGhlciA9IGdldE1vZHVsYXJJbnN0YW5jZShvdGhlcik7DQogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgUXVlcnlJbXBsKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHNhbWVSZXBvID0gdGhpcy5fcmVwbyA9PT0gb3RoZXIuX3JlcG87DQogICAgICAgIGNvbnN0IHNhbWVQYXRoID0gcGF0aEVxdWFscyh0aGlzLl9wYXRoLCBvdGhlci5fcGF0aCk7DQogICAgICAgIGNvbnN0IHNhbWVRdWVyeUlkZW50aWZpZXIgPSB0aGlzLl9xdWVyeUlkZW50aWZpZXIgPT09IG90aGVyLl9xdWVyeUlkZW50aWZpZXI7DQogICAgICAgIHJldHVybiBzYW1lUmVwbyAmJiBzYW1lUGF0aCAmJiBzYW1lUXVlcnlJZGVudGlmaWVyOw0KICAgIH0NCiAgICB0b0pTT04oKSB7DQogICAgICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKCk7DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fcmVwby50b1N0cmluZygpICsgcGF0aFRvVXJsRW5jb2RlZFN0cmluZyh0aGlzLl9wYXRoKTsNCiAgICB9DQp9DQovKioNCiAqIEBpbnRlcm5hbA0KICovDQpjbGFzcyBSZWZlcmVuY2VJbXBsIGV4dGVuZHMgUXVlcnlJbXBsIHsNCiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqLw0KICAgIGNvbnN0cnVjdG9yKHJlcG8sIHBhdGgpIHsNCiAgICAgICAgc3VwZXIocmVwbywgcGF0aCwgbmV3IFF1ZXJ5UGFyYW1zKCksIGZhbHNlKTsNCiAgICB9DQogICAgZ2V0IHBhcmVudCgpIHsNCiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhQYXJlbnQodGhpcy5fcGF0aCk7DQogICAgICAgIHJldHVybiBwYXJlbnRQYXRoID09PSBudWxsDQogICAgICAgICAgICA/IG51bGwNCiAgICAgICAgICAgIDogbmV3IFJlZmVyZW5jZUltcGwodGhpcy5fcmVwbywgcGFyZW50UGF0aCk7DQogICAgfQ0KICAgIGdldCByb290KCkgew0KICAgICAgICBsZXQgcmVmID0gdGhpczsNCiAgICAgICAgd2hpbGUgKHJlZi5wYXJlbnQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIHJlZiA9IHJlZi5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlZjsNCiAgICB9DQp9DQovKioNCiAqIEEgYERhdGFTbmFwc2hvdGAgY29udGFpbnMgZGF0YSBmcm9tIGEgRGF0YWJhc2UgbG9jYXRpb24uDQogKg0KICogQW55IHRpbWUgeW91IHJlYWQgZGF0YSBmcm9tIHRoZSBEYXRhYmFzZSwgeW91IHJlY2VpdmUgdGhlIGRhdGEgYXMgYQ0KICogYERhdGFTbmFwc2hvdGAuIEEgYERhdGFTbmFwc2hvdGAgaXMgcGFzc2VkIHRvIHRoZSBldmVudCBjYWxsYmFja3MgeW91IGF0dGFjaA0KICogd2l0aCBgb24oKWAgb3IgYG9uY2UoKWAuIFlvdSBjYW4gZXh0cmFjdCB0aGUgY29udGVudHMgb2YgdGhlIHNuYXBzaG90IGFzIGENCiAqIEphdmFTY3JpcHQgb2JqZWN0IGJ5IGNhbGxpbmcgdGhlIGB2YWwoKWAgbWV0aG9kLiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuDQogKiB0cmF2ZXJzZSBpbnRvIHRoZSBzbmFwc2hvdCBieSBjYWxsaW5nIGBjaGlsZCgpYCB0byByZXR1cm4gY2hpbGQgc25hcHNob3RzDQogKiAod2hpY2ggeW91IGNvdWxkIHRoZW4gY2FsbCBgdmFsKClgIG9uKS4NCiAqDQogKiBBIGBEYXRhU25hcHNob3RgIGlzIGFuIGVmZmljaWVudGx5IGdlbmVyYXRlZCwgaW1tdXRhYmxlIGNvcHkgb2YgdGhlIGRhdGEgYXQNCiAqIGEgRGF0YWJhc2UgbG9jYXRpb24uIEl0IGNhbm5vdCBiZSBtb2RpZmllZCBhbmQgd2lsbCBuZXZlciBjaGFuZ2UgKHRvIG1vZGlmeQ0KICogZGF0YSwgeW91IGFsd2F5cyBjYWxsIHRoZSBgc2V0KClgIG1ldGhvZCBvbiBhIGBSZWZlcmVuY2VgIGRpcmVjdGx5KS4NCiAqLw0KY2xhc3MgRGF0YVNuYXBzaG90IHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gX25vZGUgLSBBIFNuYXBzaG90Tm9kZSB0byB3cmFwLg0KICAgICAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdGhpcyBzbmFwc2hvdCBjYW1lIGZyb20uDQogICAgICogQHBhcmFtIF9pbmRleCAtIFRoZSBpdGVyYXRpb24gb3JkZXIgZm9yIHRoaXMgc25hcHNob3QNCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yDQogICAgICovDQogICAgY29uc3RydWN0b3IoX25vZGUsIA0KICAgIC8qKg0KICAgICAqIFRoZSBsb2NhdGlvbiBvZiB0aGlzIERhdGFTbmFwc2hvdC4NCiAgICAgKi8NCiAgICByZWYsIF9pbmRleCkgew0KICAgICAgICB0aGlzLl9ub2RlID0gX25vZGU7DQogICAgICAgIHRoaXMucmVmID0gcmVmOw0KICAgICAgICB0aGlzLl9pbmRleCA9IF9pbmRleDsNCiAgICB9DQogICAgLyoqDQogICAgICogR2V0cyB0aGUgcHJpb3JpdHkgdmFsdWUgb2YgdGhlIGRhdGEgaW4gdGhpcyBgRGF0YVNuYXBzaG90YC4NCiAgICAgKg0KICAgICAqIEFwcGxpY2F0aW9ucyBuZWVkIG5vdCB1c2UgcHJpb3JpdHkgYnV0IGNhbiBvcmRlciBjb2xsZWN0aW9ucyBieQ0KICAgICAqIG9yZGluYXJ5IHByb3BlcnRpZXMgKHNlZQ0KICAgICAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvbGlzdHMtb2YtZGF0YSNzb3J0aW5nX2FuZF9maWx0ZXJpbmdfZGF0YSB8U29ydGluZyBhbmQgZmlsdGVyaW5nIGRhdGF9DQogICAgICogKS4NCiAgICAgKi8NCiAgICBnZXQgcHJpb3JpdHkoKSB7DQogICAgICAgIC8vIHR5cGVjYXN0IGhlcmUgYmVjYXVzZSB3ZSBuZXZlciByZXR1cm4gZGVmZXJyZWQgdmFsdWVzIG9yIGludGVybmFsIHByaW9yaXRpZXMgKE1BWF9QUklPUklUWSkNCiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUuZ2V0UHJpb3JpdHkoKS52YWwoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVGhlIGtleSAobGFzdCBwYXJ0IG9mIHRoZSBwYXRoKSBvZiB0aGUgbG9jYXRpb24gb2YgdGhpcyBgRGF0YVNuYXBzaG90YC4NCiAgICAgKg0KICAgICAqIFRoZSBsYXN0IHRva2VuIGluIGEgRGF0YWJhc2UgbG9jYXRpb24gaXMgY29uc2lkZXJlZCBpdHMga2V5LiBGb3IgZXhhbXBsZSwNCiAgICAgKiAiYWRhIiBpcyB0aGUga2V5IGZvciB0aGUgL3VzZXJzL2FkYS8gbm9kZS4gQWNjZXNzaW5nIHRoZSBrZXkgb24gYW55DQogICAgICogYERhdGFTbmFwc2hvdGAgd2lsbCByZXR1cm4gdGhlIGtleSBmb3IgdGhlIGxvY2F0aW9uIHRoYXQgZ2VuZXJhdGVkIGl0Lg0KICAgICAqIEhvd2V2ZXIsIGFjY2Vzc2luZyB0aGUga2V5IG9uIHRoZSByb290IFVSTCBvZiBhIERhdGFiYXNlIHdpbGwgcmV0dXJuDQogICAgICogYG51bGxgLg0KICAgICAqLw0KICAgIGdldCBrZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZi5rZXk7DQogICAgfQ0KICAgIC8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgY2hpbGQgcHJvcGVydGllcyBvZiB0aGlzIGBEYXRhU25hcHNob3RgLiAqLw0KICAgIGdldCBzaXplKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbm9kZS5udW1DaGlsZHJlbigpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBHZXRzIGFub3RoZXIgYERhdGFTbmFwc2hvdGAgZm9yIHRoZSBsb2NhdGlvbiBhdCB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIHBhdGguDQogICAgICoNCiAgICAgKiBQYXNzaW5nIGEgcmVsYXRpdmUgcGF0aCB0byB0aGUgYGNoaWxkKClgIG1ldGhvZCBvZiBhIERhdGFTbmFwc2hvdCByZXR1cm5zDQogICAgICogYW5vdGhlciBgRGF0YVNuYXBzaG90YCBmb3IgdGhlIGxvY2F0aW9uIGF0IHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgcGF0aC4gVGhlDQogICAgICogcmVsYXRpdmUgcGF0aCBjYW4gZWl0aGVyIGJlIGEgc2ltcGxlIGNoaWxkIG5hbWUgKGZvciBleGFtcGxlLCAiYWRhIikgb3IgYQ0KICAgICAqIGRlZXBlciwgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCAiYWRhL25hbWUvZmlyc3QiKS4gSWYgdGhlIGNoaWxkDQogICAgICogbG9jYXRpb24gaGFzIG5vIGRhdGEsIGFuIGVtcHR5IGBEYXRhU25hcHNob3RgICh0aGF0IGlzLCBhIGBEYXRhU25hcHNob3RgDQogICAgICogd2hvc2UgdmFsdWUgaXMgYG51bGxgKSBpcyByZXR1cm5lZC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBwYXRoIC0gQSByZWxhdGl2ZSBwYXRoIHRvIHRoZSBsb2NhdGlvbiBvZiBjaGlsZCBkYXRhLg0KICAgICAqLw0KICAgIGNoaWxkKHBhdGgpIHsNCiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gbmV3IFBhdGgocGF0aCk7DQogICAgICAgIGNvbnN0IGNoaWxkUmVmID0gY2hpbGQodGhpcy5yZWYsIHBhdGgpOw0KICAgICAgICByZXR1cm4gbmV3IERhdGFTbmFwc2hvdCh0aGlzLl9ub2RlLmdldENoaWxkKGNoaWxkUGF0aCksIGNoaWxkUmVmLCBQUklPUklUWV9JTkRFWCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBEYXRhU25hcHNob3RgIGNvbnRhaW5zIGFueSBkYXRhLiBJdCBpcyBzbGlnaHRseSBtb3JlDQogICAgICogZWZmaWNpZW50IHRoYW4gdXNpbmcgYHNuYXBzaG90LnZhbCgpICE9PSBudWxsYC4NCiAgICAgKi8NCiAgICBleGlzdHMoKSB7DQogICAgICAgIHJldHVybiAhdGhpcy5fbm9kZS5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4cG9ydHMgdGhlIGVudGlyZSBjb250ZW50cyBvZiB0aGUgRGF0YVNuYXBzaG90IGFzIGEgSmF2YVNjcmlwdCBvYmplY3QuDQogICAgICoNCiAgICAgKiBUaGUgYGV4cG9ydFZhbCgpYCBtZXRob2QgaXMgc2ltaWxhciB0byBgdmFsKClgLCBleGNlcHQgcHJpb3JpdHkgaW5mb3JtYXRpb24NCiAgICAgKiBpcyBpbmNsdWRlZCAoaWYgYXZhaWxhYmxlKSwgbWFraW5nIGl0IHN1aXRhYmxlIGZvciBiYWNraW5nIHVwIHlvdXIgZGF0YS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRoZSBEYXRhU25hcHNob3QncyBjb250ZW50cyBhcyBhIEphdmFTY3JpcHQgdmFsdWUgKE9iamVjdCwNCiAgICAgKiAgIEFycmF5LCBzdHJpbmcsIG51bWJlciwgYm9vbGVhbiwgb3IgYG51bGxgKS4NCiAgICAgKi8NCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgIGV4cG9ydFZhbCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUudmFsKHRydWUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBFbnVtZXJhdGVzIHRoZSB0b3AtbGV2ZWwgY2hpbGRyZW4gaW4gdGhlIGBJdGVyYXRlZERhdGFTbmFwc2hvdGAuDQogICAgICoNCiAgICAgKiBCZWNhdXNlIG9mIHRoZSB3YXkgSmF2YVNjcmlwdCBvYmplY3RzIHdvcmssIHRoZSBvcmRlcmluZyBvZiBkYXRhIGluIHRoZQ0KICAgICAqIEphdmFTY3JpcHQgb2JqZWN0IHJldHVybmVkIGJ5IGB2YWwoKWAgaXMgbm90IGd1YXJhbnRlZWQgdG8gbWF0Y2ggdGhlDQogICAgICogb3JkZXJpbmcgb24gdGhlIHNlcnZlciBub3IgdGhlIG9yZGVyaW5nIG9mIGBvbkNoaWxkQWRkZWQoKWAgZXZlbnRzLiBUaGF0IGlzDQogICAgICogd2hlcmUgYGZvckVhY2goKWAgY29tZXMgaW4gaGFuZHkuIEl0IGd1YXJhbnRlZXMgdGhlIGNoaWxkcmVuIG9mIGENCiAgICAgKiBgRGF0YVNuYXBzaG90YCB3aWxsIGJlIGl0ZXJhdGVkIGluIHRoZWlyIHF1ZXJ5IG9yZGVyLg0KICAgICAqDQogICAgICogSWYgbm8gZXhwbGljaXQgYG9yZGVyQnkqKClgIG1ldGhvZCBpcyB1c2VkLCByZXN1bHRzIGFyZSByZXR1cm5lZA0KICAgICAqIG9yZGVyZWQgYnkga2V5ICh1bmxlc3MgcHJpb3JpdGllcyBhcmUgdXNlZCwgaW4gd2hpY2ggY2FzZSwgcmVzdWx0cyBhcmUNCiAgICAgKiByZXR1cm5lZCBieSBwcmlvcml0eSkuDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIGZvciBlYWNoIGNoaWxkIERhdGFTbmFwc2hvdC4NCiAgICAgKiBUaGUgY2FsbGJhY2sgY2FuIHJldHVybiB0cnVlIHRvIGNhbmNlbCBmdXJ0aGVyIGVudW1lcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHRydWUgaWYgZW51bWVyYXRpb24gd2FzIGNhbmNlbGVkIGR1ZSB0byB5b3VyIGNhbGxiYWNrIHJldHVybmluZw0KICAgICAqIHRydWUuDQogICAgICovDQogICAgZm9yRWFjaChhY3Rpb24pIHsNCiAgICAgICAgaWYgKHRoaXMuX25vZGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRyZW5Ob2RlID0gdGhpcy5fbm9kZTsNCiAgICAgICAgLy8gU2FuaXRpemUgdGhlIHJldHVybiB2YWx1ZSB0byBhIGJvb2xlYW4uIENoaWxkcmVuTm9kZS5mb3JFYWNoQ2hpbGQgaGFzIGEgd2VpcmQgcmV0dXJuIHR5cGUuLi4NCiAgICAgICAgcmV0dXJuICEhY2hpbGRyZW5Ob2RlLmZvckVhY2hDaGlsZCh0aGlzLl9pbmRleCwgKGtleSwgbm9kZSkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIGFjdGlvbihuZXcgRGF0YVNuYXBzaG90KG5vZGUsIGNoaWxkKHRoaXMucmVmLCBrZXkpLCBQUklPUklUWV9JTkRFWCkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVjaWZpZWQgY2hpbGQgcGF0aCBoYXMgKG5vbi1udWxsKSBkYXRhLg0KICAgICAqDQogICAgICogQHBhcmFtIHBhdGggLSBBIHJlbGF0aXZlIHBhdGggdG8gdGhlIGxvY2F0aW9uIG9mIGEgcG90ZW50aWFsIGNoaWxkLg0KICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiBkYXRhIGV4aXN0cyBhdCB0aGUgc3BlY2lmaWVkIGNoaWxkIHBhdGg7IGVsc2UNCiAgICAgKiAgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBoYXNDaGlsZChwYXRoKSB7DQogICAgICAgIGNvbnN0IGNoaWxkUGF0aCA9IG5ldyBQYXRoKHBhdGgpOw0KICAgICAgICByZXR1cm4gIXRoaXMuX25vZGUuZ2V0Q2hpbGQoY2hpbGRQYXRoKS5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGBEYXRhU25hcHNob3RgIGhhcyBhbnkgbm9uLWBudWxsYCBjaGlsZA0KICAgICAqIHByb3BlcnRpZXMuDQogICAgICoNCiAgICAgKiBZb3UgY2FuIHVzZSBgaGFzQ2hpbGRyZW4oKWAgdG8gZGV0ZXJtaW5lIGlmIGEgYERhdGFTbmFwc2hvdGAgaGFzIGFueQ0KICAgICAqIGNoaWxkcmVuLiBJZiBpdCBkb2VzLCB5b3UgY2FuIGVudW1lcmF0ZSB0aGVtIHVzaW5nIGBmb3JFYWNoKClgLiBJZiBpdA0KICAgICAqIGRvZXNuJ3QsIHRoZW4gZWl0aGVyIHRoaXMgc25hcHNob3QgY29udGFpbnMgYSBwcmltaXRpdmUgdmFsdWUgKHdoaWNoIGNhbiBiZQ0KICAgICAqIHJldHJpZXZlZCB3aXRoIGB2YWwoKWApIG9yIGl0IGlzIGVtcHR5IChpbiB3aGljaCBjYXNlLCBgdmFsKClgIHdpbGwgcmV0dXJuDQogICAgICogYG51bGxgKS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBzbmFwc2hvdCBoYXMgYW55IGNoaWxkcmVuOyBlbHNlIGZhbHNlLg0KICAgICAqLw0KICAgIGhhc0NoaWxkcmVuKCkgew0KICAgICAgICBpZiAodGhpcy5fbm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAhdGhpcy5fbm9kZS5pc0VtcHR5KCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0Lg0KICAgICAqLw0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0VmFsKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4dHJhY3RzIGEgSmF2YVNjcmlwdCB2YWx1ZSBmcm9tIGEgYERhdGFTbmFwc2hvdGAuDQogICAgICoNCiAgICAgKiBEZXBlbmRpbmcgb24gdGhlIGRhdGEgaW4gYSBgRGF0YVNuYXBzaG90YCwgdGhlIGB2YWwoKWAgbWV0aG9kIG1heSByZXR1cm4gYQ0KICAgICAqIHNjYWxhciB0eXBlIChzdHJpbmcsIG51bWJlciwgb3IgYm9vbGVhbiksIGFuIGFycmF5LCBvciBhbiBvYmplY3QuIEl0IG1heQ0KICAgICAqIGFsc28gcmV0dXJuIG51bGwsIGluZGljYXRpbmcgdGhhdCB0aGUgYERhdGFTbmFwc2hvdGAgaXMgZW1wdHkgKGNvbnRhaW5zIG5vDQogICAgICogZGF0YSkuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyBUaGUgRGF0YVNuYXBzaG90J3MgY29udGVudHMgYXMgYSBKYXZhU2NyaXB0IHZhbHVlIChPYmplY3QsDQogICAgICogICBBcnJheSwgc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9yIGBudWxsYCkuDQogICAgICovDQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICB2YWwoKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9ub2RlLnZhbCgpOw0KICAgIH0NCn0NCi8qKg0KICoNCiAqIFJldHVybnMgYSBgUmVmZXJlbmNlYCByZXByZXNlbnRpbmcgdGhlIGxvY2F0aW9uIGluIHRoZSBEYXRhYmFzZQ0KICogY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgcGF0aC4gSWYgbm8gcGF0aCBpcyBwcm92aWRlZCwgdGhlIGBSZWZlcmVuY2VgDQogKiB3aWxsIHBvaW50IHRvIHRoZSByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqDQogKiBAcGFyYW0gZGIgLSBUaGUgZGF0YWJhc2UgaW5zdGFuY2UgdG8gb2J0YWluIGEgcmVmZXJlbmNlIGZvci4NCiAqIEBwYXJhbSBwYXRoIC0gT3B0aW9uYWwgcGF0aCByZXByZXNlbnRpbmcgdGhlIGxvY2F0aW9uIHRoZSByZXR1cm5lZA0KICogICBgUmVmZXJlbmNlYCB3aWxsIHBvaW50LiBJZiBub3QgcHJvdmlkZWQsIHRoZSByZXR1cm5lZCBgUmVmZXJlbmNlYCB3aWxsDQogKiAgIHBvaW50IHRvIHRoZSByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqIEByZXR1cm5zIElmIGEgcGF0aCBpcyBwcm92aWRlZCwgYSBgUmVmZXJlbmNlYA0KICogICBwb2ludGluZyB0byB0aGUgcHJvdmlkZWQgcGF0aC4gT3RoZXJ3aXNlLCBhIGBSZWZlcmVuY2VgIHBvaW50aW5nIHRvIHRoZQ0KICogICByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqLw0KZnVuY3Rpb24gcmVmKGRiLCBwYXRoKSB7DQogICAgZGIgPSBnZXRNb2R1bGFySW5zdGFuY2UoZGIpOw0KICAgIGRiLl9jaGVja05vdERlbGV0ZWQoJ3JlZicpOw0KICAgIHJldHVybiBwYXRoICE9PSB1bmRlZmluZWQgPyBjaGlsZChkYi5fcm9vdCwgcGF0aCkgOiBkYi5fcm9vdDsNCn0NCi8qKg0KICogR2V0cyBhIGBSZWZlcmVuY2VgIGZvciB0aGUgbG9jYXRpb24gYXQgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSBwYXRoLg0KICoNCiAqIFRoZSByZWxhdGl2ZSBwYXRoIGNhbiBlaXRoZXIgYmUgYSBzaW1wbGUgY2hpbGQgbmFtZSAoZm9yIGV4YW1wbGUsICJhZGEiKSBvcg0KICogYSBkZWVwZXIgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCAiYWRhL25hbWUvZmlyc3QiKS4NCiAqDQogKiBAcGFyYW0gcGFyZW50IC0gVGhlIHBhcmVudCBsb2NhdGlvbi4NCiAqIEBwYXJhbSBwYXRoIC0gQSByZWxhdGl2ZSBwYXRoIGZyb20gdGhpcyBsb2NhdGlvbiB0byB0aGUgZGVzaXJlZCBjaGlsZA0KICogICBsb2NhdGlvbi4NCiAqIEByZXR1cm5zIFRoZSBzcGVjaWZpZWQgY2hpbGQgbG9jYXRpb24uDQogKi8NCmZ1bmN0aW9uIGNoaWxkKHBhcmVudCwgcGF0aCkgew0KICAgIHBhcmVudCA9IGdldE1vZHVsYXJJbnN0YW5jZShwYXJlbnQpOw0KICAgIGlmIChwYXRoR2V0RnJvbnQocGFyZW50Ll9wYXRoKSA9PT0gbnVsbCkgew0KICAgICAgICB2YWxpZGF0ZVJvb3RQYXRoU3RyaW5nKCdjaGlsZCcsICdwYXRoJywgcGF0aCwgZmFsc2UpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmFsaWRhdGVQYXRoU3RyaW5nKCdjaGlsZCcsICdwYXRoJywgcGF0aCwgZmFsc2UpOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IFJlZmVyZW5jZUltcGwocGFyZW50Ll9yZXBvLCBwYXRoQ2hpbGQocGFyZW50Ll9wYXRoLCBwYXRoKSk7DQp9DQovKioNCiAqIFJlbW92ZXMgdGhlIGRhdGEgYXQgdGhpcyBEYXRhYmFzZSBsb2NhdGlvbi4NCiAqDQogKiBBbnkgZGF0YSBhdCBjaGlsZCBsb2NhdGlvbnMgd2lsbCBhbHNvIGJlIGRlbGV0ZWQuDQogKg0KICogVGhlIGVmZmVjdCBvZiB0aGUgcmVtb3ZlIHdpbGwgYmUgdmlzaWJsZSBpbW1lZGlhdGVseSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcNCiAqIGV2ZW50ICd2YWx1ZScgd2lsbCBiZSB0cmlnZ2VyZWQuIFN5bmNocm9uaXphdGlvbiBvZiB0aGUgcmVtb3ZlIHRvIHRoZQ0KICogRmlyZWJhc2Ugc2VydmVycyB3aWxsIGFsc28gYmUgc3RhcnRlZCwgYW5kIHRoZSByZXR1cm5lZCBQcm9taXNlIHdpbGwgcmVzb2x2ZQ0KICogd2hlbiBjb21wbGV0ZS4gSWYgcHJvdmlkZWQsIHRoZSBvbkNvbXBsZXRlIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVkDQogKiBhc3luY2hyb25vdXNseSBhZnRlciBzeW5jaHJvbml6YXRpb24gaGFzIGZpbmlzaGVkLg0KICoNCiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gcmVtb3ZlLg0KICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiByZW1vdmUgb24gc2VydmVyIGlzIGNvbXBsZXRlLg0KICovDQpmdW5jdGlvbiByZW1vdmUocmVmKSB7DQogICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ3JlbW92ZScsIHJlZi5fcGF0aCk7DQogICAgcmV0dXJuIHNldCQxKHJlZiwgbnVsbCk7DQp9DQovKioNCiAqIFdyaXRlcyBkYXRhIHRvIHRoaXMgRGF0YWJhc2UgbG9jYXRpb24uDQogKg0KICogVGhpcyB3aWxsIG92ZXJ3cml0ZSBhbnkgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGFuZCBhbGwgY2hpbGQgbG9jYXRpb25zLg0KICoNCiAqIFRoZSBlZmZlY3Qgb2YgdGhlIHdyaXRlIHdpbGwgYmUgdmlzaWJsZSBpbW1lZGlhdGVseSwgYW5kIHRoZSBjb3JyZXNwb25kaW5nDQogKiBldmVudHMgKCJ2YWx1ZSIsICJjaGlsZF9hZGRlZCIsIGV0Yy4pIHdpbGwgYmUgdHJpZ2dlcmVkLiBTeW5jaHJvbml6YXRpb24gb2YNCiAqIHRoZSBkYXRhIHRvIHRoZSBGaXJlYmFzZSBzZXJ2ZXJzIHdpbGwgYWxzbyBiZSBzdGFydGVkLCBhbmQgdGhlIHJldHVybmVkDQogKiBQcm9taXNlIHdpbGwgcmVzb2x2ZSB3aGVuIGNvbXBsZXRlLiBJZiBwcm92aWRlZCwgdGhlIGBvbkNvbXBsZXRlYCBjYWxsYmFjaw0KICogd2lsbCBiZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkgYWZ0ZXIgc3luY2hyb25pemF0aW9uIGhhcyBmaW5pc2hlZC4NCiAqDQogKiBQYXNzaW5nIGBudWxsYCBmb3IgdGhlIG5ldyB2YWx1ZSBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmcgYHJlbW92ZSgpYDsgbmFtZWx5LA0KICogYWxsIGRhdGEgYXQgdGhpcyBsb2NhdGlvbiBhbmQgYWxsIGNoaWxkIGxvY2F0aW9ucyB3aWxsIGJlIGRlbGV0ZWQuDQogKg0KICogYHNldCgpYCB3aWxsIHJlbW92ZSBhbnkgcHJpb3JpdHkgc3RvcmVkIGF0IHRoaXMgbG9jYXRpb24sIHNvIGlmIHByaW9yaXR5IGlzDQogKiBtZWFudCB0byBiZSBwcmVzZXJ2ZWQsIHlvdSBuZWVkIHRvIHVzZSBgc2V0V2l0aFByaW9yaXR5KClgIGluc3RlYWQuDQogKg0KICogTm90ZSB0aGF0IG1vZGlmeWluZyBkYXRhIHdpdGggYHNldCgpYCB3aWxsIGNhbmNlbCBhbnkgcGVuZGluZyB0cmFuc2FjdGlvbnMNCiAqIGF0IHRoYXQgbG9jYXRpb24sIHNvIGV4dHJlbWUgY2FyZSBzaG91bGQgYmUgdGFrZW4gaWYgbWl4aW5nIGBzZXQoKWAgYW5kDQogKiBgdHJhbnNhY3Rpb24oKWAgdG8gbW9kaWZ5IHRoZSBzYW1lIGRhdGEuDQogKg0KICogQSBzaW5nbGUgYHNldCgpYCB3aWxsIGdlbmVyYXRlIGEgc2luZ2xlICJ2YWx1ZSIgZXZlbnQgYXQgdGhlIGxvY2F0aW9uIHdoZXJlDQogKiB0aGUgYHNldCgpYCB3YXMgcGVyZm9ybWVkLg0KICoNCiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gd3JpdGUgdG8uDQogKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gYmUgd3JpdHRlbiAoc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9iamVjdCwNCiAqICAgYXJyYXksIG9yIG51bGwpLg0KICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiB3cml0ZSB0byBzZXJ2ZXIgaXMgY29tcGxldGUuDQogKi8NCmZ1bmN0aW9uIHNldCQxKHJlZiwgdmFsdWUpIHsNCiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTsNCiAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgnc2V0JywgcmVmLl9wYXRoKTsNCiAgICB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZygnc2V0JywgdmFsdWUsIHJlZi5fcGF0aCwgZmFsc2UpOw0KICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7DQogICAgcmVwb1NldFdpdGhQcmlvcml0eShyZWYuX3JlcG8sIHJlZi5fcGF0aCwgdmFsdWUsIA0KICAgIC8qcHJpb3JpdHk9Ki8gbnVsbCwgZGVmZXJyZWQud3JhcENhbGxiYWNrKCgpID0+IHsgfSkpOw0KICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOw0KfQ0KLyoqDQogKiBSZXByZXNlbnRzIHJlZ2lzdHJhdGlvbiBmb3IgJ3ZhbHVlJyBldmVudHMuDQogKi8NCmNsYXNzIFZhbHVlRXZlbnRSZWdpc3RyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGNhbGxiYWNrQ29udGV4dCkgew0KICAgICAgICB0aGlzLmNhbGxiYWNrQ29udGV4dCA9IGNhbGxiYWNrQ29udGV4dDsNCiAgICB9DQogICAgcmVzcG9uZHNUbyhldmVudFR5cGUpIHsNCiAgICAgICAgcmV0dXJuIGV2ZW50VHlwZSA9PT0gJ3ZhbHVlJzsNCiAgICB9DQogICAgY3JlYXRlRXZlbnQoY2hhbmdlLCBxdWVyeSkgew0KICAgICAgICBjb25zdCBpbmRleCA9IHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpOw0KICAgICAgICByZXR1cm4gbmV3IERhdGFFdmVudCgndmFsdWUnLCB0aGlzLCBuZXcgRGF0YVNuYXBzaG90KGNoYW5nZS5zbmFwc2hvdE5vZGUsIG5ldyBSZWZlcmVuY2VJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCksIGluZGV4KSk7DQogICAgfQ0KICAgIGdldEV2ZW50UnVubmVyKGV2ZW50RGF0YSkgew0KICAgICAgICBpZiAoZXZlbnREYXRhLmdldEV2ZW50VHlwZSgpID09PSAnY2FuY2VsJykgew0KICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uQ2FuY2VsKGV2ZW50RGF0YS5lcnJvcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5jYWxsYmFja0NvbnRleHQub25WYWx1ZShldmVudERhdGEuc25hcHNob3QsIG51bGwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNyZWF0ZUNhbmNlbEV2ZW50KGVycm9yLCBwYXRoKSB7DQogICAgICAgIGlmICh0aGlzLmNhbGxiYWNrQ29udGV4dC5oYXNDYW5jZWxDYWxsYmFjaykgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxFdmVudCh0aGlzLCBlcnJvciwgcGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBtYXRjaGVzKG90aGVyKSB7DQogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgVmFsdWVFdmVudFJlZ2lzdHJhdGlvbikpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICghb3RoZXIuY2FsbGJhY2tDb250ZXh0IHx8ICF0aGlzLmNhbGxiYWNrQ29udGV4dCkgew0KICAgICAgICAgICAgLy8gSWYgbm8gY2FsbGJhY2sgc3BlY2lmaWVkLCB3ZSBjb25zaWRlciBpdCB0byBtYXRjaCBhbnkgY2FsbGJhY2suDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBvdGhlci5jYWxsYmFja0NvbnRleHQubWF0Y2hlcyh0aGlzLmNhbGxiYWNrQ29udGV4dCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzQW55Q2FsbGJhY2soKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNhbGxiYWNrQ29udGV4dCAhPT0gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFJlcHJlc2VudHMgdGhlIHJlZ2lzdHJhdGlvbiBvZiBhIGNoaWxkX3ggZXZlbnQuDQogKi8NCmNsYXNzIENoaWxkRXZlbnRSZWdpc3RyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGV2ZW50VHlwZSwgY2FsbGJhY2tDb250ZXh0KSB7DQogICAgICAgIHRoaXMuZXZlbnRUeXBlID0gZXZlbnRUeXBlOw0KICAgICAgICB0aGlzLmNhbGxiYWNrQ29udGV4dCA9IGNhbGxiYWNrQ29udGV4dDsNCiAgICB9DQogICAgcmVzcG9uZHNUbyhldmVudFR5cGUpIHsNCiAgICAgICAgbGV0IGV2ZW50VG9DaGVjayA9IGV2ZW50VHlwZSA9PT0gJ2NoaWxkcmVuX2FkZGVkJyA/ICdjaGlsZF9hZGRlZCcgOiBldmVudFR5cGU7DQogICAgICAgIGV2ZW50VG9DaGVjayA9DQogICAgICAgICAgICBldmVudFRvQ2hlY2sgPT09ICdjaGlsZHJlbl9yZW1vdmVkJyA/ICdjaGlsZF9yZW1vdmVkJyA6IGV2ZW50VG9DaGVjazsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUeXBlID09PSBldmVudFRvQ2hlY2s7DQogICAgfQ0KICAgIGNyZWF0ZUNhbmNlbEV2ZW50KGVycm9yLCBwYXRoKSB7DQogICAgICAgIGlmICh0aGlzLmNhbGxiYWNrQ29udGV4dC5oYXNDYW5jZWxDYWxsYmFjaykgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxFdmVudCh0aGlzLCBlcnJvciwgcGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjcmVhdGVFdmVudChjaGFuZ2UsIHF1ZXJ5KSB7DQogICAgICAgIGFzc2VydChjaGFuZ2UuY2hpbGROYW1lICE9IG51bGwsICdDaGlsZCBldmVudHMgc2hvdWxkIGhhdmUgYSBjaGlsZE5hbWUuJyk7DQogICAgICAgIGNvbnN0IGNoaWxkUmVmID0gY2hpbGQobmV3IFJlZmVyZW5jZUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoKSwgY2hhbmdlLmNoaWxkTmFtZSk7DQogICAgICAgIGNvbnN0IGluZGV4ID0gcXVlcnkuX3F1ZXJ5UGFyYW1zLmdldEluZGV4KCk7DQogICAgICAgIHJldHVybiBuZXcgRGF0YUV2ZW50KGNoYW5nZS50eXBlLCB0aGlzLCBuZXcgRGF0YVNuYXBzaG90KGNoYW5nZS5zbmFwc2hvdE5vZGUsIGNoaWxkUmVmLCBpbmRleCksIGNoYW5nZS5wcmV2TmFtZSk7DQogICAgfQ0KICAgIGdldEV2ZW50UnVubmVyKGV2ZW50RGF0YSkgew0KICAgICAgICBpZiAoZXZlbnREYXRhLmdldEV2ZW50VHlwZSgpID09PSAnY2FuY2VsJykgew0KICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uQ2FuY2VsKGV2ZW50RGF0YS5lcnJvcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5jYWxsYmFja0NvbnRleHQub25WYWx1ZShldmVudERhdGEuc25hcHNob3QsIGV2ZW50RGF0YS5wcmV2TmFtZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgbWF0Y2hlcyhvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBDaGlsZEV2ZW50UmVnaXN0cmF0aW9uKSB7DQogICAgICAgICAgICByZXR1cm4gKHRoaXMuZXZlbnRUeXBlID09PSBvdGhlci5ldmVudFR5cGUgJiYNCiAgICAgICAgICAgICAgICAoIXRoaXMuY2FsbGJhY2tDb250ZXh0IHx8DQogICAgICAgICAgICAgICAgICAgICFvdGhlci5jYWxsYmFja0NvbnRleHQgfHwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja0NvbnRleHQubWF0Y2hlcyhvdGhlci5jYWxsYmFja0NvbnRleHQpKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBoYXNBbnlDYWxsYmFjaygpIHsNCiAgICAgICAgcmV0dXJuICEhdGhpcy5jYWxsYmFja0NvbnRleHQ7DQogICAgfQ0KfQ0KZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lciQxKHF1ZXJ5LCBldmVudFR5cGUsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykgew0KICAgIGxldCBjYW5jZWxDYWxsYmFjazsNCiAgICBpZiAodHlwZW9mIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zID09PSAnb2JqZWN0Jykgew0KICAgICAgICBjYW5jZWxDYWxsYmFjayA9IHVuZGVmaW5lZDsNCiAgICAgICAgb3B0aW9ucyA9IGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGNhbmNlbENhbGxiYWNrID0gY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnM7DQogICAgfQ0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMub25seU9uY2UpIHsNCiAgICAgICAgY29uc3QgdXNlckNhbGxiYWNrID0gY2FsbGJhY2s7DQogICAgICAgIGNvbnN0IG9uY2VDYWxsYmFjayA9IChkYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKSA9PiB7DQogICAgICAgICAgICByZXBvUmVtb3ZlRXZlbnRDYWxsYmFja0ZvclF1ZXJ5KHF1ZXJ5Ll9yZXBvLCBxdWVyeSwgY29udGFpbmVyKTsNCiAgICAgICAgICAgIHVzZXJDYWxsYmFjayhkYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKTsNCiAgICAgICAgfTsNCiAgICAgICAgb25jZUNhbGxiYWNrLnVzZXJDYWxsYmFjayA9IGNhbGxiYWNrLnVzZXJDYWxsYmFjazsNCiAgICAgICAgb25jZUNhbGxiYWNrLmNvbnRleHQgPSBjYWxsYmFjay5jb250ZXh0Ow0KICAgICAgICBjYWxsYmFjayA9IG9uY2VDYWxsYmFjazsNCiAgICB9DQogICAgY29uc3QgY2FsbGJhY2tDb250ZXh0ID0gbmV3IENhbGxiYWNrQ29udGV4dChjYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2sgfHwgdW5kZWZpbmVkKTsNCiAgICBjb25zdCBjb250YWluZXIgPSBldmVudFR5cGUgPT09ICd2YWx1ZScNCiAgICAgICAgPyBuZXcgVmFsdWVFdmVudFJlZ2lzdHJhdGlvbihjYWxsYmFja0NvbnRleHQpDQogICAgICAgIDogbmV3IENoaWxkRXZlbnRSZWdpc3RyYXRpb24oZXZlbnRUeXBlLCBjYWxsYmFja0NvbnRleHQpOw0KICAgIHJlcG9BZGRFdmVudENhbGxiYWNrRm9yUXVlcnkocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpOw0KICAgIHJldHVybiAoKSA9PiByZXBvUmVtb3ZlRXZlbnRDYWxsYmFja0ZvclF1ZXJ5KHF1ZXJ5Ll9yZXBvLCBxdWVyeSwgY29udGFpbmVyKTsNCn0NCmZ1bmN0aW9uIG9uVmFsdWUocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykgew0KICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyJDEocXVlcnksICd2YWx1ZScsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucyk7DQp9DQovKioNCiAqIERlZmluZSByZWZlcmVuY2UgY29uc3RydWN0b3IgaW4gdmFyaW91cyBtb2R1bGVzDQogKg0KICogV2UgYXJlIGRvaW5nIHRoaXMgaGVyZSB0byBhdm9pZCBzZXZlcmFsIGNpcmN1bGFyDQogKiBkZXBlbmRlbmN5IGlzc3Vlcw0KICovDQpzeW5jUG9pbnRTZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcihSZWZlcmVuY2VJbXBsKTsNCnN5bmNUcmVlU2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoUmVmZXJlbmNlSW1wbCk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoaXMgdmFyaWFibGUgaXMgYWxzbyBkZWZpbmVkIGluIHRoZSBmaXJlYmFzZSBOb2RlLmpzIEFkbWluIFNESy4gQmVmb3JlDQogKiBtb2RpZnlpbmcgdGhpcyBkZWZpbml0aW9uLCBjb25zdWx0IHRoZSBkZWZpbml0aW9uIGluOg0KICoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1hZG1pbi1ub2RlDQogKg0KICogYW5kIG1ha2Ugc3VyZSB0aGUgdHdvIGFyZSBjb25zaXN0ZW50Lg0KICovDQpjb25zdCBGSVJFQkFTRV9EQVRBQkFTRV9FTVVMQVRPUl9IT1NUX1ZBUiA9ICdGSVJFQkFTRV9EQVRBQkFTRV9FTVVMQVRPUl9IT1NUJzsNCi8qKg0KICogQ3JlYXRlcyBhbmQgY2FjaGVzIGBSZXBvYCBpbnN0YW5jZXMuDQogKi8NCmNvbnN0IHJlcG9zID0ge307DQovKioNCiAqIElmIHRydWUsIGFueSBuZXcgYFJlcG9gIHdpbGwgYmUgY3JlYXRlZCB0byB1c2UgYFJlYWRvbmx5UmVzdENsaWVudGAgKGZvciB0ZXN0aW5nIHB1cnBvc2VzKS4NCiAqLw0KbGV0IHVzZVJlc3RDbGllbnQgPSBmYWxzZTsNCi8qKg0KICogVXBkYXRlIGFuIGV4aXN0aW5nIGBSZXBvYCBpbiBwbGFjZSB0byBwb2ludCB0byBhIG5ldyBob3N0L3BvcnQuDQogKi8NCmZ1bmN0aW9uIHJlcG9NYW5hZ2VyQXBwbHlFbXVsYXRvclNldHRpbmdzKHJlcG8sIGhvc3QsIHBvcnQsIHRva2VuUHJvdmlkZXIpIHsNCiAgICByZXBvLnJlcG9JbmZvXyA9IG5ldyBSZXBvSW5mbyhgJHtob3N0fToke3BvcnR9YCwgDQogICAgLyogc2VjdXJlPSAqLyBmYWxzZSwgcmVwby5yZXBvSW5mb18ubmFtZXNwYWNlLCByZXBvLnJlcG9JbmZvXy53ZWJTb2NrZXRPbmx5LCByZXBvLnJlcG9JbmZvXy5ub2RlQWRtaW4sIHJlcG8ucmVwb0luZm9fLnBlcnNpc3RlbmNlS2V5LCByZXBvLnJlcG9JbmZvXy5pbmNsdWRlTmFtZXNwYWNlSW5RdWVyeVBhcmFtcywgDQogICAgLyppc1VzaW5nRW11bGF0b3I9Ki8gdHJ1ZSk7DQogICAgaWYgKHRva2VuUHJvdmlkZXIpIHsNCiAgICAgICAgcmVwby5hdXRoVG9rZW5Qcm92aWRlcl8gPSB0b2tlblByb3ZpZGVyOw0KICAgIH0NCn0NCi8qKg0KICogVGhpcyBmdW5jdGlvbiBzaG91bGQgb25seSBldmVyIGJlIGNhbGxlZCB0byBDUkVBVEUgYSBuZXcgZGF0YWJhc2UgaW5zdGFuY2UuDQogKiBAaW50ZXJuYWwNCiAqLw0KZnVuY3Rpb24gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCwgbm9kZUFkbWluKSB7DQogICAgbGV0IGRiVXJsID0gdXJsIHx8IGFwcC5vcHRpb25zLmRhdGFiYXNlVVJMOw0KICAgIGlmIChkYlVybCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGlmICghYXBwLm9wdGlvbnMucHJvamVjdElkKSB7DQogICAgICAgICAgICBmYXRhbCgiQ2FuJ3QgZGV0ZXJtaW5lIEZpcmViYXNlIERhdGFiYXNlIFVSTC4gQmUgc3VyZSB0byBpbmNsdWRlICIgKw0KICAgICAgICAgICAgICAgICcgYSBQcm9qZWN0IElEIHdoZW4gY2FsbGluZyBmaXJlYmFzZS5pbml0aWFsaXplQXBwKCkuJyk7DQogICAgICAgIH0NCiAgICAgICAgbG9nKCdVc2luZyBkZWZhdWx0IGhvc3QgZm9yIHByb2plY3QgJywgYXBwLm9wdGlvbnMucHJvamVjdElkKTsNCiAgICAgICAgZGJVcmwgPSBgJHthcHAub3B0aW9ucy5wcm9qZWN0SWR9LWRlZmF1bHQtcnRkYi5maXJlYmFzZWlvLmNvbWA7DQogICAgfQ0KICAgIGxldCBwYXJzZWRVcmwgPSBwYXJzZVJlcG9JbmZvKGRiVXJsLCBub2RlQWRtaW4pOw0KICAgIGxldCByZXBvSW5mbyA9IHBhcnNlZFVybC5yZXBvSW5mbzsNCiAgICBsZXQgaXNFbXVsYXRvcjsNCiAgICBsZXQgZGJFbXVsYXRvckhvc3QgPSB1bmRlZmluZWQ7DQogICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudikgew0KICAgICAgICBkYkVtdWxhdG9ySG9zdCA9IHByb2Nlc3MuZW52W0ZJUkVCQVNFX0RBVEFCQVNFX0VNVUxBVE9SX0hPU1RfVkFSXTsNCiAgICB9DQogICAgaWYgKGRiRW11bGF0b3JIb3N0KSB7DQogICAgICAgIGlzRW11bGF0b3IgPSB0cnVlOw0KICAgICAgICBkYlVybCA9IGBodHRwOi8vJHtkYkVtdWxhdG9ySG9zdH0/bnM9JHtyZXBvSW5mby5uYW1lc3BhY2V9YDsNCiAgICAgICAgcGFyc2VkVXJsID0gcGFyc2VSZXBvSW5mbyhkYlVybCwgbm9kZUFkbWluKTsNCiAgICAgICAgcmVwb0luZm8gPSBwYXJzZWRVcmwucmVwb0luZm87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpc0VtdWxhdG9yID0gIXBhcnNlZFVybC5yZXBvSW5mby5zZWN1cmU7DQogICAgfQ0KICAgIGNvbnN0IGF1dGhUb2tlblByb3ZpZGVyID0gbm9kZUFkbWluICYmIGlzRW11bGF0b3INCiAgICAgICAgPyBuZXcgRW11bGF0b3JUb2tlblByb3ZpZGVyKEVtdWxhdG9yVG9rZW5Qcm92aWRlci5PV05FUikNCiAgICAgICAgOiBuZXcgRmlyZWJhc2VBdXRoVG9rZW5Qcm92aWRlcihhcHAubmFtZSwgYXBwLm9wdGlvbnMsIGF1dGhQcm92aWRlcik7DQogICAgdmFsaWRhdGVVcmwoJ0ludmFsaWQgRmlyZWJhc2UgRGF0YWJhc2UgVVJMJywgcGFyc2VkVXJsKTsNCiAgICBpZiAoIXBhdGhJc0VtcHR5KHBhcnNlZFVybC5wYXRoKSkgew0KICAgICAgICBmYXRhbCgnRGF0YWJhc2UgVVJMIG11c3QgcG9pbnQgdG8gdGhlIHJvb3Qgb2YgYSBGaXJlYmFzZSBEYXRhYmFzZSAnICsNCiAgICAgICAgICAgICcobm90IGluY2x1ZGluZyBhIGNoaWxkIHBhdGgpLicpOw0KICAgIH0NCiAgICBjb25zdCByZXBvID0gcmVwb01hbmFnZXJDcmVhdGVSZXBvKHJlcG9JbmZvLCBhcHAsIGF1dGhUb2tlblByb3ZpZGVyLCBuZXcgQXBwQ2hlY2tUb2tlblByb3ZpZGVyKGFwcC5uYW1lLCBhcHBDaGVja1Byb3ZpZGVyKSk7DQogICAgcmV0dXJuIG5ldyBEYXRhYmFzZShyZXBvLCBhcHApOw0KfQ0KLyoqDQogKiBSZW1vdmUgdGhlIHJlcG8gYW5kIG1ha2Ugc3VyZSBpdCBpcyBkaXNjb25uZWN0ZWQuDQogKg0KICovDQpmdW5jdGlvbiByZXBvTWFuYWdlckRlbGV0ZVJlcG8ocmVwbywgYXBwTmFtZSkgew0KICAgIGNvbnN0IGFwcFJlcG9zID0gcmVwb3NbYXBwTmFtZV07DQogICAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuLi4uDQogICAgaWYgKCFhcHBSZXBvcyB8fCBhcHBSZXBvc1tyZXBvLmtleV0gIT09IHJlcG8pIHsNCiAgICAgICAgZmF0YWwoYERhdGFiYXNlICR7YXBwTmFtZX0oJHtyZXBvLnJlcG9JbmZvX30pIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZC5gKTsNCiAgICB9DQogICAgcmVwb0ludGVycnVwdChyZXBvKTsNCiAgICBkZWxldGUgYXBwUmVwb3NbcmVwby5rZXldOw0KfQ0KLyoqDQogKiBFbnN1cmVzIGEgcmVwbyBkb2Vzbid0IGFscmVhZHkgZXhpc3QgYW5kIHRoZW4gY3JlYXRlcyBvbmUgdXNpbmcgdGhlDQogKiBwcm92aWRlZCBhcHAuDQogKg0KICogQHBhcmFtIHJlcG9JbmZvIC0gVGhlIG1ldGFkYXRhIGFib3V0IHRoZSBSZXBvDQogKiBAcmV0dXJucyBUaGUgUmVwbyBvYmplY3QgZm9yIHRoZSBzcGVjaWZpZWQgc2VydmVyIC8gcmVwb05hbWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9NYW5hZ2VyQ3JlYXRlUmVwbyhyZXBvSW5mbywgYXBwLCBhdXRoVG9rZW5Qcm92aWRlciwgYXBwQ2hlY2tQcm92aWRlcikgew0KICAgIGxldCBhcHBSZXBvcyA9IHJlcG9zW2FwcC5uYW1lXTsNCiAgICBpZiAoIWFwcFJlcG9zKSB7DQogICAgICAgIGFwcFJlcG9zID0ge307DQogICAgICAgIHJlcG9zW2FwcC5uYW1lXSA9IGFwcFJlcG9zOw0KICAgIH0NCiAgICBsZXQgcmVwbyA9IGFwcFJlcG9zW3JlcG9JbmZvLnRvVVJMU3RyaW5nKCldOw0KICAgIGlmIChyZXBvKSB7DQogICAgICAgIGZhdGFsKCdEYXRhYmFzZSBpbml0aWFsaXplZCBtdWx0aXBsZSB0aW1lcy4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhYmFzZSBVUkwgbWF0Y2hlcyB3aXRoIGVhY2ggZGF0YWJhc2UoKSBjYWxsLicpOw0KICAgIH0NCiAgICByZXBvID0gbmV3IFJlcG8ocmVwb0luZm8sIHVzZVJlc3RDbGllbnQsIGF1dGhUb2tlblByb3ZpZGVyLCBhcHBDaGVja1Byb3ZpZGVyKTsNCiAgICBhcHBSZXBvc1tyZXBvSW5mby50b1VSTFN0cmluZygpXSA9IHJlcG87DQogICAgcmV0dXJuIHJlcG87DQp9DQovKioNCiAqIENsYXNzIHJlcHJlc2VudGluZyBhIEZpcmViYXNlIFJlYWx0aW1lIERhdGFiYXNlLg0KICovDQpjbGFzcyBEYXRhYmFzZSB7DQogICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi8NCiAgICBjb25zdHJ1Y3RvcihfcmVwb0ludGVybmFsLCANCiAgICAvKiogVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBhc3NvY2lhdGVkIHdpdGggdGhpcyBSZWFsdGltZSBEYXRhYmFzZSBpbnN0YW5jZS4gKi8NCiAgICBhcHApIHsNCiAgICAgICAgdGhpcy5fcmVwb0ludGVybmFsID0gX3JlcG9JbnRlcm5hbDsNCiAgICAgICAgdGhpcy5hcHAgPSBhcHA7DQogICAgICAgIC8qKiBSZXByZXNlbnRzIGEgYERhdGFiYXNlYCBpbnN0YW5jZS4gKi8NCiAgICAgICAgdGhpc1sndHlwZSddID0gJ2RhdGFiYXNlJzsNCiAgICAgICAgLyoqIFRyYWNrIGlmIHRoZSBpbnN0YW5jZSBoYXMgYmVlbiB1c2VkIChyb290IG9yIHJlcG8gYWNjZXNzZWQpICovDQogICAgICAgIHRoaXMuX2luc3RhbmNlU3RhcnRlZCA9IGZhbHNlOw0KICAgIH0NCiAgICBnZXQgX3JlcG8oKSB7DQogICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VTdGFydGVkKSB7DQogICAgICAgICAgICByZXBvU3RhcnQodGhpcy5fcmVwb0ludGVybmFsLCB0aGlzLmFwcC5vcHRpb25zLmFwcElkLCB0aGlzLmFwcC5vcHRpb25zWydkYXRhYmFzZUF1dGhWYXJpYWJsZU92ZXJyaWRlJ10pOw0KICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VTdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5fcmVwb0ludGVybmFsOw0KICAgIH0NCiAgICBnZXQgX3Jvb3QoKSB7DQogICAgICAgIGlmICghdGhpcy5fcm9vdEludGVybmFsKSB7DQogICAgICAgICAgICB0aGlzLl9yb290SW50ZXJuYWwgPSBuZXcgUmVmZXJlbmNlSW1wbCh0aGlzLl9yZXBvLCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuX3Jvb3RJbnRlcm5hbDsNCiAgICB9DQogICAgX2RlbGV0ZSgpIHsNCiAgICAgICAgaWYgKHRoaXMuX3Jvb3RJbnRlcm5hbCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgcmVwb01hbmFnZXJEZWxldGVSZXBvKHRoaXMuX3JlcG8sIHRoaXMuYXBwLm5hbWUpOw0KICAgICAgICAgICAgdGhpcy5fcmVwb0ludGVybmFsID0gbnVsbDsNCiAgICAgICAgICAgIHRoaXMuX3Jvb3RJbnRlcm5hbCA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOw0KICAgIH0NCiAgICBfY2hlY2tOb3REZWxldGVkKGFwaU5hbWUpIHsNCiAgICAgICAgaWYgKHRoaXMuX3Jvb3RJbnRlcm5hbCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgZmF0YWwoJ0Nhbm5vdCBjYWxsICcgKyBhcGlOYW1lICsgJyBvbiBhIGRlbGV0ZWQgZGF0YWJhc2UuJyk7DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBSZWFsdGltZSBEYXRhYmFzZSBTREsgdGhhdCBpcyBhc3NvY2lhdGVkDQogKiB3aXRoIHRoZSBwcm92aWRlZCB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0uIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIHdpdGgNCiAqIHdpdGggZGVmYXVsdCBzZXR0aW5ncyBpZiBubyBpbnN0YW5jZSBleGlzdHMgb3IgaWYgdGhlIGV4aXN0aW5nIGluc3RhbmNlIHVzZXMNCiAqIGEgY3VzdG9tIGRhdGFiYXNlIFVSTC4NCiAqDQogKiBAcGFyYW0gYXBwIC0gVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBpbnN0YW5jZSB0aGF0IHRoZSByZXR1cm5lZCBSZWFsdGltZQ0KICogRGF0YWJhc2UgaW5zdGFuY2UgaXMgYXNzb2NpYXRlZCB3aXRoLg0KICogQHBhcmFtIHVybCAtIFRoZSBVUkwgb2YgdGhlIFJlYWx0aW1lIERhdGFiYXNlIGluc3RhbmNlIHRvIGNvbm5lY3QgdG8uIElmIG5vdA0KICogcHJvdmlkZWQsIHRoZSBTREsgY29ubmVjdHMgdG8gdGhlIGRlZmF1bHQgaW5zdGFuY2Ugb2YgdGhlIEZpcmViYXNlIEFwcC4NCiAqIEByZXR1cm5zIFRoZSBgRGF0YWJhc2VgIGluc3RhbmNlIG9mIHRoZSBwcm92aWRlZCBhcHAuDQogKi8NCmZ1bmN0aW9uIGdldERhdGFiYXNlKGFwcCA9IGdldEFwcCgpLCB1cmwpIHsNCiAgICBjb25zdCBkYiA9IF9nZXRQcm92aWRlcihhcHAsICdkYXRhYmFzZScpLmdldEltbWVkaWF0ZSh7DQogICAgICAgIGlkZW50aWZpZXI6IHVybA0KICAgIH0pOw0KICAgIGlmICghZGIuX2luc3RhbmNlU3RhcnRlZCkgew0KICAgICAgICBjb25zdCBlbXVsYXRvciA9IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCgnZGF0YWJhc2UnKTsNCiAgICAgICAgaWYgKGVtdWxhdG9yKSB7DQogICAgICAgICAgICBjb25uZWN0RGF0YWJhc2VFbXVsYXRvcihkYiwgLi4uZW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkYjsNCn0NCi8qKg0KICogTW9kaWZ5IHRoZSBwcm92aWRlZCBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBSZWFsdGltZSBEYXRhYmFzZQ0KICogZW11bGF0b3IuDQogKg0KICogPHA+Tm90ZTogVGhpcyBtZXRob2QgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIHBlcmZvcm1pbmcgYW55IG90aGVyIG9wZXJhdGlvbi4NCiAqDQogKiBAcGFyYW0gZGIgLSBUaGUgaW5zdGFuY2UgdG8gbW9kaWZ5Lg0KICogQHBhcmFtIGhvc3QgLSBUaGUgZW11bGF0b3IgaG9zdCAoZXg6IGxvY2FsaG9zdCkNCiAqIEBwYXJhbSBwb3J0IC0gVGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA4MDgwKQ0KICogQHBhcmFtIG9wdGlvbnMubW9ja1VzZXJUb2tlbiAtIHRoZSBtb2NrIGF1dGggdG9rZW4gdG8gdXNlIGZvciB1bml0IHRlc3RpbmcgU2VjdXJpdHkgUnVsZXMNCiAqLw0KZnVuY3Rpb24gY29ubmVjdERhdGFiYXNlRW11bGF0b3IoZGIsIGhvc3QsIHBvcnQsIG9wdGlvbnMgPSB7fSkgew0KICAgIGRiID0gZ2V0TW9kdWxhckluc3RhbmNlKGRiKTsNCiAgICBkYi5fY2hlY2tOb3REZWxldGVkKCd1c2VFbXVsYXRvcicpOw0KICAgIGlmIChkYi5faW5zdGFuY2VTdGFydGVkKSB7DQogICAgICAgIGZhdGFsKCdDYW5ub3QgY2FsbCB1c2VFbXVsYXRvcigpIGFmdGVyIGluc3RhbmNlIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuJyk7DQogICAgfQ0KICAgIGNvbnN0IHJlcG8gPSBkYi5fcmVwb0ludGVybmFsOw0KICAgIGxldCB0b2tlblByb3ZpZGVyID0gdW5kZWZpbmVkOw0KICAgIGlmIChyZXBvLnJlcG9JbmZvXy5ub2RlQWRtaW4pIHsNCiAgICAgICAgaWYgKG9wdGlvbnMubW9ja1VzZXJUb2tlbikgew0KICAgICAgICAgICAgZmF0YWwoJ21vY2tVc2VyVG9rZW4gaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgQWRtaW4gU0RLLiBGb3IgY2xpZW50IGFjY2VzcyB3aXRoIG1vY2sgdXNlcnMsIHBsZWFzZSB1c2UgdGhlICJmaXJlYmFzZSIgcGFja2FnZSBpbnN0ZWFkIG9mICJmaXJlYmFzZS1hZG1pbiIuJyk7DQogICAgICAgIH0NCiAgICAgICAgdG9rZW5Qcm92aWRlciA9IG5ldyBFbXVsYXRvclRva2VuUHJvdmlkZXIoRW11bGF0b3JUb2tlblByb3ZpZGVyLk9XTkVSKTsNCiAgICB9DQogICAgZWxzZSBpZiAob3B0aW9ucy5tb2NrVXNlclRva2VuKSB7DQogICAgICAgIGNvbnN0IHRva2VuID0gdHlwZW9mIG9wdGlvbnMubW9ja1VzZXJUb2tlbiA9PT0gJ3N0cmluZycNCiAgICAgICAgICAgID8gb3B0aW9ucy5tb2NrVXNlclRva2VuDQogICAgICAgICAgICA6IGNyZWF0ZU1vY2tVc2VyVG9rZW4ob3B0aW9ucy5tb2NrVXNlclRva2VuLCBkYi5hcHAub3B0aW9ucy5wcm9qZWN0SWQpOw0KICAgICAgICB0b2tlblByb3ZpZGVyID0gbmV3IEVtdWxhdG9yVG9rZW5Qcm92aWRlcih0b2tlbik7DQogICAgfQ0KICAgIC8vIE1vZGlmeSB0aGUgcmVwbyB0byBhcHBseSBlbXVsYXRvciBzZXR0aW5ncw0KICAgIHJlcG9NYW5hZ2VyQXBwbHlFbXVsYXRvclNldHRpbmdzKHJlcG8sIGhvc3QsIHBvcnQsIHRva2VuUHJvdmlkZXIpOw0KfQ0KLyoqDQogKiBEaXNjb25uZWN0cyBmcm9tIHRoZSBzZXJ2ZXIgKGFsbCBEYXRhYmFzZSBvcGVyYXRpb25zIHdpbGwgYmUgY29tcGxldGVkDQogKiBvZmZsaW5lKS4NCiAqDQogKiBUaGUgY2xpZW50IGF1dG9tYXRpY2FsbHkgbWFpbnRhaW5zIGEgcGVyc2lzdGVudCBjb25uZWN0aW9uIHRvIHRoZSBEYXRhYmFzZQ0KICogc2VydmVyLCB3aGljaCB3aWxsIHJlbWFpbiBhY3RpdmUgaW5kZWZpbml0ZWx5IGFuZCByZWNvbm5lY3Qgd2hlbg0KICogZGlzY29ubmVjdGVkLiBIb3dldmVyLCB0aGUgYGdvT2ZmbGluZSgpYCBhbmQgYGdvT25saW5lKClgIG1ldGhvZHMgbWF5IGJlIHVzZWQNCiAqIHRvIGNvbnRyb2wgdGhlIGNsaWVudCBjb25uZWN0aW9uIGluIGNhc2VzIHdoZXJlIGEgcGVyc2lzdGVudCBjb25uZWN0aW9uIGlzDQogKiB1bmRlc2lyYWJsZS4NCiAqDQogKiBXaGlsZSBvZmZsaW5lLCB0aGUgY2xpZW50IHdpbGwgbm8gbG9uZ2VyIHJlY2VpdmUgZGF0YSB1cGRhdGVzIGZyb20gdGhlDQogKiBEYXRhYmFzZS4gSG93ZXZlciwgYWxsIERhdGFiYXNlIG9wZXJhdGlvbnMgcGVyZm9ybWVkIGxvY2FsbHkgd2lsbCBjb250aW51ZSB0bw0KICogaW1tZWRpYXRlbHkgZmlyZSBldmVudHMsIGFsbG93aW5nIHlvdXIgYXBwbGljYXRpb24gdG8gY29udGludWUgYmVoYXZpbmcNCiAqIG5vcm1hbGx5LiBBZGRpdGlvbmFsbHksIGVhY2ggb3BlcmF0aW9uIHBlcmZvcm1lZCBsb2NhbGx5IHdpbGwgYXV0b21hdGljYWxseQ0KICogYmUgcXVldWVkIGFuZCByZXRyaWVkIHVwb24gcmVjb25uZWN0aW9uIHRvIHRoZSBEYXRhYmFzZSBzZXJ2ZXIuDQogKg0KICogVG8gcmVjb25uZWN0IHRvIHRoZSBEYXRhYmFzZSBhbmQgYmVnaW4gcmVjZWl2aW5nIHJlbW90ZSBldmVudHMsIHNlZQ0KICogYGdvT25saW5lKClgLg0KICoNCiAqIEBwYXJhbSBkYiAtIFRoZSBpbnN0YW5jZSB0byBkaXNjb25uZWN0Lg0KICovDQpmdW5jdGlvbiBnb09mZmxpbmUoZGIpIHsNCiAgICBkYiA9IGdldE1vZHVsYXJJbnN0YW5jZShkYik7DQogICAgZGIuX2NoZWNrTm90RGVsZXRlZCgnZ29PZmZsaW5lJyk7DQogICAgcmVwb0ludGVycnVwdChkYi5fcmVwbyk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gcmVnaXN0ZXJEYXRhYmFzZSh2YXJpYW50KSB7DQogICAgc2V0U0RLVmVyc2lvbihTREtfVkVSU0lPTiQxKTsNCiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgnZGF0YWJhc2UnLCAoY29udGFpbmVyLCB7IGluc3RhbmNlSWRlbnRpZmllcjogdXJsIH0pID0+IHsNCiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgY29uc3QgYXV0aFByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhdXRoLWludGVybmFsJyk7DQogICAgICAgIGNvbnN0IGFwcENoZWNrUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpOw0KICAgICAgICByZXR1cm4gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCk7DQogICAgfSwgIlBVQkxJQyIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pLnNldE11bHRpcGxlSW5zdGFuY2VzKHRydWUpKTsNCiAgICByZWdpc3RlclZlcnNpb24obmFtZSRJLCB2ZXJzaW9uJDQsIHZhcmlhbnQpOw0KICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uDQogICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkSSwgdmVyc2lvbiQ0LCAnZXNtMjAxNycpOw0KfQovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLnNpbXBsZUxpc3RlbiA9IGZ1bmN0aW9uIChwYXRoU3RyaW5nLCBvbkNvbXBsZXRlKSB7DQogICAgdGhpcy5zZW5kUmVxdWVzdCgncScsIHsgcDogcGF0aFN0cmluZyB9LCBvbkNvbXBsZXRlKTsNCn07DQovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLmVjaG8gPSBmdW5jdGlvbiAoZGF0YSwgb25FY2hvKSB7DQogICAgdGhpcy5zZW5kUmVxdWVzdCgnZWNobycsIHsgZDogZGF0YSB9LCBvbkVjaG8pOw0KfTsNCgovKioNCiAqIEZpcmViYXNlIFJlYWx0aW1lIERhdGFiYXNlDQogKg0KICogQHBhY2thZ2VEb2N1bWVudGF0aW9uDQogKi8NCnJlZ2lzdGVyRGF0YWJhc2UoKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uCgpQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkKcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgKUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZCkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwKSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SCk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IKUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8KLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UsIFN1cHByZXNzZWRFcnJvciwgU3ltYm9sICovCgp2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHsKICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CiAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTsKICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKfTsKCmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7CiAgaWYgKHR5cGVvZiBiICE9PSAiZnVuY3Rpb24iICYmIGIgIT09IG51bGwpCiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNsYXNzIGV4dGVuZHMgdmFsdWUgIiArIFN0cmluZyhiKSArICIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbCIpOwogIGV4dGVuZFN0YXRpY3MoZCwgYik7CiAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CiAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwp9Cgp2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHsKICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkgewogICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdOwogICAgICB9CiAgICAgIHJldHVybiB0OwogIH07CiAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn07CgpmdW5jdGlvbiBfX3Jlc3QocywgZSkgewogIHZhciB0ID0ge307CiAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApCiAgICAgIHRbcF0gPSBzW3BdOwogIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICJmdW5jdGlvbiIpCiAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSkKICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTsKICAgICAgfQogIHJldHVybiB0Owp9CgpmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7CiAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDsKICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJvYmplY3QiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSAiZnVuY3Rpb24iKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7CiAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjsKICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByOwp9CgpmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikgewogIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfQp9CgpmdW5jdGlvbiBfX2VzRGVjb3JhdGUoY3RvciwgZGVzY3JpcHRvckluLCBkZWNvcmF0b3JzLCBjb250ZXh0SW4sIGluaXRpYWxpemVycywgZXh0cmFJbml0aWFsaXplcnMpIHsKICBmdW5jdGlvbiBhY2NlcHQoZikgeyBpZiAoZiAhPT0gdm9pZCAwICYmIHR5cGVvZiBmICE9PSAiZnVuY3Rpb24iKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGdW5jdGlvbiBleHBlY3RlZCIpOyByZXR1cm4gZjsgfQogIHZhciBraW5kID0gY29udGV4dEluLmtpbmQsIGtleSA9IGtpbmQgPT09ICJnZXR0ZXIiID8gImdldCIgOiBraW5kID09PSAic2V0dGVyIiA/ICJzZXQiIDogInZhbHVlIjsKICB2YXIgdGFyZ2V0ID0gIWRlc2NyaXB0b3JJbiAmJiBjdG9yID8gY29udGV4dEluWyJzdGF0aWMiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7CiAgdmFyIGRlc2NyaXB0b3IgPSBkZXNjcmlwdG9ySW4gfHwgKHRhcmdldCA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBjb250ZXh0SW4ubmFtZSkgOiB7fSk7CiAgdmFyIF8sIGRvbmUgPSBmYWxzZTsKICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICB2YXIgY29udGV4dCA9IHt9OwogICAgICBmb3IgKHZhciBwIGluIGNvbnRleHRJbikgY29udGV4dFtwXSA9IHAgPT09ICJhY2Nlc3MiID8ge30gOiBjb250ZXh0SW5bcF07CiAgICAgIGZvciAodmFyIHAgaW4gY29udGV4dEluLmFjY2VzcykgY29udGV4dC5hY2Nlc3NbcF0gPSBjb250ZXh0SW4uYWNjZXNzW3BdOwogICAgICBjb250ZXh0LmFkZEluaXRpYWxpemVyID0gZnVuY3Rpb24gKGYpIHsgaWYgKGRvbmUpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgaW5pdGlhbGl6ZXJzIGFmdGVyIGRlY29yYXRpb24gaGFzIGNvbXBsZXRlZCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTsKICAgICAgdmFyIHJlc3VsdCA9ICgwLCBkZWNvcmF0b3JzW2ldKShraW5kID09PSAiYWNjZXNzb3IiID8geyBnZXQ6IGRlc2NyaXB0b3IuZ2V0LCBzZXQ6IGRlc2NyaXB0b3Iuc2V0IH0gOiBkZXNjcmlwdG9yW2tleV0sIGNvbnRleHQpOwogICAgICBpZiAoa2luZCA9PT0gImFjY2Vzc29yIikgewogICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSBjb250aW51ZTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgdHlwZW9mIHJlc3VsdCAhPT0gIm9iamVjdCIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBleHBlY3RlZCIpOwogICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXzsKICAgICAgICAgIGlmIChfID0gYWNjZXB0KHJlc3VsdC5zZXQpKSBkZXNjcmlwdG9yLnNldCA9IF87CiAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuaW5pdCkpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pOwogICAgICB9CiAgICAgIGVsc2UgaWYgKF8gPSBhY2NlcHQocmVzdWx0KSkgewogICAgICAgICAgaWYgKGtpbmQgPT09ICJmaWVsZCIpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pOwogICAgICAgICAgZWxzZSBkZXNjcmlwdG9yW2tleV0gPSBfOwogICAgICB9CiAgfQogIGlmICh0YXJnZXQpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGNvbnRleHRJbi5uYW1lLCBkZXNjcmlwdG9yKTsKICBkb25lID0gdHJ1ZTsKfQpmdW5jdGlvbiBfX3J1bkluaXRpYWxpemVycyh0aGlzQXJnLCBpbml0aWFsaXplcnMsIHZhbHVlKSB7CiAgdmFyIHVzZVZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0aWFsaXplcnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFsdWUgPSB1c2VWYWx1ZSA/IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcsIHZhbHVlKSA6IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcpOwogIH0KICByZXR1cm4gdXNlVmFsdWUgPyB2YWx1ZSA6IHZvaWQgMDsKfQpmdW5jdGlvbiBfX3Byb3BLZXkoeCkgewogIHJldHVybiB0eXBlb2YgeCA9PT0gInN5bWJvbCIgPyB4IDogIiIuY29uY2F0KHgpOwp9CmZ1bmN0aW9uIF9fc2V0RnVuY3Rpb25OYW1lKGYsIG5hbWUsIHByZWZpeCkgewogIGlmICh0eXBlb2YgbmFtZSA9PT0gInN5bWJvbCIpIG5hbWUgPSBuYW1lLmRlc2NyaXB0aW9uID8gIlsiLmNvbmNhdChuYW1lLmRlc2NyaXB0aW9uLCAiXSIpIDogIiI7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmLCAibmFtZSIsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogcHJlZml4ID8gIiIuY29uY2F0KHByZWZpeCwgIiAiLCBuYW1lKSA6IG5hbWUgfSk7Cn0KZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkgewogIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09ICJmdW5jdGlvbiIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTsKfQoKZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgewogIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQogIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9CiAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0KICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0KICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogIH0pOwp9CgpmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7CiAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZzsKICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgInRocm93IjogdmVyYigxKSwgInJldHVybiI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZzsKICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH0KICBmdW5jdGlvbiBzdGVwKG9wKSB7CiAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7CiAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7CiAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7CiAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07CiAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7CiAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTsKICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7CiAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfQogICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfQogICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH0KICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfQogICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7CiAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsKICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfQogICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsKICB9Cn0KCnZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7CiAgaWYgKCFkZXNjIHx8ICgiZ2V0IiBpbiBkZXNjID8gIW0uX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7CiAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07CiAgfQogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgZGVzYyk7Cn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICBvW2syXSA9IG1ba107Cn0pOwoKZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHsKICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSAiZGVmYXVsdCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBwKSkgX19jcmVhdGVCaW5kaW5nKG8sIG0sIHApOwp9CgpmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7CiAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CiAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CiAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKICAgICAgfQogIH07CiAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cn0KCmZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7CiAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9bU3ltYm9sLml0ZXJhdG9yXTsKICBpZiAoIW0pIHJldHVybiBvOwogIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlOwogIHRyeSB7CiAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpOwogIH0KICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH0KICBmaW5hbGx5IHsKICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpWyJyZXR1cm4iXSkpIG0uY2FsbChpKTsKICAgICAgfQogICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH0KICB9CiAgcmV0dXJuIGFyOwp9CgovKiogQGRlcHJlY2F0ZWQgKi8KZnVuY3Rpb24gX19zcHJlYWQoKSB7CiAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspCiAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTsKICByZXR1cm4gYXI7Cn0KCi8qKiBAZGVwcmVjYXRlZCAqLwpmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHsKICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDsKICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspCiAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKQogICAgICAgICAgcltrXSA9IGFbal07CiAgcmV0dXJuIHI7Cn0KCmZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHsKICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykgewogICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7CiAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpOwogICAgICAgICAgYXJbaV0gPSBmcm9tW2ldOwogICAgICB9CiAgfQogIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpOwp9CgpmdW5jdGlvbiBfX2F3YWl0KHYpIHsKICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTsKfQoKZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHsKICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdOwogIHJldHVybiBpID0ge30sIHZlcmIoIm5leHQiKSwgdmVyYigidGhyb3ciKSwgdmVyYigicmV0dXJuIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTsKICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH0KICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9CiAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9CiAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoIm5leHQiLCB2YWx1ZSk7IH0KICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKCJ0aHJvdyIsIHZhbHVlKTsgfQogIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH0KfQoKZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7CiAgdmFyIGksIHA7CiAgcmV0dXJuIGkgPSB7fSwgdmVyYigibmV4dCIpLCB2ZXJiKCJ0aHJvdyIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKCJyZXR1cm4iKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTsKICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBmYWxzZSB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfQp9CgpmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHsKICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpOwogIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09ICJmdW5jdGlvbiIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoIm5leHQiKSwgdmVyYigidGhyb3ciKSwgdmVyYigicmV0dXJuIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7CiAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfQogIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH0KfQoKZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHsKICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsICJyYXciLCB7IHZhbHVlOiByYXcgfSk7IH0gZWxzZSB7IGNvb2tlZC5yYXcgPSByYXc7IH0KICByZXR1cm4gY29va2VkOwp9CnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgImRlZmF1bHQiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pOwp9KSA6IGZ1bmN0aW9uKG8sIHYpIHsKICBvWyJkZWZhdWx0Il0gPSB2Owp9OwoKZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkgewogIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7CiAgdmFyIHJlc3VsdCA9IHt9OwogIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSAiZGVmYXVsdCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7CiAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTsKICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7CiAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHsKICBpZiAoa2luZCA9PT0gImEiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXIiKTsKICBpZiAodHlwZW9mIHN0YXRlID09PSAiZnVuY3Rpb24iID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOwogIHJldHVybiBraW5kID09PSAibSIgPyBmIDoga2luZCA9PT0gImEiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7CiAgaWYgKGtpbmQgPT09ICJtIikgdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlIik7CiAgaWYgKGtpbmQgPT09ICJhIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyIik7CiAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gImZ1bmN0aW9uIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOwogIHJldHVybiAoa2luZCA9PT0gImEiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEluKHN0YXRlLCByZWNlaXZlcikgewogIGlmIChyZWNlaXZlciA9PT0gbnVsbCB8fCAodHlwZW9mIHJlY2VpdmVyICE9PSAib2JqZWN0IiAmJiB0eXBlb2YgcmVjZWl2ZXIgIT09ICJmdW5jdGlvbiIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgdXNlICdpbicgb3BlcmF0b3Igb24gbm9uLW9iamVjdCIpOwogIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09ICJmdW5jdGlvbiIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpOwp9CgpmdW5jdGlvbiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZShlbnYsIHZhbHVlLCBhc3luYykgewogIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAib2JqZWN0IiAmJiB0eXBlb2YgdmFsdWUgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBleHBlY3RlZC4iKTsKICAgIHZhciBkaXNwb3NlOwogICAgaWYgKGFzeW5jKSB7CiAgICAgICAgaWYgKCFTeW1ib2wuYXN5bmNEaXNwb3NlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNEaXNwb3NlIGlzIG5vdCBkZWZpbmVkLiIpOwogICAgICAgIGRpc3Bvc2UgPSB2YWx1ZVtTeW1ib2wuYXN5bmNEaXNwb3NlXTsKICAgIH0KICAgIGlmIChkaXNwb3NlID09PSB2b2lkIDApIHsKICAgICAgICBpZiAoIVN5bWJvbC5kaXNwb3NlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuZGlzcG9zZSBpcyBub3QgZGVmaW5lZC4iKTsKICAgICAgICBkaXNwb3NlID0gdmFsdWVbU3ltYm9sLmRpc3Bvc2VdOwogICAgfQogICAgaWYgKHR5cGVvZiBkaXNwb3NlICE9PSAiZnVuY3Rpb24iKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qgbm90IGRpc3Bvc2FibGUuIik7CiAgICBlbnYuc3RhY2sucHVzaCh7IHZhbHVlOiB2YWx1ZSwgZGlzcG9zZTogZGlzcG9zZSwgYXN5bmM6IGFzeW5jIH0pOwogIH0KICBlbHNlIGlmIChhc3luYykgewogICAgZW52LnN0YWNrLnB1c2goeyBhc3luYzogdHJ1ZSB9KTsKICB9CiAgcmV0dXJuIHZhbHVlOwp9Cgp2YXIgX1N1cHByZXNzZWRFcnJvciA9IHR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPT09ICJmdW5jdGlvbiIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHsKICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTsKICByZXR1cm4gZS5uYW1lID0gIlN1cHByZXNzZWRFcnJvciIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTsKfTsKCmZ1bmN0aW9uIF9fZGlzcG9zZVJlc291cmNlcyhlbnYpIHsKICBmdW5jdGlvbiBmYWlsKGUpIHsKICAgIGVudi5lcnJvciA9IGVudi5oYXNFcnJvciA/IG5ldyBfU3VwcHJlc3NlZEVycm9yKGUsIGVudi5lcnJvciwgIkFuIGVycm9yIHdhcyBzdXBwcmVzc2VkIGR1cmluZyBkaXNwb3NhbC4iKSA6IGU7CiAgICBlbnYuaGFzRXJyb3IgPSB0cnVlOwogIH0KICBmdW5jdGlvbiBuZXh0KCkgewogICAgd2hpbGUgKGVudi5zdGFjay5sZW5ndGgpIHsKICAgICAgdmFyIHJlYyA9IGVudi5zdGFjay5wb3AoKTsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgcmVzdWx0ID0gcmVjLmRpc3Bvc2UgJiYgcmVjLmRpc3Bvc2UuY2FsbChyZWMudmFsdWUpOwogICAgICAgIGlmIChyZWMuYXN5bmMpIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KS50aGVuKG5leHQsIGZ1bmN0aW9uKGUpIHsgZmFpbChlKTsgcmV0dXJuIG5leHQoKTsgfSk7CiAgICAgIH0KICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgIGZhaWwoZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChlbnYuaGFzRXJyb3IpIHRocm93IGVudi5lcnJvcjsKICB9CiAgcmV0dXJuIG5leHQoKTsKfQoKY29uc3QgdHNsaWJfZXM2ID0gewogIF9fZXh0ZW5kcywKICBfX2Fzc2lnbiwKICBfX3Jlc3QsCiAgX19kZWNvcmF0ZSwKICBfX3BhcmFtLAogIF9fbWV0YWRhdGEsCiAgX19hd2FpdGVyLAogIF9fZ2VuZXJhdG9yLAogIF9fY3JlYXRlQmluZGluZywKICBfX2V4cG9ydFN0YXIsCiAgX192YWx1ZXMsCiAgX19yZWFkLAogIF9fc3ByZWFkLAogIF9fc3ByZWFkQXJyYXlzLAogIF9fc3ByZWFkQXJyYXksCiAgX19hd2FpdCwKICBfX2FzeW5jR2VuZXJhdG9yLAogIF9fYXN5bmNEZWxlZ2F0b3IsCiAgX19hc3luY1ZhbHVlcywKICBfX21ha2VUZW1wbGF0ZU9iamVjdCwKICBfX2ltcG9ydFN0YXIsCiAgX19pbXBvcnREZWZhdWx0LAogIF9fY2xhc3NQcml2YXRlRmllbGRHZXQsCiAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCwKICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4sCiAgX19hZGREaXNwb3NhYmxlUmVzb3VyY2UsCiAgX19kaXNwb3NlUmVzb3VyY2VzLAp9OwoKY29uc3QgdHNsaWJfZXM2JDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIF9fYWRkRGlzcG9zYWJsZVJlc291cmNlLAogICAgZ2V0IF9fYXNzaWduICgpIHsgcmV0dXJuIF9fYXNzaWduOyB9LAogICAgX19hc3luY0RlbGVnYXRvciwKICAgIF9fYXN5bmNHZW5lcmF0b3IsCiAgICBfX2FzeW5jVmFsdWVzLAogICAgX19hd2FpdCwKICAgIF9fYXdhaXRlciwKICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQsCiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4sCiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0LAogICAgX19jcmVhdGVCaW5kaW5nLAogICAgX19kZWNvcmF0ZSwKICAgIF9fZGlzcG9zZVJlc291cmNlcywKICAgIF9fZXNEZWNvcmF0ZSwKICAgIF9fZXhwb3J0U3RhciwKICAgIF9fZXh0ZW5kcywKICAgIF9fZ2VuZXJhdG9yLAogICAgX19pbXBvcnREZWZhdWx0LAogICAgX19pbXBvcnRTdGFyLAogICAgX19tYWtlVGVtcGxhdGVPYmplY3QsCiAgICBfX21ldGFkYXRhLAogICAgX19wYXJhbSwKICAgIF9fcHJvcEtleSwKICAgIF9fcmVhZCwKICAgIF9fcmVzdCwKICAgIF9fcnVuSW5pdGlhbGl6ZXJzLAogICAgX19zZXRGdW5jdGlvbk5hbWUsCiAgICBfX3NwcmVhZCwKICAgIF9fc3ByZWFkQXJyYXksCiAgICBfX3NwcmVhZEFycmF5cywKICAgIF9fdmFsdWVzLAogICAgZGVmYXVsdDogdHNsaWJfZXM2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKZnVuY3Rpb24gaXNFbnRlcnByaXNlKGdyZWNhcHRjaGEpIHsNCiAgICByZXR1cm4gKGdyZWNhcHRjaGEgIT09IHVuZGVmaW5lZCAmJg0KICAgICAgICBncmVjYXB0Y2hhLmVudGVycHJpc2UgIT09IHVuZGVmaW5lZCk7DQp9DQpjbGFzcyBSZWNhcHRjaGFDb25maWcgew0KICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgcmVDQVBUQ0hBIHNpdGUga2V5Lg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zaXRlS2V5ID0gJyc7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgcmVDQVBUQ0hBIGVuYWJsZW1lbnQgc3RhdHVzIG9mIHRoZSB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IGZvciB0aGUgY3VycmVudCB0ZW5hbnQuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmVtYWlsUGFzc3dvcmRFbmFibGVkID0gZmFsc2U7DQogICAgICAgIGlmIChyZXNwb25zZS5yZWNhcHRjaGFLZXkgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZWNhcHRjaGFLZXkgdW5kZWZpbmVkJyk7DQogICAgICAgIH0NCiAgICAgICAgLy8gRXhhbXBsZSByZXNwb25zZS5yZWNhcHRjaGFLZXk6ICJwcm9qZWN0cy9wcm9qMTIzL2tleXMvc2l0ZWtleTEyMyINCiAgICAgICAgdGhpcy5zaXRlS2V5ID0gcmVzcG9uc2UucmVjYXB0Y2hhS2V5LnNwbGl0KCcvJylbM107DQogICAgICAgIHRoaXMuZW1haWxQYXNzd29yZEVuYWJsZWQgPSByZXNwb25zZS5yZWNhcHRjaGFFbmZvcmNlbWVudFN0YXRlLnNvbWUoZW5mb3JjZW1lbnRTdGF0ZSA9PiBlbmZvcmNlbWVudFN0YXRlLnByb3ZpZGVyID09PSAnRU1BSUxfUEFTU1dPUkRfUFJPVklERVInICYmDQogICAgICAgICAgICBlbmZvcmNlbWVudFN0YXRlLmVuZm9yY2VtZW50U3RhdGUgIT09ICdPRkYnKTsNCiAgICB9DQp9CmZ1bmN0aW9uIF9wcm9kRXJyb3JNYXAoKSB7DQogICAgLy8gV2Ugd2lsbCBpbmNsdWRlIHRoaXMgb25lIG1lc3NhZ2UgaW4gdGhlIHByb2QgZXJyb3IgbWFwIHNpbmNlIGJ5IHRoZSB2ZXJ5DQogICAgLy8gbmF0dXJlIG9mIHRoaXMgZXJyb3IsIGRldmVsb3BlcnMgd2lsbCBuZXZlciBiZSBhYmxlIHRvIHNlZSB0aGUgbWVzc2FnZQ0KICAgIC8vIHVzaW5nIHRoZSBkZWJ1Z0Vycm9yTWFwICh3aGljaCBpcyBpbnN0YWxsZWQgZHVyaW5nIGF1dGggaW5pdGlhbGl6YXRpb24pLg0KICAgIHJldHVybiB7DQogICAgICAgIFsiZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi9dOiAnQW5vdGhlciBGaXJlYmFzZSBTREsgd2FzIGluaXRpYWxpemVkIGFuZCBpcyB0cnlpbmcgdG8gdXNlIEF1dGggYmVmb3JlIEF1dGggaXMgJyArDQogICAgICAgICAgICAnaW5pdGlhbGl6ZWQuIFBsZWFzZSBiZSBzdXJlIHRvIGNhbGwgYGluaXRpYWxpemVBdXRoYCBvciBgZ2V0QXV0aGAgYmVmb3JlICcgKw0KICAgICAgICAgICAgJ3N0YXJ0aW5nIGFueSBvdGhlciBGaXJlYmFzZSBTREsuJw0KICAgIH07DQp9DQovKioNCiAqIEEgbWluaW1hbCBlcnJvciBtYXAgd2l0aCBhbGwgdmVyYm9zZSBlcnJvciBtZXNzYWdlcyBzdHJpcHBlZC4NCiAqDQogKiBTZWUgZGlzY3Vzc2lvbiBhdCB7QGxpbmsgQXV0aEVycm9yTWFwfQ0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgcHJvZEVycm9yTWFwID0gX3Byb2RFcnJvck1hcDsNCmNvbnN0IF9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBfcHJvZEVycm9yTWFwKCkpOw0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGxvZ0NsaWVudCA9IG5ldyBMb2dnZXIoJ0BmaXJlYmFzZS9hdXRoJyk7DQpmdW5jdGlvbiBfbG9nV2Fybihtc2csIC4uLmFyZ3MpIHsNCiAgICBpZiAobG9nQ2xpZW50LmxvZ0xldmVsIDw9IExvZ0xldmVsLldBUk4pIHsNCiAgICAgICAgbG9nQ2xpZW50Lndhcm4oYEF1dGggKCR7U0RLX1ZFUlNJT04kMX0pOiAke21zZ31gLCAuLi5hcmdzKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBfbG9nRXJyb3IobXNnLCAuLi5hcmdzKSB7DQogICAgaWYgKGxvZ0NsaWVudC5sb2dMZXZlbCA8PSBMb2dMZXZlbC5FUlJPUikgew0KICAgICAgICBsb2dDbGllbnQuZXJyb3IoYEF1dGggKCR7U0RLX1ZFUlNJT04kMX0pOiAke21zZ31gLCAuLi5hcmdzKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfZmFpbChhdXRoT3JDb2RlLCAuLi5yZXN0KSB7DQogICAgdGhyb3cgY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTsNCn0NCmZ1bmN0aW9uIF9jcmVhdGVFcnJvcihhdXRoT3JDb2RlLCAuLi5yZXN0KSB7DQogICAgcmV0dXJuIGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCk7DQp9DQpmdW5jdGlvbiBfZXJyb3JXaXRoQ3VzdG9tTWVzc2FnZShhdXRoLCBjb2RlLCBtZXNzYWdlKSB7DQogICAgY29uc3QgZXJyb3JNYXAgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHByb2RFcnJvck1hcCgpKSwgeyBbY29kZV06IG1lc3NhZ2UgfSk7DQogICAgY29uc3QgZmFjdG9yeSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBlcnJvck1hcCk7DQogICAgcmV0dXJuIGZhY3RvcnkuY3JlYXRlKGNvZGUsIHsNCiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lDQogICAgfSk7DQp9DQpmdW5jdGlvbiBjcmVhdGVFcnJvckludGVybmFsKGF1dGhPckNvZGUsIC4uLnJlc3QpIHsNCiAgICBpZiAodHlwZW9mIGF1dGhPckNvZGUgIT09ICdzdHJpbmcnKSB7DQogICAgICAgIGNvbnN0IGNvZGUgPSByZXN0WzBdOw0KICAgICAgICBjb25zdCBmdWxsUGFyYW1zID0gWy4uLnJlc3Quc2xpY2UoMSldOw0KICAgICAgICBpZiAoZnVsbFBhcmFtc1swXSkgew0KICAgICAgICAgICAgZnVsbFBhcmFtc1swXS5hcHBOYW1lID0gYXV0aE9yQ29kZS5uYW1lOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhdXRoT3JDb2RlLl9lcnJvckZhY3RvcnkuY3JlYXRlKGNvZGUsIC4uLmZ1bGxQYXJhbXMpOw0KICAgIH0NCiAgICByZXR1cm4gX0RFRkFVTFRfQVVUSF9FUlJPUl9GQUNUT1JZLmNyZWF0ZShhdXRoT3JDb2RlLCAuLi5yZXN0KTsNCn0NCmZ1bmN0aW9uIF9hc3NlcnQoYXNzZXJ0aW9uLCBhdXRoT3JDb2RlLCAuLi5yZXN0KSB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTsNCiAgICB9DQp9DQovKioNCiAqIFVuY29uZGl0aW9uYWxseSBmYWlscywgdGhyb3dpbmcgYW4gaW50ZXJuYWwgZXJyb3Igd2l0aCB0aGUgZ2l2ZW4gbWVzc2FnZS4NCiAqDQogKiBAcGFyYW0gZmFpbHVyZSB0eXBlIG9mIGZhaWx1cmUgZW5jb3VudGVyZWQNCiAqIEB0aHJvd3MgRXJyb3INCiAqLw0KZnVuY3Rpb24gZGVidWdGYWlsKGZhaWx1cmUpIHsNCiAgICAvLyBMb2cgdGhlIGZhaWx1cmUgaW4gYWRkaXRpb24gdG8gdGhyb3cgYW4gZXhjZXB0aW9uLCBqdXN0IGluIGNhc2UgdGhlDQogICAgLy8gZXhjZXB0aW9uIGlzIHN3YWxsb3dlZC4NCiAgICBjb25zdCBtZXNzYWdlID0gYElOVEVSTkFMIEFTU0VSVElPTiBGQUlMRUQ6IGAgKyBmYWlsdXJlOw0KICAgIF9sb2dFcnJvcihtZXNzYWdlKTsNCiAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgRmlyZWJhc2VFcnJvciBoZXJlIGJlY2F1c2UgdGhlc2UgYXJlIGludGVybmFsIGZhaWx1cmVzDQogICAgLy8gdGhhdCBjYW5ub3QgYmUgaGFuZGxlZCBieSB0aGUgdXNlci4gKEFsc28gaXQgd291bGQgY3JlYXRlIGEgY2lyY3VsYXINCiAgICAvLyBkZXBlbmRlbmN5IGJldHdlZW4gdGhlIGVycm9yIGFuZCBhc3NlcnQgbW9kdWxlcyB3aGljaCBkb2Vzbid0IHdvcmsuKQ0KICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsNCn0NCi8qKg0KICogRmFpbHMgaWYgdGhlIGdpdmVuIGFzc2VydGlvbiBjb25kaXRpb24gaXMgZmFsc2UsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlDQogKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC4NCiAqDQogKiBAcGFyYW0gYXNzZXJ0aW9uDQogKiBAcGFyYW0gbWVzc2FnZQ0KICovDQpmdW5jdGlvbiBkZWJ1Z0Fzc2VydChhc3NlcnRpb24sIG1lc3NhZ2UpIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgICBkZWJ1Z0ZhaWwobWVzc2FnZSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gX2dldEN1cnJlbnRVcmwoKSB7DQogICAgdmFyIF9hOw0KICAgIHJldHVybiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICgoX2EgPSBzZWxmLmxvY2F0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaHJlZikpIHx8ICcnOw0KfQ0KZnVuY3Rpb24gX2lzSHR0cE9ySHR0cHMoKSB7DQogICAgcmV0dXJuIF9nZXRDdXJyZW50U2NoZW1lKCkgPT09ICdodHRwOicgfHwgX2dldEN1cnJlbnRTY2hlbWUoKSA9PT0gJ2h0dHBzOic7DQp9DQpmdW5jdGlvbiBfZ2V0Q3VycmVudFNjaGVtZSgpIHsNCiAgICB2YXIgX2E7DQogICAgcmV0dXJuICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgKChfYSA9IHNlbGYubG9jYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wcm90b2NvbCkpIHx8IG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIERldGVybWluZSB3aGV0aGVyIHRoZSBicm93c2VyIGlzIHdvcmtpbmcgb25saW5lDQogKi8NCmZ1bmN0aW9uIF9pc09ubGluZSgpIHsNCiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYNCiAgICAgICAgbmF2aWdhdG9yICYmDQogICAgICAgICdvbkxpbmUnIGluIG5hdmlnYXRvciAmJg0KICAgICAgICB0eXBlb2YgbmF2aWdhdG9yLm9uTGluZSA9PT0gJ2Jvb2xlYW4nICYmDQogICAgICAgIC8vIEFwcGx5IG9ubHkgZm9yIHRyYWRpdGlvbmFsIHdlYiBhcHBzIGFuZCBDaHJvbWUgZXh0ZW5zaW9ucy4NCiAgICAgICAgLy8gVGhpcyBpcyBlc3BlY2lhbGx5IHRydWUgZm9yIENvcmRvdmEgYXBwcyB3aGljaCBoYXZlIHVucmVsaWFibGUNCiAgICAgICAgLy8gbmF2aWdhdG9yLm9uTGluZSBiZWhhdmlvciB1bmxlc3MgY29yZG92YS1wbHVnaW4tbmV0d29yay1pbmZvcm1hdGlvbiBpcw0KICAgICAgICAvLyBpbnN0YWxsZWQgd2hpY2ggb3ZlcndyaXRlcyB0aGUgbmF0aXZlIG5hdmlnYXRvci5vbkxpbmUgdmFsdWUgYW5kDQogICAgICAgIC8vIGRlZmluZXMgbmF2aWdhdG9yLmNvbm5lY3Rpb24uDQogICAgICAgIChfaXNIdHRwT3JIdHRwcygpIHx8IGlzQnJvd3NlckV4dGVuc2lvbigpIHx8ICdjb25uZWN0aW9uJyBpbiBuYXZpZ2F0b3IpKSB7DQogICAgICAgIHJldHVybiBuYXZpZ2F0b3Iub25MaW5lOw0KICAgIH0NCiAgICAvLyBJZiB3ZSBjYW4ndCBkZXRlcm1pbmUgdGhlIHN0YXRlLCBhc3N1bWUgaXQgaXMgb25saW5lLg0KICAgIHJldHVybiB0cnVlOw0KfQ0KZnVuY3Rpb24gX2dldFVzZXJMYW5ndWFnZSgpIHsNCiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGNvbnN0IG5hdmlnYXRvckxhbmd1YWdlID0gbmF2aWdhdG9yOw0KICAgIHJldHVybiAoDQogICAgLy8gTW9zdCByZWxpYWJsZSwgYnV0IG9ubHkgc3VwcG9ydGVkIGluIENocm9tZS9GaXJlZm94Lg0KICAgIChuYXZpZ2F0b3JMYW5ndWFnZS5sYW5ndWFnZXMgJiYgbmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2VzWzBdKSB8fA0KICAgICAgICAvLyBTdXBwb3J0ZWQgaW4gbW9zdCBicm93c2VycywgYnV0IHJldHVybnMgdGhlIGxhbmd1YWdlIG9mIHRoZSBicm93c2VyDQogICAgICAgIC8vIFVJLCBub3QgdGhlIGxhbmd1YWdlIHNldCBpbiBicm93c2VyIHNldHRpbmdzLg0KICAgICAgICBuYXZpZ2F0b3JMYW5ndWFnZS5sYW5ndWFnZSB8fA0KICAgICAgICAvLyBDb3VsZG4ndCBkZXRlcm1pbmUgbGFuZ3VhZ2UuDQogICAgICAgIG51bGwpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBIHN0cnVjdHVyZSB0byBoZWxwIHBpY2sgYmV0d2VlbiBhIHJhbmdlIG9mIGxvbmcgYW5kIHNob3J0IGRlbGF5IGR1cmF0aW9ucw0KICogZGVwZW5kaW5nIG9uIHRoZSBjdXJyZW50IGVudmlyb25tZW50LiBJbiBnZW5lcmFsLCB0aGUgbG9uZyBkZWxheSBpcyB1c2VkIGZvcg0KICogbW9iaWxlIGVudmlyb25tZW50cyB3aGVyZWFzIHNob3J0IGRlbGF5cyBhcmUgdXNlZCBmb3IgZGVza3RvcCBlbnZpcm9ubWVudHMuDQogKi8NCmNsYXNzIERlbGF5IHsNCiAgICBjb25zdHJ1Y3RvcihzaG9ydERlbGF5LCBsb25nRGVsYXkpIHsNCiAgICAgICAgdGhpcy5zaG9ydERlbGF5ID0gc2hvcnREZWxheTsNCiAgICAgICAgdGhpcy5sb25nRGVsYXkgPSBsb25nRGVsYXk7DQogICAgICAgIC8vIEludGVybmFsIGVycm9yIHdoZW4gaW1wcm9wZXJseSBpbml0aWFsaXplZC4NCiAgICAgICAgZGVidWdBc3NlcnQobG9uZ0RlbGF5ID4gc2hvcnREZWxheSwgJ1Nob3J0IGRlbGF5IHNob3VsZCBiZSBsZXNzIHRoYW4gbG9uZyBkZWxheSEnKTsNCiAgICAgICAgdGhpcy5pc01vYmlsZSA9IGlzTW9iaWxlQ29yZG92YSgpIHx8IGlzUmVhY3ROYXRpdmUoKTsNCiAgICB9DQogICAgZ2V0KCkgew0KICAgICAgICBpZiAoIV9pc09ubGluZSgpKSB7DQogICAgICAgICAgICAvLyBQaWNrIHRoZSBzaG9ydGVyIHRpbWVvdXQuDQogICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oNTAwMCAvKiBEZWxheU1pbi5PRkZMSU5FICovLCB0aGlzLnNob3J0RGVsYXkpOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIHJ1bm5pbmcgaW4gYSBtb2JpbGUgZW52aXJvbm1lbnQsIHJldHVybiB0aGUgbG9uZyBkZWxheSwgb3RoZXJ3aXNlDQogICAgICAgIC8vIHJldHVybiB0aGUgc2hvcnQgZGVsYXkuDQogICAgICAgIC8vIFRoaXMgY291bGQgYmUgaW1wcm92ZWQgaW4gdGhlIGZ1dHVyZSB0byBkeW5hbWljYWxseSBjaGFuZ2UgYmFzZWQgb24gb3RoZXINCiAgICAgICAgLy8gdmFyaWFibGVzIGluc3RlYWQgb2YganVzdCByZWFkaW5nIHRoZSBjdXJyZW50IGVudmlyb25tZW50Lg0KICAgICAgICByZXR1cm4gdGhpcy5pc01vYmlsZSA/IHRoaXMubG9uZ0RlbGF5IDogdGhpcy5zaG9ydERlbGF5Ow0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIF9lbXVsYXRvclVybChjb25maWcsIHBhdGgpIHsNCiAgICBkZWJ1Z0Fzc2VydChjb25maWcuZW11bGF0b3IsICdFbXVsYXRvciBzaG91bGQgYWx3YXlzIGJlIHNldCBoZXJlJyk7DQogICAgY29uc3QgeyB1cmwgfSA9IGNvbmZpZy5lbXVsYXRvcjsNCiAgICBpZiAoIXBhdGgpIHsNCiAgICAgICAgcmV0dXJuIHVybDsNCiAgICB9DQogICAgcmV0dXJuIGAke3VybH0ke3BhdGguc3RhcnRzV2l0aCgnLycpID8gcGF0aC5zbGljZSgxKSA6IHBhdGh9YDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIEZldGNoUHJvdmlkZXIgew0KICAgIHN0YXRpYyBpbml0aWFsaXplKGZldGNoSW1wbCwgaGVhZGVyc0ltcGwsIHJlc3BvbnNlSW1wbCkgew0KICAgICAgICB0aGlzLmZldGNoSW1wbCA9IGZldGNoSW1wbDsNCiAgICAgICAgaWYgKGhlYWRlcnNJbXBsKSB7DQogICAgICAgICAgICB0aGlzLmhlYWRlcnNJbXBsID0gaGVhZGVyc0ltcGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3BvbnNlSW1wbCkgew0KICAgICAgICAgICAgdGhpcy5yZXNwb25zZUltcGwgPSByZXNwb25zZUltcGw7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGZldGNoKCkgew0KICAgICAgICBpZiAodGhpcy5mZXRjaEltcGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoSW1wbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICdmZXRjaCcgaW4gc2VsZikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmV0Y2g7DQogICAgICAgIH0NCiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBmZXRjaCBpbXBsZW1lbnRhdGlvbiwgbWFrZSBzdXJlIHlvdSBjYWxsIEZldGNoUHJvdmlkZXIuaW5pdGlhbGl6ZSgpIHdpdGggYW4gYXBwcm9wcmlhdGUgcG9seWZpbGwnKTsNCiAgICB9DQogICAgc3RhdGljIGhlYWRlcnMoKSB7DQogICAgICAgIGlmICh0aGlzLmhlYWRlcnNJbXBsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5oZWFkZXJzSW1wbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICdIZWFkZXJzJyBpbiBzZWxmKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5IZWFkZXJzOw0KICAgICAgICB9DQogICAgICAgIGRlYnVnRmFpbCgnQ291bGQgbm90IGZpbmQgSGVhZGVycyBpbXBsZW1lbnRhdGlvbiwgbWFrZSBzdXJlIHlvdSBjYWxsIEZldGNoUHJvdmlkZXIuaW5pdGlhbGl6ZSgpIHdpdGggYW4gYXBwcm9wcmlhdGUgcG9seWZpbGwnKTsNCiAgICB9DQogICAgc3RhdGljIHJlc3BvbnNlKCkgew0KICAgICAgICBpZiAodGhpcy5yZXNwb25zZUltcGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc3BvbnNlSW1wbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICdSZXNwb25zZScgaW4gc2VsZikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuUmVzcG9uc2U7DQogICAgICAgIH0NCiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBSZXNwb25zZSBpbXBsZW1lbnRhdGlvbiwgbWFrZSBzdXJlIHlvdSBjYWxsIEZldGNoUHJvdmlkZXIuaW5pdGlhbGl6ZSgpIHdpdGggYW4gYXBwcm9wcmlhdGUgcG9seWZpbGwnKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIE1hcCBmcm9tIGVycm9ycyByZXR1cm5lZCBieSB0aGUgc2VydmVyIHRvIGVycm9ycyB0byBkZXZlbG9wZXIgdmlzaWJsZSBlcnJvcnMNCiAqLw0KY29uc3QgU0VSVkVSX0VSUk9SX01BUCA9IHsNCiAgICAvLyBDdXN0b20gdG9rZW4gZXJyb3JzLg0KICAgIFsiQ1JFREVOVElBTF9NSVNNQVRDSCIgLyogU2VydmVyRXJyb3IuQ1JFREVOVElBTF9NSVNNQVRDSCAqL106ICJjdXN0b20tdG9rZW4tbWlzbWF0Y2giIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9NSVNNQVRDSCAqLywNCiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuDQogICAgWyJNSVNTSU5HX0NVU1RPTV9UT0tFTiIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DVVNUT01fVE9LRU4gKi9dOiAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sDQogICAgLy8gQ3JlYXRlIEF1dGggVVJJIGVycm9ycy4NCiAgICBbIklOVkFMSURfSURFTlRJRklFUiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9JREVOVElGSUVSICovXTogImludmFsaWQtZW1haWwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9FTUFJTCAqLywNCiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuDQogICAgWyJNSVNTSU5HX0NPTlRJTlVFX1VSSSIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DT05USU5VRV9VUkkgKi9dOiAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sDQogICAgLy8gU2lnbiBpbiB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZCBlcnJvcnMgKHNvbWUgYXBwbHkgdG8gc2lnbiB1cCB0b28pLg0KICAgIFsiSU5WQUxJRF9QQVNTV09SRCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QQVNTV09SRCAqL106ICJ3cm9uZy1wYXNzd29yZCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1BBU1NXT1JEICovLA0KICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC4NCiAgICBbIk1JU1NJTkdfUEFTU1dPUkQiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfUEFTU1dPUkQgKi9dOiAibWlzc2luZy1wYXNzd29yZCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1BBU1NXT1JEICovLA0KICAgIC8vIFNpZ24gdXAgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQgZXJyb3JzLg0KICAgIFsiRU1BSUxfRVhJU1RTIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9FWElTVFMgKi9dOiAiZW1haWwtYWxyZWFkeS1pbi11c2UiIC8qIEF1dGhFcnJvckNvZGUuRU1BSUxfRVhJU1RTICovLA0KICAgIFsiUEFTU1dPUkRfTE9HSU5fRElTQUJMRUQiIC8qIFNlcnZlckVycm9yLlBBU1NXT1JEX0xPR0lOX0RJU0FCTEVEICovXTogIm9wZXJhdGlvbi1ub3QtYWxsb3dlZCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX0FMTE9XRUQgKi8sDQogICAgLy8gVmVyaWZ5IGFzc2VydGlvbiBmb3Igc2lnbiBpbiB3aXRoIGNyZWRlbnRpYWwgZXJyb3JzOg0KICAgIFsiSU5WQUxJRF9JRFBfUkVTUE9OU0UiIC8qIFNlcnZlckVycm9yLklOVkFMSURfSURQX1JFU1BPTlNFICovXTogImludmFsaWQtY3JlZGVudGlhbCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0lEUF9SRVNQT05TRSAqLywNCiAgICBbIklOVkFMSURfUEVORElOR19UT0tFTiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QRU5ESU5HX1RPS0VOICovXTogImludmFsaWQtY3JlZGVudGlhbCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0lEUF9SRVNQT05TRSAqLywNCiAgICBbIkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEIiAvKiBTZXJ2ZXJFcnJvci5GRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRCAqL106ICJjcmVkZW50aWFsLWFscmVhZHktaW4tdXNlIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0UgKi8sDQogICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0Lg0KICAgIFsiTUlTU0lOR19SRVFfVFlQRSIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRVFfVFlQRSAqL106ICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywNCiAgICAvLyBTZW5kIFBhc3N3b3JkIHJlc2V0IGVtYWlsIGVycm9yczoNCiAgICBbIkVNQUlMX05PVF9GT1VORCIgLyogU2VydmVyRXJyb3IuRU1BSUxfTk9UX0ZPVU5EICovXTogInVzZXItbm90LWZvdW5kIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqLywNCiAgICBbIlJFU0VUX1BBU1NXT1JEX0VYQ0VFRF9MSU1JVCIgLyogU2VydmVyRXJyb3IuUkVTRVRfUEFTU1dPUkRfRVhDRUVEX0xJTUlUICovXTogInRvby1tYW55LXJlcXVlc3RzIiAvKiBBdXRoRXJyb3JDb2RlLlRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUiAqLywNCiAgICBbIkVYUElSRURfT09CX0NPREUiIC8qIFNlcnZlckVycm9yLkVYUElSRURfT09CX0NPREUgKi9dOiAiZXhwaXJlZC1hY3Rpb24tY29kZSIgLyogQXV0aEVycm9yQ29kZS5FWFBJUkVEX09PQl9DT0RFICovLA0KICAgIFsiSU5WQUxJRF9PT0JfQ09ERSIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9PT0JfQ09ERSAqL106ICJpbnZhbGlkLWFjdGlvbi1jb2RlIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT09CX0NPREUgKi8sDQogICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0Lg0KICAgIFsiTUlTU0lOR19PT0JfQ09ERSIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19PT0JfQ09ERSAqL106ICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywNCiAgICAvLyBPcGVyYXRpb25zIHRoYXQgcmVxdWlyZSBJRCB0b2tlbiBpbiByZXF1ZXN0Og0KICAgIFsiQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOIiAvKiBTZXJ2ZXJFcnJvci5DUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4gKi9dOiAicmVxdWlyZXMtcmVjZW50LWxvZ2luIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfVE9PX09MRF9MT0dJTl9BR0FJTiAqLywNCiAgICBbIklOVkFMSURfSURfVE9LRU4iIC8qIFNlcnZlckVycm9yLklOVkFMSURfSURfVE9LRU4gKi9dOiAiaW52YWxpZC11c2VyLXRva2VuIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSCAqLywNCiAgICBbIlRPS0VOX0VYUElSRUQiIC8qIFNlcnZlckVycm9yLlRPS0VOX0VYUElSRUQgKi9dOiAidXNlci10b2tlbi1leHBpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8sDQogICAgWyJVU0VSX05PVF9GT1VORCIgLyogU2VydmVyRXJyb3IuVVNFUl9OT1RfRk9VTkQgKi9dOiAidXNlci10b2tlbi1leHBpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8sDQogICAgLy8gT3RoZXIgZXJyb3JzLg0KICAgIFsiVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSIiAvKiBTZXJ2ZXJFcnJvci5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi9dOiAidG9vLW1hbnktcmVxdWVzdHMiIC8qIEF1dGhFcnJvckNvZGUuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovLA0KICAgIFsiUEFTU1dPUkRfRE9FU19OT1RfTUVFVF9SRVFVSVJFTUVOVFMiIC8qIFNlcnZlckVycm9yLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovXTogInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzIiAvKiBBdXRoRXJyb3JDb2RlLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovLA0KICAgIC8vIFBob25lIEF1dGggcmVsYXRlZCBlcnJvcnMuDQogICAgWyJJTlZBTElEX0NPREUiIC8qIFNlcnZlckVycm9yLklOVkFMSURfQ09ERSAqL106ICJpbnZhbGlkLXZlcmlmaWNhdGlvbi1jb2RlIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09ERSAqLywNCiAgICBbIklOVkFMSURfU0VTU0lPTl9JTkZPIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1NFU1NJT05fSU5GTyAqL106ICJpbnZhbGlkLXZlcmlmaWNhdGlvbi1pZCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1NFU1NJT05fSU5GTyAqLywNCiAgICBbIklOVkFMSURfVEVNUE9SQVJZX1BST09GIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1RFTVBPUkFSWV9QUk9PRiAqL106ICJpbnZhbGlkLWNyZWRlbnRpYWwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi8sDQogICAgWyJNSVNTSU5HX1NFU1NJT05fSU5GTyIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19TRVNTSU9OX0lORk8gKi9dOiAibWlzc2luZy12ZXJpZmljYXRpb24taWQiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19TRVNTSU9OX0lORk8gKi8sDQogICAgWyJTRVNTSU9OX0VYUElSRUQiIC8qIFNlcnZlckVycm9yLlNFU1NJT05fRVhQSVJFRCAqL106ICJjb2RlLWV4cGlyZWQiIC8qIEF1dGhFcnJvckNvZGUuQ09ERV9FWFBJUkVEICovLA0KICAgIC8vIE90aGVyIGFjdGlvbiBjb2RlIGVycm9ycyB3aGVuIGFkZGl0aW9uYWwgc2V0dGluZ3MgcGFzc2VkLg0KICAgIC8vIE1JU1NJTkdfQ09OVElOVUVfVVJJIGlzIGdldHRpbmcgbWFwcGVkIHRvIElOVEVSTkFMX0VSUk9SIGFib3ZlLg0KICAgIC8vIFRoaXMgaXMgT0sgYXMgdGhpcyBlcnJvciB3aWxsIGJlIGNhdWdodCBieSBjbGllbnQgc2lkZSB2YWxpZGF0aW9uLg0KICAgIFsiTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqL106ICJtaXNzaW5nLWFuZHJvaWQtcGtnLW5hbWUiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqLywNCiAgICBbIlVOQVVUSE9SSVpFRF9ET01BSU4iIC8qIFNlcnZlckVycm9yLlVOQVVUSE9SSVpFRF9ET01BSU4gKi9dOiAidW5hdXRob3JpemVkLWNvbnRpbnVlLXVyaSIgLyogQXV0aEVycm9yQ29kZS5VTkFVVEhPUklaRURfRE9NQUlOICovLA0KICAgIC8vIGdldFByb2plY3RDb25maWcgZXJyb3JzIHdoZW4gY2xpZW50SWQgaXMgcGFzc2VkLg0KICAgIFsiSU5WQUxJRF9PQVVUSF9DTElFTlRfSUQiIC8qIFNlcnZlckVycm9yLklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEICovXTogImludmFsaWQtb2F1dGgtY2xpZW50LWlkIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEICovLA0KICAgIC8vIFVzZXIgYWN0aW9ucyAoc2lnbi11cCBvciBkZWxldGlvbikgZGlzYWJsZWQgZXJyb3JzLg0KICAgIFsiQURNSU5fT05MWV9PUEVSQVRJT04iIC8qIFNlcnZlckVycm9yLkFETUlOX09OTFlfT1BFUkFUSU9OICovXTogImFkbWluLXJlc3RyaWN0ZWQtb3BlcmF0aW9uIiAvKiBBdXRoRXJyb3JDb2RlLkFETUlOX09OTFlfT1BFUkFUSU9OICovLA0KICAgIC8vIE11bHRpIGZhY3RvciByZWxhdGVkIGVycm9ycy4NCiAgICBbIklOVkFMSURfTUZBX1BFTkRJTkdfQ1JFREVOVElBTCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9NRkFfUEVORElOR19DUkVERU5USUFMICovXTogImludmFsaWQtbXVsdGktZmFjdG9yLXNlc3Npb24iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9NRkFfU0VTU0lPTiAqLywNCiAgICBbIk1GQV9FTlJPTExNRU5UX05PVF9GT1VORCIgLyogU2VydmVyRXJyb3IuTUZBX0VOUk9MTE1FTlRfTk9UX0ZPVU5EICovXTogIm11bHRpLWZhY3Rvci1pbmZvLW5vdC1mb3VuZCIgLyogQXV0aEVycm9yQ29kZS5NRkFfSU5GT19OT1RfRk9VTkQgKi8sDQogICAgWyJNSVNTSU5HX01GQV9FTlJPTExNRU5UX0lEIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX01GQV9FTlJPTExNRU5UX0lEICovXTogIm1pc3NpbmctbXVsdGktZmFjdG9yLWluZm8iIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19NRkFfSU5GTyAqLywNCiAgICBbIk1JU1NJTkdfTUZBX1BFTkRJTkdfQ1JFREVOVElBTCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19NRkFfUEVORElOR19DUkVERU5USUFMICovXTogIm1pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb24iIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19NRkFfU0VTU0lPTiAqLywNCiAgICBbIlNFQ09ORF9GQUNUT1JfRVhJU1RTIiAvKiBTZXJ2ZXJFcnJvci5TRUNPTkRfRkFDVE9SX0VYSVNUUyAqL106ICJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfQUxSRUFEWV9FTlJPTExFRCAqLywNCiAgICBbIlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi9dOiAibWF4aW11bS1zZWNvbmQtZmFjdG9yLWNvdW50LWV4Y2VlZGVkIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi8sDQogICAgLy8gQmxvY2tpbmcgZnVuY3Rpb25zIHJlbGF0ZWQgZXJyb3JzLg0KICAgIFsiQkxPQ0tJTkdfRlVOQ1RJT05fRVJST1JfUkVTUE9OU0UiIC8qIFNlcnZlckVycm9yLkJMT0NLSU5HX0ZVTkNUSU9OX0VSUk9SX1JFU1BPTlNFICovXTogImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLA0KICAgIC8vIFJlY2FwdGNoYSByZWxhdGVkIGVycm9ycy4NCiAgICBbIlJFQ0FQVENIQV9OT1RfRU5BQkxFRCIgLyogU2VydmVyRXJyb3IuUkVDQVBUQ0hBX05PVF9FTkFCTEVEICovXTogInJlY2FwdGNoYS1ub3QtZW5hYmxlZCIgLyogQXV0aEVycm9yQ29kZS5SRUNBUFRDSEFfTk9UX0VOQUJMRUQgKi8sDQogICAgWyJNSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi9dOiAibWlzc2luZy1yZWNhcHRjaGEtdG9rZW4iIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi8sDQogICAgWyJJTlZBTElEX1JFQ0FQVENIQV9UT0tFTiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfVE9LRU4gKi9dOiAiaW52YWxpZC1yZWNhcHRjaGEtdG9rZW4iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfVE9LRU4gKi8sDQogICAgWyJJTlZBTElEX1JFQ0FQVENIQV9BQ1RJT04iIC8qIFNlcnZlckVycm9yLklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTiAqL106ICJpbnZhbGlkLXJlY2FwdGNoYS1hY3Rpb24iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfQUNUSU9OICovLA0KICAgIFsiTUlTU0lOR19DTElFTlRfVFlQRSIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DTElFTlRfVFlQRSAqL106ICJtaXNzaW5nLWNsaWVudC10eXBlIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQ0xJRU5UX1RZUEUgKi8sDQogICAgWyJNSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OICovXTogIm1pc3NpbmctcmVjYXB0Y2hhLXZlcnNpb24iIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVkVSU0lPTiAqLywNCiAgICBbIklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04iIC8qIFNlcnZlckVycm9yLklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04gKi9dOiAiaW52YWxpZC1yZWNhcHRjaGEtdmVyc2lvbiIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9WRVJTSU9OICovLA0KICAgIFsiSU5WQUxJRF9SRVFfVFlQRSIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRVFfVFlQRSAqL106ICJpbnZhbGlkLXJlcS10eXBlIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVRX1RZUEUgKi8NCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBERUZBVUxUX0FQSV9USU1FT1VUX01TID0gbmV3IERlbGF5KDMwMDAwLCA2MDAwMCk7DQpmdW5jdGlvbiBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkgew0KICAgIGlmIChhdXRoLnRlbmFudElkICYmICFyZXF1ZXN0LnRlbmFudElkKSB7DQogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlcXVlc3QpLCB7IHRlbmFudElkOiBhdXRoLnRlbmFudElkIH0pOw0KICAgIH0NCiAgICByZXR1cm4gcmVxdWVzdDsNCn0NCmFzeW5jIGZ1bmN0aW9uIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBtZXRob2QsIHBhdGgsIHJlcXVlc3QsIGN1c3RvbUVycm9yTWFwID0ge30pIHsNCiAgICByZXR1cm4gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBhc3luYyAoKSA9PiB7DQogICAgICAgIGxldCBib2R5ID0ge307DQogICAgICAgIGxldCBwYXJhbXMgPSB7fTsNCiAgICAgICAgaWYgKHJlcXVlc3QpIHsNCiAgICAgICAgICAgIGlmIChtZXRob2QgPT09ICJHRVQiIC8qIEh0dHBNZXRob2QuR0VUICovKSB7DQogICAgICAgICAgICAgICAgcGFyYW1zID0gcmVxdWVzdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGJvZHkgPSB7DQogICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBxdWVyeSA9IHF1ZXJ5c3RyaW5nJDEoT2JqZWN0LmFzc2lnbih7IGtleTogYXV0aC5jb25maWcuYXBpS2V5IH0sIHBhcmFtcykpLnNsaWNlKDEpOw0KICAgICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgYXV0aC5fZ2V0QWRkaXRpb25hbEhlYWRlcnMoKTsNCiAgICAgICAgaGVhZGVyc1siQ29udGVudC1UeXBlIiAvKiBIdHRwSGVhZGVyLkNPTlRFTlRfVFlQRSAqL10gPSAnYXBwbGljYXRpb24vanNvbic7DQogICAgICAgIGlmIChhdXRoLmxhbmd1YWdlQ29kZSkgew0KICAgICAgICAgICAgaGVhZGVyc1siWC1GaXJlYmFzZS1Mb2NhbGUiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9MT0NBTEUgKi9dID0gYXV0aC5sYW5ndWFnZUNvZGU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIEZldGNoUHJvdmlkZXIuZmV0Y2goKShfZ2V0RmluYWxUYXJnZXQoYXV0aCwgYXV0aC5jb25maWcuYXBpSG9zdCwgcGF0aCwgcXVlcnkpLCBPYmplY3QuYXNzaWduKHsgbWV0aG9kLA0KICAgICAgICAgICAgaGVhZGVycywgcmVmZXJyZXJQb2xpY3k6ICduby1yZWZlcnJlcicgfSwgYm9keSkpOw0KICAgIH0pOw0KfQ0KYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBmZXRjaEZuKSB7DQogICAgYXV0aC5fY2FuSW5pdEVtdWxhdG9yID0gZmFsc2U7DQogICAgY29uc3QgZXJyb3JNYXAgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIFNFUlZFUl9FUlJPUl9NQVApLCBjdXN0b21FcnJvck1hcCk7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgbmV0d29ya1RpbWVvdXQgPSBuZXcgTmV0d29ya1RpbWVvdXQoYXV0aCk7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUHJvbWlzZS5yYWNlKFsNCiAgICAgICAgICAgIGZldGNoRm4oKSwNCiAgICAgICAgICAgIG5ldHdvcmtUaW1lb3V0LnByb21pc2UNCiAgICAgICAgXSk7DQogICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgdGhpcyBwb2ludCwgdGhlIGZldGNoIHN1Y2NlZWRlZCBhbmQgdGhlIG5ldHdvcmtUaW1lb3V0DQogICAgICAgIC8vIGRpZG4ndCB0aHJvdzsgY2xlYXIgdGhlIG5ldHdvcmsgdGltZW91dCBkZWxheSBzbyB0aGF0IE5vZGUgd29uJ3QgaGFuZw0KICAgICAgICBuZXR3b3JrVGltZW91dC5jbGVhck5ldHdvcmtUaW1lb3V0KCk7DQogICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgICAgIGlmICgnbmVlZENvbmZpcm1hdGlvbicgaW4ganNvbikgew0KICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCAiYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbCIgLyogQXV0aEVycm9yQ29kZS5ORUVEX0NPTkZJUk1BVElPTiAqLywganNvbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3BvbnNlLm9rICYmICEoJ2Vycm9yTWVzc2FnZScgaW4ganNvbikpIHsNCiAgICAgICAgICAgIHJldHVybiBqc29uOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gcmVzcG9uc2Uub2sgPyBqc29uLmVycm9yTWVzc2FnZSA6IGpzb24uZXJyb3IubWVzc2FnZTsNCiAgICAgICAgICAgIGNvbnN0IFtzZXJ2ZXJFcnJvckNvZGUsIHNlcnZlckVycm9yTWVzc2FnZV0gPSBlcnJvck1lc3NhZ2Uuc3BsaXQoJyA6ICcpOw0KICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gIkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEIiAvKiBTZXJ2ZXJFcnJvci5GRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRCAqLykgew0KICAgICAgICAgICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgImNyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2UiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRSAqLywganNvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzZXJ2ZXJFcnJvckNvZGUgPT09ICJFTUFJTF9FWElTVFMiIC8qIFNlcnZlckVycm9yLkVNQUlMX0VYSVNUUyAqLykgew0KICAgICAgICAgICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgImVtYWlsLWFscmVhZHktaW4tdXNlIiAvKiBBdXRoRXJyb3JDb2RlLkVNQUlMX0VYSVNUUyAqLywganNvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzZXJ2ZXJFcnJvckNvZGUgPT09ICJVU0VSX0RJU0FCTEVEIiAvKiBTZXJ2ZXJFcnJvci5VU0VSX0RJU0FCTEVEICovKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCAidXNlci1kaXNhYmxlZCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovLCBqc29uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGF1dGhFcnJvciA9IGVycm9yTWFwW3NlcnZlckVycm9yQ29kZV0gfHwNCiAgICAgICAgICAgICAgICBzZXJ2ZXJFcnJvckNvZGUNCiAgICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCkNCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tfXHNdKy9nLCAnLScpOw0KICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yTWVzc2FnZSkgew0KICAgICAgICAgICAgICAgIHRocm93IF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGF1dGhFcnJvciwgc2VydmVyRXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIF9mYWlsKGF1dGgsIGF1dGhFcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7DQogICAgICAgICAgICB0aHJvdyBlOw0KICAgICAgICB9DQogICAgICAgIC8vIENoYW5naW5nIHRoaXMgdG8gYSBkaWZmZXJlbnQgZXJyb3IgY29kZSB3aWxsIGxvZyB1c2VyIG91dCB3aGVuIHRoZXJlIGlzIGEgbmV0d29yayBlcnJvcg0KICAgICAgICAvLyBiZWNhdXNlIHdlIHRyZWF0IGFueSBlcnJvciBvdGhlciB0aGFuIE5FVFdPUktfUkVRVUVTVF9GQUlMRUQgYXMgdG9rZW4gaXMgaW52YWxpZC4NCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZpcmViYXNlL2ZpcmViYXNlLWpzLXNkay9ibG9iLzRmYmM3MzYxMGQ3MGJlNGUwODUyZTdkZTYzYTM5Y2I3ODk3ZTg1NDYvcGFja2FnZXMvYXV0aC9zcmMvY29yZS9hdXRoL2F1dGhfaW1wbC50cyNMMzA5LUwzMTYNCiAgICAgICAgX2ZhaWwoYXV0aCwgIm5ldHdvcmstcmVxdWVzdC1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLywgeyAnbWVzc2FnZSc6IFN0cmluZyhlKSB9KTsNCiAgICB9DQp9DQphc3luYyBmdW5jdGlvbiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgbWV0aG9kLCBwYXRoLCByZXF1ZXN0LCBjdXN0b21FcnJvck1hcCA9IHt9KSB7DQogICAgY29uc3Qgc2VydmVyUmVzcG9uc2UgPSAoYXdhaXQgX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIG1ldGhvZCwgcGF0aCwgcmVxdWVzdCwgY3VzdG9tRXJyb3JNYXApKTsNCiAgICBpZiAoJ21mYVBlbmRpbmdDcmVkZW50aWFsJyBpbiBzZXJ2ZXJSZXNwb25zZSkgew0KICAgICAgICBfZmFpbChhdXRoLCAibXVsdGktZmFjdG9yLWF1dGgtcmVxdWlyZWQiIC8qIEF1dGhFcnJvckNvZGUuTUZBX1JFUVVJUkVEICovLCB7DQogICAgICAgICAgICBfc2VydmVyUmVzcG9uc2U6IHNlcnZlclJlc3BvbnNlDQogICAgICAgIH0pOw0KICAgIH0NCiAgICByZXR1cm4gc2VydmVyUmVzcG9uc2U7DQp9DQpmdW5jdGlvbiBfZ2V0RmluYWxUYXJnZXQoYXV0aCwgaG9zdCwgcGF0aCwgcXVlcnkpIHsNCiAgICBjb25zdCBiYXNlID0gYCR7aG9zdH0ke3BhdGh9PyR7cXVlcnl9YDsNCiAgICBpZiAoIWF1dGguY29uZmlnLmVtdWxhdG9yKSB7DQogICAgICAgIHJldHVybiBgJHthdXRoLmNvbmZpZy5hcGlTY2hlbWV9Oi8vJHtiYXNlfWA7DQogICAgfQ0KICAgIHJldHVybiBfZW11bGF0b3JVcmwoYXV0aC5jb25maWcsIGJhc2UpOw0KfQ0KY2xhc3MgTmV0d29ya1RpbWVvdXQgew0KICAgIGNvbnN0cnVjdG9yKGF1dGgpIHsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgLy8gTm9kZSB0aW1lcnMgYW5kIGJyb3dzZXIgdGltZXJzIGFyZSBmdW5kYW1lbnRhbGx5IGluY29tcGF0aWJsZSwgYnV0IHdlDQogICAgICAgIC8vIGRvbid0IGNhcmUgYWJvdXQgdGhlIHZhbHVlIGhlcmUNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgdGhpcy50aW1lciA9IG51bGw7DQogICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KF9jcmVhdGVFcnJvcih0aGlzLmF1dGgsICJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi8pKTsNCiAgICAgICAgICAgIH0sIERFRkFVTFRfQVBJX1RJTUVPVVRfTVMuZ2V0KCkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgY2xlYXJOZXR3b3JrVGltZW91dCgpIHsNCiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgY29kZSwgcmVzcG9uc2UpIHsNCiAgICBjb25zdCBlcnJvclBhcmFtcyA9IHsNCiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lDQogICAgfTsNCiAgICBpZiAocmVzcG9uc2UuZW1haWwpIHsNCiAgICAgICAgZXJyb3JQYXJhbXMuZW1haWwgPSByZXNwb25zZS5lbWFpbDsNCiAgICB9DQogICAgaWYgKHJlc3BvbnNlLnBob25lTnVtYmVyKSB7DQogICAgICAgIGVycm9yUGFyYW1zLnBob25lTnVtYmVyID0gcmVzcG9uc2UucGhvbmVOdW1iZXI7DQogICAgfQ0KICAgIGNvbnN0IGVycm9yID0gX2NyZWF0ZUVycm9yKGF1dGgsIGNvZGUsIGVycm9yUGFyYW1zKTsNCiAgICAvLyBXZSBrbm93IGN1c3RvbURhdGEgaXMgZGVmaW5lZCBvbiBlcnJvciBiZWNhdXNlIGVycm9yUGFyYW1zIGlzIGRlZmluZWQNCiAgICBlcnJvci5jdXN0b21EYXRhLl90b2tlblJlc3BvbnNlID0gcmVzcG9uc2U7DQogICAgcmV0dXJuIGVycm9yOw0KfQphc3luYyBmdW5jdGlvbiBnZXRSZWNhcHRjaGFDb25maWcoYXV0aCwgcmVxdWVzdCkgew0KICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgIkdFVCIgLyogSHR0cE1ldGhvZC5HRVQgKi8sICIvdjIvcmVjYXB0Y2hhQ29uZmlnIiAvKiBFbmRwb2ludC5HRVRfUkVDQVBUQ0hBX0NPTkZJRyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFjY291bnQoYXV0aCwgcmVxdWVzdCkgew0KICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgIlBPU1QiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgIi92MS9hY2NvdW50czpkZWxldGUiIC8qIEVuZHBvaW50LkRFTEVURV9BQ0NPVU5UICovLCByZXF1ZXN0KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIGdldEFjY291bnRJbmZvKGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6bG9va3VwIiAvKiBFbmRwb2ludC5HRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh1dGNUaW1lc3RhbXApIHsNCiAgICBpZiAoIXV0Y1RpbWVzdGFtcCkgew0KICAgICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgIH0NCiAgICB0cnkgew0KICAgICAgICAvLyBDb252ZXJ0IHRvIGRhdGUgb2JqZWN0Lg0KICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoTnVtYmVyKHV0Y1RpbWVzdGFtcCkpOw0KICAgICAgICAvLyBUZXN0IGRhdGUgaXMgdmFsaWQuDQogICAgICAgIGlmICghaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7DQogICAgICAgICAgICAvLyBDb252ZXJ0IHRvIFVUQyBkYXRlIHN0cmluZy4NCiAgICAgICAgICAgIHJldHVybiBkYXRlLnRvVVRDU3RyaW5nKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgLy8gRG8gbm90aGluZy4gdW5kZWZpbmVkIHdpbGwgYmUgcmV0dXJuZWQuDQogICAgfQ0KICAgIHJldHVybiB1bmRlZmluZWQ7DQp9Ci8qKg0KICogUmV0dXJucyBhIGRlc2VyaWFsaXplZCBKU09OIFdlYiBUb2tlbiAoSldUKSB1c2VkIHRvIGlkZW50aWZ5IHRoZSB1c2VyIHRvIGEgRmlyZWJhc2Ugc2VydmljZS4NCiAqDQogKiBAcmVtYXJrcw0KICogUmV0dXJucyB0aGUgY3VycmVudCB0b2tlbiBpZiBpdCBoYXMgbm90IGV4cGlyZWQgb3IgaWYgaXQgd2lsbCBub3QgZXhwaXJlIGluIHRoZSBuZXh0IGZpdmUNCiAqIG1pbnV0ZXMuIE90aGVyd2lzZSwgdGhpcyB3aWxsIHJlZnJlc2ggdGhlIHRva2VuIGFuZCByZXR1cm4gYSBuZXcgb25lLg0KICoNCiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuDQogKiBAcGFyYW0gZm9yY2VSZWZyZXNoIC0gRm9yY2UgcmVmcmVzaCByZWdhcmRsZXNzIG9mIHRva2VuIGV4cGlyYXRpb24uDQogKg0KICogQHB1YmxpYw0KICovDQphc3luYyBmdW5jdGlvbiBnZXRJZFRva2VuUmVzdWx0KHVzZXIsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7DQogICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpOw0KICAgIGNvbnN0IHRva2VuID0gYXdhaXQgdXNlckludGVybmFsLmdldElkVG9rZW4oZm9yY2VSZWZyZXNoKTsNCiAgICBjb25zdCBjbGFpbXMgPSBfcGFyc2VUb2tlbih0b2tlbik7DQogICAgX2Fzc2VydChjbGFpbXMgJiYgY2xhaW1zLmV4cCAmJiBjbGFpbXMuYXV0aF90aW1lICYmIGNsYWltcy5pYXQsIHVzZXJJbnRlcm5hbC5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgIGNvbnN0IGZpcmViYXNlID0gdHlwZW9mIGNsYWltcy5maXJlYmFzZSA9PT0gJ29iamVjdCcgPyBjbGFpbXMuZmlyZWJhc2UgOiB1bmRlZmluZWQ7DQogICAgY29uc3Qgc2lnbkluUHJvdmlkZXIgPSBmaXJlYmFzZSA9PT0gbnVsbCB8fCBmaXJlYmFzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlyZWJhc2VbJ3NpZ25faW5fcHJvdmlkZXInXTsNCiAgICByZXR1cm4gew0KICAgICAgICBjbGFpbXMsDQogICAgICAgIHRva2VuLA0KICAgICAgICBhdXRoVGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuYXV0aF90aW1lKSksDQogICAgICAgIGlzc3VlZEF0VGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuaWF0KSksDQogICAgICAgIGV4cGlyYXRpb25UaW1lOiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcoc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKGNsYWltcy5leHApKSwNCiAgICAgICAgc2lnbkluUHJvdmlkZXI6IHNpZ25JblByb3ZpZGVyIHx8IG51bGwsDQogICAgICAgIHNpZ25JblNlY29uZEZhY3RvcjogKGZpcmViYXNlID09PSBudWxsIHx8IGZpcmViYXNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaXJlYmFzZVsnc2lnbl9pbl9zZWNvbmRfZmFjdG9yJ10pIHx8IG51bGwNCiAgICB9Ow0KfQ0KZnVuY3Rpb24gc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKHNlY29uZHMpIHsNCiAgICByZXR1cm4gTnVtYmVyKHNlY29uZHMpICogMTAwMDsNCn0NCmZ1bmN0aW9uIF9wYXJzZVRva2VuKHRva2VuKSB7DQogICAgY29uc3QgW2FsZ29yaXRobSwgcGF5bG9hZCwgc2lnbmF0dXJlXSA9IHRva2VuLnNwbGl0KCcuJyk7DQogICAgaWYgKGFsZ29yaXRobSA9PT0gdW5kZWZpbmVkIHx8DQogICAgICAgIHBheWxvYWQgPT09IHVuZGVmaW5lZCB8fA0KICAgICAgICBzaWduYXR1cmUgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICBfbG9nRXJyb3IoJ0pXVCBtYWxmb3JtZWQsIGNvbnRhaW5lZCBmZXdlciB0aGFuIDMgc2VjdGlvbnMnKTsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGRlY29kZWQgPSBiYXNlNjREZWNvZGUocGF5bG9hZCk7DQogICAgICAgIGlmICghZGVjb2RlZCkgew0KICAgICAgICAgICAgX2xvZ0Vycm9yKCdGYWlsZWQgdG8gZGVjb2RlIGJhc2U2NCBKV1QgcGF5bG9hZCcpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIF9sb2dFcnJvcignQ2F1Z2h0IGVycm9yIHBhcnNpbmcgSldUIHBheWxvYWQgYXMgSlNPTicsIGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS50b1N0cmluZygpKTsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KfQ0KLyoqDQogKiBFeHRyYWN0IGV4cGlyZXNJbiBUVEwgZnJvbSBhIHRva2VuIGJ5IHN1YnRyYWN0aW5nIHRoZSBleHBpcmF0aW9uIGZyb20gdGhlIGlzc3VhbmNlLg0KICovDQpmdW5jdGlvbiBfdG9rZW5FeHBpcmVzSW4odG9rZW4pIHsNCiAgICBjb25zdCBwYXJzZWRUb2tlbiA9IF9wYXJzZVRva2VuKHRva2VuKTsNCiAgICBfYXNzZXJ0KHBhcnNlZFRva2VuLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgIF9hc3NlcnQodHlwZW9mIHBhcnNlZFRva2VuLmV4cCAhPT0gJ3VuZGVmaW5lZCcsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgX2Fzc2VydCh0eXBlb2YgcGFyc2VkVG9rZW4uaWF0ICE9PSAndW5kZWZpbmVkJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICByZXR1cm4gTnVtYmVyKHBhcnNlZFRva2VuLmV4cCkgLSBOdW1iZXIocGFyc2VkVG9rZW4uaWF0KTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIHByb21pc2UsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7DQogICAgaWYgKGJ5cGFzc0F1dGhTdGF0ZSkgew0KICAgICAgICByZXR1cm4gcHJvbWlzZTsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgcmV0dXJuIGF3YWl0IHByb21pc2U7DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvciAmJiBpc1VzZXJJbnZhbGlkYXRlZChlKSkgew0KICAgICAgICAgICAgaWYgKHVzZXIuYXV0aC5jdXJyZW50VXNlciA9PT0gdXNlcikgew0KICAgICAgICAgICAgICAgIGF3YWl0IHVzZXIuYXV0aC5zaWduT3V0KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgZTsNCiAgICB9DQp9DQpmdW5jdGlvbiBpc1VzZXJJbnZhbGlkYXRlZCh7IGNvZGUgfSkgew0KICAgIHJldHVybiAoY29kZSA9PT0gYGF1dGgvJHsidXNlci1kaXNhYmxlZCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovfWAgfHwNCiAgICAgICAgY29kZSA9PT0gYGF1dGgvJHsidXNlci10b2tlbi1leHBpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi99YCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBQcm9hY3RpdmVSZWZyZXNoIHsNCiAgICBjb25zdHJ1Y3Rvcih1c2VyKSB7DQogICAgICAgIHRoaXMudXNlciA9IHVzZXI7DQogICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7DQogICAgICAgIC8vIE5vZGUgdGltZXJzIGFuZCBicm93c2VyIHRpbWVycyByZXR1cm4gZnVuZGFtZW50YWxseSBkaWZmZXJlbnQgdHlwZXMuDQogICAgICAgIC8vIFdlIGRvbid0IGFjdHVhbGx5IGNhcmUgd2hhdCB0aGUgdmFsdWUgaXMgYnV0IFRTIHdvbid0IGFjY2VwdCB1bmtub3duIGFuZA0KICAgICAgICAvLyB3ZSBjYW4ndCBjYXN0IHByb3Blcmx5IGluIGJvdGggZW52aXJvbm1lbnRzLg0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB0aGlzLnRpbWVySWQgPSBudWxsOw0KICAgICAgICB0aGlzLmVycm9yQmFja29mZiA9IDMwMDAwIC8qIER1cmF0aW9uLlJFVFJZX0JBQ0tPRkZfTUlOICovOw0KICAgIH0NCiAgICBfc3RhcnQoKSB7DQogICAgICAgIGlmICh0aGlzLmlzUnVubmluZykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5zY2hlZHVsZSgpOw0KICAgIH0NCiAgICBfc3RvcCgpIHsNCiAgICAgICAgaWYgKCF0aGlzLmlzUnVubmluZykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7DQogICAgICAgIGlmICh0aGlzLnRpbWVySWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySWQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldEludGVydmFsKHdhc0Vycm9yKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgaWYgKHdhc0Vycm9yKSB7DQogICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZXJyb3JCYWNrb2ZmOw0KICAgICAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSBNYXRoLm1pbih0aGlzLmVycm9yQmFja29mZiAqIDIsIDk2MDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01BWCAqLyk7DQogICAgICAgICAgICByZXR1cm4gaW50ZXJ2YWw7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBSZXNldCB0aGUgZXJyb3IgYmFja29mZg0KICAgICAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSAzMDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01JTiAqLzsNCiAgICAgICAgICAgIGNvbnN0IGV4cFRpbWUgPSAoX2EgPSB0aGlzLnVzZXIuc3RzVG9rZW5NYW5hZ2VyLmV4cGlyYXRpb25UaW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwOw0KICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBleHBUaW1lIC0gRGF0ZS5ub3coKSAtIDMwMDAwMCAvKiBEdXJhdGlvbi5PRkZTRVQgKi87DQogICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgaW50ZXJ2YWwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNjaGVkdWxlKHdhc0Vycm9yID0gZmFsc2UpIHsNCiAgICAgICAgaWYgKCF0aGlzLmlzUnVubmluZykgew0KICAgICAgICAgICAgLy8gSnVzdCBpbiBjYXNlLi4uDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB0aGlzLmdldEludGVydmFsKHdhc0Vycm9yKTsNCiAgICAgICAgdGhpcy50aW1lcklkID0gc2V0VGltZW91dChhc3luYyAoKSA9PiB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLml0ZXJhdGlvbigpOw0KICAgICAgICB9LCBpbnRlcnZhbCk7DQogICAgfQ0KICAgIGFzeW5jIGl0ZXJhdGlvbigpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMudXNlci5nZXRJZFRva2VuKHRydWUpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAvLyBPbmx5IHJldHJ5IG9uIG5ldHdvcmsgZXJyb3JzDQogICAgICAgICAgICBpZiAoKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5jb2RlKSA9PT0NCiAgICAgICAgICAgICAgICBgYXV0aC8keyJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi99YCkgew0KICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGUoLyogd2FzRXJyb3IgKi8gdHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zY2hlZHVsZSgpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIFVzZXJNZXRhZGF0YSB7DQogICAgY29uc3RydWN0b3IoY3JlYXRlZEF0LCBsYXN0TG9naW5BdCkgew0KICAgICAgICB0aGlzLmNyZWF0ZWRBdCA9IGNyZWF0ZWRBdDsNCiAgICAgICAgdGhpcy5sYXN0TG9naW5BdCA9IGxhc3RMb2dpbkF0Ow0KICAgICAgICB0aGlzLl9pbml0aWFsaXplVGltZSgpOw0KICAgIH0NCiAgICBfaW5pdGlhbGl6ZVRpbWUoKSB7DQogICAgICAgIHRoaXMubGFzdFNpZ25JblRpbWUgPSB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcodGhpcy5sYXN0TG9naW5BdCk7DQogICAgICAgIHRoaXMuY3JlYXRpb25UaW1lID0gdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHRoaXMuY3JlYXRlZEF0KTsNCiAgICB9DQogICAgX2NvcHkobWV0YWRhdGEpIHsNCiAgICAgICAgdGhpcy5jcmVhdGVkQXQgPSBtZXRhZGF0YS5jcmVhdGVkQXQ7DQogICAgICAgIHRoaXMubGFzdExvZ2luQXQgPSBtZXRhZGF0YS5sYXN0TG9naW5BdDsNCiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZVRpbWUoKTsNCiAgICB9DQogICAgdG9KU09OKCkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgY3JlYXRlZEF0OiB0aGlzLmNyZWF0ZWRBdCwNCiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiB0aGlzLmxhc3RMb2dpbkF0DQogICAgICAgIH07DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcikgew0KICAgIHZhciBfYTsNCiAgICBjb25zdCBhdXRoID0gdXNlci5hdXRoOw0KICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VyLmdldElkVG9rZW4oKTsNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIGdldEFjY291bnRJbmZvKGF1dGgsIHsgaWRUb2tlbiB9KSk7DQogICAgX2Fzc2VydChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UudXNlcnMubGVuZ3RoLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgIGNvbnN0IGNvcmVBY2NvdW50ID0gcmVzcG9uc2UudXNlcnNbMF07DQogICAgdXNlci5fbm90aWZ5UmVsb2FkTGlzdGVuZXIoY29yZUFjY291bnQpOw0KICAgIGNvbnN0IG5ld1Byb3ZpZGVyRGF0YSA9ICgoX2EgPSBjb3JlQWNjb3VudC5wcm92aWRlclVzZXJJbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKQ0KICAgICAgICA/IGV4dHJhY3RQcm92aWRlckRhdGEoY29yZUFjY291bnQucHJvdmlkZXJVc2VySW5mbykNCiAgICAgICAgOiBbXTsNCiAgICBjb25zdCBwcm92aWRlckRhdGEgPSBtZXJnZVByb3ZpZGVyRGF0YSh1c2VyLnByb3ZpZGVyRGF0YSwgbmV3UHJvdmlkZXJEYXRhKTsNCiAgICAvLyBQcmVzZXJ2ZXMgdGhlIG5vbi1ub255bW91cyBzdGF0dXMgb2YgdGhlIHN0b3JlZCB1c2VyLCBldmVuIGlmIG5vIG1vcmUNCiAgICAvLyBjcmVkZW50aWFscyAoZmVkZXJhdGVkIG9yIGVtYWlsL3Bhc3N3b3JkKSBhcmUgbGlua2VkIHRvIHRoZSB1c2VyLiBJZg0KICAgIC8vIHRoZSB1c2VyIHdhcyBwcmV2aW91c2x5IGFub255bW91cywgdGhlbiB1c2UgcHJvdmlkZXIgZGF0YSB0byB1cGRhdGUuDQogICAgLy8gT24gdGhlIG90aGVyIGhhbmQsIGlmIGl0IHdhcyBub3QgYW5vbnltb3VzIGJlZm9yZSwgaXQgc2hvdWxkIG5ldmVyIGJlDQogICAgLy8gY29uc2lkZXJlZCBhbm9ueW1vdXMgbm93Lg0KICAgIGNvbnN0IG9sZElzQW5vbnltb3VzID0gdXNlci5pc0Fub255bW91czsNCiAgICBjb25zdCBuZXdJc0Fub255bW91cyA9ICEodXNlci5lbWFpbCAmJiBjb3JlQWNjb3VudC5wYXNzd29yZEhhc2gpICYmICEocHJvdmlkZXJEYXRhID09PSBudWxsIHx8IHByb3ZpZGVyRGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvdmlkZXJEYXRhLmxlbmd0aCk7DQogICAgY29uc3QgaXNBbm9ueW1vdXMgPSAhb2xkSXNBbm9ueW1vdXMgPyBmYWxzZSA6IG5ld0lzQW5vbnltb3VzOw0KICAgIGNvbnN0IHVwZGF0ZXMgPSB7DQogICAgICAgIHVpZDogY29yZUFjY291bnQubG9jYWxJZCwNCiAgICAgICAgZGlzcGxheU5hbWU6IGNvcmVBY2NvdW50LmRpc3BsYXlOYW1lIHx8IG51bGwsDQogICAgICAgIHBob3RvVVJMOiBjb3JlQWNjb3VudC5waG90b1VybCB8fCBudWxsLA0KICAgICAgICBlbWFpbDogY29yZUFjY291bnQuZW1haWwgfHwgbnVsbCwNCiAgICAgICAgZW1haWxWZXJpZmllZDogY29yZUFjY291bnQuZW1haWxWZXJpZmllZCB8fCBmYWxzZSwNCiAgICAgICAgcGhvbmVOdW1iZXI6IGNvcmVBY2NvdW50LnBob25lTnVtYmVyIHx8IG51bGwsDQogICAgICAgIHRlbmFudElkOiBjb3JlQWNjb3VudC50ZW5hbnRJZCB8fCBudWxsLA0KICAgICAgICBwcm92aWRlckRhdGEsDQogICAgICAgIG1ldGFkYXRhOiBuZXcgVXNlck1ldGFkYXRhKGNvcmVBY2NvdW50LmNyZWF0ZWRBdCwgY29yZUFjY291bnQubGFzdExvZ2luQXQpLA0KICAgICAgICBpc0Fub255bW91cw0KICAgIH07DQogICAgT2JqZWN0LmFzc2lnbih1c2VyLCB1cGRhdGVzKTsNCn0NCi8qKg0KICogUmVsb2FkcyB1c2VyIGFjY291bnQgZGF0YSwgaWYgc2lnbmVkIGluLg0KICoNCiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuDQogKg0KICogQHB1YmxpYw0KICovDQphc3luYyBmdW5jdGlvbiByZWxvYWQodXNlcikgew0KICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTsNCiAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh1c2VySW50ZXJuYWwpOw0KICAgIC8vIEV2ZW4gdGhvdWdoIHRoZSBjdXJyZW50IHVzZXIgaGFzbid0IGNoYW5nZWQsIHVwZGF0ZQ0KICAgIC8vIGN1cnJlbnQgdXNlciB3aWxsIHRyaWdnZXIgYSBwZXJzaXN0ZW5jZSB1cGRhdGUgdy8gdGhlDQogICAgLy8gbmV3IGluZm8uDQogICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHVzZXJJbnRlcm5hbCk7DQogICAgdXNlckludGVybmFsLmF1dGguX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh1c2VySW50ZXJuYWwpOw0KfQ0KZnVuY3Rpb24gbWVyZ2VQcm92aWRlckRhdGEob3JpZ2luYWwsIG5ld0RhdGEpIHsNCiAgICBjb25zdCBkZWR1cGVkID0gb3JpZ2luYWwuZmlsdGVyKG8gPT4gIW5ld0RhdGEuc29tZShuID0+IG4ucHJvdmlkZXJJZCA9PT0gby5wcm92aWRlcklkKSk7DQogICAgcmV0dXJuIFsuLi5kZWR1cGVkLCAuLi5uZXdEYXRhXTsNCn0NCmZ1bmN0aW9uIGV4dHJhY3RQcm92aWRlckRhdGEocHJvdmlkZXJzKSB7DQogICAgcmV0dXJuIHByb3ZpZGVycy5tYXAoKF9hKSA9PiB7DQogICAgICAgIHZhciB7IHByb3ZpZGVySWQgfSA9IF9hLCBwcm92aWRlciA9IF9fcmVzdChfYSwgWyJwcm92aWRlcklkIl0pOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcHJvdmlkZXJJZCwNCiAgICAgICAgICAgIHVpZDogcHJvdmlkZXIucmF3SWQgfHwgJycsDQogICAgICAgICAgICBkaXNwbGF5TmFtZTogcHJvdmlkZXIuZGlzcGxheU5hbWUgfHwgbnVsbCwNCiAgICAgICAgICAgIGVtYWlsOiBwcm92aWRlci5lbWFpbCB8fCBudWxsLA0KICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHByb3ZpZGVyLnBob25lTnVtYmVyIHx8IG51bGwsDQogICAgICAgICAgICBwaG90b1VSTDogcHJvdmlkZXIucGhvdG9VcmwgfHwgbnVsbA0KICAgICAgICB9Ow0KICAgIH0pOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gcmVxdWVzdFN0c1Rva2VuKGF1dGgsIHJlZnJlc2hUb2tlbikgew0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIHt9LCBhc3luYyAoKSA9PiB7DQogICAgICAgIGNvbnN0IGJvZHkgPSBxdWVyeXN0cmluZyQxKHsNCiAgICAgICAgICAgICdncmFudF90eXBlJzogJ3JlZnJlc2hfdG9rZW4nLA0KICAgICAgICAgICAgJ3JlZnJlc2hfdG9rZW4nOiByZWZyZXNoVG9rZW4NCiAgICAgICAgfSkuc2xpY2UoMSk7DQogICAgICAgIGNvbnN0IHsgdG9rZW5BcGlIb3N0LCBhcGlLZXkgfSA9IGF1dGguY29uZmlnOw0KICAgICAgICBjb25zdCB1cmwgPSBfZ2V0RmluYWxUYXJnZXQoYXV0aCwgdG9rZW5BcGlIb3N0LCAiL3YxL3Rva2VuIiAvKiBFbmRwb2ludC5UT0tFTiAqLywgYGtleT0ke2FwaUtleX1gKTsNCiAgICAgICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGF1dGguX2dldEFkZGl0aW9uYWxIZWFkZXJzKCk7DQogICAgICAgIGhlYWRlcnNbIkNvbnRlbnQtVHlwZSIgLyogSHR0cEhlYWRlci5DT05URU5UX1RZUEUgKi9dID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7DQogICAgICAgIHJldHVybiBGZXRjaFByb3ZpZGVyLmZldGNoKCkodXJsLCB7DQogICAgICAgICAgICBtZXRob2Q6ICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sDQogICAgICAgICAgICBoZWFkZXJzLA0KICAgICAgICAgICAgYm9keQ0KICAgICAgICB9KTsNCiAgICB9KTsNCiAgICAvLyBUaGUgcmVzcG9uc2UgY29tZXMgYmFjayBpbiBzbmFrZV9jYXNlLiBDb252ZXJ0IHRvIGNhbWVsOg0KICAgIHJldHVybiB7DQogICAgICAgIGFjY2Vzc1Rva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sDQogICAgICAgIGV4cGlyZXNJbjogcmVzcG9uc2UuZXhwaXJlc19pbiwNCiAgICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5yZWZyZXNoX3Rva2VuDQogICAgfTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogV2UgbmVlZCB0byBtYXJrIHRoaXMgY2xhc3MgYXMgaW50ZXJuYWwgZXhwbGljaXRseSB0byBleGNsdWRlIGl0IGluIHRoZSBwdWJsaWMgdHlwaW5ncywgYmVjYXVzZQ0KICogaXQgcmVmZXJlbmNlcyBBdXRoSW50ZXJuYWwgd2hpY2ggaGFzIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSB3aXRoIFVzZXJJbnRlcm5hbC4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgU3RzVG9rZW5NYW5hZ2VyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsOw0KICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbnVsbDsNCiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IG51bGw7DQogICAgfQ0KICAgIGdldCBpc0V4cGlyZWQoKSB7DQogICAgICAgIHJldHVybiAoIXRoaXMuZXhwaXJhdGlvblRpbWUgfHwNCiAgICAgICAgICAgIERhdGUubm93KCkgPiB0aGlzLmV4cGlyYXRpb25UaW1lIC0gMzAwMDAgLyogQnVmZmVyLlRPS0VOX1JFRlJFU0ggKi8pOw0KICAgIH0NCiAgICB1cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpIHsNCiAgICAgICAgX2Fzc2VydChyZXNwb25zZS5pZFRva2VuLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICBfYXNzZXJ0KHR5cGVvZiByZXNwb25zZS5pZFRva2VuICE9PSAndW5kZWZpbmVkJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVzcG9uc2UucmVmcmVzaFRva2VuICE9PSAndW5kZWZpbmVkJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgY29uc3QgZXhwaXJlc0luID0gJ2V4cGlyZXNJbicgaW4gcmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLmV4cGlyZXNJbiAhPT0gJ3VuZGVmaW5lZCcNCiAgICAgICAgICAgID8gTnVtYmVyKHJlc3BvbnNlLmV4cGlyZXNJbikNCiAgICAgICAgICAgIDogX3Rva2VuRXhwaXJlc0luKHJlc3BvbnNlLmlkVG9rZW4pOw0KICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24ocmVzcG9uc2UuaWRUb2tlbiwgcmVzcG9uc2UucmVmcmVzaFRva2VuLCBleHBpcmVzSW4pOw0KICAgIH0NCiAgICBhc3luYyBnZXRUb2tlbihhdXRoLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkgew0KICAgICAgICBfYXNzZXJ0KCF0aGlzLmFjY2Vzc1Rva2VuIHx8IHRoaXMucmVmcmVzaFRva2VuLCBhdXRoLCAidXNlci10b2tlbi1leHBpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8pOw0KICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiB0aGlzLmFjY2Vzc1Rva2VuICYmICF0aGlzLmlzRXhwaXJlZCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMucmVmcmVzaFRva2VuKSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2goYXV0aCwgdGhpcy5yZWZyZXNoVG9rZW4pOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGNsZWFyUmVmcmVzaFRva2VuKCkgew0KICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IG51bGw7DQogICAgfQ0KICAgIGFzeW5jIHJlZnJlc2goYXV0aCwgb2xkVG9rZW4pIHsNCiAgICAgICAgY29uc3QgeyBhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBleHBpcmVzSW4gfSA9IGF3YWl0IHJlcXVlc3RTdHNUb2tlbihhdXRoLCBvbGRUb2tlbik7DQogICAgICAgIHRoaXMudXBkYXRlVG9rZW5zQW5kRXhwaXJhdGlvbihhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBOdW1iZXIoZXhwaXJlc0luKSk7DQogICAgfQ0KICAgIHVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24oYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgZXhwaXJlc0luU2VjKSB7DQogICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gcmVmcmVzaFRva2VuIHx8IG51bGw7DQogICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbiB8fCBudWxsOw0KICAgICAgICB0aGlzLmV4cGlyYXRpb25UaW1lID0gRGF0ZS5ub3coKSArIGV4cGlyZXNJblNlYyAqIDEwMDA7DQogICAgfQ0KICAgIHN0YXRpYyBmcm9tSlNPTihhcHBOYW1lLCBvYmplY3QpIHsNCiAgICAgICAgY29uc3QgeyByZWZyZXNoVG9rZW4sIGFjY2Vzc1Rva2VuLCBleHBpcmF0aW9uVGltZSB9ID0gb2JqZWN0Ow0KICAgICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpOw0KICAgICAgICBpZiAocmVmcmVzaFRva2VuKSB7DQogICAgICAgICAgICBfYXNzZXJ0KHR5cGVvZiByZWZyZXNoVG9rZW4gPT09ICdzdHJpbmcnLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHsNCiAgICAgICAgICAgICAgICBhcHBOYW1lDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIG1hbmFnZXIucmVmcmVzaFRva2VuID0gcmVmcmVzaFRva2VuOw0KICAgICAgICB9DQogICAgICAgIGlmIChhY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgX2Fzc2VydCh0eXBlb2YgYWNjZXNzVG9rZW4gPT09ICdzdHJpbmcnLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHsNCiAgICAgICAgICAgICAgICBhcHBOYW1lDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIG1hbmFnZXIuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZXhwaXJhdGlvblRpbWUpIHsNCiAgICAgICAgICAgIF9hc3NlcnQodHlwZW9mIGV4cGlyYXRpb25UaW1lID09PSAnbnVtYmVyJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7DQogICAgICAgICAgICAgICAgYXBwTmFtZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtYW5hZ2VyLmV4cGlyYXRpb25UaW1lID0gZXhwaXJhdGlvblRpbWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG1hbmFnZXI7DQogICAgfQ0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogdGhpcy5yZWZyZXNoVG9rZW4sDQogICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbiwNCiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiB0aGlzLmV4cGlyYXRpb25UaW1lDQogICAgICAgIH07DQogICAgfQ0KICAgIF9hc3NpZ24oc3RzVG9rZW5NYW5hZ2VyKSB7DQogICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBzdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW47DQogICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbjsNCiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IHN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZTsNCiAgICB9DQogICAgX2Nsb25lKCkgew0KICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgU3RzVG9rZW5NYW5hZ2VyKCksIHRoaXMudG9KU09OKCkpOw0KICAgIH0NCiAgICBfcGVyZm9ybVJlZnJlc2goKSB7DQogICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGFzc2VydGlvbiwgYXBwTmFtZSkgew0KICAgIF9hc3NlcnQodHlwZW9mIGFzc2VydGlvbiA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGFzc2VydGlvbiA9PT0gJ3VuZGVmaW5lZCcsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywgeyBhcHBOYW1lIH0pOw0KfQ0KY2xhc3MgVXNlckltcGwgew0KICAgIGNvbnN0cnVjdG9yKF9hKSB7DQogICAgICAgIHZhciB7IHVpZCwgYXV0aCwgc3RzVG9rZW5NYW5hZ2VyIH0gPSBfYSwgb3B0ID0gX19yZXN0KF9hLCBbInVpZCIsICJhdXRoIiwgInN0c1Rva2VuTWFuYWdlciJdKTsNCiAgICAgICAgLy8gRm9yIHRoZSB1c2VyIG9iamVjdCwgcHJvdmlkZXIgaXMgYWx3YXlzIEZpcmViYXNlLg0KICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSAiZmlyZWJhc2UiIC8qIFByb3ZpZGVySWQuRklSRUJBU0UgKi87DQogICAgICAgIHRoaXMucHJvYWN0aXZlUmVmcmVzaCA9IG5ldyBQcm9hY3RpdmVSZWZyZXNoKHRoaXMpOw0KICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gbnVsbDsNCiAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lciA9IG51bGw7DQogICAgICAgIHRoaXMudWlkID0gdWlkOw0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlciA9IHN0c1Rva2VuTWFuYWdlcjsNCiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IHN0c1Rva2VuTWFuYWdlci5hY2Nlc3NUb2tlbjsNCiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IG9wdC5kaXNwbGF5TmFtZSB8fCBudWxsOw0KICAgICAgICB0aGlzLmVtYWlsID0gb3B0LmVtYWlsIHx8IG51bGw7DQogICAgICAgIHRoaXMuZW1haWxWZXJpZmllZCA9IG9wdC5lbWFpbFZlcmlmaWVkIHx8IGZhbHNlOw0KICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gb3B0LnBob25lTnVtYmVyIHx8IG51bGw7DQogICAgICAgIHRoaXMucGhvdG9VUkwgPSBvcHQucGhvdG9VUkwgfHwgbnVsbDsNCiAgICAgICAgdGhpcy5pc0Fub255bW91cyA9IG9wdC5pc0Fub255bW91cyB8fCBmYWxzZTsNCiAgICAgICAgdGhpcy50ZW5hbnRJZCA9IG9wdC50ZW5hbnRJZCB8fCBudWxsOw0KICAgICAgICB0aGlzLnByb3ZpZGVyRGF0YSA9IG9wdC5wcm92aWRlckRhdGEgPyBbLi4ub3B0LnByb3ZpZGVyRGF0YV0gOiBbXTsNCiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG5ldyBVc2VyTWV0YWRhdGEob3B0LmNyZWF0ZWRBdCB8fCB1bmRlZmluZWQsIG9wdC5sYXN0TG9naW5BdCB8fCB1bmRlZmluZWQpOw0KICAgIH0NCiAgICBhc3luYyBnZXRJZFRva2VuKGZvcmNlUmVmcmVzaCkgew0KICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHRoaXMsIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLmdldFRva2VuKHRoaXMuYXV0aCwgZm9yY2VSZWZyZXNoKSk7DQogICAgICAgIF9hc3NlcnQoYWNjZXNzVG9rZW4sIHRoaXMuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgaWYgKHRoaXMuYWNjZXNzVG9rZW4gIT09IGFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47DQogICAgICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpOw0KICAgICAgICAgICAgdGhpcy5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodGhpcyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFjY2Vzc1Rva2VuOw0KICAgIH0NCiAgICBnZXRJZFRva2VuUmVzdWx0KGZvcmNlUmVmcmVzaCkgew0KICAgICAgICByZXR1cm4gZ2V0SWRUb2tlblJlc3VsdCh0aGlzLCBmb3JjZVJlZnJlc2gpOw0KICAgIH0NCiAgICByZWxvYWQoKSB7DQogICAgICAgIHJldHVybiByZWxvYWQodGhpcyk7DQogICAgfQ0KICAgIF9hc3NpZ24odXNlcikgew0KICAgICAgICBpZiAodGhpcyA9PT0gdXNlcikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIF9hc3NlcnQodGhpcy51aWQgPT09IHVzZXIudWlkLCB0aGlzLmF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSB1c2VyLmRpc3BsYXlOYW1lOw0KICAgICAgICB0aGlzLnBob3RvVVJMID0gdXNlci5waG90b1VSTDsNCiAgICAgICAgdGhpcy5lbWFpbCA9IHVzZXIuZW1haWw7DQogICAgICAgIHRoaXMuZW1haWxWZXJpZmllZCA9IHVzZXIuZW1haWxWZXJpZmllZDsNCiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IHVzZXIucGhvbmVOdW1iZXI7DQogICAgICAgIHRoaXMuaXNBbm9ueW1vdXMgPSB1c2VyLmlzQW5vbnltb3VzOw0KICAgICAgICB0aGlzLnRlbmFudElkID0gdXNlci50ZW5hbnRJZDsNCiAgICAgICAgdGhpcy5wcm92aWRlckRhdGEgPSB1c2VyLnByb3ZpZGVyRGF0YS5tYXAodXNlckluZm8gPT4gKE9iamVjdC5hc3NpZ24oe30sIHVzZXJJbmZvKSkpOw0KICAgICAgICB0aGlzLm1ldGFkYXRhLl9jb3B5KHVzZXIubWV0YWRhdGEpOw0KICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci5fYXNzaWduKHVzZXIuc3RzVG9rZW5NYW5hZ2VyKTsNCiAgICB9DQogICAgX2Nsb25lKGF1dGgpIHsNCiAgICAgICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VySW1wbChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMpLCB7IGF1dGgsIHN0c1Rva2VuTWFuYWdlcjogdGhpcy5zdHNUb2tlbk1hbmFnZXIuX2Nsb25lKCkgfSkpOw0KICAgICAgICBuZXdVc2VyLm1ldGFkYXRhLl9jb3B5KHRoaXMubWV0YWRhdGEpOw0KICAgICAgICByZXR1cm4gbmV3VXNlcjsNCiAgICB9DQogICAgX29uUmVsb2FkKGNhbGxiYWNrKSB7DQogICAgICAgIC8vIFRoZXJlIHNob3VsZCBvbmx5IGV2ZXIgYmUgb25lIGxpc3RlbmVyLCBhbmQgdGhhdCBpcyBhIHNpbmdsZSBpbnN0YW5jZSBvZiBNdWx0aUZhY3RvclVzZXINCiAgICAgICAgX2Fzc2VydCghdGhpcy5yZWxvYWRMaXN0ZW5lciwgdGhpcy5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB0aGlzLnJlbG9hZExpc3RlbmVyID0gY2FsbGJhY2s7DQogICAgICAgIGlmICh0aGlzLnJlbG9hZFVzZXJJbmZvKSB7DQogICAgICAgICAgICB0aGlzLl9ub3RpZnlSZWxvYWRMaXN0ZW5lcih0aGlzLnJlbG9hZFVzZXJJbmZvKTsNCiAgICAgICAgICAgIHRoaXMucmVsb2FkVXNlckluZm8gPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9ub3RpZnlSZWxvYWRMaXN0ZW5lcih1c2VySW5mbykgew0KICAgICAgICBpZiAodGhpcy5yZWxvYWRMaXN0ZW5lcikgew0KICAgICAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lcih1c2VySW5mbyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBJZiBubyBsaXN0ZW5lciBpcyBzdWJzY3JpYmVkIHlldCwgc2F2ZSB0aGUgcmVzdWx0IHNvIGl0J3MgYXZhaWxhYmxlIHdoZW4gdGhleSBkbyBzdWJzY3JpYmUNCiAgICAgICAgICAgIHRoaXMucmVsb2FkVXNlckluZm8gPSB1c2VySW5mbzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBfc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCkgew0KICAgICAgICB0aGlzLnByb2FjdGl2ZVJlZnJlc2guX3N0YXJ0KCk7DQogICAgfQ0KICAgIF9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpIHsNCiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoLl9zdG9wKCk7DQogICAgfQ0KICAgIGFzeW5jIF91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSwgcmVsb2FkID0gZmFsc2UpIHsNCiAgICAgICAgbGV0IHRva2Vuc1JlZnJlc2hlZCA9IGZhbHNlOw0KICAgICAgICBpZiAocmVzcG9uc2UuaWRUb2tlbiAmJg0KICAgICAgICAgICAgcmVzcG9uc2UuaWRUb2tlbiAhPT0gdGhpcy5zdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnVwZGF0ZUZyb21TZXJ2ZXJSZXNwb25zZShyZXNwb25zZSk7DQogICAgICAgICAgICB0b2tlbnNSZWZyZXNoZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChyZWxvYWQpIHsNCiAgICAgICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHRoaXMpOw0KICAgICAgICB9DQogICAgICAgIGF3YWl0IHRoaXMuYXV0aC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQodGhpcyk7DQogICAgICAgIGlmICh0b2tlbnNSZWZyZXNoZWQpIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aC5fbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50KHRoaXMpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGFzeW5jIGRlbGV0ZSgpIHsNCiAgICAgICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHRoaXMuZ2V0SWRUb2tlbigpOw0KICAgICAgICBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCBkZWxldGVBY2NvdW50KHRoaXMuYXV0aCwgeyBpZFRva2VuIH0pKTsNCiAgICAgICAgdGhpcy5zdHNUb2tlbk1hbmFnZXIuY2xlYXJSZWZyZXNoVG9rZW4oKTsNCiAgICAgICAgLy8gVE9ETzogRGV0ZXJtaW5lIGlmIGNhbmNlbGxhYmxlLXByb21pc2VzIGFyZSBuZWNlc3NhcnkgdG8gdXNlIGluIHRoaXMgY2xhc3Mgc28gdGhhdCBkZWxldGUoKQ0KICAgICAgICAvLyAgICAgICBjYW5jZWxzIHBlbmRpbmcgYWN0aW9ucy4uLg0KICAgICAgICByZXR1cm4gdGhpcy5hdXRoLnNpZ25PdXQoKTsNCiAgICB9DQogICAgdG9KU09OKCkgew0KICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgdWlkOiB0aGlzLnVpZCwgZW1haWw6IHRoaXMuZW1haWwgfHwgdW5kZWZpbmVkLCBlbWFpbFZlcmlmaWVkOiB0aGlzLmVtYWlsVmVyaWZpZWQsIGRpc3BsYXlOYW1lOiB0aGlzLmRpc3BsYXlOYW1lIHx8IHVuZGVmaW5lZCwgaXNBbm9ueW1vdXM6IHRoaXMuaXNBbm9ueW1vdXMsIHBob3RvVVJMOiB0aGlzLnBob3RvVVJMIHx8IHVuZGVmaW5lZCwgcGhvbmVOdW1iZXI6IHRoaXMucGhvbmVOdW1iZXIgfHwgdW5kZWZpbmVkLCB0ZW5hbnRJZDogdGhpcy50ZW5hbnRJZCB8fCB1bmRlZmluZWQsIHByb3ZpZGVyRGF0YTogdGhpcy5wcm92aWRlckRhdGEubWFwKHVzZXJJbmZvID0+IChPYmplY3QuYXNzaWduKHt9LCB1c2VySW5mbykpKSwgc3RzVG9rZW5NYW5hZ2VyOiB0aGlzLnN0c1Rva2VuTWFuYWdlci50b0pTT04oKSwgDQogICAgICAgICAgICAvLyBSZWRpcmVjdCBldmVudCBJRCBtdXN0IGJlIG1haW50YWluZWQgaW4gY2FzZSB0aGVyZSBpcyBhIHBlbmRpbmcNCiAgICAgICAgICAgIC8vIHJlZGlyZWN0IGV2ZW50Lg0KICAgICAgICAgICAgX3JlZGlyZWN0RXZlbnRJZDogdGhpcy5fcmVkaXJlY3RFdmVudElkIH0sIHRoaXMubWV0YWRhdGEudG9KU09OKCkpLCB7IA0KICAgICAgICAgICAgLy8gUmVxdWlyZWQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCB0aGUgbGVnYWN5IFNESyAoZ28vZmlyZWJhc2UtYXV0aC1zZGstcGVyc2lzdGVuY2UtcGFyc2luZyk6DQogICAgICAgICAgICBhcGlLZXk6IHRoaXMuYXV0aC5jb25maWcuYXBpS2V5LCBhcHBOYW1lOiB0aGlzLmF1dGgubmFtZSB9KTsNCiAgICB9DQogICAgZ2V0IHJlZnJlc2hUb2tlbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbiB8fCAnJzsNCiAgICB9DQogICAgc3RhdGljIF9mcm9tSlNPTihhdXRoLCBvYmplY3QpIHsNCiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDsNCiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSAoX2EgPSBvYmplY3QuZGlzcGxheU5hbWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgZW1haWwgPSAoX2IgPSBvYmplY3QuZW1haWwpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgcGhvbmVOdW1iZXIgPSAoX2MgPSBvYmplY3QucGhvbmVOdW1iZXIpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgcGhvdG9VUkwgPSAoX2QgPSBvYmplY3QucGhvdG9VUkwpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgdGVuYW50SWQgPSAoX2UgPSBvYmplY3QudGVuYW50SWQpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgX3JlZGlyZWN0RXZlbnRJZCA9IChfZiA9IG9iamVjdC5fcmVkaXJlY3RFdmVudElkKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IGNyZWF0ZWRBdCA9IChfZyA9IG9iamVjdC5jcmVhdGVkQXQpICE9PSBudWxsICYmIF9nICE9PSB2b2lkIDAgPyBfZyA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgbGFzdExvZ2luQXQgPSAoX2ggPSBvYmplY3QubGFzdExvZ2luQXQpICE9PSBudWxsICYmIF9oICE9PSB2b2lkIDAgPyBfaCA6IHVuZGVmaW5lZDsNCiAgICAgICAgY29uc3QgeyB1aWQsIGVtYWlsVmVyaWZpZWQsIGlzQW5vbnltb3VzLCBwcm92aWRlckRhdGEsIHN0c1Rva2VuTWFuYWdlcjogcGxhaW5PYmplY3RUb2tlbk1hbmFnZXIgfSA9IG9iamVjdDsNCiAgICAgICAgX2Fzc2VydCh1aWQgJiYgcGxhaW5PYmplY3RUb2tlbk1hbmFnZXIsIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IFN0c1Rva2VuTWFuYWdlci5mcm9tSlNPTih0aGlzLm5hbWUsIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyKTsNCiAgICAgICAgX2Fzc2VydCh0eXBlb2YgdWlkID09PSAnc3RyaW5nJywgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZGlzcGxheU5hbWUsIGF1dGgubmFtZSk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGVtYWlsLCBhdXRoLm5hbWUpOw0KICAgICAgICBfYXNzZXJ0KHR5cGVvZiBlbWFpbFZlcmlmaWVkID09PSAnYm9vbGVhbicsIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIF9hc3NlcnQodHlwZW9mIGlzQW5vbnltb3VzID09PSAnYm9vbGVhbicsIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob25lTnVtYmVyLCBhdXRoLm5hbWUpOw0KICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChwaG90b1VSTCwgYXV0aC5uYW1lKTsNCiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQodGVuYW50SWQsIGF1dGgubmFtZSk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKF9yZWRpcmVjdEV2ZW50SWQsIGF1dGgubmFtZSk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGNyZWF0ZWRBdCwgYXV0aC5uYW1lKTsNCiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQobGFzdExvZ2luQXQsIGF1dGgubmFtZSk7DQogICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoew0KICAgICAgICAgICAgdWlkLA0KICAgICAgICAgICAgYXV0aCwNCiAgICAgICAgICAgIGVtYWlsLA0KICAgICAgICAgICAgZW1haWxWZXJpZmllZCwNCiAgICAgICAgICAgIGRpc3BsYXlOYW1lLA0KICAgICAgICAgICAgaXNBbm9ueW1vdXMsDQogICAgICAgICAgICBwaG90b1VSTCwNCiAgICAgICAgICAgIHBob25lTnVtYmVyLA0KICAgICAgICAgICAgdGVuYW50SWQsDQogICAgICAgICAgICBzdHNUb2tlbk1hbmFnZXIsDQogICAgICAgICAgICBjcmVhdGVkQXQsDQogICAgICAgICAgICBsYXN0TG9naW5BdA0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKHByb3ZpZGVyRGF0YSAmJiBBcnJheS5pc0FycmF5KHByb3ZpZGVyRGF0YSkpIHsNCiAgICAgICAgICAgIHVzZXIucHJvdmlkZXJEYXRhID0gcHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9yZWRpcmVjdEV2ZW50SWQpIHsNCiAgICAgICAgICAgIHVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9IF9yZWRpcmVjdEV2ZW50SWQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHVzZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBVc2VyIGZyb20gYW4gaWRUb2tlbiBzZXJ2ZXIgcmVzcG9uc2UNCiAgICAgKiBAcGFyYW0gYXV0aA0KICAgICAqIEBwYXJhbSBpZFRva2VuUmVzcG9uc2UNCiAgICAgKi8NCiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7DQogICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IG5ldyBTdHNUb2tlbk1hbmFnZXIoKTsNCiAgICAgICAgc3RzVG9rZW5NYW5hZ2VyLnVwZGF0ZUZyb21TZXJ2ZXJSZXNwb25zZShpZFRva2VuUmVzcG9uc2UpOw0KICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBGaXJlYmFzZSBBdXRoIHVzZXIuDQogICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoew0KICAgICAgICAgICAgdWlkOiBpZFRva2VuUmVzcG9uc2UubG9jYWxJZCwNCiAgICAgICAgICAgIGF1dGgsDQogICAgICAgICAgICBzdHNUb2tlbk1hbmFnZXIsDQogICAgICAgICAgICBpc0Fub255bW91cw0KICAgICAgICB9KTsNCiAgICAgICAgLy8gVXBkYXRlcyB0aGUgdXNlciBpbmZvIGFuZCBkYXRhIGFuZCByZXNvbHZlcyB3aXRoIGEgdXNlciBpbnN0YW5jZS4NCiAgICAgICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7DQogICAgICAgIHJldHVybiB1c2VyOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGluc3RhbmNlQ2FjaGUgPSBuZXcgTWFwKCk7DQpmdW5jdGlvbiBfZ2V0SW5zdGFuY2UoY2xzKSB7DQogICAgZGVidWdBc3NlcnQoY2xzIGluc3RhbmNlb2YgRnVuY3Rpb24sICdFeHBlY3RlZCBhIGNsYXNzIGRlZmluaXRpb24nKTsNCiAgICBsZXQgaW5zdGFuY2UgPSBpbnN0YW5jZUNhY2hlLmdldChjbHMpOw0KICAgIGlmIChpbnN0YW5jZSkgew0KICAgICAgICBkZWJ1Z0Fzc2VydChpbnN0YW5jZSBpbnN0YW5jZW9mIGNscywgJ0luc3RhbmNlIHN0b3JlZCBpbiBjYWNoZSBtaXNtYXRjaGVkIHdpdGggY2xhc3MnKTsNCiAgICAgICAgcmV0dXJuIGluc3RhbmNlOw0KICAgIH0NCiAgICBpbnN0YW5jZSA9IG5ldyBjbHMoKTsNCiAgICBpbnN0YW5jZUNhY2hlLnNldChjbHMsIGluc3RhbmNlKTsNCiAgICByZXR1cm4gaW5zdGFuY2U7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBJbk1lbW9yeVBlcnNpc3RlbmNlIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy50eXBlID0gIk5PTkUiIC8qIFBlcnNpc3RlbmNlVHlwZS5OT05FICovOw0KICAgICAgICB0aGlzLnN0b3JhZ2UgPSB7fTsNCiAgICB9DQogICAgYXN5bmMgX2lzQXZhaWxhYmxlKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7DQogICAgICAgIHRoaXMuc3RvcmFnZVtrZXldID0gdmFsdWU7DQogICAgfQ0KICAgIGFzeW5jIF9nZXQoa2V5KSB7DQogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zdG9yYWdlW2tleV07DQogICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHZhbHVlOw0KICAgIH0NCiAgICBhc3luYyBfcmVtb3ZlKGtleSkgew0KICAgICAgICBkZWxldGUgdGhpcy5zdG9yYWdlW2tleV07DQogICAgfQ0KICAgIF9hZGRMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHsNCiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBpbi1tZW1vcnkgc3RvcmFnZSBzaW5jZSBpdCBjYW5ub3QgYmUgc2hhcmVkIGFjcm9zcyB3aW5kb3dzL3dvcmtlcnMNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBfcmVtb3ZlTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7DQogICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgaW4tbWVtb3J5IHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cy93b3JrZXJzDQogICAgICAgIHJldHVybjsNCiAgICB9DQp9DQpJbk1lbW9yeVBlcnNpc3RlbmNlLnR5cGUgPSAnTk9ORSc7DQovKioNCiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSAnTk9ORScuDQogKg0KICogQHB1YmxpYw0KICovDQpjb25zdCBpbk1lbW9yeVBlcnNpc3RlbmNlID0gSW5NZW1vcnlQZXJzaXN0ZW5jZTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIF9wZXJzaXN0ZW5jZUtleU5hbWUoa2V5LCBhcGlLZXksIGFwcE5hbWUpIHsNCiAgICByZXR1cm4gYCR7ImZpcmViYXNlIiAvKiBOYW1lc3BhY2UuUEVSU0lTVEVOQ0UgKi99OiR7a2V5fToke2FwaUtleX06JHthcHBOYW1lfWA7DQp9DQpjbGFzcyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyIHsNCiAgICBjb25zdHJ1Y3RvcihwZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSkgew0KICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gcGVyc2lzdGVuY2U7DQogICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7DQogICAgICAgIHRoaXMudXNlcktleSA9IHVzZXJLZXk7DQogICAgICAgIGNvbnN0IHsgY29uZmlnLCBuYW1lIH0gPSB0aGlzLmF1dGg7DQogICAgICAgIHRoaXMuZnVsbFVzZXJLZXkgPSBfcGVyc2lzdGVuY2VLZXlOYW1lKHRoaXMudXNlcktleSwgY29uZmlnLmFwaUtleSwgbmFtZSk7DQogICAgICAgIHRoaXMuZnVsbFBlcnNpc3RlbmNlS2V5ID0gX3BlcnNpc3RlbmNlS2V5TmFtZSgicGVyc2lzdGVuY2UiIC8qIEtleU5hbWUuUEVSU0lTVEVOQ0VfVVNFUiAqLywgY29uZmlnLmFwaUtleSwgbmFtZSk7DQogICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSBhdXRoLl9vblN0b3JhZ2VFdmVudC5iaW5kKGF1dGgpOw0KICAgICAgICB0aGlzLnBlcnNpc3RlbmNlLl9hZGRMaXN0ZW5lcih0aGlzLmZ1bGxVc2VyS2V5LCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTsNCiAgICB9DQogICAgc2V0Q3VycmVudFVzZXIodXNlcikgew0KICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5fc2V0KHRoaXMuZnVsbFVzZXJLZXksIHVzZXIudG9KU09OKCkpOw0KICAgIH0NCiAgICBhc3luYyBnZXRDdXJyZW50VXNlcigpIHsNCiAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHRoaXMucGVyc2lzdGVuY2UuX2dldCh0aGlzLmZ1bGxVc2VyS2V5KTsNCiAgICAgICAgcmV0dXJuIGJsb2IgPyBVc2VySW1wbC5fZnJvbUpTT04odGhpcy5hdXRoLCBibG9iKSA6IG51bGw7DQogICAgfQ0KICAgIHJlbW92ZUN1cnJlbnRVc2VyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5fcmVtb3ZlKHRoaXMuZnVsbFVzZXJLZXkpOw0KICAgIH0NCiAgICBzYXZlUGVyc2lzdGVuY2VGb3JSZWRpcmVjdCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3NldCh0aGlzLmZ1bGxQZXJzaXN0ZW5jZUtleSwgdGhpcy5wZXJzaXN0ZW5jZS50eXBlKTsNCiAgICB9DQogICAgYXN5bmMgc2V0UGVyc2lzdGVuY2UobmV3UGVyc2lzdGVuY2UpIHsNCiAgICAgICAgaWYgKHRoaXMucGVyc2lzdGVuY2UgPT09IG5ld1BlcnNpc3RlbmNlKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKCk7DQogICAgICAgIGF3YWl0IHRoaXMucmVtb3ZlQ3VycmVudFVzZXIoKTsNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IG5ld1BlcnNpc3RlbmNlOw0KICAgICAgICBpZiAoY3VycmVudFVzZXIpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEN1cnJlbnRVc2VyKGN1cnJlbnRVc2VyKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBkZWxldGUoKSB7DQogICAgICAgIHRoaXMucGVyc2lzdGVuY2UuX3JlbW92ZUxpc3RlbmVyKHRoaXMuZnVsbFVzZXJLZXksIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpOw0KICAgIH0NCiAgICBzdGF0aWMgYXN5bmMgY3JlYXRlKGF1dGgsIHBlcnNpc3RlbmNlSGllcmFyY2h5LCB1c2VyS2V5ID0gImF1dGhVc2VyIiAvKiBLZXlOYW1lLkFVVEhfVVNFUiAqLykgew0KICAgICAgICBpZiAoIXBlcnNpc3RlbmNlSGllcmFyY2h5Lmxlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyKF9nZXRJbnN0YW5jZShpbk1lbW9yeVBlcnNpc3RlbmNlKSwgYXV0aCwgdXNlcktleSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gRWxpbWluYXRlIGFueSBwZXJzaXN0ZW5jZXMgdGhhdCBhcmUgbm90IGF2YWlsYWJsZQ0KICAgICAgICBjb25zdCBhdmFpbGFibGVQZXJzaXN0ZW5jZXMgPSAoYXdhaXQgUHJvbWlzZS5hbGwocGVyc2lzdGVuY2VIaWVyYXJjaHkubWFwKGFzeW5jIChwZXJzaXN0ZW5jZSkgPT4gew0KICAgICAgICAgICAgaWYgKGF3YWl0IHBlcnNpc3RlbmNlLl9pc0F2YWlsYWJsZSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBlcnNpc3RlbmNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgfSkpKS5maWx0ZXIocGVyc2lzdGVuY2UgPT4gcGVyc2lzdGVuY2UpOw0KICAgICAgICAvLyBGYWxsIGJhY2sgdG8gdGhlIGZpcnN0IHBlcnNpc3RlbmNlIGxpc3RlZCwgb3IgaW4gbWVtb3J5IGlmIG5vbmUgYXZhaWxhYmxlDQogICAgICAgIGxldCBzZWxlY3RlZFBlcnNpc3RlbmNlID0gYXZhaWxhYmxlUGVyc2lzdGVuY2VzWzBdIHx8DQogICAgICAgICAgICBfZ2V0SW5zdGFuY2UoaW5NZW1vcnlQZXJzaXN0ZW5jZSk7DQogICAgICAgIGNvbnN0IGtleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUodXNlcktleSwgYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLm5hbWUpOw0KICAgICAgICAvLyBQdWxsIG91dCB0aGUgZXhpc3RpbmcgdXNlciwgc2V0dGluZyB0aGUgY2hvc2VuIHBlcnNpc3RlbmNlIHRvIHRoYXQNCiAgICAgICAgLy8gcGVyc2lzdGVuY2UgaWYgdGhlIHVzZXIgZXhpc3RzLg0KICAgICAgICBsZXQgdXNlclRvTWlncmF0ZSA9IG51bGw7DQogICAgICAgIC8vIE5vdGUsIGhlcmUgd2UgY2hlY2sgZm9yIGEgdXNlciBpbiBfYWxsXyBwZXJzaXN0ZW5jZXMsIG5vdCBqdXN0IHRoZQ0KICAgICAgICAvLyBvbmVzIGRlZW1lZCBhdmFpbGFibGUuIElmIHdlIGNhbiBtaWdyYXRlIGEgdXNlciBvdXQgb2YgYSBicm9rZW4NCiAgICAgICAgLy8gcGVyc2lzdGVuY2UsIHdlIHdpbGwgKGJ1dCBvbmx5IGlmIHRoYXQgcGVyc2lzdGVuY2Ugc3VwcG9ydHMgbWlncmF0aW9uKS4NCiAgICAgICAgZm9yIChjb25zdCBwZXJzaXN0ZW5jZSBvZiBwZXJzaXN0ZW5jZUhpZXJhcmNoeSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgcGVyc2lzdGVuY2UuX2dldChrZXkpOw0KICAgICAgICAgICAgICAgIGlmIChibG9iKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBVc2VySW1wbC5fZnJvbUpTT04oYXV0aCwgYmxvYik7IC8vIHRocm93cyBmb3IgdW5wYXJzYWJsZSBibG9iICh3cm9uZyBmb3JtYXQpDQogICAgICAgICAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdXNlclRvTWlncmF0ZSA9IHVzZXI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IHBlcnNpc3RlbmNlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoX2EpIHsgfQ0KICAgICAgICB9DQogICAgICAgIC8vIElmIHdlIGZpbmQgdGhlIHVzZXIgaW4gYSBwZXJzaXN0ZW5jZSB0aGF0IGRvZXMgc3VwcG9ydCBtaWdyYXRpb24sIHVzZQ0KICAgICAgICAvLyB0aGF0IG1pZ3JhdGlvbiBwYXRoIChvZiBvbmx5IHBlcnNpc3RlbmNlcyB0aGF0IHN1cHBvcnQgbWlncmF0aW9uKQ0KICAgICAgICBjb25zdCBtaWdyYXRpb25IaWVyYXJjaHkgPSBhdmFpbGFibGVQZXJzaXN0ZW5jZXMuZmlsdGVyKHAgPT4gcC5fc2hvdWxkQWxsb3dNaWdyYXRpb24pOw0KICAgICAgICAvLyBJZiB0aGUgcGVyc2lzdGVuY2UgZG9lcyBfbm90XyBhbGxvdyBtaWdyYXRpb24sIGp1c3QgZmluaXNoIG9mZiBoZXJlDQogICAgICAgIGlmICghc2VsZWN0ZWRQZXJzaXN0ZW5jZS5fc2hvdWxkQWxsb3dNaWdyYXRpb24gfHwNCiAgICAgICAgICAgICFtaWdyYXRpb25IaWVyYXJjaHkubGVuZ3RoKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7DQogICAgICAgIH0NCiAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IG1pZ3JhdGlvbkhpZXJhcmNoeVswXTsNCiAgICAgICAgaWYgKHVzZXJUb01pZ3JhdGUpIHsNCiAgICAgICAgICAgIC8vIFRoaXMgbm9ybWFsbHkgc2hvdWxkbid0IHRocm93IHNpbmNlIGNob3NlblBlcnNpc3RlbmNlLmlzQXZhaWxhYmxlKCkgaXMgdHJ1ZSwgYnV0IGlmIGl0IGRvZXMNCiAgICAgICAgICAgIC8vIHdlJ2xsIGp1c3QgbGV0IGl0IGJ1YmJsZSB0byBzdXJmYWNlIHRoZSBlcnJvci4NCiAgICAgICAgICAgIGF3YWl0IHNlbGVjdGVkUGVyc2lzdGVuY2UuX3NldChrZXksIHVzZXJUb01pZ3JhdGUudG9KU09OKCkpOw0KICAgICAgICB9DQogICAgICAgIC8vIEF0dGVtcHQgdG8gY2xlYXIgdGhlIGtleSBpbiBvdGhlciBwZXJzaXN0ZW5jZXMgYnV0IGlnbm9yZSBlcnJvcnMuIFRoaXMgaGVscHMgcHJldmVudCBpc3N1ZXMNCiAgICAgICAgLy8gc3VjaCBhcyB1c2VycyBnZXR0aW5nIHN0dWNrIHdpdGggYSBwcmV2aW91cyBhY2NvdW50IGFmdGVyIHNpZ25pbmcgb3V0IGFuZCByZWZyZXNoaW5nIHRoZSB0YWIuDQogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHBlcnNpc3RlbmNlSGllcmFyY2h5Lm1hcChhc3luYyAocGVyc2lzdGVuY2UpID0+IHsNCiAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHBlcnNpc3RlbmNlLl9yZW1vdmUoa2V5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkpOw0KICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBEZXRlcm1pbmUgdGhlIGJyb3dzZXIgZm9yIHRoZSBwdXJwb3NlcyBvZiByZXBvcnRpbmcgdXNhZ2UgdG8gdGhlIEFQSQ0KICovDQpmdW5jdGlvbiBfZ2V0QnJvd3Nlck5hbWUodXNlckFnZW50KSB7DQogICAgY29uc3QgdWEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsNCiAgICBpZiAodWEuaW5jbHVkZXMoJ29wZXJhLycpIHx8IHVhLmluY2x1ZGVzKCdvcHIvJykgfHwgdWEuaW5jbHVkZXMoJ29waW9zLycpKSB7DQogICAgICAgIHJldHVybiAiT3BlcmEiIC8qIEJyb3dzZXJOYW1lLk9QRVJBICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChfaXNJRU1vYmlsZSh1YSkpIHsNCiAgICAgICAgLy8gV2luZG93cyBwaG9uZSBJRU1vYmlsZSBicm93c2VyLg0KICAgICAgICByZXR1cm4gIklFTW9iaWxlIiAvKiBCcm93c2VyTmFtZS5JRU1PQklMRSAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ21zaWUnKSB8fCB1YS5pbmNsdWRlcygndHJpZGVudC8nKSkgew0KICAgICAgICByZXR1cm4gIklFIiAvKiBCcm93c2VyTmFtZS5JRSAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ2VkZ2UvJykpIHsNCiAgICAgICAgcmV0dXJuICJFZGdlIiAvKiBCcm93c2VyTmFtZS5FREdFICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChfaXNGaXJlZm94KHVhKSkgew0KICAgICAgICByZXR1cm4gIkZpcmVmb3giIC8qIEJyb3dzZXJOYW1lLkZJUkVGT1ggKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdzaWxrLycpKSB7DQogICAgICAgIHJldHVybiAiU2lsayIgLyogQnJvd3Nlck5hbWUuU0lMSyAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAoX2lzQmxhY2tCZXJyeSh1YSkpIHsNCiAgICAgICAgLy8gQmxhY2tiZXJyeSBicm93c2VyLg0KICAgICAgICByZXR1cm4gIkJsYWNrYmVycnkiIC8qIEJyb3dzZXJOYW1lLkJMQUNLQkVSUlkgKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKF9pc1dlYk9TKHVhKSkgew0KICAgICAgICAvLyBXZWJPUyBkZWZhdWx0IGJyb3dzZXIuDQogICAgICAgIHJldHVybiAiV2Vib3MiIC8qIEJyb3dzZXJOYW1lLldFQk9TICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChfaXNTYWZhcmkodWEpKSB7DQogICAgICAgIHJldHVybiAiU2FmYXJpIiAvKiBCcm93c2VyTmFtZS5TQUZBUkkgKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKCh1YS5pbmNsdWRlcygnY2hyb21lLycpIHx8IF9pc0Nocm9tZUlPUyh1YSkpICYmDQogICAgICAgICF1YS5pbmNsdWRlcygnZWRnZS8nKSkgew0KICAgICAgICByZXR1cm4gIkNocm9tZSIgLyogQnJvd3Nlck5hbWUuQ0hST01FICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChfaXNBbmRyb2lkKHVhKSkgew0KICAgICAgICAvLyBBbmRyb2lkIHN0b2NrIGJyb3dzZXIuDQogICAgICAgIHJldHVybiAiQW5kcm9pZCIgLyogQnJvd3Nlck5hbWUuQU5EUk9JRCAqLzsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIE1vc3QgbW9kZXJuIGJyb3dzZXJzIGhhdmUgbmFtZS92ZXJzaW9uIGF0IGVuZCBvZiB1c2VyIGFnZW50IHN0cmluZy4NCiAgICAgICAgY29uc3QgcmUgPSAvKFthLXpBLVpcZFwuXSspXC9bYS16QS1aXGRcLl0qJC87DQogICAgICAgIGNvbnN0IG1hdGNoZXMgPSB1c2VyQWdlbnQubWF0Y2gocmUpOw0KICAgICAgICBpZiAoKG1hdGNoZXMgPT09IG51bGwgfHwgbWF0Y2hlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlcy5sZW5ndGgpID09PSAyKSB7DQogICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1sxXTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gIk90aGVyIiAvKiBCcm93c2VyTmFtZS5PVEhFUiAqLzsNCn0NCmZ1bmN0aW9uIF9pc0ZpcmVmb3godWEgPSBnZXRVQSgpKSB7DQogICAgcmV0dXJuIC9maXJlZm94XC8vaS50ZXN0KHVhKTsNCn0NCmZ1bmN0aW9uIF9pc1NhZmFyaSh1c2VyQWdlbnQgPSBnZXRVQSgpKSB7DQogICAgY29uc3QgdWEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsNCiAgICByZXR1cm4gKHVhLmluY2x1ZGVzKCdzYWZhcmkvJykgJiYNCiAgICAgICAgIXVhLmluY2x1ZGVzKCdjaHJvbWUvJykgJiYNCiAgICAgICAgIXVhLmluY2x1ZGVzKCdjcmlvcy8nKSAmJg0KICAgICAgICAhdWEuaW5jbHVkZXMoJ2FuZHJvaWQnKSk7DQp9DQpmdW5jdGlvbiBfaXNDaHJvbWVJT1ModWEgPSBnZXRVQSgpKSB7DQogICAgcmV0dXJuIC9jcmlvc1wvL2kudGVzdCh1YSk7DQp9DQpmdW5jdGlvbiBfaXNJRU1vYmlsZSh1YSA9IGdldFVBKCkpIHsNCiAgICByZXR1cm4gL2llbW9iaWxlL2kudGVzdCh1YSk7DQp9DQpmdW5jdGlvbiBfaXNBbmRyb2lkKHVhID0gZ2V0VUEoKSkgew0KICAgIHJldHVybiAvYW5kcm9pZC9pLnRlc3QodWEpOw0KfQ0KZnVuY3Rpb24gX2lzQmxhY2tCZXJyeSh1YSA9IGdldFVBKCkpIHsNCiAgICByZXR1cm4gL2JsYWNrYmVycnkvaS50ZXN0KHVhKTsNCn0NCmZ1bmN0aW9uIF9pc1dlYk9TKHVhID0gZ2V0VUEoKSkgew0KICAgIHJldHVybiAvd2Vib3MvaS50ZXN0KHVhKTsNCn0NCmZ1bmN0aW9uIF9pc0lPUyh1YSA9IGdldFVBKCkpIHsNCiAgICByZXR1cm4gKC9pcGhvbmV8aXBhZHxpcG9kL2kudGVzdCh1YSkgfHwNCiAgICAgICAgKC9tYWNpbnRvc2gvaS50ZXN0KHVhKSAmJiAvbW9iaWxlL2kudGVzdCh1YSkpKTsNCn0NCmZ1bmN0aW9uIF9pc0lPU1N0YW5kYWxvbmUodWEgPSBnZXRVQSgpKSB7DQogICAgdmFyIF9hOw0KICAgIHJldHVybiBfaXNJT1ModWEpICYmICEhKChfYSA9IHdpbmRvdy5uYXZpZ2F0b3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGFuZGFsb25lKTsNCn0NCmZ1bmN0aW9uIF9pc0lFMTAoKSB7DQogICAgcmV0dXJuIGlzSUUoKSAmJiBkb2N1bWVudC5kb2N1bWVudE1vZGUgPT09IDEwOw0KfQ0KZnVuY3Rpb24gX2lzTW9iaWxlQnJvd3Nlcih1YSA9IGdldFVBKCkpIHsNCiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgZ2V0QnJvd3Nlck5hbWUgZXF1aXZhbGVudCBmb3IgT1MuDQogICAgcmV0dXJuIChfaXNJT1ModWEpIHx8DQogICAgICAgIF9pc0FuZHJvaWQodWEpIHx8DQogICAgICAgIF9pc1dlYk9TKHVhKSB8fA0KICAgICAgICBfaXNCbGFja0JlcnJ5KHVhKSB8fA0KICAgICAgICAvd2luZG93cyBwaG9uZS9pLnRlc3QodWEpIHx8DQogICAgICAgIF9pc0lFTW9iaWxlKHVhKSk7DQp9DQpmdW5jdGlvbiBfaXNJZnJhbWUoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgY3VycmVudCB3aW5kb3cgaXMgbm90IHRoZSB0b3Agd2luZG93Lg0KICAgICAgICAvLyBJZiBzbywgcmV0dXJuIHRydWUuDQogICAgICAgIHJldHVybiAhISh3aW5kb3cgJiYgd2luZG93ICE9PSB3aW5kb3cudG9wKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qDQogKiBEZXRlcm1pbmUgdGhlIFNESyB2ZXJzaW9uIHN0cmluZw0KICovDQpmdW5jdGlvbiBfZ2V0Q2xpZW50VmVyc2lvbihjbGllbnRQbGF0Zm9ybSwgZnJhbWV3b3JrcyA9IFtdKSB7DQogICAgbGV0IHJlcG9ydGVkUGxhdGZvcm07DQogICAgc3dpdGNoIChjbGllbnRQbGF0Zm9ybSkgew0KICAgICAgICBjYXNlICJCcm93c2VyIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovOg0KICAgICAgICAgICAgLy8gSW4gYSBicm93c2VyIGVudmlyb25tZW50LCByZXBvcnQgdGhlIGJyb3dzZXIgbmFtZS4NCiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBfZ2V0QnJvd3Nlck5hbWUoZ2V0VUEoKSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiV29ya2VyIiAvKiBDbGllbnRQbGF0Zm9ybS5XT1JLRVIgKi86DQogICAgICAgICAgICAvLyBUZWNobmljYWxseSBhIHdvcmtlciBydW5zIGZyb20gYSBicm93c2VyIGJ1dCB3ZSBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYQ0KICAgICAgICAgICAgLy8gd29ya2VyIGZyb20gYSBicm93c2VyLg0KICAgICAgICAgICAgLy8gRm9yIGV4YW1wbGU6IENocm9tZS1Xb3JrZXIvSnNDb3JlLzQuOS4xL0ZpcmViYXNlQ29yZS13ZWIuDQogICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gYCR7X2dldEJyb3dzZXJOYW1lKGdldFVBKCkpfS0ke2NsaWVudFBsYXRmb3JtfWA7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBjbGllbnRQbGF0Zm9ybTsNCiAgICB9DQogICAgY29uc3QgcmVwb3J0ZWRGcmFtZXdvcmtzID0gZnJhbWV3b3Jrcy5sZW5ndGgNCiAgICAgICAgPyBmcmFtZXdvcmtzLmpvaW4oJywnKQ0KICAgICAgICA6ICdGaXJlYmFzZUNvcmUtd2ViJzsgLyogZGVmYXVsdCB2YWx1ZSBpZiBubyBvdGhlciBmcmFtZXdvcmsgaXMgdXNlZCAqLw0KICAgIHJldHVybiBgJHtyZXBvcnRlZFBsYXRmb3JtfS8keyJKc0NvcmUiIC8qIENsaWVudEltcGxlbWVudGF0aW9uLkNPUkUgKi99LyR7U0RLX1ZFUlNJT04kMX0vJHtyZXBvcnRlZEZyYW1ld29ya3N9YDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIEF1dGhNaWRkbGV3YXJlUXVldWUgew0KICAgIGNvbnN0cnVjdG9yKGF1dGgpIHsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdOw0KICAgIH0NCiAgICBwdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpIHsNCiAgICAgICAgLy8gVGhlIGNhbGxiYWNrIGNvdWxkIGJlIHN5bmMgb3IgYXN5bmMuIFdyYXAgaXQgaW50byBhDQogICAgICAgIC8vIGZ1bmN0aW9uIHRoYXQgaXMgYWx3YXlzIGFzeW5jLg0KICAgICAgICBjb25zdCB3cmFwcGVkQ2FsbGJhY2sgPSAodXNlcikgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjYWxsYmFjayh1c2VyKTsNCiAgICAgICAgICAgICAgICAvLyBFaXRoZXIgcmVzb2x2ZSB3aXRoIGV4aXN0aW5nIHByb21pc2Ugb3Igd3JhcCBhIG5vbi1wcm9taXNlDQogICAgICAgICAgICAgICAgLy8gcmV0dXJuIHZhbHVlIGludG8gYSBwcm9taXNlLg0KICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgLy8gU3luYyBjYWxsYmFjayB0aHJvd3MuDQogICAgICAgICAgICAgICAgcmVqZWN0KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8gQXR0YWNoIHRoZSBvbkFib3J0IGlmIHByZXNlbnQNCiAgICAgICAgd3JhcHBlZENhbGxiYWNrLm9uQWJvcnQgPSBvbkFib3J0Ow0KICAgICAgICB0aGlzLnF1ZXVlLnB1c2god3JhcHBlZENhbGxiYWNrKTsNCiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnF1ZXVlLmxlbmd0aCAtIDE7DQogICAgICAgIHJldHVybiAoKSA9PiB7DQogICAgICAgICAgICAvLyBVbnN1YnNjcmliZS4gUmVwbGFjZSB3aXRoIG5vLW9wLiBEbyBub3QgcmVtb3ZlIGZyb20gYXJyYXksIG9yIGl0IHdpbGwgZGlzdHVyYg0KICAgICAgICAgICAgLy8gaW5kZXhpbmcgb2Ygb3RoZXIgZWxlbWVudHMuDQogICAgICAgICAgICB0aGlzLnF1ZXVlW2luZGV4XSA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBhc3luYyBydW5NaWRkbGV3YXJlKG5leHRVc2VyKSB7DQogICAgICAgIGlmICh0aGlzLmF1dGguY3VycmVudFVzZXIgPT09IG5leHRVc2VyKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgLy8gV2hpbGUgcnVubmluZyB0aGUgbWlkZGxld2FyZSwgYnVpbGQgYSB0ZW1wb3Jhcnkgc3RhY2sgb2Ygb25BYm9ydA0KICAgICAgICAvLyBjYWxsYmFja3MgdG8gY2FsbCBpZiBvbmUgbWlkZGxld2FyZSBjYWxsYmFjayByZWplY3RzLg0KICAgICAgICBjb25zdCBvbkFib3J0U3RhY2sgPSBbXTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGZvciAoY29uc3QgYmVmb3JlU3RhdGVDYWxsYmFjayBvZiB0aGlzLnF1ZXVlKSB7DQogICAgICAgICAgICAgICAgYXdhaXQgYmVmb3JlU3RhdGVDYWxsYmFjayhuZXh0VXNlcik7DQogICAgICAgICAgICAgICAgLy8gT25seSBwdXNoIHRoZSBvbkFib3J0IGlmIHRoZSBjYWxsYmFjayBzdWNjZWVkcw0KICAgICAgICAgICAgICAgIGlmIChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpIHsNCiAgICAgICAgICAgICAgICAgICAgb25BYm9ydFN0YWNrLnB1c2goYmVmb3JlU3RhdGVDYWxsYmFjay5vbkFib3J0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIC8vIFJ1biBhbGwgb25BYm9ydCwgd2l0aCBzZXBhcmF0ZSB0cnkvY2F0Y2ggdG8gaWdub3JlIGFueSBlcnJvcnMgYW5kDQogICAgICAgICAgICAvLyBjb250aW51ZQ0KICAgICAgICAgICAgb25BYm9ydFN0YWNrLnJldmVyc2UoKTsNCiAgICAgICAgICAgIGZvciAoY29uc3Qgb25BYm9ydCBvZiBvbkFib3J0U3RhY2spIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBvbkFib3J0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChfKSB7DQogICAgICAgICAgICAgICAgICAgIC8qIHN3YWxsb3cgZXJyb3IgKi8NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aHJvdyB0aGlzLmF1dGguX2Vycm9yRmFjdG9yeS5jcmVhdGUoImxvZ2luLWJsb2NrZWQiIC8qIEF1dGhFcnJvckNvZGUuTE9HSU5fQkxPQ0tFRCAqLywgew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2UNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBGZXRjaGVzIHRoZSBwYXNzd29yZCBwb2xpY3kgZm9yIHRoZSBjdXJyZW50bHkgc2V0IHRlbmFudCBvciB0aGUgcHJvamVjdCBpZiBubyB0ZW5hbnQgaXMgc2V0Lg0KICoNCiAqIEBwYXJhbSBhdXRoIEF1dGggb2JqZWN0Lg0KICogQHBhcmFtIHJlcXVlc3QgUGFzc3dvcmQgcG9saWN5IHJlcXVlc3QuDQogKiBAcmV0dXJucyBQYXNzd29yZCBwb2xpY3kgcmVzcG9uc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIF9nZXRQYXNzd29yZFBvbGljeShhdXRoLCByZXF1ZXN0ID0ge30pIHsNCiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsICJHRVQiIC8qIEh0dHBNZXRob2QuR0VUICovLCAiL3YyL3Bhc3N3b3JkUG9saWN5IiAvKiBFbmRwb2ludC5HRVRfUEFTU1dPUkRfUE9MSUNZICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLy8gTWluaW11bSBtaW4gcGFzc3dvcmQgbGVuZ3RoIGVuZm9yY2VkIGJ5IHRoZSBiYWNrZW5kLCBldmVuIGlmIG5vIG1pbmltdW0gbGVuZ3RoIGlzIHNldC4NCmNvbnN0IE1JTklNVU1fTUlOX1BBU1NXT1JEX0xFTkdUSCA9IDY7DQovKioNCiAqIFN0b3JlcyBwYXNzd29yZCBwb2xpY3kgcmVxdWlyZW1lbnRzIGFuZCBwcm92aWRlcyBwYXNzd29yZCB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIHBvbGljeS4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgUGFzc3dvcmRQb2xpY3lJbXBsIHsNCiAgICBjb25zdHJ1Y3RvcihyZXNwb25zZSkgew0KICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7DQogICAgICAgIC8vIE9ubHkgaW5jbHVkZSBjdXN0b20gc3RyZW5ndGggb3B0aW9ucyBkZWZpbmVkIGluIHRoZSByZXNwb25zZS4NCiAgICAgICAgY29uc3QgcmVzcG9uc2VPcHRpb25zID0gcmVzcG9uc2UuY3VzdG9tU3RyZW5ndGhPcHRpb25zOw0KICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucyA9IHt9Ow0KICAgICAgICAvLyBUT0RPOiBSZW1vdmUgb25jZSB0aGUgYmFja2VuZCBpcyB1cGRhdGVkIHRvIGluY2x1ZGUgdGhlIG1pbmltdW0gbWluIHBhc3N3b3JkIGxlbmd0aCBpbnN0ZWFkIG9mIHVuZGVmaW5lZCB3aGVuIHRoZXJlIGlzIG5vIG1pbmltdW0gbGVuZ3RoIHNldC4NCiAgICAgICAgdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMubWluUGFzc3dvcmRMZW5ndGggPQ0KICAgICAgICAgICAgKF9hID0gcmVzcG9uc2VPcHRpb25zLm1pblBhc3N3b3JkTGVuZ3RoKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBNSU5JTVVNX01JTl9QQVNTV09SRF9MRU5HVEg7DQogICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGgpIHsNCiAgICAgICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLm1heFBhc3N3b3JkTGVuZ3RoID0NCiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3BvbnNlT3B0aW9ucy5jb250YWluc0xvd2VyY2FzZUNoYXJhY3RlciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc0xvd2VyY2FzZUxldHRlciA9DQogICAgICAgICAgICAgICAgcmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyOw0KICAgICAgICB9DQogICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXIgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIgPQ0KICAgICAgICAgICAgICAgIHJlc3BvbnNlT3B0aW9ucy5jb250YWluc1VwcGVyY2FzZUNoYXJhY3RlcjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc051bWVyaWNDaGFyYWN0ZXIgPQ0KICAgICAgICAgICAgICAgIHJlc3BvbnNlT3B0aW9ucy5jb250YWluc051bWVyaWNDaGFyYWN0ZXI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3BvbnNlT3B0aW9ucy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlciA9DQogICAgICAgICAgICAgICAgcmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuZW5mb3JjZW1lbnRTdGF0ZSA9IHJlc3BvbnNlLmVuZm9yY2VtZW50U3RhdGU7DQogICAgICAgIGlmICh0aGlzLmVuZm9yY2VtZW50U3RhdGUgPT09ICdFTkZPUkNFTUVOVF9TVEFURV9VTlNQRUNJRklFRCcpIHsNCiAgICAgICAgICAgIHRoaXMuZW5mb3JjZW1lbnRTdGF0ZSA9ICdPRkYnOw0KICAgICAgICB9DQogICAgICAgIC8vIFVzZSBhbiBlbXB0eSBzdHJpbmcgaWYgbm8gbm9uLWFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzIGFyZSBzcGVjaWZpZWQgaW4gdGhlIHJlc3BvbnNlLg0KICAgICAgICB0aGlzLmFsbG93ZWROb25BbHBoYW51bWVyaWNDaGFyYWN0ZXJzID0NCiAgICAgICAgICAgIChfYyA9IChfYiA9IHJlc3BvbnNlLmFsbG93ZWROb25BbHBoYW51bWVyaWNDaGFyYWN0ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuam9pbignJykpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6ICcnOw0KICAgICAgICB0aGlzLmZvcmNlVXBncmFkZU9uU2lnbmluID0gKF9kID0gcmVzcG9uc2UuZm9yY2VVcGdyYWRlT25TaWduaW4pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IGZhbHNlOw0KICAgICAgICB0aGlzLnNjaGVtYVZlcnNpb24gPSByZXNwb25zZS5zY2hlbWFWZXJzaW9uOw0KICAgIH0NCiAgICB2YWxpZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKSB7DQogICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mOw0KICAgICAgICBjb25zdCBzdGF0dXMgPSB7DQogICAgICAgICAgICBpc1ZhbGlkOiB0cnVlLA0KICAgICAgICAgICAgcGFzc3dvcmRQb2xpY3k6IHRoaXMNCiAgICAgICAgfTsNCiAgICAgICAgLy8gQ2hlY2sgdGhlIHBhc3N3b3JkIGxlbmd0aCBhbmQgY2hhcmFjdGVyIG9wdGlvbnMuDQogICAgICAgIHRoaXMudmFsaWRhdGVQYXNzd29yZExlbmd0aE9wdGlvbnMocGFzc3dvcmQsIHN0YXR1cyk7DQogICAgICAgIHRoaXMudmFsaWRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnMocGFzc3dvcmQsIHN0YXR1cyk7DQogICAgICAgIC8vIENvbWJpbmUgdGhlIHN0YXR1cyBpbnRvIHNpbmdsZSBpc1ZhbGlkIHByb3BlcnR5Lg0KICAgICAgICBzdGF0dXMuaXNWYWxpZCAmJiAoc3RhdHVzLmlzVmFsaWQgPSAoX2EgPSBzdGF0dXMubWVldHNNaW5QYXNzd29yZExlbmd0aCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdHJ1ZSk7DQogICAgICAgIHN0YXR1cy5pc1ZhbGlkICYmIChzdGF0dXMuaXNWYWxpZCA9IChfYiA9IHN0YXR1cy5tZWV0c01heFBhc3N3b3JkTGVuZ3RoKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB0cnVlKTsNCiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9jID0gc3RhdHVzLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiB0cnVlKTsNCiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9kID0gc3RhdHVzLmNvbnRhaW5zVXBwZXJjYXNlTGV0dGVyKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiB0cnVlKTsNCiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9lID0gc3RhdHVzLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlcikgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogdHJ1ZSk7DQogICAgICAgIHN0YXR1cy5pc1ZhbGlkICYmIChzdGF0dXMuaXNWYWxpZCA9IChfZiA9IHN0YXR1cy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlcikgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogdHJ1ZSk7DQogICAgICAgIHJldHVybiBzdGF0dXM7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFZhbGlkYXRlcyB0aGF0IHRoZSBwYXNzd29yZCBtZWV0cyB0aGUgbGVuZ3RoIG9wdGlvbnMgZm9yIHRoZSBwb2xpY3kuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcGFzc3dvcmQgUGFzc3dvcmQgdG8gdmFsaWRhdGUuDQogICAgICogQHBhcmFtIHN0YXR1cyBWYWxpZGF0aW9uIHN0YXR1cy4NCiAgICAgKi8NCiAgICB2YWxpZGF0ZVBhc3N3b3JkTGVuZ3RoT3B0aW9ucyhwYXNzd29yZCwgc3RhdHVzKSB7DQogICAgICAgIGNvbnN0IG1pblBhc3N3b3JkTGVuZ3RoID0gdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMubWluUGFzc3dvcmRMZW5ndGg7DQogICAgICAgIGNvbnN0IG1heFBhc3N3b3JkTGVuZ3RoID0gdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGg7DQogICAgICAgIGlmIChtaW5QYXNzd29yZExlbmd0aCkgew0KICAgICAgICAgICAgc3RhdHVzLm1lZXRzTWluUGFzc3dvcmRMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggPj0gbWluUGFzc3dvcmRMZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG1heFBhc3N3b3JkTGVuZ3RoKSB7DQogICAgICAgICAgICBzdGF0dXMubWVldHNNYXhQYXNzd29yZExlbmd0aCA9IHBhc3N3b3JkLmxlbmd0aCA8PSBtYXhQYXNzd29yZExlbmd0aDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgcGFzc3dvcmQgbWVldHMgdGhlIGNoYXJhY3RlciBvcHRpb25zIGZvciB0aGUgcG9saWN5Lg0KICAgICAqDQogICAgICogQHBhcmFtIHBhc3N3b3JkIFBhc3N3b3JkIHRvIHZhbGlkYXRlLg0KICAgICAqIEBwYXJhbSBzdGF0dXMgVmFsaWRhdGlvbiBzdGF0dXMuDQogICAgICovDQogICAgdmFsaWRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnMocGFzc3dvcmQsIHN0YXR1cykgew0KICAgICAgICAvLyBBc3NpZ24gc3RhdHVzZXMgZm9yIHJlcXVpcmVtZW50cyBldmVuIGlmIHRoZSBwYXNzd29yZCBpcyBhbiBlbXB0eSBzdHJpbmcuDQogICAgICAgIHRoaXMudXBkYXRlUGFzc3dvcmRDaGFyYWN0ZXJPcHRpb25zU3RhdHVzZXMoc3RhdHVzLCANCiAgICAgICAgLyogY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXI9ICovIGZhbHNlLCANCiAgICAgICAgLyogY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXI9ICovIGZhbHNlLCANCiAgICAgICAgLyogY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyPSAqLyBmYWxzZSwgDQogICAgICAgIC8qIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyPSAqLyBmYWxzZSk7DQogICAgICAgIGxldCBwYXNzd29yZENoYXI7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFzc3dvcmQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHBhc3N3b3JkQ2hhciA9IHBhc3N3b3JkLmNoYXJBdChpKTsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlUGFzc3dvcmRDaGFyYWN0ZXJPcHRpb25zU3RhdHVzZXMoc3RhdHVzLCANCiAgICAgICAgICAgIC8qIGNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyPSAqLyBwYXNzd29yZENoYXIgPj0gJ2EnICYmDQogICAgICAgICAgICAgICAgcGFzc3dvcmRDaGFyIDw9ICd6JywgDQogICAgICAgICAgICAvKiBjb250YWluc1VwcGVyY2FzZUNoYXJhY3Rlcj0gKi8gcGFzc3dvcmRDaGFyID49ICdBJyAmJg0KICAgICAgICAgICAgICAgIHBhc3N3b3JkQ2hhciA8PSAnWicsIA0KICAgICAgICAgICAgLyogY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyPSAqLyBwYXNzd29yZENoYXIgPj0gJzAnICYmDQogICAgICAgICAgICAgICAgcGFzc3dvcmRDaGFyIDw9ICc5JywgDQogICAgICAgICAgICAvKiBjb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3Rlcj0gKi8gdGhpcy5hbGxvd2VkTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVycy5pbmNsdWRlcyhwYXNzd29yZENoYXIpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVcGRhdGVzIHRoZSBydW5uaW5nIHZhbGlkYXRpb24gc3RhdHVzIHdpdGggdGhlIHN0YXR1c2VzIGZvciB0aGUgY2hhcmFjdGVyIG9wdGlvbnMuDQogICAgICogRXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGVhY2ggdGltZSBhIGNoYXJhY3RlciBpcyBwcm9jZXNzZWQgdG8gdXBkYXRlIGVhY2ggb3B0aW9uIHN0YXR1cw0KICAgICAqIGJhc2VkIG9uIHRoZSBjdXJyZW50IGNoYXJhY3Rlci4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBzdGF0dXMgVmFsaWRhdGlvbiBzdGF0dXMuDQogICAgICogQHBhcmFtIGNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyIFdoZXRoZXIgdGhlIGNoYXJhY3RlciBpcyBhIGxvd2VyY2FzZSBsZXR0ZXIuDQogICAgICogQHBhcmFtIGNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyIFdoZXRoZXIgdGhlIGNoYXJhY3RlciBpcyBhbiB1cHBlcmNhc2UgbGV0dGVyLg0KICAgICAqIEBwYXJhbSBjb250YWluc051bWVyaWNDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbnVtZXJpYyBjaGFyYWN0ZXIuDQogICAgICogQHBhcmFtIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyIFdoZXRoZXIgdGhlIGNoYXJhY3RlciBpcyBhIG5vbi1hbHBoYW51bWVyaWMgY2hhcmFjdGVyLg0KICAgICAqLw0KICAgIHVwZGF0ZVBhc3N3b3JkQ2hhcmFjdGVyT3B0aW9uc1N0YXR1c2VzKHN0YXR1cywgY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIsIGNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyLCBjb250YWluc051bWVyaWNDaGFyYWN0ZXIsIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyKSB7DQogICAgICAgIGlmICh0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc0xvd2VyY2FzZUxldHRlcikgew0KICAgICAgICAgICAgc3RhdHVzLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyIHx8IChzdGF0dXMuY29udGFpbnNMb3dlcmNhc2VMZXR0ZXIgPSBjb250YWluc0xvd2VyY2FzZUNoYXJhY3Rlcik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zVXBwZXJjYXNlTGV0dGVyKSB7DQogICAgICAgICAgICBzdGF0dXMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIgfHwgKHN0YXR1cy5jb250YWluc1VwcGVyY2FzZUxldHRlciA9IGNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyKSB7DQogICAgICAgICAgICBzdGF0dXMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyIHx8IChzdGF0dXMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyID0gY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIpIHsNCiAgICAgICAgICAgIHN0YXR1cy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlciB8fCAoc3RhdHVzLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyID0gY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgQXV0aEltcGwgew0KICAgIGNvbnN0cnVjdG9yKGFwcCwgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyLCBhcHBDaGVja1NlcnZpY2VQcm92aWRlciwgY29uZmlnKSB7DQogICAgICAgIHRoaXMuYXBwID0gYXBwOw0KICAgICAgICB0aGlzLmhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlciA9IGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlcjsNCiAgICAgICAgdGhpcy5hcHBDaGVja1NlcnZpY2VQcm92aWRlciA9IGFwcENoZWNrU2VydmljZVByb3ZpZGVyOw0KICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZzsNCiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGw7DQogICAgICAgIHRoaXMuZW11bGF0b3JDb25maWcgPSBudWxsOw0KICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSBQcm9taXNlLnJlc29sdmUoKTsNCiAgICAgICAgdGhpcy5hdXRoU3RhdGVTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKHRoaXMpOw0KICAgICAgICB0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKHRoaXMpOw0KICAgICAgICB0aGlzLmJlZm9yZVN0YXRlUXVldWUgPSBuZXcgQXV0aE1pZGRsZXdhcmVRdWV1ZSh0aGlzKTsNCiAgICAgICAgdGhpcy5yZWRpcmVjdFVzZXIgPSBudWxsOw0KICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5FWFBFQ1RFRF9QQVNTV09SRF9QT0xJQ1lfU0NIRU1BX1ZFUlNJT04gPSAxOw0KICAgICAgICAvLyBBbnkgbmV0d29yayBjYWxscyB3aWxsIHNldCB0aGlzIHRvIHRydWUgYW5kIHByZXZlbnQgc3Vic2VxdWVudCBlbXVsYXRvcg0KICAgICAgICAvLyBpbml0aWFsaXphdGlvbg0KICAgICAgICB0aGlzLl9jYW5Jbml0RW11bGF0b3IgPSB0cnVlOw0KICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gZmFsc2U7DQogICAgICAgIHRoaXMuX2RlbGV0ZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlID0gbnVsbDsNCiAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5fZXJyb3JGYWN0b3J5ID0gX0RFRkFVTFRfQVVUSF9FUlJPUl9GQUNUT1JZOw0KICAgICAgICB0aGlzLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyA9IG51bGw7DQogICAgICAgIHRoaXMuX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3MgPSB7fTsNCiAgICAgICAgdGhpcy5fcHJvamVjdFBhc3N3b3JkUG9saWN5ID0gbnVsbDsNCiAgICAgICAgdGhpcy5fdGVuYW50UGFzc3dvcmRQb2xpY2llcyA9IHt9Ow0KICAgICAgICAvLyBUcmFja3MgdGhlIGxhc3Qgbm90aWZpZWQgVUlEIGZvciBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXJzIHRvIHByZXZlbnQNCiAgICAgICAgLy8gcmVwZWF0ZWQgY2FsbHMgdG8gdGhlIGNhbGxiYWNrcy4gVW5kZWZpbmVkIG1lYW5zIGl0J3MgbmV2ZXIgYmVlbg0KICAgICAgICAvLyBjYWxsZWQsIHdoZXJlYXMgbnVsbCBtZWFucyBpdCdzIGJlZW4gY2FsbGVkIHdpdGggYSBzaWduZWQgb3V0IHVzZXINCiAgICAgICAgdGhpcy5sYXN0Tm90aWZpZWRVaWQgPSB1bmRlZmluZWQ7DQogICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gbnVsbDsNCiAgICAgICAgdGhpcy50ZW5hbnRJZCA9IG51bGw7DQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSB7IGFwcFZlcmlmaWNhdGlvbkRpc2FibGVkRm9yVGVzdGluZzogZmFsc2UgfTsNCiAgICAgICAgdGhpcy5mcmFtZXdvcmtzID0gW107DQogICAgICAgIHRoaXMubmFtZSA9IGFwcC5uYW1lOw0KICAgICAgICB0aGlzLmNsaWVudFZlcnNpb24gPSBjb25maWcuc2RrQ2xpZW50VmVyc2lvbjsNCiAgICB9DQogICAgX2luaXRpYWxpemVXaXRoUGVyc2lzdGVuY2UocGVyc2lzdGVuY2VIaWVyYXJjaHksIHBvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICBpZiAocG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7DQogICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBfZ2V0SW5zdGFuY2UocG9wdXBSZWRpcmVjdFJlc29sdmVyKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBIYXZlIHRvIGNoZWNrIGZvciBhcHAgZGVsZXRpb24gdGhyb3VnaG91dCBpbml0aWFsaXphdGlvbiAoYWZ0ZXIgZWFjaA0KICAgICAgICAvLyBwcm9taXNlIHJlc29sdXRpb24pDQogICAgICAgIHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZSA9IHRoaXMucXVldWUoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgdmFyIF9hLCBfYjsNCiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIgPSBhd2FpdCBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyLmNyZWF0ZSh0aGlzLCBwZXJzaXN0ZW5jZUhpZXJhcmNoeSk7DQogICAgICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIHJlc29sdmVyIGVhcmx5IGlmIG5lY2Vzc2FyeSAob25seSBhcHBsaWNhYmxlIHRvIHdlYjoNCiAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBjYXVzZSB0aGUgaWZyYW1lIHRvIGxvYWQgaW1tZWRpYXRlbHkgaW4gY2VydGFpbiBjYXNlcykNCiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5fc2hvdWxkSW5pdFByb2FjdGl2ZWx5KSB7DQogICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBmYWlscywgZG9uJ3QgaGFsdCBhdXRoIGxvYWRpbmcNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX2luaXRpYWxpemUodGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgZXJyb3IgKi8NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVDdXJyZW50VXNlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpOw0KICAgICAgICAgICAgdGhpcy5sYXN0Tm90aWZpZWRVaWQgPSAoKF9iID0gdGhpcy5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnVpZCkgfHwgbnVsbDsNCiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5faXNJbml0aWFsaXplZCA9IHRydWU7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBJZiB0aGUgcGVyc2lzdGVuY2UgaXMgY2hhbmdlZCBpbiBhbm90aGVyIHdpbmRvdywgdGhlIHVzZXIgbWFuYWdlciB3aWxsIGxldCB1cyBrbm93DQogICAgICovDQogICAgYXN5bmMgX29uU3RvcmFnZUV2ZW50KCkgew0KICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2UuZ2V0Q3VycmVudFVzZXIoKTsNCiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRVc2VyICYmICF1c2VyKSB7DQogICAgICAgICAgICAvLyBObyBjaGFuZ2UsIGRvIG5vdGhpbmcgKHdhcyBzaWduZWQgb3V0IGFuZCByZW1haW5lZCBzaWduZWQgb3V0KS4NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBJZiB0aGUgc2FtZSB1c2VyIGlzIHRvIGJlIHN5bmNocm9uaXplZC4NCiAgICAgICAgaWYgKHRoaXMuY3VycmVudFVzZXIgJiYgdXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnVpZCA9PT0gdXNlci51aWQpIHsNCiAgICAgICAgICAgIC8vIERhdGEgdXBkYXRlLCBzaW1wbHkgY29weSBkYXRhIGNoYW5nZXMuDQogICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fYXNzaWduKHVzZXIpOw0KICAgICAgICAgICAgLy8gSWYgdG9rZW5zIGNoYW5nZWQgZnJvbSBwcmV2aW91cyB1c2VyIHRva2VucywgdGhpcyB3aWxsIHRyaWdnZXINCiAgICAgICAgICAgIC8vIG5vdGlmeUF1dGhMaXN0ZW5lcnNfLg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5jdXJyZW50VXNlci5nZXRJZFRva2VuKCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgLy8gVXBkYXRlIGN1cnJlbnQgQXV0aCBzdGF0ZS4gRWl0aGVyIGEgbmV3IGxvZ2luIG9yIGxvZ291dC4NCiAgICAgICAgLy8gU2tpcCBibG9ja2luZyBjYWxsYmFja3MsIHRoZXkgc2hvdWxkIG5vdCBhcHBseSB0byBhIGNoYW5nZSBpbiBhbm90aGVyIHRhYi4NCiAgICAgICAgYXdhaXQgdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIodXNlciwgLyogc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzICovIHRydWUpOw0KICAgIH0NCiAgICBhc3luYyBpbml0aWFsaXplQ3VycmVudFVzZXIocG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgLy8gRmlyc3QgY2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgYSBwZW5kaW5nIHJlZGlyZWN0IGV2ZW50Lg0KICAgICAgICBjb25zdCBwcmV2aW91c2x5U3RvcmVkVXNlciA9IChhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2UuZ2V0Q3VycmVudFVzZXIoKSk7DQogICAgICAgIGxldCBmdXR1cmVDdXJyZW50VXNlciA9IHByZXZpb3VzbHlTdG9yZWRVc2VyOw0KICAgICAgICBsZXQgbmVlZHNUb2NoZWNrTWlkZGxld2FyZSA9IGZhbHNlOw0KICAgICAgICBpZiAocG9wdXBSZWRpcmVjdFJlc29sdmVyICYmIHRoaXMuY29uZmlnLmF1dGhEb21haW4pIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIoKTsNCiAgICAgICAgICAgIGNvbnN0IHJlZGlyZWN0VXNlckV2ZW50SWQgPSAoX2EgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9yZWRpcmVjdEV2ZW50SWQ7DQogICAgICAgICAgICBjb25zdCBzdG9yZWRVc2VyRXZlbnRJZCA9IGZ1dHVyZUN1cnJlbnRVc2VyID09PSBudWxsIHx8IGZ1dHVyZUN1cnJlbnRVc2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmdXR1cmVDdXJyZW50VXNlci5fcmVkaXJlY3RFdmVudElkOw0KICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy50cnlSZWRpcmVjdFNpZ25Jbihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpOw0KICAgICAgICAgICAgLy8gSWYgdGhlIHN0b3JlZCB1c2VyIChpLmUuIHRoZSBvbGQgImN1cnJlbnRVc2VyIikgaGFzIGEgcmVkaXJlY3RJZCB0aGF0DQogICAgICAgICAgICAvLyBtYXRjaGVzIHRoZSByZWRpcmVjdCB1c2VyLCB0aGVuIHdlIHdhbnQgdG8gaW5pdGlhbGx5IHNpZ24gaW4gd2l0aCB0aGUNCiAgICAgICAgICAgIC8vIG5ldyB1c2VyIG9iamVjdCBmcm9tIHJlc3VsdC4NCiAgICAgICAgICAgIC8vIFRPRE8oc2FtZ2hvKTogTW9yZSB0aG9yb3VnaGx5IHRlc3QgYWxsIG9mIHRoaXMNCiAgICAgICAgICAgIGlmICgoIXJlZGlyZWN0VXNlckV2ZW50SWQgfHwgcmVkaXJlY3RVc2VyRXZlbnRJZCA9PT0gc3RvcmVkVXNlckV2ZW50SWQpICYmDQogICAgICAgICAgICAgICAgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC51c2VyKSkgew0KICAgICAgICAgICAgICAgIGZ1dHVyZUN1cnJlbnRVc2VyID0gcmVzdWx0LnVzZXI7DQogICAgICAgICAgICAgICAgbmVlZHNUb2NoZWNrTWlkZGxld2FyZSA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgbm8gdXNlciBpbiBwZXJzaXN0ZW5jZSwgdGhlcmUgaXMgbm8gY3VycmVudCB1c2VyLiBTZXQgdG8gbnVsbC4NCiAgICAgICAgaWYgKCFmdXR1cmVDdXJyZW50VXNlcikgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQpIHsNCiAgICAgICAgICAgIC8vIFRoaXMgaXNuJ3QgYSByZWRpcmVjdCBsaW5rIG9wZXJhdGlvbiwgd2UgY2FuIHJlbG9hZCBhbmQgYmFpbC4NCiAgICAgICAgICAgIC8vIEZpcnN0IHRob3VnaCwgZW5zdXJlIHRoYXQgd2UgY2hlY2sgdGhlIG1pZGRsZXdhcmUgaXMgaGFwcHkuDQogICAgICAgICAgICBpZiAobmVlZHNUb2NoZWNrTWlkZGxld2FyZSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKGZ1dHVyZUN1cnJlbnRVc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgZnV0dXJlQ3VycmVudFVzZXIgPSBwcmV2aW91c2x5U3RvcmVkVXNlcjsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2Uga25vdyB0aGlzIGlzIGF2YWlsYWJsZSBzaW5jZSB0aGUgYml0IGlzIG9ubHkgc2V0IHdoZW4gdGhlDQogICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmVyIGlzIGF2YWlsYWJsZQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQodGhpcywgKCkgPT4gUHJvbWlzZS5yZWplY3QoZSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmdXR1cmVDdXJyZW50VXNlcikgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcihmdXR1cmVDdXJyZW50VXNlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIF9hc3NlcnQodGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLCB0aGlzLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgICAgICBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKCk7DQogICAgICAgIC8vIElmIHRoZSByZWRpcmVjdCB1c2VyJ3MgZXZlbnQgSUQgbWF0Y2hlcyB0aGUgY3VycmVudCB1c2VyJ3MgZXZlbnQgSUQsDQogICAgICAgIC8vIERPIE5PVCByZWxvYWQgdGhlIGN1cnJlbnQgdXNlciwgb3RoZXJ3aXNlIHRoZXknbGwgYmUgY2xlYXJlZCBmcm9tIHN0b3JhZ2UuDQogICAgICAgIC8vIFRoaXMgaXMgaW1wb3J0YW50IGZvciB0aGUgcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3QoKSBmbG93Lg0KICAgICAgICBpZiAodGhpcy5yZWRpcmVjdFVzZXIgJiYNCiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyLl9yZWRpcmVjdEV2ZW50SWQgPT09IGZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIoZnV0dXJlQ3VycmVudFVzZXIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLnJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcihmdXR1cmVDdXJyZW50VXNlcik7DQogICAgfQ0KICAgIGFzeW5jIHRyeVJlZGlyZWN0U2lnbkluKHJlZGlyZWN0UmVzb2x2ZXIpIHsNCiAgICAgICAgLy8gVGhlIHJlZGlyZWN0IHVzZXIgbmVlZHMgdG8gYmUgY2hlY2tlZCAoYW5kIHNpZ25lZCBpbiBpZiBhdmFpbGFibGUpDQogICAgICAgIC8vIGR1cmluZyBhdXRoIGluaXRpYWxpemF0aW9uLiBBbGwgb2YgdGhlIG5vcm1hbCBzaWduIGluIGFuZCBsaW5rL3JlYXV0aA0KICAgICAgICAvLyBmbG93cyBjYWxsIGJhY2sgaW50byBhdXRoIGFuZCBwdXNoIHRoaW5ncyBvbnRvIHRoZSBwcm9taXNlIHF1ZXVlLiBXZQ0KICAgICAgICAvLyBuZWVkIHRvIGF3YWl0IHRoZSByZXN1bHQgb2YgdGhlIHJlZGlyZWN0IHNpZ24gaW4gKmluc2lkZSB0aGUgcHJvbWlzZQ0KICAgICAgICAvLyBxdWV1ZSouIFRoaXMgcHJlc2VudHMgYSBwcm9ibGVtOiB3ZSBydW4gaW50byBkZWFkbG9jay4gU2VlOg0KICAgICAgICAvLyAgICDilIw+IFtJbml0aWFsaXphdGlvbl0g4pSA4pSA4pSA4pSA4pSA4pSQDQogICAgICAgIC8vICAgIOKUjD4gWzxvdGhlciBxdWV1ZSB0YXNrcz5dIOKUgg0KICAgICAgICAvLyAgICDilJTilIAgW2dldFJlZGlyZWN0UmVzdWx0XSA84pSA4pSYDQogICAgICAgIC8vICAgIHdoZXJlIFtdIGFyZSB0YXNrcyBvbiB0aGUgcXVldWUgYW5kIGFycm93cyBkZW5vdGUgYXdhaXRzDQogICAgICAgIC8vIEluaXRpYWxpemF0aW9uIHdpbGwgbmV2ZXIgY29tcGxldGUgYmVjYXVzZSBpdCdzIHdhaXRpbmcgb24gc29tZXRoaW5nDQogICAgICAgIC8vIHRoYXQncyB3YWl0aW5nIGZvciBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSENCiAgICAgICAgLy8NCiAgICAgICAgLy8gSW5zdGVhZCwgdGhpcyBtZXRob2QgY2FsbHMgZ2V0UmVkaXJlY3RSZXN1bHQoKSAoc3RvcmVkIGluDQogICAgICAgIC8vIF9jb21wbGV0ZVJlZGlyZWN0Rm4pIHdpdGggYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgaW5zdHJ1Y3RzIGFsbCBvZg0KICAgICAgICAvLyB0aGUgdW5kZXJseWluZyBhdXRoIG9wZXJhdGlvbnMgdG8gc2tpcCBhbnl0aGluZyB0aGF0IG11dGF0ZXMgYXV0aCBzdGF0ZS4NCiAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBXZSBrbm93IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciBpcyBzZXQgc2luY2UgcmVkaXJlY3RSZXNvbHZlcg0KICAgICAgICAgICAgLy8gaXMgcGFzc2VkIGluLiBUaGUgX2NvbXBsZXRlUmVkaXJlY3RGbiBleHBlY3RzIHRoZSB1bndyYXBwZWQgZXh0ZXJuLg0KICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLl9jb21wbGV0ZVJlZGlyZWN0Rm4odGhpcywgcmVkaXJlY3RSZXNvbHZlciwgdHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIC8vIFN3YWxsb3cgYW55IGVycm9ycyBoZXJlOyB0aGUgY29kZSBjYW4gcmV0cmlldmUgdGhlbSBpbg0KICAgICAgICAgICAgLy8gZ2V0UmVkaXJlY3RSZXN1bHQoKS4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NldFJlZGlyZWN0VXNlcihudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICBhc3luYyByZWxvYWRBbmRTZXRDdXJyZW50VXNlck9yQ2xlYXIodXNlcikgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGlmICgoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmNvZGUpICE9PQ0KICAgICAgICAgICAgICAgIGBhdXRoLyR7Im5ldHdvcmstcmVxdWVzdC1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqL31gKSB7DQogICAgICAgICAgICAgICAgLy8gU29tZXRoaW5nJ3Mgd3Jvbmcgd2l0aCB0aGUgdXNlcidzIHRva2VuLiBMb2cgdGhlbSBvdXQgYW5kIHJlbW92ZQ0KICAgICAgICAgICAgICAgIC8vIHRoZW0gZnJvbSBzdG9yYWdlDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpOw0KICAgIH0NCiAgICB1c2VEZXZpY2VMYW5ndWFnZSgpIHsNCiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSBfZ2V0VXNlckxhbmd1YWdlKCk7DQogICAgfQ0KICAgIGFzeW5jIF9kZWxldGUoKSB7DQogICAgICAgIHRoaXMuX2RlbGV0ZWQgPSB0cnVlOw0KICAgIH0NCiAgICBhc3luYyB1cGRhdGVDdXJyZW50VXNlcih1c2VyRXh0ZXJuKSB7DQogICAgICAgIC8vIFRoZSBwdWJsaWMgdXBkYXRlQ3VycmVudFVzZXIgbWV0aG9kIG5lZWRzIHRvIG1ha2UgYSBjb3B5IG9mIHRoZSB1c2VyLA0KICAgICAgICAvLyBhbmQgYWxzbyBjaGVjayB0aGF0IHRoZSBwcm9qZWN0IG1hdGNoZXMNCiAgICAgICAgY29uc3QgdXNlciA9IHVzZXJFeHRlcm4NCiAgICAgICAgICAgID8gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXJFeHRlcm4pDQogICAgICAgICAgICA6IG51bGw7DQogICAgICAgIGlmICh1c2VyKSB7DQogICAgICAgICAgICBfYXNzZXJ0KHVzZXIuYXV0aC5jb25maWcuYXBpS2V5ID09PSB0aGlzLmNvbmZpZy5hcGlLZXksIHRoaXMsICJpbnZhbGlkLXVzZXItdG9rZW4iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIICovKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIodXNlciAmJiB1c2VyLl9jbG9uZSh0aGlzKSk7DQogICAgfQ0KICAgIGFzeW5jIF91cGRhdGVDdXJyZW50VXNlcih1c2VyLCBza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MgPSBmYWxzZSkgew0KICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICh1c2VyKSB7DQogICAgICAgICAgICBfYXNzZXJ0KHRoaXMudGVuYW50SWQgPT09IHVzZXIudGVuYW50SWQsIHRoaXMsICJ0ZW5hbnQtaWQtbWlzbWF0Y2giIC8qIEF1dGhFcnJvckNvZGUuVEVOQU5UX0lEX01JU01BVENIICovKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXNraXBCZWZvcmVTdGF0ZUNhbGxiYWNrcykgew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5iZWZvcmVTdGF0ZVF1ZXVlLnJ1bk1pZGRsZXdhcmUodXNlcik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpOw0KICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhc3luYyBzaWduT3V0KCkgew0KICAgICAgICAvLyBSdW4gZmlyc3QsIHRvIGJsb2NrIF9zZXRSZWRpcmVjdFVzZXIoKSBpZiBhbnkgY2FsbGJhY2tzIGZhaWwuDQogICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKG51bGwpOw0KICAgICAgICAvLyBDbGVhciB0aGUgcmVkaXJlY3QgdXNlciB3aGVuIHNpZ25PdXQgaXMgY2FsbGVkDQogICAgICAgIGlmICh0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyIHx8IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UmVkaXJlY3RVc2VyKG51bGwpOw0KICAgICAgICB9DQogICAgICAgIC8vIFByZXZlbnQgY2FsbGJhY2tzIGZyb20gYmVpbmcgY2FsbGVkIGFnYWluIGluIF91cGRhdGVDdXJyZW50VXNlciwgYXMNCiAgICAgICAgLy8gdGhleSB3ZXJlIGFscmVhZHkgY2FsbGVkIGluIHRoZSBmaXJzdCBsaW5lLg0KICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIobnVsbCwgLyogc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzICovIHRydWUpOw0KICAgIH0NCiAgICBzZXRQZXJzaXN0ZW5jZShwZXJzaXN0ZW5jZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2Uuc2V0UGVyc2lzdGVuY2UoX2dldEluc3RhbmNlKHBlcnNpc3RlbmNlKSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBfZ2V0UmVjYXB0Y2hhQ29uZmlnKCkgew0KICAgICAgICBpZiAodGhpcy50ZW5hbnRJZCA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWdlbnRSZWNhcHRjaGFDb25maWc7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1t0aGlzLnRlbmFudElkXTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBhc3luYyB2YWxpZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKSB7DQogICAgICAgIGlmICghdGhpcy5fZ2V0UGFzc3dvcmRQb2xpY3lJbnRlcm5hbCgpKSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLl91cGRhdGVQYXNzd29yZFBvbGljeSgpOw0KICAgICAgICB9DQogICAgICAgIC8vIFBhc3N3b3JkIHBvbGljeSB3aWxsIGJlIGRlZmluZWQgYWZ0ZXIgZmV0Y2hpbmcuDQogICAgICAgIGNvbnN0IHBhc3N3b3JkUG9saWN5ID0gdGhpcy5fZ2V0UGFzc3dvcmRQb2xpY3lJbnRlcm5hbCgpOw0KICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBwb2xpY3kgc2NoZW1hIHZlcnNpb24gaXMgc3VwcG9ydGVkIGJ5IHRoZSBTREsuDQogICAgICAgIC8vIFRPRE86IFVwZGF0ZSB0aGlzIGxvZ2ljIHRvIHVzZSBhIG1heCBzdXBwb3J0ZWQgcG9saWN5IHNjaGVtYSB2ZXJzaW9uIG9uY2Ugd2UgaGF2ZSBtdWx0aXBsZSBzY2hlbWEgdmVyc2lvbnMuDQogICAgICAgIGlmIChwYXNzd29yZFBvbGljeS5zY2hlbWFWZXJzaW9uICE9PQ0KICAgICAgICAgICAgdGhpcy5FWFBFQ1RFRF9QQVNTV09SRF9QT0xJQ1lfU0NIRU1BX1ZFUlNJT04pIHsNCiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCh0aGlzLl9lcnJvckZhY3RvcnkuY3JlYXRlKCJ1bnN1cHBvcnRlZC1wYXNzd29yZC1wb2xpY3ktc2NoZW1hLXZlcnNpb24iIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfUEFTU1dPUkRfUE9MSUNZX1NDSEVNQV9WRVJTSU9OICovLCB7fSkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwYXNzd29yZFBvbGljeS52YWxpZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKTsNCiAgICB9DQogICAgX2dldFBhc3N3b3JkUG9saWN5SW50ZXJuYWwoKSB7DQogICAgICAgIGlmICh0aGlzLnRlbmFudElkID09PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvamVjdFBhc3N3b3JkUG9saWN5Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbmFudFBhc3N3b3JkUG9saWNpZXNbdGhpcy50ZW5hbnRJZF07DQogICAgICAgIH0NCiAgICB9DQogICAgYXN5bmMgX3VwZGF0ZVBhc3N3b3JkUG9saWN5KCkgew0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9nZXRQYXNzd29yZFBvbGljeSh0aGlzKTsNCiAgICAgICAgY29uc3QgcGFzc3dvcmRQb2xpY3kgPSBuZXcgUGFzc3dvcmRQb2xpY3lJbXBsKHJlc3BvbnNlKTsNCiAgICAgICAgaWYgKHRoaXMudGVuYW50SWQgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuX3Byb2plY3RQYXNzd29yZFBvbGljeSA9IHBhc3N3b3JkUG9saWN5Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5fdGVuYW50UGFzc3dvcmRQb2xpY2llc1t0aGlzLnRlbmFudElkXSA9IHBhc3N3b3JkUG9saWN5Ow0KICAgICAgICB9DQogICAgfQ0KICAgIF9nZXRQZXJzaXN0ZW5jZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5wZXJzaXN0ZW5jZS50eXBlOw0KICAgIH0NCiAgICBfdXBkYXRlRXJyb3JNYXAoZXJyb3JNYXApIHsNCiAgICAgICAgdGhpcy5fZXJyb3JGYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKCkpOw0KICAgIH0NCiAgICBvbkF1dGhTdGF0ZUNoYW5nZWQobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7DQogICAgfQ0KICAgIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQoY2FsbGJhY2ssIG9uQWJvcnQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5wdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpOw0KICAgIH0NCiAgICBvbklkVG9rZW5DaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyU3RhdGVMaXN0ZW5lcih0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24sIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTsNCiAgICB9DQogICAgYXV0aFN0YXRlUmVhZHkoKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgICAgIHJlc29sdmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdGhpcy5vbkF1dGhTdGF0ZUNoYW5nZWQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZSgpOw0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7DQogICAgICAgICAgICAgICAgfSwgcmVqZWN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgYXBpS2V5OiB0aGlzLmNvbmZpZy5hcGlLZXksDQogICAgICAgICAgICBhdXRoRG9tYWluOiB0aGlzLmNvbmZpZy5hdXRoRG9tYWluLA0KICAgICAgICAgICAgYXBwTmFtZTogdGhpcy5uYW1lLA0KICAgICAgICAgICAgY3VycmVudFVzZXI6IChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9KU09OKCkNCiAgICAgICAgfTsNCiAgICB9DQogICAgYXN5bmMgX3NldFJlZGlyZWN0VXNlcih1c2VyLCBwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHsNCiAgICAgICAgY29uc3QgcmVkaXJlY3RNYW5hZ2VyID0gYXdhaXQgdGhpcy5nZXRPckluaXRSZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpOw0KICAgICAgICByZXR1cm4gdXNlciA9PT0gbnVsbA0KICAgICAgICAgICAgPyByZWRpcmVjdE1hbmFnZXIucmVtb3ZlQ3VycmVudFVzZXIoKQ0KICAgICAgICAgICAgOiByZWRpcmVjdE1hbmFnZXIuc2V0Q3VycmVudFVzZXIodXNlcik7DQogICAgfQ0KICAgIGFzeW5jIGdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICBpZiAoIXRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gKHBvcHVwUmVkaXJlY3RSZXNvbHZlciAmJiBfZ2V0SW5zdGFuY2UocG9wdXBSZWRpcmVjdFJlc29sdmVyKSkgfHwNCiAgICAgICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXI7DQogICAgICAgICAgICBfYXNzZXJ0KHJlc29sdmVyLCB0aGlzLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlciA9IGF3YWl0IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIuY3JlYXRlKHRoaXMsIFtfZ2V0SW5zdGFuY2UocmVzb2x2ZXIuX3JlZGlyZWN0UGVyc2lzdGVuY2UpXSwgInJlZGlyZWN0VXNlciIgLyogS2V5TmFtZS5SRURJUkVDVF9VU0VSICovKTsNCiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyID0NCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyLmdldEN1cnJlbnRVc2VyKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXI7DQogICAgfQ0KICAgIGFzeW5jIF9yZWRpcmVjdFVzZXJGb3JJZChpZCkgew0KICAgICAgICB2YXIgX2EsIF9iOw0KICAgICAgICAvLyBNYWtlIHN1cmUgd2UndmUgY2xlYXJlZCBhbnkgcGVuZGluZyBwZXJzaXN0ZW5jZSBhY3Rpb25zIGlmIHdlJ3JlIG5vdCBpbg0KICAgICAgICAvLyB0aGUgaW5pdGlhbGl6ZXINCiAgICAgICAgaWYgKHRoaXMuX2lzSW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMucXVldWUoYXN5bmMgKCkgPT4geyB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX3JlZGlyZWN0RXZlbnRJZCkgPT09IGlkKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFVzZXI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCgoX2IgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLl9yZWRpcmVjdEV2ZW50SWQpID09PSBpZCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RVc2VyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICBhc3luYyBfcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlcikgew0KICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogTm90aWZpZXMgbGlzdGVuZXJzIG9ubHkgaWYgdGhlIHVzZXIgaXMgY3VycmVudCAqLw0KICAgIF9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodXNlcikgew0KICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgX2tleSgpIHsNCiAgICAgICAgcmV0dXJuIGAke3RoaXMuY29uZmlnLmF1dGhEb21haW59OiR7dGhpcy5jb25maWcuYXBpS2V5fToke3RoaXMubmFtZX1gOw0KICAgIH0NCiAgICBfc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCkgew0KICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpIHsNCiAgICAgICAgdGhpcy5pc1Byb2FjdGl2ZVJlZnJlc2hFbmFibGVkID0gZmFsc2U7DQogICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7DQogICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyIGNhc3QgYXMgdGhlIGludGVybmFsIHR5cGUgKi8NCiAgICBnZXQgX2N1cnJlbnRVc2VyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlcjsNCiAgICB9DQogICAgbm90aWZ5QXV0aExpc3RlbmVycygpIHsNCiAgICAgICAgdmFyIF9hLCBfYjsNCiAgICAgICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5pZFRva2VuU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7DQogICAgICAgIGNvbnN0IGN1cnJlbnRVaWQgPSAoX2IgPSAoX2EgPSB0aGlzLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudWlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsOw0KICAgICAgICBpZiAodGhpcy5sYXN0Tm90aWZpZWRVaWQgIT09IGN1cnJlbnRVaWQpIHsNCiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gY3VycmVudFVpZDsNCiAgICAgICAgICAgIHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHN1YnNjcmlwdGlvbiwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHsNCiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHsNCiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7IH07DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2IgPSB0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbicNCiAgICAgICAgICAgID8gbmV4dE9yT2JzZXJ2ZXINCiAgICAgICAgICAgIDogbmV4dE9yT2JzZXJ2ZXIubmV4dC5iaW5kKG5leHRPck9ic2VydmVyKTsNCiAgICAgICAgbGV0IGlzVW5zdWJzY3JpYmVkID0gZmFsc2U7DQogICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLl9pc0luaXRpYWxpemVkDQogICAgICAgICAgICA/IFByb21pc2UucmVzb2x2ZSgpDQogICAgICAgICAgICA6IHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZTsNCiAgICAgICAgX2Fzc2VydChwcm9taXNlLCB0aGlzLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICAvLyBUaGUgY2FsbGJhY2sgbmVlZHMgdG8gYmUgY2FsbGVkIGFzeW5jaHJvbm91c2x5IHBlciB0aGUgc3BlYy4NCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlcw0KICAgICAgICBwcm9taXNlLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgaWYgKGlzVW5zdWJzY3JpYmVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2IodGhpcy5jdXJyZW50VXNlcik7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAodHlwZW9mIG5leHRPck9ic2VydmVyID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHN1YnNjcmlwdGlvbi5hZGRPYnNlcnZlcihuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7DQogICAgICAgICAgICByZXR1cm4gKCkgPT4gew0KICAgICAgICAgICAgICAgIGlzVW5zdWJzY3JpYmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB1bnN1YnNjcmliZSgpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gc3Vic2NyaXB0aW9uLmFkZE9ic2VydmVyKG5leHRPck9ic2VydmVyKTsNCiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7DQogICAgICAgICAgICAgICAgaXNVbnN1YnNjcmliZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlKCk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVucHJvdGVjdGVkIChmcm9tIHJhY2UgY29uZGl0aW9ucykgbWV0aG9kIHRvIHNldCB0aGUgY3VycmVudCB1c2VyLiBUaGlzDQogICAgICogc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gd2l0aGluIGEgcXVldWVkIGNhbGxiYWNrLiBUaGlzIGlzIG5lY2Vzc2FyeQ0KICAgICAqIGJlY2F1c2UgdGhlIHF1ZXVlIHNob3VsZG4ndCByZWx5IG9uIGFub3RoZXIgcXVldWVkIGNhbGxiYWNrLg0KICAgICAqLw0KICAgIGFzeW5jIGRpcmVjdGx5U2V0Q3VycmVudFVzZXIodXNlcikgew0KICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyICE9PSB1c2VyKSB7DQogICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodXNlciAmJiB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQpIHsNCiAgICAgICAgICAgIHVzZXIuX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSB1c2VyOw0KICAgICAgICBpZiAodXNlcikgew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnNldEN1cnJlbnRVc2VyKHVzZXIpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnJlbW92ZUN1cnJlbnRVc2VyKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcXVldWUoYWN0aW9uKSB7DQogICAgICAgIC8vIEluIGNhc2Ugc29tZXRoaW5nIGVycm9ycywgdGhlIGNhbGxiYWNrIHN0aWxsIHNob3VsZCBiZSBjYWxsZWQgaW4gb3JkZXINCiAgICAgICAgLy8gdG8ga2VlcCB0aGUgcHJvbWlzZSBjaGFpbiBhbGl2ZQ0KICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnMudGhlbihhY3Rpb24sIGFjdGlvbik7DQogICAgICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbnM7DQogICAgfQ0KICAgIGdldCBhc3NlcnRlZFBlcnNpc3RlbmNlKCkgew0KICAgICAgICBfYXNzZXJ0KHRoaXMucGVyc2lzdGVuY2VNYW5hZ2VyLCB0aGlzLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXI7DQogICAgfQ0KICAgIF9sb2dGcmFtZXdvcmsoZnJhbWV3b3JrKSB7DQogICAgICAgIGlmICghZnJhbWV3b3JrIHx8IHRoaXMuZnJhbWV3b3Jrcy5pbmNsdWRlcyhmcmFtZXdvcmspKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5mcmFtZXdvcmtzLnB1c2goZnJhbWV3b3JrKTsNCiAgICAgICAgLy8gU29ydCBhbHBoYWJldGljYWxseSBzbyB0aGF0ICJGaXJlYmFzZUNvcmUtd2ViLEZpcmViYXNlVUktd2ViIiBhbmQNCiAgICAgICAgLy8gIkZpcmViYXNlVUktd2ViLEZpcmViYXNlQ29yZS13ZWIiIGFyZW4ndCB2aWV3ZWQgYXMgZGlmZmVyZW50Lg0KICAgICAgICB0aGlzLmZyYW1ld29ya3Muc29ydCgpOw0KICAgICAgICB0aGlzLmNsaWVudFZlcnNpb24gPSBfZ2V0Q2xpZW50VmVyc2lvbih0aGlzLmNvbmZpZy5jbGllbnRQbGF0Zm9ybSwgdGhpcy5fZ2V0RnJhbWV3b3JrcygpKTsNCiAgICB9DQogICAgX2dldEZyYW1ld29ya3MoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZyYW1ld29ya3M7DQogICAgfQ0KICAgIGFzeW5jIF9nZXRBZGRpdGlvbmFsSGVhZGVycygpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICAvLyBBZGRpdGlvbmFsIGhlYWRlcnMgb24gZXZlcnkgcmVxdWVzdA0KICAgICAgICBjb25zdCBoZWFkZXJzID0gew0KICAgICAgICAgICAgWyJYLUNsaWVudC1WZXJzaW9uIiAvKiBIdHRwSGVhZGVyLlhfQ0xJRU5UX1ZFUlNJT04gKi9dOiB0aGlzLmNsaWVudFZlcnNpb24NCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHRoaXMuYXBwLm9wdGlvbnMuYXBwSWQpIHsNCiAgICAgICAgICAgIGhlYWRlcnNbIlgtRmlyZWJhc2UtZ21waWQiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9HTVBJRCAqL10gPSB0aGlzLmFwcC5vcHRpb25zLmFwcElkOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIHRoZSBoZWFydGJlYXQgc2VydmljZSBleGlzdHMsIGFkZCB0aGUgaGVhcnRiZWF0IHN0cmluZw0KICAgICAgICBjb25zdCBoZWFydGJlYXRzSGVhZGVyID0gYXdhaXQgKChfYSA9IHRoaXMuaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyDQogICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHsNCiAgICAgICAgICAgIG9wdGlvbmFsOiB0cnVlDQogICAgICAgIH0pKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0SGVhcnRiZWF0c0hlYWRlcigpKTsNCiAgICAgICAgaWYgKGhlYXJ0YmVhdHNIZWFkZXIpIHsNCiAgICAgICAgICAgIGhlYWRlcnNbIlgtRmlyZWJhc2UtQ2xpZW50IiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfQ0xJRU5UICovXSA9IGhlYXJ0YmVhdHNIZWFkZXI7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgdGhlIEFwcCBDaGVjayBzZXJ2aWNlIGV4aXN0cywgYWRkIHRoZSBBcHAgQ2hlY2sgdG9rZW4gaW4gdGhlIGhlYWRlcnMNCiAgICAgICAgY29uc3QgYXBwQ2hlY2tUb2tlbiA9IGF3YWl0IHRoaXMuX2dldEFwcENoZWNrVG9rZW4oKTsNCiAgICAgICAgaWYgKGFwcENoZWNrVG9rZW4pIHsNCiAgICAgICAgICAgIGhlYWRlcnNbIlgtRmlyZWJhc2UtQXBwQ2hlY2siIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9BUFBfQ0hFQ0sgKi9dID0gYXBwQ2hlY2tUb2tlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaGVhZGVyczsNCiAgICB9DQogICAgYXN5bmMgX2dldEFwcENoZWNrVG9rZW4oKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgY29uc3QgYXBwQ2hlY2tUb2tlblJlc3VsdCA9IGF3YWl0ICgoX2EgPSB0aGlzLmFwcENoZWNrU2VydmljZVByb3ZpZGVyDQogICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRUb2tlbigpKTsNCiAgICAgICAgaWYgKGFwcENoZWNrVG9rZW5SZXN1bHQgPT09IG51bGwgfHwgYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tUb2tlblJlc3VsdC5lcnJvcikgew0KICAgICAgICAgICAgLy8gQ29udGV4dDogYXBwQ2hlY2suZ2V0VG9rZW4oKSB3aWxsIG5ldmVyIHRocm93IGV2ZW4gaWYgYW4gZXJyb3IgaGFwcGVuZWQuDQogICAgICAgICAgICAvLyBJbiB0aGUgZXJyb3IgY2FzZSwgYSBkdW1teSB0b2tlbiB3aWxsIGJlIHJldHVybmVkIGFsb25nIHdpdGggYW4gZXJyb3IgZmllbGQgZGVzY3JpYmluZw0KICAgICAgICAgICAgLy8gdGhlIGVycm9yLiBJbiBnZW5lcmFsLCB3ZSBzaG91bGRuJ3QgY2FyZSBhYm91dCB0aGUgZXJyb3IgY29uZGl0aW9uIGFuZCBqdXN0IHVzZQ0KICAgICAgICAgICAgLy8gdGhlIHRva2VuIChhY3R1YWwgb3IgZHVtbXkpIHRvIHNlbmQgcmVxdWVzdHMuDQogICAgICAgICAgICBfbG9nV2FybihgRXJyb3Igd2hpbGUgcmV0cmlldmluZyBBcHAgQ2hlY2sgdG9rZW46ICR7YXBwQ2hlY2tUb2tlblJlc3VsdC5lcnJvcn1gKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gbnVsbCB8fCBhcHBDaGVja1Rva2VuUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Rva2VuUmVzdWx0LnRva2VuOw0KICAgIH0NCn0NCi8qKg0KICogTWV0aG9kIHRvIGJlIHVzZWQgdG8gY2FzdCBkb3duIHRvIG91ciBwcml2YXRlIGltcGxtZW50YXRpb24gb2YgQXV0aC4NCiAqIEl0IHdpbGwgYWxzbyBoYW5kbGUgdW53cmFwcGluZyBmcm9tIHRoZSBjb21wYXQgdHlwZSBpZiBuZWNlc3NhcnkNCiAqDQogKiBAcGFyYW0gYXV0aCBBdXRoIG9iamVjdCBwYXNzZWQgaW4gZnJvbSBkZXZlbG9wZXINCiAqLw0KZnVuY3Rpb24gX2Nhc3RBdXRoKGF1dGgpIHsNCiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpOw0KfQ0KLyoqIEhlbHBlciBjbGFzcyB0byB3cmFwIHN1YnNjcmliZXIgbG9naWMgKi8NCmNsYXNzIFN1YnNjcmlwdGlvbiB7DQogICAgY29uc3RydWN0b3IoYXV0aCkgew0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5hZGRPYnNlcnZlciA9IGNyZWF0ZVN1YnNjcmliZShvYnNlcnZlciA9PiAodGhpcy5vYnNlcnZlciA9IG9ic2VydmVyKSk7DQogICAgfQ0KICAgIGdldCBuZXh0KCkgew0KICAgICAgICBfYXNzZXJ0KHRoaXMub2JzZXJ2ZXIsIHRoaXMuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIubmV4dC5iaW5kKHRoaXMub2JzZXJ2ZXIpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGdldFNjcmlwdFBhcmVudEVsZW1lbnQoKSB7DQogICAgdmFyIF9hLCBfYjsNCiAgICByZXR1cm4gKF9iID0gKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBkb2N1bWVudDsNCn0NCmZ1bmN0aW9uIF9sb2FkSlModXJsKSB7DQogICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIHRpbWVvdXQgc3VwcG9ydCAmIGNhbmNlbGxhdGlvbg0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKTsNCiAgICAgICAgZWwub25sb2FkID0gcmVzb2x2ZTsNCiAgICAgICAgZWwub25lcnJvciA9IGUgPT4gew0KICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBfY3JlYXRlRXJyb3IoImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgICAgIGVycm9yLmN1c3RvbURhdGEgPSBlOw0KICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgfTsNCiAgICAgICAgZWwudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KICAgICAgICBlbC5jaGFyc2V0ID0gJ1VURi04JzsNCiAgICAgICAgZ2V0U2NyaXB0UGFyZW50RWxlbWVudCgpLmFwcGVuZENoaWxkKGVsKTsNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIF9nZW5lcmF0ZUNhbGxiYWNrTmFtZShwcmVmaXgpIHsNCiAgICByZXR1cm4gYF9fJHtwcmVmaXh9JHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKX1gOw0KfQoKLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0cyAqLw0KY29uc3QgUkVDQVBUQ0hBX0VOVEVSUFJJU0VfVVJMID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2VudGVycHJpc2UuanM/cmVuZGVyPSc7DQpjb25zdCBSRUNBUFRDSEFfRU5URVJQUklTRV9WRVJJRklFUl9UWVBFID0gJ3JlY2FwdGNoYS1lbnRlcnByaXNlJzsNCmNvbnN0IEZBS0VfVE9LRU4gPSAnTk9fUkVDQVBUQ0hBJzsNCmNsYXNzIFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllciB7DQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0gYXV0aEV4dGVybiAtIFRoZSBjb3JyZXNwb25kaW5nIEZpcmViYXNlIHtAbGluayBBdXRofSBpbnN0YW5jZS4NCiAgICAgKg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGF1dGhFeHRlcm4pIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIElkZW50aWZpZXMgdGhlIHR5cGUgb2YgYXBwbGljYXRpb24gdmVyaWZpZXIgKGUuZy4gInJlY2FwdGNoYS1lbnRlcnByaXNlIikuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnR5cGUgPSBSRUNBUFRDSEFfRU5URVJQUklTRV9WRVJJRklFUl9UWVBFOw0KICAgICAgICB0aGlzLmF1dGggPSBfY2FzdEF1dGgoYXV0aEV4dGVybik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4ZWN1dGVzIHRoZSB2ZXJpZmljYXRpb24gcHJvY2Vzcy4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIEEgUHJvbWlzZSBmb3IgYSB0b2tlbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGFzc2VydCB0aGUgdmFsaWRpdHkgb2YgYSByZXF1ZXN0Lg0KICAgICAqLw0KICAgIGFzeW5jIHZlcmlmeShhY3Rpb24gPSAndmVyaWZ5JywgZm9yY2VSZWZyZXNoID0gZmFsc2UpIHsNCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gcmV0cmlldmVTaXRlS2V5KGF1dGgpIHsNCiAgICAgICAgICAgIGlmICghZm9yY2VSZWZyZXNoKSB7DQogICAgICAgICAgICAgICAgaWYgKGF1dGgudGVuYW50SWQgPT0gbnVsbCAmJiBhdXRoLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhdXRoLl9hZ2VudFJlY2FwdGNoYUNvbmZpZy5zaXRlS2V5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYXV0aC50ZW5hbnRJZCAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgICAgIGF1dGguX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbYXV0aC50ZW5hbnRJZF0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoLnRlbmFudElkXS5zaXRlS2V5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgZ2V0UmVjYXB0Y2hhQ29uZmlnKGF1dGgsIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogIkNMSUVOVF9UWVBFX1dFQiIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sDQogICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICJSRUNBUFRDSEFfRU5URVJQUklTRSIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVjYXB0Y2hhS2V5ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlY2FwdGNoYSBFbnRlcnByaXNlIHNpdGUga2V5IHVuZGVmaW5lZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IG5ldyBSZWNhcHRjaGFDb25maWcocmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgudGVuYW50SWQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGguX2FnZW50UmVjYXB0Y2hhQ29uZmlnID0gY29uZmlnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoLnRlbmFudElkXSA9IGNvbmZpZzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGNvbmZpZy5zaXRlS2V5KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICAgICAgY29uc3QgZ3JlY2FwdGNoYSA9IHdpbmRvdy5ncmVjYXB0Y2hhOw0KICAgICAgICAgICAgaWYgKGlzRW50ZXJwcmlzZShncmVjYXB0Y2hhKSkgew0KICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZS5yZWFkeSgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmV4ZWN1dGUoc2l0ZUtleSwgeyBhY3Rpb24gfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHRva2VuID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoRkFLRV9UT0tFTik7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmVqZWN0KEVycm9yKCdObyByZUNBUFRDSEEgZW50ZXJwcmlzZSBzY3JpcHQgbG9hZGVkLicpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgcmV0cmlldmVTaXRlS2V5KHRoaXMuYXV0aCkNCiAgICAgICAgICAgICAgICAudGhlbihzaXRlS2V5ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiBpc0VudGVycHJpc2Uod2luZG93LmdyZWNhcHRjaGEpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHJpZXZlUmVjYXB0Y2hhVG9rZW4oc2l0ZUtleSwgcmVzb2x2ZSwgcmVqZWN0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUmVjYXB0Y2hhVmVyaWZpZXIgaXMgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3NlcicpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBfbG9hZEpTKFJFQ0FQVENIQV9FTlRFUlBSSVNFX1VSTCArIHNpdGVLZXkpDQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCk7DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KYXN5bmMgZnVuY3Rpb24gaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGgsIHJlcXVlc3QsIGFjdGlvbiwgY2FwdGNoYVJlc3AgPSBmYWxzZSkgew0KICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllcihhdXRoKTsNCiAgICBsZXQgY2FwdGNoYVJlc3BvbnNlOw0KICAgIHRyeSB7DQogICAgICAgIGNhcHRjaGFSZXNwb25zZSA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeShhY3Rpb24pOw0KICAgIH0NCiAgICBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY2FwdGNoYVJlc3BvbnNlID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5KGFjdGlvbiwgdHJ1ZSk7DQogICAgfQ0KICAgIGNvbnN0IG5ld1JlcXVlc3QgPSBPYmplY3QuYXNzaWduKHt9LCByZXF1ZXN0KTsNCiAgICBpZiAoIWNhcHRjaGFSZXNwKSB7DQogICAgICAgIE9iamVjdC5hc3NpZ24obmV3UmVxdWVzdCwgeyBjYXB0Y2hhUmVzcG9uc2UgfSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgJ2NhcHRjaGFSZXNwJzogY2FwdGNoYVJlc3BvbnNlIH0pOw0KICAgIH0NCiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgJ2NsaWVudFR5cGUnOiAiQ0xJRU5UX1RZUEVfV0VCIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLyB9KTsNCiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsNCiAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiAiUkVDQVBUQ0hBX0VOVEVSUFJJU0UiIC8qIFJlY2FwdGNoYVZlcnNpb24uRU5URVJQUklTRSAqLw0KICAgIH0pOw0KICAgIHJldHVybiBuZXdSZXF1ZXN0Ow0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogSW5pdGlhbGl6ZXMgYW4ge0BsaW5rIEF1dGh9IGluc3RhbmNlIHdpdGggZmluZS1ncmFpbmVkIGNvbnRyb2wgb3Zlcg0KICoge0BsaW5rIERlcGVuZGVuY2llc30uDQogKg0KICogQHJlbWFya3MNCiAqDQogKiBUaGlzIGZ1bmN0aW9uIGFsbG93cyBtb3JlIGNvbnRyb2wgb3ZlciB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIHRoYW4NCiAqIHtAbGluayBnZXRBdXRofS4gYGdldEF1dGhgIHVzZXMgcGxhdGZvcm0tc3BlY2lmaWMgZGVmYXVsdHMgdG8gc3VwcGx5DQogKiB0aGUge0BsaW5rIERlcGVuZGVuY2llc30uIEluIGdlbmVyYWwsIGBnZXRBdXRoYCBpcyB0aGUgZWFzaWVzdCB3YXkgdG8NCiAqIGluaXRpYWxpemUgQXV0aCBhbmQgd29ya3MgZm9yIG1vc3QgdXNlIGNhc2VzLiBVc2UgYGluaXRpYWxpemVBdXRoYCBpZiB5b3UNCiAqIG5lZWQgY29udHJvbCBvdmVyIHdoaWNoIHBlcnNpc3RlbmNlIGxheWVyIGlzIHVzZWQsIG9yIHRvIG1pbmltaXplIGJ1bmRsZQ0KICogc2l6ZSBpZiB5b3UncmUgbm90IHVzaW5nIGVpdGhlciBgc2lnbkluV2l0aFBvcHVwYCBvciBgc2lnbkluV2l0aFJlZGlyZWN0YC4NCiAqDQogKiBGb3IgZXhhbXBsZSwgaWYgeW91ciBhcHAgb25seSB1c2VzIGFub255bW91cyBhY2NvdW50cyBhbmQgeW91IG9ubHkgd2FudA0KICogYWNjb3VudHMgc2F2ZWQgZm9yIHRoZSBjdXJyZW50IHNlc3Npb24sIGluaXRpYWxpemUgYEF1dGhgIHdpdGg6DQogKg0KICogYGBganMNCiAqIGNvbnN0IGF1dGggPSBpbml0aWFsaXplQXV0aChhcHAsIHsNCiAqICAgcGVyc2lzdGVuY2U6IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UsDQogKiAgIHBvcHVwUmVkaXJlY3RSZXNvbHZlcjogdW5kZWZpbmVkLA0KICogfSk7DQogKiBgYGANCiAqDQogKiBAcHVibGljDQogKi8NCmZ1bmN0aW9uIGluaXRpYWxpemVBdXRoKGFwcCwgZGVwcykgew0KICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2F1dGgnKTsNCiAgICBpZiAocHJvdmlkZXIuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgIGNvbnN0IGF1dGggPSBwcm92aWRlci5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgY29uc3QgaW5pdGlhbE9wdGlvbnMgPSBwcm92aWRlci5nZXRPcHRpb25zKCk7DQogICAgICAgIGlmIChkZWVwRXF1YWwoaW5pdGlhbE9wdGlvbnMsIGRlcHMgIT09IG51bGwgJiYgZGVwcyAhPT0gdm9pZCAwID8gZGVwcyA6IHt9KSkgew0KICAgICAgICAgICAgcmV0dXJuIGF1dGg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBfZmFpbChhdXRoLCAiYWxyZWFkeS1pbml0aWFsaXplZCIgLyogQXV0aEVycm9yQ29kZS5BTFJFQURZX0lOSVRJQUxJWkVEICovKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb25zdCBhdXRoID0gcHJvdmlkZXIuaW5pdGlhbGl6ZSh7IG9wdGlvbnM6IGRlcHMgfSk7DQogICAgcmV0dXJuIGF1dGg7DQp9DQpmdW5jdGlvbiBfaW5pdGlhbGl6ZUF1dGhJbnN0YW5jZShhdXRoLCBkZXBzKSB7DQogICAgY29uc3QgcGVyc2lzdGVuY2UgPSAoZGVwcyA9PT0gbnVsbCB8fCBkZXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXBzLnBlcnNpc3RlbmNlKSB8fCBbXTsNCiAgICBjb25zdCBoaWVyYXJjaHkgPSAoQXJyYXkuaXNBcnJheShwZXJzaXN0ZW5jZSkgPyBwZXJzaXN0ZW5jZSA6IFtwZXJzaXN0ZW5jZV0pLm1hcChfZ2V0SW5zdGFuY2UpOw0KICAgIGlmIChkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMuZXJyb3JNYXApIHsNCiAgICAgICAgYXV0aC5fdXBkYXRlRXJyb3JNYXAoZGVwcy5lcnJvck1hcCk7DQogICAgfQ0KICAgIC8vIFRoaXMgcHJvbWlzZSBpcyBpbnRlbmRlZCB0byBmbG9hdDsgYXV0aCBpbml0aWFsaXphdGlvbiBoYXBwZW5zIGluIHRoZQ0KICAgIC8vIGJhY2tncm91bmQsIG1lYW53aGlsZSB0aGUgYXV0aCBvYmplY3QgbWF5IGJlIHVzZWQgYnkgdGhlIGFwcC4NCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgYXV0aC5faW5pdGlhbGl6ZVdpdGhQZXJzaXN0ZW5jZShoaWVyYXJjaHksIGRlcHMgPT09IG51bGwgfHwgZGVwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGVwcy5wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpOw0KfQoKLyoqDQogKiBDaGFuZ2VzIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdG8gY29tbXVuaWNhdGUgd2l0aCB0aGUgRmlyZWJhc2UgQXV0aCBFbXVsYXRvciwgaW5zdGVhZCBvZiBwcm9kdWN0aW9uDQogKiBGaXJlYmFzZSBBdXRoIHNlcnZpY2VzLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIG11c3QgYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgaW1tZWRpYXRlbHkgZm9sbG93aW5nIHRoZSBmaXJzdCBjYWxsIHRvDQogKiB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9LiAgRG8gbm90IHVzZSB3aXRoIHByb2R1Y3Rpb24gY3JlZGVudGlhbHMgYXMgZW11bGF0b3INCiAqIHRyYWZmaWMgaXMgbm90IGVuY3J5cHRlZC4NCiAqDQogKg0KICogQGV4YW1wbGUNCiAqIGBgYGphdmFzY3JpcHQNCiAqIGNvbm5lY3RBdXRoRW11bGF0b3IoYXV0aCwgJ2h0dHA6Ly8xMjcuMC4wLjE6OTA5OScsIHsgZGlzYWJsZVdhcm5pbmdzOiB0cnVlIH0pOw0KICogYGBgDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIHVybCAtIFRoZSBVUkwgYXQgd2hpY2ggdGhlIGVtdWxhdG9yIGlzIHJ1bm5pbmcgKGVnLCAnaHR0cDovL2xvY2FsaG9zdDo5MDk5JykuDQogKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsLiBgb3B0aW9ucy5kaXNhYmxlV2FybmluZ3NgIGRlZmF1bHRzIHRvIGBmYWxzZWAuIFNldCBpdCB0bw0KICogYHRydWVgIHRvIGRpc2FibGUgdGhlIHdhcm5pbmcgYmFubmVyIGF0dGFjaGVkIHRvIHRoZSBET00uDQogKg0KICogQHB1YmxpYw0KICovDQpmdW5jdGlvbiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsIHVybCwgb3B0aW9ucykgew0KICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTsNCiAgICBfYXNzZXJ0KGF1dGhJbnRlcm5hbC5fY2FuSW5pdEVtdWxhdG9yLCBhdXRoSW50ZXJuYWwsICJlbXVsYXRvci1jb25maWctZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLkVNVUxBVE9SX0NPTkZJR19GQUlMRUQgKi8pOw0KICAgIF9hc3NlcnQoL15odHRwcz86XC9cLy8udGVzdCh1cmwpLCBhdXRoSW50ZXJuYWwsICJpbnZhbGlkLWVtdWxhdG9yLXNjaGVtZSIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0VNVUxBVE9SX1NDSEVNRSAqLyk7DQogICAgY29uc3QgZGlzYWJsZVdhcm5pbmdzID0gISEob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmRpc2FibGVXYXJuaW5ncyk7DQogICAgY29uc3QgcHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2wkMSh1cmwpOw0KICAgIGNvbnN0IHsgaG9zdCwgcG9ydCB9ID0gZXh0cmFjdEhvc3RBbmRQb3J0KHVybCk7DQogICAgY29uc3QgcG9ydFN0ciA9IHBvcnQgPT09IG51bGwgPyAnJyA6IGA6JHtwb3J0fWA7DQogICAgLy8gQWx3YXlzIHJlcGxhY2UgcGF0aCB3aXRoICIvIiAoZXZlbiBpZiBpbnB1dCB1cmwgaGFkIG5vIHBhdGggYXQgYWxsLCBvciBoYWQgYSBkaWZmZXJlbnQgb25lKS4NCiAgICBhdXRoSW50ZXJuYWwuY29uZmlnLmVtdWxhdG9yID0geyB1cmw6IGAke3Byb3RvY29sfS8vJHtob3N0fSR7cG9ydFN0cn0vYCB9Ow0KICAgIGF1dGhJbnRlcm5hbC5zZXR0aW5ncy5hcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3RpbmcgPSB0cnVlOw0KICAgIGF1dGhJbnRlcm5hbC5lbXVsYXRvckNvbmZpZyA9IE9iamVjdC5mcmVlemUoew0KICAgICAgICBob3N0LA0KICAgICAgICBwb3J0LA0KICAgICAgICBwcm90b2NvbDogcHJvdG9jb2wucmVwbGFjZSgnOicsICcnKSwNCiAgICAgICAgb3B0aW9uczogT2JqZWN0LmZyZWV6ZSh7IGRpc2FibGVXYXJuaW5ncyB9KQ0KICAgIH0pOw0KICAgIGlmICghZGlzYWJsZVdhcm5pbmdzKSB7DQogICAgICAgIGVtaXRFbXVsYXRvcldhcm5pbmcoKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBleHRyYWN0UHJvdG9jb2wkMSh1cmwpIHsNCiAgICBjb25zdCBwcm90b2NvbEVuZCA9IHVybC5pbmRleE9mKCc6Jyk7DQogICAgcmV0dXJuIHByb3RvY29sRW5kIDwgMCA/ICcnIDogdXJsLnN1YnN0cigwLCBwcm90b2NvbEVuZCArIDEpOw0KfQ0KZnVuY3Rpb24gZXh0cmFjdEhvc3RBbmRQb3J0KHVybCkgew0KICAgIGNvbnN0IHByb3RvY29sID0gZXh0cmFjdFByb3RvY29sJDEodXJsKTsNCiAgICBjb25zdCBhdXRob3JpdHkgPSAvKFwvXC8pPyhbXj8jL10rKS8uZXhlYyh1cmwuc3Vic3RyKHByb3RvY29sLmxlbmd0aCkpOyAvLyBCZXR3ZWVuIC8vIGFuZCAvLCA/IG9yICMuDQogICAgaWYgKCFhdXRob3JpdHkpIHsNCiAgICAgICAgcmV0dXJuIHsgaG9zdDogJycsIHBvcnQ6IG51bGwgfTsNCiAgICB9DQogICAgY29uc3QgaG9zdEFuZFBvcnQgPSBhdXRob3JpdHlbMl0uc3BsaXQoJ0AnKS5wb3AoKSB8fCAnJzsgLy8gU3RyaXAgb3V0ICJ1c2VybmFtZTpwYXNzd29yZEAiLg0KICAgIGNvbnN0IGJyYWNrZXRlZElQdjYgPSAvXihcW1teXF1dK1xdKSg6fCQpLy5leGVjKGhvc3RBbmRQb3J0KTsNCiAgICBpZiAoYnJhY2tldGVkSVB2Nikgew0KICAgICAgICBjb25zdCBob3N0ID0gYnJhY2tldGVkSVB2NlsxXTsNCiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KGhvc3RBbmRQb3J0LnN1YnN0cihob3N0Lmxlbmd0aCArIDEpKSB9Ow0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgW2hvc3QsIHBvcnRdID0gaG9zdEFuZFBvcnQuc3BsaXQoJzonKTsNCiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KHBvcnQpIH07DQogICAgfQ0KfQ0KZnVuY3Rpb24gcGFyc2VQb3J0KHBvcnRTdHIpIHsNCiAgICBpZiAoIXBvcnRTdHIpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGNvbnN0IHBvcnQgPSBOdW1iZXIocG9ydFN0cik7DQogICAgaWYgKGlzTmFOKHBvcnQpKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICByZXR1cm4gcG9ydDsNCn0NCmZ1bmN0aW9uIGVtaXRFbXVsYXRvcldhcm5pbmcoKSB7DQogICAgZnVuY3Rpb24gYXR0YWNoQmFubmVyKCkgew0KICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsNCiAgICAgICAgY29uc3Qgc3R5ID0gZWwuc3R5bGU7DQogICAgICAgIGVsLmlubmVyVGV4dCA9DQogICAgICAgICAgICAnUnVubmluZyBpbiBlbXVsYXRvciBtb2RlLiBEbyBub3QgdXNlIHdpdGggcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nOw0KICAgICAgICBzdHkucG9zaXRpb24gPSAnZml4ZWQnOw0KICAgICAgICBzdHkud2lkdGggPSAnMTAwJSc7DQogICAgICAgIHN0eS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7DQogICAgICAgIHN0eS5ib3JkZXIgPSAnLjFlbSBzb2xpZCAjMDAwMDAwJzsNCiAgICAgICAgc3R5LmNvbG9yID0gJyNiNTAwMDAnOw0KICAgICAgICBzdHkuYm90dG9tID0gJzBweCc7DQogICAgICAgIHN0eS5sZWZ0ID0gJzBweCc7DQogICAgICAgIHN0eS5tYXJnaW4gPSAnMHB4JzsNCiAgICAgICAgc3R5LnpJbmRleCA9ICcxMDAwMCc7DQogICAgICAgIHN0eS50ZXh0QWxpZ24gPSAnY2VudGVyJzsNCiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnZmlyZWJhc2UtZW11bGF0b3Itd2FybmluZycpOw0KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29uc29sZS5pbmZvID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGNvbnNvbGUuaW5mbygnV0FSTklORzogWW91IGFyZSB1c2luZyB0aGUgQXV0aCBFbXVsYXRvciwnICsNCiAgICAgICAgICAgICcgd2hpY2ggaXMgaW50ZW5kZWQgZm9yIGxvY2FsIHRlc3Rpbmcgb25seS4gIERvIG5vdCB1c2Ugd2l0aCcgKw0KICAgICAgICAgICAgJyBwcm9kdWN0aW9uIGNyZWRlbnRpYWxzLicpOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2xvYWRpbmcnKSB7DQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGF0dGFjaEJhbm5lcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBhdHRhY2hCYW5uZXIoKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogSW50ZXJmYWNlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkgYW4ge0BsaW5rIEF1dGhQcm92aWRlcn0uDQogKg0KICogQHJlbWFya3MNCiAqIEltcGxlbWVudGF0aW9ucyBzcGVjaWZ5IHRoZSBkZXRhaWxzIGFib3V0IGVhY2ggYXV0aCBwcm92aWRlcidzIGNyZWRlbnRpYWwgcmVxdWlyZW1lbnRzLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgQXV0aENyZWRlbnRpYWwgew0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBjb25zdHJ1Y3RvcigNCiAgICAvKioNCiAgICAgKiBUaGUgYXV0aGVudGljYXRpb24gcHJvdmlkZXIgSUQgZm9yIHRoZSBjcmVkZW50aWFsLg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBGb3IgZXhhbXBsZSwgJ2ZhY2Vib29rLmNvbScsIG9yICdnb29nbGUuY29tJy4NCiAgICAgKi8NCiAgICBwcm92aWRlcklkLCANCiAgICAvKioNCiAgICAgKiBUaGUgYXV0aGVudGljYXRpb24gc2lnbiBpbiBtZXRob2QgZm9yIHRoZSBjcmVkZW50aWFsLg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBGb3IgZXhhbXBsZSwge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfUEFTU1dPUkQsIG9yDQogICAgICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgc2lnbi1pbiBtZXRob2QNCiAgICAgKiBpZGVudGlmaWVyIGFzIHJldHVybmVkIGluIHtAbGluayBmZXRjaFNpZ25Jbk1ldGhvZHNGb3JFbWFpbH0uDQogICAgICovDQogICAgc2lnbkluTWV0aG9kKSB7DQogICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IHByb3ZpZGVySWQ7DQogICAgICAgIHRoaXMuc2lnbkluTWV0aG9kID0gc2lnbkluTWV0aG9kOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0Lg0KICAgICAqLw0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgnbm90IGltcGxlbWVudGVkJyk7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKF9hdXRoKSB7DQogICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2xpbmtUb0lkVG9rZW4oX2F1dGgsIF9pZFRva2VuKSB7DQogICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihfYXV0aCkgew0KICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTsNCiAgICB9DQp9CmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUVtYWlsUGFzc3dvcmQoYXV0aCwgcmVxdWVzdCkgew0KICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgIlBPU1QiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgIi92MS9hY2NvdW50czp1cGRhdGUiIC8qIEVuZHBvaW50LlNFVF9BQ0NPVU5UX0lORk8gKi8sIHJlcXVlc3QpOw0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhQYXNzd29yZChhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQYXNzd29yZCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX1BBU1NXT1JEICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmskMShhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOnNpZ25JbldpdGhFbWFpbExpbmsiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9FTUFJTF9MSU5LICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQ0KYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsTGlua0ZvckxpbmtpbmcoYXV0aCwgcmVxdWVzdCkgew0KICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgIlBPU1QiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgIi92MS9hY2NvdW50czpzaWduSW5XaXRoRW1haWxMaW5rIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfRU1BSUxfTElOSyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogSW50ZXJmYWNlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSBmb3INCiAqIHtAbGluayBQcm92aWRlcklkfS5QQVNTV09SRA0KICoNCiAqIEByZW1hcmtzDQogKiBDb3ZlcnMgYm90aCB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9QQVNTV09SRCBhbmQNCiAqIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX0xJTksuDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBFbWFpbEF1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwgew0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBjb25zdHJ1Y3RvcigNCiAgICAvKiogQGludGVybmFsICovDQogICAgX2VtYWlsLCANCiAgICAvKiogQGludGVybmFsICovDQogICAgX3Bhc3N3b3JkLCBzaWduSW5NZXRob2QsIA0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfdGVuYW50SWQgPSBudWxsKSB7DQogICAgICAgIHN1cGVyKCJwYXNzd29yZCIgLyogUHJvdmlkZXJJZC5QQVNTV09SRCAqLywgc2lnbkluTWV0aG9kKTsNCiAgICAgICAgdGhpcy5fZW1haWwgPSBfZW1haWw7DQogICAgICAgIHRoaXMuX3Bhc3N3b3JkID0gX3Bhc3N3b3JkOw0KICAgICAgICB0aGlzLl90ZW5hbnRJZCA9IF90ZW5hbnRJZDsNCiAgICB9DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIHN0YXRpYyBfZnJvbUVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKSB7DQogICAgICAgIHJldHVybiBuZXcgRW1haWxBdXRoQ3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQsICJwYXNzd29yZCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovKTsNCiAgICB9DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIHN0YXRpYyBfZnJvbUVtYWlsQW5kQ29kZShlbWFpbCwgb29iQ29kZSwgdGVuYW50SWQgPSBudWxsKSB7DQogICAgICAgIHJldHVybiBuZXcgRW1haWxBdXRoQ3JlZGVudGlhbChlbWFpbCwgb29iQ29kZSwgImVtYWlsTGluayIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi8sIHRlbmFudElkKTsNCiAgICB9DQogICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICovDQogICAgdG9KU09OKCkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLA0KICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX3Bhc3N3b3JkLA0KICAgICAgICAgICAgc2lnbkluTWV0aG9kOiB0aGlzLnNpZ25Jbk1ldGhvZCwNCiAgICAgICAgICAgIHRlbmFudElkOiB0aGlzLl90ZW5hbnRJZA0KICAgICAgICB9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTdGF0aWMgbWV0aG9kIHRvIGRlc2VyaWFsaXplIGEgSlNPTiByZXByZXNlbnRhdGlvbiBvZiBhbiBvYmplY3QgaW50byBhbiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBqc29uIC0gRWl0aGVyIGBvYmplY3RgIG9yIHRoZSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0LiBXaGVuIHN0cmluZyBpcw0KICAgICAqIHByb3ZpZGVkLCBgSlNPTi5wYXJzZWAgd291bGQgYmUgY2FsbGVkIGZpcnN0Lg0KICAgICAqDQogICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0sIG51bGwgaXMgcmV0dXJuZWQuDQogICAgICovDQogICAgc3RhdGljIGZyb21KU09OKGpzb24pIHsNCiAgICAgICAgY29uc3Qgb2JqID0gdHlwZW9mIGpzb24gPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShqc29uKSA6IGpzb247DQogICAgICAgIGlmICgob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2JqLmVtYWlsKSAmJiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2JqLnBhc3N3b3JkKSkgew0KICAgICAgICAgICAgaWYgKG9iai5zaWduSW5NZXRob2QgPT09ICJwYXNzd29yZCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21FbWFpbEFuZFBhc3N3b3JkKG9iai5lbWFpbCwgb2JqLnBhc3N3b3JkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG9iai5zaWduSW5NZXRob2QgPT09ICJlbWFpbExpbmsiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21FbWFpbEFuZENvZGUob2JqLmVtYWlsLCBvYmoucGFzc3dvcmQsIG9iai50ZW5hbnRJZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBhc3luYyBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBzd2l0Y2ggKHRoaXMuc2lnbkluTWV0aG9kKSB7DQogICAgICAgICAgICBjYXNlICJwYXNzd29yZCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovOg0KICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsDQogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9wYXNzd29yZCwNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogIkNMSUVOVF9UWVBFX1dFQiIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGlmICgoX2EgPSBhdXRoLl9nZXRSZWNhcHRjaGFDb25maWcoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVtYWlsUGFzc3dvcmRFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RXaXRoUmVjYXB0Y2hhID0gYXdhaXQgaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGgsIHJlcXVlc3QsICJzaWduSW5XaXRoUGFzc3dvcmQiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9JTl9XSVRIX1BBU1NXT1JEICovKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhQYXNzd29yZChhdXRoLCByZXF1ZXN0V2l0aFJlY2FwdGNoYSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpLmNhdGNoKGFzeW5jIChlcnJvcikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7Im1pc3NpbmctcmVjYXB0Y2hhLXRva2VuIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOICovfWApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2lnbi1pbiB3aXRoIGVtYWlsIGFkZHJlc3MgYW5kIHBhc3N3b3JkIGlzIHByb3RlY3RlZCBieSByZUNBUFRDSEEgZm9yIHRoaXMgcHJvamVjdC4gQXV0b21hdGljYWxseSB0cmlnZ2VyaW5nIHRoZSByZUNBUFRDSEEgZmxvdyBhbmQgcmVzdGFydGluZyB0aGUgc2lnbi1pbiBmbG93LicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RXaXRoUmVjYXB0Y2hhID0gYXdhaXQgaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGgsIHJlcXVlc3QsICJzaWduSW5XaXRoUGFzc3dvcmQiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9JTl9XSVRIX1BBU1NXT1JEICovKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3RXaXRoUmVjYXB0Y2hhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgImVtYWlsTGluayIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhFbWFpbExpbmskMShhdXRoLCB7DQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgb29iQ29kZTogdGhpcy5fcGFzc3dvcmQNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgYXN5bmMgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikgew0KICAgICAgICBzd2l0Y2ggKHRoaXMuc2lnbkluTWV0aG9kKSB7DQogICAgICAgICAgICBjYXNlICJwYXNzd29yZCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovOg0KICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHsNCiAgICAgICAgICAgICAgICAgICAgaWRUb2tlbiwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX3Bhc3N3b3JkDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjYXNlICJlbWFpbExpbmsiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovOg0KICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoRW1haWxMaW5rRm9yTGlua2luZyhhdXRoLCB7DQogICAgICAgICAgICAgICAgICAgIGlkVG9rZW4sDQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgb29iQ29kZTogdGhpcy5fcGFzc3dvcmQNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOnNpZ25JbldpdGhJZHAiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9JRFAgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBJRFBfUkVRVUVTVF9VUkkkMSA9ICdodHRwOi8vbG9jYWxob3N0JzsNCi8qKg0KICogUmVwcmVzZW50cyB0aGUgT0F1dGggY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9Lg0KICoNCiAqIEByZW1hcmtzDQogKiBJbXBsZW1lbnRhdGlvbnMgc3BlY2lmeSB0aGUgZGV0YWlscyBhYm91dCBlYWNoIGF1dGggcHJvdmlkZXIncyBjcmVkZW50aWFsIHJlcXVpcmVtZW50cy4NCiAqDQogKiBAcHVibGljDQogKi8NCmNsYXNzIE9BdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsNCiAgICAgICAgdGhpcy5wZW5kaW5nVG9rZW4gPSBudWxsOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgc3RhdGljIF9mcm9tUGFyYW1zKHBhcmFtcykgew0KICAgICAgICBjb25zdCBjcmVkID0gbmV3IE9BdXRoQ3JlZGVudGlhbChwYXJhbXMucHJvdmlkZXJJZCwgcGFyYW1zLnNpZ25Jbk1ldGhvZCk7DQogICAgICAgIGlmIChwYXJhbXMuaWRUb2tlbiB8fCBwYXJhbXMuYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgIC8vIE9BdXRoIDIgYW5kIGVpdGhlciBJRCB0b2tlbiBvciBhY2Nlc3MgdG9rZW4uDQogICAgICAgICAgICBpZiAocGFyYW1zLmlkVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjcmVkLmlkVG9rZW4gPSBwYXJhbXMuaWRUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXJhbXMuYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcGFyYW1zLmFjY2Vzc1Rva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gQWRkIG5vbmNlIGlmIGF2YWlsYWJsZSBhbmQgbm8gcGVuZGluZ1Rva2VuIGlzIHByZXNlbnQuDQogICAgICAgICAgICBpZiAocGFyYW1zLm5vbmNlICYmICFwYXJhbXMucGVuZGluZ1Rva2VuKSB7DQogICAgICAgICAgICAgICAgY3JlZC5ub25jZSA9IHBhcmFtcy5ub25jZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXJhbXMucGVuZGluZ1Rva2VuKSB7DQogICAgICAgICAgICAgICAgY3JlZC5wZW5kaW5nVG9rZW4gPSBwYXJhbXMucGVuZGluZ1Rva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhcmFtcy5vYXV0aFRva2VuICYmIHBhcmFtcy5vYXV0aFRva2VuU2VjcmV0KSB7DQogICAgICAgICAgICAvLyBPQXV0aCAxIGFuZCBPQXV0aCB0b2tlbiB3aXRoIHRva2VuIHNlY3JldA0KICAgICAgICAgICAgY3JlZC5hY2Nlc3NUb2tlbiA9IHBhcmFtcy5vYXV0aFRva2VuOw0KICAgICAgICAgICAgY3JlZC5zZWNyZXQgPSBwYXJhbXMub2F1dGhUb2tlblNlY3JldDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIF9mYWlsKCJhcmd1bWVudC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGNyZWQ7DQogICAgfQ0KICAgIC8qKiB7QGluaGVyaXRkb2MgQXV0aENyZWRlbnRpYWwudG9KU09OfSAgKi8NCiAgICB0b0pTT04oKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBpZFRva2VuOiB0aGlzLmlkVG9rZW4sDQogICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbiwNCiAgICAgICAgICAgIHNlY3JldDogdGhpcy5zZWNyZXQsDQogICAgICAgICAgICBub25jZTogdGhpcy5ub25jZSwNCiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wZW5kaW5nVG9rZW4sDQogICAgICAgICAgICBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWQsDQogICAgICAgICAgICBzaWduSW5NZXRob2Q6IHRoaXMuc2lnbkluTWV0aG9kDQogICAgICAgIH07DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuDQogICAgICoge0BsaW5rICBBdXRoQ3JlZGVudGlhbH0uDQogICAgICoNCiAgICAgKiBAcGFyYW0ganNvbiAtIElucHV0IGNhbiBiZSBlaXRoZXIgT2JqZWN0IG9yIHRoZSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0Lg0KICAgICAqIFdoZW4gc3RyaW5nIGlzIHByb3ZpZGVkLCBKU09OLnBhcnNlIHdvdWxkIGJlIGNhbGxlZCBmaXJzdC4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIElmIHRoZSBKU09OIGlucHV0IGRvZXMgbm90IHJlcHJlc2VudCBhbiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC4NCiAgICAgKi8NCiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikgew0KICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjsNCiAgICAgICAgY29uc3QgeyBwcm92aWRlcklkLCBzaWduSW5NZXRob2QgfSA9IG9iaiwgcmVzdCA9IF9fcmVzdChvYmosIFsicHJvdmlkZXJJZCIsICJzaWduSW5NZXRob2QiXSk7DQogICAgICAgIGlmICghcHJvdmlkZXJJZCB8fCAhc2lnbkluTWV0aG9kKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBjcmVkID0gbmV3IE9BdXRoQ3JlZGVudGlhbChwcm92aWRlcklkLCBzaWduSW5NZXRob2QpOw0KICAgICAgICBjcmVkLmlkVG9rZW4gPSByZXN0LmlkVG9rZW4gfHwgdW5kZWZpbmVkOw0KICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcmVzdC5hY2Nlc3NUb2tlbiB8fCB1bmRlZmluZWQ7DQogICAgICAgIGNyZWQuc2VjcmV0ID0gcmVzdC5zZWNyZXQ7DQogICAgICAgIGNyZWQubm9uY2UgPSByZXN0Lm5vbmNlOw0KICAgICAgICBjcmVkLnBlbmRpbmdUb2tlbiA9IHJlc3QucGVuZGluZ1Rva2VuIHx8IG51bGw7DQogICAgICAgIHJldHVybiBjcmVkOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2dldElkVG9rZW5SZXNwb25zZShhdXRoKSB7DQogICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpOw0KICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTsNCiAgICB9DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7DQogICAgICAgIHJlcXVlc3QuaWRUb2tlbiA9IGlkVG9rZW47DQogICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7DQogICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpOw0KICAgICAgICByZXF1ZXN0LmF1dG9DcmVhdGUgPSBmYWxzZTsNCiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7DQogICAgfQ0KICAgIGJ1aWxkUmVxdWVzdCgpIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsNCiAgICAgICAgICAgIHJlcXVlc3RVcmk6IElEUF9SRVFVRVNUX1VSSSQxLA0KICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1Rva2VuKSB7DQogICAgICAgICAgICByZXF1ZXN0LnBlbmRpbmdUb2tlbiA9IHRoaXMucGVuZGluZ1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgcG9zdEJvZHkgPSB7fTsNCiAgICAgICAgICAgIGlmICh0aGlzLmlkVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnaWRfdG9rZW4nXSA9IHRoaXMuaWRUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICAgICAgcG9zdEJvZHlbJ2FjY2Vzc190b2tlbiddID0gdGhpcy5hY2Nlc3NUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLnNlY3JldCkgew0KICAgICAgICAgICAgICAgIHBvc3RCb2R5WydvYXV0aF90b2tlbl9zZWNyZXQnXSA9IHRoaXMuc2VjcmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcG9zdEJvZHlbJ3Byb3ZpZGVySWQnXSA9IHRoaXMucHJvdmlkZXJJZDsNCiAgICAgICAgICAgIGlmICh0aGlzLm5vbmNlICYmICF0aGlzLnBlbmRpbmdUb2tlbikgew0KICAgICAgICAgICAgICAgIHBvc3RCb2R5Wydub25jZSddID0gdGhpcy5ub25jZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlcXVlc3QucG9zdEJvZHkgPSBxdWVyeXN0cmluZyQxKHBvc3RCb2R5KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVxdWVzdDsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIE1hcHMgdGhlIG1vZGUgc3RyaW5nIGluIGFjdGlvbiBjb2RlIFVSTCB0byBBY3Rpb24gQ29kZSBJbmZvIG9wZXJhdGlvbi4NCiAqDQogKiBAcGFyYW0gbW9kZQ0KICovDQpmdW5jdGlvbiBwYXJzZU1vZGUobW9kZSkgew0KICAgIHN3aXRjaCAobW9kZSkgew0KICAgICAgICBjYXNlICdyZWNvdmVyRW1haWwnOg0KICAgICAgICAgICAgcmV0dXJuICJSRUNPVkVSX0VNQUlMIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFQ09WRVJfRU1BSUwgKi87DQogICAgICAgIGNhc2UgJ3Jlc2V0UGFzc3dvcmQnOg0KICAgICAgICAgICAgcmV0dXJuICJQQVNTV09SRF9SRVNFVCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5QQVNTV09SRF9SRVNFVCAqLzsNCiAgICAgICAgY2FzZSAnc2lnbkluJzoNCiAgICAgICAgICAgIHJldHVybiAiRU1BSUxfU0lHTklOIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLkVNQUlMX1NJR05JTiAqLzsNCiAgICAgICAgY2FzZSAndmVyaWZ5RW1haWwnOg0KICAgICAgICAgICAgcmV0dXJuICJWRVJJRllfRU1BSUwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0VNQUlMICovOw0KICAgICAgICBjYXNlICd2ZXJpZnlBbmRDaGFuZ2VFbWFpbCc6DQogICAgICAgICAgICByZXR1cm4gIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMICovOw0KICAgICAgICBjYXNlICdyZXZlcnRTZWNvbmRGYWN0b3JBZGRpdGlvbic6DQogICAgICAgICAgICByZXR1cm4gIlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OICovOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KfQ0KLyoqDQogKiBIZWxwZXIgdG8gcGFyc2UgRkRMIGxpbmtzDQogKg0KICogQHBhcmFtIHVybA0KICovDQpmdW5jdGlvbiBwYXJzZURlZXBMaW5rKHVybCkgew0KICAgIGNvbnN0IGxpbmsgPSBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcodXJsKSlbJ2xpbmsnXTsNCiAgICAvLyBEb3VibGUgbGluayBjYXNlIChhdXRvbWF0aWMgcmVkaXJlY3QpLg0KICAgIGNvbnN0IGRvdWJsZURlZXBMaW5rID0gbGluaw0KICAgICAgICA/IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhsaW5rKSlbJ2RlZXBfbGlua19pZCddDQogICAgICAgIDogbnVsbDsNCiAgICAvLyBpT1MgY3VzdG9tIHNjaGVtZSBsaW5rcy4NCiAgICBjb25zdCBpT1NEZWVwTGluayA9IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpKVsnZGVlcF9saW5rX2lkJ107DQogICAgY29uc3QgaU9TRG91YmxlRGVlcExpbmsgPSBpT1NEZWVwTGluaw0KICAgICAgICA/IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhpT1NEZWVwTGluaykpWydsaW5rJ10NCiAgICAgICAgOiBudWxsOw0KICAgIHJldHVybiBpT1NEb3VibGVEZWVwTGluayB8fCBpT1NEZWVwTGluayB8fCBkb3VibGVEZWVwTGluayB8fCBsaW5rIHx8IHVybDsNCn0NCi8qKg0KICogQSB1dGlsaXR5IGNsYXNzIHRvIHBhcnNlIGVtYWlsIGFjdGlvbiBVUkxzIHN1Y2ggYXMgcGFzc3dvcmQgcmVzZXQsIGVtYWlsIHZlcmlmaWNhdGlvbiwNCiAqIGVtYWlsIGxpbmsgc2lnbiBpbiwgZXRjLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgQWN0aW9uQ29kZVVSTCB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGFjdGlvbkxpbmsgLSBUaGUgbGluayBmcm9tIHdoaWNoIHRvIGV4dHJhY3QgdGhlIFVSTC4NCiAgICAgKiBAcmV0dXJucyBUaGUge0BsaW5rIEFjdGlvbkNvZGVVUkx9IG9iamVjdCwgb3IgbnVsbCBpZiB0aGUgbGluayBpcyBpbnZhbGlkLg0KICAgICAqDQogICAgICogQGludGVybmFsDQogICAgICovDQogICAgY29uc3RydWN0b3IoYWN0aW9uTGluaykgew0KICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjsNCiAgICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGFjdGlvbkxpbmspKTsNCiAgICAgICAgY29uc3QgYXBpS2V5ID0gKF9hID0gc2VhcmNoUGFyYW1zWyJhcGlLZXkiIC8qIFF1ZXJ5RmllbGQuQVBJX0tFWSAqL10pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGw7DQogICAgICAgIGNvbnN0IGNvZGUgPSAoX2IgPSBzZWFyY2hQYXJhbXNbIm9vYkNvZGUiIC8qIFF1ZXJ5RmllbGQuQ09ERSAqL10pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7DQogICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IHBhcnNlTW9kZSgoX2MgPSBzZWFyY2hQYXJhbXNbIm1vZGUiIC8qIFF1ZXJ5RmllbGQuTU9ERSAqL10pICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IG51bGwpOw0KICAgICAgICAvLyBWYWxpZGF0ZSBBUEkga2V5LCBjb2RlIGFuZCBtb2RlLg0KICAgICAgICBfYXNzZXJ0KGFwaUtleSAmJiBjb2RlICYmIG9wZXJhdGlvbiwgImFyZ3VtZW50LWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTsNCiAgICAgICAgdGhpcy5hcGlLZXkgPSBhcGlLZXk7DQogICAgICAgIHRoaXMub3BlcmF0aW9uID0gb3BlcmF0aW9uOw0KICAgICAgICB0aGlzLmNvZGUgPSBjb2RlOw0KICAgICAgICB0aGlzLmNvbnRpbnVlVXJsID0gKF9kID0gc2VhcmNoUGFyYW1zWyJjb250aW51ZVVybCIgLyogUXVlcnlGaWVsZC5DT05USU5VRV9VUkwgKi9dKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBudWxsOw0KICAgICAgICB0aGlzLmxhbmd1YWdlQ29kZSA9IChfZSA9IHNlYXJjaFBhcmFtc1sibGFuZ3VhZ2VDb2RlIiAvKiBRdWVyeUZpZWxkLkxBTkdVQUdFX0NPREUgKi9dKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBudWxsOw0KICAgICAgICB0aGlzLnRlbmFudElkID0gKF9mID0gc2VhcmNoUGFyYW1zWyJ0ZW5hbnRJZCIgLyogUXVlcnlGaWVsZC5URU5BTlRfSUQgKi9dKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiBudWxsOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQYXJzZXMgdGhlIGVtYWlsIGFjdGlvbiBsaW5rIHN0cmluZyBhbmQgcmV0dXJucyBhbiB7QGxpbmsgQWN0aW9uQ29kZVVSTH0gaWYgdGhlIGxpbmsgaXMgdmFsaWQsDQogICAgICogb3RoZXJ3aXNlIHJldHVybnMgbnVsbC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBsaW5rICAtIFRoZSBlbWFpbCBhY3Rpb24gbGluayBzdHJpbmcuDQogICAgICogQHJldHVybnMgVGhlIHtAbGluayBBY3Rpb25Db2RlVVJMfSBvYmplY3QsIG9yIG51bGwgaWYgdGhlIGxpbmsgaXMgaW52YWxpZC4NCiAgICAgKg0KICAgICAqIEBwdWJsaWMNCiAgICAgKi8NCiAgICBzdGF0aWMgcGFyc2VMaW5rKGxpbmspIHsNCiAgICAgICAgY29uc3QgYWN0aW9uTGluayA9IHBhcnNlRGVlcExpbmsobGluayk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IEFjdGlvbkNvZGVVUkwoYWN0aW9uTGluayk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIHtAbGluayBFbWFpbEF1dGhDcmVkZW50aWFsfS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNsYXNzIEVtYWlsQXV0aFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gRW1haWxBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQ7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSB1c2luZyBhbiBlbWFpbCBhbmQgcGFzc3dvcmQuDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIGBgYGphdmFzY3JpcHQNCiAgICAgKiBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IEVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKTsNCiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGF1dGhDcmVkZW50aWFsKTsNCiAgICAgKiBgYGANCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICogYGBgamF2YXNjcmlwdA0KICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTsNCiAgICAgKiBgYGANCiAgICAgKg0KICAgICAqIEBwYXJhbSBlbWFpbCAtIEVtYWlsIGFkZHJlc3MuDQogICAgICogQHBhcmFtIHBhc3N3b3JkIC0gVXNlciBhY2NvdW50IHBhc3N3b3JkLg0KICAgICAqIEByZXR1cm5zIFRoZSBhdXRoIHByb3ZpZGVyIGNyZWRlbnRpYWwuDQogICAgICovDQogICAgc3RhdGljIGNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKSB7DQogICAgICAgIHJldHVybiBFbWFpbEF1dGhDcmVkZW50aWFsLl9mcm9tRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gdXNpbmcgYW4gZW1haWwgYW5kIGFuIGVtYWlsIGxpbmsgYWZ0ZXIgYSBzaWduIGluIHdpdGgNCiAgICAgKiBlbWFpbCBsaW5rIG9wZXJhdGlvbi4NCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICogYGBgamF2YXNjcmlwdA0KICAgICAqIGNvbnN0IGF1dGhDcmVkZW50aWFsID0gRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbFdpdGhMaW5rKGF1dGgsIGVtYWlsLCBlbWFpbExpbmspOw0KICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgYXV0aENyZWRlbnRpYWwpOw0KICAgICAqIGBgYA0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKiBgYGBqYXZhc2NyaXB0DQogICAgICogYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsKTsNCiAgICAgKiAvLyBPYnRhaW4gZW1haWxMaW5rIGZyb20gdXNlci4NCiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluayk7DQogICAgICogYGBgDQogICAgICoNCiAgICAgKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdXNlZCB0byB2ZXJpZnkgdGhlIGxpbmsuDQogICAgICogQHBhcmFtIGVtYWlsIC0gRW1haWwgYWRkcmVzcy4NCiAgICAgKiBAcGFyYW0gZW1haWxMaW5rIC0gU2lnbi1pbiBlbWFpbCBsaW5rLg0KICAgICAqIEByZXR1cm5zIC0gVGhlIGF1dGggcHJvdmlkZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbFdpdGhMaW5rKGVtYWlsLCBlbWFpbExpbmspIHsNCiAgICAgICAgY29uc3QgYWN0aW9uQ29kZVVybCA9IEFjdGlvbkNvZGVVUkwucGFyc2VMaW5rKGVtYWlsTGluayk7DQogICAgICAgIF9hc3NlcnQoYWN0aW9uQ29kZVVybCwgImFyZ3VtZW50LWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTsNCiAgICAgICAgcmV0dXJuIEVtYWlsQXV0aENyZWRlbnRpYWwuX2Zyb21FbWFpbEFuZENvZGUoZW1haWwsIGFjdGlvbkNvZGVVcmwuY29kZSwgYWN0aW9uQ29kZVVybC50ZW5hbnRJZCk7DQogICAgfQ0KfQ0KLyoqDQogKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5QQVNTV09SRCwgZXZlbiBmb3IgZW1haWwgbGluay4NCiAqLw0KRW1haWxBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSAicGFzc3dvcmQiIC8qIFByb3ZpZGVySWQuUEFTU1dPUkQgKi87DQovKioNCiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfUEFTU1dPUkQuDQogKi8NCkVtYWlsQXV0aFByb3ZpZGVyLkVNQUlMX1BBU1NXT1JEX1NJR05fSU5fTUVUSE9EID0gInBhc3N3b3JkIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi87DQovKioNCiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4NCiAqLw0KRW1haWxBdXRoUHJvdmlkZXIuRU1BSUxfTElOS19TSUdOX0lOX01FVEhPRCA9ICJlbWFpbExpbmsiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgYmFzZSBjbGFzcyBmb3IgYWxsIEZlZGVyYXRlZCBwcm92aWRlcnMgKE9BdXRoIChpbmNsdWRpbmcgT0lEQyksIFNBTUwpLg0KICoNCiAqIFRoaXMgY2xhc3MgaXMgbm90IG1lYW50IHRvIGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNsYXNzIEZlZGVyYXRlZEF1dGhQcm92aWRlciB7DQogICAgLyoqDQogICAgICogQ29uc3RydWN0b3IgZm9yIGdlbmVyaWMgT0F1dGggcHJvdmlkZXJzLg0KICAgICAqDQogICAgICogQHBhcmFtIHByb3ZpZGVySWQgLSBQcm92aWRlciBmb3Igd2hpY2ggY3JlZGVudGlhbHMgc2hvdWxkIGJlIGdlbmVyYXRlZC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihwcm92aWRlcklkKSB7DQogICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IHByb3ZpZGVySWQ7DQogICAgICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb2RlID0gbnVsbDsNCiAgICAgICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSB7fTsNCiAgICB9DQogICAgLyoqDQogICAgICogU2V0IHRoZSBsYW5ndWFnZSBnb2RlLg0KICAgICAqDQogICAgICogQHBhcmFtIGxhbmd1YWdlQ29kZSAtIGxhbmd1YWdlIGNvZGUNCiAgICAgKi8NCiAgICBzZXREZWZhdWx0TGFuZ3VhZ2UobGFuZ3VhZ2VDb2RlKSB7DQogICAgICAgIHRoaXMuZGVmYXVsdExhbmd1YWdlQ29kZSA9IGxhbmd1YWdlQ29kZTsNCiAgICB9DQogICAgLyoqDQogICAgICogU2V0cyB0aGUgT0F1dGggY3VzdG9tIHBhcmFtZXRlcnMgdG8gcGFzcyBpbiBhbiBPQXV0aCByZXF1ZXN0IGZvciBwb3B1cCBhbmQgcmVkaXJlY3Qgc2lnbi1pbg0KICAgICAqIG9wZXJhdGlvbnMuDQogICAgICoNCiAgICAgKiBAcmVtYXJrcw0KICAgICAqIEZvciBhIGRldGFpbGVkIGxpc3QsIGNoZWNrIHRoZSByZXNlcnZlZCByZXF1aXJlZCBPQXV0aCAyLjAgcGFyYW1ldGVycyBzdWNoIGFzIGBjbGllbnRfaWRgLA0KICAgICAqIGByZWRpcmVjdF91cmlgLCBgc2NvcGVgLCBgcmVzcG9uc2VfdHlwZWAsIGFuZCBgc3RhdGVgIGFyZSBub3QgYWxsb3dlZCBhbmQgd2lsbCBiZSBpZ25vcmVkLg0KICAgICAqDQogICAgICogQHBhcmFtIGN1c3RvbU9BdXRoUGFyYW1ldGVycyAtIFRoZSBjdXN0b20gT0F1dGggcGFyYW1ldGVycyB0byBwYXNzIGluIHRoZSBPQXV0aCByZXF1ZXN0Lg0KICAgICAqLw0KICAgIHNldEN1c3RvbVBhcmFtZXRlcnMoY3VzdG9tT0F1dGhQYXJhbWV0ZXJzKSB7DQogICAgICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IGN1c3RvbU9BdXRoUGFyYW1ldGVyczsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHJpZXZlIHRoZSBjdXJyZW50IGxpc3Qgb2Yge0BsaW5rIEN1c3RvbVBhcmFtZXRlcnN9Lg0KICAgICAqLw0KICAgIGdldEN1c3RvbVBhcmFtZXRlcnMoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN1c3RvbVBhcmFtZXRlcnM7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBDb21tb24gY29kZSB0byBhbGwgT0F1dGggcHJvdmlkZXJzLiBUaGlzIGlzIHNlcGFyYXRlIGZyb20gdGhlDQogKiB7QGxpbmsgT0F1dGhQcm92aWRlcn0gc28gdGhhdCBjaGlsZCBwcm92aWRlcnMgKGxpa2UNCiAqIHtAbGluayBHb29nbGVBdXRoUHJvdmlkZXJ9KSBkb24ndCBpbmhlcml0IHRoZSBgY3JlZGVudGlhbGAgaW5zdGFuY2UgbWV0aG9kLg0KICogSW5zdGVhZCwgdGhleSByZWx5IG9uIGEgc3RhdGljIGBjcmVkZW50aWFsYCBtZXRob2QuDQogKi8NCmNsYXNzIEJhc2VPQXV0aFByb3ZpZGVyIGV4dGVuZHMgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsNCiAgICAgICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgICAgICB0aGlzLnNjb3BlcyA9IFtdOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBZGQgYW4gT0F1dGggc2NvcGUgdG8gdGhlIGNyZWRlbnRpYWwuDQogICAgICoNCiAgICAgKiBAcGFyYW0gc2NvcGUgLSBQcm92aWRlciBPQXV0aCBzY29wZSB0byBhZGQuDQogICAgICovDQogICAgYWRkU2NvcGUoc2NvcGUpIHsNCiAgICAgICAgLy8gSWYgbm90IGFscmVhZHkgYWRkZWQsIGFkZCBzY29wZSB0byBsaXN0Lg0KICAgICAgICBpZiAoIXRoaXMuc2NvcGVzLmluY2x1ZGVzKHNjb3BlKSkgew0KICAgICAgICAgICAgdGhpcy5zY29wZXMucHVzaChzY29wZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHJpZXZlIHRoZSBjdXJyZW50IGxpc3Qgb2YgT0F1dGggc2NvcGVzLg0KICAgICAqLw0KICAgIGdldFNjb3BlcygpIHsNCiAgICAgICAgcmV0dXJuIFsuLi50aGlzLnNjb3Blc107DQogICAgfQ0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5GQUNFQk9PSy4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0Lg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTsNCiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci4NCiAqIHByb3ZpZGVyLmFkZFNjb3BlKCd1c2VyX2JpcnRoZGF5Jyk7DQogKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpOw0KICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwDQogKg0KICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdA0KICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7DQogKiBpZiAocmVzdWx0KSB7DQogKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyDQogKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjsNCiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBGYWNlYm9vayBBY2Nlc3MgVG9rZW4uDQogKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpOw0KICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiB9DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTsNCiAqIHByb3ZpZGVyLmFkZFNjb3BlKCd1c2VyX2JpcnRoZGF5Jyk7DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpOw0KICoNCiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLg0KICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogLy8gVGhpcyBnaXZlcyB5b3UgYSBGYWNlYm9vayBBY2Nlc3MgVG9rZW4uDQogKiBjb25zdCBjcmVkZW50aWFsID0gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTsNCiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqIGBgYA0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgRmFjZWJvb2tBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKCJmYWNlYm9vay5jb20iIC8qIFByb3ZpZGVySWQuRkFDRUJPT0sgKi8pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgRmFjZWJvb2suDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIGBgYGphdmFzY3JpcHQNCiAgICAgKiAvLyBgZXZlbnRgIGZyb20gdGhlIEZhY2Vib29rIGF1dGguYXV0aFJlc3BvbnNlQ2hhbmdlIGNhbGxiYWNrLg0KICAgICAqIGNvbnN0IGNyZWRlbnRpYWwgPSBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsKGV2ZW50LmF1dGhSZXNwb25zZS5hY2Nlc3NUb2tlbik7DQogICAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoY3JlZGVudGlhbCk7DQogICAgICogYGBgDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBGYWNlYm9vayBhY2Nlc3MgdG9rZW4uDQogICAgICovDQogICAgc3RhdGljIGNyZWRlbnRpYWwoYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyh7DQogICAgICAgICAgICBwcm92aWRlcklkOiBGYWNlYm9va0F1dGhQcm92aWRlci5QUk9WSURFUl9JRCwNCiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogRmFjZWJvb2tBdXRoUHJvdmlkZXIuRkFDRUJPT0tfU0lHTl9JTl9NRVRIT0QsDQogICAgICAgICAgICBhY2Nlc3NUb2tlbg0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9Lg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHsNCiAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXMNCiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikgew0KICAgICAgICByZXR1cm4gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTsNCiAgICB9DQogICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkgew0KICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UgfHwgISgnb2F1dGhBY2Nlc3NUb2tlbicgaW4gdG9rZW5SZXNwb25zZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICghdG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRkFDRUJPT0suICovDQpGYWNlYm9va0F1dGhQcm92aWRlci5GQUNFQk9PS19TSUdOX0lOX01FVEhPRCA9ICJmYWNlYm9vay5jb20iIC8qIFNpZ25Jbk1ldGhvZC5GQUNFQk9PSyAqLzsNCi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5GQUNFQk9PSy4gKi8NCkZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gImZhY2Vib29rLmNvbSIgLyogUHJvdmlkZXJJZC5GQUNFQk9PSyAqLzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4gYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5HT09HTEUuDQogKg0KICogQGV4YW1wbGUNCiAqIGBgYGphdmFzY3JpcHQNCiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC4NCiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdvb2dsZUF1dGhQcm92aWRlcigpOw0KICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLg0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ3Byb2ZpbGUnKTsNCiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdlbWFpbCcpOw0KICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTsNCiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcA0KICoNCiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHQNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpOw0KICogaWYgKHJlc3VsdCkgew0KICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlcg0KICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgR29vZ2xlIEFjY2VzcyBUb2tlbi4NCiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpOw0KICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiB9DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR29vZ2xlQXV0aFByb3ZpZGVyKCk7DQogKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpOw0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpOw0KICoNCiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLg0KICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogLy8gVGhpcyBnaXZlcyB5b3UgYSBHb29nbGUgQWNjZXNzIFRva2VuLg0KICogY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpOw0KICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuOw0KICogYGBgDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBHb29nbGVBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKCJnb29nbGUuY29tIiAvKiBQcm92aWRlcklkLkdPT0dMRSAqLyk7DQogICAgICAgIHRoaXMuYWRkU2NvcGUoJ3Byb2ZpbGUnKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgZm9yIEdvb2dsZS4gQXQgbGVhc3Qgb25lIG9mIElEIHRva2VuIGFuZCBhY2Nlc3MgdG9rZW4gaXMgcmVxdWlyZWQuDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIGBgYGphdmFzY3JpcHQNCiAgICAgKiAvLyBcYGdvb2dsZVVzZXJcYCBmcm9tIHRoZSBvbnN1Y2Nlc3MgR29vZ2xlIFNpZ24gSW4gY2FsbGJhY2suDQogICAgICogY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKGdvb2dsZVVzZXIuZ2V0QXV0aFJlc3BvbnNlKCkuaWRfdG9rZW4pOw0KICAgICAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGNyZWRlbnRpYWwpOw0KICAgICAqIGBgYA0KICAgICAqDQogICAgICogQHBhcmFtIGlkVG9rZW4gLSBHb29nbGUgSUQgdG9rZW4uDQogICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gR29vZ2xlIGFjY2VzcyB0b2tlbi4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbChpZFRva2VuLCBhY2Nlc3NUb2tlbikgew0KICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHsNCiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEdvb2dsZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRCwNCiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCwNCiAgICAgICAgICAgIGlkVG9rZW4sDQogICAgICAgICAgICBhY2Nlc3NUb2tlbg0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9Lg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHsNCiAgICAgICAgcmV0dXJuIEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzDQogICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuDQogICAgICovDQogICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHsNCiAgICAgICAgcmV0dXJuIEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpOw0KICAgIH0NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7DQogICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgeyBvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4gfSA9IHRva2VuUmVzcG9uc2U7DQogICAgICAgIGlmICghb2F1dGhJZFRva2VuICYmICFvYXV0aEFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGFuIG9hdXRoIDEgY3JlZGVudGlhbCBvciBhIHBob25lIGNyZWRlbnRpYWwNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGhJZFRva2VuLCBvYXV0aEFjY2Vzc1Rva2VuKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uR09PR0xFLiAqLw0KR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCA9ICJnb29nbGUuY29tIiAvKiBTaWduSW5NZXRob2QuR09PR0xFICovOw0KLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LkdPT0dMRS4gKi8NCkdvb2dsZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9ICJnb29nbGUuY29tIiAvKiBQcm92aWRlcklkLkdPT0dMRSAqLzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5HSVRIVUIuDQogKg0KICogQHJlbWFya3MNCiAqIEdpdEh1YiByZXF1aXJlcyBhbiBPQXV0aCAyLjAgcmVkaXJlY3QsIHNvIHlvdSBjYW4gZWl0aGVyIGhhbmRsZSB0aGUgcmVkaXJlY3QgZGlyZWN0bHksIG9yIHVzZQ0KICogdGhlIHtAbGluayBzaWduSW5XaXRoUG9wdXB9IGhhbmRsZXI6DQogKg0KICogQGV4YW1wbGUNCiAqIGBgYGphdmFzY3JpcHQNCiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC4NCiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdpdGh1YkF1dGhQcm92aWRlcigpOw0KICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLg0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ3JlcG8nKTsNCiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7DQogKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHANCiAqDQogKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTsNCiAqIGlmIChyZXN1bHQpIHsNCiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXINCiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEdpdGh1YiBBY2Nlc3MgVG9rZW4uDQogKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTsNCiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuOw0KICogfQ0KICogYGBgDQogKg0KICogQGV4YW1wbGUNCiAqIGBgYGphdmFzY3JpcHQNCiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC4NCiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdpdGh1YkF1dGhQcm92aWRlcigpOw0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ3JlcG8nKTsNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7DQogKg0KICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uDQogKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEdpdGh1YiBBY2Nlc3MgVG9rZW4uDQogKiBjb25zdCBjcmVkZW50aWFsID0gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiBgYGANCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgR2l0aHViQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigiZ2l0aHViLmNvbSIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi8pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgR2l0aHViLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gR2l0aHViIGFjY2VzcyB0b2tlbi4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbChhY2Nlc3NUb2tlbikgew0KICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHsNCiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEdpdGh1YkF1dGhQcm92aWRlci5QUk9WSURFUl9JRCwNCiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR2l0aHViQXV0aFByb3ZpZGVyLkdJVEhVQl9TSUdOX0lOX01FVEhPRCwNCiAgICAgICAgICAgIGFjY2Vzc1Rva2VuDQogICAgICAgIH0pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkgew0KICAgICAgICByZXR1cm4gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXMNCiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikgew0KICAgICAgICByZXR1cm4gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7DQogICAgfQ0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHsNCiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlIHx8ICEoJ29hdXRoQWNjZXNzVG9rZW4nIGluIHRva2VuUmVzcG9uc2UpKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5HSVRIVUIuICovDQpHaXRodWJBdXRoUHJvdmlkZXIuR0lUSFVCX1NJR05fSU5fTUVUSE9EID0gImdpdGh1Yi5jb20iIC8qIFNpZ25Jbk1ldGhvZC5HSVRIVUIgKi87DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uR0lUSFVCLiAqLw0KR2l0aHViQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gImdpdGh1Yi5jb20iIC8qIFByb3ZpZGVySWQuR0lUSFVCICovOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LlRXSVRURVIuDQogKg0KICogQGV4YW1wbGUNCiAqIGBgYGphdmFzY3JpcHQNCiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC4NCiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IFR3aXR0ZXJBdXRoUHJvdmlkZXIoKTsNCiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci4NCiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7DQogKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHANCiAqDQogKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTsNCiAqIGlmIChyZXN1bHQpIHsNCiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXINCiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIFR3aXR0ZXIgQWNjZXNzIFRva2VuIGFuZCBTZWNyZXQuDQogKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqICAgY29uc3Qgc2VjcmV0ID0gY3JlZGVudGlhbC5zZWNyZXQ7DQogKiB9DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgVHdpdHRlckF1dGhQcm92aWRlcigpOw0KICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTsNCiAqDQogKiAvLyBUaGUgc2lnbmVkLWluIHVzZXIgaW5mby4NCiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjsNCiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgVHdpdHRlciBBY2Nlc3MgVG9rZW4gYW5kIFNlY3JldC4NCiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiBjb25zdCBzZWNyZXQgPSBjcmVkZW50aWFsLnNlY3JldDsNCiAqIGBgYA0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgVHdpdHRlckF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoInR3aXR0ZXIuY29tIiAvKiBQcm92aWRlcklkLlRXSVRURVIgKi8pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgVHdpdHRlci4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB0b2tlbiAtIFR3aXR0ZXIgYWNjZXNzIHRva2VuLg0KICAgICAqIEBwYXJhbSBzZWNyZXQgLSBUd2l0dGVyIHNlY3JldC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbCh0b2tlbiwgc2VjcmV0KSB7DQogICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoew0KICAgICAgICAgICAgcHJvdmlkZXJJZDogVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCwNCiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9ELA0KICAgICAgICAgICAgb2F1dGhUb2tlbjogdG9rZW4sDQogICAgICAgICAgICBvYXV0aFRva2VuU2VjcmV0OiBzZWNyZXQNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuDQogICAgICovDQogICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7DQogICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXMNCiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikgew0KICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpOw0KICAgIH0NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7DQogICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgeyBvYXV0aEFjY2Vzc1Rva2VuLCBvYXV0aFRva2VuU2VjcmV0IH0gPSB0b2tlblJlc3BvbnNlOw0KICAgICAgICBpZiAoIW9hdXRoQWNjZXNzVG9rZW4gfHwgIW9hdXRoVG9rZW5TZWNyZXQpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsKG9hdXRoQWNjZXNzVG9rZW4sIG9hdXRoVG9rZW5TZWNyZXQpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5UV0lUVEVSLiAqLw0KVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9EID0gInR3aXR0ZXIuY29tIiAvKiBTaWduSW5NZXRob2QuVFdJVFRFUiAqLzsNCi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5UV0lUVEVSLiAqLw0KVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9ICJ0d2l0dGVyLmNvbSIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gc2lnblVwKGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6c2lnblVwIiAvKiBFbmRwb2ludC5TSUdOX1VQICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgVXNlckNyZWRlbnRpYWxJbXBsIHsNCiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsNCiAgICAgICAgdGhpcy51c2VyID0gcGFyYW1zLnVzZXI7DQogICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IHBhcmFtcy5wcm92aWRlcklkOw0KICAgICAgICB0aGlzLl90b2tlblJlc3BvbnNlID0gcGFyYW1zLl90b2tlblJlc3BvbnNlOw0KICAgICAgICB0aGlzLm9wZXJhdGlvblR5cGUgPSBwYXJhbXMub3BlcmF0aW9uVHlwZTsNCiAgICB9DQogICAgc3RhdGljIGFzeW5jIF9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIG9wZXJhdGlvblR5cGUsIGlkVG9rZW5SZXNwb25zZSwgaXNBbm9ueW1vdXMgPSBmYWxzZSkgew0KICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlckltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyk7DQogICAgICAgIGNvbnN0IHByb3ZpZGVySWQgPSBwcm92aWRlcklkRm9yUmVzcG9uc2UoaWRUb2tlblJlc3BvbnNlKTsNCiAgICAgICAgY29uc3QgdXNlckNyZWQgPSBuZXcgVXNlckNyZWRlbnRpYWxJbXBsKHsNCiAgICAgICAgICAgIHVzZXIsDQogICAgICAgICAgICBwcm92aWRlcklkLA0KICAgICAgICAgICAgX3Rva2VuUmVzcG9uc2U6IGlkVG9rZW5SZXNwb25zZSwNCiAgICAgICAgICAgIG9wZXJhdGlvblR5cGUNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB1c2VyQ3JlZDsNCiAgICB9DQogICAgc3RhdGljIGFzeW5jIF9mb3JPcGVyYXRpb24odXNlciwgb3BlcmF0aW9uVHlwZSwgcmVzcG9uc2UpIHsNCiAgICAgICAgYXdhaXQgdXNlci5fdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkocmVzcG9uc2UsIC8qIHJlbG9hZCAqLyB0cnVlKTsNCiAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVySWRGb3JSZXNwb25zZShyZXNwb25zZSk7DQogICAgICAgIHJldHVybiBuZXcgVXNlckNyZWRlbnRpYWxJbXBsKHsNCiAgICAgICAgICAgIHVzZXIsDQogICAgICAgICAgICBwcm92aWRlcklkLA0KICAgICAgICAgICAgX3Rva2VuUmVzcG9uc2U6IHJlc3BvbnNlLA0KICAgICAgICAgICAgb3BlcmF0aW9uVHlwZQ0KICAgICAgICB9KTsNCiAgICB9DQp9DQpmdW5jdGlvbiBwcm92aWRlcklkRm9yUmVzcG9uc2UocmVzcG9uc2UpIHsNCiAgICBpZiAocmVzcG9uc2UucHJvdmlkZXJJZCkgew0KICAgICAgICByZXR1cm4gcmVzcG9uc2UucHJvdmlkZXJJZDsNCiAgICB9DQogICAgaWYgKCdwaG9uZU51bWJlcicgaW4gcmVzcG9uc2UpIHsNCiAgICAgICAgcmV0dXJuICJwaG9uZSIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLzsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBNdWx0aUZhY3RvckVycm9yIGV4dGVuZHMgRmlyZWJhc2VFcnJvciB7DQogICAgY29uc3RydWN0b3IoYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBzdXBlcihlcnJvci5jb2RlLCBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgdGhpcy5vcGVyYXRpb25UeXBlID0gb3BlcmF0aW9uVHlwZTsNCiAgICAgICAgdGhpcy51c2VyID0gdXNlcjsNCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0LXdpa2kvYmxvYi9tYXN0ZXIvQnJlYWtpbmctQ2hhbmdlcy5tZCNleHRlbmRpbmctYnVpbHQtaW5zLWxpa2UtZXJyb3ItYXJyYXktYW5kLW1hcC1tYXktbm8tbG9uZ2VyLXdvcmsNCiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIE11bHRpRmFjdG9yRXJyb3IucHJvdG90eXBlKTsNCiAgICAgICAgdGhpcy5jdXN0b21EYXRhID0gew0KICAgICAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lLA0KICAgICAgICAgICAgdGVuYW50SWQ6IChfYSA9IGF1dGgudGVuYW50SWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVuZGVmaW5lZCwNCiAgICAgICAgICAgIF9zZXJ2ZXJSZXNwb25zZTogZXJyb3IuY3VzdG9tRGF0YS5fc2VydmVyUmVzcG9uc2UsDQogICAgICAgICAgICBvcGVyYXRpb25UeXBlDQogICAgICAgIH07DQogICAgfQ0KICAgIHN0YXRpYyBfZnJvbUVycm9yQW5kT3BlcmF0aW9uKGF1dGgsIGVycm9yLCBvcGVyYXRpb25UeXBlLCB1c2VyKSB7DQogICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JFcnJvcihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHsNCiAgICBjb25zdCBpZFRva2VuUHJvdmlkZXIgPSBvcGVyYXRpb25UeXBlID09PSAicmVhdXRoZW50aWNhdGUiIC8qIE9wZXJhdGlvblR5cGUuUkVBVVRIRU5USUNBVEUgKi8NCiAgICAgICAgPyBjcmVkZW50aWFsLl9nZXRSZWF1dGhlbnRpY2F0aW9uUmVzb2x2ZXIoYXV0aCkNCiAgICAgICAgOiBjcmVkZW50aWFsLl9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCk7DQogICAgcmV0dXJuIGlkVG9rZW5Qcm92aWRlci5jYXRjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8keyJtdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi99YCkgew0KICAgICAgICAgICAgdGhyb3cgTXVsdGlGYWN0b3JFcnJvci5fZnJvbUVycm9yQW5kT3BlcmF0aW9uKGF1dGgsIGVycm9yLCBvcGVyYXRpb25UeXBlLCB1c2VyKTsNCiAgICAgICAgfQ0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9KTsNCn0KYXN5bmMgZnVuY3Rpb24gX2xpbmskMSh1c2VyLCBjcmVkZW50aWFsLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkgew0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgY3JlZGVudGlhbC5fbGlua1RvSWRUb2tlbih1c2VyLmF1dGgsIGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpKSwgYnlwYXNzQXV0aFN0YXRlKTsNCiAgICByZXR1cm4gVXNlckNyZWRlbnRpYWxJbXBsLl9mb3JPcGVyYXRpb24odXNlciwgImxpbmsiIC8qIE9wZXJhdGlvblR5cGUuTElOSyAqLywgcmVzcG9uc2UpOw0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIF9yZWF1dGhlbnRpY2F0ZSh1c2VyLCBjcmVkZW50aWFsLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkgew0KICAgIGNvbnN0IHsgYXV0aCB9ID0gdXNlcjsNCiAgICBjb25zdCBvcGVyYXRpb25UeXBlID0gInJlYXV0aGVudGljYXRlIiAvKiBPcGVyYXRpb25UeXBlLlJFQVVUSEVOVElDQVRFICovOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpLCBieXBhc3NBdXRoU3RhdGUpOw0KICAgICAgICBfYXNzZXJ0KHJlc3BvbnNlLmlkVG9rZW4sIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGNvbnN0IHBhcnNlZCA9IF9wYXJzZVRva2VuKHJlc3BvbnNlLmlkVG9rZW4pOw0KICAgICAgICBfYXNzZXJ0KHBhcnNlZCwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgY29uc3QgeyBzdWI6IGxvY2FsSWQgfSA9IHBhcnNlZDsNCiAgICAgICAgX2Fzc2VydCh1c2VyLnVpZCA9PT0gbG9jYWxJZCwgYXV0aCwgInVzZXItbWlzbWF0Y2giIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9NSVNNQVRDSCAqLyk7DQogICAgICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSk7DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIC8vIENvbnZlcnQgdXNlciBkZWxldGVkIGVycm9yIGludG8gdXNlciBtaXNtYXRjaA0KICAgICAgICBpZiAoKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5jb2RlKSA9PT0gYGF1dGgvJHsidXNlci1ub3QtZm91bmQiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovfWApIHsNCiAgICAgICAgICAgIF9mYWlsKGF1dGgsICJ1c2VyLW1pc21hdGNoIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfTUlTTUFUQ0ggKi8pOw0KICAgICAgICB9DQogICAgICAgIHRocm93IGU7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gX3NpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7DQogICAgY29uc3Qgb3BlcmF0aW9uVHlwZSA9ICJzaWduSW4iIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLzsNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wcm9jZXNzQ3JlZGVudGlhbFNhdmluZ01mYUNvbnRleHRJZk5lY2Vzc2FyeShhdXRoLCBvcGVyYXRpb25UeXBlLCBjcmVkZW50aWFsKTsNCiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSk7DQogICAgaWYgKCFieXBhc3NBdXRoU3RhdGUpIHsNCiAgICAgICAgYXdhaXQgYXV0aC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7DQogICAgfQ0KICAgIHJldHVybiB1c2VyQ3JlZGVudGlhbDsNCn0NCi8qKg0KICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gd2l0aCB0aGUgZ2l2ZW4gY3JlZGVudGlhbHMuDQogKg0KICogQHJlbWFya3MNCiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGNhbiBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjcmVkZW50aWFsLg0KICoNCiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS4NCiAqIEBwYXJhbSBjcmVkZW50aWFsIC0gVGhlIGF1dGggY3JlZGVudGlhbC4NCiAqDQogKiBAcHVibGljDQogKi8NCmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGNyZWRlbnRpYWwpIHsNCiAgICByZXR1cm4gX3NpZ25JbldpdGhDcmVkZW50aWFsKF9jYXN0QXV0aChhdXRoKSwgY3JlZGVudGlhbCk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBVcGRhdGVzIHRoZSBwYXNzd29yZCBwb2xpY3kgY2FjaGVkIGluIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgaWYgYSBwb2xpY3kgaXMgYWxyZWFkeQ0KICogY2FjaGVkIGZvciB0aGUgcHJvamVjdCBvciB0ZW5hbnQuDQogKg0KICogQHJlbWFya3MNCiAqIFdlIG9ubHkgZmV0Y2ggdGhlIHBhc3N3b3JkIHBvbGljeSBpZiB0aGUgcGFzc3dvcmQgZGlkIG5vdCBtZWV0IHBvbGljeSByZXF1aXJlbWVudHMgYW5kDQogKiB0aGVyZSBpcyBhbiBleGlzdGluZyBwb2xpY3kgY2FjaGVkLiBBIGRldmVsb3BlciBtdXN0IGNhbGwgdmFsaWRhdGVQYXNzd29yZCBhdCBsZWFzdA0KICogb25jZSBmb3IgdGhlIGNhY2hlIHRvIGJlIGF1dG9tYXRpY2FsbHkgdXBkYXRlZC4NCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKg0KICogQHByaXZhdGUNCiAqLw0KYXN5bmMgZnVuY3Rpb24gcmVjYWNoZVBhc3N3b3JkUG9saWN5KGF1dGgpIHsNCiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7DQogICAgaWYgKGF1dGhJbnRlcm5hbC5fZ2V0UGFzc3dvcmRQb2xpY3lJbnRlcm5hbCgpKSB7DQogICAgICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fdXBkYXRlUGFzc3dvcmRQb2xpY3koKTsNCiAgICB9DQp9DQovKioNCiAqIENyZWF0ZXMgYSBuZXcgdXNlciBhY2NvdW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGVtYWlsIGFkZHJlc3MgYW5kIHBhc3N3b3JkLg0KICoNCiAqIEByZW1hcmtzDQogKiBPbiBzdWNjZXNzZnVsIGNyZWF0aW9uIG9mIHRoZSB1c2VyIGFjY291bnQsIHRoaXMgdXNlciB3aWxsIGFsc28gYmUgc2lnbmVkIGluIHRvIHlvdXIgYXBwbGljYXRpb24uDQogKg0KICogVXNlciBhY2NvdW50IGNyZWF0aW9uIGNhbiBmYWlsIGlmIHRoZSBhY2NvdW50IGFscmVhZHkgZXhpc3RzIG9yIHRoZSBwYXNzd29yZCBpcyBpbnZhbGlkLg0KICoNCiAqIE5vdGU6IFRoZSBlbWFpbCBhZGRyZXNzIGFjdHMgYXMgYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIHVzZXIgYW5kIGVuYWJsZXMgYW4gZW1haWwtYmFzZWQNCiAqIHBhc3N3b3JkIHJlc2V0LiBUaGlzIGZ1bmN0aW9uIHdpbGwgY3JlYXRlIGEgbmV3IHVzZXIgYWNjb3VudCBhbmQgc2V0IHRoZSBpbml0aWFsIHVzZXIgcGFzc3dvcmQuDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLg0KICogQHBhcmFtIHBhc3N3b3JkIC0gVGhlIHVzZXIncyBjaG9zZW4gcGFzc3dvcmQuDQogKg0KICogQHB1YmxpYw0KICovDQphc3luYyBmdW5jdGlvbiBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKSB7DQogICAgdmFyIF9hOw0KICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTsNCiAgICBjb25zdCByZXF1ZXN0ID0gew0KICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZSwNCiAgICAgICAgZW1haWwsDQogICAgICAgIHBhc3N3b3JkLA0KICAgICAgICBjbGllbnRUeXBlOiAiQ0xJRU5UX1RZUEVfV0VCIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLw0KICAgIH07DQogICAgbGV0IHNpZ25VcFJlc3BvbnNlOw0KICAgIGlmICgoX2EgPSBhdXRoSW50ZXJuYWwuX2dldFJlY2FwdGNoYUNvbmZpZygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW1haWxQYXNzd29yZEVuYWJsZWQpIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aEludGVybmFsLCByZXF1ZXN0LCAic2lnblVwUGFzc3dvcmQiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9VUF9QQVNTV09SRCAqLyk7DQogICAgICAgIHNpZ25VcFJlc3BvbnNlID0gc2lnblVwKGF1dGhJbnRlcm5hbCwgcmVxdWVzdFdpdGhSZWNhcHRjaGEpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgc2lnblVwUmVzcG9uc2UgPSBzaWduVXAoYXV0aEludGVybmFsLCByZXF1ZXN0KS5jYXRjaChhc3luYyAoZXJyb3IpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8keyJtaXNzaW5nLXJlY2FwdGNoYS10b2tlbiIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqL31gKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NpZ24tdXAgaXMgcHJvdGVjdGVkIGJ5IHJlQ0FQVENIQSBmb3IgdGhpcyBwcm9qZWN0LiBBdXRvbWF0aWNhbGx5IHRyaWdnZXJpbmcgdGhlIHJlQ0FQVENIQSBmbG93IGFuZCByZXN0YXJ0aW5nIHRoZSBzaWduLXVwIGZsb3cuJyk7DQogICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aEludGVybmFsLCByZXF1ZXN0LCAic2lnblVwUGFzc3dvcmQiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9VUF9QQVNTV09SRCAqLyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25VcChhdXRoSW50ZXJuYWwsIHJlcXVlc3RXaXRoUmVjYXB0Y2hhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IGVycm9yOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzaWduVXBSZXNwb25zZS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8keyJwYXNzd29yZC1kb2VzLW5vdC1tZWV0LXJlcXVpcmVtZW50cyIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqL31gKSB7DQogICAgICAgICAgICB2b2lkIHJlY2FjaGVQYXNzd29yZFBvbGljeShhdXRoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9KTsNCiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoSW50ZXJuYWwsICJzaWduSW4iIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLywgcmVzcG9uc2UpOw0KICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7DQogICAgcmV0dXJuIHVzZXJDcmVkZW50aWFsOw0KfQ0KLyoqDQogKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB1c2luZyBhbiBlbWFpbCBhbmQgcGFzc3dvcmQuDQogKg0KICogQHJlbWFya3MNCiAqIEZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIGVtYWlsIGFkZHJlc3MgYW5kIHBhc3N3b3JkIGRvIG5vdCBtYXRjaC4NCiAqDQogKiBOb3RlOiBUaGUgdXNlcidzIHBhc3N3b3JkIGlzIE5PVCB0aGUgcGFzc3dvcmQgdXNlZCB0byBhY2Nlc3MgdGhlIHVzZXIncyBlbWFpbCBhY2NvdW50LiBUaGUNCiAqIGVtYWlsIGFkZHJlc3Mgc2VydmVzIGFzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB1c2VyLCBhbmQgdGhlIHBhc3N3b3JkIGlzIHVzZWQgdG8gYWNjZXNzDQogKiB0aGUgdXNlcidzIGFjY291bnQgaW4geW91ciBGaXJlYmFzZSBwcm9qZWN0LiBTZWUgYWxzbzoge0BsaW5rIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZH0uDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXJzIGVtYWlsIGFkZHJlc3MuDQogKiBAcGFyYW0gcGFzc3dvcmQgLSBUaGUgdXNlcnMgcGFzc3dvcmQuDQogKg0KICogQHB1YmxpYw0KICovDQpmdW5jdGlvbiBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpIHsNCiAgICByZXR1cm4gc2lnbkluV2l0aENyZWRlbnRpYWwoZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLCBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCkpLmNhdGNoKGFzeW5jIChlcnJvcikgPT4gew0KICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gYGF1dGgvJHsicGFzc3dvcmQtZG9lcy1ub3QtbWVldC1yZXF1aXJlbWVudHMiIC8qIEF1dGhFcnJvckNvZGUuUEFTU1dPUkRfRE9FU19OT1RfTUVFVF9SRVFVSVJFTUVOVFMgKi99YCkgew0KICAgICAgICAgICAgdm9pZCByZWNhY2hlUGFzc3dvcmRQb2xpY3koYXV0aCk7DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgfSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovLyBOb24tb3B0aW9uYWwgYXV0aCBtZXRob2RzLg0KLyoqDQogKiBDaGFuZ2VzIHRoZSB0eXBlIG9mIHBlcnNpc3RlbmNlIG9uIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgZm9yIHRoZSBjdXJyZW50bHkgc2F2ZWQNCiAqIGBBdXRoYCBzZXNzaW9uIGFuZCBhcHBsaWVzIHRoaXMgdHlwZSBvZiBwZXJzaXN0ZW5jZSBmb3IgZnV0dXJlIHNpZ24taW4gcmVxdWVzdHMsIGluY2x1ZGluZw0KICogc2lnbi1pbiB3aXRoIHJlZGlyZWN0IHJlcXVlc3RzLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIG1ha2VzIGl0IGVhc3kgZm9yIGEgdXNlciBzaWduaW5nIGluIHRvIHNwZWNpZnkgd2hldGhlciB0aGVpciBzZXNzaW9uIHNob3VsZCBiZQ0KICogcmVtZW1iZXJlZCBvciBub3QuIEl0IGFsc28gbWFrZXMgaXQgZWFzaWVyIHRvIG5ldmVyIHBlcnNpc3QgdGhlIGBBdXRoYCBzdGF0ZSBmb3IgYXBwbGljYXRpb25zDQogKiB0aGF0IGFyZSBzaGFyZWQgYnkgb3RoZXIgdXNlcnMgb3IgaGF2ZSBzZW5zaXRpdmUgZGF0YS4NCiAqDQogKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogc2V0UGVyc2lzdGVuY2UoYXV0aCwgYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSk7DQogKiBgYGANCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKiBAcGFyYW0gcGVyc2lzdGVuY2UgLSBUaGUge0BsaW5rIFBlcnNpc3RlbmNlfSB0byB1c2UuDQogKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIHBlcnNpc3RlbmNlIGNoYW5nZSBoYXMgY29tcGxldGVkDQogKg0KICogQHB1YmxpYw0KICovDQpmdW5jdGlvbiBzZXRQZXJzaXN0ZW5jZShhdXRoLCBwZXJzaXN0ZW5jZSkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuc2V0UGVyc2lzdGVuY2UocGVyc2lzdGVuY2UpOw0KfQ0KLyoqDQogKiBBZGRzIGFuIG9ic2VydmVyIGZvciBjaGFuZ2VzIHRvIHRoZSBzaWduZWQtaW4gdXNlcidzIElEIHRva2VuLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIGluY2x1ZGVzIHNpZ24taW4sIHNpZ24tb3V0LCBhbmQgdG9rZW4gcmVmcmVzaCBldmVudHMuDQogKiBUaGlzIHdpbGwgbm90IGJlIHRyaWdnZXJlZCBhdXRvbWF0aWNhbGx5IHVwb24gSUQgdG9rZW4gZXhwaXJhdGlvbi4gVXNlIHtAbGluayBVc2VyLmdldElkVG9rZW59IHRvIHJlZnJlc2ggdGhlIElEIHRva2VuLg0KICoNCiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS4NCiAqIEBwYXJhbSBuZXh0T3JPYnNlcnZlciAtIGNhbGxiYWNrIHRyaWdnZXJlZCBvbiBjaGFuZ2UuDQogKiBAcGFyYW0gZXJyb3IgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC4gRXJyb3JzDQogKiBvbiBzaWduaW5nIGluL291dCBjYW4gYmUgY2F1Z2h0IGluIHByb21pc2VzIHJldHVybmVkIGZyb20NCiAqIHNpZ24taW4vc2lnbi1vdXQgZnVuY3Rpb25zLg0KICogQHBhcmFtIGNvbXBsZXRlZCAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gb25JZFRva2VuQ2hhbmdlZChhdXRoLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkub25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7DQp9DQovKioNCiAqIEFkZHMgYSBibG9ja2luZyBjYWxsYmFjayB0aGF0IHJ1bnMgYmVmb3JlIGFuIGF1dGggc3RhdGUgY2hhbmdlDQogKiBzZXRzIGEgbmV3IHVzZXIuDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIGNhbGxiYWNrIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIGJlZm9yZSBuZXcgdXNlciB2YWx1ZSBpcyBzZXQuDQogKiAgIElmIHRoaXMgdGhyb3dzLCBpdCBibG9ja3MgdGhlIHVzZXIgZnJvbSBiZWluZyBzZXQuDQogKiBAcGFyYW0gb25BYm9ydCAtIGNhbGxiYWNrIHRyaWdnZXJlZCBpZiBhIGxhdGVyIGBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKClgDQogKiAgIGNhbGxiYWNrIHRocm93cywgYWxsb3dpbmcgeW91IHRvIHVuZG8gYW55IHNpZGUgZWZmZWN0cy4NCiAqLw0KZnVuY3Rpb24gYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBjYWxsYmFjaywgb25BYm9ydCkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChjYWxsYmFjaywgb25BYm9ydCk7DQp9DQoKY29uc3QgU1RPUkFHRV9BVkFJTEFCTEVfS0VZID0gJ19fc2FrJzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIFRoZXJlIGFyZSB0d28gZGlmZmVyZW50IGJyb3dzZXIgcGVyc2lzdGVuY2UgdHlwZXM6IGxvY2FsIGFuZCBzZXNzaW9uLg0KLy8gQm90aCBoYXZlIHRoZSBzYW1lIGltcGxlbWVudGF0aW9uIGJ1dCB1c2UgYSBkaWZmZXJlbnQgdW5kZXJseWluZyBzdG9yYWdlDQovLyBvYmplY3QuDQpjbGFzcyBCcm93c2VyUGVyc2lzdGVuY2VDbGFzcyB7DQogICAgY29uc3RydWN0b3Ioc3RvcmFnZVJldHJpZXZlciwgdHlwZSkgew0KICAgICAgICB0aGlzLnN0b3JhZ2VSZXRyaWV2ZXIgPSBzdG9yYWdlUmV0cmlldmVyOw0KICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOw0KICAgIH0NCiAgICBfaXNBdmFpbGFibGUoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuc3RvcmFnZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9BVkFJTEFCTEVfS0VZLCAnMScpOw0KICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9BVkFJTEFCTEVfS0VZKTsNCiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBfc2V0KGtleSwgdmFsdWUpIHsNCiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpOw0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7DQogICAgfQ0KICAgIF9nZXQoa2V5KSB7DQogICAgICAgIGNvbnN0IGpzb24gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGpzb24gPyBKU09OLnBhcnNlKGpzb24pIDogbnVsbCk7DQogICAgfQ0KICAgIF9yZW1vdmUoa2V5KSB7DQogICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7DQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsNCiAgICB9DQogICAgZ2V0IHN0b3JhZ2UoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VSZXRyaWV2ZXIoKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfaWZyYW1lQ2Fubm90U3luY1dlYlN0b3JhZ2UoKSB7DQogICAgY29uc3QgdWEgPSBnZXRVQSgpOw0KICAgIHJldHVybiBfaXNTYWZhcmkodWEpIHx8IF9pc0lPUyh1YSk7DQp9DQovLyBUaGUgcG9sbGluZyBwZXJpb2QgaW4gY2FzZSBldmVudHMgYXJlIG5vdCBzdXBwb3J0ZWQNCmNvbnN0IF9QT0xMSU5HX0lOVEVSVkFMX01TJDEgPSAxMDAwOw0KLy8gVGhlIElFIDEwIGxvY2FsU3RvcmFnZSBjcm9zcyB0YWIgc3luY2hyb25pemF0aW9uIGRlbGF5IGluIG1pbGxpc2Vjb25kcw0KY29uc3QgSUUxMF9MT0NBTF9TVE9SQUdFX1NZTkNfREVMQVkgPSAxMDsNCmNsYXNzIEJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlIGV4dGVuZHMgQnJvd3NlclBlcnNpc3RlbmNlQ2xhc3Mgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigoKSA9PiB3aW5kb3cubG9jYWxTdG9yYWdlLCAiTE9DQUwiIC8qIFBlcnNpc3RlbmNlVHlwZS5MT0NBTCAqLyk7DQogICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSAoZXZlbnQsIHBvbGwpID0+IHRoaXMub25TdG9yYWdlRXZlbnQoZXZlbnQsIHBvbGwpOw0KICAgICAgICB0aGlzLmxpc3RlbmVycyA9IHt9Ow0KICAgICAgICB0aGlzLmxvY2FsQ2FjaGUgPSB7fTsNCiAgICAgICAgLy8gc2V0VGltZW91dCByZXR1cm4gdmFsdWUgaXMgcGxhdGZvcm0gc3BlY2lmaWMNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsOw0KICAgICAgICAvLyBTYWZhcmkgb3IgaU9TIGJyb3dzZXIgYW5kIGVtYmVkZGVkIGluIGFuIGlmcmFtZS4NCiAgICAgICAgdGhpcy5zYWZhcmlMb2NhbFN0b3JhZ2VOb3RTeW5jZWQgPSBfaWZyYW1lQ2Fubm90U3luY1dlYlN0b3JhZ2UoKSAmJiBfaXNJZnJhbWUoKTsNCiAgICAgICAgLy8gV2hldGhlciB0byB1c2UgcG9sbGluZyBpbnN0ZWFkIG9mIGRlcGVuZGluZyBvbiB3aW5kb3cgZXZlbnRzDQogICAgICAgIHRoaXMuZmFsbGJhY2tUb1BvbGxpbmcgPSBfaXNNb2JpbGVCcm93c2VyKCk7DQogICAgICAgIHRoaXMuX3Nob3VsZEFsbG93TWlncmF0aW9uID0gdHJ1ZTsNCiAgICB9DQogICAgZm9yQWxsQ2hhbmdlZEtleXMoY2IpIHsNCiAgICAgICAgLy8gQ2hlY2sgYWxsIGtleXMgd2l0aCBsaXN0ZW5lcnMgb24gdGhlbS4NCiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpKSB7DQogICAgICAgICAgICAvLyBHZXQgdmFsdWUgZnJvbSBsb2NhbFN0b3JhZ2UuDQogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMubG9jYWxDYWNoZVtrZXldOw0KICAgICAgICAgICAgLy8gSWYgbG9jYWwgbWFwIHZhbHVlIGRvZXMgbm90IG1hdGNoLCB0cmlnZ2VyIGxpc3RlbmVyIHdpdGggc3RvcmFnZSBldmVudC4NCiAgICAgICAgICAgIC8vIERpZmZlcmVudGlhdGUgdGhpcyBzaW11bGF0ZWQgZXZlbnQgZnJvbSB0aGUgcmVhbCBzdG9yYWdlIGV2ZW50Lg0KICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkgew0KICAgICAgICAgICAgICAgIGNiKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvblN0b3JhZ2VFdmVudChldmVudCwgcG9sbCA9IGZhbHNlKSB7DQogICAgICAgIC8vIEtleSB3b3VsZCBiZSBudWxsIGluIHNvbWUgc2l0dWF0aW9ucywgbGlrZSB3aGVuIGxvY2FsU3RvcmFnZSBpcyBjbGVhcmVkDQogICAgICAgIGlmICghZXZlbnQua2V5KSB7DQogICAgICAgICAgICB0aGlzLmZvckFsbENoYW5nZWRLZXlzKChrZXksIF9vbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhrZXksIG5ld1ZhbHVlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleTsNCiAgICAgICAgLy8gQ2hlY2sgdGhlIG1lY2hhbmlzbSBob3cgdGhpcyBldmVudCB3YXMgZGV0ZWN0ZWQuDQogICAgICAgIC8vIFRoZSBmaXJzdCBldmVudCB3aWxsIGRpY3RhdGUgdGhlIG1lY2hhbmlzbSB0byBiZSB1c2VkLg0KICAgICAgICBpZiAocG9sbCkgew0KICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHBvbGxpbmcuDQogICAgICAgICAgICAvLyBSZW1vdmUgc3RvcmFnZSBldmVudCBsaXN0ZW5lciB0byBwcmV2ZW50IHBvc3NpYmxlIGV2ZW50IGR1cGxpY2F0aW9uLg0KICAgICAgICAgICAgdGhpcy5kZXRhY2hMaXN0ZW5lcigpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHN0b3JhZ2UgZXZlbnQgbGlzdGVuZXIuDQogICAgICAgICAgICAvLyBSZW1vdmUgcG9sbGluZyBsaXN0ZW5lciB0byBwcmV2ZW50IHBvc3NpYmxlIGV2ZW50IGR1cGxpY2F0aW9uLg0KICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpOw0KICAgICAgICB9DQogICAgICAgIC8vIFNhZmFyaSBlbWJlZGRlZCBpZnJhbWUuIFN0b3JhZ2UgZXZlbnQgd2lsbCB0cmlnZ2VyIHdpdGggdGhlIGRlbHRhDQogICAgICAgIC8vIGNoYW5nZXMgYnV0IG5vIGNoYW5nZXMgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBpZnJhbWUgbG9jYWxTdG9yYWdlLg0KICAgICAgICBpZiAodGhpcy5zYWZhcmlMb2NhbFN0b3JhZ2VOb3RTeW5jZWQpIHsNCiAgICAgICAgICAgIC8vIEdldCBjdXJyZW50IGlmcmFtZSBwYWdlIHZhbHVlLg0KICAgICAgICAgICAgY29uc3Qgc3RvcmVkVmFsdWUgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICAgICAgLy8gVmFsdWUgbm90IHN5bmNocm9uaXplZCwgc3luY2hyb25pemUgbWFudWFsbHkuDQogICAgICAgICAgICBpZiAoZXZlbnQubmV3VmFsdWUgIT09IHN0b3JlZFZhbHVlKSB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm5ld1ZhbHVlICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFZhbHVlIGNoYW5nZWQgZnJvbSBjdXJyZW50IHZhbHVlLg0KICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShrZXksIGV2ZW50Lm5ld1ZhbHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWUgZGVsZXRlZC4NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmxvY2FsQ2FjaGVba2V5XSA9PT0gZXZlbnQubmV3VmFsdWUgJiYgIXBvbGwpIHsNCiAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IGRldGVjdGVkIGFuZCBwcm9jZXNzZWQsIGRvIG5vdCB0cmlnZ2VyIGxpc3RlbmVycyBhZ2Fpbi4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgdHJpZ2dlckxpc3RlbmVycyA9ICgpID0+IHsNCiAgICAgICAgICAgIC8vIEtlZXAgbG9jYWwgbWFwIHVwIHRvIGRhdGUgaW4gY2FzZSBzdG9yYWdlIGV2ZW50IGlzIHRyaWdnZXJlZCBiZWZvcmUNCiAgICAgICAgICAgIC8vIHBvbGwuDQogICAgICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgICAgICBpZiAoIXBvbGwgJiYgdGhpcy5sb2NhbENhY2hlW2tleV0gPT09IHN0b3JlZFZhbHVlKSB7DQogICAgICAgICAgICAgICAgLy8gUmVhbCBzdG9yYWdlIGV2ZW50IHdoaWNoIGhhcyBhbHJlYWR5IGJlZW4gZGV0ZWN0ZWQsIGRvIG5vdGhpbmcuDQogICAgICAgICAgICAgICAgLy8gVGhpcyBzZWVtcyB0byB0cmlnZ2VyIGluIHNvbWUgSUUgYnJvd3NlcnMgZm9yIHNvbWUgcmVhc29uLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKGtleSwgc3RvcmVkVmFsdWUpOw0KICAgICAgICB9Ow0KICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgIGlmIChfaXNJRTEwKCkgJiYNCiAgICAgICAgICAgIHN0b3JlZFZhbHVlICE9PSBldmVudC5uZXdWYWx1ZSAmJg0KICAgICAgICAgICAgZXZlbnQubmV3VmFsdWUgIT09IGV2ZW50Lm9sZFZhbHVlKSB7DQogICAgICAgICAgICAvLyBJRSAxMCBoYXMgdGhpcyB3ZWlyZCBidWcgd2hlcmUgYSBzdG9yYWdlIGV2ZW50IHdvdWxkIHRyaWdnZXIgd2l0aCB0aGUNCiAgICAgICAgICAgIC8vIGNvcnJlY3Qga2V5LCBvbGRWYWx1ZSBhbmQgbmV3VmFsdWUgYnV0IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgZG9lcw0KICAgICAgICAgICAgLy8gbm90IHlpZWxkIHRoZSB1cGRhdGVkIHZhbHVlIHVudGlsIGEgZmV3IG1pbGxpc2Vjb25kcy4gVGhpcyBlbnN1cmVzDQogICAgICAgICAgICAvLyB0aGlzIHJlY292ZXJzIGZyb20gdGhhdCBzaXR1YXRpb24uDQogICAgICAgICAgICBzZXRUaW1lb3V0KHRyaWdnZXJMaXN0ZW5lcnMsIElFMTBfTE9DQUxfU1RPUkFHRV9TWU5DX0RFTEFZKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRyaWdnZXJMaXN0ZW5lcnMoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBub3RpZnlMaXN0ZW5lcnMoa2V5LCB2YWx1ZSkgew0KICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHZhbHVlOw0KICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1trZXldOw0KICAgICAgICBpZiAobGlzdGVuZXJzKSB7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkgew0KICAgICAgICAgICAgICAgIGxpc3RlbmVyKHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiB2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhcnRQb2xsaW5nKCkgew0KICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7DQogICAgICAgIHRoaXMucG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5mb3JBbGxDaGFuZ2VkS2V5cygoa2V5LCBvbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLm9uU3RvcmFnZUV2ZW50KG5ldyBTdG9yYWdlRXZlbnQoJ3N0b3JhZ2UnLCB7DQogICAgICAgICAgICAgICAgICAgIGtleSwNCiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUsDQogICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlDQogICAgICAgICAgICAgICAgfSksIA0KICAgICAgICAgICAgICAgIC8qIHBvbGwgKi8gdHJ1ZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwgX1BPTExJTkdfSU5URVJWQUxfTVMkMSk7DQogICAgfQ0KICAgIHN0b3BQb2xsaW5nKCkgew0KICAgICAgICBpZiAodGhpcy5wb2xsVGltZXIpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpOw0KICAgICAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIGF0dGFjaExpc3RlbmVyKCkgew0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc3RvcmFnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpOw0KICAgIH0NCiAgICBkZXRhY2hMaXN0ZW5lcigpIHsNCiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTsNCiAgICB9DQogICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIC8vIFdoZXRoZXIgYnJvd3NlciBjYW4gZGV0ZWN0IHN0b3JhZ2UgZXZlbnQgd2hlbiBpdCBoYWQgYWxyZWFkeSBiZWVuIHB1c2hlZCB0byB0aGUgYmFja2dyb3VuZC4NCiAgICAgICAgICAgIC8vIFRoaXMgbWF5IGhhcHBlbiBpbiBzb21lIG1vYmlsZSBicm93c2Vycy4gQSBsb2NhbFN0b3JhZ2UgY2hhbmdlIGluIHRoZSBmb3JlZ3JvdW5kIHdpbmRvdw0KICAgICAgICAgICAgLy8gd2lsbCBub3QgYmUgZGV0ZWN0ZWQgaW4gdGhlIGJhY2tncm91bmQgd2luZG93IHZpYSB0aGUgc3RvcmFnZSBldmVudC4NCiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGRldGVjdGVkIGluIGlPUyA3LnggbW9iaWxlIGJyb3dzZXJzDQogICAgICAgICAgICBpZiAodGhpcy5mYWxsYmFja1RvUG9sbGluZykgew0KICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaExpc3RlbmVyKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbmVyc1trZXldKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLg0KICAgICAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTsNCiAgICB9DQogICAgX3JlbW92ZUxpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHsNCiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uZGVsZXRlKGxpc3RlbmVyKTsNCiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldLnNpemUgPT09IDApIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5kZXRhY2hMaXN0ZW5lcigpOw0KICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIFVwZGF0ZSBsb2NhbCBjYWNoZSBvbiBiYXNlIG9wZXJhdGlvbnM6DQogICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7DQogICAgICAgIGF3YWl0IHN1cGVyLl9zZXQoa2V5LCB2YWx1ZSk7DQogICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KICAgIH0NCiAgICBhc3luYyBfZ2V0KGtleSkgew0KICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHN1cGVyLl9nZXQoa2V5KTsNCiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICB9DQogICAgYXN5bmMgX3JlbW92ZShrZXkpIHsNCiAgICAgICAgYXdhaXQgc3VwZXIuX3JlbW92ZShrZXkpOw0KICAgICAgICBkZWxldGUgdGhpcy5sb2NhbENhY2hlW2tleV07DQogICAgfQ0KfQ0KQnJvd3NlckxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7DQovKioNCiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSBgTE9DQUxgIHVzaW5nIGBsb2NhbFN0b3JhZ2VgDQogKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlID0gQnJvd3NlckxvY2FsUGVyc2lzdGVuY2U7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBCcm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlIGV4dGVuZHMgQnJvd3NlclBlcnNpc3RlbmNlQ2xhc3Mgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigoKSA9PiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UsICJTRVNTSU9OIiAvKiBQZXJzaXN0ZW5jZVR5cGUuU0VTU0lPTiAqLyk7DQogICAgfQ0KICAgIF9hZGRMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHsNCiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBzZXNzaW9uIHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIF9yZW1vdmVMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHsNCiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBzZXNzaW9uIHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cw0KICAgICAgICByZXR1cm47DQogICAgfQ0KfQ0KQnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZS50eXBlID0gJ1NFU1NJT04nOw0KLyoqDQogKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIGBTRVNTSU9OYCB1c2luZyBgc2Vzc2lvblN0b3JhZ2VgDQogKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UgPSBCcm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBTaGltIGZvciBQcm9taXNlLmFsbFNldHRsZWQsIG5vdGUgdGhlIHNsaWdodGx5IGRpZmZlcmVudCBmb3JtYXQgb2YgYGZ1bGZpbGxlZGAgdnMgYHN0YXR1c2AuDQogKg0KICogQHBhcmFtIHByb21pc2VzIC0gQXJyYXkgb2YgcHJvbWlzZXMgdG8gd2FpdCBvbi4NCiAqLw0KZnVuY3Rpb24gX2FsbFNldHRsZWQocHJvbWlzZXMpIHsNCiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKGFzeW5jIChwcm9taXNlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHByb21pc2U7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgICB2YWx1ZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocmVhc29uKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgcmVhc29uDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfSkpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBJbnRlcmZhY2UgY2xhc3MgZm9yIHJlY2VpdmluZyBtZXNzYWdlcy4NCiAqDQogKi8NCmNsYXNzIFJlY2VpdmVyIHsNCiAgICBjb25zdHJ1Y3RvcihldmVudFRhcmdldCkgew0KICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0ID0gZXZlbnRUYXJnZXQ7DQogICAgICAgIHRoaXMuaGFuZGxlcnNNYXAgPSB7fTsNCiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTsNCiAgICB9DQogICAgLyoqDQogICAgICogT2J0YWluIGFuIGluc3RhbmNlIG9mIGEgUmVjZWl2ZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgdGFyZ2V0LCBpZiBub25lIGV4aXN0cyBpdCB3aWxsIGJlIGNyZWF0ZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnRUYXJnZXQgLSBBbiBldmVudCB0YXJnZXQgKHN1Y2ggYXMgd2luZG93IG9yIHNlbGYpIHRocm91Z2ggd2hpY2ggdGhlIHVuZGVybHlpbmcNCiAgICAgKiBtZXNzYWdlcyB3aWxsIGJlIHJlY2VpdmVkLg0KICAgICAqLw0KICAgIHN0YXRpYyBfZ2V0SW5zdGFuY2UoZXZlbnRUYXJnZXQpIHsNCiAgICAgICAgLy8gVGhlIHJlc3VsdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBzaW5jZSBvYmplY3RzIGNhbid0IGJlIGtleXMgZm9yIG90aGVyDQogICAgICAgIC8vIG9iamVjdHMuIEluIGFkZGl0aW9uLCBzZXR0aW5nIGEgdW5pcXVlIHByb3BlcnR5IG9uIGFuIGV2ZW50IHRhcmdldCBhcyBhDQogICAgICAgIC8vIGhhc2ggbWFwIGtleSBtYXkgbm90IGJlIGFsbG93ZWQgZHVlIHRvIENPUlMgcmVzdHJpY3Rpb25zLg0KICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5yZWNlaXZlcnMuZmluZChyZWNlaXZlciA9PiByZWNlaXZlci5pc0xpc3RlbmluZ3RvKGV2ZW50VGFyZ2V0KSk7DQogICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7DQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdJbnN0YW5jZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBuZXdJbnN0YW5jZSA9IG5ldyBSZWNlaXZlcihldmVudFRhcmdldCk7DQogICAgICAgIHRoaXMucmVjZWl2ZXJzLnB1c2gobmV3SW5zdGFuY2UpOw0KICAgICAgICByZXR1cm4gbmV3SW5zdGFuY2U7DQogICAgfQ0KICAgIGlzTGlzdGVuaW5ndG8oZXZlbnRUYXJnZXQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXQgPT09IGV2ZW50VGFyZ2V0Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBGYW5zIG91dCBhIE1lc3NhZ2VFdmVudCB0byB0aGUgYXBwcm9wcmlhdGUgbGlzdGVuZXJzLg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBTZW5kcyBhbiB7QGxpbmsgU3RhdHVzLkFDS30gdXBvbiByZWNlaXB0IGFuZCBhIHtAbGluayBTdGF0dXMuRE9ORX0gb25jZSBhbGwgaGFuZGxlcnMgaGF2ZQ0KICAgICAqIGZpbmlzaGVkIHByb2Nlc3NpbmcuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnQgLSBUaGUgTWVzc2FnZUV2ZW50Lg0KICAgICAqDQogICAgICovDQogICAgYXN5bmMgaGFuZGxlRXZlbnQoZXZlbnQpIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7DQogICAgICAgIGNvbnN0IHsgZXZlbnRJZCwgZXZlbnRUeXBlLCBkYXRhIH0gPSBtZXNzYWdlRXZlbnQuZGF0YTsNCiAgICAgICAgY29uc3QgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV07DQogICAgICAgIGlmICghKGhhbmRsZXJzID09PSBudWxsIHx8IGhhbmRsZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoYW5kbGVycy5zaXplKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIG1lc3NhZ2VFdmVudC5wb3J0c1swXS5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICBzdGF0dXM6ICJhY2siIC8qIF9TdGF0dXMuQUNLICovLA0KICAgICAgICAgICAgZXZlbnRJZCwNCiAgICAgICAgICAgIGV2ZW50VHlwZQ0KICAgICAgICB9KTsNCiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKGhhbmRsZXJzKS5tYXAoYXN5bmMgKGhhbmRsZXIpID0+IGhhbmRsZXIobWVzc2FnZUV2ZW50Lm9yaWdpbiwgZGF0YSkpOw0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9hbGxTZXR0bGVkKHByb21pc2VzKTsNCiAgICAgICAgbWVzc2FnZUV2ZW50LnBvcnRzWzBdLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgIHN0YXR1czogImRvbmUiIC8qIF9TdGF0dXMuRE9ORSAqLywNCiAgICAgICAgICAgIGV2ZW50SWQsDQogICAgICAgICAgICBldmVudFR5cGUsDQogICAgICAgICAgICByZXNwb25zZQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogU3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZm9yIGEgcGFydGljdWxhciBldmVudC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBldmVudFR5cGUgLSBFdmVudCBuYW1lIHRvIHN1YnNjcmliZSB0by4NCiAgICAgKiBAcGFyYW0gZXZlbnRIYW5kbGVyIC0gVGhlIGV2ZW50IGhhbmRsZXIgd2hpY2ggc2hvdWxkIHJlY2VpdmUgdGhlIGV2ZW50cy4NCiAgICAgKg0KICAgICAqLw0KICAgIF9zdWJzY3JpYmUoZXZlbnRUeXBlLCBldmVudEhhbmRsZXIpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuaGFuZGxlcnNNYXApLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5ldmVudFRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0pIHsNCiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSA9IG5ldyBTZXQoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0uYWRkKGV2ZW50SGFuZGxlcik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVuc3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZnJvbSBhIHBhcnRpY3VsYXIgZXZlbnQuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgbmFtZSB0byB1bnN1YnNjcmliZSBmcm9tLg0KICAgICAqIEBwYXJhbSBldmVudEhhbmRsZXIgLSBPcHRpbm9hbCBldmVudCBoYW5kbGVyLCBpZiBub25lIHByb3ZpZGVkLCB1bnN1YnNjcmliZSBhbGwgaGFuZGxlcnMgb24gdGhpcyBldmVudC4NCiAgICAgKg0KICAgICAqLw0KICAgIF91bnN1YnNjcmliZShldmVudFR5cGUsIGV2ZW50SGFuZGxlcikgew0KICAgICAgICBpZiAodGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdICYmIGV2ZW50SGFuZGxlcikgew0KICAgICAgICAgICAgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdLmRlbGV0ZShldmVudEhhbmRsZXIpOw0KICAgICAgICB9DQogICAgICAgIGlmICghZXZlbnRIYW5kbGVyIHx8IHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXS5zaXplID09PSAwKSB7DQogICAgICAgICAgICBkZWxldGUgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdOw0KICAgICAgICB9DQogICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmhhbmRsZXJzTWFwKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuZXZlbnRUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KUmVjZWl2ZXIucmVjZWl2ZXJzID0gW107CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfZ2VuZXJhdGVFdmVudElkKHByZWZpeCA9ICcnLCBkaWdpdHMgPSAxMCkgew0KICAgIGxldCByYW5kb20gPSAnJzsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpZ2l0czsgaSsrKSB7DQogICAgICAgIHJhbmRvbSArPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7DQogICAgfQ0KICAgIHJldHVybiBwcmVmaXggKyByYW5kb207DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEludGVyZmFjZSBmb3Igc2VuZGluZyBtZXNzYWdlcyBhbmQgd2FpdGluZyBmb3IgYSBjb21wbGV0aW9uIHJlc3BvbnNlLg0KICoNCiAqLw0KY2xhc3MgU2VuZGVyIHsNCiAgICBjb25zdHJ1Y3Rvcih0YXJnZXQpIHsNCiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7DQogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBuZXcgU2V0KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVuc3Vic2NyaWJlIHRoZSBoYW5kbGVyIGFuZCByZW1vdmUgaXQgZnJvbSBvdXIgdHJhY2tpbmcgU2V0Lg0KICAgICAqDQogICAgICogQHBhcmFtIGhhbmRsZXIgLSBUaGUgaGFuZGxlciB0byB1bnN1YnNjcmliZS4NCiAgICAgKi8NCiAgICByZW1vdmVNZXNzYWdlSGFuZGxlcihoYW5kbGVyKSB7DQogICAgICAgIGlmIChoYW5kbGVyLm1lc3NhZ2VDaGFubmVsKSB7DQogICAgICAgICAgICBoYW5kbGVyLm1lc3NhZ2VDaGFubmVsLnBvcnQxLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVyLm9uTWVzc2FnZSk7DQogICAgICAgICAgICBoYW5kbGVyLm1lc3NhZ2VDaGFubmVsLnBvcnQxLmNsb3NlKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5oYW5kbGVycy5kZWxldGUoaGFuZGxlcik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFNlbmQgYSBtZXNzYWdlIHRvIHRoZSBSZWNlaXZlciBsb2NhdGVkIGF0IHtAbGluayB0YXJnZXR9Lg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBXZSdsbCBmaXJzdCB3YWl0IGEgYml0IGZvciBhbiBBQ0sgLCBpZiB3ZSBnZXQgb25lIHdlIHdpbGwgd2FpdCBzaWduaWZpY2FudGx5IGxvbmdlciB1bnRpbCB0aGUNCiAgICAgKiByZWNlaXZlciBoYXMgaGFkIGEgY2hhbmNlIHRvIGZ1bGx5IHByb2Nlc3MgdGhlIGV2ZW50Lg0KICAgICAqDQogICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIFR5cGUgb2YgZXZlbnQgdG8gc2VuZC4NCiAgICAgKiBAcGFyYW0gZGF0YSAtIFRoZSBwYXlsb2FkIG9mIHRoZSBldmVudC4NCiAgICAgKiBAcGFyYW0gdGltZW91dCAtIFRpbWVvdXQgZm9yIHdhaXRpbmcgb24gYW4gQUNLIGZyb20gdGhlIHJlY2VpdmVyLg0KICAgICAqDQogICAgICogQHJldHVybnMgQW4gYXJyYXkgb2Ygc2V0dGxlZCBwcm9taXNlcyBmcm9tIGFsbCB0aGUgaGFuZGxlcnMgdGhhdCB3ZXJlIGxpc3RlbmluZyBvbiB0aGUgcmVjZWl2ZXIuDQogICAgICovDQogICAgYXN5bmMgX3NlbmQoZXZlbnRUeXBlLCBkYXRhLCB0aW1lb3V0ID0gNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZUNoYW5uZWwgPSB0eXBlb2YgTWVzc2FnZUNoYW5uZWwgIT09ICd1bmRlZmluZWQnID8gbmV3IE1lc3NhZ2VDaGFubmVsKCkgOiBudWxsOw0KICAgICAgICBpZiAoIW1lc3NhZ2VDaGFubmVsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNvbm5lY3Rpb25fdW5hdmFpbGFibGUiIC8qIF9NZXNzYWdlRXJyb3IuQ09OTkVDVElPTl9VTkFWQUlMQUJMRSAqLyk7DQogICAgICAgIH0NCiAgICAgICAgLy8gTm9kZSB0aW1lcnMgYW5kIGJyb3dzZXIgdGltZXJzIHJldHVybiBmdW5kYW1lbnRhbGx5IGRpZmZlcmVudCB0eXBlcy4NCiAgICAgICAgLy8gV2UgZG9uJ3QgYWN0dWFsbHkgY2FyZSB3aGF0IHRoZSB2YWx1ZSBpcyBidXQgVFMgd29uJ3QgYWNjZXB0IHVua25vd24gYW5kDQogICAgICAgIC8vIHdlIGNhbid0IGNhc3QgcHJvcGVybHkgaW4gYm90aCBlbnZpcm9ubWVudHMuDQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgIGxldCBjb21wbGV0aW9uVGltZXI7DQogICAgICAgIGxldCBoYW5kbGVyOw0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgY29uc3QgZXZlbnRJZCA9IF9nZW5lcmF0ZUV2ZW50SWQoJycsIDIwKTsNCiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLnN0YXJ0KCk7DQogICAgICAgICAgICBjb25zdCBhY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInVuc3VwcG9ydGVkX2V2ZW50IiAvKiBfTWVzc2FnZUVycm9yLlVOU1VQUE9SVEVEX0VWRU5UICovKSk7DQogICAgICAgICAgICB9LCB0aW1lb3V0KTsNCiAgICAgICAgICAgIGhhbmRsZXIgPSB7DQogICAgICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwsDQogICAgICAgICAgICAgICAgb25NZXNzYWdlKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VFdmVudCA9IGV2ZW50Ow0KICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZUV2ZW50LmRhdGEuZXZlbnRJZCAhPT0gZXZlbnRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZUV2ZW50LmRhdGEuc3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhY2siIC8qIF9TdGF0dXMuQUNLICovOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZWNlaXZlciBzaG91bGQgQUNLIGZpcnN0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhY2tUaW1lcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvblRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInRpbWVvdXQiIC8qIF9NZXNzYWdlRXJyb3IuVElNRU9VVCAqLykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMDAgLyogX1RpbWVvdXREdXJhdGlvbi5DT01QTEVUSU9OICovKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRvbmUiIC8qIF9TdGF0dXMuRE9ORSAqLzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmNlIHRoZSByZWNlaXZlcidzIGhhbmRsZXJzIGFyZSBmaW5pc2hlZCB3ZSB3aWxsIGdldCB0aGUgcmVzdWx0cy4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2VFdmVudC5kYXRhLnJlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGFja1RpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJpbnZhbGlkX3Jlc3BvbnNlIiAvKiBfTWVzc2FnZUVycm9yLklOVkFMSURfUkVTUE9OU0UgKi8pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0aGlzLmhhbmRsZXJzLmFkZChoYW5kbGVyKTsNCiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVyLm9uTWVzc2FnZSk7DQogICAgICAgICAgICB0aGlzLnRhcmdldC5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICAgICAgZXZlbnRUeXBlLA0KICAgICAgICAgICAgICAgIGV2ZW50SWQsDQogICAgICAgICAgICAgICAgZGF0YQ0KICAgICAgICAgICAgfSwgW21lc3NhZ2VDaGFubmVsLnBvcnQyXSk7DQogICAgICAgIH0pLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIExhenkgYWNjZXNzb3IgZm9yIHdpbmRvdywgc2luY2UgdGhlIGNvbXBhdCBsYXllciB3b24ndCB0cmVlIHNoYWtlIHRoaXMgb3V0LA0KICogd2UgbmVlZCB0byBtYWtlIHN1cmUgbm90IHRvIG1lc3Mgd2l0aCB3aW5kb3cgdW5sZXNzIHdlIGhhdmUgdG8NCiAqLw0KZnVuY3Rpb24gX3dpbmRvdygpIHsNCiAgICByZXR1cm4gd2luZG93Ow0KfQ0KZnVuY3Rpb24gX3NldFdpbmRvd0xvY2F0aW9uKHVybCkgew0KICAgIF93aW5kb3coKS5sb2NhdGlvbi5ocmVmID0gdXJsOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy4NCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIF9pc1dvcmtlcigpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBfd2luZG93KClbJ1dvcmtlckdsb2JhbFNjb3BlJ10gIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgIHR5cGVvZiBfd2luZG93KClbJ2ltcG9ydFNjcmlwdHMnXSA9PT0gJ2Z1bmN0aW9uJyk7DQp9DQphc3luYyBmdW5jdGlvbiBfZ2V0QWN0aXZlU2VydmljZVdvcmtlcigpIHsNCiAgICBpZiAoIShuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5Ow0KICAgICAgICByZXR1cm4gcmVnaXN0cmF0aW9uLmFjdGl2ZTsNCiAgICB9DQogICAgY2F0Y2ggKF9hKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCn0NCmZ1bmN0aW9uIF9nZXRTZXJ2aWNlV29ya2VyQ29udHJvbGxlcigpIHsNCiAgICB2YXIgX2E7DQogICAgcmV0dXJuICgoX2EgPSBuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbnRyb2xsZXIpIHx8IG51bGw7DQp9DQpmdW5jdGlvbiBfZ2V0V29ya2VyR2xvYmFsU2NvcGUoKSB7DQogICAgcmV0dXJuIF9pc1dvcmtlcigpID8gc2VsZiA6IG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBEQl9OQU1FID0gJ2ZpcmViYXNlTG9jYWxTdG9yYWdlRGInOw0KY29uc3QgREJfVkVSU0lPTiA9IDE7DQpjb25zdCBEQl9PQkpFQ1RTVE9SRV9OQU1FID0gJ2ZpcmViYXNlTG9jYWxTdG9yYWdlJzsNCmNvbnN0IERCX0RBVEFfS0VZUEFUSCA9ICdmYmFzZV9rZXknOw0KLyoqDQogKiBQcm9taXNlIHdyYXBwZXIgZm9yIElEQlJlcXVlc3QNCiAqDQogKiBVbmZvcnR1bmF0ZWx5IHdlIGNhbid0IGNsZWFubHkgZXh0ZW5kIFByb21pc2U8VD4gc2luY2UgcHJvbWlzZXMgYXJlIG5vdCBjYWxsYWJsZSBpbiBFUzYNCiAqDQogKi8NCmNsYXNzIERCUHJvbWlzZSB7DQogICAgY29uc3RydWN0b3IocmVxdWVzdCkgew0KICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0Ow0KICAgIH0NCiAgICB0b1Byb21pc2UoKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0aGlzLnJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsICgpID0+IHsNCiAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMucmVxdWVzdC5yZXN1bHQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLnJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgcmVqZWN0KHRoaXMucmVxdWVzdC5lcnJvcik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gZ2V0T2JqZWN0U3RvcmUoZGIsIGlzUmVhZFdyaXRlKSB7DQogICAgcmV0dXJuIGRiDQogICAgICAgIC50cmFuc2FjdGlvbihbREJfT0JKRUNUU1RPUkVfTkFNRV0sIGlzUmVhZFdyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKQ0KICAgICAgICAub2JqZWN0U3RvcmUoREJfT0JKRUNUU1RPUkVfTkFNRSk7DQp9DQpmdW5jdGlvbiBfZGVsZXRlRGF0YWJhc2UoKSB7DQogICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShEQl9OQU1FKTsNCiAgICByZXR1cm4gbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTsNCn0NCmZ1bmN0aW9uIF9vcGVuRGF0YWJhc2UoKSB7DQogICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKERCX05BTUUsIERCX1ZFUlNJT04pOw0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7DQogICAgICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7DQogICAgICAgIH0pOw0KICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoKSA9PiB7DQogICAgICAgICAgICBjb25zdCBkYiA9IHJlcXVlc3QucmVzdWx0Ow0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShEQl9PQkpFQ1RTVE9SRV9OQU1FLCB7IGtleVBhdGg6IERCX0RBVEFfS0VZUEFUSCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgcmVqZWN0KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgZGIgPSByZXF1ZXN0LnJlc3VsdDsNCiAgICAgICAgICAgIC8vIFN0cmFuZ2UgYnVnIHRoYXQgb2NjdXJzIGluIEZpcmVmb3ggd2hlbiBtdWx0aXBsZSB0YWJzIGFyZSBvcGVuZWQgYXQgdGhlDQogICAgICAgICAgICAvLyBzYW1lIHRpbWUuIFRoZSBvbmx5IHdheSB0byByZWNvdmVyIHNlZW1zIHRvIGJlIGRlbGV0aW5nIHRoZSBkYXRhYmFzZQ0KICAgICAgICAgICAgLy8gYW5kIHJlLWluaXRpYWxpemluZyBpdC4NCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzYzNA0KICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKERCX09CSkVDVFNUT1JFX05BTUUpKSB7DQogICAgICAgICAgICAgICAgLy8gTmVlZCB0byBjbG9zZSB0aGUgZGF0YWJhc2Ugb3IgZWxzZSB5b3UgZ2V0IGEgYGJsb2NrZWRgIGV2ZW50DQogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBhd2FpdCBfZGVsZXRlRGF0YWJhc2UoKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKGF3YWl0IF9vcGVuRGF0YWJhc2UoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXNvbHZlKGRiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQphc3luYyBmdW5jdGlvbiBfcHV0T2JqZWN0KGRiLCBrZXksIHZhbHVlKSB7DQogICAgY29uc3QgcmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCB0cnVlKS5wdXQoew0KICAgICAgICBbREJfREFUQV9LRVlQQVRIXToga2V5LA0KICAgICAgICB2YWx1ZQ0KICAgIH0pOw0KICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpOw0KfQ0KYXN5bmMgZnVuY3Rpb24gZ2V0T2JqZWN0KGRiLCBrZXkpIHsNCiAgICBjb25zdCByZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIGZhbHNlKS5nZXQoa2V5KTsNCiAgICBjb25zdCBkYXRhID0gYXdhaXQgbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTsNCiAgICByZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGRhdGEudmFsdWU7DQp9DQpmdW5jdGlvbiBfZGVsZXRlT2JqZWN0KGRiLCBrZXkpIHsNCiAgICBjb25zdCByZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIHRydWUpLmRlbGV0ZShrZXkpOw0KICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpOw0KfQ0KY29uc3QgX1BPTExJTkdfSU5URVJWQUxfTVMgPSA4MDA7DQpjb25zdCBfVFJBTlNBQ1RJT05fUkVUUllfQ09VTlQgPSAzOw0KY2xhc3MgSW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMudHlwZSA9ICJMT0NBTCIgLyogUGVyc2lzdGVuY2VUeXBlLkxPQ0FMICovOw0KICAgICAgICB0aGlzLl9zaG91bGRBbGxvd01pZ3JhdGlvbiA9IHRydWU7DQogICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307DQogICAgICAgIHRoaXMubG9jYWxDYWNoZSA9IHt9Ow0KICAgICAgICAvLyBzZXRUaW1lb3V0IHJldHVybiB2YWx1ZSBpcyBwbGF0Zm9ybSBzcGVjaWZpYw0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7DQogICAgICAgIHRoaXMucGVuZGluZ1dyaXRlcyA9IDA7DQogICAgICAgIHRoaXMucmVjZWl2ZXIgPSBudWxsOw0KICAgICAgICB0aGlzLnNlbmRlciA9IG51bGw7DQogICAgICAgIHRoaXMuc2VydmljZVdvcmtlclJlY2VpdmVyQXZhaWxhYmxlID0gZmFsc2U7DQogICAgICAgIHRoaXMuYWN0aXZlU2VydmljZVdvcmtlciA9IG51bGw7DQogICAgICAgIC8vIEZpcmUgJiBmb3JnZXQgdGhlIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiBhcyBpdCBtYXkgbmV2ZXIgcmVzb2x2ZQ0KICAgICAgICB0aGlzLl93b3JrZXJJbml0aWFsaXphdGlvblByb21pc2UgPQ0KICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplU2VydmljZVdvcmtlck1lc3NhZ2luZygpLnRoZW4oKCkgPT4geyB9LCAoKSA9PiB7IH0pOw0KICAgIH0NCiAgICBhc3luYyBfb3BlbkRiKCkgew0KICAgICAgICBpZiAodGhpcy5kYikgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGI7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5kYiA9IGF3YWl0IF9vcGVuRGF0YWJhc2UoKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGI7DQogICAgfQ0KICAgIGFzeW5jIF93aXRoUmV0cmllcyhvcCkgew0KICAgICAgICBsZXQgbnVtQXR0ZW1wdHMgPSAwOw0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IHRoaXMuX29wZW5EYigpOw0KICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBvcChkYik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGlmIChudW1BdHRlbXB0cysrID4gX1RSQU5TQUNUSU9OX1JFVFJZX0NPVU5UKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmRiKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYiA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIGV4cG9uZW50aWFsIGJhY2tvZmYNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBJbmRleGVkREIgZXZlbnRzIGRvIG5vdCBwcm9wYWdhdGUgZnJvbSB0aGUgbWFpbiB3aW5kb3cgdG8gdGhlIHdvcmtlciBjb250ZXh0LiAgV2UgcmVseSBvbiBhDQogICAgICogcG9zdE1lc3NhZ2UgaW50ZXJmYWNlIHRvIHNlbmQgdGhlc2UgZXZlbnRzIHRvIHRoZSB3b3JrZXIgb3Vyc2VsdmVzLg0KICAgICAqLw0KICAgIGFzeW5jIGluaXRpYWxpemVTZXJ2aWNlV29ya2VyTWVzc2FnaW5nKCkgew0KICAgICAgICByZXR1cm4gX2lzV29ya2VyKCkgPyB0aGlzLmluaXRpYWxpemVSZWNlaXZlcigpIDogdGhpcy5pbml0aWFsaXplU2VuZGVyKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEFzIHRoZSB3b3JrZXIgd2Ugc2hvdWxkIGxpc3RlbiB0byBldmVudHMgZnJvbSB0aGUgbWFpbiB3aW5kb3cuDQogICAgICovDQogICAgYXN5bmMgaW5pdGlhbGl6ZVJlY2VpdmVyKCkgew0KICAgICAgICB0aGlzLnJlY2VpdmVyID0gUmVjZWl2ZXIuX2dldEluc3RhbmNlKF9nZXRXb3JrZXJHbG9iYWxTY29wZSgpKTsNCiAgICAgICAgLy8gUmVmcmVzaCBmcm9tIHBlcnNpc3RlbmNlIGlmIHdlIHJlY2VpdmUgYSBLZXlDaGFuZ2VkIG1lc3NhZ2UuDQogICAgICAgIHRoaXMucmVjZWl2ZXIuX3N1YnNjcmliZSgia2V5Q2hhbmdlZCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLywgYXN5bmMgKF9vcmlnaW4sIGRhdGEpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLl9wb2xsKCk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGtleVByb2Nlc3NlZDoga2V5cy5pbmNsdWRlcyhkYXRhLmtleSkNCiAgICAgICAgICAgIH07DQogICAgICAgIH0pOw0KICAgICAgICAvLyBMZXQgdGhlIHNlbmRlciBrbm93IHRoYXQgd2UgYXJlIGxpc3RlbmluZyBzbyB0aGV5IGdpdmUgdXMgbW9yZSB0aW1lb3V0Lg0KICAgICAgICB0aGlzLnJlY2VpdmVyLl9zdWJzY3JpYmUoInBpbmciIC8qIF9FdmVudFR5cGUuUElORyAqLywgYXN5bmMgKF9vcmlnaW4sIF9kYXRhKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gWyJrZXlDaGFuZ2VkIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovXTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEFzIHRoZSBtYWluIHdpbmRvdywgd2Ugc2hvdWxkIGxldCB0aGUgd29ya2VyIGtub3cgd2hlbiBrZXlzIGNoYW5nZSAoc2V0IGFuZCByZW1vdmUpLg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1NlcnZpY2VXb3JrZXJDb250YWluZXIvcmVhZHkgfCBTZXJ2aWNlV29ya2VyQ29udGFpbmVyLnJlYWR5fQ0KICAgICAqIG1heSBub3QgcmVzb2x2ZS4NCiAgICAgKi8NCiAgICBhc3luYyBpbml0aWFsaXplU2VuZGVyKCkgew0KICAgICAgICB2YXIgX2EsIF9iOw0KICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhbiBhY3RpdmUgc2VydmljZSB3b3JrZXIuDQogICAgICAgIHRoaXMuYWN0aXZlU2VydmljZVdvcmtlciA9IGF3YWl0IF9nZXRBY3RpdmVTZXJ2aWNlV29ya2VyKCk7DQogICAgICAgIGlmICghdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZW5kZXIgPSBuZXcgU2VuZGVyKHRoaXMuYWN0aXZlU2VydmljZVdvcmtlcik7DQogICAgICAgIC8vIFBpbmcgdGhlIHNlcnZpY2Ugd29ya2VyIHRvIGNoZWNrIHdoYXQgZXZlbnRzIHRoZXkgY2FuIGhhbmRsZS4NCiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuc2VuZGVyLl9zZW5kKCJwaW5nIiAvKiBfRXZlbnRUeXBlLlBJTkcgKi8sIHt9LCA4MDAgLyogX1RpbWVvdXREdXJhdGlvbi5MT05HX0FDSyAqLyk7DQogICAgICAgIGlmICghcmVzdWx0cykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICgoKF9hID0gcmVzdWx0c1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZ1bGZpbGxlZCkgJiYNCiAgICAgICAgICAgICgoX2IgPSByZXN1bHRzWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudmFsdWUuaW5jbHVkZXMoImtleUNoYW5nZWQiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi8pKSkgew0KICAgICAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUgPSB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIExldCB0aGUgd29ya2VyIGtub3cgYWJvdXQgYSBjaGFuZ2VkIGtleSwgdGhlIGV4YWN0IGtleSBkb2Vzbid0IHRlY2huaWNhbGx5IG1hdHRlciBzaW5jZSB0aGUNCiAgICAgKiB3b3JrZXIgd2lsbCBqdXN0IHRyaWdnZXIgYSBmdWxsIHN5bmMgYW55d2F5Lg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBGb3Igbm93LCB3ZSBvbmx5IHN1cHBvcnQgb25lIHNlcnZpY2Ugd29ya2VyIHBlciBwYWdlLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIFN0b3JhZ2Uga2V5IHdoaWNoIGNoYW5nZWQuDQogICAgICovDQogICAgYXN5bmMgbm90aWZ5U2VydmljZVdvcmtlcihrZXkpIHsNCiAgICAgICAgaWYgKCF0aGlzLnNlbmRlciB8fA0KICAgICAgICAgICAgIXRoaXMuYWN0aXZlU2VydmljZVdvcmtlciB8fA0KICAgICAgICAgICAgX2dldFNlcnZpY2VXb3JrZXJDb250cm9sbGVyKCkgIT09IHRoaXMuYWN0aXZlU2VydmljZVdvcmtlcikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRlci5fc2VuZCgia2V5Q2hhbmdlZCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLywgeyBrZXkgfSwgDQogICAgICAgICAgICAvLyBVc2UgbG9uZyB0aW1lb3V0IGlmIHJlY2VpdmVyIGhhcyBwcmV2aW91c2x5IHJlc3BvbmRlZCB0byBhIHBpbmcgZnJvbSB1cy4NCiAgICAgICAgICAgIHRoaXMuc2VydmljZVdvcmtlclJlY2VpdmVyQXZhaWxhYmxlDQogICAgICAgICAgICAgICAgPyA4MDAgLyogX1RpbWVvdXREdXJhdGlvbi5MT05HX0FDSyAqLw0KICAgICAgICAgICAgICAgIDogNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGJlc3QgZWZmb3J0IGFwcHJvYWNoLiBJZ25vcmUgZXJyb3JzLg0KICAgICAgICB9DQogICAgfQ0KICAgIGFzeW5jIF9pc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghaW5kZXhlZERCKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZGIgPSBhd2FpdCBfb3BlbkRhdGFiYXNlKCk7DQogICAgICAgICAgICBhd2FpdCBfcHV0T2JqZWN0KGRiLCBTVE9SQUdFX0FWQUlMQUJMRV9LRVksICcxJyk7DQogICAgICAgICAgICBhd2FpdCBfZGVsZXRlT2JqZWN0KGRiLCBTVE9SQUdFX0FWQUlMQUJMRV9LRVkpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7IH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBhc3luYyBfd2l0aFBlbmRpbmdXcml0ZSh3cml0ZSkgew0KICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMrKzsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IHdyaXRlKCk7DQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMtLTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBhc3luYyBfc2V0KGtleSwgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX3dpdGhQZW5kaW5nV3JpdGUoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiBfcHV0T2JqZWN0KGRiLCBrZXksIHZhbHVlKSk7DQogICAgICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgYXN5bmMgX2dldChrZXkpIHsNCiAgICAgICAgY29uc3Qgb2JqID0gKGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4gZ2V0T2JqZWN0KGRiLCBrZXkpKSk7DQogICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gb2JqOw0KICAgICAgICByZXR1cm4gb2JqOw0KICAgIH0NCiAgICBhc3luYyBfcmVtb3ZlKGtleSkgew0KICAgICAgICByZXR1cm4gdGhpcy5fd2l0aFBlbmRpbmdXcml0ZShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IF9kZWxldGVPYmplY3QoZGIsIGtleSkpOw0KICAgICAgICAgICAgZGVsZXRlIHRoaXMubG9jYWxDYWNoZVtrZXldOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgYXN5bmMgX3BvbGwoKSB7DQogICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHdlIG5lZWQgdG8gZmFsbGJhY2sgaWYgZ2V0QWxsIGlzIG5vdCBzdXBwb3J0ZWQNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBnZXRBbGxSZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIGZhbHNlKS5nZXRBbGwoKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgREJQcm9taXNlKGdldEFsbFJlcXVlc3QpLnRvUHJvbWlzZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKCFyZXN1bHQpIHsNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBJZiB3ZSBoYXZlIHBlbmRpbmcgd3JpdGVzIGluIHByb2dyZXNzIGFib3J0LCB3ZSdsbCBnZXQgcGlja2VkIHVwIG9uIHRoZSBuZXh0IHBvbGwNCiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1dyaXRlcyAhPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGtleXMgPSBbXTsNCiAgICAgICAgY29uc3Qga2V5c0luUmVzdWx0ID0gbmV3IFNldCgpOw0KICAgICAgICBmb3IgKGNvbnN0IHsgZmJhc2Vfa2V5OiBrZXksIHZhbHVlIH0gb2YgcmVzdWx0KSB7DQogICAgICAgICAgICBrZXlzSW5SZXN1bHQuYWRkKGtleSk7DQogICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5sb2NhbENhY2hlW2tleV0pICE9PSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhrZXksIHZhbHVlKTsNCiAgICAgICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGNvbnN0IGxvY2FsS2V5IG9mIE9iamVjdC5rZXlzKHRoaXMubG9jYWxDYWNoZSkpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsQ2FjaGVbbG9jYWxLZXldICYmICFrZXlzSW5SZXN1bHQuaGFzKGxvY2FsS2V5KSkgew0KICAgICAgICAgICAgICAgIC8vIERlbGV0ZWQNCiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhsb2NhbEtleSwgbnVsbCk7DQogICAgICAgICAgICAgICAga2V5cy5wdXNoKGxvY2FsS2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4ga2V5czsNCiAgICB9DQogICAgbm90aWZ5TGlzdGVuZXJzKGtleSwgbmV3VmFsdWUpIHsNCiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBuZXdWYWx1ZTsNCiAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNba2V5XTsNCiAgICAgICAgaWYgKGxpc3RlbmVycykgew0KICAgICAgICAgICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiBBcnJheS5mcm9tKGxpc3RlbmVycykpIHsNCiAgICAgICAgICAgICAgICBsaXN0ZW5lcihuZXdWYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhcnRQb2xsaW5nKCkgew0KICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7DQogICAgICAgIHRoaXMucG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gdGhpcy5fcG9sbCgpLCBfUE9MTElOR19JTlRFUlZBTF9NUyk7DQogICAgfQ0KICAgIHN0b3BQb2xsaW5nKCkgew0KICAgICAgICBpZiAodGhpcy5wb2xsVGltZXIpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpOw0KICAgICAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9hZGRMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7DQogICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycykubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICB0aGlzLnN0YXJ0UG9sbGluZygpOw0KICAgICAgICB9DQogICAgICAgIGlmICghdGhpcy5saXN0ZW5lcnNba2V5XSkgew0KICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XSA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBjYWNoZSB0byBhdm9pZCBzcHVyaW91c2x5IHRyaWdnZXJpbmcgb24gZmlyc3QgcG9sbC4NCiAgICAgICAgICAgIHZvaWQgdGhpcy5fZ2V0KGtleSk7IC8vIFRoaXMgY2FuIGhhcHBlbiBpbiB0aGUgYmFja2dyb3VuZCBhc3luYyBhbmQgd2UgY2FuIHJldHVybiBpbW1lZGlhdGVseS4NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldLmFkZChsaXN0ZW5lcik7DQogICAgfQ0KICAgIF9yZW1vdmVMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7DQogICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldLmRlbGV0ZShsaXN0ZW5lcik7DQogICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XS5zaXplID09PSAwKSB7DQogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMubGlzdGVuZXJzW2tleV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCkluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7DQovKioNCiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSBgTE9DQUxgIHVzaW5nIGBpbmRleGVkREJgDQogKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UgPSBJbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlOwpuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTsNCgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIENob29zZXMgYSBwb3B1cC9yZWRpcmVjdCByZXNvbHZlciB0byB1c2UuIFRoaXMgcHJlZmVycyB0aGUgb3ZlcnJpZGUgKHdoaWNoDQogKiBpcyBkaXJlY3RseSBwYXNzZWQgaW4pLCBhbmQgZmFsbHMgYmFjayB0byB0aGUgcHJvcGVydHkgc2V0IG9uIHRoZSBhdXRoDQogKiBvYmplY3QuIElmIG5laXRoZXIgYXJlIGF2YWlsYWJsZSwgdGhpcyBmdW5jdGlvbiBlcnJvcnMgdy8gYW4gYXJndW1lbnQgZXJyb3IuDQogKi8NCmZ1bmN0aW9uIF93aXRoRGVmYXVsdFJlc29sdmVyKGF1dGgsIHJlc29sdmVyT3ZlcnJpZGUpIHsNCiAgICBpZiAocmVzb2x2ZXJPdmVycmlkZSkgew0KICAgICAgICByZXR1cm4gX2dldEluc3RhbmNlKHJlc29sdmVyT3ZlcnJpZGUpOw0KICAgIH0NCiAgICBfYXNzZXJ0KGF1dGguX3BvcHVwUmVkaXJlY3RSZXNvbHZlciwgYXV0aCwgImFyZ3VtZW50LWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTsNCiAgICByZXR1cm4gYXV0aC5fcG9wdXBSZWRpcmVjdFJlc29sdmVyOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgSWRwQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHsNCiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsNCiAgICAgICAgc3VwZXIoImN1c3RvbSIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi8sICJjdXN0b20iIC8qIFByb3ZpZGVySWQuQ1VTVE9NICovKTsNCiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7DQogICAgfQ0KICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkgew0KICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCB0aGlzLl9idWlsZElkcFJlcXVlc3QoKSk7DQogICAgfQ0KICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHsNCiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgdGhpcy5fYnVpbGRJZHBSZXF1ZXN0KGlkVG9rZW4pKTsNCiAgICB9DQogICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7DQogICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHRoaXMuX2J1aWxkSWRwUmVxdWVzdCgpKTsNCiAgICB9DQogICAgX2J1aWxkSWRwUmVxdWVzdChpZFRva2VuKSB7DQogICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7DQogICAgICAgICAgICByZXF1ZXN0VXJpOiB0aGlzLnBhcmFtcy5yZXF1ZXN0VXJpLA0KICAgICAgICAgICAgc2Vzc2lvbklkOiB0aGlzLnBhcmFtcy5zZXNzaW9uSWQsDQogICAgICAgICAgICBwb3N0Qm9keTogdGhpcy5wYXJhbXMucG9zdEJvZHksDQogICAgICAgICAgICB0ZW5hbnRJZDogdGhpcy5wYXJhbXMudGVuYW50SWQsDQogICAgICAgICAgICBwZW5kaW5nVG9rZW46IHRoaXMucGFyYW1zLnBlbmRpbmdUb2tlbiwNCiAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLA0KICAgICAgICAgICAgcmV0dXJuSWRwQ3JlZGVudGlhbDogdHJ1ZQ0KICAgICAgICB9Ow0KICAgICAgICBpZiAoaWRUb2tlbikgew0KICAgICAgICAgICAgcmVxdWVzdC5pZFRva2VuID0gaWRUb2tlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVxdWVzdDsNCiAgICB9DQp9DQpmdW5jdGlvbiBfc2lnbkluKHBhcmFtcykgew0KICAgIHJldHVybiBfc2lnbkluV2l0aENyZWRlbnRpYWwocGFyYW1zLmF1dGgsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpOw0KfQ0KZnVuY3Rpb24gX3JlYXV0aChwYXJhbXMpIHsNCiAgICBjb25zdCB7IGF1dGgsIHVzZXIgfSA9IHBhcmFtczsNCiAgICBfYXNzZXJ0KHVzZXIsIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgcmV0dXJuIF9yZWF1dGhlbnRpY2F0ZSh1c2VyLCBuZXcgSWRwQ3JlZGVudGlhbChwYXJhbXMpLCBwYXJhbXMuYnlwYXNzQXV0aFN0YXRlKTsNCn0NCmFzeW5jIGZ1bmN0aW9uIF9saW5rKHBhcmFtcykgew0KICAgIGNvbnN0IHsgYXV0aCwgdXNlciB9ID0gcGFyYW1zOw0KICAgIF9hc3NlcnQodXNlciwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICByZXR1cm4gX2xpbmskMSh1c2VyLCBuZXcgSWRwQ3JlZGVudGlhbChwYXJhbXMpLCBwYXJhbXMuYnlwYXNzQXV0aFN0YXRlKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUG9wdXAgZXZlbnQgbWFuYWdlci4gSGFuZGxlcyB0aGUgcG9wdXAncyBlbnRpcmUgbGlmZWN5Y2xlOyBsaXN0ZW5zIHRvIGF1dGgNCiAqIGV2ZW50cw0KICovDQpjbGFzcyBBYnN0cmFjdFBvcHVwUmVkaXJlY3RPcGVyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGF1dGgsIGZpbHRlciwgcmVzb2x2ZXIsIHVzZXIsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7DQogICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7DQogICAgICAgIHRoaXMucmVzb2x2ZXIgPSByZXNvbHZlcjsNCiAgICAgICAgdGhpcy51c2VyID0gdXNlcjsNCiAgICAgICAgdGhpcy5ieXBhc3NBdXRoU3RhdGUgPSBieXBhc3NBdXRoU3RhdGU7DQogICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UgPSBudWxsOw0KICAgICAgICB0aGlzLmV2ZW50TWFuYWdlciA9IG51bGw7DQogICAgICAgIHRoaXMuZmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gZmlsdGVyIDogW2ZpbHRlcl07DQogICAgfQ0KICAgIGV4ZWN1dGUoKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0aGlzLnBlbmRpbmdQcm9taXNlID0geyByZXNvbHZlLCByZWplY3QgfTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSBhd2FpdCB0aGlzLnJlc29sdmVyLl9pbml0aWFsaXplKHRoaXMuYXV0aCk7DQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkV4ZWN1dGlvbigpOw0KICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyLnJlZ2lzdGVyQ29uc3VtZXIodGhpcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgYXN5bmMgb25BdXRoRXZlbnQoZXZlbnQpIHsNCiAgICAgICAgY29uc3QgeyB1cmxSZXNwb25zZSwgc2Vzc2lvbklkLCBwb3N0Qm9keSwgdGVuYW50SWQsIGVycm9yLCB0eXBlIH0gPSBldmVudDsNCiAgICAgICAgaWYgKGVycm9yKSB7DQogICAgICAgICAgICB0aGlzLnJlamVjdChlcnJvcik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgcGFyYW1zID0gew0KICAgICAgICAgICAgYXV0aDogdGhpcy5hdXRoLA0KICAgICAgICAgICAgcmVxdWVzdFVyaTogdXJsUmVzcG9uc2UsDQogICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZCwNCiAgICAgICAgICAgIHRlbmFudElkOiB0ZW5hbnRJZCB8fCB1bmRlZmluZWQsDQogICAgICAgICAgICBwb3N0Qm9keTogcG9zdEJvZHkgfHwgdW5kZWZpbmVkLA0KICAgICAgICAgICAgdXNlcjogdGhpcy51c2VyLA0KICAgICAgICAgICAgYnlwYXNzQXV0aFN0YXRlOiB0aGlzLmJ5cGFzc0F1dGhTdGF0ZQ0KICAgICAgICB9Ow0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdGhpcy5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0SWRwVGFzayh0eXBlKShwYXJhbXMpKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25FcnJvcihlcnJvcikgew0KICAgICAgICB0aGlzLnJlamVjdChlcnJvcik7DQogICAgfQ0KICAgIGdldElkcFRhc2sodHlwZSkgew0KICAgICAgICBzd2l0Y2ggKHR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgInNpZ25JblZpYVBvcHVwIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1BPUFVQICovOg0KICAgICAgICAgICAgY2FzZSAic2lnbkluVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIF9zaWduSW47DQogICAgICAgICAgICBjYXNlICJsaW5rVmlhUG9wdXAiIC8qIEF1dGhFdmVudFR5cGUuTElOS19WSUFfUE9QVVAgKi86DQogICAgICAgICAgICBjYXNlICJsaW5rVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuTElOS19WSUFfUkVESVJFQ1QgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIF9saW5rOw0KICAgICAgICAgICAgY2FzZSAicmVhdXRoVmlhUG9wdXAiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9QT1BVUCAqLzoNCiAgICAgICAgICAgIGNhc2UgInJlYXV0aFZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUkVESVJFQ1QgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWF1dGg7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIF9mYWlsKHRoaXMuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXNvbHZlKGNyZWQpIHsNCiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5wZW5kaW5nUHJvbWlzZSwgJ1BlbmRpbmcgcHJvbWlzZSB3YXMgbmV2ZXIgc2V0Jyk7DQogICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UucmVzb2x2ZShjcmVkKTsNCiAgICAgICAgdGhpcy51bnJlZ2lzdGVyQW5kQ2xlYW5VcCgpOw0KICAgIH0NCiAgICByZWplY3QoZXJyb3IpIHsNCiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5wZW5kaW5nUHJvbWlzZSwgJ1BlbmRpbmcgcHJvbWlzZSB3YXMgbmV2ZXIgc2V0Jyk7DQogICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgdGhpcy51bnJlZ2lzdGVyQW5kQ2xlYW5VcCgpOw0KICAgIH0NCiAgICB1bnJlZ2lzdGVyQW5kQ2xlYW5VcCgpIHsNCiAgICAgICAgaWYgKHRoaXMuZXZlbnRNYW5hZ2VyKSB7DQogICAgICAgICAgICB0aGlzLmV2ZW50TWFuYWdlci51bnJlZ2lzdGVyQ29uc3VtZXIodGhpcyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZSA9IG51bGw7DQogICAgICAgIHRoaXMuY2xlYW5VcCgpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IF9QT0xMX1dJTkRPV19DTE9TRV9USU1FT1VUID0gbmV3IERlbGF5KDIwMDAsIDEwMDAwKTsNCi8qKg0KICogUG9wdXAgZXZlbnQgbWFuYWdlci4gSGFuZGxlcyB0aGUgcG9wdXAncyBlbnRpcmUgbGlmZWN5Y2xlOyBsaXN0ZW5zIHRvIGF1dGgNCiAqIGV2ZW50cw0KICoNCiAqLw0KY2xhc3MgUG9wdXBPcGVyYXRpb24gZXh0ZW5kcyBBYnN0cmFjdFBvcHVwUmVkaXJlY3RPcGVyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGF1dGgsIGZpbHRlciwgcHJvdmlkZXIsIHJlc29sdmVyLCB1c2VyKSB7DQogICAgICAgIHN1cGVyKGF1dGgsIGZpbHRlciwgcmVzb2x2ZXIsIHVzZXIpOw0KICAgICAgICB0aGlzLnByb3ZpZGVyID0gcHJvdmlkZXI7DQogICAgICAgIHRoaXMuYXV0aFdpbmRvdyA9IG51bGw7DQogICAgICAgIHRoaXMucG9sbElkID0gbnVsbDsNCiAgICAgICAgaWYgKFBvcHVwT3BlcmF0aW9uLmN1cnJlbnRQb3B1cEFjdGlvbikgew0KICAgICAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uLmNhbmNlbCgpOw0KICAgICAgICB9DQogICAgICAgIFBvcHVwT3BlcmF0aW9uLmN1cnJlbnRQb3B1cEFjdGlvbiA9IHRoaXM7DQogICAgfQ0KICAgIGFzeW5jIGV4ZWN1dGVOb3ROdWxsKCkgew0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoKTsNCiAgICAgICAgX2Fzc2VydChyZXN1bHQsIHRoaXMuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgYXN5bmMgb25FeGVjdXRpb24oKSB7DQogICAgICAgIGRlYnVnQXNzZXJ0KHRoaXMuZmlsdGVyLmxlbmd0aCA9PT0gMSwgJ1BvcHVwIG9wZXJhdGlvbnMgb25seSBoYW5kbGUgb25lIGV2ZW50Jyk7DQogICAgICAgIGNvbnN0IGV2ZW50SWQgPSBfZ2VuZXJhdGVFdmVudElkKCk7DQogICAgICAgIHRoaXMuYXV0aFdpbmRvdyA9IGF3YWl0IHRoaXMucmVzb2x2ZXIuX29wZW5Qb3B1cCh0aGlzLmF1dGgsIHRoaXMucHJvdmlkZXIsIHRoaXMuZmlsdGVyWzBdLCAvLyBUaGVyZSdzIGFsd2F5cyBvbmUsIHNlZSBjb25zdHJ1Y3Rvcg0KICAgICAgICBldmVudElkKTsNCiAgICAgICAgdGhpcy5hdXRoV2luZG93LmFzc29jaWF0ZWRFdmVudCA9IGV2ZW50SWQ7DQogICAgICAgIC8vIENoZWNrIGZvciB3ZWIgc3RvcmFnZSBzdXBwb3J0IGFuZCBvcmlnaW4gdmFsaWRhdGlvbiBfYWZ0ZXJfIHRoZSBwb3B1cCBpcw0KICAgICAgICAvLyBsb2FkZWQuIFRoZXNlIG9wZXJhdGlvbnMgYXJlIHNsb3cgKH4xIHNlY29uZCBvciBzbykgUmF0aGVyIHRoYW4NCiAgICAgICAgLy8gd2FpdGluZyBvbiB0aGVtIGJlZm9yZSBvcGVuaW5nIHRoZSB3aW5kb3csIG9wdGltaXN0aWNhbGx5IG9wZW4gdGhlIHBvcHVwDQogICAgICAgIC8vIGFuZCBjaGVjayBmb3Igc3RvcmFnZSBzdXBwb3J0IGF0IHRoZSBzYW1lIHRpbWUuIElmIHN0b3JhZ2Ugc3VwcG9ydCBpcw0KICAgICAgICAvLyBub3QgYXZhaWxhYmxlLCB0aGlzIHdpbGwgY2F1c2UgdGhlIHdob2xlIHRoaW5nIHRvIHJlamVjdCBwcm9wZXJseS4gSXQNCiAgICAgICAgLy8gd2lsbCBhbHNvIGNsb3NlIHRoZSBwb3B1cCwgYnV0IHNpbmNlIHRoZSBwcm9taXNlIGhhcyBhbHJlYWR5IHJlamVjdGVkLA0KICAgICAgICAvLyB0aGUgcG9wdXAgY2xvc2VkIGJ5IHVzZXIgcG9sbCB3aWxsIHJlamVjdCBpbnRvIHRoZSB2b2lkLg0KICAgICAgICB0aGlzLnJlc29sdmVyLl9vcmlnaW5WYWxpZGF0aW9uKHRoaXMuYXV0aCkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICB0aGlzLnJlamVjdChlKTsNCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMucmVzb2x2ZXIuX2lzSWZyYW1lV2ViU3RvcmFnZVN1cHBvcnRlZCh0aGlzLmF1dGgsIGlzU3VwcG9ydGVkID0+IHsNCiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCAid2ViLXN0b3JhZ2UtdW5zdXBwb3J0ZWQiIC8qIEF1dGhFcnJvckNvZGUuV0VCX1NUT1JBR0VfVU5TVVBQT1JURUQgKi8pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIC8vIEhhbmRsZSB1c2VyIGNsb3N1cmUuIE5vdGljZSB0aGlzIGRvZXMgKm5vdCogdXNlIGF3YWl0DQogICAgICAgIHRoaXMucG9sbFVzZXJDYW5jZWxsYXRpb24oKTsNCiAgICB9DQogICAgZ2V0IGV2ZW50SWQoKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGhXaW5kb3cpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hc3NvY2lhdGVkRXZlbnQpIHx8IG51bGw7DQogICAgfQ0KICAgIGNhbmNlbCgpIHsNCiAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgImNhbmNlbGxlZC1wb3B1cC1yZXF1ZXN0IiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfUE9QVVBfUkVRVUVTVCAqLykpOw0KICAgIH0NCiAgICBjbGVhblVwKCkgew0KICAgICAgICBpZiAodGhpcy5hdXRoV2luZG93KSB7DQogICAgICAgICAgICB0aGlzLmF1dGhXaW5kb3cuY2xvc2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5wb2xsSWQpIHsNCiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5wb2xsSWQpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuYXV0aFdpbmRvdyA9IG51bGw7DQogICAgICAgIHRoaXMucG9sbElkID0gbnVsbDsNCiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDsNCiAgICB9DQogICAgcG9sbFVzZXJDYW5jZWxsYXRpb24oKSB7DQogICAgICAgIGNvbnN0IHBvbGwgPSAoKSA9PiB7DQogICAgICAgICAgICB2YXIgX2EsIF9iOw0KICAgICAgICAgICAgaWYgKChfYiA9IChfYSA9IHRoaXMuYXV0aFdpbmRvdykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLndpbmRvdykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNsb3NlZCkgew0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZXJlIGlzIHN1ZmZpY2llbnQgdGltZSBmb3Igd2hhdGV2ZXIgYWN0aW9uIHRvDQogICAgICAgICAgICAgICAgLy8gY29tcGxldGUuIFRoZSB3aW5kb3cgY291bGQgaGF2ZSBjbG9zZWQgYnV0IHRoZSBzaWduIGluIG5ldHdvcmsNCiAgICAgICAgICAgICAgICAvLyBjYWxsIGNvdWxkIHN0aWxsIGJlIGluIGZsaWdodC4gVGhpcyBpcyBzcGVjaWZpY2FsbHkgdHJ1ZSBmb3INCiAgICAgICAgICAgICAgICAvLyBGaXJlZm94IG9yIGlmIHRoZSBvcGVuZXIgaXMgaW4gYW4gaWZyYW1lLCBpbiB3aGljaCBjYXNlIHRoZSBvYXV0aA0KICAgICAgICAgICAgICAgIC8vIGhlbHBlciBjbG9zZXMgdGhlIHBvcHVwLg0KICAgICAgICAgICAgICAgIHRoaXMucG9sbElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGxJZCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KF9jcmVhdGVFcnJvcih0aGlzLmF1dGgsICJwb3B1cC1jbG9zZWQtYnktdXNlciIgLyogQXV0aEVycm9yQ29kZS5QT1BVUF9DTE9TRURfQllfVVNFUiAqLykpOw0KICAgICAgICAgICAgICAgIH0sIDgwMDAgLyogX1RpbWVvdXQuQVVUSF9FVkVOVCAqLyk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5wb2xsSWQgPSB3aW5kb3cuc2V0VGltZW91dChwb2xsLCBfUE9MTF9XSU5ET1dfQ0xPU0VfVElNRU9VVC5nZXQoKSk7DQogICAgICAgIH07DQogICAgICAgIHBvbGwoKTsNCiAgICB9DQp9DQovLyBPbmx5IG9uZSBwb3B1cCBpcyBldmVyIHNob3duIGF0IG9uY2UuIFRoZSBsaWZlY3ljbGUgb2YgdGhlIGN1cnJlbnQgcG9wdXANCi8vIGNhbiBiZSBtYW5hZ2VkIC8gY2FuY2VsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci4NClBvcHVwT3BlcmF0aW9uLmN1cnJlbnRQb3B1cEFjdGlvbiA9IG51bGw7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBQRU5ESU5HX1JFRElSRUNUX0tFWSA9ICdwZW5kaW5nUmVkaXJlY3QnOw0KLy8gV2Ugb25seSBnZXQgb25lIHJlZGlyZWN0IG91dGNvbWUgZm9yIGFueSBvbmUgYXV0aCwgc28ganVzdCBzdG9yZSBpdA0KLy8gaW4gaGVyZS4NCmNvbnN0IHJlZGlyZWN0T3V0Y29tZU1hcCA9IG5ldyBNYXAoKTsNCmNsYXNzIFJlZGlyZWN0QWN0aW9uIGV4dGVuZHMgQWJzdHJhY3RQb3B1cFJlZGlyZWN0T3BlcmF0aW9uIHsNCiAgICBjb25zdHJ1Y3RvcihhdXRoLCByZXNvbHZlciwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHsNCiAgICAgICAgc3VwZXIoYXV0aCwgWw0KICAgICAgICAgICAgInNpZ25JblZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovLA0KICAgICAgICAgICAgImxpbmtWaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLywNCiAgICAgICAgICAgICJyZWF1dGhWaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1JFRElSRUNUICovLA0KICAgICAgICAgICAgInVua25vd24iIC8qIEF1dGhFdmVudFR5cGUuVU5LTk9XTiAqLw0KICAgICAgICBdLCByZXNvbHZlciwgdW5kZWZpbmVkLCBieXBhc3NBdXRoU3RhdGUpOw0KICAgICAgICB0aGlzLmV2ZW50SWQgPSBudWxsOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBPdmVycmlkZSB0aGUgZXhlY3V0ZSBmdW5jdGlvbjsgaWYgd2UgYWxyZWFkeSBoYXZlIGEgcmVkaXJlY3QgcmVzdWx0LCB0aGVuDQogICAgICoganVzdCByZXR1cm4gaXQuDQogICAgICovDQogICAgYXN5bmMgZXhlY3V0ZSgpIHsNCiAgICAgICAgbGV0IHJlYWR5T3V0Y29tZSA9IHJlZGlyZWN0T3V0Y29tZU1hcC5nZXQodGhpcy5hdXRoLl9rZXkoKSk7DQogICAgICAgIGlmICghcmVhZHlPdXRjb21lKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGhhc1BlbmRpbmdSZWRpcmVjdCA9IGF3YWl0IF9nZXRBbmRDbGVhclBlbmRpbmdSZWRpcmVjdFN0YXR1cyh0aGlzLnJlc29sdmVyLCB0aGlzLmF1dGgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGhhc1BlbmRpbmdSZWRpcmVjdCA/IGF3YWl0IHN1cGVyLmV4ZWN1dGUoKSA6IG51bGw7DQogICAgICAgICAgICAgICAgcmVhZHlPdXRjb21lID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHJlYWR5T3V0Y29tZSA9ICgpID0+IFByb21pc2UucmVqZWN0KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVkaXJlY3RPdXRjb21lTWFwLnNldCh0aGlzLmF1dGguX2tleSgpLCByZWFkeU91dGNvbWUpOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIHdlJ3JlIG5vdCBieXBhc3NpbmcgYXV0aCBzdGF0ZSwgdGhlIHJlYWR5IG91dGNvbWUgc2hvdWxkIGJlIHNldCB0bw0KICAgICAgICAvLyBudWxsLg0KICAgICAgICBpZiAoIXRoaXMuYnlwYXNzQXV0aFN0YXRlKSB7DQogICAgICAgICAgICByZWRpcmVjdE91dGNvbWVNYXAuc2V0KHRoaXMuYXV0aC5fa2V5KCksICgpID0+IFByb21pc2UucmVzb2x2ZShudWxsKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlYWR5T3V0Y29tZSgpOw0KICAgIH0NCiAgICBhc3luYyBvbkF1dGhFdmVudChldmVudCkgew0KICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gInNpZ25JblZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovKSB7DQogICAgICAgICAgICByZXR1cm4gc3VwZXIub25BdXRoRXZlbnQoZXZlbnQpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICJ1bmtub3duIiAvKiBBdXRoRXZlbnRUeXBlLlVOS05PV04gKi8pIHsNCiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzZW50aW5lbCB2YWx1ZSBpbmRpY2F0aW5nIHRoZXJlJ3Mgbm8gcGVuZGluZyByZWRpcmVjdA0KICAgICAgICAgICAgdGhpcy5yZXNvbHZlKG51bGwpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmIChldmVudC5ldmVudElkKSB7DQogICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5hdXRoLl9yZWRpcmVjdFVzZXJGb3JJZChldmVudC5ldmVudElkKTsNCiAgICAgICAgICAgIGlmICh1c2VyKSB7DQogICAgICAgICAgICAgICAgdGhpcy51c2VyID0gdXNlcjsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIub25BdXRoRXZlbnQoZXZlbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGFzeW5jIG9uRXhlY3V0aW9uKCkgeyB9DQogICAgY2xlYW5VcCgpIHsgfQ0KfQ0KYXN5bmMgZnVuY3Rpb24gX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHJlc29sdmVyLCBhdXRoKSB7DQogICAgY29uc3Qga2V5ID0gcGVuZGluZ1JlZGlyZWN0S2V5KGF1dGgpOw0KICAgIGNvbnN0IHBlcnNpc3RlbmNlID0gcmVzb2x2ZXJQZXJzaXN0ZW5jZShyZXNvbHZlcik7DQogICAgaWYgKCEoYXdhaXQgcGVyc2lzdGVuY2UuX2lzQXZhaWxhYmxlKCkpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gKGF3YWl0IHBlcnNpc3RlbmNlLl9nZXQoa2V5KSkgPT09ICd0cnVlJzsNCiAgICBhd2FpdCBwZXJzaXN0ZW5jZS5fcmVtb3ZlKGtleSk7DQogICAgcmV0dXJuIGhhc1BlbmRpbmdSZWRpcmVjdDsNCn0NCmZ1bmN0aW9uIF9vdmVycmlkZVJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc3VsdCkgew0KICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQoYXV0aC5fa2V5KCksIHJlc3VsdCk7DQp9DQpmdW5jdGlvbiByZXNvbHZlclBlcnNpc3RlbmNlKHJlc29sdmVyKSB7DQogICAgcmV0dXJuIF9nZXRJbnN0YW5jZShyZXNvbHZlci5fcmVkaXJlY3RQZXJzaXN0ZW5jZSk7DQp9DQpmdW5jdGlvbiBwZW5kaW5nUmVkaXJlY3RLZXkoYXV0aCkgew0KICAgIHJldHVybiBfcGVyc2lzdGVuY2VLZXlOYW1lKFBFTkRJTkdfUkVESVJFQ1RfS0VZLCBhdXRoLmNvbmZpZy5hcGlLZXksIGF1dGgubmFtZSk7DQp9CmFzeW5jIGZ1bmN0aW9uIF9nZXRSZWRpcmVjdFJlc3VsdChhdXRoLCByZXNvbHZlckV4dGVybiwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHsNCiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7DQogICAgY29uc3QgcmVzb2x2ZXIgPSBfd2l0aERlZmF1bHRSZXNvbHZlcihhdXRoSW50ZXJuYWwsIHJlc29sdmVyRXh0ZXJuKTsNCiAgICBjb25zdCBhY3Rpb24gPSBuZXcgUmVkaXJlY3RBY3Rpb24oYXV0aEludGVybmFsLCByZXNvbHZlciwgYnlwYXNzQXV0aFN0YXRlKTsNCiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY3Rpb24uZXhlY3V0ZSgpOw0KICAgIGlmIChyZXN1bHQgJiYgIWJ5cGFzc0F1dGhTdGF0ZSkgew0KICAgICAgICBkZWxldGUgcmVzdWx0LnVzZXIuX3JlZGlyZWN0RXZlbnRJZDsNCiAgICAgICAgYXdhaXQgYXV0aEludGVybmFsLl9wZXJzaXN0VXNlcklmQ3VycmVudChyZXN1bHQudXNlcik7DQogICAgICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fc2V0UmVkaXJlY3RVc2VyKG51bGwsIHJlc29sdmVyRXh0ZXJuKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovLyBUaGUgYW1vdW50IG9mIHRpbWUgdG8gc3RvcmUgdGhlIFVJRHMgb2Ygc2VlbiBldmVudHM7IHRoaXMgaXMNCi8vIHNldCB0byAxMCBtaW4gYnkgZGVmYXVsdA0KY29uc3QgRVZFTlRfRFVQTElDQVRJT05fQ0FDSEVfRFVSQVRJT05fTVMgPSAxMCAqIDYwICogMTAwMDsNCmNsYXNzIEF1dGhFdmVudE1hbmFnZXIgew0KICAgIGNvbnN0cnVjdG9yKGF1dGgpIHsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgdGhpcy5jYWNoZWRFdmVudFVpZHMgPSBuZXcgU2V0KCk7DQogICAgICAgIHRoaXMuY29uc3VtZXJzID0gbmV3IFNldCgpOw0KICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBudWxsOw0KICAgICAgICB0aGlzLmhhc0hhbmRsZWRQb3RlbnRpYWxSZWRpcmVjdCA9IGZhbHNlOw0KICAgICAgICB0aGlzLmxhc3RQcm9jZXNzZWRFdmVudFRpbWUgPSBEYXRlLm5vdygpOw0KICAgIH0NCiAgICByZWdpc3RlckNvbnN1bWVyKGF1dGhFdmVudENvbnN1bWVyKSB7DQogICAgICAgIHRoaXMuY29uc3VtZXJzLmFkZChhdXRoRXZlbnRDb25zdW1lcik7DQogICAgICAgIGlmICh0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgJiYNCiAgICAgICAgICAgIHRoaXMuaXNFdmVudEZvckNvbnN1bWVyKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCwgYXV0aEV2ZW50Q29uc3VtZXIpKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRUb0NvbnN1bWVyKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCwgYXV0aEV2ZW50Q29uc3VtZXIpOw0KICAgICAgICAgICAgdGhpcy5zYXZlRXZlbnRUb0NhY2hlKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCk7DQogICAgICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIHVucmVnaXN0ZXJDb25zdW1lcihhdXRoRXZlbnRDb25zdW1lcikgew0KICAgICAgICB0aGlzLmNvbnN1bWVycy5kZWxldGUoYXV0aEV2ZW50Q29uc3VtZXIpOw0KICAgIH0NCiAgICBvbkV2ZW50KGV2ZW50KSB7DQogICAgICAgIC8vIENoZWNrIGlmIHRoZSBldmVudCBoYXMgYWxyZWFkeSBiZWVuIGhhbmRsZWQNCiAgICAgICAgaWYgKHRoaXMuaGFzRXZlbnRCZWVuSGFuZGxlZChldmVudCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgaGFuZGxlZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLmNvbnN1bWVycy5mb3JFYWNoKGNvbnN1bWVyID0+IHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzRXZlbnRGb3JDb25zdW1lcihldmVudCwgY29uc3VtZXIpKSB7DQogICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kVG9Db25zdW1lcihldmVudCwgY29uc3VtZXIpOw0KICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUV2ZW50VG9DYWNoZShldmVudCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBpZiAodGhpcy5oYXNIYW5kbGVkUG90ZW50aWFsUmVkaXJlY3QgfHwgIWlzUmVkaXJlY3RFdmVudChldmVudCkpIHsNCiAgICAgICAgICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgc2VlbiBhIHJlZGlyZWN0IGJlZm9yZSwgb3IgdGhpcyBpcyBhIHBvcHVwIGV2ZW50LA0KICAgICAgICAgICAgLy8gYmFpbCBub3cNCiAgICAgICAgICAgIHJldHVybiBoYW5kbGVkOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0ID0gdHJ1ZTsNCiAgICAgICAgLy8gSWYgdGhlIHJlZGlyZWN0IHdhc24ndCBoYW5kbGVkLCBoYW5nIG9uIHRvIGl0DQogICAgICAgIGlmICghaGFuZGxlZCkgew0KICAgICAgICAgICAgdGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50ID0gZXZlbnQ7DQogICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaGFuZGxlZDsNCiAgICB9DQogICAgc2VuZFRvQ29uc3VtZXIoZXZlbnQsIGNvbnN1bWVyKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgaWYgKGV2ZW50LmVycm9yICYmICFpc051bGxSZWRpcmVjdEV2ZW50KGV2ZW50KSkgew0KICAgICAgICAgICAgY29uc3QgY29kZSA9ICgoX2EgPSBldmVudC5lcnJvci5jb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaXQoJ2F1dGgvJylbMV0pIHx8DQogICAgICAgICAgICAgICAgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovOw0KICAgICAgICAgICAgY29uc3VtZXIub25FcnJvcihfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCBjb2RlKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdW1lci5vbkF1dGhFdmVudChldmVudCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaXNFdmVudEZvckNvbnN1bWVyKGV2ZW50LCBjb25zdW1lcikgew0KICAgICAgICBjb25zdCBldmVudElkTWF0Y2hlcyA9IGNvbnN1bWVyLmV2ZW50SWQgPT09IG51bGwgfHwNCiAgICAgICAgICAgICghIWV2ZW50LmV2ZW50SWQgJiYgZXZlbnQuZXZlbnRJZCA9PT0gY29uc3VtZXIuZXZlbnRJZCk7DQogICAgICAgIHJldHVybiBjb25zdW1lci5maWx0ZXIuaW5jbHVkZXMoZXZlbnQudHlwZSkgJiYgZXZlbnRJZE1hdGNoZXM7DQogICAgfQ0KICAgIGhhc0V2ZW50QmVlbkhhbmRsZWQoZXZlbnQpIHsNCiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RQcm9jZXNzZWRFdmVudFRpbWUgPj0NCiAgICAgICAgICAgIEVWRU5UX0RVUExJQ0FUSU9OX0NBQ0hFX0RVUkFUSU9OX01TKSB7DQogICAgICAgICAgICB0aGlzLmNhY2hlZEV2ZW50VWlkcy5jbGVhcigpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmNhY2hlZEV2ZW50VWlkcy5oYXMoZXZlbnRVaWQoZXZlbnQpKTsNCiAgICB9DQogICAgc2F2ZUV2ZW50VG9DYWNoZShldmVudCkgew0KICAgICAgICB0aGlzLmNhY2hlZEV2ZW50VWlkcy5hZGQoZXZlbnRVaWQoZXZlbnQpKTsNCiAgICAgICAgdGhpcy5sYXN0UHJvY2Vzc2VkRXZlbnRUaW1lID0gRGF0ZS5ub3coKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBldmVudFVpZChlKSB7DQogICAgcmV0dXJuIFtlLnR5cGUsIGUuZXZlbnRJZCwgZS5zZXNzaW9uSWQsIGUudGVuYW50SWRdLmZpbHRlcih2ID0+IHYpLmpvaW4oJy0nKTsNCn0NCmZ1bmN0aW9uIGlzTnVsbFJlZGlyZWN0RXZlbnQoeyB0eXBlLCBlcnJvciB9KSB7DQogICAgcmV0dXJuICh0eXBlID09PSAidW5rbm93biIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovICYmDQogICAgICAgIChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IGBhdXRoLyR7Im5vLWF1dGgtZXZlbnQiIC8qIEF1dGhFcnJvckNvZGUuTk9fQVVUSF9FVkVOVCAqL31gKTsNCn0NCmZ1bmN0aW9uIGlzUmVkaXJlY3RFdmVudChldmVudCkgew0KICAgIHN3aXRjaCAoZXZlbnQudHlwZSkgew0KICAgICAgICBjYXNlICJzaWduSW5WaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5TSUdOX0lOX1ZJQV9SRURJUkVDVCAqLzoNCiAgICAgICAgY2FzZSAibGlua1ZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1JFRElSRUNUICovOg0KICAgICAgICBjYXNlICJyZWF1dGhWaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1JFRElSRUNUICovOg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIGNhc2UgInVua25vd24iIC8qIEF1dGhFdmVudFR5cGUuVU5LTk9XTiAqLzoNCiAgICAgICAgICAgIHJldHVybiBpc051bGxSZWRpcmVjdEV2ZW50KGV2ZW50KTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBfZ2V0UHJvamVjdENvbmZpZyhhdXRoLCByZXF1ZXN0ID0ge30pIHsNCiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsICJHRVQiIC8qIEh0dHBNZXRob2QuR0VUICovLCAiL3YxL3Byb2plY3RzIiAvKiBFbmRwb2ludC5HRVRfUFJPSkVDVF9DT05GSUcgKi8sIHJlcXVlc3QpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgSVBfQUREUkVTU19SRUdFWCA9IC9eXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfSQvOw0KY29uc3QgSFRUUF9SRUdFWCA9IC9eaHR0cHM/LzsNCmFzeW5jIGZ1bmN0aW9uIF92YWxpZGF0ZU9yaWdpbihhdXRoKSB7DQogICAgLy8gU2tpcCBvcmlnaW4gdmFsaWRhdGlvbiBpZiB3ZSBhcmUgaW4gYW4gZW11bGF0ZWQgZW52aXJvbm1lbnQNCiAgICBpZiAoYXV0aC5jb25maWcuZW11bGF0b3IpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBjb25zdCB7IGF1dGhvcml6ZWREb21haW5zIH0gPSBhd2FpdCBfZ2V0UHJvamVjdENvbmZpZyhhdXRoKTsNCiAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBhdXRob3JpemVkRG9tYWlucykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKG1hdGNoRG9tYWluKGRvbWFpbikpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRoZXJlJ3MgYSBVUkwgZXJyb3I7IGp1c3QgY29udGludWUgc2VhcmNoaW5nDQogICAgICAgIH0NCiAgICB9DQogICAgLy8gSW4gdGhlIG9sZCBTREssIHRoaXMgZXJyb3IgYWxzbyBwcm92aWRlcyBoZWxwZnVsIG1lc3NhZ2VzLg0KICAgIF9mYWlsKGF1dGgsICJ1bmF1dGhvcml6ZWQtZG9tYWluIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT1JJR0lOICovKTsNCn0NCmZ1bmN0aW9uIG1hdGNoRG9tYWluKGV4cGVjdGVkKSB7DQogICAgY29uc3QgY3VycmVudFVybCA9IF9nZXRDdXJyZW50VXJsKCk7DQogICAgY29uc3QgeyBwcm90b2NvbCwgaG9zdG5hbWUgfSA9IG5ldyBVUkwoY3VycmVudFVybCk7DQogICAgaWYgKGV4cGVjdGVkLnN0YXJ0c1dpdGgoJ2Nocm9tZS1leHRlbnNpb246Ly8nKSkgew0KICAgICAgICBjb25zdCBjZVVybCA9IG5ldyBVUkwoZXhwZWN0ZWQpOw0KICAgICAgICBpZiAoY2VVcmwuaG9zdG5hbWUgPT09ICcnICYmIGhvc3RuYW1lID09PSAnJykgew0KICAgICAgICAgICAgLy8gRm9yIHNvbWUgcmVhc29uIHdlJ3JlIG5vdCBwYXJzaW5nIGNocm9tZSBVUkxzIHByb3Blcmx5DQogICAgICAgICAgICByZXR1cm4gKHByb3RvY29sID09PSAnY2hyb21lLWV4dGVuc2lvbjonICYmDQogICAgICAgICAgICAgICAgZXhwZWN0ZWQucmVwbGFjZSgnY2hyb21lLWV4dGVuc2lvbjovLycsICcnKSA9PT0NCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFVybC5yZXBsYWNlKCdjaHJvbWUtZXh0ZW5zaW9uOi8vJywgJycpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcHJvdG9jb2wgPT09ICdjaHJvbWUtZXh0ZW5zaW9uOicgJiYgY2VVcmwuaG9zdG5hbWUgPT09IGhvc3RuYW1lOw0KICAgIH0NCiAgICBpZiAoIUhUVFBfUkVHRVgudGVzdChwcm90b2NvbCkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBpZiAoSVBfQUREUkVTU19SRUdFWC50ZXN0KGV4cGVjdGVkKSkgew0KICAgICAgICAvLyBUaGUgZG9tYWluIGhhcyB0byBiZSBleGFjdGx5IGVxdWFsIHRvIHRoZSBwYXR0ZXJuLCBhcyBhbiBJUCBkb21haW4gd2lsbA0KICAgICAgICAvLyBvbmx5IGNvbnRhaW4gdGhlIElQLCBubyBleHRyYSBjaGFyYWN0ZXIuDQogICAgICAgIHJldHVybiBob3N0bmFtZSA9PT0gZXhwZWN0ZWQ7DQogICAgfQ0KICAgIC8vIERvdHMgaW4gcGF0dGVybiBzaG91bGQgYmUgZXNjYXBlZC4NCiAgICBjb25zdCBlc2NhcGVkRG9tYWluUGF0dGVybiA9IGV4cGVjdGVkLnJlcGxhY2UoL1wuL2csICdcXC4nKTsNCiAgICAvLyBOb24gaXAgYWRkcmVzcyBkb21haW5zLg0KICAgIC8vIGRvbWFpbi5jb20gPSAqLmRvbWFpbi5jb20gT1IgZG9tYWluLmNvbQ0KICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cCgnXiguK1xcLicgKyBlc2NhcGVkRG9tYWluUGF0dGVybiArICd8JyArIGVzY2FwZWREb21haW5QYXR0ZXJuICsgJykkJywgJ2knKTsNCiAgICByZXR1cm4gcmUudGVzdChob3N0bmFtZSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgTkVUV09SS19USU1FT1VUID0gbmV3IERlbGF5KDMwMDAwLCA2MDAwMCk7DQovKioNCiAqIFJlc2V0IHVubGFvZGVkIEdBcGkgbW9kdWxlcy4gSWYgZ2FwaS5sb2FkIGZhaWxzIGR1ZSB0byBhIG5ldHdvcmsgZXJyb3IsDQogKiBpdCB3aWxsIHN0b3Agd29ya2luZyBhZnRlciBhIHJldHJpYWwuIFRoaXMgaXMgYSBoYWNrIHRvIGZpeCB0aGlzIGlzc3VlLg0KICovDQpmdW5jdGlvbiByZXNldFVubG9hZGVkR2FwaU1vZHVsZXMoKSB7DQogICAgLy8gQ2xlYXIgbGFzdCBmYWlsZWQgZ2FwaS5sb2FkIHN0YXRlIHRvIGZvcmNlIG5leHQgZ2FwaS5sb2FkIHRvIGZpcnN0DQogICAgLy8gbG9hZCB0aGUgZmFpbGVkIGdhcGkuaWZyYW1lcyBtb2R1bGUuDQogICAgLy8gR2V0IGdhcGl4LmJlYWNvbiBjb250ZXh0Lg0KICAgIGNvbnN0IGJlYWNvbiA9IF93aW5kb3coKS5fX19qc2w7DQogICAgLy8gR2V0IGN1cnJlbnQgaGludC4NCiAgICBpZiAoYmVhY29uID09PSBudWxsIHx8IGJlYWNvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYmVhY29uLkgpIHsNCiAgICAgICAgLy8gR2V0IGdhcGkgaGludC4NCiAgICAgICAgZm9yIChjb25zdCBoaW50IG9mIE9iamVjdC5rZXlzKGJlYWNvbi5IKSkgew0KICAgICAgICAgICAgLy8gUmVxdWVzdGVkIG1vZHVsZXMuDQogICAgICAgICAgICBiZWFjb24uSFtoaW50XS5yID0gYmVhY29uLkhbaGludF0uciB8fCBbXTsNCiAgICAgICAgICAgIC8vIExvYWRlZCBtb2R1bGVzLg0KICAgICAgICAgICAgYmVhY29uLkhbaGludF0uTCA9IGJlYWNvbi5IW2hpbnRdLkwgfHwgW107DQogICAgICAgICAgICAvLyBTZXQgcmVxdWVzdGVkIG1vZHVsZXMgdG8gYSBjb3B5IG9mIHRoZSBsb2FkZWQgbW9kdWxlcy4NCiAgICAgICAgICAgIGJlYWNvbi5IW2hpbnRdLnIgPSBbLi4uYmVhY29uLkhbaGludF0uTF07DQogICAgICAgICAgICAvLyBDbGVhciBwZW5kaW5nIGNhbGxiYWNrcy4NCiAgICAgICAgICAgIGlmIChiZWFjb24uQ1ApIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJlYWNvbi5DUC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYWxsIGZhaWxlZCBwZW5kaW5nIGNhbGxiYWNrcy4NCiAgICAgICAgICAgICAgICAgICAgYmVhY29uLkNQW2ldID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQpmdW5jdGlvbiBsb2FkR2FwaShhdXRoKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgdmFyIF9hLCBfYiwgX2M7DQogICAgICAgIC8vIEZ1bmN0aW9uIHRvIHJ1biB3aGVuIGdhcGkubG9hZCBpcyByZWFkeS4NCiAgICAgICAgZnVuY3Rpb24gbG9hZEdhcGlJZnJhbWUoKSB7DQogICAgICAgICAgICAvLyBUaGUgZGV2ZWxvcGVyIG1heSBoYXZlIHRyaWVkIHRvIHByZXZpb3VzbHkgcnVuIGdhcGkubG9hZCBhbmQgZmFpbGVkLg0KICAgICAgICAgICAgLy8gUnVuIHRoaXMgdG8gZml4IHRoYXQuDQogICAgICAgICAgICByZXNldFVubG9hZGVkR2FwaU1vZHVsZXMoKTsNCiAgICAgICAgICAgIGdhcGkubG9hZCgnZ2FwaS5pZnJhbWVzJywgew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZ2FwaS5pZnJhbWVzLmdldENvbnRleHQoKSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBvbnRpbWVvdXQ6ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGFib3ZlIHJlc2V0IG1heSBiZSBzdWZmaWNpZW50LCBidXQgaGF2aW5nIHRoaXMgcmVzZXQgYWZ0ZXINCiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbHVyZSBlbnN1cmVzIHRoYXQgaWYgdGhlIGRldmVsb3BlciBjYWxscyBnYXBpLmxvYWQgYWZ0ZXIgdGhlDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbm5lY3Rpb24gaXMgcmUtZXN0YWJsaXNoZWQgYW5kIGJlZm9yZSBhbm90aGVyIGF0dGVtcHQgdG8gZW1iZWQNCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGlmcmFtZSwgaXQgd291bGQgd29yayBhbmQgd291bGQgbm90IGJlIGJyb2tlbiBiZWNhdXNlIG9mIG91cg0KICAgICAgICAgICAgICAgICAgICAvLyBmYWlsZWQgYXR0ZW1wdC4NCiAgICAgICAgICAgICAgICAgICAgLy8gVGltZW91dCB3aGVuIGdhcGkuaWZyYW1lcy5JZnJhbWUgbm90IGxvYWRlZC4NCiAgICAgICAgICAgICAgICAgICAgcmVzZXRVbmxvYWRlZEdhcGlNb2R1bGVzKCk7DQogICAgICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgIm5ldHdvcmstcmVxdWVzdC1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgdGltZW91dDogTkVUV09SS19USU1FT1VULmdldCgpDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKF9iID0gKF9hID0gX3dpbmRvdygpLmdhcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZnJhbWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuSWZyYW1lKSB7DQogICAgICAgICAgICAvLyBJZiBnYXBpLmlmcmFtZXMuSWZyYW1lIGF2YWlsYWJsZSwgcmVzb2x2ZS4NCiAgICAgICAgICAgIHJlc29sdmUoZ2FwaS5pZnJhbWVzLmdldENvbnRleHQoKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoISEoKF9jID0gX3dpbmRvdygpLmdhcGkpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sb2FkKSkgew0KICAgICAgICAgICAgLy8gR2FwaSBsb2FkZXIgcmVhZHksIGxvYWQgZ2FwaS5pZnJhbWVzLg0KICAgICAgICAgICAgbG9hZEdhcGlJZnJhbWUoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyBpZnJhbWUgY2FsbGJhY2sgd2hlbiB0aGlzIGlzIGNhbGxlZCBzbyBhcyBub3QgdG8gb3ZlcndyaXRlDQogICAgICAgICAgICAvLyBhbnkgcHJldmlvdXMgZGVmaW5lZCBjYWxsYmFjay4gVGhpcyBoYXBwZW5zIGlmIHRoaXMgbWV0aG9kIGlzIGNhbGxlZA0KICAgICAgICAgICAgLy8gbXVsdGlwbGUgdGltZXMgaW4gcGFyYWxsZWwgYW5kIGNvdWxkIHJlc3VsdCBpbiB0aGUgbGF0ZXIgY2FsbGJhY2sNCiAgICAgICAgICAgIC8vIG92ZXJ3cml0aW5nIHRoZSBwcmV2aW91cyBvbmUuIFRoaXMgd291bGQgZW5kIHVwIHdpdGggYSBpZnJhbWUNCiAgICAgICAgICAgIC8vIHRpbWVvdXQuDQogICAgICAgICAgICBjb25zdCBjYk5hbWUgPSBfZ2VuZXJhdGVDYWxsYmFja05hbWUoJ2lmcmFtZWZjYicpOw0KICAgICAgICAgICAgLy8gR0FwaSBsb2FkZXIgbm90IGF2YWlsYWJsZSwgZHluYW1pY2FsbHkgbG9hZCBwbGF0Zm9ybS5qcy4NCiAgICAgICAgICAgIF93aW5kb3coKVtjYk5hbWVdID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIEdBcGkgbG9hZGVyIHNob3VsZCBiZSByZWFkeS4NCiAgICAgICAgICAgICAgICBpZiAoISFnYXBpLmxvYWQpIHsNCiAgICAgICAgICAgICAgICAgICAgbG9hZEdhcGlJZnJhbWUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEdhcGkgbG9hZGVyIGZhaWxlZCwgdGhyb3cgZXJyb3IuDQogICAgICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgIm5ldHdvcmstcmVxdWVzdC1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICAvLyBMb2FkIEdBcGkgbG9hZGVyLg0KICAgICAgICAgICAgcmV0dXJuIF9sb2FkSlMoYGh0dHBzOi8vYXBpcy5nb29nbGUuY29tL2pzL2FwaS5qcz9vbmxvYWQ9JHtjYk5hbWV9YCkNCiAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiByZWplY3QoZSkpOw0KICAgICAgICB9DQogICAgfSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAvLyBSZXNldCBjYWNoZWQgcHJvbWlzZSB0byBhbGxvdyBmb3IgcmV0cmlhbC4NCiAgICAgICAgY2FjaGVkR0FwaUxvYWRlciA9IG51bGw7DQogICAgICAgIHRocm93IGVycm9yOw0KICAgIH0pOw0KfQ0KbGV0IGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsOw0KZnVuY3Rpb24gX2xvYWRHYXBpKGF1dGgpIHsNCiAgICBjYWNoZWRHQXBpTG9hZGVyID0gY2FjaGVkR0FwaUxvYWRlciB8fCBsb2FkR2FwaShhdXRoKTsNCiAgICByZXR1cm4gY2FjaGVkR0FwaUxvYWRlcjsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBQSU5HX1RJTUVPVVQgPSBuZXcgRGVsYXkoNTAwMCwgMTUwMDApOw0KY29uc3QgSUZSQU1FX1BBVEggPSAnX18vYXV0aC9pZnJhbWUnOw0KY29uc3QgRU1VTEFURURfSUZSQU1FX1BBVEggPSAnZW11bGF0b3IvYXV0aC9pZnJhbWUnOw0KY29uc3QgSUZSQU1FX0FUVFJJQlVURVMgPSB7DQogICAgc3R5bGU6IHsNCiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsDQogICAgICAgIHRvcDogJy0xMDBweCcsDQogICAgICAgIHdpZHRoOiAnMXB4JywNCiAgICAgICAgaGVpZ2h0OiAnMXB4Jw0KICAgIH0sDQogICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnLA0KICAgIHRhYmluZGV4OiAnLTEnDQp9Ow0KLy8gTWFwIGZyb20gYXBpSG9zdCB0byBlbmRwb2ludCBJRCBmb3IgcGFzc2luZyBpbnRvIGlmcmFtZS4gSW4gY3VycmVudCBTREssIGFwaUhvc3QgY2FuIGJlIHNldCB0bw0KLy8gYW55dGhpbmcgKG5vdCBmcm9tIGEgbGlzdCBvZiBlbmRwb2ludHMgd2l0aCBJRHMgYXMgaW4gbGVnYWN5KSwgc28gdGhpcyBpcyB0aGUgY2xvc2VzdCB3ZSBjYW4gZ2V0Lg0KY29uc3QgRUlEX0ZST01fQVBJSE9TVCA9IG5ldyBNYXAoWw0KICAgIFsiaWRlbnRpdHl0b29sa2l0Lmdvb2dsZWFwaXMuY29tIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9IT1NUICovLCAncCddLA0KICAgIFsnc3RhZ2luZy1pZGVudGl0eXRvb2xraXQuc2FuZGJveC5nb29nbGVhcGlzLmNvbScsICdzJ10sDQogICAgWyd0ZXN0LWlkZW50aXR5dG9vbGtpdC5zYW5kYm94Lmdvb2dsZWFwaXMuY29tJywgJ3QnXSAvLyB0ZXN0DQpdKTsNCmZ1bmN0aW9uIGdldElmcmFtZVVybChhdXRoKSB7DQogICAgY29uc3QgY29uZmlnID0gYXV0aC5jb25maWc7DQogICAgX2Fzc2VydChjb25maWcuYXV0aERvbWFpbiwgYXV0aCwgImF1dGgtZG9tYWluLWNvbmZpZy1yZXF1aXJlZCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FVVEhfRE9NQUlOICovKTsNCiAgICBjb25zdCB1cmwgPSBjb25maWcuZW11bGF0b3INCiAgICAgICAgPyBfZW11bGF0b3JVcmwoY29uZmlnLCBFTVVMQVRFRF9JRlJBTUVfUEFUSCkNCiAgICAgICAgOiBgaHR0cHM6Ly8ke2F1dGguY29uZmlnLmF1dGhEb21haW59LyR7SUZSQU1FX1BBVEh9YDsNCiAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgIGFwaUtleTogY29uZmlnLmFwaUtleSwNCiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lLA0KICAgICAgICB2OiBTREtfVkVSU0lPTiQxDQogICAgfTsNCiAgICBjb25zdCBlaWQgPSBFSURfRlJPTV9BUElIT1NULmdldChhdXRoLmNvbmZpZy5hcGlIb3N0KTsNCiAgICBpZiAoZWlkKSB7DQogICAgICAgIHBhcmFtcy5laWQgPSBlaWQ7DQogICAgfQ0KICAgIGNvbnN0IGZyYW1ld29ya3MgPSBhdXRoLl9nZXRGcmFtZXdvcmtzKCk7DQogICAgaWYgKGZyYW1ld29ya3MubGVuZ3RoKSB7DQogICAgICAgIHBhcmFtcy5mdyA9IGZyYW1ld29ya3Muam9pbignLCcpOw0KICAgIH0NCiAgICByZXR1cm4gYCR7dXJsfT8ke3F1ZXJ5c3RyaW5nJDEocGFyYW1zKS5zbGljZSgxKX1gOw0KfQ0KYXN5bmMgZnVuY3Rpb24gX29wZW5JZnJhbWUoYXV0aCkgew0KICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCBfbG9hZEdhcGkoYXV0aCk7DQogICAgY29uc3QgZ2FwaSA9IF93aW5kb3coKS5nYXBpOw0KICAgIF9hc3NlcnQoZ2FwaSwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICByZXR1cm4gY29udGV4dC5vcGVuKHsNCiAgICAgICAgd2hlcmU6IGRvY3VtZW50LmJvZHksDQogICAgICAgIHVybDogZ2V0SWZyYW1lVXJsKGF1dGgpLA0KICAgICAgICBtZXNzYWdlSGFuZGxlcnNGaWx0ZXI6IGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIsDQogICAgICAgIGF0dHJpYnV0ZXM6IElGUkFNRV9BVFRSSUJVVEVTLA0KICAgICAgICBkb250Y2xlYXI6IHRydWUNCiAgICB9LCAoaWZyYW1lKSA9PiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIGF3YWl0IGlmcmFtZS5yZXN0eWxlKHsNCiAgICAgICAgICAgIC8vIFByZXZlbnQgaWZyYW1lIGZyb20gY2xvc2luZyBvbiBtb3VzZSBvdXQuDQogICAgICAgICAgICBzZXRIaWRlT25MZWF2ZTogZmFsc2UNCiAgICAgICAgfSk7DQogICAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IF9jcmVhdGVFcnJvcihhdXRoLCAibmV0d29yay1yZXF1ZXN0LWZhaWxlZCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKTsNCiAgICAgICAgLy8gQ29uZmlybSBpZnJhbWUgaXMgY29ycmVjdGx5IGxvYWRlZC4NCiAgICAgICAgLy8gVG8gZmFsbGJhY2sgb24gZmFpbHVyZSwgc2V0IGEgdGltZW91dC4NCiAgICAgICAgY29uc3QgbmV0d29ya0Vycm9yVGltZXIgPSBfd2luZG93KCkuc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICByZWplY3QobmV0d29ya0Vycm9yKTsNCiAgICAgICAgfSwgUElOR19USU1FT1VULmdldCgpKTsNCiAgICAgICAgLy8gQ2xlYXIgdGltZXIgYW5kIHJlc29sdmUgcGVuZGluZyBpZnJhbWUgcmVhZHkgcHJvbWlzZS4NCiAgICAgICAgZnVuY3Rpb24gY2xlYXJUaW1lckFuZFJlc29sdmUoKSB7DQogICAgICAgICAgICBfd2luZG93KCkuY2xlYXJUaW1lb3V0KG5ldHdvcmtFcnJvclRpbWVyKTsNCiAgICAgICAgICAgIHJlc29sdmUoaWZyYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBUaGlzIHJldHVybnMgYW4gSVRoZW5hYmxlLiBIb3dldmVyIHRoZSByZWplY3QgcGFydCBkb2VzIG5vdCBjYWxsDQogICAgICAgIC8vIHdoZW4gdGhlIGlmcmFtZSBpcyBub3QgbG9hZGVkLg0KICAgICAgICBpZnJhbWUucGluZyhjbGVhclRpbWVyQW5kUmVzb2x2ZSkudGhlbihjbGVhclRpbWVyQW5kUmVzb2x2ZSwgKCkgPT4gew0KICAgICAgICAgICAgcmVqZWN0KG5ldHdvcmtFcnJvcik7DQogICAgICAgIH0pOw0KICAgIH0pKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBCQVNFX1BPUFVQX09QVElPTlMgPSB7DQogICAgbG9jYXRpb246ICd5ZXMnLA0KICAgIHJlc2l6YWJsZTogJ3llcycsDQogICAgc3RhdHVzYmFyOiAneWVzJywNCiAgICB0b29sYmFyOiAnbm8nDQp9Ow0KY29uc3QgREVGQVVMVF9XSURUSCA9IDUwMDsNCmNvbnN0IERFRkFVTFRfSEVJR0hUID0gNjAwOw0KY29uc3QgVEFSR0VUX0JMQU5LID0gJ19ibGFuayc7DQpjb25zdCBGSVJFRk9YX0VNUFRZX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0JzsNCmNsYXNzIEF1dGhQb3B1cCB7DQogICAgY29uc3RydWN0b3Iod2luZG93KSB7DQogICAgICAgIHRoaXMud2luZG93ID0gd2luZG93Ow0KICAgICAgICB0aGlzLmFzc29jaWF0ZWRFdmVudCA9IG51bGw7DQogICAgfQ0KICAgIGNsb3NlKCkgew0KICAgICAgICBpZiAodGhpcy53aW5kb3cpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7IH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCmZ1bmN0aW9uIF9vcGVuKGF1dGgsIHVybCwgbmFtZSwgd2lkdGggPSBERUZBVUxUX1dJRFRILCBoZWlnaHQgPSBERUZBVUxUX0hFSUdIVCkgew0KICAgIGNvbnN0IHRvcCA9IE1hdGgubWF4KCh3aW5kb3cuc2NyZWVuLmF2YWlsSGVpZ2h0IC0gaGVpZ2h0KSAvIDIsIDApLnRvU3RyaW5nKCk7DQogICAgY29uc3QgbGVmdCA9IE1hdGgubWF4KCh3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGggLSB3aWR0aCkgLyAyLCAwKS50b1N0cmluZygpOw0KICAgIGxldCB0YXJnZXQgPSAnJzsNCiAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBCQVNFX1BPUFVQX09QVElPTlMpLCB7IHdpZHRoOiB3aWR0aC50b1N0cmluZygpLCBoZWlnaHQ6IGhlaWdodC50b1N0cmluZygpLCB0b3AsDQogICAgICAgIGxlZnQgfSk7DQogICAgLy8gQ2hyb21lIGlPUyA3IGFuZCA4IGlzIHJldHVybmluZyBhbiB1bmRlZmluZWQgcG9wdXAgd2luIHdoZW4gdGFyZ2V0IGlzDQogICAgLy8gc3BlY2lmaWVkLCBldmVuIHRob3VnaCB0aGUgcG9wdXAgaXMgbm90IG5lY2Vzc2FyaWx5IGJsb2NrZWQuDQogICAgY29uc3QgdWEgPSBnZXRVQSgpLnRvTG93ZXJDYXNlKCk7DQogICAgaWYgKG5hbWUpIHsNCiAgICAgICAgdGFyZ2V0ID0gX2lzQ2hyb21lSU9TKHVhKSA/IFRBUkdFVF9CTEFOSyA6IG5hbWU7DQogICAgfQ0KICAgIGlmIChfaXNGaXJlZm94KHVhKSkgew0KICAgICAgICAvLyBGaXJlZm94IGNvbXBsYWlucyB3aGVuIGludmFsaWQgVVJMcyBhcmUgcG9wcGVkIG91dC4gSGFja3kgd2F5IHRvIGJ5cGFzcy4NCiAgICAgICAgdXJsID0gdXJsIHx8IEZJUkVGT1hfRU1QVFlfVVJMOw0KICAgICAgICAvLyBGaXJlZm94IGRpc2FibGVzIGJ5IGRlZmF1bHQgc2Nyb2xsaW5nIG9uIHBvcHVwIHdpbmRvd3MsIHdoaWNoIGNhbiBjcmVhdGUNCiAgICAgICAgLy8gaXNzdWVzIHdoZW4gdGhlIHVzZXIgaGFzIG1hbnkgR29vZ2xlIGFjY291bnRzLCBmb3IgaW5zdGFuY2UuDQogICAgICAgIG9wdGlvbnMuc2Nyb2xsYmFycyA9ICd5ZXMnOw0KICAgIH0NCiAgICBjb25zdCBvcHRpb25zU3RyaW5nID0gT2JqZWN0LmVudHJpZXMob3B0aW9ucykucmVkdWNlKChhY2N1bSwgW2tleSwgdmFsdWVdKSA9PiBgJHthY2N1bX0ke2tleX09JHt2YWx1ZX0sYCwgJycpOw0KICAgIGlmIChfaXNJT1NTdGFuZGFsb25lKHVhKSAmJiB0YXJnZXQgIT09ICdfc2VsZicpIHsNCiAgICAgICAgb3BlbkFzTmV3V2luZG93SU9TKHVybCB8fCAnJywgdGFyZ2V0KTsNCiAgICAgICAgcmV0dXJuIG5ldyBBdXRoUG9wdXAobnVsbCk7DQogICAgfQ0KICAgIC8vIGFib3V0OmJsYW5rIGdldHRpbmcgc2FuaXRpemVkIGNhdXNpbmcgYnJvd3NlcnMgbGlrZSBJRS9FZGdlIHRvIGRpc3BsYXkNCiAgICAvLyBicmllZiBlcnJvciBtZXNzYWdlIGJlZm9yZSByZWRpcmVjdGluZyB0byBoYW5kbGVyLg0KICAgIGNvbnN0IG5ld1dpbiA9IHdpbmRvdy5vcGVuKHVybCB8fCAnJywgdGFyZ2V0LCBvcHRpb25zU3RyaW5nKTsNCiAgICBfYXNzZXJ0KG5ld1dpbiwgYXV0aCwgInBvcHVwLWJsb2NrZWQiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQkxPQ0tFRCAqLyk7DQogICAgLy8gRmxha3kgb24gSUUgZWRnZSwgZW5jYXBzdWxhdGUgd2l0aCBhIHRyeSBhbmQgY2F0Y2guDQogICAgdHJ5IHsNCiAgICAgICAgbmV3V2luLmZvY3VzKCk7DQogICAgfQ0KICAgIGNhdGNoIChlKSB7IH0NCiAgICByZXR1cm4gbmV3IEF1dGhQb3B1cChuZXdXaW4pOw0KfQ0KZnVuY3Rpb24gb3BlbkFzTmV3V2luZG93SU9TKHVybCwgdGFyZ2V0KSB7DQogICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQogICAgZWwuaHJlZiA9IHVybDsNCiAgICBlbC50YXJnZXQgPSB0YXJnZXQ7DQogICAgY29uc3QgY2xpY2sgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudCcpOw0KICAgIGNsaWNrLmluaXRNb3VzZUV2ZW50KCdjbGljaycsIHRydWUsIHRydWUsIHdpbmRvdywgMSwgMCwgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDEsIG51bGwpOw0KICAgIGVsLmRpc3BhdGNoRXZlbnQoY2xpY2spOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBVUkwgZm9yIEF1dGhlbnRpY2F0aW9uIHdpZGdldCB3aGljaCB3aWxsIGluaXRpYXRlIHRoZSBPQXV0aCBoYW5kc2hha2UNCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgV0lER0VUX1BBVEggPSAnX18vYXV0aC9oYW5kbGVyJzsNCi8qKg0KICogVVJMIGZvciBlbXVsYXRlZCBlbnZpcm9ubWVudA0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpjb25zdCBFTVVMQVRPUl9XSURHRVRfUEFUSCA9ICdlbXVsYXRvci9hdXRoL2hhbmRsZXInOw0KLyoqDQogKiBGcmFnbWVudCBuYW1lIGZvciB0aGUgQXBwIENoZWNrIHRva2VuIHRoYXQgZ2V0cyBwYXNzZWQgdG8gdGhlIHdpZGdldA0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpjb25zdCBGSVJFQkFTRV9BUFBfQ0hFQ0tfRlJBR01FTlRfSUQgPSBlbmNvZGVVUklDb21wb25lbnQoJ2ZhYycpOw0KYXN5bmMgZnVuY3Rpb24gX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgcmVkaXJlY3RVcmwsIGV2ZW50SWQsIGFkZGl0aW9uYWxQYXJhbXMpIHsNCiAgICBfYXNzZXJ0KGF1dGguY29uZmlnLmF1dGhEb21haW4sIGF1dGgsICJhdXRoLWRvbWFpbi1jb25maWctcmVxdWlyZWQiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BVVRIX0RPTUFJTiAqLyk7DQogICAgX2Fzc2VydChhdXRoLmNvbmZpZy5hcGlLZXksIGF1dGgsICJpbnZhbGlkLWFwaS1rZXkiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUElfS0VZICovKTsNCiAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgIGFwaUtleTogYXV0aC5jb25maWcuYXBpS2V5LA0KICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUsDQogICAgICAgIGF1dGhUeXBlLA0KICAgICAgICByZWRpcmVjdFVybCwNCiAgICAgICAgdjogU0RLX1ZFUlNJT04kMSwNCiAgICAgICAgZXZlbnRJZA0KICAgIH07DQogICAgaWYgKHByb3ZpZGVyIGluc3RhbmNlb2YgRmVkZXJhdGVkQXV0aFByb3ZpZGVyKSB7DQogICAgICAgIHByb3ZpZGVyLnNldERlZmF1bHRMYW5ndWFnZShhdXRoLmxhbmd1YWdlQ29kZSk7DQogICAgICAgIHBhcmFtcy5wcm92aWRlcklkID0gcHJvdmlkZXIucHJvdmlkZXJJZCB8fCAnJzsNCiAgICAgICAgaWYgKCFpc0VtcHR5KHByb3ZpZGVyLmdldEN1c3RvbVBhcmFtZXRlcnMoKSkpIHsNCiAgICAgICAgICAgIHBhcmFtcy5jdXN0b21QYXJhbWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkocHJvdmlkZXIuZ2V0Q3VzdG9tUGFyYW1ldGVycygpKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBUT0RPIHNldCBhZGRpdGlvbmFsUGFyYW1zIGZyb20gdGhlIHByb3ZpZGVyIGFzIHdlbGw/DQogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGFkZGl0aW9uYWxQYXJhbXMgfHwge30pKSB7DQogICAgICAgICAgICBwYXJhbXNba2V5XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIEJhc2VPQXV0aFByb3ZpZGVyKSB7DQogICAgICAgIGNvbnN0IHNjb3BlcyA9IHByb3ZpZGVyLmdldFNjb3BlcygpLmZpbHRlcihzY29wZSA9PiBzY29wZSAhPT0gJycpOw0KICAgICAgICBpZiAoc2NvcGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHBhcmFtcy5zY29wZXMgPSBzY29wZXMuam9pbignLCcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChhdXRoLnRlbmFudElkKSB7DQogICAgICAgIHBhcmFtcy50aWQgPSBhdXRoLnRlbmFudElkOw0KICAgIH0NCiAgICAvLyBUT0RPOiBtYXliZSBzZXQgZWlkIGFzIGVuZGlwb2ludElkDQogICAgLy8gVE9ETzogbWF5YmUgc2V0IGZ3IGFzIEZyYW1ld29ya3Muam9pbigiLCIpDQogICAgY29uc3QgcGFyYW1zRGljdCA9IHBhcmFtczsNCiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXJhbXNEaWN0KSkgew0KICAgICAgICBpZiAocGFyYW1zRGljdFtrZXldID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGRlbGV0ZSBwYXJhbXNEaWN0W2tleV07DQogICAgICAgIH0NCiAgICB9DQogICAgLy8gU2V0cyB0aGUgQXBwIENoZWNrIHRva2VuIHRvIHBhc3MgdG8gdGhlIHdpZGdldA0KICAgIGNvbnN0IGFwcENoZWNrVG9rZW4gPSBhd2FpdCBhdXRoLl9nZXRBcHBDaGVja1Rva2VuKCk7DQogICAgY29uc3QgYXBwQ2hlY2tUb2tlbkZyYWdtZW50ID0gYXBwQ2hlY2tUb2tlbg0KICAgICAgICA/IGAjJHtGSVJFQkFTRV9BUFBfQ0hFQ0tfRlJBR01FTlRfSUR9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFwcENoZWNrVG9rZW4pfWANCiAgICAgICAgOiAnJzsNCiAgICAvLyBTdGFydCBhdCBpbmRleCAxIHRvIHNraXAgdGhlIGxlYWRpbmcgJyYnIGluIHRoZSBxdWVyeSBzdHJpbmcNCiAgICByZXR1cm4gYCR7Z2V0SGFuZGxlckJhc2UoYXV0aCl9PyR7cXVlcnlzdHJpbmckMShwYXJhbXNEaWN0KS5zbGljZSgxKX0ke2FwcENoZWNrVG9rZW5GcmFnbWVudH1gOw0KfQ0KZnVuY3Rpb24gZ2V0SGFuZGxlckJhc2UoeyBjb25maWcgfSkgew0KICAgIGlmICghY29uZmlnLmVtdWxhdG9yKSB7DQogICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke2NvbmZpZy5hdXRoRG9tYWlufS8ke1dJREdFVF9QQVRIfWA7DQogICAgfQ0KICAgIHJldHVybiBfZW11bGF0b3JVcmwoY29uZmlnLCBFTVVMQVRPUl9XSURHRVRfUEFUSCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoZSBzcGVjaWFsIHdlYiBzdG9yYWdlIGV2ZW50DQogKg0KICovDQpjb25zdCBXRUJfU1RPUkFHRV9TVVBQT1JUX0tFWSA9ICd3ZWJTdG9yYWdlU3VwcG9ydCc7DQpjbGFzcyBCcm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXJzID0ge307DQogICAgICAgIHRoaXMuaWZyYW1lcyA9IHt9Ow0KICAgICAgICB0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlcyA9IHt9Ow0KICAgICAgICB0aGlzLl9yZWRpcmVjdFBlcnNpc3RlbmNlID0gYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZTsNCiAgICAgICAgdGhpcy5fY29tcGxldGVSZWRpcmVjdEZuID0gX2dldFJlZGlyZWN0UmVzdWx0Ow0KICAgICAgICB0aGlzLl9vdmVycmlkZVJlZGlyZWN0UmVzdWx0ID0gX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQ7DQogICAgfQ0KICAgIC8vIFdyYXBwaW5nIGluIGFzeW5jIGV2ZW4gdGhvdWdoIHdlIGRvbid0IGF3YWl0IGFueXdoZXJlIGluIG9yZGVyDQogICAgLy8gdG8gbWFrZSBzdXJlIGVycm9ycyBhcmUgcmFpc2VkIGFzIHByb21pc2UgcmVqZWN0aW9ucw0KICAgIGFzeW5jIF9vcGVuUG9wdXAoYXV0aCwgcHJvdmlkZXIsIGF1dGhUeXBlLCBldmVudElkKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgZGVidWdBc3NlcnQoKF9hID0gdGhpcy5ldmVudE1hbmFnZXJzW2F1dGguX2tleSgpXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hbmFnZXIsICdfaW5pdGlhbGl6ZSgpIG5vdCBjYWxsZWQgYmVmb3JlIF9vcGVuUG9wdXAoKScpOw0KICAgICAgICBjb25zdCB1cmwgPSBhd2FpdCBfZ2V0UmVkaXJlY3RVcmwoYXV0aCwgcHJvdmlkZXIsIGF1dGhUeXBlLCBfZ2V0Q3VycmVudFVybCgpLCBldmVudElkKTsNCiAgICAgICAgcmV0dXJuIF9vcGVuKGF1dGgsIHVybCwgX2dlbmVyYXRlRXZlbnRJZCgpKTsNCiAgICB9DQogICAgYXN5bmMgX29wZW5SZWRpcmVjdChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIGV2ZW50SWQpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5fb3JpZ2luVmFsaWRhdGlvbihhdXRoKTsNCiAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgX2dldEN1cnJlbnRVcmwoKSwgZXZlbnRJZCk7DQogICAgICAgIF9zZXRXaW5kb3dMb2NhdGlvbih1cmwpOw0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKCkgPT4geyB9KTsNCiAgICB9DQogICAgX2luaXRpYWxpemUoYXV0aCkgew0KICAgICAgICBjb25zdCBrZXkgPSBhdXRoLl9rZXkoKTsNCiAgICAgICAgaWYgKHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldKSB7DQogICAgICAgICAgICBjb25zdCB7IG1hbmFnZXIsIHByb21pc2UgfSA9IHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldOw0KICAgICAgICAgICAgaWYgKG1hbmFnZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG1hbmFnZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZGVidWdBc3NlcnQocHJvbWlzZSwgJ0lmIG1hbmFnZXIgaXMgbm90IHNldCwgcHJvbWlzZSBzaG91bGQgYmUnKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5pbml0QW5kR2V0TWFuYWdlcihhdXRoKTsNCiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXJzW2tleV0gPSB7IHByb21pc2UgfTsNCiAgICAgICAgLy8gSWYgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQsIHRoZSBrZXkgc2hvdWxkIGJlIHJlbW92ZWQgc28gdGhhdCB0aGUNCiAgICAgICAgLy8gb3BlcmF0aW9uIGNhbiBiZSByZXRyaWVkIGxhdGVyLg0KICAgICAgICBwcm9taXNlLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmV2ZW50TWFuYWdlcnNba2V5XTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBwcm9taXNlOw0KICAgIH0NCiAgICBhc3luYyBpbml0QW5kR2V0TWFuYWdlcihhdXRoKSB7DQogICAgICAgIGNvbnN0IGlmcmFtZSA9IGF3YWl0IF9vcGVuSWZyYW1lKGF1dGgpOw0KICAgICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IEF1dGhFdmVudE1hbmFnZXIoYXV0aCk7DQogICAgICAgIGlmcmFtZS5yZWdpc3RlcignYXV0aEV2ZW50JywgKGlmcmFtZUV2ZW50KSA9PiB7DQogICAgICAgICAgICBfYXNzZXJ0KGlmcmFtZUV2ZW50ID09PSBudWxsIHx8IGlmcmFtZUV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpZnJhbWVFdmVudC5hdXRoRXZlbnQsIGF1dGgsICJpbnZhbGlkLWF1dGgtZXZlbnQiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIX0VWRU5UICovKTsNCiAgICAgICAgICAgIC8vIFRPRE86IENvbnNpZGVyIHNwbGl0dGluZyByZWRpcmVjdCBhbmQgcG9wdXAgZXZlbnRzIGVhcmxpZXIgb24NCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZWQgPSBtYW5hZ2VyLm9uRXZlbnQoaWZyYW1lRXZlbnQuYXV0aEV2ZW50KTsNCiAgICAgICAgICAgIHJldHVybiB7IHN0YXR1czogaGFuZGxlZCA/ICJBQ0siIC8qIEdhcGlPdXRjb21lLkFDSyAqLyA6ICJFUlJPUiIgLyogR2FwaU91dGNvbWUuRVJST1IgKi8gfTsNCiAgICAgICAgfSwgZ2FwaS5pZnJhbWVzLkNST1NTX09SSUdJTl9JRlJBTUVTX0ZJTFRFUik7DQogICAgICAgIHRoaXMuZXZlbnRNYW5hZ2Vyc1thdXRoLl9rZXkoKV0gPSB7IG1hbmFnZXIgfTsNCiAgICAgICAgdGhpcy5pZnJhbWVzW2F1dGguX2tleSgpXSA9IGlmcmFtZTsNCiAgICAgICAgcmV0dXJuIG1hbmFnZXI7DQogICAgfQ0KICAgIF9pc0lmcmFtZVdlYlN0b3JhZ2VTdXBwb3J0ZWQoYXV0aCwgY2IpIHsNCiAgICAgICAgY29uc3QgaWZyYW1lID0gdGhpcy5pZnJhbWVzW2F1dGguX2tleSgpXTsNCiAgICAgICAgaWZyYW1lLnNlbmQoV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVksIHsgdHlwZTogV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVkgfSwgcmVzdWx0ID0+IHsNCiAgICAgICAgICAgIHZhciBfYTsNCiAgICAgICAgICAgIGNvbnN0IGlzU3VwcG9ydGVkID0gKF9hID0gcmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0WzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVldOw0KICAgICAgICAgICAgaWYgKGlzU3VwcG9ydGVkICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBjYighIWlzU3VwcG9ydGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9mYWlsKGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIH0sIGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIpOw0KICAgIH0NCiAgICBfb3JpZ2luVmFsaWRhdGlvbihhdXRoKSB7DQogICAgICAgIGNvbnN0IGtleSA9IGF1dGguX2tleSgpOw0KICAgICAgICBpZiAoIXRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzW2tleV0pIHsNCiAgICAgICAgICAgIHRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzW2tleV0gPSBfdmFsaWRhdGVPcmlnaW4oYXV0aCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzW2tleV07DQogICAgfQ0KICAgIGdldCBfc2hvdWxkSW5pdFByb2FjdGl2ZWx5KCkgew0KICAgICAgICAvLyBNb2JpbGUgYnJvd3NlcnMgYW5kIFNhZmFyaSBuZWVkIHRvIG9wdGltaXN0aWNhbGx5IGluaXRpYWxpemUNCiAgICAgICAgcmV0dXJuIF9pc01vYmlsZUJyb3dzZXIoKSB8fCBfaXNTYWZhcmkoKSB8fCBfaXNJT1MoKTsNCiAgICB9DQp9DQovKioNCiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9IHN1aXRhYmxlIGZvciBicm93c2VyDQogKiBiYXNlZCBhcHBsaWNhdGlvbnMuDQogKg0KICogQHJlbWFya3MNCiAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50Lg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgYnJvd3NlclBvcHVwUmVkaXJlY3RSZXNvbHZlciA9IEJyb3dzZXJQb3B1cFJlZGlyZWN0UmVzb2x2ZXI7Cgp2YXIgbmFtZSRIID0gIkBmaXJlYmFzZS9hdXRoIjsKdmFyIHZlcnNpb24kMyA9ICIxLjMuMCI7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBBdXRoSW50ZXJvcCB7DQogICAgY29uc3RydWN0b3IoYXV0aCkgew0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzID0gbmV3IE1hcCgpOw0KICAgIH0NCiAgICBnZXRVaWQoKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgdGhpcy5hc3NlcnRBdXRoQ29uZmlndXJlZCgpOw0KICAgICAgICByZXR1cm4gKChfYSA9IHRoaXMuYXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVpZCkgfHwgbnVsbDsNCiAgICB9DQogICAgYXN5bmMgZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSB7DQogICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTsNCiAgICAgICAgYXdhaXQgdGhpcy5hdXRoLl9pbml0aWFsaXphdGlvblByb21pc2U7DQogICAgICAgIGlmICghdGhpcy5hdXRoLmN1cnJlbnRVc2VyKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IHRoaXMuYXV0aC5jdXJyZW50VXNlci5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7DQogICAgICAgIHJldHVybiB7IGFjY2Vzc1Rva2VuIH07DQogICAgfQ0KICAgIGFkZEF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSB7DQogICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTsNCiAgICAgICAgaWYgKHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuaGFzKGxpc3RlbmVyKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdGhpcy5hdXRoLm9uSWRUb2tlbkNoYW5nZWQodXNlciA9PiB7DQogICAgICAgICAgICBsaXN0ZW5lcigodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnN0c1Rva2VuTWFuYWdlci5hY2Nlc3NUb2tlbikgfHwgbnVsbCk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzLnNldChsaXN0ZW5lciwgdW5zdWJzY3JpYmUpOw0KICAgICAgICB0aGlzLnVwZGF0ZVByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICB9DQogICAgcmVtb3ZlQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpIHsNCiAgICAgICAgdGhpcy5hc3NlcnRBdXRoQ29uZmlndXJlZCgpOw0KICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuZ2V0KGxpc3RlbmVyKTsNCiAgICAgICAgaWYgKCF1bnN1YnNjcmliZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuZGVsZXRlKGxpc3RlbmVyKTsNCiAgICAgICAgdW5zdWJzY3JpYmUoKTsNCiAgICAgICAgdGhpcy51cGRhdGVQcm9hY3RpdmVSZWZyZXNoKCk7DQogICAgfQ0KICAgIGFzc2VydEF1dGhDb25maWd1cmVkKCkgew0KICAgICAgICBfYXNzZXJ0KHRoaXMuYXV0aC5faW5pdGlhbGl6YXRpb25Qcm9taXNlLCAiZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi8pOw0KICAgIH0NCiAgICB1cGRhdGVQcm9hY3RpdmVSZWZyZXNoKCkgew0KICAgICAgICBpZiAodGhpcy5pbnRlcm5hbExpc3RlbmVycy5zaXplID4gMCkgew0KICAgICAgICAgICAgdGhpcy5hdXRoLl9zdGFydFByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aC5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGdldFZlcnNpb25Gb3JQbGF0Zm9ybShjbGllbnRQbGF0Zm9ybSkgew0KICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHsNCiAgICAgICAgY2FzZSAiTm9kZSIgLyogQ2xpZW50UGxhdGZvcm0uTk9ERSAqLzoNCiAgICAgICAgICAgIHJldHVybiAnbm9kZSc7DQogICAgICAgIGNhc2UgIlJlYWN0TmF0aXZlIiAvKiBDbGllbnRQbGF0Zm9ybS5SRUFDVF9OQVRJVkUgKi86DQogICAgICAgICAgICByZXR1cm4gJ3JuJzsNCiAgICAgICAgY2FzZSAiV29ya2VyIiAvKiBDbGllbnRQbGF0Zm9ybS5XT1JLRVIgKi86DQogICAgICAgICAgICByZXR1cm4gJ3dlYndvcmtlcic7DQogICAgICAgIGNhc2UgIkNvcmRvdmEiIC8qIENsaWVudFBsYXRmb3JtLkNPUkRPVkEgKi86DQogICAgICAgICAgICByZXR1cm4gJ2NvcmRvdmEnOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQp9DQovKiogQGludGVybmFsICovDQpmdW5jdGlvbiByZWdpc3RlckF1dGgoY2xpZW50UGxhdGZvcm0pIHsNCiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgiYXV0aCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSCAqLywgKGNvbnRhaW5lciwgeyBvcHRpb25zOiBkZXBzIH0pID0+IHsNCiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgY29uc3QgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKTsNCiAgICAgICAgY29uc3QgYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpOw0KICAgICAgICBjb25zdCB7IGFwaUtleSwgYXV0aERvbWFpbiB9ID0gYXBwLm9wdGlvbnM7DQogICAgICAgIF9hc3NlcnQoYXBpS2V5ICYmICFhcGlLZXkuaW5jbHVkZXMoJzonKSwgImludmFsaWQtYXBpLWtleSIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQSV9LRVkgKi8sIHsgYXBwTmFtZTogYXBwLm5hbWUgfSk7DQogICAgICAgIGNvbnN0IGNvbmZpZyA9IHsNCiAgICAgICAgICAgIGFwaUtleSwNCiAgICAgICAgICAgIGF1dGhEb21haW4sDQogICAgICAgICAgICBjbGllbnRQbGF0Zm9ybSwNCiAgICAgICAgICAgIGFwaUhvc3Q6ICJpZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20iIC8qIERlZmF1bHRDb25maWcuQVBJX0hPU1QgKi8sDQogICAgICAgICAgICB0b2tlbkFwaUhvc3Q6ICJzZWN1cmV0b2tlbi5nb29nbGVhcGlzLmNvbSIgLyogRGVmYXVsdENvbmZpZy5UT0tFTl9BUElfSE9TVCAqLywNCiAgICAgICAgICAgIGFwaVNjaGVtZTogImh0dHBzIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9TQ0hFTUUgKi8sDQogICAgICAgICAgICBzZGtDbGllbnRWZXJzaW9uOiBfZ2V0Q2xpZW50VmVyc2lvbihjbGllbnRQbGF0Zm9ybSkNCiAgICAgICAgfTsNCiAgICAgICAgY29uc3QgYXV0aEluc3RhbmNlID0gbmV3IEF1dGhJbXBsKGFwcCwgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyLCBhcHBDaGVja1NlcnZpY2VQcm92aWRlciwgY29uZmlnKTsNCiAgICAgICAgX2luaXRpYWxpemVBdXRoSW5zdGFuY2UoYXV0aEluc3RhbmNlLCBkZXBzKTsNCiAgICAgICAgcmV0dXJuIGF1dGhJbnN0YW5jZTsNCiAgICB9LCAiUFVCTElDIiAvKiBDb21wb25lbnRUeXBlLlBVQkxJQyAqLykNCiAgICAgICAgLyoqDQogICAgICAgICAqIEF1dGggY2FuIG9ubHkgYmUgaW5pdGlhbGl6ZWQgYnkgZXhwbGljaXRseSBjYWxsaW5nIGdldEF1dGgoKSBvciBpbml0aWFsaXplQXV0aCgpDQogICAgICAgICAqIEZvciB3aHkgd2UgZG8gdGhpcywgU2VlIGdvL2ZpcmViYXNlLW5leHQtYXV0aC1pbml0DQogICAgICAgICAqLw0KICAgICAgICAuc2V0SW5zdGFudGlhdGlvbk1vZGUoIkVYUExJQ0lUIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLykNCiAgICAgICAgLyoqDQogICAgICAgICAqIEJlY2F1c2UgYWxsIGZpcmViYXNlIHByb2R1Y3RzIHRoYXQgZGVwZW5kIG9uIGF1dGggZGVwZW5kIG9uIGF1dGgtaW50ZXJuYWwgZGlyZWN0bHksDQogICAgICAgICAqIHdlIG5lZWQgdG8gaW5pdGlhbGl6ZSBhdXRoLWludGVybmFsIGFmdGVyIGF1dGggaXMgaW5pdGlhbGl6ZWQgdG8gbWFrZSBpdCBhdmFpbGFibGUgdG8gb3RoZXIgZmlyZWJhc2UgcHJvZHVjdHMuDQogICAgICAgICAqLw0KICAgICAgICAuc2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2soKGNvbnRhaW5lciwgX2luc3RhbmNlSWRlbnRpZmllciwgX2luc3RhbmNlKSA9PiB7DQogICAgICAgIGNvbnN0IGF1dGhJbnRlcm5hbFByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCJhdXRoLWludGVybmFsIiAvKiBfQ29tcG9uZW50TmFtZS5BVVRIX0lOVEVSTkFMICovKTsNCiAgICAgICAgYXV0aEludGVybmFsUHJvdmlkZXIuaW5pdGlhbGl6ZSgpOw0KICAgIH0pKTsNCiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgiYXV0aC1pbnRlcm5hbCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLywgY29udGFpbmVyID0+IHsNCiAgICAgICAgY29uc3QgYXV0aCA9IF9jYXN0QXV0aChjb250YWluZXIuZ2V0UHJvdmlkZXIoImF1dGgiIC8qIF9Db21wb25lbnROYW1lLkFVVEggKi8pLmdldEltbWVkaWF0ZSgpKTsNCiAgICAgICAgcmV0dXJuIChhdXRoID0+IG5ldyBBdXRoSW50ZXJvcChhdXRoKSkoYXV0aCk7DQogICAgfSwgIlBSSVZBVEUiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykuc2V0SW5zdGFudGlhdGlvbk1vZGUoIkVYUExJQ0lUIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLykpOw0KICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJEgsIHZlcnNpb24kMywgZ2V0VmVyc2lvbkZvclBsYXRmb3JtKGNsaWVudFBsYXRmb3JtKSk7DQogICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb24NCiAgICByZWdpc3RlclZlcnNpb24obmFtZSRILCB2ZXJzaW9uJDMsICdlc20yMDE3Jyk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBERUZBVUxUX0lEX1RPS0VOX01BWF9BR0UgPSA1ICogNjA7DQpjb25zdCBhdXRoSWRUb2tlbk1heEFnZSA9IGdldEV4cGVyaW1lbnRhbFNldHRpbmcoJ2F1dGhJZFRva2VuTWF4QWdlJykgfHwgREVGQVVMVF9JRF9UT0tFTl9NQVhfQUdFOw0KbGV0IGxhc3RQb3N0ZWRJZFRva2VuID0gbnVsbDsNCmNvbnN0IG1pbnRDb29raWVGYWN0b3J5ID0gKHVybCkgPT4gYXN5bmMgKHVzZXIpID0+IHsNCiAgICBjb25zdCBpZFRva2VuUmVzdWx0ID0gdXNlciAmJiAoYXdhaXQgdXNlci5nZXRJZFRva2VuUmVzdWx0KCkpOw0KICAgIGNvbnN0IGlkVG9rZW5BZ2UgPSBpZFRva2VuUmVzdWx0ICYmDQogICAgICAgIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIERhdGUucGFyc2UoaWRUb2tlblJlc3VsdC5pc3N1ZWRBdFRpbWUpKSAvIDEwMDA7DQogICAgaWYgKGlkVG9rZW5BZ2UgJiYgaWRUb2tlbkFnZSA+IGF1dGhJZFRva2VuTWF4QWdlKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgLy8gU3BlY2lmaWNhbGx5IHRyaXAgbnVsbCA9PiB1bmRlZmluZWQgd2hlbiBsb2dnZWQgb3V0LCB0byBkZWxldGUgYW55IGV4aXN0aW5nIGNvb2tpZQ0KICAgIGNvbnN0IGlkVG9rZW4gPSBpZFRva2VuUmVzdWx0ID09PSBudWxsIHx8IGlkVG9rZW5SZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkVG9rZW5SZXN1bHQudG9rZW47DQogICAgaWYgKGxhc3RQb3N0ZWRJZFRva2VuID09PSBpZFRva2VuKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgbGFzdFBvc3RlZElkVG9rZW4gPSBpZFRva2VuOw0KICAgIGF3YWl0IGZldGNoKHVybCwgew0KICAgICAgICBtZXRob2Q6IGlkVG9rZW4gPyAnUE9TVCcgOiAnREVMRVRFJywNCiAgICAgICAgaGVhZGVyczogaWRUb2tlbg0KICAgICAgICAgICAgPyB7DQogICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aWRUb2tlbn1gDQogICAgICAgICAgICB9DQogICAgICAgICAgICA6IHt9DQogICAgfSk7DQp9Ow0KLyoqDQogKiBSZXR1cm5zIHRoZSBBdXRoIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWQge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9Lg0KICogSWYgbm8gaW5zdGFuY2UgZXhpc3RzLCBpbml0aWFsaXplcyBhbiBBdXRoIGluc3RhbmNlIHdpdGggcGxhdGZvcm0tc3BlY2lmaWMgZGVmYXVsdCBkZXBlbmRlbmNpZXMuDQogKg0KICogQHBhcmFtIGFwcCAtIFRoZSBGaXJlYmFzZSBBcHAuDQogKg0KICogQHB1YmxpYw0KICovDQpmdW5jdGlvbiBnZXRBdXRoKGFwcCA9IGdldEFwcCgpKSB7DQogICAgY29uc3QgcHJvdmlkZXIgPSBfZ2V0UHJvdmlkZXIoYXBwLCAnYXV0aCcpOw0KICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgcmV0dXJuIHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpOw0KICAgIH0NCiAgICBjb25zdCBhdXRoID0gaW5pdGlhbGl6ZUF1dGgoYXBwLCB7DQogICAgICAgIHBvcHVwUmVkaXJlY3RSZXNvbHZlcjogYnJvd3NlclBvcHVwUmVkaXJlY3RSZXNvbHZlciwNCiAgICAgICAgcGVyc2lzdGVuY2U6IFsNCiAgICAgICAgICAgIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UsDQogICAgICAgICAgICBicm93c2VyTG9jYWxQZXJzaXN0ZW5jZSwNCiAgICAgICAgICAgIGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UNCiAgICAgICAgXQ0KICAgIH0pOw0KICAgIGNvbnN0IGF1dGhUb2tlblN5bmNVcmwgPSBnZXRFeHBlcmltZW50YWxTZXR0aW5nKCdhdXRoVG9rZW5TeW5jVVJMJyk7DQogICAgaWYgKGF1dGhUb2tlblN5bmNVcmwpIHsNCiAgICAgICAgY29uc3QgbWludENvb2tpZSA9IG1pbnRDb29raWVGYWN0b3J5KGF1dGhUb2tlblN5bmNVcmwpOw0KICAgICAgICBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKGF1dGgsIG1pbnRDb29raWUsICgpID0+IG1pbnRDb29raWUoYXV0aC5jdXJyZW50VXNlcikpOw0KICAgICAgICBvbklkVG9rZW5DaGFuZ2VkKGF1dGgsIHVzZXIgPT4gbWludENvb2tpZSh1c2VyKSk7DQogICAgfQ0KICAgIGNvbnN0IGF1dGhFbXVsYXRvckhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KCdhdXRoJyk7DQogICAgaWYgKGF1dGhFbXVsYXRvckhvc3QpIHsNCiAgICAgICAgY29ubmVjdEF1dGhFbXVsYXRvcihhdXRoLCBgaHR0cDovLyR7YXV0aEVtdWxhdG9ySG9zdH1gKTsNCiAgICB9DQogICAgcmV0dXJuIGF1dGg7DQp9DQpyZWdpc3RlckF1dGgoIkJyb3dzZXIiIC8qIENsaWVudFBsYXRmb3JtLkJST1dTRVIgKi8pOwoKYXN5bmMgZnVuY3Rpb24gc2lnbmFsU3dhcm0ob2ZmZXIpIHsKICBsZXQgaWQgPSB2NCgpOwogIGNvbnN0IGRiID0gZ2V0RGF0YWJhc2UoKTsKICBsZXQgcmVmZiA9IHJlZihkYiwgYC9zd2FybS8ke2lkfWApOwogIHNldCQxKHJlZmYsIG9mZmVyKTsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgb25WYWx1ZShyZWZmLCAoc25hcHNob3QpID0+IHsKICAgICAgY29uc3QgdGV4dCA9IHNuYXBzaG90LnZhbCgpOwogICAgICBpZiAoIXRleHQpCiAgICAgICAgcmV0dXJuOwogICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7CiAgICAgIGNvbnNvbGUubG9nKCI8IiwgZGF0YSk7CiAgICAgIGlmIChkYXRhLmVycm9yKSB7CiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihkYXRhLmVycm9yKSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghKGRhdGEgJiYgZGF0YS5hbnN3ZXIgJiYgZGF0YS5jYW5kaWRhdGVzKSkKICAgICAgICByZXR1cm47CiAgICAgIHJlbW92ZShyZWZmKTsKICAgICAgcmVzb2x2ZShkYXRhKTsKICAgIH0pOwogIH0pOwp9CmFzeW5jIGZ1bmN0aW9uIHNpZ25hbEFjY291bnQob2ZmZXIpIHsKICBsZXQgYXV0aCA9IGdldEF1dGgoKTsKICBpZiAoIWF1dGguY3VycmVudFVzZXIpCiAgICB0aHJvdyBuZXcgRXJyb3IoIm5vdCBzaWduZWQgaW4iKTsKICBjb25zdCBkYiA9IGdldERhdGFiYXNlKCk7CiAgbGV0IHBlZXIgPSByZWYoZGIsIGAvcGVlcnMvJHthdXRoLmN1cnJlbnRVc2VyLnVpZH1gKTsKICBzZXQkMShwZWVyLCBvZmZlcik7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIG9uVmFsdWUocGVlciwgYXN5bmMgKHNuYXBzaG90KSA9PiB7CiAgICAgIGNvbnN0IHN0ciA9IHNuYXBzaG90LnZhbCgpOwogICAgICBpZiAoc3RyKSB7CiAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHN0cik7CiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5hbnN3ZXIgJiYgZGF0YS5jYW5kaWRhdGVzKSB7CiAgICAgICAgICByZW1vdmUocGVlcik7CiAgICAgICAgICByZXNvbHZlKGRhdGEpOwogICAgICAgICAgZ29PZmZsaW5lKGRiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiBkb3dubG9hZFNob3J0Y3V0KG5hbWUsIHRpdGxlKSB7CiAgbGV0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgYS5ocmVmID0gImRhdGE6dGV4dC9wbGFpbjtiYXNlNjQsIiArIGJ0b2EoYAogICAgPCFET0NUWVBFIGh0bWw+CiAgICA8aHRtbCBsYW5nPSJlbiI+CiAgICAKICAgIDxoZWFkPgogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICAgICAgPHRpdGxlPiR7dGl0bGV9PC90aXRsZT4KICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIGJvZHksCiAgICAgICAgICAgIGh0bWwgewogICAgICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDB2dzsKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwdmg7CiAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgaWZyYW1lIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgIAogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIAogICAgPC9oZWFkPgogICAgCiAgICA8Ym9keT4KICAgICAgICA8aWZyYW1lIHNyYz0iJHtsb2NhdGlvbi5ocmVmfSIgLz4KICAgIDwvYm9keT4KICAgIAogICAgPC9odG1sPgpgKTsKICBjb25zb2xlLmxvZyhhLmhyZWYpOwogIGEuZG93bmxvYWQgPSBuYW1lOwogIGEuY2xpY2soKTsKfQoKY29uc3Qgc0NsaWVudCA9IFN5bWJvbCgic3BhZGl1bSBjbGllbnQiKTsKY29uc3Qgc0Fib3J0ID0gU3ltYm9sKCJzcGFkaXVtIGFib3J0Iik7CmNvbnN0IHNMb2NhdGlvbiA9IFN5bWJvbCgic3BhZGl1bSBsb2NhdGlvbiIpOwpjb25zdCBzSWZyYW1lU3JjID0gU3ltYm9sKCJzcGFkaXVtIGlmcmFtZSBzcmMiKTsKY29uc3Qgc0Jsb2JVcmxzID0gU3ltYm9sKCJzcGFkaXVtIGJsb2IgdXJscyIpOwpjb25zdCBzVGltZW91dHMgPSBTeW1ib2woInNwYWRpdW0gdGltZW91dHMiKTsKCmNvbnN0IHJlZnJlc2hSZWdleCA9IC9eKFxkKykoPzo7P1xzKnVybD0oLispPyk/JC87CmZ1bmN0aW9uIHBhcnNlUmVmcmVzaEhlYWRlcih2YWx1ZSwgd2luKSB7CiAgY29uc3QgbWF0Y2hlcyA9IHZhbHVlLm1hdGNoKHJlZnJlc2hSZWdleCk7CiAgaWYgKCFtYXRjaGVzKQogICAgcmV0dXJuOwogIHJldHVybiB7CiAgICBkdXJhdGlvbjogcGFyc2VJbnQobWF0Y2hlc1sxXSwgMTApLAogICAgdXJsOiBuZXcgVVJMKG1hdGNoZXNbMl0sIHdpbltzTG9jYXRpb25dKS50b1N0cmluZygpCiAgfTsKfQoKdmFyIGNvbW1vbmpzR2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgpmdW5jdGlvbiBnZXRBdWdtZW50ZWROYW1lc3BhY2UobikgewogIGlmIChuLl9fZXNNb2R1bGUpIHJldHVybiBuOwogIHZhciBmID0gbi5kZWZhdWx0OwoJaWYgKHR5cGVvZiBmID09ICJmdW5jdGlvbiIpIHsKCQl2YXIgYSA9IGZ1bmN0aW9uIGEgKCkgewoJCQlpZiAodGhpcyBpbnN0YW5jZW9mIGEpIHsKICAgICAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QoZiwgYXJndW1lbnRzLCB0aGlzLmNvbnN0cnVjdG9yKTsKCQkJfQoJCQlyZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCX07CgkJYS5wcm90b3R5cGUgPSBmLnByb3RvdHlwZTsKICB9IGVsc2UgYSA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCAnX19lc01vZHVsZScsIHt2YWx1ZTogdHJ1ZX0pOwoJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCXZhciBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLCBrKTsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgaywgZC5nZXQgPyBkIDogewoJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCQkJCXJldHVybiBuW2tdOwoJCQl9CgkJfSk7Cgl9KTsKCXJldHVybiBhOwp9CgovKiogSGlnaGVzdCBwb3NpdGl2ZSBzaWduZWQgMzItYml0IGZsb2F0IHZhbHVlICovCmNvbnN0IG1heEludCA9IDIxNDc0ODM2NDc7IC8vIGFrYS4gMHg3RkZGRkZGRiBvciAyXjMxLTEKCi8qKiBCb290c3RyaW5nIHBhcmFtZXRlcnMgKi8KY29uc3QgYmFzZSA9IDM2Owpjb25zdCB0TWluID0gMTsKY29uc3QgdE1heCA9IDI2Owpjb25zdCBza2V3ID0gMzg7CmNvbnN0IGRhbXAgPSA3MDA7CmNvbnN0IGluaXRpYWxCaWFzID0gNzI7CmNvbnN0IGluaXRpYWxOID0gMTI4OyAvLyAweDgwCmNvbnN0IGRlbGltaXRlciA9ICctJzsgLy8gJ1x4MkQnCgovKiogUmVndWxhciBleHByZXNzaW9ucyAqLwpjb25zdCByZWdleFB1bnljb2RlID0gL154bi0tLzsKY29uc3QgcmVnZXhOb25BU0NJSSA9IC9bXlwwLVx4N0ZdLzsgLy8gTm90ZTogVSswMDdGIERFTCBpcyBleGNsdWRlZCB0b28uCmNvbnN0IHJlZ2V4U2VwYXJhdG9ycyA9IC9bXHgyRVx1MzAwMlx1RkYwRVx1RkY2MV0vZzsgLy8gUkZDIDM0OTAgc2VwYXJhdG9ycwoKLyoqIEVycm9yIG1lc3NhZ2VzICovCmNvbnN0IGVycm9ycyA9IHsKCSdvdmVyZmxvdyc6ICdPdmVyZmxvdzogaW5wdXQgbmVlZHMgd2lkZXIgaW50ZWdlcnMgdG8gcHJvY2VzcycsCgknbm90LWJhc2ljJzogJ0lsbGVnYWwgaW5wdXQgPj0gMHg4MCAobm90IGEgYmFzaWMgY29kZSBwb2ludCknLAoJJ2ludmFsaWQtaW5wdXQnOiAnSW52YWxpZCBpbnB1dCcKfTsKCi8qKiBDb252ZW5pZW5jZSBzaG9ydGN1dHMgKi8KY29uc3QgYmFzZU1pbnVzVE1pbiA9IGJhc2UgLSB0TWluOwpjb25zdCBmbG9vciA9IE1hdGguZmxvb3I7CmNvbnN0IHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCi8qKgogKiBBIGdlbmVyaWMgZXJyb3IgdXRpbGl0eSBmdW5jdGlvbi4KICogQHByaXZhdGUKICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGVycm9yIHR5cGUuCiAqIEByZXR1cm5zIHtFcnJvcn0gVGhyb3dzIGEgYFJhbmdlRXJyb3JgIHdpdGggdGhlIGFwcGxpY2FibGUgZXJyb3IgbWVzc2FnZS4KICovCmZ1bmN0aW9uIGVycm9yKHR5cGUpIHsKCXRocm93IG5ldyBSYW5nZUVycm9yKGVycm9yc1t0eXBlXSk7Cn0KCi8qKgogKiBBIGdlbmVyaWMgYEFycmF5I21hcGAgdXRpbGl0eSBmdW5jdGlvbi4KICogQHByaXZhdGUKICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5IGFycmF5CiAqIGl0ZW0uCiAqIEByZXR1cm5zIHtBcnJheX0gQSBuZXcgYXJyYXkgb2YgdmFsdWVzIHJldHVybmVkIGJ5IHRoZSBjYWxsYmFjayBmdW5jdGlvbi4KICovCmZ1bmN0aW9uIG1hcChhcnJheSwgY2FsbGJhY2spIHsKCWNvbnN0IHJlc3VsdCA9IFtdOwoJbGV0IGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKCXdoaWxlIChsZW5ndGgtLSkgewoJCXJlc3VsdFtsZW5ndGhdID0gY2FsbGJhY2soYXJyYXlbbGVuZ3RoXSk7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgovKioKICogQSBzaW1wbGUgYEFycmF5I21hcGAtbGlrZSB3cmFwcGVyIHRvIHdvcmsgd2l0aCBkb21haW4gbmFtZSBzdHJpbmdzIG9yIGVtYWlsCiAqIGFkZHJlc3Nlcy4KICogQHByaXZhdGUKICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5CiAqIGNoYXJhY3Rlci4KICogQHJldHVybnMge1N0cmluZ30gQSBuZXcgc3RyaW5nIG9mIGNoYXJhY3RlcnMgcmV0dXJuZWQgYnkgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gbWFwRG9tYWluKGRvbWFpbiwgY2FsbGJhY2spIHsKCWNvbnN0IHBhcnRzID0gZG9tYWluLnNwbGl0KCdAJyk7CglsZXQgcmVzdWx0ID0gJyc7CglpZiAocGFydHMubGVuZ3RoID4gMSkgewoJCS8vIEluIGVtYWlsIGFkZHJlc3Nlcywgb25seSB0aGUgZG9tYWluIG5hbWUgc2hvdWxkIGJlIHB1bnljb2RlZC4gTGVhdmUKCQkvLyB0aGUgbG9jYWwgcGFydCAoaS5lLiBldmVyeXRoaW5nIHVwIHRvIGBAYCkgaW50YWN0LgoJCXJlc3VsdCA9IHBhcnRzWzBdICsgJ0AnOwoJCWRvbWFpbiA9IHBhcnRzWzFdOwoJfQoJLy8gQXZvaWQgYHNwbGl0KHJlZ2V4KWAgZm9yIElFOCBjb21wYXRpYmlsaXR5LiBTZWUgIzE3LgoJZG9tYWluID0gZG9tYWluLnJlcGxhY2UocmVnZXhTZXBhcmF0b3JzLCAnXHgyRScpOwoJY29uc3QgbGFiZWxzID0gZG9tYWluLnNwbGl0KCcuJyk7Cgljb25zdCBlbmNvZGVkID0gbWFwKGxhYmVscywgY2FsbGJhY2spLmpvaW4oJy4nKTsKCXJldHVybiByZXN1bHQgKyBlbmNvZGVkOwp9CgovKioKICogQ3JlYXRlcyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1lcmljIGNvZGUgcG9pbnRzIG9mIGVhY2ggVW5pY29kZQogKiBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZy4gV2hpbGUgSmF2YVNjcmlwdCB1c2VzIFVDUy0yIGludGVybmFsbHksCiAqIHRoaXMgZnVuY3Rpb24gd2lsbCBjb252ZXJ0IGEgcGFpciBvZiBzdXJyb2dhdGUgaGFsdmVzIChlYWNoIG9mIHdoaWNoCiAqIFVDUy0yIGV4cG9zZXMgYXMgc2VwYXJhdGUgY2hhcmFjdGVycykgaW50byBhIHNpbmdsZSBjb2RlIHBvaW50LAogKiBtYXRjaGluZyBVVEYtMTYuCiAqIEBzZWUgYHB1bnljb2RlLnVjczIuZW5jb2RlYAogKiBAc2VlIDxodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZz4KICogQG1lbWJlck9mIHB1bnljb2RlLnVjczIKICogQG5hbWUgZGVjb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIFVuaWNvZGUgaW5wdXQgc3RyaW5nIChVQ1MtMikuCiAqIEByZXR1cm5zIHtBcnJheX0gVGhlIG5ldyBhcnJheSBvZiBjb2RlIHBvaW50cy4KICovCmZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7Cgljb25zdCBvdXRwdXQgPSBbXTsKCWxldCBjb3VudGVyID0gMDsKCWNvbnN0IGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7Cgl3aGlsZSAoY291bnRlciA8IGxlbmd0aCkgewoJCWNvbnN0IHZhbHVlID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKCQlpZiAodmFsdWUgPj0gMHhEODAwICYmIHZhbHVlIDw9IDB4REJGRiAmJiBjb3VudGVyIDwgbGVuZ3RoKSB7CgkJCS8vIEl0J3MgYSBoaWdoIHN1cnJvZ2F0ZSwgYW5kIHRoZXJlIGlzIGEgbmV4dCBjaGFyYWN0ZXIuCgkJCWNvbnN0IGV4dHJhID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKCQkJaWYgKChleHRyYSAmIDB4RkMwMCkgPT0gMHhEQzAwKSB7IC8vIExvdyBzdXJyb2dhdGUuCgkJCQlvdXRwdXQucHVzaCgoKHZhbHVlICYgMHgzRkYpIDw8IDEwKSArIChleHRyYSAmIDB4M0ZGKSArIDB4MTAwMDApOwoJCQl9IGVsc2UgewoJCQkJLy8gSXQncyBhbiB1bm1hdGNoZWQgc3Vycm9nYXRlOyBvbmx5IGFwcGVuZCB0aGlzIGNvZGUgdW5pdCwgaW4gY2FzZSB0aGUKCQkJCS8vIG5leHQgY29kZSB1bml0IGlzIHRoZSBoaWdoIHN1cnJvZ2F0ZSBvZiBhIHN1cnJvZ2F0ZSBwYWlyLgoJCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCQkJY291bnRlci0tOwoJCQl9CgkJfSBlbHNlIHsKCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCX0KCX0KCXJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBDcmVhdGVzIGEgc3RyaW5nIGJhc2VkIG9uIGFuIGFycmF5IG9mIG51bWVyaWMgY29kZSBwb2ludHMuCiAqIEBzZWUgYHB1bnljb2RlLnVjczIuZGVjb2RlYAogKiBAbWVtYmVyT2YgcHVueWNvZGUudWNzMgogKiBAbmFtZSBlbmNvZGUKICogQHBhcmFtIHtBcnJheX0gY29kZVBvaW50cyBUaGUgYXJyYXkgb2YgbnVtZXJpYyBjb2RlIHBvaW50cy4KICogQHJldHVybnMge1N0cmluZ30gVGhlIG5ldyBVbmljb2RlIHN0cmluZyAoVUNTLTIpLgogKi8KY29uc3QgdWNzMmVuY29kZSA9IGNvZGVQb2ludHMgPT4gU3RyaW5nLmZyb21Db2RlUG9pbnQoLi4uY29kZVBvaW50cyk7CgovKioKICogQ29udmVydHMgYSBiYXNpYyBjb2RlIHBvaW50IGludG8gYSBkaWdpdC9pbnRlZ2VyLgogKiBAc2VlIGBkaWdpdFRvQmFzaWMoKWAKICogQHByaXZhdGUKICogQHBhcmFtIHtOdW1iZXJ9IGNvZGVQb2ludCBUaGUgYmFzaWMgbnVtZXJpYyBjb2RlIHBvaW50IHZhbHVlLgogKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQgKGZvciB1c2UgaW4KICogcmVwcmVzZW50aW5nIGludGVnZXJzKSBpbiB0aGUgcmFuZ2UgYDBgIHRvIGBiYXNlIC0gMWAsIG9yIGBiYXNlYCBpZgogKiB0aGUgY29kZSBwb2ludCBkb2VzIG5vdCByZXByZXNlbnQgYSB2YWx1ZS4KICovCmNvbnN0IGJhc2ljVG9EaWdpdCA9IGZ1bmN0aW9uKGNvZGVQb2ludCkgewoJaWYgKGNvZGVQb2ludCA+PSAweDMwICYmIGNvZGVQb2ludCA8IDB4M0EpIHsKCQlyZXR1cm4gMjYgKyAoY29kZVBvaW50IC0gMHgzMCk7Cgl9CglpZiAoY29kZVBvaW50ID49IDB4NDEgJiYgY29kZVBvaW50IDwgMHg1QikgewoJCXJldHVybiBjb2RlUG9pbnQgLSAweDQxOwoJfQoJaWYgKGNvZGVQb2ludCA+PSAweDYxICYmIGNvZGVQb2ludCA8IDB4N0IpIHsKCQlyZXR1cm4gY29kZVBvaW50IC0gMHg2MTsKCX0KCXJldHVybiBiYXNlOwp9OwoKLyoqCiAqIENvbnZlcnRzIGEgZGlnaXQvaW50ZWdlciBpbnRvIGEgYmFzaWMgY29kZSBwb2ludC4KICogQHNlZSBgYmFzaWNUb0RpZ2l0KClgCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7TnVtYmVyfSBkaWdpdCBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQuCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBiYXNpYyBjb2RlIHBvaW50IHdob3NlIHZhbHVlICh3aGVuIHVzZWQgZm9yCiAqIHJlcHJlc2VudGluZyBpbnRlZ2VycykgaXMgYGRpZ2l0YCwgd2hpY2ggbmVlZHMgdG8gYmUgaW4gdGhlIHJhbmdlCiAqIGAwYCB0byBgYmFzZSAtIDFgLiBJZiBgZmxhZ2AgaXMgbm9uLXplcm8sIHRoZSB1cHBlcmNhc2UgZm9ybSBpcwogKiB1c2VkOyBlbHNlLCB0aGUgbG93ZXJjYXNlIGZvcm0gaXMgdXNlZC4gVGhlIGJlaGF2aW9yIGlzIHVuZGVmaW5lZAogKiBpZiBgZmxhZ2AgaXMgbm9uLXplcm8gYW5kIGBkaWdpdGAgaGFzIG5vIHVwcGVyY2FzZSBmb3JtLgogKi8KY29uc3QgZGlnaXRUb0Jhc2ljID0gZnVuY3Rpb24oZGlnaXQsIGZsYWcpIHsKCS8vICAwLi4yNSBtYXAgdG8gQVNDSUkgYS4ueiBvciBBLi5aCgkvLyAyNi4uMzUgbWFwIHRvIEFTQ0lJIDAuLjkKCXJldHVybiBkaWdpdCArIDIyICsgNzUgKiAoZGlnaXQgPCAyNikgLSAoKGZsYWcgIT0gMCkgPDwgNSk7Cn07CgovKioKICogQmlhcyBhZGFwdGF0aW9uIGZ1bmN0aW9uIGFzIHBlciBzZWN0aW9uIDMuNCBvZiBSRkMgMzQ5Mi4KICogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0OTIjc2VjdGlvbi0zLjQKICogQHByaXZhdGUKICovCmNvbnN0IGFkYXB0ID0gZnVuY3Rpb24oZGVsdGEsIG51bVBvaW50cywgZmlyc3RUaW1lKSB7CglsZXQgayA9IDA7CglkZWx0YSA9IGZpcnN0VGltZSA/IGZsb29yKGRlbHRhIC8gZGFtcCkgOiBkZWx0YSA+PiAxOwoJZGVsdGEgKz0gZmxvb3IoZGVsdGEgLyBudW1Qb2ludHMpOwoJZm9yICgvKiBubyBpbml0aWFsaXphdGlvbiAqLzsgZGVsdGEgPiBiYXNlTWludXNUTWluICogdE1heCA+PiAxOyBrICs9IGJhc2UpIHsKCQlkZWx0YSA9IGZsb29yKGRlbHRhIC8gYmFzZU1pbnVzVE1pbik7Cgl9CglyZXR1cm4gZmxvb3IoayArIChiYXNlTWludXNUTWluICsgMSkgKiBkZWx0YSAvIChkZWx0YSArIHNrZXcpKTsKfTsKCi8qKgogKiBDb252ZXJ0cyBhIFB1bnljb2RlIHN0cmluZyBvZiBBU0NJSS1vbmx5IHN5bWJvbHMgdG8gYSBzdHJpbmcgb2YgVW5pY29kZQogKiBzeW1ib2xzLgogKiBAbWVtYmVyT2YgcHVueWNvZGUKICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgcmVzdWx0aW5nIHN0cmluZyBvZiBVbmljb2RlIHN5bWJvbHMuCiAqLwpjb25zdCBkZWNvZGUkMyA9IGZ1bmN0aW9uKGlucHV0KSB7CgkvLyBEb24ndCB1c2UgVUNTLTIuCgljb25zdCBvdXRwdXQgPSBbXTsKCWNvbnN0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwoJbGV0IGkgPSAwOwoJbGV0IG4gPSBpbml0aWFsTjsKCWxldCBiaWFzID0gaW5pdGlhbEJpYXM7CgoJLy8gSGFuZGxlIHRoZSBiYXNpYyBjb2RlIHBvaW50czogbGV0IGBiYXNpY2AgYmUgdGhlIG51bWJlciBvZiBpbnB1dCBjb2RlCgkvLyBwb2ludHMgYmVmb3JlIHRoZSBsYXN0IGRlbGltaXRlciwgb3IgYDBgIGlmIHRoZXJlIGlzIG5vbmUsIHRoZW4gY29weQoJLy8gdGhlIGZpcnN0IGJhc2ljIGNvZGUgcG9pbnRzIHRvIHRoZSBvdXRwdXQuCgoJbGV0IGJhc2ljID0gaW5wdXQubGFzdEluZGV4T2YoZGVsaW1pdGVyKTsKCWlmIChiYXNpYyA8IDApIHsKCQliYXNpYyA9IDA7Cgl9CgoJZm9yIChsZXQgaiA9IDA7IGogPCBiYXNpYzsgKytqKSB7CgkJLy8gaWYgaXQncyBub3QgYSBiYXNpYyBjb2RlIHBvaW50CgkJaWYgKGlucHV0LmNoYXJDb2RlQXQoaikgPj0gMHg4MCkgewoJCQllcnJvcignbm90LWJhc2ljJyk7CgkJfQoJCW91dHB1dC5wdXNoKGlucHV0LmNoYXJDb2RlQXQoaikpOwoJfQoKCS8vIE1haW4gZGVjb2RpbmcgbG9vcDogc3RhcnQganVzdCBhZnRlciB0aGUgbGFzdCBkZWxpbWl0ZXIgaWYgYW55IGJhc2ljIGNvZGUKCS8vIHBvaW50cyB3ZXJlIGNvcGllZDsgc3RhcnQgYXQgdGhlIGJlZ2lubmluZyBvdGhlcndpc2UuCgoJZm9yIChsZXQgaW5kZXggPSBiYXNpYyA+IDAgPyBiYXNpYyArIDEgOiAwOyBpbmRleCA8IGlucHV0TGVuZ3RoOyAvKiBubyBmaW5hbCBleHByZXNzaW9uICovKSB7CgoJCS8vIGBpbmRleGAgaXMgdGhlIGluZGV4IG9mIHRoZSBuZXh0IGNoYXJhY3RlciB0byBiZSBjb25zdW1lZC4KCQkvLyBEZWNvZGUgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlciBpbnRvIGBkZWx0YWAsCgkJLy8gd2hpY2ggZ2V0cyBhZGRlZCB0byBgaWAuIFRoZSBvdmVyZmxvdyBjaGVja2luZyBpcyBlYXNpZXIKCQkvLyBpZiB3ZSBpbmNyZWFzZSBgaWAgYXMgd2UgZ28sIHRoZW4gc3VidHJhY3Qgb2ZmIGl0cyBzdGFydGluZwoJCS8vIHZhbHVlIGF0IHRoZSBlbmQgdG8gb2J0YWluIGBkZWx0YWAuCgkJY29uc3Qgb2xkaSA9IGk7CgkJZm9yIChsZXQgdyA9IDEsIGsgPSBiYXNlOyAvKiBubyBjb25kaXRpb24gKi87IGsgKz0gYmFzZSkgewoKCQkJaWYgKGluZGV4ID49IGlucHV0TGVuZ3RoKSB7CgkJCQllcnJvcignaW52YWxpZC1pbnB1dCcpOwoJCQl9CgoJCQljb25zdCBkaWdpdCA9IGJhc2ljVG9EaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KyspKTsKCgkJCWlmIChkaWdpdCA+PSBiYXNlKSB7CgkJCQllcnJvcignaW52YWxpZC1pbnB1dCcpOwoJCQl9CgkJCWlmIChkaWdpdCA+IGZsb29yKChtYXhJbnQgLSBpKSAvIHcpKSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoKCQkJaSArPSBkaWdpdCAqIHc7CgkJCWNvbnN0IHQgPSBrIDw9IGJpYXMgPyB0TWluIDogKGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXMpOwoKCQkJaWYgKGRpZ2l0IDwgdCkgewoJCQkJYnJlYWs7CgkJCX0KCgkJCWNvbnN0IGJhc2VNaW51c1QgPSBiYXNlIC0gdDsKCQkJaWYgKHcgPiBmbG9vcihtYXhJbnQgLyBiYXNlTWludXNUKSkgewoJCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJCX0KCgkJCXcgKj0gYmFzZU1pbnVzVDsKCgkJfQoKCQljb25zdCBvdXQgPSBvdXRwdXQubGVuZ3RoICsgMTsKCQliaWFzID0gYWRhcHQoaSAtIG9sZGksIG91dCwgb2xkaSA9PSAwKTsKCgkJLy8gYGlgIHdhcyBzdXBwb3NlZCB0byB3cmFwIGFyb3VuZCBmcm9tIGBvdXRgIHRvIGAwYCwKCQkvLyBpbmNyZW1lbnRpbmcgYG5gIGVhY2ggdGltZSwgc28gd2UnbGwgZml4IHRoYXQgbm93OgoJCWlmIChmbG9vcihpIC8gb3V0KSA+IG1heEludCAtIG4pIHsKCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJfQoKCQluICs9IGZsb29yKGkgLyBvdXQpOwoJCWkgJT0gb3V0OwoKCQkvLyBJbnNlcnQgYG5gIGF0IHBvc2l0aW9uIGBpYCBvZiB0aGUgb3V0cHV0LgoJCW91dHB1dC5zcGxpY2UoaSsrLCAwLCBuKTsKCgl9CgoJcmV0dXJuIFN0cmluZy5mcm9tQ29kZVBvaW50KC4uLm91dHB1dCk7Cn07CgovKioKICogQ29udmVydHMgYSBzdHJpbmcgb2YgVW5pY29kZSBzeW1ib2xzIChlLmcuIGEgZG9tYWluIG5hbWUgbGFiZWwpIHRvIGEKICogUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy4KICogQG1lbWJlck9mIHB1bnljb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIG9mIFVuaWNvZGUgc3ltYm9scy4KICogQHJldHVybnMge1N0cmluZ30gVGhlIHJlc3VsdGluZyBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogKi8KY29uc3QgZW5jb2RlJDMgPSBmdW5jdGlvbihpbnB1dCkgewoJY29uc3Qgb3V0cHV0ID0gW107CgoJLy8gQ29udmVydCB0aGUgaW5wdXQgaW4gVUNTLTIgdG8gYW4gYXJyYXkgb2YgVW5pY29kZSBjb2RlIHBvaW50cy4KCWlucHV0ID0gdWNzMmRlY29kZShpbnB1dCk7CgoJLy8gQ2FjaGUgdGhlIGxlbmd0aC4KCWNvbnN0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwoKCS8vIEluaXRpYWxpemUgdGhlIHN0YXRlLgoJbGV0IG4gPSBpbml0aWFsTjsKCWxldCBkZWx0YSA9IDA7CglsZXQgYmlhcyA9IGluaXRpYWxCaWFzOwoKCS8vIEhhbmRsZSB0aGUgYmFzaWMgY29kZSBwb2ludHMuCglmb3IgKGNvbnN0IGN1cnJlbnRWYWx1ZSBvZiBpbnB1dCkgewoJCWlmIChjdXJyZW50VmFsdWUgPCAweDgwKSB7CgkJCW91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShjdXJyZW50VmFsdWUpKTsKCQl9Cgl9CgoJY29uc3QgYmFzaWNMZW5ndGggPSBvdXRwdXQubGVuZ3RoOwoJbGV0IGhhbmRsZWRDUENvdW50ID0gYmFzaWNMZW5ndGg7CgoJLy8gYGhhbmRsZWRDUENvdW50YCBpcyB0aGUgbnVtYmVyIG9mIGNvZGUgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIGhhbmRsZWQ7CgkvLyBgYmFzaWNMZW5ndGhgIGlzIHRoZSBudW1iZXIgb2YgYmFzaWMgY29kZSBwb2ludHMuCgoJLy8gRmluaXNoIHRoZSBiYXNpYyBzdHJpbmcgd2l0aCBhIGRlbGltaXRlciB1bmxlc3MgaXQncyBlbXB0eS4KCWlmIChiYXNpY0xlbmd0aCkgewoJCW91dHB1dC5wdXNoKGRlbGltaXRlcik7Cgl9CgoJLy8gTWFpbiBlbmNvZGluZyBsb29wOgoJd2hpbGUgKGhhbmRsZWRDUENvdW50IDwgaW5wdXRMZW5ndGgpIHsKCgkJLy8gQWxsIG5vbi1iYXNpYyBjb2RlIHBvaW50cyA8IG4gaGF2ZSBiZWVuIGhhbmRsZWQgYWxyZWFkeS4gRmluZCB0aGUgbmV4dAoJCS8vIGxhcmdlciBvbmU6CgkJbGV0IG0gPSBtYXhJbnQ7CgkJZm9yIChjb25zdCBjdXJyZW50VmFsdWUgb2YgaW5wdXQpIHsKCQkJaWYgKGN1cnJlbnRWYWx1ZSA+PSBuICYmIGN1cnJlbnRWYWx1ZSA8IG0pIHsKCQkJCW0gPSBjdXJyZW50VmFsdWU7CgkJCX0KCQl9CgoJCS8vIEluY3JlYXNlIGBkZWx0YWAgZW5vdWdoIHRvIGFkdmFuY2UgdGhlIGRlY29kZXIncyA8bixpPiBzdGF0ZSB0byA8bSwwPiwKCQkvLyBidXQgZ3VhcmQgYWdhaW5zdCBvdmVyZmxvdy4KCQljb25zdCBoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CgkJaWYgKG0gLSBuID4gZmxvb3IoKG1heEludCAtIGRlbHRhKSAvIGhhbmRsZWRDUENvdW50UGx1c09uZSkpIHsKCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJfQoKCQlkZWx0YSArPSAobSAtIG4pICogaGFuZGxlZENQQ291bnRQbHVzT25lOwoJCW4gPSBtOwoKCQlmb3IgKGNvbnN0IGN1cnJlbnRWYWx1ZSBvZiBpbnB1dCkgewoJCQlpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoJCQlpZiAoY3VycmVudFZhbHVlID09PSBuKSB7CgkJCQkvLyBSZXByZXNlbnQgZGVsdGEgYXMgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlci4KCQkJCWxldCBxID0gZGVsdGE7CgkJCQlmb3IgKGxldCBrID0gYmFzZTsgLyogbm8gY29uZGl0aW9uICovOyBrICs9IGJhc2UpIHsKCQkJCQljb25zdCB0ID0gayA8PSBiaWFzID8gdE1pbiA6IChrID49IGJpYXMgKyB0TWF4ID8gdE1heCA6IGsgLSBiaWFzKTsKCQkJCQlpZiAocSA8IHQpIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNvbnN0IHFNaW51c1QgPSBxIC0gdDsKCQkJCQljb25zdCBiYXNlTWludXNUID0gYmFzZSAtIHQ7CgkJCQkJb3V0cHV0LnB1c2goCgkJCQkJCXN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWModCArIHFNaW51c1QgJSBiYXNlTWludXNULCAwKSkKCQkJCQkpOwoJCQkJCXEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CgkJCQl9CgoJCQkJb3V0cHV0LnB1c2goc3RyaW5nRnJvbUNoYXJDb2RlKGRpZ2l0VG9CYXNpYyhxLCAwKSkpOwoJCQkJYmlhcyA9IGFkYXB0KGRlbHRhLCBoYW5kbGVkQ1BDb3VudFBsdXNPbmUsIGhhbmRsZWRDUENvdW50ID09PSBiYXNpY0xlbmd0aCk7CgkJCQlkZWx0YSA9IDA7CgkJCQkrK2hhbmRsZWRDUENvdW50OwoJCQl9CgkJfQoKCQkrK2RlbHRhOwoJCSsrbjsKCgl9CglyZXR1cm4gb3V0cHV0LmpvaW4oJycpOwp9OwoKLyoqCiAqIENvbnZlcnRzIGEgUHVueWNvZGUgc3RyaW5nIHJlcHJlc2VudGluZyBhIGRvbWFpbiBuYW1lIG9yIGFuIGVtYWlsIGFkZHJlc3MKICogdG8gVW5pY29kZS4gT25seSB0aGUgUHVueWNvZGVkIHBhcnRzIG9mIHRoZSBpbnB1dCB3aWxsIGJlIGNvbnZlcnRlZCwgaS5lLgogKiBpdCBkb2Vzbid0IG1hdHRlciBpZiB5b3UgY2FsbCBpdCBvbiBhIHN0cmluZyB0aGF0IGhhcyBhbHJlYWR5IGJlZW4KICogY29udmVydGVkIHRvIFVuaWNvZGUuCiAqIEBtZW1iZXJPZiBwdW55Y29kZQogKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIFB1bnljb2RlZCBkb21haW4gbmFtZSBvciBlbWFpbCBhZGRyZXNzIHRvCiAqIGNvbnZlcnQgdG8gVW5pY29kZS4KICogQHJldHVybnMge1N0cmluZ30gVGhlIFVuaWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIFB1bnljb2RlCiAqIHN0cmluZy4KICovCmNvbnN0IHRvVW5pY29kZSA9IGZ1bmN0aW9uKGlucHV0KSB7CglyZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbihzdHJpbmcpIHsKCQlyZXR1cm4gcmVnZXhQdW55Y29kZS50ZXN0KHN0cmluZykKCQkJPyBkZWNvZGUkMyhzdHJpbmcuc2xpY2UoNCkudG9Mb3dlckNhc2UoKSkKCQkJOiBzdHJpbmc7Cgl9KTsKfTsKCi8qKgogKiBDb252ZXJ0cyBhIFVuaWNvZGUgc3RyaW5nIHJlcHJlc2VudGluZyBhIGRvbWFpbiBuYW1lIG9yIGFuIGVtYWlsIGFkZHJlc3MgdG8KICogUHVueWNvZGUuIE9ubHkgdGhlIG5vbi1BU0NJSSBwYXJ0cyBvZiB0aGUgZG9tYWluIG5hbWUgd2lsbCBiZSBjb252ZXJ0ZWQsCiAqIGkuZS4gaXQgZG9lc24ndCBtYXR0ZXIgaWYgeW91IGNhbGwgaXQgd2l0aCBhIGRvbWFpbiB0aGF0J3MgYWxyZWFkeSBpbgogKiBBU0NJSS4KICogQG1lbWJlck9mIHB1bnljb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcyB0byBjb252ZXJ0LCBhcyBhCiAqIFVuaWNvZGUgc3RyaW5nLgogKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgUHVueWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIGRvbWFpbiBuYW1lIG9yCiAqIGVtYWlsIGFkZHJlc3MuCiAqLwpjb25zdCB0b0FTQ0lJID0gZnVuY3Rpb24oaW5wdXQpIHsKCXJldHVybiBtYXBEb21haW4oaW5wdXQsIGZ1bmN0aW9uKHN0cmluZykgewoJCXJldHVybiByZWdleE5vbkFTQ0lJLnRlc3Qoc3RyaW5nKQoJCQk/ICd4bi0tJyArIGVuY29kZSQzKHN0cmluZykKCQkJOiBzdHJpbmc7Cgl9KTsKfTsKCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKLyoqIERlZmluZSB0aGUgcHVibGljIEFQSSAqLwpjb25zdCBwdW55Y29kZSQxID0gewoJLyoqCgkgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgUHVueWNvZGUuanMgdmVyc2lvbiBudW1iZXIuCgkgKiBAbWVtYmVyT2YgcHVueWNvZGUKCSAqIEB0eXBlIFN0cmluZwoJICovCgkndmVyc2lvbic6ICcyLjEuMCcsCgkvKioKCSAqIEFuIG9iamVjdCBvZiBtZXRob2RzIHRvIGNvbnZlcnQgZnJvbSBKYXZhU2NyaXB0J3MgaW50ZXJuYWwgY2hhcmFjdGVyCgkgKiByZXByZXNlbnRhdGlvbiAoVUNTLTIpIHRvIFVuaWNvZGUgY29kZSBwb2ludHMsIGFuZCBiYWNrLgoJICogQHNlZSA8aHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtZW5jb2Rpbmc+CgkgKiBAbWVtYmVyT2YgcHVueWNvZGUKCSAqIEB0eXBlIE9iamVjdAoJICovCgkndWNzMic6IHsKCQknZGVjb2RlJzogdWNzMmRlY29kZSwKCQknZW5jb2RlJzogdWNzMmVuY29kZQoJfSwKCSdkZWNvZGUnOiBkZWNvZGUkMywKCSdlbmNvZGUnOiBlbmNvZGUkMywKCSd0b0FTQ0lJJzogdG9BU0NJSSwKCSd0b1VuaWNvZGUnOiB0b1VuaWNvZGUKfTsKCmNvbnN0IHB1bnljb2RlX2VzNiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZGVjb2RlOiBkZWNvZGUkMywKICAgIGRlZmF1bHQ6IHB1bnljb2RlJDEsCiAgICBlbmNvZGU6IGVuY29kZSQzLAogICAgdG9BU0NJSSwKICAgIHRvVW5pY29kZSwKICAgIHVjczJkZWNvZGUsCiAgICB1Y3MyZW5jb2RlCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgcmVxdWlyZSQkMCQyID0gLypAX19QVVJFX18qL2dldEF1Z21lbnRlZE5hbWVzcGFjZShwdW55Y29kZV9lczYpOwoKLyoqCiAqIENoZWNrIGlmIHdlJ3JlIHJlcXVpcmVkIHRvIGFkZCBhIHBvcnQgbnVtYmVyLgogKgogKiBAc2VlIGh0dHBzOi8vdXJsLnNwZWMud2hhdHdnLm9yZy8jZGVmYXVsdC1wb3J0CiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gcG9ydCBQb3J0IG51bWJlciB3ZSBuZWVkIHRvIGNoZWNrCiAqIEBwYXJhbSB7U3RyaW5nfSBwcm90b2NvbCBQcm90b2NvbCB3ZSBuZWVkIHRvIGNoZWNrIGFnYWluc3QuCiAqIEByZXR1cm5zIHtCb29sZWFufSBJcyBpdCBhIGRlZmF1bHQgcG9ydCBmb3IgdGhlIGdpdmVuIHByb3RvY29sCiAqIEBhcGkgcHJpdmF0ZQogKi8KdmFyIHJlcXVpcmVzUG9ydCA9IGZ1bmN0aW9uIHJlcXVpcmVkKHBvcnQsIHByb3RvY29sKSB7CiAgcHJvdG9jb2wgPSBwcm90b2NvbC5zcGxpdCgnOicpWzBdOwogIHBvcnQgPSArcG9ydDsKCiAgaWYgKCFwb3J0KSByZXR1cm4gZmFsc2U7CgogIHN3aXRjaCAocHJvdG9jb2wpIHsKICAgIGNhc2UgJ2h0dHAnOgogICAgY2FzZSAnd3MnOgogICAgcmV0dXJuIHBvcnQgIT09IDgwOwoKICAgIGNhc2UgJ2h0dHBzJzoKICAgIGNhc2UgJ3dzcyc6CiAgICByZXR1cm4gcG9ydCAhPT0gNDQzOwoKICAgIGNhc2UgJ2Z0cCc6CiAgICByZXR1cm4gcG9ydCAhPT0gMjE7CgogICAgY2FzZSAnZ29waGVyJzoKICAgIHJldHVybiBwb3J0ICE9PSA3MDsKCiAgICBjYXNlICdmaWxlJzoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiBwb3J0ICE9PSAwOwp9OwoKdmFyIHF1ZXJ5c3RyaW5naWZ5JDEgPSB7fTsKCnZhciBoYXMkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkKICAsIHVuZGVmOwoKLyoqCiAqIERlY29kZSBhIFVSSSBlbmNvZGVkIHN0cmluZy4KICoKICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBVUkkgZW5jb2RlZCBzdHJpbmcuCiAqIEByZXR1cm5zIHtTdHJpbmd8TnVsbH0gVGhlIGRlY29kZWQgc3RyaW5nLgogKiBAYXBpIHByaXZhdGUKICovCmZ1bmN0aW9uIGRlY29kZSQyKGlucHV0KSB7CiAgdHJ5IHsKICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQucmVwbGFjZSgvXCsvZywgJyAnKSk7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CgovKioKICogQXR0ZW1wdHMgdG8gZW5jb2RlIGEgZ2l2ZW4gaW5wdXQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIHRoYXQgbmVlZHMgdG8gYmUgZW5jb2RlZC4KICogQHJldHVybnMge1N0cmluZ3xOdWxsfSBUaGUgZW5jb2RlZCBzdHJpbmcuCiAqIEBhcGkgcHJpdmF0ZQogKi8KZnVuY3Rpb24gZW5jb2RlJDIoaW5wdXQpIHsKICB0cnkgewogICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChpbnB1dCk7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CgovKioKICogU2ltcGxlIHF1ZXJ5IHN0cmluZyBwYXJzZXIuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBxdWVyeSBUaGUgcXVlcnkgc3RyaW5nIHRoYXQgbmVlZHMgdG8gYmUgcGFyc2VkLgogKiBAcmV0dXJucyB7T2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KZnVuY3Rpb24gcXVlcnlzdHJpbmcocXVlcnkpIHsKICB2YXIgcGFyc2VyID0gLyhbXj0/IyZdKyk9PyhbXiZdKikvZwogICAgLCByZXN1bHQgPSB7fQogICAgLCBwYXJ0OwoKICB3aGlsZSAocGFydCA9IHBhcnNlci5leGVjKHF1ZXJ5KSkgewogICAgdmFyIGtleSA9IGRlY29kZSQyKHBhcnRbMV0pCiAgICAgICwgdmFsdWUgPSBkZWNvZGUkMihwYXJ0WzJdKTsKCiAgICAvLwogICAgLy8gUHJldmVudCBvdmVycmlkaW5nIG9mIGV4aXN0aW5nIHByb3BlcnRpZXMuIFRoaXMgZW5zdXJlcyB0aGF0IGJ1aWxkLWluCiAgICAvLyBtZXRob2RzIGxpa2UgYHRvU3RyaW5nYCBvciBfX3Byb3RvX18gYXJlIG5vdCBvdmVycmlkZW4gYnkgbWFsaWNpb3VzCiAgICAvLyBxdWVyeXN0cmluZ3MuCiAgICAvLwogICAgLy8gSW4gdGhlIGNhc2UgaWYgZmFpbGVkIGRlY29kaW5nLCB3ZSB3YW50IHRvIG9taXQgdGhlIGtleS92YWx1ZSBwYWlycwogICAgLy8gZnJvbSB0aGUgcmVzdWx0LgogICAgLy8KICAgIGlmIChrZXkgPT09IG51bGwgfHwgdmFsdWUgPT09IG51bGwgfHwga2V5IGluIHJlc3VsdCkgY29udGludWU7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqCiAqIFRyYW5zZm9ybSBhIHF1ZXJ5IHN0cmluZyB0byBhbiBvYmplY3QuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogT2JqZWN0IHRoYXQgc2hvdWxkIGJlIHRyYW5zZm9ybWVkLgogKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IE9wdGlvbmFsIHByZWZpeC4KICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCmZ1bmN0aW9uIHF1ZXJ5c3RyaW5naWZ5KG9iaiwgcHJlZml4KSB7CiAgcHJlZml4ID0gcHJlZml4IHx8ICcnOwoKICB2YXIgcGFpcnMgPSBbXQogICAgLCB2YWx1ZQogICAgLCBrZXk7CgogIC8vCiAgLy8gT3B0aW9uYWxseSBwcmVmaXggd2l0aCBhICc/JyBpZiBuZWVkZWQKICAvLwogIGlmICgnc3RyaW5nJyAhPT0gdHlwZW9mIHByZWZpeCkgcHJlZml4ID0gJz8nOwoKICBmb3IgKGtleSBpbiBvYmopIHsKICAgIGlmIChoYXMkMS5jYWxsKG9iaiwga2V5KSkgewogICAgICB2YWx1ZSA9IG9ialtrZXldOwoKICAgICAgLy8KICAgICAgLy8gRWRnZSBjYXNlcyB3aGVyZSB3ZSBhY3R1YWxseSB3YW50IHRvIGVuY29kZSB0aGUgdmFsdWUgdG8gYW4gZW1wdHkKICAgICAgLy8gc3RyaW5nIGluc3RlYWQgb2YgdGhlIHN0cmluZ2lmaWVkIHZhbHVlLgogICAgICAvLwogICAgICBpZiAoIXZhbHVlICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWYgfHwgaXNOYU4odmFsdWUpKSkgewogICAgICAgIHZhbHVlID0gJyc7CiAgICAgIH0KCiAgICAgIGtleSA9IGVuY29kZSQyKGtleSk7CiAgICAgIHZhbHVlID0gZW5jb2RlJDIodmFsdWUpOwoKICAgICAgLy8KICAgICAgLy8gSWYgd2UgZmFpbGVkIHRvIGVuY29kZSB0aGUgc3RyaW5ncywgd2Ugc2hvdWxkIGJhaWwgb3V0IGFzIHdlIGRvbid0CiAgICAgIC8vIHdhbnQgdG8gYWRkIGludmFsaWQgc3RyaW5ncyB0byB0aGUgcXVlcnkuCiAgICAgIC8vCiAgICAgIGlmIChrZXkgPT09IG51bGwgfHwgdmFsdWUgPT09IG51bGwpIGNvbnRpbnVlOwogICAgICBwYWlycy5wdXNoKGtleSArJz0nKyB2YWx1ZSk7CiAgICB9CiAgfQoKICByZXR1cm4gcGFpcnMubGVuZ3RoID8gcHJlZml4ICsgcGFpcnMuam9pbignJicpIDogJyc7Cn0KCi8vCi8vIEV4cG9zZSB0aGUgbW9kdWxlLgovLwpxdWVyeXN0cmluZ2lmeSQxLnN0cmluZ2lmeSA9IHF1ZXJ5c3RyaW5naWZ5OwpxdWVyeXN0cmluZ2lmeSQxLnBhcnNlID0gcXVlcnlzdHJpbmc7Cgp2YXIgcmVxdWlyZWQgPSByZXF1aXJlc1BvcnQKICAsIHFzJDEgPSBxdWVyeXN0cmluZ2lmeSQxCiAgLCBjb250cm9sT3JXaGl0ZXNwYWNlID0gL15bXHgwMC1ceDIwXHUwMGEwXHUxNjgwXHUyMDAwLVx1MjAwYVx1MjAyOFx1MjAyOVx1MjAyZlx1MjA1Zlx1MzAwMFx1ZmVmZl0rLwogICwgQ1JIVExGID0gL1tcblxyXHRdL2cKICAsIHNsYXNoZXMgPSAvXltBLVphLXpdW0EtWmEtejAtOSstLl0qOlwvXC8vCiAgLCBwb3J0ID0gLzpcZCskLwogICwgcHJvdG9jb2xyZSA9IC9eKFthLXpdW2EtejAtOS4rLV0qOik/KFwvXC8pPyhbXFwvXSspPyhbXFNcc10qKS9pCiAgLCB3aW5kb3dzRHJpdmVMZXR0ZXIgPSAvXlthLXpBLVpdOi87CgovKioKICogUmVtb3ZlIGNvbnRyb2wgY2hhcmFjdGVycyBhbmQgd2hpdGVzcGFjZSBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgYSBzdHJpbmcuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gc3RyIFN0cmluZyB0byB0cmltLgogKiBAcmV0dXJucyB7U3RyaW5nfSBBIG5ldyBzdHJpbmcgcmVwcmVzZW50aW5nIGBzdHJgIHN0cmlwcGVkIG9mIGNvbnRyb2wKICogICAgIGNoYXJhY3RlcnMgYW5kIHdoaXRlc3BhY2UgZnJvbSBpdHMgYmVnaW5uaW5nLgogKiBAcHVibGljCiAqLwpmdW5jdGlvbiB0cmltTGVmdChzdHIpIHsKICByZXR1cm4gKHN0ciA/IHN0ciA6ICcnKS50b1N0cmluZygpLnJlcGxhY2UoY29udHJvbE9yV2hpdGVzcGFjZSwgJycpOwp9CgovKioKICogVGhlc2UgYXJlIHRoZSBwYXJzZSBydWxlcyBmb3IgdGhlIFVSTCBwYXJzZXIsIGl0IGluZm9ybXMgdGhlIHBhcnNlcgogKiBhYm91dDoKICoKICogMC4gVGhlIGNoYXIgaXQgTmVlZHMgdG8gcGFyc2UsIGlmIGl0J3MgYSBzdHJpbmcgaXQgc2hvdWxkIGJlIGRvbmUgdXNpbmcKICogICAgaW5kZXhPZiwgUmVnRXhwIHVzaW5nIGV4ZWMgYW5kIE5hTiBtZWFucyBzZXQgYXMgY3VycmVudCB2YWx1ZS4KICogMS4gVGhlIHByb3BlcnR5IHdlIHNob3VsZCBzZXQgd2hlbiBwYXJzaW5nIHRoaXMgdmFsdWUuCiAqIDIuIEluZGljYXRpb24gaWYgaXQncyBiYWNrd2FyZHMgb3IgZm9yd2FyZCBwYXJzaW5nLCB3aGVuIHNldCBhcyBudW1iZXIgaXQncwogKiAgICB0aGUgdmFsdWUgb2YgZXh0cmEgY2hhcnMgdGhhdCBzaG91bGQgYmUgc3BsaXQgb2ZmLgogKiAzLiBJbmhlcml0IGZyb20gbG9jYXRpb24gaWYgbm9uIGV4aXN0aW5nIGluIHRoZSBwYXJzZXIuCiAqIDQuIGB0b0xvd2VyQ2FzZWAgdGhlIHJlc3VsdGluZyB2YWx1ZS4KICovCnZhciBydWxlcyA9IFsKICBbJyMnLCAnaGFzaCddLCAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZnJvbSB0aGUgYmFjay4KICBbJz8nLCAncXVlcnknXSwgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZnJvbSB0aGUgYmFjay4KICBmdW5jdGlvbiBzYW5pdGl6ZShhZGRyZXNzLCB1cmwpIHsgICAgIC8vIFNhbml0aXplIHdoYXQgaXMgbGVmdCBvZiB0aGUgYWRkcmVzcwogICAgcmV0dXJuIGlzU3BlY2lhbCh1cmwucHJvdG9jb2wpID8gYWRkcmVzcy5yZXBsYWNlKC9cXC9nLCAnLycpIDogYWRkcmVzczsKICB9LAogIFsnLycsICdwYXRobmFtZSddLCAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBmcm9tIHRoZSBiYWNrLgogIFsnQCcsICdhdXRoJywgMV0sICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBmcm9tIHRoZSBmcm9udC4KICBbTmFOLCAnaG9zdCcsIHVuZGVmaW5lZCwgMSwgMV0sICAgICAgIC8vIFNldCBsZWZ0IG92ZXIgdmFsdWUuCiAgWy86KFxkKikkLywgJ3BvcnQnLCB1bmRlZmluZWQsIDFdLCAgICAvLyBSZWdFeHAgdGhlIGJhY2suCiAgW05hTiwgJ2hvc3RuYW1lJywgdW5kZWZpbmVkLCAxLCAxXSAgICAvLyBTZXQgbGVmdCBvdmVyLgpdOwoKLyoqCiAqIFRoZXNlIHByb3BlcnRpZXMgc2hvdWxkIG5vdCBiZSBjb3BpZWQgb3IgaW5oZXJpdGVkIGZyb20uIFRoaXMgaXMgb25seSBuZWVkZWQKICogZm9yIGFsbCBub24gYmxvYiBVUkwncyBhcyBhIGJsb2IgVVJMIGRvZXMgbm90IGluY2x1ZGUgYSBoYXNoLCBvbmx5IHRoZQogKiBvcmlnaW4uCiAqCiAqIEB0eXBlIHtPYmplY3R9CiAqIEBwcml2YXRlCiAqLwp2YXIgaWdub3JlID0geyBoYXNoOiAxLCBxdWVyeTogMSB9OwoKLyoqCiAqIFRoZSBsb2NhdGlvbiBvYmplY3QgZGlmZmVycyB3aGVuIHlvdXIgY29kZSBpcyBsb2FkZWQgdGhyb3VnaCBhIG5vcm1hbCBwYWdlLAogKiBXb3JrZXIgb3IgdGhyb3VnaCBhIHdvcmtlciB1c2luZyBhIGJsb2IuIEFuZCB3aXRoIHRoZSBibG9iYmxlIGJlZ2lucyB0aGUKICogdHJvdWJsZSBhcyB0aGUgbG9jYXRpb24gb2JqZWN0IHdpbGwgY29udGFpbiB0aGUgVVJMIG9mIHRoZSBibG9iLCBub3QgdGhlCiAqIGxvY2F0aW9uIG9mIHRoZSBwYWdlIHdoZXJlIG91ciBjb2RlIGlzIGxvYWRlZCBpbi4gVGhlIGFjdHVhbCBvcmlnaW4gaXMKICogZW5jb2RlZCBpbiB0aGUgYHBhdGhuYW1lYCBzbyB3ZSBjYW4gdGhhbmtmdWxseSBnZW5lcmF0ZSBhIGdvb2QgImRlZmF1bHQiCiAqIGxvY2F0aW9uIGZyb20gaXQgc28gd2UgY2FuIGdlbmVyYXRlIHByb3BlciByZWxhdGl2ZSBVUkwncyBhZ2Fpbi4KICoKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBsb2MgT3B0aW9uYWwgZGVmYXVsdCBsb2NhdGlvbiBvYmplY3QuCiAqIEByZXR1cm5zIHtPYmplY3R9IGxvbGNhdGlvbiBvYmplY3QuCiAqIEBwdWJsaWMKICovCmZ1bmN0aW9uIGxvbGNhdGlvbihsb2MpIHsKICB2YXIgZ2xvYmFsVmFyOwoKICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIGdsb2JhbFZhciA9IHdpbmRvdzsKICBlbHNlIGlmICh0eXBlb2YgY29tbW9uanNHbG9iYWwgIT09ICd1bmRlZmluZWQnKSBnbG9iYWxWYXIgPSBjb21tb25qc0dsb2JhbDsKICBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIGdsb2JhbFZhciA9IHNlbGY7CiAgZWxzZSBnbG9iYWxWYXIgPSB7fTsKCiAgdmFyIGxvY2F0aW9uID0gZ2xvYmFsVmFyLmxvY2F0aW9uIHx8IHt9OwogIGxvYyA9IGxvYyB8fCBsb2NhdGlvbjsKCiAgdmFyIGZpbmFsZGVzdGluYXRpb24gPSB7fQogICAgLCB0eXBlID0gdHlwZW9mIGxvYwogICAgLCBrZXk7CgogIGlmICgnYmxvYjonID09PSBsb2MucHJvdG9jb2wpIHsKICAgIGZpbmFsZGVzdGluYXRpb24gPSBuZXcgVXJsJDIodW5lc2NhcGUobG9jLnBhdGhuYW1lKSwge30pOwogIH0gZWxzZSBpZiAoJ3N0cmluZycgPT09IHR5cGUpIHsKICAgIGZpbmFsZGVzdGluYXRpb24gPSBuZXcgVXJsJDIobG9jLCB7fSk7CiAgICBmb3IgKGtleSBpbiBpZ25vcmUpIGRlbGV0ZSBmaW5hbGRlc3RpbmF0aW9uW2tleV07CiAgfSBlbHNlIGlmICgnb2JqZWN0JyA9PT0gdHlwZSkgewogICAgZm9yIChrZXkgaW4gbG9jKSB7CiAgICAgIGlmIChrZXkgaW4gaWdub3JlKSBjb250aW51ZTsKICAgICAgZmluYWxkZXN0aW5hdGlvbltrZXldID0gbG9jW2tleV07CiAgICB9CgogICAgaWYgKGZpbmFsZGVzdGluYXRpb24uc2xhc2hlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGZpbmFsZGVzdGluYXRpb24uc2xhc2hlcyA9IHNsYXNoZXMudGVzdChsb2MuaHJlZik7CiAgICB9CiAgfQoKICByZXR1cm4gZmluYWxkZXN0aW5hdGlvbjsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwcm90b2NvbCBzY2hlbWUgaXMgc3BlY2lhbC4KICoKICogQHBhcmFtIHtTdHJpbmd9IFRoZSBwcm90b2NvbCBzY2hlbWUgb2YgdGhlIFVSTAogKiBAcmV0dXJuIHtCb29sZWFufSBgdHJ1ZWAgaWYgdGhlIHByb3RvY29sIHNjaGVtZSBpcyBzcGVjaWFsLCBlbHNlIGBmYWxzZWAKICogQHByaXZhdGUKICovCmZ1bmN0aW9uIGlzU3BlY2lhbChzY2hlbWUpIHsKICByZXR1cm4gKAogICAgc2NoZW1lID09PSAnZmlsZTonIHx8CiAgICBzY2hlbWUgPT09ICdmdHA6JyB8fAogICAgc2NoZW1lID09PSAnaHR0cDonIHx8CiAgICBzY2hlbWUgPT09ICdodHRwczonIHx8CiAgICBzY2hlbWUgPT09ICd3czonIHx8CiAgICBzY2hlbWUgPT09ICd3c3M6JwogICk7Cn0KCi8qKgogKiBAdHlwZWRlZiBQcm90b2NvbEV4dHJhY3QKICogQHR5cGUgT2JqZWN0CiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBwcm90b2NvbCBQcm90b2NvbCBtYXRjaGVkIGluIHRoZSBVUkwsIGluIGxvd2VyY2FzZS4KICogQHByb3BlcnR5IHtCb29sZWFufSBzbGFzaGVzIGB0cnVlYCBpZiBwcm90b2NvbCBpcyBmb2xsb3dlZCBieSAiLy8iLCBlbHNlIGBmYWxzZWAuCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSByZXN0IFJlc3Qgb2YgdGhlIFVSTCB0aGF0IGlzIG5vdCBwYXJ0IG9mIHRoZSBwcm90b2NvbC4KICovCgovKioKICogRXh0cmFjdCBwcm90b2NvbCBpbmZvcm1hdGlvbiBmcm9tIGEgVVJMIHdpdGgvd2l0aG91dCBkb3VibGUgc2xhc2ggKCIvLyIpLgogKgogKiBAcGFyYW0ge1N0cmluZ30gYWRkcmVzcyBVUkwgd2Ugd2FudCB0byBleHRyYWN0IGZyb20uCiAqIEBwYXJhbSB7T2JqZWN0fSBsb2NhdGlvbgogKiBAcmV0dXJuIHtQcm90b2NvbEV4dHJhY3R9IEV4dHJhY3RlZCBpbmZvcm1hdGlvbi4KICogQHByaXZhdGUKICovCmZ1bmN0aW9uIGV4dHJhY3RQcm90b2NvbChhZGRyZXNzLCBsb2NhdGlvbikgewogIGFkZHJlc3MgPSB0cmltTGVmdChhZGRyZXNzKTsKICBhZGRyZXNzID0gYWRkcmVzcy5yZXBsYWNlKENSSFRMRiwgJycpOwogIGxvY2F0aW9uID0gbG9jYXRpb24gfHwge307CgogIHZhciBtYXRjaCA9IHByb3RvY29scmUuZXhlYyhhZGRyZXNzKTsKICB2YXIgcHJvdG9jb2wgPSBtYXRjaFsxXSA/IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgOiAnJzsKICB2YXIgZm9yd2FyZFNsYXNoZXMgPSAhIW1hdGNoWzJdOwogIHZhciBvdGhlclNsYXNoZXMgPSAhIW1hdGNoWzNdOwogIHZhciBzbGFzaGVzQ291bnQgPSAwOwogIHZhciByZXN0OwoKICBpZiAoZm9yd2FyZFNsYXNoZXMpIHsKICAgIGlmIChvdGhlclNsYXNoZXMpIHsKICAgICAgcmVzdCA9IG1hdGNoWzJdICsgbWF0Y2hbM10gKyBtYXRjaFs0XTsKICAgICAgc2xhc2hlc0NvdW50ID0gbWF0Y2hbMl0ubGVuZ3RoICsgbWF0Y2hbM10ubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgcmVzdCA9IG1hdGNoWzJdICsgbWF0Y2hbNF07CiAgICAgIHNsYXNoZXNDb3VudCA9IG1hdGNoWzJdLmxlbmd0aDsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKG90aGVyU2xhc2hlcykgewogICAgICByZXN0ID0gbWF0Y2hbM10gKyBtYXRjaFs0XTsKICAgICAgc2xhc2hlc0NvdW50ID0gbWF0Y2hbM10ubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgcmVzdCA9IG1hdGNoWzRdOwogICAgfQogIH0KCiAgaWYgKHByb3RvY29sID09PSAnZmlsZTonKSB7CiAgICBpZiAoc2xhc2hlc0NvdW50ID49IDIpIHsKICAgICAgcmVzdCA9IHJlc3Quc2xpY2UoMik7CiAgICB9CiAgfSBlbHNlIGlmIChpc1NwZWNpYWwocHJvdG9jb2wpKSB7CiAgICByZXN0ID0gbWF0Y2hbNF07CiAgfSBlbHNlIGlmIChwcm90b2NvbCkgewogICAgaWYgKGZvcndhcmRTbGFzaGVzKSB7CiAgICAgIHJlc3QgPSByZXN0LnNsaWNlKDIpOwogICAgfQogIH0gZWxzZSBpZiAoc2xhc2hlc0NvdW50ID49IDIgJiYgaXNTcGVjaWFsKGxvY2F0aW9uLnByb3RvY29sKSkgewogICAgcmVzdCA9IG1hdGNoWzRdOwogIH0KCiAgcmV0dXJuIHsKICAgIHByb3RvY29sOiBwcm90b2NvbCwKICAgIHNsYXNoZXM6IGZvcndhcmRTbGFzaGVzIHx8IGlzU3BlY2lhbChwcm90b2NvbCksCiAgICBzbGFzaGVzQ291bnQ6IHNsYXNoZXNDb3VudCwKICAgIHJlc3Q6IHJlc3QKICB9Owp9CgovKioKICogUmVzb2x2ZSBhIHJlbGF0aXZlIFVSTCBwYXRobmFtZSBhZ2FpbnN0IGEgYmFzZSBVUkwgcGF0aG5hbWUuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSByZWxhdGl2ZSBQYXRobmFtZSBvZiB0aGUgcmVsYXRpdmUgVVJMLgogKiBAcGFyYW0ge1N0cmluZ30gYmFzZSBQYXRobmFtZSBvZiB0aGUgYmFzZSBVUkwuCiAqIEByZXR1cm4ge1N0cmluZ30gUmVzb2x2ZWQgcGF0aG5hbWUuCiAqIEBwcml2YXRlCiAqLwpmdW5jdGlvbiByZXNvbHZlKHJlbGF0aXZlLCBiYXNlKSB7CiAgaWYgKHJlbGF0aXZlID09PSAnJykgcmV0dXJuIGJhc2U7CgogIHZhciBwYXRoID0gKGJhc2UgfHwgJy8nKS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5jb25jYXQocmVsYXRpdmUuc3BsaXQoJy8nKSkKICAgICwgaSA9IHBhdGgubGVuZ3RoCiAgICAsIGxhc3QgPSBwYXRoW2kgLSAxXQogICAgLCB1bnNoaWZ0ID0gZmFsc2UKICAgICwgdXAgPSAwOwoKICB3aGlsZSAoaS0tKSB7CiAgICBpZiAocGF0aFtpXSA9PT0gJy4nKSB7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgfSBlbHNlIGlmIChwYXRoW2ldID09PSAnLi4nKSB7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgICB1cCsrOwogICAgfSBlbHNlIGlmICh1cCkgewogICAgICBpZiAoaSA9PT0gMCkgdW5zaGlmdCA9IHRydWU7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgICB1cC0tOwogICAgfQogIH0KCiAgaWYgKHVuc2hpZnQpIHBhdGgudW5zaGlmdCgnJyk7CiAgaWYgKGxhc3QgPT09ICcuJyB8fCBsYXN0ID09PSAnLi4nKSBwYXRoLnB1c2goJycpOwoKICByZXR1cm4gcGF0aC5qb2luKCcvJyk7Cn0KCi8qKgogKiBUaGUgYWN0dWFsIFVSTCBpbnN0YW5jZS4gSW5zdGVhZCBvZiByZXR1cm5pbmcgYW4gb2JqZWN0IHdlJ3ZlIG9wdGVkLWluIHRvCiAqIGNyZWF0ZSBhbiBhY3R1YWwgY29uc3RydWN0b3IgYXMgaXQncyBtdWNoIG1vcmUgbWVtb3J5IGVmZmljaWVudCBhbmQKICogZmFzdGVyIGFuZCBpdCBwbGVhc2VzIG15IE9DRC4KICoKICogSXQgaXMgd29ydGggbm90aW5nIHRoYXQgd2Ugc2hvdWxkIG5vdCB1c2UgYFVSTGAgYXMgY2xhc3MgbmFtZSB0byBwcmV2ZW50CiAqIGNsYXNoZXMgd2l0aCB0aGUgZ2xvYmFsIFVSTCBpbnN0YW5jZSB0aGF0IGdvdCBpbnRyb2R1Y2VkIGluIGJyb3dzZXJzLgogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtTdHJpbmd9IGFkZHJlc3MgVVJMIHdlIHdhbnQgdG8gcGFyc2UuCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gW2xvY2F0aW9uXSBMb2NhdGlvbiBkZWZhdWx0cyBmb3IgcmVsYXRpdmUgcGF0aHMuCiAqIEBwYXJhbSB7Qm9vbGVhbnxGdW5jdGlvbn0gW3BhcnNlcl0gUGFyc2VyIGZvciB0aGUgcXVlcnkgc3RyaW5nLgogKiBAcHJpdmF0ZQogKi8KZnVuY3Rpb24gVXJsJDIoYWRkcmVzcywgbG9jYXRpb24sIHBhcnNlcikgewogIGFkZHJlc3MgPSB0cmltTGVmdChhZGRyZXNzKTsKICBhZGRyZXNzID0gYWRkcmVzcy5yZXBsYWNlKENSSFRMRiwgJycpOwoKICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVXJsJDIpKSB7CiAgICByZXR1cm4gbmV3IFVybCQyKGFkZHJlc3MsIGxvY2F0aW9uLCBwYXJzZXIpOwogIH0KCiAgdmFyIHJlbGF0aXZlLCBleHRyYWN0ZWQsIHBhcnNlLCBpbnN0cnVjdGlvbiwgaW5kZXgsIGtleQogICAgLCBpbnN0cnVjdGlvbnMgPSBydWxlcy5zbGljZSgpCiAgICAsIHR5cGUgPSB0eXBlb2YgbG9jYXRpb24KICAgICwgdXJsID0gdGhpcwogICAgLCBpID0gMDsKCiAgLy8KICAvLyBUaGUgZm9sbG93aW5nIGlmIHN0YXRlbWVudHMgYWxsb3dzIHRoaXMgbW9kdWxlIHR3byBoYXZlIGNvbXBhdGliaWxpdHkgd2l0aAogIC8vIDIgZGlmZmVyZW50IEFQSToKICAvLwogIC8vIDEuIE5vZGUuanMncyBgdXJsLnBhcnNlYCBhcGkgd2hpY2ggYWNjZXB0cyBhIFVSTCwgYm9vbGVhbiBhcyBhcmd1bWVudHMKICAvLyAgICB3aGVyZSB0aGUgYm9vbGVhbiBpbmRpY2F0ZXMgdGhhdCB0aGUgcXVlcnkgc3RyaW5nIHNob3VsZCBhbHNvIGJlIHBhcnNlZC4KICAvLwogIC8vIDIuIFRoZSBgVVJMYCBpbnRlcmZhY2Ugb2YgdGhlIGJyb3dzZXIgd2hpY2ggYWNjZXB0cyBhIFVSTCwgb2JqZWN0IGFzCiAgLy8gICAgYXJndW1lbnRzLiBUaGUgc3VwcGxpZWQgb2JqZWN0IHdpbGwgYmUgdXNlZCBhcyBkZWZhdWx0IHZhbHVlcyAvIGZhbGwtYmFjawogIC8vICAgIGZvciByZWxhdGl2ZSBwYXRocy4KICAvLwogIGlmICgnb2JqZWN0JyAhPT0gdHlwZSAmJiAnc3RyaW5nJyAhPT0gdHlwZSkgewogICAgcGFyc2VyID0gbG9jYXRpb247CiAgICBsb2NhdGlvbiA9IG51bGw7CiAgfQoKICBpZiAocGFyc2VyICYmICdmdW5jdGlvbicgIT09IHR5cGVvZiBwYXJzZXIpIHBhcnNlciA9IHFzJDEucGFyc2U7CgogIGxvY2F0aW9uID0gbG9sY2F0aW9uKGxvY2F0aW9uKTsKCiAgLy8KICAvLyBFeHRyYWN0IHByb3RvY29sIGluZm9ybWF0aW9uIGJlZm9yZSBydW5uaW5nIHRoZSBpbnN0cnVjdGlvbnMuCiAgLy8KICBleHRyYWN0ZWQgPSBleHRyYWN0UHJvdG9jb2woYWRkcmVzcyB8fCAnJywgbG9jYXRpb24pOwogIHJlbGF0aXZlID0gIWV4dHJhY3RlZC5wcm90b2NvbCAmJiAhZXh0cmFjdGVkLnNsYXNoZXM7CiAgdXJsLnNsYXNoZXMgPSBleHRyYWN0ZWQuc2xhc2hlcyB8fCByZWxhdGl2ZSAmJiBsb2NhdGlvbi5zbGFzaGVzOwogIHVybC5wcm90b2NvbCA9IGV4dHJhY3RlZC5wcm90b2NvbCB8fCBsb2NhdGlvbi5wcm90b2NvbCB8fCAnJzsKICBhZGRyZXNzID0gZXh0cmFjdGVkLnJlc3Q7CgogIC8vCiAgLy8gV2hlbiB0aGUgYXV0aG9yaXR5IGNvbXBvbmVudCBpcyBhYnNlbnQgdGhlIFVSTCBzdGFydHMgd2l0aCBhIHBhdGgKICAvLyBjb21wb25lbnQuCiAgLy8KICBpZiAoCiAgICBleHRyYWN0ZWQucHJvdG9jb2wgPT09ICdmaWxlOicgJiYgKAogICAgICBleHRyYWN0ZWQuc2xhc2hlc0NvdW50ICE9PSAyIHx8IHdpbmRvd3NEcml2ZUxldHRlci50ZXN0KGFkZHJlc3MpKSB8fAogICAgKCFleHRyYWN0ZWQuc2xhc2hlcyAmJgogICAgICAoZXh0cmFjdGVkLnByb3RvY29sIHx8CiAgICAgICAgZXh0cmFjdGVkLnNsYXNoZXNDb3VudCA8IDIgfHwKICAgICAgICAhaXNTcGVjaWFsKHVybC5wcm90b2NvbCkpKQogICkgewogICAgaW5zdHJ1Y3Rpb25zWzNdID0gWy8oLiopLywgJ3BhdGhuYW1lJ107CiAgfQoKICBmb3IgKDsgaSA8IGluc3RydWN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbnNbaV07CgogICAgaWYgKHR5cGVvZiBpbnN0cnVjdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBhZGRyZXNzID0gaW5zdHJ1Y3Rpb24oYWRkcmVzcywgdXJsKTsKICAgICAgY29udGludWU7CiAgICB9CgogICAgcGFyc2UgPSBpbnN0cnVjdGlvblswXTsKICAgIGtleSA9IGluc3RydWN0aW9uWzFdOwoKICAgIGlmIChwYXJzZSAhPT0gcGFyc2UpIHsKICAgICAgdXJsW2tleV0gPSBhZGRyZXNzOwogICAgfSBlbHNlIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHBhcnNlKSB7CiAgICAgIGluZGV4ID0gcGFyc2UgPT09ICdAJwogICAgICAgID8gYWRkcmVzcy5sYXN0SW5kZXhPZihwYXJzZSkKICAgICAgICA6IGFkZHJlc3MuaW5kZXhPZihwYXJzZSk7CgogICAgICBpZiAofmluZGV4KSB7CiAgICAgICAgaWYgKCdudW1iZXInID09PSB0eXBlb2YgaW5zdHJ1Y3Rpb25bMl0pIHsKICAgICAgICAgIHVybFtrZXldID0gYWRkcmVzcy5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgICBhZGRyZXNzID0gYWRkcmVzcy5zbGljZShpbmRleCArIGluc3RydWN0aW9uWzJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdXJsW2tleV0gPSBhZGRyZXNzLnNsaWNlKGluZGV4KTsKICAgICAgICAgIGFkZHJlc3MgPSBhZGRyZXNzLnNsaWNlKDAsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoKGluZGV4ID0gcGFyc2UuZXhlYyhhZGRyZXNzKSkpIHsKICAgICAgdXJsW2tleV0gPSBpbmRleFsxXTsKICAgICAgYWRkcmVzcyA9IGFkZHJlc3Muc2xpY2UoMCwgaW5kZXguaW5kZXgpOwogICAgfQoKICAgIHVybFtrZXldID0gdXJsW2tleV0gfHwgKAogICAgICByZWxhdGl2ZSAmJiBpbnN0cnVjdGlvblszXSA/IGxvY2F0aW9uW2tleV0gfHwgJycgOiAnJwogICAgKTsKCiAgICAvLwogICAgLy8gSG9zdG5hbWUsIGhvc3QgYW5kIHByb3RvY29sIHNob3VsZCBiZSBsb3dlcmNhc2VkIHNvIHRoZXkgY2FuIGJlIHVzZWQgdG8KICAgIC8vIGNyZWF0ZSBhIHByb3BlciBgb3JpZ2luYC4KICAgIC8vCiAgICBpZiAoaW5zdHJ1Y3Rpb25bNF0pIHVybFtrZXldID0gdXJsW2tleV0udG9Mb3dlckNhc2UoKTsKICB9CgogIC8vCiAgLy8gQWxzbyBwYXJzZSB0aGUgc3VwcGxpZWQgcXVlcnkgc3RyaW5nIGluIHRvIGFuIG9iamVjdC4gSWYgd2UncmUgc3VwcGxpZWQKICAvLyB3aXRoIGEgY3VzdG9tIHBhcnNlciBhcyBmdW5jdGlvbiB1c2UgdGhhdCBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IGJ1aWxkLWluCiAgLy8gcGFyc2VyLgogIC8vCiAgaWYgKHBhcnNlcikgdXJsLnF1ZXJ5ID0gcGFyc2VyKHVybC5xdWVyeSk7CgogIC8vCiAgLy8gSWYgdGhlIFVSTCBpcyByZWxhdGl2ZSwgcmVzb2x2ZSB0aGUgcGF0aG5hbWUgYWdhaW5zdCB0aGUgYmFzZSBVUkwuCiAgLy8KICBpZiAoCiAgICAgIHJlbGF0aXZlCiAgICAmJiBsb2NhdGlvbi5zbGFzaGVzCiAgICAmJiB1cmwucGF0aG5hbWUuY2hhckF0KDApICE9PSAnLycKICAgICYmICh1cmwucGF0aG5hbWUgIT09ICcnIHx8IGxvY2F0aW9uLnBhdGhuYW1lICE9PSAnJykKICApIHsKICAgIHVybC5wYXRobmFtZSA9IHJlc29sdmUodXJsLnBhdGhuYW1lLCBsb2NhdGlvbi5wYXRobmFtZSk7CiAgfQoKICAvLwogIC8vIERlZmF1bHQgdG8gYSAvIGZvciBwYXRobmFtZSBpZiBub25lIGV4aXN0cy4gVGhpcyBub3JtYWxpemVzIHRoZSBVUkwKICAvLyB0byBhbHdheXMgaGF2ZSBhIC8KICAvLwogIGlmICh1cmwucGF0aG5hbWUuY2hhckF0KDApICE9PSAnLycgJiYgaXNTcGVjaWFsKHVybC5wcm90b2NvbCkpIHsKICAgIHVybC5wYXRobmFtZSA9ICcvJyArIHVybC5wYXRobmFtZTsKICB9CgogIC8vCiAgLy8gV2Ugc2hvdWxkIG5vdCBhZGQgcG9ydCBudW1iZXJzIGlmIHRoZXkgYXJlIGFscmVhZHkgdGhlIGRlZmF1bHQgcG9ydCBudW1iZXIKICAvLyBmb3IgYSBnaXZlbiBwcm90b2NvbC4gQXMgdGhlIGhvc3QgYWxzbyBjb250YWlucyB0aGUgcG9ydCBudW1iZXIgd2UncmUgZ29pbmcKICAvLyBvdmVycmlkZSBpdCB3aXRoIHRoZSBob3N0bmFtZSB3aGljaCBjb250YWlucyBubyBwb3J0IG51bWJlci4KICAvLwogIGlmICghcmVxdWlyZWQodXJsLnBvcnQsIHVybC5wcm90b2NvbCkpIHsKICAgIHVybC5ob3N0ID0gdXJsLmhvc3RuYW1lOwogICAgdXJsLnBvcnQgPSAnJzsKICB9CgogIC8vCiAgLy8gUGFyc2UgZG93biB0aGUgYGF1dGhgIGZvciB0aGUgdXNlcm5hbWUgYW5kIHBhc3N3b3JkLgogIC8vCiAgdXJsLnVzZXJuYW1lID0gdXJsLnBhc3N3b3JkID0gJyc7CgogIGlmICh1cmwuYXV0aCkgewogICAgaW5kZXggPSB1cmwuYXV0aC5pbmRleE9mKCc6Jyk7CgogICAgaWYgKH5pbmRleCkgewogICAgICB1cmwudXNlcm5hbWUgPSB1cmwuYXV0aC5zbGljZSgwLCBpbmRleCk7CiAgICAgIHVybC51c2VybmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQodXJsLnVzZXJuYW1lKSk7CgogICAgICB1cmwucGFzc3dvcmQgPSB1cmwuYXV0aC5zbGljZShpbmRleCArIDEpOwogICAgICB1cmwucGFzc3dvcmQgPSBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXNzd29yZCkpOwogICAgfSBlbHNlIHsKICAgICAgdXJsLnVzZXJuYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudCh1cmwuYXV0aCkpOwogICAgfQoKICAgIHVybC5hdXRoID0gdXJsLnBhc3N3b3JkID8gdXJsLnVzZXJuYW1lICsnOicrIHVybC5wYXNzd29yZCA6IHVybC51c2VybmFtZTsKICB9CgogIHVybC5vcmlnaW4gPSB1cmwucHJvdG9jb2wgIT09ICdmaWxlOicgJiYgaXNTcGVjaWFsKHVybC5wcm90b2NvbCkgJiYgdXJsLmhvc3QKICAgID8gdXJsLnByb3RvY29sICsnLy8nKyB1cmwuaG9zdAogICAgOiAnbnVsbCc7CgogIC8vCiAgLy8gVGhlIGhyZWYgaXMganVzdCB0aGUgY29tcGlsZWQgcmVzdWx0LgogIC8vCiAgdXJsLmhyZWYgPSB1cmwudG9TdHJpbmcoKTsKfQoKLyoqCiAqIFRoaXMgaXMgY29udmVuaWVuY2UgbWV0aG9kIGZvciBjaGFuZ2luZyBwcm9wZXJ0aWVzIGluIHRoZSBVUkwgaW5zdGFuY2UgdG8KICogaW5zdXJlIHRoYXQgdGhleSBhbGwgcHJvcGFnYXRlIGNvcnJlY3RseS4KICoKICogQHBhcmFtIHtTdHJpbmd9IHBhcnQgICAgICAgICAgUHJvcGVydHkgd2UgbmVlZCB0byBhZGp1c3QuCiAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlICAgICAgICAgIFRoZSBuZXdseSBhc3NpZ25lZCB2YWx1ZS4KICogQHBhcmFtIHtCb29sZWFufEZ1bmN0aW9ufSBmbiAgV2hlbiBzZXR0aW5nIHRoZSBxdWVyeSwgaXQgd2lsbCBiZSB0aGUgZnVuY3Rpb24KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCB0byBwYXJzZSB0aGUgcXVlcnkuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoZW4gc2V0dGluZyB0aGUgcHJvdG9jb2wsIGRvdWJsZSBzbGFzaCB3aWxsIGJlCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWQgZnJvbSB0aGUgZmluYWwgdXJsIGlmIGl0IGlzIHRydWUuCiAqIEByZXR1cm5zIHtVUkx9IFVSTCBpbnN0YW5jZSBmb3IgY2hhaW5pbmcuCiAqIEBwdWJsaWMKICovCmZ1bmN0aW9uIHNldChwYXJ0LCB2YWx1ZSwgZm4pIHsKICB2YXIgdXJsID0gdGhpczsKCiAgc3dpdGNoIChwYXJ0KSB7CiAgICBjYXNlICdxdWVyeSc6CiAgICAgIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHZhbHVlICYmIHZhbHVlLmxlbmd0aCkgewogICAgICAgIHZhbHVlID0gKGZuIHx8IHFzJDEucGFyc2UpKHZhbHVlKTsKICAgICAgfQoKICAgICAgdXJsW3BhcnRdID0gdmFsdWU7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3BvcnQnOgogICAgICB1cmxbcGFydF0gPSB2YWx1ZTsKCiAgICAgIGlmICghcmVxdWlyZWQodmFsdWUsIHVybC5wcm90b2NvbCkpIHsKICAgICAgICB1cmwuaG9zdCA9IHVybC5ob3N0bmFtZTsKICAgICAgICB1cmxbcGFydF0gPSAnJzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSkgewogICAgICAgIHVybC5ob3N0ID0gdXJsLmhvc3RuYW1lICsnOicrIHZhbHVlOwogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICdob3N0bmFtZSc6CiAgICAgIHVybFtwYXJ0XSA9IHZhbHVlOwoKICAgICAgaWYgKHVybC5wb3J0KSB2YWx1ZSArPSAnOicrIHVybC5wb3J0OwogICAgICB1cmwuaG9zdCA9IHZhbHVlOwogICAgICBicmVhazsKCiAgICBjYXNlICdob3N0JzoKICAgICAgdXJsW3BhcnRdID0gdmFsdWU7CgogICAgICBpZiAocG9ydC50ZXN0KHZhbHVlKSkgewogICAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJzonKTsKICAgICAgICB1cmwucG9ydCA9IHZhbHVlLnBvcCgpOwogICAgICAgIHVybC5ob3N0bmFtZSA9IHZhbHVlLmpvaW4oJzonKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1cmwuaG9zdG5hbWUgPSB2YWx1ZTsKICAgICAgICB1cmwucG9ydCA9ICcnOwogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICdwcm90b2NvbCc6CiAgICAgIHVybC5wcm90b2NvbCA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7CiAgICAgIHVybC5zbGFzaGVzID0gIWZuOwogICAgICBicmVhazsKCiAgICBjYXNlICdwYXRobmFtZSc6CiAgICBjYXNlICdoYXNoJzoKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgdmFyIGNoYXIgPSBwYXJ0ID09PSAncGF0aG5hbWUnID8gJy8nIDogJyMnOwogICAgICAgIHVybFtwYXJ0XSA9IHZhbHVlLmNoYXJBdCgwKSAhPT0gY2hhciA/IGNoYXIgKyB2YWx1ZSA6IHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHVybFtwYXJ0XSA9IHZhbHVlOwogICAgICB9CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3VzZXJuYW1lJzoKICAgIGNhc2UgJ3Bhc3N3b3JkJzoKICAgICAgdXJsW3BhcnRdID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAnYXV0aCc6CiAgICAgIHZhciBpbmRleCA9IHZhbHVlLmluZGV4T2YoJzonKTsKCiAgICAgIGlmICh+aW5kZXgpIHsKICAgICAgICB1cmwudXNlcm5hbWUgPSB2YWx1ZS5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgdXJsLnVzZXJuYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudCh1cmwudXNlcm5hbWUpKTsKCiAgICAgICAgdXJsLnBhc3N3b3JkID0gdmFsdWUuc2xpY2UoaW5kZXggKyAxKTsKICAgICAgICB1cmwucGFzc3dvcmQgPSBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXNzd29yZCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHVybC51c2VybmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQodmFsdWUpKTsKICAgICAgfQogIH0KCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGlucyA9IHJ1bGVzW2ldOwoKICAgIGlmIChpbnNbNF0pIHVybFtpbnNbMV1dID0gdXJsW2luc1sxXV0udG9Mb3dlckNhc2UoKTsKICB9CgogIHVybC5hdXRoID0gdXJsLnBhc3N3b3JkID8gdXJsLnVzZXJuYW1lICsnOicrIHVybC5wYXNzd29yZCA6IHVybC51c2VybmFtZTsKCiAgdXJsLm9yaWdpbiA9IHVybC5wcm90b2NvbCAhPT0gJ2ZpbGU6JyAmJiBpc1NwZWNpYWwodXJsLnByb3RvY29sKSAmJiB1cmwuaG9zdAogICAgPyB1cmwucHJvdG9jb2wgKycvLycrIHVybC5ob3N0CiAgICA6ICdudWxsJzsKCiAgdXJsLmhyZWYgPSB1cmwudG9TdHJpbmcoKTsKCiAgcmV0dXJuIHVybDsKfQoKLyoqCiAqIFRyYW5zZm9ybSB0aGUgcHJvcGVydGllcyBiYWNrIGluIHRvIGEgdmFsaWQgYW5kIGZ1bGwgVVJMIHN0cmluZy4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3RyaW5naWZ5IE9wdGlvbmFsIHF1ZXJ5IHN0cmluZ2lmeSBmdW5jdGlvbi4KICogQHJldHVybnMge1N0cmluZ30gQ29tcGlsZWQgdmVyc2lvbiBvZiB0aGUgVVJMLgogKiBAcHVibGljCiAqLwpmdW5jdGlvbiB0b1N0cmluZyQxKHN0cmluZ2lmeSkgewogIGlmICghc3RyaW5naWZ5IHx8ICdmdW5jdGlvbicgIT09IHR5cGVvZiBzdHJpbmdpZnkpIHN0cmluZ2lmeSA9IHFzJDEuc3RyaW5naWZ5OwoKICB2YXIgcXVlcnkKICAgICwgdXJsID0gdGhpcwogICAgLCBob3N0ID0gdXJsLmhvc3QKICAgICwgcHJvdG9jb2wgPSB1cmwucHJvdG9jb2w7CgogIGlmIChwcm90b2NvbCAmJiBwcm90b2NvbC5jaGFyQXQocHJvdG9jb2wubGVuZ3RoIC0gMSkgIT09ICc6JykgcHJvdG9jb2wgKz0gJzonOwoKICB2YXIgcmVzdWx0ID0KICAgIHByb3RvY29sICsKICAgICgodXJsLnByb3RvY29sICYmIHVybC5zbGFzaGVzKSB8fCBpc1NwZWNpYWwodXJsLnByb3RvY29sKSA/ICcvLycgOiAnJyk7CgogIGlmICh1cmwudXNlcm5hbWUpIHsKICAgIHJlc3VsdCArPSB1cmwudXNlcm5hbWU7CiAgICBpZiAodXJsLnBhc3N3b3JkKSByZXN1bHQgKz0gJzonKyB1cmwucGFzc3dvcmQ7CiAgICByZXN1bHQgKz0gJ0AnOwogIH0gZWxzZSBpZiAodXJsLnBhc3N3b3JkKSB7CiAgICByZXN1bHQgKz0gJzonKyB1cmwucGFzc3dvcmQ7CiAgICByZXN1bHQgKz0gJ0AnOwogIH0gZWxzZSBpZiAoCiAgICB1cmwucHJvdG9jb2wgIT09ICdmaWxlOicgJiYKICAgIGlzU3BlY2lhbCh1cmwucHJvdG9jb2wpICYmCiAgICAhaG9zdCAmJgogICAgdXJsLnBhdGhuYW1lICE9PSAnLycKICApIHsKICAgIC8vCiAgICAvLyBBZGQgYmFjayB0aGUgZW1wdHkgdXNlcmluZm8sIG90aGVyd2lzZSB0aGUgb3JpZ2luYWwgaW52YWxpZCBVUkwKICAgIC8vIG1pZ2h0IGJlIHRyYW5zZm9ybWVkIGludG8gYSB2YWxpZCBvbmUgd2l0aCBgdXJsLnBhdGhuYW1lYCBhcyBob3N0LgogICAgLy8KICAgIHJlc3VsdCArPSAnQCc7CiAgfQoKICAvLwogIC8vIFRyYWlsaW5nIGNvbG9uIGlzIHJlbW92ZWQgZnJvbSBgdXJsLmhvc3RgIHdoZW4gaXQgaXMgcGFyc2VkLiBJZiBpdCBzdGlsbAogIC8vIGVuZHMgd2l0aCBhIGNvbG9uLCB0aGVuIGFkZCBiYWNrIHRoZSB0cmFpbGluZyBjb2xvbiB0aGF0IHdhcyByZW1vdmVkLiBUaGlzCiAgLy8gcHJldmVudHMgYW4gaW52YWxpZCBVUkwgZnJvbSBiZWluZyB0cmFuc2Zvcm1lZCBpbnRvIGEgdmFsaWQgb25lLgogIC8vCiAgaWYgKGhvc3RbaG9zdC5sZW5ndGggLSAxXSA9PT0gJzonIHx8IChwb3J0LnRlc3QodXJsLmhvc3RuYW1lKSAmJiAhdXJsLnBvcnQpKSB7CiAgICBob3N0ICs9ICc6JzsKICB9CgogIHJlc3VsdCArPSBob3N0ICsgdXJsLnBhdGhuYW1lOwoKICBxdWVyeSA9ICdvYmplY3QnID09PSB0eXBlb2YgdXJsLnF1ZXJ5ID8gc3RyaW5naWZ5KHVybC5xdWVyeSkgOiB1cmwucXVlcnk7CiAgaWYgKHF1ZXJ5KSByZXN1bHQgKz0gJz8nICE9PSBxdWVyeS5jaGFyQXQoMCkgPyAnPycrIHF1ZXJ5IDogcXVlcnk7CgogIGlmICh1cmwuaGFzaCkgcmVzdWx0ICs9IHVybC5oYXNoOwoKICByZXR1cm4gcmVzdWx0Owp9CgpVcmwkMi5wcm90b3R5cGUgPSB7IHNldDogc2V0LCB0b1N0cmluZzogdG9TdHJpbmckMSB9OwoKLy8KLy8gRXhwb3NlIHRoZSBVUkwgcGFyc2VyIGFuZCBzb21lIGFkZGl0aW9uYWwgcHJvcGVydGllcyB0aGF0IG1pZ2h0IGJlIHVzZWZ1bCBmb3IKLy8gb3RoZXJzIG9yIHRlc3RpbmcuCi8vClVybCQyLmV4dHJhY3RQcm90b2NvbCA9IGV4dHJhY3RQcm90b2NvbDsKVXJsJDIubG9jYXRpb24gPSBsb2xjYXRpb247ClVybCQyLnRyaW1MZWZ0ID0gdHJpbUxlZnQ7ClVybCQyLnFzID0gcXMkMTsKCnZhciB1cmxQYXJzZSQxID0gVXJsJDI7Cgp2YXIgcHVic3VmZml4UHNsID0ge307Cgp2YXIgcHNsJDEgPSB7fTsKCmNvbnN0IHJlcXVpcmUkJDEgPSBbCgkiYWMiLAoJImNvbS5hYyIsCgkiZWR1LmFjIiwKCSJnb3YuYWMiLAoJIm5ldC5hYyIsCgkibWlsLmFjIiwKCSJvcmcuYWMiLAoJImFkIiwKCSJub20uYWQiLAoJImFlIiwKCSJjby5hZSIsCgkibmV0LmFlIiwKCSJvcmcuYWUiLAoJInNjaC5hZSIsCgkiYWMuYWUiLAoJImdvdi5hZSIsCgkibWlsLmFlIiwKCSJhZXJvIiwKCSJhY2NpZGVudC1pbnZlc3RpZ2F0aW9uLmFlcm8iLAoJImFjY2lkZW50LXByZXZlbnRpb24uYWVybyIsCgkiYWVyb2JhdGljLmFlcm8iLAoJImFlcm9jbHViLmFlcm8iLAoJImFlcm9kcm9tZS5hZXJvIiwKCSJhZ2VudHMuYWVybyIsCgkiYWlyY3JhZnQuYWVybyIsCgkiYWlybGluZS5hZXJvIiwKCSJhaXJwb3J0LmFlcm8iLAoJImFpci1zdXJ2ZWlsbGFuY2UuYWVybyIsCgkiYWlydHJhZmZpYy5hZXJvIiwKCSJhaXItdHJhZmZpYy1jb250cm9sLmFlcm8iLAoJImFtYnVsYW5jZS5hZXJvIiwKCSJhbXVzZW1lbnQuYWVybyIsCgkiYXNzb2NpYXRpb24uYWVybyIsCgkiYXV0aG9yLmFlcm8iLAoJImJhbGxvb25pbmcuYWVybyIsCgkiYnJva2VyLmFlcm8iLAoJImNhYS5hZXJvIiwKCSJjYXJnby5hZXJvIiwKCSJjYXRlcmluZy5hZXJvIiwKCSJjZXJ0aWZpY2F0aW9uLmFlcm8iLAoJImNoYW1waW9uc2hpcC5hZXJvIiwKCSJjaGFydGVyLmFlcm8iLAoJImNpdmlsYXZpYXRpb24uYWVybyIsCgkiY2x1Yi5hZXJvIiwKCSJjb25mZXJlbmNlLmFlcm8iLAoJImNvbnN1bHRhbnQuYWVybyIsCgkiY29uc3VsdGluZy5hZXJvIiwKCSJjb250cm9sLmFlcm8iLAoJImNvdW5jaWwuYWVybyIsCgkiY3Jldy5hZXJvIiwKCSJkZXNpZ24uYWVybyIsCgkiZGdjYS5hZXJvIiwKCSJlZHVjYXRvci5hZXJvIiwKCSJlbWVyZ2VuY3kuYWVybyIsCgkiZW5naW5lLmFlcm8iLAoJImVuZ2luZWVyLmFlcm8iLAoJImVudGVydGFpbm1lbnQuYWVybyIsCgkiZXF1aXBtZW50LmFlcm8iLAoJImV4Y2hhbmdlLmFlcm8iLAoJImV4cHJlc3MuYWVybyIsCgkiZmVkZXJhdGlvbi5hZXJvIiwKCSJmbGlnaHQuYWVybyIsCgkiZnVlbC5hZXJvIiwKCSJnbGlkaW5nLmFlcm8iLAoJImdvdmVybm1lbnQuYWVybyIsCgkiZ3JvdW5kaGFuZGxpbmcuYWVybyIsCgkiZ3JvdXAuYWVybyIsCgkiaGFuZ2dsaWRpbmcuYWVybyIsCgkiaG9tZWJ1aWx0LmFlcm8iLAoJImluc3VyYW5jZS5hZXJvIiwKCSJqb3VybmFsLmFlcm8iLAoJImpvdXJuYWxpc3QuYWVybyIsCgkibGVhc2luZy5hZXJvIiwKCSJsb2dpc3RpY3MuYWVybyIsCgkibWFnYXppbmUuYWVybyIsCgkibWFpbnRlbmFuY2UuYWVybyIsCgkibWVkaWEuYWVybyIsCgkibWljcm9saWdodC5hZXJvIiwKCSJtb2RlbGxpbmcuYWVybyIsCgkibmF2aWdhdGlvbi5hZXJvIiwKCSJwYXJhY2h1dGluZy5hZXJvIiwKCSJwYXJhZ2xpZGluZy5hZXJvIiwKCSJwYXNzZW5nZXItYXNzb2NpYXRpb24uYWVybyIsCgkicGlsb3QuYWVybyIsCgkicHJlc3MuYWVybyIsCgkicHJvZHVjdGlvbi5hZXJvIiwKCSJyZWNyZWF0aW9uLmFlcm8iLAoJInJlcGJvZHkuYWVybyIsCgkicmVzLmFlcm8iLAoJInJlc2VhcmNoLmFlcm8iLAoJInJvdG9yY3JhZnQuYWVybyIsCgkic2FmZXR5LmFlcm8iLAoJInNjaWVudGlzdC5hZXJvIiwKCSJzZXJ2aWNlcy5hZXJvIiwKCSJzaG93LmFlcm8iLAoJInNreWRpdmluZy5hZXJvIiwKCSJzb2Z0d2FyZS5hZXJvIiwKCSJzdHVkZW50LmFlcm8iLAoJInRyYWRlci5hZXJvIiwKCSJ0cmFkaW5nLmFlcm8iLAoJInRyYWluZXIuYWVybyIsCgkidW5pb24uYWVybyIsCgkid29ya2luZ2dyb3VwLmFlcm8iLAoJIndvcmtzLmFlcm8iLAoJImFmIiwKCSJnb3YuYWYiLAoJImNvbS5hZiIsCgkib3JnLmFmIiwKCSJuZXQuYWYiLAoJImVkdS5hZiIsCgkiYWciLAoJImNvbS5hZyIsCgkib3JnLmFnIiwKCSJuZXQuYWciLAoJImNvLmFnIiwKCSJub20uYWciLAoJImFpIiwKCSJvZmYuYWkiLAoJImNvbS5haSIsCgkibmV0LmFpIiwKCSJvcmcuYWkiLAoJImFsIiwKCSJjb20uYWwiLAoJImVkdS5hbCIsCgkiZ292LmFsIiwKCSJtaWwuYWwiLAoJIm5ldC5hbCIsCgkib3JnLmFsIiwKCSJhbSIsCgkiY28uYW0iLAoJImNvbS5hbSIsCgkiY29tbXVuZS5hbSIsCgkibmV0LmFtIiwKCSJvcmcuYW0iLAoJImFvIiwKCSJlZC5hbyIsCgkiZ3YuYW8iLAoJIm9nLmFvIiwKCSJjby5hbyIsCgkicGIuYW8iLAoJIml0LmFvIiwKCSJhcSIsCgkiYXIiLAoJImJldC5hciIsCgkiY29tLmFyIiwKCSJjb29wLmFyIiwKCSJlZHUuYXIiLAoJImdvYi5hciIsCgkiZ292LmFyIiwKCSJpbnQuYXIiLAoJIm1pbC5hciIsCgkibXVzaWNhLmFyIiwKCSJtdXR1YWwuYXIiLAoJIm5ldC5hciIsCgkib3JnLmFyIiwKCSJzZW5hc2EuYXIiLAoJInR1ci5hciIsCgkiYXJwYSIsCgkiZTE2NC5hcnBhIiwKCSJpbi1hZGRyLmFycGEiLAoJImlwNi5hcnBhIiwKCSJpcmlzLmFycGEiLAoJInVyaS5hcnBhIiwKCSJ1cm4uYXJwYSIsCgkiYXMiLAoJImdvdi5hcyIsCgkiYXNpYSIsCgkiYXQiLAoJImFjLmF0IiwKCSJjby5hdCIsCgkiZ3YuYXQiLAoJIm9yLmF0IiwKCSJzdGguYWMuYXQiLAoJImF1IiwKCSJjb20uYXUiLAoJIm5ldC5hdSIsCgkib3JnLmF1IiwKCSJlZHUuYXUiLAoJImdvdi5hdSIsCgkiYXNuLmF1IiwKCSJpZC5hdSIsCgkiaW5mby5hdSIsCgkiY29uZi5hdSIsCgkib3ouYXUiLAoJImFjdC5hdSIsCgkibnN3LmF1IiwKCSJudC5hdSIsCgkicWxkLmF1IiwKCSJzYS5hdSIsCgkidGFzLmF1IiwKCSJ2aWMuYXUiLAoJIndhLmF1IiwKCSJhY3QuZWR1LmF1IiwKCSJjYXRob2xpYy5lZHUuYXUiLAoJIm5zdy5lZHUuYXUiLAoJIm50LmVkdS5hdSIsCgkicWxkLmVkdS5hdSIsCgkic2EuZWR1LmF1IiwKCSJ0YXMuZWR1LmF1IiwKCSJ2aWMuZWR1LmF1IiwKCSJ3YS5lZHUuYXUiLAoJInFsZC5nb3YuYXUiLAoJInNhLmdvdi5hdSIsCgkidGFzLmdvdi5hdSIsCgkidmljLmdvdi5hdSIsCgkid2EuZ292LmF1IiwKCSJzY2hvb2xzLm5zdy5lZHUuYXUiLAoJImF3IiwKCSJjb20uYXciLAoJImF4IiwKCSJheiIsCgkiY29tLmF6IiwKCSJuZXQuYXoiLAoJImludC5heiIsCgkiZ292LmF6IiwKCSJvcmcuYXoiLAoJImVkdS5heiIsCgkiaW5mby5heiIsCgkicHAuYXoiLAoJIm1pbC5heiIsCgkibmFtZS5heiIsCgkicHJvLmF6IiwKCSJiaXouYXoiLAoJImJhIiwKCSJjb20uYmEiLAoJImVkdS5iYSIsCgkiZ292LmJhIiwKCSJtaWwuYmEiLAoJIm5ldC5iYSIsCgkib3JnLmJhIiwKCSJiYiIsCgkiYml6LmJiIiwKCSJjby5iYiIsCgkiY29tLmJiIiwKCSJlZHUuYmIiLAoJImdvdi5iYiIsCgkiaW5mby5iYiIsCgkibmV0LmJiIiwKCSJvcmcuYmIiLAoJInN0b3JlLmJiIiwKCSJ0di5iYiIsCgkiKi5iZCIsCgkiYmUiLAoJImFjLmJlIiwKCSJiZiIsCgkiZ292LmJmIiwKCSJiZyIsCgkiYS5iZyIsCgkiYi5iZyIsCgkiYy5iZyIsCgkiZC5iZyIsCgkiZS5iZyIsCgkiZi5iZyIsCgkiZy5iZyIsCgkiaC5iZyIsCgkiaS5iZyIsCgkiai5iZyIsCgkiay5iZyIsCgkibC5iZyIsCgkibS5iZyIsCgkibi5iZyIsCgkiby5iZyIsCgkicC5iZyIsCgkicS5iZyIsCgkici5iZyIsCgkicy5iZyIsCgkidC5iZyIsCgkidS5iZyIsCgkidi5iZyIsCgkidy5iZyIsCgkieC5iZyIsCgkieS5iZyIsCgkiei5iZyIsCgkiMC5iZyIsCgkiMS5iZyIsCgkiMi5iZyIsCgkiMy5iZyIsCgkiNC5iZyIsCgkiNS5iZyIsCgkiNi5iZyIsCgkiNy5iZyIsCgkiOC5iZyIsCgkiOS5iZyIsCgkiYmgiLAoJImNvbS5iaCIsCgkiZWR1LmJoIiwKCSJuZXQuYmgiLAoJIm9yZy5iaCIsCgkiZ292LmJoIiwKCSJiaSIsCgkiY28uYmkiLAoJImNvbS5iaSIsCgkiZWR1LmJpIiwKCSJvci5iaSIsCgkib3JnLmJpIiwKCSJiaXoiLAoJImJqIiwKCSJhc3NvLmJqIiwKCSJiYXJyZWF1LmJqIiwKCSJnb3V2LmJqIiwKCSJibSIsCgkiY29tLmJtIiwKCSJlZHUuYm0iLAoJImdvdi5ibSIsCgkibmV0LmJtIiwKCSJvcmcuYm0iLAoJImJuIiwKCSJjb20uYm4iLAoJImVkdS5ibiIsCgkiZ292LmJuIiwKCSJuZXQuYm4iLAoJIm9yZy5ibiIsCgkiYm8iLAoJImNvbS5ibyIsCgkiZWR1LmJvIiwKCSJnb2IuYm8iLAoJImludC5ibyIsCgkib3JnLmJvIiwKCSJuZXQuYm8iLAoJIm1pbC5ibyIsCgkidHYuYm8iLAoJIndlYi5ibyIsCgkiYWNhZGVtaWEuYm8iLAoJImFncm8uYm8iLAoJImFydGUuYm8iLAoJImJsb2cuYm8iLAoJImJvbGl2aWEuYm8iLAoJImNpZW5jaWEuYm8iLAoJImNvb3BlcmF0aXZhLmJvIiwKCSJkZW1vY3JhY2lhLmJvIiwKCSJkZXBvcnRlLmJvIiwKCSJlY29sb2dpYS5ibyIsCgkiZWNvbm9taWEuYm8iLAoJImVtcHJlc2EuYm8iLAoJImluZGlnZW5hLmJvIiwKCSJpbmR1c3RyaWEuYm8iLAoJImluZm8uYm8iLAoJIm1lZGljaW5hLmJvIiwKCSJtb3ZpbWllbnRvLmJvIiwKCSJtdXNpY2EuYm8iLAoJIm5hdHVyYWwuYm8iLAoJIm5vbWJyZS5ibyIsCgkibm90aWNpYXMuYm8iLAoJInBhdHJpYS5ibyIsCgkicG9saXRpY2EuYm8iLAoJInByb2Zlc2lvbmFsLmJvIiwKCSJwbHVyaW5hY2lvbmFsLmJvIiwKCSJwdWVibG8uYm8iLAoJInJldmlzdGEuYm8iLAoJInNhbHVkLmJvIiwKCSJ0ZWNub2xvZ2lhLmJvIiwKCSJ0a3NhdC5ibyIsCgkidHJhbnNwb3J0ZS5ibyIsCgkid2lraS5ibyIsCgkiYnIiLAoJIjlndWFjdS5iciIsCgkiYWJjLmJyIiwKCSJhZG0uYnIiLAoJImFkdi5iciIsCgkiYWdyLmJyIiwKCSJhanUuYnIiLAoJImFtLmJyIiwKCSJhbmFuaS5iciIsCgkiYXBhcmVjaWRhLmJyIiwKCSJhcHAuYnIiLAoJImFycS5iciIsCgkiYXJ0LmJyIiwKCSJhdG8uYnIiLAoJImIuYnIiLAoJImJhcnVlcmkuYnIiLAoJImJlbGVtLmJyIiwKCSJiaHouYnIiLAoJImJpYi5iciIsCgkiYmlvLmJyIiwKCSJibG9nLmJyIiwKCSJibWQuYnIiLAoJImJvYXZpc3RhLmJyIiwKCSJic2IuYnIiLAoJImNhbXBpbmFncmFuZGUuYnIiLAoJImNhbXBpbmFzLmJyIiwKCSJjYXhpYXMuYnIiLAoJImNpbS5iciIsCgkiY25nLmJyIiwKCSJjbnQuYnIiLAoJImNvbS5iciIsCgkiY29udGFnZW0uYnIiLAoJImNvb3AuYnIiLAoJImNvei5iciIsCgkiY3JpLmJyIiwKCSJjdWlhYmEuYnIiLAoJImN1cml0aWJhLmJyIiwKCSJkZWYuYnIiLAoJImRlcy5iciIsCgkiZGV0LmJyIiwKCSJkZXYuYnIiLAoJImVjbi5iciIsCgkiZWNvLmJyIiwKCSJlZHUuYnIiLAoJImVtcC5iciIsCgkiZW5mLmJyIiwKCSJlbmcuYnIiLAoJImVzcC5iciIsCgkiZXRjLmJyIiwKCSJldGkuYnIiLAoJImZhci5iciIsCgkiZmVpcmEuYnIiLAoJImZsb2cuYnIiLAoJImZsb3JpcGEuYnIiLAoJImZtLmJyIiwKCSJmbmQuYnIiLAoJImZvcnRhbC5iciIsCgkiZm90LmJyIiwKCSJmb3ouYnIiLAoJImZzdC5iciIsCgkiZzEyLmJyIiwKCSJnZW8uYnIiLAoJImdnZi5iciIsCgkiZ29pYW5pYS5iciIsCgkiZ292LmJyIiwKCSJhYy5nb3YuYnIiLAoJImFsLmdvdi5iciIsCgkiYW0uZ292LmJyIiwKCSJhcC5nb3YuYnIiLAoJImJhLmdvdi5iciIsCgkiY2UuZ292LmJyIiwKCSJkZi5nb3YuYnIiLAoJImVzLmdvdi5iciIsCgkiZ28uZ292LmJyIiwKCSJtYS5nb3YuYnIiLAoJIm1nLmdvdi5iciIsCgkibXMuZ292LmJyIiwKCSJtdC5nb3YuYnIiLAoJInBhLmdvdi5iciIsCgkicGIuZ292LmJyIiwKCSJwZS5nb3YuYnIiLAoJInBpLmdvdi5iciIsCgkicHIuZ292LmJyIiwKCSJyai5nb3YuYnIiLAoJInJuLmdvdi5iciIsCgkicm8uZ292LmJyIiwKCSJyci5nb3YuYnIiLAoJInJzLmdvdi5iciIsCgkic2MuZ292LmJyIiwKCSJzZS5nb3YuYnIiLAoJInNwLmdvdi5iciIsCgkidG8uZ292LmJyIiwKCSJncnUuYnIiLAoJImltYi5iciIsCgkiaW5kLmJyIiwKCSJpbmYuYnIiLAoJImphYi5iciIsCgkiamFtcGEuYnIiLAoJImpkZi5iciIsCgkiam9pbnZpbGxlLmJyIiwKCSJqb3IuYnIiLAoJImp1cy5iciIsCgkibGVnLmJyIiwKCSJsZWwuYnIiLAoJImxvZy5iciIsCgkibG9uZHJpbmEuYnIiLAoJIm1hY2FwYS5iciIsCgkibWFjZWlvLmJyIiwKCSJtYW5hdXMuYnIiLAoJIm1hcmluZ2EuYnIiLAoJIm1hdC5iciIsCgkibWVkLmJyIiwKCSJtaWwuYnIiLAoJIm1vcmVuYS5iciIsCgkibXAuYnIiLAoJIm11cy5iciIsCgkibmF0YWwuYnIiLAoJIm5ldC5iciIsCgkibml0ZXJvaS5iciIsCgkiKi5ub20uYnIiLAoJIm5vdC5iciIsCgkibnRyLmJyIiwKCSJvZG8uYnIiLAoJIm9uZy5iciIsCgkib3JnLmJyIiwKCSJvc2FzY28uYnIiLAoJInBhbG1hcy5iciIsCgkicG9hLmJyIiwKCSJwcGcuYnIiLAoJInByby5iciIsCgkicHNjLmJyIiwKCSJwc2kuYnIiLAoJInB2aC5iciIsCgkicXNsLmJyIiwKCSJyYWRpby5iciIsCgkicmVjLmJyIiwKCSJyZWNpZmUuYnIiLAoJInJlcC5iciIsCgkicmliZWlyYW8uYnIiLAoJInJpby5iciIsCgkicmlvYnJhbmNvLmJyIiwKCSJyaW9wcmV0by5iciIsCgkic2FsdmFkb3IuYnIiLAoJInNhbXBhLmJyIiwKCSJzYW50YW1hcmlhLmJyIiwKCSJzYW50b2FuZHJlLmJyIiwKCSJzYW9iZXJuYXJkby5iciIsCgkic2FvZ29uY2EuYnIiLAoJInNlZy5iciIsCgkic2pjLmJyIiwKCSJzbGcuYnIiLAoJInNsei5iciIsCgkic29yb2NhYmEuYnIiLAoJInNydi5iciIsCgkidGF4aS5iciIsCgkidGMuYnIiLAoJInRlYy5iciIsCgkidGVvLmJyIiwKCSJ0aGUuYnIiLAoJInRtcC5iciIsCgkidHJkLmJyIiwKCSJ0dXIuYnIiLAoJInR2LmJyIiwKCSJ1ZGkuYnIiLAoJInZldC5iciIsCgkidml4LmJyIiwKCSJ2bG9nLmJyIiwKCSJ3aWtpLmJyIiwKCSJ6bGcuYnIiLAoJImJzIiwKCSJjb20uYnMiLAoJIm5ldC5icyIsCgkib3JnLmJzIiwKCSJlZHUuYnMiLAoJImdvdi5icyIsCgkiYnQiLAoJImNvbS5idCIsCgkiZWR1LmJ0IiwKCSJnb3YuYnQiLAoJIm5ldC5idCIsCgkib3JnLmJ0IiwKCSJidiIsCgkiYnciLAoJImNvLmJ3IiwKCSJvcmcuYnciLAoJImJ5IiwKCSJnb3YuYnkiLAoJIm1pbC5ieSIsCgkiY29tLmJ5IiwKCSJvZi5ieSIsCgkiYnoiLAoJImNvbS5ieiIsCgkibmV0LmJ6IiwKCSJvcmcuYnoiLAoJImVkdS5ieiIsCgkiZ292LmJ6IiwKCSJjYSIsCgkiYWIuY2EiLAoJImJjLmNhIiwKCSJtYi5jYSIsCgkibmIuY2EiLAoJIm5mLmNhIiwKCSJubC5jYSIsCgkibnMuY2EiLAoJIm50LmNhIiwKCSJudS5jYSIsCgkib24uY2EiLAoJInBlLmNhIiwKCSJxYy5jYSIsCgkic2suY2EiLAoJInlrLmNhIiwKCSJnYy5jYSIsCgkiY2F0IiwKCSJjYyIsCgkiY2QiLAoJImdvdi5jZCIsCgkiY2YiLAoJImNnIiwKCSJjaCIsCgkiY2kiLAoJIm9yZy5jaSIsCgkib3IuY2kiLAoJImNvbS5jaSIsCgkiY28uY2kiLAoJImVkdS5jaSIsCgkiZWQuY2kiLAoJImFjLmNpIiwKCSJuZXQuY2kiLAoJImdvLmNpIiwKCSJhc3NvLmNpIiwKCSJhw6lyb3BvcnQuY2kiLAoJImludC5jaSIsCgkicHJlc3NlLmNpIiwKCSJtZC5jaSIsCgkiZ291di5jaSIsCgkiKi5jayIsCgkiIXd3dy5jayIsCgkiY2wiLAoJImNvLmNsIiwKCSJnb2IuY2wiLAoJImdvdi5jbCIsCgkibWlsLmNsIiwKCSJjbSIsCgkiY28uY20iLAoJImNvbS5jbSIsCgkiZ292LmNtIiwKCSJuZXQuY20iLAoJImNuIiwKCSJhYy5jbiIsCgkiY29tLmNuIiwKCSJlZHUuY24iLAoJImdvdi5jbiIsCgkibmV0LmNuIiwKCSJvcmcuY24iLAoJIm1pbC5jbiIsCgki5YWs5Y+4LmNuIiwKCSLnvZHnu5wuY24iLAoJIue2sue1oS5jbiIsCgkiYWguY24iLAoJImJqLmNuIiwKCSJjcS5jbiIsCgkiZmouY24iLAoJImdkLmNuIiwKCSJncy5jbiIsCgkiZ3ouY24iLAoJImd4LmNuIiwKCSJoYS5jbiIsCgkiaGIuY24iLAoJImhlLmNuIiwKCSJoaS5jbiIsCgkiaGwuY24iLAoJImhuLmNuIiwKCSJqbC5jbiIsCgkianMuY24iLAoJImp4LmNuIiwKCSJsbi5jbiIsCgkibm0uY24iLAoJIm54LmNuIiwKCSJxaC5jbiIsCgkic2MuY24iLAoJInNkLmNuIiwKCSJzaC5jbiIsCgkic24uY24iLAoJInN4LmNuIiwKCSJ0ai5jbiIsCgkieGouY24iLAoJInh6LmNuIiwKCSJ5bi5jbiIsCgkiemouY24iLAoJImhrLmNuIiwKCSJtby5jbiIsCgkidHcuY24iLAoJImNvIiwKCSJhcnRzLmNvIiwKCSJjb20uY28iLAoJImVkdS5jbyIsCgkiZmlybS5jbyIsCgkiZ292LmNvIiwKCSJpbmZvLmNvIiwKCSJpbnQuY28iLAoJIm1pbC5jbyIsCgkibmV0LmNvIiwKCSJub20uY28iLAoJIm9yZy5jbyIsCgkicmVjLmNvIiwKCSJ3ZWIuY28iLAoJImNvbSIsCgkiY29vcCIsCgkiY3IiLAoJImFjLmNyIiwKCSJjby5jciIsCgkiZWQuY3IiLAoJImZpLmNyIiwKCSJnby5jciIsCgkib3IuY3IiLAoJInNhLmNyIiwKCSJjdSIsCgkiY29tLmN1IiwKCSJlZHUuY3UiLAoJIm9yZy5jdSIsCgkibmV0LmN1IiwKCSJnb3YuY3UiLAoJImluZi5jdSIsCgkiY3YiLAoJImNvbS5jdiIsCgkiZWR1LmN2IiwKCSJpbnQuY3YiLAoJIm5vbWUuY3YiLAoJIm9yZy5jdiIsCgkiY3ciLAoJImNvbS5jdyIsCgkiZWR1LmN3IiwKCSJuZXQuY3ciLAoJIm9yZy5jdyIsCgkiY3giLAoJImdvdi5jeCIsCgkiY3kiLAoJImFjLmN5IiwKCSJiaXouY3kiLAoJImNvbS5jeSIsCgkiZWtsb2dlcy5jeSIsCgkiZ292LmN5IiwKCSJsdGQuY3kiLAoJIm1pbC5jeSIsCgkibmV0LmN5IiwKCSJvcmcuY3kiLAoJInByZXNzLmN5IiwKCSJwcm8uY3kiLAoJInRtLmN5IiwKCSJjeiIsCgkiZGUiLAoJImRqIiwKCSJkayIsCgkiZG0iLAoJImNvbS5kbSIsCgkibmV0LmRtIiwKCSJvcmcuZG0iLAoJImVkdS5kbSIsCgkiZ292LmRtIiwKCSJkbyIsCgkiYXJ0LmRvIiwKCSJjb20uZG8iLAoJImVkdS5kbyIsCgkiZ29iLmRvIiwKCSJnb3YuZG8iLAoJIm1pbC5kbyIsCgkibmV0LmRvIiwKCSJvcmcuZG8iLAoJInNsZC5kbyIsCgkid2ViLmRvIiwKCSJkeiIsCgkiYXJ0LmR6IiwKCSJhc3NvLmR6IiwKCSJjb20uZHoiLAoJImVkdS5keiIsCgkiZ292LmR6IiwKCSJvcmcuZHoiLAoJIm5ldC5keiIsCgkicG9sLmR6IiwKCSJzb2MuZHoiLAoJInRtLmR6IiwKCSJlYyIsCgkiY29tLmVjIiwKCSJpbmZvLmVjIiwKCSJuZXQuZWMiLAoJImZpbi5lYyIsCgkiazEyLmVjIiwKCSJtZWQuZWMiLAoJInByby5lYyIsCgkib3JnLmVjIiwKCSJlZHUuZWMiLAoJImdvdi5lYyIsCgkiZ29iLmVjIiwKCSJtaWwuZWMiLAoJImVkdSIsCgkiZWUiLAoJImVkdS5lZSIsCgkiZ292LmVlIiwKCSJyaWlrLmVlIiwKCSJsaWIuZWUiLAoJIm1lZC5lZSIsCgkiY29tLmVlIiwKCSJwcmkuZWUiLAoJImFpcC5lZSIsCgkib3JnLmVlIiwKCSJmaWUuZWUiLAoJImVnIiwKCSJjb20uZWciLAoJImVkdS5lZyIsCgkiZXVuLmVnIiwKCSJnb3YuZWciLAoJIm1pbC5lZyIsCgkibmFtZS5lZyIsCgkibmV0LmVnIiwKCSJvcmcuZWciLAoJInNjaS5lZyIsCgkiKi5lciIsCgkiZXMiLAoJImNvbS5lcyIsCgkibm9tLmVzIiwKCSJvcmcuZXMiLAoJImdvYi5lcyIsCgkiZWR1LmVzIiwKCSJldCIsCgkiY29tLmV0IiwKCSJnb3YuZXQiLAoJIm9yZy5ldCIsCgkiZWR1LmV0IiwKCSJiaXouZXQiLAoJIm5hbWUuZXQiLAoJImluZm8uZXQiLAoJIm5ldC5ldCIsCgkiZXUiLAoJImZpIiwKCSJhbGFuZC5maSIsCgkiZmoiLAoJImFjLmZqIiwKCSJiaXouZmoiLAoJImNvbS5maiIsCgkiZ292LmZqIiwKCSJpbmZvLmZqIiwKCSJtaWwuZmoiLAoJIm5hbWUuZmoiLAoJIm5ldC5maiIsCgkib3JnLmZqIiwKCSJwcm8uZmoiLAoJIiouZmsiLAoJImNvbS5mbSIsCgkiZWR1LmZtIiwKCSJuZXQuZm0iLAoJIm9yZy5mbSIsCgkiZm0iLAoJImZvIiwKCSJmciIsCgkiYXNzby5mciIsCgkiY29tLmZyIiwKCSJnb3V2LmZyIiwKCSJub20uZnIiLAoJInByZC5mciIsCgkidG0uZnIiLAoJImFlcm9wb3J0LmZyIiwKCSJhdm9jYXQuZnIiLAoJImF2b3Vlcy5mciIsCgkiY2NpLmZyIiwKCSJjaGFtYmFncmkuZnIiLAoJImNoaXJ1cmdpZW5zLWRlbnRpc3Rlcy5mciIsCgkiZXhwZXJ0cy1jb21wdGFibGVzLmZyIiwKCSJnZW9tZXRyZS1leHBlcnQuZnIiLAoJImdyZXRhLmZyIiwKCSJodWlzc2llci1qdXN0aWNlLmZyIiwKCSJtZWRlY2luLmZyIiwKCSJub3RhaXJlcy5mciIsCgkicGhhcm1hY2llbi5mciIsCgkicG9ydC5mciIsCgkidmV0ZXJpbmFpcmUuZnIiLAoJImdhIiwKCSJnYiIsCgkiZWR1LmdkIiwKCSJnb3YuZ2QiLAoJImdkIiwKCSJnZSIsCgkiY29tLmdlIiwKCSJlZHUuZ2UiLAoJImdvdi5nZSIsCgkib3JnLmdlIiwKCSJtaWwuZ2UiLAoJIm5ldC5nZSIsCgkicHZ0LmdlIiwKCSJnZiIsCgkiZ2ciLAoJImNvLmdnIiwKCSJuZXQuZ2ciLAoJIm9yZy5nZyIsCgkiZ2giLAoJImNvbS5naCIsCgkiZWR1LmdoIiwKCSJnb3YuZ2giLAoJIm9yZy5naCIsCgkibWlsLmdoIiwKCSJnaSIsCgkiY29tLmdpIiwKCSJsdGQuZ2kiLAoJImdvdi5naSIsCgkibW9kLmdpIiwKCSJlZHUuZ2kiLAoJIm9yZy5naSIsCgkiZ2wiLAoJImNvLmdsIiwKCSJjb20uZ2wiLAoJImVkdS5nbCIsCgkibmV0LmdsIiwKCSJvcmcuZ2wiLAoJImdtIiwKCSJnbiIsCgkiYWMuZ24iLAoJImNvbS5nbiIsCgkiZWR1LmduIiwKCSJnb3YuZ24iLAoJIm9yZy5nbiIsCgkibmV0LmduIiwKCSJnb3YiLAoJImdwIiwKCSJjb20uZ3AiLAoJIm5ldC5ncCIsCgkibW9iaS5ncCIsCgkiZWR1LmdwIiwKCSJvcmcuZ3AiLAoJImFzc28uZ3AiLAoJImdxIiwKCSJnciIsCgkiY29tLmdyIiwKCSJlZHUuZ3IiLAoJIm5ldC5nciIsCgkib3JnLmdyIiwKCSJnb3YuZ3IiLAoJImdzIiwKCSJndCIsCgkiY29tLmd0IiwKCSJlZHUuZ3QiLAoJImdvYi5ndCIsCgkiaW5kLmd0IiwKCSJtaWwuZ3QiLAoJIm5ldC5ndCIsCgkib3JnLmd0IiwKCSJndSIsCgkiY29tLmd1IiwKCSJlZHUuZ3UiLAoJImdvdi5ndSIsCgkiZ3VhbS5ndSIsCgkiaW5mby5ndSIsCgkibmV0Lmd1IiwKCSJvcmcuZ3UiLAoJIndlYi5ndSIsCgkiZ3ciLAoJImd5IiwKCSJjby5neSIsCgkiY29tLmd5IiwKCSJlZHUuZ3kiLAoJImdvdi5neSIsCgkibmV0Lmd5IiwKCSJvcmcuZ3kiLAoJImhrIiwKCSJjb20uaGsiLAoJImVkdS5oayIsCgkiZ292LmhrIiwKCSJpZHYuaGsiLAoJIm5ldC5oayIsCgkib3JnLmhrIiwKCSLlhazlj7guaGsiLAoJIuaVmeiCsi5oayIsCgki5pWO6IKyLmhrIiwKCSLmlL/lupwuaGsiLAoJIuWAi+S6ui5oayIsCgki5Liq77+977+9LmhrIiwKCSLnrofkurouaGsiLAoJIue2sue7nC5oayIsCgki572R57ucLmhrIiwKCSLnu4TnuZQuaGsiLAoJIue2sue1oS5oayIsCgki572R57WhLmhrIiwKCSLnu4Tnu4cuaGsiLAoJIue1hOe5lC5oayIsCgki57WE57uHLmhrIiwKCSJobSIsCgkiaG4iLAoJImNvbS5obiIsCgkiZWR1LmhuIiwKCSJvcmcuaG4iLAoJIm5ldC5obiIsCgkibWlsLmhuIiwKCSJnb2IuaG4iLAoJImhyIiwKCSJpei5ociIsCgkiZnJvbS5ociIsCgkibmFtZS5ociIsCgkiY29tLmhyIiwKCSJodCIsCgkiY29tLmh0IiwKCSJzaG9wLmh0IiwKCSJmaXJtLmh0IiwKCSJpbmZvLmh0IiwKCSJhZHVsdC5odCIsCgkibmV0Lmh0IiwKCSJwcm8uaHQiLAoJIm9yZy5odCIsCgkibWVkLmh0IiwKCSJhcnQuaHQiLAoJImNvb3AuaHQiLAoJInBvbC5odCIsCgkiYXNzby5odCIsCgkiZWR1Lmh0IiwKCSJyZWwuaHQiLAoJImdvdXYuaHQiLAoJInBlcnNvLmh0IiwKCSJodSIsCgkiY28uaHUiLAoJImluZm8uaHUiLAoJIm9yZy5odSIsCgkicHJpdi5odSIsCgkic3BvcnQuaHUiLAoJInRtLmh1IiwKCSIyMDAwLmh1IiwKCSJhZ3Jhci5odSIsCgkiYm9sdC5odSIsCgkiY2FzaW5vLmh1IiwKCSJjaXR5Lmh1IiwKCSJlcm90aWNhLmh1IiwKCSJlcm90aWthLmh1IiwKCSJmaWxtLmh1IiwKCSJmb3J1bS5odSIsCgkiZ2FtZXMuaHUiLAoJImhvdGVsLmh1IiwKCSJpbmdhdGxhbi5odSIsCgkiam9nYXN6Lmh1IiwKCSJrb255dmVsby5odSIsCgkibGFrYXMuaHUiLAoJIm1lZGlhLmh1IiwKCSJuZXdzLmh1IiwKCSJyZWtsYW0uaHUiLAoJInNleC5odSIsCgkic2hvcC5odSIsCgkic3VsaS5odSIsCgkic3pleC5odSIsCgkidG96c2RlLmh1IiwKCSJ1dGF6YXMuaHUiLAoJInZpZGVvLmh1IiwKCSJpZCIsCgkiYWMuaWQiLAoJImJpei5pZCIsCgkiY28uaWQiLAoJImRlc2EuaWQiLAoJImdvLmlkIiwKCSJtaWwuaWQiLAoJIm15LmlkIiwKCSJuZXQuaWQiLAoJIm9yLmlkIiwKCSJwb25wZXMuaWQiLAoJInNjaC5pZCIsCgkid2ViLmlkIiwKCSJpZSIsCgkiZ292LmllIiwKCSJpbCIsCgkiYWMuaWwiLAoJImNvLmlsIiwKCSJnb3YuaWwiLAoJImlkZi5pbCIsCgkiazEyLmlsIiwKCSJtdW5pLmlsIiwKCSJuZXQuaWwiLAoJIm9yZy5pbCIsCgkiaW0iLAoJImFjLmltIiwKCSJjby5pbSIsCgkiY29tLmltIiwKCSJsdGQuY28uaW0iLAoJIm5ldC5pbSIsCgkib3JnLmltIiwKCSJwbGMuY28uaW0iLAoJInR0LmltIiwKCSJ0di5pbSIsCgkiaW4iLAoJImNvLmluIiwKCSJmaXJtLmluIiwKCSJuZXQuaW4iLAoJIm9yZy5pbiIsCgkiZ2VuLmluIiwKCSJpbmQuaW4iLAoJIm5pYy5pbiIsCgkiYWMuaW4iLAoJImVkdS5pbiIsCgkicmVzLmluIiwKCSJnb3YuaW4iLAoJIm1pbC5pbiIsCgkiaW5mbyIsCgkiaW50IiwKCSJldS5pbnQiLAoJImlvIiwKCSJjb20uaW8iLAoJImlxIiwKCSJnb3YuaXEiLAoJImVkdS5pcSIsCgkibWlsLmlxIiwKCSJjb20uaXEiLAoJIm9yZy5pcSIsCgkibmV0LmlxIiwKCSJpciIsCgkiYWMuaXIiLAoJImNvLmlyIiwKCSJnb3YuaXIiLAoJImlkLmlyIiwKCSJuZXQuaXIiLAoJIm9yZy5pciIsCgkic2NoLmlyIiwKCSLYp9uM2LHYp9mGLmlyIiwKCSLYp9mK2LHYp9mGLmlyIiwKCSJpcyIsCgkibmV0LmlzIiwKCSJjb20uaXMiLAoJImVkdS5pcyIsCgkiZ292LmlzIiwKCSJvcmcuaXMiLAoJImludC5pcyIsCgkiaXQiLAoJImdvdi5pdCIsCgkiZWR1Lml0IiwKCSJhYnIuaXQiLAoJImFicnV6em8uaXQiLAoJImFvc3RhLXZhbGxleS5pdCIsCgkiYW9zdGF2YWxsZXkuaXQiLAoJImJhcy5pdCIsCgkiYmFzaWxpY2F0YS5pdCIsCgkiY2FsLml0IiwKCSJjYWxhYnJpYS5pdCIsCgkiY2FtLml0IiwKCSJjYW1wYW5pYS5pdCIsCgkiZW1pbGlhLXJvbWFnbmEuaXQiLAoJImVtaWxpYXJvbWFnbmEuaXQiLAoJImVtci5pdCIsCgkiZnJpdWxpLXYtZ2l1bGlhLml0IiwKCSJmcml1bGktdmUtZ2l1bGlhLml0IiwKCSJmcml1bGktdmVnaXVsaWEuaXQiLAoJImZyaXVsaS12ZW5lemlhLWdpdWxpYS5pdCIsCgkiZnJpdWxpLXZlbmV6aWFnaXVsaWEuaXQiLAoJImZyaXVsaS12Z2l1bGlhLml0IiwKCSJmcml1bGl2LWdpdWxpYS5pdCIsCgkiZnJpdWxpdmUtZ2l1bGlhLml0IiwKCSJmcml1bGl2ZWdpdWxpYS5pdCIsCgkiZnJpdWxpdmVuZXppYS1naXVsaWEuaXQiLAoJImZyaXVsaXZlbmV6aWFnaXVsaWEuaXQiLAoJImZyaXVsaXZnaXVsaWEuaXQiLAoJImZ2Zy5pdCIsCgkibGF6Lml0IiwKCSJsYXppby5pdCIsCgkibGlnLml0IiwKCSJsaWd1cmlhLml0IiwKCSJsb20uaXQiLAoJImxvbWJhcmRpYS5pdCIsCgkibG9tYmFyZHkuaXQiLAoJImx1Y2FuaWEuaXQiLAoJIm1hci5pdCIsCgkibWFyY2hlLml0IiwKCSJtb2wuaXQiLAoJIm1vbGlzZS5pdCIsCgkicGllZG1vbnQuaXQiLAoJInBpZW1vbnRlLml0IiwKCSJwbW4uaXQiLAoJInB1Zy5pdCIsCgkicHVnbGlhLml0IiwKCSJzYXIuaXQiLAoJInNhcmRlZ25hLml0IiwKCSJzYXJkaW5pYS5pdCIsCgkic2ljLml0IiwKCSJzaWNpbGlhLml0IiwKCSJzaWNpbHkuaXQiLAoJInRhYS5pdCIsCgkidG9zLml0IiwKCSJ0b3NjYW5hLml0IiwKCSJ0cmVudGluLXN1ZC10aXJvbC5pdCIsCgkidHJlbnRpbi1zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGluLXN1ZHRpcm9sLml0IiwKCSJ0cmVudGluLXPDvGR0aXJvbC5pdCIsCgkidHJlbnRpbi1zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGluLXN1ZWR0aXJvbC5pdCIsCgkidHJlbnRpbm8tYS1hZGlnZS5pdCIsCgkidHJlbnRpbm8tYWFkaWdlLml0IiwKCSJ0cmVudGluby1hbHRvLWFkaWdlLml0IiwKCSJ0cmVudGluby1hbHRvYWRpZ2UuaXQiLAoJInRyZW50aW5vLXMtdGlyb2wuaXQiLAoJInRyZW50aW5vLXN0aXJvbC5pdCIsCgkidHJlbnRpbm8tc3VkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zdWR0aXJvbC5pdCIsCgkidHJlbnRpbm8tc8O8ZHRpcm9sLml0IiwKCSJ0cmVudGluby1zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zdWVkdGlyb2wuaXQiLAoJInRyZW50aW5vLml0IiwKCSJ0cmVudGlub2EtYWRpZ2UuaXQiLAoJInRyZW50aW5vYWFkaWdlLml0IiwKCSJ0cmVudGlub2FsdG8tYWRpZ2UuaXQiLAoJInRyZW50aW5vYWx0b2FkaWdlLml0IiwKCSJ0cmVudGlub3MtdGlyb2wuaXQiLAoJInRyZW50aW5vc3Rpcm9sLml0IiwKCSJ0cmVudGlub3N1ZC10aXJvbC5pdCIsCgkidHJlbnRpbm9zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGlub3N1ZHRpcm9sLml0IiwKCSJ0cmVudGlub3PDvGR0aXJvbC5pdCIsCgkidHJlbnRpbm9zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGlub3N1ZWR0aXJvbC5pdCIsCgkidHJlbnRpbnN1ZC10aXJvbC5pdCIsCgkidHJlbnRpbnPDvGQtdGlyb2wuaXQiLAoJInRyZW50aW5zdWR0aXJvbC5pdCIsCgkidHJlbnRpbnPDvGR0aXJvbC5pdCIsCgkidHJlbnRpbnN1ZWQtdGlyb2wuaXQiLAoJInRyZW50aW5zdWVkdGlyb2wuaXQiLAoJInR1c2NhbnkuaXQiLAoJInVtYi5pdCIsCgkidW1icmlhLml0IiwKCSJ2YWwtZC1hb3N0YS5pdCIsCgkidmFsLWRhb3N0YS5pdCIsCgkidmFsZC1hb3N0YS5pdCIsCgkidmFsZGFvc3RhLml0IiwKCSJ2YWxsZS1hb3N0YS5pdCIsCgkidmFsbGUtZC1hb3N0YS5pdCIsCgkidmFsbGUtZGFvc3RhLml0IiwKCSJ2YWxsZWFvc3RhLml0IiwKCSJ2YWxsZWQtYW9zdGEuaXQiLAoJInZhbGxlZGFvc3RhLml0IiwKCSJ2YWxsZWUtYW9zdGUuaXQiLAoJInZhbGzDqWUtYW9zdGUuaXQiLAoJInZhbGxlZS1kLWFvc3RlLml0IiwKCSJ2YWxsw6llLWQtYW9zdGUuaXQiLAoJInZhbGxlZWFvc3RlLml0IiwKCSJ2YWxsw6llYW9zdGUuaXQiLAoJInZhbGxlZWRhb3N0ZS5pdCIsCgkidmFsbMOpZWRhb3N0ZS5pdCIsCgkidmFvLml0IiwKCSJ2ZGEuaXQiLAoJInZlbi5pdCIsCgkidmVuZXRvLml0IiwKCSJhZy5pdCIsCgkiYWdyaWdlbnRvLml0IiwKCSJhbC5pdCIsCgkiYWxlc3NhbmRyaWEuaXQiLAoJImFsdG8tYWRpZ2UuaXQiLAoJImFsdG9hZGlnZS5pdCIsCgkiYW4uaXQiLAoJImFuY29uYS5pdCIsCgkiYW5kcmlhLWJhcmxldHRhLXRyYW5pLml0IiwKCSJhbmRyaWEtdHJhbmktYmFybGV0dGEuaXQiLAoJImFuZHJpYWJhcmxldHRhdHJhbmkuaXQiLAoJImFuZHJpYXRyYW5pYmFybGV0dGEuaXQiLAoJImFvLml0IiwKCSJhb3N0YS5pdCIsCgkiYW9zdGUuaXQiLAoJImFwLml0IiwKCSJhcS5pdCIsCgkiYXF1aWxhLml0IiwKCSJhci5pdCIsCgkiYXJlenpvLml0IiwKCSJhc2NvbGktcGljZW5vLml0IiwKCSJhc2NvbGlwaWNlbm8uaXQiLAoJImFzdGkuaXQiLAoJImF0Lml0IiwKCSJhdi5pdCIsCgkiYXZlbGxpbm8uaXQiLAoJImJhLml0IiwKCSJiYWxzYW4tc3VkdGlyb2wuaXQiLAoJImJhbHNhbi1zw7xkdGlyb2wuaXQiLAoJImJhbHNhbi1zdWVkdGlyb2wuaXQiLAoJImJhbHNhbi5pdCIsCgkiYmFyaS5pdCIsCgkiYmFybGV0dGEtdHJhbmktYW5kcmlhLml0IiwKCSJiYXJsZXR0YXRyYW5pYW5kcmlhLml0IiwKCSJiZWxsdW5vLml0IiwKCSJiZW5ldmVudG8uaXQiLAoJImJlcmdhbW8uaXQiLAoJImJnLml0IiwKCSJiaS5pdCIsCgkiYmllbGxhLml0IiwKCSJibC5pdCIsCgkiYm4uaXQiLAoJImJvLml0IiwKCSJib2xvZ25hLml0IiwKCSJib2x6YW5vLWFsdG9hZGlnZS5pdCIsCgkiYm9semFuby5pdCIsCgkiYm96ZW4tc3VkdGlyb2wuaXQiLAoJImJvemVuLXPDvGR0aXJvbC5pdCIsCgkiYm96ZW4tc3VlZHRpcm9sLml0IiwKCSJib3plbi5pdCIsCgkiYnIuaXQiLAoJImJyZXNjaWEuaXQiLAoJImJyaW5kaXNpLml0IiwKCSJicy5pdCIsCgkiYnQuaXQiLAoJImJ1bHNhbi1zdWR0aXJvbC5pdCIsCgkiYnVsc2FuLXPDvGR0aXJvbC5pdCIsCgkiYnVsc2FuLXN1ZWR0aXJvbC5pdCIsCgkiYnVsc2FuLml0IiwKCSJiei5pdCIsCgkiY2EuaXQiLAoJImNhZ2xpYXJpLml0IiwKCSJjYWx0YW5pc3NldHRhLml0IiwKCSJjYW1waWRhbm8tbWVkaW8uaXQiLAoJImNhbXBpZGFub21lZGlvLml0IiwKCSJjYW1wb2Jhc3NvLml0IiwKCSJjYXJib25pYS1pZ2xlc2lhcy5pdCIsCgkiY2FyYm9uaWFpZ2xlc2lhcy5pdCIsCgkiY2FycmFyYS1tYXNzYS5pdCIsCgkiY2FycmFyYW1hc3NhLml0IiwKCSJjYXNlcnRhLml0IiwKCSJjYXRhbmlhLml0IiwKCSJjYXRhbnphcm8uaXQiLAoJImNiLml0IiwKCSJjZS5pdCIsCgkiY2VzZW5hLWZvcmxpLml0IiwKCSJjZXNlbmEtZm9ybMOsLml0IiwKCSJjZXNlbmFmb3JsaS5pdCIsCgkiY2VzZW5hZm9ybMOsLml0IiwKCSJjaC5pdCIsCgkiY2hpZXRpLml0IiwKCSJjaS5pdCIsCgkiY2wuaXQiLAoJImNuLml0IiwKCSJjby5pdCIsCgkiY29tby5pdCIsCgkiY29zZW56YS5pdCIsCgkiY3IuaXQiLAoJImNyZW1vbmEuaXQiLAoJImNyb3RvbmUuaXQiLAoJImNzLml0IiwKCSJjdC5pdCIsCgkiY3VuZW8uaXQiLAoJImN6Lml0IiwKCSJkZWxsLW9nbGlhc3RyYS5pdCIsCgkiZGVsbG9nbGlhc3RyYS5pdCIsCgkiZW4uaXQiLAoJImVubmEuaXQiLAoJImZjLml0IiwKCSJmZS5pdCIsCgkiZmVybW8uaXQiLAoJImZlcnJhcmEuaXQiLAoJImZnLml0IiwKCSJmaS5pdCIsCgkiZmlyZW56ZS5pdCIsCgkiZmxvcmVuY2UuaXQiLAoJImZtLml0IiwKCSJmb2dnaWEuaXQiLAoJImZvcmxpLWNlc2VuYS5pdCIsCgkiZm9ybMOsLWNlc2VuYS5pdCIsCgkiZm9ybGljZXNlbmEuaXQiLAoJImZvcmzDrGNlc2VuYS5pdCIsCgkiZnIuaXQiLAoJImZyb3Npbm9uZS5pdCIsCgkiZ2UuaXQiLAoJImdlbm9hLml0IiwKCSJnZW5vdmEuaXQiLAoJImdvLml0IiwKCSJnb3JpemlhLml0IiwKCSJnci5pdCIsCgkiZ3Jvc3NldG8uaXQiLAoJImlnbGVzaWFzLWNhcmJvbmlhLml0IiwKCSJpZ2xlc2lhc2NhcmJvbmlhLml0IiwKCSJpbS5pdCIsCgkiaW1wZXJpYS5pdCIsCgkiaXMuaXQiLAoJImlzZXJuaWEuaXQiLAoJImtyLml0IiwKCSJsYS1zcGV6aWEuaXQiLAoJImxhcXVpbGEuaXQiLAoJImxhc3BlemlhLml0IiwKCSJsYXRpbmEuaXQiLAoJImxjLml0IiwKCSJsZS5pdCIsCgkibGVjY2UuaXQiLAoJImxlY2NvLml0IiwKCSJsaS5pdCIsCgkibGl2b3Juby5pdCIsCgkibG8uaXQiLAoJImxvZGkuaXQiLAoJImx0Lml0IiwKCSJsdS5pdCIsCgkibHVjY2EuaXQiLAoJIm1hY2VyYXRhLml0IiwKCSJtYW50b3ZhLml0IiwKCSJtYXNzYS1jYXJyYXJhLml0IiwKCSJtYXNzYWNhcnJhcmEuaXQiLAoJIm1hdGVyYS5pdCIsCgkibWIuaXQiLAoJIm1jLml0IiwKCSJtZS5pdCIsCgkibWVkaW8tY2FtcGlkYW5vLml0IiwKCSJtZWRpb2NhbXBpZGFuby5pdCIsCgkibWVzc2luYS5pdCIsCgkibWkuaXQiLAoJIm1pbGFuLml0IiwKCSJtaWxhbm8uaXQiLAoJIm1uLml0IiwKCSJtby5pdCIsCgkibW9kZW5hLml0IiwKCSJtb256YS1icmlhbnphLml0IiwKCSJtb256YS1lLWRlbGxhLWJyaWFuemEuaXQiLAoJIm1vbnphLml0IiwKCSJtb256YWJyaWFuemEuaXQiLAoJIm1vbnphZWJyaWFuemEuaXQiLAoJIm1vbnphZWRlbGxhYnJpYW56YS5pdCIsCgkibXMuaXQiLAoJIm10Lml0IiwKCSJuYS5pdCIsCgkibmFwbGVzLml0IiwKCSJuYXBvbGkuaXQiLAoJIm5vLml0IiwKCSJub3ZhcmEuaXQiLAoJIm51Lml0IiwKCSJudW9yby5pdCIsCgkib2cuaXQiLAoJIm9nbGlhc3RyYS5pdCIsCgkib2xiaWEtdGVtcGlvLml0IiwKCSJvbGJpYXRlbXBpby5pdCIsCgkib3IuaXQiLAoJIm9yaXN0YW5vLml0IiwKCSJvdC5pdCIsCgkicGEuaXQiLAoJInBhZG92YS5pdCIsCgkicGFkdWEuaXQiLAoJInBhbGVybW8uaXQiLAoJInBhcm1hLml0IiwKCSJwYXZpYS5pdCIsCgkicGMuaXQiLAoJInBkLml0IiwKCSJwZS5pdCIsCgkicGVydWdpYS5pdCIsCgkicGVzYXJvLXVyYmluby5pdCIsCgkicGVzYXJvdXJiaW5vLml0IiwKCSJwZXNjYXJhLml0IiwKCSJwZy5pdCIsCgkicGkuaXQiLAoJInBpYWNlbnphLml0IiwKCSJwaXNhLml0IiwKCSJwaXN0b2lhLml0IiwKCSJwbi5pdCIsCgkicG8uaXQiLAoJInBvcmRlbm9uZS5pdCIsCgkicG90ZW56YS5pdCIsCgkicHIuaXQiLAoJInByYXRvLml0IiwKCSJwdC5pdCIsCgkicHUuaXQiLAoJInB2Lml0IiwKCSJwei5pdCIsCgkicmEuaXQiLAoJInJhZ3VzYS5pdCIsCgkicmF2ZW5uYS5pdCIsCgkicmMuaXQiLAoJInJlLml0IiwKCSJyZWdnaW8tY2FsYWJyaWEuaXQiLAoJInJlZ2dpby1lbWlsaWEuaXQiLAoJInJlZ2dpb2NhbGFicmlhLml0IiwKCSJyZWdnaW9lbWlsaWEuaXQiLAoJInJnLml0IiwKCSJyaS5pdCIsCgkicmlldGkuaXQiLAoJInJpbWluaS5pdCIsCgkicm0uaXQiLAoJInJuLml0IiwKCSJyby5pdCIsCgkicm9tYS5pdCIsCgkicm9tZS5pdCIsCgkicm92aWdvLml0IiwKCSJzYS5pdCIsCgkic2FsZXJuby5pdCIsCgkic2Fzc2FyaS5pdCIsCgkic2F2b25hLml0IiwKCSJzaS5pdCIsCgkic2llbmEuaXQiLAoJInNpcmFjdXNhLml0IiwKCSJzby5pdCIsCgkic29uZHJpby5pdCIsCgkic3AuaXQiLAoJInNyLml0IiwKCSJzcy5pdCIsCgkic3VlZHRpcm9sLml0IiwKCSJzw7xkdGlyb2wuaXQiLAoJInN2Lml0IiwKCSJ0YS5pdCIsCgkidGFyYW50by5pdCIsCgkidGUuaXQiLAoJInRlbXBpby1vbGJpYS5pdCIsCgkidGVtcGlvb2xiaWEuaXQiLAoJInRlcmFtby5pdCIsCgkidGVybmkuaXQiLAoJInRuLml0IiwKCSJ0by5pdCIsCgkidG9yaW5vLml0IiwKCSJ0cC5pdCIsCgkidHIuaXQiLAoJInRyYW5pLWFuZHJpYS1iYXJsZXR0YS5pdCIsCgkidHJhbmktYmFybGV0dGEtYW5kcmlhLml0IiwKCSJ0cmFuaWFuZHJpYWJhcmxldHRhLml0IiwKCSJ0cmFuaWJhcmxldHRhYW5kcmlhLml0IiwKCSJ0cmFwYW5pLml0IiwKCSJ0cmVudG8uaXQiLAoJInRyZXZpc28uaXQiLAoJInRyaWVzdGUuaXQiLAoJInRzLml0IiwKCSJ0dXJpbi5pdCIsCgkidHYuaXQiLAoJInVkLml0IiwKCSJ1ZGluZS5pdCIsCgkidXJiaW5vLXBlc2Fyby5pdCIsCgkidXJiaW5vcGVzYXJvLml0IiwKCSJ2YS5pdCIsCgkidmFyZXNlLml0IiwKCSJ2Yi5pdCIsCgkidmMuaXQiLAoJInZlLml0IiwKCSJ2ZW5lemlhLml0IiwKCSJ2ZW5pY2UuaXQiLAoJInZlcmJhbmlhLml0IiwKCSJ2ZXJjZWxsaS5pdCIsCgkidmVyb25hLml0IiwKCSJ2aS5pdCIsCgkidmliby12YWxlbnRpYS5pdCIsCgkidmlib3ZhbGVudGlhLml0IiwKCSJ2aWNlbnphLml0IiwKCSJ2aXRlcmJvLml0IiwKCSJ2ci5pdCIsCgkidnMuaXQiLAoJInZ0Lml0IiwKCSJ2di5pdCIsCgkiamUiLAoJImNvLmplIiwKCSJuZXQuamUiLAoJIm9yZy5qZSIsCgkiKi5qbSIsCgkiam8iLAoJImNvbS5qbyIsCgkib3JnLmpvIiwKCSJuZXQuam8iLAoJImVkdS5qbyIsCgkic2NoLmpvIiwKCSJnb3Yuam8iLAoJIm1pbC5qbyIsCgkibmFtZS5qbyIsCgkiam9icyIsCgkianAiLAoJImFjLmpwIiwKCSJhZC5qcCIsCgkiY28uanAiLAoJImVkLmpwIiwKCSJnby5qcCIsCgkiZ3IuanAiLAoJImxnLmpwIiwKCSJuZS5qcCIsCgkib3IuanAiLAoJImFpY2hpLmpwIiwKCSJha2l0YS5qcCIsCgkiYW9tb3JpLmpwIiwKCSJjaGliYS5qcCIsCgkiZWhpbWUuanAiLAoJImZ1a3VpLmpwIiwKCSJmdWt1b2thLmpwIiwKCSJmdWt1c2hpbWEuanAiLAoJImdpZnUuanAiLAoJImd1bm1hLmpwIiwKCSJoaXJvc2hpbWEuanAiLAoJImhva2thaWRvLmpwIiwKCSJoeW9nby5qcCIsCgkiaWJhcmFraS5qcCIsCgkiaXNoaWthd2EuanAiLAoJIml3YXRlLmpwIiwKCSJrYWdhd2EuanAiLAoJImthZ29zaGltYS5qcCIsCgkia2FuYWdhd2EuanAiLAoJImtvY2hpLmpwIiwKCSJrdW1hbW90by5qcCIsCgkia3lvdG8uanAiLAoJIm1pZS5qcCIsCgkibWl5YWdpLmpwIiwKCSJtaXlhemFraS5qcCIsCgkibmFnYW5vLmpwIiwKCSJuYWdhc2FraS5qcCIsCgkibmFyYS5qcCIsCgkibmlpZ2F0YS5qcCIsCgkib2l0YS5qcCIsCgkib2theWFtYS5qcCIsCgkib2tpbmF3YS5qcCIsCgkib3Nha2EuanAiLAoJInNhZ2EuanAiLAoJInNhaXRhbWEuanAiLAoJInNoaWdhLmpwIiwKCSJzaGltYW5lLmpwIiwKCSJzaGl6dW9rYS5qcCIsCgkidG9jaGlnaS5qcCIsCgkidG9rdXNoaW1hLmpwIiwKCSJ0b2t5by5qcCIsCgkidG90dG9yaS5qcCIsCgkidG95YW1hLmpwIiwKCSJ3YWtheWFtYS5qcCIsCgkieWFtYWdhdGEuanAiLAoJInlhbWFndWNoaS5qcCIsCgkieWFtYW5hc2hpLmpwIiwKCSLmoIPmnKguanAiLAoJIuaEm+efpS5qcCIsCgki5oSb5aqbLmpwIiwKCSLlhbXluqsuanAiLAoJIueGiuacrC5qcCIsCgki6Iyo5Z+OLmpwIiwKCSLljJfmtbfpgZMuanAiLAoJIuWNg+iRiS5qcCIsCgki5ZKM5q2M5bGxLmpwIiwKCSLplbfltI4uanAiLAoJIumVt+mHji5qcCIsCgki5paw5r2fLmpwIiwKCSLpnZLmo64uanAiLAoJIumdmeWyoS5qcCIsCgki5p2x5LqsLmpwIiwKCSLnn7Plt50uanAiLAoJIuWfvOeOiS5qcCIsCgki5LiJ6YeNLmpwIiwKCSLkuqzpg70uanAiLAoJIuS9kOizgC5qcCIsCgki5aSn5YiGLmpwIiwKCSLlpKfpmKouanAiLAoJIuWliOiJry5qcCIsCgki5a6u5Z+OLmpwIiwKCSLlrq7ltI4uanAiLAoJIuWvjOWxsS5qcCIsCgki5bGx5Y+jLmpwIiwKCSLlsbHlvaIuanAiLAoJIuWxseaiqC5qcCIsCgki5bKp5omLLmpwIiwKCSLlspDpmJwuanAiLAoJIuWyoeWxsS5qcCIsCgki5bO25qC5LmpwIiwKCSLluoPls7YuanAiLAoJIuW+s+Wzti5qcCIsCgki5rKW57iELmpwIiwKCSLmu4vos4AuanAiLAoJIuelnuWliOW3nS5qcCIsCgki56aP5LqVLmpwIiwKCSLnpo/lsqEuanAiLAoJIuemj+Wzti5qcCIsCgki56eL55SwLmpwIiwKCSLnvqTppqwuanAiLAoJIummmeW3nS5qcCIsCgki6auY55+lLmpwIiwKCSLps6Xlj5YuanAiLAoJIum5v+WFkOWzti5qcCIsCgkiKi5rYXdhc2FraS5qcCIsCgkiKi5raXRha3l1c2h1LmpwIiwKCSIqLmtvYmUuanAiLAoJIioubmFnb3lhLmpwIiwKCSIqLnNhcHBvcm8uanAiLAoJIiouc2VuZGFpLmpwIiwKCSIqLnlva29oYW1hLmpwIiwKCSIhY2l0eS5rYXdhc2FraS5qcCIsCgkiIWNpdHkua2l0YWt5dXNodS5qcCIsCgkiIWNpdHkua29iZS5qcCIsCgkiIWNpdHkubmFnb3lhLmpwIiwKCSIhY2l0eS5zYXBwb3JvLmpwIiwKCSIhY2l0eS5zZW5kYWkuanAiLAoJIiFjaXR5Lnlva29oYW1hLmpwIiwKCSJhaXNhaS5haWNoaS5qcCIsCgkiYW1hLmFpY2hpLmpwIiwKCSJhbmpvLmFpY2hpLmpwIiwKCSJhc3VrZS5haWNoaS5qcCIsCgkiY2hpcnl1LmFpY2hpLmpwIiwKCSJjaGl0YS5haWNoaS5qcCIsCgkiZnVzby5haWNoaS5qcCIsCgkiZ2FtYWdvcmkuYWljaGkuanAiLAoJImhhbmRhLmFpY2hpLmpwIiwKCSJoYXp1LmFpY2hpLmpwIiwKCSJoZWtpbmFuLmFpY2hpLmpwIiwKCSJoaWdhc2hpdXJhLmFpY2hpLmpwIiwKCSJpY2hpbm9taXlhLmFpY2hpLmpwIiwKCSJpbmF6YXdhLmFpY2hpLmpwIiwKCSJpbnV5YW1hLmFpY2hpLmpwIiwKCSJpc3NoaWtpLmFpY2hpLmpwIiwKCSJpd2FrdXJhLmFpY2hpLmpwIiwKCSJrYW5pZS5haWNoaS5qcCIsCgkia2FyaXlhLmFpY2hpLmpwIiwKCSJrYXN1Z2FpLmFpY2hpLmpwIiwKCSJraXJhLmFpY2hpLmpwIiwKCSJraXlvc3UuYWljaGkuanAiLAoJImtvbWFraS5haWNoaS5qcCIsCgkia29uYW4uYWljaGkuanAiLAoJImtvdGEuYWljaGkuanAiLAoJIm1paGFtYS5haWNoaS5qcCIsCgkibWl5b3NoaS5haWNoaS5qcCIsCgkibmlzaGlvLmFpY2hpLmpwIiwKCSJuaXNzaGluLmFpY2hpLmpwIiwKCSJvYnUuYWljaGkuanAiLAoJIm9ndWNoaS5haWNoaS5qcCIsCgkib2hhcnUuYWljaGkuanAiLAoJIm9rYXpha2kuYWljaGkuanAiLAoJIm93YXJpYXNhaGkuYWljaGkuanAiLAoJInNldG8uYWljaGkuanAiLAoJInNoaWthdHN1LmFpY2hpLmpwIiwKCSJzaGluc2hpcm8uYWljaGkuanAiLAoJInNoaXRhcmEuYWljaGkuanAiLAoJInRhaGFyYS5haWNoaS5qcCIsCgkidGFrYWhhbWEuYWljaGkuanAiLAoJInRvYmlzaGltYS5haWNoaS5qcCIsCgkidG9laS5haWNoaS5qcCIsCgkidG9nby5haWNoaS5qcCIsCgkidG9rYWkuYWljaGkuanAiLAoJInRva29uYW1lLmFpY2hpLmpwIiwKCSJ0b3lvYWtlLmFpY2hpLmpwIiwKCSJ0b3lvaGFzaGkuYWljaGkuanAiLAoJInRveW9rYXdhLmFpY2hpLmpwIiwKCSJ0b3lvbmUuYWljaGkuanAiLAoJInRveW90YS5haWNoaS5qcCIsCgkidHN1c2hpbWEuYWljaGkuanAiLAoJInlhdG9taS5haWNoaS5qcCIsCgkiYWtpdGEuYWtpdGEuanAiLAoJImRhaXNlbi5ha2l0YS5qcCIsCgkiZnVqaXNhdG8uYWtpdGEuanAiLAoJImdvam9tZS5ha2l0YS5qcCIsCgkiaGFjaGlyb2dhdGEuYWtpdGEuanAiLAoJImhhcHBvdS5ha2l0YS5qcCIsCgkiaGlnYXNoaW5hcnVzZS5ha2l0YS5qcCIsCgkiaG9uam8uYWtpdGEuanAiLAoJImhvbmp5by5ha2l0YS5qcCIsCgkiaWthd2EuYWtpdGEuanAiLAoJImthbWlrb2FuaS5ha2l0YS5qcCIsCgkia2FtaW9rYS5ha2l0YS5qcCIsCgkia2F0YWdhbWkuYWtpdGEuanAiLAoJImthenVuby5ha2l0YS5qcCIsCgkia2l0YWFraXRhLmFraXRhLmpwIiwKCSJrb3Nha2EuYWtpdGEuanAiLAoJImt5b3dhLmFraXRhLmpwIiwKCSJtaXNhdG8uYWtpdGEuanAiLAoJIm1pdGFuZS5ha2l0YS5qcCIsCgkibW9yaXlvc2hpLmFraXRhLmpwIiwKCSJuaWthaG8uYWtpdGEuanAiLAoJIm5vc2hpcm8uYWtpdGEuanAiLAoJIm9kYXRlLmFraXRhLmpwIiwKCSJvZ2EuYWtpdGEuanAiLAoJIm9nYXRhLmFraXRhLmpwIiwKCSJzZW1ib2t1LmFraXRhLmpwIiwKCSJ5b2tvdGUuYWtpdGEuanAiLAoJInl1cmlob25qby5ha2l0YS5qcCIsCgkiYW9tb3JpLmFvbW9yaS5qcCIsCgkiZ29ub2hlLmFvbW9yaS5qcCIsCgkiaGFjaGlub2hlLmFvbW9yaS5qcCIsCgkiaGFzaGlrYW1pLmFvbW9yaS5qcCIsCgkiaGlyYW5haS5hb21vcmkuanAiLAoJImhpcm9zYWtpLmFvbW9yaS5qcCIsCgkiaXRheWFuYWdpLmFvbW9yaS5qcCIsCgkia3Vyb2lzaGkuYW9tb3JpLmpwIiwKCSJtaXNhd2EuYW9tb3JpLmpwIiwKCSJtdXRzdS5hb21vcmkuanAiLAoJIm5ha2Fkb21hcmkuYW9tb3JpLmpwIiwKCSJub2hlamkuYW9tb3JpLmpwIiwKCSJvaXJhc2UuYW9tb3JpLmpwIiwKCSJvd2FuaS5hb21vcmkuanAiLAoJInJva3Vub2hlLmFvbW9yaS5qcCIsCgkic2Fubm9oZS5hb21vcmkuanAiLAoJInNoaWNoaW5vaGUuYW9tb3JpLmpwIiwKCSJzaGluZ28uYW9tb3JpLmpwIiwKCSJ0YWtrby5hb21vcmkuanAiLAoJInRvd2FkYS5hb21vcmkuanAiLAoJInRzdWdhcnUuYW9tb3JpLmpwIiwKCSJ0c3VydXRhLmFvbW9yaS5qcCIsCgkiYWJpa28uY2hpYmEuanAiLAoJImFzYWhpLmNoaWJhLmpwIiwKCSJjaG9uYW4uY2hpYmEuanAiLAoJImNob3NlaS5jaGliYS5qcCIsCgkiY2hvc2hpLmNoaWJhLmpwIiwKCSJjaHVvLmNoaWJhLmpwIiwKCSJmdW5hYmFzaGkuY2hpYmEuanAiLAoJImZ1dHRzdS5jaGliYS5qcCIsCgkiaGFuYW1pZ2F3YS5jaGliYS5qcCIsCgkiaWNoaWhhcmEuY2hpYmEuanAiLAoJImljaGlrYXdhLmNoaWJhLmpwIiwKCSJpY2hpbm9taXlhLmNoaWJhLmpwIiwKCSJpbnphaS5jaGliYS5qcCIsCgkiaXN1bWkuY2hpYmEuanAiLAoJImthbWFnYXlhLmNoaWJhLmpwIiwKCSJrYW1vZ2F3YS5jaGliYS5qcCIsCgkia2FzaGl3YS5jaGliYS5qcCIsCgkia2F0b3JpLmNoaWJhLmpwIiwKCSJrYXRzdXVyYS5jaGliYS5qcCIsCgkia2ltaXRzdS5jaGliYS5qcCIsCgkia2lzYXJhenUuY2hpYmEuanAiLAoJImtvemFraS5jaGliYS5qcCIsCgkia3VqdWt1cmkuY2hpYmEuanAiLAoJImt5b25hbi5jaGliYS5qcCIsCgkibWF0c3Vkby5jaGliYS5qcCIsCgkibWlkb3JpLmNoaWJhLmpwIiwKCSJtaWhhbWEuY2hpYmEuanAiLAoJIm1pbmFtaWJvc28uY2hpYmEuanAiLAoJIm1vYmFyYS5jaGliYS5qcCIsCgkibXV0c3V6YXdhLmNoaWJhLmpwIiwKCSJuYWdhcmEuY2hpYmEuanAiLAoJIm5hZ2FyZXlhbWEuY2hpYmEuanAiLAoJIm5hcmFzaGluby5jaGliYS5qcCIsCgkibmFyaXRhLmNoaWJhLmpwIiwKCSJub2RhLmNoaWJhLmpwIiwKCSJvYW1pc2hpcmFzYXRvLmNoaWJhLmpwIiwKCSJvbWlnYXdhLmNoaWJhLmpwIiwKCSJvbmp1a3UuY2hpYmEuanAiLAoJIm90YWtpLmNoaWJhLmpwIiwKCSJzYWthZS5jaGliYS5qcCIsCgkic2FrdXJhLmNoaWJhLmpwIiwKCSJzaGltb2Z1c2EuY2hpYmEuanAiLAoJInNoaXJha28uY2hpYmEuanAiLAoJInNoaXJvaS5jaGliYS5qcCIsCgkic2hpc3VpLmNoaWJhLmpwIiwKCSJzb2RlZ2F1cmEuY2hpYmEuanAiLAoJInNvc2EuY2hpYmEuanAiLAoJInRha28uY2hpYmEuanAiLAoJInRhdGV5YW1hLmNoaWJhLmpwIiwKCSJ0b2dhbmUuY2hpYmEuanAiLAoJInRvaG5vc2hvLmNoaWJhLmpwIiwKCSJ0b21pc2F0by5jaGliYS5qcCIsCgkidXJheWFzdS5jaGliYS5qcCIsCgkieWFjaGltYXRhLmNoaWJhLmpwIiwKCSJ5YWNoaXlvLmNoaWJhLmpwIiwKCSJ5b2thaWNoaWJhLmNoaWJhLmpwIiwKCSJ5b2tvc2hpYmFoaWthcmkuY2hpYmEuanAiLAoJInlvdHN1a2FpZG8uY2hpYmEuanAiLAoJImFpbmFuLmVoaW1lLmpwIiwKCSJob25haS5laGltZS5qcCIsCgkiaWthdGEuZWhpbWUuanAiLAoJImltYWJhcmkuZWhpbWUuanAiLAoJIml5by5laGltZS5qcCIsCgkia2FtaWppbWEuZWhpbWUuanAiLAoJImtpaG9rdS5laGltZS5qcCIsCgkia3VtYWtvZ2VuLmVoaW1lLmpwIiwKCSJtYXNha2kuZWhpbWUuanAiLAoJIm1hdHN1bm8uZWhpbWUuanAiLAoJIm1hdHN1eWFtYS5laGltZS5qcCIsCgkibmFtaWthdGEuZWhpbWUuanAiLAoJIm5paWhhbWEuZWhpbWUuanAiLAoJIm96dS5laGltZS5qcCIsCgkic2Fpam8uZWhpbWUuanAiLAoJInNlaXlvLmVoaW1lLmpwIiwKCSJzaGlrb2t1Y2h1by5laGltZS5qcCIsCgkidG9iZS5laGltZS5qcCIsCgkidG9vbi5laGltZS5qcCIsCgkidWNoaWtvLmVoaW1lLmpwIiwKCSJ1d2FqaW1hLmVoaW1lLmpwIiwKCSJ5YXdhdGFoYW1hLmVoaW1lLmpwIiwKCSJlY2hpemVuLmZ1a3VpLmpwIiwKCSJlaWhlaWppLmZ1a3VpLmpwIiwKCSJmdWt1aS5mdWt1aS5qcCIsCgkiaWtlZGEuZnVrdWkuanAiLAoJImthdHN1eWFtYS5mdWt1aS5qcCIsCgkibWloYW1hLmZ1a3VpLmpwIiwKCSJtaW5hbWllY2hpemVuLmZ1a3VpLmpwIiwKCSJvYmFtYS5mdWt1aS5qcCIsCgkib2hpLmZ1a3VpLmpwIiwKCSJvbm8uZnVrdWkuanAiLAoJInNhYmFlLmZ1a3VpLmpwIiwKCSJzYWthaS5mdWt1aS5qcCIsCgkidGFrYWhhbWEuZnVrdWkuanAiLAoJInRzdXJ1Z2EuZnVrdWkuanAiLAoJIndha2FzYS5mdWt1aS5qcCIsCgkiYXNoaXlhLmZ1a3Vva2EuanAiLAoJImJ1emVuLmZ1a3Vva2EuanAiLAoJImNoaWt1Z28uZnVrdW9rYS5qcCIsCgkiY2hpa3Voby5mdWt1b2thLmpwIiwKCSJjaGlrdWpvLmZ1a3Vva2EuanAiLAoJImNoaWt1c2hpbm8uZnVrdW9rYS5qcCIsCgkiY2hpa3V6ZW4uZnVrdW9rYS5qcCIsCgkiY2h1by5mdWt1b2thLmpwIiwKCSJkYXphaWZ1LmZ1a3Vva2EuanAiLAoJImZ1a3VjaGkuZnVrdW9rYS5qcCIsCgkiaGFrYXRhLmZ1a3Vva2EuanAiLAoJImhpZ2FzaGkuZnVrdW9rYS5qcCIsCgkiaGlyb2thd2EuZnVrdW9rYS5qcCIsCgkiaGlzYXlhbWEuZnVrdW9rYS5qcCIsCgkiaWl6dWthLmZ1a3Vva2EuanAiLAoJImluYXRzdWtpLmZ1a3Vva2EuanAiLAoJImthaG8uZnVrdW9rYS5qcCIsCgkia2FzdWdhLmZ1a3Vva2EuanAiLAoJImthc3V5YS5mdWt1b2thLmpwIiwKCSJrYXdhcmEuZnVrdW9rYS5qcCIsCgkia2Vpc2VuLmZ1a3Vva2EuanAiLAoJImtvZ2EuZnVrdW9rYS5qcCIsCgkia3VyYXRlLmZ1a3Vva2EuanAiLAoJImt1cm9naS5mdWt1b2thLmpwIiwKCSJrdXJ1bWUuZnVrdW9rYS5qcCIsCgkibWluYW1pLmZ1a3Vva2EuanAiLAoJIm1peWFrby5mdWt1b2thLmpwIiwKCSJtaXlhbWEuZnVrdW9rYS5qcCIsCgkibWl5YXdha2EuZnVrdW9rYS5qcCIsCgkibWl6dW1ha2kuZnVrdW9rYS5qcCIsCgkibXVuYWthdGEuZnVrdW9rYS5qcCIsCgkibmFrYWdhd2EuZnVrdW9rYS5qcCIsCgkibmFrYW1hLmZ1a3Vva2EuanAiLAoJIm5pc2hpLmZ1a3Vva2EuanAiLAoJIm5vZ2F0YS5mdWt1b2thLmpwIiwKCSJvZ29yaS5mdWt1b2thLmpwIiwKCSJva2FnYWtpLmZ1a3Vva2EuanAiLAoJIm9rYXdhLmZ1a3Vva2EuanAiLAoJIm9raS5mdWt1b2thLmpwIiwKCSJvbXV0YS5mdWt1b2thLmpwIiwKCSJvbmdhLmZ1a3Vva2EuanAiLAoJIm9ub2pvLmZ1a3Vva2EuanAiLAoJIm90by5mdWt1b2thLmpwIiwKCSJzYWlnYXdhLmZ1a3Vva2EuanAiLAoJInNhc2FndXJpLmZ1a3Vva2EuanAiLAoJInNoaW5ndS5mdWt1b2thLmpwIiwKCSJzaGlueW9zaGl0b21pLmZ1a3Vva2EuanAiLAoJInNob25haS5mdWt1b2thLmpwIiwKCSJzb2VkYS5mdWt1b2thLmpwIiwKCSJzdWUuZnVrdW9rYS5qcCIsCgkidGFjaGlhcmFpLmZ1a3Vva2EuanAiLAoJInRhZ2F3YS5mdWt1b2thLmpwIiwKCSJ0YWthdGEuZnVrdW9rYS5qcCIsCgkidG9oby5mdWt1b2thLmpwIiwKCSJ0b3lvdHN1LmZ1a3Vva2EuanAiLAoJInRzdWlraS5mdWt1b2thLmpwIiwKCSJ1a2loYS5mdWt1b2thLmpwIiwKCSJ1bWkuZnVrdW9rYS5qcCIsCgkidXN1aS5mdWt1b2thLmpwIiwKCSJ5YW1hZGEuZnVrdW9rYS5qcCIsCgkieWFtZS5mdWt1b2thLmpwIiwKCSJ5YW5hZ2F3YS5mdWt1b2thLmpwIiwKCSJ5dWt1aGFzaGkuZnVrdW9rYS5qcCIsCgkiYWl6dWJhbmdlLmZ1a3VzaGltYS5qcCIsCgkiYWl6dW1pc2F0by5mdWt1c2hpbWEuanAiLAoJImFpenV3YWthbWF0c3UuZnVrdXNoaW1hLmpwIiwKCSJhc2FrYXdhLmZ1a3VzaGltYS5qcCIsCgkiYmFuZGFpLmZ1a3VzaGltYS5qcCIsCgkiZGF0ZS5mdWt1c2hpbWEuanAiLAoJImZ1a3VzaGltYS5mdWt1c2hpbWEuanAiLAoJImZ1cnVkb25vLmZ1a3VzaGltYS5qcCIsCgkiZnV0YWJhLmZ1a3VzaGltYS5qcCIsCgkiaGFuYXdhLmZ1a3VzaGltYS5qcCIsCgkiaGlnYXNoaS5mdWt1c2hpbWEuanAiLAoJImhpcmF0YS5mdWt1c2hpbWEuanAiLAoJImhpcm9uby5mdWt1c2hpbWEuanAiLAoJImlpdGF0ZS5mdWt1c2hpbWEuanAiLAoJImluYXdhc2hpcm8uZnVrdXNoaW1hLmpwIiwKCSJpc2hpa2F3YS5mdWt1c2hpbWEuanAiLAoJIml3YWtpLmZ1a3VzaGltYS5qcCIsCgkiaXp1bWl6YWtpLmZ1a3VzaGltYS5qcCIsCgkia2FnYW1paXNoaS5mdWt1c2hpbWEuanAiLAoJImthbmV5YW1hLmZ1a3VzaGltYS5qcCIsCgkia2F3YW1hdGEuZnVrdXNoaW1hLmpwIiwKCSJraXRha2F0YS5mdWt1c2hpbWEuanAiLAoJImtpdGFzaGlvYmFyYS5mdWt1c2hpbWEuanAiLAoJImtvb3JpLmZ1a3VzaGltYS5qcCIsCgkia29yaXlhbWEuZnVrdXNoaW1hLmpwIiwKCSJrdW5pbWkuZnVrdXNoaW1hLmpwIiwKCSJtaWhhcnUuZnVrdXNoaW1hLmpwIiwKCSJtaXNoaW1hLmZ1a3VzaGltYS5qcCIsCgkibmFtaWUuZnVrdXNoaW1hLmpwIiwKCSJuYW5nby5mdWt1c2hpbWEuanAiLAoJIm5pc2hpYWl6dS5mdWt1c2hpbWEuanAiLAoJIm5pc2hpZ28uZnVrdXNoaW1hLmpwIiwKCSJva3VtYS5mdWt1c2hpbWEuanAiLAoJIm9tb3RlZ28uZnVrdXNoaW1hLmpwIiwKCSJvbm8uZnVrdXNoaW1hLmpwIiwKCSJvdGFtYS5mdWt1c2hpbWEuanAiLAoJInNhbWVnYXdhLmZ1a3VzaGltYS5qcCIsCgkic2hpbW9nby5mdWt1c2hpbWEuanAiLAoJInNoaXJha2F3YS5mdWt1c2hpbWEuanAiLAoJInNob3dhLmZ1a3VzaGltYS5qcCIsCgkic29tYS5mdWt1c2hpbWEuanAiLAoJInN1a2FnYXdhLmZ1a3VzaGltYS5qcCIsCgkidGFpc2hpbi5mdWt1c2hpbWEuanAiLAoJInRhbWFrYXdhLmZ1a3VzaGltYS5qcCIsCgkidGFuYWd1cmEuZnVrdXNoaW1hLmpwIiwKCSJ0ZW5laS5mdWt1c2hpbWEuanAiLAoJInlhYnVraS5mdWt1c2hpbWEuanAiLAoJInlhbWF0by5mdWt1c2hpbWEuanAiLAoJInlhbWF0c3VyaS5mdWt1c2hpbWEuanAiLAoJInlhbmFpenUuZnVrdXNoaW1hLmpwIiwKCSJ5dWdhd2EuZnVrdXNoaW1hLmpwIiwKCSJhbnBhY2hpLmdpZnUuanAiLAoJImVuYS5naWZ1LmpwIiwKCSJnaWZ1LmdpZnUuanAiLAoJImdpbmFuLmdpZnUuanAiLAoJImdvZG8uZ2lmdS5qcCIsCgkiZ3Vqby5naWZ1LmpwIiwKCSJoYXNoaW1hLmdpZnUuanAiLAoJImhpY2hpc28uZ2lmdS5qcCIsCgkiaGlkYS5naWZ1LmpwIiwKCSJoaWdhc2hpc2hpcmFrYXdhLmdpZnUuanAiLAoJImliaWdhd2EuZ2lmdS5qcCIsCgkiaWtlZGEuZ2lmdS5qcCIsCgkia2FrYW1pZ2FoYXJhLmdpZnUuanAiLAoJImthbmkuZ2lmdS5qcCIsCgkia2FzYWhhcmEuZ2lmdS5qcCIsCgkia2FzYW1hdHN1LmdpZnUuanAiLAoJImthd2F1ZS5naWZ1LmpwIiwKCSJraXRhZ2F0YS5naWZ1LmpwIiwKCSJtaW5vLmdpZnUuanAiLAoJIm1pbm9rYW1vLmdpZnUuanAiLAoJIm1pdGFrZS5naWZ1LmpwIiwKCSJtaXp1bmFtaS5naWZ1LmpwIiwKCSJtb3Rvc3UuZ2lmdS5qcCIsCgkibmFrYXRzdWdhd2EuZ2lmdS5qcCIsCgkib2dha2kuZ2lmdS5qcCIsCgkic2FrYWhvZ2kuZ2lmdS5qcCIsCgkic2VraS5naWZ1LmpwIiwKCSJzZWtpZ2FoYXJhLmdpZnUuanAiLAoJInNoaXJha2F3YS5naWZ1LmpwIiwKCSJ0YWppbWkuZ2lmdS5qcCIsCgkidGFrYXlhbWEuZ2lmdS5qcCIsCgkidGFydWkuZ2lmdS5qcCIsCgkidG9raS5naWZ1LmpwIiwKCSJ0b21pa2EuZ2lmdS5qcCIsCgkid2Fub3VjaGkuZ2lmdS5qcCIsCgkieWFtYWdhdGEuZ2lmdS5qcCIsCgkieWFvdHN1LmdpZnUuanAiLAoJInlvcm8uZ2lmdS5qcCIsCgkiYW5uYWthLmd1bm1hLmpwIiwKCSJjaGl5b2RhLmd1bm1hLmpwIiwKCSJmdWppb2thLmd1bm1hLmpwIiwKCSJoaWdhc2hpYWdhdHN1bWEuZ3VubWEuanAiLAoJImlzZXNha2kuZ3VubWEuanAiLAoJIml0YWt1cmEuZ3VubWEuanAiLAoJImthbm5hLmd1bm1hLmpwIiwKCSJrYW5yYS5ndW5tYS5qcCIsCgkia2F0YXNoaW5hLmd1bm1hLmpwIiwKCSJrYXdhYmEuZ3VubWEuanAiLAoJImtpcnl1Lmd1bm1hLmpwIiwKCSJrdXNhdHN1Lmd1bm1hLmpwIiwKCSJtYWViYXNoaS5ndW5tYS5qcCIsCgkibWVpd2EuZ3VubWEuanAiLAoJIm1pZG9yaS5ndW5tYS5qcCIsCgkibWluYWthbWkuZ3VubWEuanAiLAoJIm5hZ2Fub2hhcmEuZ3VubWEuanAiLAoJIm5ha2Fub2pvLmd1bm1hLmpwIiwKCSJuYW5tb2t1Lmd1bm1hLmpwIiwKCSJudW1hdGEuZ3VubWEuanAiLAoJIm9penVtaS5ndW5tYS5qcCIsCgkib3JhLmd1bm1hLmpwIiwKCSJvdGEuZ3VubWEuanAiLAoJInNoaWJ1a2F3YS5ndW5tYS5qcCIsCgkic2hpbW9uaXRhLmd1bm1hLmpwIiwKCSJzaGludG8uZ3VubWEuanAiLAoJInNob3dhLmd1bm1hLmpwIiwKCSJ0YWthc2FraS5ndW5tYS5qcCIsCgkidGFrYXlhbWEuZ3VubWEuanAiLAoJInRhbWFtdXJhLmd1bm1hLmpwIiwKCSJ0YXRlYmF5YXNoaS5ndW5tYS5qcCIsCgkidG9taW9rYS5ndW5tYS5qcCIsCgkidHN1a2l5b25vLmd1bm1hLmpwIiwKCSJ0c3VtYWdvaS5ndW5tYS5qcCIsCgkidWVuby5ndW5tYS5qcCIsCgkieW9zaGlva2EuZ3VubWEuanAiLAoJImFzYW1pbmFtaS5oaXJvc2hpbWEuanAiLAoJImRhaXdhLmhpcm9zaGltYS5qcCIsCgkiZXRhamltYS5oaXJvc2hpbWEuanAiLAoJImZ1Y2h1Lmhpcm9zaGltYS5qcCIsCgkiZnVrdXlhbWEuaGlyb3NoaW1hLmpwIiwKCSJoYXRzdWthaWNoaS5oaXJvc2hpbWEuanAiLAoJImhpZ2FzaGloaXJvc2hpbWEuaGlyb3NoaW1hLmpwIiwKCSJob25nby5oaXJvc2hpbWEuanAiLAoJImppbnNla2lrb2dlbi5oaXJvc2hpbWEuanAiLAoJImthaXRhLmhpcm9zaGltYS5qcCIsCgkia3VpLmhpcm9zaGltYS5qcCIsCgkia3VtYW5vLmhpcm9zaGltYS5qcCIsCgkia3VyZS5oaXJvc2hpbWEuanAiLAoJIm1paGFyYS5oaXJvc2hpbWEuanAiLAoJIm1peW9zaGkuaGlyb3NoaW1hLmpwIiwKCSJuYWthLmhpcm9zaGltYS5qcCIsCgkib25vbWljaGkuaGlyb3NoaW1hLmpwIiwKCSJvc2FraWthbWlqaW1hLmhpcm9zaGltYS5qcCIsCgkib3Rha2UuaGlyb3NoaW1hLmpwIiwKCSJzYWthLmhpcm9zaGltYS5qcCIsCgkic2VyYS5oaXJvc2hpbWEuanAiLAoJInNlcmFuaXNoaS5oaXJvc2hpbWEuanAiLAoJInNoaW5pY2hpLmhpcm9zaGltYS5qcCIsCgkic2hvYmFyYS5oaXJvc2hpbWEuanAiLAoJInRha2VoYXJhLmhpcm9zaGltYS5qcCIsCgkiYWJhc2hpcmkuaG9ra2FpZG8uanAiLAoJImFiaXJhLmhva2thaWRvLmpwIiwKCSJhaWJldHN1Lmhva2thaWRvLmpwIiwKCSJha2FiaXJhLmhva2thaWRvLmpwIiwKCSJha2tlc2hpLmhva2thaWRvLmpwIiwKCSJhc2FoaWthd2EuaG9ra2FpZG8uanAiLAoJImFzaGliZXRzdS5ob2trYWlkby5qcCIsCgkiYXNob3JvLmhva2thaWRvLmpwIiwKCSJhc3NhYnUuaG9ra2FpZG8uanAiLAoJImF0c3VtYS5ob2trYWlkby5qcCIsCgkiYmliYWkuaG9ra2FpZG8uanAiLAoJImJpZWkuaG9ra2FpZG8uanAiLAoJImJpZnVrYS5ob2trYWlkby5qcCIsCgkiYmlob3JvLmhva2thaWRvLmpwIiwKCSJiaXJhdG9yaS5ob2trYWlkby5qcCIsCgkiY2hpcHB1YmV0c3UuaG9ra2FpZG8uanAiLAoJImNoaXRvc2UuaG9ra2FpZG8uanAiLAoJImRhdGUuaG9ra2FpZG8uanAiLAoJImViZXRzdS5ob2trYWlkby5qcCIsCgkiZW1iZXRzdS5ob2trYWlkby5qcCIsCgkiZW5pd2EuaG9ra2FpZG8uanAiLAoJImVyaW1vLmhva2thaWRvLmpwIiwKCSJlc2FuLmhva2thaWRvLmpwIiwKCSJlc2FzaGkuaG9ra2FpZG8uanAiLAoJImZ1a2FnYXdhLmhva2thaWRvLmpwIiwKCSJmdWt1c2hpbWEuaG9ra2FpZG8uanAiLAoJImZ1cmFuby5ob2trYWlkby5qcCIsCgkiZnVydWJpcmEuaG9ra2FpZG8uanAiLAoJImhhYm9yby5ob2trYWlkby5qcCIsCgkiaGFrb2RhdGUuaG9ra2FpZG8uanAiLAoJImhhbWF0b25iZXRzdS5ob2trYWlkby5qcCIsCgkiaGlkYWthLmhva2thaWRvLmpwIiwKCSJoaWdhc2hpa2FndXJhLmhva2thaWRvLmpwIiwKCSJoaWdhc2hpa2F3YS5ob2trYWlkby5qcCIsCgkiaGlyb28uaG9ra2FpZG8uanAiLAoJImhva3VyeXUuaG9ra2FpZG8uanAiLAoJImhva3V0by5ob2trYWlkby5qcCIsCgkiaG9uYmV0c3UuaG9ra2FpZG8uanAiLAoJImhvcm9rYW5haS5ob2trYWlkby5qcCIsCgkiaG9yb25vYmUuaG9ra2FpZG8uanAiLAoJImlrZWRhLmhva2thaWRvLmpwIiwKCSJpbWFrYW5lLmhva2thaWRvLmpwIiwKCSJpc2hpa2FyaS5ob2trYWlkby5qcCIsCgkiaXdhbWl6YXdhLmhva2thaWRvLmpwIiwKCSJpd2FuYWkuaG9ra2FpZG8uanAiLAoJImthbWlmdXJhbm8uaG9ra2FpZG8uanAiLAoJImthbWlrYXdhLmhva2thaWRvLmpwIiwKCSJrYW1pc2hpaG9yby5ob2trYWlkby5qcCIsCgkia2FtaXN1bmFnYXdhLmhva2thaWRvLmpwIiwKCSJrYW1vZW5haS5ob2trYWlkby5qcCIsCgkia2F5YWJlLmhva2thaWRvLmpwIiwKCSJrZW1idWNoaS5ob2trYWlkby5qcCIsCgkia2lrb25haS5ob2trYWlkby5qcCIsCgkia2ltb2JldHN1Lmhva2thaWRvLmpwIiwKCSJraXRhaGlyb3NoaW1hLmhva2thaWRvLmpwIiwKCSJraXRhbWkuaG9ra2FpZG8uanAiLAoJImtpeW9zYXRvLmhva2thaWRvLmpwIiwKCSJrb3NoaW1penUuaG9ra2FpZG8uanAiLAoJImt1bm5lcHB1Lmhva2thaWRvLmpwIiwKCSJrdXJpeWFtYS5ob2trYWlkby5qcCIsCgkia3Vyb21hdHN1bmFpLmhva2thaWRvLmpwIiwKCSJrdXNoaXJvLmhva2thaWRvLmpwIiwKCSJrdXRjaGFuLmhva2thaWRvLmpwIiwKCSJreW93YS5ob2trYWlkby5qcCIsCgkibWFzaGlrZS5ob2trYWlkby5qcCIsCgkibWF0c3VtYWUuaG9ra2FpZG8uanAiLAoJIm1pa2FzYS5ob2trYWlkby5qcCIsCgkibWluYW1pZnVyYW5vLmhva2thaWRvLmpwIiwKCSJtb21iZXRzdS5ob2trYWlkby5qcCIsCgkibW9zZXVzaGkuaG9ra2FpZG8uanAiLAoJIm11a2F3YS5ob2trYWlkby5qcCIsCgkibXVyb3Jhbi5ob2trYWlkby5qcCIsCgkibmFpZS5ob2trYWlkby5qcCIsCgkibmFrYWdhd2EuaG9ra2FpZG8uanAiLAoJIm5ha2FzYXRzdW5haS5ob2trYWlkby5qcCIsCgkibmFrYXRvbWJldHN1Lmhva2thaWRvLmpwIiwKCSJuYW5hZS5ob2trYWlkby5qcCIsCgkibmFucG9yby5ob2trYWlkby5qcCIsCgkibmF5b3JvLmhva2thaWRvLmpwIiwKCSJuZW11cm8uaG9ra2FpZG8uanAiLAoJIm5paWthcHB1Lmhva2thaWRvLmpwIiwKCSJuaWtpLmhva2thaWRvLmpwIiwKCSJuaXNoaW9rb3BwZS5ob2trYWlkby5qcCIsCgkibm9ib3JpYmV0c3UuaG9ra2FpZG8uanAiLAoJIm51bWF0YS5ob2trYWlkby5qcCIsCgkib2JpaGlyby5ob2trYWlkby5qcCIsCgkib2JpcmEuaG9ra2FpZG8uanAiLAoJIm9rZXRvLmhva2thaWRvLmpwIiwKCSJva29wcGUuaG9ra2FpZG8uanAiLAoJIm90YXJ1Lmhva2thaWRvLmpwIiwKCSJvdG9iZS5ob2trYWlkby5qcCIsCgkib3RvZnVrZS5ob2trYWlkby5qcCIsCgkib3RvaW5lcHB1Lmhva2thaWRvLmpwIiwKCSJvdW11Lmhva2thaWRvLmpwIiwKCSJvem9yYS5ob2trYWlkby5qcCIsCgkicGlwcHUuaG9ra2FpZG8uanAiLAoJInJhbmtvc2hpLmhva2thaWRvLmpwIiwKCSJyZWJ1bi5ob2trYWlkby5qcCIsCgkicmlrdWJldHN1Lmhva2thaWRvLmpwIiwKCSJyaXNoaXJpLmhva2thaWRvLmpwIiwKCSJyaXNoaXJpZnVqaS5ob2trYWlkby5qcCIsCgkic2Fyb21hLmhva2thaWRvLmpwIiwKCSJzYXJ1ZnV0c3UuaG9ra2FpZG8uanAiLAoJInNoYWtvdGFuLmhva2thaWRvLmpwIiwKCSJzaGFyaS5ob2trYWlkby5qcCIsCgkic2hpYmVjaGEuaG9ra2FpZG8uanAiLAoJInNoaWJldHN1Lmhva2thaWRvLmpwIiwKCSJzaGlrYWJlLmhva2thaWRvLmpwIiwKCSJzaGlrYW9pLmhva2thaWRvLmpwIiwKCSJzaGltYW1ha2kuaG9ra2FpZG8uanAiLAoJInNoaW1penUuaG9ra2FpZG8uanAiLAoJInNoaW1va2F3YS5ob2trYWlkby5qcCIsCgkic2hpbnNoaW5vdHN1Lmhva2thaWRvLmpwIiwKCSJzaGludG9rdS5ob2trYWlkby5qcCIsCgkic2hpcmFudWthLmhva2thaWRvLmpwIiwKCSJzaGlyYW9pLmhva2thaWRvLmpwIiwKCSJzaGlyaXVjaGkuaG9ra2FpZG8uanAiLAoJInNvYmV0c3UuaG9ra2FpZG8uanAiLAoJInN1bmFnYXdhLmhva2thaWRvLmpwIiwKCSJ0YWlraS5ob2trYWlkby5qcCIsCgkidGFrYXN1Lmhva2thaWRvLmpwIiwKCSJ0YWtpa2F3YS5ob2trYWlkby5qcCIsCgkidGFraW5vdWUuaG9ra2FpZG8uanAiLAoJInRlc2hpa2FnYS5ob2trYWlkby5qcCIsCgkidG9iZXRzdS5ob2trYWlkby5qcCIsCgkidG9obWEuaG9ra2FpZG8uanAiLAoJInRvbWFrb21haS5ob2trYWlkby5qcCIsCgkidG9tYXJpLmhva2thaWRvLmpwIiwKCSJ0b3lhLmhva2thaWRvLmpwIiwKCSJ0b3lha28uaG9ra2FpZG8uanAiLAoJInRveW90b21pLmhva2thaWRvLmpwIiwKCSJ0b3lvdXJhLmhva2thaWRvLmpwIiwKCSJ0c3ViZXRzdS5ob2trYWlkby5qcCIsCgkidHN1a2lnYXRhLmhva2thaWRvLmpwIiwKCSJ1cmFrYXdhLmhva2thaWRvLmpwIiwKCSJ1cmF1c3UuaG9ra2FpZG8uanAiLAoJInVyeXUuaG9ra2FpZG8uanAiLAoJInV0YXNoaW5haS5ob2trYWlkby5qcCIsCgkid2Fra2FuYWkuaG9ra2FpZG8uanAiLAoJIndhc3NhbXUuaG9ra2FpZG8uanAiLAoJInlha3Vtby5ob2trYWlkby5qcCIsCgkieW9pY2hpLmhva2thaWRvLmpwIiwKCSJhaW9pLmh5b2dvLmpwIiwKCSJha2FzaGkuaHlvZ28uanAiLAoJImFrby5oeW9nby5qcCIsCgkiYW1hZ2FzYWtpLmh5b2dvLmpwIiwKCSJhb2dha2kuaHlvZ28uanAiLAoJImFzYWdvLmh5b2dvLmpwIiwKCSJhc2hpeWEuaHlvZ28uanAiLAoJImF3YWppLmh5b2dvLmpwIiwKCSJmdWt1c2FraS5oeW9nby5qcCIsCgkiZ29zaGlraS5oeW9nby5qcCIsCgkiaGFyaW1hLmh5b2dvLmpwIiwKCSJoaW1lamkuaHlvZ28uanAiLAoJImljaGlrYXdhLmh5b2dvLmpwIiwKCSJpbmFnYXdhLmh5b2dvLmpwIiwKCSJpdGFtaS5oeW9nby5qcCIsCgkia2Frb2dhd2EuaHlvZ28uanAiLAoJImthbWlnb3JpLmh5b2dvLmpwIiwKCSJrYW1pa2F3YS5oeW9nby5qcCIsCgkia2FzYWkuaHlvZ28uanAiLAoJImthc3VnYS5oeW9nby5qcCIsCgkia2F3YW5pc2hpLmh5b2dvLmpwIiwKCSJtaWtpLmh5b2dvLmpwIiwKCSJtaW5hbWlhd2FqaS5oeW9nby5qcCIsCgkibmlzaGlub21peWEuaHlvZ28uanAiLAoJIm5pc2hpd2FraS5oeW9nby5qcCIsCgkib25vLmh5b2dvLmpwIiwKCSJzYW5kYS5oeW9nby5qcCIsCgkic2FubmFuLmh5b2dvLmpwIiwKCSJzYXNheWFtYS5oeW9nby5qcCIsCgkic2F5by5oeW9nby5qcCIsCgkic2hpbmd1Lmh5b2dvLmpwIiwKCSJzaGlub25zZW4uaHlvZ28uanAiLAoJInNoaXNvLmh5b2dvLmpwIiwKCSJzdW1vdG8uaHlvZ28uanAiLAoJInRhaXNoaS5oeW9nby5qcCIsCgkidGFrYS5oeW9nby5qcCIsCgkidGFrYXJhenVrYS5oeW9nby5qcCIsCgkidGFrYXNhZ28uaHlvZ28uanAiLAoJInRha2luby5oeW9nby5qcCIsCgkidGFtYmEuaHlvZ28uanAiLAoJInRhdHN1bm8uaHlvZ28uanAiLAoJInRveW9va2EuaHlvZ28uanAiLAoJInlhYnUuaHlvZ28uanAiLAoJInlhc2hpcm8uaHlvZ28uanAiLAoJInlva2EuaHlvZ28uanAiLAoJInlva2F3YS5oeW9nby5qcCIsCgkiYW1pLmliYXJha2kuanAiLAoJImFzYWhpLmliYXJha2kuanAiLAoJImJhbmRvLmliYXJha2kuanAiLAoJImNoaWt1c2VpLmliYXJha2kuanAiLAoJImRhaWdvLmliYXJha2kuanAiLAoJImZ1amlzaGlyby5pYmFyYWtpLmpwIiwKCSJoaXRhY2hpLmliYXJha2kuanAiLAoJImhpdGFjaGluYWthLmliYXJha2kuanAiLAoJImhpdGFjaGlvbWl5YS5pYmFyYWtpLmpwIiwKCSJoaXRhY2hpb3RhLmliYXJha2kuanAiLAoJImliYXJha2kuaWJhcmFraS5qcCIsCgkiaW5hLmliYXJha2kuanAiLAoJImluYXNoaWtpLmliYXJha2kuanAiLAoJIml0YWtvLmliYXJha2kuanAiLAoJIml3YW1hLmliYXJha2kuanAiLAoJImpvc28uaWJhcmFraS5qcCIsCgkia2FtaXN1LmliYXJha2kuanAiLAoJImthc2FtYS5pYmFyYWtpLmpwIiwKCSJrYXNoaW1hLmliYXJha2kuanAiLAoJImthc3VtaWdhdXJhLmliYXJha2kuanAiLAoJImtvZ2EuaWJhcmFraS5qcCIsCgkibWloby5pYmFyYWtpLmpwIiwKCSJtaXRvLmliYXJha2kuanAiLAoJIm1vcml5YS5pYmFyYWtpLmpwIiwKCSJuYWthLmliYXJha2kuanAiLAoJIm5hbWVnYXRhLmliYXJha2kuanAiLAoJIm9hcmFpLmliYXJha2kuanAiLAoJIm9nYXdhLmliYXJha2kuanAiLAoJIm9taXRhbWEuaWJhcmFraS5qcCIsCgkicnl1Z2FzYWtpLmliYXJha2kuanAiLAoJInNha2FpLmliYXJha2kuanAiLAoJInNha3VyYWdhd2EuaWJhcmFraS5qcCIsCgkic2hpbW9kYXRlLmliYXJha2kuanAiLAoJInNoaW1vdHN1bWEuaWJhcmFraS5qcCIsCgkic2hpcm9zYXRvLmliYXJha2kuanAiLAoJInNvd2EuaWJhcmFraS5qcCIsCgkic3VpZnUuaWJhcmFraS5qcCIsCgkidGFrYWhhZ2kuaWJhcmFraS5qcCIsCgkidGFtYXRzdWt1cmkuaWJhcmFraS5qcCIsCgkidG9rYWkuaWJhcmFraS5qcCIsCgkidG9tb2JlLmliYXJha2kuanAiLAoJInRvbmUuaWJhcmFraS5qcCIsCgkidG9yaWRlLmliYXJha2kuanAiLAoJInRzdWNoaXVyYS5pYmFyYWtpLmpwIiwKCSJ0c3VrdWJhLmliYXJha2kuanAiLAoJInVjaGloYXJhLmliYXJha2kuanAiLAoJInVzaGlrdS5pYmFyYWtpLmpwIiwKCSJ5YWNoaXlvLmliYXJha2kuanAiLAoJInlhbWFnYXRhLmliYXJha2kuanAiLAoJInlhd2FyYS5pYmFyYWtpLmpwIiwKCSJ5dWtpLmliYXJha2kuanAiLAoJImFuYW1penUuaXNoaWthd2EuanAiLAoJImhha3VpLmlzaGlrYXdhLmpwIiwKCSJoYWt1c2FuLmlzaGlrYXdhLmpwIiwKCSJrYWdhLmlzaGlrYXdhLmpwIiwKCSJrYWhva3UuaXNoaWthd2EuanAiLAoJImthbmF6YXdhLmlzaGlrYXdhLmpwIiwKCSJrYXdha2l0YS5pc2hpa2F3YS5qcCIsCgkia29tYXRzdS5pc2hpa2F3YS5qcCIsCgkibmFrYW5vdG8uaXNoaWthd2EuanAiLAoJIm5hbmFvLmlzaGlrYXdhLmpwIiwKCSJub21pLmlzaGlrYXdhLmpwIiwKCSJub25vaWNoaS5pc2hpa2F3YS5qcCIsCgkibm90by5pc2hpa2F3YS5qcCIsCgkic2hpa2EuaXNoaWthd2EuanAiLAoJInN1enUuaXNoaWthd2EuanAiLAoJInRzdWJhdGEuaXNoaWthd2EuanAiLAoJInRzdXJ1Z2kuaXNoaWthd2EuanAiLAoJInVjaGluYWRhLmlzaGlrYXdhLmpwIiwKCSJ3YWppbWEuaXNoaWthd2EuanAiLAoJImZ1ZGFpLml3YXRlLmpwIiwKCSJmdWppc2F3YS5pd2F0ZS5qcCIsCgkiaGFuYW1ha2kuaXdhdGUuanAiLAoJImhpcmFpenVtaS5pd2F0ZS5qcCIsCgkiaGlyb25vLml3YXRlLmpwIiwKCSJpY2hpbm9oZS5pd2F0ZS5qcCIsCgkiaWNoaW5vc2VraS5pd2F0ZS5qcCIsCgkiaXdhaXp1bWkuaXdhdGUuanAiLAoJIml3YXRlLml3YXRlLmpwIiwKCSJqb2JvamkuaXdhdGUuanAiLAoJImthbWFpc2hpLml3YXRlLmpwIiwKCSJrYW5lZ2FzYWtpLml3YXRlLmpwIiwKCSJrYXJ1bWFpLml3YXRlLmpwIiwKCSJrYXdhaS5pd2F0ZS5qcCIsCgkia2l0YWthbWkuaXdhdGUuanAiLAoJImt1amkuaXdhdGUuanAiLAoJImt1bm9oZS5pd2F0ZS5qcCIsCgkia3V6dW1ha2kuaXdhdGUuanAiLAoJIm1peWFrby5pd2F0ZS5qcCIsCgkibWl6dXNhd2EuaXdhdGUuanAiLAoJIm1vcmlva2EuaXdhdGUuanAiLAoJIm5pbm9oZS5pd2F0ZS5qcCIsCgkibm9kYS5pd2F0ZS5qcCIsCgkib2Z1bmF0by5pd2F0ZS5qcCIsCgkib3NodS5pd2F0ZS5qcCIsCgkib3RzdWNoaS5pd2F0ZS5qcCIsCgkicmlrdXplbnRha2F0YS5pd2F0ZS5qcCIsCgkic2hpd2EuaXdhdGUuanAiLAoJInNoaXp1a3Vpc2hpLml3YXRlLmpwIiwKCSJzdW1pdGEuaXdhdGUuanAiLAoJInRhbm9oYXRhLml3YXRlLmpwIiwKCSJ0b25vLml3YXRlLmpwIiwKCSJ5YWhhYmEuaXdhdGUuanAiLAoJInlhbWFkYS5pd2F0ZS5qcCIsCgkiYXlhZ2F3YS5rYWdhd2EuanAiLAoJImhpZ2FzaGlrYWdhd2Eua2FnYXdhLmpwIiwKCSJrYW5vbmppLmthZ2F3YS5qcCIsCgkia290b2hpcmEua2FnYXdhLmpwIiwKCSJtYW5uby5rYWdhd2EuanAiLAoJIm1hcnVnYW1lLmthZ2F3YS5qcCIsCgkibWl0b3lvLmthZ2F3YS5qcCIsCgkibmFvc2hpbWEua2FnYXdhLmpwIiwKCSJzYW51a2kua2FnYXdhLmpwIiwKCSJ0YWRvdHN1LmthZ2F3YS5qcCIsCgkidGFrYW1hdHN1LmthZ2F3YS5qcCIsCgkidG9ub3Noby5rYWdhd2EuanAiLAoJInVjaGlub21pLmthZ2F3YS5qcCIsCgkidXRhenUua2FnYXdhLmpwIiwKCSJ6ZW50c3VqaS5rYWdhd2EuanAiLAoJImFrdW5lLmthZ29zaGltYS5qcCIsCgkiYW1hbWkua2Fnb3NoaW1hLmpwIiwKCSJoaW9raS5rYWdvc2hpbWEuanAiLAoJImlzYS5rYWdvc2hpbWEuanAiLAoJImlzZW4ua2Fnb3NoaW1hLmpwIiwKCSJpenVtaS5rYWdvc2hpbWEuanAiLAoJImthZ29zaGltYS5rYWdvc2hpbWEuanAiLAoJImthbm95YS5rYWdvc2hpbWEuanAiLAoJImthd2FuYWJlLmthZ29zaGltYS5qcCIsCgkia2lua28ua2Fnb3NoaW1hLmpwIiwKCSJrb3V5YW1hLmthZ29zaGltYS5qcCIsCgkibWFrdXJhemFraS5rYWdvc2hpbWEuanAiLAoJIm1hdHN1bW90by5rYWdvc2hpbWEuanAiLAoJIm1pbmFtaXRhbmUua2Fnb3NoaW1hLmpwIiwKCSJuYWthdGFuZS5rYWdvc2hpbWEuanAiLAoJIm5pc2hpbm9vbW90ZS5rYWdvc2hpbWEuanAiLAoJInNhdHN1bWFzZW5kYWkua2Fnb3NoaW1hLmpwIiwKCSJzb28ua2Fnb3NoaW1hLmpwIiwKCSJ0YXJ1bWl6dS5rYWdvc2hpbWEuanAiLAoJInl1c3VpLmthZ29zaGltYS5qcCIsCgkiYWlrYXdhLmthbmFnYXdhLmpwIiwKCSJhdHN1Z2kua2FuYWdhd2EuanAiLAoJImF5YXNlLmthbmFnYXdhLmpwIiwKCSJjaGlnYXNha2kua2FuYWdhd2EuanAiLAoJImViaW5hLmthbmFnYXdhLmpwIiwKCSJmdWppc2F3YS5rYW5hZ2F3YS5qcCIsCgkiaGFkYW5vLmthbmFnYXdhLmpwIiwKCSJoYWtvbmUua2FuYWdhd2EuanAiLAoJImhpcmF0c3VrYS5rYW5hZ2F3YS5qcCIsCgkiaXNlaGFyYS5rYW5hZ2F3YS5qcCIsCgkia2Fpc2VpLmthbmFnYXdhLmpwIiwKCSJrYW1ha3VyYS5rYW5hZ2F3YS5qcCIsCgkia2l5b2thd2Eua2FuYWdhd2EuanAiLAoJIm1hdHN1ZGEua2FuYWdhd2EuanAiLAoJIm1pbmFtaWFzaGlnYXJhLmthbmFnYXdhLmpwIiwKCSJtaXVyYS5rYW5hZ2F3YS5qcCIsCgkibmFrYWkua2FuYWdhd2EuanAiLAoJIm5pbm9taXlhLmthbmFnYXdhLmpwIiwKCSJvZGF3YXJhLmthbmFnYXdhLmpwIiwKCSJvaS5rYW5hZ2F3YS5qcCIsCgkib2lzby5rYW5hZ2F3YS5qcCIsCgkic2FnYW1paGFyYS5rYW5hZ2F3YS5qcCIsCgkic2FtdWthd2Eua2FuYWdhd2EuanAiLAoJInRzdWt1aS5rYW5hZ2F3YS5qcCIsCgkieWFtYWtpdGEua2FuYWdhd2EuanAiLAoJInlhbWF0by5rYW5hZ2F3YS5qcCIsCgkieW9rb3N1a2Eua2FuYWdhd2EuanAiLAoJInl1Z2F3YXJhLmthbmFnYXdhLmpwIiwKCSJ6YW1hLmthbmFnYXdhLmpwIiwKCSJ6dXNoaS5rYW5hZ2F3YS5qcCIsCgkiYWtpLmtvY2hpLmpwIiwKCSJnZWlzZWkua29jaGkuanAiLAoJImhpZGFrYS5rb2NoaS5qcCIsCgkiaGlnYXNoaXRzdW5vLmtvY2hpLmpwIiwKCSJpbm8ua29jaGkuanAiLAoJImthZ2FtaS5rb2NoaS5qcCIsCgkia2FtaS5rb2NoaS5qcCIsCgkia2l0YWdhd2Eua29jaGkuanAiLAoJImtvY2hpLmtvY2hpLmpwIiwKCSJtaWhhcmEua29jaGkuanAiLAoJIm1vdG95YW1hLmtvY2hpLmpwIiwKCSJtdXJvdG8ua29jaGkuanAiLAoJIm5haGFyaS5rb2NoaS5qcCIsCgkibmFrYW11cmEua29jaGkuanAiLAoJIm5hbmtva3Uua29jaGkuanAiLAoJIm5pc2hpdG9zYS5rb2NoaS5qcCIsCgkibml5b2RvZ2F3YS5rb2NoaS5qcCIsCgkib2NoaS5rb2NoaS5qcCIsCgkib2thd2Eua29jaGkuanAiLAoJIm90b3lvLmtvY2hpLmpwIiwKCSJvdHN1a2kua29jaGkuanAiLAoJInNha2F3YS5rb2NoaS5qcCIsCgkic3VrdW1vLmtvY2hpLmpwIiwKCSJzdXNha2kua29jaGkuanAiLAoJInRvc2Eua29jaGkuanAiLAoJInRvc2FzaGltaXp1LmtvY2hpLmpwIiwKCSJ0b3lvLmtvY2hpLmpwIiwKCSJ0c3Vuby5rb2NoaS5qcCIsCgkidW1hamkua29jaGkuanAiLAoJInlhc3VkYS5rb2NoaS5qcCIsCgkieXVzdWhhcmEua29jaGkuanAiLAoJImFtYWt1c2Eua3VtYW1vdG8uanAiLAoJImFyYW8ua3VtYW1vdG8uanAiLAoJImFzby5rdW1hbW90by5qcCIsCgkiY2hveW8ua3VtYW1vdG8uanAiLAoJImd5b2t1dG8ua3VtYW1vdG8uanAiLAoJImthbWlhbWFrdXNhLmt1bWFtb3RvLmpwIiwKCSJraWt1Y2hpLmt1bWFtb3RvLmpwIiwKCSJrdW1hbW90by5rdW1hbW90by5qcCIsCgkibWFzaGlraS5rdW1hbW90by5qcCIsCgkibWlmdW5lLmt1bWFtb3RvLmpwIiwKCSJtaW5hbWF0YS5rdW1hbW90by5qcCIsCgkibWluYW1pb2d1bmkua3VtYW1vdG8uanAiLAoJIm5hZ2FzdS5rdW1hbW90by5qcCIsCgkibmlzaGloYXJhLmt1bWFtb3RvLmpwIiwKCSJvZ3VuaS5rdW1hbW90by5qcCIsCgkib3p1Lmt1bWFtb3RvLmpwIiwKCSJzdW1vdG8ua3VtYW1vdG8uanAiLAoJInRha2Ftb3JpLmt1bWFtb3RvLmpwIiwKCSJ1a2kua3VtYW1vdG8uanAiLAoJInV0by5rdW1hbW90by5qcCIsCgkieWFtYWdhLmt1bWFtb3RvLmpwIiwKCSJ5YW1hdG8ua3VtYW1vdG8uanAiLAoJInlhdHN1c2hpcm8ua3VtYW1vdG8uanAiLAoJImF5YWJlLmt5b3RvLmpwIiwKCSJmdWt1Y2hpeWFtYS5reW90by5qcCIsCgkiaGlnYXNoaXlhbWEua3lvdG8uanAiLAoJImlkZS5reW90by5qcCIsCgkiaW5lLmt5b3RvLmpwIiwKCSJqb3lvLmt5b3RvLmpwIiwKCSJrYW1lb2thLmt5b3RvLmpwIiwKCSJrYW1vLmt5b3RvLmpwIiwKCSJraXRhLmt5b3RvLmpwIiwKCSJraXp1Lmt5b3RvLmpwIiwKCSJrdW1peWFtYS5reW90by5qcCIsCgkia3lvdGFtYmEua3lvdG8uanAiLAoJImt5b3RhbmFiZS5reW90by5qcCIsCgkia3lvdGFuZ28ua3lvdG8uanAiLAoJIm1haXp1cnUua3lvdG8uanAiLAoJIm1pbmFtaS5reW90by5qcCIsCgkibWluYW1peWFtYXNoaXJvLmt5b3RvLmpwIiwKCSJtaXlhenUua3lvdG8uanAiLAoJIm11a28ua3lvdG8uanAiLAoJIm5hZ2Fva2FreW8ua3lvdG8uanAiLAoJIm5ha2FneW8ua3lvdG8uanAiLAoJIm5hbnRhbi5reW90by5qcCIsCgkib3lhbWF6YWtpLmt5b3RvLmpwIiwKCSJzYWt5by5reW90by5qcCIsCgkic2Vpa2Eua3lvdG8uanAiLAoJInRhbmFiZS5reW90by5qcCIsCgkidWppLmt5b3RvLmpwIiwKCSJ1aml0YXdhcmEua3lvdG8uanAiLAoJIndhenVrYS5reW90by5qcCIsCgkieWFtYXNoaW5hLmt5b3RvLmpwIiwKCSJ5YXdhdGEua3lvdG8uanAiLAoJImFzYWhpLm1pZS5qcCIsCgkiaW5hYmUubWllLmpwIiwKCSJpc2UubWllLmpwIiwKCSJrYW1leWFtYS5taWUuanAiLAoJImthd2Fnb2UubWllLmpwIiwKCSJraWhvLm1pZS5qcCIsCgkia2lzb3Nha2kubWllLmpwIiwKCSJraXdhLm1pZS5qcCIsCgkia29tb25vLm1pZS5qcCIsCgkia3VtYW5vLm1pZS5qcCIsCgkia3V3YW5hLm1pZS5qcCIsCgkibWF0c3VzYWthLm1pZS5qcCIsCgkibWVpd2EubWllLmpwIiwKCSJtaWhhbWEubWllLmpwIiwKCSJtaW5hbWlpc2UubWllLmpwIiwKCSJtaXN1Z2kubWllLmpwIiwKCSJtaXlhbWEubWllLmpwIiwKCSJuYWJhcmkubWllLmpwIiwKCSJzaGltYS5taWUuanAiLAoJInN1enVrYS5taWUuanAiLAoJInRhZG8ubWllLmpwIiwKCSJ0YWlraS5taWUuanAiLAoJInRha2kubWllLmpwIiwKCSJ0YW1ha2kubWllLmpwIiwKCSJ0b2JhLm1pZS5qcCIsCgkidHN1Lm1pZS5qcCIsCgkidWRvbm8ubWllLmpwIiwKCSJ1cmVzaGluby5taWUuanAiLAoJIndhdGFyYWkubWllLmpwIiwKCSJ5b2trYWljaGkubWllLmpwIiwKCSJmdXJ1a2F3YS5taXlhZ2kuanAiLAoJImhpZ2FzaGltYXRzdXNoaW1hLm1peWFnaS5qcCIsCgkiaXNoaW5vbWFraS5taXlhZ2kuanAiLAoJIml3YW51bWEubWl5YWdpLmpwIiwKCSJrYWt1ZGEubWl5YWdpLmpwIiwKCSJrYW1pLm1peWFnaS5qcCIsCgkia2F3YXNha2kubWl5YWdpLmpwIiwKCSJtYXJ1bW9yaS5taXlhZ2kuanAiLAoJIm1hdHN1c2hpbWEubWl5YWdpLmpwIiwKCSJtaW5hbWlzYW5yaWt1Lm1peWFnaS5qcCIsCgkibWlzYXRvLm1peWFnaS5qcCIsCgkibXVyYXRhLm1peWFnaS5qcCIsCgkibmF0b3JpLm1peWFnaS5qcCIsCgkib2dhd2FyYS5taXlhZ2kuanAiLAoJIm9oaXJhLm1peWFnaS5qcCIsCgkib25hZ2F3YS5taXlhZ2kuanAiLAoJIm9zYWtpLm1peWFnaS5qcCIsCgkicmlmdS5taXlhZ2kuanAiLAoJInNlbWluZS5taXlhZ2kuanAiLAoJInNoaWJhdGEubWl5YWdpLmpwIiwKCSJzaGljaGlrYXNodWt1Lm1peWFnaS5qcCIsCgkic2hpa2FtYS5taXlhZ2kuanAiLAoJInNoaW9nYW1hLm1peWFnaS5qcCIsCgkic2hpcm9pc2hpLm1peWFnaS5qcCIsCgkidGFnYWpvLm1peWFnaS5qcCIsCgkidGFpd2EubWl5YWdpLmpwIiwKCSJ0b21lLm1peWFnaS5qcCIsCgkidG9taXlhLm1peWFnaS5qcCIsCgkid2FrdXlhLm1peWFnaS5qcCIsCgkid2F0YXJpLm1peWFnaS5qcCIsCgkieWFtYW1vdG8ubWl5YWdpLmpwIiwKCSJ6YW8ubWl5YWdpLmpwIiwKCSJheWEubWl5YXpha2kuanAiLAoJImViaW5vLm1peWF6YWtpLmpwIiwKCSJnb2thc2UubWl5YXpha2kuanAiLAoJImh5dWdhLm1peWF6YWtpLmpwIiwKCSJrYWRvZ2F3YS5taXlhemFraS5qcCIsCgkia2F3YW1pbmFtaS5taXlhemFraS5qcCIsCgkia2lqby5taXlhemFraS5qcCIsCgkia2l0YWdhd2EubWl5YXpha2kuanAiLAoJImtpdGFrYXRhLm1peWF6YWtpLmpwIiwKCSJraXRhdXJhLm1peWF6YWtpLmpwIiwKCSJrb2JheWFzaGkubWl5YXpha2kuanAiLAoJImt1bml0b21pLm1peWF6YWtpLmpwIiwKCSJrdXNoaW1hLm1peWF6YWtpLmpwIiwKCSJtaW1hdGEubWl5YXpha2kuanAiLAoJIm1peWFrb25vam8ubWl5YXpha2kuanAiLAoJIm1peWF6YWtpLm1peWF6YWtpLmpwIiwKCSJtb3JvdHN1a2EubWl5YXpha2kuanAiLAoJIm5pY2hpbmFuLm1peWF6YWtpLmpwIiwKCSJuaXNoaW1lcmEubWl5YXpha2kuanAiLAoJIm5vYmVva2EubWl5YXpha2kuanAiLAoJInNhaXRvLm1peWF6YWtpLmpwIiwKCSJzaGlpYmEubWl5YXpha2kuanAiLAoJInNoaW50b21pLm1peWF6YWtpLmpwIiwKCSJ0YWthaGFydS5taXlhemFraS5qcCIsCgkidGFrYW5hYmUubWl5YXpha2kuanAiLAoJInRha2F6YWtpLm1peWF6YWtpLmpwIiwKCSJ0c3Vuby5taXlhemFraS5qcCIsCgkiYWNoaS5uYWdhbm8uanAiLAoJImFnZW1hdHN1Lm5hZ2Fuby5qcCIsCgkiYW5hbi5uYWdhbm8uanAiLAoJImFva2kubmFnYW5vLmpwIiwKCSJhc2FoaS5uYWdhbm8uanAiLAoJImF6dW1pbm8ubmFnYW5vLmpwIiwKCSJjaGlrdWhva3UubmFnYW5vLmpwIiwKCSJjaGlrdW1hLm5hZ2Fuby5qcCIsCgkiY2hpbm8ubmFnYW5vLmpwIiwKCSJmdWppbWkubmFnYW5vLmpwIiwKCSJoYWt1YmEubmFnYW5vLmpwIiwKCSJoYXJhLm5hZ2Fuby5qcCIsCgkiaGlyYXlhLm5hZ2Fuby5qcCIsCgkiaWlkYS5uYWdhbm8uanAiLAoJImlpamltYS5uYWdhbm8uanAiLAoJImlpeWFtYS5uYWdhbm8uanAiLAoJImlpenVuYS5uYWdhbm8uanAiLAoJImlrZWRhLm5hZ2Fuby5qcCIsCgkiaWt1c2FrYS5uYWdhbm8uanAiLAoJImluYS5uYWdhbm8uanAiLAoJImthcnVpemF3YS5uYWdhbm8uanAiLAoJImthd2FrYW1pLm5hZ2Fuby5qcCIsCgkia2lzby5uYWdhbm8uanAiLAoJImtpc29mdWt1c2hpbWEubmFnYW5vLmpwIiwKCSJraXRhYWlraS5uYWdhbm8uanAiLAoJImtvbWFnYW5lLm5hZ2Fuby5qcCIsCgkia29tb3JvLm5hZ2Fuby5qcCIsCgkibWF0c3VrYXdhLm5hZ2Fuby5qcCIsCgkibWF0c3Vtb3RvLm5hZ2Fuby5qcCIsCgkibWlhc2EubmFnYW5vLmpwIiwKCSJtaW5hbWlhaWtpLm5hZ2Fuby5qcCIsCgkibWluYW1pbWFraS5uYWdhbm8uanAiLAoJIm1pbmFtaW1pbm93YS5uYWdhbm8uanAiLAoJIm1pbm93YS5uYWdhbm8uanAiLAoJIm1peWFkYS5uYWdhbm8uanAiLAoJIm1peW90YS5uYWdhbm8uanAiLAoJIm1vY2hpenVraS5uYWdhbm8uanAiLAoJIm5hZ2Fuby5uYWdhbm8uanAiLAoJIm5hZ2F3YS5uYWdhbm8uanAiLAoJIm5hZ2lzby5uYWdhbm8uanAiLAoJIm5ha2FnYXdhLm5hZ2Fuby5qcCIsCgkibmFrYW5vLm5hZ2Fuby5qcCIsCgkibm96YXdhb25zZW4ubmFnYW5vLmpwIiwKCSJvYnVzZS5uYWdhbm8uanAiLAoJIm9nYXdhLm5hZ2Fuby5qcCIsCgkib2theWEubmFnYW5vLmpwIiwKCSJvbWFjaGkubmFnYW5vLmpwIiwKCSJvbWkubmFnYW5vLmpwIiwKCSJvb2t1d2EubmFnYW5vLmpwIiwKCSJvb3NoaWthLm5hZ2Fuby5qcCIsCgkib3Rha2kubmFnYW5vLmpwIiwKCSJvdGFyaS5uYWdhbm8uanAiLAoJInNha2FlLm5hZ2Fuby5qcCIsCgkic2FrYWtpLm5hZ2Fuby5qcCIsCgkic2FrdS5uYWdhbm8uanAiLAoJInNha3Voby5uYWdhbm8uanAiLAoJInNoaW1vc3V3YS5uYWdhbm8uanAiLAoJInNoaW5hbm9tYWNoaS5uYWdhbm8uanAiLAoJInNoaW9qaXJpLm5hZ2Fuby5qcCIsCgkic3V3YS5uYWdhbm8uanAiLAoJInN1emFrYS5uYWdhbm8uanAiLAoJInRha2FnaS5uYWdhbm8uanAiLAoJInRha2Ftb3JpLm5hZ2Fuby5qcCIsCgkidGFrYXlhbWEubmFnYW5vLmpwIiwKCSJ0YXRlc2hpbmEubmFnYW5vLmpwIiwKCSJ0YXRzdW5vLm5hZ2Fuby5qcCIsCgkidG9nYWt1c2hpLm5hZ2Fuby5qcCIsCgkidG9ndXJhLm5hZ2Fuby5qcCIsCgkidG9taS5uYWdhbm8uanAiLAoJInVlZGEubmFnYW5vLmpwIiwKCSJ3YWRhLm5hZ2Fuby5qcCIsCgkieWFtYWdhdGEubmFnYW5vLmpwIiwKCSJ5YW1hbm91Y2hpLm5hZ2Fuby5qcCIsCgkieWFzYWthLm5hZ2Fuby5qcCIsCgkieWFzdW9rYS5uYWdhbm8uanAiLAoJImNoaWppd2EubmFnYXNha2kuanAiLAoJImZ1dHN1Lm5hZ2FzYWtpLmpwIiwKCSJnb3RvLm5hZ2FzYWtpLmpwIiwKCSJoYXNhbWkubmFnYXNha2kuanAiLAoJImhpcmFkby5uYWdhc2FraS5qcCIsCgkiaWtpLm5hZ2FzYWtpLmpwIiwKCSJpc2FoYXlhLm5hZ2FzYWtpLmpwIiwKCSJrYXdhdGFuYS5uYWdhc2FraS5qcCIsCgkia3VjaGlub3RzdS5uYWdhc2FraS5qcCIsCgkibWF0c3V1cmEubmFnYXNha2kuanAiLAoJIm5hZ2FzYWtpLm5hZ2FzYWtpLmpwIiwKCSJvYmFtYS5uYWdhc2FraS5qcCIsCgkib211cmEubmFnYXNha2kuanAiLAoJIm9zZXRvLm5hZ2FzYWtpLmpwIiwKCSJzYWlrYWkubmFnYXNha2kuanAiLAoJInNhc2Viby5uYWdhc2FraS5qcCIsCgkic2VpaGkubmFnYXNha2kuanAiLAoJInNoaW1hYmFyYS5uYWdhc2FraS5qcCIsCgkic2hpbmthbWlnb3RvLm5hZ2FzYWtpLmpwIiwKCSJ0b2dpdHN1Lm5hZ2FzYWtpLmpwIiwKCSJ0c3VzaGltYS5uYWdhc2FraS5qcCIsCgkidW56ZW4ubmFnYXNha2kuanAiLAoJImFuZG8ubmFyYS5qcCIsCgkiZ29zZS5uYXJhLmpwIiwKCSJoZWd1cmkubmFyYS5qcCIsCgkiaGlnYXNoaXlvc2hpbm8ubmFyYS5qcCIsCgkiaWthcnVnYS5uYXJhLmpwIiwKCSJpa29tYS5uYXJhLmpwIiwKCSJrYW1pa2l0YXlhbWEubmFyYS5qcCIsCgkia2FubWFraS5uYXJhLmpwIiwKCSJrYXNoaWJhLm5hcmEuanAiLAoJImthc2hpaGFyYS5uYXJhLmpwIiwKCSJrYXRzdXJhZ2kubmFyYS5qcCIsCgkia2F3YWkubmFyYS5qcCIsCgkia2F3YWthbWkubmFyYS5qcCIsCgkia2F3YW5pc2hpLm5hcmEuanAiLAoJImtvcnlvLm5hcmEuanAiLAoJImt1cm90YWtpLm5hcmEuanAiLAoJIm1pdHN1ZS5uYXJhLmpwIiwKCSJtaXlha2UubmFyYS5qcCIsCgkibmFyYS5uYXJhLmpwIiwKCSJub3NlZ2F3YS5uYXJhLmpwIiwKCSJvamkubmFyYS5qcCIsCgkib3VkYS5uYXJhLmpwIiwKCSJveW9kby5uYXJhLmpwIiwKCSJzYWt1cmFpLm5hcmEuanAiLAoJInNhbmdvLm5hcmEuanAiLAoJInNoaW1vaWNoaS5uYXJhLmpwIiwKCSJzaGltb2tpdGF5YW1hLm5hcmEuanAiLAoJInNoaW5qby5uYXJhLmpwIiwKCSJzb25pLm5hcmEuanAiLAoJInRha2F0b3JpLm5hcmEuanAiLAoJInRhd2FyYW1vdG8ubmFyYS5qcCIsCgkidGVua2F3YS5uYXJhLmpwIiwKCSJ0ZW5yaS5uYXJhLmpwIiwKCSJ1ZGEubmFyYS5qcCIsCgkieWFtYXRva29yaXlhbWEubmFyYS5qcCIsCgkieWFtYXRvdGFrYWRhLm5hcmEuanAiLAoJInlhbWF6b2UubmFyYS5qcCIsCgkieW9zaGluby5uYXJhLmpwIiwKCSJhZ2EubmlpZ2F0YS5qcCIsCgkiYWdhbm8ubmlpZ2F0YS5qcCIsCgkiZ29zZW4ubmlpZ2F0YS5qcCIsCgkiaXRvaWdhd2EubmlpZ2F0YS5qcCIsCgkiaXp1bW96YWtpLm5paWdhdGEuanAiLAoJImpvZXRzdS5uaWlnYXRhLmpwIiwKCSJrYW1vLm5paWdhdGEuanAiLAoJImthcml3YS5uaWlnYXRhLmpwIiwKCSJrYXNoaXdhemFraS5uaWlnYXRhLmpwIiwKCSJtaW5hbWl1b251bWEubmlpZ2F0YS5qcCIsCgkibWl0c3VrZS5uaWlnYXRhLmpwIiwKCSJtdWlrYS5uaWlnYXRhLmpwIiwKCSJtdXJha2FtaS5uaWlnYXRhLmpwIiwKCSJteW9rby5uaWlnYXRhLmpwIiwKCSJuYWdhb2thLm5paWdhdGEuanAiLAoJIm5paWdhdGEubmlpZ2F0YS5qcCIsCgkib2ppeWEubmlpZ2F0YS5qcCIsCgkib21pLm5paWdhdGEuanAiLAoJInNhZG8ubmlpZ2F0YS5qcCIsCgkic2Fuam8ubmlpZ2F0YS5qcCIsCgkic2Vpcm8ubmlpZ2F0YS5qcCIsCgkic2Vpcm91Lm5paWdhdGEuanAiLAoJInNla2lrYXdhLm5paWdhdGEuanAiLAoJInNoaWJhdGEubmlpZ2F0YS5qcCIsCgkidGFnYW1pLm5paWdhdGEuanAiLAoJInRhaW5haS5uaWlnYXRhLmpwIiwKCSJ0b2NoaW8ubmlpZ2F0YS5qcCIsCgkidG9rYW1hY2hpLm5paWdhdGEuanAiLAoJInRzdWJhbWUubmlpZ2F0YS5qcCIsCgkidHN1bmFuLm5paWdhdGEuanAiLAoJInVvbnVtYS5uaWlnYXRhLmpwIiwKCSJ5YWhpa28ubmlpZ2F0YS5qcCIsCgkieW9pdGEubmlpZ2F0YS5qcCIsCgkieXV6YXdhLm5paWdhdGEuanAiLAoJImJlcHB1Lm9pdGEuanAiLAoJImJ1bmdvb25vLm9pdGEuanAiLAoJImJ1bmdvdGFrYWRhLm9pdGEuanAiLAoJImhhc2FtYS5vaXRhLmpwIiwKCSJoaWppLm9pdGEuanAiLAoJImhpbWVzaGltYS5vaXRhLmpwIiwKCSJoaXRhLm9pdGEuanAiLAoJImthbWl0c3VlLm9pdGEuanAiLAoJImtva29ub2Uub2l0YS5qcCIsCgkia3VqdS5vaXRhLmpwIiwKCSJrdW5pc2FraS5vaXRhLmpwIiwKCSJrdXN1Lm9pdGEuanAiLAoJIm9pdGEub2l0YS5qcCIsCgkic2Fpa2kub2l0YS5qcCIsCgkidGFrZXRhLm9pdGEuanAiLAoJInRzdWt1bWkub2l0YS5qcCIsCgkidXNhLm9pdGEuanAiLAoJInVzdWtpLm9pdGEuanAiLAoJInl1ZnUub2l0YS5qcCIsCgkiYWthaXdhLm9rYXlhbWEuanAiLAoJImFzYWt1Y2hpLm9rYXlhbWEuanAiLAoJImJpemVuLm9rYXlhbWEuanAiLAoJImhheWFzaGltYS5va2F5YW1hLmpwIiwKCSJpYmFyYS5va2F5YW1hLmpwIiwKCSJrYWdhbWluby5va2F5YW1hLmpwIiwKCSJrYXNhb2thLm9rYXlhbWEuanAiLAoJImtpYmljaHVvLm9rYXlhbWEuanAiLAoJImt1bWVuYW4ub2theWFtYS5qcCIsCgkia3VyYXNoaWtpLm9rYXlhbWEuanAiLAoJIm1hbml3YS5va2F5YW1hLmpwIiwKCSJtaXNha2kub2theWFtYS5qcCIsCgkibmFnaS5va2F5YW1hLmpwIiwKCSJuaWltaS5va2F5YW1hLmpwIiwKCSJuaXNoaWF3YWt1cmEub2theWFtYS5qcCIsCgkib2theWFtYS5va2F5YW1hLmpwIiwKCSJzYXRvc2hvLm9rYXlhbWEuanAiLAoJInNldG91Y2hpLm9rYXlhbWEuanAiLAoJInNoaW5qby5va2F5YW1hLmpwIiwKCSJzaG9vLm9rYXlhbWEuanAiLAoJInNvamEub2theWFtYS5qcCIsCgkidGFrYWhhc2hpLm9rYXlhbWEuanAiLAoJInRhbWFuby5va2F5YW1hLmpwIiwKCSJ0c3V5YW1hLm9rYXlhbWEuanAiLAoJIndha2Uub2theWFtYS5qcCIsCgkieWFrYWdlLm9rYXlhbWEuanAiLAoJImFndW5pLm9raW5hd2EuanAiLAoJImdpbm93YW4ub2tpbmF3YS5qcCIsCgkiZ2lub3phLm9raW5hd2EuanAiLAoJImd1c2hpa2FtaS5va2luYXdhLmpwIiwKCSJoYWViYXJ1Lm9raW5hd2EuanAiLAoJImhpZ2FzaGkub2tpbmF3YS5qcCIsCgkiaGlyYXJhLm9raW5hd2EuanAiLAoJImloZXlhLm9raW5hd2EuanAiLAoJImlzaGlnYWtpLm9raW5hd2EuanAiLAoJImlzaGlrYXdhLm9raW5hd2EuanAiLAoJIml0b21hbi5va2luYXdhLmpwIiwKCSJpemVuYS5va2luYXdhLmpwIiwKCSJrYWRlbmEub2tpbmF3YS5qcCIsCgkia2luLm9raW5hd2EuanAiLAoJImtpdGFkYWl0by5va2luYXdhLmpwIiwKCSJraXRhbmFrYWd1c3VrdS5va2luYXdhLmpwIiwKCSJrdW1lamltYS5va2luYXdhLmpwIiwKCSJrdW5pZ2FtaS5va2luYXdhLmpwIiwKCSJtaW5hbWlkYWl0by5va2luYXdhLmpwIiwKCSJtb3RvYnUub2tpbmF3YS5qcCIsCgkibmFnby5va2luYXdhLmpwIiwKCSJuYWhhLm9raW5hd2EuanAiLAoJIm5ha2FndXN1a3Uub2tpbmF3YS5qcCIsCgkibmFraWppbi5va2luYXdhLmpwIiwKCSJuYW5qby5va2luYXdhLmpwIiwKCSJuaXNoaWhhcmEub2tpbmF3YS5qcCIsCgkib2dpbWkub2tpbmF3YS5qcCIsCgkib2tpbmF3YS5va2luYXdhLmpwIiwKCSJvbm5hLm9raW5hd2EuanAiLAoJInNoaW1vamkub2tpbmF3YS5qcCIsCgkidGFrZXRvbWkub2tpbmF3YS5qcCIsCgkidGFyYW1hLm9raW5hd2EuanAiLAoJInRva2FzaGlraS5va2luYXdhLmpwIiwKCSJ0b21pZ3VzdWt1Lm9raW5hd2EuanAiLAoJInRvbmFraS5va2luYXdhLmpwIiwKCSJ1cmFzb2Uub2tpbmF3YS5qcCIsCgkidXJ1bWEub2tpbmF3YS5qcCIsCgkieWFlc2Uub2tpbmF3YS5qcCIsCgkieW9taXRhbi5va2luYXdhLmpwIiwKCSJ5b25hYmFydS5va2luYXdhLmpwIiwKCSJ5b25hZ3VuaS5va2luYXdhLmpwIiwKCSJ6YW1hbWkub2tpbmF3YS5qcCIsCgkiYWJlbm8ub3Nha2EuanAiLAoJImNoaWhheWFha2FzYWthLm9zYWthLmpwIiwKCSJjaHVvLm9zYWthLmpwIiwKCSJkYWl0by5vc2FrYS5qcCIsCgkiZnVqaWlkZXJhLm9zYWthLmpwIiwKCSJoYWJpa2luby5vc2FrYS5qcCIsCgkiaGFubmFuLm9zYWthLmpwIiwKCSJoaWdhc2hpb3Nha2Eub3Nha2EuanAiLAoJImhpZ2FzaGlzdW1peW9zaGkub3Nha2EuanAiLAoJImhpZ2FzaGl5b2RvZ2F3YS5vc2FrYS5qcCIsCgkiaGlyYWthdGEub3Nha2EuanAiLAoJImliYXJha2kub3Nha2EuanAiLAoJImlrZWRhLm9zYWthLmpwIiwKCSJpenVtaS5vc2FrYS5qcCIsCgkiaXp1bWlvdHN1Lm9zYWthLmpwIiwKCSJpenVtaXNhbm8ub3Nha2EuanAiLAoJImthZG9tYS5vc2FrYS5qcCIsCgkia2FpenVrYS5vc2FrYS5qcCIsCgkia2FuYW4ub3Nha2EuanAiLAoJImthc2hpd2FyYS5vc2FrYS5qcCIsCgkia2F0YW5vLm9zYWthLmpwIiwKCSJrYXdhY2hpbmFnYW5vLm9zYWthLmpwIiwKCSJraXNoaXdhZGEub3Nha2EuanAiLAoJImtpdGEub3Nha2EuanAiLAoJImt1bWF0b3JpLm9zYWthLmpwIiwKCSJtYXRzdWJhcmEub3Nha2EuanAiLAoJIm1pbmF0by5vc2FrYS5qcCIsCgkibWlub2gub3Nha2EuanAiLAoJIm1pc2FraS5vc2FrYS5qcCIsCgkibW9yaWd1Y2hpLm9zYWthLmpwIiwKCSJuZXlhZ2F3YS5vc2FrYS5qcCIsCgkibmlzaGkub3Nha2EuanAiLAoJIm5vc2Uub3Nha2EuanAiLAoJIm9zYWthc2F5YW1hLm9zYWthLmpwIiwKCSJzYWthaS5vc2FrYS5qcCIsCgkic2F5YW1hLm9zYWthLmpwIiwKCSJzZW5uYW4ub3Nha2EuanAiLAoJInNldHRzdS5vc2FrYS5qcCIsCgkic2hpam9uYXdhdGUub3Nha2EuanAiLAoJInNoaW1hbW90by5vc2FrYS5qcCIsCgkic3VpdGEub3Nha2EuanAiLAoJInRhZGFva2Eub3Nha2EuanAiLAoJInRhaXNoaS5vc2FrYS5qcCIsCgkidGFqaXJpLm9zYWthLmpwIiwKCSJ0YWthaXNoaS5vc2FrYS5qcCIsCgkidGFrYXRzdWtpLm9zYWthLmpwIiwKCSJ0b25kYWJheWFzaGkub3Nha2EuanAiLAoJInRveW9uYWthLm9zYWthLmpwIiwKCSJ0b3lvbm8ub3Nha2EuanAiLAoJInlhby5vc2FrYS5qcCIsCgkiYXJpYWtlLnNhZ2EuanAiLAoJImFyaXRhLnNhZ2EuanAiLAoJImZ1a3Vkb21pLnNhZ2EuanAiLAoJImdlbmthaS5zYWdhLmpwIiwKCSJoYW1hdGFtYS5zYWdhLmpwIiwKCSJoaXplbi5zYWdhLmpwIiwKCSJpbWFyaS5zYWdhLmpwIiwKCSJrYW1pbWluZS5zYWdhLmpwIiwKCSJrYW56YWtpLnNhZ2EuanAiLAoJImthcmF0c3Uuc2FnYS5qcCIsCgkia2FzaGltYS5zYWdhLmpwIiwKCSJraXRhZ2F0YS5zYWdhLmpwIiwKCSJraXRhaGF0YS5zYWdhLmpwIiwKCSJraXlhbWEuc2FnYS5qcCIsCgkia291aG9rdS5zYWdhLmpwIiwKCSJreXVyYWdpLnNhZ2EuanAiLAoJIm5pc2hpYXJpdGEuc2FnYS5qcCIsCgkib2dpLnNhZ2EuanAiLAoJIm9tYWNoaS5zYWdhLmpwIiwKCSJvdWNoaS5zYWdhLmpwIiwKCSJzYWdhLnNhZ2EuanAiLAoJInNoaXJvaXNoaS5zYWdhLmpwIiwKCSJ0YWt1LnNhZ2EuanAiLAoJInRhcmEuc2FnYS5qcCIsCgkidG9zdS5zYWdhLmpwIiwKCSJ5b3NoaW5vZ2FyaS5zYWdhLmpwIiwKCSJhcmFrYXdhLnNhaXRhbWEuanAiLAoJImFzYWthLnNhaXRhbWEuanAiLAoJImNoaWNoaWJ1LnNhaXRhbWEuanAiLAoJImZ1amltaS5zYWl0YW1hLmpwIiwKCSJmdWppbWluby5zYWl0YW1hLmpwIiwKCSJmdWtheWEuc2FpdGFtYS5qcCIsCgkiaGFubm8uc2FpdGFtYS5qcCIsCgkiaGFueXUuc2FpdGFtYS5qcCIsCgkiaGFzdWRhLnNhaXRhbWEuanAiLAoJImhhdG9nYXlhLnNhaXRhbWEuanAiLAoJImhhdG95YW1hLnNhaXRhbWEuanAiLAoJImhpZGFrYS5zYWl0YW1hLmpwIiwKCSJoaWdhc2hpY2hpY2hpYnUuc2FpdGFtYS5qcCIsCgkiaGlnYXNoaW1hdHN1eWFtYS5zYWl0YW1hLmpwIiwKCSJob25qby5zYWl0YW1hLmpwIiwKCSJpbmEuc2FpdGFtYS5qcCIsCgkiaXJ1bWEuc2FpdGFtYS5qcCIsCgkiaXdhdHN1a2kuc2FpdGFtYS5qcCIsCgkia2FtaWl6dW1pLnNhaXRhbWEuanAiLAoJImthbWlrYXdhLnNhaXRhbWEuanAiLAoJImthbWlzYXRvLnNhaXRhbWEuanAiLAoJImthc3VrYWJlLnNhaXRhbWEuanAiLAoJImthd2Fnb2Uuc2FpdGFtYS5qcCIsCgkia2F3YWd1Y2hpLnNhaXRhbWEuanAiLAoJImthd2FqaW1hLnNhaXRhbWEuanAiLAoJImthem8uc2FpdGFtYS5qcCIsCgkia2l0YW1vdG8uc2FpdGFtYS5qcCIsCgkia29zaGlnYXlhLnNhaXRhbWEuanAiLAoJImtvdW5vc3Uuc2FpdGFtYS5qcCIsCgkia3VraS5zYWl0YW1hLmpwIiwKCSJrdW1hZ2F5YS5zYWl0YW1hLmpwIiwKCSJtYXRzdWJ1c2hpLnNhaXRhbWEuanAiLAoJIm1pbmFuby5zYWl0YW1hLmpwIiwKCSJtaXNhdG8uc2FpdGFtYS5qcCIsCgkibWl5YXNoaXJvLnNhaXRhbWEuanAiLAoJIm1peW9zaGkuc2FpdGFtYS5qcCIsCgkibW9yb3lhbWEuc2FpdGFtYS5qcCIsCgkibmFnYXRvcm8uc2FpdGFtYS5qcCIsCgkibmFtZWdhd2Euc2FpdGFtYS5qcCIsCgkibmlpemEuc2FpdGFtYS5qcCIsCgkib2dhbm8uc2FpdGFtYS5qcCIsCgkib2dhd2Euc2FpdGFtYS5qcCIsCgkib2dvc2Uuc2FpdGFtYS5qcCIsCgkib2tlZ2F3YS5zYWl0YW1hLmpwIiwKCSJvbWl5YS5zYWl0YW1hLmpwIiwKCSJvdGFraS5zYWl0YW1hLmpwIiwKCSJyYW56YW4uc2FpdGFtYS5qcCIsCgkicnlva2FtaS5zYWl0YW1hLmpwIiwKCSJzYWl0YW1hLnNhaXRhbWEuanAiLAoJInNha2Fkby5zYWl0YW1hLmpwIiwKCSJzYXR0ZS5zYWl0YW1hLmpwIiwKCSJzYXlhbWEuc2FpdGFtYS5qcCIsCgkic2hpa2kuc2FpdGFtYS5qcCIsCgkic2hpcmFva2Euc2FpdGFtYS5qcCIsCgkic29rYS5zYWl0YW1hLmpwIiwKCSJzdWdpdG8uc2FpdGFtYS5qcCIsCgkidG9kYS5zYWl0YW1hLmpwIiwKCSJ0b2tpZ2F3YS5zYWl0YW1hLmpwIiwKCSJ0b2tvcm96YXdhLnNhaXRhbWEuanAiLAoJInRzdXJ1Z2FzaGltYS5zYWl0YW1hLmpwIiwKCSJ1cmF3YS5zYWl0YW1hLmpwIiwKCSJ3YXJhYmkuc2FpdGFtYS5qcCIsCgkieWFzaGlvLnNhaXRhbWEuanAiLAoJInlva296ZS5zYWl0YW1hLmpwIiwKCSJ5b25vLnNhaXRhbWEuanAiLAoJInlvcmlpLnNhaXRhbWEuanAiLAoJInlvc2hpZGEuc2FpdGFtYS5qcCIsCgkieW9zaGlrYXdhLnNhaXRhbWEuanAiLAoJInlvc2hpbWkuc2FpdGFtYS5qcCIsCgkiYWlzaG8uc2hpZ2EuanAiLAoJImdhbW8uc2hpZ2EuanAiLAoJImhpZ2FzaGlvbWkuc2hpZ2EuanAiLAoJImhpa29uZS5zaGlnYS5qcCIsCgkia29rYS5zaGlnYS5qcCIsCgkia29uYW4uc2hpZ2EuanAiLAoJImtvc2VpLnNoaWdhLmpwIiwKCSJrb3RvLnNoaWdhLmpwIiwKCSJrdXNhdHN1LnNoaWdhLmpwIiwKCSJtYWliYXJhLnNoaWdhLmpwIiwKCSJtb3JpeWFtYS5zaGlnYS5qcCIsCgkibmFnYWhhbWEuc2hpZ2EuanAiLAoJIm5pc2hpYXphaS5zaGlnYS5qcCIsCgkibm90b2dhd2Euc2hpZ2EuanAiLAoJIm9taWhhY2hpbWFuLnNoaWdhLmpwIiwKCSJvdHN1LnNoaWdhLmpwIiwKCSJyaXR0by5zaGlnYS5qcCIsCgkicnl1b2guc2hpZ2EuanAiLAoJInRha2FzaGltYS5zaGlnYS5qcCIsCgkidGFrYXRzdWtpLnNoaWdhLmpwIiwKCSJ0b3JhaGltZS5zaGlnYS5qcCIsCgkidG95b3NhdG8uc2hpZ2EuanAiLAoJInlhc3Uuc2hpZ2EuanAiLAoJImFrYWdpLnNoaW1hbmUuanAiLAoJImFtYS5zaGltYW5lLmpwIiwKCSJnb3RzdS5zaGltYW5lLmpwIiwKCSJoYW1hZGEuc2hpbWFuZS5qcCIsCgkiaGlnYXNoaWl6dW1vLnNoaW1hbmUuanAiLAoJImhpa2F3YS5zaGltYW5lLmpwIiwKCSJoaWtpbWkuc2hpbWFuZS5qcCIsCgkiaXp1bW8uc2hpbWFuZS5qcCIsCgkia2FraW5va2kuc2hpbWFuZS5qcCIsCgkibWFzdWRhLnNoaW1hbmUuanAiLAoJIm1hdHN1ZS5zaGltYW5lLmpwIiwKCSJtaXNhdG8uc2hpbWFuZS5qcCIsCgkibmlzaGlub3NoaW1hLnNoaW1hbmUuanAiLAoJIm9oZGEuc2hpbWFuZS5qcCIsCgkib2tpbm9zaGltYS5zaGltYW5lLmpwIiwKCSJva3VpenVtby5zaGltYW5lLmpwIiwKCSJzaGltYW5lLnNoaW1hbmUuanAiLAoJInRhbWF5dS5zaGltYW5lLmpwIiwKCSJ0c3V3YW5vLnNoaW1hbmUuanAiLAoJInVubmFuLnNoaW1hbmUuanAiLAoJInlha3Vtby5zaGltYW5lLmpwIiwKCSJ5YXN1Z2kuc2hpbWFuZS5qcCIsCgkieWF0c3VrYS5zaGltYW5lLmpwIiwKCSJhcmFpLnNoaXp1b2thLmpwIiwKCSJhdGFtaS5zaGl6dW9rYS5qcCIsCgkiZnVqaS5zaGl6dW9rYS5qcCIsCgkiZnVqaWVkYS5zaGl6dW9rYS5qcCIsCgkiZnVqaWthd2Euc2hpenVva2EuanAiLAoJImZ1amlub21peWEuc2hpenVva2EuanAiLAoJImZ1a3Vyb2kuc2hpenVva2EuanAiLAoJImdvdGVtYmEuc2hpenVva2EuanAiLAoJImhhaWJhcmEuc2hpenVva2EuanAiLAoJImhhbWFtYXRzdS5zaGl6dW9rYS5qcCIsCgkiaGlnYXNoaWl6dS5zaGl6dW9rYS5qcCIsCgkiaXRvLnNoaXp1b2thLmpwIiwKCSJpd2F0YS5zaGl6dW9rYS5qcCIsCgkiaXp1LnNoaXp1b2thLmpwIiwKCSJpenVub2t1bmkuc2hpenVva2EuanAiLAoJImtha2VnYXdhLnNoaXp1b2thLmpwIiwKCSJrYW5uYW1pLnNoaXp1b2thLmpwIiwKCSJrYXdhbmVob24uc2hpenVva2EuanAiLAoJImthd2F6dS5zaGl6dW9rYS5qcCIsCgkia2lrdWdhd2Euc2hpenVva2EuanAiLAoJImtvc2FpLnNoaXp1b2thLmpwIiwKCSJtYWtpbm9oYXJhLnNoaXp1b2thLmpwIiwKCSJtYXRzdXpha2kuc2hpenVva2EuanAiLAoJIm1pbmFtaWl6dS5zaGl6dW9rYS5qcCIsCgkibWlzaGltYS5zaGl6dW9rYS5qcCIsCgkibW9yaW1hY2hpLnNoaXp1b2thLmpwIiwKCSJuaXNoaWl6dS5zaGl6dW9rYS5qcCIsCgkibnVtYXp1LnNoaXp1b2thLmpwIiwKCSJvbWFlemFraS5zaGl6dW9rYS5qcCIsCgkic2hpbWFkYS5zaGl6dW9rYS5qcCIsCgkic2hpbWl6dS5zaGl6dW9rYS5qcCIsCgkic2hpbW9kYS5zaGl6dW9rYS5qcCIsCgkic2hpenVva2Euc2hpenVva2EuanAiLAoJInN1c29uby5zaGl6dW9rYS5qcCIsCgkieWFpenUuc2hpenVva2EuanAiLAoJInlvc2hpZGEuc2hpenVva2EuanAiLAoJImFzaGlrYWdhLnRvY2hpZ2kuanAiLAoJImJhdG8udG9jaGlnaS5qcCIsCgkiaGFnYS50b2NoaWdpLmpwIiwKCSJpY2hpa2FpLnRvY2hpZ2kuanAiLAoJIml3YWZ1bmUudG9jaGlnaS5qcCIsCgkia2FtaW5va2F3YS50b2NoaWdpLmpwIiwKCSJrYW51bWEudG9jaGlnaS5qcCIsCgkia2FyYXN1eWFtYS50b2NoaWdpLmpwIiwKCSJrdXJvaXNvLnRvY2hpZ2kuanAiLAoJIm1hc2hpa28udG9jaGlnaS5qcCIsCgkibWlidS50b2NoaWdpLmpwIiwKCSJtb2thLnRvY2hpZ2kuanAiLAoJIm1vdGVnaS50b2NoaWdpLmpwIiwKCSJuYXN1LnRvY2hpZ2kuanAiLAoJIm5hc3VzaGlvYmFyYS50b2NoaWdpLmpwIiwKCSJuaWtrby50b2NoaWdpLmpwIiwKCSJuaXNoaWthdGEudG9jaGlnaS5qcCIsCgkibm9naS50b2NoaWdpLmpwIiwKCSJvaGlyYS50b2NoaWdpLmpwIiwKCSJvaHRhd2FyYS50b2NoaWdpLmpwIiwKCSJveWFtYS50b2NoaWdpLmpwIiwKCSJzYWt1cmEudG9jaGlnaS5qcCIsCgkic2Fuby50b2NoaWdpLmpwIiwKCSJzaGltb3RzdWtlLnRvY2hpZ2kuanAiLAoJInNoaW95YS50b2NoaWdpLmpwIiwKCSJ0YWthbmV6YXdhLnRvY2hpZ2kuanAiLAoJInRvY2hpZ2kudG9jaGlnaS5qcCIsCgkidHN1Z2EudG9jaGlnaS5qcCIsCgkidWppaWUudG9jaGlnaS5qcCIsCgkidXRzdW5vbWl5YS50b2NoaWdpLmpwIiwKCSJ5YWl0YS50b2NoaWdpLmpwIiwKCSJhaXp1bWkudG9rdXNoaW1hLmpwIiwKCSJhbmFuLnRva3VzaGltYS5qcCIsCgkiaWNoaWJhLnRva3VzaGltYS5qcCIsCgkiaXRhbm8udG9rdXNoaW1hLmpwIiwKCSJrYWluYW4udG9rdXNoaW1hLmpwIiwKCSJrb21hdHN1c2hpbWEudG9rdXNoaW1hLmpwIiwKCSJtYXRzdXNoaWdlLnRva3VzaGltYS5qcCIsCgkibWltYS50b2t1c2hpbWEuanAiLAoJIm1pbmFtaS50b2t1c2hpbWEuanAiLAoJIm1peW9zaGkudG9rdXNoaW1hLmpwIiwKCSJtdWdpLnRva3VzaGltYS5qcCIsCgkibmFrYWdhd2EudG9rdXNoaW1hLmpwIiwKCSJuYXJ1dG8udG9rdXNoaW1hLmpwIiwKCSJzYW5hZ29jaGkudG9rdXNoaW1hLmpwIiwKCSJzaGlzaGlrdWkudG9rdXNoaW1hLmpwIiwKCSJ0b2t1c2hpbWEudG9rdXNoaW1hLmpwIiwKCSJ3YWppa2kudG9rdXNoaW1hLmpwIiwKCSJhZGFjaGkudG9reW8uanAiLAoJImFraXJ1bm8udG9reW8uanAiLAoJImFraXNoaW1hLnRva3lvLmpwIiwKCSJhb2dhc2hpbWEudG9reW8uanAiLAoJImFyYWthd2EudG9reW8uanAiLAoJImJ1bmt5by50b2t5by5qcCIsCgkiY2hpeW9kYS50b2t5by5qcCIsCgkiY2hvZnUudG9reW8uanAiLAoJImNodW8udG9reW8uanAiLAoJImVkb2dhd2EudG9reW8uanAiLAoJImZ1Y2h1LnRva3lvLmpwIiwKCSJmdXNzYS50b2t5by5qcCIsCgkiaGFjaGlqby50b2t5by5qcCIsCgkiaGFjaGlvamkudG9reW8uanAiLAoJImhhbXVyYS50b2t5by5qcCIsCgkiaGlnYXNoaWt1cnVtZS50b2t5by5qcCIsCgkiaGlnYXNoaW11cmF5YW1hLnRva3lvLmpwIiwKCSJoaWdhc2hpeWFtYXRvLnRva3lvLmpwIiwKCSJoaW5vLnRva3lvLmpwIiwKCSJoaW5vZGUudG9reW8uanAiLAoJImhpbm9oYXJhLnRva3lvLmpwIiwKCSJpbmFnaS50b2t5by5qcCIsCgkiaXRhYmFzaGkudG9reW8uanAiLAoJImthdHN1c2hpa2EudG9reW8uanAiLAoJImtpdGEudG9reW8uanAiLAoJImtpeW9zZS50b2t5by5qcCIsCgkia29kYWlyYS50b2t5by5qcCIsCgkia29nYW5laS50b2t5by5qcCIsCgkia29rdWJ1bmppLnRva3lvLmpwIiwKCSJrb21hZS50b2t5by5qcCIsCgkia290by50b2t5by5qcCIsCgkia291enVzaGltYS50b2t5by5qcCIsCgkia3VuaXRhY2hpLnRva3lvLmpwIiwKCSJtYWNoaWRhLnRva3lvLmpwIiwKCSJtZWd1cm8udG9reW8uanAiLAoJIm1pbmF0by50b2t5by5qcCIsCgkibWl0YWthLnRva3lvLmpwIiwKCSJtaXp1aG8udG9reW8uanAiLAoJIm11c2FzaGltdXJheWFtYS50b2t5by5qcCIsCgkibXVzYXNoaW5vLnRva3lvLmpwIiwKCSJuYWthbm8udG9reW8uanAiLAoJIm5lcmltYS50b2t5by5qcCIsCgkib2dhc2F3YXJhLnRva3lvLmpwIiwKCSJva3V0YW1hLnRva3lvLmpwIiwKCSJvbWUudG9reW8uanAiLAoJIm9zaGltYS50b2t5by5qcCIsCgkib3RhLnRva3lvLmpwIiwKCSJzZXRhZ2F5YS50b2t5by5qcCIsCgkic2hpYnV5YS50b2t5by5qcCIsCgkic2hpbmFnYXdhLnRva3lvLmpwIiwKCSJzaGluanVrdS50b2t5by5qcCIsCgkic3VnaW5hbWkudG9reW8uanAiLAoJInN1bWlkYS50b2t5by5qcCIsCgkidGFjaGlrYXdhLnRva3lvLmpwIiwKCSJ0YWl0by50b2t5by5qcCIsCgkidGFtYS50b2t5by5qcCIsCgkidG9zaGltYS50b2t5by5qcCIsCgkiY2hpenUudG90dG9yaS5qcCIsCgkiaGluby50b3R0b3JpLmpwIiwKCSJrYXdhaGFyYS50b3R0b3JpLmpwIiwKCSJrb2dlLnRvdHRvcmkuanAiLAoJImtvdG91cmEudG90dG9yaS5qcCIsCgkibWlzYXNhLnRvdHRvcmkuanAiLAoJIm5hbmJ1LnRvdHRvcmkuanAiLAoJIm5pY2hpbmFuLnRvdHRvcmkuanAiLAoJInNha2FpbWluYXRvLnRvdHRvcmkuanAiLAoJInRvdHRvcmkudG90dG9yaS5qcCIsCgkid2FrYXNhLnRvdHRvcmkuanAiLAoJInlhenUudG90dG9yaS5qcCIsCgkieW9uYWdvLnRvdHRvcmkuanAiLAoJImFzYWhpLnRveWFtYS5qcCIsCgkiZnVjaHUudG95YW1hLmpwIiwKCSJmdWt1bWl0c3UudG95YW1hLmpwIiwKCSJmdW5haGFzaGkudG95YW1hLmpwIiwKCSJoaW1pLnRveWFtYS5qcCIsCgkiaW1penUudG95YW1hLmpwIiwKCSJpbmFtaS50b3lhbWEuanAiLAoJImpvaGFuYS50b3lhbWEuanAiLAoJImthbWlpY2hpLnRveWFtYS5qcCIsCgkia3Vyb2JlLnRveWFtYS5qcCIsCgkibmFrYW5paWthd2EudG95YW1hLmpwIiwKCSJuYW1lcmlrYXdhLnRveWFtYS5qcCIsCgkibmFudG8udG95YW1hLmpwIiwKCSJueXV6ZW4udG95YW1hLmpwIiwKCSJveWFiZS50b3lhbWEuanAiLAoJInRhaXJhLnRveWFtYS5qcCIsCgkidGFrYW9rYS50b3lhbWEuanAiLAoJInRhdGV5YW1hLnRveWFtYS5qcCIsCgkidG9nYS50b3lhbWEuanAiLAoJInRvbmFtaS50b3lhbWEuanAiLAoJInRveWFtYS50b3lhbWEuanAiLAoJInVuYXp1a2kudG95YW1hLmpwIiwKCSJ1b3p1LnRveWFtYS5qcCIsCgkieWFtYWRhLnRveWFtYS5qcCIsCgkiYXJpZGEud2FrYXlhbWEuanAiLAoJImFyaWRhZ2F3YS53YWtheWFtYS5qcCIsCgkiZ29iby53YWtheWFtYS5qcCIsCgkiaGFzaGltb3RvLndha2F5YW1hLmpwIiwKCSJoaWRha2Eud2FrYXlhbWEuanAiLAoJImhpcm9nYXdhLndha2F5YW1hLmpwIiwKCSJpbmFtaS53YWtheWFtYS5qcCIsCgkiaXdhZGUud2FrYXlhbWEuanAiLAoJImthaW5hbi53YWtheWFtYS5qcCIsCgkia2FtaXRvbmRhLndha2F5YW1hLmpwIiwKCSJrYXRzdXJhZ2kud2FrYXlhbWEuanAiLAoJImtpbWluby53YWtheWFtYS5qcCIsCgkia2lub2thd2Eud2FrYXlhbWEuanAiLAoJImtpdGF5YW1hLndha2F5YW1hLmpwIiwKCSJrb3lhLndha2F5YW1hLmpwIiwKCSJrb3phLndha2F5YW1hLmpwIiwKCSJrb3phZ2F3YS53YWtheWFtYS5qcCIsCgkia3Vkb3lhbWEud2FrYXlhbWEuanAiLAoJImt1c2hpbW90by53YWtheWFtYS5qcCIsCgkibWloYW1hLndha2F5YW1hLmpwIiwKCSJtaXNhdG8ud2FrYXlhbWEuanAiLAoJIm5hY2hpa2F0c3V1cmEud2FrYXlhbWEuanAiLAoJInNoaW5ndS53YWtheWFtYS5qcCIsCgkic2hpcmFoYW1hLndha2F5YW1hLmpwIiwKCSJ0YWlqaS53YWtheWFtYS5qcCIsCgkidGFuYWJlLndha2F5YW1hLmpwIiwKCSJ3YWtheWFtYS53YWtheWFtYS5qcCIsCgkieXVhc2Eud2FrYXlhbWEuanAiLAoJInl1cmEud2FrYXlhbWEuanAiLAoJImFzYWhpLnlhbWFnYXRhLmpwIiwKCSJmdW5hZ2F0YS55YW1hZ2F0YS5qcCIsCgkiaGlnYXNoaW5lLnlhbWFnYXRhLmpwIiwKCSJpaWRlLnlhbWFnYXRhLmpwIiwKCSJrYWhva3UueWFtYWdhdGEuanAiLAoJImthbWlub3lhbWEueWFtYWdhdGEuanAiLAoJImthbmV5YW1hLnlhbWFnYXRhLmpwIiwKCSJrYXdhbmlzaGkueWFtYWdhdGEuanAiLAoJIm1hbXVyb2dhd2EueWFtYWdhdGEuanAiLAoJIm1pa2F3YS55YW1hZ2F0YS5qcCIsCgkibXVyYXlhbWEueWFtYWdhdGEuanAiLAoJIm5hZ2FpLnlhbWFnYXRhLmpwIiwKCSJuYWtheWFtYS55YW1hZ2F0YS5qcCIsCgkibmFueW8ueWFtYWdhdGEuanAiLAoJIm5pc2hpa2F3YS55YW1hZ2F0YS5qcCIsCgkib2JhbmF6YXdhLnlhbWFnYXRhLmpwIiwKCSJvZS55YW1hZ2F0YS5qcCIsCgkib2d1bmkueWFtYWdhdGEuanAiLAoJIm9oa3VyYS55YW1hZ2F0YS5qcCIsCgkib2lzaGlkYS55YW1hZ2F0YS5qcCIsCgkic2FnYWUueWFtYWdhdGEuanAiLAoJInNha2F0YS55YW1hZ2F0YS5qcCIsCgkic2FrZWdhd2EueWFtYWdhdGEuanAiLAoJInNoaW5qby55YW1hZ2F0YS5qcCIsCgkic2hpcmF0YWthLnlhbWFnYXRhLmpwIiwKCSJzaG9uYWkueWFtYWdhdGEuanAiLAoJInRha2FoYXRhLnlhbWFnYXRhLmpwIiwKCSJ0ZW5kby55YW1hZ2F0YS5qcCIsCgkidG96YXdhLnlhbWFnYXRhLmpwIiwKCSJ0c3VydW9rYS55YW1hZ2F0YS5qcCIsCgkieWFtYWdhdGEueWFtYWdhdGEuanAiLAoJInlhbWFub2JlLnlhbWFnYXRhLmpwIiwKCSJ5b25lemF3YS55YW1hZ2F0YS5qcCIsCgkieXV6YS55YW1hZ2F0YS5qcCIsCgkiYWJ1LnlhbWFndWNoaS5qcCIsCgkiaGFnaS55YW1hZ3VjaGkuanAiLAoJImhpa2FyaS55YW1hZ3VjaGkuanAiLAoJImhvZnUueWFtYWd1Y2hpLmpwIiwKCSJpd2FrdW5pLnlhbWFndWNoaS5qcCIsCgkia3VkYW1hdHN1LnlhbWFndWNoaS5qcCIsCgkibWl0b3UueWFtYWd1Y2hpLmpwIiwKCSJuYWdhdG8ueWFtYWd1Y2hpLmpwIiwKCSJvc2hpbWEueWFtYWd1Y2hpLmpwIiwKCSJzaGltb25vc2VraS55YW1hZ3VjaGkuanAiLAoJInNodW5hbi55YW1hZ3VjaGkuanAiLAoJInRhYnVzZS55YW1hZ3VjaGkuanAiLAoJInRva3V5YW1hLnlhbWFndWNoaS5qcCIsCgkidG95b3RhLnlhbWFndWNoaS5qcCIsCgkidWJlLnlhbWFndWNoaS5qcCIsCgkieXV1LnlhbWFndWNoaS5qcCIsCgkiY2h1by55YW1hbmFzaGkuanAiLAoJImRvc2hpLnlhbWFuYXNoaS5qcCIsCgkiZnVlZnVraS55YW1hbmFzaGkuanAiLAoJImZ1amlrYXdhLnlhbWFuYXNoaS5qcCIsCgkiZnVqaWthd2FndWNoaWtvLnlhbWFuYXNoaS5qcCIsCgkiZnVqaXlvc2hpZGEueWFtYW5hc2hpLmpwIiwKCSJoYXlha2F3YS55YW1hbmFzaGkuanAiLAoJImhva3V0by55YW1hbmFzaGkuanAiLAoJImljaGlrYXdhbWlzYXRvLnlhbWFuYXNoaS5qcCIsCgkia2FpLnlhbWFuYXNoaS5qcCIsCgkia29mdS55YW1hbmFzaGkuanAiLAoJImtvc2h1LnlhbWFuYXNoaS5qcCIsCgkia29zdWdlLnlhbWFuYXNoaS5qcCIsCgkibWluYW1pLWFscHMueWFtYW5hc2hpLmpwIiwKCSJtaW5vYnUueWFtYW5hc2hpLmpwIiwKCSJuYWthbWljaGkueWFtYW5hc2hpLmpwIiwKCSJuYW5idS55YW1hbmFzaGkuanAiLAoJIm5hcnVzYXdhLnlhbWFuYXNoaS5qcCIsCgkibmlyYXNha2kueWFtYW5hc2hpLmpwIiwKCSJuaXNoaWthdHN1cmEueWFtYW5hc2hpLmpwIiwKCSJvc2hpbm8ueWFtYW5hc2hpLmpwIiwKCSJvdHN1a2kueWFtYW5hc2hpLmpwIiwKCSJzaG93YS55YW1hbmFzaGkuanAiLAoJInRhYmF5YW1hLnlhbWFuYXNoaS5qcCIsCgkidHN1cnUueWFtYW5hc2hpLmpwIiwKCSJ1ZW5vaGFyYS55YW1hbmFzaGkuanAiLAoJInlhbWFuYWtha28ueWFtYW5hc2hpLmpwIiwKCSJ5YW1hbmFzaGkueWFtYW5hc2hpLmpwIiwKCSJrZSIsCgkiYWMua2UiLAoJImNvLmtlIiwKCSJnby5rZSIsCgkiaW5mby5rZSIsCgkibWUua2UiLAoJIm1vYmkua2UiLAoJIm5lLmtlIiwKCSJvci5rZSIsCgkic2Mua2UiLAoJImtnIiwKCSJvcmcua2ciLAoJIm5ldC5rZyIsCgkiY29tLmtnIiwKCSJlZHUua2ciLAoJImdvdi5rZyIsCgkibWlsLmtnIiwKCSIqLmtoIiwKCSJraSIsCgkiZWR1LmtpIiwKCSJiaXoua2kiLAoJIm5ldC5raSIsCgkib3JnLmtpIiwKCSJnb3Yua2kiLAoJImluZm8ua2kiLAoJImNvbS5raSIsCgkia20iLAoJIm9yZy5rbSIsCgkibm9tLmttIiwKCSJnb3Yua20iLAoJInByZC5rbSIsCgkidG0ua20iLAoJImVkdS5rbSIsCgkibWlsLmttIiwKCSJhc3Mua20iLAoJImNvbS5rbSIsCgkiY29vcC5rbSIsCgkiYXNzby5rbSIsCgkicHJlc3NlLmttIiwKCSJtZWRlY2luLmttIiwKCSJub3RhaXJlcy5rbSIsCgkicGhhcm1hY2llbnMua20iLAoJInZldGVyaW5haXJlLmttIiwKCSJnb3V2LmttIiwKCSJrbiIsCgkibmV0LmtuIiwKCSJvcmcua24iLAoJImVkdS5rbiIsCgkiZ292LmtuIiwKCSJrcCIsCgkiY29tLmtwIiwKCSJlZHUua3AiLAoJImdvdi5rcCIsCgkib3JnLmtwIiwKCSJyZXAua3AiLAoJInRyYS5rcCIsCgkia3IiLAoJImFjLmtyIiwKCSJjby5rciIsCgkiZXMua3IiLAoJImdvLmtyIiwKCSJocy5rciIsCgkia2cua3IiLAoJIm1pbC5rciIsCgkibXMua3IiLAoJIm5lLmtyIiwKCSJvci5rciIsCgkicGUua3IiLAoJInJlLmtyIiwKCSJzYy5rciIsCgkiYnVzYW4ua3IiLAoJImNodW5nYnVrLmtyIiwKCSJjaHVuZ25hbS5rciIsCgkiZGFlZ3Uua3IiLAoJImRhZWplb24ua3IiLAoJImdhbmd3b24ua3IiLAoJImd3YW5nanUua3IiLAoJImd5ZW9uZ2J1ay5rciIsCgkiZ3llb25nZ2kua3IiLAoJImd5ZW9uZ25hbS5rciIsCgkiaW5jaGVvbi5rciIsCgkiamVqdS5rciIsCgkiamVvbmJ1ay5rciIsCgkiamVvbm5hbS5rciIsCgkic2VvdWwua3IiLAoJInVsc2FuLmtyIiwKCSJrdyIsCgkiY29tLmt3IiwKCSJlZHUua3ciLAoJImVtYi5rdyIsCgkiZ292Lmt3IiwKCSJpbmQua3ciLAoJIm5ldC5rdyIsCgkib3JnLmt3IiwKCSJreSIsCgkiY29tLmt5IiwKCSJlZHUua3kiLAoJIm5ldC5reSIsCgkib3JnLmt5IiwKCSJreiIsCgkib3JnLmt6IiwKCSJlZHUua3oiLAoJIm5ldC5reiIsCgkiZ292Lmt6IiwKCSJtaWwua3oiLAoJImNvbS5reiIsCgkibGEiLAoJImludC5sYSIsCgkibmV0LmxhIiwKCSJpbmZvLmxhIiwKCSJlZHUubGEiLAoJImdvdi5sYSIsCgkicGVyLmxhIiwKCSJjb20ubGEiLAoJIm9yZy5sYSIsCgkibGIiLAoJImNvbS5sYiIsCgkiZWR1LmxiIiwKCSJnb3YubGIiLAoJIm5ldC5sYiIsCgkib3JnLmxiIiwKCSJsYyIsCgkiY29tLmxjIiwKCSJuZXQubGMiLAoJImNvLmxjIiwKCSJvcmcubGMiLAoJImVkdS5sYyIsCgkiZ292LmxjIiwKCSJsaSIsCgkibGsiLAoJImdvdi5sayIsCgkic2NoLmxrIiwKCSJuZXQubGsiLAoJImludC5sayIsCgkiY29tLmxrIiwKCSJvcmcubGsiLAoJImVkdS5sayIsCgkibmdvLmxrIiwKCSJzb2MubGsiLAoJIndlYi5sayIsCgkibHRkLmxrIiwKCSJhc3NuLmxrIiwKCSJncnAubGsiLAoJImhvdGVsLmxrIiwKCSJhYy5sayIsCgkibHIiLAoJImNvbS5sciIsCgkiZWR1LmxyIiwKCSJnb3YubHIiLAoJIm9yZy5sciIsCgkibmV0LmxyIiwKCSJscyIsCgkiYWMubHMiLAoJImJpei5scyIsCgkiY28ubHMiLAoJImVkdS5scyIsCgkiZ292LmxzIiwKCSJpbmZvLmxzIiwKCSJuZXQubHMiLAoJIm9yZy5scyIsCgkic2MubHMiLAoJImx0IiwKCSJnb3YubHQiLAoJImx1IiwKCSJsdiIsCgkiY29tLmx2IiwKCSJlZHUubHYiLAoJImdvdi5sdiIsCgkib3JnLmx2IiwKCSJtaWwubHYiLAoJImlkLmx2IiwKCSJuZXQubHYiLAoJImFzbi5sdiIsCgkiY29uZi5sdiIsCgkibHkiLAoJImNvbS5seSIsCgkibmV0Lmx5IiwKCSJnb3YubHkiLAoJInBsYy5seSIsCgkiZWR1Lmx5IiwKCSJzY2gubHkiLAoJIm1lZC5seSIsCgkib3JnLmx5IiwKCSJpZC5seSIsCgkibWEiLAoJImNvLm1hIiwKCSJuZXQubWEiLAoJImdvdi5tYSIsCgkib3JnLm1hIiwKCSJhYy5tYSIsCgkicHJlc3MubWEiLAoJIm1jIiwKCSJ0bS5tYyIsCgkiYXNzby5tYyIsCgkibWQiLAoJIm1lIiwKCSJjby5tZSIsCgkibmV0Lm1lIiwKCSJvcmcubWUiLAoJImVkdS5tZSIsCgkiYWMubWUiLAoJImdvdi5tZSIsCgkiaXRzLm1lIiwKCSJwcml2Lm1lIiwKCSJtZyIsCgkib3JnLm1nIiwKCSJub20ubWciLAoJImdvdi5tZyIsCgkicHJkLm1nIiwKCSJ0bS5tZyIsCgkiZWR1Lm1nIiwKCSJtaWwubWciLAoJImNvbS5tZyIsCgkiY28ubWciLAoJIm1oIiwKCSJtaWwiLAoJIm1rIiwKCSJjb20ubWsiLAoJIm9yZy5tayIsCgkibmV0Lm1rIiwKCSJlZHUubWsiLAoJImdvdi5tayIsCgkiaW5mLm1rIiwKCSJuYW1lLm1rIiwKCSJtbCIsCgkiY29tLm1sIiwKCSJlZHUubWwiLAoJImdvdXYubWwiLAoJImdvdi5tbCIsCgkibmV0Lm1sIiwKCSJvcmcubWwiLAoJInByZXNzZS5tbCIsCgkiKi5tbSIsCgkibW4iLAoJImdvdi5tbiIsCgkiZWR1Lm1uIiwKCSJvcmcubW4iLAoJIm1vIiwKCSJjb20ubW8iLAoJIm5ldC5tbyIsCgkib3JnLm1vIiwKCSJlZHUubW8iLAoJImdvdi5tbyIsCgkibW9iaSIsCgkibXAiLAoJIm1xIiwKCSJtciIsCgkiZ292Lm1yIiwKCSJtcyIsCgkiY29tLm1zIiwKCSJlZHUubXMiLAoJImdvdi5tcyIsCgkibmV0Lm1zIiwKCSJvcmcubXMiLAoJIm10IiwKCSJjb20ubXQiLAoJImVkdS5tdCIsCgkibmV0Lm10IiwKCSJvcmcubXQiLAoJIm11IiwKCSJjb20ubXUiLAoJIm5ldC5tdSIsCgkib3JnLm11IiwKCSJnb3YubXUiLAoJImFjLm11IiwKCSJjby5tdSIsCgkib3IubXUiLAoJIm11c2V1bSIsCgkiYWNhZGVteS5tdXNldW0iLAoJImFncmljdWx0dXJlLm11c2V1bSIsCgkiYWlyLm11c2V1bSIsCgkiYWlyZ3VhcmQubXVzZXVtIiwKCSJhbGFiYW1hLm11c2V1bSIsCgkiYWxhc2thLm11c2V1bSIsCgkiYW1iZXIubXVzZXVtIiwKCSJhbWJ1bGFuY2UubXVzZXVtIiwKCSJhbWVyaWNhbi5tdXNldW0iLAoJImFtZXJpY2FuYS5tdXNldW0iLAoJImFtZXJpY2FuYW50aXF1ZXMubXVzZXVtIiwKCSJhbWVyaWNhbmFydC5tdXNldW0iLAoJImFtc3RlcmRhbS5tdXNldW0iLAoJImFuZC5tdXNldW0iLAoJImFubmVmcmFuay5tdXNldW0iLAoJImFudGhyby5tdXNldW0iLAoJImFudGhyb3BvbG9neS5tdXNldW0iLAoJImFudGlxdWVzLm11c2V1bSIsCgkiYXF1YXJpdW0ubXVzZXVtIiwKCSJhcmJvcmV0dW0ubXVzZXVtIiwKCSJhcmNoYWVvbG9naWNhbC5tdXNldW0iLAoJImFyY2hhZW9sb2d5Lm11c2V1bSIsCgkiYXJjaGl0ZWN0dXJlLm11c2V1bSIsCgkiYXJ0Lm11c2V1bSIsCgkiYXJ0YW5kZGVzaWduLm11c2V1bSIsCgkiYXJ0Y2VudGVyLm11c2V1bSIsCgkiYXJ0ZGVjby5tdXNldW0iLAoJImFydGVkdWNhdGlvbi5tdXNldW0iLAoJImFydGdhbGxlcnkubXVzZXVtIiwKCSJhcnRzLm11c2V1bSIsCgkiYXJ0c2FuZGNyYWZ0cy5tdXNldW0iLAoJImFzbWF0YXJ0Lm11c2V1bSIsCgkiYXNzYXNzaW5hdGlvbi5tdXNldW0iLAoJImFzc2lzaS5tdXNldW0iLAoJImFzc29jaWF0aW9uLm11c2V1bSIsCgkiYXN0cm9ub215Lm11c2V1bSIsCgkiYXRsYW50YS5tdXNldW0iLAoJImF1c3Rpbi5tdXNldW0iLAoJImF1c3RyYWxpYS5tdXNldW0iLAoJImF1dG9tb3RpdmUubXVzZXVtIiwKCSJhdmlhdGlvbi5tdXNldW0iLAoJImF4aXMubXVzZXVtIiwKCSJiYWRham96Lm11c2V1bSIsCgkiYmFnaGRhZC5tdXNldW0iLAoJImJhaG4ubXVzZXVtIiwKCSJiYWxlLm11c2V1bSIsCgkiYmFsdGltb3JlLm11c2V1bSIsCgkiYmFyY2Vsb25hLm11c2V1bSIsCgkiYmFzZWJhbGwubXVzZXVtIiwKCSJiYXNlbC5tdXNldW0iLAoJImJhdGhzLm11c2V1bSIsCgkiYmF1ZXJuLm11c2V1bSIsCgkiYmVhdXhhcnRzLm11c2V1bSIsCgkiYmVlbGRlbmdlbHVpZC5tdXNldW0iLAoJImJlbGxldnVlLm11c2V1bSIsCgkiYmVyZ2JhdS5tdXNldW0iLAoJImJlcmtlbGV5Lm11c2V1bSIsCgkiYmVybGluLm11c2V1bSIsCgkiYmVybi5tdXNldW0iLAoJImJpYmxlLm11c2V1bSIsCgkiYmlsYmFvLm11c2V1bSIsCgkiYmlsbC5tdXNldW0iLAoJImJpcmRhcnQubXVzZXVtIiwKCSJiaXJ0aHBsYWNlLm11c2V1bSIsCgkiYm9ubi5tdXNldW0iLAoJImJvc3Rvbi5tdXNldW0iLAoJImJvdGFuaWNhbC5tdXNldW0iLAoJImJvdGFuaWNhbGdhcmRlbi5tdXNldW0iLAoJImJvdGFuaWNnYXJkZW4ubXVzZXVtIiwKCSJib3RhbnkubXVzZXVtIiwKCSJicmFuZHl3aW5ldmFsbGV5Lm11c2V1bSIsCgkiYnJhc2lsLm11c2V1bSIsCgkiYnJpc3RvbC5tdXNldW0iLAoJImJyaXRpc2gubXVzZXVtIiwKCSJicml0aXNoY29sdW1iaWEubXVzZXVtIiwKCSJicm9hZGNhc3QubXVzZXVtIiwKCSJicnVuZWwubXVzZXVtIiwKCSJicnVzc2VsLm11c2V1bSIsCgkiYnJ1c3NlbHMubXVzZXVtIiwKCSJicnV4ZWxsZXMubXVzZXVtIiwKCSJidWlsZGluZy5tdXNldW0iLAoJImJ1cmdob2YubXVzZXVtIiwKCSJidXMubXVzZXVtIiwKCSJidXNoZXkubXVzZXVtIiwKCSJjYWRhcXVlcy5tdXNldW0iLAoJImNhbGlmb3JuaWEubXVzZXVtIiwKCSJjYW1icmlkZ2UubXVzZXVtIiwKCSJjYW4ubXVzZXVtIiwKCSJjYW5hZGEubXVzZXVtIiwKCSJjYXBlYnJldG9uLm11c2V1bSIsCgkiY2Fycmllci5tdXNldW0iLAoJImNhcnRvb25hcnQubXVzZXVtIiwKCSJjYXNhZGVsYW1vbmVkYS5tdXNldW0iLAoJImNhc3RsZS5tdXNldW0iLAoJImNhc3RyZXMubXVzZXVtIiwKCSJjZWx0aWMubXVzZXVtIiwKCSJjZW50ZXIubXVzZXVtIiwKCSJjaGF0dGFub29nYS5tdXNldW0iLAoJImNoZWx0ZW5oYW0ubXVzZXVtIiwKCSJjaGVzYXBlYWtlYmF5Lm11c2V1bSIsCgkiY2hpY2Fnby5tdXNldW0iLAoJImNoaWxkcmVuLm11c2V1bSIsCgkiY2hpbGRyZW5zLm11c2V1bSIsCgkiY2hpbGRyZW5zZ2FyZGVuLm11c2V1bSIsCgkiY2hpcm9wcmFjdGljLm11c2V1bSIsCgkiY2hvY29sYXRlLm11c2V1bSIsCgkiY2hyaXN0aWFuc2J1cmcubXVzZXVtIiwKCSJjaW5jaW5uYXRpLm11c2V1bSIsCgkiY2luZW1hLm11c2V1bSIsCgkiY2lyY3VzLm11c2V1bSIsCgkiY2l2aWxpc2F0aW9uLm11c2V1bSIsCgkiY2l2aWxpemF0aW9uLm11c2V1bSIsCgkiY2l2aWx3YXIubXVzZXVtIiwKCSJjbGludG9uLm11c2V1bSIsCgkiY2xvY2subXVzZXVtIiwKCSJjb2FsLm11c2V1bSIsCgkiY29hc3RhbGRlZmVuY2UubXVzZXVtIiwKCSJjb2R5Lm11c2V1bSIsCgkiY29sZHdhci5tdXNldW0iLAoJImNvbGxlY3Rpb24ubXVzZXVtIiwKCSJjb2xvbmlhbHdpbGxpYW1zYnVyZy5tdXNldW0iLAoJImNvbG9yYWRvcGxhdGVhdS5tdXNldW0iLAoJImNvbHVtYmlhLm11c2V1bSIsCgkiY29sdW1idXMubXVzZXVtIiwKCSJjb21tdW5pY2F0aW9uLm11c2V1bSIsCgkiY29tbXVuaWNhdGlvbnMubXVzZXVtIiwKCSJjb21tdW5pdHkubXVzZXVtIiwKCSJjb21wdXRlci5tdXNldW0iLAoJImNvbXB1dGVyaGlzdG9yeS5tdXNldW0iLAoJImNvbXVuaWNhw6fDtWVzLm11c2V1bSIsCgkiY29udGVtcG9yYXJ5Lm11c2V1bSIsCgkiY29udGVtcG9yYXJ5YXJ0Lm11c2V1bSIsCgkiY29udmVudC5tdXNldW0iLAoJImNvcGVuaGFnZW4ubXVzZXVtIiwKCSJjb3Jwb3JhdGlvbi5tdXNldW0iLAoJImNvcnJlaW9zLWUtdGVsZWNvbXVuaWNhw6fDtWVzLm11c2V1bSIsCgkiY29ydmV0dGUubXVzZXVtIiwKCSJjb3N0dW1lLm11c2V1bSIsCgkiY291bnRyeWVzdGF0ZS5tdXNldW0iLAoJImNvdW50eS5tdXNldW0iLAoJImNyYWZ0cy5tdXNldW0iLAoJImNyYW5icm9vay5tdXNldW0iLAoJImNyZWF0aW9uLm11c2V1bSIsCgkiY3VsdHVyYWwubXVzZXVtIiwKCSJjdWx0dXJhbGNlbnRlci5tdXNldW0iLAoJImN1bHR1cmUubXVzZXVtIiwKCSJjeWJlci5tdXNldW0iLAoJImN5bXJ1Lm11c2V1bSIsCgkiZGFsaS5tdXNldW0iLAoJImRhbGxhcy5tdXNldW0iLAoJImRhdGFiYXNlLm11c2V1bSIsCgkiZGRyLm11c2V1bSIsCgkiZGVjb3JhdGl2ZWFydHMubXVzZXVtIiwKCSJkZWxhd2FyZS5tdXNldW0iLAoJImRlbG1lbmhvcnN0Lm11c2V1bSIsCgkiZGVubWFyay5tdXNldW0iLAoJImRlcG90Lm11c2V1bSIsCgkiZGVzaWduLm11c2V1bSIsCgkiZGV0cm9pdC5tdXNldW0iLAoJImRpbm9zYXVyLm11c2V1bSIsCgkiZGlzY292ZXJ5Lm11c2V1bSIsCgkiZG9sbHMubXVzZXVtIiwKCSJkb25vc3RpYS5tdXNldW0iLAoJImR1cmhhbS5tdXNldW0iLAoJImVhc3RhZnJpY2EubXVzZXVtIiwKCSJlYXN0Y29hc3QubXVzZXVtIiwKCSJlZHVjYXRpb24ubXVzZXVtIiwKCSJlZHVjYXRpb25hbC5tdXNldW0iLAoJImVneXB0aWFuLm11c2V1bSIsCgkiZWlzZW5iYWhuLm11c2V1bSIsCgkiZWxidXJnLm11c2V1bSIsCgkiZWx2ZW5kcmVsbC5tdXNldW0iLAoJImVtYnJvaWRlcnkubXVzZXVtIiwKCSJlbmN5Y2xvcGVkaWMubXVzZXVtIiwKCSJlbmdsYW5kLm11c2V1bSIsCgkiZW50b21vbG9neS5tdXNldW0iLAoJImVudmlyb25tZW50Lm11c2V1bSIsCgkiZW52aXJvbm1lbnRhbGNvbnNlcnZhdGlvbi5tdXNldW0iLAoJImVwaWxlcHN5Lm11c2V1bSIsCgkiZXNzZXgubXVzZXVtIiwKCSJlc3RhdGUubXVzZXVtIiwKCSJldGhub2xvZ3kubXVzZXVtIiwKCSJleGV0ZXIubXVzZXVtIiwKCSJleGhpYml0aW9uLm11c2V1bSIsCgkiZmFtaWx5Lm11c2V1bSIsCgkiZmFybS5tdXNldW0iLAoJImZhcm1lcXVpcG1lbnQubXVzZXVtIiwKCSJmYXJtZXJzLm11c2V1bSIsCgkiZmFybXN0ZWFkLm11c2V1bSIsCgkiZmllbGQubXVzZXVtIiwKCSJmaWd1ZXJlcy5tdXNldW0iLAoJImZpbGF0ZWxpYS5tdXNldW0iLAoJImZpbG0ubXVzZXVtIiwKCSJmaW5lYXJ0Lm11c2V1bSIsCgkiZmluZWFydHMubXVzZXVtIiwKCSJmaW5sYW5kLm11c2V1bSIsCgkiZmxhbmRlcnMubXVzZXVtIiwKCSJmbG9yaWRhLm11c2V1bSIsCgkiZm9yY2UubXVzZXVtIiwKCSJmb3J0bWlzc291bGEubXVzZXVtIiwKCSJmb3J0d29ydGgubXVzZXVtIiwKCSJmb3VuZGF0aW9uLm11c2V1bSIsCgkiZnJhbmNhaXNlLm11c2V1bSIsCgkiZnJhbmtmdXJ0Lm11c2V1bSIsCgkiZnJhbnppc2thbmVyLm11c2V1bSIsCgkiZnJlZW1hc29ucnkubXVzZXVtIiwKCSJmcmVpYnVyZy5tdXNldW0iLAoJImZyaWJvdXJnLm11c2V1bSIsCgkiZnJvZy5tdXNldW0iLAoJImZ1bmRhY2lvLm11c2V1bSIsCgkiZnVybml0dXJlLm11c2V1bSIsCgkiZ2FsbGVyeS5tdXNldW0iLAoJImdhcmRlbi5tdXNldW0iLAoJImdhdGV3YXkubXVzZXVtIiwKCSJnZWVsdmluY2subXVzZXVtIiwKCSJnZW1vbG9naWNhbC5tdXNldW0iLAoJImdlb2xvZ3kubXVzZXVtIiwKCSJnZW9yZ2lhLm11c2V1bSIsCgkiZ2llc3Nlbi5tdXNldW0iLAoJImdsYXMubXVzZXVtIiwKCSJnbGFzcy5tdXNldW0iLAoJImdvcmdlLm11c2V1bSIsCgkiZ3JhbmRyYXBpZHMubXVzZXVtIiwKCSJncmF6Lm11c2V1bSIsCgkiZ3Vlcm5zZXkubXVzZXVtIiwKCSJoYWxsb2ZmYW1lLm11c2V1bSIsCgkiaGFtYnVyZy5tdXNldW0iLAoJImhhbmRzb24ubXVzZXVtIiwKCSJoYXJ2ZXN0Y2VsZWJyYXRpb24ubXVzZXVtIiwKCSJoYXdhaWkubXVzZXVtIiwKCSJoZWFsdGgubXVzZXVtIiwKCSJoZWltYXR1bmR1aHJlbi5tdXNldW0iLAoJImhlbGxhcy5tdXNldW0iLAoJImhlbHNpbmtpLm11c2V1bSIsCgkiaGVtYnlnZHNmb3JidW5kLm11c2V1bSIsCgkiaGVyaXRhZ2UubXVzZXVtIiwKCSJoaXN0b2lyZS5tdXNldW0iLAoJImhpc3RvcmljYWwubXVzZXVtIiwKCSJoaXN0b3JpY2Fsc29jaWV0eS5tdXNldW0iLAoJImhpc3RvcmljaG91c2VzLm11c2V1bSIsCgkiaGlzdG9yaXNjaC5tdXNldW0iLAoJImhpc3RvcmlzY2hlcy5tdXNldW0iLAoJImhpc3RvcnkubXVzZXVtIiwKCSJoaXN0b3J5b2ZzY2llbmNlLm11c2V1bSIsCgkiaG9yb2xvZ3kubXVzZXVtIiwKCSJob3VzZS5tdXNldW0iLAoJImh1bWFuaXRpZXMubXVzZXVtIiwKCSJpbGx1c3RyYXRpb24ubXVzZXVtIiwKCSJpbWFnZWFuZHNvdW5kLm11c2V1bSIsCgkiaW5kaWFuLm11c2V1bSIsCgkiaW5kaWFuYS5tdXNldW0iLAoJImluZGlhbmFwb2xpcy5tdXNldW0iLAoJImluZGlhbm1hcmtldC5tdXNldW0iLAoJImludGVsbGlnZW5jZS5tdXNldW0iLAoJImludGVyYWN0aXZlLm11c2V1bSIsCgkiaXJhcS5tdXNldW0iLAoJImlyb24ubXVzZXVtIiwKCSJpc2xlb2ZtYW4ubXVzZXVtIiwKCSJqYW1pc29uLm11c2V1bSIsCgkiamVmZmVyc29uLm11c2V1bSIsCgkiamVydXNhbGVtLm11c2V1bSIsCgkiamV3ZWxyeS5tdXNldW0iLAoJImpld2lzaC5tdXNldW0iLAoJImpld2lzaGFydC5tdXNldW0iLAoJImpmay5tdXNldW0iLAoJImpvdXJuYWxpc20ubXVzZXVtIiwKCSJqdWRhaWNhLm11c2V1bSIsCgkianVkeWdhcmxhbmQubXVzZXVtIiwKCSJqdWVkaXNjaGVzLm11c2V1bSIsCgkianVpZi5tdXNldW0iLAoJImthcmF0ZS5tdXNldW0iLAoJImthcmlrYXR1ci5tdXNldW0iLAoJImtpZHMubXVzZXVtIiwKCSJrb2ViZW5oYXZuLm11c2V1bSIsCgkia29lbG4ubXVzZXVtIiwKCSJrdW5zdC5tdXNldW0iLAoJImt1bnN0c2FtbWx1bmcubXVzZXVtIiwKCSJrdW5zdHVuZGRlc2lnbi5tdXNldW0iLAoJImxhYm9yLm11c2V1bSIsCgkibGFib3VyLm11c2V1bSIsCgkibGFqb2xsYS5tdXNldW0iLAoJImxhbmNhc2hpcmUubXVzZXVtIiwKCSJsYW5kZXMubXVzZXVtIiwKCSJsYW5zLm11c2V1bSIsCgkibMOkbnMubXVzZXVtIiwKCSJsYXJzc29uLm11c2V1bSIsCgkibGV3aXNtaWxsZXIubXVzZXVtIiwKCSJsaW5jb2xuLm11c2V1bSIsCgkibGluei5tdXNldW0iLAoJImxpdmluZy5tdXNldW0iLAoJImxpdmluZ2hpc3RvcnkubXVzZXVtIiwKCSJsb2NhbGhpc3RvcnkubXVzZXVtIiwKCSJsb25kb24ubXVzZXVtIiwKCSJsb3NhbmdlbGVzLm11c2V1bSIsCgkibG91dnJlLm11c2V1bSIsCgkibG95YWxpc3QubXVzZXVtIiwKCSJsdWNlcm5lLm11c2V1bSIsCgkibHV4ZW1ib3VyZy5tdXNldW0iLAoJImx1emVybi5tdXNldW0iLAoJIm1hZC5tdXNldW0iLAoJIm1hZHJpZC5tdXNldW0iLAoJIm1hbGxvcmNhLm11c2V1bSIsCgkibWFuY2hlc3Rlci5tdXNldW0iLAoJIm1hbnNpb24ubXVzZXVtIiwKCSJtYW5zaW9ucy5tdXNldW0iLAoJIm1hbngubXVzZXVtIiwKCSJtYXJidXJnLm11c2V1bSIsCgkibWFyaXRpbWUubXVzZXVtIiwKCSJtYXJpdGltby5tdXNldW0iLAoJIm1hcnlsYW5kLm11c2V1bSIsCgkibWFyeWxodXJzdC5tdXNldW0iLAoJIm1lZGlhLm11c2V1bSIsCgkibWVkaWNhbC5tdXNldW0iLAoJIm1lZGl6aW5oaXN0b3Jpc2NoZXMubXVzZXVtIiwKCSJtZWVyZXMubXVzZXVtIiwKCSJtZW1vcmlhbC5tdXNldW0iLAoJIm1lc2F2ZXJkZS5tdXNldW0iLAoJIm1pY2hpZ2FuLm11c2V1bSIsCgkibWlkYXRsYW50aWMubXVzZXVtIiwKCSJtaWxpdGFyeS5tdXNldW0iLAoJIm1pbGwubXVzZXVtIiwKCSJtaW5lcnMubXVzZXVtIiwKCSJtaW5pbmcubXVzZXVtIiwKCSJtaW5uZXNvdGEubXVzZXVtIiwKCSJtaXNzaWxlLm11c2V1bSIsCgkibWlzc291bGEubXVzZXVtIiwKCSJtb2Rlcm4ubXVzZXVtIiwKCSJtb21hLm11c2V1bSIsCgkibW9uZXkubXVzZXVtIiwKCSJtb25tb3V0aC5tdXNldW0iLAoJIm1vbnRpY2VsbG8ubXVzZXVtIiwKCSJtb250cmVhbC5tdXNldW0iLAoJIm1vc2Nvdy5tdXNldW0iLAoJIm1vdG9yY3ljbGUubXVzZXVtIiwKCSJtdWVuY2hlbi5tdXNldW0iLAoJIm11ZW5zdGVyLm11c2V1bSIsCgkibXVsaG91c2UubXVzZXVtIiwKCSJtdW5jaWUubXVzZXVtIiwKCSJtdXNlZXQubXVzZXVtIiwKCSJtdXNldW1jZW50ZXIubXVzZXVtIiwKCSJtdXNldW12ZXJlbmlnaW5nLm11c2V1bSIsCgkibXVzaWMubXVzZXVtIiwKCSJuYXRpb25hbC5tdXNldW0iLAoJIm5hdGlvbmFsZmlyZWFybXMubXVzZXVtIiwKCSJuYXRpb25hbGhlcml0YWdlLm11c2V1bSIsCgkibmF0aXZlYW1lcmljYW4ubXVzZXVtIiwKCSJuYXR1cmFsaGlzdG9yeS5tdXNldW0iLAoJIm5hdHVyYWxoaXN0b3J5bXVzZXVtLm11c2V1bSIsCgkibmF0dXJhbHNjaWVuY2VzLm11c2V1bSIsCgkibmF0dXJlLm11c2V1bSIsCgkibmF0dXJoaXN0b3Jpc2NoZXMubXVzZXVtIiwKCSJuYXR1dXJ3ZXRlbnNjaGFwcGVuLm11c2V1bSIsCgkibmF1bWJ1cmcubXVzZXVtIiwKCSJuYXZhbC5tdXNldW0iLAoJIm5lYnJhc2thLm11c2V1bSIsCgkibmV1ZXMubXVzZXVtIiwKCSJuZXdoYW1wc2hpcmUubXVzZXVtIiwKCSJuZXdqZXJzZXkubXVzZXVtIiwKCSJuZXdtZXhpY28ubXVzZXVtIiwKCSJuZXdwb3J0Lm11c2V1bSIsCgkibmV3c3BhcGVyLm11c2V1bSIsCgkibmV3eW9yay5tdXNldW0iLAoJIm5pZXBjZS5tdXNldW0iLAoJIm5vcmZvbGsubXVzZXVtIiwKCSJub3J0aC5tdXNldW0iLAoJIm5ydy5tdXNldW0iLAoJIm55Yy5tdXNldW0iLAoJIm55bnkubXVzZXVtIiwKCSJvY2Vhbm9ncmFwaGljLm11c2V1bSIsCgkib2NlYW5vZ3JhcGhpcXVlLm11c2V1bSIsCgkib21haGEubXVzZXVtIiwKCSJvbmxpbmUubXVzZXVtIiwKCSJvbnRhcmlvLm11c2V1bSIsCgkib3BlbmFpci5tdXNldW0iLAoJIm9yZWdvbi5tdXNldW0iLAoJIm9yZWdvbnRyYWlsLm11c2V1bSIsCgkib3RhZ28ubXVzZXVtIiwKCSJveGZvcmQubXVzZXVtIiwKCSJwYWNpZmljLm11c2V1bSIsCgkicGFkZXJib3JuLm11c2V1bSIsCgkicGFsYWNlLm11c2V1bSIsCgkicGFsZW8ubXVzZXVtIiwKCSJwYWxtc3ByaW5ncy5tdXNldW0iLAoJInBhbmFtYS5tdXNldW0iLAoJInBhcmlzLm11c2V1bSIsCgkicGFzYWRlbmEubXVzZXVtIiwKCSJwaGFybWFjeS5tdXNldW0iLAoJInBoaWxhZGVscGhpYS5tdXNldW0iLAoJInBoaWxhZGVscGhpYWFyZWEubXVzZXVtIiwKCSJwaGlsYXRlbHkubXVzZXVtIiwKCSJwaG9lbml4Lm11c2V1bSIsCgkicGhvdG9ncmFwaHkubXVzZXVtIiwKCSJwaWxvdHMubXVzZXVtIiwKCSJwaXR0c2J1cmdoLm11c2V1bSIsCgkicGxhbmV0YXJpdW0ubXVzZXVtIiwKCSJwbGFudGF0aW9uLm11c2V1bSIsCgkicGxhbnRzLm11c2V1bSIsCgkicGxhemEubXVzZXVtIiwKCSJwb3J0YWwubXVzZXVtIiwKCSJwb3J0bGFuZC5tdXNldW0iLAoJInBvcnRsbGlnYXQubXVzZXVtIiwKCSJwb3N0cy1hbmQtdGVsZWNvbW11bmljYXRpb25zLm11c2V1bSIsCgkicHJlc2VydmF0aW9uLm11c2V1bSIsCgkicHJlc2lkaW8ubXVzZXVtIiwKCSJwcmVzcy5tdXNldW0iLAoJInByb2plY3QubXVzZXVtIiwKCSJwdWJsaWMubXVzZXVtIiwKCSJwdWJvbC5tdXNldW0iLAoJInF1ZWJlYy5tdXNldW0iLAoJInJhaWxyb2FkLm11c2V1bSIsCgkicmFpbHdheS5tdXNldW0iLAoJInJlc2VhcmNoLm11c2V1bSIsCgkicmVzaXN0YW5jZS5tdXNldW0iLAoJInJpb2RlamFuZWlyby5tdXNldW0iLAoJInJvY2hlc3Rlci5tdXNldW0iLAoJInJvY2thcnQubXVzZXVtIiwKCSJyb21hLm11c2V1bSIsCgkicnVzc2lhLm11c2V1bSIsCgkic2FpbnRsb3Vpcy5tdXNldW0iLAoJInNhbGVtLm11c2V1bSIsCgkic2FsdmFkb3JkYWxpLm11c2V1bSIsCgkic2FsemJ1cmcubXVzZXVtIiwKCSJzYW5kaWVnby5tdXNldW0iLAoJInNhbmZyYW5jaXNjby5tdXNldW0iLAoJInNhbnRhYmFyYmFyYS5tdXNldW0iLAoJInNhbnRhY3J1ei5tdXNldW0iLAoJInNhbnRhZmUubXVzZXVtIiwKCSJzYXNrYXRjaGV3YW4ubXVzZXVtIiwKCSJzYXR4Lm11c2V1bSIsCgkic2F2YW5uYWhnYS5tdXNldW0iLAoJInNjaGxlc2lzY2hlcy5tdXNldW0iLAoJInNjaG9lbmJydW5uLm11c2V1bSIsCgkic2Nob2tvbGFkZW4ubXVzZXVtIiwKCSJzY2hvb2wubXVzZXVtIiwKCSJzY2h3ZWl6Lm11c2V1bSIsCgkic2NpZW5jZS5tdXNldW0iLAoJInNjaWVuY2VhbmRoaXN0b3J5Lm11c2V1bSIsCgkic2NpZW5jZWFuZGluZHVzdHJ5Lm11c2V1bSIsCgkic2NpZW5jZWNlbnRlci5tdXNldW0iLAoJInNjaWVuY2VjZW50ZXJzLm11c2V1bSIsCgkic2NpZW5jZS1maWN0aW9uLm11c2V1bSIsCgkic2NpZW5jZWhpc3RvcnkubXVzZXVtIiwKCSJzY2llbmNlcy5tdXNldW0iLAoJInNjaWVuY2VzbmF0dXJlbGxlcy5tdXNldW0iLAoJInNjb3RsYW5kLm11c2V1bSIsCgkic2VhcG9ydC5tdXNldW0iLAoJInNldHRsZW1lbnQubXVzZXVtIiwKCSJzZXR0bGVycy5tdXNldW0iLAoJInNoZWxsLm11c2V1bSIsCgkic2hlcmJyb29rZS5tdXNldW0iLAoJInNpYmVuaWsubXVzZXVtIiwKCSJzaWxrLm11c2V1bSIsCgkic2tpLm11c2V1bSIsCgkic2tvbGUubXVzZXVtIiwKCSJzb2NpZXR5Lm11c2V1bSIsCgkic29sb2duZS5tdXNldW0iLAoJInNvdW5kYW5kdmlzaW9uLm11c2V1bSIsCgkic291dGhjYXJvbGluYS5tdXNldW0iLAoJInNvdXRod2VzdC5tdXNldW0iLAoJInNwYWNlLm11c2V1bSIsCgkic3B5Lm11c2V1bSIsCgkic3F1YXJlLm11c2V1bSIsCgkic3RhZHQubXVzZXVtIiwKCSJzdGFsYmFucy5tdXNldW0iLAoJInN0YXJuYmVyZy5tdXNldW0iLAoJInN0YXRlLm11c2V1bSIsCgkic3RhdGVvZmRlbGF3YXJlLm11c2V1bSIsCgkic3RhdGlvbi5tdXNldW0iLAoJInN0ZWFtLm11c2V1bSIsCgkic3RlaWVybWFyay5tdXNldW0iLAoJInN0am9obi5tdXNldW0iLAoJInN0b2NraG9sbS5tdXNldW0iLAoJInN0cGV0ZXJzYnVyZy5tdXNldW0iLAoJInN0dXR0Z2FydC5tdXNldW0iLAoJInN1aXNzZS5tdXNldW0iLAoJInN1cmdlb25zaGFsbC5tdXNldW0iLAoJInN1cnJleS5tdXNldW0iLAoJInN2aXp6ZXJhLm11c2V1bSIsCgkic3dlZGVuLm11c2V1bSIsCgkic3lkbmV5Lm11c2V1bSIsCgkidGFuay5tdXNldW0iLAoJInRjbS5tdXNldW0iLAoJInRlY2hub2xvZ3kubXVzZXVtIiwKCSJ0ZWxla29tbXVuaWthdGlvbi5tdXNldW0iLAoJInRlbGV2aXNpb24ubXVzZXVtIiwKCSJ0ZXhhcy5tdXNldW0iLAoJInRleHRpbGUubXVzZXVtIiwKCSJ0aGVhdGVyLm11c2V1bSIsCgkidGltZS5tdXNldW0iLAoJInRpbWVrZWVwaW5nLm11c2V1bSIsCgkidG9wb2xvZ3kubXVzZXVtIiwKCSJ0b3Jpbm8ubXVzZXVtIiwKCSJ0b3VjaC5tdXNldW0iLAoJInRvd24ubXVzZXVtIiwKCSJ0cmFuc3BvcnQubXVzZXVtIiwKCSJ0cmVlLm11c2V1bSIsCgkidHJvbGxleS5tdXNldW0iLAoJInRydXN0Lm11c2V1bSIsCgkidHJ1c3RlZS5tdXNldW0iLAoJInVocmVuLm11c2V1bSIsCgkidWxtLm11c2V1bSIsCgkidW5kZXJzZWEubXVzZXVtIiwKCSJ1bml2ZXJzaXR5Lm11c2V1bSIsCgkidXNhLm11c2V1bSIsCgkidXNhbnRpcXVlcy5tdXNldW0iLAoJInVzYXJ0cy5tdXNldW0iLAoJInVzY291bnRyeWVzdGF0ZS5tdXNldW0iLAoJInVzY3VsdHVyZS5tdXNldW0iLAoJInVzZGVjb3JhdGl2ZWFydHMubXVzZXVtIiwKCSJ1c2dhcmRlbi5tdXNldW0iLAoJInVzaGlzdG9yeS5tdXNldW0iLAoJInVzaHVhaWEubXVzZXVtIiwKCSJ1c2xpdmluZ2hpc3RvcnkubXVzZXVtIiwKCSJ1dGFoLm11c2V1bSIsCgkidXZpYy5tdXNldW0iLAoJInZhbGxleS5tdXNldW0iLAoJInZhbnRhYS5tdXNldW0iLAoJInZlcnNhaWxsZXMubXVzZXVtIiwKCSJ2aWtpbmcubXVzZXVtIiwKCSJ2aWxsYWdlLm11c2V1bSIsCgkidmlyZ2luaWEubXVzZXVtIiwKCSJ2aXJ0dWFsLm11c2V1bSIsCgkidmlydHVlbC5tdXNldW0iLAoJInZsYWFuZGVyZW4ubXVzZXVtIiwKCSJ2b2xrZW5rdW5kZS5tdXNldW0iLAoJIndhbGVzLm11c2V1bSIsCgkid2FsbG9uaWUubXVzZXVtIiwKCSJ3YXIubXVzZXVtIiwKCSJ3YXNoaW5ndG9uZGMubXVzZXVtIiwKCSJ3YXRjaGFuZGNsb2NrLm11c2V1bSIsCgkid2F0Y2gtYW5kLWNsb2NrLm11c2V1bSIsCgkid2VzdGVybi5tdXNldW0iLAoJIndlc3RmYWxlbi5tdXNldW0iLAoJIndoYWxpbmcubXVzZXVtIiwKCSJ3aWxkbGlmZS5tdXNldW0iLAoJIndpbGxpYW1zYnVyZy5tdXNldW0iLAoJIndpbmRtaWxsLm11c2V1bSIsCgkid29ya3Nob3AubXVzZXVtIiwKCSJ5b3JrLm11c2V1bSIsCgkieW9ya3NoaXJlLm11c2V1bSIsCgkieW9zZW1pdGUubXVzZXVtIiwKCSJ5b3V0aC5tdXNldW0iLAoJInpvb2xvZ2ljYWwubXVzZXVtIiwKCSJ6b29sb2d5Lm11c2V1bSIsCgki15nXqNeV16nXnNeZ150ubXVzZXVtIiwKCSLQuNC60L7QvC5tdXNldW0iLAoJIm12IiwKCSJhZXJvLm12IiwKCSJiaXoubXYiLAoJImNvbS5tdiIsCgkiY29vcC5tdiIsCgkiZWR1Lm12IiwKCSJnb3YubXYiLAoJImluZm8ubXYiLAoJImludC5tdiIsCgkibWlsLm12IiwKCSJtdXNldW0ubXYiLAoJIm5hbWUubXYiLAoJIm5ldC5tdiIsCgkib3JnLm12IiwKCSJwcm8ubXYiLAoJIm13IiwKCSJhYy5tdyIsCgkiYml6Lm13IiwKCSJjby5tdyIsCgkiY29tLm13IiwKCSJjb29wLm13IiwKCSJlZHUubXciLAoJImdvdi5tdyIsCgkiaW50Lm13IiwKCSJtdXNldW0ubXciLAoJIm5ldC5tdyIsCgkib3JnLm13IiwKCSJteCIsCgkiY29tLm14IiwKCSJvcmcubXgiLAoJImdvYi5teCIsCgkiZWR1Lm14IiwKCSJuZXQubXgiLAoJIm15IiwKCSJiaXoubXkiLAoJImNvbS5teSIsCgkiZWR1Lm15IiwKCSJnb3YubXkiLAoJIm1pbC5teSIsCgkibmFtZS5teSIsCgkibmV0Lm15IiwKCSJvcmcubXkiLAoJIm16IiwKCSJhYy5teiIsCgkiYWR2Lm16IiwKCSJjby5teiIsCgkiZWR1Lm16IiwKCSJnb3YubXoiLAoJIm1pbC5teiIsCgkibmV0Lm16IiwKCSJvcmcubXoiLAoJIm5hIiwKCSJpbmZvLm5hIiwKCSJwcm8ubmEiLAoJIm5hbWUubmEiLAoJInNjaG9vbC5uYSIsCgkib3IubmEiLAoJImRyLm5hIiwKCSJ1cy5uYSIsCgkibXgubmEiLAoJImNhLm5hIiwKCSJpbi5uYSIsCgkiY2MubmEiLAoJInR2Lm5hIiwKCSJ3cy5uYSIsCgkibW9iaS5uYSIsCgkiY28ubmEiLAoJImNvbS5uYSIsCgkib3JnLm5hIiwKCSJuYW1lIiwKCSJuYyIsCgkiYXNzby5uYyIsCgkibm9tLm5jIiwKCSJuZSIsCgkibmV0IiwKCSJuZiIsCgkiY29tLm5mIiwKCSJuZXQubmYiLAoJInBlci5uZiIsCgkicmVjLm5mIiwKCSJ3ZWIubmYiLAoJImFydHMubmYiLAoJImZpcm0ubmYiLAoJImluZm8ubmYiLAoJIm90aGVyLm5mIiwKCSJzdG9yZS5uZiIsCgkibmciLAoJImNvbS5uZyIsCgkiZWR1Lm5nIiwKCSJnb3YubmciLAoJImkubmciLAoJIm1pbC5uZyIsCgkibW9iaS5uZyIsCgkibmFtZS5uZyIsCgkibmV0Lm5nIiwKCSJvcmcubmciLAoJInNjaC5uZyIsCgkibmkiLAoJImFjLm5pIiwKCSJiaXoubmkiLAoJImNvLm5pIiwKCSJjb20ubmkiLAoJImVkdS5uaSIsCgkiZ29iLm5pIiwKCSJpbi5uaSIsCgkiaW5mby5uaSIsCgkiaW50Lm5pIiwKCSJtaWwubmkiLAoJIm5ldC5uaSIsCgkibm9tLm5pIiwKCSJvcmcubmkiLAoJIndlYi5uaSIsCgkibmwiLAoJIm5vIiwKCSJmaHMubm8iLAoJInZncy5ubyIsCgkiZnlsa2VzYmlibC5ubyIsCgkiZm9sa2ViaWJsLm5vIiwKCSJtdXNldW0ubm8iLAoJImlkcmV0dC5ubyIsCgkicHJpdi5ubyIsCgkibWlsLm5vIiwKCSJzdGF0Lm5vIiwKCSJkZXAubm8iLAoJImtvbW11bmUubm8iLAoJImhlcmFkLm5vIiwKCSJhYS5ubyIsCgkiYWgubm8iLAoJImJ1Lm5vIiwKCSJmbS5ubyIsCgkiaGwubm8iLAoJImhtLm5vIiwKCSJqYW4tbWF5ZW4ubm8iLAoJIm1yLm5vIiwKCSJubC5ubyIsCgkibnQubm8iLAoJIm9mLm5vIiwKCSJvbC5ubyIsCgkib3Nsby5ubyIsCgkicmwubm8iLAoJInNmLm5vIiwKCSJzdC5ubyIsCgkic3ZhbGJhcmQubm8iLAoJInRtLm5vIiwKCSJ0ci5ubyIsCgkidmEubm8iLAoJInZmLm5vIiwKCSJncy5hYS5ubyIsCgkiZ3MuYWgubm8iLAoJImdzLmJ1Lm5vIiwKCSJncy5mbS5ubyIsCgkiZ3MuaGwubm8iLAoJImdzLmhtLm5vIiwKCSJncy5qYW4tbWF5ZW4ubm8iLAoJImdzLm1yLm5vIiwKCSJncy5ubC5ubyIsCgkiZ3MubnQubm8iLAoJImdzLm9mLm5vIiwKCSJncy5vbC5ubyIsCgkiZ3Mub3Nsby5ubyIsCgkiZ3Mucmwubm8iLAoJImdzLnNmLm5vIiwKCSJncy5zdC5ubyIsCgkiZ3Muc3ZhbGJhcmQubm8iLAoJImdzLnRtLm5vIiwKCSJncy50ci5ubyIsCgkiZ3MudmEubm8iLAoJImdzLnZmLm5vIiwKCSJha3JlaGFtbi5ubyIsCgkiw6VrcmVoYW1uLm5vIiwKCSJhbGdhcmQubm8iLAoJIsOlbGfDpXJkLm5vIiwKCSJhcm5hLm5vIiwKCSJicnVtdW5kZGFsLm5vIiwKCSJicnluZS5ubyIsCgkiYnJvbm5veXN1bmQubm8iLAoJImJyw7hubsO4eXN1bmQubm8iLAoJImRyb2Jhay5ubyIsCgkiZHLDuGJhay5ubyIsCgkiZWdlcnN1bmQubm8iLAoJImZldHN1bmQubm8iLAoJImZsb3JvLm5vIiwKCSJmbG9yw7gubm8iLAoJImZyZWRyaWtzdGFkLm5vIiwKCSJob2trc3VuZC5ubyIsCgkiaG9uZWZvc3Mubm8iLAoJImjDuG5lZm9zcy5ubyIsCgkiamVzc2hlaW0ubm8iLAoJImpvcnBlbGFuZC5ubyIsCgkiasO4cnBlbGFuZC5ubyIsCgkia2lya2VuZXMubm8iLAoJImtvcGVydmlrLm5vIiwKCSJrcm9rc3RhZGVsdmEubm8iLAoJImxhbmdldmFnLm5vIiwKCSJsYW5nZXbDpWcubm8iLAoJImxlaXJ2aWsubm8iLAoJIm1qb25kYWxlbi5ubyIsCgkibWrDuG5kYWxlbi5ubyIsCgkibW8taS1yYW5hLm5vIiwKCSJtb3Nqb2VuLm5vIiwKCSJtb3Nqw7hlbi5ubyIsCgkibmVzb2RkdGFuZ2VuLm5vIiwKCSJvcmthbmdlci5ubyIsCgkib3NveXJvLm5vIiwKCSJvc8O4eXJvLm5vIiwKCSJyYWhvbHQubm8iLAoJInLDpWhvbHQubm8iLAoJInNhbmRuZXNzam9lbi5ubyIsCgkic2FuZG5lc3Nqw7hlbi5ubyIsCgkic2tlZHNtb2tvcnNldC5ubyIsCgkic2xhdHR1bS5ubyIsCgkic3BqZWxrYXZpay5ubyIsCgkic3RhdGhlbGxlLm5vIiwKCSJzdGF2ZXJuLm5vIiwKCSJzdGpvcmRhbHNoYWxzZW4ubm8iLAoJInN0asO4cmRhbHNoYWxzZW4ubm8iLAoJInRhbmFuZ2VyLm5vIiwKCSJ0cmFuYnkubm8iLAoJInZvc3NldmFuZ2VuLm5vIiwKCSJhZmpvcmQubm8iLAoJIsOlZmpvcmQubm8iLAoJImFnZGVuZXMubm8iLAoJImFsLm5vIiwKCSLDpWwubm8iLAoJImFsZXN1bmQubm8iLAoJIsOlbGVzdW5kLm5vIiwKCSJhbHN0YWhhdWcubm8iLAoJImFsdGEubm8iLAoJIsOhbHTDoS5ubyIsCgkiYWxhaGVhZGp1Lm5vIiwKCSLDoWxhaGVhZGp1Lm5vIiwKCSJhbHZkYWwubm8iLAoJImFtbGkubm8iLAoJIsOlbWxpLm5vIiwKCSJhbW90Lm5vIiwKCSLDpW1vdC5ubyIsCgkiYW5kZWJ1Lm5vIiwKCSJhbmRveS5ubyIsCgkiYW5kw7h5Lm5vIiwKCSJhbmRhc3VvbG8ubm8iLAoJImFyZGFsLm5vIiwKCSLDpXJkYWwubm8iLAoJImFyZW1hcmsubm8iLAoJImFyZW5kYWwubm8iLAoJIsOlcy5ubyIsCgkiYXNlcmFsLm5vIiwKCSLDpXNlcmFsLm5vIiwKCSJhc2tlci5ubyIsCgkiYXNraW0ubm8iLAoJImFza3ZvbGwubm8iLAoJImFza295Lm5vIiwKCSJhc2vDuHkubm8iLAoJImFzbmVzLm5vIiwKCSLDpXNuZXMubm8iLAoJImF1ZG5lZGFsbi5ubyIsCgkiYXVrcmEubm8iLAoJImF1cmUubm8iLAoJImF1cmxhbmQubm8iLAoJImF1cnNrb2ctaG9sYW5kLm5vIiwKCSJhdXJza29nLWjDuGxhbmQubm8iLAoJImF1c3Rldm9sbC5ubyIsCgkiYXVzdHJoZWltLm5vIiwKCSJhdmVyb3kubm8iLAoJImF2ZXLDuHkubm8iLAoJImJhbGVzdHJhbmQubm8iLAoJImJhbGxhbmdlbi5ubyIsCgkiYmFsYXQubm8iLAoJImLDoWzDoXQubm8iLAoJImJhbHNmam9yZC5ubyIsCgkiYmFoY2NhdnVvdG5hLm5vIiwKCSJiw6FoY2NhdnVvdG5hLm5vIiwKCSJiYW1ibGUubm8iLAoJImJhcmR1Lm5vIiwKCSJiZWFyZHUubm8iLAoJImJlaWFybi5ubyIsCgkiYmFqZGRhci5ubyIsCgkiYsOhamRkYXIubm8iLAoJImJhaWRhci5ubyIsCgkiYsOhaWTDoXIubm8iLAoJImJlcmcubm8iLAoJImJlcmdlbi5ubyIsCgkiYmVybGV2YWcubm8iLAoJImJlcmxldsOlZy5ubyIsCgkiYmVhcmFsdmFoa2kubm8iLAoJImJlYXJhbHbDoWhraS5ubyIsCgkiYmluZGFsLm5vIiwKCSJiaXJrZW5lcy5ubyIsCgkiYmphcmtveS5ubyIsCgkiYmphcmvDuHkubm8iLAoJImJqZXJrcmVpbS5ubyIsCgkiYmp1Z24ubm8iLAoJImJvZG8ubm8iLAoJImJvZMO4Lm5vIiwKCSJiYWRhZGRqYS5ubyIsCgkiYsOlZMOlZGRqw6Uubm8iLAoJImJ1ZGVqanUubm8iLAoJImJva24ubm8iLAoJImJyZW1hbmdlci5ubyIsCgkiYnJvbm5veS5ubyIsCgkiYnLDuG5uw7h5Lm5vIiwKCSJieWdsYW5kLm5vIiwKCSJieWtsZS5ubyIsCgkiYmFydW0ubm8iLAoJImLDpnJ1bS5ubyIsCgkiYm8udGVsZW1hcmsubm8iLAoJImLDuC50ZWxlbWFyay5ubyIsCgkiYm8ubm9yZGxhbmQubm8iLAoJImLDuC5ub3JkbGFuZC5ubyIsCgkiYmlldmF0Lm5vIiwKCSJiaWV2w6F0Lm5vIiwKCSJib21sby5ubyIsCgkiYsO4bWxvLm5vIiwKCSJiYXRzZmpvcmQubm8iLAoJImLDpXRzZmpvcmQubm8iLAoJImJhaGNhdnVvdG5hLm5vIiwKCSJiw6FoY2F2dW90bmEubm8iLAoJImRvdnJlLm5vIiwKCSJkcmFtbWVuLm5vIiwKCSJkcmFuZ2VkYWwubm8iLAoJImR5cm95Lm5vIiwKCSJkeXLDuHkubm8iLAoJImRvbm5hLm5vIiwKCSJkw7hubmEubm8iLAoJImVpZC5ubyIsCgkiZWlkZmpvcmQubm8iLAoJImVpZHNiZXJnLm5vIiwKCSJlaWRza29nLm5vIiwKCSJlaWRzdm9sbC5ubyIsCgkiZWlnZXJzdW5kLm5vIiwKCSJlbHZlcnVtLm5vIiwKCSJlbmViYWtrLm5vIiwKCSJlbmdlcmRhbC5ubyIsCgkiZXRuZS5ubyIsCgkiZXRuZWRhbC5ubyIsCgkiZXZlbmVzLm5vIiwKCSJldmVuYXNzaS5ubyIsCgkiZXZlbsOhxaHFoWkubm8iLAoJImV2amUtb2ctaG9ybm5lcy5ubyIsCgkiZmFyc3VuZC5ubyIsCgkiZmF1c2tlLm5vIiwKCSJmdW9zc2tvLm5vIiwKCSJmdW9pc2t1Lm5vIiwKCSJmZWRqZS5ubyIsCgkiZmV0Lm5vIiwKCSJmaW5ub3kubm8iLAoJImZpbm7DuHkubm8iLAoJImZpdGphci5ubyIsCgkiZmphbGVyLm5vIiwKCSJmamVsbC5ubyIsCgkiZmxha3N0YWQubm8iLAoJImZsYXRhbmdlci5ubyIsCgkiZmxla2tlZmpvcmQubm8iLAoJImZsZXNiZXJnLm5vIiwKCSJmbG9yYS5ubyIsCgkiZmxhLm5vIiwKCSJmbMOlLm5vIiwKCSJmb2xsZGFsLm5vIiwKCSJmb3JzYW5kLm5vIiwKCSJmb3NuZXMubm8iLAoJImZyZWkubm8iLAoJImZyb2duLm5vIiwKCSJmcm9sYW5kLm5vIiwKCSJmcm9zdGEubm8iLAoJImZyYW5hLm5vIiwKCSJmcsOmbmEubm8iLAoJImZyb3lhLm5vIiwKCSJmcsO4eWEubm8iLAoJImZ1c2Eubm8iLAoJImZ5cmVzZGFsLm5vIiwKCSJmb3JkZS5ubyIsCgkiZsO4cmRlLm5vIiwKCSJnYW12aWsubm8iLAoJImdhbmdhdmlpa2Eubm8iLAoJImfDocWLZ2F2aWlrYS5ubyIsCgkiZ2F1bGFyLm5vIiwKCSJnYXVzZGFsLm5vIiwKCSJnaWxkZXNrYWwubm8iLAoJImdpbGRlc2vDpWwubm8iLAoJImdpc2tlLm5vIiwKCSJnamVtbmVzLm5vIiwKCSJnamVyZHJ1bS5ubyIsCgkiZ2plcnN0YWQubm8iLAoJImdqZXNkYWwubm8iLAoJImdqb3Zpay5ubyIsCgkiZ2rDuHZpay5ubyIsCgkiZ2xvcHBlbi5ubyIsCgkiZ29sLm5vIiwKCSJncmFuLm5vIiwKCSJncmFuZS5ubyIsCgkiZ3JhbnZpbi5ubyIsCgkiZ3JhdGFuZ2VuLm5vIiwKCSJncmltc3RhZC5ubyIsCgkiZ3Jvbmcubm8iLAoJImtyYWFuZ2hrZS5ubyIsCgkia3LDpWFuZ2hrZS5ubyIsCgkiZ3J1ZS5ubyIsCgkiZ3VsZW4ubm8iLAoJImhhZHNlbC5ubyIsCgkiaGFsZGVuLm5vIiwKCSJoYWxzYS5ubyIsCgkiaGFtYXIubm8iLAoJImhhbWFyb3kubm8iLAoJImhhYm1lci5ubyIsCgkiaMOhYm1lci5ubyIsCgkiaGFwbWlyLm5vIiwKCSJow6FwbWlyLm5vIiwKCSJoYW1tZXJmZXN0Lm5vIiwKCSJoYW1tYXJmZWFzdGEubm8iLAoJImjDoW1tw6FyZmVhc3RhLm5vIiwKCSJoYXJhbS5ubyIsCgkiaGFyZWlkLm5vIiwKCSJoYXJzdGFkLm5vIiwKCSJoYXN2aWsubm8iLAoJImFrbm9sdW9rdGEubm8iLAoJIsOha8WLb2x1b2t0YS5ubyIsCgkiaGF0dGZqZWxsZGFsLm5vIiwKCSJhYXJib3J0ZS5ubyIsCgkiaGF1Z2VzdW5kLm5vIiwKCSJoZW1uZS5ubyIsCgkiaGVtbmVzLm5vIiwKCSJoZW1zZWRhbC5ubyIsCgkiaGVyb3kubW9yZS1vZy1yb21zZGFsLm5vIiwKCSJoZXLDuHkubcO4cmUtb2ctcm9tc2RhbC5ubyIsCgkiaGVyb3kubm9yZGxhbmQubm8iLAoJImhlcsO4eS5ub3JkbGFuZC5ubyIsCgkiaGl0cmEubm8iLAoJImhqYXJ0ZGFsLm5vIiwKCSJoamVsbWVsYW5kLm5vIiwKCSJob2JvbC5ubyIsCgkiaG9iw7hsLm5vIiwKCSJob2Yubm8iLAoJImhvbC5ubyIsCgkiaG9sZS5ubyIsCgkiaG9sbWVzdHJhbmQubm8iLAoJImhvbHRhbGVuLm5vIiwKCSJob2x0w6VsZW4ubm8iLAoJImhvcm5pbmRhbC5ubyIsCgkiaG9ydGVuLm5vIiwKCSJodXJkYWwubm8iLAoJImh1cnVtLm5vIiwKCSJodmFsZXIubm8iLAoJImh5bGxlc3RhZC5ubyIsCgkiaGFnZWJvc3RhZC5ubyIsCgkiaMOmZ2Vib3N0YWQubm8iLAoJImhveWFuZ2VyLm5vIiwKCSJow7h5YW5nZXIubm8iLAoJImhveWxhbmRldC5ubyIsCgkiaMO4eWxhbmRldC5ubyIsCgkiaGEubm8iLAoJImjDpS5ubyIsCgkiaWJlc3RhZC5ubyIsCgkiaW5kZXJveS5ubyIsCgkiaW5kZXLDuHkubm8iLAoJIml2ZWxhbmQubm8iLAoJImpldm5ha2VyLm5vIiwKCSJqb25kYWwubm8iLAoJImpvbHN0ZXIubm8iLAoJImrDuGxzdGVyLm5vIiwKCSJrYXJhc2pvay5ubyIsCgkia2FyYXNqb2hrYS5ubyIsCgkia8OhcsOhxaFqb2hrYS5ubyIsCgkia2FybHNveS5ubyIsCgkiZ2Fsc2Eubm8iLAoJImfDoWxzw6Eubm8iLAoJImthcm1veS5ubyIsCgkia2FybcO4eS5ubyIsCgkia2F1dG9rZWluby5ubyIsCgkiZ3VvdmRhZ2VhaWRudS5ubyIsCgkia2xlcHAubm8iLAoJImtsYWJ1Lm5vIiwKCSJrbMOmYnUubm8iLAoJImtvbmdzYmVyZy5ubyIsCgkia29uZ3N2aW5nZXIubm8iLAoJImtyYWdlcm8ubm8iLAoJImtyYWdlcsO4Lm5vIiwKCSJrcmlzdGlhbnNhbmQubm8iLAoJImtyaXN0aWFuc3VuZC5ubyIsCgkia3JvZHNoZXJhZC5ubyIsCgkia3LDuGRzaGVyYWQubm8iLAoJImt2YWxzdW5kLm5vIiwKCSJyYWhra2VyYXZqdS5ubyIsCgkicsOhaGtrZXLDoXZqdS5ubyIsCgkia3ZhbS5ubyIsCgkia3ZpbmVzZGFsLm5vIiwKCSJrdmlubmhlcmFkLm5vIiwKCSJrdml0ZXNlaWQubm8iLAoJImt2aXRzb3kubm8iLAoJImt2aXRzw7h5Lm5vIiwKCSJrdmFmam9yZC5ubyIsCgkia3bDpmZqb3JkLm5vIiwKCSJnaWVodGF2dW9hdG5hLm5vIiwKCSJrdmFuYW5nZW4ubm8iLAoJImt2w6ZuYW5nZW4ubm8iLAoJIm5hdnVvdG5hLm5vIiwKCSJuw6F2dW90bmEubm8iLAoJImthZmpvcmQubm8iLAoJImvDpWZqb3JkLm5vIiwKCSJnYWl2dW90bmEubm8iLAoJImfDoWl2dW90bmEubm8iLAoJImxhcnZpay5ubyIsCgkibGF2YW5nZW4ubm8iLAoJImxhdmFnaXMubm8iLAoJImxvYWJhdC5ubyIsCgkibG9hYsOhdC5ubyIsCgkibGViZXNieS5ubyIsCgkiZGF2dmVzaWlkYS5ubyIsCgkibGVpa2FuZ2VyLm5vIiwKCSJsZWlyZmpvcmQubm8iLAoJImxla2Eubm8iLAoJImxla3N2aWsubm8iLAoJImxlbnZpay5ubyIsCgkibGVhbmdhdmlpa2Eubm8iLAoJImxlYcWLZ2F2aWlrYS5ubyIsCgkibGVzamEubm8iLAoJImxldmFuZ2VyLm5vIiwKCSJsaWVyLm5vIiwKCSJsaWVybmUubm8iLAoJImxpbGxlaGFtbWVyLm5vIiwKCSJsaWxsZXNhbmQubm8iLAoJImxpbmRlc25lcy5ubyIsCgkibGluZGFzLm5vIiwKCSJsaW5kw6VzLm5vIiwKCSJsb20ubm8iLAoJImxvcHBhLm5vIiwKCSJsYWhwcGkubm8iLAoJImzDoWhwcGkubm8iLAoJImx1bmQubm8iLAoJImx1bm5lci5ubyIsCgkibHVyb3kubm8iLAoJImx1csO4eS5ubyIsCgkibHVzdGVyLm5vIiwKCSJseW5nZGFsLm5vIiwKCSJseW5nZW4ubm8iLAoJIml2Z3Uubm8iLAoJImxhcmRhbC5ubyIsCgkibGVyZGFsLm5vIiwKCSJsw6ZyZGFsLm5vIiwKCSJsb2Rpbmdlbi5ubyIsCgkibMO4ZGluZ2VuLm5vIiwKCSJsb3JlbnNrb2cubm8iLAoJImzDuHJlbnNrb2cubm8iLAoJImxvdGVuLm5vIiwKCSJsw7h0ZW4ubm8iLAoJIm1hbHZpay5ubyIsCgkibWFzb3kubm8iLAoJIm3DpXPDuHkubm8iLAoJIm11b3NhdC5ubyIsCgkibXVvc8OhdC5ubyIsCgkibWFuZGFsLm5vIiwKCSJtYXJrZXIubm8iLAoJIm1hcm5hcmRhbC5ubyIsCgkibWFzZmpvcmRlbi5ubyIsCgkibWVsYW5kLm5vIiwKCSJtZWxkYWwubm8iLAoJIm1lbGh1cy5ubyIsCgkibWVsb3kubm8iLAoJIm1lbMO4eS5ubyIsCgkibWVyYWtlci5ubyIsCgkibWVyw6VrZXIubm8iLAoJIm1vYXJla2Uubm8iLAoJIm1vw6VyZWtlLm5vIiwKCSJtaWRzdW5kLm5vIiwKCSJtaWR0cmUtZ2F1bGRhbC5ubyIsCgkibW9kYWxlbi5ubyIsCgkibW9kdW0ubm8iLAoJIm1vbGRlLm5vIiwKCSJtb3NrZW5lcy5ubyIsCgkibW9zcy5ubyIsCgkibW9zdmlrLm5vIiwKCSJtYWxzZWx2Lm5vIiwKCSJtw6Vsc2Vsdi5ubyIsCgkibWFsYXR2dW9wbWkubm8iLAoJIm3DoWxhdHZ1b3BtaS5ubyIsCgkibmFtZGFsc2VpZC5ubyIsCgkiYWVqcmllLm5vIiwKCSJuYW1zb3Mubm8iLAoJIm5hbXNza29nYW4ubm8iLAoJIm5hYW1lc2pldnVlbWllLm5vIiwKCSJuw6XDpW1lc2pldnVlbWllLm5vIiwKCSJsYWFrZXN2dWVtaWUubm8iLAoJIm5hbm5lc3RhZC5ubyIsCgkibmFydmlrLm5vIiwKCSJuYXJ2aWlrYS5ubyIsCgkibmF1c3RkYWwubm8iLAoJIm5lZHJlLWVpa2VyLm5vIiwKCSJuZXMuYWtlcnNodXMubm8iLAoJIm5lcy5idXNrZXJ1ZC5ubyIsCgkibmVzbmEubm8iLAoJIm5lc29kZGVuLm5vIiwKCSJuZXNzZWJ5Lm5vIiwKCSJ1bmphcmdhLm5vIiwKCSJ1bmrDoXJnYS5ubyIsCgkibmVzc2V0Lm5vIiwKCSJuaXNzZWRhbC5ubyIsCgkibml0dGVkYWwubm8iLAoJIm5vcmQtYXVyZGFsLm5vIiwKCSJub3JkLWZyb24ubm8iLAoJIm5vcmQtb2RhbC5ubyIsCgkibm9yZGRhbC5ubyIsCgkibm9yZGthcHAubm8iLAoJImRhdnZlbmphcmdhLm5vIiwKCSJkYXZ2ZW5qw6FyZ2Eubm8iLAoJIm5vcmRyZS1sYW5kLm5vIiwKCSJub3JkcmVpc2Eubm8iLAoJInJhaXNhLm5vIiwKCSJyw6Fpc2Eubm8iLAoJIm5vcmUtb2ctdXZkYWwubm8iLAoJIm5vdG9kZGVuLm5vIiwKCSJuYXJveS5ubyIsCgkibsOmcsO4eS5ubyIsCgkibm90dGVyb3kubm8iLAoJIm7DuHR0ZXLDuHkubm8iLAoJIm9kZGEubm8iLAoJIm9rc25lcy5ubyIsCgkiw7hrc25lcy5ubyIsCgkib3BwZGFsLm5vIiwKCSJvcHBlZ2FyZC5ubyIsCgkib3BwZWfDpXJkLm5vIiwKCSJvcmtkYWwubm8iLAoJIm9ybGFuZC5ubyIsCgkiw7hybGFuZC5ubyIsCgkib3Jza29nLm5vIiwKCSLDuHJza29nLm5vIiwKCSJvcnN0YS5ubyIsCgkiw7hyc3RhLm5vIiwKCSJvcy5oZWRtYXJrLm5vIiwKCSJvcy5ob3JkYWxhbmQubm8iLAoJIm9zZW4ubm8iLAoJIm9zdGVyb3kubm8iLAoJIm9zdGVyw7h5Lm5vIiwKCSJvc3RyZS10b3Rlbi5ubyIsCgkiw7hzdHJlLXRvdGVuLm5vIiwKCSJvdmVyaGFsbGEubm8iLAoJIm92cmUtZWlrZXIubm8iLAoJIsO4dnJlLWVpa2VyLm5vIiwKCSJveWVyLm5vIiwKCSLDuHllci5ubyIsCgkib3lnYXJkZW4ubm8iLAoJIsO4eWdhcmRlbi5ubyIsCgkib3lzdHJlLXNsaWRyZS5ubyIsCgkiw7h5c3RyZS1zbGlkcmUubm8iLAoJInBvcnNhbmdlci5ubyIsCgkicG9yc2FuZ3Uubm8iLAoJInBvcnPDocWLZ3Uubm8iLAoJInBvcnNncnVubi5ubyIsCgkicmFkb3kubm8iLAoJInJhZMO4eS5ubyIsCgkicmFra2VzdGFkLm5vIiwKCSJyYW5hLm5vIiwKCSJydW92YXQubm8iLAoJInJhbmRhYmVyZy5ubyIsCgkicmF1bWEubm8iLAoJInJlbmRhbGVuLm5vIiwKCSJyZW5uZWJ1Lm5vIiwKCSJyZW5uZXNveS5ubyIsCgkicmVubmVzw7h5Lm5vIiwKCSJyaW5kYWwubm8iLAoJInJpbmdlYnUubm8iLAoJInJpbmdlcmlrZS5ubyIsCgkicmluZ3Nha2VyLm5vIiwKCSJyaXNzYS5ubyIsCgkicmlzb3Iubm8iLAoJInJpc8O4ci5ubyIsCgkicm9hbi5ubyIsCgkicm9sbGFnLm5vIiwKCSJyeWdnZS5ubyIsCgkicmFsaW5nZW4ubm8iLAoJInLDpmxpbmdlbi5ubyIsCgkicm9kb3kubm8iLAoJInLDuGTDuHkubm8iLAoJInJvbXNrb2cubm8iLAoJInLDuG1za29nLm5vIiwKCSJyb3Jvcy5ubyIsCgkicsO4cm9zLm5vIiwKCSJyb3N0Lm5vIiwKCSJyw7hzdC5ubyIsCgkicm95a2VuLm5vIiwKCSJyw7h5a2VuLm5vIiwKCSJyb3lydmlrLm5vIiwKCSJyw7h5cnZpay5ubyIsCgkicmFkZS5ubyIsCgkicsOlZGUubm8iLAoJInNhbGFuZ2VuLm5vIiwKCSJzaWVsbGFrLm5vIiwKCSJzYWx0ZGFsLm5vIiwKCSJzYWxhdC5ubyIsCgkic8OhbMOhdC5ubyIsCgkic8OhbGF0Lm5vIiwKCSJzYW1uYW5nZXIubm8iLAoJInNhbmRlLm1vcmUtb2ctcm9tc2RhbC5ubyIsCgkic2FuZGUubcO4cmUtb2ctcm9tc2RhbC5ubyIsCgkic2FuZGUudmVzdGZvbGQubm8iLAoJInNhbmRlZmpvcmQubm8iLAoJInNhbmRuZXMubm8iLAoJInNhbmRveS5ubyIsCgkic2FuZMO4eS5ubyIsCgkic2FycHNib3JnLm5vIiwKCSJzYXVkYS5ubyIsCgkic2F1aGVyYWQubm8iLAoJInNlbC5ubyIsCgkic2VsYnUubm8iLAoJInNlbGplLm5vIiwKCSJzZWxqb3JkLm5vIiwKCSJzaWdkYWwubm8iLAoJInNpbGphbi5ubyIsCgkic2lyZGFsLm5vIiwKCSJza2F1bi5ubyIsCgkic2tlZHNtby5ubyIsCgkic2tpLm5vIiwKCSJza2llbi5ubyIsCgkic2tpcHR2ZXQubm8iLAoJInNramVydm95Lm5vIiwKCSJza2plcnbDuHkubm8iLAoJInNraWVydmEubm8iLAoJInNraWVydsOhLm5vIiwKCSJza2phay5ubyIsCgkic2tqw6VrLm5vIiwKCSJza29kamUubm8iLAoJInNrYW5sYW5kLm5vIiwKCSJza8OlbmxhbmQubm8iLAoJInNrYW5pdC5ubyIsCgkic2vDoW5pdC5ubyIsCgkic21vbGEubm8iLAoJInNtw7hsYS5ubyIsCgkic25pbGxmam9yZC5ubyIsCgkic25hc2Eubm8iLAoJInNuw6VzYS5ubyIsCgkic25vYXNhLm5vIiwKCSJzbmFhc2Uubm8iLAoJInNuw6Vhc2Uubm8iLAoJInNvZ25kYWwubm8iLAoJInNva25kYWwubm8iLAoJInNvbGEubm8iLAoJInNvbHVuZC5ubyIsCgkic29uZ2RhbGVuLm5vIiwKCSJzb3J0bGFuZC5ubyIsCgkic3B5ZGViZXJnLm5vIiwKCSJzdGFuZ2Uubm8iLAoJInN0YXZhbmdlci5ubyIsCgkic3RlaWdlbi5ubyIsCgkic3RlaW5ramVyLm5vIiwKCSJzdGpvcmRhbC5ubyIsCgkic3Rqw7hyZGFsLm5vIiwKCSJzdG9ra2Uubm8iLAoJInN0b3ItZWx2ZGFsLm5vIiwKCSJzdG9yZC5ubyIsCgkic3RvcmRhbC5ubyIsCgkic3RvcmZqb3JkLm5vIiwKCSJvbWFzdnVvdG5hLm5vIiwKCSJzdHJhbmQubm8iLAoJInN0cmFuZGEubm8iLAoJInN0cnluLm5vIiwKCSJzdWxhLm5vIiwKCSJzdWxkYWwubm8iLAoJInN1bmQubm8iLAoJInN1bm5kYWwubm8iLAoJInN1cm5hZGFsLm5vIiwKCSJzdmVpby5ubyIsCgkic3ZlbHZpay5ubyIsCgkic3lra3lsdmVuLm5vIiwKCSJzb2duZS5ubyIsCgkic8O4Z25lLm5vIiwKCSJzb21uYS5ubyIsCgkic8O4bW5hLm5vIiwKCSJzb25kcmUtbGFuZC5ubyIsCgkic8O4bmRyZS1sYW5kLm5vIiwKCSJzb3ItYXVyZGFsLm5vIiwKCSJzw7hyLWF1cmRhbC5ubyIsCgkic29yLWZyb24ubm8iLAoJInPDuHItZnJvbi5ubyIsCgkic29yLW9kYWwubm8iLAoJInPDuHItb2RhbC5ubyIsCgkic29yLXZhcmFuZ2VyLm5vIiwKCSJzw7hyLXZhcmFuZ2VyLm5vIiwKCSJtYXR0YS12YXJqamF0Lm5vIiwKCSJtw6F0dGEtdsOhcmpqYXQubm8iLAoJInNvcmZvbGQubm8iLAoJInPDuHJmb2xkLm5vIiwKCSJzb3JyZWlzYS5ubyIsCgkic8O4cnJlaXNhLm5vIiwKCSJzb3J1bS5ubyIsCgkic8O4cnVtLm5vIiwKCSJ0YW5hLm5vIiwKCSJkZWF0bnUubm8iLAoJInRpbWUubm8iLAoJInRpbmd2b2xsLm5vIiwKCSJ0aW5uLm5vIiwKCSJ0amVsZHN1bmQubm8iLAoJImRpZWxkZGFudW9ycmkubm8iLAoJInRqb21lLm5vIiwKCSJ0asO4bWUubm8iLAoJInRva2tlLm5vIiwKCSJ0b2xnYS5ubyIsCgkidG9yc2tlbi5ubyIsCgkidHJhbm95Lm5vIiwKCSJ0cmFuw7h5Lm5vIiwKCSJ0cm9tc28ubm8iLAoJInRyb21zw7gubm8iLAoJInRyb21zYS5ubyIsCgkicm9tc2Eubm8iLAoJInRyb25kaGVpbS5ubyIsCgkidHJvYW5kaW4ubm8iLAoJInRyeXNpbC5ubyIsCgkidHJhbmEubm8iLAoJInRyw6ZuYS5ubyIsCgkidHJvZ3N0YWQubm8iLAoJInRyw7hnc3RhZC5ubyIsCgkidHZlZGVzdHJhbmQubm8iLAoJInR5ZGFsLm5vIiwKCSJ0eW5zZXQubm8iLAoJInR5c2Zqb3JkLm5vIiwKCSJkaXZ0YXN2dW9kbmEubm8iLAoJImRpdnR0YXN2dW90bmEubm8iLAoJInR5c25lcy5ubyIsCgkidHlzdmFyLm5vIiwKCSJ0eXN2w6ZyLm5vIiwKCSJ0b25zYmVyZy5ubyIsCgkidMO4bnNiZXJnLm5vIiwKCSJ1bGxlbnNha2VyLm5vIiwKCSJ1bGxlbnN2YW5nLm5vIiwKCSJ1bHZpay5ubyIsCgkidXRzaXJhLm5vIiwKCSJ2YWRzby5ubyIsCgkidmFkc8O4Lm5vIiwKCSJjYWhjZXN1b2xvLm5vIiwKCSLEjcOhaGNlc3VvbG8ubm8iLAoJInZha3NkYWwubm8iLAoJInZhbGxlLm5vIiwKCSJ2YW5nLm5vIiwKCSJ2YW55bHZlbi5ubyIsCgkidmFyZG8ubm8iLAoJInZhcmTDuC5ubyIsCgkidmFyZ2dhdC5ubyIsCgkidsOhcmdnw6F0Lm5vIiwKCSJ2ZWZzbi5ubyIsCgkidmFhcHN0ZS5ubyIsCgkidmVnYS5ubyIsCgkidmVnYXJzaGVpLm5vIiwKCSJ2ZWfDpXJzaGVpLm5vIiwKCSJ2ZW5uZXNsYS5ubyIsCgkidmVyZGFsLm5vIiwKCSJ2ZXJyYW4ubm8iLAoJInZlc3RieS5ubyIsCgkidmVzdG5lcy5ubyIsCgkidmVzdHJlLXNsaWRyZS5ubyIsCgkidmVzdHJlLXRvdGVuLm5vIiwKCSJ2ZXN0dmFnb3kubm8iLAoJInZlc3R2w6Vnw7h5Lm5vIiwKCSJ2ZXZlbHN0YWQubm8iLAoJInZpay5ubyIsCgkidmlrbmEubm8iLAoJInZpbmRhZmpvcmQubm8iLAoJInZvbGRhLm5vIiwKCSJ2b3NzLm5vIiwKCSJ2YXJveS5ubyIsCgkidsOmcsO4eS5ubyIsCgkidmFnYW4ubm8iLAoJInbDpWdhbi5ubyIsCgkidm9hZ2F0Lm5vIiwKCSJ2YWdzb3kubm8iLAoJInbDpWdzw7h5Lm5vIiwKCSJ2YWdhLm5vIiwKCSJ2w6Vnw6Uubm8iLAoJInZhbGVyLm9zdGZvbGQubm8iLAoJInbDpWxlci7DuHN0Zm9sZC5ubyIsCgkidmFsZXIuaGVkbWFyay5ubyIsCgkidsOlbGVyLmhlZG1hcmsubm8iLAoJIioubnAiLAoJIm5yIiwKCSJiaXoubnIiLAoJImluZm8ubnIiLAoJImdvdi5uciIsCgkiZWR1Lm5yIiwKCSJvcmcubnIiLAoJIm5ldC5uciIsCgkiY29tLm5yIiwKCSJudSIsCgkibnoiLAoJImFjLm56IiwKCSJjby5ueiIsCgkiY3JpLm56IiwKCSJnZWVrLm56IiwKCSJnZW4ubnoiLAoJImdvdnQubnoiLAoJImhlYWx0aC5ueiIsCgkiaXdpLm56IiwKCSJraXdpLm56IiwKCSJtYW9yaS5ueiIsCgkibWlsLm56IiwKCSJtxIFvcmkubnoiLAoJIm5ldC5ueiIsCgkib3JnLm56IiwKCSJwYXJsaWFtZW50Lm56IiwKCSJzY2hvb2wubnoiLAoJIm9tIiwKCSJjby5vbSIsCgkiY29tLm9tIiwKCSJlZHUub20iLAoJImdvdi5vbSIsCgkibWVkLm9tIiwKCSJtdXNldW0ub20iLAoJIm5ldC5vbSIsCgkib3JnLm9tIiwKCSJwcm8ub20iLAoJIm9uaW9uIiwKCSJvcmciLAoJInBhIiwKCSJhYy5wYSIsCgkiZ29iLnBhIiwKCSJjb20ucGEiLAoJIm9yZy5wYSIsCgkic2xkLnBhIiwKCSJlZHUucGEiLAoJIm5ldC5wYSIsCgkiaW5nLnBhIiwKCSJhYm8ucGEiLAoJIm1lZC5wYSIsCgkibm9tLnBhIiwKCSJwZSIsCgkiZWR1LnBlIiwKCSJnb2IucGUiLAoJIm5vbS5wZSIsCgkibWlsLnBlIiwKCSJvcmcucGUiLAoJImNvbS5wZSIsCgkibmV0LnBlIiwKCSJwZiIsCgkiY29tLnBmIiwKCSJvcmcucGYiLAoJImVkdS5wZiIsCgkiKi5wZyIsCgkicGgiLAoJImNvbS5waCIsCgkibmV0LnBoIiwKCSJvcmcucGgiLAoJImdvdi5waCIsCgkiZWR1LnBoIiwKCSJuZ28ucGgiLAoJIm1pbC5waCIsCgkiaS5waCIsCgkicGsiLAoJImNvbS5wayIsCgkibmV0LnBrIiwKCSJlZHUucGsiLAoJIm9yZy5wayIsCgkiZmFtLnBrIiwKCSJiaXoucGsiLAoJIndlYi5wayIsCgkiZ292LnBrIiwKCSJnb2IucGsiLAoJImdvay5wayIsCgkiZ29uLnBrIiwKCSJnb3AucGsiLAoJImdvcy5wayIsCgkiaW5mby5wayIsCgkicGwiLAoJImNvbS5wbCIsCgkibmV0LnBsIiwKCSJvcmcucGwiLAoJImFpZC5wbCIsCgkiYWdyby5wbCIsCgkiYXRtLnBsIiwKCSJhdXRvLnBsIiwKCSJiaXoucGwiLAoJImVkdS5wbCIsCgkiZ21pbmEucGwiLAoJImdzbS5wbCIsCgkiaW5mby5wbCIsCgkibWFpbC5wbCIsCgkibWlhc3RhLnBsIiwKCSJtZWRpYS5wbCIsCgkibWlsLnBsIiwKCSJuaWVydWNob21vc2NpLnBsIiwKCSJub20ucGwiLAoJInBjLnBsIiwKCSJwb3dpYXQucGwiLAoJInByaXYucGwiLAoJInJlYWxlc3RhdGUucGwiLAoJInJlbC5wbCIsCgkic2V4LnBsIiwKCSJzaG9wLnBsIiwKCSJza2xlcC5wbCIsCgkic29zLnBsIiwKCSJzemtvbGEucGwiLAoJInRhcmdpLnBsIiwKCSJ0bS5wbCIsCgkidG91cmlzbS5wbCIsCgkidHJhdmVsLnBsIiwKCSJ0dXJ5c3R5a2EucGwiLAoJImdvdi5wbCIsCgkiYXAuZ292LnBsIiwKCSJpYy5nb3YucGwiLAoJImlzLmdvdi5wbCIsCgkidXMuZ292LnBsIiwKCSJrbXBzcC5nb3YucGwiLAoJImtwcHNwLmdvdi5wbCIsCgkia3dwc3AuZ292LnBsIiwKCSJwc3AuZ292LnBsIiwKCSJ3c2tyLmdvdi5wbCIsCgkia3dwLmdvdi5wbCIsCgkibXcuZ292LnBsIiwKCSJ1Zy5nb3YucGwiLAoJInVtLmdvdi5wbCIsCgkidW1pZy5nb3YucGwiLAoJInVnaW0uZ292LnBsIiwKCSJ1cG93Lmdvdi5wbCIsCgkidXcuZ292LnBsIiwKCSJzdGFyb3N0d28uZ292LnBsIiwKCSJwYS5nb3YucGwiLAoJInBvLmdvdi5wbCIsCgkicHNzZS5nb3YucGwiLAoJInB1cC5nb3YucGwiLAoJInJ6Z3cuZ292LnBsIiwKCSJzYS5nb3YucGwiLAoJInNvLmdvdi5wbCIsCgkic3IuZ292LnBsIiwKCSJ3c2EuZ292LnBsIiwKCSJza28uZ292LnBsIiwKCSJ1enMuZ292LnBsIiwKCSJ3aWloLmdvdi5wbCIsCgkid2luYi5nb3YucGwiLAoJInBpbmIuZ292LnBsIiwKCSJ3aW9zLmdvdi5wbCIsCgkid2l0ZC5nb3YucGwiLAoJInd6bWl1dy5nb3YucGwiLAoJInBpdy5nb3YucGwiLAoJIndpdy5nb3YucGwiLAoJImdyaXcuZ292LnBsIiwKCSJ3aWYuZ292LnBsIiwKCSJvdW0uZ292LnBsIiwKCSJzZG4uZ292LnBsIiwKCSJ6cC5nb3YucGwiLAoJInVwcG8uZ292LnBsIiwKCSJtdXAuZ292LnBsIiwKCSJ3dW96Lmdvdi5wbCIsCgkia29uc3VsYXQuZ292LnBsIiwKCSJvaXJtLmdvdi5wbCIsCgkiYXVndXN0b3cucGwiLAoJImJhYmlhLWdvcmEucGwiLAoJImJlZHppbi5wbCIsCgkiYmVza2lkeS5wbCIsCgkiYmlhbG93aWV6YS5wbCIsCgkiYmlhbHlzdG9rLnBsIiwKCSJiaWVsYXdhLnBsIiwKCSJiaWVzemN6YWR5LnBsIiwKCSJib2xlc2xhd2llYy5wbCIsCgkiYnlkZ29zemN6LnBsIiwKCSJieXRvbS5wbCIsCgkiY2llc3p5bi5wbCIsCgkiY3plbGFkei5wbCIsCgkiY3plc3QucGwiLAoJImRsdWdvbGVrYS5wbCIsCgkiZWxibGFnLnBsIiwKCSJlbGsucGwiLAoJImdsb2dvdy5wbCIsCgkiZ25pZXpuby5wbCIsCgkiZ29ybGljZS5wbCIsCgkiZ3JhamV3by5wbCIsCgkiaWxhd2EucGwiLAoJImphd29yem5vLnBsIiwKCSJqZWxlbmlhLWdvcmEucGwiLAoJImpnb3JhLnBsIiwKCSJrYWxpc3oucGwiLAoJImthemltaWVyei1kb2xueS5wbCIsCgkia2FycGFjei5wbCIsCgkia2FydHV6eS5wbCIsCgkia2FzenVieS5wbCIsCgkia2F0b3dpY2UucGwiLAoJImtlcG5vLnBsIiwKCSJrZXRyenluLnBsIiwKCSJrbG9kemtvLnBsIiwKCSJrb2JpZXJ6eWNlLnBsIiwKCSJrb2xvYnJ6ZWcucGwiLAoJImtvbmluLnBsIiwKCSJrb25za293b2xhLnBsIiwKCSJrdXRuby5wbCIsCgkibGFweS5wbCIsCgkibGVib3JrLnBsIiwKCSJsZWduaWNhLnBsIiwKCSJsZXphanNrLnBsIiwKCSJsaW1hbm93YS5wbCIsCgkibG9temEucGwiLAoJImxvd2ljei5wbCIsCgkibHViaW4ucGwiLAoJImx1a293LnBsIiwKCSJtYWxib3JrLnBsIiwKCSJtYWxvcG9sc2thLnBsIiwKCSJtYXpvd3N6ZS5wbCIsCgkibWF6dXJ5LnBsIiwKCSJtaWVsZWMucGwiLAoJIm1pZWxuby5wbCIsCgkibXJhZ293by5wbCIsCgkibmFrbG8ucGwiLAoJIm5vd2FydWRhLnBsIiwKCSJueXNhLnBsIiwKCSJvbGF3YS5wbCIsCgkib2xlY2tvLnBsIiwKCSJvbGt1c3oucGwiLAoJIm9sc3p0eW4ucGwiLAoJIm9wb2N6bm8ucGwiLAoJIm9wb2xlLnBsIiwKCSJvc3Ryb2RhLnBsIiwKCSJvc3Ryb2xla2EucGwiLAoJIm9zdHJvd2llYy5wbCIsCgkib3N0cm93d2xrcC5wbCIsCgkicGlsYS5wbCIsCgkicGlzei5wbCIsCgkicG9kaGFsZS5wbCIsCgkicG9kbGFzaWUucGwiLAoJInBvbGtvd2ljZS5wbCIsCgkicG9tb3J6ZS5wbCIsCgkicG9tb3Jza2llLnBsIiwKCSJwcm9jaG93aWNlLnBsIiwKCSJwcnVzemtvdy5wbCIsCgkicHJ6ZXdvcnNrLnBsIiwKCSJwdWxhd3kucGwiLAoJInJhZG9tLnBsIiwKCSJyYXdhLW1hei5wbCIsCgkicnlibmlrLnBsIiwKCSJyemVzem93LnBsIiwKCSJzYW5vay5wbCIsCgkic2VqbnkucGwiLAoJInNsYXNrLnBsIiwKCSJzbHVwc2sucGwiLAoJInNvc25vd2llYy5wbCIsCgkic3RhbG93YS13b2xhLnBsIiwKCSJza29jem93LnBsIiwKCSJzdGFyYWNob3dpY2UucGwiLAoJInN0YXJnYXJkLnBsIiwKCSJzdXdhbGtpLnBsIiwKCSJzd2lkbmljYS5wbCIsCgkic3dpZWJvZHppbi5wbCIsCgkic3dpbm91anNjaWUucGwiLAoJInN6Y3plY2luLnBsIiwKCSJzemN6eXRuby5wbCIsCgkidGFybm9icnplZy5wbCIsCgkidGdvcnkucGwiLAoJInR1cmVrLnBsIiwKCSJ0eWNoeS5wbCIsCgkidXN0a2EucGwiLAoJIndhbGJyenljaC5wbCIsCgkid2FybWlhLnBsIiwKCSJ3YXJzemF3YS5wbCIsCgkid2F3LnBsIiwKCSJ3ZWdyb3cucGwiLAoJIndpZWx1bi5wbCIsCgkid2xvY2wucGwiLAoJIndsb2NsYXdlay5wbCIsCgkid29kemlzbGF3LnBsIiwKCSJ3b2xvbWluLnBsIiwKCSJ3cm9jbGF3LnBsIiwKCSJ6YWNocG9tb3IucGwiLAoJInphZ2FuLnBsIiwKCSJ6YXJvdy5wbCIsCgkiemdvcmEucGwiLAoJInpnb3J6ZWxlYy5wbCIsCgkicG0iLAoJInBuIiwKCSJnb3YucG4iLAoJImNvLnBuIiwKCSJvcmcucG4iLAoJImVkdS5wbiIsCgkibmV0LnBuIiwKCSJwb3N0IiwKCSJwciIsCgkiY29tLnByIiwKCSJuZXQucHIiLAoJIm9yZy5wciIsCgkiZ292LnByIiwKCSJlZHUucHIiLAoJImlzbGEucHIiLAoJInByby5wciIsCgkiYml6LnByIiwKCSJpbmZvLnByIiwKCSJuYW1lLnByIiwKCSJlc3QucHIiLAoJInByb2YucHIiLAoJImFjLnByIiwKCSJwcm8iLAoJImFhYS5wcm8iLAoJImFjYS5wcm8iLAoJImFjY3QucHJvIiwKCSJhdm9jYXQucHJvIiwKCSJiYXIucHJvIiwKCSJjcGEucHJvIiwKCSJlbmcucHJvIiwKCSJqdXIucHJvIiwKCSJsYXcucHJvIiwKCSJtZWQucHJvIiwKCSJyZWNodC5wcm8iLAoJInBzIiwKCSJlZHUucHMiLAoJImdvdi5wcyIsCgkic2VjLnBzIiwKCSJwbG8ucHMiLAoJImNvbS5wcyIsCgkib3JnLnBzIiwKCSJuZXQucHMiLAoJInB0IiwKCSJuZXQucHQiLAoJImdvdi5wdCIsCgkib3JnLnB0IiwKCSJlZHUucHQiLAoJImludC5wdCIsCgkicHVibC5wdCIsCgkiY29tLnB0IiwKCSJub21lLnB0IiwKCSJwdyIsCgkiY28ucHciLAoJIm5lLnB3IiwKCSJvci5wdyIsCgkiZWQucHciLAoJImdvLnB3IiwKCSJiZWxhdS5wdyIsCgkicHkiLAoJImNvbS5weSIsCgkiY29vcC5weSIsCgkiZWR1LnB5IiwKCSJnb3YucHkiLAoJIm1pbC5weSIsCgkibmV0LnB5IiwKCSJvcmcucHkiLAoJInFhIiwKCSJjb20ucWEiLAoJImVkdS5xYSIsCgkiZ292LnFhIiwKCSJtaWwucWEiLAoJIm5hbWUucWEiLAoJIm5ldC5xYSIsCgkib3JnLnFhIiwKCSJzY2gucWEiLAoJInJlIiwKCSJhc3NvLnJlIiwKCSJjb20ucmUiLAoJIm5vbS5yZSIsCgkicm8iLAoJImFydHMucm8iLAoJImNvbS5ybyIsCgkiZmlybS5ybyIsCgkiaW5mby5ybyIsCgkibm9tLnJvIiwKCSJudC5ybyIsCgkib3JnLnJvIiwKCSJyZWMucm8iLAoJInN0b3JlLnJvIiwKCSJ0bS5ybyIsCgkid3d3LnJvIiwKCSJycyIsCgkiYWMucnMiLAoJImNvLnJzIiwKCSJlZHUucnMiLAoJImdvdi5ycyIsCgkiaW4ucnMiLAoJIm9yZy5ycyIsCgkicnUiLAoJInJ3IiwKCSJhYy5ydyIsCgkiY28ucnciLAoJImNvb3AucnciLAoJImdvdi5ydyIsCgkibWlsLnJ3IiwKCSJuZXQucnciLAoJIm9yZy5ydyIsCgkic2EiLAoJImNvbS5zYSIsCgkibmV0LnNhIiwKCSJvcmcuc2EiLAoJImdvdi5zYSIsCgkibWVkLnNhIiwKCSJwdWIuc2EiLAoJImVkdS5zYSIsCgkic2NoLnNhIiwKCSJzYiIsCgkiY29tLnNiIiwKCSJlZHUuc2IiLAoJImdvdi5zYiIsCgkibmV0LnNiIiwKCSJvcmcuc2IiLAoJInNjIiwKCSJjb20uc2MiLAoJImdvdi5zYyIsCgkibmV0LnNjIiwKCSJvcmcuc2MiLAoJImVkdS5zYyIsCgkic2QiLAoJImNvbS5zZCIsCgkibmV0LnNkIiwKCSJvcmcuc2QiLAoJImVkdS5zZCIsCgkibWVkLnNkIiwKCSJ0di5zZCIsCgkiZ292LnNkIiwKCSJpbmZvLnNkIiwKCSJzZSIsCgkiYS5zZSIsCgkiYWMuc2UiLAoJImIuc2UiLAoJImJkLnNlIiwKCSJicmFuZC5zZSIsCgkiYy5zZSIsCgkiZC5zZSIsCgkiZS5zZSIsCgkiZi5zZSIsCgkiZmguc2UiLAoJImZoc2suc2UiLAoJImZodi5zZSIsCgkiZy5zZSIsCgkiaC5zZSIsCgkiaS5zZSIsCgkiay5zZSIsCgkia29tZm9yYi5zZSIsCgkia29tbXVuYWxmb3JidW5kLnNlIiwKCSJrb212dXguc2UiLAoJImwuc2UiLAoJImxhbmJpYi5zZSIsCgkibS5zZSIsCgkibi5zZSIsCgkibmF0dXJicnVrc2d5bW4uc2UiLAoJIm8uc2UiLAoJIm9yZy5zZSIsCgkicC5zZSIsCgkicGFydGkuc2UiLAoJInBwLnNlIiwKCSJwcmVzcy5zZSIsCgkici5zZSIsCgkicy5zZSIsCgkidC5zZSIsCgkidG0uc2UiLAoJInUuc2UiLAoJIncuc2UiLAoJInguc2UiLAoJInkuc2UiLAoJInouc2UiLAoJInNnIiwKCSJjb20uc2ciLAoJIm5ldC5zZyIsCgkib3JnLnNnIiwKCSJnb3Yuc2ciLAoJImVkdS5zZyIsCgkicGVyLnNnIiwKCSJzaCIsCgkiY29tLnNoIiwKCSJuZXQuc2giLAoJImdvdi5zaCIsCgkib3JnLnNoIiwKCSJtaWwuc2giLAoJInNpIiwKCSJzaiIsCgkic2siLAoJInNsIiwKCSJjb20uc2wiLAoJIm5ldC5zbCIsCgkiZWR1LnNsIiwKCSJnb3Yuc2wiLAoJIm9yZy5zbCIsCgkic20iLAoJInNuIiwKCSJhcnQuc24iLAoJImNvbS5zbiIsCgkiZWR1LnNuIiwKCSJnb3V2LnNuIiwKCSJvcmcuc24iLAoJInBlcnNvLnNuIiwKCSJ1bml2LnNuIiwKCSJzbyIsCgkiY29tLnNvIiwKCSJlZHUuc28iLAoJImdvdi5zbyIsCgkibWUuc28iLAoJIm5ldC5zbyIsCgkib3JnLnNvIiwKCSJzciIsCgkic3MiLAoJImJpei5zcyIsCgkiY29tLnNzIiwKCSJlZHUuc3MiLAoJImdvdi5zcyIsCgkibWUuc3MiLAoJIm5ldC5zcyIsCgkib3JnLnNzIiwKCSJzY2guc3MiLAoJInN0IiwKCSJjby5zdCIsCgkiY29tLnN0IiwKCSJjb25zdWxhZG8uc3QiLAoJImVkdS5zdCIsCgkiZW1iYWl4YWRhLnN0IiwKCSJtaWwuc3QiLAoJIm5ldC5zdCIsCgkib3JnLnN0IiwKCSJwcmluY2lwZS5zdCIsCgkic2FvdG9tZS5zdCIsCgkic3RvcmUuc3QiLAoJInN1IiwKCSJzdiIsCgkiY29tLnN2IiwKCSJlZHUuc3YiLAoJImdvYi5zdiIsCgkib3JnLnN2IiwKCSJyZWQuc3YiLAoJInN4IiwKCSJnb3Yuc3giLAoJInN5IiwKCSJlZHUuc3kiLAoJImdvdi5zeSIsCgkibmV0LnN5IiwKCSJtaWwuc3kiLAoJImNvbS5zeSIsCgkib3JnLnN5IiwKCSJzeiIsCgkiY28uc3oiLAoJImFjLnN6IiwKCSJvcmcuc3oiLAoJInRjIiwKCSJ0ZCIsCgkidGVsIiwKCSJ0ZiIsCgkidGciLAoJInRoIiwKCSJhYy50aCIsCgkiY28udGgiLAoJImdvLnRoIiwKCSJpbi50aCIsCgkibWkudGgiLAoJIm5ldC50aCIsCgkib3IudGgiLAoJInRqIiwKCSJhYy50aiIsCgkiYml6LnRqIiwKCSJjby50aiIsCgkiY29tLnRqIiwKCSJlZHUudGoiLAoJImdvLnRqIiwKCSJnb3YudGoiLAoJImludC50aiIsCgkibWlsLnRqIiwKCSJuYW1lLnRqIiwKCSJuZXQudGoiLAoJIm5pYy50aiIsCgkib3JnLnRqIiwKCSJ0ZXN0LnRqIiwKCSJ3ZWIudGoiLAoJInRrIiwKCSJ0bCIsCgkiZ292LnRsIiwKCSJ0bSIsCgkiY29tLnRtIiwKCSJjby50bSIsCgkib3JnLnRtIiwKCSJuZXQudG0iLAoJIm5vbS50bSIsCgkiZ292LnRtIiwKCSJtaWwudG0iLAoJImVkdS50bSIsCgkidG4iLAoJImNvbS50biIsCgkiZW5zLnRuIiwKCSJmaW4udG4iLAoJImdvdi50biIsCgkiaW5kLnRuIiwKCSJpbmZvLnRuIiwKCSJpbnRsLnRuIiwKCSJtaW5jb20udG4iLAoJIm5hdC50biIsCgkibmV0LnRuIiwKCSJvcmcudG4iLAoJInBlcnNvLnRuIiwKCSJ0b3VyaXNtLnRuIiwKCSJ0byIsCgkiY29tLnRvIiwKCSJnb3YudG8iLAoJIm5ldC50byIsCgkib3JnLnRvIiwKCSJlZHUudG8iLAoJIm1pbC50byIsCgkidHIiLAoJImF2LnRyIiwKCSJiYnMudHIiLAoJImJlbC50ciIsCgkiYml6LnRyIiwKCSJjb20udHIiLAoJImRyLnRyIiwKCSJlZHUudHIiLAoJImdlbi50ciIsCgkiZ292LnRyIiwKCSJpbmZvLnRyIiwKCSJtaWwudHIiLAoJImsxMi50ciIsCgkia2VwLnRyIiwKCSJuYW1lLnRyIiwKCSJuZXQudHIiLAoJIm9yZy50ciIsCgkicG9sLnRyIiwKCSJ0ZWwudHIiLAoJInRzay50ciIsCgkidHYudHIiLAoJIndlYi50ciIsCgkibmMudHIiLAoJImdvdi5uYy50ciIsCgkidHQiLAoJImNvLnR0IiwKCSJjb20udHQiLAoJIm9yZy50dCIsCgkibmV0LnR0IiwKCSJiaXoudHQiLAoJImluZm8udHQiLAoJInByby50dCIsCgkiaW50LnR0IiwKCSJjb29wLnR0IiwKCSJqb2JzLnR0IiwKCSJtb2JpLnR0IiwKCSJ0cmF2ZWwudHQiLAoJIm11c2V1bS50dCIsCgkiYWVyby50dCIsCgkibmFtZS50dCIsCgkiZ292LnR0IiwKCSJlZHUudHQiLAoJInR2IiwKCSJ0dyIsCgkiZWR1LnR3IiwKCSJnb3YudHciLAoJIm1pbC50dyIsCgkiY29tLnR3IiwKCSJuZXQudHciLAoJIm9yZy50dyIsCgkiaWR2LnR3IiwKCSJnYW1lLnR3IiwKCSJlYml6LnR3IiwKCSJjbHViLnR3IiwKCSLntrLot68udHciLAoJIue1hOe5lC50dyIsCgki5ZWG5qWtLnR3IiwKCSJ0eiIsCgkiYWMudHoiLAoJImNvLnR6IiwKCSJnby50eiIsCgkiaG90ZWwudHoiLAoJImluZm8udHoiLAoJIm1lLnR6IiwKCSJtaWwudHoiLAoJIm1vYmkudHoiLAoJIm5lLnR6IiwKCSJvci50eiIsCgkic2MudHoiLAoJInR2LnR6IiwKCSJ1YSIsCgkiY29tLnVhIiwKCSJlZHUudWEiLAoJImdvdi51YSIsCgkiaW4udWEiLAoJIm5ldC51YSIsCgkib3JnLnVhIiwKCSJjaGVya2Fzc3kudWEiLAoJImNoZXJrYXN5LnVhIiwKCSJjaGVybmlnb3YudWEiLAoJImNoZXJuaWhpdi51YSIsCgkiY2hlcm5pdnRzaS51YSIsCgkiY2hlcm5vdnRzeS51YSIsCgkiY2sudWEiLAoJImNuLnVhIiwKCSJjci51YSIsCgkiY3JpbWVhLnVhIiwKCSJjdi51YSIsCgkiZG4udWEiLAoJImRuZXByb3BldHJvdnNrLnVhIiwKCSJkbmlwcm9wZXRyb3Zzay51YSIsCgkiZG9uZXRzay51YSIsCgkiZHAudWEiLAoJImlmLnVhIiwKCSJpdmFuby1mcmFua2l2c2sudWEiLAoJImtoLnVhIiwKCSJraGFya2l2LnVhIiwKCSJraGFya292LnVhIiwKCSJraGVyc29uLnVhIiwKCSJraG1lbG5pdHNraXkudWEiLAoJImtobWVsbnl0c2t5aS51YSIsCgkia2lldi51YSIsCgkia2lyb3ZvZ3JhZC51YSIsCgkia20udWEiLAoJImtyLnVhIiwKCSJrcnltLnVhIiwKCSJrcy51YSIsCgkia3YudWEiLAoJImt5aXYudWEiLAoJImxnLnVhIiwKCSJsdC51YSIsCgkibHVnYW5zay51YSIsCgkibHV0c2sudWEiLAoJImx2LnVhIiwKCSJsdml2LnVhIiwKCSJtay51YSIsCgkibXlrb2xhaXYudWEiLAoJIm5pa29sYWV2LnVhIiwKCSJvZC51YSIsCgkib2Rlc2EudWEiLAoJIm9kZXNzYS51YSIsCgkicGwudWEiLAoJInBvbHRhdmEudWEiLAoJInJpdm5lLnVhIiwKCSJyb3Zuby51YSIsCgkicnYudWEiLAoJInNiLnVhIiwKCSJzZWJhc3RvcG9sLnVhIiwKCSJzZXZhc3RvcG9sLnVhIiwKCSJzbS51YSIsCgkic3VteS51YSIsCgkidGUudWEiLAoJInRlcm5vcGlsLnVhIiwKCSJ1ei51YSIsCgkidXpoZ29yb2QudWEiLAoJInZpbm5pY2EudWEiLAoJInZpbm55dHNpYS51YSIsCgkidm4udWEiLAoJInZvbHluLnVhIiwKCSJ5YWx0YS51YSIsCgkiemFwb3Jpemh6aGUudWEiLAoJInphcG9yaXpoemhpYS51YSIsCgkiemhpdG9taXIudWEiLAoJInpoeXRvbXlyLnVhIiwKCSJ6cC51YSIsCgkienQudWEiLAoJInVnIiwKCSJjby51ZyIsCgkib3IudWciLAoJImFjLnVnIiwKCSJzYy51ZyIsCgkiZ28udWciLAoJIm5lLnVnIiwKCSJjb20udWciLAoJIm9yZy51ZyIsCgkidWsiLAoJImFjLnVrIiwKCSJjby51ayIsCgkiZ292LnVrIiwKCSJsdGQudWsiLAoJIm1lLnVrIiwKCSJuZXQudWsiLAoJIm5ocy51ayIsCgkib3JnLnVrIiwKCSJwbGMudWsiLAoJInBvbGljZS51ayIsCgkiKi5zY2gudWsiLAoJInVzIiwKCSJkbmkudXMiLAoJImZlZC51cyIsCgkiaXNhLnVzIiwKCSJraWRzLnVzIiwKCSJuc24udXMiLAoJImFrLnVzIiwKCSJhbC51cyIsCgkiYXIudXMiLAoJImFzLnVzIiwKCSJhei51cyIsCgkiY2EudXMiLAoJImNvLnVzIiwKCSJjdC51cyIsCgkiZGMudXMiLAoJImRlLnVzIiwKCSJmbC51cyIsCgkiZ2EudXMiLAoJImd1LnVzIiwKCSJoaS51cyIsCgkiaWEudXMiLAoJImlkLnVzIiwKCSJpbC51cyIsCgkiaW4udXMiLAoJImtzLnVzIiwKCSJreS51cyIsCgkibGEudXMiLAoJIm1hLnVzIiwKCSJtZC51cyIsCgkibWUudXMiLAoJIm1pLnVzIiwKCSJtbi51cyIsCgkibW8udXMiLAoJIm1zLnVzIiwKCSJtdC51cyIsCgkibmMudXMiLAoJIm5kLnVzIiwKCSJuZS51cyIsCgkibmgudXMiLAoJIm5qLnVzIiwKCSJubS51cyIsCgkibnYudXMiLAoJIm55LnVzIiwKCSJvaC51cyIsCgkib2sudXMiLAoJIm9yLnVzIiwKCSJwYS51cyIsCgkicHIudXMiLAoJInJpLnVzIiwKCSJzYy51cyIsCgkic2QudXMiLAoJInRuLnVzIiwKCSJ0eC51cyIsCgkidXQudXMiLAoJInZpLnVzIiwKCSJ2dC51cyIsCgkidmEudXMiLAoJIndhLnVzIiwKCSJ3aS51cyIsCgkid3YudXMiLAoJInd5LnVzIiwKCSJrMTIuYWsudXMiLAoJImsxMi5hbC51cyIsCgkiazEyLmFyLnVzIiwKCSJrMTIuYXMudXMiLAoJImsxMi5hei51cyIsCgkiazEyLmNhLnVzIiwKCSJrMTIuY28udXMiLAoJImsxMi5jdC51cyIsCgkiazEyLmRjLnVzIiwKCSJrMTIuZGUudXMiLAoJImsxMi5mbC51cyIsCgkiazEyLmdhLnVzIiwKCSJrMTIuZ3UudXMiLAoJImsxMi5pYS51cyIsCgkiazEyLmlkLnVzIiwKCSJrMTIuaWwudXMiLAoJImsxMi5pbi51cyIsCgkiazEyLmtzLnVzIiwKCSJrMTIua3kudXMiLAoJImsxMi5sYS51cyIsCgkiazEyLm1hLnVzIiwKCSJrMTIubWQudXMiLAoJImsxMi5tZS51cyIsCgkiazEyLm1pLnVzIiwKCSJrMTIubW4udXMiLAoJImsxMi5tby51cyIsCgkiazEyLm1zLnVzIiwKCSJrMTIubXQudXMiLAoJImsxMi5uYy51cyIsCgkiazEyLm5lLnVzIiwKCSJrMTIubmgudXMiLAoJImsxMi5uai51cyIsCgkiazEyLm5tLnVzIiwKCSJrMTIubnYudXMiLAoJImsxMi5ueS51cyIsCgkiazEyLm9oLnVzIiwKCSJrMTIub2sudXMiLAoJImsxMi5vci51cyIsCgkiazEyLnBhLnVzIiwKCSJrMTIucHIudXMiLAoJImsxMi5zYy51cyIsCgkiazEyLnRuLnVzIiwKCSJrMTIudHgudXMiLAoJImsxMi51dC51cyIsCgkiazEyLnZpLnVzIiwKCSJrMTIudnQudXMiLAoJImsxMi52YS51cyIsCgkiazEyLndhLnVzIiwKCSJrMTIud2kudXMiLAoJImsxMi53eS51cyIsCgkiY2MuYWsudXMiLAoJImNjLmFsLnVzIiwKCSJjYy5hci51cyIsCgkiY2MuYXMudXMiLAoJImNjLmF6LnVzIiwKCSJjYy5jYS51cyIsCgkiY2MuY28udXMiLAoJImNjLmN0LnVzIiwKCSJjYy5kYy51cyIsCgkiY2MuZGUudXMiLAoJImNjLmZsLnVzIiwKCSJjYy5nYS51cyIsCgkiY2MuZ3UudXMiLAoJImNjLmhpLnVzIiwKCSJjYy5pYS51cyIsCgkiY2MuaWQudXMiLAoJImNjLmlsLnVzIiwKCSJjYy5pbi51cyIsCgkiY2Mua3MudXMiLAoJImNjLmt5LnVzIiwKCSJjYy5sYS51cyIsCgkiY2MubWEudXMiLAoJImNjLm1kLnVzIiwKCSJjYy5tZS51cyIsCgkiY2MubWkudXMiLAoJImNjLm1uLnVzIiwKCSJjYy5tby51cyIsCgkiY2MubXMudXMiLAoJImNjLm10LnVzIiwKCSJjYy5uYy51cyIsCgkiY2MubmQudXMiLAoJImNjLm5lLnVzIiwKCSJjYy5uaC51cyIsCgkiY2MubmoudXMiLAoJImNjLm5tLnVzIiwKCSJjYy5udi51cyIsCgkiY2MubnkudXMiLAoJImNjLm9oLnVzIiwKCSJjYy5vay51cyIsCgkiY2Mub3IudXMiLAoJImNjLnBhLnVzIiwKCSJjYy5wci51cyIsCgkiY2MucmkudXMiLAoJImNjLnNjLnVzIiwKCSJjYy5zZC51cyIsCgkiY2MudG4udXMiLAoJImNjLnR4LnVzIiwKCSJjYy51dC51cyIsCgkiY2MudmkudXMiLAoJImNjLnZ0LnVzIiwKCSJjYy52YS51cyIsCgkiY2Mud2EudXMiLAoJImNjLndpLnVzIiwKCSJjYy53di51cyIsCgkiY2Mud3kudXMiLAoJImxpYi5hay51cyIsCgkibGliLmFsLnVzIiwKCSJsaWIuYXIudXMiLAoJImxpYi5hcy51cyIsCgkibGliLmF6LnVzIiwKCSJsaWIuY2EudXMiLAoJImxpYi5jby51cyIsCgkibGliLmN0LnVzIiwKCSJsaWIuZGMudXMiLAoJImxpYi5mbC51cyIsCgkibGliLmdhLnVzIiwKCSJsaWIuZ3UudXMiLAoJImxpYi5oaS51cyIsCgkibGliLmlhLnVzIiwKCSJsaWIuaWQudXMiLAoJImxpYi5pbC51cyIsCgkibGliLmluLnVzIiwKCSJsaWIua3MudXMiLAoJImxpYi5reS51cyIsCgkibGliLmxhLnVzIiwKCSJsaWIubWEudXMiLAoJImxpYi5tZC51cyIsCgkibGliLm1lLnVzIiwKCSJsaWIubWkudXMiLAoJImxpYi5tbi51cyIsCgkibGliLm1vLnVzIiwKCSJsaWIubXMudXMiLAoJImxpYi5tdC51cyIsCgkibGliLm5jLnVzIiwKCSJsaWIubmQudXMiLAoJImxpYi5uZS51cyIsCgkibGliLm5oLnVzIiwKCSJsaWIubmoudXMiLAoJImxpYi5ubS51cyIsCgkibGliLm52LnVzIiwKCSJsaWIubnkudXMiLAoJImxpYi5vaC51cyIsCgkibGliLm9rLnVzIiwKCSJsaWIub3IudXMiLAoJImxpYi5wYS51cyIsCgkibGliLnByLnVzIiwKCSJsaWIucmkudXMiLAoJImxpYi5zYy51cyIsCgkibGliLnNkLnVzIiwKCSJsaWIudG4udXMiLAoJImxpYi50eC51cyIsCgkibGliLnV0LnVzIiwKCSJsaWIudmkudXMiLAoJImxpYi52dC51cyIsCgkibGliLnZhLnVzIiwKCSJsaWIud2EudXMiLAoJImxpYi53aS51cyIsCgkibGliLnd5LnVzIiwKCSJwdnQuazEyLm1hLnVzIiwKCSJjaHRyLmsxMi5tYS51cyIsCgkicGFyb2NoLmsxMi5tYS51cyIsCgkiYW5uLWFyYm9yLm1pLnVzIiwKCSJjb2cubWkudXMiLAoJImRzdC5taS51cyIsCgkiZWF0b24ubWkudXMiLAoJImdlbi5taS51cyIsCgkibXVzLm1pLnVzIiwKCSJ0ZWMubWkudXMiLAoJIndhc2h0ZW5hdy5taS51cyIsCgkidXkiLAoJImNvbS51eSIsCgkiZWR1LnV5IiwKCSJndWIudXkiLAoJIm1pbC51eSIsCgkibmV0LnV5IiwKCSJvcmcudXkiLAoJInV6IiwKCSJjby51eiIsCgkiY29tLnV6IiwKCSJuZXQudXoiLAoJIm9yZy51eiIsCgkidmEiLAoJInZjIiwKCSJjb20udmMiLAoJIm5ldC52YyIsCgkib3JnLnZjIiwKCSJnb3YudmMiLAoJIm1pbC52YyIsCgkiZWR1LnZjIiwKCSJ2ZSIsCgkiYXJ0cy52ZSIsCgkiYmliLnZlIiwKCSJjby52ZSIsCgkiY29tLnZlIiwKCSJlMTIudmUiLAoJImVkdS52ZSIsCgkiZmlybS52ZSIsCgkiZ29iLnZlIiwKCSJnb3YudmUiLAoJImluZm8udmUiLAoJImludC52ZSIsCgkibWlsLnZlIiwKCSJuZXQudmUiLAoJIm5vbS52ZSIsCgkib3JnLnZlIiwKCSJyYXIudmUiLAoJInJlYy52ZSIsCgkic3RvcmUudmUiLAoJInRlYy52ZSIsCgkid2ViLnZlIiwKCSJ2ZyIsCgkidmkiLAoJImNvLnZpIiwKCSJjb20udmkiLAoJImsxMi52aSIsCgkibmV0LnZpIiwKCSJvcmcudmkiLAoJInZuIiwKCSJjb20udm4iLAoJIm5ldC52biIsCgkib3JnLnZuIiwKCSJlZHUudm4iLAoJImdvdi52biIsCgkiaW50LnZuIiwKCSJhYy52biIsCgkiYml6LnZuIiwKCSJpbmZvLnZuIiwKCSJuYW1lLnZuIiwKCSJwcm8udm4iLAoJImhlYWx0aC52biIsCgkidnUiLAoJImNvbS52dSIsCgkiZWR1LnZ1IiwKCSJuZXQudnUiLAoJIm9yZy52dSIsCgkid2YiLAoJIndzIiwKCSJjb20ud3MiLAoJIm5ldC53cyIsCgkib3JnLndzIiwKCSJnb3Yud3MiLAoJImVkdS53cyIsCgkieXQiLAoJItin2YXYp9ix2KfYqiIsCgki1bDVodW1IiwKCSLgpqzgpr7gpoLgprLgpr4iLAoJItCx0LMiLAoJItin2YTYqNit2LHZitmGIiwKCSLQsdC10LsiLAoJIuS4reWbvSIsCgki5Lit5ZyLIiwKCSLYp9mE2KzYstin2KbYsSIsCgki2YXYtdixIiwKCSLQtdGOIiwKCSLOtc+FIiwKCSLZhdmI2LHZitiq2KfZhtmK2KciLAoJIuGDkuGDlCIsCgkizrXOuyIsCgki6aaZ5rivIiwKCSLlhazlj7gu6aaZ5rivIiwKCSLmlZnogrIu6aaZ5rivIiwKCSLmlL/lupwu6aaZ5rivIiwKCSLlgIvkurou6aaZ5rivIiwKCSLntrLntaEu6aaZ5rivIiwKCSLntYTnuZQu6aaZ5rivIiwKCSLgsq3gsr7gsrDgsqQiLAoJIuCsreCsvuCssOCspCIsCgki4Kat4Ka+4Kew4KakIiwKCSLgpK3gpL7gpLDgpKTgpK7gpY0iLAoJIuCkreCkvuCksOCli+CkpCIsCgki2oDYp9ix2KoiLAoJIuC0reC0vuC0sOC0pOC0giIsCgki4KSt4KS+4KSw4KSkIiwKCSLYqNin2LHYqiIsCgki2Kjavtin2LHYqiIsCgki4LCt4LC+4LCw4LCk4LGNIiwKCSLgqq3gqr7gqrDgqqQiLAoJIuCoreCovuCosOCopCIsCgki4Kat4Ka+4Kaw4KakIiwKCSLgrofgrqjgr43grqTgrr/grq/grr4iLAoJItin24zYsdin2YYiLAoJItin2YrYsdin2YYiLAoJIti52LHYp9mCIiwKCSLYp9mE2KfYsdiv2YYiLAoJIu2VnOq1rSIsCgki0pvQsNC3IiwKCSLguqXgurLguqciLAoJIuC2veC2guC2muC3jyIsCgki4K6H4K6y4K6Z4K+N4K6V4K+IIiwKCSLYp9mE2YXYutix2KgiLAoJItC80LrQtCIsCgki0LzQvtC9IiwKCSLmvrPploAiLAoJIua+s+mXqCIsCgki2YXZhNmK2LPZitinIiwKCSLYudmF2KfZhiIsCgki2b7Yp9qp2LPYqtin2YYiLAoJItm+2KfZg9iz2KrYp9mGIiwKCSLZgdmE2LPYt9mK2YYiLAoJItGB0YDQsSIsCgki0L/RgC7RgdGA0LEiLAoJItC+0YDQsy7RgdGA0LEiLAoJItC+0LHRgC7RgdGA0LEiLAoJItC+0LQu0YHRgNCxIiwKCSLRg9C/0YAu0YHRgNCxIiwKCSLQsNC6LtGB0YDQsSIsCgki0YDRhCIsCgki2YLYt9ixIiwKCSLYp9mE2LPYudmI2K/ZitipIiwKCSLYp9mE2LPYudmI2K/bjNipIiwKCSLYp9mE2LPYudmI2K/bjNuDIiwKCSLYp9mE2LPYudmI2K/ZitmHIiwKCSLYs9mI2K/Yp9mGIiwKCSLmlrDliqDlnaEiLAoJIuCumuCuv+CumeCvjeCuleCuquCvjeCuquCvguCusOCvjSIsCgki2LPZiNix2YrYqSIsCgki2LPZiNix2YrYpyIsCgki4LmE4LiX4LiiIiwKCSLguKjguLbguIHguKnguLIu4LmE4LiX4LiiIiwKCSLguJjguLjguKPguIHguLTguIgu4LmE4LiX4LiiIiwKCSLguKPguLHguJDguJrguLLguKUu4LmE4LiX4LiiIiwKCSLguJfguKvguLLguKMu4LmE4LiX4LiiIiwKCSLguYDguJnguYfguJUu4LmE4LiX4LiiIiwKCSLguK3guIfguITguYzguIHguKMu4LmE4LiX4LiiIiwKCSLYqtmI2YbYsyIsCgki5Y+w54GjIiwKCSLlj7Dmub4iLAoJIuiHuueBoyIsCgki0YPQutGAIiwKCSLYp9mE2YrZhdmGIiwKCSJ4eHgiLAoJInllIiwKCSJjb20ueWUiLAoJImVkdS55ZSIsCgkiZ292LnllIiwKCSJuZXQueWUiLAoJIm1pbC55ZSIsCgkib3JnLnllIiwKCSJhYy56YSIsCgkiYWdyaWMuemEiLAoJImFsdC56YSIsCgkiY28uemEiLAoJImVkdS56YSIsCgkiZ292LnphIiwKCSJncm9uZGFyLnphIiwKCSJsYXcuemEiLAoJIm1pbC56YSIsCgkibmV0LnphIiwKCSJuZ28uemEiLAoJIm5pYy56YSIsCgkibmlzLnphIiwKCSJub20uemEiLAoJIm9yZy56YSIsCgkic2Nob29sLnphIiwKCSJ0bS56YSIsCgkid2ViLnphIiwKCSJ6bSIsCgkiYWMuem0iLAoJImJpei56bSIsCgkiY28uem0iLAoJImNvbS56bSIsCgkiZWR1LnptIiwKCSJnb3Yuem0iLAoJImluZm8uem0iLAoJIm1pbC56bSIsCgkibmV0LnptIiwKCSJvcmcuem0iLAoJInNjaC56bSIsCgkienciLAoJImFjLnp3IiwKCSJjby56dyIsCgkiZ292Lnp3IiwKCSJtaWwuenciLAoJIm9yZy56dyIsCgkiYWFhIiwKCSJhYXJwIiwKCSJhYmFydGgiLAoJImFiYiIsCgkiYWJib3R0IiwKCSJhYmJ2aWUiLAoJImFiYyIsCgkiYWJsZSIsCgkiYWJvZ2FkbyIsCgkiYWJ1ZGhhYmkiLAoJImFjYWRlbXkiLAoJImFjY2VudHVyZSIsCgkiYWNjb3VudGFudCIsCgkiYWNjb3VudGFudHMiLAoJImFjbyIsCgkiYWN0b3IiLAoJImFkYWMiLAoJImFkcyIsCgkiYWR1bHQiLAoJImFlZyIsCgkiYWV0bmEiLAoJImFmbCIsCgkiYWZyaWNhIiwKCSJhZ2FraGFuIiwKCSJhZ2VuY3kiLAoJImFpZyIsCgkiYWlyYnVzIiwKCSJhaXJmb3JjZSIsCgkiYWlydGVsIiwKCSJha2RuIiwKCSJhbGZhcm9tZW8iLAoJImFsaWJhYmEiLAoJImFsaXBheSIsCgkiYWxsZmluYW56IiwKCSJhbGxzdGF0ZSIsCgkiYWxseSIsCgkiYWxzYWNlIiwKCSJhbHN0b20iLAoJImFtYXpvbiIsCgkiYW1lcmljYW5leHByZXNzIiwKCSJhbWVyaWNhbmZhbWlseSIsCgkiYW1leCIsCgkiYW1mYW0iLAoJImFtaWNhIiwKCSJhbXN0ZXJkYW0iLAoJImFuYWx5dGljcyIsCgkiYW5kcm9pZCIsCgkiYW5xdWFuIiwKCSJhbnoiLAoJImFvbCIsCgkiYXBhcnRtZW50cyIsCgkiYXBwIiwKCSJhcHBsZSIsCgkiYXF1YXJlbGxlIiwKCSJhcmFiIiwKCSJhcmFtY28iLAoJImFyY2hpIiwKCSJhcm15IiwKCSJhcnQiLAoJImFydGUiLAoJImFzZGEiLAoJImFzc29jaWF0ZXMiLAoJImF0aGxldGEiLAoJImF0dG9ybmV5IiwKCSJhdWN0aW9uIiwKCSJhdWRpIiwKCSJhdWRpYmxlIiwKCSJhdWRpbyIsCgkiYXVzcG9zdCIsCgkiYXV0aG9yIiwKCSJhdXRvIiwKCSJhdXRvcyIsCgkiYXZpYW5jYSIsCgkiYXdzIiwKCSJheGEiLAoJImF6dXJlIiwKCSJiYWJ5IiwKCSJiYWlkdSIsCgkiYmFuYW1leCIsCgkiYmFuYW5hcmVwdWJsaWMiLAoJImJhbmQiLAoJImJhbmsiLAoJImJhciIsCgkiYmFyY2Vsb25hIiwKCSJiYXJjbGF5Y2FyZCIsCgkiYmFyY2xheXMiLAoJImJhcmVmb290IiwKCSJiYXJnYWlucyIsCgkiYmFzZWJhbGwiLAoJImJhc2tldGJhbGwiLAoJImJhdWhhdXMiLAoJImJheWVybiIsCgkiYmJjIiwKCSJiYnQiLAoJImJidmEiLAoJImJjZyIsCgkiYmNuIiwKCSJiZWF0cyIsCgkiYmVhdXR5IiwKCSJiZWVyIiwKCSJiZW50bGV5IiwKCSJiZXJsaW4iLAoJImJlc3QiLAoJImJlc3RidXkiLAoJImJldCIsCgkiYmhhcnRpIiwKCSJiaWJsZSIsCgkiYmlkIiwKCSJiaWtlIiwKCSJiaW5nIiwKCSJiaW5nbyIsCgkiYmlvIiwKCSJibGFjayIsCgkiYmxhY2tmcmlkYXkiLAoJImJsb2NrYnVzdGVyIiwKCSJibG9nIiwKCSJibG9vbWJlcmciLAoJImJsdWUiLAoJImJtcyIsCgkiYm13IiwKCSJibnBwYXJpYmFzIiwKCSJib2F0cyIsCgkiYm9laHJpbmdlciIsCgkiYm9mYSIsCgkiYm9tIiwKCSJib25kIiwKCSJib28iLAoJImJvb2siLAoJImJvb2tpbmciLAoJImJvc2NoIiwKCSJib3N0aWsiLAoJImJvc3RvbiIsCgkiYm90IiwKCSJib3V0aXF1ZSIsCgkiYm94IiwKCSJicmFkZXNjbyIsCgkiYnJpZGdlc3RvbmUiLAoJImJyb2Fkd2F5IiwKCSJicm9rZXIiLAoJImJyb3RoZXIiLAoJImJydXNzZWxzIiwKCSJidWdhdHRpIiwKCSJidWlsZCIsCgkiYnVpbGRlcnMiLAoJImJ1c2luZXNzIiwKCSJidXkiLAoJImJ1enoiLAoJImJ6aCIsCgkiY2FiIiwKCSJjYWZlIiwKCSJjYWwiLAoJImNhbGwiLAoJImNhbHZpbmtsZWluIiwKCSJjYW0iLAoJImNhbWVyYSIsCgkiY2FtcCIsCgkiY2FuY2VycmVzZWFyY2giLAoJImNhbm9uIiwKCSJjYXBldG93biIsCgkiY2FwaXRhbCIsCgkiY2FwaXRhbG9uZSIsCgkiY2FyIiwKCSJjYXJhdmFuIiwKCSJjYXJkcyIsCgkiY2FyZSIsCgkiY2FyZWVyIiwKCSJjYXJlZXJzIiwKCSJjYXJzIiwKCSJjYXNhIiwKCSJjYXNlIiwKCSJjYXNoIiwKCSJjYXNpbm8iLAoJImNhdGVyaW5nIiwKCSJjYXRob2xpYyIsCgkiY2JhIiwKCSJjYm4iLAoJImNicmUiLAoJImNicyIsCgkiY2VudGVyIiwKCSJjZW8iLAoJImNlcm4iLAoJImNmYSIsCgkiY2ZkIiwKCSJjaGFuZWwiLAoJImNoYW5uZWwiLAoJImNoYXJpdHkiLAoJImNoYXNlIiwKCSJjaGF0IiwKCSJjaGVhcCIsCgkiY2hpbnRhaSIsCgkiY2hyaXN0bWFzIiwKCSJjaHJvbWUiLAoJImNodXJjaCIsCgkiY2lwcmlhbmkiLAoJImNpcmNsZSIsCgkiY2lzY28iLAoJImNpdGFkZWwiLAoJImNpdGkiLAoJImNpdGljIiwKCSJjaXR5IiwKCSJjaXR5ZWF0cyIsCgkiY2xhaW1zIiwKCSJjbGVhbmluZyIsCgkiY2xpY2siLAoJImNsaW5pYyIsCgkiY2xpbmlxdWUiLAoJImNsb3RoaW5nIiwKCSJjbG91ZCIsCgkiY2x1YiIsCgkiY2x1Ym1lZCIsCgkiY29hY2giLAoJImNvZGVzIiwKCSJjb2ZmZWUiLAoJImNvbGxlZ2UiLAoJImNvbG9nbmUiLAoJImNvbWNhc3QiLAoJImNvbW1iYW5rIiwKCSJjb21tdW5pdHkiLAoJImNvbXBhbnkiLAoJImNvbXBhcmUiLAoJImNvbXB1dGVyIiwKCSJjb21zZWMiLAoJImNvbmRvcyIsCgkiY29uc3RydWN0aW9uIiwKCSJjb25zdWx0aW5nIiwKCSJjb250YWN0IiwKCSJjb250cmFjdG9ycyIsCgkiY29va2luZyIsCgkiY29va2luZ2NoYW5uZWwiLAoJImNvb2wiLAoJImNvcnNpY2EiLAoJImNvdW50cnkiLAoJImNvdXBvbiIsCgkiY291cG9ucyIsCgkiY291cnNlcyIsCgkiY3BhIiwKCSJjcmVkaXQiLAoJImNyZWRpdGNhcmQiLAoJImNyZWRpdHVuaW9uIiwKCSJjcmlja2V0IiwKCSJjcm93biIsCgkiY3JzIiwKCSJjcnVpc2UiLAoJImNydWlzZXMiLAoJImN1aXNpbmVsbGEiLAoJImN5bXJ1IiwKCSJjeW91IiwKCSJkYWJ1ciIsCgkiZGFkIiwKCSJkYW5jZSIsCgkiZGF0YSIsCgkiZGF0ZSIsCgkiZGF0aW5nIiwKCSJkYXRzdW4iLAoJImRheSIsCgkiZGNsayIsCgkiZGRzIiwKCSJkZWFsIiwKCSJkZWFsZXIiLAoJImRlYWxzIiwKCSJkZWdyZWUiLAoJImRlbGl2ZXJ5IiwKCSJkZWxsIiwKCSJkZWxvaXR0ZSIsCgkiZGVsdGEiLAoJImRlbW9jcmF0IiwKCSJkZW50YWwiLAoJImRlbnRpc3QiLAoJImRlc2kiLAoJImRlc2lnbiIsCgkiZGV2IiwKCSJkaGwiLAoJImRpYW1vbmRzIiwKCSJkaWV0IiwKCSJkaWdpdGFsIiwKCSJkaXJlY3QiLAoJImRpcmVjdG9yeSIsCgkiZGlzY291bnQiLAoJImRpc2NvdmVyIiwKCSJkaXNoIiwKCSJkaXkiLAoJImRucCIsCgkiZG9jcyIsCgkiZG9jdG9yIiwKCSJkb2ciLAoJImRvbWFpbnMiLAoJImRvdCIsCgkiZG93bmxvYWQiLAoJImRyaXZlIiwKCSJkdHYiLAoJImR1YmFpIiwKCSJkdW5sb3AiLAoJImR1cG9udCIsCgkiZHVyYmFuIiwKCSJkdmFnIiwKCSJkdnIiLAoJImVhcnRoIiwKCSJlYXQiLAoJImVjbyIsCgkiZWRla2EiLAoJImVkdWNhdGlvbiIsCgkiZW1haWwiLAoJImVtZXJjayIsCgkiZW5lcmd5IiwKCSJlbmdpbmVlciIsCgkiZW5naW5lZXJpbmciLAoJImVudGVycHJpc2VzIiwKCSJlcHNvbiIsCgkiZXF1aXBtZW50IiwKCSJlcmljc3NvbiIsCgkiZXJuaSIsCgkiZXNxIiwKCSJlc3RhdGUiLAoJImV0aXNhbGF0IiwKCSJldXJvdmlzaW9uIiwKCSJldXMiLAoJImV2ZW50cyIsCgkiZXhjaGFuZ2UiLAoJImV4cGVydCIsCgkiZXhwb3NlZCIsCgkiZXhwcmVzcyIsCgkiZXh0cmFzcGFjZSIsCgkiZmFnZSIsCgkiZmFpbCIsCgkiZmFpcndpbmRzIiwKCSJmYWl0aCIsCgkiZmFtaWx5IiwKCSJmYW4iLAoJImZhbnMiLAoJImZhcm0iLAoJImZhcm1lcnMiLAoJImZhc2hpb24iLAoJImZhc3QiLAoJImZlZGV4IiwKCSJmZWVkYmFjayIsCgkiZmVycmFyaSIsCgkiZmVycmVybyIsCgkiZmlhdCIsCgkiZmlkZWxpdHkiLAoJImZpZG8iLAoJImZpbG0iLAoJImZpbmFsIiwKCSJmaW5hbmNlIiwKCSJmaW5hbmNpYWwiLAoJImZpcmUiLAoJImZpcmVzdG9uZSIsCgkiZmlybWRhbGUiLAoJImZpc2giLAoJImZpc2hpbmciLAoJImZpdCIsCgkiZml0bmVzcyIsCgkiZmxpY2tyIiwKCSJmbGlnaHRzIiwKCSJmbGlyIiwKCSJmbG9yaXN0IiwKCSJmbG93ZXJzIiwKCSJmbHkiLAoJImZvbyIsCgkiZm9vZCIsCgkiZm9vZG5ldHdvcmsiLAoJImZvb3RiYWxsIiwKCSJmb3JkIiwKCSJmb3JleCIsCgkiZm9yc2FsZSIsCgkiZm9ydW0iLAoJImZvdW5kYXRpb24iLAoJImZveCIsCgkiZnJlZSIsCgkiZnJlc2VuaXVzIiwKCSJmcmwiLAoJImZyb2dhbnMiLAoJImZyb250ZG9vciIsCgkiZnJvbnRpZXIiLAoJImZ0ciIsCgkiZnVqaXRzdSIsCgkiZnVuIiwKCSJmdW5kIiwKCSJmdXJuaXR1cmUiLAoJImZ1dGJvbCIsCgkiZnlpIiwKCSJnYWwiLAoJImdhbGxlcnkiLAoJImdhbGxvIiwKCSJnYWxsdXAiLAoJImdhbWUiLAoJImdhbWVzIiwKCSJnYXAiLAoJImdhcmRlbiIsCgkiZ2F5IiwKCSJnYml6IiwKCSJnZG4iLAoJImdlYSIsCgkiZ2VudCIsCgkiZ2VudGluZyIsCgkiZ2VvcmdlIiwKCSJnZ2VlIiwKCSJnaWZ0IiwKCSJnaWZ0cyIsCgkiZ2l2ZXMiLAoJImdpdmluZyIsCgkiZ2xhc3MiLAoJImdsZSIsCgkiZ2xvYmFsIiwKCSJnbG9ibyIsCgkiZ21haWwiLAoJImdtYmgiLAoJImdtbyIsCgkiZ214IiwKCSJnb2RhZGR5IiwKCSJnb2xkIiwKCSJnb2xkcG9pbnQiLAoJImdvbGYiLAoJImdvbyIsCgkiZ29vZHllYXIiLAoJImdvb2ciLAoJImdvb2dsZSIsCgkiZ29wIiwKCSJnb3QiLAoJImdyYWluZ2VyIiwKCSJncmFwaGljcyIsCgkiZ3JhdGlzIiwKCSJncmVlbiIsCgkiZ3JpcGUiLAoJImdyb2NlcnkiLAoJImdyb3VwIiwKCSJndWFyZGlhbiIsCgkiZ3VjY2kiLAoJImd1Z2UiLAoJImd1aWRlIiwKCSJndWl0YXJzIiwKCSJndXJ1IiwKCSJoYWlyIiwKCSJoYW1idXJnIiwKCSJoYW5nb3V0IiwKCSJoYXVzIiwKCSJoYm8iLAoJImhkZmMiLAoJImhkZmNiYW5rIiwKCSJoZWFsdGgiLAoJImhlYWx0aGNhcmUiLAoJImhlbHAiLAoJImhlbHNpbmtpIiwKCSJoZXJlIiwKCSJoZXJtZXMiLAoJImhndHYiLAoJImhpcGhvcCIsCgkiaGlzYW1pdHN1IiwKCSJoaXRhY2hpIiwKCSJoaXYiLAoJImhrdCIsCgkiaG9ja2V5IiwKCSJob2xkaW5ncyIsCgkiaG9saWRheSIsCgkiaG9tZWRlcG90IiwKCSJob21lZ29vZHMiLAoJImhvbWVzIiwKCSJob21lc2Vuc2UiLAoJImhvbmRhIiwKCSJob3JzZSIsCgkiaG9zcGl0YWwiLAoJImhvc3QiLAoJImhvc3RpbmciLAoJImhvdCIsCgkiaG90ZWxlcyIsCgkiaG90ZWxzIiwKCSJob3RtYWlsIiwKCSJob3VzZSIsCgkiaG93IiwKCSJoc2JjIiwKCSJodWdoZXMiLAoJImh5YXR0IiwKCSJoeXVuZGFpIiwKCSJpYm0iLAoJImljYmMiLAoJImljZSIsCgkiaWN1IiwKCSJpZWVlIiwKCSJpZm0iLAoJImlrYW5vIiwKCSJpbWFtYXQiLAoJImltZGIiLAoJImltbW8iLAoJImltbW9iaWxpZW4iLAoJImluYyIsCgkiaW5kdXN0cmllcyIsCgkiaW5maW5pdGkiLAoJImluZyIsCgkiaW5rIiwKCSJpbnN0aXR1dGUiLAoJImluc3VyYW5jZSIsCgkiaW5zdXJlIiwKCSJpbnRlcm5hdGlvbmFsIiwKCSJpbnR1aXQiLAoJImludmVzdG1lbnRzIiwKCSJpcGlyYW5nYSIsCgkiaXJpc2giLAoJImlzbWFpbGkiLAoJImlzdCIsCgkiaXN0YW5idWwiLAoJIml0YXUiLAoJIml0diIsCgkiamFndWFyIiwKCSJqYXZhIiwKCSJqY2IiLAoJImplZXAiLAoJImpldHp0IiwKCSJqZXdlbHJ5IiwKCSJqaW8iLAoJImpsbCIsCgkiam1wIiwKCSJqbmoiLAoJImpvYnVyZyIsCgkiam90IiwKCSJqb3kiLAoJImpwbW9yZ2FuIiwKCSJqcHJzIiwKCSJqdWVnb3MiLAoJImp1bmlwZXIiLAoJImthdWZlbiIsCgkia2RkaSIsCgkia2Vycnlob3RlbHMiLAoJImtlcnJ5bG9naXN0aWNzIiwKCSJrZXJyeXByb3BlcnRpZXMiLAoJImtmaCIsCgkia2lhIiwKCSJraWRzIiwKCSJraW0iLAoJImtpbmRlciIsCgkia2luZGxlIiwKCSJraXRjaGVuIiwKCSJraXdpIiwKCSJrb2VsbiIsCgkia29tYXRzdSIsCgkia29zaGVyIiwKCSJrcG1nIiwKCSJrcG4iLAoJImtyZCIsCgkia3JlZCIsCgkia3Vva2dyb3VwIiwKCSJreW90byIsCgkibGFjYWl4YSIsCgkibGFtYm9yZ2hpbmkiLAoJImxhbWVyIiwKCSJsYW5jYXN0ZXIiLAoJImxhbmNpYSIsCgkibGFuZCIsCgkibGFuZHJvdmVyIiwKCSJsYW54ZXNzIiwKCSJsYXNhbGxlIiwKCSJsYXQiLAoJImxhdGlubyIsCgkibGF0cm9iZSIsCgkibGF3IiwKCSJsYXd5ZXIiLAoJImxkcyIsCgkibGVhc2UiLAoJImxlY2xlcmMiLAoJImxlZnJhayIsCgkibGVnYWwiLAoJImxlZ28iLAoJImxleHVzIiwKCSJsZ2J0IiwKCSJsaWRsIiwKCSJsaWZlIiwKCSJsaWZlaW5zdXJhbmNlIiwKCSJsaWZlc3R5bGUiLAoJImxpZ2h0aW5nIiwKCSJsaWtlIiwKCSJsaWxseSIsCgkibGltaXRlZCIsCgkibGltbyIsCgkibGluY29sbiIsCgkibGluZGUiLAoJImxpbmsiLAoJImxpcHN5IiwKCSJsaXZlIiwKCSJsaXZpbmciLAoJImxsYyIsCgkibGxwIiwKCSJsb2FuIiwKCSJsb2FucyIsCgkibG9ja2VyIiwKCSJsb2N1cyIsCgkibG9mdCIsCgkibG9sIiwKCSJsb25kb24iLAoJImxvdHRlIiwKCSJsb3R0byIsCgkibG92ZSIsCgkibHBsIiwKCSJscGxmaW5hbmNpYWwiLAoJImx0ZCIsCgkibHRkYSIsCgkibHVuZGJlY2siLAoJImx1eGUiLAoJImx1eHVyeSIsCgkibWFjeXMiLAoJIm1hZHJpZCIsCgkibWFpZiIsCgkibWFpc29uIiwKCSJtYWtldXAiLAoJIm1hbiIsCgkibWFuYWdlbWVudCIsCgkibWFuZ28iLAoJIm1hcCIsCgkibWFya2V0IiwKCSJtYXJrZXRpbmciLAoJIm1hcmtldHMiLAoJIm1hcnJpb3R0IiwKCSJtYXJzaGFsbHMiLAoJIm1hc2VyYXRpIiwKCSJtYXR0ZWwiLAoJIm1iYSIsCgkibWNraW5zZXkiLAoJIm1lZCIsCgkibWVkaWEiLAoJIm1lZXQiLAoJIm1lbGJvdXJuZSIsCgkibWVtZSIsCgkibWVtb3JpYWwiLAoJIm1lbiIsCgkibWVudSIsCgkibWVyY2ttc2QiLAoJIm1pYW1pIiwKCSJtaWNyb3NvZnQiLAoJIm1pbmkiLAoJIm1pbnQiLAoJIm1pdCIsCgkibWl0c3ViaXNoaSIsCgkibWxiIiwKCSJtbHMiLAoJIm1tYSIsCgkibW9iaWxlIiwKCSJtb2RhIiwKCSJtb2UiLAoJIm1vaSIsCgkibW9tIiwKCSJtb25hc2giLAoJIm1vbmV5IiwKCSJtb25zdGVyIiwKCSJtb3Jtb24iLAoJIm1vcnRnYWdlIiwKCSJtb3Njb3ciLAoJIm1vdG8iLAoJIm1vdG9yY3ljbGVzIiwKCSJtb3YiLAoJIm1vdmllIiwKCSJtc2QiLAoJIm10biIsCgkibXRyIiwKCSJtdXNpYyIsCgkibXV0dWFsIiwKCSJuYWIiLAoJIm5hZ295YSIsCgkibmF0dXJhIiwKCSJuYXZ5IiwKCSJuYmEiLAoJIm5lYyIsCgkibmV0YmFuayIsCgkibmV0ZmxpeCIsCgkibmV0d29yayIsCgkibmV1c3RhciIsCgkibmV3IiwKCSJuZXdzIiwKCSJuZXh0IiwKCSJuZXh0ZGlyZWN0IiwKCSJuZXh1cyIsCgkibmZsIiwKCSJuZ28iLAoJIm5oayIsCgkibmljbyIsCgkibmlrZSIsCgkibmlrb24iLAoJIm5pbmphIiwKCSJuaXNzYW4iLAoJIm5pc3NheSIsCgkibm9raWEiLAoJIm5vcnRod2VzdGVybm11dHVhbCIsCgkibm9ydG9uIiwKCSJub3ciLAoJIm5vd3J1eiIsCgkibm93dHYiLAoJIm5yYSIsCgkibnJ3IiwKCSJudHQiLAoJIm55YyIsCgkib2JpIiwKCSJvYnNlcnZlciIsCgkib2ZmaWNlIiwKCSJva2luYXdhIiwKCSJvbGF5YW4iLAoJIm9sYXlhbmdyb3VwIiwKCSJvbGRuYXZ5IiwKCSJvbGxvIiwKCSJvbWVnYSIsCgkib25lIiwKCSJvbmciLAoJIm9ubCIsCgkib25saW5lIiwKCSJvb28iLAoJIm9wZW4iLAoJIm9yYWNsZSIsCgkib3JhbmdlIiwKCSJvcmdhbmljIiwKCSJvcmlnaW5zIiwKCSJvc2FrYSIsCgkib3RzdWthIiwKCSJvdHQiLAoJIm92aCIsCgkicGFnZSIsCgkicGFuYXNvbmljIiwKCSJwYXJpcyIsCgkicGFycyIsCgkicGFydG5lcnMiLAoJInBhcnRzIiwKCSJwYXJ0eSIsCgkicGFzc2FnZW5zIiwKCSJwYXkiLAoJInBjY3ciLAoJInBldCIsCgkicGZpemVyIiwKCSJwaGFybWFjeSIsCgkicGhkIiwKCSJwaGlsaXBzIiwKCSJwaG9uZSIsCgkicGhvdG8iLAoJInBob3RvZ3JhcGh5IiwKCSJwaG90b3MiLAoJInBoeXNpbyIsCgkicGljcyIsCgkicGljdGV0IiwKCSJwaWN0dXJlcyIsCgkicGlkIiwKCSJwaW4iLAoJInBpbmciLAoJInBpbmsiLAoJInBpb25lZXIiLAoJInBpenphIiwKCSJwbGFjZSIsCgkicGxheSIsCgkicGxheXN0YXRpb24iLAoJInBsdW1iaW5nIiwKCSJwbHVzIiwKCSJwbmMiLAoJInBvaGwiLAoJInBva2VyIiwKCSJwb2xpdGllIiwKCSJwb3JuIiwKCSJwcmFtZXJpY2EiLAoJInByYXhpIiwKCSJwcmVzcyIsCgkicHJpbWUiLAoJInByb2QiLAoJInByb2R1Y3Rpb25zIiwKCSJwcm9mIiwKCSJwcm9ncmVzc2l2ZSIsCgkicHJvbW8iLAoJInByb3BlcnRpZXMiLAoJInByb3BlcnR5IiwKCSJwcm90ZWN0aW9uIiwKCSJwcnUiLAoJInBydWRlbnRpYWwiLAoJInB1YiIsCgkicHdjIiwKCSJxcG9uIiwKCSJxdWViZWMiLAoJInF1ZXN0IiwKCSJyYWNpbmciLAoJInJhZGlvIiwKCSJyZWFkIiwKCSJyZWFsZXN0YXRlIiwKCSJyZWFsdG9yIiwKCSJyZWFsdHkiLAoJInJlY2lwZXMiLAoJInJlZCIsCgkicmVkc3RvbmUiLAoJInJlZHVtYnJlbGxhIiwKCSJyZWhhYiIsCgkicmVpc2UiLAoJInJlaXNlbiIsCgkicmVpdCIsCgkicmVsaWFuY2UiLAoJInJlbiIsCgkicmVudCIsCgkicmVudGFscyIsCgkicmVwYWlyIiwKCSJyZXBvcnQiLAoJInJlcHVibGljYW4iLAoJInJlc3QiLAoJInJlc3RhdXJhbnQiLAoJInJldmlldyIsCgkicmV2aWV3cyIsCgkicmV4cm90aCIsCgkicmljaCIsCgkicmljaGFyZGxpIiwKCSJyaWNvaCIsCgkicmlsIiwKCSJyaW8iLAoJInJpcCIsCgkicm9jaGVyIiwKCSJyb2NrcyIsCgkicm9kZW8iLAoJInJvZ2VycyIsCgkicm9vbSIsCgkicnN2cCIsCgkicnVnYnkiLAoJInJ1aHIiLAoJInJ1biIsCgkicndlIiwKCSJyeXVreXUiLAoJInNhYXJsYW5kIiwKCSJzYWZlIiwKCSJzYWZldHkiLAoJInNha3VyYSIsCgkic2FsZSIsCgkic2Fsb24iLAoJInNhbXNjbHViIiwKCSJzYW1zdW5nIiwKCSJzYW5kdmlrIiwKCSJzYW5kdmlrY29yb21hbnQiLAoJInNhbm9maSIsCgkic2FwIiwKCSJzYXJsIiwKCSJzYXMiLAoJInNhdmUiLAoJInNheG8iLAoJInNiaSIsCgkic2JzIiwKCSJzY2EiLAoJInNjYiIsCgkic2NoYWVmZmxlciIsCgkic2NobWlkdCIsCgkic2Nob2xhcnNoaXBzIiwKCSJzY2hvb2wiLAoJInNjaHVsZSIsCgkic2Nod2FyeiIsCgkic2NpZW5jZSIsCgkic2NvdCIsCgkic2VhcmNoIiwKCSJzZWF0IiwKCSJzZWN1cmUiLAoJInNlY3VyaXR5IiwKCSJzZWVrIiwKCSJzZWxlY3QiLAoJInNlbmVyIiwKCSJzZXJ2aWNlcyIsCgkic2VzIiwKCSJzZXZlbiIsCgkic2V3IiwKCSJzZXgiLAoJInNleHkiLAoJInNmciIsCgkic2hhbmdyaWxhIiwKCSJzaGFycCIsCgkic2hhdyIsCgkic2hlbGwiLAoJInNoaWEiLAoJInNoaWtzaGEiLAoJInNob2VzIiwKCSJzaG9wIiwKCSJzaG9wcGluZyIsCgkic2hvdWppIiwKCSJzaG93IiwKCSJzaG93dGltZSIsCgkic2lsayIsCgkic2luYSIsCgkic2luZ2xlcyIsCgkic2l0ZSIsCgkic2tpIiwKCSJza2luIiwKCSJza3kiLAoJInNreXBlIiwKCSJzbGluZyIsCgkic21hcnQiLAoJInNtaWxlIiwKCSJzbmNmIiwKCSJzb2NjZXIiLAoJInNvY2lhbCIsCgkic29mdGJhbmsiLAoJInNvZnR3YXJlIiwKCSJzb2h1IiwKCSJzb2xhciIsCgkic29sdXRpb25zIiwKCSJzb25nIiwKCSJzb255IiwKCSJzb3kiLAoJInNwYSIsCgkic3BhY2UiLAoJInNwb3J0IiwKCSJzcG90IiwKCSJzcmwiLAoJInN0YWRhIiwKCSJzdGFwbGVzIiwKCSJzdGFyIiwKCSJzdGF0ZWJhbmsiLAoJInN0YXRlZmFybSIsCgkic3RjIiwKCSJzdGNncm91cCIsCgkic3RvY2tob2xtIiwKCSJzdG9yYWdlIiwKCSJzdG9yZSIsCgkic3RyZWFtIiwKCSJzdHVkaW8iLAoJInN0dWR5IiwKCSJzdHlsZSIsCgkic3Vja3MiLAoJInN1cHBsaWVzIiwKCSJzdXBwbHkiLAoJInN1cHBvcnQiLAoJInN1cmYiLAoJInN1cmdlcnkiLAoJInN1enVraSIsCgkic3dhdGNoIiwKCSJzd2lzcyIsCgkic3lkbmV5IiwKCSJzeXN0ZW1zIiwKCSJ0YWIiLAoJInRhaXBlaSIsCgkidGFsayIsCgkidGFvYmFvIiwKCSJ0YXJnZXQiLAoJInRhdGFtb3RvcnMiLAoJInRhdGFyIiwKCSJ0YXR0b28iLAoJInRheCIsCgkidGF4aSIsCgkidGNpIiwKCSJ0ZGsiLAoJInRlYW0iLAoJInRlY2giLAoJInRlY2hub2xvZ3kiLAoJInRlbWFzZWsiLAoJInRlbm5pcyIsCgkidGV2YSIsCgkidGhkIiwKCSJ0aGVhdGVyIiwKCSJ0aGVhdHJlIiwKCSJ0aWFhIiwKCSJ0aWNrZXRzIiwKCSJ0aWVuZGEiLAoJInRpZmZhbnkiLAoJInRpcHMiLAoJInRpcmVzIiwKCSJ0aXJvbCIsCgkidGptYXh4IiwKCSJ0angiLAoJInRrbWF4eCIsCgkidG1hbGwiLAoJInRvZGF5IiwKCSJ0b2t5byIsCgkidG9vbHMiLAoJInRvcCIsCgkidG9yYXkiLAoJInRvc2hpYmEiLAoJInRvdGFsIiwKCSJ0b3VycyIsCgkidG93biIsCgkidG95b3RhIiwKCSJ0b3lzIiwKCSJ0cmFkZSIsCgkidHJhZGluZyIsCgkidHJhaW5pbmciLAoJInRyYXZlbCIsCgkidHJhdmVsY2hhbm5lbCIsCgkidHJhdmVsZXJzIiwKCSJ0cmF2ZWxlcnNpbnN1cmFuY2UiLAoJInRydXN0IiwKCSJ0cnYiLAoJInR1YmUiLAoJInR1aSIsCgkidHVuZXMiLAoJInR1c2h1IiwKCSJ0dnMiLAoJInViYW5rIiwKCSJ1YnMiLAoJInVuaWNvbSIsCgkidW5pdmVyc2l0eSIsCgkidW5vIiwKCSJ1b2wiLAoJInVwcyIsCgkidmFjYXRpb25zIiwKCSJ2YW5hIiwKCSJ2YW5ndWFyZCIsCgkidmVnYXMiLAoJInZlbnR1cmVzIiwKCSJ2ZXJpc2lnbiIsCgkidmVyc2ljaGVydW5nIiwKCSJ2ZXQiLAoJInZpYWplcyIsCgkidmlkZW8iLAoJInZpZyIsCgkidmlraW5nIiwKCSJ2aWxsYXMiLAoJInZpbiIsCgkidmlwIiwKCSJ2aXJnaW4iLAoJInZpc2EiLAoJInZpc2lvbiIsCgkidml2YSIsCgkidml2byIsCgkidmxhYW5kZXJlbiIsCgkidm9ka2EiLAoJInZvbGtzd2FnZW4iLAoJInZvbHZvIiwKCSJ2b3RlIiwKCSJ2b3RpbmciLAoJInZvdG8iLAoJInZveWFnZSIsCgkidnVlbG9zIiwKCSJ3YWxlcyIsCgkid2FsbWFydCIsCgkid2FsdGVyIiwKCSJ3YW5nIiwKCSJ3YW5nZ291IiwKCSJ3YXRjaCIsCgkid2F0Y2hlcyIsCgkid2VhdGhlciIsCgkid2VhdGhlcmNoYW5uZWwiLAoJIndlYmNhbSIsCgkid2ViZXIiLAoJIndlYnNpdGUiLAoJIndlZGRpbmciLAoJIndlaWJvIiwKCSJ3ZWlyIiwKCSJ3aG9zd2hvIiwKCSJ3aWVuIiwKCSJ3aWtpIiwKCSJ3aWxsaWFtaGlsbCIsCgkid2luIiwKCSJ3aW5kb3dzIiwKCSJ3aW5lIiwKCSJ3aW5uZXJzIiwKCSJ3bWUiLAoJIndvbHRlcnNrbHV3ZXIiLAoJIndvb2RzaWRlIiwKCSJ3b3JrIiwKCSJ3b3JrcyIsCgkid29ybGQiLAoJIndvdyIsCgkid3RjIiwKCSJ3dGYiLAoJInhib3giLAoJInhlcm94IiwKCSJ4ZmluaXR5IiwKCSJ4aWh1YW4iLAoJInhpbiIsCgki4KSV4KWJ4KSuIiwKCSLjgrvjg7zjg6siLAoJIuS9m+WxsSIsCgki5oWI5ZaEIiwKCSLpm4blm6IiLAoJIuWcqOe6vyIsCgki54K555yLIiwKCSLguITguK3guKEiLAoJIuWFq+WNpiIsCgki2YXZiNmC2LkiLAoJIuWFrOebiiIsCgki5YWs5Y+4IiwKCSLpppnmoLzph4zmi4kiLAoJIue9keermSIsCgki56e75YqoIiwKCSLmiJHniLHkvaAiLAoJItC80L7RgdC60LLQsCIsCgki0LrQsNGC0L7Qu9C40LoiLAoJItC+0L3Qu9Cw0LnQvSIsCgki0YHQsNC50YIiLAoJIuiBlOmAmiIsCgki16fXldedIiwKCSLml7blsJoiLAoJIuW+ruWNmiIsCgki5reh6ams6ZShIiwKCSLjg5XjgqHjg4Pjgrfjg6fjg7MiLAoJItC+0YDQsyIsCgki4KSo4KWH4KSfIiwKCSLjgrnjg4jjgqIiLAoJIuOCouODnuOCvuODsyIsCgki7IK87ISxIiwKCSLllYbmoIciLAoJIuWVhuW6lyIsCgki5ZWG5Z+OIiwKCSLQtNC10YLQuCIsCgki44Od44Kk44Oz44OIIiwKCSLmlrDpl7siLAoJIuWutumbuyIsCgki2YPZiNmFIiwKCSLkuK3mlofnvZEiLAoJIuS4reS/oSIsCgki5aix5LmQIiwKCSLosLfmrYwiLAoJIumbu+ioiuebiOenkSIsCgki6LSt54mpIiwKCSLjgq/jg6njgqbjg4kiLAoJIumAmuiyqSIsCgki572R5bqXIiwKCSLgpLjgpILgpJfgpKDgpKgiLAoJIumkkOWOhSIsCgki572R57ucIiwKCSLQutC+0LwiLAoJIuS6mumprOmAiiIsCgki6K+65Z+65LqaIiwKCSLpo5/lk4EiLAoJIumjnuWIqea1piIsCgki5omL5py6IiwKCSLYp9ix2KfZhdmD2YgiLAoJItin2YTYudmE2YrYp9mGIiwKCSLYp9iq2LXYp9mE2KfYqiIsCgki2KjYp9iy2KfYsSIsCgki2KfYqNmI2LjYqNmKIiwKCSLZg9in2KvZiNmE2YrZgyIsCgki2YfZhdix2KfZhyIsCgki64u37Lu0IiwKCSLmlL/lupwiLAoJIti02KjZg9ipIiwKCSLYqNmK2KrZgyIsCgki2LnYsdioIiwKCSLmnLrmnoQiLAoJIue7hOe7h+acuuaehCIsCgki5YGl5bq3IiwKCSLmi5vogZgiLAoJItGA0YPRgSIsCgki5aSn5ou/IiwKCSLjgb/jgpPjgaoiLAoJIuOCsOODvOOCsOODqyIsCgki5LiW55WMIiwKCSLmm7jnsY0iLAoJIue9keWdgCIsCgki64u364S3IiwKCSLjgrPjg6AiLAoJIuWkqeS4u+aVmSIsCgki5ri45oiPIiwKCSJ2ZXJtw7ZnZW5zYmVyYXRlciIsCgkidmVybcO2Z2Vuc2JlcmF0dW5nIiwKCSLkvIHkuJoiLAoJIuS/oeaBryIsCgki5ZiJ6YeM5aSn6YWS5bqXIiwKCSLlmInph4wiLAoJIuW5v+S4nCIsCgki5pS/5YqhIiwKCSJ4eXoiLAoJInlhY2h0cyIsCgkieWFob28iLAoJInlhbWF4dW4iLAoJInlhbmRleCIsCgkieW9kb2Jhc2hpIiwKCSJ5b2dhIiwKCSJ5b2tvaGFtYSIsCgkieW91IiwKCSJ5b3V0dWJlIiwKCSJ5dW4iLAoJInphcHBvcyIsCgkiemFyYSIsCgkiemVybyIsCgkiemlwIiwKCSJ6b25lIiwKCSJ6dWVyaWNoIiwKCSJjYy51YSIsCgkiaW5mLnVhIiwKCSJsdGQudWEiLAoJIjYxMS50byIsCgkiZ3JhcGhveC51cyIsCgkiKi5kZXZjZG5hY2Nlc3NvLmNvbSIsCgkiYWRvYmVhZW1jbG91ZC5jb20iLAoJIiouZGV2LmFkb2JlYWVtY2xvdWQuY29tIiwKCSJobHgubGl2ZSIsCgkiYWRvYmVhZW1jbG91ZC5uZXQiLAoJImhseC5wYWdlIiwKCSJobHgzLnBhZ2UiLAoJImJlZXAucGwiLAoJImFpcmtpdGFwcHMuY29tIiwKCSJhaXJraXRhcHBzLWF1LmNvbSIsCgkiYWlya2l0YXBwcy5ldSIsCgkiYWl2ZW5jbG91ZC5jb20iLAoJImJhcnN5LmNhIiwKCSIqLmNvbXB1dGUuZXN0YXRlIiwKCSIqLmFsY2VzLm5ldHdvcmsiLAoJImthc3NlcnZlci5jb20iLAoJImFsdGVydmlzdGEub3JnIiwKCSJhbHdheXNkYXRhLm5ldCIsCgkiY2xvdWRmcm9udC5uZXQiLAoJIiouY29tcHV0ZS5hbWF6b25hd3MuY29tIiwKCSIqLmNvbXB1dGUtMS5hbWF6b25hd3MuY29tIiwKCSIqLmNvbXB1dGUuYW1hem9uYXdzLmNvbS5jbiIsCgkidXMtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJImNuLW5vcnRoLTEuZWIuYW1hem9uYXdzLmNvbS5jbiIsCgkiY24tbm9ydGh3ZXN0LTEuZWIuYW1hem9uYXdzLmNvbS5jbiIsCgkiZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLW5vcnRoZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJhcC1ub3J0aGVhc3QtMi5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiYXAtbm9ydGhlYXN0LTMuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLXNvdXRoLTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLXNvdXRoZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJhcC1zb3V0aGVhc3QtMi5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiY2EtY2VudHJhbC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJldS1jZW50cmFsLTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImV1LXdlc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiZXUtd2VzdC0yLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJldS13ZXN0LTMuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInNhLWVhc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkidXMtZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJ1cy1lYXN0LTIuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInVzLWdvdi13ZXN0LTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInVzLXdlc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkidXMtd2VzdC0yLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSIqLmVsYi5hbWF6b25hd3MuY29tIiwKCSIqLmVsYi5hbWF6b25hd3MuY29tLmNuIiwKCSJhd3NnbG9iYWxhY2NlbGVyYXRvci5jb20iLAoJInMzLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLW5vcnRoZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLXNvdXRoLTEuYW1hem9uYXdzLmNvbSIsCgkiczMtYXAtc291dGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtYXAtc291dGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWV1LWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy1ldS13ZXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtZXUtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLWV1LXdlc3QtMy5hbWF6b25hd3MuY29tIiwKCSJzMy1leHRlcm5hbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWZpcHMtdXMtZ292LXdlc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy1zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtdXMtZ292LXdlc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy11cy1lYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtdXMtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXVzLXdlc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmNuLW5vcnRoLTEuYW1hem9uYXdzLmNvbS5jbiIsCgkiczMuY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmV1LWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5ldS13ZXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMuZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLnVzLWVhc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suYXAtbm9ydGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5hcC1zb3V0aGVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suYXAtc291dGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmNhLWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suZXUtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5ldS13ZXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmV1LXdlc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2sudXMtZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtYXAtbm9ydGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtd2Vic2l0ZS1hcC1zb3V0aGVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy13ZWJzaXRlLWFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtZXUtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtc2EtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtd2Vic2l0ZS5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUudXMtZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInQzbDNwMHJ0Lm5ldCIsCgkidGVsZS5hbXVuZS5vcmciLAoJImFwaWdlZS5pbyIsCgkic2lpaXRlcy5jb20iLAoJImFwcHNwYWNlaG9zdGVkLmNvbSIsCgkiYXBwc3BhY2V1c2VyY29udGVudC5jb20iLAoJImFwcHVkby5uZXQiLAoJIm9uLWFwdGlibGUuY29tIiwKCSJ1c2VyLmFzZWluZXQubmUuanAiLAoJImd2LnZjIiwKCSJkLmd2LnZjIiwKCSJ1c2VyLnBhcnR5LmV1cyIsCgkicGltaWVudGEub3JnIiwKCSJwb2l2cm9uLm9yZyIsCgkicG90YWdlci5vcmciLAoJInN3ZWV0cGVwcGVyLm9yZyIsCgkibXlhc3VzdG9yLmNvbSIsCgkiY2RuLnByb2QuYXRsYXNzaWFuLWRldi5uZXQiLAoJInRyYW5zbGF0ZWQucGFnZSIsCgkibXlmcml0ei5uZXQiLAoJIm9uYXZzdGFjay5uZXQiLAoJIiouYXdkZXYuY2EiLAoJIiouYWR2aXNvci53cyIsCgkiZWNvbW1lcmNlLXNob3AucGwiLAoJImItZGF0YS5pbyIsCgkiYmFja3BsYW5lYXBwLmlvIiwKCSJiYWxlbmEtZGV2aWNlcy5jb20iLAoJInJzLmJhIiwKCSIqLmJhbnphaS5jbG91ZCIsCgkiYXBwLmJhbnphaWNsb3VkLmlvIiwKCSIqLmJhY2t5YXJkcy5iYW56YWljbG91ZC5pbyIsCgkiYmFzZS5lYyIsCgkib2ZmaWNpYWwuZWMiLAoJImJ1eXNob3AuanAiLAoJImZhc2hpb25zdG9yZS5qcCIsCgkiaGFuZGNyYWZ0ZWQuanAiLAoJImthd2FpaXNob3AuanAiLAoJInN1cGVyc2FsZS5qcCIsCgkidGhlc2hvcC5qcCIsCgkic2hvcHNlbGVjdC5uZXQiLAoJImJhc2Uuc2hvcCIsCgkiKi5iZWdldC5hcHAiLAoJImJldGFpbmFib3guY29tIiwKCSJibnIubGEiLAoJImJpdGJ1Y2tldC5pbyIsCgkiYmxhY2tiYXVkY2RuLm5ldCIsCgkib2YuamUiLAoJImJsdWViaXRlLmlvIiwKCSJib29tbGEubmV0IiwKCSJib3V0aXIuY29tIiwKCSJib3hmdXNlLmlvIiwKCSJzcXVhcmU3LmNoIiwKCSJicGxhY2VkLmNvbSIsCgkiYnBsYWNlZC5kZSIsCgkic3F1YXJlNy5kZSIsCgkiYnBsYWNlZC5uZXQiLAoJInNxdWFyZTcubmV0IiwKCSJzaG9wLmJyZW5kbHkucnMiLAoJImJyb3dzZXJzYWZldHltYXJrLmlvIiwKCSJ1azAuYmlndi5pbyIsCgkiZGguYnl0ZW1hcmsuY28udWsiLAoJInZtLmJ5dGVtYXJrLmNvLnVrIiwKCSJjYWZqcy5jb20iLAoJIm15Y2QuZXUiLAoJImRyci5hYyIsCgkidXd1LmFpIiwKCSJjYXJyZC5jbyIsCgkiY3JkLmNvIiwKCSJqdS5tcCIsCgkiYWUub3JnIiwKCSJici5jb20iLAoJImNuLmNvbSIsCgkiY29tLmRlIiwKCSJjb20uc2UiLAoJImRlLmNvbSIsCgkiZXUuY29tIiwKCSJnYi5uZXQiLAoJImh1Lm5ldCIsCgkianAubmV0IiwKCSJqcG4uY29tIiwKCSJtZXguY29tIiwKCSJydS5jb20iLAoJInNhLmNvbSIsCgkic2UubmV0IiwKCSJ1ay5jb20iLAoJInVrLm5ldCIsCgkidXMuY29tIiwKCSJ6YS5ieiIsCgkiemEuY29tIiwKCSJhci5jb20iLAoJImh1LmNvbSIsCgkia3IuY29tIiwKCSJuby5jb20iLAoJInFjLmNvbSIsCgkidXkuY29tIiwKCSJhZnJpY2EuY29tIiwKCSJnci5jb20iLAoJImluLm5ldCIsCgkid2ViLmluIiwKCSJ1cy5vcmciLAoJImNvLmNvbSIsCgkiYXVzLmJhc2tldGJhbGwiLAoJIm56LmJhc2tldGJhbGwiLAoJInJhZGlvLmFtIiwKCSJyYWRpby5mbSIsCgkiYy5sYSIsCgkiY2VydG1nci5vcmciLAoJImN4LnVhIiwKCSJkaXNjb3Vyc2UuZ3JvdXAiLAoJImRpc2NvdXJzZS50ZWFtIiwKCSJjbGV2ZXJhcHBzLmlvIiwKCSJjbGVyay5hcHAiLAoJImNsZXJrc3RhZ2UuYXBwIiwKCSIqLmxjbC5kZXYiLAoJIioubGNsc3RhZ2UuZGV2IiwKCSIqLnN0Zy5kZXYiLAoJIiouc3Rnc3RhZ2UuZGV2IiwKCSJjbGlja3Jpc2luZy5uZXQiLAoJImM2Ni5tZSIsCgkiY2xvdWQ2Ni53cyIsCgkiY2xvdWQ2Ni56b25lIiwKCSJqZGV2Y2xvdWQuY29tIiwKCSJ3cGRldmNsb3VkLmNvbSIsCgkiY2xvdWRhY2Nlc3MuaG9zdCIsCgkiZnJlZXNpdGUuaG9zdCIsCgkiY2xvdWRhY2Nlc3MubmV0IiwKCSJjbG91ZGNvbnRyb2xsZWQuY29tIiwKCSJjbG91ZGNvbnRyb2xhcHAuY29tIiwKCSIqLmNsb3VkZXJhLnNpdGUiLAoJInBhZ2VzLmRldiIsCgkidHJ5Y2xvdWRmbGFyZS5jb20iLAoJIndvcmtlcnMuZGV2IiwKCSJ3bmV4dC5hcHAiLAoJImNvLmNhIiwKCSIqLm90YXAuY28iLAoJImNvLmN6IiwKCSJjLmNkbjc3Lm9yZyIsCgkiY2RuNzctc3NsLm5ldCIsCgkici5jZG43Ny5uZXQiLAoJInJzYy5jZG43Ny5vcmciLAoJInNzbC5vcmlnaW4uY2RuNzctc2VjdXJlLm9yZyIsCgkiY2xvdWRucy5hc2lhIiwKCSJjbG91ZG5zLmJpeiIsCgkiY2xvdWRucy5jbHViIiwKCSJjbG91ZG5zLmNjIiwKCSJjbG91ZG5zLmV1IiwKCSJjbG91ZG5zLmluIiwKCSJjbG91ZG5zLmluZm8iLAoJImNsb3VkbnMub3JnIiwKCSJjbG91ZG5zLnBybyIsCgkiY2xvdWRucy5wdyIsCgkiY2xvdWRucy51cyIsCgkiY25weS5nZG4iLAoJImNvZGViZXJnLnBhZ2UiLAoJImNvLm5sIiwKCSJjby5ubyIsCgkid2ViaG9zdGluZy5iZSIsCgkiaG9zdGluZy1jbHVzdGVyLm5sIiwKCSJhYy5ydSIsCgkiZWR1LnJ1IiwKCSJnb3YucnUiLAoJImludC5ydSIsCgkibWlsLnJ1IiwKCSJ0ZXN0LnJ1IiwKCSJkeW4uY29zaWRucy5kZSIsCgkiZHluYW1pc2NoZXMtZG5zLmRlIiwKCSJkbnN1cGRhdGVyLmRlIiwKCSJpbnRlcm5ldC1kbnMuZGUiLAoJImwtby1nLWktbi5kZSIsCgkiZHluYW1pYy1kbnMuaW5mbyIsCgkiZmVzdGUtaXAubmV0IiwKCSJrbngtc2VydmVyLm5ldCIsCgkic3RhdGljLWFjY2Vzcy5uZXQiLAoJInJlYWxtLmN6IiwKCSIqLmNyeXB0b25vbWljLm5ldCIsCgkiY3VwY2FrZS5pcyIsCgkiY3Vydi5kZXYiLAoJIiouY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY2kuY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY3AuY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY3MuY3VzdG9tZXItb2NpLmNvbSIsCgkiY3lvbi5saW5rIiwKCSJjeW9uLnNpdGUiLAoJImZud2suc2l0ZSIsCgkiZm9saW9uZXR3b3JrLnNpdGUiLAoJInBsYXRmb3JtMC5hcHAiLAoJImRhcGxpZS5tZSIsCgkibG9jYWxob3N0LmRhcGxpZS5tZSIsCgkiZGF0dG9sb2NhbC5jb20iLAoJImRhdHRvcmVsYXkuY29tIiwKCSJkYXR0b3dlYi5jb20iLAoJIm15ZGF0dG8uY29tIiwKCSJkYXR0b2xvY2FsLm5ldCIsCgkibXlkYXR0by5uZXQiLAoJImJpei5kayIsCgkiY28uZGsiLAoJImZpcm0uZGsiLAoJInJlZy5kayIsCgkic3RvcmUuZGsiLAoJImR5bmRucy5kYXBwbm9kZS5pbyIsCgkiKi5kYXBwcy5lYXJ0aCIsCgkiKi5ienouZGFwcHMuZWFydGgiLAoJImJ1aWx0d2l0aGRhcmsuY29tIiwKCSJkZW1vLmRhdGFkZXRlY3QuY29tIiwKCSJpbnN0YW5jZS5kYXRhZGV0ZWN0LmNvbSIsCgkiZWRnZXN0YWNrLm1lIiwKCSJkZG5zNS5jb20iLAoJImRlYmlhbi5uZXQiLAoJImRlbm8uZGV2IiwKCSJkZW5vLXN0YWdpbmcuZGV2IiwKCSJkZWR5bi5pbyIsCgkiZGV0YS5hcHAiLAoJImRldGEuZGV2IiwKCSIqLnJzcy5teS5pZCIsCgkiKi5kaWhlci5zb2x1dGlvbnMiLAoJImRpc2NvcmRzYXlzLmNvbSIsCgkiZGlzY29yZHNlei5jb20iLAoJImpvemkuYml6IiwKCSJkbnNob21lLmRlIiwKCSJvbmxpbmUudGgiLAoJInNob3AudGgiLAoJImRyYXlkZG5zLmNvbSIsCgkic2hvcGFyZW5hLnBsIiwKCSJkcmVhbWhvc3RlcnMuY29tIiwKCSJteWRyb2JvLmNvbSIsCgkiZHJ1ZC5pbyIsCgkiZHJ1ZC51cyIsCgkiZHVja2Rucy5vcmciLAoJImJpcC5zaCIsCgkiYml0YnJpZGdlLm5ldCIsCgkiZHkuZmkiLAoJInR1bmsub3JnIiwKCSJkeW5kbnMtYXQtaG9tZS5jb20iLAoJImR5bmRucy1hdC13b3JrLmNvbSIsCgkiZHluZG5zLWJsb2cuY29tIiwKCSJkeW5kbnMtZnJlZS5jb20iLAoJImR5bmRucy1ob21lLmNvbSIsCgkiZHluZG5zLWlwLmNvbSIsCgkiZHluZG5zLW1haWwuY29tIiwKCSJkeW5kbnMtb2ZmaWNlLmNvbSIsCgkiZHluZG5zLXBpY3MuY29tIiwKCSJkeW5kbnMtcmVtb3RlLmNvbSIsCgkiZHluZG5zLXNlcnZlci5jb20iLAoJImR5bmRucy13ZWIuY29tIiwKCSJkeW5kbnMtd2lraS5jb20iLAoJImR5bmRucy13b3JrLmNvbSIsCgkiZHluZG5zLmJpeiIsCgkiZHluZG5zLmluZm8iLAoJImR5bmRucy5vcmciLAoJImR5bmRucy50diIsCgkiYXQtYmFuZC1jYW1wLm5ldCIsCgkiYXRoLmN4IiwKCSJiYXJyZWwtb2Yta25vd2xlZGdlLmluZm8iLAoJImJhcnJlbGwtb2Yta25vd2xlZGdlLmluZm8iLAoJImJldHRlci10aGFuLnR2IiwKCSJibG9nZG5zLmNvbSIsCgkiYmxvZ2Rucy5uZXQiLAoJImJsb2dkbnMub3JnIiwKCSJibG9nc2l0ZS5vcmciLAoJImJvbGRseWdvaW5nbm93aGVyZS5vcmciLAoJImJyb2tlLWl0Lm5ldCIsCgkiYnV5c2hvdXNlcy5uZXQiLAoJImNlY2hpcmUuY29tIiwKCSJkbnNhbGlhcy5jb20iLAoJImRuc2FsaWFzLm5ldCIsCgkiZG5zYWxpYXMub3JnIiwKCSJkbnNkb2pvLmNvbSIsCgkiZG5zZG9qby5uZXQiLAoJImRuc2Rvam8ub3JnIiwKCSJkb2VzLWl0Lm5ldCIsCgkiZG9lc250ZXhpc3QuY29tIiwKCSJkb2VzbnRleGlzdC5vcmciLAoJImRvbnRleGlzdC5jb20iLAoJImRvbnRleGlzdC5uZXQiLAoJImRvbnRleGlzdC5vcmciLAoJImRvb21kbnMuY29tIiwKCSJkb29tZG5zLm9yZyIsCgkiZHZyZG5zLm9yZyIsCgkiZHluLW8tc2F1ci5jb20iLAoJImR5bmFsaWFzLmNvbSIsCgkiZHluYWxpYXMubmV0IiwKCSJkeW5hbGlhcy5vcmciLAoJImR5bmF0aG9tZS5uZXQiLAoJImR5bmRucy53cyIsCgkiZW5kb2ZpbnRlcm5ldC5uZXQiLAoJImVuZG9maW50ZXJuZXQub3JnIiwKCSJlbmRvZnRoZWludGVybmV0Lm9yZyIsCgkiZXN0LWEtbGEtbWFpc29uLmNvbSIsCgkiZXN0LWEtbGEtbWFzaW9uLmNvbSIsCgkiZXN0LWxlLXBhdHJvbi5jb20iLAoJImVzdC1tb24tYmxvZ3VldXIuY29tIiwKCSJmb3ItYmV0dGVyLmJpeiIsCgkiZm9yLW1vcmUuYml6IiwKCSJmb3Itb3VyLmluZm8iLAoJImZvci1zb21lLmJpeiIsCgkiZm9yLXRoZS5iaXoiLAoJImZvcmdvdC5oZXIubmFtZSIsCgkiZm9yZ290Lmhpcy5uYW1lIiwKCSJmcm9tLWFrLmNvbSIsCgkiZnJvbS1hbC5jb20iLAoJImZyb20tYXIuY29tIiwKCSJmcm9tLWF6Lm5ldCIsCgkiZnJvbS1jYS5jb20iLAoJImZyb20tY28ubmV0IiwKCSJmcm9tLWN0LmNvbSIsCgkiZnJvbS1kYy5jb20iLAoJImZyb20tZGUuY29tIiwKCSJmcm9tLWZsLmNvbSIsCgkiZnJvbS1nYS5jb20iLAoJImZyb20taGkuY29tIiwKCSJmcm9tLWlhLmNvbSIsCgkiZnJvbS1pZC5jb20iLAoJImZyb20taWwuY29tIiwKCSJmcm9tLWluLmNvbSIsCgkiZnJvbS1rcy5jb20iLAoJImZyb20ta3kuY29tIiwKCSJmcm9tLWxhLm5ldCIsCgkiZnJvbS1tYS5jb20iLAoJImZyb20tbWQuY29tIiwKCSJmcm9tLW1lLm9yZyIsCgkiZnJvbS1taS5jb20iLAoJImZyb20tbW4uY29tIiwKCSJmcm9tLW1vLmNvbSIsCgkiZnJvbS1tcy5jb20iLAoJImZyb20tbXQuY29tIiwKCSJmcm9tLW5jLmNvbSIsCgkiZnJvbS1uZC5jb20iLAoJImZyb20tbmUuY29tIiwKCSJmcm9tLW5oLmNvbSIsCgkiZnJvbS1uai5jb20iLAoJImZyb20tbm0uY29tIiwKCSJmcm9tLW52LmNvbSIsCgkiZnJvbS1ueS5uZXQiLAoJImZyb20tb2guY29tIiwKCSJmcm9tLW9rLmNvbSIsCgkiZnJvbS1vci5jb20iLAoJImZyb20tcGEuY29tIiwKCSJmcm9tLXByLmNvbSIsCgkiZnJvbS1yaS5jb20iLAoJImZyb20tc2MuY29tIiwKCSJmcm9tLXNkLmNvbSIsCgkiZnJvbS10bi5jb20iLAoJImZyb20tdHguY29tIiwKCSJmcm9tLXV0LmNvbSIsCgkiZnJvbS12YS5jb20iLAoJImZyb20tdnQuY29tIiwKCSJmcm9tLXdhLmNvbSIsCgkiZnJvbS13aS5jb20iLAoJImZyb20td3YuY29tIiwKCSJmcm9tLXd5LmNvbSIsCgkiZnRwYWNjZXNzLmNjIiwKCSJmdWV0dGVydGRhc25ldHouZGUiLAoJImdhbWUtaG9zdC5vcmciLAoJImdhbWUtc2VydmVyLmNjIiwKCSJnZXRteWlwLmNvbSIsCgkiZ2V0cy1pdC5uZXQiLAoJImdvLmR5bmRucy5vcmciLAoJImdvdGRucy5jb20iLAoJImdvdGRucy5vcmciLAoJImdyb2tzLXRoZS5pbmZvIiwKCSJncm9rcy10aGlzLmluZm8iLAoJImhhbS1yYWRpby1vcC5uZXQiLAoJImhlcmUtZm9yLW1vcmUuaW5mbyIsCgkiaG9iYnktc2l0ZS5jb20iLAoJImhvYmJ5LXNpdGUub3JnIiwKCSJob21lLmR5bmRucy5vcmciLAoJImhvbWVkbnMub3JnIiwKCSJob21lZnRwLm5ldCIsCgkiaG9tZWZ0cC5vcmciLAoJImhvbWVpcC5uZXQiLAoJImhvbWVsaW51eC5jb20iLAoJImhvbWVsaW51eC5uZXQiLAoJImhvbWVsaW51eC5vcmciLAoJImhvbWV1bml4LmNvbSIsCgkiaG9tZXVuaXgubmV0IiwKCSJob21ldW5peC5vcmciLAoJImlhbWFsbGFtYS5jb20iLAoJImluLXRoZS1iYW5kLm5ldCIsCgkiaXMtYS1hbmFyY2hpc3QuY29tIiwKCSJpcy1hLWJsb2dnZXIuY29tIiwKCSJpcy1hLWJvb2trZWVwZXIuY29tIiwKCSJpcy1hLWJydWluc2Zhbi5vcmciLAoJImlzLWEtYnVsbHMtZmFuLmNvbSIsCgkiaXMtYS1jYW5kaWRhdGUub3JnIiwKCSJpcy1hLWNhdGVyZXIuY29tIiwKCSJpcy1hLWNlbHRpY3NmYW4ub3JnIiwKCSJpcy1hLWNoZWYuY29tIiwKCSJpcy1hLWNoZWYubmV0IiwKCSJpcy1hLWNoZWYub3JnIiwKCSJpcy1hLWNvbnNlcnZhdGl2ZS5jb20iLAoJImlzLWEtY3BhLmNvbSIsCgkiaXMtYS1jdWJpY2xlLXNsYXZlLmNvbSIsCgkiaXMtYS1kZW1vY3JhdC5jb20iLAoJImlzLWEtZGVzaWduZXIuY29tIiwKCSJpcy1hLWRvY3Rvci5jb20iLAoJImlzLWEtZmluYW5jaWFsYWR2aXNvci5jb20iLAoJImlzLWEtZ2Vlay5jb20iLAoJImlzLWEtZ2Vlay5uZXQiLAoJImlzLWEtZ2Vlay5vcmciLAoJImlzLWEtZ3JlZW4uY29tIiwKCSJpcy1hLWd1cnUuY29tIiwKCSJpcy1hLWhhcmQtd29ya2VyLmNvbSIsCgkiaXMtYS1odW50ZXIuY29tIiwKCSJpcy1hLWtuaWdodC5vcmciLAoJImlzLWEtbGFuZHNjYXBlci5jb20iLAoJImlzLWEtbGF3eWVyLmNvbSIsCgkiaXMtYS1saWJlcmFsLmNvbSIsCgkiaXMtYS1saWJlcnRhcmlhbi5jb20iLAoJImlzLWEtbGludXgtdXNlci5vcmciLAoJImlzLWEtbGxhbWEuY29tIiwKCSJpcy1hLW11c2ljaWFuLmNvbSIsCgkiaXMtYS1uYXNjYXJmYW4uY29tIiwKCSJpcy1hLW51cnNlLmNvbSIsCgkiaXMtYS1wYWludGVyLmNvbSIsCgkiaXMtYS1wYXRzZmFuLm9yZyIsCgkiaXMtYS1wZXJzb25hbHRyYWluZXIuY29tIiwKCSJpcy1hLXBob3RvZ3JhcGhlci5jb20iLAoJImlzLWEtcGxheWVyLmNvbSIsCgkiaXMtYS1yZXB1YmxpY2FuLmNvbSIsCgkiaXMtYS1yb2Nrc3Rhci5jb20iLAoJImlzLWEtc29jaWFsaXN0LmNvbSIsCgkiaXMtYS1zb3hmYW4ub3JnIiwKCSJpcy1hLXN0dWRlbnQuY29tIiwKCSJpcy1hLXRlYWNoZXIuY29tIiwKCSJpcy1hLXRlY2hpZS5jb20iLAoJImlzLWEtdGhlcmFwaXN0LmNvbSIsCgkiaXMtYW4tYWNjb3VudGFudC5jb20iLAoJImlzLWFuLWFjdG9yLmNvbSIsCgkiaXMtYW4tYWN0cmVzcy5jb20iLAoJImlzLWFuLWFuYXJjaGlzdC5jb20iLAoJImlzLWFuLWFydGlzdC5jb20iLAoJImlzLWFuLWVuZ2luZWVyLmNvbSIsCgkiaXMtYW4tZW50ZXJ0YWluZXIuY29tIiwKCSJpcy1ieS51cyIsCgkiaXMtY2VydGlmaWVkLmNvbSIsCgkiaXMtZm91bmQub3JnIiwKCSJpcy1nb25lLmNvbSIsCgkiaXMtaW50by1hbmltZS5jb20iLAoJImlzLWludG8tY2Fycy5jb20iLAoJImlzLWludG8tY2FydG9vbnMuY29tIiwKCSJpcy1pbnRvLWdhbWVzLmNvbSIsCgkiaXMtbGVldC5jb20iLAoJImlzLWxvc3Qub3JnIiwKCSJpcy1ub3QtY2VydGlmaWVkLmNvbSIsCgkiaXMtc2F2ZWQub3JnIiwKCSJpcy1zbGljay5jb20iLAoJImlzLXViZXJsZWV0LmNvbSIsCgkiaXMtdmVyeS1iYWQub3JnIiwKCSJpcy12ZXJ5LWV2aWwub3JnIiwKCSJpcy12ZXJ5LWdvb2Qub3JnIiwKCSJpcy12ZXJ5LW5pY2Uub3JnIiwKCSJpcy12ZXJ5LXN3ZWV0Lm9yZyIsCgkiaXMtd2l0aC10aGViYW5kLmNvbSIsCgkiaXNhLWdlZWsuY29tIiwKCSJpc2EtZ2Vlay5uZXQiLAoJImlzYS1nZWVrLm9yZyIsCgkiaXNhLWhvY2tleW51dC5jb20iLAoJImlzc21hcnRlcnRoYW55b3UuY29tIiwKCSJpc3RlaW5nZWVrLmRlIiwKCSJpc3RtZWluLmRlIiwKCSJraWNrcy1hc3MubmV0IiwKCSJraWNrcy1hc3Mub3JnIiwKCSJrbm93c2l0YWxsLmluZm8iLAoJImxhbmQtNC1zYWxlLnVzIiwKCSJsZWJ0aW1uZXR6LmRlIiwKCSJsZWl0dW5nc2VuLmRlIiwKCSJsaWtlcy1waWUuY29tIiwKCSJsaWtlc2NhbmR5LmNvbSIsCgkibWVyc2VpbmUubnUiLAoJIm1pbmUubnUiLAoJIm1pc2NvbmZ1c2VkLm9yZyIsCgkibXlwZXRzLndzIiwKCSJteXBob3Rvcy5jYyIsCgkibmVhdC11cmwuY29tIiwKCSJvZmZpY2Utb24tdGhlLm5ldCIsCgkib24tdGhlLXdlYi50diIsCgkicG9kem9uZS5uZXQiLAoJInBvZHpvbmUub3JnIiwKCSJyZWFkbXlibG9nLm9yZyIsCgkic2F2ZXMtdGhlLXdoYWxlcy5jb20iLAoJInNjcmFwcGVyLXNpdGUubmV0IiwKCSJzY3JhcHBpbmcuY2MiLAoJInNlbGZpcC5iaXoiLAoJInNlbGZpcC5jb20iLAoJInNlbGZpcC5pbmZvIiwKCSJzZWxmaXAubmV0IiwKCSJzZWxmaXAub3JnIiwKCSJzZWxscy1mb3ItbGVzcy5jb20iLAoJInNlbGxzLWZvci11LmNvbSIsCgkic2VsbHMtaXQubmV0IiwKCSJzZWxsc3lvdXJob21lLm9yZyIsCgkic2VydmViYnMuY29tIiwKCSJzZXJ2ZWJicy5uZXQiLAoJInNlcnZlYmJzLm9yZyIsCgkic2VydmVmdHAubmV0IiwKCSJzZXJ2ZWZ0cC5vcmciLAoJInNlcnZlZ2FtZS5vcmciLAoJInNoYWNrbmV0Lm51IiwKCSJzaW1wbGUtdXJsLmNvbSIsCgkic3BhY2UtdG8tcmVudC5jb20iLAoJInN0dWZmLTQtc2FsZS5vcmciLAoJInN0dWZmLTQtc2FsZS51cyIsCgkidGVhY2hlcy15b2dhLmNvbSIsCgkidGhydWhlcmUubmV0IiwKCSJ0cmFldW10Z2VyYWRlLmRlIiwKCSJ3ZWJob3AuYml6IiwKCSJ3ZWJob3AuaW5mbyIsCgkid2ViaG9wLm5ldCIsCgkid2ViaG9wLm9yZyIsCgkid29yc2UtdGhhbi50diIsCgkid3JpdGVzdGhpc2Jsb2cuY29tIiwKCSJkZG5zcy5kZSIsCgkiZHluLmRkbnNzLmRlIiwKCSJkeW5kbnMuZGRuc3MuZGUiLAoJImR5bmRuczEuZGUiLAoJImR5bi1pcDI0LmRlIiwKCSJob21lLXdlYnNlcnZlci5kZSIsCgkiZHluLmhvbWUtd2Vic2VydmVyLmRlIiwKCSJteWhvbWUtc2VydmVyLmRlIiwKCSJkZG5zcy5vcmciLAoJImRlZmluaW1hLm5ldCIsCgkiZGVmaW5pbWEuaW8iLAoJIm9uZGlnaXRhbG9jZWFuLmFwcCIsCgkiKi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tIiwKCSJiY2kuZG5zdHJhY2UucHJvIiwKCSJkZG5zZnJlZS5jb20iLAoJImRkbnNnZWVrLmNvbSIsCgkiZ2lpemUuY29tIiwKCSJnbGVlemUuY29tIiwKCSJrb3pvdy5jb20iLAoJImxvc2V5b3VyaXAuY29tIiwKCSJvb2d1eS5jb20iLAoJInRoZXdvcmtwYy5jb20iLAoJImNhc2FjYW0ubmV0IiwKCSJkeW51Lm5ldCIsCgkiYWNjZXNzY2FtLm9yZyIsCgkiY2FtZHZyLm9yZyIsCgkiZnJlZWRkbnMub3JnIiwKCSJteXdpcmUub3JnIiwKCSJ3ZWJyZWRpcmVjdC5vcmciLAoJIm15ZGRucy5yb2NrcyIsCgkiYmxvZ3NpdGUueHl6IiwKCSJkeW52Ni5uZXQiLAoJImU0LmN6IiwKCSJlZXJvLm9ubGluZSIsCgkiZWVyby1zdGFnZS5vbmxpbmUiLAoJImVsZW1lbnRvci5jbG91ZCIsCgkiZWxlbWVudG9yLmNvb2wiLAoJImVuLXJvb3QuZnIiLAoJIm15dHVsZWFwLmNvbSIsCgkidHVsZWFwLXBhcnRuZXJzLmNvbSIsCgkiZW5jci5hcHAiLAoJImVuY29yZWFwaS5jb20iLAoJIm9ucmVkLm9uZSIsCgkic3RhZ2luZy5vbnJlZC5vbmUiLAoJImV1LmVuY293YXkuY2xvdWQiLAoJImV1Lm9yZyIsCgkiYWwuZXUub3JnIiwKCSJhc3NvLmV1Lm9yZyIsCgkiYXQuZXUub3JnIiwKCSJhdS5ldS5vcmciLAoJImJlLmV1Lm9yZyIsCgkiYmcuZXUub3JnIiwKCSJjYS5ldS5vcmciLAoJImNkLmV1Lm9yZyIsCgkiY2guZXUub3JnIiwKCSJjbi5ldS5vcmciLAoJImN5LmV1Lm9yZyIsCgkiY3ouZXUub3JnIiwKCSJkZS5ldS5vcmciLAoJImRrLmV1Lm9yZyIsCgkiZWR1LmV1Lm9yZyIsCgkiZWUuZXUub3JnIiwKCSJlcy5ldS5vcmciLAoJImZpLmV1Lm9yZyIsCgkiZnIuZXUub3JnIiwKCSJnci5ldS5vcmciLAoJImhyLmV1Lm9yZyIsCgkiaHUuZXUub3JnIiwKCSJpZS5ldS5vcmciLAoJImlsLmV1Lm9yZyIsCgkiaW4uZXUub3JnIiwKCSJpbnQuZXUub3JnIiwKCSJpcy5ldS5vcmciLAoJIml0LmV1Lm9yZyIsCgkianAuZXUub3JnIiwKCSJrci5ldS5vcmciLAoJImx0LmV1Lm9yZyIsCgkibHUuZXUub3JnIiwKCSJsdi5ldS5vcmciLAoJIm1jLmV1Lm9yZyIsCgkibWUuZXUub3JnIiwKCSJtay5ldS5vcmciLAoJIm10LmV1Lm9yZyIsCgkibXkuZXUub3JnIiwKCSJuZXQuZXUub3JnIiwKCSJuZy5ldS5vcmciLAoJIm5sLmV1Lm9yZyIsCgkibm8uZXUub3JnIiwKCSJuei5ldS5vcmciLAoJInBhcmlzLmV1Lm9yZyIsCgkicGwuZXUub3JnIiwKCSJwdC5ldS5vcmciLAoJInEtYS5ldS5vcmciLAoJInJvLmV1Lm9yZyIsCgkicnUuZXUub3JnIiwKCSJzZS5ldS5vcmciLAoJInNpLmV1Lm9yZyIsCgkic2suZXUub3JnIiwKCSJ0ci5ldS5vcmciLAoJInVrLmV1Lm9yZyIsCgkidXMuZXUub3JnIiwKCSJldXJvZGlyLnJ1IiwKCSJldS0xLmV2ZW5ub2RlLmNvbSIsCgkiZXUtMi5ldmVubm9kZS5jb20iLAoJImV1LTMuZXZlbm5vZGUuY29tIiwKCSJldS00LmV2ZW5ub2RlLmNvbSIsCgkidXMtMS5ldmVubm9kZS5jb20iLAoJInVzLTIuZXZlbm5vZGUuY29tIiwKCSJ1cy0zLmV2ZW5ub2RlLmNvbSIsCgkidXMtNC5ldmVubm9kZS5jb20iLAoJInR3bWFpbC5jYyIsCgkidHdtYWlsLm5ldCIsCgkidHdtYWlsLm9yZyIsCgkibXltYWlsZXIuY29tLnR3IiwKCSJ1cmwudHciLAoJIm9uZmFicmljYS5jb20iLAoJImFwcHMuZmJzYnguY29tIiwKCSJydS5uZXQiLAoJImFkeWdleWEucnUiLAoJImJhc2hraXJpYS5ydSIsCgkiYmlyLnJ1IiwKCSJjYmcucnUiLAoJImNvbS5ydSIsCgkiZGFnZXN0YW4ucnUiLAoJImdyb3pueS5ydSIsCgkia2FsbXlraWEucnUiLAoJImt1c3RhbmFpLnJ1IiwKCSJtYXJpbmUucnUiLAoJIm1vcmRvdmlhLnJ1IiwKCSJtc2sucnUiLAoJIm15dGlzLnJ1IiwKCSJuYWxjaGlrLnJ1IiwKCSJub3YucnUiLAoJInB5YXRpZ29yc2sucnUiLAoJInNwYi5ydSIsCgkidmxhZGlrYXZrYXoucnUiLAoJInZsYWRpbWlyLnJ1IiwKCSJhYmtoYXppYS5zdSIsCgkiYWR5Z2V5YS5zdSIsCgkiYWt0eXViaW5zay5zdSIsCgkiYXJraGFuZ2Vsc2suc3UiLAoJImFybWVuaWEuc3UiLAoJImFzaGdhYmFkLnN1IiwKCSJhemVyYmFpamFuLnN1IiwKCSJiYWxhc2hvdi5zdSIsCgkiYmFzaGtpcmlhLnN1IiwKCSJicnlhbnNrLnN1IiwKCSJidWtoYXJhLnN1IiwKCSJjaGlta2VudC5zdSIsCgkiZGFnZXN0YW4uc3UiLAoJImVhc3Qta2F6YWtoc3Rhbi5zdSIsCgkiZXhuZXQuc3UiLAoJImdlb3JnaWEuc3UiLAoJImdyb3pueS5zdSIsCgkiaXZhbm92by5zdSIsCgkiamFtYnlsLnN1IiwKCSJrYWxteWtpYS5zdSIsCgkia2FsdWdhLnN1IiwKCSJrYXJhY29sLnN1IiwKCSJrYXJhZ2FuZGEuc3UiLAoJImthcmVsaWEuc3UiLAoJImtoYWthc3NpYS5zdSIsCgkia3Jhc25vZGFyLnN1IiwKCSJrdXJnYW4uc3UiLAoJImt1c3RhbmFpLnN1IiwKCSJsZW51Zy5zdSIsCgkibWFuZ3lzaGxhay5zdSIsCgkibW9yZG92aWEuc3UiLAoJIm1zay5zdSIsCgkibXVybWFuc2suc3UiLAoJIm5hbGNoaWsuc3UiLAoJIm5hdm9pLnN1IiwKCSJub3J0aC1rYXpha2hzdGFuLnN1IiwKCSJub3Yuc3UiLAoJIm9ibmluc2suc3UiLAoJInBlbnphLnN1IiwKCSJwb2tyb3Zzay5zdSIsCgkic29jaGkuc3UiLAoJInNwYi5zdSIsCgkidGFzaGtlbnQuc3UiLAoJInRlcm1lei5zdSIsCgkidG9nbGlhdHRpLnN1IiwKCSJ0cm9pdHNrLnN1IiwKCSJ0c2VsaW5vZ3JhZC5zdSIsCgkidHVsYS5zdSIsCgkidHV2YS5zdSIsCgkidmxhZGlrYXZrYXouc3UiLAoJInZsYWRpbWlyLnN1IiwKCSJ2b2xvZ2RhLnN1IiwKCSJjaGFubmVsc2R2ci5uZXQiLAoJInUuY2hhbm5lbHNkdnIubmV0IiwKCSJlZGdlY29tcHV0ZS5hcHAiLAoJImZhc3RseS10ZXJyYXJpdW0uY29tIiwKCSJmYXN0bHlsYi5uZXQiLAoJIm1hcC5mYXN0bHlsYi5uZXQiLAoJImZyZWV0bHMuZmFzdGx5Lm5ldCIsCgkibWFwLmZhc3RseS5uZXQiLAoJImEucHJvZC5mYXN0bHkubmV0IiwKCSJnbG9iYWwucHJvZC5mYXN0bHkubmV0IiwKCSJhLnNzbC5mYXN0bHkubmV0IiwKCSJiLnNzbC5mYXN0bHkubmV0IiwKCSJnbG9iYWwuc3NsLmZhc3RseS5uZXQiLAoJImZhc3R2cHMtc2VydmVyLmNvbSIsCgkiZmFzdHZwcy5ob3N0IiwKCSJteWZhc3QuaG9zdCIsCgkiZmFzdHZwcy5zaXRlIiwKCSJteWZhc3Quc3BhY2UiLAoJImZlZG9yYWluZnJhY2xvdWQub3JnIiwKCSJmZWRvcmFwZW9wbGUub3JnIiwKCSJjbG91ZC5mZWRvcmFwcm9qZWN0Lm9yZyIsCgkiYXBwLm9zLmZlZG9yYXByb2plY3Qub3JnIiwKCSJhcHAub3Muc3RnLmZlZG9yYXByb2plY3Qub3JnIiwKCSJjb25uLnVrIiwKCSJjb3Byby51ayIsCgkiaG9zcC51ayIsCgkibXlkb2Jpc3MuY29tIiwKCSJmaC1tdWVuc3Rlci5pbyIsCgkiZmlsZWdlYXIubWUiLAoJImZpbGVnZWFyLWF1Lm1lIiwKCSJmaWxlZ2Vhci1kZS5tZSIsCgkiZmlsZWdlYXItZ2IubWUiLAoJImZpbGVnZWFyLWllLm1lIiwKCSJmaWxlZ2Vhci1qcC5tZSIsCgkiZmlsZWdlYXItc2cubWUiLAoJImZpcmViYXNlYXBwLmNvbSIsCgkiZmlyZXdlYi5hcHAiLAoJImZsYXAuaWQiLAoJIm9uZmxhc2hkcml2ZS5hcHAiLAoJImZsZHJ2LmNvbSIsCgkiZmx5LmRldiIsCgkiZWRnZWFwcC5uZXQiLAoJInNody5pbyIsCgkiZmx5bm5ob3N0aW5nLm5ldCIsCgkiZm9yZ2VibG9ja3MuY29tIiwKCSJpZC5mb3JnZXJvY2suaW8iLAoJImZyYW1lci5hcHAiLAoJImZyYW1lcmNhbnZhcy5jb20iLAoJIiouZnJ1c2t5LmRlIiwKCSJyYXZwYWdlLmNvLmlsIiwKCSIwZS52YyIsCgkiZnJlZWJveC1vcy5jb20iLAoJImZyZWVib3hvcy5jb20iLAoJImZieC1vcy5mciIsCgkiZmJ4b3MuZnIiLAoJImZyZWVib3gtb3MuZnIiLAoJImZyZWVib3hvcy5mciIsCgkiZnJlZWRlc2t0b3Aub3JnIiwKCSJmcmVlbXlpcC5jb20iLAoJIndpZW4uZnVua2ZldWVyLmF0IiwKCSIqLmZ1dHVyZWNtcy5hdCIsCgkiKi5leC5mdXR1cmVjbXMuYXQiLAoJIiouaW4uZnV0dXJlY21zLmF0IiwKCSJmdXR1cmVob3N0aW5nLmF0IiwKCSJmdXR1cmVtYWlsaW5nLmF0IiwKCSIqLmV4Lm9ydHNpbmZvLmF0IiwKCSIqLmt1bmRlbi5vcnRzaW5mby5hdCIsCgkiKi5zdGF0aWNzLmNsb3VkIiwKCSJpbmRlcGVuZGVudC1jb21taXNzaW9uLnVrIiwKCSJpbmRlcGVuZGVudC1pbnF1ZXN0LnVrIiwKCSJpbmRlcGVuZGVudC1pbnF1aXJ5LnVrIiwKCSJpbmRlcGVuZGVudC1wYW5lbC51ayIsCgkiaW5kZXBlbmRlbnQtcmV2aWV3LnVrIiwKCSJwdWJsaWMtaW5xdWlyeS51ayIsCgkicm95YWwtY29tbWlzc2lvbi51ayIsCgkiY2FtcGFpZ24uZ292LnVrIiwKCSJzZXJ2aWNlLmdvdi51ayIsCgkiYXBpLmdvdi51ayIsCgkiZ2VoaXJuLm5lLmpwIiwKCSJ1c2VyY29udGVudC5qcCIsCgkiZ2VudGFwcHMuY29tIiwKCSJnZW50bGVudGFwaXMuY29tIiwKCSJsYWIubXMiLAoJImNkbi1lZGdlcy5uZXQiLAoJImdob3N0LmlvIiwKCSJnc2ouYnoiLAoJImdpdGh1YnVzZXJjb250ZW50LmNvbSIsCgkiZ2l0aHVicHJldmlldy5kZXYiLAoJImdpdGh1Yi5pbyIsCgkiZ2l0bGFiLmlvIiwKCSJnaXRhcHAuc2kiLAoJImdpdHBhZ2Uuc2kiLAoJImdsaXRjaC5tZSIsCgkibm9nLmNvbW11bml0eSIsCgkiY28ucm8iLAoJInNob3Aucm8iLAoJImxvbGlwb3AuaW8iLAoJImFuZ3J5LmpwIiwKCSJiYWJ5Ymx1ZS5qcCIsCgkiYmFieW1pbGsuanAiLAoJImJhY2tkcm9wLmpwIiwKCSJiYW1iaW5hLmpwIiwKCSJiaXR0ZXIuanAiLAoJImJsdXNoLmpwIiwKCSJib28uanAiLAoJImJveS5qcCIsCgkiYm95ZnJpZW5kLmpwIiwKCSJidXQuanAiLAoJImNhbmR5cG9wLmpwIiwKCSJjYXBvby5qcCIsCgkiY2F0Zm9vZC5qcCIsCgkiY2hlYXAuanAiLAoJImNoaWNhcHBhLmpwIiwKCSJjaGlsbG91dC5qcCIsCgkiY2hpcHMuanAiLAoJImNob3dkZXIuanAiLAoJImNodS5qcCIsCgkiY2lhby5qcCIsCgkiY29jb3R0ZS5qcCIsCgkiY29vbGJsb2cuanAiLAoJImNyYW5reS5qcCIsCgkiY3V0ZWdpcmwuanAiLAoJImRhYS5qcCIsCgkiZGVjYS5qcCIsCgkiZGVjaS5qcCIsCgkiZGlnaWNrLmpwIiwKCSJlZ29pc20uanAiLAoJImZha2VmdXIuanAiLAoJImZlbS5qcCIsCgkiZmxpZXIuanAiLAoJImZsb3BweS5qcCIsCgkiZm9vbC5qcCIsCgkiZnJlbmNoa2lzcy5qcCIsCgkiZ2lybGZyaWVuZC5qcCIsCgkiZ2lybHkuanAiLAoJImdsb29teS5qcCIsCgkiZ29ubmEuanAiLAoJImdyZWF0ZXIuanAiLAoJImhhY2NhLmpwIiwKCSJoZWF2eS5qcCIsCgkiaGVyLmpwIiwKCSJoaWhvLmpwIiwKCSJoaXBweS5qcCIsCgkiaG9seS5qcCIsCgkiaHVuZ3J5LmpwIiwKCSJpY3VydXMuanAiLAoJIml0aWdvLmpwIiwKCSJqZWxseWJlYW4uanAiLAoJImtpa2lyYXJhLmpwIiwKCSJraWxsLmpwIiwKCSJraWxvLmpwIiwKCSJrdXJvbi5qcCIsCgkibGl0dGxlc3Rhci5qcCIsCgkibG9saXBvcG1jLmpwIiwKCSJsb2xpdGFwdW5rLmpwIiwKCSJsb21vLmpwIiwKCSJsb3ZlcG9wLmpwIiwKCSJsb3Zlc2ljay5qcCIsCgkibWFpbi5qcCIsCgkibW9kcy5qcCIsCgkibW9uZC5qcCIsCgkibW9uZ29saWFuLmpwIiwKCSJtb28uanAiLAoJIm5hbWFzdGUuanAiLAoJIm5pa2l0YS5qcCIsCgkibm9idXNoaS5qcCIsCgkibm9vci5qcCIsCgkib29wcy5qcCIsCgkicGFyYWxsZWwuanAiLAoJInBhcmFzaXRlLmpwIiwKCSJwZWNvcmkuanAiLAoJInBlZXdlZS5qcCIsCgkicGVubmUuanAiLAoJInBlcHBlci5qcCIsCgkicGVybWEuanAiLAoJInBpZ2JvYXQuanAiLAoJInBpbm9rby5qcCIsCgkicHVueXUuanAiLAoJInB1cHUuanAiLAoJInB1c3N5Y2F0LmpwIiwKCSJweWEuanAiLAoJInJhaW5kcm9wLmpwIiwKCSJyZWFkeW1hZGUuanAiLAoJInNhZGlzdC5qcCIsCgkic2Nob29sYnVzLmpwIiwKCSJzZWNyZXQuanAiLAoJInN0YWJhLmpwIiwKCSJzdHJpcHBlci5qcCIsCgkic3ViLmpwIiwKCSJzdW5ueWRheS5qcCIsCgkidGhpY2suanAiLAoJInRvbmtvdHN1LmpwIiwKCSJ1bmRlci5qcCIsCgkidXBwZXIuanAiLAoJInZlbHZldC5qcCIsCgkidmVyc2UuanAiLAoJInZlcnN1cy5qcCIsCgkidml2aWFuLmpwIiwKCSJ3YXRzb24uanAiLAoJIndlYmxpa2UuanAiLAoJIndoaXRlc25vdy5qcCIsCgkiem9tYmllLmpwIiwKCSJoZXRlbWwubmV0IiwKCSJjbG91ZGFwcHMuZGlnaXRhbCIsCgkibG9uZG9uLmNsb3VkYXBwcy5kaWdpdGFsIiwKCSJweW1udC51ayIsCgkiaG9tZW9mZmljZS5nb3YudWsiLAoJInJvLmltIiwKCSJnb2lwLmRlIiwKCSJydW4uYXBwIiwKCSJhLnJ1bi5hcHAiLAoJIndlYi5hcHAiLAoJIiouMGVtbS5jb20iLAoJImFwcHNwb3QuY29tIiwKCSIqLnIuYXBwc3BvdC5jb20iLAoJImNvZGVzcG90LmNvbSIsCgkiZ29vZ2xlYXBpcy5jb20iLAoJImdvb2dsZWNvZGUuY29tIiwKCSJwYWdlc3BlZWRtb2JpbGl6ZXIuY29tIiwKCSJwdWJsaXNocHJveHkuY29tIiwKCSJ3aXRoZ29vZ2xlLmNvbSIsCgkid2l0aHlvdXR1YmUuY29tIiwKCSIqLmdhdGV3YXkuZGV2IiwKCSJjbG91ZC5nb29nIiwKCSJ0cmFuc2xhdGUuZ29vZyIsCgkiKi51c2VyY29udGVudC5nb29nIiwKCSJjbG91ZGZ1bmN0aW9ucy5uZXQiLAoJImJsb2dzcG90LmFlIiwKCSJibG9nc3BvdC5hbCIsCgkiYmxvZ3Nwb3QuYW0iLAoJImJsb2dzcG90LmJhIiwKCSJibG9nc3BvdC5iZSIsCgkiYmxvZ3Nwb3QuYmciLAoJImJsb2dzcG90LmJqIiwKCSJibG9nc3BvdC5jYSIsCgkiYmxvZ3Nwb3QuY2YiLAoJImJsb2dzcG90LmNoIiwKCSJibG9nc3BvdC5jbCIsCgkiYmxvZ3Nwb3QuY28uYXQiLAoJImJsb2dzcG90LmNvLmlkIiwKCSJibG9nc3BvdC5jby5pbCIsCgkiYmxvZ3Nwb3QuY28ua2UiLAoJImJsb2dzcG90LmNvLm56IiwKCSJibG9nc3BvdC5jby51ayIsCgkiYmxvZ3Nwb3QuY28uemEiLAoJImJsb2dzcG90LmNvbSIsCgkiYmxvZ3Nwb3QuY29tLmFyIiwKCSJibG9nc3BvdC5jb20uYXUiLAoJImJsb2dzcG90LmNvbS5iciIsCgkiYmxvZ3Nwb3QuY29tLmJ5IiwKCSJibG9nc3BvdC5jb20uY28iLAoJImJsb2dzcG90LmNvbS5jeSIsCgkiYmxvZ3Nwb3QuY29tLmVlIiwKCSJibG9nc3BvdC5jb20uZWciLAoJImJsb2dzcG90LmNvbS5lcyIsCgkiYmxvZ3Nwb3QuY29tLm10IiwKCSJibG9nc3BvdC5jb20ubmciLAoJImJsb2dzcG90LmNvbS50ciIsCgkiYmxvZ3Nwb3QuY29tLnV5IiwKCSJibG9nc3BvdC5jdiIsCgkiYmxvZ3Nwb3QuY3oiLAoJImJsb2dzcG90LmRlIiwKCSJibG9nc3BvdC5kayIsCgkiYmxvZ3Nwb3QuZmkiLAoJImJsb2dzcG90LmZyIiwKCSJibG9nc3BvdC5nciIsCgkiYmxvZ3Nwb3QuaGsiLAoJImJsb2dzcG90LmhyIiwKCSJibG9nc3BvdC5odSIsCgkiYmxvZ3Nwb3QuaWUiLAoJImJsb2dzcG90LmluIiwKCSJibG9nc3BvdC5pcyIsCgkiYmxvZ3Nwb3QuaXQiLAoJImJsb2dzcG90LmpwIiwKCSJibG9nc3BvdC5rciIsCgkiYmxvZ3Nwb3QubGkiLAoJImJsb2dzcG90Lmx0IiwKCSJibG9nc3BvdC5sdSIsCgkiYmxvZ3Nwb3QubWQiLAoJImJsb2dzcG90Lm1rIiwKCSJibG9nc3BvdC5tciIsCgkiYmxvZ3Nwb3QubXgiLAoJImJsb2dzcG90Lm15IiwKCSJibG9nc3BvdC5ubCIsCgkiYmxvZ3Nwb3Qubm8iLAoJImJsb2dzcG90LnBlIiwKCSJibG9nc3BvdC5wdCIsCgkiYmxvZ3Nwb3QucWEiLAoJImJsb2dzcG90LnJlIiwKCSJibG9nc3BvdC5ybyIsCgkiYmxvZ3Nwb3QucnMiLAoJImJsb2dzcG90LnJ1IiwKCSJibG9nc3BvdC5zZSIsCgkiYmxvZ3Nwb3Quc2ciLAoJImJsb2dzcG90LnNpIiwKCSJibG9nc3BvdC5zayIsCgkiYmxvZ3Nwb3Quc24iLAoJImJsb2dzcG90LnRkIiwKCSJibG9nc3BvdC50dyIsCgkiYmxvZ3Nwb3QudWciLAoJImJsb2dzcG90LnZuIiwKCSJnb3VwaWxlLmZyIiwKCSJnb3YubmwiLAoJImF3c21wcGwuY29tIiwKCSJnw7xuc3RpZ2Jlc3RlbGxlbi5kZSIsCgkiZ8O8bnN0aWdsaWVmZXJuLmRlIiwKCSJmaW4uY2kiLAoJImZyZWUuaHIiLAoJImNhYS5saSIsCgkidWEucnMiLAoJImNvbmYuc2UiLAoJImhzLnpvbmUiLAoJImhzLnJ1biIsCgkiaGFzaGJhbmcuc2giLAoJImhhc3VyYS5hcHAiLAoJImhhc3VyYS1hcHAuaW8iLAoJInBhZ2VzLml0LmhzLWhlaWxicm9ubi5kZSIsCgkiaGVwZm9yZ2Uub3JnIiwKCSJoZXJva3VhcHAuY29tIiwKCSJoZXJva3Vzc2wuY29tIiwKCSJyYXZlbmRiLmNsb3VkIiwKCSJteXJhdmVuZGIuY29tIiwKCSJyYXZlbmRiLmNvbW11bml0eSIsCgkicmF2ZW5kYi5tZSIsCgkiZGV2ZWxvcG1lbnQucnVuIiwKCSJyYXZlbmRiLnJ1biIsCgkiaG9tZXNrbGVwLnBsIiwKCSJzZWNhYXMuaGsiLAoJImhvcGxpeC5zaG9wIiwKCSJvcnguYml6IiwKCSJiaXouZ2wiLAoJImNvbC5uZyIsCgkiZmlybS5uZyIsCgkiZ2VuLm5nIiwKCSJsdGQubmciLAoJIm5nby5uZyIsCgkiZWR1LnNjb3QiLAoJInNjaC5zbyIsCgkiaG9zdHlob3N0aW5nLmlvIiwKCSJow6Rra2luZW4uZmkiLAoJIioubW9vbnNjYWxlLmlvIiwKCSJtb29uc2NhbGUubmV0IiwKCSJpa2kuZmkiLAoJImlieG9zLml0IiwKCSJpbGlhZGJveG9zLml0IiwKCSJpbXBlcnRyaXhjZG4uY29tIiwKCSJpbXBlcnRyaXguY29tIiwKCSJzbXVzaGNkbi5jb20iLAoJIndwaG9zdGVkbWFpbC5jb20iLAoJIndwbXVjZG4uY29tIiwKCSJ0ZW1wdXJsLmhvc3QiLAoJIndwbXVkZXYuaG9zdCIsCgkiZHluLWJlcmxpbi5kZSIsCgkiaW4tYmVybGluLmRlIiwKCSJpbi1icmIuZGUiLAoJImluLWJ1dHRlci5kZSIsCgkiaW4tZHNsLmRlIiwKCSJpbi1kc2wubmV0IiwKCSJpbi1kc2wub3JnIiwKCSJpbi12cG4uZGUiLAoJImluLXZwbi5uZXQiLAoJImluLXZwbi5vcmciLAoJImJpei5hdCIsCgkiaW5mby5hdCIsCgkiaW5mby5jeCIsCgkiYWMubGVnLmJyIiwKCSJhbC5sZWcuYnIiLAoJImFtLmxlZy5iciIsCgkiYXAubGVnLmJyIiwKCSJiYS5sZWcuYnIiLAoJImNlLmxlZy5iciIsCgkiZGYubGVnLmJyIiwKCSJlcy5sZWcuYnIiLAoJImdvLmxlZy5iciIsCgkibWEubGVnLmJyIiwKCSJtZy5sZWcuYnIiLAoJIm1zLmxlZy5iciIsCgkibXQubGVnLmJyIiwKCSJwYS5sZWcuYnIiLAoJInBiLmxlZy5iciIsCgkicGUubGVnLmJyIiwKCSJwaS5sZWcuYnIiLAoJInByLmxlZy5iciIsCgkicmoubGVnLmJyIiwKCSJybi5sZWcuYnIiLAoJInJvLmxlZy5iciIsCgkicnIubGVnLmJyIiwKCSJycy5sZWcuYnIiLAoJInNjLmxlZy5iciIsCgkic2UubGVnLmJyIiwKCSJzcC5sZWcuYnIiLAoJInRvLmxlZy5iciIsCgkicGl4b2xpbm8uY29tIiwKCSJuYTR1LnJ1IiwKCSJpb3BzeXMuc2UiLAoJImlwaWZvbnkubmV0IiwKCSJpc2VydnNjaHVsZS5kZSIsCgkibWVpbi1pc2Vydi5kZSIsCgkic2NodWxwbGF0dGZvcm0uZGUiLAoJInNjaHVsc2VydmVyLmRlIiwKCSJ0ZXN0LWlzZXJ2LmRlIiwKCSJpc2Vydi5kZXYiLAoJImlvYmIubmV0IiwKCSJtZWwuY2xvdWRsZXRzLmNvbS5hdSIsCgkiY2xvdWQuaW50ZXJob3N0c29sdXRpb25zLmJlIiwKCSJ1c2Vycy5zY2FsZS52aXJ0dWFsY2xvdWQuY29tLmJyIiwKCSJteWNsb3VkLmJ5IiwKCSJhbHAxLmFlLmZsb3cuY2giLAoJImFwcGVuZ2luZS5mbG93LmNoIiwKCSJlcy0xLmF4YXJuZXQuY2xvdWQiLAoJImRpYWRlbS5jbG91ZCIsCgkidmlwLmplbGFzdGljLmNsb3VkIiwKCSJqZWxlLmNsb3VkIiwKCSJpdDEuZXVyLmFydWJhLmplbnYtYXJ1YmEuY2xvdWQiLAoJIml0MS5qZW52LWFydWJhLmNsb3VkIiwKCSJrZWxpd2ViLmNsb3VkIiwKCSJjcy5rZWxpd2ViLmNsb3VkIiwKCSJveGEuY2xvdWQiLAoJInRuLm94YS5jbG91ZCIsCgkidWsub3hhLmNsb3VkIiwKCSJwcmltZXRlbC5jbG91ZCIsCgkidWsucHJpbWV0ZWwuY2xvdWQiLAoJImNhLnJlY2xhaW0uY2xvdWQiLAoJInVrLnJlY2xhaW0uY2xvdWQiLAoJInVzLnJlY2xhaW0uY2xvdWQiLAoJImNoLnRyZW5kaG9zdGluZy5jbG91ZCIsCgkiZGUudHJlbmRob3N0aW5nLmNsb3VkIiwKCSJqZWxlLmNsdWIiLAoJImFtc2NvbXB1dGUuY29tIiwKCSJjbGlja2V0Y2xvdWQuY29tIiwKCSJkb3BhYXMuY29tIiwKCSJoaWRvcmEuY29tIiwKCSJwYWFzLmhvc3RlZC1ieS1wcmV2aWRlci5jb20iLAoJInJhZy1jbG91ZC5ob3N0ZXVyLmNvbSIsCgkicmFnLWNsb3VkLWNoLmhvc3RldXIuY29tIiwKCSJqY2xvdWQuaWstc2VydmVyLmNvbSIsCgkiamNsb3VkLXZlci1qcGMuaWstc2VydmVyLmNvbSIsCgkiZGVtby5qZWxhc3RpYy5jb20iLAoJImtpbGF0aXJvbi5jb20iLAoJInBhYXMubWFzc2l2ZWdyaWQuY29tIiwKCSJqZWQud2FmYWljbG91ZC5jb20iLAoJImxvbi53YWZhaWNsb3VkLmNvbSIsCgkicnlkLndhZmFpY2xvdWQuY29tIiwKCSJqLnNjYWxlZm9yY2UuY29tLmN5IiwKCSJqZWxhc3RpYy5kb2dhZG8uZXUiLAoJImZpLmNsb3VkcGxhdGZvcm0uZmkiLAoJImRlbW8uZGF0YWNlbnRlci5maSIsCgkicGFhcy5kYXRhY2VudGVyLmZpIiwKCSJqZWxlLmhvc3QiLAoJIm1pcmNsb3VkLmhvc3QiLAoJInBhYXMuYmVlYnl0ZS5pbyIsCgkic2VrZDEuYmVlYnl0ZWFwcC5pbyIsCgkiamVsZS5pbyIsCgkiY2xvdWQtZnIxLnVuaXNwYWNlLmlvIiwKCSJqYy5uZWVuLml0IiwKCSJjbG91ZC5qZWxhc3RpYy5vcGVuLnRpbS5pdCIsCgkiamNsb3VkLmt6IiwKCSJ1cGFhcy5rYXp0ZWxlcG9ydC5reiIsCgkiY2xvdWRqaWZmeS5uZXQiLAoJImZyYTEtZGUuY2xvdWRqaWZmeS5uZXQiLAoJIndlc3QxLXVzLmNsb3VkamlmZnkubmV0IiwKCSJqbHMtc3RvMS5lbGFzdHgubmV0IiwKCSJqbHMtc3RvMi5lbGFzdHgubmV0IiwKCSJqbHMtc3RvMy5lbGFzdHgubmV0IiwKCSJmYXN0c3RhY2tzLm5ldCIsCgkiZnItMS5wYWFzLm1hc3NpdmVncmlkLm5ldCIsCgkibG9uLTEucGFhcy5tYXNzaXZlZ3JpZC5uZXQiLAoJImxvbi0yLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJueS0xLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJueS0yLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJzZy0xLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJqZWxhc3RpYy5zYXZlaW5jbG91ZC5uZXQiLAoJIm5vcmRlc3RlLWlkYy5zYXZlaW5jbG91ZC5uZXQiLAoJImouc2NhbGVmb3JjZS5uZXQiLAoJImplbGFzdGljLnRzdWthZXJ1Lm5ldCIsCgkic2RzY2xvdWQucGwiLAoJInVuaWNsb3VkLnBsIiwKCSJtaXJjbG91ZC5ydSIsCgkiamVsYXN0aWMucmVncnVob3N0aW5nLnJ1IiwKCSJlbnNjYWxlZC5zZyIsCgkiamVsZS5zaXRlIiwKCSJqZWxhc3RpYy50ZWFtIiwKCSJvcmFuZ2VjbG91ZC50biIsCgkiai5sYXllcnNoaWZ0LmNvLnVrIiwKCSJwaHguZW5zY2FsZWQudXMiLAoJIm1pcmNsb3VkLnVzIiwKCSJteWppbm8ucnUiLAoJIiouaG9zdGluZy5teWppbm8ucnUiLAoJIioubGFuZGluZy5teWppbm8ucnUiLAoJIiouc3BlY3RydW0ubXlqaW5vLnJ1IiwKCSIqLnZwcy5teWppbm8ucnUiLAoJImpvdGVsdWx1LmNsb3VkIiwKCSIqLnRyaXRvbi56b25lIiwKCSIqLmNucy5qb3llbnQuY29tIiwKCSJqcy5vcmciLAoJImthYXMuZ2ciLAoJImtocGxheS5ubCIsCgkia3Rpc3RvcnkuY29tIiwKCSJrYXBzaS5maSIsCgkia2V5bWFjaGluZS5kZSIsCgkia2luZ2hvc3QubmV0IiwKCSJ1bmk1Lm5ldCIsCgkia25pZ2h0cG9pbnQuc3lzdGVtcyIsCgkia29vYmluLmV2ZW50cyIsCgkib3lhLnRvIiwKCSJrdWxldXZlbi5jbG91ZCIsCgkiZXpwcm94eS5rdWxldXZlbi5iZSIsCgkiY28ua3JkIiwKCSJlZHUua3JkIiwKCSJrcmVsbGlhbi5uZXQiLAoJIndlYnRoaW5ncy5pbyIsCgkiZ2l0LXJlcG9zLmRlIiwKCSJsY3ViZS1zZXJ2ZXIuZGUiLAoJInN2bi1yZXBvcy5kZSIsCgkibGVhZHBhZ2VzLmNvIiwKCSJscGFnZXMuY28iLAoJImxwdXNlcmNvbnRlbnQuY29tIiwKCSJsZWx1eC5zaXRlIiwKCSJjby5idXNpbmVzcyIsCgkiY28uZWR1Y2F0aW9uIiwKCSJjby5ldmVudHMiLAoJImNvLmZpbmFuY2lhbCIsCgkiY28ubmV0d29yayIsCgkiY28ucGxhY2UiLAoJImNvLnRlY2hub2xvZ3kiLAoJImFwcC5sbXBtLmNvbSIsCgkibGlua3lhcmQuY2xvdWQiLAoJImxpbmt5YXJkLWNsb3VkLmNoIiwKCSJtZW1iZXJzLmxpbm9kZS5jb20iLAoJIioubm9kZWJhbGFuY2VyLmxpbm9kZS5jb20iLAoJIioubGlub2Rlb2JqZWN0cy5jb20iLAoJImlwLmxpbm9kZXVzZXJjb250ZW50LmNvbSIsCgkid2UuYnMiLAoJIioudXNlci5sb2NhbGNlcnQuZGV2IiwKCSJsb2NhbHpvbmUueHl6IiwKCSJsb2dpbmxpbmUuYXBwIiwKCSJsb2dpbmxpbmUuZGV2IiwKCSJsb2dpbmxpbmUuaW8iLAoJImxvZ2lubGluZS5zZXJ2aWNlcyIsCgkibG9naW5saW5lLnNpdGUiLAoJInNlcnZlcnMucnVuIiwKCSJsb2htdXMubWUiLAoJImtyYXNuaWsucGwiLAoJImxlY3puYS5wbCIsCgkibHViYXJ0b3cucGwiLAoJImx1Ymxpbi5wbCIsCgkicG9uaWF0b3dhLnBsIiwKCSJzd2lkbmlrLnBsIiwKCSJnbHVnLm9yZy51ayIsCgkibHVnLm9yZy51ayIsCgkibHVncy5vcmcudWsiLAoJImJhcnN5LmJnIiwKCSJiYXJzeS5jby51ayIsCgkiYmFyc3lvbmxpbmUuY28udWsiLAoJImJhcnN5Y2VudGVyLmNvbSIsCgkiYmFyc3lvbmxpbmUuY29tIiwKCSJiYXJzeS5jbHViIiwKCSJiYXJzeS5kZSIsCgkiYmFyc3kuZXUiLAoJImJhcnN5LmluIiwKCSJiYXJzeS5pbmZvIiwKCSJiYXJzeS5pbyIsCgkiYmFyc3kubWUiLAoJImJhcnN5Lm1lbnUiLAoJImJhcnN5Lm1vYmkiLAoJImJhcnN5Lm5ldCIsCgkiYmFyc3kub25saW5lIiwKCSJiYXJzeS5vcmciLAoJImJhcnN5LnBybyIsCgkiYmFyc3kucHViIiwKCSJiYXJzeS5ybyIsCgkiYmFyc3kuc2hvcCIsCgkiYmFyc3kuc2l0ZSIsCgkiYmFyc3kuc3VwcG9ydCIsCgkiYmFyc3kudWsiLAoJIioubWFnZW50b3NpdGUuY2xvdWQiLAoJIm1heWZpcnN0LmluZm8iLAoJIm1heWZpcnN0Lm9yZyIsCgkiaGIuY2xkbWFpbC5ydSIsCgkiY24udnUiLAoJIm1hemVwbGF5LmNvbSIsCgkibWNwZS5tZSIsCgkibWNkaXIubWUiLAoJIm1jZGlyLnJ1IiwKCSJtY3ByZS5ydSIsCgkidnBzLm1jZGlyLnJ1IiwKCSJtZWRpYXRlY2guYnkiLAoJIm1lZGlhdGVjaC5kZXYiLAoJImhyYS5oZWFsdGgiLAoJIm1pbmlzZXJ2ZXIuY29tIiwKCSJtZW1zZXQubmV0IiwKCSJtZXNzZXJsaS5hcHAiLAoJIiouY2xvdWQubWV0YWNlbnRydW0uY3oiLAoJImN1c3RvbS5tZXRhY2VudHJ1bS5jeiIsCgkiZmx0LmNsb3VkLm11bmkuY3oiLAoJInVzci5jbG91ZC5tdW5pLmN6IiwKCSJtZXRlb3JhcHAuY29tIiwKCSJldS5tZXRlb3JhcHAuY29tIiwKCSJjby5wbCIsCgkiKi5henVyZWNvbnRhaW5lci5pbyIsCgkiYXp1cmV3ZWJzaXRlcy5uZXQiLAoJImF6dXJlLW1vYmlsZS5uZXQiLAoJImNsb3VkYXBwLm5ldCIsCgkiYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiMS5henVyZXN0YXRpY2FwcHMubmV0IiwKCSJjZW50cmFsdXMuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiZWFzdGFzaWEuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiZWFzdHVzMi5henVyZXN0YXRpY2FwcHMubmV0IiwKCSJ3ZXN0ZXVyb3BlLmF6dXJlc3RhdGljYXBwcy5uZXQiLAoJIndlc3R1czIuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiY3N4LmNjIiwKCSJtaW50ZXJlLnNpdGUiLAoJImZvcnRlLmlkIiwKCSJtb3ppbGxhLWlvdC5vcmciLAoJImJtb2F0dGFjaG1lbnRzLm9yZyIsCgkibmV0LnJ1IiwKCSJvcmcucnUiLAoJInBwLnJ1IiwKCSJob3N0ZWRwaS5jb20iLAoJImN1c3RvbWVyLm15dGhpYy1iZWFzdHMuY29tIiwKCSJjYXJhY2FsLm15dGhpYy1iZWFzdHMuY29tIiwKCSJmZW50aWdlci5teXRoaWMtYmVhc3RzLmNvbSIsCgkibHlueC5teXRoaWMtYmVhc3RzLmNvbSIsCgkib2NlbG90Lm15dGhpYy1iZWFzdHMuY29tIiwKCSJvbmNpbGxhLm15dGhpYy1iZWFzdHMuY29tIiwKCSJvbnphLm15dGhpYy1iZWFzdHMuY29tIiwKCSJzcGhpbngubXl0aGljLWJlYXN0cy5jb20iLAoJInZzLm15dGhpYy1iZWFzdHMuY29tIiwKCSJ4Lm15dGhpYy1iZWFzdHMuY29tIiwKCSJ5YWxpLm15dGhpYy1iZWFzdHMuY29tIiwKCSJjdXN0LnJldHJvc251Yi5jby51ayIsCgkidWkubmFidS5jYXNhIiwKCSJwb255LmNsdWIiLAoJIm9mLmZhc2hpb24iLAoJImluLmxvbmRvbiIsCgkib2YubG9uZG9uIiwKCSJmcm9tLm1hcmtldGluZyIsCgkid2l0aC5tYXJrZXRpbmciLAoJImZvci5tZW4iLAoJInJlcGFpci5tZW4iLAoJImFuZC5tb20iLAoJImZvci5tb20iLAoJImZvci5vbmUiLAoJInVuZGVyLm9uZSIsCgkiZm9yLnNhbGUiLAoJInRoYXQud2luIiwKCSJmcm9tLndvcmsiLAoJInRvLndvcmsiLAoJImNsb3VkLm5vc3BhbXByb3h5LmNvbSIsCgkibmV0bGlmeS5hcHAiLAoJIjR1LmNvbSIsCgkibmdyb2suaW8iLAoJIm5oLXNlcnYuY28udWsiLAoJIm5mc2hvc3QuY29tIiwKCSIqLmRldmVsb3Blci5hcHAiLAoJIm5vb3AuYXBwIiwKCSIqLm5vcnRoZmxhbmsuYXBwIiwKCSIqLmJ1aWxkLnJ1biIsCgkiKi5jb2RlLnJ1biIsCgkiKi5kYXRhYmFzZS5ydW4iLAoJIioubWlncmF0aW9uLnJ1biIsCgkibm90aWNlYWJsZS5uZXdzIiwKCSJkbnNraW5nLmNoIiwKCSJteXBpLmNvIiwKCSJuNHQuY28iLAoJIjAwMXd3dy5jb20iLAoJImRkbnNsaXZlLmNvbSIsCgkibXlpcGhvc3QuY29tIiwKCSJmb3J1bXouaW5mbyIsCgkiMTYtYi5pdCIsCgkiMzItYi5pdCIsCgkiNjQtYi5pdCIsCgkic291bmRjYXN0Lm1lIiwKCSJ0Y3A0Lm1lIiwKCSJkbnN1cC5uZXQiLAoJImhpY2FtLm5ldCIsCgkibm93LWRucy5uZXQiLAoJIm93bmlwLm5ldCIsCgkidnBuZG5zLm5ldCIsCgkiZHluc2Vydi5vcmciLAoJIm5vdy1kbnMub3JnIiwKCSJ4NDQzLnB3IiwKCSJub3ctZG5zLnRvcCIsCgkibnRkbGwudG9wIiwKCSJmcmVlZGRucy51cyIsCgkiY3JhZnRpbmcueHl6IiwKCSJ6YXB0by54eXoiLAoJIm5zdXBkYXRlLmluZm8iLAoJIm5lcmRwb2wub3ZoIiwKCSJibG9nc3l0ZS5jb20iLAoJImJyYXNpbGlhLm1lIiwKCSJjYWJsZS1tb2RlbS5vcmciLAoJImNpc2NvZnJlYWsuY29tIiwKCSJjb2xsZWdlZmFuLm9yZyIsCgkiY291Y2hwb3RhdG9mcmllcy5vcmciLAoJImRhbW5zZXJ2ZXIuY29tIiwKCSJkZG5zLm1lIiwKCSJkaXRjaHlvdXJpcC5jb20iLAoJImRuc2Zvci5tZSIsCgkiZG5zaXNraW5reS5jb20iLAoJImR2cmNhbS5pbmZvIiwKCSJkeW5ucy5jb20iLAoJImVhdGluZy1vcmdhbmljLm5ldCIsCgkiZmFudGFzeWxlYWd1ZS5jYyIsCgkiZ2Vla2dhbGF4eS5jb20iLAoJImdvbGZmYW4udXMiLAoJImhlYWx0aC1jYXJlcmVmb3JtLmNvbSIsCgkiaG9tZXNlY3VyaXR5bWFjLmNvbSIsCgkiaG9tZXNlY3VyaXR5cGMuY29tIiwKCSJob3B0by5tZSIsCgkiaWxvdmVjb2xsZWdlLmluZm8iLAoJImxvZ2ludG8ubWUiLAoJIm1sYmZhbi5vcmciLAoJIm1tYWZhbi5iaXoiLAoJIm15YWN0aXZlZGlyZWN0b3J5LmNvbSIsCgkibXlkaXNzZW50Lm5ldCIsCgkibXllZmZlY3QubmV0IiwKCSJteW1lZGlhcGMubmV0IiwKCSJteXBzeC5uZXQiLAoJIm15c2VjdXJpdHljYW1lcmEuY29tIiwKCSJteXNlY3VyaXR5Y2FtZXJhLm5ldCIsCgkibXlzZWN1cml0eWNhbWVyYS5vcmciLAoJIm5ldC1mcmVha3MuY29tIiwKCSJuZmxmYW4ub3JnIiwKCSJuaGxmYW4ubmV0IiwKCSJuby1pcC5jYSIsCgkibm8taXAuY28udWsiLAoJIm5vLWlwLm5ldCIsCgkibm9pcC51cyIsCgkib250aGV3aWZpLmNvbSIsCgkicGdhZmFuLm5ldCIsCgkicG9pbnQydGhpcy5jb20iLAoJInBvaW50dG8udXMiLAoJInByaXZhdGl6ZWhlYWx0aGluc3VyYW5jZS5uZXQiLAoJInF1aWNrc3l0ZXMuY29tIiwKCSJyZWFkLWJvb2tzLm9yZyIsCgkic2VjdXJpdHl0YWN0aWNzLmNvbSIsCgkic2VydmVleGNoYW5nZS5jb20iLAoJInNlcnZlaHVtb3VyLmNvbSIsCgkic2VydmVwMnAuY29tIiwKCSJzZXJ2ZXNhcmNhc20uY29tIiwKCSJzdHVmZnRvcmVhZC5jb20iLAoJInVmY2Zhbi5vcmciLAoJInVudXN1YWxwZXJzb24uY29tIiwKCSJ3b3JraXNib3JpbmcuY29tIiwKCSIzdXRpbGl0aWVzLmNvbSIsCgkiYm91bmNlbWUubmV0IiwKCSJkZG5zLm5ldCIsCgkiZGRuc2tpbmcuY29tIiwKCSJnb3RkbnMuY2giLAoJImhvcHRvLm9yZyIsCgkibXlmdHAuYml6IiwKCSJteWZ0cC5vcmciLAoJIm15dm5jLmNvbSIsCgkibm8taXAuYml6IiwKCSJuby1pcC5pbmZvIiwKCSJuby1pcC5vcmciLAoJIm5vaXAubWUiLAoJInJlZGlyZWN0bWUubmV0IiwKCSJzZXJ2ZWJlZXIuY29tIiwKCSJzZXJ2ZWJsb2cubmV0IiwKCSJzZXJ2ZWNvdW50ZXJzdHJpa2UuY29tIiwKCSJzZXJ2ZWZ0cC5jb20iLAoJInNlcnZlZ2FtZS5jb20iLAoJInNlcnZlaGFsZmxpZmUuY29tIiwKCSJzZXJ2ZWh0dHAuY29tIiwKCSJzZXJ2ZWlyYy5jb20iLAoJInNlcnZlbWluZWNyYWZ0Lm5ldCIsCgkic2VydmVtcDMuY29tIiwKCSJzZXJ2ZXBpY3MuY29tIiwKCSJzZXJ2ZXF1YWtlLmNvbSIsCgkic3l0ZXMubmV0IiwKCSJ3ZWJob3AubWUiLAoJInphcHRvLm9yZyIsCgkic3RhZ2Uubm9kZWFydC5pbyIsCgkicGNsb3VkLmhvc3QiLAoJIm55Yy5tbiIsCgkic3RhdGljLm9ic2VydmFibGV1c2VyY29udGVudC5jb20iLAoJImN5YS5nZyIsCgkib21nLmxvbCIsCgkiY2xvdWR5Y2x1c3Rlci5uZXQiLAoJIm9tbml3ZS5zaXRlIiwKCSJzZXJ2aWNlLm9uZSIsCgkibmlkLmlvIiwKCSJvcGVuc29jaWFsLnNpdGUiLAoJIm9wZW5jcmFmdC5ob3N0aW5nIiwKCSJvcnNpdGVzLmNvbSIsCgkib3BlcmF1bml0ZS5jb20iLAoJInRlY2gub3JhbmdlIiwKCSJhdXRoZ2Vhci1zdGFnaW5nLmNvbSIsCgkiYXV0aGdlYXJhcHBzLmNvbSIsCgkic2t5Z2VhcmFwcC5jb20iLAoJIm91dHN5c3RlbXNjbG91ZC5jb20iLAoJIioud2VicGFhcy5vdmgubmV0IiwKCSIqLmhvc3Rpbmcub3ZoLm5ldCIsCgkib3ducHJvdmlkZXIuY29tIiwKCSJvd24ucG0iLAoJIioub3dvLmNvZGVzIiwKCSJveC5ycyIsCgkib3kubGMiLAoJInBnZm9nLmNvbSIsCgkicGFnZWZyb250YXBwLmNvbSIsCgkicGFnZXhsLmNvbSIsCgkiKi5wYXl3aGlybC5jb20iLAoJImJhcjAubmV0IiwKCSJiYXIxLm5ldCIsCgkiYmFyMi5uZXQiLAoJInJkdi50byIsCgkiYXJ0LnBsIiwKCSJnbGl3aWNlLnBsIiwKCSJrcmFrb3cucGwiLAoJInBvem5hbi5wbCIsCgkid3JvYy5wbCIsCgkiemFrb3BhbmUucGwiLAoJInBhbnRoZW9uc2l0ZS5pbyIsCgkiZ290cGFudGhlb24uY29tIiwKCSJteXBlcC5saW5rIiwKCSJwZXJzcGVjdGEuY2xvdWQiLAoJImxrMy5ydSIsCgkib24td2ViLmZyIiwKCSJiYy5wbGF0Zm9ybS5zaCIsCgkiZW50LnBsYXRmb3JtLnNoIiwKCSJldS5wbGF0Zm9ybS5zaCIsCgkidXMucGxhdGZvcm0uc2giLAoJIioucGxhdGZvcm1zaC5zaXRlIiwKCSIqLnRzdC5zaXRlIiwKCSJwbGF0dGVyLWFwcC5jb20iLAoJInBsYXR0ZXItYXBwLmRldiIsCgkicGxhdHRlcnAudXMiLAoJInBkbnMucGFnZSIsCgkicGxlc2sucGFnZSIsCgkicGxlc2tucy5jb20iLAoJImR5bjUzLmlvIiwKCSJvbnBvcnRlci5ydW4iLAoJImNvLmJuIiwKCSJwb3N0bWFuLWVjaG8uY29tIiwKCSJwc3Rtbi5pbyIsCgkibW9jay5wc3Rtbi5pbyIsCgkiaHR0cGJpbi5vcmciLAoJInByZXF1YWxpZnltZS50b2RheSIsCgkieGVuLnByZ21yLmNvbSIsCgkicHJpdi5hdCIsCgkicHJ2Y3kucGFnZSIsCgkiKi5kd2ViLmxpbmsiLAoJInByb3RvbmV0LmlvIiwKCSJjaGlydXJnaWVucy1kZW50aXN0ZXMtZW4tZnJhbmNlLmZyIiwKCSJieWVuLnNpdGUiLAoJInB1YnRscy5vcmciLAoJInB5dGhvbmFueXdoZXJlLmNvbSIsCgkiZXUucHl0aG9uYW55d2hlcmUuY29tIiwKCSJxb3RvLmlvIiwKCSJxdWFsaWZpb2FwcC5jb20iLAoJInFidXNlci5jb20iLAoJImNsb3Vkc2l0ZS5idWlsZGVycyIsCgkiaW5zdGFuY2VzLnNwYXduLmNjIiwKCSJpbnN0YW50Y2xvdWQuY24iLAoJInJhcy5ydSIsCgkicWEyLmNvbSIsCgkicWN4LmlvIiwKCSIqLnN5cy5xY3guaW8iLAoJImRldi1teXFuYXBjbG91ZC5jb20iLAoJImFscGhhLW15cW5hcGNsb3VkLmNvbSIsCgkibXlxbmFwY2xvdWQuY29tIiwKCSIqLnF1aXBlbGVtZW50cy5jb20iLAoJInZhcG9yLmNsb3VkIiwKCSJ2YXBvcmNsb3VkLmlvIiwKCSJyYWNrbWF6ZS5jb20iLAoJInJhY2ttYXplLm5ldCIsCgkiZy52YnJwbHNieC5pbyIsCgkiKi5vbi1rM3MuaW8iLAoJIioub24tcmFuY2hlci5jbG91ZCIsCgkiKi5vbi1yaW8uaW8iLAoJInJlYWR0aGVkb2NzLmlvIiwKCSJyaGNsb3VkLmNvbSIsCgkiYXBwLnJlbmRlci5jb20iLAoJIm9ucmVuZGVyLmNvbSIsCgkicmVwbC5jbyIsCgkiaWQucmVwbC5jbyIsCgkicmVwbC5ydW4iLAoJInJlc2luZGV2aWNlLmlvIiwKCSJkZXZpY2VzLnJlc2luc3RhZ2luZy5pbyIsCgkiaHpjLmlvIiwKCSJ3ZWxsYmVpbmd6b25lLmV1IiwKCSJ3ZWxsYmVpbmd6b25lLmNvLnVrIiwKCSJhZGltby5jby51ayIsCgkiaXRjb3VsZGJld29yLnNlIiwKCSJnaXQtcGFnZXMucml0LmVkdSIsCgkicm9ja3kucGFnZSIsCgki0LHQuNC3LtGA0YPRgSIsCgki0LrQvtC8LtGA0YPRgSIsCgki0LrRgNGL0Lwu0YDRg9GBIiwKCSLQvNC40YAu0YDRg9GBIiwKCSLQvNGB0Lou0YDRg9GBIiwKCSLQvtGA0LMu0YDRg9GBIiwKCSLRgdCw0LzQsNGA0LAu0YDRg9GBIiwKCSLRgdC+0YfQuC7RgNGD0YEiLAoJItGB0L/QsS7RgNGD0YEiLAoJItGPLtGA0YPRgSIsCgkiKi5idWlsZGVyLmNvZGUuY29tIiwKCSIqLmRldi1idWlsZGVyLmNvZGUuY29tIiwKCSIqLnN0Zy1idWlsZGVyLmNvZGUuY29tIiwKCSJzYW5kY2F0cy5pbyIsCgkibG9nb2lwLmRlIiwKCSJsb2dvaXAuY29tIiwKCSJmci1wYXItMS5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJmci1wYXItMi5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJubC1hbXMtMS5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJmbmMuZnItcGFyLnNjdy5jbG91ZCIsCgkiZnVuY3Rpb25zLmZuYy5mci1wYXIuc2N3LmNsb3VkIiwKCSJrOHMuZnItcGFyLnNjdy5jbG91ZCIsCgkibm9kZXMuazhzLmZyLXBhci5zY3cuY2xvdWQiLAoJInMzLmZyLXBhci5zY3cuY2xvdWQiLAoJInMzLXdlYnNpdGUuZnItcGFyLnNjdy5jbG91ZCIsCgkid2htLmZyLXBhci5zY3cuY2xvdWQiLAoJInByaXYuaW5zdGFuY2VzLnNjdy5jbG91ZCIsCgkicHViLmluc3RhbmNlcy5zY3cuY2xvdWQiLAoJIms4cy5zY3cuY2xvdWQiLAoJIms4cy5ubC1hbXMuc2N3LmNsb3VkIiwKCSJub2Rlcy5rOHMubmwtYW1zLnNjdy5jbG91ZCIsCgkiczMubmwtYW1zLnNjdy5jbG91ZCIsCgkiczMtd2Vic2l0ZS5ubC1hbXMuc2N3LmNsb3VkIiwKCSJ3aG0ubmwtYW1zLnNjdy5jbG91ZCIsCgkiazhzLnBsLXdhdy5zY3cuY2xvdWQiLAoJIm5vZGVzLms4cy5wbC13YXcuc2N3LmNsb3VkIiwKCSJzMy5wbC13YXcuc2N3LmNsb3VkIiwKCSJzMy13ZWJzaXRlLnBsLXdhdy5zY3cuY2xvdWQiLAoJInNjYWxlYm9vay5zY3cuY2xvdWQiLAoJInNtYXJ0bGFiZWxpbmcuc2N3LmNsb3VkIiwKCSJkZWRpYm94LmZyIiwKCSJzY2hva29rZWtzLm5ldCIsCgkiZ292LnNjb3QiLAoJInNlcnZpY2UuZ292LnNjb3QiLAoJInNjcnlzZWMuY29tIiwKCSJmaXJld2FsbC1nYXRld2F5LmNvbSIsCgkiZmlyZXdhbGwtZ2F0ZXdheS5kZSIsCgkibXktZ2F0ZXdheS5kZSIsCgkibXktcm91dGVyLmRlIiwKCSJzcGRucy5kZSIsCgkic3BkbnMuZXUiLAoJImZpcmV3YWxsLWdhdGV3YXkubmV0IiwKCSJteS1maXJld2FsbC5vcmciLAoJIm15ZmlyZXdhbGwub3JnIiwKCSJzcGRucy5vcmciLAoJInNlaWRhdC5uZXQiLAoJInNlbGxmeS5zdG9yZSIsCgkic2Vuc2VlcmluZy5uZXQiLAoJIm1pbmlzaXRlLm1zIiwKCSJtYWduZXQucGFnZSIsCgkiYml6LnVhIiwKCSJjby51YSIsCgkicHAudWEiLAoJInNoaWZ0Y3J5cHRvLmRldiIsCgkic2hpZnRjcnlwdG8uaW8iLAoJInNoaWZ0ZWRpdC5pbyIsCgkibXlzaG9wYmxvY2tzLmNvbSIsCgkibXlzaG9waWZ5LmNvbSIsCgkic2hvcGl0c2l0ZS5jb20iLAoJInNob3B3YXJlLnN0b3JlIiwKCSJtby1zaWVtZW5zLmlvIiwKCSIxa2FwcC5jb20iLAoJImFwcGNoaXppLmNvbSIsCgkiYXBwbGluemkuY29tIiwKCSJzaW5hYXBwLmNvbSIsCgkidmlwc2luYWFwcC5jb20iLAoJInNpdGVsZWFmLm5ldCIsCgkiYm91bnR5LWZ1bGwuY29tIiwKCSJhbHBoYS5ib3VudHktZnVsbC5jb20iLAoJImJldGEuYm91bnR5LWZ1bGwuY29tIiwKCSJzbWFsbC13ZWIub3JnIiwKCSJ2cDQubWUiLAoJInRyeS1zbm93cGxvdy5jb20iLAoJInNyaHQuc2l0ZSIsCgkic3RhY2toZXJvLW5ldHdvcmsuY29tIiwKCSJtdXNpY2lhbi5pbyIsCgkibm92ZWNvcmUuc2l0ZSIsCgkic3RhdGljLmxhbmQiLAoJImRldi5zdGF0aWMubGFuZCIsCgkic2l0ZXMuc3RhdGljLmxhbmQiLAoJInN0b3JlYmFzZS5zdG9yZSIsCgkidnBzLWhvc3QubmV0IiwKCSJhdGwuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJuanMuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJyaWMuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJwbGF5c3RhdGlvbi1jbG91ZC5jb20iLAoJImFwcHMubGFpci5pbyIsCgkiKi5zdG9sb3MuaW8iLAoJInNwYWNla2l0LmlvIiwKCSJjdXN0b21lci5zcGVlZHBhcnRuZXIuZGUiLAoJIm15c3ByZWFkc2hvcC5hdCIsCgkibXlzcHJlYWRzaG9wLmNvbS5hdSIsCgkibXlzcHJlYWRzaG9wLmJlIiwKCSJteXNwcmVhZHNob3AuY2EiLAoJIm15c3ByZWFkc2hvcC5jaCIsCgkibXlzcHJlYWRzaG9wLmNvbSIsCgkibXlzcHJlYWRzaG9wLmRlIiwKCSJteXNwcmVhZHNob3AuZGsiLAoJIm15c3ByZWFkc2hvcC5lcyIsCgkibXlzcHJlYWRzaG9wLmZpIiwKCSJteXNwcmVhZHNob3AuZnIiLAoJIm15c3ByZWFkc2hvcC5pZSIsCgkibXlzcHJlYWRzaG9wLml0IiwKCSJteXNwcmVhZHNob3AubmV0IiwKCSJteXNwcmVhZHNob3AubmwiLAoJIm15c3ByZWFkc2hvcC5ubyIsCgkibXlzcHJlYWRzaG9wLnBsIiwKCSJteXNwcmVhZHNob3Auc2UiLAoJIm15c3ByZWFkc2hvcC5jby51ayIsCgkiYXBpLnN0ZGxpYi5jb20iLAoJInN0b3JqLmZhcm0iLAoJInV0d2VudGUuaW8iLAoJInNvYy5zcmNmLm5ldCIsCgkidXNlci5zcmNmLm5ldCIsCgkidGVtcC1kbnMuY29tIiwKCSJzdXBhYmFzZS5jbyIsCgkic3VwYWJhc2UuaW4iLAoJInN1cGFiYXNlLm5ldCIsCgkic3UucGFiYS5zZSIsCgkiKi5zNXkuaW8iLAoJIiouc2Vuc2lvc2l0ZS5jbG91ZCIsCgkic3luY2xvdWQuaXQiLAoJImRzY2xvdWQuYml6IiwKCSJkaXJlY3QucXVpY2tjb25uZWN0LmNuIiwKCSJkc215bmFzLmNvbSIsCgkiZmFtaWx5ZHMuY29tIiwKCSJkaXNrc3RhdGlvbi5tZSIsCgkiZHNjbG91ZC5tZSIsCgkiaTIzNC5tZSIsCgkibXlkcy5tZSIsCgkic3lub2xvZ3kubWUiLAoJImRzY2xvdWQubW9iaSIsCgkiZHNteW5hcy5uZXQiLAoJImZhbWlseWRzLm5ldCIsCgkiZHNteW5hcy5vcmciLAoJImZhbWlseWRzLm9yZyIsCgkidnBucGx1cy50byIsCgkiZGlyZWN0LnF1aWNrY29ubmVjdC50byIsCgkidGFiaXRvcmRlci5jby5pbCIsCgkidGFpZnVuLWRucy5kZSIsCgkiYmV0YS50YWlsc2NhbGUubmV0IiwKCSJ0cy5uZXQiLAoJImdkYS5wbCIsCgkiZ2RhbnNrLnBsIiwKCSJnZHluaWEucGwiLAoJIm1lZC5wbCIsCgkic29wb3QucGwiLAoJInNpdGUudGItaG9zdGluZy5jb20iLAoJImVkdWdpdC5pbyIsCgkiczMudGVja2lkcy5vcmciLAoJInRlbGViaXQuYXBwIiwKCSJ0ZWxlYml0LmlvIiwKCSIqLnRlbGViaXQueHl6IiwKCSJnd2lkZGxlLmNvLnVrIiwKCSIqLmZpcmVuZXQuY2giLAoJIiouc3ZjLmZpcmVuZXQuY2giLAoJInJlc2VydmQuY29tIiwKCSJ0aGluZ2R1c3RkYXRhLmNvbSIsCgkiY3VzdC5kZXYudGhpbmdkdXN0LmlvIiwKCSJjdXN0LmRpc3JlYy50aGluZ2R1c3QuaW8iLAoJImN1c3QucHJvZC50aGluZ2R1c3QuaW8iLAoJImN1c3QudGVzdGluZy50aGluZ2R1c3QuaW8iLAoJInJlc2VydmQuZGV2LnRoaW5nZHVzdC5pbyIsCgkicmVzZXJ2ZC5kaXNyZWMudGhpbmdkdXN0LmlvIiwKCSJyZXNlcnZkLnRlc3RpbmcudGhpbmdkdXN0LmlvIiwKCSJ0aWNrZXRzLmlvIiwKCSJhcnZvLm5ldHdvcmsiLAoJImF6aW11dGgubmV0d29yayIsCgkidGxvbi5uZXR3b3JrIiwKCSJ0b3Jwcm9qZWN0Lm5ldCIsCgkicGFnZXMudG9ycHJvamVjdC5uZXQiLAoJImJsb3hjbXMuY29tIiwKCSJ0b3dubmV3cy1zdGFnaW5nLmNvbSIsCgkidGJpdHMubWUiLAoJIjEyaHAuYXQiLAoJIjJpeC5hdCIsCgkiNGxpbWEuYXQiLAoJImxpbWEtY2l0eS5hdCIsCgkiMTJocC5jaCIsCgkiMml4LmNoIiwKCSI0bGltYS5jaCIsCgkibGltYS1jaXR5LmNoIiwKCSJ0cmFmZmljcGxleC5jbG91ZCIsCgkiZGUuY29vbCIsCgkiMTJocC5kZSIsCgkiMml4LmRlIiwKCSI0bGltYS5kZSIsCgkibGltYS1jaXR5LmRlIiwKCSIxMzM3LnBpY3R1cmVzIiwKCSJjbGFuLnJpcCIsCgkibGltYS1jaXR5LnJvY2tzIiwKCSJ3ZWJzcGFjZS5yb2NrcyIsCgkibGltYS56b25lIiwKCSIqLnRyYW5zdXJsLmJlIiwKCSIqLnRyYW5zdXJsLmV1IiwKCSIqLnRyYW5zdXJsLm5sIiwKCSJzaXRlLnRyYW5zaXAubWUiLAoJInR1eGZhbWlseS5vcmciLAoJImRkLWRucy5kZSIsCgkiZGlza3N0YXRpb24uZXUiLAoJImRpc2tzdGF0aW9uLm9yZyIsCgkiZHJheS1kbnMuZGUiLAoJImRyYXlkbnMuZGUiLAoJImR5bi12cG4uZGUiLAoJImR5bnZwbi5kZSIsCgkibWVpbi12aWdvci5kZSIsCgkibXktdmlnb3IuZGUiLAoJIm15LXdhbi5kZSIsCgkic3luby1kcy5kZSIsCgkic3lub2xvZ3ktZGlza3N0YXRpb24uZGUiLAoJInN5bm9sb2d5LWRzLmRlIiwKCSJ0eXBlZHJlYW0uYXBwIiwKCSJwcm8udHlwZWZvcm0uY29tIiwKCSJ1YmVyLnNwYWNlIiwKCSIqLnViZXJzcGFjZS5kZSIsCgkiaGsuY29tIiwKCSJoay5vcmciLAoJImx0ZC5oayIsCgkiaW5jLmhrIiwKCSJuYW1lLnBtIiwKCSJzY2gudGYiLAoJImJpei53ZiIsCgkic2NoLndmIiwKCSJvcmcueXQiLAoJInZpcnR1YWx1c2VyLmRlIiwKCSJ2aXJ0dWFsLXVzZXIuZGUiLAoJInVwbGkuaW8iLAoJInVyb3duLmNsb3VkIiwKCSJkbnN1cGRhdGUuaW5mbyIsCgkibGliLmRlLnVzIiwKCSIyMDM4LmlvIiwKCSJ2ZXJjZWwuYXBwIiwKCSJ2ZXJjZWwuZGV2IiwKCSJub3cuc2giLAoJInJvdXRlci5tYW5hZ2VtZW50IiwKCSJ2LWluZm8uaW5mbyIsCgkidm9vcmxvcGVyLmNsb3VkIiwKCSJuZWtvLmFtIiwKCSJueWFhLmFtIiwKCSJiZS5heCIsCgkiY2F0LmF4IiwKCSJlcy5heCIsCgkiZXUuYXgiLAoJImdnLmF4IiwKCSJtYy5heCIsCgkidXMuYXgiLAoJInh5LmF4IiwKCSJubC5jaSIsCgkieHguZ2wiLAoJImFwcC5ncCIsCgkiYmxvZy5ndCIsCgkiZGUuZ3QiLAoJInRvLmd0IiwKCSJiZS5neSIsCgkiY2MuaG4iLAoJImJsb2cua2ciLAoJImlvLmtnIiwKCSJqcC5rZyIsCgkidHYua2ciLAoJInVrLmtnIiwKCSJ1cy5rZyIsCgkiZGUubHMiLAoJImF0Lm1kIiwKCSJkZS5tZCIsCgkianAubWQiLAoJInRvLm1kIiwKCSJpbmRpZS5wb3JuIiwKCSJ2eGwuc2giLAoJImNoLnRjIiwKCSJtZS50YyIsCgkid2UudGMiLAoJIm55YW4udG8iLAoJImF0LnZnIiwKCSJibG9nLnZ1IiwKCSJkZXYudnUiLAoJIm1lLnZ1IiwKCSJ2LnVhIiwKCSIqLnZ1bHRyb2JqZWN0cy5jb20iLAoJIndhZmZsZWNlbGwuY29tIiwKCSIqLndlYmhhcmUuZGV2IiwKCSJyZXNlcnZlLW9ubGluZS5uZXQiLAoJInJlc2VydmUtb25saW5lLmNvbSIsCgkiYm9va29ubGluZS5hcHAiLAoJImhvdGVsd2l0aGZsaWdodC5jb20iLAoJIndlZGVwbG95LmlvIiwKCSJ3ZWRlcGxveS5tZSIsCgkid2VkZXBsb3kuc2giLAoJInJlbW90ZXdkLmNvbSIsCgkicGFnZXMud2lhcmR3ZWIuY29tIiwKCSJ3bWZsYWJzLm9yZyIsCgkidG9vbGZvcmdlLm9yZyIsCgkid21jbG91ZC5vcmciLAoJInBhbmVsLmdnIiwKCSJkYWVtb24ucGFuZWwuZ2ciLAoJIm1lc3N3aXRoZG5zLmNvbSIsCgkid29sdGxhYi1kZW1vLmNvbSIsCgkibXlmb3J1bS5jb21tdW5pdHkiLAoJImNvbW11bml0eS1wcm8uZGUiLAoJImRpc2t1c3Npb25zYmVyZWljaC5kZSIsCgkiY29tbXVuaXR5LXByby5uZXQiLAoJIm1laW5mb3J1bS5uZXQiLAoJImFmZmluaXR5bG90dGVyeS5vcmcudWsiLAoJInJhZmZsZWVudHJ5Lm9yZy51ayIsCgkid2Vla2x5bG90dGVyeS5vcmcudWsiLAoJIndwZW5naW5lcG93ZXJlZC5jb20iLAoJImpzLndwZW5naW5lcG93ZXJlZC5jb20iLAoJIndpeHNpdGUuY29tIiwKCSJlZGl0b3J4LmlvIiwKCSJoYWxmLmhvc3QiLAoJInhuYmF5LmNvbSIsCgkidTIueG5iYXkuY29tIiwKCSJ1Mi1sb2NhbC54bmJheS5jb20iLAoJImNpc3Ryb24ubmwiLAoJImRlbW9uLm5sIiwKCSJ4czRhbGwuc3BhY2UiLAoJInlhbmRleGNsb3VkLm5ldCIsCgkic3RvcmFnZS55YW5kZXhjbG91ZC5uZXQiLAoJIndlYnNpdGUueWFuZGV4Y2xvdWQubmV0IiwKCSJvZmZpY2lhbC5hY2FkZW15IiwKCSJ5b2xhc2l0ZS5jb20iLAoJInliby5mYWl0aCIsCgkieW9tYm8ubWUiLAoJImhvbWVsaW5rLm9uZSIsCgkieWJvLnBhcnR5IiwKCSJ5Ym8ucmV2aWV3IiwKCSJ5Ym8uc2NpZW5jZSIsCgkieWJvLnRyYWRlIiwKCSJ5bmguZnIiLAoJIm5vaG9zdC5tZSIsCgkibm9oby5zdCIsCgkiemEubmV0IiwKCSJ6YS5vcmciLAoJImJzcy5kZXNpZ24iLAoJImJhc2ljc2VydmVyLmlvIiwKCSJ2aXJ0dWFsc2VydmVyLmlvIiwKCSJlbnRlcnByaXNlY2xvdWQubnUiCl07CgovKmVzbGludCBuby12YXI6MCwgcHJlZmVyLWFycm93LWNhbGxiYWNrOiAwLCBvYmplY3Qtc2hvcnRoYW5kOiAwICovCgooZnVuY3Rpb24gKGV4cG9ydHMpIHsKCgoJdmFyIFB1bnljb2RlID0gcmVxdWlyZSQkMCQyOwoKCgl2YXIgaW50ZXJuYWxzID0ge307CgoKCS8vCgkvLyBSZWFkIHJ1bGVzIGZyb20gZmlsZS4KCS8vCglpbnRlcm5hbHMucnVsZXMgPSByZXF1aXJlJCQxLm1hcChmdW5jdGlvbiAocnVsZSkgewoKCSAgcmV0dXJuIHsKCSAgICBydWxlOiBydWxlLAoJICAgIHN1ZmZpeDogcnVsZS5yZXBsYWNlKC9eKFwqXC58XCEpLywgJycpLAoJICAgIHB1bnlTdWZmaXg6IC0xLAoJICAgIHdpbGRjYXJkOiBydWxlLmNoYXJBdCgwKSA9PT0gJyonLAoJICAgIGV4Y2VwdGlvbjogcnVsZS5jaGFyQXQoMCkgPT09ICchJwoJICB9OwoJfSk7CgoKCS8vCgkvLyBDaGVjayBpcyBnaXZlbiBzdHJpbmcgZW5kcyB3aXRoIGBzdWZmaXhgLgoJLy8KCWludGVybmFscy5lbmRzV2l0aCA9IGZ1bmN0aW9uIChzdHIsIHN1ZmZpeCkgewoKCSAgcmV0dXJuIHN0ci5pbmRleE9mKHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpICE9PSAtMTsKCX07CgoKCS8vCgkvLyBGaW5kIHJ1bGUgZm9yIGEgZ2l2ZW4gZG9tYWluLgoJLy8KCWludGVybmFscy5maW5kUnVsZSA9IGZ1bmN0aW9uIChkb21haW4pIHsKCgkgIHZhciBwdW55RG9tYWluID0gUHVueWNvZGUudG9BU0NJSShkb21haW4pOwoJICByZXR1cm4gaW50ZXJuYWxzLnJ1bGVzLnJlZHVjZShmdW5jdGlvbiAobWVtbywgcnVsZSkgewoKCSAgICBpZiAocnVsZS5wdW55U3VmZml4ID09PSAtMSl7CgkgICAgICBydWxlLnB1bnlTdWZmaXggPSBQdW55Y29kZS50b0FTQ0lJKHJ1bGUuc3VmZml4KTsKCSAgICB9CgkgICAgaWYgKCFpbnRlcm5hbHMuZW5kc1dpdGgocHVueURvbWFpbiwgJy4nICsgcnVsZS5wdW55U3VmZml4KSAmJiBwdW55RG9tYWluICE9PSBydWxlLnB1bnlTdWZmaXgpIHsKCSAgICAgIHJldHVybiBtZW1vOwoJICAgIH0KCSAgICAvLyBUaGlzIGhhcyBiZWVuIGNvbW1lbnRlZCBvdXQgYXMgaXQgbmV2ZXIgc2VlbXMgdG8gcnVuLiBUaGlzIGlzIGJlY2F1c2UKCSAgICAvLyBzdWIgdGxkcyBhbHdheXMgYXBwZWFyIGFmdGVyIHRoZWlyIHBhcmVudHMgYW5kIHdlIG5ldmVyIGZpbmQgYSBzaG9ydGVyCgkgICAgLy8gbWF0Y2guCgkgICAgLy9pZiAobWVtbykgewoJICAgIC8vICB2YXIgbWVtb1N1ZmZpeCA9IFB1bnljb2RlLnRvQVNDSUkobWVtby5zdWZmaXgpOwoJICAgIC8vICBpZiAobWVtb1N1ZmZpeC5sZW5ndGggPj0gcHVueVN1ZmZpeC5sZW5ndGgpIHsKCSAgICAvLyAgICByZXR1cm4gbWVtbzsKCSAgICAvLyAgfQoJICAgIC8vfQoJICAgIHJldHVybiBydWxlOwoJICB9LCBudWxsKTsKCX07CgoKCS8vCgkvLyBFcnJvciBjb2RlcyBhbmQgbWVzc2FnZXMuCgkvLwoJZXhwb3J0cy5lcnJvckNvZGVzID0gewoJICBET01BSU5fVE9PX1NIT1JUOiAnRG9tYWluIG5hbWUgdG9vIHNob3J0LicsCgkgIERPTUFJTl9UT09fTE9ORzogJ0RvbWFpbiBuYW1lIHRvbyBsb25nLiBJdCBzaG91bGQgYmUgbm8gbW9yZSB0aGFuIDI1NSBjaGFycy4nLAoJICBMQUJFTF9TVEFSVFNfV0lUSF9EQVNIOiAnRG9tYWluIG5hbWUgbGFiZWwgY2FuIG5vdCBzdGFydCB3aXRoIGEgZGFzaC4nLAoJICBMQUJFTF9FTkRTX1dJVEhfREFTSDogJ0RvbWFpbiBuYW1lIGxhYmVsIGNhbiBub3QgZW5kIHdpdGggYSBkYXNoLicsCgkgIExBQkVMX1RPT19MT05HOiAnRG9tYWluIG5hbWUgbGFiZWwgc2hvdWxkIGJlIGF0IG1vc3QgNjMgY2hhcnMgbG9uZy4nLAoJICBMQUJFTF9UT09fU0hPUlQ6ICdEb21haW4gbmFtZSBsYWJlbCBzaG91bGQgYmUgYXQgbGVhc3QgMSBjaGFyYWN0ZXIgbG9uZy4nLAoJICBMQUJFTF9JTlZBTElEX0NIQVJTOiAnRG9tYWluIG5hbWUgbGFiZWwgY2FuIG9ubHkgY29udGFpbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVycyBvciBkYXNoZXMuJwoJfTsKCgoJLy8KCS8vIFZhbGlkYXRlIGRvbWFpbiBuYW1lIGFuZCB0aHJvdyBpZiBub3QgdmFsaWQuCgkvLwoJLy8gRnJvbSB3aWtpcGVkaWE6CgkvLwoJLy8gSG9zdG5hbWVzIGFyZSBjb21wb3NlZCBvZiBzZXJpZXMgb2YgbGFiZWxzIGNvbmNhdGVuYXRlZCB3aXRoIGRvdHMsIGFzIGFyZSBhbGwKCS8vIGRvbWFpbiBuYW1lcy4gRWFjaCBsYWJlbCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNjMgY2hhcmFjdGVycyBsb25nLCBhbmQgdGhlCgkvLyBlbnRpcmUgaG9zdG5hbWUgKGluY2x1ZGluZyB0aGUgZGVsaW1pdGluZyBkb3RzKSBoYXMgYSBtYXhpbXVtIG9mIDI1NSBjaGFycy4KCS8vCgkvLyBBbGxvd2VkIGNoYXJzOgoJLy8KCS8vICogYGEtemAKCS8vICogYDAtOWAKCS8vICogYC1gIGJ1dCBub3QgYXMgYSBzdGFydGluZyBvciBlbmRpbmcgY2hhcmFjdGVyCgkvLyAqIGAuYCBhcyBhIHNlcGFyYXRvciBmb3IgdGhlIHRleHR1YWwgcG9ydGlvbnMgb2YgYSBkb21haW4gbmFtZQoJLy8KCS8vICogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb21haW5fbmFtZQoJLy8gKiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hvc3RuYW1lCgkvLwoJaW50ZXJuYWxzLnZhbGlkYXRlID0gZnVuY3Rpb24gKGlucHV0KSB7CgoJICAvLyBCZWZvcmUgd2UgY2FuIHZhbGlkYXRlIHdlIG5lZWQgdG8gdGFrZSBjYXJlIG9mIElETnMgd2l0aCB1bmljb2RlIGNoYXJzLgoJICB2YXIgYXNjaWkgPSBQdW55Y29kZS50b0FTQ0lJKGlucHV0KTsKCgkgIGlmIChhc2NpaS5sZW5ndGggPCAxKSB7CgkgICAgcmV0dXJuICdET01BSU5fVE9PX1NIT1JUJzsKCSAgfQoJICBpZiAoYXNjaWkubGVuZ3RoID4gMjU1KSB7CgkgICAgcmV0dXJuICdET01BSU5fVE9PX0xPTkcnOwoJICB9CgoJICAvLyBDaGVjayBlYWNoIHBhcnQncyBsZW5ndGggYW5kIGFsbG93ZWQgY2hhcnMuCgkgIHZhciBsYWJlbHMgPSBhc2NpaS5zcGxpdCgnLicpOwoJICB2YXIgbGFiZWw7CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IGxhYmVscy5sZW5ndGg7ICsraSkgewoJICAgIGxhYmVsID0gbGFiZWxzW2ldOwoJICAgIGlmICghbGFiZWwubGVuZ3RoKSB7CgkgICAgICByZXR1cm4gJ0xBQkVMX1RPT19TSE9SVCc7CgkgICAgfQoJICAgIGlmIChsYWJlbC5sZW5ndGggPiA2MykgewoJICAgICAgcmV0dXJuICdMQUJFTF9UT09fTE9ORyc7CgkgICAgfQoJICAgIGlmIChsYWJlbC5jaGFyQXQoMCkgPT09ICctJykgewoJICAgICAgcmV0dXJuICdMQUJFTF9TVEFSVFNfV0lUSF9EQVNIJzsKCSAgICB9CgkgICAgaWYgKGxhYmVsLmNoYXJBdChsYWJlbC5sZW5ndGggLSAxKSA9PT0gJy0nKSB7CgkgICAgICByZXR1cm4gJ0xBQkVMX0VORFNfV0lUSF9EQVNIJzsKCSAgICB9CgkgICAgaWYgKCEvXlthLXowLTlcLV0rJC8udGVzdChsYWJlbCkpIHsKCSAgICAgIHJldHVybiAnTEFCRUxfSU5WQUxJRF9DSEFSUyc7CgkgICAgfQoJICB9Cgl9OwoKCgkvLwoJLy8gUHVibGljIEFQSQoJLy8KCgoJLy8KCS8vIFBhcnNlIGRvbWFpbi4KCS8vCglleHBvcnRzLnBhcnNlID0gZnVuY3Rpb24gKGlucHV0KSB7CgoJICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykgewoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0RvbWFpbiBuYW1lIG11c3QgYmUgYSBzdHJpbmcuJyk7CgkgIH0KCgkgIC8vIEZvcmNlIGRvbWFpbiB0byBsb3dlcmNhc2UuCgkgIHZhciBkb21haW4gPSBpbnB1dC5zbGljZSgwKS50b0xvd2VyQ2FzZSgpOwoKCSAgLy8gSGFuZGxlIEZRRE4uCgkgIC8vIFRPRE86IFNpbXBseSByZW1vdmUgdHJhaWxpbmcgZG90PwoJICBpZiAoZG9tYWluLmNoYXJBdChkb21haW4ubGVuZ3RoIC0gMSkgPT09ICcuJykgewoJICAgIGRvbWFpbiA9IGRvbWFpbi5zbGljZSgwLCBkb21haW4ubGVuZ3RoIC0gMSk7CgkgIH0KCgkgIC8vIFZhbGlkYXRlIGFuZCBzYW5pdGlzZSBpbnB1dC4KCSAgdmFyIGVycm9yID0gaW50ZXJuYWxzLnZhbGlkYXRlKGRvbWFpbik7CgkgIGlmIChlcnJvcikgewoJICAgIHJldHVybiB7CgkgICAgICBpbnB1dDogaW5wdXQsCgkgICAgICBlcnJvcjogewoJICAgICAgICBtZXNzYWdlOiBleHBvcnRzLmVycm9yQ29kZXNbZXJyb3JdLAoJICAgICAgICBjb2RlOiBlcnJvcgoJICAgICAgfQoJICAgIH07CgkgIH0KCgkgIHZhciBwYXJzZWQgPSB7CgkgICAgaW5wdXQ6IGlucHV0LAoJICAgIHRsZDogbnVsbCwKCSAgICBzbGQ6IG51bGwsCgkgICAgZG9tYWluOiBudWxsLAoJICAgIHN1YmRvbWFpbjogbnVsbCwKCSAgICBsaXN0ZWQ6IGZhbHNlCgkgIH07CgoJICB2YXIgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoJy4nKTsKCgkgIC8vIE5vbi1JbnRlcm5ldCBUTEQKCSAgaWYgKGRvbWFpblBhcnRzW2RvbWFpblBhcnRzLmxlbmd0aCAtIDFdID09PSAnbG9jYWwnKSB7CgkgICAgcmV0dXJuIHBhcnNlZDsKCSAgfQoKCSAgdmFyIGhhbmRsZVB1bnljb2RlID0gZnVuY3Rpb24gKCkgewoKCSAgICBpZiAoIS94bi0tLy50ZXN0KGRvbWFpbikpIHsKCSAgICAgIHJldHVybiBwYXJzZWQ7CgkgICAgfQoJICAgIGlmIChwYXJzZWQuZG9tYWluKSB7CgkgICAgICBwYXJzZWQuZG9tYWluID0gUHVueWNvZGUudG9BU0NJSShwYXJzZWQuZG9tYWluKTsKCSAgICB9CgkgICAgaWYgKHBhcnNlZC5zdWJkb21haW4pIHsKCSAgICAgIHBhcnNlZC5zdWJkb21haW4gPSBQdW55Y29kZS50b0FTQ0lJKHBhcnNlZC5zdWJkb21haW4pOwoJICAgIH0KCSAgICByZXR1cm4gcGFyc2VkOwoJICB9OwoKCSAgdmFyIHJ1bGUgPSBpbnRlcm5hbHMuZmluZFJ1bGUoZG9tYWluKTsKCgkgIC8vIFVubGlzdGVkIHRsZC4KCSAgaWYgKCFydWxlKSB7CgkgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA8IDIpIHsKCSAgICAgIHJldHVybiBwYXJzZWQ7CgkgICAgfQoJICAgIHBhcnNlZC50bGQgPSBkb21haW5QYXJ0cy5wb3AoKTsKCSAgICBwYXJzZWQuc2xkID0gZG9tYWluUGFydHMucG9wKCk7CgkgICAgcGFyc2VkLmRvbWFpbiA9IFtwYXJzZWQuc2xkLCBwYXJzZWQudGxkXS5qb2luKCcuJyk7CgkgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCkgewoJICAgICAgcGFyc2VkLnN1YmRvbWFpbiA9IGRvbWFpblBhcnRzLnBvcCgpOwoJICAgIH0KCSAgICByZXR1cm4gaGFuZGxlUHVueWNvZGUoKTsKCSAgfQoKCSAgLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IHRoZSBwdWJsaWMgc3VmZml4IGlzIGxpc3RlZC4KCSAgcGFyc2VkLmxpc3RlZCA9IHRydWU7CgoJICB2YXIgdGxkUGFydHMgPSBydWxlLnN1ZmZpeC5zcGxpdCgnLicpOwoJICB2YXIgcHJpdmF0ZVBhcnRzID0gZG9tYWluUGFydHMuc2xpY2UoMCwgZG9tYWluUGFydHMubGVuZ3RoIC0gdGxkUGFydHMubGVuZ3RoKTsKCgkgIGlmIChydWxlLmV4Y2VwdGlvbikgewoJICAgIHByaXZhdGVQYXJ0cy5wdXNoKHRsZFBhcnRzLnNoaWZ0KCkpOwoJICB9CgoJICBwYXJzZWQudGxkID0gdGxkUGFydHMuam9pbignLicpOwoKCSAgaWYgKCFwcml2YXRlUGFydHMubGVuZ3RoKSB7CgkgICAgcmV0dXJuIGhhbmRsZVB1bnljb2RlKCk7CgkgIH0KCgkgIGlmIChydWxlLndpbGRjYXJkKSB7CgkgICAgdGxkUGFydHMudW5zaGlmdChwcml2YXRlUGFydHMucG9wKCkpOwoJICAgIHBhcnNlZC50bGQgPSB0bGRQYXJ0cy5qb2luKCcuJyk7CgkgIH0KCgkgIGlmICghcHJpdmF0ZVBhcnRzLmxlbmd0aCkgewoJICAgIHJldHVybiBoYW5kbGVQdW55Y29kZSgpOwoJICB9CgoJICBwYXJzZWQuc2xkID0gcHJpdmF0ZVBhcnRzLnBvcCgpOwoJICBwYXJzZWQuZG9tYWluID0gW3BhcnNlZC5zbGQsICBwYXJzZWQudGxkXS5qb2luKCcuJyk7CgoJICBpZiAocHJpdmF0ZVBhcnRzLmxlbmd0aCkgewoJICAgIHBhcnNlZC5zdWJkb21haW4gPSBwcml2YXRlUGFydHMuam9pbignLicpOwoJICB9CgoJICByZXR1cm4gaGFuZGxlUHVueWNvZGUoKTsKCX07CgoKCS8vCgkvLyBHZXQgZG9tYWluLgoJLy8KCWV4cG9ydHMuZ2V0ID0gZnVuY3Rpb24gKGRvbWFpbikgewoKCSAgaWYgKCFkb21haW4pIHsKCSAgICByZXR1cm4gbnVsbDsKCSAgfQoJICByZXR1cm4gZXhwb3J0cy5wYXJzZShkb21haW4pLmRvbWFpbiB8fCBudWxsOwoJfTsKCgoJLy8KCS8vIENoZWNrIHdoZXRoZXIgZG9tYWluIGJlbG9uZ3MgdG8gYSBrbm93biBwdWJsaWMgc3VmZml4LgoJLy8KCWV4cG9ydHMuaXNWYWxpZCA9IGZ1bmN0aW9uIChkb21haW4pIHsKCgkgIHZhciBwYXJzZWQgPSBleHBvcnRzLnBhcnNlKGRvbWFpbik7CgkgIHJldHVybiBCb29sZWFuKHBhcnNlZC5kb21haW4gJiYgcGFyc2VkLmxpc3RlZCk7Cgl9OyAKfSAocHNsJDEpKTsKCi8qIQogKiBDb3B5cmlnaHQgKGMpIDIwMTgsIFNhbGVzZm9yY2UuY29tLCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKICoKICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKgogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICogYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAqCiAqIDMuIE5laXRoZXIgdGhlIG5hbWUgb2YgU2FsZXNmb3JjZS5jb20gbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heQogKiBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0CiAqIHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICoKICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAqIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICogSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICogQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRQogKiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SCiAqIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GCiAqIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUwogKiBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTgogKiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKQogKiBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRQogKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCmNvbnN0IHBzbCA9IHBzbCQxOwoKLy8gUkZDIDY3NjEKY29uc3QgU1BFQ0lBTF9VU0VfRE9NQUlOUyA9IFsKICAibG9jYWwiLAogICJleGFtcGxlIiwKICAiaW52YWxpZCIsCiAgImxvY2FsaG9zdCIsCiAgInRlc3QiCl07Cgpjb25zdCBTUEVDSUFMX1RSRUFUTUVOVF9ET01BSU5TID0gWyJsb2NhbGhvc3QiLCAiaW52YWxpZCJdOwoKZnVuY3Rpb24gZ2V0UHVibGljU3VmZml4KGRvbWFpbiwgb3B0aW9ucyA9IHt9KSB7CiAgY29uc3QgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoIi4iKTsKICBjb25zdCB0b3BMZXZlbERvbWFpbiA9IGRvbWFpblBhcnRzW2RvbWFpblBhcnRzLmxlbmd0aCAtIDFdOwogIGNvbnN0IGFsbG93U3BlY2lhbFVzZURvbWFpbiA9ICEhb3B0aW9ucy5hbGxvd1NwZWNpYWxVc2VEb21haW47CiAgY29uc3QgaWdub3JlRXJyb3IgPSAhIW9wdGlvbnMuaWdub3JlRXJyb3I7CgogIGlmIChhbGxvd1NwZWNpYWxVc2VEb21haW4gJiYgU1BFQ0lBTF9VU0VfRE9NQUlOUy5pbmNsdWRlcyh0b3BMZXZlbERvbWFpbikpIHsKICAgIGlmIChkb21haW5QYXJ0cy5sZW5ndGggPiAxKSB7CiAgICAgIGNvbnN0IHNlY29uZExldmVsRG9tYWluID0gZG9tYWluUGFydHNbZG9tYWluUGFydHMubGVuZ3RoIC0gMl07CiAgICAgIC8vIEluIGFmb3JlbWVudGlvbmVkIGV4YW1wbGUsIHRoZSBlVExEL3B1YlN1ZiB3aWxsIGJlIGFwcGxlLmxvY2FsaG9zdAogICAgICByZXR1cm4gYCR7c2Vjb25kTGV2ZWxEb21haW59LiR7dG9wTGV2ZWxEb21haW59YDsKICAgIH0gZWxzZSBpZiAoU1BFQ0lBTF9UUkVBVE1FTlRfRE9NQUlOUy5pbmNsdWRlcyh0b3BMZXZlbERvbWFpbikpIHsKICAgICAgLy8gRm9yIGEgc2luZ2xlIHdvcmQgc3BlY2lhbCB1c2UgZG9tYWluLCBlLmcuICdsb2NhbGhvc3QnIG9yICdpbnZhbGlkJywgcGVyIFJGQyA2NzYxLAogICAgICAvLyAiQXBwbGljYXRpb24gc29mdHdhcmUgTUFZIHJlY29nbml6ZSB7bG9jYWxob3N0L2ludmFsaWR9IG5hbWVzIGFzIHNwZWNpYWwsIG9yCiAgICAgIC8vIE1BWSBwYXNzIHRoZW0gdG8gbmFtZSByZXNvbHV0aW9uIEFQSXMgYXMgdGhleSB3b3VsZCBmb3Igb3RoZXIgZG9tYWluIG5hbWVzLiIKICAgICAgcmV0dXJuIGAke3RvcExldmVsRG9tYWlufWA7CiAgICB9CiAgfQoKICBpZiAoIWlnbm9yZUVycm9yICYmIFNQRUNJQUxfVVNFX0RPTUFJTlMuaW5jbHVkZXModG9wTGV2ZWxEb21haW4pKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgIGBDb29raWUgaGFzIGRvbWFpbiBzZXQgdG8gdGhlIHB1YmxpYyBzdWZmaXggIiR7dG9wTGV2ZWxEb21haW59IiB3aGljaCBpcyBhIHNwZWNpYWwgdXNlIGRvbWFpbi4gVG8gYWxsb3cgdGhpcywgY29uZmlndXJlIHlvdXIgQ29va2llSmFyIHdpdGgge2FsbG93U3BlY2lhbFVzZURvbWFpbjp0cnVlLCByZWplY3RQdWJsaWNTdWZmaXhlczogZmFsc2V9LmAKICAgICk7CiAgfQoKICByZXR1cm4gcHNsLmdldChkb21haW4pOwp9CgpwdWJzdWZmaXhQc2wuZ2V0UHVibGljU3VmZml4ID0gZ2V0UHVibGljU3VmZml4OwoKdmFyIHN0b3JlID0ge307CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwovKmpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KCmxldCBTdG9yZSQyID0gY2xhc3MgU3RvcmUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5zeW5jaHJvbm91cyA9IGZhbHNlOwogIH0KCiAgZmluZENvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIHRocm93IG5ldyBFcnJvcigiZmluZENvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIGZpbmRDb29raWVzKGRvbWFpbiwgcGF0aCwgYWxsb3dTcGVjaWFsVXNlRG9tYWluLCBjYikgewogICAgdGhyb3cgbmV3IEVycm9yKCJmaW5kQ29va2llcyBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHB1dENvb2tpZShjb29raWUsIGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInB1dENvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHVwZGF0ZUNvb2tpZShvbGRDb29raWUsIG5ld0Nvb2tpZSwgY2IpIHsKICAgIC8vIHJlY29tbWVuZGVkIGRlZmF1bHQgaW1wbGVtZW50YXRpb246CiAgICAvLyByZXR1cm4gdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgICB0aHJvdyBuZXcgRXJyb3IoInVwZGF0ZUNvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHJlbW92ZUNvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIHRocm93IG5ldyBFcnJvcigicmVtb3ZlQ29va2llIGlzIG5vdCBpbXBsZW1lbnRlZCIpOwogIH0KCiAgcmVtb3ZlQ29va2llcyhkb21haW4sIHBhdGgsIGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInJlbW92ZUNvb2tpZXMgaXMgbm90IGltcGxlbWVudGVkIik7CiAgfQoKICByZW1vdmVBbGxDb29raWVzKGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInJlbW92ZUFsbENvb2tpZXMgaXMgbm90IGltcGxlbWVudGVkIik7CiAgfQoKICBnZXRBbGxDb29raWVzKGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICJnZXRBbGxDb29raWVzIGlzIG5vdCBpbXBsZW1lbnRlZCAodGhlcmVmb3JlIGphciBjYW5ub3QgYmUgc2VyaWFsaXplZCkiCiAgICApOwogIH0KfTsKCnN0b3JlLlN0b3JlID0gU3RvcmUkMjsKCnZhciBtZW1zdG9yZSA9IHt9OwoKdmFyIHVuaXZlcnNhbGlmeSA9IHt9OwoKdW5pdmVyc2FsaWZ5LmZyb21DYWxsYmFjayA9IGZ1bmN0aW9uIChmbikgewogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZnVuY3Rpb24gKCkgewogICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdID09PSAnZnVuY3Rpb24nKSBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgZWxzZSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGhdID0gKGVyciwgcmVzKSA9PiB7CiAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVqZWN0KGVycikKICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICB9OwogICAgICAgIGFyZ3VtZW50cy5sZW5ndGgrKzsKICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9KQogICAgfQogIH0sICduYW1lJywgeyB2YWx1ZTogZm4ubmFtZSB9KQp9OwoKdW5pdmVyc2FsaWZ5LmZyb21Qcm9taXNlID0gZnVuY3Rpb24gKGZuKSB7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBjYiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07CiAgICBpZiAodHlwZW9mIGNiICE9PSAnZnVuY3Rpb24nKSByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgZWxzZSB7CiAgICAgIGRlbGV0ZSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOwogICAgICBhcmd1bWVudHMubGVuZ3RoLS07CiAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykudGhlbihyID0+IGNiKG51bGwsIHIpLCBjYik7CiAgICB9CiAgfSwgJ25hbWUnLCB7IHZhbHVlOiBmbi5uYW1lIH0pCn07Cgp2YXIgcGVybXV0ZURvbWFpbiQyID0ge307CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwoKdmFyIGhhc1JlcXVpcmVkUGVybXV0ZURvbWFpbjsKCmZ1bmN0aW9uIHJlcXVpcmVQZXJtdXRlRG9tYWluICgpIHsKCWlmIChoYXNSZXF1aXJlZFBlcm11dGVEb21haW4pIHJldHVybiBwZXJtdXRlRG9tYWluJDI7CgloYXNSZXF1aXJlZFBlcm11dGVEb21haW4gPSAxOwoJY29uc3QgcHVic3VmZml4ID0gcHVic3VmZml4UHNsOwoKCS8vIEdpdmVzIHRoZSBwZXJtdXRhdGlvbiBvZiBhbGwgcG9zc2libGUgZG9tYWluTWF0Y2goKWVzIG9mIGEgZ2l2ZW4gZG9tYWluLiBUaGUKCS8vIGFycmF5IGlzIGluIHNob3J0ZXN0LXRvLWxvbmdlc3Qgb3JkZXIuICBIYW5keSBmb3IgaW5kZXhpbmcuCgoJZnVuY3Rpb24gcGVybXV0ZURvbWFpbihkb21haW4sIGFsbG93U3BlY2lhbFVzZURvbWFpbikgewoJICBjb25zdCBwdWJTdWYgPSBwdWJzdWZmaXguZ2V0UHVibGljU3VmZml4KGRvbWFpbiwgewoJICAgIGFsbG93U3BlY2lhbFVzZURvbWFpbjogYWxsb3dTcGVjaWFsVXNlRG9tYWluCgkgIH0pOwoKCSAgaWYgKCFwdWJTdWYpIHsKCSAgICByZXR1cm4gbnVsbDsKCSAgfQoJICBpZiAocHViU3VmID09IGRvbWFpbikgewoJICAgIHJldHVybiBbZG9tYWluXTsKCSAgfQoKCSAgLy8gTnVrZSB0cmFpbGluZyBkb3QKCSAgaWYgKGRvbWFpbi5zbGljZSgtMSkgPT0gIi4iKSB7CgkgICAgZG9tYWluID0gZG9tYWluLnNsaWNlKDAsIC0xKTsKCSAgfQoKCSAgY29uc3QgcHJlZml4ID0gZG9tYWluLnNsaWNlKDAsIC0ocHViU3VmLmxlbmd0aCArIDEpKTsgLy8gIi5leGFtcGxlLmNvbSIKCSAgY29uc3QgcGFydHMgPSBwcmVmaXguc3BsaXQoIi4iKS5yZXZlcnNlKCk7CgkgIGxldCBjdXIgPSBwdWJTdWY7CgkgIGNvbnN0IHBlcm11dGF0aW9ucyA9IFtjdXJdOwoJICB3aGlsZSAocGFydHMubGVuZ3RoKSB7CgkgICAgY3VyID0gYCR7cGFydHMuc2hpZnQoKX0uJHtjdXJ9YDsKCSAgICBwZXJtdXRhdGlvbnMucHVzaChjdXIpOwoJICB9CgkgIHJldHVybiBwZXJtdXRhdGlvbnM7Cgl9CgoJcGVybXV0ZURvbWFpbiQyLnBlcm11dGVEb21haW4gPSBwZXJtdXRlRG9tYWluOwoJcmV0dXJuIHBlcm11dGVEb21haW4kMjsKfQoKdmFyIHBhdGhNYXRjaCQzID0ge307CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwovKgogKiAiQSByZXF1ZXN0LXBhdGggcGF0aC1tYXRjaGVzIGEgZ2l2ZW4gY29va2llLXBhdGggaWYgYXQgbGVhc3Qgb25lIG9mIHRoZQogKiBmb2xsb3dpbmcgY29uZGl0aW9ucyBob2xkczoiCiAqLwpmdW5jdGlvbiBwYXRoTWF0Y2gkMihyZXFQYXRoLCBjb29raWVQYXRoKSB7CiAgLy8gIm8gIFRoZSBjb29raWUtcGF0aCBhbmQgdGhlIHJlcXVlc3QtcGF0aCBhcmUgaWRlbnRpY2FsLiIKICBpZiAoY29va2llUGF0aCA9PT0gcmVxUGF0aCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBjb25zdCBpZHggPSByZXFQYXRoLmluZGV4T2YoY29va2llUGF0aCk7CiAgaWYgKGlkeCA9PT0gMCkgewogICAgLy8gIm8gIFRoZSBjb29raWUtcGF0aCBpcyBhIHByZWZpeCBvZiB0aGUgcmVxdWVzdC1wYXRoLCBhbmQgdGhlIGxhc3QKICAgIC8vIGNoYXJhY3RlciBvZiB0aGUgY29va2llLXBhdGggaXMgJXgyRiAoIi8iKS4iCiAgICBpZiAoY29va2llUGF0aC5zdWJzdHIoLTEpID09PSAiLyIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gIiBvICBUaGUgY29va2llLXBhdGggaXMgYSBwcmVmaXggb2YgdGhlIHJlcXVlc3QtcGF0aCwgYW5kIHRoZSBmaXJzdAogICAgLy8gY2hhcmFjdGVyIG9mIHRoZSByZXF1ZXN0LXBhdGggdGhhdCBpcyBub3QgaW5jbHVkZWQgaW4gdGhlIGNvb2tpZS0gcGF0aAogICAgLy8gaXMgYSAleDJGICgiLyIpIGNoYXJhY3Rlci4iCiAgICBpZiAocmVxUGF0aC5zdWJzdHIoY29va2llUGF0aC5sZW5ndGgsIDEpID09PSAiLyIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICByZXR1cm4gZmFsc2U7Cn0KCnBhdGhNYXRjaCQzLnBhdGhNYXRjaCA9IHBhdGhNYXRjaCQyOwoKdmFyIHV0aWxIZWxwZXIgPSB7fTsKCmNvbnN0IF9fdml0ZUJyb3dzZXJFeHRlcm5hbCA9IHt9OwoKY29uc3QgX192aXRlQnJvd3NlckV4dGVybmFsJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGRlZmF1bHQ6IF9fdml0ZUJyb3dzZXJFeHRlcm5hbAp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IHJlcXVpcmUkJDAkMSA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoX192aXRlQnJvd3NlckV4dGVybmFsJDEpOwoKZnVuY3Rpb24gcmVxdWlyZVV0aWwkMSgpIHsKICB0cnkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtbW9kdWxlcwogICAgcmV0dXJuIHJlcXVpcmUkJDAkMTsKICB9IGNhdGNoIChlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCi8vIGZvciB2MTAuMTIuMCsKZnVuY3Rpb24gbG9va3VwQ3VzdG9tSW5zcGVjdFN5bWJvbCgpIHsKICByZXR1cm4gU3ltYm9sLmZvcigibm9kZWpzLnV0aWwuaW5zcGVjdC5jdXN0b20iKTsKfQoKLy8gZm9yIG9sZGVyIG5vZGUgZW52aXJvbm1lbnRzCmZ1bmN0aW9uIHRyeVJlYWRpbmdDdXN0b21TeW1ib2xGcm9tVXRpbEluc3BlY3Qob3B0aW9ucykgewogIGNvbnN0IF9yZXF1aXJlVXRpbCA9IG9wdGlvbnMucmVxdWlyZVV0aWwgfHwgcmVxdWlyZVV0aWwkMTsKICBjb25zdCB1dGlsID0gX3JlcXVpcmVVdGlsKCk7CiAgcmV0dXJuIHV0aWwgPyB1dGlsLmluc3BlY3QuY3VzdG9tIDogbnVsbDsKfQoKdXRpbEhlbHBlci5nZXRVdGlsSW5zcGVjdCA9IGZ1bmN0aW9uIGdldFV0aWxJbnNwZWN0KGZhbGxiYWNrLCBvcHRpb25zID0ge30pIHsKICBjb25zdCBfcmVxdWlyZVV0aWwgPSBvcHRpb25zLnJlcXVpcmVVdGlsIHx8IHJlcXVpcmVVdGlsJDE7CiAgY29uc3QgdXRpbCA9IF9yZXF1aXJlVXRpbCgpOwogIHJldHVybiBmdW5jdGlvbiBpbnNwZWN0KHZhbHVlLCBzaG93SGlkZGVuLCBkZXB0aCkgewogICAgcmV0dXJuIHV0aWwgPyB1dGlsLmluc3BlY3QodmFsdWUsIHNob3dIaWRkZW4sIGRlcHRoKSA6IGZhbGxiYWNrKHZhbHVlKTsKICB9Owp9OwoKdXRpbEhlbHBlci5nZXRDdXN0b21JbnNwZWN0U3ltYm9sID0gZnVuY3Rpb24gZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbChvcHRpb25zID0ge30pIHsKICBjb25zdCBfbG9va3VwQ3VzdG9tSW5zcGVjdFN5bWJvbCA9CiAgICBvcHRpb25zLmxvb2t1cEN1c3RvbUluc3BlY3RTeW1ib2wgfHwgbG9va3VwQ3VzdG9tSW5zcGVjdFN5bWJvbDsKCiAgLy8gZ2V0IGN1c3RvbSBpbnNwZWN0IHN5bWJvbCBmb3Igbm9kZSBlbnZpcm9ubWVudHMKICByZXR1cm4gKAogICAgX2xvb2t1cEN1c3RvbUluc3BlY3RTeW1ib2woKSB8fAogICAgdHJ5UmVhZGluZ0N1c3RvbVN5bWJvbEZyb21VdGlsSW5zcGVjdChvcHRpb25zKQogICk7Cn07CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwpjb25zdCB7IGZyb21DYWxsYmFjazogZnJvbUNhbGxiYWNrJDEgfSA9IHVuaXZlcnNhbGlmeTsKY29uc3QgU3RvcmUkMSA9IHN0b3JlLlN0b3JlOwpjb25zdCBwZXJtdXRlRG9tYWluJDEgPSByZXF1aXJlUGVybXV0ZURvbWFpbigpLnBlcm11dGVEb21haW47CmNvbnN0IHBhdGhNYXRjaCQxID0gcGF0aE1hdGNoJDMucGF0aE1hdGNoOwpjb25zdCB7IGdldEN1c3RvbUluc3BlY3RTeW1ib2w6IGdldEN1c3RvbUluc3BlY3RTeW1ib2wkMSwgZ2V0VXRpbEluc3BlY3QgfSA9IHV0aWxIZWxwZXI7CgpsZXQgTWVtb3J5Q29va2llU3RvcmUkMSA9IGNsYXNzIE1lbW9yeUNvb2tpZVN0b3JlIGV4dGVuZHMgU3RvcmUkMSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5zeW5jaHJvbm91cyA9IHRydWU7CiAgICB0aGlzLmlkeCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBjdXN0b21JbnNwZWN0U3ltYm9sID0gZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbCQxKCk7CiAgICBpZiAoY3VzdG9tSW5zcGVjdFN5bWJvbCkgewogICAgICB0aGlzW2N1c3RvbUluc3BlY3RTeW1ib2xdID0gdGhpcy5pbnNwZWN0OwogICAgfQogIH0KCiAgaW5zcGVjdCgpIHsKICAgIGNvbnN0IHV0aWwgPSB7IGluc3BlY3Q6IGdldFV0aWxJbnNwZWN0KGluc3BlY3RGYWxsYmFjaykgfTsKICAgIHJldHVybiBgeyBpZHg6ICR7dXRpbC5pbnNwZWN0KHRoaXMuaWR4LCBmYWxzZSwgMil9IH1gOwogIH0KCiAgZmluZENvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIGlmICghdGhpcy5pZHhbZG9tYWluXSkgewogICAgICByZXR1cm4gY2IobnVsbCwgdW5kZWZpbmVkKTsKICAgIH0KICAgIGlmICghdGhpcy5pZHhbZG9tYWluXVtwYXRoXSkgewogICAgICByZXR1cm4gY2IobnVsbCwgdW5kZWZpbmVkKTsKICAgIH0KICAgIHJldHVybiBjYihudWxsLCB0aGlzLmlkeFtkb21haW5dW3BhdGhdW2tleV0gfHwgbnVsbCk7CiAgfQogIGZpbmRDb29raWVzKGRvbWFpbiwgcGF0aCwgYWxsb3dTcGVjaWFsVXNlRG9tYWluLCBjYikgewogICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgaWYgKHR5cGVvZiBhbGxvd1NwZWNpYWxVc2VEb21haW4gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgY2IgPSBhbGxvd1NwZWNpYWxVc2VEb21haW47CiAgICAgIGFsbG93U3BlY2lhbFVzZURvbWFpbiA9IHRydWU7CiAgICB9CiAgICBpZiAoIWRvbWFpbikgewogICAgICByZXR1cm4gY2IobnVsbCwgW10pOwogICAgfQoKICAgIGxldCBwYXRoTWF0Y2hlcjsKICAgIGlmICghcGF0aCkgewogICAgICAvLyBudWxsIG1lYW5zICJhbGwgcGF0aHMiCiAgICAgIHBhdGhNYXRjaGVyID0gZnVuY3Rpb24gbWF0Y2hBbGwoZG9tYWluSW5kZXgpIHsKICAgICAgICBmb3IgKGNvbnN0IGN1clBhdGggaW4gZG9tYWluSW5kZXgpIHsKICAgICAgICAgIGNvbnN0IHBhdGhJbmRleCA9IGRvbWFpbkluZGV4W2N1clBhdGhdOwogICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGF0aEluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaChwYXRoSW5kZXhba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgcGF0aE1hdGNoZXIgPSBmdW5jdGlvbiBtYXRjaFJGQyhkb21haW5JbmRleCkgewogICAgICAgIC8vTk9URTogd2Ugc2hvdWxkIHVzZSBwYXRoLW1hdGNoIGFsZ29yaXRobSBmcm9tIFM1LjEuNCBoZXJlCiAgICAgICAgLy8oc2VlIDogaHR0cHM6Ly9naXRodWIuY29tL0Nocm9taXVtV2ViQXBwcy9jaHJvbWl1bS9ibG9iL2IzZDNiNGRhOGJiOTRjMWIyZTA2MTYwMGRmMTA2ZDU5MGZkYTM2MjAvbmV0L2Nvb2tpZXMvY2Fub25pY2FsX2Nvb2tpZS5jYyNMMjk5KQogICAgICAgIE9iamVjdC5rZXlzKGRvbWFpbkluZGV4KS5mb3JFYWNoKGNvb2tpZVBhdGggPT4gewogICAgICAgICAgaWYgKHBhdGhNYXRjaCQxKHBhdGgsIGNvb2tpZVBhdGgpKSB7CiAgICAgICAgICAgIGNvbnN0IHBhdGhJbmRleCA9IGRvbWFpbkluZGV4W2Nvb2tpZVBhdGhdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRoSW5kZXgpIHsKICAgICAgICAgICAgICByZXN1bHRzLnB1c2gocGF0aEluZGV4W2tleV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CgogICAgY29uc3QgZG9tYWlucyA9IHBlcm11dGVEb21haW4kMShkb21haW4sIGFsbG93U3BlY2lhbFVzZURvbWFpbikgfHwgW2RvbWFpbl07CiAgICBjb25zdCBpZHggPSB0aGlzLmlkeDsKICAgIGRvbWFpbnMuZm9yRWFjaChjdXJEb21haW4gPT4gewogICAgICBjb25zdCBkb21haW5JbmRleCA9IGlkeFtjdXJEb21haW5dOwogICAgICBpZiAoIWRvbWFpbkluZGV4KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHBhdGhNYXRjaGVyKGRvbWFpbkluZGV4KTsKICAgIH0pOwoKICAgIGNiKG51bGwsIHJlc3VsdHMpOwogIH0KCiAgcHV0Q29va2llKGNvb2tpZSwgY2IpIHsKICAgIGlmICghdGhpcy5pZHhbY29va2llLmRvbWFpbl0pIHsKICAgICAgdGhpcy5pZHhbY29va2llLmRvbWFpbl0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgaWYgKCF0aGlzLmlkeFtjb29raWUuZG9tYWluXVtjb29raWUucGF0aF0pIHsKICAgICAgdGhpcy5pZHhbY29va2llLmRvbWFpbl1bY29va2llLnBhdGhdID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIH0KICAgIHRoaXMuaWR4W2Nvb2tpZS5kb21haW5dW2Nvb2tpZS5wYXRoXVtjb29raWUua2V5XSA9IGNvb2tpZTsKICAgIGNiKG51bGwpOwogIH0KICB1cGRhdGVDb29raWUob2xkQ29va2llLCBuZXdDb29raWUsIGNiKSB7CiAgICAvLyB1cGRhdGVDb29raWUoKSBtYXkgYXZvaWQgdXBkYXRpbmcgY29va2llcyB0aGF0IGFyZSBpZGVudGljYWwuICBGb3IgZXhhbXBsZSwKICAgIC8vIGxhc3RBY2Nlc3NlZCBtYXkgbm90IGJlIGltcG9ydGFudCB0byBzb21lIHN0b3JlcyBhbmQgYW4gZXF1YWxpdHkKICAgIC8vIGNvbXBhcmlzb24gY291bGQgZXhjbHVkZSB0aGF0IGZpZWxkLgogICAgdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgfQogIHJlbW92ZUNvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIGlmICgKICAgICAgdGhpcy5pZHhbZG9tYWluXSAmJgogICAgICB0aGlzLmlkeFtkb21haW5dW3BhdGhdICYmCiAgICAgIHRoaXMuaWR4W2RvbWFpbl1bcGF0aF1ba2V5XQogICAgKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dW3BhdGhdW2tleV07CiAgICB9CiAgICBjYihudWxsKTsKICB9CiAgcmVtb3ZlQ29va2llcyhkb21haW4sIHBhdGgsIGNiKSB7CiAgICBpZiAodGhpcy5pZHhbZG9tYWluXSkgewogICAgICBpZiAocGF0aCkgewogICAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dW3BhdGhdOwogICAgICB9IGVsc2UgewogICAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2IobnVsbCk7CiAgfQogIHJlbW92ZUFsbENvb2tpZXMoY2IpIHsKICAgIHRoaXMuaWR4ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHJldHVybiBjYihudWxsKTsKICB9CiAgZ2V0QWxsQ29va2llcyhjYikgewogICAgY29uc3QgY29va2llcyA9IFtdOwogICAgY29uc3QgaWR4ID0gdGhpcy5pZHg7CgogICAgY29uc3QgZG9tYWlucyA9IE9iamVjdC5rZXlzKGlkeCk7CiAgICBkb21haW5zLmZvckVhY2goZG9tYWluID0+IHsKICAgICAgY29uc3QgcGF0aHMgPSBPYmplY3Qua2V5cyhpZHhbZG9tYWluXSk7CiAgICAgIHBhdGhzLmZvckVhY2gocGF0aCA9PiB7CiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGlkeFtkb21haW5dW3BhdGhdKTsKICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgICAgIGlmIChrZXkgIT09IG51bGwpIHsKICAgICAgICAgICAgY29va2llcy5wdXNoKGlkeFtkb21haW5dW3BhdGhdW2tleV0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwoKICAgIC8vIFNvcnQgYnkgY3JlYXRpb25JbmRleCBzbyBkZXNlcmlhbGl6aW5nIHJldGFpbnMgdGhlIGNyZWF0aW9uIG9yZGVyLgogICAgLy8gV2hlbiBpbXBsZW1lbnRpbmcgeW91ciBvd24gc3RvcmUsIHRoaXMgU0hPVUxEIHJldGFpbiB0aGUgb3JkZXIgdG9vCiAgICBjb29raWVzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgcmV0dXJuIChhLmNyZWF0aW9uSW5kZXggfHwgMCkgLSAoYi5jcmVhdGlvbkluZGV4IHx8IDApOwogICAgfSk7CgogICAgY2IobnVsbCwgY29va2llcyk7CiAgfQp9OwoKWwogICJmaW5kQ29va2llIiwKICAiZmluZENvb2tpZXMiLAogICJwdXRDb29raWUiLAogICJ1cGRhdGVDb29raWUiLAogICJyZW1vdmVDb29raWUiLAogICJyZW1vdmVDb29raWVzIiwKICAicmVtb3ZlQWxsQ29va2llcyIsCiAgImdldEFsbENvb2tpZXMiCl0uZm9yRWFjaChuYW1lID0+IHsKICBNZW1vcnlDb29raWVTdG9yZSQxLnByb3RvdHlwZVtuYW1lXSA9IGZyb21DYWxsYmFjayQxKAogICAgTWVtb3J5Q29va2llU3RvcmUkMS5wcm90b3R5cGVbbmFtZV0KICApOwp9KTsKCm1lbXN0b3JlLk1lbW9yeUNvb2tpZVN0b3JlID0gTWVtb3J5Q29va2llU3RvcmUkMTsKCmZ1bmN0aW9uIGluc3BlY3RGYWxsYmFjayh2YWwpIHsKICBjb25zdCBkb21haW5zID0gT2JqZWN0LmtleXModmFsKTsKICBpZiAoZG9tYWlucy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiAiW09iamVjdDogbnVsbCBwcm90b3R5cGVdIHt9IjsKICB9CiAgbGV0IHJlc3VsdCA9ICJbT2JqZWN0OiBudWxsIHByb3RvdHlwZV0ge1xuIjsKICBPYmplY3Qua2V5cyh2YWwpLmZvckVhY2goKGRvbWFpbiwgaSkgPT4gewogICAgcmVzdWx0ICs9IGZvcm1hdERvbWFpbihkb21haW4sIHZhbFtkb21haW5dKTsKICAgIGlmIChpIDwgZG9tYWlucy5sZW5ndGggLSAxKSB7CiAgICAgIHJlc3VsdCArPSAiLCI7CiAgICB9CiAgICByZXN1bHQgKz0gIlxuIjsKICB9KTsKICByZXN1bHQgKz0gIn0iOwogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGZvcm1hdERvbWFpbihkb21haW5OYW1lLCBkb21haW5WYWx1ZSkgewogIGNvbnN0IGluZGVudCA9ICIgICI7CiAgbGV0IHJlc3VsdCA9IGAke2luZGVudH0nJHtkb21haW5OYW1lfSc6IFtPYmplY3Q6IG51bGwgcHJvdG90eXBlXSB7XG5gOwogIE9iamVjdC5rZXlzKGRvbWFpblZhbHVlKS5mb3JFYWNoKChwYXRoLCBpLCBwYXRocykgPT4gewogICAgcmVzdWx0ICs9IGZvcm1hdFBhdGgocGF0aCwgZG9tYWluVmFsdWVbcGF0aF0pOwogICAgaWYgKGkgPCBwYXRocy5sZW5ndGggLSAxKSB7CiAgICAgIHJlc3VsdCArPSAiLCI7CiAgICB9CiAgICByZXN1bHQgKz0gIlxuIjsKICB9KTsKICByZXN1bHQgKz0gYCR7aW5kZW50fX1gOwogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGZvcm1hdFBhdGgocGF0aE5hbWUsIHBhdGhWYWx1ZSkgewogIGNvbnN0IGluZGVudCA9ICIgICAgIjsKICBsZXQgcmVzdWx0ID0gYCR7aW5kZW50fScke3BhdGhOYW1lfSc6IFtPYmplY3Q6IG51bGwgcHJvdG90eXBlXSB7XG5gOwogIE9iamVjdC5rZXlzKHBhdGhWYWx1ZSkuZm9yRWFjaCgoY29va2llTmFtZSwgaSwgY29va2llTmFtZXMpID0+IHsKICAgIGNvbnN0IGNvb2tpZSA9IHBhdGhWYWx1ZVtjb29raWVOYW1lXTsKICAgIHJlc3VsdCArPSBgICAgICAgJHtjb29raWVOYW1lfTogJHtjb29raWUuaW5zcGVjdCgpfWA7CiAgICBpZiAoaSA8IGNvb2tpZU5hbWVzLmxlbmd0aCAtIDEpIHsKICAgICAgcmVzdWx0ICs9ICIsIjsKICAgIH0KICAgIHJlc3VsdCArPSAiXG4iOwogIH0pOwogIHJlc3VsdCArPSBgJHtpbmRlbnR9fWA7CiAgcmV0dXJuIHJlc3VsdDsKfQoKbWVtc3RvcmUuaW5zcGVjdEZhbGxiYWNrID0gaW5zcGVjdEZhbGxiYWNrOwoKdmFyIHZhbGlkYXRvcnMkMSA9IHt9OwoKLyogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCkV4dHJhY3RlZCBmcm9tIGNoZWNrLXR5cGVzLmpzCmh0dHBzOi8vZ2l0bGFiLmNvbS9waGlsYm9vdGgvY2hlY2stdHlwZXMuanMKCk1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTIsIDIwMTMsIDIwMTQsIDIwMTUsIDIwMTYsIDIwMTcsIDIwMTgsIDIwMTkgUGhpbCBCb290aAoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQpTT0ZUV0FSRS4KCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwoKLyogVmFsaWRhdGlvbiBmdW5jdGlvbnMgY29waWVkIGZyb20gY2hlY2stdHlwZXMgcGFja2FnZSAtIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NoZWNrLXR5cGVzICovCmZ1bmN0aW9uIGlzRnVuY3Rpb24oZGF0YSkgewogIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gImZ1bmN0aW9uIjsKfQoKZnVuY3Rpb24gaXNOb25FbXB0eVN0cmluZyhkYXRhKSB7CiAgcmV0dXJuIGlzU3RyaW5nKGRhdGEpICYmIGRhdGEgIT09ICIiOwp9CgpmdW5jdGlvbiBpc0RhdGUoZGF0YSkgewogIHJldHVybiBpc0luc3RhbmNlU3RyaWN0KGRhdGEsIERhdGUpICYmIGlzSW50ZWdlcihkYXRhLmdldFRpbWUoKSk7Cn0KCmZ1bmN0aW9uIGlzRW1wdHlTdHJpbmcoZGF0YSkgewogIHJldHVybiBkYXRhID09PSAiIiB8fCAoZGF0YSBpbnN0YW5jZW9mIFN0cmluZyAmJiBkYXRhLnRvU3RyaW5nKCkgPT09ICIiKTsKfQoKZnVuY3Rpb24gaXNTdHJpbmcoZGF0YSkgewogIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgfHwgZGF0YSBpbnN0YW5jZW9mIFN0cmluZzsKfQoKZnVuY3Rpb24gaXNPYmplY3QoZGF0YSkgewogIHJldHVybiB0b1N0cmluZy5jYWxsKGRhdGEpID09PSAiW29iamVjdCBPYmplY3RdIjsKfQpmdW5jdGlvbiBpc0luc3RhbmNlU3RyaWN0KGRhdGEsIHByb3RvdHlwZSkgewogIHRyeSB7CiAgICByZXR1cm4gZGF0YSBpbnN0YW5jZW9mIHByb3RvdHlwZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKZnVuY3Rpb24gaXNJbnRlZ2VyKGRhdGEpIHsKICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICJudW1iZXIiICYmIGRhdGEgJSAxID09PSAwOwp9Ci8qIEVuZCB2YWxpZGF0aW9uIGZ1bmN0aW9ucyAqLwoKZnVuY3Rpb24gdmFsaWRhdGUkMShib29sLCBjYiwgb3B0aW9ucykgewogIGlmICghaXNGdW5jdGlvbihjYikpIHsKICAgIG9wdGlvbnMgPSBjYjsKICAgIGNiID0gbnVsbDsKICB9CiAgaWYgKCFpc09iamVjdChvcHRpb25zKSkgb3B0aW9ucyA9IHsgRXJyb3I6ICJGYWlsZWQgQ2hlY2siIH07CiAgaWYgKCFib29sKSB7CiAgICBpZiAoY2IpIHsKICAgICAgY2IobmV3IFBhcmFtZXRlckVycm9yKG9wdGlvbnMpKTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBQYXJhbWV0ZXJFcnJvcihvcHRpb25zKTsKICAgIH0KICB9Cn0KCmNsYXNzIFBhcmFtZXRlckVycm9yIGV4dGVuZHMgRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLnBhcmFtcykgewogICAgc3VwZXIoLi4ucGFyYW1zKTsKICB9Cn0KCnZhbGlkYXRvcnMkMS5QYXJhbWV0ZXJFcnJvciA9IFBhcmFtZXRlckVycm9yOwp2YWxpZGF0b3JzJDEuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247CnZhbGlkYXRvcnMkMS5pc05vbkVtcHR5U3RyaW5nID0gaXNOb25FbXB0eVN0cmluZzsKdmFsaWRhdG9ycyQxLmlzRGF0ZSA9IGlzRGF0ZTsKdmFsaWRhdG9ycyQxLmlzRW1wdHlTdHJpbmcgPSBpc0VtcHR5U3RyaW5nOwp2YWxpZGF0b3JzJDEuaXNTdHJpbmcgPSBpc1N0cmluZzsKdmFsaWRhdG9ycyQxLmlzT2JqZWN0ID0gaXNPYmplY3Q7CnZhbGlkYXRvcnMkMS52YWxpZGF0ZSA9IHZhbGlkYXRlJDE7CgovLyBnZW5lcmF0ZWQgYnkgZ2VudmVyc2lvbgp2YXIgdmVyc2lvbiQyID0gJzQuMS4zJzsKCi8qIQogKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAyMCwgU2FsZXNmb3JjZS5jb20sIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogKgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgogKiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogMy4gTmVpdGhlciB0aGUgbmFtZSBvZiBTYWxlc2ZvcmNlLmNvbSBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiAqIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKICogc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogKgogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogKiBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFCiAqIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IKICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiAqIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KY29uc3QgcHVueWNvZGUgPSByZXF1aXJlJCQwJDI7CmNvbnN0IHVybFBhcnNlID0gdXJsUGFyc2UkMTsKY29uc3QgcHVic3VmZml4ID0gcHVic3VmZml4UHNsOwpjb25zdCBTdG9yZSA9IHN0b3JlLlN0b3JlOwpjb25zdCBNZW1vcnlDb29raWVTdG9yZSA9IG1lbXN0b3JlLk1lbW9yeUNvb2tpZVN0b3JlOwpjb25zdCBwYXRoTWF0Y2ggPSBwYXRoTWF0Y2gkMy5wYXRoTWF0Y2g7CmNvbnN0IHZhbGlkYXRvcnMgPSB2YWxpZGF0b3JzJDE7CmNvbnN0IFZFUlNJT04gPSB2ZXJzaW9uJDI7CmNvbnN0IHsgZnJvbUNhbGxiYWNrIH0gPSB1bml2ZXJzYWxpZnk7CmNvbnN0IHsgZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbCB9ID0gdXRpbEhlbHBlcjsKCi8vIEZyb20gUkZDNjI2NSBTNC4xLjEKLy8gbm90ZSB0aGF0IGl0IGV4Y2x1ZGVzIFx4M0IgIjsiCmNvbnN0IENPT0tJRV9PQ1RFVFMgPSAvXltceDIxXHgyMy1ceDJCXHgyRC1ceDNBXHgzQy1ceDVCXHg1RC1ceDdFXSskLzsKCmNvbnN0IENPTlRST0xfQ0hBUlMgPSAvW1x4MDAtXHgxRl0vOwoKLy8gRnJvbSBDaHJvbWl1bSAvLyAnXHInLCAnXG4nIGFuZCAnXDAnIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgdGVybWluYXRvciBpbgovLyB0aGUgInJlbGF4ZWQiIG1vZGUsIHNlZToKLy8gaHR0cHM6Ly9naXRodWIuY29tL0Nocm9taXVtV2ViQXBwcy9jaHJvbWl1bS9ibG9iL2IzZDNiNGRhOGJiOTRjMWIyZTA2MTYwMGRmMTA2ZDU5MGZkYTM2MjAvbmV0L2Nvb2tpZXMvcGFyc2VkX2Nvb2tpZS5jYyNMNjAKY29uc3QgVEVSTUlOQVRPUlMgPSBbIlxuIiwgIlxyIiwgIlwwIl07CgovLyBSRkM2MjY1IFM0LjEuMSBkZWZpbmVzIHBhdGggdmFsdWUgYXMgJ2FueSBDSEFSIGV4Y2VwdCBDVExzIG9yICI7IicKLy8gTm90ZSAnOycgaXMgXHgzQgpjb25zdCBQQVRIX1ZBTFVFID0gL1tceDIwLVx4M0FceDNDLVx4N0VdKy87CgovLyBkYXRlLXRpbWUgcGFyc2luZyBjb25zdGFudHMgKFJGQzYyNjUgUzUuMS4xKQoKY29uc3QgREFURV9ERUxJTSA9IC9bXHgwOVx4MjAtXHgyRlx4M0ItXHg0MFx4NUItXHg2MFx4N0ItXHg3RV0vOwoKY29uc3QgTU9OVEhfVE9fTlVNID0gewogIGphbjogMCwKICBmZWI6IDEsCiAgbWFyOiAyLAogIGFwcjogMywKICBtYXk6IDQsCiAganVuOiA1LAogIGp1bDogNiwKICBhdWc6IDcsCiAgc2VwOiA4LAogIG9jdDogOSwKICBub3Y6IDEwLAogIGRlYzogMTEKfTsKCmNvbnN0IE1BWF9USU1FID0gMjE0NzQ4MzY0NzAwMDsgLy8gMzEtYml0IG1heApjb25zdCBNSU5fVElNRSA9IDA7IC8vIDMxLWJpdCBtaW4KY29uc3QgU0FNRV9TSVRFX0NPTlRFWFRfVkFMX0VSUiA9CiAgJ0ludmFsaWQgc2FtZVNpdGVDb250ZXh0IG9wdGlvbiBmb3IgZ2V0Q29va2llcygpOyBleHBlY3RlZCBvbmUgb2YgInN0cmljdCIsICJsYXgiLCBvciAibm9uZSInOwoKZnVuY3Rpb24gY2hlY2tTYW1lU2l0ZUNvbnRleHQodmFsdWUpIHsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNOb25FbXB0eVN0cmluZyh2YWx1ZSksIHZhbHVlKTsKICBjb25zdCBjb250ZXh0ID0gU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpOwogIGlmIChjb250ZXh0ID09PSAibm9uZSIgfHwgY29udGV4dCA9PT0gImxheCIgfHwgY29udGV4dCA9PT0gInN0cmljdCIpIHsKICAgIHJldHVybiBjb250ZXh0OwogIH0gZWxzZSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCmNvbnN0IFByZWZpeFNlY3VyaXR5RW51bSA9IE9iamVjdC5mcmVlemUoewogIFNJTEVOVDogInNpbGVudCIsCiAgU1RSSUNUOiAic3RyaWN0IiwKICBESVNBQkxFRDogInVuc2FmZS1kaXNhYmxlZCIKfSk7CgovLyBEdW1wZWQgZnJvbSBpcC1yZWdleEA0LjAuMCwgd2l0aCB0aGUgZm9sbG93aW5nIGNoYW5nZXM6Ci8vICogYWxsIGNhcHR1cmluZyBncm91cHMgY29udmVydGVkIHRvIG5vbi1jYXB0dXJpbmcgLS0gIig/OikiCi8vICogc3VwcG9ydCBmb3IgSVB2NiBTY29wZWQgTGl0ZXJhbCAoIiVldGgxIikgcmVtb3ZlZAovLyAqIGxvd2VyY2FzZSBoZXhhZGVjaW1hbCBvbmx5CmNvbnN0IElQX1JFR0VYX0xPV0VSQ0FTRSA9IC8oPzpeKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSg/OlwuKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSl7M30kKXwoPzpeKD86KD86W2EtZlxkXXsxLDR9Oil7N30oPzpbYS1mXGRdezEsNH18Oil8KD86W2EtZlxkXXsxLDR9Oil7Nn0oPzooPzoyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldXGR8XGQpKD86XC4oPzoyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldXGR8XGQpKXszfXw6W2EtZlxkXXsxLDR9fDopfCg/OlthLWZcZF17MSw0fTopezV9KD86Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsMn18Oil8KD86W2EtZlxkXXsxLDR9Oil7NH0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDF9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsM318Oil8KD86W2EtZlxkXXsxLDR9Oil7M30oPzooPzo6W2EtZlxkXXsxLDR9KXswLDJ9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNH18Oil8KD86W2EtZlxkXXsxLDR9Oil7Mn0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDN9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNX18Oil8KD86W2EtZlxkXXsxLDR9Oil7MX0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDR9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNn18Oil8KD86Oig/Oig/OjpbYS1mXGRdezEsNH0pezAsNX06KD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSg/OlwuKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSl7M318KD86OlthLWZcZF17MSw0fSl7MSw3fXw6KSkpJCkvOwpjb25zdCBJUF9WNl9SRUdFWCA9IGAKXFxbPyg/OgooPzpbYS1mQS1GXFxkXXsxLDR9Oil7N30oPzpbYS1mQS1GXFxkXXsxLDR9fDopfAooPzpbYS1mQS1GXFxkXXsxLDR9Oil7Nn0oPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldXFxkfFxcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldXFxkfFxcZCkpezN9fDpbYS1mQS1GXFxkXXsxLDR9fDopfAooPzpbYS1mQS1GXFxkXXsxLDR9Oil7NX0oPzo6KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSwyfXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezR9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsMX06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSwzfXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezN9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsMn06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw0fXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezJ9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsM306KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw1fXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezF9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsNH06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw2fXw6KXwKKD86Oig/Oig/OjpbYS1mQS1GXFxkXXsxLDR9KXswLDV9Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV1cXGR8XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV1cXGR8XFxkKSl7M318KD86OlthLWZBLUZcXGRdezEsNH0pezEsN318OikpCikoPzolWzAtOWEtekEtWl17MSx9KT9cXF0/CmAKICAucmVwbGFjZSgvXHMqXC9cLy4qJC9nbSwgIiIpCiAgLnJlcGxhY2UoL1xuL2csICIiKQogIC50cmltKCk7CmNvbnN0IElQX1Y2X1JFR0VYX09CSkVDVCA9IG5ldyBSZWdFeHAoYF4ke0lQX1Y2X1JFR0VYfSRgKTsKCi8qCiAqIFBhcnNlcyBhIE5hdHVyYWwgbnVtYmVyIChpLmUuLCBub24tbmVnYXRpdmUgaW50ZWdlcikgd2l0aCBlaXRoZXIgdGhlCiAqICAgIDxtaW4+KjxtYXg+RElHSVQgKCBub24tZGlnaXQgKk9DVEVUICkKICogb3IKICogICAgPG1pbj4qPG1heD5ESUdJVAogKiBncmFtbWFyIChSRkM2MjY1IFM1LjEuMSkuCiAqCiAqIFRoZSAidHJhaWxpbmdPSyIgYm9vbGVhbiBjb250cm9scyBpZiB0aGUgZ3JhbW1hciBhY2NlcHRzIGEKICogIiggbm9uLWRpZ2l0ICpPQ1RFVCApIiB0cmFpbGVyLgogKi8KZnVuY3Rpb24gcGFyc2VEaWdpdHModG9rZW4sIG1pbkRpZ2l0cywgbWF4RGlnaXRzLCB0cmFpbGluZ09LKSB7CiAgbGV0IGNvdW50ID0gMDsKICB3aGlsZSAoY291bnQgPCB0b2tlbi5sZW5ndGgpIHsKICAgIGNvbnN0IGMgPSB0b2tlbi5jaGFyQ29kZUF0KGNvdW50KTsKICAgIC8vICJub24tZGlnaXQgPSAleDAwLTJGIC8gJXgzQS1GRiIKICAgIGlmIChjIDw9IDB4MmYgfHwgYyA+PSAweDNhKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY291bnQrKzsKICB9CgogIC8vIGNvbnN0cmFpbiB0byBhIG1pbmltdW0gYW5kIG1heGltdW0gbnVtYmVyIG9mIGRpZ2l0cy4KICBpZiAoY291bnQgPCBtaW5EaWdpdHMgfHwgY291bnQgPiBtYXhEaWdpdHMpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgaWYgKCF0cmFpbGluZ09LICYmIGNvdW50ICE9IHRva2VuLmxlbmd0aCkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICByZXR1cm4gcGFyc2VJbnQodG9rZW4uc3Vic3RyKDAsIGNvdW50KSwgMTApOwp9CgpmdW5jdGlvbiBwYXJzZVRpbWUodG9rZW4pIHsKICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCI6Iik7CiAgY29uc3QgcmVzdWx0ID0gWzAsIDAsIDBdOwoKICAvKiBSRjYyNTYgUzUuMS4xOgogICAqICAgICAgdGltZSAgICAgICAgICAgID0gaG1zLXRpbWUgKCBub24tZGlnaXQgKk9DVEVUICkKICAgKiAgICAgIGhtcy10aW1lICAgICAgICA9IHRpbWUtZmllbGQgIjoiIHRpbWUtZmllbGQgIjoiIHRpbWUtZmllbGQKICAgKiAgICAgIHRpbWUtZmllbGQgICAgICA9IDEqMkRJR0lUCiAgICovCgogIGlmIChwYXJ0cy5sZW5ndGggIT09IDMpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgIC8vICJ0aW1lLWZpZWxkIiBtdXN0IGJlIHN0cmljdGx5ICIxKjJESUdJVCIsIEhPV0VWRVIsICJobXMtdGltZSIgY2FuIGJlCiAgICAvLyBmb2xsb3dlZCBieSAiKCBub24tZGlnaXQgKk9DVEVUICkiIHNvIHRoZXJlZm9yZSB0aGUgbGFzdCB0aW1lLWZpZWxkIGNhbgogICAgLy8gaGF2ZSBhIHRyYWlsZXIKICAgIGNvbnN0IHRyYWlsaW5nT0sgPSBpID09IDI7CiAgICBjb25zdCBudW0gPSBwYXJzZURpZ2l0cyhwYXJ0c1tpXSwgMSwgMiwgdHJhaWxpbmdPSyk7CiAgICBpZiAobnVtID09PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmVzdWx0W2ldID0gbnVtOwogIH0KCiAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gcGFyc2VNb250aCh0b2tlbikgewogIHRva2VuID0gU3RyaW5nKHRva2VuKQogICAgLnN1YnN0cigwLCAzKQogICAgLnRvTG93ZXJDYXNlKCk7CiAgY29uc3QgbnVtID0gTU9OVEhfVE9fTlVNW3Rva2VuXTsKICByZXR1cm4gbnVtID49IDAgPyBudW0gOiBudWxsOwp9CgovKgogKiBSRkM2MjY1IFM1LjEuMSBkYXRlIHBhcnNlciAoc2VlIFJGQyBmb3IgZnVsbCBncmFtbWFyKQogKi8KZnVuY3Rpb24gcGFyc2VEYXRlKHN0cikgewogIGlmICghc3RyKSB7CiAgICByZXR1cm47CiAgfQoKICAvKiBSRkM2MjY1IFM1LjEuMToKICAgKiAyLiBQcm9jZXNzIGVhY2ggZGF0ZS10b2tlbiBzZXF1ZW50aWFsbHkgaW4gdGhlIG9yZGVyIHRoZSBkYXRlLXRva2VucwogICAqIGFwcGVhciBpbiB0aGUgY29va2llLWRhdGUKICAgKi8KICBjb25zdCB0b2tlbnMgPSBzdHIuc3BsaXQoREFURV9ERUxJTSk7CiAgaWYgKCF0b2tlbnMpIHsKICAgIHJldHVybjsKICB9CgogIGxldCBob3VyID0gbnVsbDsKICBsZXQgbWludXRlID0gbnVsbDsKICBsZXQgc2Vjb25kID0gbnVsbDsKICBsZXQgZGF5T2ZNb250aCA9IG51bGw7CiAgbGV0IG1vbnRoID0gbnVsbDsKICBsZXQgeWVhciA9IG51bGw7CgogIGZvciAobGV0IGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCB0b2tlbiA9IHRva2Vuc1tpXS50cmltKCk7CiAgICBpZiAoIXRva2VuLmxlbmd0aCkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBsZXQgcmVzdWx0OwoKICAgIC8qIDIuMS4gSWYgdGhlIGZvdW5kLXRpbWUgZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgdG9rZW4gbWF0Y2hlcyB0aGUgdGltZQogICAgICogcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC10aW1lIGZsYWcgYW5kIHNldCB0aGUgaG91ci0gdmFsdWUsCiAgICAgKiBtaW51dGUtdmFsdWUsIGFuZCBzZWNvbmQtdmFsdWUgdG8gdGhlIG51bWJlcnMgZGVub3RlZCBieSB0aGUgZGlnaXRzIGluCiAgICAgKiB0aGUgZGF0ZS10b2tlbiwgcmVzcGVjdGl2ZWx5LiAgU2tpcCB0aGUgcmVtYWluaW5nIHN1Yi1zdGVwcyBhbmQgY29udGludWUKICAgICAqIHRvIHRoZSBuZXh0IGRhdGUtdG9rZW4uCiAgICAgKi8KICAgIGlmIChzZWNvbmQgPT09IG51bGwpIHsKICAgICAgcmVzdWx0ID0gcGFyc2VUaW1lKHRva2VuKTsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIGhvdXIgPSByZXN1bHRbMF07CiAgICAgICAgbWludXRlID0gcmVzdWx0WzFdOwogICAgICAgIHNlY29uZCA9IHJlc3VsdFsyXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQoKICAgIC8qIDIuMi4gSWYgdGhlIGZvdW5kLWRheS1vZi1tb250aCBmbGFnIGlzIG5vdCBzZXQgYW5kIHRoZSBkYXRlLXRva2VuIG1hdGNoZXMKICAgICAqIHRoZSBkYXktb2YtbW9udGggcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC1kYXktb2YtIG1vbnRoIGZsYWcgYW5kIHNldAogICAgICogdGhlIGRheS1vZi1tb250aC12YWx1ZSB0byB0aGUgbnVtYmVyIGRlbm90ZWQgYnkgdGhlIGRhdGUtdG9rZW4uICBTa2lwCiAgICAgKiB0aGUgcmVtYWluaW5nIHN1Yi1zdGVwcyBhbmQgY29udGludWUgdG8gdGhlIG5leHQgZGF0ZS10b2tlbi4KICAgICAqLwogICAgaWYgKGRheU9mTW9udGggPT09IG51bGwpIHsKICAgICAgLy8gImRheS1vZi1tb250aCA9IDEqMkRJR0lUICggbm9uLWRpZ2l0ICpPQ1RFVCApIgogICAgICByZXN1bHQgPSBwYXJzZURpZ2l0cyh0b2tlbiwgMSwgMiwgdHJ1ZSk7CiAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHsKICAgICAgICBkYXlPZk1vbnRoID0gcmVzdWx0OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CgogICAgLyogMi4zLiBJZiB0aGUgZm91bmQtbW9udGggZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgZGF0ZS10b2tlbiBtYXRjaGVzIHRoZQogICAgICogbW9udGggcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC1tb250aCBmbGFnIGFuZCBzZXQgdGhlIG1vbnRoLXZhbHVlIHRvCiAgICAgKiB0aGUgbW9udGggZGVub3RlZCBieSB0aGUgZGF0ZS10b2tlbi4gIFNraXAgdGhlIHJlbWFpbmluZyBzdWItc3RlcHMgYW5kCiAgICAgKiBjb250aW51ZSB0byB0aGUgbmV4dCBkYXRlLXRva2VuLgogICAgICovCiAgICBpZiAobW9udGggPT09IG51bGwpIHsKICAgICAgcmVzdWx0ID0gcGFyc2VNb250aCh0b2tlbik7CiAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHsKICAgICAgICBtb250aCA9IHJlc3VsdDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQoKICAgIC8qIDIuNC4gSWYgdGhlIGZvdW5kLXllYXIgZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgZGF0ZS10b2tlbiBtYXRjaGVzIHRoZQogICAgICogeWVhciBwcm9kdWN0aW9uLCBzZXQgdGhlIGZvdW5kLXllYXIgZmxhZyBhbmQgc2V0IHRoZSB5ZWFyLXZhbHVlIHRvIHRoZQogICAgICogbnVtYmVyIGRlbm90ZWQgYnkgdGhlIGRhdGUtdG9rZW4uICBTa2lwIHRoZSByZW1haW5pbmcgc3ViLXN0ZXBzIGFuZAogICAgICogY29udGludWUgdG8gdGhlIG5leHQgZGF0ZS10b2tlbi4KICAgICAqLwogICAgaWYgKHllYXIgPT09IG51bGwpIHsKICAgICAgLy8gInllYXIgPSAyKjRESUdJVCAoIG5vbi1kaWdpdCAqT0NURVQgKSIKICAgICAgcmVzdWx0ID0gcGFyc2VEaWdpdHModG9rZW4sIDIsIDQsIHRydWUpOwogICAgICBpZiAocmVzdWx0ICE9PSBudWxsKSB7CiAgICAgICAgeWVhciA9IHJlc3VsdDsKICAgICAgICAvKiBGcm9tIFM1LjEuMToKICAgICAgICAgKiAzLiAgSWYgdGhlIHllYXItdmFsdWUgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDcwIGFuZCBsZXNzCiAgICAgICAgICogdGhhbiBvciBlcXVhbCB0byA5OSwgaW5jcmVtZW50IHRoZSB5ZWFyLXZhbHVlIGJ5IDE5MDAuCiAgICAgICAgICogNC4gIElmIHRoZSB5ZWFyLXZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwIGFuZCBsZXNzCiAgICAgICAgICogdGhhbiBvciBlcXVhbCB0byA2OSwgaW5jcmVtZW50IHRoZSB5ZWFyLXZhbHVlIGJ5IDIwMDAuCiAgICAgICAgICovCiAgICAgICAgaWYgKHllYXIgPj0gNzAgJiYgeWVhciA8PSA5OSkgewogICAgICAgICAgeWVhciArPSAxOTAwOwogICAgICAgIH0gZWxzZSBpZiAoeWVhciA+PSAwICYmIHllYXIgPD0gNjkpIHsKICAgICAgICAgIHllYXIgKz0gMjAwMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qIFJGQyA2MjY1IFM1LjEuMQogICAqICI1LiBBYm9ydCB0aGVzZSBzdGVwcyBhbmQgZmFpbCB0byBwYXJzZSB0aGUgY29va2llLWRhdGUgaWY6CiAgICogICAgICogIGF0IGxlYXN0IG9uZSBvZiB0aGUgZm91bmQtZGF5LW9mLW1vbnRoLCBmb3VuZC1tb250aCwgZm91bmQtCiAgICogICAgICAgIHllYXIsIG9yIGZvdW5kLXRpbWUgZmxhZ3MgaXMgbm90IHNldCwKICAgKiAgICAgKiAgdGhlIGRheS1vZi1tb250aC12YWx1ZSBpcyBsZXNzIHRoYW4gMSBvciBncmVhdGVyIHRoYW4gMzEsCiAgICogICAgICogIHRoZSB5ZWFyLXZhbHVlIGlzIGxlc3MgdGhhbiAxNjAxLAogICAqICAgICAqICB0aGUgaG91ci12YWx1ZSBpcyBncmVhdGVyIHRoYW4gMjMsCiAgICogICAgICogIHRoZSBtaW51dGUtdmFsdWUgaXMgZ3JlYXRlciB0aGFuIDU5LCBvcgogICAqICAgICAqICB0aGUgc2Vjb25kLXZhbHVlIGlzIGdyZWF0ZXIgdGhhbiA1OS4KICAgKiAgICAgKE5vdGUgdGhhdCBsZWFwIHNlY29uZHMgY2Fubm90IGJlIHJlcHJlc2VudGVkIGluIHRoaXMgc3ludGF4LikiCiAgICoKICAgKiBTbywgaW4gb3JkZXIgYXMgYWJvdmU6CiAgICovCiAgaWYgKAogICAgZGF5T2ZNb250aCA9PT0gbnVsbCB8fAogICAgbW9udGggPT09IG51bGwgfHwKICAgIHllYXIgPT09IG51bGwgfHwKICAgIHNlY29uZCA9PT0gbnVsbCB8fAogICAgZGF5T2ZNb250aCA8IDEgfHwKICAgIGRheU9mTW9udGggPiAzMSB8fAogICAgeWVhciA8IDE2MDEgfHwKICAgIGhvdXIgPiAyMyB8fAogICAgbWludXRlID4gNTkgfHwKICAgIHNlY29uZCA+IDU5CiAgKSB7CiAgICByZXR1cm47CiAgfQoKICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheU9mTW9udGgsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kKSk7Cn0KCmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0RhdGUoZGF0ZSksIGRhdGUpOwogIHJldHVybiBkYXRlLnRvVVRDU3RyaW5nKCk7Cn0KCi8vIFM1LjEuMiBDYW5vbmljYWxpemVkIEhvc3QgTmFtZXMKZnVuY3Rpb24gY2Fub25pY2FsRG9tYWluKHN0cikgewogIGlmIChzdHIgPT0gbnVsbCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHN0ciA9IHN0ci50cmltKCkucmVwbGFjZSgvXlwuLywgIiIpOyAvLyBTNC4xLjIuMyAmIFM1LjIuMzogaWdub3JlIGxlYWRpbmcgLgoKICBpZiAoSVBfVjZfUkVHRVhfT0JKRUNULnRlc3Qoc3RyKSkgewogICAgc3RyID0gc3RyLnJlcGxhY2UoIlsiLCAiIikucmVwbGFjZSgiXSIsICIiKTsKICB9CgogIC8vIGNvbnZlcnQgdG8gSUROIGlmIGFueSBub24tQVNDSUkgY2hhcmFjdGVycwogIGlmIChwdW55Y29kZSAmJiAvW15cdTAwMDEtXHUwMDdmXS8udGVzdChzdHIpKSB7CiAgICBzdHIgPSBwdW55Y29kZS50b0FTQ0lJKHN0cik7CiAgfQoKICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7Cn0KCi8vIFM1LjEuMyBEb21haW4gTWF0Y2hpbmcKZnVuY3Rpb24gZG9tYWluTWF0Y2goc3RyLCBkb21TdHIsIGNhbm9uaWNhbGl6ZSkgewogIGlmIChzdHIgPT0gbnVsbCB8fCBkb21TdHIgPT0gbnVsbCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChjYW5vbmljYWxpemUgIT09IGZhbHNlKSB7CiAgICBzdHIgPSBjYW5vbmljYWxEb21haW4oc3RyKTsKICAgIGRvbVN0ciA9IGNhbm9uaWNhbERvbWFpbihkb21TdHIpOwogIH0KCiAgLyoKICAgKiBTNS4xLjM6CiAgICogIkEgc3RyaW5nIGRvbWFpbi1tYXRjaGVzIGEgZ2l2ZW4gZG9tYWluIHN0cmluZyBpZiBhdCBsZWFzdCBvbmUgb2YgdGhlCiAgICogZm9sbG93aW5nIGNvbmRpdGlvbnMgaG9sZDoiCiAgICoKICAgKiAiIG8gVGhlIGRvbWFpbiBzdHJpbmcgYW5kIHRoZSBzdHJpbmcgYXJlIGlkZW50aWNhbC4gKE5vdGUgdGhhdCBib3RoIHRoZQogICAqIGRvbWFpbiBzdHJpbmcgYW5kIHRoZSBzdHJpbmcgd2lsbCBoYXZlIGJlZW4gY2Fub25pY2FsaXplZCB0byBsb3dlciBjYXNlIGF0CiAgICogdGhpcyBwb2ludCkiCiAgICovCiAgaWYgKHN0ciA9PSBkb21TdHIpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyogIiBvIEFsbCBvZiB0aGUgZm9sbG93aW5nIFt0aHJlZV0gY29uZGl0aW9ucyBob2xkOiIgKi8KCiAgLyogIiogVGhlIGRvbWFpbiBzdHJpbmcgaXMgYSBzdWZmaXggb2YgdGhlIHN0cmluZyIgKi8KICBjb25zdCBpZHggPSBzdHIubGFzdEluZGV4T2YoZG9tU3RyKTsKICBpZiAoaWR4IDw9IDApIHsKICAgIHJldHVybiBmYWxzZTsgLy8gaXQncyBhIG5vbi1tYXRjaCAoLTEpIG9yIHByZWZpeCAoMCkKICB9CgogIC8vIG5leHQsIGNoZWNrIGl0J3MgYSBwcm9wZXIgc3VmZml4CiAgLy8gZS5nLiwgImEuYi5jIi5pbmRleE9mKCJiLmMiKSA9PT0gMgogIC8vIDUgPT09IDMrMgogIGlmIChzdHIubGVuZ3RoICE9PSBkb21TdHIubGVuZ3RoICsgaWR4KSB7CiAgICByZXR1cm4gZmFsc2U7IC8vIGl0J3Mgbm90IGEgc3VmZml4CiAgfQoKICAvKiAiICAqIFRoZSBsYXN0IGNoYXJhY3RlciBvZiB0aGUgc3RyaW5nIHRoYXQgaXMgbm90IGluY2x1ZGVkIGluIHRoZQogICAqIGRvbWFpbiBzdHJpbmcgaXMgYSAleDJFICgiLiIpIGNoYXJhY3Rlci4iICovCiAgaWYgKHN0ci5zdWJzdHIoaWR4IC0gMSwgMSkgIT09ICIuIikgewogICAgcmV0dXJuIGZhbHNlOyAvLyBkb2Vzbid0IGFsaWduIG9uICIuIgogIH0KCiAgLyogIiAgKiBUaGUgc3RyaW5nIGlzIGEgaG9zdCBuYW1lIChpLmUuLCBub3QgYW4gSVAgYWRkcmVzcykuIiAqLwogIGlmIChJUF9SRUdFWF9MT1dFUkNBU0UudGVzdChzdHIpKSB7CiAgICByZXR1cm4gZmFsc2U7IC8vIGl0J3MgYW4gSVAgYWRkcmVzcwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KCi8vIFJGQzYyNjUgUzUuMS40IFBhdGhzIGFuZCBQYXRoLU1hdGNoCgovKgogKiAiVGhlIHVzZXIgYWdlbnQgTVVTVCB1c2UgYW4gYWxnb3JpdGhtIGVxdWl2YWxlbnQgdG8gdGhlIGZvbGxvd2luZyBhbGdvcml0aG0KICogdG8gY29tcHV0ZSB0aGUgZGVmYXVsdC1wYXRoIG9mIGEgY29va2llOiIKICoKICogQXNzdW1wdGlvbjogdGhlIHBhdGggKGFuZCBub3QgcXVlcnkgcGFydCBvciBhYnNvbHV0ZSB1cmkpIGlzIHBhc3NlZCBpbi4KICovCmZ1bmN0aW9uIGRlZmF1bHRQYXRoKHBhdGgpIHsKICAvLyAiMi4gSWYgdGhlIHVyaS1wYXRoIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlIHVyaS1wYXRoIGlzIG5vdAogIC8vIGEgJXgyRiAoIi8iKSBjaGFyYWN0ZXIsIG91dHB1dCAleDJGICgiLyIpIGFuZCBza2lwIHRoZSByZW1haW5pbmcgc3RlcHMuCiAgaWYgKCFwYXRoIHx8IHBhdGguc3Vic3RyKDAsIDEpICE9PSAiLyIpIHsKICAgIHJldHVybiAiLyI7CiAgfQoKICAvLyAiMy4gSWYgdGhlIHVyaS1wYXRoIGNvbnRhaW5zIG5vIG1vcmUgdGhhbiBvbmUgJXgyRiAoIi8iKSBjaGFyYWN0ZXIsIG91dHB1dAogIC8vICV4MkYgKCIvIikgYW5kIHNraXAgdGhlIHJlbWFpbmluZyBzdGVwLiIKICBpZiAocGF0aCA9PT0gIi8iKSB7CiAgICByZXR1cm4gcGF0aDsKICB9CgogIGNvbnN0IHJpZ2h0U2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCIvIik7CiAgaWYgKHJpZ2h0U2xhc2ggPT09IDApIHsKICAgIHJldHVybiAiLyI7CiAgfQoKICAvLyAiNC4gT3V0cHV0IHRoZSBjaGFyYWN0ZXJzIG9mIHRoZSB1cmktcGF0aCBmcm9tIHRoZSBmaXJzdCBjaGFyYWN0ZXIgdXAgdG8sCiAgLy8gYnV0IG5vdCBpbmNsdWRpbmcsIHRoZSByaWdodC1tb3N0ICV4MkYgKCIvIikuIgogIHJldHVybiBwYXRoLnNsaWNlKDAsIHJpZ2h0U2xhc2gpOwp9CgpmdW5jdGlvbiB0cmltVGVybWluYXRvcihzdHIpIHsKICBpZiAodmFsaWRhdG9ycy5pc0VtcHR5U3RyaW5nKHN0cikpIHJldHVybiBzdHI7CiAgZm9yIChsZXQgdCA9IDA7IHQgPCBURVJNSU5BVE9SUy5sZW5ndGg7IHQrKykgewogICAgY29uc3QgdGVybWluYXRvcklkeCA9IHN0ci5pbmRleE9mKFRFUk1JTkFUT1JTW3RdKTsKICAgIGlmICh0ZXJtaW5hdG9ySWR4ICE9PSAtMSkgewogICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIHRlcm1pbmF0b3JJZHgpOwogICAgfQogIH0KCiAgcmV0dXJuIHN0cjsKfQoKZnVuY3Rpb24gcGFyc2VDb29raWVQYWlyKGNvb2tpZVBhaXIsIGxvb3NlTW9kZSkgewogIGNvb2tpZVBhaXIgPSB0cmltVGVybWluYXRvcihjb29raWVQYWlyKTsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNTdHJpbmcoY29va2llUGFpciksIGNvb2tpZVBhaXIpOwoKICBsZXQgZmlyc3RFcSA9IGNvb2tpZVBhaXIuaW5kZXhPZigiPSIpOwogIGlmIChsb29zZU1vZGUpIHsKICAgIGlmIChmaXJzdEVxID09PSAwKSB7CiAgICAgIC8vICc9JyBpcyBpbW1lZGlhdGVseSBhdCBzdGFydAogICAgICBjb29raWVQYWlyID0gY29va2llUGFpci5zdWJzdHIoMSk7CiAgICAgIGZpcnN0RXEgPSBjb29raWVQYWlyLmluZGV4T2YoIj0iKTsgLy8gbWlnaHQgc3RpbGwgbmVlZCB0byBzcGxpdCBvbiAnPScKICAgIH0KICB9IGVsc2UgewogICAgLy8gbm9uLWxvb3NlIG1vZGUKICAgIGlmIChmaXJzdEVxIDw9IDApIHsKICAgICAgLy8gbm8gJz0nIG9yIGlzIGF0IHN0YXJ0CiAgICAgIHJldHVybjsgLy8gbmVlZHMgdG8gaGF2ZSBub24tZW1wdHkgImNvb2tpZS1uYW1lIgogICAgfQogIH0KCiAgbGV0IGNvb2tpZU5hbWUsIGNvb2tpZVZhbHVlOwogIGlmIChmaXJzdEVxIDw9IDApIHsKICAgIGNvb2tpZU5hbWUgPSAiIjsKICAgIGNvb2tpZVZhbHVlID0gY29va2llUGFpci50cmltKCk7CiAgfSBlbHNlIHsKICAgIGNvb2tpZU5hbWUgPSBjb29raWVQYWlyLnN1YnN0cigwLCBmaXJzdEVxKS50cmltKCk7CiAgICBjb29raWVWYWx1ZSA9IGNvb2tpZVBhaXIuc3Vic3RyKGZpcnN0RXEgKyAxKS50cmltKCk7CiAgfQoKICBpZiAoQ09OVFJPTF9DSEFSUy50ZXN0KGNvb2tpZU5hbWUpIHx8IENPTlRST0xfQ0hBUlMudGVzdChjb29raWVWYWx1ZSkpIHsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IGMgPSBuZXcgQ29va2llKCk7CiAgYy5rZXkgPSBjb29raWVOYW1lOwogIGMudmFsdWUgPSBjb29raWVWYWx1ZTsKICByZXR1cm4gYzsKfQoKZnVuY3Rpb24gcGFyc2UkSChzdHIsIG9wdGlvbnMpIHsKICBpZiAoIW9wdGlvbnMgfHwgdHlwZW9mIG9wdGlvbnMgIT09ICJvYmplY3QiKSB7CiAgICBvcHRpb25zID0ge307CiAgfQoKICBpZiAodmFsaWRhdG9ycy5pc0VtcHR5U3RyaW5nKHN0cikgfHwgIXZhbGlkYXRvcnMuaXNTdHJpbmcoc3RyKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICBzdHIgPSBzdHIudHJpbSgpOwoKICAvLyBXZSB1c2UgYSByZWdleCB0byBwYXJzZSB0aGUgIm5hbWUtdmFsdWUtcGFpciIgcGFydCBvZiBTNS4yCiAgY29uc3QgZmlyc3RTZW1pID0gc3RyLmluZGV4T2YoIjsiKTsgLy8gUzUuMiBzdGVwIDEKICBjb25zdCBjb29raWVQYWlyID0gZmlyc3RTZW1pID09PSAtMSA/IHN0ciA6IHN0ci5zdWJzdHIoMCwgZmlyc3RTZW1pKTsKICBjb25zdCBjID0gcGFyc2VDb29raWVQYWlyKGNvb2tpZVBhaXIsICEhb3B0aW9ucy5sb29zZSk7CiAgaWYgKCFjKSB7CiAgICByZXR1cm47CiAgfQoKICBpZiAoZmlyc3RTZW1pID09PSAtMSkgewogICAgcmV0dXJuIGM7CiAgfQoKICAvLyBTNS4yLjMgInVucGFyc2VkLWF0dHJpYnV0ZXMgY29uc2lzdCBvZiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzZXQtY29va2llLXN0cmluZwogIC8vIChpbmNsdWRpbmcgdGhlICV4M0IgKCI7IikgaW4gcXVlc3Rpb24pLiIgcGx1cyBsYXRlciBvbiBpbiB0aGUgc2FtZSBzZWN0aW9uCiAgLy8gImRpc2NhcmQgdGhlIGZpcnN0ICI7IiBhbmQgdHJpbSIuCiAgY29uc3QgdW5wYXJzZWQgPSBzdHIuc2xpY2UoZmlyc3RTZW1pICsgMSkudHJpbSgpOwoKICAvLyAiSWYgdGhlIHVucGFyc2VkLWF0dHJpYnV0ZXMgc3RyaW5nIGlzIGVtcHR5LCBza2lwIHRoZSByZXN0IG9mIHRoZXNlCiAgLy8gc3RlcHMuIgogIGlmICh1bnBhcnNlZC5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBjOwogIH0KCiAgLyoKICAgKiBTNS4yIHNheXMgdGhhdCB3aGVuIGxvb3Bpbmcgb3ZlciB0aGUgaXRlbXMgIltwXXJvY2VzcyB0aGUgYXR0cmlidXRlLW5hbWUKICAgKiBhbmQgYXR0cmlidXRlLXZhbHVlIGFjY29yZGluZyB0byB0aGUgcmVxdWlyZW1lbnRzIGluIHRoZSBmb2xsb3dpbmcKICAgKiBzdWJzZWN0aW9ucyIgZm9yIGV2ZXJ5IGl0ZW0uICBQbHVzLCBmb3IgbWFueSBvZiB0aGUgaW5kaXZpZHVhbCBhdHRyaWJ1dGVzCiAgICogaW4gUzUuMyBpdCBzYXlzIHRvIHVzZSB0aGUgImF0dHJpYnV0ZS12YWx1ZSBvZiB0aGUgbGFzdCBhdHRyaWJ1dGUgaW4gdGhlCiAgICogY29va2llLWF0dHJpYnV0ZS1saXN0Ii4gIFRoZXJlZm9yZSwgaW4gdGhpcyBpbXBsZW1lbnRhdGlvbiwgd2Ugb3ZlcndyaXRlCiAgICogdGhlIHByZXZpb3VzIHZhbHVlLgogICAqLwogIGNvbnN0IGNvb2tpZV9hdnMgPSB1bnBhcnNlZC5zcGxpdCgiOyIpOwogIHdoaWxlIChjb29raWVfYXZzLmxlbmd0aCkgewogICAgY29uc3QgYXYgPSBjb29raWVfYXZzLnNoaWZ0KCkudHJpbSgpOwogICAgaWYgKGF2Lmxlbmd0aCA9PT0gMCkgewogICAgICAvLyBoYXBwZW5zIGlmICI7OyIgYXBwZWFycwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGF2X3NlcCA9IGF2LmluZGV4T2YoIj0iKTsKICAgIGxldCBhdl9rZXksIGF2X3ZhbHVlOwoKICAgIGlmIChhdl9zZXAgPT09IC0xKSB7CiAgICAgIGF2X2tleSA9IGF2OwogICAgICBhdl92YWx1ZSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBhdl9rZXkgPSBhdi5zdWJzdHIoMCwgYXZfc2VwKTsKICAgICAgYXZfdmFsdWUgPSBhdi5zdWJzdHIoYXZfc2VwICsgMSk7CiAgICB9CgogICAgYXZfa2V5ID0gYXZfa2V5LnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoKICAgIGlmIChhdl92YWx1ZSkgewogICAgICBhdl92YWx1ZSA9IGF2X3ZhbHVlLnRyaW0oKTsKICAgIH0KCiAgICBzd2l0Y2ggKGF2X2tleSkgewogICAgICBjYXNlICJleHBpcmVzIjogLy8gUzUuMi4xCiAgICAgICAgaWYgKGF2X3ZhbHVlKSB7CiAgICAgICAgICBjb25zdCBleHAgPSBwYXJzZURhdGUoYXZfdmFsdWUpOwogICAgICAgICAgLy8gIklmIHRoZSBhdHRyaWJ1dGUtdmFsdWUgZmFpbGVkIHRvIHBhcnNlIGFzIGEgY29va2llIGRhdGUsIGlnbm9yZSB0aGUKICAgICAgICAgIC8vIGNvb2tpZS1hdi4iCiAgICAgICAgICBpZiAoZXhwKSB7CiAgICAgICAgICAgIC8vIG92ZXIgYW5kIHVuZGVyZmxvdyBub3QgcmVhbGlzdGljYWxseSBhIGNvbmNlcm46IFY4J3MgZ2V0VGltZSgpIHNlZW1zIHRvCiAgICAgICAgICAgIC8vIHN0b3JlIHNvbWV0aGluZyBsYXJnZXIgdGhhbiBhIDMyLWJpdCB0aW1lX3QgKGV2ZW4gd2l0aCAzMi1iaXQgbm9kZSkKICAgICAgICAgICAgYy5leHBpcmVzID0gZXhwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgIm1heC1hZ2UiOiAvLyBTNS4yLjIKICAgICAgICBpZiAoYXZfdmFsdWUpIHsKICAgICAgICAgIC8vICJJZiB0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIHRoZSBhdHRyaWJ1dGUtdmFsdWUgaXMgbm90IGEgRElHSVQgb3IgYSAiLSIKICAgICAgICAgIC8vIGNoYXJhY3RlciAuLi5bb3JdLi4uIElmIHRoZSByZW1haW5kZXIgb2YgYXR0cmlidXRlLXZhbHVlIGNvbnRhaW5zIGEKICAgICAgICAgIC8vIG5vbi1ESUdJVCBjaGFyYWN0ZXIsIGlnbm9yZSB0aGUgY29va2llLWF2LiIKICAgICAgICAgIGlmICgvXi0/WzAtOV0rJC8udGVzdChhdl92YWx1ZSkpIHsKICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBwYXJzZUludChhdl92YWx1ZSwgMTApOwogICAgICAgICAgICAvLyAiSWYgZGVsdGEtc2Vjb25kcyBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gemVybyAoMCksIGxldCBleHBpcnktdGltZQogICAgICAgICAgICAvLyBiZSB0aGUgZWFybGllc3QgcmVwcmVzZW50YWJsZSBkYXRlIGFuZCB0aW1lLiIKICAgICAgICAgICAgYy5zZXRNYXhBZ2UoZGVsdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImRvbWFpbiI6IC8vIFM1LjIuMwogICAgICAgIC8vICJJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5LCB0aGUgYmVoYXZpb3IgaXMgdW5kZWZpbmVkLiAgSG93ZXZlciwKICAgICAgICAvLyB0aGUgdXNlciBhZ2VudCBTSE9VTEQgaWdub3JlIHRoZSBjb29raWUtYXYgZW50aXJlbHkuIgogICAgICAgIGlmIChhdl92YWx1ZSkgewogICAgICAgICAgLy8gUzUuMi4zICJMZXQgY29va2llLWRvbWFpbiBiZSB0aGUgYXR0cmlidXRlLXZhbHVlIHdpdGhvdXQgdGhlIGxlYWRpbmcgJXgyRQogICAgICAgICAgLy8gKCIuIikgY2hhcmFjdGVyLiIKICAgICAgICAgIGNvbnN0IGRvbWFpbiA9IGF2X3ZhbHVlLnRyaW0oKS5yZXBsYWNlKC9eXC4vLCAiIik7CiAgICAgICAgICBpZiAoZG9tYWluKSB7CiAgICAgICAgICAgIC8vICJDb252ZXJ0IHRoZSBjb29raWUtZG9tYWluIHRvIGxvd2VyIGNhc2UuIgogICAgICAgICAgICBjLmRvbWFpbiA9IGRvbWFpbi50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInBhdGgiOiAvLyBTNS4yLjQKICAgICAgICAvKgogICAgICAgICAqICJJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlCiAgICAgICAgICogYXR0cmlidXRlLXZhbHVlIGlzIG5vdCAleDJGICgiLyIpOgogICAgICAgICAqICAgTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBkZWZhdWx0LXBhdGguCiAgICAgICAgICogT3RoZXJ3aXNlOgogICAgICAgICAqICAgTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBhdHRyaWJ1dGUtdmFsdWUuIgogICAgICAgICAqCiAgICAgICAgICogV2UnbGwgcmVwcmVzZW50IHRoZSBkZWZhdWx0LXBhdGggYXMgbnVsbCBzaW5jZSBpdCBkZXBlbmRzIG9uIHRoZQogICAgICAgICAqIGNvbnRleHQgb2YgdGhlIHBhcnNpbmcuCiAgICAgICAgICovCiAgICAgICAgYy5wYXRoID0gYXZfdmFsdWUgJiYgYXZfdmFsdWVbMF0gPT09ICIvIiA/IGF2X3ZhbHVlIDogbnVsbDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInNlY3VyZSI6IC8vIFM1LjIuNQogICAgICAgIC8qCiAgICAgICAgICogIklmIHRoZSBhdHRyaWJ1dGUtbmFtZSBjYXNlLWluc2Vuc2l0aXZlbHkgbWF0Y2hlcyB0aGUgc3RyaW5nICJTZWN1cmUiLAogICAgICAgICAqIHRoZSB1c2VyIGFnZW50IE1VU1QgYXBwZW5kIGFuIGF0dHJpYnV0ZSB0byB0aGUgY29va2llLWF0dHJpYnV0ZS1saXN0CiAgICAgICAgICogd2l0aCBhbiBhdHRyaWJ1dGUtbmFtZSBvZiBTZWN1cmUgYW5kIGFuIGVtcHR5IGF0dHJpYnV0ZS12YWx1ZS4iCiAgICAgICAgICovCiAgICAgICAgYy5zZWN1cmUgPSB0cnVlOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiaHR0cG9ubHkiOiAvLyBTNS4yLjYgLS0gZWZmZWN0aXZlbHkgdGhlIHNhbWUgYXMgJ3NlY3VyZScKICAgICAgICBjLmh0dHBPbmx5ID0gdHJ1ZTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInNhbWVzaXRlIjogLy8gUkZDNjI2NWJpcy0wMiBTNS4zLjcKICAgICAgICBjb25zdCBlbmZvcmNlbWVudCA9IGF2X3ZhbHVlID8gYXZfdmFsdWUudG9Mb3dlckNhc2UoKSA6ICIiOwogICAgICAgIHN3aXRjaCAoZW5mb3JjZW1lbnQpIHsKICAgICAgICAgIGNhc2UgInN0cmljdCI6CiAgICAgICAgICAgIGMuc2FtZVNpdGUgPSAic3RyaWN0IjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJsYXgiOgogICAgICAgICAgICBjLnNhbWVTaXRlID0gImxheCI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAibm9uZSI6CiAgICAgICAgICAgIGMuc2FtZVNpdGUgPSAibm9uZSI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYy5zYW1lU2l0ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBjLmV4dGVuc2lvbnMgPSBjLmV4dGVuc2lvbnMgfHwgW107CiAgICAgICAgYy5leHRlbnNpb25zLnB1c2goYXYpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIGM7Cn0KCi8qKgogKiAgSWYgdGhlIGNvb2tpZS1uYW1lIGJlZ2lucyB3aXRoIGEgY2FzZS1zZW5zaXRpdmUgbWF0Y2ggZm9yIHRoZQogKiAgc3RyaW5nICJfX1NlY3VyZS0iLCBhYm9ydCB0aGVzZSBzdGVwcyBhbmQgaWdub3JlIHRoZSBjb29raWUKICogIGVudGlyZWx5IHVubGVzcyB0aGUgY29va2llJ3Mgc2VjdXJlLW9ubHktZmxhZyBpcyB0cnVlLgogKiBAcGFyYW0gY29va2llCiAqIEByZXR1cm5zIGJvb2xlYW4KICovCmZ1bmN0aW9uIGlzU2VjdXJlUHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpLCBjb29raWUpOwogIHJldHVybiAhY29va2llLmtleS5zdGFydHNXaXRoKCJfX1NlY3VyZS0iKSB8fCBjb29raWUuc2VjdXJlOwp9CgovKioKICogIElmIHRoZSBjb29raWUtbmFtZSBiZWdpbnMgd2l0aCBhIGNhc2Utc2Vuc2l0aXZlIG1hdGNoIGZvciB0aGUKICogIHN0cmluZyAiX19Ib3N0LSIsIGFib3J0IHRoZXNlIHN0ZXBzIGFuZCBpZ25vcmUgdGhlIGNvb2tpZQogKiAgZW50aXJlbHkgdW5sZXNzIHRoZSBjb29raWUgbWVldHMgYWxsIHRoZSBmb2xsb3dpbmcgY3JpdGVyaWE6CiAqICAgIDEuICBUaGUgY29va2llJ3Mgc2VjdXJlLW9ubHktZmxhZyBpcyB0cnVlLgogKiAgICAyLiAgVGhlIGNvb2tpZSdzIGhvc3Qtb25seS1mbGFnIGlzIHRydWUuCiAqICAgIDMuICBUaGUgY29va2llLWF0dHJpYnV0ZS1saXN0IGNvbnRhaW5zIGFuIGF0dHJpYnV0ZSB3aXRoIGFuCiAqICAgICAgICBhdHRyaWJ1dGUtbmFtZSBvZiAiUGF0aCIsIGFuZCB0aGUgY29va2llJ3MgcGF0aCBpcyAiLyIuCiAqIEBwYXJhbSBjb29raWUKICogQHJldHVybnMgYm9vbGVhbgogKi8KZnVuY3Rpb24gaXNIb3N0UHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpKTsKICByZXR1cm4gKAogICAgIWNvb2tpZS5rZXkuc3RhcnRzV2l0aCgiX19Ib3N0LSIpIHx8CiAgICAoY29va2llLnNlY3VyZSAmJgogICAgICBjb29raWUuaG9zdE9ubHkgJiYKICAgICAgY29va2llLnBhdGggIT0gbnVsbCAmJgogICAgICBjb29raWUucGF0aCA9PT0gIi8iKQogICk7Cn0KCi8vIGF2b2lkIHRoZSBWOCBkZW9wdGltaXphdGlvbiBtb25zdGVyIQpmdW5jdGlvbiBqc29uUGFyc2Uoc3RyKSB7CiAgbGV0IG9iajsKICB0cnkgewogICAgb2JqID0gSlNPTi5wYXJzZShzdHIpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJldHVybiBlOwogIH0KICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBmcm9tSlNPTihzdHIpIHsKICBpZiAoIXN0ciB8fCB2YWxpZGF0b3JzLmlzRW1wdHlTdHJpbmcoc3RyKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICBsZXQgb2JqOwogIGlmICh0eXBlb2Ygc3RyID09PSAic3RyaW5nIikgewogICAgb2JqID0ganNvblBhcnNlKHN0cik7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIGFzc3VtZSBpdCdzIGFuIE9iamVjdAogICAgb2JqID0gc3RyOwogIH0KCiAgY29uc3QgYyA9IG5ldyBDb29raWUoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IENvb2tpZS5zZXJpYWxpemFibGVQcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBwcm9wID0gQ29va2llLnNlcmlhbGl6YWJsZVByb3BlcnRpZXNbaV07CiAgICBpZiAob2JqW3Byb3BdID09PSB1bmRlZmluZWQgfHwgb2JqW3Byb3BdID09PSBjb29raWVEZWZhdWx0c1twcm9wXSkgewogICAgICBjb250aW51ZTsgLy8gbGVhdmUgYXMgcHJvdG90eXBlIGRlZmF1bHQKICAgIH0KCiAgICBpZiAocHJvcCA9PT0gImV4cGlyZXMiIHx8IHByb3AgPT09ICJjcmVhdGlvbiIgfHwgcHJvcCA9PT0gImxhc3RBY2Nlc3NlZCIpIHsKICAgICAgaWYgKG9ialtwcm9wXSA9PT0gbnVsbCkgewogICAgICAgIGNbcHJvcF0gPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIGNbcHJvcF0gPSBvYmpbcHJvcF0gPT0gIkluZmluaXR5IiA/ICJJbmZpbml0eSIgOiBuZXcgRGF0ZShvYmpbcHJvcF0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjW3Byb3BdID0gb2JqW3Byb3BdOwogICAgfQogIH0KCiAgcmV0dXJuIGM7Cn0KCi8qIFNlY3Rpb24gNS40IHBhcnQgMjoKICogIiogIENvb2tpZXMgd2l0aCBsb25nZXIgcGF0aHMgYXJlIGxpc3RlZCBiZWZvcmUgY29va2llcyB3aXRoCiAqICAgICBzaG9ydGVyIHBhdGhzLgogKgogKiAgKiAgQW1vbmcgY29va2llcyB0aGF0IGhhdmUgZXF1YWwtbGVuZ3RoIHBhdGggZmllbGRzLCBjb29raWVzIHdpdGgKICogICAgIGVhcmxpZXIgY3JlYXRpb24tdGltZXMgYXJlIGxpc3RlZCBiZWZvcmUgY29va2llcyB3aXRoIGxhdGVyCiAqICAgICBjcmVhdGlvbi10aW1lcy4iCiAqLwoKZnVuY3Rpb24gY29va2llQ29tcGFyZShhLCBiKSB7CiAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzT2JqZWN0KGEpLCBhKTsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNPYmplY3QoYiksIGIpOwogIGxldCBjbXAgPSAwOwoKICAvLyBkZXNjZW5kaW5nIGZvciBsZW5ndGg6IGIgQ01QIGEKICBjb25zdCBhUGF0aExlbiA9IGEucGF0aCA/IGEucGF0aC5sZW5ndGggOiAwOwogIGNvbnN0IGJQYXRoTGVuID0gYi5wYXRoID8gYi5wYXRoLmxlbmd0aCA6IDA7CiAgY21wID0gYlBhdGhMZW4gLSBhUGF0aExlbjsKICBpZiAoY21wICE9PSAwKSB7CiAgICByZXR1cm4gY21wOwogIH0KCiAgLy8gYXNjZW5kaW5nIGZvciB0aW1lOiBhIENNUCBiCiAgY29uc3QgYVRpbWUgPSBhLmNyZWF0aW9uID8gYS5jcmVhdGlvbi5nZXRUaW1lKCkgOiBNQVhfVElNRTsKICBjb25zdCBiVGltZSA9IGIuY3JlYXRpb24gPyBiLmNyZWF0aW9uLmdldFRpbWUoKSA6IE1BWF9USU1FOwogIGNtcCA9IGFUaW1lIC0gYlRpbWU7CiAgaWYgKGNtcCAhPT0gMCkgewogICAgcmV0dXJuIGNtcDsKICB9CgogIC8vIGJyZWFrIHRpZXMgZm9yIHRoZSBzYW1lIG1pbGxpc2Vjb25kIChwcmVjaXNpb24gb2YgSmF2YVNjcmlwdCdzIGNsb2NrKQogIGNtcCA9IGEuY3JlYXRpb25JbmRleCAtIGIuY3JlYXRpb25JbmRleDsKCiAgcmV0dXJuIGNtcDsKfQoKZnVuY3Rpb24gZ2V0Q29va2llQ29udGV4dCh1cmwpIHsKICBpZiAodXJsIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICByZXR1cm4gdXJsOwogIH0KICAvLyBOT1RFOiBkZWNvZGVVUkkgd2lsbCB0aHJvdyBvbiBtYWxmb3JtZWQgVVJJcyAoc2VlIEdILTMyKS4KICAvLyBUaGVyZWZvcmUsIHdlIHdpbGwganVzdCBza2lwIGRlY29kaW5nIGZvciBzdWNoIFVSSXMuCiAgdHJ5IHsKICAgIHVybCA9IGRlY29kZVVSSSh1cmwpOwogIH0gY2F0Y2ggKGVycikgewogICAgLy8gU2lsZW50bHkgc3dhbGxvdyBlcnJvcgogIH0KCiAgcmV0dXJuIHVybFBhcnNlKHVybCk7Cn0KCmNvbnN0IGNvb2tpZURlZmF1bHRzID0gewogIC8vIHRoZSBvcmRlciBpbiB3aGljaCB0aGUgUkZDIGhhcyB0aGVtOgogIGtleTogIiIsCiAgdmFsdWU6ICIiLAogIGV4cGlyZXM6ICJJbmZpbml0eSIsCiAgbWF4QWdlOiBudWxsLAogIGRvbWFpbjogbnVsbCwKICBwYXRoOiBudWxsLAogIHNlY3VyZTogZmFsc2UsCiAgaHR0cE9ubHk6IGZhbHNlLAogIGV4dGVuc2lvbnM6IG51bGwsCiAgLy8gc2V0IGJ5IHRoZSBDb29raWVKYXI6CiAgaG9zdE9ubHk6IG51bGwsCiAgcGF0aElzRGVmYXVsdDogbnVsbCwKICBjcmVhdGlvbjogbnVsbCwKICBsYXN0QWNjZXNzZWQ6IG51bGwsCiAgc2FtZVNpdGU6IHVuZGVmaW5lZAp9OwoKY2xhc3MgQ29va2llIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgIGNvbnN0IGN1c3RvbUluc3BlY3RTeW1ib2wgPSBnZXRDdXN0b21JbnNwZWN0U3ltYm9sKCk7CiAgICBpZiAoY3VzdG9tSW5zcGVjdFN5bWJvbCkgewogICAgICB0aGlzW2N1c3RvbUluc3BlY3RTeW1ib2xdID0gdGhpcy5pbnNwZWN0OwogICAgfQoKICAgIE9iamVjdC5hc3NpZ24odGhpcywgY29va2llRGVmYXVsdHMsIG9wdGlvbnMpOwogICAgdGhpcy5jcmVhdGlvbiA9IHRoaXMuY3JlYXRpb24gfHwgbmV3IERhdGUoKTsKCiAgICAvLyB1c2VkIHRvIGJyZWFrIGNyZWF0aW9uIHRpZXMgaW4gY29va2llQ29tcGFyZSgpOgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJjcmVhdGlvbkluZGV4IiwgewogICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgLy8gaW1wb3J0YW50IGZvciBhc3NlcnQuZGVlcEVxdWFsIGNoZWNrcwogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6ICsrQ29va2llLmNvb2tpZXNDcmVhdGVkCiAgICB9KTsKICB9CgogIGluc3BlY3QoKSB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgY29uc3QgaG9zdE9ubHkgPSB0aGlzLmhvc3RPbmx5ICE9IG51bGwgPyB0aGlzLmhvc3RPbmx5IDogIj8iOwogICAgY29uc3QgY3JlYXRlQWdlID0gdGhpcy5jcmVhdGlvbgogICAgICA/IGAke25vdyAtIHRoaXMuY3JlYXRpb24uZ2V0VGltZSgpfW1zYAogICAgICA6ICI/IjsKICAgIGNvbnN0IGFjY2Vzc0FnZSA9IHRoaXMubGFzdEFjY2Vzc2VkCiAgICAgID8gYCR7bm93IC0gdGhpcy5sYXN0QWNjZXNzZWQuZ2V0VGltZSgpfW1zYAogICAgICA6ICI/IjsKICAgIHJldHVybiBgQ29va2llPSIke3RoaXMudG9TdHJpbmcoKX07IGhvc3RPbmx5PSR7aG9zdE9ubHl9OyBhQWdlPSR7YWNjZXNzQWdlfTsgY0FnZT0ke2NyZWF0ZUFnZX0iYDsKICB9CgogIHRvSlNPTigpIHsKICAgIGNvbnN0IG9iaiA9IHt9OwoKICAgIGZvciAoY29uc3QgcHJvcCBvZiBDb29raWUuc2VyaWFsaXphYmxlUHJvcGVydGllcykgewogICAgICBpZiAodGhpc1twcm9wXSA9PT0gY29va2llRGVmYXVsdHNbcHJvcF0pIHsKICAgICAgICBjb250aW51ZTsgLy8gbGVhdmUgYXMgcHJvdG90eXBlIGRlZmF1bHQKICAgICAgfQoKICAgICAgaWYgKAogICAgICAgIHByb3AgPT09ICJleHBpcmVzIiB8fAogICAgICAgIHByb3AgPT09ICJjcmVhdGlvbiIgfHwKICAgICAgICBwcm9wID09PSAibGFzdEFjY2Vzc2VkIgogICAgICApIHsKICAgICAgICBpZiAodGhpc1twcm9wXSA9PT0gbnVsbCkgewogICAgICAgICAgb2JqW3Byb3BdID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2JqW3Byb3BdID0KICAgICAgICAgICAgdGhpc1twcm9wXSA9PSAiSW5maW5pdHkiIC8vIGludGVudGlvbmFsbHkgbm90ID09PQogICAgICAgICAgICAgID8gIkluZmluaXR5IgogICAgICAgICAgICAgIDogdGhpc1twcm9wXS50b0lTT1N0cmluZygpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwcm9wID09PSAibWF4QWdlIikgewogICAgICAgIGlmICh0aGlzW3Byb3BdICE9PSBudWxsKSB7CiAgICAgICAgICAvLyBhZ2FpbiwgaW50ZW50aW9uYWxseSBub3QgPT09CiAgICAgICAgICBvYmpbcHJvcF0gPQogICAgICAgICAgICB0aGlzW3Byb3BdID09IEluZmluaXR5IHx8IHRoaXNbcHJvcF0gPT0gLUluZmluaXR5CiAgICAgICAgICAgICAgPyB0aGlzW3Byb3BdLnRvU3RyaW5nKCkKICAgICAgICAgICAgICA6IHRoaXNbcHJvcF07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzW3Byb3BdICE9PSBjb29raWVEZWZhdWx0c1twcm9wXSkgewogICAgICAgICAgb2JqW3Byb3BdID0gdGhpc1twcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH0KCiAgY2xvbmUoKSB7CiAgICByZXR1cm4gZnJvbUpTT04odGhpcy50b0pTT04oKSk7CiAgfQoKICB2YWxpZGF0ZSgpIHsKICAgIGlmICghQ09PS0lFX09DVEVUUy50ZXN0KHRoaXMudmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgKICAgICAgdGhpcy5leHBpcmVzICE9IEluZmluaXR5ICYmCiAgICAgICEodGhpcy5leHBpcmVzIGluc3RhbmNlb2YgRGF0ZSkgJiYKICAgICAgIXBhcnNlRGF0ZSh0aGlzLmV4cGlyZXMpCiAgICApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMubWF4QWdlICE9IG51bGwgJiYgdGhpcy5tYXhBZ2UgPD0gMCkgewogICAgICByZXR1cm4gZmFsc2U7IC8vICJNYXgtQWdlPSIgbm9uLXplcm8tZGlnaXQgKkRJR0lUCiAgICB9CiAgICBpZiAodGhpcy5wYXRoICE9IG51bGwgJiYgIVBBVEhfVkFMVUUudGVzdCh0aGlzLnBhdGgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBjb25zdCBjZG9tYWluID0gdGhpcy5jZG9tYWluKCk7CiAgICBpZiAoY2RvbWFpbikgewogICAgICBpZiAoY2RvbWFpbi5tYXRjaCgvXC4kLykpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFM0LjEuMi4zIHN1Z2dlc3RzIHRoYXQgdGhpcyBpcyBiYWQuIGRvbWFpbk1hdGNoKCkgdGVzdHMgY29uZmlybSB0aGlzCiAgICAgIH0KICAgICAgY29uc3Qgc3VmZml4ID0gcHVic3VmZml4LmdldFB1YmxpY1N1ZmZpeChjZG9tYWluKTsKICAgICAgaWYgKHN1ZmZpeCA9PSBudWxsKSB7CiAgICAgICAgLy8gaXQncyBhIHB1YmxpYyBzdWZmaXgKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgc2V0RXhwaXJlcyhleHApIHsKICAgIGlmIChleHAgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgIHRoaXMuZXhwaXJlcyA9IGV4cDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZXhwaXJlcyA9IHBhcnNlRGF0ZShleHApIHx8ICJJbmZpbml0eSI7CiAgICB9CiAgfQoKICBzZXRNYXhBZ2UoYWdlKSB7CiAgICBpZiAoYWdlID09PSBJbmZpbml0eSB8fCBhZ2UgPT09IC1JbmZpbml0eSkgewogICAgICB0aGlzLm1heEFnZSA9IGFnZS50b1N0cmluZygpOyAvLyBzbyBKU09OLnN0cmluZ2lmeSgpIHdvcmtzCiAgICB9IGVsc2UgewogICAgICB0aGlzLm1heEFnZSA9IGFnZTsKICAgIH0KICB9CgogIGNvb2tpZVN0cmluZygpIHsKICAgIGxldCB2YWwgPSB0aGlzLnZhbHVlOwogICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgIHZhbCA9ICIiOwogICAgfQogICAgaWYgKHRoaXMua2V5ID09PSAiIikgewogICAgICByZXR1cm4gdmFsOwogICAgfQogICAgcmV0dXJuIGAke3RoaXMua2V5fT0ke3ZhbH1gOwogIH0KCiAgLy8gZ2l2ZXMgU2V0LUNvb2tpZSBoZWFkZXIgZm9ybWF0CiAgdG9TdHJpbmcoKSB7CiAgICBsZXQgc3RyID0gdGhpcy5jb29raWVTdHJpbmcoKTsKCiAgICBpZiAodGhpcy5leHBpcmVzICE9IEluZmluaXR5KSB7CiAgICAgIGlmICh0aGlzLmV4cGlyZXMgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgc3RyICs9IGA7IEV4cGlyZXM9JHtmb3JtYXREYXRlKHRoaXMuZXhwaXJlcyl9YDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdHIgKz0gYDsgRXhwaXJlcz0ke3RoaXMuZXhwaXJlc31gOwogICAgICB9CiAgICB9CgogICAgaWYgKHRoaXMubWF4QWdlICE9IG51bGwgJiYgdGhpcy5tYXhBZ2UgIT0gSW5maW5pdHkpIHsKICAgICAgc3RyICs9IGA7IE1heC1BZ2U9JHt0aGlzLm1heEFnZX1gOwogICAgfQoKICAgIGlmICh0aGlzLmRvbWFpbiAmJiAhdGhpcy5ob3N0T25seSkgewogICAgICBzdHIgKz0gYDsgRG9tYWluPSR7dGhpcy5kb21haW59YDsKICAgIH0KICAgIGlmICh0aGlzLnBhdGgpIHsKICAgICAgc3RyICs9IGA7IFBhdGg9JHt0aGlzLnBhdGh9YDsKICAgIH0KCiAgICBpZiAodGhpcy5zZWN1cmUpIHsKICAgICAgc3RyICs9ICI7IFNlY3VyZSI7CiAgICB9CiAgICBpZiAodGhpcy5odHRwT25seSkgewogICAgICBzdHIgKz0gIjsgSHR0cE9ubHkiOwogICAgfQogICAgaWYgKHRoaXMuc2FtZVNpdGUgJiYgdGhpcy5zYW1lU2l0ZSAhPT0gIm5vbmUiKSB7CiAgICAgIGNvbnN0IHNzQ2Fub24gPSBDb29raWUuc2FtZVNpdGVDYW5vbmljYWxbdGhpcy5zYW1lU2l0ZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgc3RyICs9IGA7IFNhbWVTaXRlPSR7c3NDYW5vbiA/IHNzQ2Fub24gOiB0aGlzLnNhbWVTaXRlfWA7CiAgICB9CiAgICBpZiAodGhpcy5leHRlbnNpb25zKSB7CiAgICAgIHRoaXMuZXh0ZW5zaW9ucy5mb3JFYWNoKGV4dCA9PiB7CiAgICAgICAgc3RyICs9IGA7ICR7ZXh0fWA7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBzdHI7CiAgfQoKICAvLyBUVEwoKSBwYXJ0aWFsbHkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKQogIC8vIFM1LjMgc2F5cyB0byBnaXZlIHRoZSAibGF0ZXN0IHJlcHJlc2VudGFibGUgZGF0ZSIgZm9yIHdoaWNoIHdlIHVzZSBJbmZpbml0eQogIC8vIEZvciAiZXhwaXJlZCIgd2UgdXNlIDAKICBUVEwobm93KSB7CiAgICAvKiBSRkM2MjY1IFM0LjEuMi4yIElmIGEgY29va2llIGhhcyBib3RoIHRoZSBNYXgtQWdlIGFuZCB0aGUgRXhwaXJlcwogICAgICogYXR0cmlidXRlLCB0aGUgTWF4LUFnZSBhdHRyaWJ1dGUgaGFzIHByZWNlZGVuY2UgYW5kIGNvbnRyb2xzIHRoZQogICAgICogZXhwaXJhdGlvbiBkYXRlIG9mIHRoZSBjb29raWUuCiAgICAgKiAoQ29uY3VycyB3aXRoIFM1LjMgc3RlcCAzKQogICAgICovCiAgICBpZiAodGhpcy5tYXhBZ2UgIT0gbnVsbCkgewogICAgICByZXR1cm4gdGhpcy5tYXhBZ2UgPD0gMCA/IDAgOiB0aGlzLm1heEFnZSAqIDEwMDA7CiAgICB9CgogICAgbGV0IGV4cGlyZXMgPSB0aGlzLmV4cGlyZXM7CiAgICBpZiAoZXhwaXJlcyAhPSBJbmZpbml0eSkgewogICAgICBpZiAoIShleHBpcmVzIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgICAgICBleHBpcmVzID0gcGFyc2VEYXRlKGV4cGlyZXMpIHx8IEluZmluaXR5OwogICAgICB9CgogICAgICBpZiAoZXhwaXJlcyA9PSBJbmZpbml0eSkgewogICAgICAgIHJldHVybiBJbmZpbml0eTsKICAgICAgfQoKICAgICAgcmV0dXJuIGV4cGlyZXMuZ2V0VGltZSgpIC0gKG5vdyB8fCBEYXRlLm5vdygpKTsKICAgIH0KCiAgICByZXR1cm4gSW5maW5pdHk7CiAgfQoKICAvLyBleHBpcnlUaW1lKCkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKQogIGV4cGlyeVRpbWUobm93KSB7CiAgICBpZiAodGhpcy5tYXhBZ2UgIT0gbnVsbCkgewogICAgICBjb25zdCByZWxhdGl2ZVRvID0gbm93IHx8IHRoaXMuY3JlYXRpb24gfHwgbmV3IERhdGUoKTsKICAgICAgY29uc3QgYWdlID0gdGhpcy5tYXhBZ2UgPD0gMCA/IC1JbmZpbml0eSA6IHRoaXMubWF4QWdlICogMTAwMDsKICAgICAgcmV0dXJuIHJlbGF0aXZlVG8uZ2V0VGltZSgpICsgYWdlOwogICAgfQoKICAgIGlmICh0aGlzLmV4cGlyZXMgPT0gSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIEluZmluaXR5OwogICAgfQogICAgcmV0dXJuIHRoaXMuZXhwaXJlcy5nZXRUaW1lKCk7CiAgfQoKICAvLyBleHBpcnlEYXRlKCkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKSwgZXhjZXB0IGl0IHJldHVybnMgYSBEYXRlCiAgZXhwaXJ5RGF0ZShub3cpIHsKICAgIGNvbnN0IG1pbGxpc2VjID0gdGhpcy5leHBpcnlUaW1lKG5vdyk7CiAgICBpZiAobWlsbGlzZWMgPT0gSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKE1BWF9USU1FKTsKICAgIH0gZWxzZSBpZiAobWlsbGlzZWMgPT0gLUluZmluaXR5KSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShNSU5fVElNRSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IERhdGUobWlsbGlzZWMpOwogICAgfQogIH0KCiAgLy8gVGhpcyByZXBsYWNlcyB0aGUgInBlcnNpc3RlbnQtZmxhZyIgcGFydHMgb2YgUzUuMyBzdGVwIDMKICBpc1BlcnNpc3RlbnQoKSB7CiAgICByZXR1cm4gdGhpcy5tYXhBZ2UgIT0gbnVsbCB8fCB0aGlzLmV4cGlyZXMgIT0gSW5maW5pdHk7CiAgfQoKICAvLyBNb3N0bHkgUzUuMS4yIGFuZCBTNS4yLjM6CiAgY2Fub25pY2FsaXplZERvbWFpbigpIHsKICAgIGlmICh0aGlzLmRvbWFpbiA9PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIGNhbm9uaWNhbERvbWFpbih0aGlzLmRvbWFpbik7CiAgfQoKICBjZG9tYWluKCkgewogICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsaXplZERvbWFpbigpOwogIH0KfQoKQ29va2llLmNvb2tpZXNDcmVhdGVkID0gMDsKQ29va2llLnBhcnNlID0gcGFyc2UkSDsKQ29va2llLmZyb21KU09OID0gZnJvbUpTT047CkNvb2tpZS5zZXJpYWxpemFibGVQcm9wZXJ0aWVzID0gT2JqZWN0LmtleXMoY29va2llRGVmYXVsdHMpOwpDb29raWUuc2FtZVNpdGVMZXZlbCA9IHsKICBzdHJpY3Q6IDMsCiAgbGF4OiAyLAogIG5vbmU6IDEKfTsKCkNvb2tpZS5zYW1lU2l0ZUNhbm9uaWNhbCA9IHsKICBzdHJpY3Q6ICJTdHJpY3QiLAogIGxheDogIkxheCIKfTsKCmZ1bmN0aW9uIGdldE5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eShwcmVmaXhTZWN1cml0eSkgewogIGlmIChwcmVmaXhTZWN1cml0eSAhPSBudWxsKSB7CiAgICBjb25zdCBub3JtYWxpemVkUHJlZml4U2VjdXJpdHkgPSBwcmVmaXhTZWN1cml0eS50b0xvd2VyQ2FzZSgpOwogICAgLyogVGhlIHRocmVlIHN1cHBvcnRlZCBvcHRpb25zICovCiAgICBzd2l0Y2ggKG5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eSkgewogICAgICBjYXNlIFByZWZpeFNlY3VyaXR5RW51bS5TVFJJQ1Q6CiAgICAgIGNhc2UgUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDoKICAgICAgY2FzZSBQcmVmaXhTZWN1cml0eUVudW0uRElTQUJMRUQ6CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eTsKICAgIH0KICB9CiAgLyogRGVmYXVsdCBpcyBTSUxFTlQgKi8KICByZXR1cm4gUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDsKfQoKY2xhc3MgQ29va2llSmFyIHsKICBjb25zdHJ1Y3RvcihzdG9yZSwgb3B0aW9ucyA9IHsgcmVqZWN0UHVibGljU3VmZml4ZXM6IHRydWUgfSkgewogICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAiYm9vbGVhbiIpIHsKICAgICAgb3B0aW9ucyA9IHsgcmVqZWN0UHVibGljU3VmZml4ZXM6IG9wdGlvbnMgfTsKICAgIH0KICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChvcHRpb25zKSwgb3B0aW9ucyk7CiAgICB0aGlzLnJlamVjdFB1YmxpY1N1ZmZpeGVzID0gb3B0aW9ucy5yZWplY3RQdWJsaWNTdWZmaXhlczsKICAgIHRoaXMuZW5hYmxlTG9vc2VNb2RlID0gISFvcHRpb25zLmxvb3NlTW9kZTsKICAgIHRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluID0KICAgICAgdHlwZW9mIG9wdGlvbnMuYWxsb3dTcGVjaWFsVXNlRG9tYWluID09PSAiYm9vbGVhbiIKICAgICAgICA/IG9wdGlvbnMuYWxsb3dTcGVjaWFsVXNlRG9tYWluCiAgICAgICAgOiB0cnVlOwogICAgdGhpcy5zdG9yZSA9IHN0b3JlIHx8IG5ldyBNZW1vcnlDb29raWVTdG9yZSgpOwogICAgdGhpcy5wcmVmaXhTZWN1cml0eSA9IGdldE5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eShvcHRpb25zLnByZWZpeFNlY3VyaXR5KTsKICAgIHRoaXMuX2Nsb25lU3luYyA9IHN5bmNXcmFwKCJjbG9uZSIpOwogICAgdGhpcy5faW1wb3J0Q29va2llc1N5bmMgPSBzeW5jV3JhcCgiX2ltcG9ydENvb2tpZXMiKTsKICAgIHRoaXMuZ2V0Q29va2llc1N5bmMgPSBzeW5jV3JhcCgiZ2V0Q29va2llcyIpOwogICAgdGhpcy5nZXRDb29raWVTdHJpbmdTeW5jID0gc3luY1dyYXAoImdldENvb2tpZVN0cmluZyIpOwogICAgdGhpcy5nZXRTZXRDb29raWVTdHJpbmdzU3luYyA9IHN5bmNXcmFwKCJnZXRTZXRDb29raWVTdHJpbmdzIik7CiAgICB0aGlzLnJlbW92ZUFsbENvb2tpZXNTeW5jID0gc3luY1dyYXAoInJlbW92ZUFsbENvb2tpZXMiKTsKICAgIHRoaXMuc2V0Q29va2llU3luYyA9IHN5bmNXcmFwKCJzZXRDb29raWUiKTsKICAgIHRoaXMuc2VyaWFsaXplU3luYyA9IHN5bmNXcmFwKCJzZXJpYWxpemUiKTsKICB9CgogIHNldENvb2tpZShjb29raWUsIHVybCwgb3B0aW9ucywgY2IpIHsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc05vbkVtcHR5U3RyaW5nKHVybCksIGNiLCBvcHRpb25zKTsKICAgIGxldCBlcnI7CgogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbih1cmwpKSB7CiAgICAgIGNiID0gdXJsOwogICAgICByZXR1cm4gY2IobmV3IEVycm9yKCJObyBVUkwgd2FzIHNwZWNpZmllZCIpKTsKICAgIH0KCiAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29va2llQ29udGV4dCh1cmwpOwogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICBjYiA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KCiAgICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihjYiksIGNiKTsKCiAgICBpZiAoCiAgICAgICF2YWxpZGF0b3JzLmlzTm9uRW1wdHlTdHJpbmcoY29va2llKSAmJgogICAgICAhdmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpICYmCiAgICAgIGNvb2tpZSBpbnN0YW5jZW9mIFN0cmluZyAmJgogICAgICBjb29raWUubGVuZ3RoID09IDAKICAgICkgewogICAgICByZXR1cm4gY2IobnVsbCk7CiAgICB9CgogICAgY29uc3QgaG9zdCA9IGNhbm9uaWNhbERvbWFpbihjb250ZXh0Lmhvc3RuYW1lKTsKICAgIGNvbnN0IGxvb3NlID0gb3B0aW9ucy5sb29zZSB8fCB0aGlzLmVuYWJsZUxvb3NlTW9kZTsKCiAgICBsZXQgc2FtZVNpdGVDb250ZXh0ID0gbnVsbDsKICAgIGlmIChvcHRpb25zLnNhbWVTaXRlQ29udGV4dCkgewogICAgICBzYW1lU2l0ZUNvbnRleHQgPSBjaGVja1NhbWVTaXRlQ29udGV4dChvcHRpb25zLnNhbWVTaXRlQ29udGV4dCk7CiAgICAgIGlmICghc2FtZVNpdGVDb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIGNiKG5ldyBFcnJvcihTQU1FX1NJVEVfQ09OVEVYVF9WQUxfRVJSKSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgMQogICAgaWYgKHR5cGVvZiBjb29raWUgPT09ICJzdHJpbmciIHx8IGNvb2tpZSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICBjb29raWUgPSBDb29raWUucGFyc2UoY29va2llLCB7IGxvb3NlOiBsb29zZSB9KTsKICAgICAgaWYgKCFjb29raWUpIHsKICAgICAgICBlcnIgPSBuZXcgRXJyb3IoIkNvb2tpZSBmYWlsZWQgdG8gcGFyc2UiKTsKICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEoY29va2llIGluc3RhbmNlb2YgQ29va2llKSkgewogICAgICAvLyBJZiB5b3UncmUgc2VlaW5nIHRoaXMgZXJyb3IsIGFuZCBhcmUgcGFzc2luZyBpbiBhIENvb2tpZSBvYmplY3QsCiAgICAgIC8vIGl0ICptaWdodCogYmUgYSBDb29raWUgb2JqZWN0IGZyb20gYW5vdGhlciBsb2FkZWQgdmVyc2lvbiBvZiB0b3VnaC1jb29raWUuCiAgICAgIGVyciA9IG5ldyBFcnJvcigKICAgICAgICAiRmlyc3QgYXJndW1lbnQgdG8gc2V0Q29va2llIG11c3QgYmUgYSBDb29raWUgb2JqZWN0IG9yIHN0cmluZyIKICAgICAgKTsKICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgMgogICAgY29uc3Qgbm93ID0gb3B0aW9ucy5ub3cgfHwgbmV3IERhdGUoKTsgLy8gd2lsbCBhc3NpZ24gbGF0ZXIgdG8gc2F2ZSBlZmZvcnQgaW4gdGhlIGZhY2Ugb2YgZXJyb3JzCgogICAgLy8gUzUuMyBzdGVwIDM6IE5PT1A7IHBlcnNpc3RlbnQtZmxhZyBhbmQgZXhwaXJ5LXRpbWUgaXMgaGFuZGxlZCBieSBnZXRDb29raWUoKQoKICAgIC8vIFM1LjMgc3RlcCA0OiBOT09QOyBkb21haW4gaXMgbnVsbCBieSBkZWZhdWx0CgogICAgLy8gUzUuMyBzdGVwIDU6IHB1YmxpYyBzdWZmaXhlcwogICAgaWYgKHRoaXMucmVqZWN0UHVibGljU3VmZml4ZXMgJiYgY29va2llLmRvbWFpbikgewogICAgICBjb25zdCBzdWZmaXggPSBwdWJzdWZmaXguZ2V0UHVibGljU3VmZml4KGNvb2tpZS5jZG9tYWluKCksIHsKICAgICAgICBhbGxvd1NwZWNpYWxVc2VEb21haW46IHRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluLAogICAgICAgIGlnbm9yZUVycm9yOiBvcHRpb25zLmlnbm9yZUVycm9yCiAgICAgIH0pOwogICAgICBpZiAoc3VmZml4ID09IG51bGwgJiYgIUlQX1Y2X1JFR0VYX09CSkVDVC50ZXN0KGNvb2tpZS5kb21haW4pKSB7CiAgICAgICAgLy8gZS5nLiAiY29tIgogICAgICAgIGVyciA9IG5ldyBFcnJvcigiQ29va2llIGhhcyBkb21haW4gc2V0IHRvIGEgcHVibGljIHN1ZmZpeCIpOwogICAgICAgIHJldHVybiBjYihvcHRpb25zLmlnbm9yZUVycm9yID8gbnVsbCA6IGVycik7CiAgICAgIH0KICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgNjoKICAgIGlmIChjb29raWUuZG9tYWluKSB7CiAgICAgIGlmICghZG9tYWluTWF0Y2goaG9zdCwgY29va2llLmNkb21haW4oKSwgZmFsc2UpKSB7CiAgICAgICAgZXJyID0gbmV3IEVycm9yKAogICAgICAgICAgYENvb2tpZSBub3QgaW4gdGhpcyBob3N0J3MgZG9tYWluLiBDb29raWU6JHtjb29raWUuY2RvbWFpbigpfSBSZXF1ZXN0OiR7aG9zdH1gCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICB9CgogICAgICBpZiAoY29va2llLmhvc3RPbmx5ID09IG51bGwpIHsKICAgICAgICAvLyBkb24ndCByZXNldCBpZiBhbHJlYWR5IHNldAogICAgICAgIGNvb2tpZS5ob3N0T25seSA9IGZhbHNlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb29raWUuaG9zdE9ubHkgPSB0cnVlOwogICAgICBjb29raWUuZG9tYWluID0gaG9zdDsKICAgIH0KCiAgICAvL1M1LjIuNCBJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlCiAgICAvL2F0dHJpYnV0ZS12YWx1ZSBpcyBub3QgJXgyRiAoIi8iKToKICAgIC8vTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBkZWZhdWx0LXBhdGguCiAgICBpZiAoIWNvb2tpZS5wYXRoIHx8IGNvb2tpZS5wYXRoWzBdICE9PSAiLyIpIHsKICAgICAgY29va2llLnBhdGggPSBkZWZhdWx0UGF0aChjb250ZXh0LnBhdGhuYW1lKTsKICAgICAgY29va2llLnBhdGhJc0RlZmF1bHQgPSB0cnVlOwogICAgfQoKICAgIC8vIFM1LjMgc3RlcCA4OiBOT09QOyBzZWN1cmUgYXR0cmlidXRlCiAgICAvLyBTNS4zIHN0ZXAgOTogTk9PUDsgaHR0cE9ubHkgYXR0cmlidXRlCgogICAgLy8gUzUuMyBzdGVwIDEwCiAgICBpZiAob3B0aW9ucy5odHRwID09PSBmYWxzZSAmJiBjb29raWUuaHR0cE9ubHkpIHsKICAgICAgZXJyID0gbmV3IEVycm9yKCJDb29raWUgaXMgSHR0cE9ubHkgYW5kIHRoaXMgaXNuJ3QgYW4gSFRUUCBBUEkiKTsKICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgIH0KCiAgICAvLyA2MjUyYmlzLTAyIFM1LjQgU3RlcCAxMyAmIDE0OgogICAgaWYgKAogICAgICBjb29raWUuc2FtZVNpdGUgIT09ICJub25lIiAmJgogICAgICBjb29raWUuc2FtZVNpdGUgIT09IHVuZGVmaW5lZCAmJgogICAgICBzYW1lU2l0ZUNvbnRleHQKICAgICkgewogICAgICAvLyAiSWYgdGhlIGNvb2tpZSdzICJzYW1lLXNpdGUtZmxhZyIgaXMgbm90ICJOb25lIiwgYW5kIHRoZSBjb29raWUKICAgICAgLy8gIGlzIGJlaW5nIHNldCBmcm9tIGEgY29udGV4dCB3aG9zZSAic2l0ZSBmb3IgY29va2llcyIgaXMgbm90IGFuCiAgICAgIC8vICBleGFjdCBtYXRjaCBmb3IgcmVxdWVzdC11cmkncyBob3N0J3MgcmVnaXN0ZXJlZCBkb21haW4sIHRoZW4KICAgICAgLy8gIGFib3J0IHRoZXNlIHN0ZXBzIGFuZCBpZ25vcmUgdGhlIG5ld2x5IGNyZWF0ZWQgY29va2llIGVudGlyZWx5LiIKICAgICAgaWYgKHNhbWVTaXRlQ29udGV4dCA9PT0gIm5vbmUiKSB7CiAgICAgICAgZXJyID0gbmV3IEVycm9yKAogICAgICAgICAgIkNvb2tpZSBpcyBTYW1lU2l0ZSBidXQgdGhpcyBpcyBhIGNyb3NzLW9yaWdpbiByZXF1ZXN0IgogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgICAgfQogICAgfQoKICAgIC8qIDYyNjViaXMtMDIgUzUuNCBTdGVwcyAxNSAmIDE2ICovCiAgICBjb25zdCBpZ25vcmVFcnJvckZvclByZWZpeFNlY3VyaXR5ID0KICAgICAgdGhpcy5wcmVmaXhTZWN1cml0eSA9PT0gUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDsKICAgIGNvbnN0IHByZWZpeFNlY3VyaXR5RGlzYWJsZWQgPQogICAgICB0aGlzLnByZWZpeFNlY3VyaXR5ID09PSBQcmVmaXhTZWN1cml0eUVudW0uRElTQUJMRUQ7CiAgICAvKiBJZiBwcmVmaXggY2hlY2tpbmcgaXMgbm90IGRpc2FibGVkIC4uLiovCiAgICBpZiAoIXByZWZpeFNlY3VyaXR5RGlzYWJsZWQpIHsKICAgICAgbGV0IGVycm9yRm91bmQgPSBmYWxzZTsKICAgICAgbGV0IGVycm9yTXNnOwogICAgICAvKiBDaGVjayBzZWN1cmUgcHJlZml4IGNvbmRpdGlvbiAqLwogICAgICBpZiAoIWlzU2VjdXJlUHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkpIHsKICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgICBlcnJvck1zZyA9ICJDb29raWUgaGFzIF9fU2VjdXJlIHByZWZpeCBidXQgU2VjdXJlIGF0dHJpYnV0ZSBpcyBub3Qgc2V0IjsKICAgICAgfSBlbHNlIGlmICghaXNIb3N0UHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkpIHsKICAgICAgICAvKiBDaGVjayBob3N0IHByZWZpeCBjb25kaXRpb24gKi8KICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgICBlcnJvck1zZyA9CiAgICAgICAgICAiQ29va2llIGhhcyBfX0hvc3QgcHJlZml4IGJ1dCBlaXRoZXIgU2VjdXJlIG9yIEhvc3RPbmx5IGF0dHJpYnV0ZSBpcyBub3Qgc2V0IG9yIFBhdGggaXMgbm90ICcvJyI7CiAgICAgIH0KICAgICAgaWYgKGVycm9yRm91bmQpIHsKICAgICAgICByZXR1cm4gY2IoCiAgICAgICAgICBvcHRpb25zLmlnbm9yZUVycm9yIHx8IGlnbm9yZUVycm9yRm9yUHJlZml4U2VjdXJpdHkKICAgICAgICAgICAgPyBudWxsCiAgICAgICAgICAgIDogbmV3IEVycm9yKGVycm9yTXNnKQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgaWYgKCFzdG9yZS51cGRhdGVDb29raWUpIHsKICAgICAgc3RvcmUudXBkYXRlQ29va2llID0gZnVuY3Rpb24ob2xkQ29va2llLCBuZXdDb29raWUsIGNiKSB7CiAgICAgICAgdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aENvb2tpZShlcnIsIG9sZENvb2tpZSkgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5leHQgPSBmdW5jdGlvbihlcnIpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2IobnVsbCwgY29va2llKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAob2xkQ29va2llKSB7CiAgICAgICAgLy8gUzUuMyBzdGVwIDExIC0gIklmIHRoZSBjb29raWUgc3RvcmUgY29udGFpbnMgYSBjb29raWUgd2l0aCB0aGUgc2FtZSBuYW1lLAogICAgICAgIC8vIGRvbWFpbiwgYW5kIHBhdGggYXMgdGhlIG5ld2x5IGNyZWF0ZWQgY29va2llOiIKICAgICAgICBpZiAob3B0aW9ucy5odHRwID09PSBmYWxzZSAmJiBvbGRDb29raWUuaHR0cE9ubHkpIHsKICAgICAgICAgIC8vIHN0ZXAgMTEuMgogICAgICAgICAgZXJyID0gbmV3IEVycm9yKCJvbGQgQ29va2llIGlzIEh0dHBPbmx5IGFuZCB0aGlzIGlzbid0IGFuIEhUVFAgQVBJIik7CiAgICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICAgIH0KICAgICAgICBjb29raWUuY3JlYXRpb24gPSBvbGRDb29raWUuY3JlYXRpb247IC8vIHN0ZXAgMTEuMwogICAgICAgIGNvb2tpZS5jcmVhdGlvbkluZGV4ID0gb2xkQ29va2llLmNyZWF0aW9uSW5kZXg7IC8vIHByZXNlcnZlIHRpZS1icmVha2VyCiAgICAgICAgY29va2llLmxhc3RBY2Nlc3NlZCA9IG5vdzsKICAgICAgICAvLyBTdGVwIDExLjQgKGRlbGV0ZSBjb29raWUpIGlzIGltcGxpZWQgYnkganVzdCBzZXR0aW5nIHRoZSBuZXcgb25lOgogICAgICAgIHN0b3JlLnVwZGF0ZUNvb2tpZShvbGRDb29raWUsIGNvb2tpZSwgbmV4dCk7IC8vIHN0ZXAgMTIKICAgICAgfSBlbHNlIHsKICAgICAgICBjb29raWUuY3JlYXRpb24gPSBjb29raWUubGFzdEFjY2Vzc2VkID0gbm93OwogICAgICAgIHN0b3JlLnB1dENvb2tpZShjb29raWUsIG5leHQpOyAvLyBzdGVwIDEyCiAgICAgIH0KICAgIH0KCiAgICBzdG9yZS5maW5kQ29va2llKGNvb2tpZS5kb21haW4sIGNvb2tpZS5wYXRoLCBjb29raWUua2V5LCB3aXRoQ29va2llKTsKICB9CgogIC8vIFJGQzYzNjUgUzUuNAogIGdldENvb2tpZXModXJsLCBvcHRpb25zLCBjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzTm9uRW1wdHlTdHJpbmcodXJsKSwgY2IsIHVybCk7CiAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29va2llQ29udGV4dCh1cmwpOwogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICBjYiA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChvcHRpb25zKSwgY2IsIG9wdGlvbnMpOwogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CgogICAgY29uc3QgaG9zdCA9IGNhbm9uaWNhbERvbWFpbihjb250ZXh0Lmhvc3RuYW1lKTsKICAgIGNvbnN0IHBhdGggPSBjb250ZXh0LnBhdGhuYW1lIHx8ICIvIjsKCiAgICBsZXQgc2VjdXJlID0gb3B0aW9ucy5zZWN1cmU7CiAgICBpZiAoCiAgICAgIHNlY3VyZSA9PSBudWxsICYmCiAgICAgIGNvbnRleHQucHJvdG9jb2wgJiYKICAgICAgKGNvbnRleHQucHJvdG9jb2wgPT0gImh0dHBzOiIgfHwgY29udGV4dC5wcm90b2NvbCA9PSAid3NzOiIpCiAgICApIHsKICAgICAgc2VjdXJlID0gdHJ1ZTsKICAgIH0KCiAgICBsZXQgc2FtZVNpdGVMZXZlbCA9IDA7CiAgICBpZiAob3B0aW9ucy5zYW1lU2l0ZUNvbnRleHQpIHsKICAgICAgY29uc3Qgc2FtZVNpdGVDb250ZXh0ID0gY2hlY2tTYW1lU2l0ZUNvbnRleHQob3B0aW9ucy5zYW1lU2l0ZUNvbnRleHQpOwogICAgICBzYW1lU2l0ZUxldmVsID0gQ29va2llLnNhbWVTaXRlTGV2ZWxbc2FtZVNpdGVDb250ZXh0XTsKICAgICAgaWYgKCFzYW1lU2l0ZUxldmVsKSB7CiAgICAgICAgcmV0dXJuIGNiKG5ldyBFcnJvcihTQU1FX1NJVEVfQ09OVEVYVF9WQUxfRVJSKSk7CiAgICAgIH0KICAgIH0KCiAgICBsZXQgaHR0cCA9IG9wdGlvbnMuaHR0cDsKICAgIGlmIChodHRwID09IG51bGwpIHsKICAgICAgaHR0cCA9IHRydWU7CiAgICB9CgogICAgY29uc3Qgbm93ID0gb3B0aW9ucy5ub3cgfHwgRGF0ZS5ub3coKTsKICAgIGNvbnN0IGV4cGlyZUNoZWNrID0gb3B0aW9ucy5leHBpcmUgIT09IGZhbHNlOwogICAgY29uc3QgYWxsUGF0aHMgPSAhIW9wdGlvbnMuYWxsUGF0aHM7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgZnVuY3Rpb24gbWF0Y2hpbmdDb29raWUoYykgewogICAgICAvLyAiRWl0aGVyOgogICAgICAvLyAgIFRoZSBjb29raWUncyBob3N0LW9ubHktZmxhZyBpcyB0cnVlIGFuZCB0aGUgY2Fub25pY2FsaXplZAogICAgICAvLyAgIHJlcXVlc3QtaG9zdCBpcyBpZGVudGljYWwgdG8gdGhlIGNvb2tpZSdzIGRvbWFpbi4KICAgICAgLy8gT3I6CiAgICAgIC8vICAgVGhlIGNvb2tpZSdzIGhvc3Qtb25seS1mbGFnIGlzIGZhbHNlIGFuZCB0aGUgY2Fub25pY2FsaXplZAogICAgICAvLyAgIHJlcXVlc3QtaG9zdCBkb21haW4tbWF0Y2hlcyB0aGUgY29va2llJ3MgZG9tYWluLiIKICAgICAgaWYgKGMuaG9zdE9ubHkpIHsKICAgICAgICBpZiAoYy5kb21haW4gIT0gaG9zdCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIWRvbWFpbk1hdGNoKGhvc3QsIGMuZG9tYWluLCBmYWxzZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vICJUaGUgcmVxdWVzdC11cmkncyBwYXRoIHBhdGgtbWF0Y2hlcyB0aGUgY29va2llJ3MgcGF0aC4iCiAgICAgIGlmICghYWxsUGF0aHMgJiYgIXBhdGhNYXRjaChwYXRoLCBjLnBhdGgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyAiSWYgdGhlIGNvb2tpZSdzIHNlY3VyZS1vbmx5LWZsYWcgaXMgdHJ1ZSwgdGhlbiB0aGUgcmVxdWVzdC11cmkncwogICAgICAvLyBzY2hlbWUgbXVzdCBkZW5vdGUgYSAic2VjdXJlIiBwcm90b2NvbCIKICAgICAgaWYgKGMuc2VjdXJlICYmICFzZWN1cmUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vICJJZiB0aGUgY29va2llJ3MgaHR0cC1vbmx5LWZsYWcgaXMgdHJ1ZSwgdGhlbiBleGNsdWRlIHRoZSBjb29raWUgaWYgdGhlCiAgICAgIC8vIGNvb2tpZS1zdHJpbmcgaXMgYmVpbmcgZ2VuZXJhdGVkIGZvciBhICJub24tSFRUUCIgQVBJIgogICAgICBpZiAoYy5odHRwT25seSAmJiAhaHR0cCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gUkZDNjI2NWJpcy0wMiBTNS4zLjcKICAgICAgaWYgKHNhbWVTaXRlTGV2ZWwpIHsKICAgICAgICBjb25zdCBjb29raWVMZXZlbCA9IENvb2tpZS5zYW1lU2l0ZUxldmVsW2Muc2FtZVNpdGUgfHwgIm5vbmUiXTsKICAgICAgICBpZiAoY29va2llTGV2ZWwgPiBzYW1lU2l0ZUxldmVsKSB7CiAgICAgICAgICAvLyBvbmx5IGFsbG93IGNvb2tpZXMgYXQgb3IgYmVsb3cgdGhlIHJlcXVlc3QgbGV2ZWwKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGRlZmVycmVkIGZyb20gUzUuMwogICAgICAvLyBub24tUkZDOiBhbGxvdyByZXRlbnRpb24gb2YgZXhwaXJlZCBjb29raWVzIGJ5IGNob2ljZQogICAgICBpZiAoZXhwaXJlQ2hlY2sgJiYgYy5leHBpcnlUaW1lKCkgPD0gbm93KSB7CiAgICAgICAgc3RvcmUucmVtb3ZlQ29va2llKGMuZG9tYWluLCBjLnBhdGgsIGMua2V5LCAoKSA9PiB7fSk7IC8vIHJlc3VsdCBpZ25vcmVkCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBzdG9yZS5maW5kQ29va2llcygKICAgICAgaG9zdCwKICAgICAgYWxsUGF0aHMgPyBudWxsIDogcGF0aCwKICAgICAgdGhpcy5hbGxvd1NwZWNpYWxVc2VEb21haW4sCiAgICAgIChlcnIsIGNvb2tpZXMpID0+IHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICB9CgogICAgICAgIGNvb2tpZXMgPSBjb29raWVzLmZpbHRlcihtYXRjaGluZ0Nvb2tpZSk7CgogICAgICAgIC8vIHNvcnRpbmcgb2YgUzUuNCBwYXJ0IDIKICAgICAgICBpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkgewogICAgICAgICAgY29va2llcyA9IGNvb2tpZXMuc29ydChjb29raWVDb21wYXJlKTsKICAgICAgICB9CgogICAgICAgIC8vIFM1LjQgcGFydCAzCiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICBmb3IgKGNvbnN0IGNvb2tpZSBvZiBjb29raWVzKSB7CiAgICAgICAgICBjb29raWUubGFzdEFjY2Vzc2VkID0gbm93OwogICAgICAgIH0KICAgICAgICAvLyBUT0RPIHBlcnNpc3QgbGFzdEFjY2Vzc2VkCgogICAgICAgIGNiKG51bGwsIGNvb2tpZXMpOwogICAgICB9CiAgICApOwogIH0KCiAgZ2V0Q29va2llU3RyaW5nKC4uLmFyZ3MpIHsKICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0Z1bmN0aW9uKGNiKSwgY2IpOwogICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uKGVyciwgY29va2llcykgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY2IoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYigKICAgICAgICAgIG51bGwsCiAgICAgICAgICBjb29raWVzCiAgICAgICAgICAgIC5zb3J0KGNvb2tpZUNvbXBhcmUpCiAgICAgICAgICAgIC5tYXAoYyA9PiBjLmNvb2tpZVN0cmluZygpKQogICAgICAgICAgICAuam9pbigiOyAiKQogICAgICAgICk7CiAgICAgIH0KICAgIH07CiAgICBhcmdzLnB1c2gobmV4dCk7CiAgICB0aGlzLmdldENvb2tpZXMuYXBwbHkodGhpcywgYXJncyk7CiAgfQoKICBnZXRTZXRDb29raWVTdHJpbmdzKC4uLmFyZ3MpIHsKICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0Z1bmN0aW9uKGNiKSwgY2IpOwogICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uKGVyciwgY29va2llcykgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY2IoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYigKICAgICAgICAgIG51bGwsCiAgICAgICAgICBjb29raWVzLm1hcChjID0+IHsKICAgICAgICAgICAgcmV0dXJuIGMudG9TdHJpbmcoKTsKICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgICAgfQogICAgfTsKICAgIGFyZ3MucHVzaChuZXh0KTsKICAgIHRoaXMuZ2V0Q29va2llcy5hcHBseSh0aGlzLCBhcmdzKTsKICB9CgogIHNlcmlhbGl6ZShjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CiAgICBsZXQgdHlwZSA9IHRoaXMuc3RvcmUuY29uc3RydWN0b3IubmFtZTsKICAgIGlmICh2YWxpZGF0b3JzLmlzT2JqZWN0KHR5cGUpKSB7CiAgICAgIHR5cGUgPSBudWxsOwogICAgfQoKICAgIC8vIHVwZGF0ZSBSRUFETUUubWQgIlNlcmlhbGl6YXRpb24gRm9ybWF0IiBpZiB5b3UgY2hhbmdlIHRoaXMsIHBsZWFzZSEKICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSB7CiAgICAgIC8vIFRoZSB2ZXJzaW9uIG9mIHRvdWdoLWNvb2tpZSB0aGF0IHNlcmlhbGl6ZWQgdGhpcyBqYXIuIEdlbmVyYWxseSBhIGdvb2QKICAgICAgLy8gcHJhY3RpY2Ugc2luY2UgZnV0dXJlIHZlcnNpb25zIGNhbiBtYWtlIGRhdGEgaW1wb3J0IGRlY2lzaW9ucyBiYXNlZCBvbgogICAgICAvLyBrbm93biBwYXN0IGJlaGF2aW9yLiBXaGVuL2lmIHRoaXMgbWF0dGVycywgdXNlIGBzZW12ZXJgLgogICAgICB2ZXJzaW9uOiBgdG91Z2gtY29va2llQCR7VkVSU0lPTn1gLAoKICAgICAgLy8gYWRkIHRoZSBzdG9yZSB0eXBlLCB0byBtYWtlIGh1bWFucyBoYXBweToKICAgICAgc3RvcmVUeXBlOiB0eXBlLAoKICAgICAgLy8gQ29va2llSmFyIGNvbmZpZ3VyYXRpb246CiAgICAgIHJlamVjdFB1YmxpY1N1ZmZpeGVzOiAhIXRoaXMucmVqZWN0UHVibGljU3VmZml4ZXMsCiAgICAgIGVuYWJsZUxvb3NlTW9kZTogISF0aGlzLmVuYWJsZUxvb3NlTW9kZSwKICAgICAgYWxsb3dTcGVjaWFsVXNlRG9tYWluOiAhIXRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluLAogICAgICBwcmVmaXhTZWN1cml0eTogZ2V0Tm9ybWFsaXplZFByZWZpeFNlY3VyaXR5KHRoaXMucHJlZml4U2VjdXJpdHkpLAoKICAgICAgLy8gdGhpcyBnZXRzIGZpbGxlZCBmcm9tIGdldEFsbENvb2tpZXM6CiAgICAgIGNvb2tpZXM6IFtdCiAgICB9OwoKICAgIGlmICgKICAgICAgISgKICAgICAgICB0aGlzLnN0b3JlLmdldEFsbENvb2tpZXMgJiYKICAgICAgICB0eXBlb2YgdGhpcy5zdG9yZS5nZXRBbGxDb29raWVzID09PSAiZnVuY3Rpb24iCiAgICAgICkKICAgICkgewogICAgICByZXR1cm4gY2IoCiAgICAgICAgbmV3IEVycm9yKAogICAgICAgICAgInN0b3JlIGRvZXMgbm90IHN1cHBvcnQgZ2V0QWxsQ29va2llcyBhbmQgY2Fubm90IGJlIHNlcmlhbGl6ZWQiCiAgICAgICAgKQogICAgICApOwogICAgfQoKICAgIHRoaXMuc3RvcmUuZ2V0QWxsQ29va2llcygoZXJyLCBjb29raWVzKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgc2VyaWFsaXplZC5jb29raWVzID0gY29va2llcy5tYXAoY29va2llID0+IHsKICAgICAgICAvLyBjb252ZXJ0IHRvIHNlcmlhbGl6ZWQgJ3JhdycgY29va2llcwogICAgICAgIGNvb2tpZSA9IGNvb2tpZSBpbnN0YW5jZW9mIENvb2tpZSA/IGNvb2tpZS50b0pTT04oKSA6IGNvb2tpZTsKCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBpbmRleCBzbyBuZXcgb25lcyBnZXQgYXNzaWduZWQgZHVyaW5nIGRlc2VyaWFsaXphdGlvbgogICAgICAgIGRlbGV0ZSBjb29raWUuY3JlYXRpb25JbmRleDsKCiAgICAgICAgcmV0dXJuIGNvb2tpZTsKICAgICAgfSk7CgogICAgICByZXR1cm4gY2IobnVsbCwgc2VyaWFsaXplZCk7CiAgICB9KTsKICB9CgogIHRvSlNPTigpIHsKICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZVN5bmMoKTsKICB9CgogIC8vIHVzZSB0aGUgY2xhc3MgbWV0aG9kIENvb2tpZUphci5kZXNlcmlhbGl6ZSBpbnN0ZWFkIG9mIGNhbGxpbmcgdGhpcyBkaXJlY3RseQogIF9pbXBvcnRDb29raWVzKHNlcmlhbGl6ZWQsIGNiKSB7CiAgICBsZXQgY29va2llcyA9IHNlcmlhbGl6ZWQuY29va2llczsKICAgIGlmICghY29va2llcyB8fCAhQXJyYXkuaXNBcnJheShjb29raWVzKSkgewogICAgICByZXR1cm4gY2IobmV3IEVycm9yKCJzZXJpYWxpemVkIGphciBoYXMgbm8gY29va2llcyBhcnJheSIpKTsKICAgIH0KICAgIGNvb2tpZXMgPSBjb29raWVzLnNsaWNlKCk7IC8vIGRvIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsCgogICAgY29uc3QgcHV0TmV4dCA9IGVyciA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgaWYgKCFjb29raWVzLmxlbmd0aCkgewogICAgICAgIHJldHVybiBjYihlcnIsIHRoaXMpOwogICAgICB9CgogICAgICBsZXQgY29va2llOwogICAgICB0cnkgewogICAgICAgIGNvb2tpZSA9IGZyb21KU09OKGNvb2tpZXMuc2hpZnQoKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gY2IoZSk7CiAgICAgIH0KCiAgICAgIGlmIChjb29raWUgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gcHV0TmV4dChudWxsKTsgLy8gc2tpcCB0aGlzIGNvb2tpZQogICAgICB9CgogICAgICB0aGlzLnN0b3JlLnB1dENvb2tpZShjb29raWUsIHB1dE5leHQpOwogICAgfTsKCiAgICBwdXROZXh0KCk7CiAgfQoKICBjbG9uZShuZXdTdG9yZSwgY2IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIGNiID0gbmV3U3RvcmU7CiAgICAgIG5ld1N0b3JlID0gbnVsbDsKICAgIH0KCiAgICB0aGlzLnNlcmlhbGl6ZSgoZXJyLCBzZXJpYWxpemVkKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQogICAgICBDb29raWVKYXIuZGVzZXJpYWxpemUoc2VyaWFsaXplZCwgbmV3U3RvcmUsIGNiKTsKICAgIH0pOwogIH0KCiAgY2xvbmVTeW5jKG5ld1N0b3JlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdGhpcy5fY2xvbmVTeW5jKCk7CiAgICB9CiAgICBpZiAoIW5ld1N0b3JlLnN5bmNocm9ub3VzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiQ29va2llSmFyIGNsb25lIGRlc3RpbmF0aW9uIHN0b3JlIGlzIG5vdCBzeW5jaHJvbm91czsgdXNlIGFzeW5jIEFQSSBpbnN0ZWFkLiIKICAgICAgKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9jbG9uZVN5bmMobmV3U3RvcmUpOwogIH0KCiAgcmVtb3ZlQWxsQ29va2llcyhjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgLy8gQ2hlY2sgdGhhdCB0aGUgc3RvcmUgaW1wbGVtZW50cyBpdHMgb3duIHJlbW92ZUFsbENvb2tpZXMoKS4gVGhlIGRlZmF1bHQKICAgIC8vIGltcGxlbWVudGF0aW9uIGluIFN0b3JlIHdpbGwgaW1tZWRpYXRlbHkgY2FsbCB0aGUgY2FsbGJhY2sgd2l0aCBhICJub3QKICAgIC8vIGltcGxlbWVudGVkIiBFcnJvci4KICAgIGlmICgKICAgICAgdHlwZW9mIHN0b3JlLnJlbW92ZUFsbENvb2tpZXMgPT09ICJmdW5jdGlvbiIgJiYKICAgICAgc3RvcmUucmVtb3ZlQWxsQ29va2llcyAhPT0gU3RvcmUucHJvdG90eXBlLnJlbW92ZUFsbENvb2tpZXMKICAgICkgewogICAgICByZXR1cm4gc3RvcmUucmVtb3ZlQWxsQ29va2llcyhjYik7CiAgICB9CgogICAgc3RvcmUuZ2V0QWxsQ29va2llcygoZXJyLCBjb29raWVzKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgaWYgKGNvb2tpZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICB9CgogICAgICBsZXQgY29tcGxldGVkQ291bnQgPSAwOwogICAgICBjb25zdCByZW1vdmVFcnJvcnMgPSBbXTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZUNvb2tpZUNiKHJlbW92ZUVycikgewogICAgICAgIGlmIChyZW1vdmVFcnIpIHsKICAgICAgICAgIHJlbW92ZUVycm9ycy5wdXNoKHJlbW92ZUVycik7CiAgICAgICAgfQoKICAgICAgICBjb21wbGV0ZWRDb3VudCsrOwoKICAgICAgICBpZiAoY29tcGxldGVkQ291bnQgPT09IGNvb2tpZXMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gY2IocmVtb3ZlRXJyb3JzLmxlbmd0aCA/IHJlbW92ZUVycm9yc1swXSA6IG51bGwpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29va2llcy5mb3JFYWNoKGNvb2tpZSA9PiB7CiAgICAgICAgc3RvcmUucmVtb3ZlQ29va2llKAogICAgICAgICAgY29va2llLmRvbWFpbiwKICAgICAgICAgIGNvb2tpZS5wYXRoLAogICAgICAgICAgY29va2llLmtleSwKICAgICAgICAgIHJlbW92ZUNvb2tpZUNiCiAgICAgICAgKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIHN0YXRpYyBkZXNlcmlhbGl6ZShzdHJPck9iaiwgc3RvcmUsIGNiKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMykgewogICAgICAvLyBzdG9yZSBpcyBvcHRpb25hbAogICAgICBjYiA9IHN0b3JlOwogICAgICBzdG9yZSA9IG51bGw7CiAgICB9CiAgICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihjYiksIGNiKTsKCiAgICBsZXQgc2VyaWFsaXplZDsKICAgIGlmICh0eXBlb2Ygc3RyT3JPYmogPT09ICJzdHJpbmciKSB7CiAgICAgIHNlcmlhbGl6ZWQgPSBqc29uUGFyc2Uoc3RyT3JPYmopOwogICAgICBpZiAoc2VyaWFsaXplZCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgcmV0dXJuIGNiKHNlcmlhbGl6ZWQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzZXJpYWxpemVkID0gc3RyT3JPYmo7CiAgICB9CgogICAgY29uc3QgamFyID0gbmV3IENvb2tpZUphcihzdG9yZSwgewogICAgICByZWplY3RQdWJsaWNTdWZmaXhlczogc2VyaWFsaXplZC5yZWplY3RQdWJsaWNTdWZmaXhlcywKICAgICAgbG9vc2VNb2RlOiBzZXJpYWxpemVkLmVuYWJsZUxvb3NlTW9kZSwKICAgICAgYWxsb3dTcGVjaWFsVXNlRG9tYWluOiBzZXJpYWxpemVkLmFsbG93U3BlY2lhbFVzZURvbWFpbiwKICAgICAgcHJlZml4U2VjdXJpdHk6IHNlcmlhbGl6ZWQucHJlZml4U2VjdXJpdHkKICAgIH0pOwogICAgamFyLl9pbXBvcnRDb29raWVzKHNlcmlhbGl6ZWQsIGVyciA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQogICAgICBjYihudWxsLCBqYXIpOwogICAgfSk7CiAgfQoKICBzdGF0aWMgZGVzZXJpYWxpemVTeW5jKHN0ck9yT2JqLCBzdG9yZSkgewogICAgY29uc3Qgc2VyaWFsaXplZCA9CiAgICAgIHR5cGVvZiBzdHJPck9iaiA9PT0gInN0cmluZyIgPyBKU09OLnBhcnNlKHN0ck9yT2JqKSA6IHN0ck9yT2JqOwogICAgY29uc3QgamFyID0gbmV3IENvb2tpZUphcihzdG9yZSwgewogICAgICByZWplY3RQdWJsaWNTdWZmaXhlczogc2VyaWFsaXplZC5yZWplY3RQdWJsaWNTdWZmaXhlcywKICAgICAgbG9vc2VNb2RlOiBzZXJpYWxpemVkLmVuYWJsZUxvb3NlTW9kZQogICAgfSk7CgogICAgLy8gY2F0Y2ggdGhpcyBtaXN0YWtlIGVhcmx5OgogICAgaWYgKCFqYXIuc3RvcmUuc3luY2hyb25vdXMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICJDb29raWVKYXIgc3RvcmUgaXMgbm90IHN5bmNocm9ub3VzOyB1c2UgYXN5bmMgQVBJIGluc3RlYWQuIgogICAgICApOwogICAgfQoKICAgIGphci5faW1wb3J0Q29va2llc1N5bmMoc2VyaWFsaXplZCk7CiAgICByZXR1cm4gamFyOwogIH0KfQpDb29raWVKYXIuZnJvbUpTT04gPSBDb29raWVKYXIuZGVzZXJpYWxpemVTeW5jOwoKWwogICJfaW1wb3J0Q29va2llcyIsCiAgImNsb25lIiwKICAiZ2V0Q29va2llcyIsCiAgImdldENvb2tpZVN0cmluZyIsCiAgImdldFNldENvb2tpZVN0cmluZ3MiLAogICJyZW1vdmVBbGxDb29raWVzIiwKICAic2VyaWFsaXplIiwKICAic2V0Q29va2llIgpdLmZvckVhY2gobmFtZSA9PiB7CiAgQ29va2llSmFyLnByb3RvdHlwZVtuYW1lXSA9IGZyb21DYWxsYmFjayhDb29raWVKYXIucHJvdG90eXBlW25hbWVdKTsKfSk7CkNvb2tpZUphci5kZXNlcmlhbGl6ZSA9IGZyb21DYWxsYmFjayhDb29raWVKYXIuZGVzZXJpYWxpemUpOwoKLy8gVXNlIGEgY2xvc3VyZSB0byBwcm92aWRlIGEgdHJ1ZSBpbXBlcmF0aXZlIEFQSSBmb3Igc3luY2hyb25vdXMgc3RvcmVzLgpmdW5jdGlvbiBzeW5jV3JhcChtZXRob2QpIHsKICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykgewogICAgaWYgKCF0aGlzLnN0b3JlLnN5bmNocm9ub3VzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiQ29va2llSmFyIHN0b3JlIGlzIG5vdCBzeW5jaHJvbm91czsgdXNlIGFzeW5jIEFQSSBpbnN0ZWFkLiIKICAgICAgKTsKICAgIH0KCiAgICBsZXQgc3luY0Vyciwgc3luY1Jlc3VsdDsKICAgIHRoaXNbbWV0aG9kXSguLi5hcmdzLCAoZXJyLCByZXN1bHQpID0+IHsKICAgICAgc3luY0VyciA9IGVycjsKICAgICAgc3luY1Jlc3VsdCA9IHJlc3VsdDsKICAgIH0pOwoKICAgIGlmIChzeW5jRXJyKSB7CiAgICAgIHRocm93IHN5bmNFcnI7CiAgICB9CiAgICByZXR1cm4gc3luY1Jlc3VsdDsKICB9Owp9CnZhciBDb29raWVKYXJfMSA9IENvb2tpZUphcjsKdmFyIENvb2tpZV8xID0gQ29va2llOwp2YXIgU3RvcmVfMSA9IFN0b3JlOwpwdWJzdWZmaXguZ2V0UHVibGljU3VmZml4Owp2YXIgcGVybXV0ZURvbWFpbiA9IHJlcXVpcmVQZXJtdXRlRG9tYWluKCkucGVybXV0ZURvbWFpbjsKdmFsaWRhdG9ycy5QYXJhbWV0ZXJFcnJvcjsKCmNvbnN0IFNUT1JFX0tFWSA9ICJfX2Nvb2tpZVN0b3JlX18iOwpjbGFzcyBXZWJTdG9yYWdlQ29va2llU3RvcmUgZXh0ZW5kcyBTdG9yZV8xIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnN5bmNocm9ub3VzID0gdHJ1ZTsKICB9CiAgZmluZENvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2FsbGJhY2spIHsKICAgIGNvbnN0IHN0b3JlID0gdGhpcy5fcmVhZFN0b3JlKCk7CiAgICBjb25zdCBjb29raWUgPSBzdG9yZVtkb21haW5dPy5bcGF0aF0/LltrZXldID8/IG51bGw7CiAgICBjYWxsYmFjayhudWxsLCBDb29raWVfMS5mcm9tSlNPTihjb29raWUpKTsKICB9CiAgZmluZENvb2tpZXMoZG9tYWluLCBwYXRoLCBhbGxvd1NwZWNpYWxVc2VEb21haW4sIGNiKSB7CiAgICBpZiAoIWRvbWFpbikKICAgICAgcmV0dXJuIHZvaWQgY2IobnVsbCwgW10pOwogICAgY29uc3QgY29va2llcyA9IFtdOwogICAgY29uc3Qgc3RvcmUgPSB0aGlzLl9yZWFkU3RvcmUoKTsKICAgIGNvbnN0IGRvbWFpbnMgPSBwZXJtdXRlRG9tYWluKGRvbWFpbiwgYWxsb3dTcGVjaWFsVXNlRG9tYWluKSB8fCBbZG9tYWluXTsKICAgIGZvciAoY29uc3QgZG9tYWluMiBvZiBkb21haW5zKSB7CiAgICAgIGlmICghc3RvcmVbZG9tYWluMl0pCiAgICAgICAgY29udGludWU7CiAgICAgIGxldCBtYXRjaGluZ1BhdGhzID0gT2JqZWN0LmtleXMoc3RvcmVbZG9tYWluMl0pOwogICAgICBpZiAocGF0aCAhPT0gbnVsbCkgewogICAgICAgIG1hdGNoaW5nUGF0aHMgPSBtYXRjaGluZ1BhdGhzLmZpbHRlcigKICAgICAgICAgIChjb29raWVQYXRoKSA9PiB0aGlzLl9pc09uUGF0aChjb29raWVQYXRoLCBwYXRoKQogICAgICAgICk7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBwYXRoMiBvZiBtYXRjaGluZ1BhdGhzKSB7CiAgICAgICAgY29va2llcy5wdXNoKC4uLk9iamVjdC52YWx1ZXMoc3RvcmVbZG9tYWluMl1bcGF0aDJdKSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG5ld0Nvb2tpZXMgPSBjb29raWVzLm1hcCgoY29va2llKSA9PiBDb29raWVfMS5mcm9tSlNPTihjb29raWUpKS5maWx0ZXIoQm9vbGVhbik7CiAgICBjYihudWxsLCBuZXdDb29raWVzKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyB3aGV0aGVyIGBjb29raWVQYXRoYCBpcyBvbiB0aGUgZ2l2ZW4gYHVybFBhdGhgCiAgICovCiAgX2lzT25QYXRoKGNvb2tpZVBhdGgsIHVybFBhdGgpIHsKICAgIGlmICghY29va2llUGF0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoY29va2llUGF0aCA9PT0gdXJsUGF0aCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICghdXJsUGF0aC5zdGFydHNXaXRoKGNvb2tpZVBhdGgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChjb29raWVQYXRoW2Nvb2tpZVBhdGgubGVuZ3RoIC0gMV0gIT09ICIvIiAmJiB1cmxQYXRoW2Nvb2tpZVBhdGgubGVuZ3RoXSAhPT0gIi8iKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBwdXRDb29raWUoY29va2llLCBjYWxsYmFjaykgewogICAgY29uc3Qgc3RvcmUgPSB0aGlzLl9yZWFkU3RvcmUoKTsKICAgIGlmICghKGNvb2tpZS5kb21haW4gaW4gc3RvcmUpKQogICAgICBzdG9yZVtjb29raWUuZG9tYWluXSA9IHt9OwogICAgaWYgKCEoY29va2llLnBhdGggaW4gc3RvcmVbY29va2llLmRvbWFpbl0pKQogICAgICBzdG9yZVtjb29raWUuZG9tYWluXVtjb29raWUucGF0aF0gPSB7fTsKICAgIHN0b3JlW2Nvb2tpZS5kb21haW5dW2Nvb2tpZS5wYXRoXVtjb29raWUua2V5XSA9IGNvb2tpZTsKICAgIHRoaXMuX3dyaXRlU3RvcmUoc3RvcmUpOwogICAgY2FsbGJhY2sobnVsbCk7CiAgfQogIHVwZGF0ZUNvb2tpZShvbGRDb29raWUsIG5ld0Nvb2tpZSwgY2FsbGJhY2spIHsKICAgIHRoaXMucHV0Q29va2llKG5ld0Nvb2tpZSwgY2FsbGJhY2spOwogIH0KICByZW1vdmVDb29raWUoZG9tYWluLCBwYXRoLCBrZXksIGNhbGxiYWNrKSB7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuX3JlYWRTdG9yZSgpOwogICAgaWYgKHN0b3JlPy5bZG9tYWluXT8uW3BhdGhdKQogICAgICBkZWxldGUgc3RvcmVbZG9tYWluXVtwYXRoXVtrZXldOwogICAgdGhpcy5fd3JpdGVTdG9yZShzdG9yZSk7CiAgICBjYWxsYmFjayhudWxsKTsKICB9CiAgcmVtb3ZlQ29va2llcyhkb21haW4sIHBhdGgsIGNhbGxiYWNrKSB7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuX3JlYWRTdG9yZSgpOwogICAgaWYgKHBhdGggPT09IG51bGwpIHsKICAgICAgZGVsZXRlIHN0b3JlW2RvbWFpbl07CiAgICB9IGVsc2UgewogICAgICBkZWxldGUgc3RvcmVbZG9tYWluXVtwYXRoXTsKICAgIH0KICAgIHRoaXMuX3dyaXRlU3RvcmUoc3RvcmUpOwogICAgY2FsbGJhY2sobnVsbCk7CiAgfQogIGdldEFsbENvb2tpZXMoY2FsbGJhY2spIHsKICAgIGNvbnN0IGNvb2tpZXMgPSBbXTsKICAgIGNvbnN0IHN0b3JlID0gdGhpcy5fcmVhZFN0b3JlKCk7CiAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBPYmplY3Qua2V5cyhzdG9yZSkpIHsKICAgICAgZm9yIChjb25zdCBwYXRoIG9mIE9iamVjdC5rZXlzKHN0b3JlW2RvbWFpbl0pKSB7CiAgICAgICAgY29va2llcy5wdXNoKC4uLk9iamVjdC52YWx1ZXMoc3RvcmVbZG9tYWluXVtwYXRoXSkpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBuZXdDb29raWVzID0gY29va2llcy5tYXAoKGNvb2tpZSkgPT4gQ29va2llXzEuZnJvbUpTT04oY29va2llKSkuZmlsdGVyKEJvb2xlYW4pOwogICAgbmV3Q29va2llcy5zb3J0KAogICAgICAoYzEsIGMyKSA9PiAoYzEuY3JlYXRpb25JbmRleCB8fCAwKSAtIChjMi5jcmVhdGlvbkluZGV4IHx8IDApCiAgICApOwogICAgY2FsbGJhY2sobnVsbCwgbmV3Q29va2llcyk7CiAgfQogIF9yZWFkU3RvcmUoKSB7CiAgICBpZiAoIShTVE9SRV9LRVkgaW4gbG9jYWxTdG9yYWdlKSkKICAgICAgbG9jYWxTdG9yYWdlW1NUT1JFX0tFWV0gPSBKU09OLnN0cmluZ2lmeSh7fSk7CiAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbU1RPUkVfS0VZXSk7CiAgfQogIF93cml0ZVN0b3JlKHN0b3JlKSB7CiAgICBsb2NhbFN0b3JhZ2VbU1RPUkVfS0VZXSA9IEpTT04uc3RyaW5naWZ5KHN0b3JlKTsKICB9Cn0KCmNvbnN0IHZhbGlkUHJvdG9jb2xzID0gWyJodHRwOiIsICJodHRwczoiXTsKY29uc3QgcmVkaXJlY3RTdGF0dXNDb2RlcyA9IFszMDAsIDMwMSwgMzAyLCAzMDMsIDMwNCwgMzA1LCAzMDcsIDMwOF07CmNvbnN0IGNvb2tpZSA9IG5ldyBDb29raWVKYXJfMShuZXcgV2ViU3RvcmFnZUNvb2tpZVN0b3JlKCkpOwphc3luYyBmdW5jdGlvbiByZXF1ZXN0KHJlcSwgZGVzdCwgd2luKSB7CiAgd2hpbGUgKHRydWUpIHsKICAgIGNvbnN0IHJlcyA9IGF3YWl0IF9yZXF1ZXN0KHJlcSwgZGVzdCwgd2luW3NDbGllbnRdLCB3aW5bc0Fib3J0XS5zaWduYWwpOwogICAgZm9yIChjb25zdCBuYW1lIGluIHJlcy5yYXdIZWFkZXJzKSB7CiAgICAgIGlmIChuYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzZXQtY29va2llIikgewogICAgICAgIGxldCBjb29raWVzID0gcmVzLnJhd0hlYWRlcnNbbmFtZV07CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvb2tpZXMpKQogICAgICAgICAgY29va2llcyA9IFtjb29raWVzXTsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgY29va2llcykKICAgICAgICAgIGF3YWl0IGNvb2tpZS5zZXRDb29raWUoYywgcmVzLmZpbmFsVVJMKTsKICAgICAgfQogICAgfQogICAgaWYgKHJlZGlyZWN0U3RhdHVzQ29kZXMuaW5jbHVkZXMocmVzLnN0YXR1cykpIHsKICAgICAgY29uc3QgbG9jYXRpb24gPSBuZXcgVVJMKHJlcy5oZWFkZXJzLmdldCgibG9jYXRpb24iKSB8fCAiIiwgcmVxLnVybCk7CiAgICAgIHJlcSA9IG5ldyBSZXF1ZXN0KGxvY2F0aW9uKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICByZXR1cm4gcmVzOwogIH0KfQphc3luYyBmdW5jdGlvbiBfcmVxdWVzdChyZXEsIGRlc3QsIGNsaWVudCwgc2lnbmFsKSB7CiAgaWYgKCFjbGllbnQpCiAgICB0aHJvdyBuZXcgRXJyb3IoIk9LIik7CiAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlcS5oZWFkZXJzKTsKICBoZWFkZXJzLnNldCgidXNlci1hZ2VudCIsIG5hdmlnYXRvci51c2VyQWdlbnQpOwogIGhlYWRlcnMuc2V0KCJzZWMtZmV0Y2gtZGVzdCIsIGRlc3QpOwogIGNvbnN0IGNvb2tpZXMgPSBhd2FpdCBjb29raWUuZ2V0Q29va2llU3RyaW5nKHJlcS51cmwpOwogIGlmIChjb29raWVzKQogICAgaGVhZGVycy5zZXQoImNvb2tpZSIsIGNvb2tpZXMpOwogIHJldHVybiBhd2FpdCBjbGllbnQuZmV0Y2gocmVxLnVybCwgewogICAgaGVhZGVycywKICAgIGJvZHk6IHJlcS5ib2R5LAogICAgLy8gZm9yY2luZyBjYWNoZSBncmVhdGx5IGltcHJvdmVzIGxvYWQgdGltZXMKICAgIGNhY2hlOiAiZm9yY2UtY2FjaGUiLAogICAgc2lnbmFsLAogICAgbWV0aG9kOiByZXEubWV0aG9kLAogICAgcmVkaXJlY3Q6ICJtYW51YWwiCiAgfSk7Cn0KYXN5bmMgZnVuY3Rpb24gbG9jYWxpemVSZXNvdXJjZSh1cmwsIGRlc3QsIHdpbikgewogIGNvbnN0IHIgPSBuZXcgVVJMKHVybCk7CiAgaWYgKCF2YWxpZFByb3RvY29scy5pbmNsdWRlcyhyLnByb3RvY29sKSB8fCAhci5ob3N0IHx8IHIucHJvdG9jb2wgPT09ICJkYXRhOiIpCiAgICByZXR1cm4gci50b1N0cmluZygpOwogIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QobmV3IFJlcXVlc3QociksIGRlc3QsIHdpbik7CiAgY29uc3QgYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYXdhaXQgcmVzLmJsb2IoKSk7CiAgd2luW3NCbG9iVXJsc10ucHVzaChibG9iVXJsKTsKICByZXR1cm4gYmxvYlVybDsKfQoKY29uc3QgZXJyb3JNZXNzYWdlcyA9IHsNCiAgICBbMF06ICdVbmV4cGVjdGVkIHRva2VuJywNCiAgICBbMjhdOiAiVW5leHBlY3RlZCB0b2tlbjogJyUwJyIsDQogICAgWzFdOiAnT2N0YWwgZXNjYXBlIHNlcXVlbmNlcyBhcmUgbm90IGFsbG93ZWQgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFsyXTogJ09jdGFsIGVzY2FwZSBzZXF1ZW5jZXMgYXJlIG5vdCBhbGxvd2VkIGluIHRlbXBsYXRlIHN0cmluZ3MnLA0KICAgIFszXTogJ1VuZXhwZWN0ZWQgdG9rZW4gYCNgJywNCiAgICBbNF06ICdJbGxlZ2FsIFVuaWNvZGUgZXNjYXBlIHNlcXVlbmNlJywNCiAgICBbNV06ICdJbnZhbGlkIGNvZGUgcG9pbnQgJTAnLA0KICAgIFs2XTogJ0ludmFsaWQgaGV4YWRlY2ltYWwgZXNjYXBlIHNlcXVlbmNlJywNCiAgICBbOF06ICdPY3RhbCBsaXRlcmFscyBhcmUgbm90IGFsbG93ZWQgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFs3XTogJ0RlY2ltYWwgaW50ZWdlciBsaXRlcmFscyB3aXRoIGEgbGVhZGluZyB6ZXJvIGFyZSBmb3JiaWRkZW4gaW4gc3RyaWN0IG1vZGUnLA0KICAgIFs5XTogJ0V4cGVjdGVkIG51bWJlciBpbiByYWRpeCAlMCcsDQogICAgWzE0Nl06ICdJbnZhbGlkIGxlZnQtaGFuZCBzaWRlIGFzc2lnbm1lbnQgdG8gYSBkZXN0cnVjdGlibGUgcmlnaHQtaGFuZCBzaWRlJywNCiAgICBbMTBdOiAnTm9uLW51bWJlciBmb3VuZCBhZnRlciBleHBvbmVudCBpbmRpY2F0b3InLA0KICAgIFsxMV06ICdJbnZhbGlkIEJpZ0ludExpdGVyYWwnLA0KICAgIFsxMl06ICdObyBpZGVudGlmaWVycyBhbGxvd2VkIGRpcmVjdGx5IGFmdGVyIG51bWVyaWMgbGl0ZXJhbCcsDQogICAgWzEzXTogJ0VzY2FwZXMgXFw4IG9yIFxcOSBhcmUgbm90IHN5bnRhY3RpY2FsbHkgdmFsaWQgZXNjYXBlcycsDQogICAgWzE0XTogJ1VudGVybWluYXRlZCBzdHJpbmcgbGl0ZXJhbCcsDQogICAgWzE1XTogJ1VudGVybWluYXRlZCB0ZW1wbGF0ZSBsaXRlcmFsJywNCiAgICBbMTZdOiAnTXVsdGlsaW5lIGNvbW1lbnQgd2FzIG5vdCBjbG9zZWQgcHJvcGVybHknLA0KICAgIFsxN106ICdUaGUgaWRlbnRpZmllciBjb250YWluZWQgZHluYW1pYyB1bmljb2RlIGVzY2FwZSB0aGF0IHdhcyBub3QgY2xvc2VkJywNCiAgICBbMThdOiAiSWxsZWdhbCBjaGFyYWN0ZXIgJyUwJyIsDQogICAgWzE5XTogJ01pc3NpbmcgaGV4YWRlY2ltYWwgZGlnaXRzJywNCiAgICBbMjBdOiAnSW52YWxpZCBpbXBsaWNpdCBvY3RhbCcsDQogICAgWzIxXTogJ0ludmFsaWQgbGluZSBicmVhayBpbiBzdHJpbmcgbGl0ZXJhbCcsDQogICAgWzIyXTogJ09ubHkgdW5pY29kZSBlc2NhcGVzIGFyZSBsZWdhbCBpbiBpZGVudGlmaWVyIG5hbWVzJywNCiAgICBbMjNdOiAiRXhwZWN0ZWQgJyUwJyIsDQogICAgWzI0XTogJ0ludmFsaWQgbGVmdC1oYW5kIHNpZGUgaW4gYXNzaWdubWVudCcsDQogICAgWzI1XTogJ0ludmFsaWQgbGVmdC1oYW5kIHNpZGUgaW4gYXN5bmMgYXJyb3cnLA0KICAgIFsyNl06ICdDYWxscyB0byBzdXBlciBtdXN0IGJlIGluIHRoZSAiY29uc3RydWN0b3IiIG1ldGhvZCBvZiBhIGNsYXNzIGV4cHJlc3Npb24gb3IgY2xhc3MgZGVjbGFyYXRpb24gdGhhdCBoYXMgYSBzdXBlcmNsYXNzJywNCiAgICBbMjddOiAnTWVtYmVyIGFjY2VzcyBvbiBzdXBlciBtdXN0IGJlIGluIGEgbWV0aG9kJywNCiAgICBbMjldOiAnQXdhaXQgZXhwcmVzc2lvbiBub3QgYWxsb3dlZCBpbiBmb3JtYWwgcGFyYW1ldGVyJywNCiAgICBbMzBdOiAnWWllbGQgZXhwcmVzc2lvbiBub3QgYWxsb3dlZCBpbiBmb3JtYWwgcGFyYW1ldGVyJywNCiAgICBbOTNdOiAiVW5leHBlY3RlZCB0b2tlbjogJ2VzY2FwZWQga2V5d29yZCciLA0KICAgIFszMV06ICdVbmFyeSBleHByZXNzaW9ucyBhcyB0aGUgbGVmdCBvcGVyYW5kIG9mIGFuIGV4cG9uZW50aWF0aW9uIGV4cHJlc3Npb24gbXVzdCBiZSBkaXNhbWJpZ3VhdGVkIHdpdGggcGFyZW50aGVzZXMnLA0KICAgIFsxMjBdOiAnQXN5bmMgZnVuY3Rpb25zIGNhbiBvbmx5IGJlIGRlY2xhcmVkIGF0IHRoZSB0b3AgbGV2ZWwgb3IgaW5zaWRlIGEgYmxvY2snLA0KICAgIFszMl06ICdVbnRlcm1pbmF0ZWQgcmVndWxhciBleHByZXNzaW9uJywNCiAgICBbMzNdOiAnVW5leHBlY3RlZCByZWd1bGFyIGV4cHJlc3Npb24gZmxhZycsDQogICAgWzM0XTogIkR1cGxpY2F0ZSByZWd1bGFyIGV4cHJlc3Npb24gZmxhZyAnJTAnIiwNCiAgICBbMzVdOiAnJTAgZnVuY3Rpb25zIG11c3QgaGF2ZSBleGFjdGx5ICUxIGFyZ3VtZW50JTInLA0KICAgIFszNl06ICdTZXR0ZXIgZnVuY3Rpb24gYXJndW1lbnQgbXVzdCBub3QgYmUgYSByZXN0IHBhcmFtZXRlcicsDQogICAgWzM3XTogJyUwIGRlY2xhcmF0aW9uIG11c3QgaGF2ZSBhIG5hbWUgaW4gdGhpcyBjb250ZXh0JywNCiAgICBbMzhdOiAnRnVuY3Rpb24gbmFtZSBtYXkgbm90IGNvbnRhaW4gYW55IHJlc2VydmVkIHdvcmRzIG9yIGJlIGV2YWwgb3IgYXJndW1lbnRzIGluIHN0cmljdCBtb2RlJywNCiAgICBbMzldOiAnVGhlIHJlc3Qgb3BlcmF0b3IgaXMgbWlzc2luZyBhbiBhcmd1bWVudCcsDQogICAgWzQwXTogJ0EgZ2V0dGVyIGNhbm5vdCBiZSBhIGdlbmVyYXRvcicsDQogICAgWzQxXTogJ0Egc2V0dGVyIGNhbm5vdCBiZSBhIGdlbmVyYXRvcicsDQogICAgWzQyXTogJ0EgY29tcHV0ZWQgcHJvcGVydHkgbmFtZSBtdXN0IGJlIGZvbGxvd2VkIGJ5IGEgY29sb24gb3IgcGFyZW4nLA0KICAgIFsxMzFdOiAnT2JqZWN0IGxpdGVyYWwga2V5cyB0aGF0IGFyZSBzdHJpbmdzIG9yIG51bWJlcnMgbXVzdCBiZSBhIG1ldGhvZCBvciBoYXZlIGEgY29sb24nLA0KICAgIFs0NF06ICdGb3VuZCBgKiBhc3luYyB4KCl7fWAgYnV0IHRoaXMgc2hvdWxkIGJlIGBhc3luYyAqIHgoKXt9YCcsDQogICAgWzQzXTogJ0dldHRlcnMgYW5kIHNldHRlcnMgY2FuIG5vdCBiZSBnZW5lcmF0b3JzJywNCiAgICBbNDVdOiAiJyUwJyBjYW4gbm90IGJlIGdlbmVyYXRvciBtZXRob2QiLA0KICAgIFs0Nl06ICJObyBsaW5lIGJyZWFrIGlzIGFsbG93ZWQgYWZ0ZXIgJz0+JyIsDQogICAgWzQ3XTogJ1RoZSBsZWZ0LWhhbmQgc2lkZSBvZiB0aGUgYXJyb3cgY2FuIG9ubHkgYmUgZGVzdHJ1Y3RlZCB0aHJvdWdoIGFzc2lnbm1lbnQnLA0KICAgIFs0OF06ICdUaGUgYmluZGluZyBkZWNsYXJhdGlvbiBpcyBub3QgZGVzdHJ1Y3RpYmxlJywNCiAgICBbNDldOiAnQXN5bmMgYXJyb3cgY2FuIG5vdCBiZSBmb2xsb3dlZCBieSBuZXcgZXhwcmVzc2lvbicsDQogICAgWzUwXTogIkNsYXNzZXMgbWF5IG5vdCBoYXZlIGEgc3RhdGljIHByb3BlcnR5IG5hbWVkICdwcm90b3R5cGUnIiwNCiAgICBbNTFdOiAnQ2xhc3MgY29uc3RydWN0b3IgbWF5IG5vdCBiZSBhICUwJywNCiAgICBbNTJdOiAnRHVwbGljYXRlIGNvbnN0cnVjdG9yIG1ldGhvZCBpbiBjbGFzcycsDQogICAgWzUzXTogJ0ludmFsaWQgaW5jcmVtZW50L2RlY3JlbWVudCBvcGVyYW5kJywNCiAgICBbNTRdOiAnSW52YWxpZCB1c2Ugb2YgYG5ld2Aga2V5d29yZCBvbiBhbiBpbmNyZW1lbnQvZGVjcmVtZW50IGV4cHJlc3Npb24nLA0KICAgIFs1NV06ICdgPT5gIGlzIGFuIGludmFsaWQgYXNzaWdubWVudCB0YXJnZXQnLA0KICAgIFs1Nl06ICdSZXN0IGVsZW1lbnQgbWF5IG5vdCBoYXZlIGEgdHJhaWxpbmcgY29tbWEnLA0KICAgIFs1N106ICdNaXNzaW5nIGluaXRpYWxpemVyIGluICUwIGRlY2xhcmF0aW9uJywNCiAgICBbNThdOiAiJ2Zvci0lMCcgbG9vcCBoZWFkIGRlY2xhcmF0aW9ucyBjYW4gbm90IGhhdmUgYW4gaW5pdGlhbGl6ZXIiLA0KICAgIFs1OV06ICdJbnZhbGlkIGxlZnQtaGFuZCBzaWRlIGluIGZvci0lMCBsb29wOiBNdXN0IGhhdmUgYSBzaW5nbGUgYmluZGluZycsDQogICAgWzYwXTogJ0ludmFsaWQgc2hvcnRoYW5kIHByb3BlcnR5IGluaXRpYWxpemVyJywNCiAgICBbNjFdOiAnUHJvcGVydHkgbmFtZSBfX3Byb3RvX18gYXBwZWFycyBtb3JlIHRoYW4gb25jZSBpbiBvYmplY3QgbGl0ZXJhbCcsDQogICAgWzYyXTogJ0xldCBpcyBkaXNhbGxvd2VkIGFzIGEgbGV4aWNhbGx5IGJvdW5kIG5hbWUnLA0KICAgIFs2M106ICJJbnZhbGlkIHVzZSBvZiAnJTAnIGluc2lkZSBuZXcgZXhwcmVzc2lvbiIsDQogICAgWzY0XTogIklsbGVnYWwgJ3VzZSBzdHJpY3QnIGRpcmVjdGl2ZSBpbiBmdW5jdGlvbiB3aXRoIG5vbi1zaW1wbGUgcGFyYW1ldGVyIGxpc3QiLA0KICAgIFs2NV06ICdJZGVudGlmaWVyICJsZXQiIGRpc2FsbG93ZWQgYXMgbGVmdC1oYW5kIHNpZGUgZXhwcmVzc2lvbiBpbiBzdHJpY3QgbW9kZScsDQogICAgWzY2XTogJ0lsbGVnYWwgY29udGludWUgc3RhdGVtZW50JywNCiAgICBbNjddOiAnSWxsZWdhbCBicmVhayBzdGF0ZW1lbnQnLA0KICAgIFs2OF06ICdDYW5ub3QgaGF2ZSBgbGV0Wy4uLl1gIGFzIGEgdmFyIG5hbWUgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFs2OV06ICdJbnZhbGlkIGRlc3RydWN0dXJpbmcgYXNzaWdubWVudCB0YXJnZXQnLA0KICAgIFs3MF06ICdSZXN0IHBhcmFtZXRlciBtYXkgbm90IGhhdmUgYSBkZWZhdWx0IGluaXRpYWxpemVyJywNCiAgICBbNzFdOiAnVGhlIHJlc3QgYXJndW1lbnQgbXVzdCB0aGUgYmUgbGFzdCBwYXJhbWV0ZXInLA0KICAgIFs3Ml06ICdJbnZhbGlkIHJlc3QgYXJndW1lbnQnLA0KICAgIFs3NF06ICdJbiBzdHJpY3QgbW9kZSBjb2RlLCBmdW5jdGlvbnMgY2FuIG9ubHkgYmUgZGVjbGFyZWQgYXQgdG9wIGxldmVsIG9yIGluc2lkZSBhIGJsb2NrJywNCiAgICBbNzVdOiAnSW4gbm9uLXN0cmljdCBtb2RlIGNvZGUsIGZ1bmN0aW9ucyBjYW4gb25seSBiZSBkZWNsYXJlZCBhdCB0b3AgbGV2ZWwsIGluc2lkZSBhIGJsb2NrLCBvciBhcyB0aGUgYm9keSBvZiBhbiBpZiBzdGF0ZW1lbnQnLA0KICAgIFs3Nl06ICdXaXRob3V0IHdlYiBjb21wYXRpYmlsaXR5IGVuYWJsZWQgZnVuY3Rpb25zIGNhbiBub3QgYmUgZGVjbGFyZWQgYXQgdG9wIGxldmVsLCBpbnNpZGUgYSBibG9jaywgb3IgYXMgdGhlIGJvZHkgb2YgYW4gaWYgc3RhdGVtZW50JywNCiAgICBbNzddOiAiQ2xhc3MgZGVjbGFyYXRpb24gY2FuJ3QgYXBwZWFyIGluIHNpbmdsZS1zdGF0ZW1lbnQgY29udGV4dCIsDQogICAgWzc4XTogJ0ludmFsaWQgbGVmdC1oYW5kIHNpZGUgaW4gZm9yLSUwJywNCiAgICBbNzldOiAnSW52YWxpZCBhc3NpZ25tZW50IGluIGZvci0lMCcsDQogICAgWzgwXTogJ2ZvciBhd2FpdCAoLi4uIG9mIC4uLikgaXMgb25seSB2YWxpZCBpbiBhc3luYyBmdW5jdGlvbnMgYW5kIGFzeW5jIGdlbmVyYXRvcnMnLA0KICAgIFs4MV06ICdUaGUgZmlyc3QgdG9rZW4gYWZ0ZXIgdGhlIHRlbXBsYXRlIGV4cHJlc3Npb24gc2hvdWxkIGJlIGEgY29udGludWF0aW9uIG9mIHRoZSB0ZW1wbGF0ZScsDQogICAgWzgzXTogJ2BsZXRgIGRlY2xhcmF0aW9uIG5vdCBhbGxvd2VkIGhlcmUgYW5kIGBsZXRgIGNhbm5vdCBiZSBhIHJlZ3VsYXIgdmFyIG5hbWUgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFs4Ml06ICdgbGV0IFxuIFtgIGlzIGEgcmVzdHJpY3RlZCBwcm9kdWN0aW9uIGF0IHRoZSBzdGFydCBvZiBhIHN0YXRlbWVudCcsDQogICAgWzg0XTogJ0NhdGNoIGNsYXVzZSByZXF1aXJlcyBleGFjdGx5IG9uZSBwYXJhbWV0ZXIsIG5vdCBtb3JlIChhbmQgbm8gdHJhaWxpbmcgY29tbWEpJywNCiAgICBbODVdOiAnQ2F0Y2ggY2xhdXNlIHBhcmFtZXRlciBkb2VzIG5vdCBzdXBwb3J0IGRlZmF1bHQgdmFsdWVzJywNCiAgICBbODZdOiAnTWlzc2luZyBjYXRjaCBvciBmaW5hbGx5IGFmdGVyIHRyeScsDQogICAgWzg3XTogJ01vcmUgdGhhbiBvbmUgZGVmYXVsdCBjbGF1c2UgaW4gc3dpdGNoIHN0YXRlbWVudCcsDQogICAgWzg4XTogJ0lsbGVnYWwgbmV3bGluZSBhZnRlciB0aHJvdycsDQogICAgWzg5XTogJ1N0cmljdCBtb2RlIGNvZGUgbWF5IG5vdCBpbmNsdWRlIGEgd2l0aCBzdGF0ZW1lbnQnLA0KICAgIFs5MF06ICdJbGxlZ2FsIHJldHVybiBzdGF0ZW1lbnQnLA0KICAgIFs5MV06ICdUaGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGZvci1oZWFkZXIgYmluZGluZyBkZWNsYXJhdGlvbiBpcyBub3QgZGVzdHJ1Y3RpYmxlJywNCiAgICBbOTJdOiAnbmV3LnRhcmdldCBvbmx5IGFsbG93ZWQgd2l0aGluIGZ1bmN0aW9ucycsDQogICAgWzk0XTogIicjJyBub3QgZm9sbG93ZWQgYnkgaWRlbnRpZmllciIsDQogICAgWzEwMF06ICdJbnZhbGlkIGtleXdvcmQnLA0KICAgIFs5OV06ICJDYW4gbm90IHVzZSAnbGV0JyBhcyBhIGNsYXNzIG5hbWUiLA0KICAgIFs5OF06ICInQSBsZXhpY2FsIGRlY2xhcmF0aW9uIGNhbid0IGRlZmluZSBhICdsZXQnIGJpbmRpbmciLA0KICAgIFs5N106ICdDYW4gbm90IHVzZSBgbGV0YCBhcyB2YXJpYWJsZSBuYW1lIGluIHN0cmljdCBtb2RlJywNCiAgICBbOTVdOiAiJyUwJyBtYXkgbm90IGJlIHVzZWQgYXMgYW4gaWRlbnRpZmllciBpbiB0aGlzIGNvbnRleHQiLA0KICAgIFs5Nl06ICdBd2FpdCBpcyBvbmx5IHZhbGlkIGluIGFzeW5jIGZ1bmN0aW9ucycsDQogICAgWzEwMV06ICdUaGUgJTAga2V5d29yZCBjYW4gb25seSBiZSB1c2VkIHdpdGggdGhlIG1vZHVsZSBnb2FsJywNCiAgICBbMTAyXTogJ1VuaWNvZGUgY29kZXBvaW50IG11c3Qgbm90IGJlIGdyZWF0ZXIgdGhhbiAweDEwRkZGRicsDQogICAgWzEwM106ICclMCBzb3VyY2UgbXVzdCBiZSBzdHJpbmcnLA0KICAgIFsxMDRdOiAnT25seSBhIGlkZW50aWZpZXIgY2FuIGJlIHVzZWQgdG8gaW5kaWNhdGUgYWxpYXMnLA0KICAgIFsxMDVdOiAiT25seSAnKicgb3IgJ3suLi59JyBjYW4gYmUgaW1wb3J0ZWQgYWZ0ZXIgZGVmYXVsdCIsDQogICAgWzEwNl06ICdUcmFpbGluZyBkZWNvcmF0b3IgbWF5IGJlIGZvbGxvd2VkIGJ5IG1ldGhvZCcsDQogICAgWzEwN106ICJEZWNvcmF0b3JzIGNhbid0IGJlIHVzZWQgd2l0aCBhIGNvbnN0cnVjdG9yIiwNCiAgICBbMTA5XTogJ0hUTUwgY29tbWVudHMgYXJlIG9ubHkgYWxsb3dlZCB3aXRoIHdlYiBjb21wYXRpYmlsaXR5IChBbm5leCBCKScsDQogICAgWzExMF06ICJUaGUgaWRlbnRpZmllciAnbGV0JyBtdXN0IG5vdCBiZSBpbiBleHByZXNzaW9uIHBvc2l0aW9uIGluIHN0cmljdCBtb2RlIiwNCiAgICBbMTExXTogJ0Nhbm5vdCBhc3NpZ24gdG8gYGV2YWxgIGFuZCBgYXJndW1lbnRzYCBpbiBzdHJpY3QgbW9kZScsDQogICAgWzExMl06ICJUaGUgbGVmdC1oYW5kIHNpZGUgb2YgYSBmb3Itb2YgbG9vcCBtYXkgbm90IHN0YXJ0IHdpdGggJ2xldCciLA0KICAgIFsxMTNdOiAnQmxvY2sgYm9keSBhcnJvd3MgY2FuIG5vdCBiZSBpbW1lZGlhdGVseSBpbnZva2VkIHdpdGhvdXQgYSBncm91cCcsDQogICAgWzExNF06ICdCbG9jayBib2R5IGFycm93cyBjYW4gbm90IGJlIGltbWVkaWF0ZWx5IGFjY2Vzc2VkIHdpdGhvdXQgYSBncm91cCcsDQogICAgWzExNV06ICdVbmV4cGVjdGVkIHN0cmljdCBtb2RlIHJlc2VydmVkIHdvcmQnLA0KICAgIFsxMTZdOiAnVW5leHBlY3RlZCBldmFsIG9yIGFyZ3VtZW50cyBpbiBzdHJpY3QgbW9kZScsDQogICAgWzExN106ICdEZWNvcmF0b3JzIG11c3Qgbm90IGJlIGZvbGxvd2VkIGJ5IGEgc2VtaWNvbG9uJywNCiAgICBbMTE4XTogJ0NhbGxpbmcgZGVsZXRlIG9uIGV4cHJlc3Npb24gbm90IGFsbG93ZWQgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFsxMTldOiAnUGF0dGVybiBjYW4gbm90IGhhdmUgYSB0YWlsJywNCiAgICBbMTIxXTogJ0NhbiBub3QgaGF2ZSBhIGB5aWVsZGAgZXhwcmVzc2lvbiBvbiB0aGUgbGVmdCBzaWRlIG9mIGEgdGVybmFyeScsDQogICAgWzEyMl06ICdBbiBhcnJvdyBmdW5jdGlvbiBjYW4gbm90IGhhdmUgYSBwb3N0Zml4IHVwZGF0ZSBvcGVyYXRvcicsDQogICAgWzEyM106ICdJbnZhbGlkIG9iamVjdCBsaXRlcmFsIGtleSBjaGFyYWN0ZXIgYWZ0ZXIgZ2VuZXJhdG9yIHN0YXInLA0KICAgIFsxMjRdOiAnUHJpdmF0ZSBmaWVsZHMgY2FuIG5vdCBiZSBkZWxldGVkJywNCiAgICBbMTI2XTogJ0NsYXNzZXMgbWF5IG5vdCBoYXZlIGEgZmllbGQgY2FsbGVkIGNvbnN0cnVjdG9yJywNCiAgICBbMTI1XTogJ0NsYXNzZXMgbWF5IG5vdCBoYXZlIGEgcHJpdmF0ZSBlbGVtZW50IG5hbWVkIGNvbnN0cnVjdG9yJywNCiAgICBbMTI3XTogJ0EgY2xhc3MgZmllbGQgaW5pdGlhbGl6ZXIgbWF5IG5vdCBjb250YWluIGFyZ3VtZW50cycsDQogICAgWzEyOF06ICdHZW5lcmF0b3JzIGNhbiBvbmx5IGJlIGRlY2xhcmVkIGF0IHRoZSB0b3AgbGV2ZWwgb3IgaW5zaWRlIGEgYmxvY2snLA0KICAgIFsxMjldOiAnQXN5bmMgbWV0aG9kcyBhcmUgYSByZXN0cmljdGVkIHByb2R1Y3Rpb24gYW5kIGNhbm5vdCBoYXZlIGEgbmV3bGluZSBmb2xsb3dpbmcgaXQnLA0KICAgIFsxMzBdOiAnVW5leHBlY3RlZCBjaGFyYWN0ZXIgYWZ0ZXIgb2JqZWN0IGxpdGVyYWwgcHJvcGVydHkgbmFtZScsDQogICAgWzEzMl06ICdJbnZhbGlkIGtleSB0b2tlbicsDQogICAgWzEzM106ICJMYWJlbCAnJTAnIGhhcyBhbHJlYWR5IGJlZW4gZGVjbGFyZWQiLA0KICAgIFsxMzRdOiAnY29udGludWUgc3RhdGVtZW50IG11c3QgYmUgbmVzdGVkIHdpdGhpbiBhbiBpdGVyYXRpb24gc3RhdGVtZW50JywNCiAgICBbMTM1XTogIlVuZGVmaW5lZCBsYWJlbCAnJTAnIiwNCiAgICBbMTM2XTogJ1RyYWlsaW5nIGNvbW1hIGlzIGRpc2FsbG93ZWQgaW5zaWRlIGltcG9ydCguLi4pIGFyZ3VtZW50cycsDQogICAgWzEzN106ICdpbXBvcnQoKSByZXF1aXJlcyBleGFjdGx5IG9uZSBhcmd1bWVudCcsDQogICAgWzEzOF06ICdDYW5ub3QgdXNlIG5ldyB3aXRoIGltcG9ydCguLi4pJywNCiAgICBbMTM5XTogJy4uLiBpcyBub3QgYWxsb3dlZCBpbiBpbXBvcnQoKScsDQogICAgWzE0MF06ICJFeHBlY3RlZCAnPT4nIiwNCiAgICBbMTQxXTogIkR1cGxpY2F0ZSBiaW5kaW5nICclMCciLA0KICAgIFsxNDJdOiAiQ2Fubm90IGV4cG9ydCBhIGR1cGxpY2F0ZSBuYW1lICclMCciLA0KICAgIFsxNDVdOiAnRHVwbGljYXRlICUwIGZvci1iaW5kaW5nJywNCiAgICBbMTQzXTogIkV4cG9ydGVkIGJpbmRpbmcgJyUwJyBuZWVkcyB0byByZWZlciB0byBhIHRvcC1sZXZlbCBkZWNsYXJlZCB2YXJpYWJsZSIsDQogICAgWzE0NF06ICdVbmV4cGVjdGVkIHByaXZhdGUgZmllbGQnLA0KICAgIFsxNDhdOiAnTnVtZXJpYyBzZXBhcmF0b3JzIGFyZSBub3QgYWxsb3dlZCBhdCB0aGUgZW5kIG9mIG51bWVyaWMgbGl0ZXJhbHMnLA0KICAgIFsxNDddOiAnT25seSBvbmUgdW5kZXJzY29yZSBpcyBhbGxvd2VkIGFzIG51bWVyaWMgc2VwYXJhdG9yJywNCiAgICBbMTQ5XTogJ0pTWCB2YWx1ZSBzaG91bGQgYmUgZWl0aGVyIGFuIGV4cHJlc3Npb24gb3IgYSBxdW90ZWQgSlNYIHRleHQnLA0KICAgIFsxNTBdOiAnRXhwZWN0ZWQgY29ycmVzcG9uZGluZyBKU1ggY2xvc2luZyB0YWcgZm9yICUwJywNCiAgICBbMTUxXTogJ0FkamFjZW50IEpTWCBlbGVtZW50cyBtdXN0IGJlIHdyYXBwZWQgaW4gYW4gZW5jbG9zaW5nIHRhZycsDQogICAgWzE1Ml06ICJKU1ggYXR0cmlidXRlcyBtdXN0IG9ubHkgYmUgYXNzaWduZWQgYSBub24tZW1wdHkgJ2V4cHJlc3Npb24nIiwNCiAgICBbMTUzXTogIiclMCcgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZCIsDQogICAgWzE1NF06ICInJTAnIHNoYWRvd2VkIGEgY2F0Y2ggY2xhdXNlIGJpbmRpbmciLA0KICAgIFsxNTVdOiAnRG90IHByb3BlcnR5IG11c3QgYmUgYW4gaWRlbnRpZmllcicsDQogICAgWzE1Nl06ICdFbmNvdW50ZXJlZCBpbnZhbGlkIGlucHV0IGFmdGVyIHNwcmVhZC9yZXN0IGFyZ3VtZW50JywNCiAgICBbMTU3XTogJ0NhdGNoIHdpdGhvdXQgdHJ5JywNCiAgICBbMTU4XTogJ0ZpbmFsbHkgd2l0aG91dCB0cnknLA0KICAgIFsxNTldOiAnRXhwZWN0ZWQgY29ycmVzcG9uZGluZyBjbG9zaW5nIHRhZyBmb3IgSlNYIGZyYWdtZW50JywNCiAgICBbMTYwXTogJ0NvYWxlc2NpbmcgYW5kIGxvZ2ljYWwgb3BlcmF0b3JzIHVzZWQgdG9nZXRoZXIgaW4gdGhlIHNhbWUgZXhwcmVzc2lvbiBtdXN0IGJlIGRpc2FtYmlndWF0ZWQgd2l0aCBwYXJlbnRoZXNlcycsDQogICAgWzE2MV06ICdJbnZhbGlkIHRhZ2dlZCB0ZW1wbGF0ZSBvbiBvcHRpb25hbCBjaGFpbicsDQogICAgWzE2Ml06ICdJbnZhbGlkIG9wdGlvbmFsIGNoYWluIGZyb20gc3VwZXIgcHJvcGVydHknLA0KICAgIFsxNjNdOiAnSW52YWxpZCBvcHRpb25hbCBjaGFpbiBmcm9tIG5ldyBleHByZXNzaW9uJywNCiAgICBbMTY0XTogJ0Nhbm5vdCB1c2UgImltcG9ydC5tZXRhIiBvdXRzaWRlIGEgbW9kdWxlJywNCiAgICBbMTY1XTogJ0xlYWRpbmcgZGVjb3JhdG9ycyBtdXN0IGJlIGF0dGFjaGVkIHRvIGEgY2xhc3MgZGVjbGFyYXRpb24nDQp9Ow0KY2xhc3MgUGFyc2VFcnJvciBleHRlbmRzIFN5bnRheEVycm9yIHsNCiAgICBjb25zdHJ1Y3RvcihzdGFydGluZGV4LCBsaW5lLCBjb2x1bW4sIHR5cGUsIC4uLnBhcmFtcykgew0KICAgICAgICBjb25zdCBtZXNzYWdlID0gJ1snICsgbGluZSArICc6JyArIGNvbHVtbiArICddOiAnICsgZXJyb3JNZXNzYWdlc1t0eXBlXS5yZXBsYWNlKC8lKFxkKykvZywgKF8sIGkpID0+IHBhcmFtc1tpXSk7DQogICAgICAgIHN1cGVyKGAke21lc3NhZ2V9YCk7DQogICAgICAgIHRoaXMuaW5kZXggPSBzdGFydGluZGV4Ow0KICAgICAgICB0aGlzLmxpbmUgPSBsaW5lOw0KICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjsNCiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IG1lc3NhZ2U7DQogICAgICAgIHRoaXMubG9jID0gew0KICAgICAgICAgICAgbGluZSwNCiAgICAgICAgICAgIGNvbHVtbg0KICAgICAgICB9Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIHJlcG9ydChwYXJzZXIsIHR5cGUsIC4uLnBhcmFtcykgew0KICAgIHRocm93IG5ldyBQYXJzZUVycm9yKHBhcnNlci5pbmRleCwgcGFyc2VyLmxpbmUsIHBhcnNlci5jb2x1bW4sIHR5cGUsIC4uLnBhcmFtcyk7DQp9DQpmdW5jdGlvbiByZXBvcnRTY29wZUVycm9yKHNjb3BlKSB7DQogICAgdGhyb3cgbmV3IFBhcnNlRXJyb3Ioc2NvcGUuaW5kZXgsIHNjb3BlLmxpbmUsIHNjb3BlLmNvbHVtbiwgc2NvcGUudHlwZSwgc2NvcGUucGFyYW1zKTsNCn0NCmZ1bmN0aW9uIHJlcG9ydE1lc3NhZ2VBdChpbmRleCwgbGluZSwgY29sdW1uLCB0eXBlLCAuLi5wYXJhbXMpIHsNCiAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihpbmRleCwgbGluZSwgY29sdW1uLCB0eXBlLCAuLi5wYXJhbXMpOw0KfQ0KZnVuY3Rpb24gcmVwb3J0U2Nhbm5lckVycm9yKGluZGV4LCBsaW5lLCBjb2x1bW4sIHR5cGUpIHsNCiAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihpbmRleCwgbGluZSwgY29sdW1uLCB0eXBlKTsNCn0KCmNvbnN0IHVuaWNvZGVMb29rdXAgPSAoKGNvbXByZXNzZWQsIGxvb2t1cCkgPT4gew0KICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBVaW50MzJBcnJheSgxMDQ0NDgpOw0KICAgIGxldCBpbmRleCA9IDA7DQogICAgbGV0IHN1YkluZGV4ID0gMDsNCiAgICB3aGlsZSAoaW5kZXggPCAzNTQwKSB7DQogICAgICAgIGNvbnN0IGluc3QgPSBjb21wcmVzc2VkW2luZGV4KytdOw0KICAgICAgICBpZiAoaW5zdCA8IDApIHsNCiAgICAgICAgICAgIHN1YkluZGV4IC09IGluc3Q7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBsZXQgY29kZSA9IGNvbXByZXNzZWRbaW5kZXgrK107DQogICAgICAgICAgICBpZiAoaW5zdCAmIDIpDQogICAgICAgICAgICAgICAgY29kZSA9IGxvb2t1cFtjb2RlXTsNCiAgICAgICAgICAgIGlmIChpbnN0ICYgMSkgew0KICAgICAgICAgICAgICAgIHJlc3VsdC5maWxsKGNvZGUsIHN1YkluZGV4LCBzdWJJbmRleCArPSBjb21wcmVzc2VkW2luZGV4KytdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJlc3VsdFtzdWJJbmRleCsrXSA9IGNvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0pKFstMSwgMiwgMjQsIDIsIDI1LCAyLCA1LCAtMSwgMCwgNzc1OTU2NDgsIDMsIDQ0LCAyLCAzLCAwLCAxNCwgMiwgNTcsIDIsIDU4LCAzLCAwLCAzLCAwLCAzMTY4Nzk2NjcxLCAwLCA0Mjk0OTU2OTkyLCAyLCAxLCAyLCAwLCAyLCA1OSwgMywgMCwgNCwgMCwgNDI5NDk2NjUyMywgMywgMCwgNCwgMiwgMTYsIDIsIDYwLCAyLCAwLCAwLCA0Mjk0ODM2NzM1LCAwLCAzMjIxMjI1NDcxLCAwLCA0Mjk0OTAxOTQyLCAyLCA2MSwgMCwgMTM0MTUyMTkyLCAzLCAwLCAyLCAwLCA0Mjk0OTUxOTM1LCAzLCAwLCAyLCAwLCAyNjgzMzA1OTgzLCAwLCAyNjg0MzU0MDQ3LCAyLCAxNywgMiwgMCwgMCwgNDI5NDk2MTE1MSwgMywgMCwgMiwgMiwgMTksIDIsIDAsIDAsIDYwODE3NDA3OSwgMiwgMCwgMiwgMTMxLCAyLCA2LCAyLCA1NiwgLTEsIDIsIDM3LCAwLCA0Mjk0NDQzMjYzLCAyLCAxLCAzLCAwLCAzLCAwLCA0Mjk0OTAxNzExLCAyLCAzOSwgMCwgNDA4OTgzOTEwMywgMCwgMjk2MTIwOTc1OSwgMCwgMTM0MjQzOTM3NSwgMCwgNDI5NDU0MzM0MiwgMCwgMzU0NzIwMTAyMywgMCwgMTU3NzIwNDEwMywgMCwgNDE5NDI0MCwgMCwgNDI5NDY4ODc1MCwgMiwgMiwgMCwgODA4MzEsIDAsIDQyNjE0NzgzNTEsIDAsIDQyOTQ1NDk0ODYsIDIsIDIsIDAsIDI5Njc0ODQ4MzEsIDAsIDE5NjU1OSwgMCwgMzU5NDM3MzEwMCwgMCwgMzI4ODMxOTc2OCwgMCwgODQ2OTk1OSwgMiwgMTk0LCAyLCAzLCAwLCAzODI1MjA0NzM1LCAwLCAxMjM3NDc4MDcsIDAsIDY1NDg3LCAwLCA0Mjk0ODI4MDE1LCAwLCA0MDkyNTkxNjE1LCAwLCAxMDgwMDQ5MTE5LCAwLCA0NTg3MDMsIDIsIDMsIDIsIDAsIDAsIDIxNjMyNDQ1MTEsIDAsIDQyMjc5MjM5MTksIDAsIDQyMzYyNDcwMjIsIDIsIDY2LCAwLCA0Mjg0NDQ5OTE5LCAwLCA4NTE5MDQsIDIsIDQsIDIsIDExLCAwLCA2NzA3NjA5NSwgLTEsIDIsIDY3LCAwLCAxMDczNzQxNzQzLCAwLCA0MDkzNTkxMzkxLCAtMSwgMCwgNTAzMzE2NDksIDAsIDMyNjUyNjY2ODcsIDIsIDMyLCAwLCA0Mjk0ODQ0NDE1LCAwLCA0Mjc4MTkwMDQ3LCAyLCAxOCwgMiwgMTI5LCAtMSwgMywgMCwgMiwgMiwgMjEsIDIsIDAsIDIsIDksIDIsIDAsIDIsIDE0LCAyLCAxNSwgMywgMCwgMTAsIDIsIDY5LCAyLCAwLCAyLCA3MCwgMiwgNzEsIDIsIDcyLCAyLCAwLCAyLCA3MywgMiwgMCwgMiwgMTAsIDAsIDI2MTYzMiwgMiwgMjMsIDMsIDAsIDIsIDIsIDEyLCAyLCA0LCAzLCAwLCAxOCwgMiwgNzQsIDIsIDUsIDMsIDAsIDIsIDIsIDc1LCAwLCAyMDg4OTU5LCAyLCAyNywgMiwgOCwgMCwgOTA5MzExLCAzLCAwLCAyLCAwLCA4MTQ3NDM1NTEsIDIsIDQxLCAwLCA2NzA1NzY2NCwgMywgMCwgMiwgMiwgNDAsIDIsIDAsIDIsIDI4LCAyLCAwLCAyLCAyOSwgMiwgNywgMCwgMjY4Mzc0MDE1LCAyLCAyNiwgMiwgNDksIDIsIDAsIDIsIDc2LCAwLCAxMzQxNTMyMTUsIC0xLCAyLCA2LCAyLCAwLCAyLCA3LCAwLCAyNjg0MzU0NTU5LCAwLCA2NzA0NDM1MSwgMCwgMzIyMTE2MDA2NCwgMCwgMSwgLTEsIDMsIDAsIDIsIDIsIDQyLCAwLCAxMDQ2NTI4LCAzLCAwLCAzLCAyLCA4LCAyLCAwLCAyLCA1MSwgMCwgNDI5NDk2MDEyNywgMiwgOSwgMiwgMzgsIDIsIDEwLCAwLCA0Mjk0Mzc3NDcyLCAyLCAxMSwgMywgMCwgNywgMCwgNDIyNzg1ODQzMSwgMywgMCwgOCwgMiwgMTIsIDIsIDAsIDIsIDc4LCAyLCA5LCAyLCAwLCAyLCA3OSwgMiwgODAsIDIsIDgxLCAtMSwgMiwgMTI0LCAwLCAxMDQ4NTc3LCAyLCA4MiwgMiwgMTMsIC0xLCAyLCAxMywgMCwgMTMxMDQyLCAyLCA4MywgMiwgODQsIDIsIDg1LCAyLCAwLCAyLCAzMywgLTgzLCAyLCAwLCAyLCA1MywgMiwgNywgMywgMCwgNCwgMCwgMTA0NjU1OSwgMiwgMCwgMiwgMTQsIDIsIDAsIDAsIDIxNDc1MTY2NzEsIDIsIDIwLCAzLCA4NiwgMiwgMiwgMCwgLTE2LCAyLCA4NywgMCwgNTI0MjIyNDYyLCAyLCA0LCAyLCAwLCAwLCA0MjY5ODAxNDcxLCAyLCA0LCAyLCAwLCAyLCAxNSwgMiwgNzcsIDIsIDE2LCAzLCAwLCAyLCAyLCA0NywgMiwgMCwgLTEsIDIsIDE3LCAtMTYsIDMsIDAsIDIwNiwgLTIsIDMsIDAsIDY1NSwgMiwgMTgsIDMsIDAsIDM2LCAyLCA2OCwgLTEsIDIsIDE3LCAyLCA5LCAzLCAwLCA4LCAyLCA4OSwgMiwgMTIxLCAyLCAwLCAwLCAzMjIwMjQyNDMxLCAzLCAwLCAzLCAyLCAxOSwgMiwgOTAsIDIsIDkxLCAzLCAwLCAyLCAyLCA5MiwgMiwgMCwgMiwgOTMsIDIsIDk0LCAyLCAwLCAwLCA0MzUxLCAyLCAwLCAyLCA4LCAzLCAwLCAyLCAwLCA2NzA0MzM5MSwgMCwgMzkwOTA5MTMyNywgMiwgMCwgMiwgMjIsIDIsIDgsIDIsIDE4LCAzLCAwLCAyLCAwLCA2NzA3NjA5NywgMiwgNywgMiwgMCwgMiwgMjAsIDAsIDY3MDU5NzExLCAwLCA0MjM2MjQ3MDM5LCAzLCAwLCAyLCAwLCA5Mzk1MjQxMDMsIDAsIDgxOTE5OTksIDIsIDk3LCAyLCA5OCwgMiwgMTUsIDIsIDIxLCAzLCAwLCAzLCAwLCA2NzA1NzY2MywgMywgMCwgMzQ5LCAyLCA5OSwgMiwgMTAwLCAyLCA2LCAtMjY0LCAzLCAwLCAxMSwgMiwgMjIsIDMsIDAsIDIsIDIsIDMxLCAtMSwgMCwgMzc3NDM0OTQzOSwgMiwgMTAxLCAyLCAxMDIsIDMsIDAsIDIsIDIsIDE5LCAyLCAxMDMsIDMsIDAsIDEwLCAyLCA5LCAyLCAxNywgMiwgMCwgMiwgNDUsIDIsIDAsIDIsIDMwLCAyLCAxMDQsIDIsIDIzLCAwLCAxNjM4Mzk5LCAyLCAxNzIsIDIsIDEwNSwgMywgMCwgMywgMiwgMTgsIDIsIDI0LCAyLCAyNSwgMiwgNSwgMiwgMjYsIDIsIDAsIDIsIDcsIDIsIDEwNiwgLTEsIDIsIDEwNywgMiwgMTA4LCAyLCAxMDksIC0xLCAzLCAwLCAzLCAyLCAxMSwgLTIsIDIsIDAsIDIsIDI3LCAtMywgMiwgMTUwLCAtNCwgMiwgMTgsIDIsIDAsIDIsIDM1LCAwLCAxLCAyLCAwLCAyLCA2MiwgMiwgMjgsIDIsIDExLCAyLCA5LCAyLCAwLCAyLCAxMTAsIC0xLCAzLCAwLCA0LCAyLCA5LCAyLCAyMSwgMiwgMTExLCAyLCA2LCAyLCAwLCAyLCAxMTIsIDIsIDAsIDIsIDQ4LCAtNCwgMywgMCwgOSwgMiwgMjAsIDIsIDI5LCAyLCAzMCwgLTQsIDIsIDExMywgMiwgMTE0LCAyLCAyOSwgMiwgMjAsIDIsIDcsIC0yLCAyLCAxMTUsIDIsIDI5LCAyLCAzMSwgLTIsIDIsIDAsIDIsIDExNiwgLTIsIDAsIDQyNzcxMzc1MTksIDAsIDIyNjkxMTg0NjMsIC0xLCAzLCAxOCwgMiwgLTEsIDIsIDMyLCAyLCAzNiwgMiwgMCwgMywgMjksIDIsIDIsIDM0LCAyLCAxOSwgLTMsIDMsIDAsIDIsIDIsIDMzLCAtMSwgMiwgMCwgMiwgMzQsIDIsIDAsIDIsIDM0LCAyLCAwLCAyLCA0NiwgLTEwLCAyLCAwLCAwLCAyMDM3NzUsIC0yLCAyLCAxOCwgMiwgNDMsIDIsIDM1LCAtMiwgMiwgMTcsIDIsIDExNywgMiwgMjAsIDMsIDAsIDIsIDIsIDM2LCAwLCAyMTQ3NTQ5MTIwLCAyLCAwLCAyLCAxMSwgMiwgMTcsIDIsIDEzNSwgMiwgMCwgMiwgMzcsIDIsIDUyLCAwLCA1MjQyODc5LCAzLCAwLCAyLCAwLCA0MDI2NDQ1MTEsIC0xLCAyLCAxMjAsIDAsIDEwOTA1MTkwMzksIC0yLCAyLCAxMjIsIDIsIDM4LCAyLCAwLCAwLCA2NzA0NTM3NSwgMiwgMzksIDAsIDQyMjY2NzgyNzEsIDAsIDM3NjY1NjUyNzksIDAsIDIwMzk3NTksIC00LCAzLCAwLCAyLCAwLCAzMjg4MjcwODQ3LCAwLCAzLCAzLCAwLCAyLCAwLCA2NzA0MzUxOSwgLTUsIDIsIDAsIDAsIDQyODIzODQzODMsIDAsIDEwNTY5NjQ2MDksIC0xLCAzLCAwLCAyLCAwLCA2NzA0MzM0NSwgLTEsIDIsIDAsIDIsIDQwLCAyLCA0MSwgLTEsIDIsIDEwLCAyLCA0MiwgLTYsIDIsIDAsIDIsIDExLCAtMywgMywgMCwgMiwgMCwgMjE0NzQ4NDY3MSwgMiwgMTI1LCAwLCA0MTkwMTA5Njk1LCAyLCA1MCwgLTIsIDIsIDEyNiwgMCwgNDI0NDYzNTY0NywgMCwgMjcsIDIsIDAsIDIsIDcsIDIsIDQzLCAyLCAwLCAyLCA2MywgLTEsIDIsIDAsIDIsIDQwLCAtOCwgMiwgNTQsIDIsIDQ0LCAwLCA2NzA0MzMyOSwgMiwgMTI3LCAyLCA0NSwgMCwgODM4ODM1MSwgLTIsIDIsIDEyOCwgMCwgMzAyODI4NzQ4NywgMiwgNDYsIDIsIDEzMCwgMCwgMzMyNTk1MTksIDIsIDQxLCAtOSwgMiwgMjAsIC01LCAyLCA2NCwgLTIsIDMsIDAsIDI4LCAyLCAzMSwgLTMsIDMsIDAsIDMsIDIsIDQ3LCAzLCAwLCA2LCAyLCA0OCwgLTg1LCAzLCAwLCAzMywgMiwgNDcsIC0xMjYsIDMsIDAsIDE4LCAyLCAzNiwgLTI2OSwgMywgMCwgMTcsIDIsIDQwLCAyLCA3LCAyLCA0MSwgLTIsIDIsIDE3LCAyLCA0OSwgMiwgMCwgMiwgMjAsIDIsIDUwLCAyLCAxMzIsIDIsIDIzLCAtMjEsIDMsIDAsIDIsIC00LCAzLCAwLCAyLCAwLCA0Mjk0OTM2NTc1LCAyLCAwLCAwLCA0Mjk0OTM0NzgzLCAtMiwgMCwgMTk2NjM1LCAzLCAwLCAxOTEsIDIsIDUxLCAzLCAwLCAzOCwgMiwgMjksIC0xLCAyLCAzMywgLTI3OSwgMywgMCwgOCwgMiwgNywgLTEsIDIsIDEzMywgMiwgNTIsIDMsIDAsIDExLCAyLCA2LCAtNzIsIDMsIDAsIDMsIDIsIDEzNCwgMCwgMTY3NzY1NjU3NSwgLTE2NiwgMCwgNDE2MTI2NjY1NiwgMCwgNDA3MSwgMCwgMTUzNjAsIC00LCAwLCAyOCwgLTEzLCAzLCAwLCAyLCAyLCAzNywgMiwgMCwgMiwgMTM2LCAyLCAxMzcsIDIsIDU1LCAyLCAwLCAyLCAxMzgsIDIsIDEzOSwgMiwgMTQwLCAzLCAwLCAxMCwgMiwgMTQxLCAyLCAxNDIsIDIsIDE1LCAzLCAzNywgMiwgMywgNTMsIDIsIDMsIDU0LCAyLCAwLCA0Mjk0OTU0OTk5LCAyLCAwLCAtMTYsIDIsIDAsIDIsIDg4LCAyLCAwLCAwLCAyMTA1MzQzLCAwLCA0MTYwNzQ5NTg0LCAwLCA2NTUzNCwgLTQyLCAwLCA0MTk0MzAzODcxLCAwLCAyMDExLCAtNiwgMiwgMCwgMCwgMTA3MzY4NDQ3OSwgMCwgMTc0MDcsIC0xMSwgMiwgMCwgMiwgMzEsIC00MCwgMywgMCwgNiwgMCwgODMyMzEwMywgLTEsIDMsIDAsIDIsIDIsIDQyLCAtMzcsIDIsIDU1LCAyLCAxNDQsIDIsIDE0NSwgMiwgMTQ2LCAyLCAxNDcsIDIsIDE0OCwgLTEwNSwgMiwgMjQsIC0zMiwgMywgMCwgMTMzNCwgMiwgOSwgLTEsIDMsIDAsIDEyOSwgMiwgMjcsIDMsIDAsIDYsIDIsIDksIDMsIDAsIDE4MCwgMiwgMTQ5LCAzLCAwLCAyMzMsIDAsIDEsIC05NiwgMywgMCwgMTYsIDIsIDksIC00NywgMywgMCwgMTU0LCAyLCA1NiwgLTIyMzgxLCAzLCAwLCA3LCAyLCAyMywgLTYxMzAsIDMsIDUsIDIsIC0xLCAwLCA2OTIwNzA0MCwgMywgNDQsIDIsIDMsIDAsIDE0LCAyLCA1NywgMiwgNTgsIC0zLCAwLCAzMTY4NzMxMTM2LCAwLCA0Mjk0OTU2ODY0LCAyLCAxLCAyLCAwLCAyLCA1OSwgMywgMCwgNCwgMCwgNDI5NDk2NjI3NSwgMywgMCwgNCwgMiwgMTYsIDIsIDYwLCAyLCAwLCAyLCAzMywgLTEsIDIsIDE3LCAyLCA2MSwgLTEsIDIsIDAsIDIsIDU2LCAwLCA0Mjk0ODg1Mzc2LCAzLCAwLCAyLCAwLCAzMTQ1NzI3LCAwLCAyNjE3Mjk0OTQ0LCAwLCA0Mjk0NzcwNjg4LCAyLCAyMywgMiwgNjIsIDMsIDAsIDIsIDAsIDEzMTEzNSwgMiwgOTUsIDAsIDcwMjU2NjM5LCAwLCA3MTMwMzE2NywgMCwgMjcyLCAyLCA0MCwgMiwgNTYsIC0xLCAyLCAzNywgMiwgMzAsIC0xLCAyLCA5NiwgMiwgNjMsIDAsIDQyNzgyNTU2MTYsIDAsIDQyOTQ4MzYyMjcsIDAsIDQyOTQ1NDk0NzMsIDAsIDYwMDE3ODE3NSwgMCwgMjk1MjgwNjQwMCwgMCwgMjY4NjMyMDY3LCAwLCA0Mjk0NTQzMzI4LCAwLCA1NzU0MDA5NSwgMCwgMTU3NzA1ODMwNCwgMCwgMTgzNTAwOCwgMCwgNDI5NDY4ODczNiwgMiwgNjUsIDIsIDY0LCAwLCAzMzU1NDQzNSwgMiwgMTIzLCAyLCA2NSwgMiwgMTUxLCAwLCAxMzEwNzUsIDAsIDM1OTQzNzMwOTYsIDAsIDY3MDk0Mjk2LCAyLCA2NCwgLTEsIDAsIDQyOTQ4MjgwMDAsIDAsIDYwMzk3OTI2MywgMiwgMTYwLCAwLCAzLCAwLCA0Mjk0ODI4MDAxLCAwLCA2MDI5MzA2ODcsIDIsIDE4MywgMCwgMzkzMjE5LCAwLCA0Mjk0ODI4MDE2LCAwLCA2NzEwODg2MzksIDAsIDIxNTQ4NDAwNjQsIDAsIDQyMjc4NTg0MzUsIDAsIDQyMzYyNDcwMDgsIDIsIDY2LCAyLCAzNiwgLTEsIDIsIDQsIDAsIDkxNzUwMywgMiwgMzYsIC0xLCAyLCA2NywgMCwgNTM3Nzg4MzM1LCAwLCA0MDI2NTMxOTM1LCAtMSwgMCwgMSwgLTEsIDIsIDMyLCAyLCA2OCwgMCwgNzkzNiwgLTMsIDIsIDAsIDAsIDIxNDc0ODU2OTUsIDAsIDEwMTA3NjE3MjgsIDAsIDQyOTI5ODQ5MzAsIDAsIDE2Mzg3LCAyLCAwLCAyLCAxNCwgMiwgMTUsIDMsIDAsIDEwLCAyLCA2OSwgMiwgMCwgMiwgNzAsIDIsIDcxLCAyLCA3MiwgMiwgMCwgMiwgNzMsIDIsIDAsIDIsIDExLCAtMSwgMiwgMjMsIDMsIDAsIDIsIDIsIDEyLCAyLCA0LCAzLCAwLCAxOCwgMiwgNzQsIDIsIDUsIDMsIDAsIDIsIDIsIDc1LCAwLCAyNTM5NTEsIDMsIDE5LCAyLCAwLCAxMjI4NzksIDIsIDAsIDIsIDgsIDAsIDI3NjgyNDA2NCwgLTIsIDMsIDAsIDIsIDIsIDQwLCAyLCAwLCAwLCA0Mjk0OTAzMjk1LCAyLCAwLCAyLCAyOSwgMiwgNywgLTEsIDIsIDE3LCAyLCA0OSwgMiwgMCwgMiwgNzYsIDIsIDQxLCAtMSwgMiwgMjAsIDIsIDAsIDIsIDI3LCAtMiwgMCwgMTI4LCAtMiwgMiwgNzcsIDIsIDgsIDAsIDQwNjQsIC0xLCAyLCAxMTksIDAsIDQyMjc5MDc1ODUsIDIsIDAsIDIsIDExOCwgMiwgMCwgMiwgNDgsIDIsIDE3MywgMiwgOSwgMiwgMzgsIDIsIDEwLCAtMSwgMCwgNzQ0NDAxOTIsIDMsIDAsIDYsIC0yLCAzLCAwLCA4LCAyLCAxMiwgMiwgMCwgMiwgNzgsIDIsIDksIDIsIDAsIDIsIDc5LCAyLCA4MCwgMiwgODEsIC0zLCAyLCA4MiwgMiwgMTMsIC0zLCAyLCA4MywgMiwgODQsIDIsIDg1LCAyLCAwLCAyLCAzMywgLTgzLCAyLCAwLCAyLCA1MywgMiwgNywgMywgMCwgNCwgMCwgODE3MTgzLCAyLCAwLCAyLCAxNCwgMiwgMCwgMCwgMzMwMjMsIDIsIDIwLCAzLCA4NiwgMiwgLTE3LCAyLCA4NywgMCwgNTI0MTU3OTUwLCAyLCA0LCAyLCAwLCAyLCA4OCwgMiwgNCwgMiwgMCwgMiwgMTUsIDIsIDc3LCAyLCAxNiwgMywgMCwgMiwgMiwgNDcsIDIsIDAsIC0xLCAyLCAxNywgLTE2LCAzLCAwLCAyMDYsIC0yLCAzLCAwLCA2NTUsIDIsIDE4LCAzLCAwLCAzNiwgMiwgNjgsIC0xLCAyLCAxNywgMiwgOSwgMywgMCwgOCwgMiwgODksIDAsIDMwNzIsIDIsIDAsIDAsIDIxNDc1MTY0MTUsIDIsIDksIDMsIDAsIDIsIDIsIDIzLCAyLCA5MCwgMiwgOTEsIDMsIDAsIDIsIDIsIDkyLCAyLCAwLCAyLCA5MywgMiwgOTQsIDAsIDQyOTQ5NjUxNzksIDAsIDcsIDIsIDAsIDIsIDgsIDIsIDkxLCAyLCA4LCAtMSwgMCwgMTc2MTM0NTUzNiwgMiwgOTUsIDAsIDQyOTQ5MDE4MjMsIDIsIDM2LCAyLCAxOCwgMiwgOTYsIDIsIDM0LCAyLCAxNjYsIDAsIDIwODA0NDAyODcsIDIsIDAsIDIsIDMzLCAyLCAxNDMsIDAsIDMyOTY3MjI5NDMsIDIsIDAsIDAsIDEwNDY2NzU0NTUsIDAsIDkzOTUyNDEwMSwgMCwgMTgzNzA1NSwgMiwgOTcsIDIsIDk4LCAyLCAxNSwgMiwgMjEsIDMsIDAsIDMsIDAsIDcsIDMsIDAsIDM0OSwgMiwgOTksIDIsIDEwMCwgMiwgNiwgLTI2NCwgMywgMCwgMTEsIDIsIDIyLCAzLCAwLCAyLCAyLCAzMSwgLTEsIDAsIDI3MDA2MDc2MTUsIDIsIDEwMSwgMiwgMTAyLCAzLCAwLCAyLCAyLCAxOSwgMiwgMTAzLCAzLCAwLCAxMCwgMiwgOSwgMiwgMTcsIDIsIDAsIDIsIDQ1LCAyLCAwLCAyLCAzMCwgMiwgMTA0LCAtMywgMiwgMTA1LCAzLCAwLCAzLCAyLCAxOCwgLTEsIDMsIDUsIDIsIDIsIDI2LCAyLCAwLCAyLCA3LCAyLCAxMDYsIC0xLCAyLCAxMDcsIDIsIDEwOCwgMiwgMTA5LCAtMSwgMywgMCwgMywgMiwgMTEsIC0yLCAyLCAwLCAyLCAyNywgLTgsIDIsIDE4LCAyLCAwLCAyLCAzNSwgLTEsIDIsIDAsIDIsIDYyLCAyLCAyOCwgMiwgMjksIDIsIDksIDIsIDAsIDIsIDExMCwgLTEsIDMsIDAsIDQsIDIsIDksIDIsIDE3LCAyLCAxMTEsIDIsIDYsIDIsIDAsIDIsIDExMiwgMiwgMCwgMiwgNDgsIC00LCAzLCAwLCA5LCAyLCAyMCwgMiwgMjksIDIsIDMwLCAtNCwgMiwgMTEzLCAyLCAxMTQsIDIsIDI5LCAyLCAyMCwgMiwgNywgLTIsIDIsIDExNSwgMiwgMjksIDIsIDMxLCAtMiwgMiwgMCwgMiwgMTE2LCAtMiwgMCwgNDI3NzA3NTk2OSwgMiwgMjksIC0xLCAzLCAxOCwgMiwgLTEsIDIsIDMyLCAyLCAxMTcsIDIsIDAsIDMsIDI5LCAyLCAyLCAzNCwgMiwgMTksIC0zLCAzLCAwLCAyLCAyLCAzMywgLTEsIDIsIDAsIDIsIDM0LCAyLCAwLCAyLCAzNCwgMiwgMCwgMiwgNDgsIC0xMCwgMiwgMCwgMCwgMTk3NjMxLCAtMiwgMiwgMTgsIDIsIDQzLCAyLCAxMTgsIC0yLCAyLCAxNywgMiwgMTE3LCAyLCAyMCwgMiwgMTE5LCAyLCA1MSwgLTIsIDIsIDExOSwgMiwgMjMsIDIsIDE3LCAyLCAzMywgMiwgMTE5LCAyLCAzNiwgMCwgNDI5NDkwMTkwNCwgMCwgNDcxODU5MSwgMiwgMTE5LCAyLCAzNCwgMCwgMzM1NTQ0MzUwLCAtMSwgMiwgMTIwLCAyLCAxMjEsIC0yLCAyLCAxMjIsIDIsIDM4LCAyLCA3LCAtMSwgMiwgMTIzLCAyLCA2NSwgMCwgMzc1ODE2MTkyMCwgMCwgMywgLTQsIDIsIDAsIDIsIDI3LCAwLCAyMTQ3NDg1NTY4LCAwLCAzLCAyLCAwLCAyLCAyMywgMCwgMTc2LCAtNSwgMiwgMCwgMiwgNDcsIDIsIDE4NiwgLTEsIDIsIDAsIDIsIDIzLCAyLCAxOTcsIC0xLCAyLCAwLCAwLCAxNjc3OTI2MywgLTIsIDIsIDExLCAtNywgMiwgMCwgMiwgMTIxLCAtMywgMywgMCwgMiwgMiwgMTI0LCAyLCAxMjUsIDAsIDIxNDc1NDkxODMsIDAsIDIsIC0yLCAyLCAxMjYsIDIsIDM1LCAwLCAxMCwgMCwgNDI5NDk2NTI0OSwgMCwgNjc2MzMxNTEsIDAsIDQwMjY1OTczNzYsIDIsIDAsIDAsIDUzNjg3MTkzNSwgLTEsIDIsIDAsIDIsIDQwLCAtOCwgMiwgNTQsIDIsIDQ3LCAwLCAxLCAyLCAxMjcsIDIsIDIzLCAtMywgMiwgMTI4LCAyLCAzNSwgMiwgMTI5LCAyLCAxMzAsIDAsIDE2Nzc4MjM5LCAtMTAsIDIsIDM0LCAtNSwgMiwgNjQsIC0yLCAzLCAwLCAyOCwgMiwgMzEsIC0zLCAzLCAwLCAzLCAyLCA0NywgMywgMCwgNiwgMiwgNDgsIC04NSwgMywgMCwgMzMsIDIsIDQ3LCAtMTI2LCAzLCAwLCAxOCwgMiwgMzYsIC0yNjksIDMsIDAsIDE3LCAyLCA0MCwgMiwgNywgLTMsIDIsIDE3LCAyLCAxMzEsIDIsIDAsIDIsIDIzLCAyLCA0OCwgMiwgMTMyLCAyLCAyMywgLTIxLCAzLCAwLCAyLCAtNCwgMywgMCwgMiwgMCwgNjc1ODMsIC0xLCAyLCAxMDMsIC0yLCAwLCAxMSwgMywgMCwgMTkxLCAyLCA1MSwgMywgMCwgMzgsIDIsIDI5LCAtMSwgMiwgMzMsIC0yNzksIDMsIDAsIDgsIDIsIDcsIC0xLCAyLCAxMzMsIDIsIDUyLCAzLCAwLCAxMSwgMiwgNiwgLTcyLCAzLCAwLCAzLCAyLCAxMzQsIDIsIDEzNSwgLTE4NywgMywgMCwgMiwgMiwgMzcsIDIsIDAsIDIsIDEzNiwgMiwgMTM3LCAyLCA1NSwgMiwgMCwgMiwgMTM4LCAyLCAxMzksIDIsIDE0MCwgMywgMCwgMTAsIDIsIDE0MSwgMiwgMTQyLCAyLCAxNSwgMywgMzcsIDIsIDMsIDUzLCAyLCAzLCA1NCwgMiwgMiwgMTQzLCAtNzMsIDIsIDAsIDAsIDEwNjUzNjE0MDcsIDAsIDE2Mzg0LCAtMTEsIDIsIDAsIDIsIDEyMSwgLTQwLCAzLCAwLCA2LCAyLCAxMTcsIC0xLCAzLCAwLCAyLCAwLCAyMDYzLCAtMzcsIDIsIDU1LCAyLCAxNDQsIDIsIDE0NSwgMiwgMTQ2LCAyLCAxNDcsIDIsIDE0OCwgLTEzOCwgMywgMCwgMTMzNCwgMiwgOSwgLTEsIDMsIDAsIDEyOSwgMiwgMjcsIDMsIDAsIDYsIDIsIDksIDMsIDAsIDE4MCwgMiwgMTQ5LCAzLCAwLCAyMzMsIDAsIDEsIC05NiwgMywgMCwgMTYsIDIsIDksIC00NywgMywgMCwgMTU0LCAyLCA1NiwgLTI4NTE3LCAyLCAwLCAwLCAxLCAtMSwgMiwgMTI0LCAyLCAwLCAwLCA4MTkzLCAtMjEsIDIsIDE5MywgMCwgMTAyNTUsIDAsIDQsIC0xMSwgMiwgNjQsIDIsIDE3MSwgLTEsIDAsIDcxNjgwLCAtMSwgMiwgMTYxLCAwLCA0MjkyOTAwODY0LCAwLCA4MDUzMDY0MzEsIC01LCAyLCAxNTAsIC0xLCAyLCAxNTcsIC0xLCAwLCA2MTQ0LCAtMiwgMiwgMTI3LCAtMSwgMiwgMTU0LCAtMSwgMCwgMjE0NzUzMjgwMCwgMiwgMTUxLCAyLCAxNjUsIDIsIDAsIDIsIDE2NCwgMCwgNTI0MDMyLCAwLCA0LCAtNCwgMiwgMTkwLCAwLCAyMDUxMjgxOTIsIDAsIDEzMzM3NTc1MzYsIDAsIDIxNDc0ODM2OTYsIDAsIDQyMzk1MywgMCwgNzQ3NzY2MjcyLCAwLCAyNzE3NzYzMTkyLCAwLCA0Mjg2NTc4NzUxLCAwLCAyNzg1NDUsIDIsIDE1MiwgMCwgNDI5NDg4NjQ2NCwgMCwgMzMyOTIzMzYsIDAsIDQxNzgwOSwgMiwgMTUyLCAwLCAxMzI3NDgyNDY0LCAwLCA0Mjc4MTkwMTI4LCAwLCA3MDA1OTQxOTUsIDAsIDEwMDY2NDc1MjcsIDAsIDQyODY0OTczMzYsIDAsIDQxNjA3NDk2MzEsIDIsIDE1MywgMCwgNDY5NzYyNTYwLCAwLCA0MTcxMjE5NDg4LCAwLCA4MzIzMTIwLCAyLCAxNTMsIDAsIDIwMjM3NTY4MCwgMCwgMzIxNDkxODE3NiwgMCwgNDI5NDUwODU5MiwgMiwgMTUzLCAtMSwgMCwgOTgzNTg0LCAwLCA0OCwgMCwgNTg3MjAyNzMsIDAsIDM0ODk5MjMwNzIsIDAsIDEwNTE3Mzc2LCAwLCA0MjkzMDY2ODE1LCAwLCAxLCAwLCAyMDEzMjY1OTIwLCAyLCAxNzcsIDIsIDAsIDAsIDIwODksIDAsIDMyMjEyMjU1NTIsIDAsIDIwMTM3NTkwNCwgMiwgMCwgLTIsIDAsIDI1NiwgMCwgMTIyODgwLCAwLCAxNjc3NzIxNiwgMiwgMTUwLCAwLCA0MTYwNzU3NzYwLCAyLCAwLCAtNiwgMiwgMTY3LCAtMTEsIDAsIDMyNjMyMTgxNzYsIC0xLCAwLCA0OTY2NCwgMCwgMjE2MDE5NzYzMiwgMCwgODM4ODgwMiwgLTEsIDAsIDEyNzEzOTg0LCAtMSwgMiwgMTU0LCAyLCAxNTksIDIsIDE3OCwgLTIsIDIsIDE2MiwgLTIwLCAwLCAzNzU4MDk2Mzg1LCAtMiwgMiwgMTU1LCAwLCA0MjkyODc4MzM2LCAyLCA5MCwgMiwgMTY5LCAwLCA0Mjk0MDU3OTg0LCAtMiwgMiwgMTYzLCAyLCAxNTYsIDIsIDE3NSwgLTIsIDIsIDE1NSwgLTEsIDIsIDE4MiwgLTEsIDIsIDE3MCwgMiwgMTI0LCAwLCA0MDI2NTkzMjgwLCAwLCAxNCwgMCwgNDI5MjkxOTI5NiwgLTEsIDIsIDE1OCwgMCwgOTM5NTg4NjA4LCAtMSwgMCwgODA1MzA2MzY4LCAtMSwgMiwgMTI0LCAwLCAxNjEwNjEyNzM2LCAyLCAxNTYsIDIsIDE1NywgMiwgNCwgMiwgMCwgLTIsIDIsIDE1OCwgMiwgMTU5LCAtMywgMCwgMjY3Mzg2ODgwLCAtMSwgMiwgMTYwLCAwLCA3MTY4LCAtMSwgMCwgNjUwMjQsIDIsIDE1NCwgMiwgMTYxLCAyLCAxNzksIC03LCAyLCAxNjgsIC04LCAyLCAxNjIsIC0xLCAwLCAxNDI2MTEyNzA0LCAyLCAxNjMsIC0xLCAyLCAxNjQsIDAsIDI3MTU4MTIxNiwgMCwgMjE0OTc3NzQwOCwgMiwgMjMsIDIsIDE2MSwgMiwgMTI0LCAwLCA4NTE5NjcsIDIsIDE4MCwgLTEsIDIsIDIzLCAyLCAxODEsIC00LCAyLCAxNTgsIC0yMCwgMiwgMTk1LCAyLCAxNjUsIC01NiwgMCwgMzE0NTcyOCwgMiwgMTg1LCAtNCwgMiwgMTY2LCAyLCAxMjQsIC00LCAwLCAzMjUwNTg1NiwgLTEsIDIsIDE2NywgLTEsIDAsIDIxNDczODUwODgsIDIsIDkwLCAxLCAyMTU1OTA1MTUyLCAyLCAtMywgMiwgMTAzLCAyLCAwLCAyLCAxNjgsIC0yLCAyLCAxNjksIC02LCAyLCAxNzAsIDAsIDQwMjY1OTczNzUsIDAsIDEsIC0xLCAwLCAxLCAtMSwgMiwgMTcxLCAtMywgMiwgMTE3LCAyLCA2NCwgLTIsIDIsIDE2NiwgLTIsIDIsIDE3NiwgMiwgMTI0LCAtODc4LCAyLCAxNTksIC0zNiwgMiwgMTcyLCAtMSwgMiwgMjAxLCAtMTAsIDIsIDE4OCwgLTUsIDIsIDE3NCwgLTYsIDAsIDQyOTQ5NjUyNTEsIDIsIDI3LCAtMSwgMiwgMTczLCAtMSwgMiwgMTc0LCAtMiwgMCwgNDIyNzg3NDc1MiwgLTMsIDAsIDIxNDY0MzUwNzIsIDIsIDE1OSwgLTIsIDAsIDEwMDY2NDkzNDQsIDIsIDEyNCwgLTEsIDIsIDkwLCAwLCAyMDEzNzU3NDQsIC0zLCAwLCAxMzQyMTc3MjAsIDIsIDkwLCAwLCA0Mjg2Njc3Mzc3LCAwLCAzMjg5NiwgLTEsIDIsIDE1OCwgLTMsIDIsIDE3NSwgLTM0OSwgMiwgMTc2LCAwLCAxOTIwLCAyLCAxNzcsIDMsIDAsIDI2NCwgLTExLCAyLCAxNTcsIC0yLCAyLCAxNzgsIDIsIDAsIDAsIDUyMDYxNzg1NiwgMCwgMjY5Mjc0MzE2OCwgMCwgMzYsIC0zLCAwLCA1MjQyODQsIC0xMSwgMiwgMjMsIC0xLCAyLCAxODcsIC0xLCAyLCAxODQsIDAsIDMyMjEyOTEwMDcsIDIsIDE3OCwgLTEsIDIsIDIwMiwgMCwgMjE1ODcyMCwgLTMsIDIsIDE1OSwgMCwgMSwgLTQsIDIsIDEyNCwgMCwgMzgwODYyNTQxMSwgMCwgMzQ4OTYyODI4OCwgMiwgMjAwLCAwLCAxMjA3OTU5NjgwLCAwLCAzMjIxMjc0NjI0LCAyLCAwLCAtMywgMiwgMTc5LCAwLCAxMjAsIDAsIDczNDAwMzIsIC0yLCAyLCAxODAsIDIsIDQsIDIsIDIzLCAyLCAxNjMsIDMsIDAsIDQsIDIsIDE1OSwgLTEsIDIsIDE4MSwgMiwgMTc3LCAtMSwgMCwgODE3NiwgMiwgMTgyLCAyLCAxNzksIDIsIDE4MywgLTEsIDAsIDQyOTA3NzMyMzIsIDIsIDAsIC00LCAyLCAxNjMsIDIsIDE4OSwgMCwgMTU3Mjg2NDAsIDIsIDE3NywgLTEsIDIsIDE2MSwgLTEsIDAsIDQyOTQ5MzQ1MTIsIDMsIDAsIDQsIC05LCAyLCA5MCwgMiwgMTcwLCAyLCAxODQsIDMsIDAsIDQsIDAsIDcwNCwgMCwgMTg0OTY4ODA2NCwgMiwgMTg1LCAtMSwgMiwgMTI0LCAwLCA0Mjk0OTAxODg3LCAyLCAwLCAwLCAxMzA1NDc3MTIsIDAsIDE4NzkwNDgxOTIsIDIsIDE5OSwgMywgMCwgMiwgLTEsIDIsIDE4NiwgMiwgMTg3LCAtMSwgMCwgMTc4Mjk3NzYsIDAsIDIwMjU4NDg4MzIsIDAsIDQyNjE0Nzc4ODgsIC0yLCAyLCAwLCAtMSwgMCwgNDI4NjU4MDYwOCwgLTEsIDAsIDI5MzYwMTI4LCAyLCAxOTIsIDAsIDE2MjUyOTI4LCAwLCAzNzkxMzg4NjcyLCAyLCAzOCwgMywgMCwgMiwgLTIsIDIsIDE5NiwgMiwgMCwgLTEsIDIsIDEwMywgLTEsIDAsIDY2NTg0NTc2LCAtMSwgMiwgMTkxLCAzLCAwLCA5LCAyLCAxMjQsIC0xLCAwLCA0Mjk0NzU1MzI4LCAzLCAwLCAyLCAtMSwgMiwgMTYxLCAyLCAxNzgsIDMsIDAsIDIsIDIsIDIzLCAyLCAxODgsIDIsIDkwLCAtMiwgMCwgMjQ1NzYwLCAwLCAyMTQ3NDE4MTEyLCAtMSwgMiwgMTUwLCAyLCAyMDMsIDAsIDQyMjc5MjM0NTYsIC0xLCAyLCAxNjQsIDIsIDE2MSwgMiwgOTAsIC0zLCAwLCA0MjkyODcwMTQ1LCAwLCAyNjIxNDQsIDIsIDEyNCwgMywgMCwgMiwgMCwgMTA3Mzc1ODg0OCwgMiwgMTg5LCAtMSwgMCwgNDIyNzkyMTkyMCwgMiwgMTkwLCAwLCA2ODI4OTAyNCwgMCwgNTI4NDAyMDE2LCAwLCA0MjkyOTI3NTM2LCAzLCAwLCA0LCAtMiwgMCwgMjY4NDM1NDU2LCAyLCA5MSwgLTIsIDIsIDE5MSwgMywgMCwgNSwgLTEsIDIsIDE5MiwgMiwgMTYzLCAyLCAwLCAtMiwgMCwgNDIyNzkyMzkzNiwgMiwgNjIsIC0xLCAyLCAxNTUsIDIsIDk1LCAyLCAwLCAyLCAxNTQsIDIsIDE1OCwgMywgMCwgNiwgLTEsIDIsIDE3NywgMywgMCwgMywgLTIsIDAsIDIxNDY5NTkzNjAsIDAsIDk0NDA2NDAsIDAsIDEwNDg1NzYwMCwgMCwgNDIyNzkyMzg0MCwgMywgMCwgMiwgMCwgNzY4LCAyLCAxOTMsIDIsIDc3LCAtMiwgMiwgMTYxLCAtMiwgMiwgMTE5LCAtMSwgMiwgMTU1LCAzLCAwLCA4LCAwLCA1MTIsIDAsIDgzODg2MDgsIDIsIDE5NCwgMiwgMTcyLCAyLCAxODcsIDAsIDQyODY1Nzg5NDQsIDMsIDAsIDIsIDAsIDExNTIsIDAsIDEyNjY2Nzk4MDgsIDIsIDE5MSwgMCwgNTc2LCAwLCA0MjYxNzA3Nzc2LCAyLCA5NSwgMywgMCwgOSwgMiwgMTU1LCAzLCAwLCA1LCAyLCAxNiwgLTEsIDAsIDIxNDcyMjE1MDQsIC0yOCwgMiwgMTc4LCAzLCAwLCAzLCAtMywgMCwgNDI5MjkwMjkxMiwgLTYsIDIsIDk2LCAzLCAwLCA4NSwgLTMzLCAwLCA0Mjk0OTM0NTI4LCAzLCAwLCAxMjYsIC0xOCwgMiwgMTk1LCAzLCAwLCAyNjksIC0xNywgMiwgMTU1LCAyLCAxMjQsIDIsIDE5OCwgMywgMCwgMiwgMiwgMjMsIDAsIDQyOTA4MjIxNDQsIC0yLCAwLCA2NzE3NDMzNiwgMCwgNTIwMDkzNzAwLCAyLCAxNywgMywgMCwgMjEsIC0yLCAyLCAxNzksIDMsIDAsIDMsIC0yLCAwLCAzMDcyMCwgLTEsIDAsIDMyNTEyLCAzLCAwLCAyLCAwLCA0Mjk0NzcwNjU2LCAtMTkxLCAyLCAxNzQsIC0zOCwgMiwgMTcwLCAyLCAwLCAyLCAxOTYsIDMsIDAsIDI3OSwgLTgsIDIsIDEyNCwgMiwgMCwgMCwgNDI5NDUwODU0MywgMCwgNjUyOTUsIC0xMSwgMiwgMTc3LCAzLCAwLCA3MiwgLTMsIDAsIDM3NTgxNTk4NzIsIDAsIDIwMTM5MTYxNiwgMywgMCwgMTU1LCAtNywgMiwgMTcwLCAtMSwgMCwgMzg0LCAtMSwgMCwgMTMzNjkzNDQwLCAtMywgMiwgMTk2LCAtMiwgMiwgMjYsIDMsIDAsIDQsIDIsIDE2OSwgLTIsIDIsIDkwLCAyLCAxNTUsIDMsIDAsIDQsIC0yLCAyLCAxNjQsIC0xLCAyLCAxNTAsIDAsIDMzNTU1MjkyMywgMiwgMTk3LCAtMSwgMCwgNTM4OTc0MjcyLCAwLCAyMjE0NTkyNTEyLCAwLCAxMzIwMDAsIC0xMCwgMCwgMTkyLCAtOCwgMCwgMTIyODgsIC0yMSwgMCwgMTM0MjEzNjMyLCAwLCA0Mjk0OTAxNzYxLCAzLCAwLCA0MiwgMCwgMTAwNjYzNDI0LCAwLCA0Mjk0OTY1Mjg0LCAzLCAwLCA2LCAtMSwgMCwgMzIyMTI4MjgxNiwgMiwgMTk4LCAzLCAwLCAxMSwgLTEsIDIsIDE5OSwgMywgMCwgNDAsIC02LCAwLCA0Mjg2NTc4Nzg0LCAyLCAwLCAtMiwgMCwgMTAwNjY5NDQwMCwgMywgMCwgMjQsIDIsIDM1LCAtMSwgMiwgOTQsIDMsIDAsIDIsIDAsIDEsIDIsIDE2MywgMywgMCwgNiwgMiwgMTk3LCAwLCA0MTEwOTQyNTY5LCAwLCAxNDMyOTUwMTM5LCAwLCAyNzAxNjU4MjE3LCAwLCA0MDI2NTMyODY0LCAwLCA0MDI2NTMyODgxLCAyLCAwLCAyLCA0NSwgMywgMCwgOCwgLTEsIDIsIDE1OCwgLTIsIDIsIDE2OSwgMCwgOTgzMDQsIDAsIDY1NTM3LCAyLCAxNzAsIC01LCAwLCA0Mjk0OTUwOTEyLCAyLCAwLCAyLCAxMTgsIDAsIDY1NTI4LCAyLCAxNzcsIDAsIDQyOTQ3NzAxNzYsIDIsIDI2LCAzLCAwLCA0LCAtMzAsIDIsIDE3NCwgMCwgMzc1ODE1MzcyOCwgLTMsIDIsIDE2OSwgLTIsIDIsIDE1NSwgMiwgMTg4LCAyLCAxNTgsIC0xLCAyLCAxOTEsIC0xLCAyLCAxNjEsIDAsIDQyOTQ3NTQzMDQsIDMsIDAsIDIsIC0zLCAwLCAzMzU1NDQzMiwgLTIsIDIsIDIwMCwgLTMsIDIsIDE2OSwgMCwgNDE3NTQ3ODc4NCwgMiwgMjAxLCAwLCA0Mjg2NjQzNzEyLCAwLCA0Mjg2NjQ0MjE2LCAyLCAwLCAtNCwgMiwgMjAyLCAtMSwgMiwgMTY1LCAwLCA0MjI3OTIzOTY3LCAzLCAwLCAzMiwgLTEzMzQsIDIsIDE2MywgMiwgMCwgLTEyOSwgMiwgOTQsIC02LCAyLCAxNjMsIC0xODAsIDIsIDIwMywgLTIzMywgMiwgNCwgMywgMCwgOTYsIC0xNiwgMiwgMTYzLCAzLCAwLCA0NywgLTE1NCwgMiwgMTY1LCAzLCAwLCAyMjM4MSwgLTcsIDIsIDE3LCAzLCAwLCA2MTI4XSwgWzQyOTQ5NjcyOTUsIDQyOTQ5NjcyOTEsIDQwOTI0NjA1NDMsIDQyOTQ4MjgwMzEsIDQyOTQ5NjcyOTQsIDEzNDIxNzcyNiwgMjY4NDM1NDU1LCAyMTQ3NDgzNjQ3LCAxMDQ4NTc1LCAxMDczNzQxODIzLCAzODkyMzE0MTExLCAxMzQyMTc3MjcsIDEwNjExNTg5MTEsIDUzNjgwNTM3NiwgNDI5NDkxMDE0MywgNDE2MDc0OTU2NywgNDI5NDkwMTc1OSwgNDI5NDkwMTc2MCwgNTM2ODcwOTExLCAyNjIxNDMsIDgzODg2MDcsIDQyOTQ5MDI3ODMsIDQyOTQ5MTgxNDMsIDY1NTM1LCA2NzA0MzMyOCwgMjI4MTcwMTM3NCwgNDI5NDk2NzIzMiwgMjA5NzE1MSwgNDI5NDkwMzgwNywgNDE5NDMwMywgMjU1LCA2NzEwODg2MywgNDI5NDk2NzAzOSwgNTExLCA1MjQyODcsIDEzMTA3MSwgMTI3LCA0MjkyODcwMTQzLCA0Mjk0OTAyMjcxLCA0Mjk0NTQ5NDg3LCAzMzU1NDQzMSwgMTAyMywgNjcwNDc0MjMsIDQyOTQ5MDE4ODgsIDQyODY1Nzg2ODcsIDQyOTQ3NzA2ODcsIDY3MDQzNTgzLCAzMjc2NywgMTUsIDIwNDc5OTksIDY3MDQzMzQzLCAxNjc3NzIxNSwgNDI5NDkwMjAwMCwgNDI5NDkzNDUyNywgNDI5NDk2Njc4MywgNDI5NDk2NzI3OSwgMjA0NywgMjYyMDgzLCAyMDUxMSwgNDI5MDc3Mjk5MSwgNDE5NDMwMzksIDQ5MzU2NywgNDI5NDk1OTEwNCwgNjAzOTc5Nzc1LCA2NTUzNiwgNjAyNzk5NjE1LCA4MDUwNDQyMjMsIDQyOTQ5NjUyMDYsIDgxOTEsIDEwMzE3NDkxMTksIDQyOTQ5MTc2MzEsIDIxMzQ3Njk2NjMsIDQyODY1Nzg0OTMsIDQyODIyNTMzMTEsIDQyOTQ5NDI3MTksIDMzNTQwMDk1LCA0Mjk0OTA1ODU1LCA0Mjk0OTY3MjY0LCAyODY4ODU0NTkxLCAxNjA4NTE1NTgzLCAyNjUyMzIzNDgsIDUzNDUxOTgwNywgMjE0NzYxNDcyMCwgMTA2MDEwOTQ0NCwgNDA5MzY0MDAxNiwgMTczNzYsIDIxMzkwNjIxNDMsIDIyNCwgNDE2OTEzODE3NSwgNDI5NDkwOTk1MSwgNDI4NjU3ODY4OCwgNDI5NDk2NzI5MiwgNDI5NDk2NTc1OSwgMjA0NCwgNDI5Mjg3MDE0NCwgNDI5NDk2NjI3MiwgNDI5NDk2NzI4MCwgODI4OTkxOCwgNDI5NDkzNDM5OSwgNDI5NDkwMTc3NSwgNDI5NDk2NTM3NSwgMTYwMjIyMzYxNSwgNDI5NDk2NzI1OSwgNDI5NDQ0MzAwOCwgMjY4MzY5OTIwLCA0MjkyODA0NjA4LCA0ODYzNDE4ODQsIDQyOTQ5NjMxOTksIDMwODcwMDc2MTUsIDEwNzM2OTI2NzEsIDQxMjg1MjcsIDQyNzkyMzg2NTUsIDQyOTQ5MDIwMTUsIDQyOTQ5NjY1OTEsIDI0NDUyNzkyMzEsIDM2NzAwMTUsIDMyMzgwMDI2ODcsIDMxLCA2MywgNDI5NDk2NzI4OCwgNDI5NDcwNTE1MSwgNDA5NSwgMzIyMTIwODQ0NywgNDI5NDU0OTQ3MiwgMjE0NzQ4MzY0OCwgNDI4NTUyNjY1NSwgNDI5NDk2NjUyNywgNDI5NDcwNTE1MiwgNDI5NDk2NjE0MywgNjQsIDQyOTQ5NjY3MTksIDE2MzgzLCAzNzc0ODczNTkyLCA0NTg3NTIsIDUzNjgwNzQyMywgNjcwNDM4MzksIDM3NTgwOTYzODMsIDM5NTk0MTQzNzIsIDM3NTU5OTMwMjMsIDIwODAzNzQ3ODMsIDQyOTQ4MzUyOTUsIDQyOTQ5NjcxMDMsIDQxNjA3NDk1NjUsIDQwODcsIDE4NDAyNDcyNiwgMjg2MjAxNzE1NiwgMTU5MzMwOTA3OCwgMjY4NDM0NDMxLCAyNjg0MzQ0MTQsIDQyOTQ5MDE3NjMsIDUzNjg3MDkxMiwgMjk1Mjc5MDAxNiwgMjAyNTA2NzUyLCAxMzkyNjQsIDQwMjY1MzE4NCwgNDI2MTQxMjg2NCwgNDIyNzkyMjk0NCwgNDkxNTIsIDYxNDQwLCAzNzU4MDk2Mzg0LCAxMTc0NDA1MTIsIDY1MjgwLCAzMjMzODA4Mzg0LCAzMjIxMjI1NDcyLCAyMDk3MTUyLCA0Mjk0OTY1MjQ4LCAzMjc2OCwgNTcxNTIsIDY3MTA4ODY0LCA0MjkzOTE4NzIwLCA0MjkwNzcyOTkyLCAyNTE2NTgyNCwgNTczNDQsIDQyMjc5MTU3NzYsIDQyNzgxOTAwODAsIDQyMjc5MDc1ODQsIDY1NTIwLCA0MDI2NTMxODQwLCA0MjI3ODU4NDMyLCA0MTYwNzQ5NTY4LCAzNzU4MTI5MTUyLCA0Mjk0ODM2MjI0LCA2MzQ4OCwgMTA3Mzc0MTgyNCwgNDI5NDk2NzA0MCwgNDE5NDMwNCwgMjUxNjU4MjQwLCAxOTY2MDgsIDQyOTQ5NjMyMDAsIDY0NTEyLCA0MTc4MDgsIDQyMjc5MjM3MTIsIDEyNTgyOTEyLCA1MDMzMTY0OCwgNjU0NzIsIDQyOTQ5NjcxNjgsIDQyOTQ5NjY3ODQsIDE2LCA0Mjk0OTE3MTIwLCAyMDgwMzc0Nzg0LCA0MDk2LCA2NTQwOCwgNTI0Mjg4LCA2NTUzMl0pOwoKZnVuY3Rpb24gYWR2YW5jZUNoYXIocGFyc2VyKSB7DQogICAgcGFyc2VyLmNvbHVtbisrOw0KICAgIHJldHVybiAocGFyc2VyLmN1cnJlbnRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KCsrcGFyc2VyLmluZGV4KSk7DQp9DQpmdW5jdGlvbiBjb25zdW1lTXVsdGlVbml0Q29kZVBvaW50KHBhcnNlciwgaGkpIHsNCiAgICBpZiAoKGhpICYgMHhmYzAwKSAhPT0gNTUyOTYpDQogICAgICAgIHJldHVybiAwOw0KICAgIGNvbnN0IGxvID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpOw0KICAgIGlmICgobG8gJiAweGZjMDApICE9PSAweGRjMDApDQogICAgICAgIHJldHVybiAwOw0KICAgIGhpID0gcGFyc2VyLmN1cnJlbnRDaGFyID0gNjU1MzYgKyAoKGhpICYgMHgzZmYpIDw8IDEwKSArIChsbyAmIDB4M2ZmKTsNCiAgICBpZiAoKCh1bmljb2RlTG9va3VwWyhoaSA+Pj4gNSkgKyAwXSA+Pj4gaGkpICYgMzEgJiAxKSA9PT0gMCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxOCwgZnJvbUNvZGVQb2ludChoaSkpOw0KICAgIH0NCiAgICBwYXJzZXIuaW5kZXgrKzsNCiAgICBwYXJzZXIuY29sdW1uKys7DQogICAgcmV0dXJuIDE7DQp9DQpmdW5jdGlvbiBjb25zdW1lTGluZUZlZWQocGFyc2VyLCBzdGF0ZSkgew0KICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdCgrK3BhcnNlci5pbmRleCk7DQogICAgcGFyc2VyLmZsYWdzIHw9IDE7DQogICAgaWYgKChzdGF0ZSAmIDQpID09PSAwKSB7DQogICAgICAgIHBhcnNlci5jb2x1bW4gPSAwOw0KICAgICAgICBwYXJzZXIubGluZSsrOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHNjYW5OZXdMaW5lKHBhcnNlcikgew0KICAgIHBhcnNlci5mbGFncyB8PSAxOw0KICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdCgrK3BhcnNlci5pbmRleCk7DQogICAgcGFyc2VyLmNvbHVtbiA9IDA7DQogICAgcGFyc2VyLmxpbmUrKzsNCn0NCmZ1bmN0aW9uIGlzRXhvdGljRUNNQVNjcmlwdFdoaXRlc3BhY2UoY2gpIHsNCiAgICByZXR1cm4gKGNoID09PSAxNjAgfHwNCiAgICAgICAgY2ggPT09IDY1Mjc5IHx8DQogICAgICAgIGNoID09PSAxMzMgfHwNCiAgICAgICAgY2ggPT09IDU3NjAgfHwNCiAgICAgICAgKGNoID49IDgxOTIgJiYgY2ggPD0gODIwMykgfHwNCiAgICAgICAgY2ggPT09IDgyMzkgfHwNCiAgICAgICAgY2ggPT09IDgyODcgfHwNCiAgICAgICAgY2ggPT09IDEyMjg4IHx8DQogICAgICAgIGNoID09PSA4MjAxIHx8DQogICAgICAgIGNoID09PSA2NTUxOSk7DQp9DQpmdW5jdGlvbiBmcm9tQ29kZVBvaW50KGNvZGVQb2ludCkgew0KICAgIHJldHVybiBjb2RlUG9pbnQgPD0gNjU1MzUNCiAgICAgICAgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCkNCiAgICAgICAgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCA+Pj4gMTApICsgU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlUG9pbnQgJiAweDNmZik7DQp9DQpmdW5jdGlvbiB0b0hleChjb2RlKSB7DQogICAgcmV0dXJuIGNvZGUgPCA2NSA/IGNvZGUgLSA0OCA6IChjb2RlIC0gNjUgKyAxMCkgJiAweGY7DQp9DQpmdW5jdGlvbiBjb252ZXJ0VG9rZW5UeXBlKHQpIHsNCiAgICBzd2l0Y2ggKHQpIHsNCiAgICAgICAgY2FzZSAxMzQyODMyNjY6DQogICAgICAgICAgICByZXR1cm4gJ051bWVyaWNMaXRlcmFsJzsNCiAgICAgICAgY2FzZSAxMzQyODMyNjc6DQogICAgICAgICAgICByZXR1cm4gJ1N0cmluZ0xpdGVyYWwnOw0KICAgICAgICBjYXNlIDg2MDIxOg0KICAgICAgICBjYXNlIDg2MDIyOg0KICAgICAgICAgICAgcmV0dXJuICdCb29sZWFuTGl0ZXJhbCc7DQogICAgICAgIGNhc2UgODYwMjM6DQogICAgICAgICAgICByZXR1cm4gJ051bGxMaXRlcmFsJzsNCiAgICAgICAgY2FzZSA2NTU0MDoNCiAgICAgICAgICAgIHJldHVybiAnUmVndWxhckV4cHJlc3Npb24nOw0KICAgICAgICBjYXNlIDY3MTc0NDA4Og0KICAgICAgICBjYXNlIDY3MTc0NDA5Og0KICAgICAgICBjYXNlIDEzMjoNCiAgICAgICAgICAgIHJldHVybiAnVGVtcGxhdGVMaXRlcmFsJzsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIGlmICgodCAmIDE0MzM2MCkgPT09IDE0MzM2MCkNCiAgICAgICAgICAgICAgICByZXR1cm4gJ0lkZW50aWZpZXInOw0KICAgICAgICAgICAgaWYgKCh0ICYgNDA5NikgPT09IDQwOTYpDQogICAgICAgICAgICAgICAgcmV0dXJuICdLZXl3b3JkJzsNCiAgICAgICAgICAgIHJldHVybiAnUHVuY3R1YXRvcic7DQogICAgfQ0KfQoKY29uc3QgQ2hhclR5cGVzID0gWw0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgOCB8IDEwMjQsDQogICAgMCwNCiAgICAwLA0KICAgIDggfCAyMDQ4LA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICA4MTkyLA0KICAgIDAsDQogICAgMSB8IDIsDQogICAgMCwNCiAgICAwLA0KICAgIDgxOTIsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMjU2LA0KICAgIDAsDQogICAgMjU2IHwgMzI3NjgsDQogICAgMCwNCiAgICAwLA0KICAgIDIgfCAxNiB8IDEyOCB8IDMyIHwgNjQsDQogICAgMiB8IDE2IHwgMTI4IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCAzMiB8IDY0LA0KICAgIDIgfCAxNiB8IDMyIHwgNjQsDQogICAgMiB8IDE2IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCAzMiB8IDY0LA0KICAgIDIgfCAxNiB8IDMyIHwgNjQsDQogICAgMiB8IDE2IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCA1MTIgfCA2NCwNCiAgICAyIHwgMTYgfCA1MTIgfCA2NCwNCiAgICAwLA0KICAgIDAsDQogICAgMTYzODQsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxIHwgMiB8IDY0LA0KICAgIDEgfCAyIHwgNjQsDQogICAgMSB8IDIgfCA2NCwNCiAgICAxIHwgMiB8IDY0LA0KICAgIDEgfCAyIHwgNjQsDQogICAgMSB8IDIgfCA2NCwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAxIHwgMiwNCiAgICAwLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDEgfCAyIHwgNDA5NiwNCiAgICAwLA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCB8IDY0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMTYzODQsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMA0KXTsNCmNvbnN0IGlzSWRTdGFydCA9IFsNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMSwNCiAgICAwLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDANCl07DQpjb25zdCBpc0lkUGFydCA9IFsNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMSwNCiAgICAwLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDANCl07DQpmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydCQxKGNvZGUpIHsNCiAgICByZXR1cm4gY29kZSA8PSAweDdGDQogICAgICAgID8gaXNJZFN0YXJ0W2NvZGVdDQogICAgICAgIDogKHVuaWNvZGVMb29rdXBbKGNvZGUgPj4+IDUpICsgMzQ4MTZdID4+PiBjb2RlKSAmIDMxICYgMTsNCn0NCmZ1bmN0aW9uIGlzSWRlbnRpZmllclBhcnQoY29kZSkgew0KICAgIHJldHVybiBjb2RlIDw9IDB4N0YNCiAgICAgICAgPyBpc0lkUGFydFtjb2RlXQ0KICAgICAgICA6ICh1bmljb2RlTG9va3VwWyhjb2RlID4+PiA1KSArIDBdID4+PiBjb2RlKSAmIDMxICYgMSB8fCAoY29kZSA9PT0gODIwNCB8fCBjb2RlID09PSA4MjA1KTsNCn0KCmNvbnN0IENvbW1lbnRUeXBlcyA9IFsnU2luZ2xlTGluZScsICdNdWx0aUxpbmUnLCAnSFRNTE9wZW4nLCAnSFRNTENsb3NlJywgJ0hhc2hiYW5nQ29tbWVudCddOw0KZnVuY3Rpb24gc2tpcEhhc2hCYW5nKHBhcnNlcikgew0KICAgIGNvbnN0IHNvdXJjZSA9IHBhcnNlci5zb3VyY2U7DQogICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA9PT0gMzUgJiYgc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMSkgPT09IDMzKSB7DQogICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIHNraXBTaW5nbGVMaW5lQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgMCwgNCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gc2tpcFNpbmdsZUhUTUxDb21tZW50KHBhcnNlciwgc291cmNlLCBzdGF0ZSwgY29udGV4dCwgdHlwZSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChjb250ZXh0ICYgMjA0OCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgcmV0dXJuIHNraXBTaW5nbGVMaW5lQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgc3RhdGUsIHR5cGUsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gc2tpcFNpbmdsZUxpbmVDb21tZW50KHBhcnNlciwgc291cmNlLCBzdGF0ZSwgdHlwZSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgaW5kZXggfSA9IHBhcnNlcjsNCiAgICBwYXJzZXIudG9rZW5Qb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICBwYXJzZXIuY29sUG9zID0gcGFyc2VyLmNvbHVtbjsNCiAgICB3aGlsZSAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICBpZiAoQ2hhclR5cGVzW3BhcnNlci5jdXJyZW50Q2hhcl0gJiA4KSB7DQogICAgICAgICAgICBjb25zdCBpc0NSID0gcGFyc2VyLmN1cnJlbnRDaGFyID09PSAxMzsNCiAgICAgICAgICAgIHNjYW5OZXdMaW5lKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoaXNDUiAmJiBwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kICYmIHBhcnNlci5jdXJyZW50Q2hhciA9PT0gMTApDQogICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gc291cmNlLmNoYXJDb2RlQXQoKytwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKHBhcnNlci5jdXJyZW50Q2hhciBeIDgyMzIpIDw9IDEpIHsNCiAgICAgICAgICAgIHNjYW5OZXdMaW5lKHBhcnNlcik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICBwYXJzZXIudG9rZW5Qb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgICAgIHBhcnNlci5saW5lUG9zID0gcGFyc2VyLmxpbmU7DQogICAgICAgIHBhcnNlci5jb2xQb3MgPSBwYXJzZXIuY29sdW1uOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLm9uQ29tbWVudCkgew0KICAgICAgICBjb25zdCBsb2MgPSB7DQogICAgICAgICAgICBzdGFydDogew0KICAgICAgICAgICAgICAgIGxpbmUsDQogICAgICAgICAgICAgICAgY29sdW1uDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZW5kOiB7DQogICAgICAgICAgICAgICAgbGluZTogcGFyc2VyLmxpbmVQb3MsDQogICAgICAgICAgICAgICAgY29sdW1uOiBwYXJzZXIuY29sUG9zDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIHBhcnNlci5vbkNvbW1lbnQoQ29tbWVudFR5cGVzW3R5cGUgJiAweGZmXSwgc291cmNlLnNsaWNlKGluZGV4LCBwYXJzZXIudG9rZW5Qb3MpLCBzdGFydCwgcGFyc2VyLnRva2VuUG9zLCBsb2MpOw0KICAgIH0NCiAgICByZXR1cm4gc3RhdGUgfCAxOw0KfQ0KZnVuY3Rpb24gc2tpcE11bHRpTGluZUNvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlKSB7DQogICAgY29uc3QgeyBpbmRleCB9ID0gcGFyc2VyOw0KICAgIHdoaWxlIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgPCAweDJiKSB7DQogICAgICAgICAgICBsZXQgc2tpcHBlZE9uZUFzdGVyaXNrID0gZmFsc2U7DQogICAgICAgICAgICB3aGlsZSAocGFyc2VyLmN1cnJlbnRDaGFyID09PSA0Mikgew0KICAgICAgICAgICAgICAgIGlmICghc2tpcHBlZE9uZUFzdGVyaXNrKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlICY9IH40Ow0KICAgICAgICAgICAgICAgICAgICBza2lwcGVkT25lQXN0ZXJpc2sgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSA9PT0gNDcpIHsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5vbkNvbW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIubGluZVBvcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBwYXJzZXIuY29sUG9zDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogcGFyc2VyLmxpbmUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogcGFyc2VyLmNvbHVtbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIub25Db21tZW50KENvbW1lbnRUeXBlc1sxICYgMHhmZl0sIHNvdXJjZS5zbGljZShpbmRleCwgcGFyc2VyLmluZGV4IC0gMiksIGluZGV4IC0gMiwgcGFyc2VyLmluZGV4LCBsb2MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5pbmRleDsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbFBvcyA9IHBhcnNlci5jb2x1bW47DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2tpcHBlZE9uZUFzdGVyaXNrKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoQ2hhclR5cGVzW3BhcnNlci5jdXJyZW50Q2hhcl0gJiA4KSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA9PT0gMTMpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMSB8IDQ7DQogICAgICAgICAgICAgICAgICAgIHNjYW5OZXdMaW5lKHBhcnNlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zdW1lTGluZUZlZWQocGFyc2VyLCBzdGF0ZSk7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gKHN0YXRlICYgfjQpIHwgMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKChwYXJzZXIuY3VycmVudENoYXIgXiA4MjMyKSA8PSAxKSB7DQogICAgICAgICAgICBzdGF0ZSA9IChzdGF0ZSAmIH40KSB8IDE7DQogICAgICAgICAgICBzY2FuTmV3TGluZShwYXJzZXIpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgc3RhdGUgJj0gfjQ7DQogICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJlcG9ydChwYXJzZXIsIDE2KTsNCn0KCmZ1bmN0aW9uIHNjYW5SZWd1bGFyRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCBib2R5U3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgbGV0IHByZXBhcnNlU3RhdGUgPSAwOw0KICAgIGxvb3A6IHdoaWxlICh0cnVlKSB7DQogICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICBpZiAocHJlcGFyc2VTdGF0ZSAmIDEpIHsNCiAgICAgICAgICAgIHByZXBhcnNlU3RhdGUgJj0gfjE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzd2l0Y2ggKGNoKSB7DQogICAgICAgICAgICAgICAgY2FzZSA0NzoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmVwYXJzZVN0YXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgbG9vcDsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA5MjoNCiAgICAgICAgICAgICAgICAgICAgcHJlcGFyc2VTdGF0ZSB8PSAxOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDkxOg0KICAgICAgICAgICAgICAgICAgICBwcmVwYXJzZVN0YXRlIHw9IDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgOTM6DQogICAgICAgICAgICAgICAgICAgIHByZXBhcnNlU3RhdGUgJj0gMTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAxMzoNCiAgICAgICAgICAgICAgICBjYXNlIDEwOg0KICAgICAgICAgICAgICAgIGNhc2UgODIzMjoNCiAgICAgICAgICAgICAgICBjYXNlIDgyMzM6DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5zb3VyY2UubGVuZ3RoKSB7DQogICAgICAgICAgICByZXR1cm4gcmVwb3J0KHBhcnNlciwgMzIpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IGJvZHlFbmQgPSBwYXJzZXIuaW5kZXggLSAxOw0KICAgIGxldCBtYXNrID0gMDsNCiAgICBsZXQgY2hhciA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICBjb25zdCB7IGluZGV4OiBmbGFnU3RhcnQgfSA9IHBhcnNlcjsNCiAgICB3aGlsZSAoaXNJZGVudGlmaWVyUGFydChjaGFyKSkgew0KICAgICAgICBzd2l0Y2ggKGNoYXIpIHsNCiAgICAgICAgICAgIGNhc2UgMTAzOg0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgMikNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzQsICdnJyk7DQogICAgICAgICAgICAgICAgbWFzayB8PSAyOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAxMDU6DQogICAgICAgICAgICAgICAgaWYgKG1hc2sgJiAxKQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzNCwgJ2knKTsNCiAgICAgICAgICAgICAgICBtYXNrIHw9IDE7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDEwOToNCiAgICAgICAgICAgICAgICBpZiAobWFzayAmIDQpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAnbScpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gNDsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTE3Og0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgMTYpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAndScpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gMTY7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDEyMToNCiAgICAgICAgICAgICAgICBpZiAobWFzayAmIDgpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAneScpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gODsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTE1Og0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgMzIpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAncycpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gMzI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDEwMDoNCiAgICAgICAgICAgICAgICBpZiAobWFzayAmIDY0KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzNCwgJ2QnKTsNCiAgICAgICAgICAgICAgICBtYXNrIHw9IDY0Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzMyk7DQogICAgICAgIH0NCiAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgfQ0KICAgIGNvbnN0IGZsYWdzID0gcGFyc2VyLnNvdXJjZS5zbGljZShmbGFnU3RhcnQsIHBhcnNlci5pbmRleCk7DQogICAgY29uc3QgcGF0dGVybiA9IHBhcnNlci5zb3VyY2Uuc2xpY2UoYm9keVN0YXJ0LCBib2R5RW5kKTsNCiAgICBwYXJzZXIudG9rZW5SZWdFeHAgPSB7IHBhdHRlcm4sIGZsYWdzIH07DQogICAgaWYgKGNvbnRleHQgJiA1MTIpDQogICAgICAgIHBhcnNlci50b2tlblJhdyA9IHBhcnNlci5zb3VyY2Uuc2xpY2UocGFyc2VyLnRva2VuUG9zLCBwYXJzZXIuaW5kZXgpOw0KICAgIHBhcnNlci50b2tlblZhbHVlID0gdmFsaWRhdGUocGFyc2VyLCBwYXR0ZXJuLCBmbGFncyk7DQogICAgcmV0dXJuIDY1NTQwOw0KfQ0KZnVuY3Rpb24gdmFsaWRhdGUocGFyc2VyLCBwYXR0ZXJuLCBmbGFncykgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHBhdHRlcm4sIGZsYWdzKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIG5ldyBSZWdFeHAocGF0dGVybiwgZmxhZ3MucmVwbGFjZSgnZCcsICcnKSk7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzIpOw0KICAgICAgICB9DQogICAgfQ0KfQoKZnVuY3Rpb24gc2NhblN0cmluZyQxKHBhcnNlciwgY29udGV4dCwgcXVvdGUpIHsNCiAgICBjb25zdCB7IGluZGV4OiBzdGFydCB9ID0gcGFyc2VyOw0KICAgIGxldCByZXQgPSAnJzsNCiAgICBsZXQgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgbGV0IG1hcmtlciA9IHBhcnNlci5pbmRleDsNCiAgICB3aGlsZSAoKENoYXJUeXBlc1tjaGFyXSAmIDgpID09PSAwKSB7DQogICAgICAgIGlmIChjaGFyID09PSBxdW90ZSkgew0KICAgICAgICAgICAgcmV0ICs9IHBhcnNlci5zb3VyY2Uuc2xpY2UobWFya2VyLCBwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICYgNTEyKQ0KICAgICAgICAgICAgICAgIHBhcnNlci50b2tlblJhdyA9IHBhcnNlci5zb3VyY2Uuc2xpY2Uoc3RhcnQsIHBhcnNlci5pbmRleCk7DQogICAgICAgICAgICBwYXJzZXIudG9rZW5WYWx1ZSA9IHJldDsNCiAgICAgICAgICAgIHJldHVybiAxMzQyODMyNjc7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChjaGFyICYgOCkgPT09IDggJiYgY2hhciA9PT0gOTIpIHsNCiAgICAgICAgICAgIHJldCArPSBwYXJzZXIuc291cmNlLnNsaWNlKG1hcmtlciwgcGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKGNoYXIgPCAweDdmIHx8IGNoYXIgPT09IDgyMzIgfHwgY2hhciA9PT0gODIzMykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvZGUgPSBwYXJzZUVzY2FwZShwYXJzZXIsIGNvbnRleHQsIGNoYXIpOw0KICAgICAgICAgICAgICAgIGlmIChjb2RlID49IDApDQogICAgICAgICAgICAgICAgICAgIHJldCArPSBmcm9tQ29kZVBvaW50KGNvZGUpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU3RyaW5nRXJyb3IocGFyc2VyLCBjb2RlLCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldCArPSBmcm9tQ29kZVBvaW50KGNoYXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbWFya2VyID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5lbmQpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNCk7DQogICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgIH0NCiAgICByZXBvcnQocGFyc2VyLCAxNCk7DQp9DQpmdW5jdGlvbiBwYXJzZUVzY2FwZShwYXJzZXIsIGNvbnRleHQsIGZpcnN0KSB7DQogICAgc3dpdGNoIChmaXJzdCkgew0KICAgICAgICBjYXNlIDk4Og0KICAgICAgICAgICAgcmV0dXJuIDg7DQogICAgICAgIGNhc2UgMTAyOg0KICAgICAgICAgICAgcmV0dXJuIDEyOw0KICAgICAgICBjYXNlIDExNDoNCiAgICAgICAgICAgIHJldHVybiAxMzsNCiAgICAgICAgY2FzZSAxMTA6DQogICAgICAgICAgICByZXR1cm4gMTA7DQogICAgICAgIGNhc2UgMTE2Og0KICAgICAgICAgICAgcmV0dXJuIDk7DQogICAgICAgIGNhc2UgMTE4Og0KICAgICAgICAgICAgcmV0dXJuIDExOw0KICAgICAgICBjYXNlIDEzOiB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpOw0KICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hhciA9PT0gMTApIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gbmV4dENoYXI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhc2UgMTA6DQogICAgICAgIGNhc2UgODIzMjoNCiAgICAgICAgY2FzZSA4MjMzOg0KICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiA9IC0xOw0KICAgICAgICAgICAgcGFyc2VyLmxpbmUrKzsNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgY2FzZSA0ODoNCiAgICAgICAgY2FzZSA0OToNCiAgICAgICAgY2FzZSA1MDoNCiAgICAgICAgY2FzZSA1MTogew0KICAgICAgICAgICAgbGV0IGNvZGUgPSBmaXJzdCAtIDQ4Ow0KICAgICAgICAgICAgbGV0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgIGxldCBjb2x1bW4gPSBwYXJzZXIuY29sdW1uICsgMTsNCiAgICAgICAgICAgIGlmIChpbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KGluZGV4KTsNCiAgICAgICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tuZXh0XSAmIDMyKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKGNvZGUgIT09IDAgfHwgQ2hhclR5cGVzW25leHRdICYgNTEyKSAmJiBjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0yOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gbmV4dDsNCiAgICAgICAgICAgICAgICAgICAgY29kZSA9IChjb2RlIDw8IDMpIHwgKG5leHQgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgIGluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIGNvbHVtbisrOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KGluZGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChDaGFyVHlwZXNbbmV4dF0gJiAzMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IG5leHQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IChjb2RlIDw8IDMpIHwgKG5leHQgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gNjQ7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5pbmRleCA9IGluZGV4IC0gMTsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiA9IGNvbHVtbiAtIDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSA1MjoNCiAgICAgICAgY2FzZSA1MzoNCiAgICAgICAgY2FzZSA1NDoNCiAgICAgICAgY2FzZSA1NTogew0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMjsNCiAgICAgICAgICAgIGxldCBjb2RlID0gZmlyc3QgLSA0ODsNCiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IHBhcnNlci5jb2x1bW4gKyAxOw0KICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpOw0KICAgICAgICAgICAgICAgIGlmIChDaGFyVHlwZXNbbmV4dF0gJiAzMikgew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gKGNvZGUgPDwgMykgfCAobmV4dCAtIDQ4KTsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gbmV4dDsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4ID0gaW5kZXg7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gPSBjb2x1bW47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDY0Ow0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAxMjA6IHsNCiAgICAgICAgICAgIGNvbnN0IGNoMSA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tjaDFdICYgNjQpID09PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtNDsNCiAgICAgICAgICAgIGNvbnN0IGhpID0gdG9IZXgoY2gxKTsNCiAgICAgICAgICAgIGNvbnN0IGNoMiA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tjaDJdICYgNjQpID09PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtNDsNCiAgICAgICAgICAgIGNvbnN0IGxvID0gdG9IZXgoY2gyKTsNCiAgICAgICAgICAgIHJldHVybiAoaGkgPDwgNCkgfCBsbzsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDExNzogew0KICAgICAgICAgICAgY29uc3QgY2ggPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA9PT0gMTIzKSB7DQogICAgICAgICAgICAgICAgbGV0IGNvZGUgPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlICgoQ2hhclR5cGVzW2FkdmFuY2VDaGFyKHBhcnNlcildICYgNjQpICE9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGNvZGUgPSAoY29kZSA8PCA0KSB8IHRvSGV4KHBhcnNlci5jdXJyZW50Q2hhcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID4gMTExNDExMSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtNTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA8IDEgfHwgcGFyc2VyLmN1cnJlbnRDaGFyICE9PSAxMjUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW2NoXSAmIDY0KSA9PT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgICAgIGNvbnN0IGNoMiA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAxKTsNCiAgICAgICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tjaDJdICYgNjQpID09PSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTQ7DQogICAgICAgICAgICAgICAgY29uc3QgY2gzID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDIpOw0KICAgICAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW2NoM10gJiA2NCkgPT09IDApDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtNDsNCiAgICAgICAgICAgICAgICBjb25zdCBjaDQgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMyk7DQogICAgICAgICAgICAgICAgaWYgKChDaGFyVHlwZXNbY2g0XSAmIDY0KSA9PT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgICAgIHBhcnNlci5pbmRleCArPSAzOw0KICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gKz0gMzsNCiAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gKHRvSGV4KGNoKSA8PCAxMikgfCAodG9IZXgoY2gyKSA8PCA4KSB8ICh0b0hleChjaDMpIDw8IDQpIHwgdG9IZXgoY2g0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDU2Og0KICAgICAgICBjYXNlIDU3Og0KICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgMjU2KSA9PT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTM7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gZmlyc3Q7DQogICAgfQ0KfQ0KZnVuY3Rpb24gaGFuZGxlU3RyaW5nRXJyb3Ioc3RhdGUsIGNvZGUsIGlzVGVtcGxhdGUpIHsNCiAgICBzd2l0Y2ggKGNvZGUpIHsNCiAgICAgICAgY2FzZSAtMToNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgY2FzZSAtMjoNCiAgICAgICAgICAgIHJlcG9ydChzdGF0ZSwgaXNUZW1wbGF0ZSA/IDIgOiAxKTsNCiAgICAgICAgY2FzZSAtMzoNCiAgICAgICAgICAgIHJlcG9ydChzdGF0ZSwgMTMpOw0KICAgICAgICBjYXNlIC00Og0KICAgICAgICAgICAgcmVwb3J0KHN0YXRlLCA2KTsNCiAgICAgICAgY2FzZSAtNToNCiAgICAgICAgICAgIHJlcG9ydChzdGF0ZSwgMTAyKTsNCiAgICB9DQp9CgpmdW5jdGlvbiBzY2FuVGVtcGxhdGUocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgeyBpbmRleDogc3RhcnQgfSA9IHBhcnNlcjsNCiAgICBsZXQgdG9rZW4gPSA2NzE3NDQwOTsNCiAgICBsZXQgcmV0ID0gJyc7DQogICAgbGV0IGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgIHdoaWxlIChjaGFyICE9PSA5Nikgew0KICAgICAgICBpZiAoY2hhciA9PT0gMzYgJiYgcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpID09PSAxMjMpIHsNCiAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICB0b2tlbiA9IDY3MTc0NDA4Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKGNoYXIgJiA4KSA9PT0gOCAmJiBjaGFyID09PSA5Mikgew0KICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoY2hhciA+IDB4N2UpIHsNCiAgICAgICAgICAgICAgICByZXQgKz0gZnJvbUNvZGVQb2ludChjaGFyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvZGUgPSBwYXJzZUVzY2FwZShwYXJzZXIsIGNvbnRleHQgfCAxMDI0LCBjaGFyKTsNCiAgICAgICAgICAgICAgICBpZiAoY29kZSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldCArPSBmcm9tQ29kZVBvaW50KGNvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb2RlICE9PSAtMSAmJiBjb250ZXh0ICYgNjU1MzYpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gc2NhbkJhZFRlbXBsYXRlKHBhcnNlciwgY2hhcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaGFyIDwgMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gNjcxNzQ0MDg7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU3RyaW5nRXJyb3IocGFyc2VyLCBjb2RlLCAxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCAmJg0KICAgICAgICAgICAgICAgIGNoYXIgPT09IDEzICYmDQogICAgICAgICAgICAgICAgcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCkgPT09IDEwKSB7DQogICAgICAgICAgICAgICAgcmV0ICs9IGZyb21Db2RlUG9pbnQoY2hhcik7DQogICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KCsrcGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgoKGNoYXIgJiA4MykgPCAzICYmIGNoYXIgPT09IDEwKSB8fCAoY2hhciBeIDgyMzIpIDw9IDEpIHsNCiAgICAgICAgICAgICAgICBwYXJzZXIuY29sdW1uID0gLTE7DQogICAgICAgICAgICAgICAgcGFyc2VyLmxpbmUrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldCArPSBmcm9tQ29kZVBvaW50KGNoYXIpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1KTsNCiAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgfQ0KICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgcGFyc2VyLnRva2VuVmFsdWUgPSByZXQ7DQogICAgcGFyc2VyLnRva2VuUmF3ID0gcGFyc2VyLnNvdXJjZS5zbGljZShzdGFydCArIDEsIHBhcnNlci5pbmRleCAtICh0b2tlbiA9PT0gNjcxNzQ0MDkgPyAxIDogMikpOw0KICAgIHJldHVybiB0b2tlbjsNCn0NCmZ1bmN0aW9uIHNjYW5CYWRUZW1wbGF0ZShwYXJzZXIsIGNoKSB7DQogICAgd2hpbGUgKGNoICE9PSA5Nikgew0KICAgICAgICBzd2l0Y2ggKGNoKSB7DQogICAgICAgICAgICBjYXNlIDM2OiB7DQogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHBhcnNlci5lbmQgJiYgcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KGluZGV4KSA9PT0gMTIzKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5pbmRleCA9IGluZGV4Ow0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY29sdW1uKys7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtY2g7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDoNCiAgICAgICAgICAgIGNhc2UgODIzMjoNCiAgICAgICAgICAgIGNhc2UgODIzMzoNCiAgICAgICAgICAgICAgICBwYXJzZXIuY29sdW1uID0gLTE7DQogICAgICAgICAgICAgICAgcGFyc2VyLmxpbmUrKzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5lbmQpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNSk7DQogICAgICAgIGNoID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgcmV0dXJuIGNoOw0KfQ0KZnVuY3Rpb24gc2NhblRlbXBsYXRlVGFpbChwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5lbmQpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgIHBhcnNlci5pbmRleC0tOw0KICAgIHBhcnNlci5jb2x1bW4tLTsNCiAgICByZXR1cm4gc2NhblRlbXBsYXRlKHBhcnNlciwgY29udGV4dCk7DQp9CgpmdW5jdGlvbiBzY2FuTnVtYmVyJDEocGFyc2VyLCBjb250ZXh0LCBraW5kKSB7DQogICAgbGV0IGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgbGV0IHZhbHVlID0gMDsNCiAgICBsZXQgZGlnaXQgPSA5Ow0KICAgIGxldCBhdFN0YXJ0ID0ga2luZCAmIDY0ID8gMCA6IDE7DQogICAgbGV0IGRpZ2l0cyA9IDA7DQogICAgbGV0IGFsbG93U2VwYXJhdG9yID0gMDsNCiAgICBpZiAoa2luZCAmIDY0KSB7DQogICAgICAgIHZhbHVlID0gJy4nICsgc2NhbkRlY2ltYWxEaWdpdHNPclNlcGFyYXRvcihwYXJzZXIsIGNoYXIpOw0KICAgICAgICBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICBpZiAoY2hhciA9PT0gMTEwKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTEpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgaWYgKGNoYXIgPT09IDQ4KSB7DQogICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmICgoY2hhciB8IDMyKSA9PT0gMTIwKSB7DQogICAgICAgICAgICAgICAga2luZCA9IDggfCAxMjg7DQogICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgd2hpbGUgKENoYXJUeXBlc1tjaGFyXSAmICg2NCB8IDQwOTYpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSA5NSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhbGxvd1NlcGFyYXRvcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiAweDEwICsgdG9IZXgoY2hhcik7DQogICAgICAgICAgICAgICAgICAgIGRpZ2l0cysrOw0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRpZ2l0cyA9PT0gMCB8fCAhYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgZGlnaXRzID09PSAwID8gMTkgOiAxNDgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKChjaGFyIHwgMzIpID09PSAxMTEpIHsNCiAgICAgICAgICAgICAgICBraW5kID0gNCB8IDEyODsNCiAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAoQ2hhclR5cGVzW2NoYXJdICYgKDMyIHwgNDA5NikpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFsbG93U2VwYXJhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQ3KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAxOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogOCArIChjaGFyIC0gNDgpOw0KICAgICAgICAgICAgICAgICAgICBkaWdpdHMrKzsNCiAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkaWdpdHMgPT09IDAgfHwgIWFsbG93U2VwYXJhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIGRpZ2l0cyA9PT0gMCA/IDAgOiAxNDgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKChjaGFyIHwgMzIpID09PSA5OCkgew0KICAgICAgICAgICAgICAgIGtpbmQgPSAyIHwgMTI4Ow0KICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgIHdoaWxlIChDaGFyVHlwZXNbY2hhcl0gJiAoMTI4IHwgNDA5NikpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFsbG93U2VwYXJhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQ3KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAxOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogMiArIChjaGFyIC0gNDgpOw0KICAgICAgICAgICAgICAgICAgICBkaWdpdHMrKzsNCiAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkaWdpdHMgPT09IDAgfHwgIWFsbG93U2VwYXJhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIGRpZ2l0cyA9PT0gMCA/IDAgOiAxNDgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKENoYXJUeXBlc1tjaGFyXSAmIDMyKSB7DQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxKTsNCiAgICAgICAgICAgICAgICBraW5kID0gMTsNCiAgICAgICAgICAgICAgICB3aGlsZSAoQ2hhclR5cGVzW2NoYXJdICYgMTYpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKENoYXJUeXBlc1tjaGFyXSAmIDUxMikgew0KICAgICAgICAgICAgICAgICAgICAgICAga2luZCA9IDMyOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXRTdGFydCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogOCArIChjaGFyIC0gNDgpOw0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChDaGFyVHlwZXNbY2hhcl0gJiA1MTIpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEpOw0KICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSA2NDsNCiAgICAgICAgICAgICAgICBraW5kID0gMzI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjaGFyID09PSA5NSkgew0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChraW5kICYgNDgpIHsNCiAgICAgICAgICAgIGlmIChhdFN0YXJ0KSB7DQogICAgICAgICAgICAgICAgd2hpbGUgKGRpZ2l0ID49IDAgJiYgQ2hhclR5cGVzW2NoYXJdICYgKDE2IHwgNDA5NikpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSA5NSB8fCBraW5kICYgMzIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRTY2FubmVyRXJyb3IocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4ICsgMSwgMTQ3KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMDsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAxMCAqIHZhbHVlICsgKGNoYXIgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAtLWRpZ2l0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0U2Nhbm5lckVycm9yKHBhcnNlci5pbmRleCwgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCArIDEsIDE0OCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkaWdpdCA+PSAwICYmICFpc0lkZW50aWZpZXJTdGFydCQxKGNoYXIpICYmIGNoYXIgIT09IDQ2KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0ICYgNTEyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuUmF3ID0gcGFyc2VyLnNvdXJjZS5zbGljZShwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5pbmRleCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxMzQyODMyNjY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFsdWUgKz0gc2NhbkRlY2ltYWxEaWdpdHNPclNlcGFyYXRvcihwYXJzZXIsIGNoYXIpOw0KICAgICAgICAgICAgY2hhciA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgIGlmIChjaGFyID09PSA0Nikgew0KICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpID09PSA5NSkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgICAgICAgICAgICAga2luZCA9IDY0Ow0KICAgICAgICAgICAgICAgIHZhbHVlICs9ICcuJyArIHNjYW5EZWNpbWFsRGlnaXRzT3JTZXBhcmF0b3IocGFyc2VyLCBwYXJzZXIuY3VycmVudENoYXIpOw0KICAgICAgICAgICAgICAgIGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgY29uc3QgZW5kID0gcGFyc2VyLmluZGV4Ow0KICAgIGxldCBpc0JpZ0ludCA9IDA7DQogICAgaWYgKGNoYXIgPT09IDExMCAmJiBraW5kICYgMTI4KSB7DQogICAgICAgIGlzQmlnSW50ID0gMTsNCiAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpZiAoKGNoYXIgfCAzMikgPT09IDEwMSkgew0KICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoQ2hhclR5cGVzW2NoYXJdICYgMjU2KQ0KICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgY29uc3QgeyBpbmRleCB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgaWYgKChDaGFyVHlwZXNbY2hhcl0gJiAxNikgPT09IDApDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTApOw0KICAgICAgICAgICAgdmFsdWUgKz0gcGFyc2VyLnNvdXJjZS5zdWJzdHJpbmcoZW5kLCBpbmRleCkgKyBzY2FuRGVjaW1hbERpZ2l0c09yU2VwYXJhdG9yKHBhcnNlciwgY2hhcik7DQogICAgICAgICAgICBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICgocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCAmJiBDaGFyVHlwZXNbY2hhcl0gJiAxNikgfHwgaXNJZGVudGlmaWVyU3RhcnQkMShjaGFyKSkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMik7DQogICAgfQ0KICAgIGlmIChpc0JpZ0ludCkgew0KICAgICAgICBwYXJzZXIudG9rZW5SYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgPSBCaWdJbnQodmFsdWUpOw0KICAgICAgICByZXR1cm4gMTM0MjgzMzg5Ow0KICAgIH0NCiAgICBwYXJzZXIudG9rZW5WYWx1ZSA9DQogICAgICAgIGtpbmQgJiAoMSB8IDIgfCA4IHwgNCkNCiAgICAgICAgICAgID8gdmFsdWUNCiAgICAgICAgICAgIDoga2luZCAmIDMyDQogICAgICAgICAgICAgICAgPyBwYXJzZUZsb2F0KHBhcnNlci5zb3VyY2Uuc3Vic3RyaW5nKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KSkNCiAgICAgICAgICAgICAgICA6ICt2YWx1ZTsNCiAgICBpZiAoY29udGV4dCAmIDUxMikNCiAgICAgICAgcGFyc2VyLnRva2VuUmF3ID0gcGFyc2VyLnNvdXJjZS5zbGljZShwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5pbmRleCk7DQogICAgcmV0dXJuIDEzNDI4MzI2NjsNCn0NCmZ1bmN0aW9uIHNjYW5EZWNpbWFsRGlnaXRzT3JTZXBhcmF0b3IocGFyc2VyLCBjaGFyKSB7DQogICAgbGV0IGFsbG93U2VwYXJhdG9yID0gMDsNCiAgICBsZXQgc3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgbGV0IHJldCA9ICcnOw0KICAgIHdoaWxlIChDaGFyVHlwZXNbY2hhcl0gJiAoMTYgfCA0MDk2KSkgew0KICAgICAgICBpZiAoY2hhciA9PT0gOTUpIHsNCiAgICAgICAgICAgIGNvbnN0IHsgaW5kZXggfSA9IHBhcnNlcjsNCiAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgcmVwb3J0U2Nhbm5lckVycm9yKHBhcnNlci5pbmRleCwgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCArIDEsIDE0Nyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDE7DQogICAgICAgICAgICByZXQgKz0gcGFyc2VyLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIGluZGV4KTsNCiAgICAgICAgICAgIHN0YXJ0ID0gcGFyc2VyLmluZGV4Ow0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgaWYgKGFsbG93U2VwYXJhdG9yKSB7DQogICAgICAgIHJlcG9ydFNjYW5uZXJFcnJvcihwYXJzZXIuaW5kZXgsIHBhcnNlci5saW5lLCBwYXJzZXIuaW5kZXggKyAxLCAxNDgpOw0KICAgIH0NCiAgICByZXR1cm4gcmV0ICsgcGFyc2VyLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHBhcnNlci5pbmRleCk7DQp9Cgpjb25zdCBLZXl3b3JkRGVzY1RhYmxlID0gWw0KICAgICdlbmQgb2Ygc291cmNlJywNCiAgICAnaWRlbnRpZmllcicsICdudW1iZXInLCAnc3RyaW5nJywgJ3JlZ3VsYXIgZXhwcmVzc2lvbicsDQogICAgJ2ZhbHNlJywgJ3RydWUnLCAnbnVsbCcsDQogICAgJ3RlbXBsYXRlIGNvbnRpbnVhdGlvbicsICd0ZW1wbGF0ZSB0YWlsJywNCiAgICAnPT4nLCAnKCcsICd7JywgJy4nLCAnLi4uJywgJ30nLCAnKScsICc7JywgJywnLCAnWycsICddJywgJzonLCAnPycsICdcJycsICciJywgJzwvJywgJy8+JywNCiAgICAnKysnLCAnLS0nLA0KICAgICc9JywgJzw8PScsICc+Pj0nLCAnPj4+PScsICcqKj0nLCAnKz0nLCAnLT0nLCAnKj0nLCAnLz0nLCAnJT0nLCAnXj0nLCAnfD0nLA0KICAgICcmPScsICd8fD0nLCAnJiY9JywgJz8/PScsDQogICAgJ3R5cGVvZicsICdkZWxldGUnLCAndm9pZCcsICchJywgJ34nLCAnKycsICctJywgJ2luJywgJ2luc3RhbmNlb2YnLCAnKicsICclJywgJy8nLCAnKionLCAnJiYnLA0KICAgICd8fCcsICc9PT0nLCAnIT09JywgJz09JywgJyE9JywgJzw9JywgJz49JywgJzwnLCAnPicsICc8PCcsICc+PicsICc+Pj4nLCAnJicsICd8JywgJ14nLA0KICAgICd2YXInLCAnbGV0JywgJ2NvbnN0JywNCiAgICAnYnJlYWsnLCAnY2FzZScsICdjYXRjaCcsICdjbGFzcycsICdjb250aW51ZScsICdkZWJ1Z2dlcicsICdkZWZhdWx0JywgJ2RvJywgJ2Vsc2UnLCAnZXhwb3J0JywNCiAgICAnZXh0ZW5kcycsICdmaW5hbGx5JywgJ2ZvcicsICdmdW5jdGlvbicsICdpZicsICdpbXBvcnQnLCAnbmV3JywgJ3JldHVybicsICdzdXBlcicsICdzd2l0Y2gnLA0KICAgICd0aGlzJywgJ3Rocm93JywgJ3RyeScsICd3aGlsZScsICd3aXRoJywNCiAgICAnaW1wbGVtZW50cycsICdpbnRlcmZhY2UnLCAncGFja2FnZScsICdwcml2YXRlJywgJ3Byb3RlY3RlZCcsICdwdWJsaWMnLCAnc3RhdGljJywgJ3lpZWxkJywNCiAgICAnYXMnLCAnYXN5bmMnLCAnYXdhaXQnLCAnY29uc3RydWN0b3InLCAnZ2V0JywgJ3NldCcsICdmcm9tJywgJ29mJywNCiAgICAnZW51bScsICdldmFsJywgJ2FyZ3VtZW50cycsICdlc2NhcGVkIGtleXdvcmQnLCAnZXNjYXBlZCBmdXR1cmUgcmVzZXJ2ZWQga2V5d29yZCcsICdyZXNlcnZlZCBpZiBzdHJpY3QnLCAnIycsDQogICAgJ0JpZ0ludExpdGVyYWwnLCAnPz8nLCAnPy4nLCAnV2hpdGVTcGFjZScsICdJbGxlZ2FsJywgJ0xpbmVUZXJtaW5hdG9yJywgJ1ByaXZhdGVGaWVsZCcsDQogICAgJ1RlbXBsYXRlJywgJ0AnLCAndGFyZ2V0JywgJ21ldGEnLCAnTGluZUZlZWQnLCAnRXNjYXBlZCcsICdKU1hUZXh0Jw0KXTsNCmNvbnN0IGRlc2NLZXl3b3JkVGFibGUgPSBPYmplY3QuY3JlYXRlKG51bGwsIHsNCiAgICB0aGlzOiB7IHZhbHVlOiA4NjExMyB9LA0KICAgIGZ1bmN0aW9uOiB7IHZhbHVlOiA4NjEwNiB9LA0KICAgIGlmOiB7IHZhbHVlOiAyMDU3MSB9LA0KICAgIHJldHVybjogeyB2YWx1ZTogMjA1NzQgfSwNCiAgICB2YXI6IHsgdmFsdWU6IDg2MDkwIH0sDQogICAgZWxzZTogeyB2YWx1ZTogMjA1NjUgfSwNCiAgICBmb3I6IHsgdmFsdWU6IDIwNTY5IH0sDQogICAgbmV3OiB7IHZhbHVlOiA4NjEwOSB9LA0KICAgIGluOiB7IHZhbHVlOiA4NzM4ODY4IH0sDQogICAgdHlwZW9mOiB7IHZhbHVlOiAxNjg2MzI3NyB9LA0KICAgIHdoaWxlOiB7IHZhbHVlOiAyMDU4MCB9LA0KICAgIGNhc2U6IHsgdmFsdWU6IDIwNTU4IH0sDQogICAgYnJlYWs6IHsgdmFsdWU6IDIwNTU3IH0sDQogICAgdHJ5OiB7IHZhbHVlOiAyMDU3OSB9LA0KICAgIGNhdGNoOiB7IHZhbHVlOiAyMDU1OSB9LA0KICAgIGRlbGV0ZTogeyB2YWx1ZTogMTY4NjMyNzggfSwNCiAgICB0aHJvdzogeyB2YWx1ZTogODYxMTQgfSwNCiAgICBzd2l0Y2g6IHsgdmFsdWU6IDg2MTEyIH0sDQogICAgY29udGludWU6IHsgdmFsdWU6IDIwNTYxIH0sDQogICAgZGVmYXVsdDogeyB2YWx1ZTogMjA1NjMgfSwNCiAgICBpbnN0YW5jZW9mOiB7IHZhbHVlOiA4NDc2NzI1IH0sDQogICAgZG86IHsgdmFsdWU6IDIwNTY0IH0sDQogICAgdm9pZDogeyB2YWx1ZTogMTY4NjMyNzkgfSwNCiAgICBmaW5hbGx5OiB7IHZhbHVlOiAyMDU2OCB9LA0KICAgIGFzeW5jOiB7IHZhbHVlOiAyMDkwMDcgfSwNCiAgICBhd2FpdDogeyB2YWx1ZTogMjA5MDA4IH0sDQogICAgY2xhc3M6IHsgdmFsdWU6IDg2MDk2IH0sDQogICAgY29uc3Q6IHsgdmFsdWU6IDg2MDkyIH0sDQogICAgY29uc3RydWN0b3I6IHsgdmFsdWU6IDEyNDAxIH0sDQogICAgZGVidWdnZXI6IHsgdmFsdWU6IDIwNTYyIH0sDQogICAgZXhwb3J0OiB7IHZhbHVlOiAyMDU2NiB9LA0KICAgIGV4dGVuZHM6IHsgdmFsdWU6IDIwNTY3IH0sDQogICAgZmFsc2U6IHsgdmFsdWU6IDg2MDIxIH0sDQogICAgZnJvbTogeyB2YWx1ZTogMTI0MDQgfSwNCiAgICBnZXQ6IHsgdmFsdWU6IDEyNDAyIH0sDQogICAgaW1wbGVtZW50czogeyB2YWx1ZTogMzY5NjYgfSwNCiAgICBpbXBvcnQ6IHsgdmFsdWU6IDg2MTA4IH0sDQogICAgaW50ZXJmYWNlOiB7IHZhbHVlOiAzNjk2NyB9LA0KICAgIGxldDogeyB2YWx1ZTogMjQxNzM5IH0sDQogICAgbnVsbDogeyB2YWx1ZTogODYwMjMgfSwNCiAgICBvZjogeyB2YWx1ZTogMjc0NTQ5IH0sDQogICAgcGFja2FnZTogeyB2YWx1ZTogMzY5NjggfSwNCiAgICBwcml2YXRlOiB7IHZhbHVlOiAzNjk2OSB9LA0KICAgIHByb3RlY3RlZDogeyB2YWx1ZTogMzY5NzAgfSwNCiAgICBwdWJsaWM6IHsgdmFsdWU6IDM2OTcxIH0sDQogICAgc2V0OiB7IHZhbHVlOiAxMjQwMyB9LA0KICAgIHN0YXRpYzogeyB2YWx1ZTogMzY5NzIgfSwNCiAgICBzdXBlcjogeyB2YWx1ZTogODYxMTEgfSwNCiAgICB0cnVlOiB7IHZhbHVlOiA4NjAyMiB9LA0KICAgIHdpdGg6IHsgdmFsdWU6IDIwNTgxIH0sDQogICAgeWllbGQ6IHsgdmFsdWU6IDI0MTc3MyB9LA0KICAgIGVudW06IHsgdmFsdWU6IDg2MTM0IH0sDQogICAgZXZhbDogeyB2YWx1ZTogNTM3MDc5OTI3IH0sDQogICAgYXM6IHsgdmFsdWU6IDc3OTM0IH0sDQogICAgYXJndW1lbnRzOiB7IHZhbHVlOiA1MzcwNzk5MjggfSwNCiAgICB0YXJnZXQ6IHsgdmFsdWU6IDE0MzQ5NCB9LA0KICAgIG1ldGE6IHsgdmFsdWU6IDE0MzQ5NSB9LA0KfSk7CgpmdW5jdGlvbiBzY2FuSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIGlzVmFsaWRBc0tleXdvcmQpIHsNCiAgICB3aGlsZSAoaXNJZFBhcnRbYWR2YW5jZUNoYXIocGFyc2VyKV0pIHsgfQ0KICAgIHBhcnNlci50b2tlblZhbHVlID0gcGFyc2VyLnNvdXJjZS5zbGljZShwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5pbmRleCk7DQogICAgcmV0dXJuIHBhcnNlci5jdXJyZW50Q2hhciAhPT0gOTIgJiYgcGFyc2VyLmN1cnJlbnRDaGFyIDw9IDB4N2UNCiAgICAgICAgPyBkZXNjS2V5d29yZFRhYmxlW3BhcnNlci50b2tlblZhbHVlXSB8fCAyMDg4OTcNCiAgICAgICAgOiBzY2FuSWRlbnRpZmllclNsb3dDYXNlKHBhcnNlciwgY29udGV4dCwgMCwgaXNWYWxpZEFzS2V5d29yZCk7DQp9DQpmdW5jdGlvbiBzY2FuVW5pY29kZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgY29va2VkQ2hhciA9IHNjYW5JZGVudGlmaWVyVW5pY29kZUVzY2FwZShwYXJzZXIpOw0KICAgIGlmICghaXNJZGVudGlmaWVyUGFydChjb29rZWRDaGFyKSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNCk7DQogICAgcGFyc2VyLnRva2VuVmFsdWUgPSBmcm9tQ29kZVBvaW50KGNvb2tlZENoYXIpOw0KICAgIHJldHVybiBzY2FuSWRlbnRpZmllclNsb3dDYXNlKHBhcnNlciwgY29udGV4dCwgMSwgQ2hhclR5cGVzW2Nvb2tlZENoYXJdICYgNCk7DQp9DQpmdW5jdGlvbiBzY2FuSWRlbnRpZmllclNsb3dDYXNlKHBhcnNlciwgY29udGV4dCwgaGFzRXNjYXBlLCBpc1ZhbGlkQXNLZXl3b3JkKSB7DQogICAgbGV0IHN0YXJ0ID0gcGFyc2VyLmluZGV4Ow0KICAgIHdoaWxlIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgPT09IDkyKSB7DQogICAgICAgICAgICBwYXJzZXIudG9rZW5WYWx1ZSArPSBwYXJzZXIuc291cmNlLnNsaWNlKHN0YXJ0LCBwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgaGFzRXNjYXBlID0gMTsNCiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSBzY2FuSWRlbnRpZmllclVuaWNvZGVFc2NhcGUocGFyc2VyKTsNCiAgICAgICAgICAgIGlmICghaXNJZGVudGlmaWVyUGFydChjb2RlKSkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0KTsNCiAgICAgICAgICAgIGlzVmFsaWRBc0tleXdvcmQgPSBpc1ZhbGlkQXNLZXl3b3JkICYmIENoYXJUeXBlc1tjb2RlXSAmIDQ7DQogICAgICAgICAgICBwYXJzZXIudG9rZW5WYWx1ZSArPSBmcm9tQ29kZVBvaW50KGNvZGUpOw0KICAgICAgICAgICAgc3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaXNJZGVudGlmaWVyUGFydChwYXJzZXIuY3VycmVudENoYXIpIHx8IGNvbnN1bWVNdWx0aVVuaXRDb2RlUG9pbnQocGFyc2VyLCBwYXJzZXIuY3VycmVudENoYXIpKSB7DQogICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKHBhcnNlci5pbmRleCA8PSBwYXJzZXIuZW5kKSB7DQogICAgICAgIHBhcnNlci50b2tlblZhbHVlICs9IHBhcnNlci5zb3VyY2Uuc2xpY2Uoc3RhcnQsIHBhcnNlci5pbmRleCk7DQogICAgfQ0KICAgIGNvbnN0IGxlbmd0aCA9IHBhcnNlci50b2tlblZhbHVlLmxlbmd0aDsNCiAgICBpZiAoaXNWYWxpZEFzS2V5d29yZCAmJiBsZW5ndGggPj0gMiAmJiBsZW5ndGggPD0gMTEpIHsNCiAgICAgICAgY29uc3QgdG9rZW4gPSBkZXNjS2V5d29yZFRhYmxlW3BhcnNlci50b2tlblZhbHVlXTsNCiAgICAgICAgaWYgKHRva2VuID09PSB2b2lkIDApDQogICAgICAgICAgICByZXR1cm4gMjA4ODk3Ow0KICAgICAgICBpZiAoIWhhc0VzY2FwZSkNCiAgICAgICAgICAgIHJldHVybiB0b2tlbjsNCiAgICAgICAgaWYgKHRva2VuID09PSAyMDkwMDgpIHsNCiAgICAgICAgICAgIGlmICgoY29udGV4dCAmICgyMDQ4IHwgNDE5NDMwNCkpID09PSAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDEyMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMzY5NzIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMTIyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCh0b2tlbiAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMTIyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCh0b2tlbiAmIDIwNDgwKSA9PT0gMjA0ODApIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwNzM3NDE4MjQgJiYgKGNvbnRleHQgJiA4MTkyKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTIxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAxNDM0ODM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbnRleHQgJiAxMDczNzQxODI0ICYmDQogICAgICAgICAgICAoY29udGV4dCAmIDgxOTIpID09PSAwICYmDQogICAgICAgICAgICAodG9rZW4gJiAyMDQ4MCkgPT09IDIwNDgwKQ0KICAgICAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgICAgICBpZiAodG9rZW4gPT09IDI0MTc3Mykgew0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQgJiAxMDczNzQxODI0DQogICAgICAgICAgICAgICAgPyAxNDM0ODMNCiAgICAgICAgICAgICAgICA6IGNvbnRleHQgJiAyMDk3MTUyDQogICAgICAgICAgICAgICAgICAgID8gMTIxDQogICAgICAgICAgICAgICAgICAgIDogdG9rZW47DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRva2VuID09PSAyMDkwMDcpIHsNCiAgICAgICAgICAgIHJldHVybiAxNDM0ODM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCh0b2tlbiAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgIHJldHVybiB0b2tlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMTIxOw0KICAgIH0NCiAgICByZXR1cm4gMjA4ODk3Ow0KfQ0KZnVuY3Rpb24gc2NhblByaXZhdGVJZGVudGlmaWVyKHBhcnNlcikgew0KICAgIGlmICghaXNJZGVudGlmaWVyU3RhcnQkMShhZHZhbmNlQ2hhcihwYXJzZXIpKSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTQpOw0KICAgIHJldHVybiAxMzE7DQp9DQpmdW5jdGlvbiBzY2FuSWRlbnRpZmllclVuaWNvZGVFc2NhcGUocGFyc2VyKSB7DQogICAgaWYgKHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAxKSAhPT0gMTE3KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDQpOw0KICAgIH0NCiAgICBwYXJzZXIuY3VycmVudENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoKHBhcnNlci5pbmRleCArPSAyKSk7DQogICAgcmV0dXJuIHNjYW5Vbmljb2RlRXNjYXBlKHBhcnNlcik7DQp9DQpmdW5jdGlvbiBzY2FuVW5pY29kZUVzY2FwZShwYXJzZXIpIHsNCiAgICBsZXQgY29kZVBvaW50ID0gMDsNCiAgICBjb25zdCBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgIGlmIChjaGFyID09PSAxMjMpIHsNCiAgICAgICAgY29uc3QgYmVnaW4gPSBwYXJzZXIuaW5kZXggLSAyOw0KICAgICAgICB3aGlsZSAoQ2hhclR5cGVzW2FkdmFuY2VDaGFyKHBhcnNlcildICYgNjQpIHsNCiAgICAgICAgICAgIGNvZGVQb2ludCA9IChjb2RlUG9pbnQgPDwgNCkgfCB0b0hleChwYXJzZXIuY3VycmVudENoYXIpOw0KICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA+IDExMTQxMTEpDQogICAgICAgICAgICAgICAgcmVwb3J0U2Nhbm5lckVycm9yKGJlZ2luLCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4ICsgMSwgMTAyKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyICE9PSAxMjUpIHsNCiAgICAgICAgICAgIHJlcG9ydFNjYW5uZXJFcnJvcihiZWdpbiwgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCAtIDEsIDYpOw0KICAgICAgICB9DQogICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIHJldHVybiBjb2RlUG9pbnQ7DQogICAgfQ0KICAgIGlmICgoQ2hhclR5cGVzW2NoYXJdICYgNjQpID09PSAwKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA2KTsNCiAgICBjb25zdCBjaGFyMiA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAxKTsNCiAgICBpZiAoKENoYXJUeXBlc1tjaGFyMl0gJiA2NCkgPT09IDApDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYpOw0KICAgIGNvbnN0IGNoYXIzID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDIpOw0KICAgIGlmICgoQ2hhclR5cGVzW2NoYXIzXSAmIDY0KSA9PT0gMCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNik7DQogICAgY29uc3QgY2hhcjQgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMyk7DQogICAgaWYgKChDaGFyVHlwZXNbY2hhcjRdICYgNjQpID09PSAwKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA2KTsNCiAgICBjb2RlUG9pbnQgPSAodG9IZXgoY2hhcikgPDwgMTIpIHwgKHRvSGV4KGNoYXIyKSA8PCA4KSB8ICh0b0hleChjaGFyMykgPDwgNCkgfCB0b0hleChjaGFyNCk7DQogICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KChwYXJzZXIuaW5kZXggKz0gNCkpOw0KICAgIHJldHVybiBjb2RlUG9pbnQ7DQp9Cgpjb25zdCBUb2tlbkxvb2t1cCA9IFsNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjgsDQogICAgMTM2LA0KICAgIDEyOCwNCiAgICAxMjgsDQogICAgMTMwLA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOCwNCiAgICAxNjg0MjgwMCwNCiAgICAxMzQyODMyNjcsDQogICAgMTMxLA0KICAgIDIwODg5NywNCiAgICA4NDU3MDE1LA0KICAgIDg0NTU3NTEsDQogICAgMTM0MjgzMjY3LA0KICAgIDY3MTc0NDExLA0KICAgIDE2LA0KICAgIDg0NTcwMTQsDQogICAgMjUyMzM5NzAsDQogICAgMTgsDQogICAgMjUyMzM5NzEsDQogICAgNjcxMDg4NzcsDQogICAgODQ1NzAxNiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMjEsDQogICAgMTA3NDc5MDQxNywNCiAgICA4NDU2MjU4LA0KICAgIDEwNzc5MzYxNTcsDQogICAgODQ1NjI1OSwNCiAgICAyMiwNCiAgICAxMzMsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICA2OTI3MTU3MSwNCiAgICAxMzcsDQogICAgMjAsDQogICAgODQ1NTQ5NywNCiAgICAyMDg4OTcsDQogICAgMTMyLA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICAyMDg4OTcsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgMjE2MjcwMCwNCiAgICA4NDU1MjQwLA0KICAgIDEwNzQ3OTA0MTUsDQogICAgMTY4NDI4MDEsDQogICAgMTI5DQpdOw0KZnVuY3Rpb24gbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCkgew0KICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAxKSBeIDE7DQogICAgcGFyc2VyLnN0YXJ0UG9zID0gcGFyc2VyLmluZGV4Ow0KICAgIHBhcnNlci5zdGFydENvbHVtbiA9IHBhcnNlci5jb2x1bW47DQogICAgcGFyc2VyLnN0YXJ0TGluZSA9IHBhcnNlci5saW5lOw0KICAgIHBhcnNlci50b2tlbiA9IHNjYW5TaW5nbGVUb2tlbihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgIGlmIChwYXJzZXIub25Ub2tlbiAmJiBwYXJzZXIudG9rZW4gIT09IDEwNDg1NzYpIHsNCiAgICAgICAgY29uc3QgbG9jID0gew0KICAgICAgICAgICAgc3RhcnQ6IHsNCiAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIubGluZVBvcywNCiAgICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlci5jb2xQb3MNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmQ6IHsNCiAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIubGluZSwNCiAgICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlci5jb2x1bW4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgcGFyc2VyLm9uVG9rZW4oY29udmVydFRva2VuVHlwZShwYXJzZXIudG9rZW4pLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5pbmRleCwgbG9jKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBzY2FuU2luZ2xlVG9rZW4ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSkgew0KICAgIGNvbnN0IGlzU3RhcnRPZkxpbmUgPSBwYXJzZXIuaW5kZXggPT09IDA7DQogICAgY29uc3Qgc291cmNlID0gcGFyc2VyLnNvdXJjZTsNCiAgICBsZXQgc3RhcnRQb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgbGV0IHN0YXJ0TGluZSA9IHBhcnNlci5saW5lOw0KICAgIGxldCBzdGFydENvbHVtbiA9IHBhcnNlci5jb2x1bW47DQogICAgd2hpbGUgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgcGFyc2VyLnRva2VuUG9zID0gcGFyc2VyLmluZGV4Ow0KICAgICAgICBwYXJzZXIuY29sUG9zID0gcGFyc2VyLmNvbHVtbjsNCiAgICAgICAgcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICAgICAgbGV0IGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgIGlmIChjaGFyIDw9IDB4N2UpIHsNCiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gVG9rZW5Mb29rdXBbY2hhcl07DQogICAgICAgICAgICBzd2l0Y2ggKHRva2VuKSB7DQogICAgICAgICAgICAgICAgY2FzZSA2NzE3NDQxMToNCiAgICAgICAgICAgICAgICBjYXNlIDE2Og0KICAgICAgICAgICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgICAgICBjYXNlIDEwNzQ3OTA0MTU6DQogICAgICAgICAgICAgICAgY2FzZSA2OTI3MTU3MToNCiAgICAgICAgICAgICAgICBjYXNlIDIwOg0KICAgICAgICAgICAgICAgIGNhc2UgMjE6DQogICAgICAgICAgICAgICAgY2FzZSAxMDc0NzkwNDE3Og0KICAgICAgICAgICAgICAgIGNhc2UgMTg6DQogICAgICAgICAgICAgICAgY2FzZSAxNjg0MjgwMToNCiAgICAgICAgICAgICAgICBjYXNlIDEzMzoNCiAgICAgICAgICAgICAgICBjYXNlIDEyOToNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgICAgICAgICAgICAgIGNhc2UgMjA4ODk3Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbklkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICBjYXNlIDQwOTY6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDEpOw0KICAgICAgICAgICAgICAgIGNhc2UgMTM0MjgzMjY2Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Nhbk51bWJlciQxKHBhcnNlciwgY29udGV4dCwgMTYgfCAxMjgpOw0KICAgICAgICAgICAgICAgIGNhc2UgMTM0MjgzMjY3Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhblN0cmluZyQxKHBhcnNlciwgY29udGV4dCwgY2hhcik7DQogICAgICAgICAgICAgICAgY2FzZSAxMzI6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuVGVtcGxhdGUocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICBjYXNlIDEzNzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5Vbmljb2RlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGNhc2UgMTMxOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhblByaXZhdGVJZGVudGlmaWVyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgY2FzZSAxMjg6DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgMTMwOg0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxIHwgNDsNCiAgICAgICAgICAgICAgICAgICAgc2Nhbk5ld0xpbmUocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAxMzY6DQogICAgICAgICAgICAgICAgICAgIGNvbnN1bWVMaW5lRmVlZChwYXJzZXIsIHN0YXRlKTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAoc3RhdGUgJiB+NCkgfCAxOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDg0NTYyNTg6DQogICAgICAgICAgICAgICAgICAgIGxldCBjaCA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQgJiYgYWR2YW5jZUNoYXIocGFyc2VyKSA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzMzQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2NTE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjI1NjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gMzMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBhcnNlci5pbmRleCArIDE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICsgMSA8IHBhcnNlci5lbmQgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpID09PSA0NSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UuY2hhckNvZGVBdChpbmRleCArIDEpID09IDQ1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gKz0gMzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gc291cmNlLmNoYXJDb2RlQXQoKHBhcnNlci5pbmRleCArPSAzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gc2tpcFNpbmdsZUhUTUxDb21tZW50KHBhcnNlciwgc291cmNlLCBzdGF0ZSwgY29udGV4dCwgMiwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gcGFyc2VyLnRva2VuUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydExpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTYyNTg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDQ3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgMTYpID09PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjI1ODsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBhcnNlci5pbmRleCArIDE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaCA9IHNvdXJjZS5jaGFyQ29kZUF0KGluZGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0MiB8fCBjaCA9PT0gNDcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTYyNTg7DQogICAgICAgICAgICAgICAgY2FzZSAxMDc3OTM2MTU3OiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU1OTk2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTU5OTg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTA3NzkzNjE1NzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAxNjg0MjgwMDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgIT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTY4NDI4MDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgIT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NTk5OTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NTk5NzsNCiAgICAgICAgICAgICAgICBjYXNlIDg0NTcwMTU6DQogICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpICE9PSA2MSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU3MDE1Ow0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDM0MjsNCiAgICAgICAgICAgICAgICBjYXNlIDg0NTcwMTQ6IHsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5pbmRleCA+PSBwYXJzZXIuZW5kKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTcwMTQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoICE9PSA0MikNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU3MDE0Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSAhPT0gNjEpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NzI3MzsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzMzc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NTQ5NzoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgIT09IDYxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTU0OTc7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzQzOw0KICAgICAgICAgICAgICAgIGNhc2UgMjUyMzM5NzA6IHsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzM2MTk5OTU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzM4Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAyNTIzMzk3MDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAyNTIzMzk3MTogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjaCA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0NSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoc3RhdGUgJiAxIHx8IGlzU3RhcnRPZkxpbmUpICYmIHBhcnNlci5jdXJyZW50Q2hhciA9PT0gNjIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbnRleHQgJiAyNTYpID09PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMDkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBza2lwU2luZ2xlSFRNTENvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlLCBjb250ZXh0LCAzLCBzdGFydFBvcywgc3RhcnRMaW5lLCBzdGFydENvbHVtbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRMaW5lID0gcGFyc2VyLmxpbmVQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMzNjE5OTk2Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDMzOTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjUyMzM5NzE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NzAxNjogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDQ3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IHNraXBTaW5nbGVMaW5lQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgc3RhdGUsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gcGFyc2VyLnRva2VuUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gc2tpcE11bHRpTGluZUNvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFBvcyA9IHBhcnNlci50b2tlblBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydExpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IHBhcnNlci5jb2xQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDMyNzY4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5SZWd1bGFyRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQyNTk4Nzc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTcwMTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgNjcxMDg4Nzc6DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCA+PSA0OCAmJiBuZXh0IDw9IDU3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5OdW1iZXIkMShwYXJzZXIsIGNvbnRleHQsIDY0IHwgMTYpOw0KICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCA9PT0gNDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHBhcnNlci5lbmQgJiYgc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpID09PSA0Nikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gKz0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBzb3VyY2UuY2hhckNvZGVBdCgocGFyc2VyLmluZGV4ICs9IDIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDY3MTA4ODc3Ow0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NTI0MDogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjaCA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSAxMjQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODk3OTAwMzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTUyNDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NjI1OTogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjaCA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2MjU3Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCAhPT0gNjIpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjI1OTsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDMzNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTY1MTg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDMzNTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjUxNzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSA4NDU1NzUxOiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDM4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzQ3Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg5NzkyNTg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzQ1Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU1NzUxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXNlIDIyOiB7DQogICAgICAgICAgICAgICAgICAgIGxldCBjaCA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjc2ODg5OTgyOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaCA9IHNvdXJjZS5jaGFyQ29kZUF0KGluZGV4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShjaCA+PSA0OCAmJiBjaCA8PSA1NykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDY3MTA4OTkxOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKChjaGFyIF4gODIzMikgPD0gMSkgew0KICAgICAgICAgICAgICAgIHN0YXRlID0gKHN0YXRlICYgfjQpIHwgMTsNCiAgICAgICAgICAgICAgICBzY2FuTmV3TGluZShwYXJzZXIpOw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKChjaGFyICYgMHhmYzAwKSA9PT0gMHhkODAwIHx8ICgodW5pY29kZUxvb2t1cFsoY2hhciA+Pj4gNSkgKyAzNDgxNl0gPj4+IGNoYXIpICYgMzEgJiAxKSAhPT0gMCkgew0KICAgICAgICAgICAgICAgIGlmICgoY2hhciAmIDB4ZmMwMCkgPT09IDB4ZGMwMCkgew0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gKChjaGFyICYgMHgzZmYpIDw8IDEwKSB8IChjaGFyICYgMHgzZmYpIHwgMHgxMDAwMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCgodW5pY29kZUxvb2t1cFsoY2hhciA+Pj4gNSkgKyAwXSA+Pj4gY2hhcikgJiAzMSAmIDEpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxOCwgZnJvbUNvZGVQb2ludChjaGFyKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IGNoYXI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4rKzsNCiAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW5WYWx1ZSA9ICcnOw0KICAgICAgICAgICAgICAgIHJldHVybiBzY2FuSWRlbnRpZmllclNsb3dDYXNlKHBhcnNlciwgY29udGV4dCwgMCwgMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoaXNFeG90aWNFQ01BU2NyaXB0V2hpdGVzcGFjZShjaGFyKSkgew0KICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxOCwgZnJvbUNvZGVQb2ludChjaGFyKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIDEwNDg1NzY7DQp9Cgpjb25zdCBlbnRpdGllcyA9IHsNCiAgICBBRWxpZzogJ1x1MDBDNicsDQogICAgQU1QOiAnXHUwMDI2JywNCiAgICBBYWN1dGU6ICdcdTAwQzEnLA0KICAgIEFicmV2ZTogJ1x1MDEwMicsDQogICAgQWNpcmM6ICdcdTAwQzInLA0KICAgIEFjeTogJ1x1MDQxMCcsDQogICAgQWZyOiAnXHVEODM1XHVERDA0JywNCiAgICBBZ3JhdmU6ICdcdTAwQzAnLA0KICAgIEFscGhhOiAnXHUwMzkxJywNCiAgICBBbWFjcjogJ1x1MDEwMCcsDQogICAgQW5kOiAnXHUyQTUzJywNCiAgICBBb2dvbjogJ1x1MDEwNCcsDQogICAgQW9wZjogJ1x1RDgzNVx1REQzOCcsDQogICAgQXBwbHlGdW5jdGlvbjogJ1x1MjA2MScsDQogICAgQXJpbmc6ICdcdTAwQzUnLA0KICAgIEFzY3I6ICdcdUQ4MzVcdURDOUMnLA0KICAgIEFzc2lnbjogJ1x1MjI1NCcsDQogICAgQXRpbGRlOiAnXHUwMEMzJywNCiAgICBBdW1sOiAnXHUwMEM0JywNCiAgICBCYWNrc2xhc2g6ICdcdTIyMTYnLA0KICAgIEJhcnY6ICdcdTJBRTcnLA0KICAgIEJhcndlZDogJ1x1MjMwNicsDQogICAgQmN5OiAnXHUwNDExJywNCiAgICBCZWNhdXNlOiAnXHUyMjM1JywNCiAgICBCZXJub3VsbGlzOiAnXHUyMTJDJywNCiAgICBCZXRhOiAnXHUwMzkyJywNCiAgICBCZnI6ICdcdUQ4MzVcdUREMDUnLA0KICAgIEJvcGY6ICdcdUQ4MzVcdUREMzknLA0KICAgIEJyZXZlOiAnXHUwMkQ4JywNCiAgICBCc2NyOiAnXHUyMTJDJywNCiAgICBCdW1wZXE6ICdcdTIyNEUnLA0KICAgIENIY3k6ICdcdTA0MjcnLA0KICAgIENPUFk6ICdcdTAwQTknLA0KICAgIENhY3V0ZTogJ1x1MDEwNicsDQogICAgQ2FwOiAnXHUyMkQyJywNCiAgICBDYXBpdGFsRGlmZmVyZW50aWFsRDogJ1x1MjE0NScsDQogICAgQ2F5bGV5czogJ1x1MjEyRCcsDQogICAgQ2Nhcm9uOiAnXHUwMTBDJywNCiAgICBDY2VkaWw6ICdcdTAwQzcnLA0KICAgIENjaXJjOiAnXHUwMTA4JywNCiAgICBDY29uaW50OiAnXHUyMjMwJywNCiAgICBDZG90OiAnXHUwMTBBJywNCiAgICBDZWRpbGxhOiAnXHUwMEI4JywNCiAgICBDZW50ZXJEb3Q6ICdcdTAwQjcnLA0KICAgIENmcjogJ1x1MjEyRCcsDQogICAgQ2hpOiAnXHUwM0E3JywNCiAgICBDaXJjbGVEb3Q6ICdcdTIyOTknLA0KICAgIENpcmNsZU1pbnVzOiAnXHUyMjk2JywNCiAgICBDaXJjbGVQbHVzOiAnXHUyMjk1JywNCiAgICBDaXJjbGVUaW1lczogJ1x1MjI5NycsDQogICAgQ2xvY2t3aXNlQ29udG91ckludGVncmFsOiAnXHUyMjMyJywNCiAgICBDbG9zZUN1cmx5RG91YmxlUXVvdGU6ICdcdTIwMUQnLA0KICAgIENsb3NlQ3VybHlRdW90ZTogJ1x1MjAxOScsDQogICAgQ29sb246ICdcdTIyMzcnLA0KICAgIENvbG9uZTogJ1x1MkE3NCcsDQogICAgQ29uZ3J1ZW50OiAnXHUyMjYxJywNCiAgICBDb25pbnQ6ICdcdTIyMkYnLA0KICAgIENvbnRvdXJJbnRlZ3JhbDogJ1x1MjIyRScsDQogICAgQ29wZjogJ1x1MjEwMicsDQogICAgQ29wcm9kdWN0OiAnXHUyMjEwJywNCiAgICBDb3VudGVyQ2xvY2t3aXNlQ29udG91ckludGVncmFsOiAnXHUyMjMzJywNCiAgICBDcm9zczogJ1x1MkEyRicsDQogICAgQ3NjcjogJ1x1RDgzNVx1REM5RScsDQogICAgQ3VwOiAnXHUyMkQzJywNCiAgICBDdXBDYXA6ICdcdTIyNEQnLA0KICAgIEREOiAnXHUyMTQ1JywNCiAgICBERG90cmFoZDogJ1x1MjkxMScsDQogICAgREpjeTogJ1x1MDQwMicsDQogICAgRFNjeTogJ1x1MDQwNScsDQogICAgRFpjeTogJ1x1MDQwRicsDQogICAgRGFnZ2VyOiAnXHUyMDIxJywNCiAgICBEYXJyOiAnXHUyMUExJywNCiAgICBEYXNodjogJ1x1MkFFNCcsDQogICAgRGNhcm9uOiAnXHUwMTBFJywNCiAgICBEY3k6ICdcdTA0MTQnLA0KICAgIERlbDogJ1x1MjIwNycsDQogICAgRGVsdGE6ICdcdTAzOTQnLA0KICAgIERmcjogJ1x1RDgzNVx1REQwNycsDQogICAgRGlhY3JpdGljYWxBY3V0ZTogJ1x1MDBCNCcsDQogICAgRGlhY3JpdGljYWxEb3Q6ICdcdTAyRDknLA0KICAgIERpYWNyaXRpY2FsRG91YmxlQWN1dGU6ICdcdTAyREQnLA0KICAgIERpYWNyaXRpY2FsR3JhdmU6ICdcdTAwNjAnLA0KICAgIERpYWNyaXRpY2FsVGlsZGU6ICdcdTAyREMnLA0KICAgIERpYW1vbmQ6ICdcdTIyQzQnLA0KICAgIERpZmZlcmVudGlhbEQ6ICdcdTIxNDYnLA0KICAgIERvcGY6ICdcdUQ4MzVcdUREM0InLA0KICAgIERvdDogJ1x1MDBBOCcsDQogICAgRG90RG90OiAnXHUyMERDJywNCiAgICBEb3RFcXVhbDogJ1x1MjI1MCcsDQogICAgRG91YmxlQ29udG91ckludGVncmFsOiAnXHUyMjJGJywNCiAgICBEb3VibGVEb3Q6ICdcdTAwQTgnLA0KICAgIERvdWJsZURvd25BcnJvdzogJ1x1MjFEMycsDQogICAgRG91YmxlTGVmdEFycm93OiAnXHUyMUQwJywNCiAgICBEb3VibGVMZWZ0UmlnaHRBcnJvdzogJ1x1MjFENCcsDQogICAgRG91YmxlTGVmdFRlZTogJ1x1MkFFNCcsDQogICAgRG91YmxlTG9uZ0xlZnRBcnJvdzogJ1x1MjdGOCcsDQogICAgRG91YmxlTG9uZ0xlZnRSaWdodEFycm93OiAnXHUyN0ZBJywNCiAgICBEb3VibGVMb25nUmlnaHRBcnJvdzogJ1x1MjdGOScsDQogICAgRG91YmxlUmlnaHRBcnJvdzogJ1x1MjFEMicsDQogICAgRG91YmxlUmlnaHRUZWU6ICdcdTIyQTgnLA0KICAgIERvdWJsZVVwQXJyb3c6ICdcdTIxRDEnLA0KICAgIERvdWJsZVVwRG93bkFycm93OiAnXHUyMUQ1JywNCiAgICBEb3VibGVWZXJ0aWNhbEJhcjogJ1x1MjIyNScsDQogICAgRG93bkFycm93OiAnXHUyMTkzJywNCiAgICBEb3duQXJyb3dCYXI6ICdcdTI5MTMnLA0KICAgIERvd25BcnJvd1VwQXJyb3c6ICdcdTIxRjUnLA0KICAgIERvd25CcmV2ZTogJ1x1MDMxMScsDQogICAgRG93bkxlZnRSaWdodFZlY3RvcjogJ1x1Mjk1MCcsDQogICAgRG93bkxlZnRUZWVWZWN0b3I6ICdcdTI5NUUnLA0KICAgIERvd25MZWZ0VmVjdG9yOiAnXHUyMUJEJywNCiAgICBEb3duTGVmdFZlY3RvckJhcjogJ1x1Mjk1NicsDQogICAgRG93blJpZ2h0VGVlVmVjdG9yOiAnXHUyOTVGJywNCiAgICBEb3duUmlnaHRWZWN0b3I6ICdcdTIxQzEnLA0KICAgIERvd25SaWdodFZlY3RvckJhcjogJ1x1Mjk1NycsDQogICAgRG93blRlZTogJ1x1MjJBNCcsDQogICAgRG93blRlZUFycm93OiAnXHUyMUE3JywNCiAgICBEb3duYXJyb3c6ICdcdTIxRDMnLA0KICAgIERzY3I6ICdcdUQ4MzVcdURDOUYnLA0KICAgIERzdHJvazogJ1x1MDExMCcsDQogICAgRU5HOiAnXHUwMTRBJywNCiAgICBFVEg6ICdcdTAwRDAnLA0KICAgIEVhY3V0ZTogJ1x1MDBDOScsDQogICAgRWNhcm9uOiAnXHUwMTFBJywNCiAgICBFY2lyYzogJ1x1MDBDQScsDQogICAgRWN5OiAnXHUwNDJEJywNCiAgICBFZG90OiAnXHUwMTE2JywNCiAgICBFZnI6ICdcdUQ4MzVcdUREMDgnLA0KICAgIEVncmF2ZTogJ1x1MDBDOCcsDQogICAgRWxlbWVudDogJ1x1MjIwOCcsDQogICAgRW1hY3I6ICdcdTAxMTInLA0KICAgIEVtcHR5U21hbGxTcXVhcmU6ICdcdTI1RkInLA0KICAgIEVtcHR5VmVyeVNtYWxsU3F1YXJlOiAnXHUyNUFCJywNCiAgICBFb2dvbjogJ1x1MDExOCcsDQogICAgRW9wZjogJ1x1RDgzNVx1REQzQycsDQogICAgRXBzaWxvbjogJ1x1MDM5NScsDQogICAgRXF1YWw6ICdcdTJBNzUnLA0KICAgIEVxdWFsVGlsZGU6ICdcdTIyNDInLA0KICAgIEVxdWlsaWJyaXVtOiAnXHUyMUNDJywNCiAgICBFc2NyOiAnXHUyMTMwJywNCiAgICBFc2ltOiAnXHUyQTczJywNCiAgICBFdGE6ICdcdTAzOTcnLA0KICAgIEV1bWw6ICdcdTAwQ0InLA0KICAgIEV4aXN0czogJ1x1MjIwMycsDQogICAgRXhwb25lbnRpYWxFOiAnXHUyMTQ3JywNCiAgICBGY3k6ICdcdTA0MjQnLA0KICAgIEZmcjogJ1x1RDgzNVx1REQwOScsDQogICAgRmlsbGVkU21hbGxTcXVhcmU6ICdcdTI1RkMnLA0KICAgIEZpbGxlZFZlcnlTbWFsbFNxdWFyZTogJ1x1MjVBQScsDQogICAgRm9wZjogJ1x1RDgzNVx1REQzRCcsDQogICAgRm9yQWxsOiAnXHUyMjAwJywNCiAgICBGb3VyaWVydHJmOiAnXHUyMTMxJywNCiAgICBGc2NyOiAnXHUyMTMxJywNCiAgICBHSmN5OiAnXHUwNDAzJywNCiAgICBHVDogJ1x1MDAzRScsDQogICAgR2FtbWE6ICdcdTAzOTMnLA0KICAgIEdhbW1hZDogJ1x1MDNEQycsDQogICAgR2JyZXZlOiAnXHUwMTFFJywNCiAgICBHY2VkaWw6ICdcdTAxMjInLA0KICAgIEdjaXJjOiAnXHUwMTFDJywNCiAgICBHY3k6ICdcdTA0MTMnLA0KICAgIEdkb3Q6ICdcdTAxMjAnLA0KICAgIEdmcjogJ1x1RDgzNVx1REQwQScsDQogICAgR2c6ICdcdTIyRDknLA0KICAgIEdvcGY6ICdcdUQ4MzVcdUREM0UnLA0KICAgIEdyZWF0ZXJFcXVhbDogJ1x1MjI2NScsDQogICAgR3JlYXRlckVxdWFsTGVzczogJ1x1MjJEQicsDQogICAgR3JlYXRlckZ1bGxFcXVhbDogJ1x1MjI2NycsDQogICAgR3JlYXRlckdyZWF0ZXI6ICdcdTJBQTInLA0KICAgIEdyZWF0ZXJMZXNzOiAnXHUyMjc3JywNCiAgICBHcmVhdGVyU2xhbnRFcXVhbDogJ1x1MkE3RScsDQogICAgR3JlYXRlclRpbGRlOiAnXHUyMjczJywNCiAgICBHc2NyOiAnXHVEODM1XHVEQ0EyJywNCiAgICBHdDogJ1x1MjI2QicsDQogICAgSEFSRGN5OiAnXHUwNDJBJywNCiAgICBIYWNlazogJ1x1MDJDNycsDQogICAgSGF0OiAnXHUwMDVFJywNCiAgICBIY2lyYzogJ1x1MDEyNCcsDQogICAgSGZyOiAnXHUyMTBDJywNCiAgICBIaWxiZXJ0U3BhY2U6ICdcdTIxMEInLA0KICAgIEhvcGY6ICdcdTIxMEQnLA0KICAgIEhvcml6b250YWxMaW5lOiAnXHUyNTAwJywNCiAgICBIc2NyOiAnXHUyMTBCJywNCiAgICBIc3Ryb2s6ICdcdTAxMjYnLA0KICAgIEh1bXBEb3duSHVtcDogJ1x1MjI0RScsDQogICAgSHVtcEVxdWFsOiAnXHUyMjRGJywNCiAgICBJRWN5OiAnXHUwNDE1JywNCiAgICBJSmxpZzogJ1x1MDEzMicsDQogICAgSU9jeTogJ1x1MDQwMScsDQogICAgSWFjdXRlOiAnXHUwMENEJywNCiAgICBJY2lyYzogJ1x1MDBDRScsDQogICAgSWN5OiAnXHUwNDE4JywNCiAgICBJZG90OiAnXHUwMTMwJywNCiAgICBJZnI6ICdcdTIxMTEnLA0KICAgIElncmF2ZTogJ1x1MDBDQycsDQogICAgSW06ICdcdTIxMTEnLA0KICAgIEltYWNyOiAnXHUwMTJBJywNCiAgICBJbWFnaW5hcnlJOiAnXHUyMTQ4JywNCiAgICBJbXBsaWVzOiAnXHUyMUQyJywNCiAgICBJbnQ6ICdcdTIyMkMnLA0KICAgIEludGVncmFsOiAnXHUyMjJCJywNCiAgICBJbnRlcnNlY3Rpb246ICdcdTIyQzInLA0KICAgIEludmlzaWJsZUNvbW1hOiAnXHUyMDYzJywNCiAgICBJbnZpc2libGVUaW1lczogJ1x1MjA2MicsDQogICAgSW9nb246ICdcdTAxMkUnLA0KICAgIElvcGY6ICdcdUQ4MzVcdURENDAnLA0KICAgIElvdGE6ICdcdTAzOTknLA0KICAgIElzY3I6ICdcdTIxMTAnLA0KICAgIEl0aWxkZTogJ1x1MDEyOCcsDQogICAgSXVrY3k6ICdcdTA0MDYnLA0KICAgIEl1bWw6ICdcdTAwQ0YnLA0KICAgIEpjaXJjOiAnXHUwMTM0JywNCiAgICBKY3k6ICdcdTA0MTknLA0KICAgIEpmcjogJ1x1RDgzNVx1REQwRCcsDQogICAgSm9wZjogJ1x1RDgzNVx1REQ0MScsDQogICAgSnNjcjogJ1x1RDgzNVx1RENBNScsDQogICAgSnNlcmN5OiAnXHUwNDA4JywNCiAgICBKdWtjeTogJ1x1MDQwNCcsDQogICAgS0hjeTogJ1x1MDQyNScsDQogICAgS0pjeTogJ1x1MDQwQycsDQogICAgS2FwcGE6ICdcdTAzOUEnLA0KICAgIEtjZWRpbDogJ1x1MDEzNicsDQogICAgS2N5OiAnXHUwNDFBJywNCiAgICBLZnI6ICdcdUQ4MzVcdUREMEUnLA0KICAgIEtvcGY6ICdcdUQ4MzVcdURENDInLA0KICAgIEtzY3I6ICdcdUQ4MzVcdURDQTYnLA0KICAgIExKY3k6ICdcdTA0MDknLA0KICAgIExUOiAnXHUwMDNDJywNCiAgICBMYWN1dGU6ICdcdTAxMzknLA0KICAgIExhbWJkYTogJ1x1MDM5QicsDQogICAgTGFuZzogJ1x1MjdFQScsDQogICAgTGFwbGFjZXRyZjogJ1x1MjExMicsDQogICAgTGFycjogJ1x1MjE5RScsDQogICAgTGNhcm9uOiAnXHUwMTNEJywNCiAgICBMY2VkaWw6ICdcdTAxM0InLA0KICAgIExjeTogJ1x1MDQxQicsDQogICAgTGVmdEFuZ2xlQnJhY2tldDogJ1x1MjdFOCcsDQogICAgTGVmdEFycm93OiAnXHUyMTkwJywNCiAgICBMZWZ0QXJyb3dCYXI6ICdcdTIxRTQnLA0KICAgIExlZnRBcnJvd1JpZ2h0QXJyb3c6ICdcdTIxQzYnLA0KICAgIExlZnRDZWlsaW5nOiAnXHUyMzA4JywNCiAgICBMZWZ0RG91YmxlQnJhY2tldDogJ1x1MjdFNicsDQogICAgTGVmdERvd25UZWVWZWN0b3I6ICdcdTI5NjEnLA0KICAgIExlZnREb3duVmVjdG9yOiAnXHUyMUMzJywNCiAgICBMZWZ0RG93blZlY3RvckJhcjogJ1x1Mjk1OScsDQogICAgTGVmdEZsb29yOiAnXHUyMzBBJywNCiAgICBMZWZ0UmlnaHRBcnJvdzogJ1x1MjE5NCcsDQogICAgTGVmdFJpZ2h0VmVjdG9yOiAnXHUyOTRFJywNCiAgICBMZWZ0VGVlOiAnXHUyMkEzJywNCiAgICBMZWZ0VGVlQXJyb3c6ICdcdTIxQTQnLA0KICAgIExlZnRUZWVWZWN0b3I6ICdcdTI5NUEnLA0KICAgIExlZnRUcmlhbmdsZTogJ1x1MjJCMicsDQogICAgTGVmdFRyaWFuZ2xlQmFyOiAnXHUyOUNGJywNCiAgICBMZWZ0VHJpYW5nbGVFcXVhbDogJ1x1MjJCNCcsDQogICAgTGVmdFVwRG93blZlY3RvcjogJ1x1Mjk1MScsDQogICAgTGVmdFVwVGVlVmVjdG9yOiAnXHUyOTYwJywNCiAgICBMZWZ0VXBWZWN0b3I6ICdcdTIxQkYnLA0KICAgIExlZnRVcFZlY3RvckJhcjogJ1x1Mjk1OCcsDQogICAgTGVmdFZlY3RvcjogJ1x1MjFCQycsDQogICAgTGVmdFZlY3RvckJhcjogJ1x1Mjk1MicsDQogICAgTGVmdGFycm93OiAnXHUyMUQwJywNCiAgICBMZWZ0cmlnaHRhcnJvdzogJ1x1MjFENCcsDQogICAgTGVzc0VxdWFsR3JlYXRlcjogJ1x1MjJEQScsDQogICAgTGVzc0Z1bGxFcXVhbDogJ1x1MjI2NicsDQogICAgTGVzc0dyZWF0ZXI6ICdcdTIyNzYnLA0KICAgIExlc3NMZXNzOiAnXHUyQUExJywNCiAgICBMZXNzU2xhbnRFcXVhbDogJ1x1MkE3RCcsDQogICAgTGVzc1RpbGRlOiAnXHUyMjcyJywNCiAgICBMZnI6ICdcdUQ4MzVcdUREMEYnLA0KICAgIExsOiAnXHUyMkQ4JywNCiAgICBMbGVmdGFycm93OiAnXHUyMURBJywNCiAgICBMbWlkb3Q6ICdcdTAxM0YnLA0KICAgIExvbmdMZWZ0QXJyb3c6ICdcdTI3RjUnLA0KICAgIExvbmdMZWZ0UmlnaHRBcnJvdzogJ1x1MjdGNycsDQogICAgTG9uZ1JpZ2h0QXJyb3c6ICdcdTI3RjYnLA0KICAgIExvbmdsZWZ0YXJyb3c6ICdcdTI3RjgnLA0KICAgIExvbmdsZWZ0cmlnaHRhcnJvdzogJ1x1MjdGQScsDQogICAgTG9uZ3JpZ2h0YXJyb3c6ICdcdTI3RjknLA0KICAgIExvcGY6ICdcdUQ4MzVcdURENDMnLA0KICAgIExvd2VyTGVmdEFycm93OiAnXHUyMTk5JywNCiAgICBMb3dlclJpZ2h0QXJyb3c6ICdcdTIxOTgnLA0KICAgIExzY3I6ICdcdTIxMTInLA0KICAgIExzaDogJ1x1MjFCMCcsDQogICAgTHN0cm9rOiAnXHUwMTQxJywNCiAgICBMdDogJ1x1MjI2QScsDQogICAgTWFwOiAnXHUyOTA1JywNCiAgICBNY3k6ICdcdTA0MUMnLA0KICAgIE1lZGl1bVNwYWNlOiAnXHUyMDVGJywNCiAgICBNZWxsaW50cmY6ICdcdTIxMzMnLA0KICAgIE1mcjogJ1x1RDgzNVx1REQxMCcsDQogICAgTWludXNQbHVzOiAnXHUyMjEzJywNCiAgICBNb3BmOiAnXHVEODM1XHVERDQ0JywNCiAgICBNc2NyOiAnXHUyMTMzJywNCiAgICBNdTogJ1x1MDM5QycsDQogICAgTkpjeTogJ1x1MDQwQScsDQogICAgTmFjdXRlOiAnXHUwMTQzJywNCiAgICBOY2Fyb246ICdcdTAxNDcnLA0KICAgIE5jZWRpbDogJ1x1MDE0NScsDQogICAgTmN5OiAnXHUwNDFEJywNCiAgICBOZWdhdGl2ZU1lZGl1bVNwYWNlOiAnXHUyMDBCJywNCiAgICBOZWdhdGl2ZVRoaWNrU3BhY2U6ICdcdTIwMEInLA0KICAgIE5lZ2F0aXZlVGhpblNwYWNlOiAnXHUyMDBCJywNCiAgICBOZWdhdGl2ZVZlcnlUaGluU3BhY2U6ICdcdTIwMEInLA0KICAgIE5lc3RlZEdyZWF0ZXJHcmVhdGVyOiAnXHUyMjZCJywNCiAgICBOZXN0ZWRMZXNzTGVzczogJ1x1MjI2QScsDQogICAgTmV3TGluZTogJ1x1MDAwQScsDQogICAgTmZyOiAnXHVEODM1XHVERDExJywNCiAgICBOb0JyZWFrOiAnXHUyMDYwJywNCiAgICBOb25CcmVha2luZ1NwYWNlOiAnXHUwMEEwJywNCiAgICBOb3BmOiAnXHUyMTE1JywNCiAgICBOb3Q6ICdcdTJBRUMnLA0KICAgIE5vdENvbmdydWVudDogJ1x1MjI2MicsDQogICAgTm90Q3VwQ2FwOiAnXHUyMjZEJywNCiAgICBOb3REb3VibGVWZXJ0aWNhbEJhcjogJ1x1MjIyNicsDQogICAgTm90RWxlbWVudDogJ1x1MjIwOScsDQogICAgTm90RXF1YWw6ICdcdTIyNjAnLA0KICAgIE5vdEVxdWFsVGlsZGU6ICdcdTIyNDJcdTAzMzgnLA0KICAgIE5vdEV4aXN0czogJ1x1MjIwNCcsDQogICAgTm90R3JlYXRlcjogJ1x1MjI2RicsDQogICAgTm90R3JlYXRlckVxdWFsOiAnXHUyMjcxJywNCiAgICBOb3RHcmVhdGVyRnVsbEVxdWFsOiAnXHUyMjY3XHUwMzM4JywNCiAgICBOb3RHcmVhdGVyR3JlYXRlcjogJ1x1MjI2Qlx1MDMzOCcsDQogICAgTm90R3JlYXRlckxlc3M6ICdcdTIyNzknLA0KICAgIE5vdEdyZWF0ZXJTbGFudEVxdWFsOiAnXHUyQTdFXHUwMzM4JywNCiAgICBOb3RHcmVhdGVyVGlsZGU6ICdcdTIyNzUnLA0KICAgIE5vdEh1bXBEb3duSHVtcDogJ1x1MjI0RVx1MDMzOCcsDQogICAgTm90SHVtcEVxdWFsOiAnXHUyMjRGXHUwMzM4JywNCiAgICBOb3RMZWZ0VHJpYW5nbGU6ICdcdTIyRUEnLA0KICAgIE5vdExlZnRUcmlhbmdsZUJhcjogJ1x1MjlDRlx1MDMzOCcsDQogICAgTm90TGVmdFRyaWFuZ2xlRXF1YWw6ICdcdTIyRUMnLA0KICAgIE5vdExlc3M6ICdcdTIyNkUnLA0KICAgIE5vdExlc3NFcXVhbDogJ1x1MjI3MCcsDQogICAgTm90TGVzc0dyZWF0ZXI6ICdcdTIyNzgnLA0KICAgIE5vdExlc3NMZXNzOiAnXHUyMjZBXHUwMzM4JywNCiAgICBOb3RMZXNzU2xhbnRFcXVhbDogJ1x1MkE3RFx1MDMzOCcsDQogICAgTm90TGVzc1RpbGRlOiAnXHUyMjc0JywNCiAgICBOb3ROZXN0ZWRHcmVhdGVyR3JlYXRlcjogJ1x1MkFBMlx1MDMzOCcsDQogICAgTm90TmVzdGVkTGVzc0xlc3M6ICdcdTJBQTFcdTAzMzgnLA0KICAgIE5vdFByZWNlZGVzOiAnXHUyMjgwJywNCiAgICBOb3RQcmVjZWRlc0VxdWFsOiAnXHUyQUFGXHUwMzM4JywNCiAgICBOb3RQcmVjZWRlc1NsYW50RXF1YWw6ICdcdTIyRTAnLA0KICAgIE5vdFJldmVyc2VFbGVtZW50OiAnXHUyMjBDJywNCiAgICBOb3RSaWdodFRyaWFuZ2xlOiAnXHUyMkVCJywNCiAgICBOb3RSaWdodFRyaWFuZ2xlQmFyOiAnXHUyOUQwXHUwMzM4JywNCiAgICBOb3RSaWdodFRyaWFuZ2xlRXF1YWw6ICdcdTIyRUQnLA0KICAgIE5vdFNxdWFyZVN1YnNldDogJ1x1MjI4Rlx1MDMzOCcsDQogICAgTm90U3F1YXJlU3Vic2V0RXF1YWw6ICdcdTIyRTInLA0KICAgIE5vdFNxdWFyZVN1cGVyc2V0OiAnXHUyMjkwXHUwMzM4JywNCiAgICBOb3RTcXVhcmVTdXBlcnNldEVxdWFsOiAnXHUyMkUzJywNCiAgICBOb3RTdWJzZXQ6ICdcdTIyODJcdTIwRDInLA0KICAgIE5vdFN1YnNldEVxdWFsOiAnXHUyMjg4JywNCiAgICBOb3RTdWNjZWVkczogJ1x1MjI4MScsDQogICAgTm90U3VjY2VlZHNFcXVhbDogJ1x1MkFCMFx1MDMzOCcsDQogICAgTm90U3VjY2VlZHNTbGFudEVxdWFsOiAnXHUyMkUxJywNCiAgICBOb3RTdWNjZWVkc1RpbGRlOiAnXHUyMjdGXHUwMzM4JywNCiAgICBOb3RTdXBlcnNldDogJ1x1MjI4M1x1MjBEMicsDQogICAgTm90U3VwZXJzZXRFcXVhbDogJ1x1MjI4OScsDQogICAgTm90VGlsZGU6ICdcdTIyNDEnLA0KICAgIE5vdFRpbGRlRXF1YWw6ICdcdTIyNDQnLA0KICAgIE5vdFRpbGRlRnVsbEVxdWFsOiAnXHUyMjQ3JywNCiAgICBOb3RUaWxkZVRpbGRlOiAnXHUyMjQ5JywNCiAgICBOb3RWZXJ0aWNhbEJhcjogJ1x1MjIyNCcsDQogICAgTnNjcjogJ1x1RDgzNVx1RENBOScsDQogICAgTnRpbGRlOiAnXHUwMEQxJywNCiAgICBOdTogJ1x1MDM5RCcsDQogICAgT0VsaWc6ICdcdTAxNTInLA0KICAgIE9hY3V0ZTogJ1x1MDBEMycsDQogICAgT2NpcmM6ICdcdTAwRDQnLA0KICAgIE9jeTogJ1x1MDQxRScsDQogICAgT2RibGFjOiAnXHUwMTUwJywNCiAgICBPZnI6ICdcdUQ4MzVcdUREMTInLA0KICAgIE9ncmF2ZTogJ1x1MDBEMicsDQogICAgT21hY3I6ICdcdTAxNEMnLA0KICAgIE9tZWdhOiAnXHUwM0E5JywNCiAgICBPbWljcm9uOiAnXHUwMzlGJywNCiAgICBPb3BmOiAnXHVEODM1XHVERDQ2JywNCiAgICBPcGVuQ3VybHlEb3VibGVRdW90ZTogJ1x1MjAxQycsDQogICAgT3BlbkN1cmx5UXVvdGU6ICdcdTIwMTgnLA0KICAgIE9yOiAnXHUyQTU0JywNCiAgICBPc2NyOiAnXHVEODM1XHVEQ0FBJywNCiAgICBPc2xhc2g6ICdcdTAwRDgnLA0KICAgIE90aWxkZTogJ1x1MDBENScsDQogICAgT3RpbWVzOiAnXHUyQTM3JywNCiAgICBPdW1sOiAnXHUwMEQ2JywNCiAgICBPdmVyQmFyOiAnXHUyMDNFJywNCiAgICBPdmVyQnJhY2U6ICdcdTIzREUnLA0KICAgIE92ZXJCcmFja2V0OiAnXHUyM0I0JywNCiAgICBPdmVyUGFyZW50aGVzaXM6ICdcdTIzREMnLA0KICAgIFBhcnRpYWxEOiAnXHUyMjAyJywNCiAgICBQY3k6ICdcdTA0MUYnLA0KICAgIFBmcjogJ1x1RDgzNVx1REQxMycsDQogICAgUGhpOiAnXHUwM0E2JywNCiAgICBQaTogJ1x1MDNBMCcsDQogICAgUGx1c01pbnVzOiAnXHUwMEIxJywNCiAgICBQb2luY2FyZXBsYW5lOiAnXHUyMTBDJywNCiAgICBQb3BmOiAnXHUyMTE5JywNCiAgICBQcjogJ1x1MkFCQicsDQogICAgUHJlY2VkZXM6ICdcdTIyN0EnLA0KICAgIFByZWNlZGVzRXF1YWw6ICdcdTJBQUYnLA0KICAgIFByZWNlZGVzU2xhbnRFcXVhbDogJ1x1MjI3QycsDQogICAgUHJlY2VkZXNUaWxkZTogJ1x1MjI3RScsDQogICAgUHJpbWU6ICdcdTIwMzMnLA0KICAgIFByb2R1Y3Q6ICdcdTIyMEYnLA0KICAgIFByb3BvcnRpb246ICdcdTIyMzcnLA0KICAgIFByb3BvcnRpb25hbDogJ1x1MjIxRCcsDQogICAgUHNjcjogJ1x1RDgzNVx1RENBQicsDQogICAgUHNpOiAnXHUwM0E4JywNCiAgICBRVU9UOiAnXHUwMDIyJywNCiAgICBRZnI6ICdcdUQ4MzVcdUREMTQnLA0KICAgIFFvcGY6ICdcdTIxMUEnLA0KICAgIFFzY3I6ICdcdUQ4MzVcdURDQUMnLA0KICAgIFJCYXJyOiAnXHUyOTEwJywNCiAgICBSRUc6ICdcdTAwQUUnLA0KICAgIFJhY3V0ZTogJ1x1MDE1NCcsDQogICAgUmFuZzogJ1x1MjdFQicsDQogICAgUmFycjogJ1x1MjFBMCcsDQogICAgUmFycnRsOiAnXHUyOTE2JywNCiAgICBSY2Fyb246ICdcdTAxNTgnLA0KICAgIFJjZWRpbDogJ1x1MDE1NicsDQogICAgUmN5OiAnXHUwNDIwJywNCiAgICBSZTogJ1x1MjExQycsDQogICAgUmV2ZXJzZUVsZW1lbnQ6ICdcdTIyMEInLA0KICAgIFJldmVyc2VFcXVpbGlicml1bTogJ1x1MjFDQicsDQogICAgUmV2ZXJzZVVwRXF1aWxpYnJpdW06ICdcdTI5NkYnLA0KICAgIFJmcjogJ1x1MjExQycsDQogICAgUmhvOiAnXHUwM0ExJywNCiAgICBSaWdodEFuZ2xlQnJhY2tldDogJ1x1MjdFOScsDQogICAgUmlnaHRBcnJvdzogJ1x1MjE5MicsDQogICAgUmlnaHRBcnJvd0JhcjogJ1x1MjFFNScsDQogICAgUmlnaHRBcnJvd0xlZnRBcnJvdzogJ1x1MjFDNCcsDQogICAgUmlnaHRDZWlsaW5nOiAnXHUyMzA5JywNCiAgICBSaWdodERvdWJsZUJyYWNrZXQ6ICdcdTI3RTcnLA0KICAgIFJpZ2h0RG93blRlZVZlY3RvcjogJ1x1Mjk1RCcsDQogICAgUmlnaHREb3duVmVjdG9yOiAnXHUyMUMyJywNCiAgICBSaWdodERvd25WZWN0b3JCYXI6ICdcdTI5NTUnLA0KICAgIFJpZ2h0Rmxvb3I6ICdcdTIzMEInLA0KICAgIFJpZ2h0VGVlOiAnXHUyMkEyJywNCiAgICBSaWdodFRlZUFycm93OiAnXHUyMUE2JywNCiAgICBSaWdodFRlZVZlY3RvcjogJ1x1Mjk1QicsDQogICAgUmlnaHRUcmlhbmdsZTogJ1x1MjJCMycsDQogICAgUmlnaHRUcmlhbmdsZUJhcjogJ1x1MjlEMCcsDQogICAgUmlnaHRUcmlhbmdsZUVxdWFsOiAnXHUyMkI1JywNCiAgICBSaWdodFVwRG93blZlY3RvcjogJ1x1Mjk0RicsDQogICAgUmlnaHRVcFRlZVZlY3RvcjogJ1x1Mjk1QycsDQogICAgUmlnaHRVcFZlY3RvcjogJ1x1MjFCRScsDQogICAgUmlnaHRVcFZlY3RvckJhcjogJ1x1Mjk1NCcsDQogICAgUmlnaHRWZWN0b3I6ICdcdTIxQzAnLA0KICAgIFJpZ2h0VmVjdG9yQmFyOiAnXHUyOTUzJywNCiAgICBSaWdodGFycm93OiAnXHUyMUQyJywNCiAgICBSb3BmOiAnXHUyMTFEJywNCiAgICBSb3VuZEltcGxpZXM6ICdcdTI5NzAnLA0KICAgIFJyaWdodGFycm93OiAnXHUyMURCJywNCiAgICBSc2NyOiAnXHUyMTFCJywNCiAgICBSc2g6ICdcdTIxQjEnLA0KICAgIFJ1bGVEZWxheWVkOiAnXHUyOUY0JywNCiAgICBTSENIY3k6ICdcdTA0MjknLA0KICAgIFNIY3k6ICdcdTA0MjgnLA0KICAgIFNPRlRjeTogJ1x1MDQyQycsDQogICAgU2FjdXRlOiAnXHUwMTVBJywNCiAgICBTYzogJ1x1MkFCQycsDQogICAgU2Nhcm9uOiAnXHUwMTYwJywNCiAgICBTY2VkaWw6ICdcdTAxNUUnLA0KICAgIFNjaXJjOiAnXHUwMTVDJywNCiAgICBTY3k6ICdcdTA0MjEnLA0KICAgIFNmcjogJ1x1RDgzNVx1REQxNicsDQogICAgU2hvcnREb3duQXJyb3c6ICdcdTIxOTMnLA0KICAgIFNob3J0TGVmdEFycm93OiAnXHUyMTkwJywNCiAgICBTaG9ydFJpZ2h0QXJyb3c6ICdcdTIxOTInLA0KICAgIFNob3J0VXBBcnJvdzogJ1x1MjE5MScsDQogICAgU2lnbWE6ICdcdTAzQTMnLA0KICAgIFNtYWxsQ2lyY2xlOiAnXHUyMjE4JywNCiAgICBTb3BmOiAnXHVEODM1XHVERDRBJywNCiAgICBTcXJ0OiAnXHUyMjFBJywNCiAgICBTcXVhcmU6ICdcdTI1QTEnLA0KICAgIFNxdWFyZUludGVyc2VjdGlvbjogJ1x1MjI5MycsDQogICAgU3F1YXJlU3Vic2V0OiAnXHUyMjhGJywNCiAgICBTcXVhcmVTdWJzZXRFcXVhbDogJ1x1MjI5MScsDQogICAgU3F1YXJlU3VwZXJzZXQ6ICdcdTIyOTAnLA0KICAgIFNxdWFyZVN1cGVyc2V0RXF1YWw6ICdcdTIyOTInLA0KICAgIFNxdWFyZVVuaW9uOiAnXHUyMjk0JywNCiAgICBTc2NyOiAnXHVEODM1XHVEQ0FFJywNCiAgICBTdGFyOiAnXHUyMkM2JywNCiAgICBTdWI6ICdcdTIyRDAnLA0KICAgIFN1YnNldDogJ1x1MjJEMCcsDQogICAgU3Vic2V0RXF1YWw6ICdcdTIyODYnLA0KICAgIFN1Y2NlZWRzOiAnXHUyMjdCJywNCiAgICBTdWNjZWVkc0VxdWFsOiAnXHUyQUIwJywNCiAgICBTdWNjZWVkc1NsYW50RXF1YWw6ICdcdTIyN0QnLA0KICAgIFN1Y2NlZWRzVGlsZGU6ICdcdTIyN0YnLA0KICAgIFN1Y2hUaGF0OiAnXHUyMjBCJywNCiAgICBTdW06ICdcdTIyMTEnLA0KICAgIFN1cDogJ1x1MjJEMScsDQogICAgU3VwZXJzZXQ6ICdcdTIyODMnLA0KICAgIFN1cGVyc2V0RXF1YWw6ICdcdTIyODcnLA0KICAgIFN1cHNldDogJ1x1MjJEMScsDQogICAgVEhPUk46ICdcdTAwREUnLA0KICAgIFRSQURFOiAnXHUyMTIyJywNCiAgICBUU0hjeTogJ1x1MDQwQicsDQogICAgVFNjeTogJ1x1MDQyNicsDQogICAgVGFiOiAnXHUwMDA5JywNCiAgICBUYXU6ICdcdTAzQTQnLA0KICAgIFRjYXJvbjogJ1x1MDE2NCcsDQogICAgVGNlZGlsOiAnXHUwMTYyJywNCiAgICBUY3k6ICdcdTA0MjInLA0KICAgIFRmcjogJ1x1RDgzNVx1REQxNycsDQogICAgVGhlcmVmb3JlOiAnXHUyMjM0JywNCiAgICBUaGV0YTogJ1x1MDM5OCcsDQogICAgVGhpY2tTcGFjZTogJ1x1MjA1Rlx1MjAwQScsDQogICAgVGhpblNwYWNlOiAnXHUyMDA5JywNCiAgICBUaWxkZTogJ1x1MjIzQycsDQogICAgVGlsZGVFcXVhbDogJ1x1MjI0MycsDQogICAgVGlsZGVGdWxsRXF1YWw6ICdcdTIyNDUnLA0KICAgIFRpbGRlVGlsZGU6ICdcdTIyNDgnLA0KICAgIFRvcGY6ICdcdUQ4MzVcdURENEInLA0KICAgIFRyaXBsZURvdDogJ1x1MjBEQicsDQogICAgVHNjcjogJ1x1RDgzNVx1RENBRicsDQogICAgVHN0cm9rOiAnXHUwMTY2JywNCiAgICBVYWN1dGU6ICdcdTAwREEnLA0KICAgIFVhcnI6ICdcdTIxOUYnLA0KICAgIFVhcnJvY2lyOiAnXHUyOTQ5JywNCiAgICBVYnJjeTogJ1x1MDQwRScsDQogICAgVWJyZXZlOiAnXHUwMTZDJywNCiAgICBVY2lyYzogJ1x1MDBEQicsDQogICAgVWN5OiAnXHUwNDIzJywNCiAgICBVZGJsYWM6ICdcdTAxNzAnLA0KICAgIFVmcjogJ1x1RDgzNVx1REQxOCcsDQogICAgVWdyYXZlOiAnXHUwMEQ5JywNCiAgICBVbWFjcjogJ1x1MDE2QScsDQogICAgVW5kZXJCYXI6ICdcdTAwNUYnLA0KICAgIFVuZGVyQnJhY2U6ICdcdTIzREYnLA0KICAgIFVuZGVyQnJhY2tldDogJ1x1MjNCNScsDQogICAgVW5kZXJQYXJlbnRoZXNpczogJ1x1MjNERCcsDQogICAgVW5pb246ICdcdTIyQzMnLA0KICAgIFVuaW9uUGx1czogJ1x1MjI4RScsDQogICAgVW9nb246ICdcdTAxNzInLA0KICAgIFVvcGY6ICdcdUQ4MzVcdURENEMnLA0KICAgIFVwQXJyb3c6ICdcdTIxOTEnLA0KICAgIFVwQXJyb3dCYXI6ICdcdTI5MTInLA0KICAgIFVwQXJyb3dEb3duQXJyb3c6ICdcdTIxQzUnLA0KICAgIFVwRG93bkFycm93OiAnXHUyMTk1JywNCiAgICBVcEVxdWlsaWJyaXVtOiAnXHUyOTZFJywNCiAgICBVcFRlZTogJ1x1MjJBNScsDQogICAgVXBUZWVBcnJvdzogJ1x1MjFBNScsDQogICAgVXBhcnJvdzogJ1x1MjFEMScsDQogICAgVXBkb3duYXJyb3c6ICdcdTIxRDUnLA0KICAgIFVwcGVyTGVmdEFycm93OiAnXHUyMTk2JywNCiAgICBVcHBlclJpZ2h0QXJyb3c6ICdcdTIxOTcnLA0KICAgIFVwc2k6ICdcdTAzRDInLA0KICAgIFVwc2lsb246ICdcdTAzQTUnLA0KICAgIFVyaW5nOiAnXHUwMTZFJywNCiAgICBVc2NyOiAnXHVEODM1XHVEQ0IwJywNCiAgICBVdGlsZGU6ICdcdTAxNjgnLA0KICAgIFV1bWw6ICdcdTAwREMnLA0KICAgIFZEYXNoOiAnXHUyMkFCJywNCiAgICBWYmFyOiAnXHUyQUVCJywNCiAgICBWY3k6ICdcdTA0MTInLA0KICAgIFZkYXNoOiAnXHUyMkE5JywNCiAgICBWZGFzaGw6ICdcdTJBRTYnLA0KICAgIFZlZTogJ1x1MjJDMScsDQogICAgVmVyYmFyOiAnXHUyMDE2JywNCiAgICBWZXJ0OiAnXHUyMDE2JywNCiAgICBWZXJ0aWNhbEJhcjogJ1x1MjIyMycsDQogICAgVmVydGljYWxMaW5lOiAnXHUwMDdDJywNCiAgICBWZXJ0aWNhbFNlcGFyYXRvcjogJ1x1Mjc1OCcsDQogICAgVmVydGljYWxUaWxkZTogJ1x1MjI0MCcsDQogICAgVmVyeVRoaW5TcGFjZTogJ1x1MjAwQScsDQogICAgVmZyOiAnXHVEODM1XHVERDE5JywNCiAgICBWb3BmOiAnXHVEODM1XHVERDREJywNCiAgICBWc2NyOiAnXHVEODM1XHVEQ0IxJywNCiAgICBWdmRhc2g6ICdcdTIyQUEnLA0KICAgIFdjaXJjOiAnXHUwMTc0JywNCiAgICBXZWRnZTogJ1x1MjJDMCcsDQogICAgV2ZyOiAnXHVEODM1XHVERDFBJywNCiAgICBXb3BmOiAnXHVEODM1XHVERDRFJywNCiAgICBXc2NyOiAnXHVEODM1XHVEQ0IyJywNCiAgICBYZnI6ICdcdUQ4MzVcdUREMUInLA0KICAgIFhpOiAnXHUwMzlFJywNCiAgICBYb3BmOiAnXHVEODM1XHVERDRGJywNCiAgICBYc2NyOiAnXHVEODM1XHVEQ0IzJywNCiAgICBZQWN5OiAnXHUwNDJGJywNCiAgICBZSWN5OiAnXHUwNDA3JywNCiAgICBZVWN5OiAnXHUwNDJFJywNCiAgICBZYWN1dGU6ICdcdTAwREQnLA0KICAgIFljaXJjOiAnXHUwMTc2JywNCiAgICBZY3k6ICdcdTA0MkInLA0KICAgIFlmcjogJ1x1RDgzNVx1REQxQycsDQogICAgWW9wZjogJ1x1RDgzNVx1REQ1MCcsDQogICAgWXNjcjogJ1x1RDgzNVx1RENCNCcsDQogICAgWXVtbDogJ1x1MDE3OCcsDQogICAgWkhjeTogJ1x1MDQxNicsDQogICAgWmFjdXRlOiAnXHUwMTc5JywNCiAgICBaY2Fyb246ICdcdTAxN0QnLA0KICAgIFpjeTogJ1x1MDQxNycsDQogICAgWmRvdDogJ1x1MDE3QicsDQogICAgWmVyb1dpZHRoU3BhY2U6ICdcdTIwMEInLA0KICAgIFpldGE6ICdcdTAzOTYnLA0KICAgIFpmcjogJ1x1MjEyOCcsDQogICAgWm9wZjogJ1x1MjEyNCcsDQogICAgWnNjcjogJ1x1RDgzNVx1RENCNScsDQogICAgYWFjdXRlOiAnXHUwMEUxJywNCiAgICBhYnJldmU6ICdcdTAxMDMnLA0KICAgIGFjOiAnXHUyMjNFJywNCiAgICBhY0U6ICdcdTIyM0VcdTAzMzMnLA0KICAgIGFjZDogJ1x1MjIzRicsDQogICAgYWNpcmM6ICdcdTAwRTInLA0KICAgIGFjdXRlOiAnXHUwMEI0JywNCiAgICBhY3k6ICdcdTA0MzAnLA0KICAgIGFlbGlnOiAnXHUwMEU2JywNCiAgICBhZjogJ1x1MjA2MScsDQogICAgYWZyOiAnXHVEODM1XHVERDFFJywNCiAgICBhZ3JhdmU6ICdcdTAwRTAnLA0KICAgIGFsZWZzeW06ICdcdTIxMzUnLA0KICAgIGFsZXBoOiAnXHUyMTM1JywNCiAgICBhbHBoYTogJ1x1MDNCMScsDQogICAgYW1hY3I6ICdcdTAxMDEnLA0KICAgIGFtYWxnOiAnXHUyQTNGJywNCiAgICBhbXA6ICdcdTAwMjYnLA0KICAgIGFuZDogJ1x1MjIyNycsDQogICAgYW5kYW5kOiAnXHUyQTU1JywNCiAgICBhbmRkOiAnXHUyQTVDJywNCiAgICBhbmRzbG9wZTogJ1x1MkE1OCcsDQogICAgYW5kdjogJ1x1MkE1QScsDQogICAgYW5nOiAnXHUyMjIwJywNCiAgICBhbmdlOiAnXHUyOUE0JywNCiAgICBhbmdsZTogJ1x1MjIyMCcsDQogICAgYW5nbXNkOiAnXHUyMjIxJywNCiAgICBhbmdtc2RhYTogJ1x1MjlBOCcsDQogICAgYW5nbXNkYWI6ICdcdTI5QTknLA0KICAgIGFuZ21zZGFjOiAnXHUyOUFBJywNCiAgICBhbmdtc2RhZDogJ1x1MjlBQicsDQogICAgYW5nbXNkYWU6ICdcdTI5QUMnLA0KICAgIGFuZ21zZGFmOiAnXHUyOUFEJywNCiAgICBhbmdtc2RhZzogJ1x1MjlBRScsDQogICAgYW5nbXNkYWg6ICdcdTI5QUYnLA0KICAgIGFuZ3J0OiAnXHUyMjFGJywNCiAgICBhbmdydHZiOiAnXHUyMkJFJywNCiAgICBhbmdydHZiZDogJ1x1Mjk5RCcsDQogICAgYW5nc3BoOiAnXHUyMjIyJywNCiAgICBhbmdzdDogJ1x1MDBDNScsDQogICAgYW5nemFycjogJ1x1MjM3QycsDQogICAgYW9nb246ICdcdTAxMDUnLA0KICAgIGFvcGY6ICdcdUQ4MzVcdURENTInLA0KICAgIGFwOiAnXHUyMjQ4JywNCiAgICBhcEU6ICdcdTJBNzAnLA0KICAgIGFwYWNpcjogJ1x1MkE2RicsDQogICAgYXBlOiAnXHUyMjRBJywNCiAgICBhcGlkOiAnXHUyMjRCJywNCiAgICBhcG9zOiAnXHUwMDI3JywNCiAgICBhcHByb3g6ICdcdTIyNDgnLA0KICAgIGFwcHJveGVxOiAnXHUyMjRBJywNCiAgICBhcmluZzogJ1x1MDBFNScsDQogICAgYXNjcjogJ1x1RDgzNVx1RENCNicsDQogICAgYXN0OiAnXHUwMDJBJywNCiAgICBhc3ltcDogJ1x1MjI0OCcsDQogICAgYXN5bXBlcTogJ1x1MjI0RCcsDQogICAgYXRpbGRlOiAnXHUwMEUzJywNCiAgICBhdW1sOiAnXHUwMEU0JywNCiAgICBhd2NvbmludDogJ1x1MjIzMycsDQogICAgYXdpbnQ6ICdcdTJBMTEnLA0KICAgIGJOb3Q6ICdcdTJBRUQnLA0KICAgIGJhY2tjb25nOiAnXHUyMjRDJywNCiAgICBiYWNrZXBzaWxvbjogJ1x1MDNGNicsDQogICAgYmFja3ByaW1lOiAnXHUyMDM1JywNCiAgICBiYWNrc2ltOiAnXHUyMjNEJywNCiAgICBiYWNrc2ltZXE6ICdcdTIyQ0QnLA0KICAgIGJhcnZlZTogJ1x1MjJCRCcsDQogICAgYmFyd2VkOiAnXHUyMzA1JywNCiAgICBiYXJ3ZWRnZTogJ1x1MjMwNScsDQogICAgYmJyazogJ1x1MjNCNScsDQogICAgYmJya3Ricms6ICdcdTIzQjYnLA0KICAgIGJjb25nOiAnXHUyMjRDJywNCiAgICBiY3k6ICdcdTA0MzEnLA0KICAgIGJkcXVvOiAnXHUyMDFFJywNCiAgICBiZWNhdXM6ICdcdTIyMzUnLA0KICAgIGJlY2F1c2U6ICdcdTIyMzUnLA0KICAgIGJlbXB0eXY6ICdcdTI5QjAnLA0KICAgIGJlcHNpOiAnXHUwM0Y2JywNCiAgICBiZXJub3U6ICdcdTIxMkMnLA0KICAgIGJldGE6ICdcdTAzQjInLA0KICAgIGJldGg6ICdcdTIxMzYnLA0KICAgIGJldHdlZW46ICdcdTIyNkMnLA0KICAgIGJmcjogJ1x1RDgzNVx1REQxRicsDQogICAgYmlnY2FwOiAnXHUyMkMyJywNCiAgICBiaWdjaXJjOiAnXHUyNUVGJywNCiAgICBiaWdjdXA6ICdcdTIyQzMnLA0KICAgIGJpZ29kb3Q6ICdcdTJBMDAnLA0KICAgIGJpZ29wbHVzOiAnXHUyQTAxJywNCiAgICBiaWdvdGltZXM6ICdcdTJBMDInLA0KICAgIGJpZ3NxY3VwOiAnXHUyQTA2JywNCiAgICBiaWdzdGFyOiAnXHUyNjA1JywNCiAgICBiaWd0cmlhbmdsZWRvd246ICdcdTI1QkQnLA0KICAgIGJpZ3RyaWFuZ2xldXA6ICdcdTI1QjMnLA0KICAgIGJpZ3VwbHVzOiAnXHUyQTA0JywNCiAgICBiaWd2ZWU6ICdcdTIyQzEnLA0KICAgIGJpZ3dlZGdlOiAnXHUyMkMwJywNCiAgICBia2Fyb3c6ICdcdTI5MEQnLA0KICAgIGJsYWNrbG96ZW5nZTogJ1x1MjlFQicsDQogICAgYmxhY2tzcXVhcmU6ICdcdTI1QUEnLA0KICAgIGJsYWNrdHJpYW5nbGU6ICdcdTI1QjQnLA0KICAgIGJsYWNrdHJpYW5nbGVkb3duOiAnXHUyNUJFJywNCiAgICBibGFja3RyaWFuZ2xlbGVmdDogJ1x1MjVDMicsDQogICAgYmxhY2t0cmlhbmdsZXJpZ2h0OiAnXHUyNUI4JywNCiAgICBibGFuazogJ1x1MjQyMycsDQogICAgYmxrMTI6ICdcdTI1OTInLA0KICAgIGJsazE0OiAnXHUyNTkxJywNCiAgICBibGszNDogJ1x1MjU5MycsDQogICAgYmxvY2s6ICdcdTI1ODgnLA0KICAgIGJuZTogJ1x1MDAzRFx1MjBFNScsDQogICAgYm5lcXVpdjogJ1x1MjI2MVx1MjBFNScsDQogICAgYm5vdDogJ1x1MjMxMCcsDQogICAgYm9wZjogJ1x1RDgzNVx1REQ1MycsDQogICAgYm90OiAnXHUyMkE1JywNCiAgICBib3R0b206ICdcdTIyQTUnLA0KICAgIGJvd3RpZTogJ1x1MjJDOCcsDQogICAgYm94REw6ICdcdTI1NTcnLA0KICAgIGJveERSOiAnXHUyNTU0JywNCiAgICBib3hEbDogJ1x1MjU1NicsDQogICAgYm94RHI6ICdcdTI1NTMnLA0KICAgIGJveEg6ICdcdTI1NTAnLA0KICAgIGJveEhEOiAnXHUyNTY2JywNCiAgICBib3hIVTogJ1x1MjU2OScsDQogICAgYm94SGQ6ICdcdTI1NjQnLA0KICAgIGJveEh1OiAnXHUyNTY3JywNCiAgICBib3hVTDogJ1x1MjU1RCcsDQogICAgYm94VVI6ICdcdTI1NUEnLA0KICAgIGJveFVsOiAnXHUyNTVDJywNCiAgICBib3hVcjogJ1x1MjU1OScsDQogICAgYm94VjogJ1x1MjU1MScsDQogICAgYm94Vkg6ICdcdTI1NkMnLA0KICAgIGJveFZMOiAnXHUyNTYzJywNCiAgICBib3hWUjogJ1x1MjU2MCcsDQogICAgYm94Vmg6ICdcdTI1NkInLA0KICAgIGJveFZsOiAnXHUyNTYyJywNCiAgICBib3hWcjogJ1x1MjU1RicsDQogICAgYm94Ym94OiAnXHUyOUM5JywNCiAgICBib3hkTDogJ1x1MjU1NScsDQogICAgYm94ZFI6ICdcdTI1NTInLA0KICAgIGJveGRsOiAnXHUyNTEwJywNCiAgICBib3hkcjogJ1x1MjUwQycsDQogICAgYm94aDogJ1x1MjUwMCcsDQogICAgYm94aEQ6ICdcdTI1NjUnLA0KICAgIGJveGhVOiAnXHUyNTY4JywNCiAgICBib3hoZDogJ1x1MjUyQycsDQogICAgYm94aHU6ICdcdTI1MzQnLA0KICAgIGJveG1pbnVzOiAnXHUyMjlGJywNCiAgICBib3hwbHVzOiAnXHUyMjlFJywNCiAgICBib3h0aW1lczogJ1x1MjJBMCcsDQogICAgYm94dUw6ICdcdTI1NUInLA0KICAgIGJveHVSOiAnXHUyNTU4JywNCiAgICBib3h1bDogJ1x1MjUxOCcsDQogICAgYm94dXI6ICdcdTI1MTQnLA0KICAgIGJveHY6ICdcdTI1MDInLA0KICAgIGJveHZIOiAnXHUyNTZBJywNCiAgICBib3h2TDogJ1x1MjU2MScsDQogICAgYm94dlI6ICdcdTI1NUUnLA0KICAgIGJveHZoOiAnXHUyNTNDJywNCiAgICBib3h2bDogJ1x1MjUyNCcsDQogICAgYm94dnI6ICdcdTI1MUMnLA0KICAgIGJwcmltZTogJ1x1MjAzNScsDQogICAgYnJldmU6ICdcdTAyRDgnLA0KICAgIGJydmJhcjogJ1x1MDBBNicsDQogICAgYnNjcjogJ1x1RDgzNVx1RENCNycsDQogICAgYnNlbWk6ICdcdTIwNEYnLA0KICAgIGJzaW06ICdcdTIyM0QnLA0KICAgIGJzaW1lOiAnXHUyMkNEJywNCiAgICBic29sOiAnXHUwMDVDJywNCiAgICBic29sYjogJ1x1MjlDNScsDQogICAgYnNvbGhzdWI6ICdcdTI3QzgnLA0KICAgIGJ1bGw6ICdcdTIwMjInLA0KICAgIGJ1bGxldDogJ1x1MjAyMicsDQogICAgYnVtcDogJ1x1MjI0RScsDQogICAgYnVtcEU6ICdcdTJBQUUnLA0KICAgIGJ1bXBlOiAnXHUyMjRGJywNCiAgICBidW1wZXE6ICdcdTIyNEYnLA0KICAgIGNhY3V0ZTogJ1x1MDEwNycsDQogICAgY2FwOiAnXHUyMjI5JywNCiAgICBjYXBhbmQ6ICdcdTJBNDQnLA0KICAgIGNhcGJyY3VwOiAnXHUyQTQ5JywNCiAgICBjYXBjYXA6ICdcdTJBNEInLA0KICAgIGNhcGN1cDogJ1x1MkE0NycsDQogICAgY2FwZG90OiAnXHUyQTQwJywNCiAgICBjYXBzOiAnXHUyMjI5XHVGRTAwJywNCiAgICBjYXJldDogJ1x1MjA0MScsDQogICAgY2Fyb246ICdcdTAyQzcnLA0KICAgIGNjYXBzOiAnXHUyQTREJywNCiAgICBjY2Fyb246ICdcdTAxMEQnLA0KICAgIGNjZWRpbDogJ1x1MDBFNycsDQogICAgY2NpcmM6ICdcdTAxMDknLA0KICAgIGNjdXBzOiAnXHUyQTRDJywNCiAgICBjY3Vwc3NtOiAnXHUyQTUwJywNCiAgICBjZG90OiAnXHUwMTBCJywNCiAgICBjZWRpbDogJ1x1MDBCOCcsDQogICAgY2VtcHR5djogJ1x1MjlCMicsDQogICAgY2VudDogJ1x1MDBBMicsDQogICAgY2VudGVyZG90OiAnXHUwMEI3JywNCiAgICBjZnI6ICdcdUQ4MzVcdUREMjAnLA0KICAgIGNoY3k6ICdcdTA0NDcnLA0KICAgIGNoZWNrOiAnXHUyNzEzJywNCiAgICBjaGVja21hcms6ICdcdTI3MTMnLA0KICAgIGNoaTogJ1x1MDNDNycsDQogICAgY2lyOiAnXHUyNUNCJywNCiAgICBjaXJFOiAnXHUyOUMzJywNCiAgICBjaXJjOiAnXHUwMkM2JywNCiAgICBjaXJjZXE6ICdcdTIyNTcnLA0KICAgIGNpcmNsZWFycm93bGVmdDogJ1x1MjFCQScsDQogICAgY2lyY2xlYXJyb3dyaWdodDogJ1x1MjFCQicsDQogICAgY2lyY2xlZFI6ICdcdTAwQUUnLA0KICAgIGNpcmNsZWRTOiAnXHUyNEM4JywNCiAgICBjaXJjbGVkYXN0OiAnXHUyMjlCJywNCiAgICBjaXJjbGVkY2lyYzogJ1x1MjI5QScsDQogICAgY2lyY2xlZGRhc2g6ICdcdTIyOUQnLA0KICAgIGNpcmU6ICdcdTIyNTcnLA0KICAgIGNpcmZuaW50OiAnXHUyQTEwJywNCiAgICBjaXJtaWQ6ICdcdTJBRUYnLA0KICAgIGNpcnNjaXI6ICdcdTI5QzInLA0KICAgIGNsdWJzOiAnXHUyNjYzJywNCiAgICBjbHVic3VpdDogJ1x1MjY2MycsDQogICAgY29sb246ICdcdTAwM0EnLA0KICAgIGNvbG9uZTogJ1x1MjI1NCcsDQogICAgY29sb25lcTogJ1x1MjI1NCcsDQogICAgY29tbWE6ICdcdTAwMkMnLA0KICAgIGNvbW1hdDogJ1x1MDA0MCcsDQogICAgY29tcDogJ1x1MjIwMScsDQogICAgY29tcGZuOiAnXHUyMjE4JywNCiAgICBjb21wbGVtZW50OiAnXHUyMjAxJywNCiAgICBjb21wbGV4ZXM6ICdcdTIxMDInLA0KICAgIGNvbmc6ICdcdTIyNDUnLA0KICAgIGNvbmdkb3Q6ICdcdTJBNkQnLA0KICAgIGNvbmludDogJ1x1MjIyRScsDQogICAgY29wZjogJ1x1RDgzNVx1REQ1NCcsDQogICAgY29wcm9kOiAnXHUyMjEwJywNCiAgICBjb3B5OiAnXHUwMEE5JywNCiAgICBjb3B5c3I6ICdcdTIxMTcnLA0KICAgIGNyYXJyOiAnXHUyMUI1JywNCiAgICBjcm9zczogJ1x1MjcxNycsDQogICAgY3NjcjogJ1x1RDgzNVx1RENCOCcsDQogICAgY3N1YjogJ1x1MkFDRicsDQogICAgY3N1YmU6ICdcdTJBRDEnLA0KICAgIGNzdXA6ICdcdTJBRDAnLA0KICAgIGNzdXBlOiAnXHUyQUQyJywNCiAgICBjdGRvdDogJ1x1MjJFRicsDQogICAgY3VkYXJybDogJ1x1MjkzOCcsDQogICAgY3VkYXJycjogJ1x1MjkzNScsDQogICAgY3VlcHI6ICdcdTIyREUnLA0KICAgIGN1ZXNjOiAnXHUyMkRGJywNCiAgICBjdWxhcnI6ICdcdTIxQjYnLA0KICAgIGN1bGFycnA6ICdcdTI5M0QnLA0KICAgIGN1cDogJ1x1MjIyQScsDQogICAgY3VwYnJjYXA6ICdcdTJBNDgnLA0KICAgIGN1cGNhcDogJ1x1MkE0NicsDQogICAgY3VwY3VwOiAnXHUyQTRBJywNCiAgICBjdXBkb3Q6ICdcdTIyOEQnLA0KICAgIGN1cG9yOiAnXHUyQTQ1JywNCiAgICBjdXBzOiAnXHUyMjJBXHVGRTAwJywNCiAgICBjdXJhcnI6ICdcdTIxQjcnLA0KICAgIGN1cmFycm06ICdcdTI5M0MnLA0KICAgIGN1cmx5ZXFwcmVjOiAnXHUyMkRFJywNCiAgICBjdXJseWVxc3VjYzogJ1x1MjJERicsDQogICAgY3VybHl2ZWU6ICdcdTIyQ0UnLA0KICAgIGN1cmx5d2VkZ2U6ICdcdTIyQ0YnLA0KICAgIGN1cnJlbjogJ1x1MDBBNCcsDQogICAgY3VydmVhcnJvd2xlZnQ6ICdcdTIxQjYnLA0KICAgIGN1cnZlYXJyb3dyaWdodDogJ1x1MjFCNycsDQogICAgY3V2ZWU6ICdcdTIyQ0UnLA0KICAgIGN1d2VkOiAnXHUyMkNGJywNCiAgICBjd2NvbmludDogJ1x1MjIzMicsDQogICAgY3dpbnQ6ICdcdTIyMzEnLA0KICAgIGN5bGN0eTogJ1x1MjMyRCcsDQogICAgZEFycjogJ1x1MjFEMycsDQogICAgZEhhcjogJ1x1Mjk2NScsDQogICAgZGFnZ2VyOiAnXHUyMDIwJywNCiAgICBkYWxldGg6ICdcdTIxMzgnLA0KICAgIGRhcnI6ICdcdTIxOTMnLA0KICAgIGRhc2g6ICdcdTIwMTAnLA0KICAgIGRhc2h2OiAnXHUyMkEzJywNCiAgICBkYmthcm93OiAnXHUyOTBGJywNCiAgICBkYmxhYzogJ1x1MDJERCcsDQogICAgZGNhcm9uOiAnXHUwMTBGJywNCiAgICBkY3k6ICdcdTA0MzQnLA0KICAgIGRkOiAnXHUyMTQ2JywNCiAgICBkZGFnZ2VyOiAnXHUyMDIxJywNCiAgICBkZGFycjogJ1x1MjFDQScsDQogICAgZGRvdHNlcTogJ1x1MkE3NycsDQogICAgZGVnOiAnXHUwMEIwJywNCiAgICBkZWx0YTogJ1x1MDNCNCcsDQogICAgZGVtcHR5djogJ1x1MjlCMScsDQogICAgZGZpc2h0OiAnXHUyOTdGJywNCiAgICBkZnI6ICdcdUQ4MzVcdUREMjEnLA0KICAgIGRoYXJsOiAnXHUyMUMzJywNCiAgICBkaGFycjogJ1x1MjFDMicsDQogICAgZGlhbTogJ1x1MjJDNCcsDQogICAgZGlhbW9uZDogJ1x1MjJDNCcsDQogICAgZGlhbW9uZHN1aXQ6ICdcdTI2NjYnLA0KICAgIGRpYW1zOiAnXHUyNjY2JywNCiAgICBkaWU6ICdcdTAwQTgnLA0KICAgIGRpZ2FtbWE6ICdcdTAzREQnLA0KICAgIGRpc2luOiAnXHUyMkYyJywNCiAgICBkaXY6ICdcdTAwRjcnLA0KICAgIGRpdmlkZTogJ1x1MDBGNycsDQogICAgZGl2aWRlb250aW1lczogJ1x1MjJDNycsDQogICAgZGl2b254OiAnXHUyMkM3JywNCiAgICBkamN5OiAnXHUwNDUyJywNCiAgICBkbGNvcm46ICdcdTIzMUUnLA0KICAgIGRsY3JvcDogJ1x1MjMwRCcsDQogICAgZG9sbGFyOiAnXHUwMDI0JywNCiAgICBkb3BmOiAnXHVEODM1XHVERDU1JywNCiAgICBkb3Q6ICdcdTAyRDknLA0KICAgIGRvdGVxOiAnXHUyMjUwJywNCiAgICBkb3RlcWRvdDogJ1x1MjI1MScsDQogICAgZG90bWludXM6ICdcdTIyMzgnLA0KICAgIGRvdHBsdXM6ICdcdTIyMTQnLA0KICAgIGRvdHNxdWFyZTogJ1x1MjJBMScsDQogICAgZG91YmxlYmFyd2VkZ2U6ICdcdTIzMDYnLA0KICAgIGRvd25hcnJvdzogJ1x1MjE5MycsDQogICAgZG93bmRvd25hcnJvd3M6ICdcdTIxQ0EnLA0KICAgIGRvd25oYXJwb29ubGVmdDogJ1x1MjFDMycsDQogICAgZG93bmhhcnBvb25yaWdodDogJ1x1MjFDMicsDQogICAgZHJia2Fyb3c6ICdcdTI5MTAnLA0KICAgIGRyY29ybjogJ1x1MjMxRicsDQogICAgZHJjcm9wOiAnXHUyMzBDJywNCiAgICBkc2NyOiAnXHVEODM1XHVEQ0I5JywNCiAgICBkc2N5OiAnXHUwNDU1JywNCiAgICBkc29sOiAnXHUyOUY2JywNCiAgICBkc3Ryb2s6ICdcdTAxMTEnLA0KICAgIGR0ZG90OiAnXHUyMkYxJywNCiAgICBkdHJpOiAnXHUyNUJGJywNCiAgICBkdHJpZjogJ1x1MjVCRScsDQogICAgZHVhcnI6ICdcdTIxRjUnLA0KICAgIGR1aGFyOiAnXHUyOTZGJywNCiAgICBkd2FuZ2xlOiAnXHUyOUE2JywNCiAgICBkemN5OiAnXHUwNDVGJywNCiAgICBkemlncmFycjogJ1x1MjdGRicsDQogICAgZUREb3Q6ICdcdTJBNzcnLA0KICAgIGVEb3Q6ICdcdTIyNTEnLA0KICAgIGVhY3V0ZTogJ1x1MDBFOScsDQogICAgZWFzdGVyOiAnXHUyQTZFJywNCiAgICBlY2Fyb246ICdcdTAxMUInLA0KICAgIGVjaXI6ICdcdTIyNTYnLA0KICAgIGVjaXJjOiAnXHUwMEVBJywNCiAgICBlY29sb246ICdcdTIyNTUnLA0KICAgIGVjeTogJ1x1MDQ0RCcsDQogICAgZWRvdDogJ1x1MDExNycsDQogICAgZWU6ICdcdTIxNDcnLA0KICAgIGVmRG90OiAnXHUyMjUyJywNCiAgICBlZnI6ICdcdUQ4MzVcdUREMjInLA0KICAgIGVnOiAnXHUyQTlBJywNCiAgICBlZ3JhdmU6ICdcdTAwRTgnLA0KICAgIGVnczogJ1x1MkE5NicsDQogICAgZWdzZG90OiAnXHUyQTk4JywNCiAgICBlbDogJ1x1MkE5OScsDQogICAgZWxpbnRlcnM6ICdcdTIzRTcnLA0KICAgIGVsbDogJ1x1MjExMycsDQogICAgZWxzOiAnXHUyQTk1JywNCiAgICBlbHNkb3Q6ICdcdTJBOTcnLA0KICAgIGVtYWNyOiAnXHUwMTEzJywNCiAgICBlbXB0eTogJ1x1MjIwNScsDQogICAgZW1wdHlzZXQ6ICdcdTIyMDUnLA0KICAgIGVtcHR5djogJ1x1MjIwNScsDQogICAgZW1zcDEzOiAnXHUyMDA0JywNCiAgICBlbXNwMTQ6ICdcdTIwMDUnLA0KICAgIGVtc3A6ICdcdTIwMDMnLA0KICAgIGVuZzogJ1x1MDE0QicsDQogICAgZW5zcDogJ1x1MjAwMicsDQogICAgZW9nb246ICdcdTAxMTknLA0KICAgIGVvcGY6ICdcdUQ4MzVcdURENTYnLA0KICAgIGVwYXI6ICdcdTIyRDUnLA0KICAgIGVwYXJzbDogJ1x1MjlFMycsDQogICAgZXBsdXM6ICdcdTJBNzEnLA0KICAgIGVwc2k6ICdcdTAzQjUnLA0KICAgIGVwc2lsb246ICdcdTAzQjUnLA0KICAgIGVwc2l2OiAnXHUwM0Y1JywNCiAgICBlcWNpcmM6ICdcdTIyNTYnLA0KICAgIGVxY29sb246ICdcdTIyNTUnLA0KICAgIGVxc2ltOiAnXHUyMjQyJywNCiAgICBlcXNsYW50Z3RyOiAnXHUyQTk2JywNCiAgICBlcXNsYW50bGVzczogJ1x1MkE5NScsDQogICAgZXF1YWxzOiAnXHUwMDNEJywNCiAgICBlcXVlc3Q6ICdcdTIyNUYnLA0KICAgIGVxdWl2OiAnXHUyMjYxJywNCiAgICBlcXVpdkREOiAnXHUyQTc4JywNCiAgICBlcXZwYXJzbDogJ1x1MjlFNScsDQogICAgZXJEb3Q6ICdcdTIyNTMnLA0KICAgIGVyYXJyOiAnXHUyOTcxJywNCiAgICBlc2NyOiAnXHUyMTJGJywNCiAgICBlc2RvdDogJ1x1MjI1MCcsDQogICAgZXNpbTogJ1x1MjI0MicsDQogICAgZXRhOiAnXHUwM0I3JywNCiAgICBldGg6ICdcdTAwRjAnLA0KICAgIGV1bWw6ICdcdTAwRUInLA0KICAgIGV1cm86ICdcdTIwQUMnLA0KICAgIGV4Y2w6ICdcdTAwMjEnLA0KICAgIGV4aXN0OiAnXHUyMjAzJywNCiAgICBleHBlY3RhdGlvbjogJ1x1MjEzMCcsDQogICAgZXhwb25lbnRpYWxlOiAnXHUyMTQ3JywNCiAgICBmYWxsaW5nZG90c2VxOiAnXHUyMjUyJywNCiAgICBmY3k6ICdcdTA0NDQnLA0KICAgIGZlbWFsZTogJ1x1MjY0MCcsDQogICAgZmZpbGlnOiAnXHVGQjAzJywNCiAgICBmZmxpZzogJ1x1RkIwMCcsDQogICAgZmZsbGlnOiAnXHVGQjA0JywNCiAgICBmZnI6ICdcdUQ4MzVcdUREMjMnLA0KICAgIGZpbGlnOiAnXHVGQjAxJywNCiAgICBmamxpZzogJ1x1MDA2Nlx1MDA2QScsDQogICAgZmxhdDogJ1x1MjY2RCcsDQogICAgZmxsaWc6ICdcdUZCMDInLA0KICAgIGZsdG5zOiAnXHUyNUIxJywNCiAgICBmbm9mOiAnXHUwMTkyJywNCiAgICBmb3BmOiAnXHVEODM1XHVERDU3JywNCiAgICBmb3JhbGw6ICdcdTIyMDAnLA0KICAgIGZvcms6ICdcdTIyRDQnLA0KICAgIGZvcmt2OiAnXHUyQUQ5JywNCiAgICBmcGFydGludDogJ1x1MkEwRCcsDQogICAgZnJhYzEyOiAnXHUwMEJEJywNCiAgICBmcmFjMTM6ICdcdTIxNTMnLA0KICAgIGZyYWMxNDogJ1x1MDBCQycsDQogICAgZnJhYzE1OiAnXHUyMTU1JywNCiAgICBmcmFjMTY6ICdcdTIxNTknLA0KICAgIGZyYWMxODogJ1x1MjE1QicsDQogICAgZnJhYzIzOiAnXHUyMTU0JywNCiAgICBmcmFjMjU6ICdcdTIxNTYnLA0KICAgIGZyYWMzNDogJ1x1MDBCRScsDQogICAgZnJhYzM1OiAnXHUyMTU3JywNCiAgICBmcmFjMzg6ICdcdTIxNUMnLA0KICAgIGZyYWM0NTogJ1x1MjE1OCcsDQogICAgZnJhYzU2OiAnXHUyMTVBJywNCiAgICBmcmFjNTg6ICdcdTIxNUQnLA0KICAgIGZyYWM3ODogJ1x1MjE1RScsDQogICAgZnJhc2w6ICdcdTIwNDQnLA0KICAgIGZyb3duOiAnXHUyMzIyJywNCiAgICBmc2NyOiAnXHVEODM1XHVEQ0JCJywNCiAgICBnRTogJ1x1MjI2NycsDQogICAgZ0VsOiAnXHUyQThDJywNCiAgICBnYWN1dGU6ICdcdTAxRjUnLA0KICAgIGdhbW1hOiAnXHUwM0IzJywNCiAgICBnYW1tYWQ6ICdcdTAzREQnLA0KICAgIGdhcDogJ1x1MkE4NicsDQogICAgZ2JyZXZlOiAnXHUwMTFGJywNCiAgICBnY2lyYzogJ1x1MDExRCcsDQogICAgZ2N5OiAnXHUwNDMzJywNCiAgICBnZG90OiAnXHUwMTIxJywNCiAgICBnZTogJ1x1MjI2NScsDQogICAgZ2VsOiAnXHUyMkRCJywNCiAgICBnZXE6ICdcdTIyNjUnLA0KICAgIGdlcXE6ICdcdTIyNjcnLA0KICAgIGdlcXNsYW50OiAnXHUyQTdFJywNCiAgICBnZXM6ICdcdTJBN0UnLA0KICAgIGdlc2NjOiAnXHUyQUE5JywNCiAgICBnZXNkb3Q6ICdcdTJBODAnLA0KICAgIGdlc2RvdG86ICdcdTJBODInLA0KICAgIGdlc2RvdG9sOiAnXHUyQTg0JywNCiAgICBnZXNsOiAnXHUyMkRCXHVGRTAwJywNCiAgICBnZXNsZXM6ICdcdTJBOTQnLA0KICAgIGdmcjogJ1x1RDgzNVx1REQyNCcsDQogICAgZ2c6ICdcdTIyNkInLA0KICAgIGdnZzogJ1x1MjJEOScsDQogICAgZ2ltZWw6ICdcdTIxMzcnLA0KICAgIGdqY3k6ICdcdTA0NTMnLA0KICAgIGdsOiAnXHUyMjc3JywNCiAgICBnbEU6ICdcdTJBOTInLA0KICAgIGdsYTogJ1x1MkFBNScsDQogICAgZ2xqOiAnXHUyQUE0JywNCiAgICBnbkU6ICdcdTIyNjknLA0KICAgIGduYXA6ICdcdTJBOEEnLA0KICAgIGduYXBwcm94OiAnXHUyQThBJywNCiAgICBnbmU6ICdcdTJBODgnLA0KICAgIGduZXE6ICdcdTJBODgnLA0KICAgIGduZXFxOiAnXHUyMjY5JywNCiAgICBnbnNpbTogJ1x1MjJFNycsDQogICAgZ29wZjogJ1x1RDgzNVx1REQ1OCcsDQogICAgZ3JhdmU6ICdcdTAwNjAnLA0KICAgIGdzY3I6ICdcdTIxMEEnLA0KICAgIGdzaW06ICdcdTIyNzMnLA0KICAgIGdzaW1lOiAnXHUyQThFJywNCiAgICBnc2ltbDogJ1x1MkE5MCcsDQogICAgZ3Q6ICdcdTAwM0UnLA0KICAgIGd0Y2M6ICdcdTJBQTcnLA0KICAgIGd0Y2lyOiAnXHUyQTdBJywNCiAgICBndGRvdDogJ1x1MjJENycsDQogICAgZ3RsUGFyOiAnXHUyOTk1JywNCiAgICBndHF1ZXN0OiAnXHUyQTdDJywNCiAgICBndHJhcHByb3g6ICdcdTJBODYnLA0KICAgIGd0cmFycjogJ1x1Mjk3OCcsDQogICAgZ3RyZG90OiAnXHUyMkQ3JywNCiAgICBndHJlcWxlc3M6ICdcdTIyREInLA0KICAgIGd0cmVxcWxlc3M6ICdcdTJBOEMnLA0KICAgIGd0cmxlc3M6ICdcdTIyNzcnLA0KICAgIGd0cnNpbTogJ1x1MjI3MycsDQogICAgZ3ZlcnRuZXFxOiAnXHUyMjY5XHVGRTAwJywNCiAgICBndm5FOiAnXHUyMjY5XHVGRTAwJywNCiAgICBoQXJyOiAnXHUyMUQ0JywNCiAgICBoYWlyc3A6ICdcdTIwMEEnLA0KICAgIGhhbGY6ICdcdTAwQkQnLA0KICAgIGhhbWlsdDogJ1x1MjEwQicsDQogICAgaGFyZGN5OiAnXHUwNDRBJywNCiAgICBoYXJyOiAnXHUyMTk0JywNCiAgICBoYXJyY2lyOiAnXHUyOTQ4JywNCiAgICBoYXJydzogJ1x1MjFBRCcsDQogICAgaGJhcjogJ1x1MjEwRicsDQogICAgaGNpcmM6ICdcdTAxMjUnLA0KICAgIGhlYXJ0czogJ1x1MjY2NScsDQogICAgaGVhcnRzdWl0OiAnXHUyNjY1JywNCiAgICBoZWxsaXA6ICdcdTIwMjYnLA0KICAgIGhlcmNvbjogJ1x1MjJCOScsDQogICAgaGZyOiAnXHVEODM1XHVERDI1JywNCiAgICBoa3NlYXJvdzogJ1x1MjkyNScsDQogICAgaGtzd2Fyb3c6ICdcdTI5MjYnLA0KICAgIGhvYXJyOiAnXHUyMUZGJywNCiAgICBob210aHQ6ICdcdTIyM0InLA0KICAgIGhvb2tsZWZ0YXJyb3c6ICdcdTIxQTknLA0KICAgIGhvb2tyaWdodGFycm93OiAnXHUyMUFBJywNCiAgICBob3BmOiAnXHVEODM1XHVERDU5JywNCiAgICBob3JiYXI6ICdcdTIwMTUnLA0KICAgIGhzY3I6ICdcdUQ4MzVcdURDQkQnLA0KICAgIGhzbGFzaDogJ1x1MjEwRicsDQogICAgaHN0cm9rOiAnXHUwMTI3JywNCiAgICBoeWJ1bGw6ICdcdTIwNDMnLA0KICAgIGh5cGhlbjogJ1x1MjAxMCcsDQogICAgaWFjdXRlOiAnXHUwMEVEJywNCiAgICBpYzogJ1x1MjA2MycsDQogICAgaWNpcmM6ICdcdTAwRUUnLA0KICAgIGljeTogJ1x1MDQzOCcsDQogICAgaWVjeTogJ1x1MDQzNScsDQogICAgaWV4Y2w6ICdcdTAwQTEnLA0KICAgIGlmZjogJ1x1MjFENCcsDQogICAgaWZyOiAnXHVEODM1XHVERDI2JywNCiAgICBpZ3JhdmU6ICdcdTAwRUMnLA0KICAgIGlpOiAnXHUyMTQ4JywNCiAgICBpaWlpbnQ6ICdcdTJBMEMnLA0KICAgIGlpaW50OiAnXHUyMjJEJywNCiAgICBpaW5maW46ICdcdTI5REMnLA0KICAgIGlpb3RhOiAnXHUyMTI5JywNCiAgICBpamxpZzogJ1x1MDEzMycsDQogICAgaW1hY3I6ICdcdTAxMkInLA0KICAgIGltYWdlOiAnXHUyMTExJywNCiAgICBpbWFnbGluZTogJ1x1MjExMCcsDQogICAgaW1hZ3BhcnQ6ICdcdTIxMTEnLA0KICAgIGltYXRoOiAnXHUwMTMxJywNCiAgICBpbW9mOiAnXHUyMkI3JywNCiAgICBpbXBlZDogJ1x1MDFCNScsDQogICAgaW46ICdcdTIyMDgnLA0KICAgIGluY2FyZTogJ1x1MjEwNScsDQogICAgaW5maW46ICdcdTIyMUUnLA0KICAgIGluZmludGllOiAnXHUyOUREJywNCiAgICBpbm9kb3Q6ICdcdTAxMzEnLA0KICAgIGludDogJ1x1MjIyQicsDQogICAgaW50Y2FsOiAnXHUyMkJBJywNCiAgICBpbnRlZ2VyczogJ1x1MjEyNCcsDQogICAgaW50ZXJjYWw6ICdcdTIyQkEnLA0KICAgIGludGxhcmhrOiAnXHUyQTE3JywNCiAgICBpbnRwcm9kOiAnXHUyQTNDJywNCiAgICBpb2N5OiAnXHUwNDUxJywNCiAgICBpb2dvbjogJ1x1MDEyRicsDQogICAgaW9wZjogJ1x1RDgzNVx1REQ1QScsDQogICAgaW90YTogJ1x1MDNCOScsDQogICAgaXByb2Q6ICdcdTJBM0MnLA0KICAgIGlxdWVzdDogJ1x1MDBCRicsDQogICAgaXNjcjogJ1x1RDgzNVx1RENCRScsDQogICAgaXNpbjogJ1x1MjIwOCcsDQogICAgaXNpbkU6ICdcdTIyRjknLA0KICAgIGlzaW5kb3Q6ICdcdTIyRjUnLA0KICAgIGlzaW5zOiAnXHUyMkY0JywNCiAgICBpc2luc3Y6ICdcdTIyRjMnLA0KICAgIGlzaW52OiAnXHUyMjA4JywNCiAgICBpdDogJ1x1MjA2MicsDQogICAgaXRpbGRlOiAnXHUwMTI5JywNCiAgICBpdWtjeTogJ1x1MDQ1NicsDQogICAgaXVtbDogJ1x1MDBFRicsDQogICAgamNpcmM6ICdcdTAxMzUnLA0KICAgIGpjeTogJ1x1MDQzOScsDQogICAgamZyOiAnXHVEODM1XHVERDI3JywNCiAgICBqbWF0aDogJ1x1MDIzNycsDQogICAgam9wZjogJ1x1RDgzNVx1REQ1QicsDQogICAganNjcjogJ1x1RDgzNVx1RENCRicsDQogICAganNlcmN5OiAnXHUwNDU4JywNCiAgICBqdWtjeTogJ1x1MDQ1NCcsDQogICAga2FwcGE6ICdcdTAzQkEnLA0KICAgIGthcHBhdjogJ1x1MDNGMCcsDQogICAga2NlZGlsOiAnXHUwMTM3JywNCiAgICBrY3k6ICdcdTA0M0EnLA0KICAgIGtmcjogJ1x1RDgzNVx1REQyOCcsDQogICAga2dyZWVuOiAnXHUwMTM4JywNCiAgICBraGN5OiAnXHUwNDQ1JywNCiAgICBramN5OiAnXHUwNDVDJywNCiAgICBrb3BmOiAnXHVEODM1XHVERDVDJywNCiAgICBrc2NyOiAnXHVEODM1XHVEQ0MwJywNCiAgICBsQWFycjogJ1x1MjFEQScsDQogICAgbEFycjogJ1x1MjFEMCcsDQogICAgbEF0YWlsOiAnXHUyOTFCJywNCiAgICBsQmFycjogJ1x1MjkwRScsDQogICAgbEU6ICdcdTIyNjYnLA0KICAgIGxFZzogJ1x1MkE4QicsDQogICAgbEhhcjogJ1x1Mjk2MicsDQogICAgbGFjdXRlOiAnXHUwMTNBJywNCiAgICBsYWVtcHR5djogJ1x1MjlCNCcsDQogICAgbGFncmFuOiAnXHUyMTEyJywNCiAgICBsYW1iZGE6ICdcdTAzQkInLA0KICAgIGxhbmc6ICdcdTI3RTgnLA0KICAgIGxhbmdkOiAnXHUyOTkxJywNCiAgICBsYW5nbGU6ICdcdTI3RTgnLA0KICAgIGxhcDogJ1x1MkE4NScsDQogICAgbGFxdW86ICdcdTAwQUInLA0KICAgIGxhcnI6ICdcdTIxOTAnLA0KICAgIGxhcnJiOiAnXHUyMUU0JywNCiAgICBsYXJyYmZzOiAnXHUyOTFGJywNCiAgICBsYXJyZnM6ICdcdTI5MUQnLA0KICAgIGxhcnJoazogJ1x1MjFBOScsDQogICAgbGFycmxwOiAnXHUyMUFCJywNCiAgICBsYXJycGw6ICdcdTI5MzknLA0KICAgIGxhcnJzaW06ICdcdTI5NzMnLA0KICAgIGxhcnJ0bDogJ1x1MjFBMicsDQogICAgbGF0OiAnXHUyQUFCJywNCiAgICBsYXRhaWw6ICdcdTI5MTknLA0KICAgIGxhdGU6ICdcdTJBQUQnLA0KICAgIGxhdGVzOiAnXHUyQUFEXHVGRTAwJywNCiAgICBsYmFycjogJ1x1MjkwQycsDQogICAgbGJicms6ICdcdTI3NzInLA0KICAgIGxicmFjZTogJ1x1MDA3QicsDQogICAgbGJyYWNrOiAnXHUwMDVCJywNCiAgICBsYnJrZTogJ1x1Mjk4QicsDQogICAgbGJya3NsZDogJ1x1Mjk4RicsDQogICAgbGJya3NsdTogJ1x1Mjk4RCcsDQogICAgbGNhcm9uOiAnXHUwMTNFJywNCiAgICBsY2VkaWw6ICdcdTAxM0MnLA0KICAgIGxjZWlsOiAnXHUyMzA4JywNCiAgICBsY3ViOiAnXHUwMDdCJywNCiAgICBsY3k6ICdcdTA0M0InLA0KICAgIGxkY2E6ICdcdTI5MzYnLA0KICAgIGxkcXVvOiAnXHUyMDFDJywNCiAgICBsZHF1b3I6ICdcdTIwMUUnLA0KICAgIGxkcmRoYXI6ICdcdTI5NjcnLA0KICAgIGxkcnVzaGFyOiAnXHUyOTRCJywNCiAgICBsZHNoOiAnXHUyMUIyJywNCiAgICBsZTogJ1x1MjI2NCcsDQogICAgbGVmdGFycm93OiAnXHUyMTkwJywNCiAgICBsZWZ0YXJyb3d0YWlsOiAnXHUyMUEyJywNCiAgICBsZWZ0aGFycG9vbmRvd246ICdcdTIxQkQnLA0KICAgIGxlZnRoYXJwb29udXA6ICdcdTIxQkMnLA0KICAgIGxlZnRsZWZ0YXJyb3dzOiAnXHUyMUM3JywNCiAgICBsZWZ0cmlnaHRhcnJvdzogJ1x1MjE5NCcsDQogICAgbGVmdHJpZ2h0YXJyb3dzOiAnXHUyMUM2JywNCiAgICBsZWZ0cmlnaHRoYXJwb29uczogJ1x1MjFDQicsDQogICAgbGVmdHJpZ2h0c3F1aWdhcnJvdzogJ1x1MjFBRCcsDQogICAgbGVmdHRocmVldGltZXM6ICdcdTIyQ0InLA0KICAgIGxlZzogJ1x1MjJEQScsDQogICAgbGVxOiAnXHUyMjY0JywNCiAgICBsZXFxOiAnXHUyMjY2JywNCiAgICBsZXFzbGFudDogJ1x1MkE3RCcsDQogICAgbGVzOiAnXHUyQTdEJywNCiAgICBsZXNjYzogJ1x1MkFBOCcsDQogICAgbGVzZG90OiAnXHUyQTdGJywNCiAgICBsZXNkb3RvOiAnXHUyQTgxJywNCiAgICBsZXNkb3RvcjogJ1x1MkE4MycsDQogICAgbGVzZzogJ1x1MjJEQVx1RkUwMCcsDQogICAgbGVzZ2VzOiAnXHUyQTkzJywNCiAgICBsZXNzYXBwcm94OiAnXHUyQTg1JywNCiAgICBsZXNzZG90OiAnXHUyMkQ2JywNCiAgICBsZXNzZXFndHI6ICdcdTIyREEnLA0KICAgIGxlc3NlcXFndHI6ICdcdTJBOEInLA0KICAgIGxlc3NndHI6ICdcdTIyNzYnLA0KICAgIGxlc3NzaW06ICdcdTIyNzInLA0KICAgIGxmaXNodDogJ1x1Mjk3QycsDQogICAgbGZsb29yOiAnXHUyMzBBJywNCiAgICBsZnI6ICdcdUQ4MzVcdUREMjknLA0KICAgIGxnOiAnXHUyMjc2JywNCiAgICBsZ0U6ICdcdTJBOTEnLA0KICAgIGxoYXJkOiAnXHUyMUJEJywNCiAgICBsaGFydTogJ1x1MjFCQycsDQogICAgbGhhcnVsOiAnXHUyOTZBJywNCiAgICBsaGJsazogJ1x1MjU4NCcsDQogICAgbGpjeTogJ1x1MDQ1OScsDQogICAgbGw6ICdcdTIyNkEnLA0KICAgIGxsYXJyOiAnXHUyMUM3JywNCiAgICBsbGNvcm5lcjogJ1x1MjMxRScsDQogICAgbGxoYXJkOiAnXHUyOTZCJywNCiAgICBsbHRyaTogJ1x1MjVGQScsDQogICAgbG1pZG90OiAnXHUwMTQwJywNCiAgICBsbW91c3Q6ICdcdTIzQjAnLA0KICAgIGxtb3VzdGFjaGU6ICdcdTIzQjAnLA0KICAgIGxuRTogJ1x1MjI2OCcsDQogICAgbG5hcDogJ1x1MkE4OScsDQogICAgbG5hcHByb3g6ICdcdTJBODknLA0KICAgIGxuZTogJ1x1MkE4NycsDQogICAgbG5lcTogJ1x1MkE4NycsDQogICAgbG5lcXE6ICdcdTIyNjgnLA0KICAgIGxuc2ltOiAnXHUyMkU2JywNCiAgICBsb2FuZzogJ1x1MjdFQycsDQogICAgbG9hcnI6ICdcdTIxRkQnLA0KICAgIGxvYnJrOiAnXHUyN0U2JywNCiAgICBsb25nbGVmdGFycm93OiAnXHUyN0Y1JywNCiAgICBsb25nbGVmdHJpZ2h0YXJyb3c6ICdcdTI3RjcnLA0KICAgIGxvbmdtYXBzdG86ICdcdTI3RkMnLA0KICAgIGxvbmdyaWdodGFycm93OiAnXHUyN0Y2JywNCiAgICBsb29wYXJyb3dsZWZ0OiAnXHUyMUFCJywNCiAgICBsb29wYXJyb3dyaWdodDogJ1x1MjFBQycsDQogICAgbG9wYXI6ICdcdTI5ODUnLA0KICAgIGxvcGY6ICdcdUQ4MzVcdURENUQnLA0KICAgIGxvcGx1czogJ1x1MkEyRCcsDQogICAgbG90aW1lczogJ1x1MkEzNCcsDQogICAgbG93YXN0OiAnXHUyMjE3JywNCiAgICBsb3diYXI6ICdcdTAwNUYnLA0KICAgIGxvejogJ1x1MjVDQScsDQogICAgbG96ZW5nZTogJ1x1MjVDQScsDQogICAgbG96ZjogJ1x1MjlFQicsDQogICAgbHBhcjogJ1x1MDAyOCcsDQogICAgbHBhcmx0OiAnXHUyOTkzJywNCiAgICBscmFycjogJ1x1MjFDNicsDQogICAgbHJjb3JuZXI6ICdcdTIzMUYnLA0KICAgIGxyaGFyOiAnXHUyMUNCJywNCiAgICBscmhhcmQ6ICdcdTI5NkQnLA0KICAgIGxybTogJ1x1MjAwRScsDQogICAgbHJ0cmk6ICdcdTIyQkYnLA0KICAgIGxzYXF1bzogJ1x1MjAzOScsDQogICAgbHNjcjogJ1x1RDgzNVx1RENDMScsDQogICAgbHNoOiAnXHUyMUIwJywNCiAgICBsc2ltOiAnXHUyMjcyJywNCiAgICBsc2ltZTogJ1x1MkE4RCcsDQogICAgbHNpbWc6ICdcdTJBOEYnLA0KICAgIGxzcWI6ICdcdTAwNUInLA0KICAgIGxzcXVvOiAnXHUyMDE4JywNCiAgICBsc3F1b3I6ICdcdTIwMUEnLA0KICAgIGxzdHJvazogJ1x1MDE0MicsDQogICAgbHQ6ICdcdTAwM0MnLA0KICAgIGx0Y2M6ICdcdTJBQTYnLA0KICAgIGx0Y2lyOiAnXHUyQTc5JywNCiAgICBsdGRvdDogJ1x1MjJENicsDQogICAgbHRocmVlOiAnXHUyMkNCJywNCiAgICBsdGltZXM6ICdcdTIyQzknLA0KICAgIGx0bGFycjogJ1x1Mjk3NicsDQogICAgbHRxdWVzdDogJ1x1MkE3QicsDQogICAgbHRyUGFyOiAnXHUyOTk2JywNCiAgICBsdHJpOiAnXHUyNUMzJywNCiAgICBsdHJpZTogJ1x1MjJCNCcsDQogICAgbHRyaWY6ICdcdTI1QzInLA0KICAgIGx1cmRzaGFyOiAnXHUyOTRBJywNCiAgICBsdXJ1aGFyOiAnXHUyOTY2JywNCiAgICBsdmVydG5lcXE6ICdcdTIyNjhcdUZFMDAnLA0KICAgIGx2bkU6ICdcdTIyNjhcdUZFMDAnLA0KICAgIG1ERG90OiAnXHUyMjNBJywNCiAgICBtYWNyOiAnXHUwMEFGJywNCiAgICBtYWxlOiAnXHUyNjQyJywNCiAgICBtYWx0OiAnXHUyNzIwJywNCiAgICBtYWx0ZXNlOiAnXHUyNzIwJywNCiAgICBtYXA6ICdcdTIxQTYnLA0KICAgIG1hcHN0bzogJ1x1MjFBNicsDQogICAgbWFwc3RvZG93bjogJ1x1MjFBNycsDQogICAgbWFwc3RvbGVmdDogJ1x1MjFBNCcsDQogICAgbWFwc3RvdXA6ICdcdTIxQTUnLA0KICAgIG1hcmtlcjogJ1x1MjVBRScsDQogICAgbWNvbW1hOiAnXHUyQTI5JywNCiAgICBtY3k6ICdcdTA0M0MnLA0KICAgIG1kYXNoOiAnXHUyMDE0JywNCiAgICBtZWFzdXJlZGFuZ2xlOiAnXHUyMjIxJywNCiAgICBtZnI6ICdcdUQ4MzVcdUREMkEnLA0KICAgIG1obzogJ1x1MjEyNycsDQogICAgbWljcm86ICdcdTAwQjUnLA0KICAgIG1pZDogJ1x1MjIyMycsDQogICAgbWlkYXN0OiAnXHUwMDJBJywNCiAgICBtaWRjaXI6ICdcdTJBRjAnLA0KICAgIG1pZGRvdDogJ1x1MDBCNycsDQogICAgbWludXM6ICdcdTIyMTInLA0KICAgIG1pbnVzYjogJ1x1MjI5RicsDQogICAgbWludXNkOiAnXHUyMjM4JywNCiAgICBtaW51c2R1OiAnXHUyQTJBJywNCiAgICBtbGNwOiAnXHUyQURCJywNCiAgICBtbGRyOiAnXHUyMDI2JywNCiAgICBtbnBsdXM6ICdcdTIyMTMnLA0KICAgIG1vZGVsczogJ1x1MjJBNycsDQogICAgbW9wZjogJ1x1RDgzNVx1REQ1RScsDQogICAgbXA6ICdcdTIyMTMnLA0KICAgIG1zY3I6ICdcdUQ4MzVcdURDQzInLA0KICAgIG1zdHBvczogJ1x1MjIzRScsDQogICAgbXU6ICdcdTAzQkMnLA0KICAgIG11bHRpbWFwOiAnXHUyMkI4JywNCiAgICBtdW1hcDogJ1x1MjJCOCcsDQogICAgbkdnOiAnXHUyMkQ5XHUwMzM4JywNCiAgICBuR3Q6ICdcdTIyNkJcdTIwRDInLA0KICAgIG5HdHY6ICdcdTIyNkJcdTAzMzgnLA0KICAgIG5MZWZ0YXJyb3c6ICdcdTIxQ0QnLA0KICAgIG5MZWZ0cmlnaHRhcnJvdzogJ1x1MjFDRScsDQogICAgbkxsOiAnXHUyMkQ4XHUwMzM4JywNCiAgICBuTHQ6ICdcdTIyNkFcdTIwRDInLA0KICAgIG5MdHY6ICdcdTIyNkFcdTAzMzgnLA0KICAgIG5SaWdodGFycm93OiAnXHUyMUNGJywNCiAgICBuVkRhc2g6ICdcdTIyQUYnLA0KICAgIG5WZGFzaDogJ1x1MjJBRScsDQogICAgbmFibGE6ICdcdTIyMDcnLA0KICAgIG5hY3V0ZTogJ1x1MDE0NCcsDQogICAgbmFuZzogJ1x1MjIyMFx1MjBEMicsDQogICAgbmFwOiAnXHUyMjQ5JywNCiAgICBuYXBFOiAnXHUyQTcwXHUwMzM4JywNCiAgICBuYXBpZDogJ1x1MjI0Qlx1MDMzOCcsDQogICAgbmFwb3M6ICdcdTAxNDknLA0KICAgIG5hcHByb3g6ICdcdTIyNDknLA0KICAgIG5hdHVyOiAnXHUyNjZFJywNCiAgICBuYXR1cmFsOiAnXHUyNjZFJywNCiAgICBuYXR1cmFsczogJ1x1MjExNScsDQogICAgbmJzcDogJ1x1MDBBMCcsDQogICAgbmJ1bXA6ICdcdTIyNEVcdTAzMzgnLA0KICAgIG5idW1wZTogJ1x1MjI0Rlx1MDMzOCcsDQogICAgbmNhcDogJ1x1MkE0MycsDQogICAgbmNhcm9uOiAnXHUwMTQ4JywNCiAgICBuY2VkaWw6ICdcdTAxNDYnLA0KICAgIG5jb25nOiAnXHUyMjQ3JywNCiAgICBuY29uZ2RvdDogJ1x1MkE2RFx1MDMzOCcsDQogICAgbmN1cDogJ1x1MkE0MicsDQogICAgbmN5OiAnXHUwNDNEJywNCiAgICBuZGFzaDogJ1x1MjAxMycsDQogICAgbmU6ICdcdTIyNjAnLA0KICAgIG5lQXJyOiAnXHUyMUQ3JywNCiAgICBuZWFyaGs6ICdcdTI5MjQnLA0KICAgIG5lYXJyOiAnXHUyMTk3JywNCiAgICBuZWFycm93OiAnXHUyMTk3JywNCiAgICBuZWRvdDogJ1x1MjI1MFx1MDMzOCcsDQogICAgbmVxdWl2OiAnXHUyMjYyJywNCiAgICBuZXNlYXI6ICdcdTI5MjgnLA0KICAgIG5lc2ltOiAnXHUyMjQyXHUwMzM4JywNCiAgICBuZXhpc3Q6ICdcdTIyMDQnLA0KICAgIG5leGlzdHM6ICdcdTIyMDQnLA0KICAgIG5mcjogJ1x1RDgzNVx1REQyQicsDQogICAgbmdFOiAnXHUyMjY3XHUwMzM4JywNCiAgICBuZ2U6ICdcdTIyNzEnLA0KICAgIG5nZXE6ICdcdTIyNzEnLA0KICAgIG5nZXFxOiAnXHUyMjY3XHUwMzM4JywNCiAgICBuZ2Vxc2xhbnQ6ICdcdTJBN0VcdTAzMzgnLA0KICAgIG5nZXM6ICdcdTJBN0VcdTAzMzgnLA0KICAgIG5nc2ltOiAnXHUyMjc1JywNCiAgICBuZ3Q6ICdcdTIyNkYnLA0KICAgIG5ndHI6ICdcdTIyNkYnLA0KICAgIG5oQXJyOiAnXHUyMUNFJywNCiAgICBuaGFycjogJ1x1MjFBRScsDQogICAgbmhwYXI6ICdcdTJBRjInLA0KICAgIG5pOiAnXHUyMjBCJywNCiAgICBuaXM6ICdcdTIyRkMnLA0KICAgIG5pc2Q6ICdcdTIyRkEnLA0KICAgIG5pdjogJ1x1MjIwQicsDQogICAgbmpjeTogJ1x1MDQ1QScsDQogICAgbmxBcnI6ICdcdTIxQ0QnLA0KICAgIG5sRTogJ1x1MjI2Nlx1MDMzOCcsDQogICAgbmxhcnI6ICdcdTIxOUEnLA0KICAgIG5sZHI6ICdcdTIwMjUnLA0KICAgIG5sZTogJ1x1MjI3MCcsDQogICAgbmxlZnRhcnJvdzogJ1x1MjE5QScsDQogICAgbmxlZnRyaWdodGFycm93OiAnXHUyMUFFJywNCiAgICBubGVxOiAnXHUyMjcwJywNCiAgICBubGVxcTogJ1x1MjI2Nlx1MDMzOCcsDQogICAgbmxlcXNsYW50OiAnXHUyQTdEXHUwMzM4JywNCiAgICBubGVzOiAnXHUyQTdEXHUwMzM4JywNCiAgICBubGVzczogJ1x1MjI2RScsDQogICAgbmxzaW06ICdcdTIyNzQnLA0KICAgIG5sdDogJ1x1MjI2RScsDQogICAgbmx0cmk6ICdcdTIyRUEnLA0KICAgIG5sdHJpZTogJ1x1MjJFQycsDQogICAgbm1pZDogJ1x1MjIyNCcsDQogICAgbm9wZjogJ1x1RDgzNVx1REQ1RicsDQogICAgbm90OiAnXHUwMEFDJywNCiAgICBub3RpbjogJ1x1MjIwOScsDQogICAgbm90aW5FOiAnXHUyMkY5XHUwMzM4JywNCiAgICBub3RpbmRvdDogJ1x1MjJGNVx1MDMzOCcsDQogICAgbm90aW52YTogJ1x1MjIwOScsDQogICAgbm90aW52YjogJ1x1MjJGNycsDQogICAgbm90aW52YzogJ1x1MjJGNicsDQogICAgbm90bmk6ICdcdTIyMEMnLA0KICAgIG5vdG5pdmE6ICdcdTIyMEMnLA0KICAgIG5vdG5pdmI6ICdcdTIyRkUnLA0KICAgIG5vdG5pdmM6ICdcdTIyRkQnLA0KICAgIG5wYXI6ICdcdTIyMjYnLA0KICAgIG5wYXJhbGxlbDogJ1x1MjIyNicsDQogICAgbnBhcnNsOiAnXHUyQUZEXHUyMEU1JywNCiAgICBucGFydDogJ1x1MjIwMlx1MDMzOCcsDQogICAgbnBvbGludDogJ1x1MkExNCcsDQogICAgbnByOiAnXHUyMjgwJywNCiAgICBucHJjdWU6ICdcdTIyRTAnLA0KICAgIG5wcmU6ICdcdTJBQUZcdTAzMzgnLA0KICAgIG5wcmVjOiAnXHUyMjgwJywNCiAgICBucHJlY2VxOiAnXHUyQUFGXHUwMzM4JywNCiAgICBuckFycjogJ1x1MjFDRicsDQogICAgbnJhcnI6ICdcdTIxOUInLA0KICAgIG5yYXJyYzogJ1x1MjkzM1x1MDMzOCcsDQogICAgbnJhcnJ3OiAnXHUyMTlEXHUwMzM4JywNCiAgICBucmlnaHRhcnJvdzogJ1x1MjE5QicsDQogICAgbnJ0cmk6ICdcdTIyRUInLA0KICAgIG5ydHJpZTogJ1x1MjJFRCcsDQogICAgbnNjOiAnXHUyMjgxJywNCiAgICBuc2NjdWU6ICdcdTIyRTEnLA0KICAgIG5zY2U6ICdcdTJBQjBcdTAzMzgnLA0KICAgIG5zY3I6ICdcdUQ4MzVcdURDQzMnLA0KICAgIG5zaG9ydG1pZDogJ1x1MjIyNCcsDQogICAgbnNob3J0cGFyYWxsZWw6ICdcdTIyMjYnLA0KICAgIG5zaW06ICdcdTIyNDEnLA0KICAgIG5zaW1lOiAnXHUyMjQ0JywNCiAgICBuc2ltZXE6ICdcdTIyNDQnLA0KICAgIG5zbWlkOiAnXHUyMjI0JywNCiAgICBuc3BhcjogJ1x1MjIyNicsDQogICAgbnNxc3ViZTogJ1x1MjJFMicsDQogICAgbnNxc3VwZTogJ1x1MjJFMycsDQogICAgbnN1YjogJ1x1MjI4NCcsDQogICAgbnN1YkU6ICdcdTJBQzVcdTAzMzgnLA0KICAgIG5zdWJlOiAnXHUyMjg4JywNCiAgICBuc3Vic2V0OiAnXHUyMjgyXHUyMEQyJywNCiAgICBuc3Vic2V0ZXE6ICdcdTIyODgnLA0KICAgIG5zdWJzZXRlcXE6ICdcdTJBQzVcdTAzMzgnLA0KICAgIG5zdWNjOiAnXHUyMjgxJywNCiAgICBuc3VjY2VxOiAnXHUyQUIwXHUwMzM4JywNCiAgICBuc3VwOiAnXHUyMjg1JywNCiAgICBuc3VwRTogJ1x1MkFDNlx1MDMzOCcsDQogICAgbnN1cGU6ICdcdTIyODknLA0KICAgIG5zdXBzZXQ6ICdcdTIyODNcdTIwRDInLA0KICAgIG5zdXBzZXRlcTogJ1x1MjI4OScsDQogICAgbnN1cHNldGVxcTogJ1x1MkFDNlx1MDMzOCcsDQogICAgbnRnbDogJ1x1MjI3OScsDQogICAgbnRpbGRlOiAnXHUwMEYxJywNCiAgICBudGxnOiAnXHUyMjc4JywNCiAgICBudHJpYW5nbGVsZWZ0OiAnXHUyMkVBJywNCiAgICBudHJpYW5nbGVsZWZ0ZXE6ICdcdTIyRUMnLA0KICAgIG50cmlhbmdsZXJpZ2h0OiAnXHUyMkVCJywNCiAgICBudHJpYW5nbGVyaWdodGVxOiAnXHUyMkVEJywNCiAgICBudTogJ1x1MDNCRCcsDQogICAgbnVtOiAnXHUwMDIzJywNCiAgICBudW1lcm86ICdcdTIxMTYnLA0KICAgIG51bXNwOiAnXHUyMDA3JywNCiAgICBudkRhc2g6ICdcdTIyQUQnLA0KICAgIG52SGFycjogJ1x1MjkwNCcsDQogICAgbnZhcDogJ1x1MjI0RFx1MjBEMicsDQogICAgbnZkYXNoOiAnXHUyMkFDJywNCiAgICBudmdlOiAnXHUyMjY1XHUyMEQyJywNCiAgICBudmd0OiAnXHUwMDNFXHUyMEQyJywNCiAgICBudmluZmluOiAnXHUyOURFJywNCiAgICBudmxBcnI6ICdcdTI5MDInLA0KICAgIG52bGU6ICdcdTIyNjRcdTIwRDInLA0KICAgIG52bHQ6ICdcdTAwM0NcdTIwRDInLA0KICAgIG52bHRyaWU6ICdcdTIyQjRcdTIwRDInLA0KICAgIG52ckFycjogJ1x1MjkwMycsDQogICAgbnZydHJpZTogJ1x1MjJCNVx1MjBEMicsDQogICAgbnZzaW06ICdcdTIyM0NcdTIwRDInLA0KICAgIG53QXJyOiAnXHUyMUQ2JywNCiAgICBud2FyaGs6ICdcdTI5MjMnLA0KICAgIG53YXJyOiAnXHUyMTk2JywNCiAgICBud2Fycm93OiAnXHUyMTk2JywNCiAgICBud25lYXI6ICdcdTI5MjcnLA0KICAgIG9TOiAnXHUyNEM4JywNCiAgICBvYWN1dGU6ICdcdTAwRjMnLA0KICAgIG9hc3Q6ICdcdTIyOUInLA0KICAgIG9jaXI6ICdcdTIyOUEnLA0KICAgIG9jaXJjOiAnXHUwMEY0JywNCiAgICBvY3k6ICdcdTA0M0UnLA0KICAgIG9kYXNoOiAnXHUyMjlEJywNCiAgICBvZGJsYWM6ICdcdTAxNTEnLA0KICAgIG9kaXY6ICdcdTJBMzgnLA0KICAgIG9kb3Q6ICdcdTIyOTknLA0KICAgIG9kc29sZDogJ1x1MjlCQycsDQogICAgb2VsaWc6ICdcdTAxNTMnLA0KICAgIG9mY2lyOiAnXHUyOUJGJywNCiAgICBvZnI6ICdcdUQ4MzVcdUREMkMnLA0KICAgIG9nb246ICdcdTAyREInLA0KICAgIG9ncmF2ZTogJ1x1MDBGMicsDQogICAgb2d0OiAnXHUyOUMxJywNCiAgICBvaGJhcjogJ1x1MjlCNScsDQogICAgb2htOiAnXHUwM0E5JywNCiAgICBvaW50OiAnXHUyMjJFJywNCiAgICBvbGFycjogJ1x1MjFCQScsDQogICAgb2xjaXI6ICdcdTI5QkUnLA0KICAgIG9sY3Jvc3M6ICdcdTI5QkInLA0KICAgIG9saW5lOiAnXHUyMDNFJywNCiAgICBvbHQ6ICdcdTI5QzAnLA0KICAgIG9tYWNyOiAnXHUwMTREJywNCiAgICBvbWVnYTogJ1x1MDNDOScsDQogICAgb21pY3JvbjogJ1x1MDNCRicsDQogICAgb21pZDogJ1x1MjlCNicsDQogICAgb21pbnVzOiAnXHUyMjk2JywNCiAgICBvb3BmOiAnXHVEODM1XHVERDYwJywNCiAgICBvcGFyOiAnXHUyOUI3JywNCiAgICBvcGVycDogJ1x1MjlCOScsDQogICAgb3BsdXM6ICdcdTIyOTUnLA0KICAgIG9yOiAnXHUyMjI4JywNCiAgICBvcmFycjogJ1x1MjFCQicsDQogICAgb3JkOiAnXHUyQTVEJywNCiAgICBvcmRlcjogJ1x1MjEzNCcsDQogICAgb3JkZXJvZjogJ1x1MjEzNCcsDQogICAgb3JkZjogJ1x1MDBBQScsDQogICAgb3JkbTogJ1x1MDBCQScsDQogICAgb3JpZ29mOiAnXHUyMkI2JywNCiAgICBvcm9yOiAnXHUyQTU2JywNCiAgICBvcnNsb3BlOiAnXHUyQTU3JywNCiAgICBvcnY6ICdcdTJBNUInLA0KICAgIG9zY3I6ICdcdTIxMzQnLA0KICAgIG9zbGFzaDogJ1x1MDBGOCcsDQogICAgb3NvbDogJ1x1MjI5OCcsDQogICAgb3RpbGRlOiAnXHUwMEY1JywNCiAgICBvdGltZXM6ICdcdTIyOTcnLA0KICAgIG90aW1lc2FzOiAnXHUyQTM2JywNCiAgICBvdW1sOiAnXHUwMEY2JywNCiAgICBvdmJhcjogJ1x1MjMzRCcsDQogICAgcGFyOiAnXHUyMjI1JywNCiAgICBwYXJhOiAnXHUwMEI2JywNCiAgICBwYXJhbGxlbDogJ1x1MjIyNScsDQogICAgcGFyc2ltOiAnXHUyQUYzJywNCiAgICBwYXJzbDogJ1x1MkFGRCcsDQogICAgcGFydDogJ1x1MjIwMicsDQogICAgcGN5OiAnXHUwNDNGJywNCiAgICBwZXJjbnQ6ICdcdTAwMjUnLA0KICAgIHBlcmlvZDogJ1x1MDAyRScsDQogICAgcGVybWlsOiAnXHUyMDMwJywNCiAgICBwZXJwOiAnXHUyMkE1JywNCiAgICBwZXJ0ZW5rOiAnXHUyMDMxJywNCiAgICBwZnI6ICdcdUQ4MzVcdUREMkQnLA0KICAgIHBoaTogJ1x1MDNDNicsDQogICAgcGhpdjogJ1x1MDNENScsDQogICAgcGhtbWF0OiAnXHUyMTMzJywNCiAgICBwaG9uZTogJ1x1MjYwRScsDQogICAgcGk6ICdcdTAzQzAnLA0KICAgIHBpdGNoZm9yazogJ1x1MjJENCcsDQogICAgcGl2OiAnXHUwM0Q2JywNCiAgICBwbGFuY2s6ICdcdTIxMEYnLA0KICAgIHBsYW5ja2g6ICdcdTIxMEUnLA0KICAgIHBsYW5rdjogJ1x1MjEwRicsDQogICAgcGx1czogJ1x1MDAyQicsDQogICAgcGx1c2FjaXI6ICdcdTJBMjMnLA0KICAgIHBsdXNiOiAnXHUyMjlFJywNCiAgICBwbHVzY2lyOiAnXHUyQTIyJywNCiAgICBwbHVzZG86ICdcdTIyMTQnLA0KICAgIHBsdXNkdTogJ1x1MkEyNScsDQogICAgcGx1c2U6ICdcdTJBNzInLA0KICAgIHBsdXNtbjogJ1x1MDBCMScsDQogICAgcGx1c3NpbTogJ1x1MkEyNicsDQogICAgcGx1c3R3bzogJ1x1MkEyNycsDQogICAgcG06ICdcdTAwQjEnLA0KICAgIHBvaW50aW50OiAnXHUyQTE1JywNCiAgICBwb3BmOiAnXHVEODM1XHVERDYxJywNCiAgICBwb3VuZDogJ1x1MDBBMycsDQogICAgcHI6ICdcdTIyN0EnLA0KICAgIHByRTogJ1x1MkFCMycsDQogICAgcHJhcDogJ1x1MkFCNycsDQogICAgcHJjdWU6ICdcdTIyN0MnLA0KICAgIHByZTogJ1x1MkFBRicsDQogICAgcHJlYzogJ1x1MjI3QScsDQogICAgcHJlY2FwcHJveDogJ1x1MkFCNycsDQogICAgcHJlY2N1cmx5ZXE6ICdcdTIyN0MnLA0KICAgIHByZWNlcTogJ1x1MkFBRicsDQogICAgcHJlY25hcHByb3g6ICdcdTJBQjknLA0KICAgIHByZWNuZXFxOiAnXHUyQUI1JywNCiAgICBwcmVjbnNpbTogJ1x1MjJFOCcsDQogICAgcHJlY3NpbTogJ1x1MjI3RScsDQogICAgcHJpbWU6ICdcdTIwMzInLA0KICAgIHByaW1lczogJ1x1MjExOScsDQogICAgcHJuRTogJ1x1MkFCNScsDQogICAgcHJuYXA6ICdcdTJBQjknLA0KICAgIHBybnNpbTogJ1x1MjJFOCcsDQogICAgcHJvZDogJ1x1MjIwRicsDQogICAgcHJvZmFsYXI6ICdcdTIzMkUnLA0KICAgIHByb2ZsaW5lOiAnXHUyMzEyJywNCiAgICBwcm9mc3VyZjogJ1x1MjMxMycsDQogICAgcHJvcDogJ1x1MjIxRCcsDQogICAgcHJvcHRvOiAnXHUyMjFEJywNCiAgICBwcnNpbTogJ1x1MjI3RScsDQogICAgcHJ1cmVsOiAnXHUyMkIwJywNCiAgICBwc2NyOiAnXHVEODM1XHVEQ0M1JywNCiAgICBwc2k6ICdcdTAzQzgnLA0KICAgIHB1bmNzcDogJ1x1MjAwOCcsDQogICAgcWZyOiAnXHVEODM1XHVERDJFJywNCiAgICBxaW50OiAnXHUyQTBDJywNCiAgICBxb3BmOiAnXHVEODM1XHVERDYyJywNCiAgICBxcHJpbWU6ICdcdTIwNTcnLA0KICAgIHFzY3I6ICdcdUQ4MzVcdURDQzYnLA0KICAgIHF1YXRlcm5pb25zOiAnXHUyMTBEJywNCiAgICBxdWF0aW50OiAnXHUyQTE2JywNCiAgICBxdWVzdDogJ1x1MDAzRicsDQogICAgcXVlc3RlcTogJ1x1MjI1RicsDQogICAgcXVvdDogJ1x1MDAyMicsDQogICAgckFhcnI6ICdcdTIxREInLA0KICAgIHJBcnI6ICdcdTIxRDInLA0KICAgIHJBdGFpbDogJ1x1MjkxQycsDQogICAgckJhcnI6ICdcdTI5MEYnLA0KICAgIHJIYXI6ICdcdTI5NjQnLA0KICAgIHJhY2U6ICdcdTIyM0RcdTAzMzEnLA0KICAgIHJhY3V0ZTogJ1x1MDE1NScsDQogICAgcmFkaWM6ICdcdTIyMUEnLA0KICAgIHJhZW1wdHl2OiAnXHUyOUIzJywNCiAgICByYW5nOiAnXHUyN0U5JywNCiAgICByYW5nZDogJ1x1Mjk5MicsDQogICAgcmFuZ2U6ICdcdTI5QTUnLA0KICAgIHJhbmdsZTogJ1x1MjdFOScsDQogICAgcmFxdW86ICdcdTAwQkInLA0KICAgIHJhcnI6ICdcdTIxOTInLA0KICAgIHJhcnJhcDogJ1x1Mjk3NScsDQogICAgcmFycmI6ICdcdTIxRTUnLA0KICAgIHJhcnJiZnM6ICdcdTI5MjAnLA0KICAgIHJhcnJjOiAnXHUyOTMzJywNCiAgICByYXJyZnM6ICdcdTI5MUUnLA0KICAgIHJhcnJoazogJ1x1MjFBQScsDQogICAgcmFycmxwOiAnXHUyMUFDJywNCiAgICByYXJycGw6ICdcdTI5NDUnLA0KICAgIHJhcnJzaW06ICdcdTI5NzQnLA0KICAgIHJhcnJ0bDogJ1x1MjFBMycsDQogICAgcmFycnc6ICdcdTIxOUQnLA0KICAgIHJhdGFpbDogJ1x1MjkxQScsDQogICAgcmF0aW86ICdcdTIyMzYnLA0KICAgIHJhdGlvbmFsczogJ1x1MjExQScsDQogICAgcmJhcnI6ICdcdTI5MEQnLA0KICAgIHJiYnJrOiAnXHUyNzczJywNCiAgICByYnJhY2U6ICdcdTAwN0QnLA0KICAgIHJicmFjazogJ1x1MDA1RCcsDQogICAgcmJya2U6ICdcdTI5OEMnLA0KICAgIHJicmtzbGQ6ICdcdTI5OEUnLA0KICAgIHJicmtzbHU6ICdcdTI5OTAnLA0KICAgIHJjYXJvbjogJ1x1MDE1OScsDQogICAgcmNlZGlsOiAnXHUwMTU3JywNCiAgICByY2VpbDogJ1x1MjMwOScsDQogICAgcmN1YjogJ1x1MDA3RCcsDQogICAgcmN5OiAnXHUwNDQwJywNCiAgICByZGNhOiAnXHUyOTM3JywNCiAgICByZGxkaGFyOiAnXHUyOTY5JywNCiAgICByZHF1bzogJ1x1MjAxRCcsDQogICAgcmRxdW9yOiAnXHUyMDFEJywNCiAgICByZHNoOiAnXHUyMUIzJywNCiAgICByZWFsOiAnXHUyMTFDJywNCiAgICByZWFsaW5lOiAnXHUyMTFCJywNCiAgICByZWFscGFydDogJ1x1MjExQycsDQogICAgcmVhbHM6ICdcdTIxMUQnLA0KICAgIHJlY3Q6ICdcdTI1QUQnLA0KICAgIHJlZzogJ1x1MDBBRScsDQogICAgcmZpc2h0OiAnXHUyOTdEJywNCiAgICByZmxvb3I6ICdcdTIzMEInLA0KICAgIHJmcjogJ1x1RDgzNVx1REQyRicsDQogICAgcmhhcmQ6ICdcdTIxQzEnLA0KICAgIHJoYXJ1OiAnXHUyMUMwJywNCiAgICByaGFydWw6ICdcdTI5NkMnLA0KICAgIHJobzogJ1x1MDNDMScsDQogICAgcmhvdjogJ1x1MDNGMScsDQogICAgcmlnaHRhcnJvdzogJ1x1MjE5MicsDQogICAgcmlnaHRhcnJvd3RhaWw6ICdcdTIxQTMnLA0KICAgIHJpZ2h0aGFycG9vbmRvd246ICdcdTIxQzEnLA0KICAgIHJpZ2h0aGFycG9vbnVwOiAnXHUyMUMwJywNCiAgICByaWdodGxlZnRhcnJvd3M6ICdcdTIxQzQnLA0KICAgIHJpZ2h0bGVmdGhhcnBvb25zOiAnXHUyMUNDJywNCiAgICByaWdodHJpZ2h0YXJyb3dzOiAnXHUyMUM5JywNCiAgICByaWdodHNxdWlnYXJyb3c6ICdcdTIxOUQnLA0KICAgIHJpZ2h0dGhyZWV0aW1lczogJ1x1MjJDQycsDQogICAgcmluZzogJ1x1MDJEQScsDQogICAgcmlzaW5nZG90c2VxOiAnXHUyMjUzJywNCiAgICBybGFycjogJ1x1MjFDNCcsDQogICAgcmxoYXI6ICdcdTIxQ0MnLA0KICAgIHJsbTogJ1x1MjAwRicsDQogICAgcm1vdXN0OiAnXHUyM0IxJywNCiAgICBybW91c3RhY2hlOiAnXHUyM0IxJywNCiAgICBybm1pZDogJ1x1MkFFRScsDQogICAgcm9hbmc6ICdcdTI3RUQnLA0KICAgIHJvYXJyOiAnXHUyMUZFJywNCiAgICByb2JyazogJ1x1MjdFNycsDQogICAgcm9wYXI6ICdcdTI5ODYnLA0KICAgIHJvcGY6ICdcdUQ4MzVcdURENjMnLA0KICAgIHJvcGx1czogJ1x1MkEyRScsDQogICAgcm90aW1lczogJ1x1MkEzNScsDQogICAgcnBhcjogJ1x1MDAyOScsDQogICAgcnBhcmd0OiAnXHUyOTk0JywNCiAgICBycHBvbGludDogJ1x1MkExMicsDQogICAgcnJhcnI6ICdcdTIxQzknLA0KICAgIHJzYXF1bzogJ1x1MjAzQScsDQogICAgcnNjcjogJ1x1RDgzNVx1RENDNycsDQogICAgcnNoOiAnXHUyMUIxJywNCiAgICByc3FiOiAnXHUwMDVEJywNCiAgICByc3F1bzogJ1x1MjAxOScsDQogICAgcnNxdW9yOiAnXHUyMDE5JywNCiAgICBydGhyZWU6ICdcdTIyQ0MnLA0KICAgIHJ0aW1lczogJ1x1MjJDQScsDQogICAgcnRyaTogJ1x1MjVCOScsDQogICAgcnRyaWU6ICdcdTIyQjUnLA0KICAgIHJ0cmlmOiAnXHUyNUI4JywNCiAgICBydHJpbHRyaTogJ1x1MjlDRScsDQogICAgcnVsdWhhcjogJ1x1Mjk2OCcsDQogICAgcng6ICdcdTIxMUUnLA0KICAgIHNhY3V0ZTogJ1x1MDE1QicsDQogICAgc2JxdW86ICdcdTIwMUEnLA0KICAgIHNjOiAnXHUyMjdCJywNCiAgICBzY0U6ICdcdTJBQjQnLA0KICAgIHNjYXA6ICdcdTJBQjgnLA0KICAgIHNjYXJvbjogJ1x1MDE2MScsDQogICAgc2NjdWU6ICdcdTIyN0QnLA0KICAgIHNjZTogJ1x1MkFCMCcsDQogICAgc2NlZGlsOiAnXHUwMTVGJywNCiAgICBzY2lyYzogJ1x1MDE1RCcsDQogICAgc2NuRTogJ1x1MkFCNicsDQogICAgc2NuYXA6ICdcdTJBQkEnLA0KICAgIHNjbnNpbTogJ1x1MjJFOScsDQogICAgc2Nwb2xpbnQ6ICdcdTJBMTMnLA0KICAgIHNjc2ltOiAnXHUyMjdGJywNCiAgICBzY3k6ICdcdTA0NDEnLA0KICAgIHNkb3Q6ICdcdTIyQzUnLA0KICAgIHNkb3RiOiAnXHUyMkExJywNCiAgICBzZG90ZTogJ1x1MkE2NicsDQogICAgc2VBcnI6ICdcdTIxRDgnLA0KICAgIHNlYXJoazogJ1x1MjkyNScsDQogICAgc2VhcnI6ICdcdTIxOTgnLA0KICAgIHNlYXJyb3c6ICdcdTIxOTgnLA0KICAgIHNlY3Q6ICdcdTAwQTcnLA0KICAgIHNlbWk6ICdcdTAwM0InLA0KICAgIHNlc3dhcjogJ1x1MjkyOScsDQogICAgc2V0bWludXM6ICdcdTIyMTYnLA0KICAgIHNldG1uOiAnXHUyMjE2JywNCiAgICBzZXh0OiAnXHUyNzM2JywNCiAgICBzZnI6ICdcdUQ4MzVcdUREMzAnLA0KICAgIHNmcm93bjogJ1x1MjMyMicsDQogICAgc2hhcnA6ICdcdTI2NkYnLA0KICAgIHNoY2hjeTogJ1x1MDQ0OScsDQogICAgc2hjeTogJ1x1MDQ0OCcsDQogICAgc2hvcnRtaWQ6ICdcdTIyMjMnLA0KICAgIHNob3J0cGFyYWxsZWw6ICdcdTIyMjUnLA0KICAgIHNoeTogJ1x1MDBBRCcsDQogICAgc2lnbWE6ICdcdTAzQzMnLA0KICAgIHNpZ21hZjogJ1x1MDNDMicsDQogICAgc2lnbWF2OiAnXHUwM0MyJywNCiAgICBzaW06ICdcdTIyM0MnLA0KICAgIHNpbWRvdDogJ1x1MkE2QScsDQogICAgc2ltZTogJ1x1MjI0MycsDQogICAgc2ltZXE6ICdcdTIyNDMnLA0KICAgIHNpbWc6ICdcdTJBOUUnLA0KICAgIHNpbWdFOiAnXHUyQUEwJywNCiAgICBzaW1sOiAnXHUyQTlEJywNCiAgICBzaW1sRTogJ1x1MkE5RicsDQogICAgc2ltbmU6ICdcdTIyNDYnLA0KICAgIHNpbXBsdXM6ICdcdTJBMjQnLA0KICAgIHNpbXJhcnI6ICdcdTI5NzInLA0KICAgIHNsYXJyOiAnXHUyMTkwJywNCiAgICBzbWFsbHNldG1pbnVzOiAnXHUyMjE2JywNCiAgICBzbWFzaHA6ICdcdTJBMzMnLA0KICAgIHNtZXBhcnNsOiAnXHUyOUU0JywNCiAgICBzbWlkOiAnXHUyMjIzJywNCiAgICBzbWlsZTogJ1x1MjMyMycsDQogICAgc210OiAnXHUyQUFBJywNCiAgICBzbXRlOiAnXHUyQUFDJywNCiAgICBzbXRlczogJ1x1MkFBQ1x1RkUwMCcsDQogICAgc29mdGN5OiAnXHUwNDRDJywNCiAgICBzb2w6ICdcdTAwMkYnLA0KICAgIHNvbGI6ICdcdTI5QzQnLA0KICAgIHNvbGJhcjogJ1x1MjMzRicsDQogICAgc29wZjogJ1x1RDgzNVx1REQ2NCcsDQogICAgc3BhZGVzOiAnXHUyNjYwJywNCiAgICBzcGFkZXN1aXQ6ICdcdTI2NjAnLA0KICAgIHNwYXI6ICdcdTIyMjUnLA0KICAgIHNxY2FwOiAnXHUyMjkzJywNCiAgICBzcWNhcHM6ICdcdTIyOTNcdUZFMDAnLA0KICAgIHNxY3VwOiAnXHUyMjk0JywNCiAgICBzcWN1cHM6ICdcdTIyOTRcdUZFMDAnLA0KICAgIHNxc3ViOiAnXHUyMjhGJywNCiAgICBzcXN1YmU6ICdcdTIyOTEnLA0KICAgIHNxc3Vic2V0OiAnXHUyMjhGJywNCiAgICBzcXN1YnNldGVxOiAnXHUyMjkxJywNCiAgICBzcXN1cDogJ1x1MjI5MCcsDQogICAgc3FzdXBlOiAnXHUyMjkyJywNCiAgICBzcXN1cHNldDogJ1x1MjI5MCcsDQogICAgc3FzdXBzZXRlcTogJ1x1MjI5MicsDQogICAgc3F1OiAnXHUyNUExJywNCiAgICBzcXVhcmU6ICdcdTI1QTEnLA0KICAgIHNxdWFyZjogJ1x1MjVBQScsDQogICAgc3F1ZjogJ1x1MjVBQScsDQogICAgc3JhcnI6ICdcdTIxOTInLA0KICAgIHNzY3I6ICdcdUQ4MzVcdURDQzgnLA0KICAgIHNzZXRtbjogJ1x1MjIxNicsDQogICAgc3NtaWxlOiAnXHUyMzIzJywNCiAgICBzc3RhcmY6ICdcdTIyQzYnLA0KICAgIHN0YXI6ICdcdTI2MDYnLA0KICAgIHN0YXJmOiAnXHUyNjA1JywNCiAgICBzdHJhaWdodGVwc2lsb246ICdcdTAzRjUnLA0KICAgIHN0cmFpZ2h0cGhpOiAnXHUwM0Q1JywNCiAgICBzdHJuczogJ1x1MDBBRicsDQogICAgc3ViOiAnXHUyMjgyJywNCiAgICBzdWJFOiAnXHUyQUM1JywNCiAgICBzdWJkb3Q6ICdcdTJBQkQnLA0KICAgIHN1YmU6ICdcdTIyODYnLA0KICAgIHN1YmVkb3Q6ICdcdTJBQzMnLA0KICAgIHN1Ym11bHQ6ICdcdTJBQzEnLA0KICAgIHN1Ym5FOiAnXHUyQUNCJywNCiAgICBzdWJuZTogJ1x1MjI4QScsDQogICAgc3VicGx1czogJ1x1MkFCRicsDQogICAgc3VicmFycjogJ1x1Mjk3OScsDQogICAgc3Vic2V0OiAnXHUyMjgyJywNCiAgICBzdWJzZXRlcTogJ1x1MjI4NicsDQogICAgc3Vic2V0ZXFxOiAnXHUyQUM1JywNCiAgICBzdWJzZXRuZXE6ICdcdTIyOEEnLA0KICAgIHN1YnNldG5lcXE6ICdcdTJBQ0InLA0KICAgIHN1YnNpbTogJ1x1MkFDNycsDQogICAgc3Vic3ViOiAnXHUyQUQ1JywNCiAgICBzdWJzdXA6ICdcdTJBRDMnLA0KICAgIHN1Y2M6ICdcdTIyN0InLA0KICAgIHN1Y2NhcHByb3g6ICdcdTJBQjgnLA0KICAgIHN1Y2NjdXJseWVxOiAnXHUyMjdEJywNCiAgICBzdWNjZXE6ICdcdTJBQjAnLA0KICAgIHN1Y2NuYXBwcm94OiAnXHUyQUJBJywNCiAgICBzdWNjbmVxcTogJ1x1MkFCNicsDQogICAgc3VjY25zaW06ICdcdTIyRTknLA0KICAgIHN1Y2NzaW06ICdcdTIyN0YnLA0KICAgIHN1bTogJ1x1MjIxMScsDQogICAgc3VuZzogJ1x1MjY2QScsDQogICAgc3VwMTogJ1x1MDBCOScsDQogICAgc3VwMjogJ1x1MDBCMicsDQogICAgc3VwMzogJ1x1MDBCMycsDQogICAgc3VwOiAnXHUyMjgzJywNCiAgICBzdXBFOiAnXHUyQUM2JywNCiAgICBzdXBkb3Q6ICdcdTJBQkUnLA0KICAgIHN1cGRzdWI6ICdcdTJBRDgnLA0KICAgIHN1cGU6ICdcdTIyODcnLA0KICAgIHN1cGVkb3Q6ICdcdTJBQzQnLA0KICAgIHN1cGhzb2w6ICdcdTI3QzknLA0KICAgIHN1cGhzdWI6ICdcdTJBRDcnLA0KICAgIHN1cGxhcnI6ICdcdTI5N0InLA0KICAgIHN1cG11bHQ6ICdcdTJBQzInLA0KICAgIHN1cG5FOiAnXHUyQUNDJywNCiAgICBzdXBuZTogJ1x1MjI4QicsDQogICAgc3VwcGx1czogJ1x1MkFDMCcsDQogICAgc3Vwc2V0OiAnXHUyMjgzJywNCiAgICBzdXBzZXRlcTogJ1x1MjI4NycsDQogICAgc3Vwc2V0ZXFxOiAnXHUyQUM2JywNCiAgICBzdXBzZXRuZXE6ICdcdTIyOEInLA0KICAgIHN1cHNldG5lcXE6ICdcdTJBQ0MnLA0KICAgIHN1cHNpbTogJ1x1MkFDOCcsDQogICAgc3Vwc3ViOiAnXHUyQUQ0JywNCiAgICBzdXBzdXA6ICdcdTJBRDYnLA0KICAgIHN3QXJyOiAnXHUyMUQ5JywNCiAgICBzd2FyaGs6ICdcdTI5MjYnLA0KICAgIHN3YXJyOiAnXHUyMTk5JywNCiAgICBzd2Fycm93OiAnXHUyMTk5JywNCiAgICBzd253YXI6ICdcdTI5MkEnLA0KICAgIHN6bGlnOiAnXHUwMERGJywNCiAgICB0YXJnZXQ6ICdcdTIzMTYnLA0KICAgIHRhdTogJ1x1MDNDNCcsDQogICAgdGJyazogJ1x1MjNCNCcsDQogICAgdGNhcm9uOiAnXHUwMTY1JywNCiAgICB0Y2VkaWw6ICdcdTAxNjMnLA0KICAgIHRjeTogJ1x1MDQ0MicsDQogICAgdGRvdDogJ1x1MjBEQicsDQogICAgdGVscmVjOiAnXHUyMzE1JywNCiAgICB0ZnI6ICdcdUQ4MzVcdUREMzEnLA0KICAgIHRoZXJlNDogJ1x1MjIzNCcsDQogICAgdGhlcmVmb3JlOiAnXHUyMjM0JywNCiAgICB0aGV0YTogJ1x1MDNCOCcsDQogICAgdGhldGFzeW06ICdcdTAzRDEnLA0KICAgIHRoZXRhdjogJ1x1MDNEMScsDQogICAgdGhpY2thcHByb3g6ICdcdTIyNDgnLA0KICAgIHRoaWNrc2ltOiAnXHUyMjNDJywNCiAgICB0aGluc3A6ICdcdTIwMDknLA0KICAgIHRoa2FwOiAnXHUyMjQ4JywNCiAgICB0aGtzaW06ICdcdTIyM0MnLA0KICAgIHRob3JuOiAnXHUwMEZFJywNCiAgICB0aWxkZTogJ1x1MDJEQycsDQogICAgdGltZXM6ICdcdTAwRDcnLA0KICAgIHRpbWVzYjogJ1x1MjJBMCcsDQogICAgdGltZXNiYXI6ICdcdTJBMzEnLA0KICAgIHRpbWVzZDogJ1x1MkEzMCcsDQogICAgdGludDogJ1x1MjIyRCcsDQogICAgdG9lYTogJ1x1MjkyOCcsDQogICAgdG9wOiAnXHUyMkE0JywNCiAgICB0b3Bib3Q6ICdcdTIzMzYnLA0KICAgIHRvcGNpcjogJ1x1MkFGMScsDQogICAgdG9wZjogJ1x1RDgzNVx1REQ2NScsDQogICAgdG9wZm9yazogJ1x1MkFEQScsDQogICAgdG9zYTogJ1x1MjkyOScsDQogICAgdHByaW1lOiAnXHUyMDM0JywNCiAgICB0cmFkZTogJ1x1MjEyMicsDQogICAgdHJpYW5nbGU6ICdcdTI1QjUnLA0KICAgIHRyaWFuZ2xlZG93bjogJ1x1MjVCRicsDQogICAgdHJpYW5nbGVsZWZ0OiAnXHUyNUMzJywNCiAgICB0cmlhbmdsZWxlZnRlcTogJ1x1MjJCNCcsDQogICAgdHJpYW5nbGVxOiAnXHUyMjVDJywNCiAgICB0cmlhbmdsZXJpZ2h0OiAnXHUyNUI5JywNCiAgICB0cmlhbmdsZXJpZ2h0ZXE6ICdcdTIyQjUnLA0KICAgIHRyaWRvdDogJ1x1MjVFQycsDQogICAgdHJpZTogJ1x1MjI1QycsDQogICAgdHJpbWludXM6ICdcdTJBM0EnLA0KICAgIHRyaXBsdXM6ICdcdTJBMzknLA0KICAgIHRyaXNiOiAnXHUyOUNEJywNCiAgICB0cml0aW1lOiAnXHUyQTNCJywNCiAgICB0cnBleml1bTogJ1x1MjNFMicsDQogICAgdHNjcjogJ1x1RDgzNVx1RENDOScsDQogICAgdHNjeTogJ1x1MDQ0NicsDQogICAgdHNoY3k6ICdcdTA0NUInLA0KICAgIHRzdHJvazogJ1x1MDE2NycsDQogICAgdHdpeHQ6ICdcdTIyNkMnLA0KICAgIHR3b2hlYWRsZWZ0YXJyb3c6ICdcdTIxOUUnLA0KICAgIHR3b2hlYWRyaWdodGFycm93OiAnXHUyMUEwJywNCiAgICB1QXJyOiAnXHUyMUQxJywNCiAgICB1SGFyOiAnXHUyOTYzJywNCiAgICB1YWN1dGU6ICdcdTAwRkEnLA0KICAgIHVhcnI6ICdcdTIxOTEnLA0KICAgIHVicmN5OiAnXHUwNDVFJywNCiAgICB1YnJldmU6ICdcdTAxNkQnLA0KICAgIHVjaXJjOiAnXHUwMEZCJywNCiAgICB1Y3k6ICdcdTA0NDMnLA0KICAgIHVkYXJyOiAnXHUyMUM1JywNCiAgICB1ZGJsYWM6ICdcdTAxNzEnLA0KICAgIHVkaGFyOiAnXHUyOTZFJywNCiAgICB1ZmlzaHQ6ICdcdTI5N0UnLA0KICAgIHVmcjogJ1x1RDgzNVx1REQzMicsDQogICAgdWdyYXZlOiAnXHUwMEY5JywNCiAgICB1aGFybDogJ1x1MjFCRicsDQogICAgdWhhcnI6ICdcdTIxQkUnLA0KICAgIHVoYmxrOiAnXHUyNTgwJywNCiAgICB1bGNvcm46ICdcdTIzMUMnLA0KICAgIHVsY29ybmVyOiAnXHUyMzFDJywNCiAgICB1bGNyb3A6ICdcdTIzMEYnLA0KICAgIHVsdHJpOiAnXHUyNUY4JywNCiAgICB1bWFjcjogJ1x1MDE2QicsDQogICAgdW1sOiAnXHUwMEE4JywNCiAgICB1b2dvbjogJ1x1MDE3MycsDQogICAgdW9wZjogJ1x1RDgzNVx1REQ2NicsDQogICAgdXBhcnJvdzogJ1x1MjE5MScsDQogICAgdXBkb3duYXJyb3c6ICdcdTIxOTUnLA0KICAgIHVwaGFycG9vbmxlZnQ6ICdcdTIxQkYnLA0KICAgIHVwaGFycG9vbnJpZ2h0OiAnXHUyMUJFJywNCiAgICB1cGx1czogJ1x1MjI4RScsDQogICAgdXBzaTogJ1x1MDNDNScsDQogICAgdXBzaWg6ICdcdTAzRDInLA0KICAgIHVwc2lsb246ICdcdTAzQzUnLA0KICAgIHVwdXBhcnJvd3M6ICdcdTIxQzgnLA0KICAgIHVyY29ybjogJ1x1MjMxRCcsDQogICAgdXJjb3JuZXI6ICdcdTIzMUQnLA0KICAgIHVyY3JvcDogJ1x1MjMwRScsDQogICAgdXJpbmc6ICdcdTAxNkYnLA0KICAgIHVydHJpOiAnXHUyNUY5JywNCiAgICB1c2NyOiAnXHVEODM1XHVEQ0NBJywNCiAgICB1dGRvdDogJ1x1MjJGMCcsDQogICAgdXRpbGRlOiAnXHUwMTY5JywNCiAgICB1dHJpOiAnXHUyNUI1JywNCiAgICB1dHJpZjogJ1x1MjVCNCcsDQogICAgdXVhcnI6ICdcdTIxQzgnLA0KICAgIHV1bWw6ICdcdTAwRkMnLA0KICAgIHV3YW5nbGU6ICdcdTI5QTcnLA0KICAgIHZBcnI6ICdcdTIxRDUnLA0KICAgIHZCYXI6ICdcdTJBRTgnLA0KICAgIHZCYXJ2OiAnXHUyQUU5JywNCiAgICB2RGFzaDogJ1x1MjJBOCcsDQogICAgdmFuZ3J0OiAnXHUyOTlDJywNCiAgICB2YXJlcHNpbG9uOiAnXHUwM0Y1JywNCiAgICB2YXJrYXBwYTogJ1x1MDNGMCcsDQogICAgdmFybm90aGluZzogJ1x1MjIwNScsDQogICAgdmFycGhpOiAnXHUwM0Q1JywNCiAgICB2YXJwaTogJ1x1MDNENicsDQogICAgdmFycHJvcHRvOiAnXHUyMjFEJywNCiAgICB2YXJyOiAnXHUyMTk1JywNCiAgICB2YXJyaG86ICdcdTAzRjEnLA0KICAgIHZhcnNpZ21hOiAnXHUwM0MyJywNCiAgICB2YXJzdWJzZXRuZXE6ICdcdTIyOEFcdUZFMDAnLA0KICAgIHZhcnN1YnNldG5lcXE6ICdcdTJBQ0JcdUZFMDAnLA0KICAgIHZhcnN1cHNldG5lcTogJ1x1MjI4Qlx1RkUwMCcsDQogICAgdmFyc3Vwc2V0bmVxcTogJ1x1MkFDQ1x1RkUwMCcsDQogICAgdmFydGhldGE6ICdcdTAzRDEnLA0KICAgIHZhcnRyaWFuZ2xlbGVmdDogJ1x1MjJCMicsDQogICAgdmFydHJpYW5nbGVyaWdodDogJ1x1MjJCMycsDQogICAgdmN5OiAnXHUwNDMyJywNCiAgICB2ZGFzaDogJ1x1MjJBMicsDQogICAgdmVlOiAnXHUyMjI4JywNCiAgICB2ZWViYXI6ICdcdTIyQkInLA0KICAgIHZlZWVxOiAnXHUyMjVBJywNCiAgICB2ZWxsaXA6ICdcdTIyRUUnLA0KICAgIHZlcmJhcjogJ1x1MDA3QycsDQogICAgdmVydDogJ1x1MDA3QycsDQogICAgdmZyOiAnXHVEODM1XHVERDMzJywNCiAgICB2bHRyaTogJ1x1MjJCMicsDQogICAgdm5zdWI6ICdcdTIyODJcdTIwRDInLA0KICAgIHZuc3VwOiAnXHUyMjgzXHUyMEQyJywNCiAgICB2b3BmOiAnXHVEODM1XHVERDY3JywNCiAgICB2cHJvcDogJ1x1MjIxRCcsDQogICAgdnJ0cmk6ICdcdTIyQjMnLA0KICAgIHZzY3I6ICdcdUQ4MzVcdURDQ0InLA0KICAgIHZzdWJuRTogJ1x1MkFDQlx1RkUwMCcsDQogICAgdnN1Ym5lOiAnXHUyMjhBXHVGRTAwJywNCiAgICB2c3VwbkU6ICdcdTJBQ0NcdUZFMDAnLA0KICAgIHZzdXBuZTogJ1x1MjI4Qlx1RkUwMCcsDQogICAgdnppZ3phZzogJ1x1Mjk5QScsDQogICAgd2NpcmM6ICdcdTAxNzUnLA0KICAgIHdlZGJhcjogJ1x1MkE1RicsDQogICAgd2VkZ2U6ICdcdTIyMjcnLA0KICAgIHdlZGdlcTogJ1x1MjI1OScsDQogICAgd2VpZXJwOiAnXHUyMTE4JywNCiAgICB3ZnI6ICdcdUQ4MzVcdUREMzQnLA0KICAgIHdvcGY6ICdcdUQ4MzVcdURENjgnLA0KICAgIHdwOiAnXHUyMTE4JywNCiAgICB3cjogJ1x1MjI0MCcsDQogICAgd3JlYXRoOiAnXHUyMjQwJywNCiAgICB3c2NyOiAnXHVEODM1XHVEQ0NDJywNCiAgICB4Y2FwOiAnXHUyMkMyJywNCiAgICB4Y2lyYzogJ1x1MjVFRicsDQogICAgeGN1cDogJ1x1MjJDMycsDQogICAgeGR0cmk6ICdcdTI1QkQnLA0KICAgIHhmcjogJ1x1RDgzNVx1REQzNScsDQogICAgeGhBcnI6ICdcdTI3RkEnLA0KICAgIHhoYXJyOiAnXHUyN0Y3JywNCiAgICB4aTogJ1x1MDNCRScsDQogICAgeGxBcnI6ICdcdTI3RjgnLA0KICAgIHhsYXJyOiAnXHUyN0Y1JywNCiAgICB4bWFwOiAnXHUyN0ZDJywNCiAgICB4bmlzOiAnXHUyMkZCJywNCiAgICB4b2RvdDogJ1x1MkEwMCcsDQogICAgeG9wZjogJ1x1RDgzNVx1REQ2OScsDQogICAgeG9wbHVzOiAnXHUyQTAxJywNCiAgICB4b3RpbWU6ICdcdTJBMDInLA0KICAgIHhyQXJyOiAnXHUyN0Y5JywNCiAgICB4cmFycjogJ1x1MjdGNicsDQogICAgeHNjcjogJ1x1RDgzNVx1RENDRCcsDQogICAgeHNxY3VwOiAnXHUyQTA2JywNCiAgICB4dXBsdXM6ICdcdTJBMDQnLA0KICAgIHh1dHJpOiAnXHUyNUIzJywNCiAgICB4dmVlOiAnXHUyMkMxJywNCiAgICB4d2VkZ2U6ICdcdTIyQzAnLA0KICAgIHlhY3V0ZTogJ1x1MDBGRCcsDQogICAgeWFjeTogJ1x1MDQ0RicsDQogICAgeWNpcmM6ICdcdTAxNzcnLA0KICAgIHljeTogJ1x1MDQ0QicsDQogICAgeWVuOiAnXHUwMEE1JywNCiAgICB5ZnI6ICdcdUQ4MzVcdUREMzYnLA0KICAgIHlpY3k6ICdcdTA0NTcnLA0KICAgIHlvcGY6ICdcdUQ4MzVcdURENkEnLA0KICAgIHlzY3I6ICdcdUQ4MzVcdURDQ0UnLA0KICAgIHl1Y3k6ICdcdTA0NEUnLA0KICAgIHl1bWw6ICdcdTAwRkYnLA0KICAgIHphY3V0ZTogJ1x1MDE3QScsDQogICAgemNhcm9uOiAnXHUwMTdFJywNCiAgICB6Y3k6ICdcdTA0MzcnLA0KICAgIHpkb3Q6ICdcdTAxN0MnLA0KICAgIHplZXRyZjogJ1x1MjEyOCcsDQogICAgemV0YTogJ1x1MDNCNicsDQogICAgemZyOiAnXHVEODM1XHVERDM3JywNCiAgICB6aGN5OiAnXHUwNDM2JywNCiAgICB6aWdyYXJyOiAnXHUyMUREJywNCiAgICB6b3BmOiAnXHVEODM1XHVERDZCJywNCiAgICB6c2NyOiAnXHVEODM1XHVEQ0NGJywNCiAgICB6d2o6ICdcdTIwMEQnLA0KICAgIHp3bmo6ICdcdTIwMEMnDQp9Ow0KY29uc3QgZGVjb2RlTWFwID0gew0KICAgICcwJzogNjU1MzMsDQogICAgJzEyOCc6IDgzNjQsDQogICAgJzEzMCc6IDgyMTgsDQogICAgJzEzMSc6IDQwMiwNCiAgICAnMTMyJzogODIyMiwNCiAgICAnMTMzJzogODIzMCwNCiAgICAnMTM0JzogODIyNCwNCiAgICAnMTM1JzogODIyNSwNCiAgICAnMTM2JzogNzEwLA0KICAgICcxMzcnOiA4MjQwLA0KICAgICcxMzgnOiAzNTIsDQogICAgJzEzOSc6IDgyNDksDQogICAgJzE0MCc6IDMzOCwNCiAgICAnMTQyJzogMzgxLA0KICAgICcxNDUnOiA4MjE2LA0KICAgICcxNDYnOiA4MjE3LA0KICAgICcxNDcnOiA4MjIwLA0KICAgICcxNDgnOiA4MjIxLA0KICAgICcxNDknOiA4MjI2LA0KICAgICcxNTAnOiA4MjExLA0KICAgICcxNTEnOiA4MjEyLA0KICAgICcxNTInOiA3MzIsDQogICAgJzE1Myc6IDg0ODIsDQogICAgJzE1NCc6IDM1MywNCiAgICAnMTU1JzogODI1MCwNCiAgICAnMTU2JzogMzM5LA0KICAgICcxNTgnOiAzODIsDQogICAgJzE1OSc6IDM3Ng0KfTsNCmZ1bmN0aW9uIGRlY29kZUhUTUxTdHJpY3QodGV4dCkgew0KICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoLyYoPzpbYS16QS1aXSt8I1t4WF1bXGRhLWZBLUZdK3wjXGQrKTsvZywgKGtleSkgPT4gew0KICAgICAgICBpZiAoa2V5LmNoYXJBdCgxKSA9PT0gJyMnKSB7DQogICAgICAgICAgICBjb25zdCBzZWNvbmRDaGFyID0ga2V5LmNoYXJBdCgyKTsNCiAgICAgICAgICAgIGNvbnN0IGNvZGVQb2ludCA9IHNlY29uZENoYXIgPT09ICdYJyB8fCBzZWNvbmRDaGFyID09PSAneCcNCiAgICAgICAgICAgICAgICA/IHBhcnNlSW50KGtleS5zbGljZSgzKSwgMTYpDQogICAgICAgICAgICAgICAgOiBwYXJzZUludChrZXkuc2xpY2UoMiksIDEwKTsNCiAgICAgICAgICAgIHJldHVybiBkZWNvZGVDb2RlUG9pbnQoY29kZVBvaW50KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZW50aXRpZXNba2V5LnNsaWNlKDEsIC0xKV0gfHwga2V5Ow0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gZGVjb2RlQ29kZVBvaW50KGNvZGVQb2ludCkgew0KICAgIGlmICgoY29kZVBvaW50ID49IDB4ZDgwMCAmJiBjb2RlUG9pbnQgPD0gMHhkZmZmKSB8fCBjb2RlUG9pbnQgPiAweDEwZmZmZikgew0KICAgICAgICByZXR1cm4gJ1x1RkZGRCc7DQogICAgfQ0KICAgIGlmIChjb2RlUG9pbnQgaW4gZGVjb2RlTWFwKSB7DQogICAgICAgIGNvZGVQb2ludCA9IGRlY29kZU1hcFtjb2RlUG9pbnRdOw0KICAgIH0NCiAgICByZXR1cm4gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZVBvaW50KTsNCn0KCmZ1bmN0aW9uIHNjYW5KU1hBdHRyaWJ1dGVWYWx1ZShwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBwYXJzZXIuc3RhcnRQb3MgPSBwYXJzZXIudG9rZW5Qb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgcGFyc2VyLnN0YXJ0Q29sdW1uID0gcGFyc2VyLmNvbFBvcyA9IHBhcnNlci5jb2x1bW47DQogICAgcGFyc2VyLnN0YXJ0TGluZSA9IHBhcnNlci5saW5lUG9zID0gcGFyc2VyLmxpbmU7DQogICAgcGFyc2VyLnRva2VuID0NCiAgICAgICAgQ2hhclR5cGVzW3BhcnNlci5jdXJyZW50Q2hhcl0gJiA4MTkyDQogICAgICAgICAgICA/IHNjYW5KU1hTdHJpbmcocGFyc2VyLCBjb250ZXh0KQ0KICAgICAgICAgICAgOiBzY2FuU2luZ2xlVG9rZW4ocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICByZXR1cm4gcGFyc2VyLnRva2VuOw0KfQ0KZnVuY3Rpb24gc2NhbkpTWFN0cmluZyhwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCBxdW90ZSA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICBsZXQgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgd2hpbGUgKGNoYXIgIT09IHF1b3RlKSB7DQogICAgICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0KTsNCiAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgfQ0KICAgIGlmIChjaGFyICE9PSBxdW90ZSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQpOw0KICAgIHBhcnNlci50b2tlblZhbHVlID0gcGFyc2VyLnNvdXJjZS5zbGljZShzdGFydCwgcGFyc2VyLmluZGV4KTsNCiAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgIGlmIChjb250ZXh0ICYgNTEyKQ0KICAgICAgICBwYXJzZXIudG9rZW5SYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICByZXR1cm4gMTM0MjgzMjY3Ow0KfQ0KZnVuY3Rpb24gc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCkgew0KICAgIHBhcnNlci5zdGFydFBvcyA9IHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5pbmRleDsNCiAgICBwYXJzZXIuc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zID0gcGFyc2VyLmNvbHVtbjsNCiAgICBwYXJzZXIuc3RhcnRMaW5lID0gcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5lbmQpDQogICAgICAgIHJldHVybiAocGFyc2VyLnRva2VuID0gMTA0ODU3Nik7DQogICAgY29uc3QgdG9rZW4gPSBUb2tlbkxvb2t1cFtwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4KV07DQogICAgc3dpdGNoICh0b2tlbikgew0KICAgICAgICBjYXNlIDg0NTYyNTg6IHsNCiAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSA0Nykgew0KICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuID0gMjU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gPSA4NDU2MjU4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAyMTYyNzAwOiB7DQogICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgcGFyc2VyLnRva2VuID0gMjE2MjcwMDsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgIGxldCBzdGF0ZSA9IDA7DQogICAgICAgICAgICB3aGlsZSAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBDaGFyVHlwZXNbcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCldOw0KICAgICAgICAgICAgICAgIGlmICh0eXBlICYgMTAyNCkgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxIHwgNDsNCiAgICAgICAgICAgICAgICAgICAgc2Nhbk5ld0xpbmUocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSAmIDIwNDgpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZUxpbmVGZWVkKHBhcnNlciwgc3RhdGUpOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IChzdGF0ZSAmIH40KSB8IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoQ2hhclR5cGVzW3BhcnNlci5jdXJyZW50Q2hhcl0gJiAxNjM4NCkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCByYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICYgNTEyKQ0KICAgICAgICAgICAgICAgIHBhcnNlci50b2tlblJhdyA9IHJhdzsNCiAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlID0gZGVjb2RlSFRNTFN0cmljdChyYXcpOw0KICAgICAgICAgICAgcGFyc2VyLnRva2VuID0gMTM4Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwYXJzZXIudG9rZW47DQp9DQpmdW5jdGlvbiBzY2FuSlNYSWRlbnRpZmllcihwYXJzZXIpIHsNCiAgICBpZiAoKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgPT09IDE0MzM2MCkgew0KICAgICAgICBjb25zdCB7IGluZGV4IH0gPSBwYXJzZXI7DQogICAgICAgIGxldCBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICB3aGlsZSAoQ2hhclR5cGVzW2NoYXJdICYgKDMyNzY4IHwgMikpIHsNCiAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICB9DQogICAgICAgIHBhcnNlci50b2tlblZhbHVlICs9IHBhcnNlci5zb3VyY2Uuc2xpY2UoaW5kZXgsIHBhcnNlci5pbmRleCk7DQogICAgfQ0KICAgIHBhcnNlci50b2tlbiA9IDIwODg5NzsNCiAgICByZXR1cm4gcGFyc2VyLnRva2VuOw0KfQoKZnVuY3Rpb24gbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQsIHNwZWNEZXZpYXRpb24pIHsNCiAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEpID09PSAwICYmDQogICAgICAgIChwYXJzZXIudG9rZW4gJiAxMDQ4NTc2KSAhPT0gMTA0ODU3NiAmJg0KICAgICAgICAhc3BlY0RldmlhdGlvbikgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTcpOw0KfQ0KZnVuY3Rpb24gaXNWYWxpZFN0cmljdE1vZGUocGFyc2VyLCBpbmRleCwgdG9rZW5Qb3MsIHRva2VuVmFsdWUpIHsNCiAgICBpZiAoaW5kZXggLSB0b2tlblBvcyA8IDEzICYmIHRva2VuVmFsdWUgPT09ICd1c2Ugc3RyaWN0Jykgew0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDEwNDg1NzYpID09PSAxMDQ4NTc2IHx8IHBhcnNlci5mbGFncyAmIDEpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiAwOw0KfQ0KZnVuY3Rpb24gb3B0aW9uYWxCaXQocGFyc2VyLCBjb250ZXh0LCB0KSB7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gdCkNCiAgICAgICAgcmV0dXJuIDA7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcmV0dXJuIDE7DQp9DQpmdW5jdGlvbiBjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgdCkgew0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IHQpDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICByZXR1cm4gdHJ1ZTsNCn0NCmZ1bmN0aW9uIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCB0KSB7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gdCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMjMsIEtleXdvcmREZXNjVGFibGVbdCAmIDI1NV0pOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KfQ0KZnVuY3Rpb24gcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIG5vZGUpIHsNCiAgICBzd2l0Y2ggKG5vZGUudHlwZSkgew0KICAgICAgICBjYXNlICdBcnJheUV4cHJlc3Npb24nOg0KICAgICAgICAgICAgbm9kZS50eXBlID0gJ0FycmF5UGF0dGVybic7DQogICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IG5vZGUuZWxlbWVudHM7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IG47ICsraSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBlbGVtZW50c1tpXTsNCiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkNCiAgICAgICAgICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIGVsZW1lbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBjYXNlICdPYmplY3RFeHByZXNzaW9uJzoNCiAgICAgICAgICAgIG5vZGUudHlwZSA9ICdPYmplY3RQYXR0ZXJuJzsNCiAgICAgICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBub2RlLnByb3BlcnRpZXM7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbjsgKytpKSB7DQogICAgICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIHByb3BlcnRpZXNbaV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBjYXNlICdBc3NpZ25tZW50RXhwcmVzc2lvbic6DQogICAgICAgICAgICBub2RlLnR5cGUgPSAnQXNzaWdubWVudFBhdHRlcm4nOw0KICAgICAgICAgICAgaWYgKG5vZGUub3BlcmF0b3IgIT09ICc9JykNCiAgICAgICAgICAgICAgICByZXBvcnQoc3RhdGUsIDY5KTsNCiAgICAgICAgICAgIGRlbGV0ZSBub2RlLm9wZXJhdG9yOw0KICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIG5vZGUubGVmdCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIGNhc2UgJ1Byb3BlcnR5JzoNCiAgICAgICAgICAgIHJlaW50ZXJwcmV0VG9QYXR0ZXJuKHN0YXRlLCBub2RlLnZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgY2FzZSAnU3ByZWFkRWxlbWVudCc6DQogICAgICAgICAgICBub2RlLnR5cGUgPSAnUmVzdEVsZW1lbnQnOw0KICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIG5vZGUuYXJndW1lbnQpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHZhbGlkYXRlQmluZGluZ0lkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBraW5kLCB0LCBza2lwRXZhbEFyZ0NoZWNrKSB7DQogICAgaWYgKGNvbnRleHQgJiAxMDI0KSB7DQogICAgICAgIGlmICgodCAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFza2lwRXZhbEFyZ0NoZWNrICYmICh0ICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICgodCAmIDIwNDgwKSA9PT0gMjA0ODApIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTAwKTsNCiAgICB9DQogICAgaWYgKGtpbmQgJiAoOCB8IDE2KSAmJiB0ID09PSAyNDE3MzkpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTgpOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICg0MTk0MzA0IHwgMjA0OCkgJiYgdCA9PT0gMjA5MDA4KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk2KTsNCiAgICB9DQogICAgaWYgKGNvbnRleHQgJiAoMjA5NzE1MiB8IDEwMjQpICYmIHQgPT09IDI0MTc3Mykgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA5NSwgJ3lpZWxkJyk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmFsaWRhdGVGdW5jdGlvbk5hbWUocGFyc2VyLCBjb250ZXh0LCB0KSB7DQogICAgaWYgKGNvbnRleHQgJiAxMDI0KSB7DQogICAgICAgIGlmICgodCAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCh0ICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0ID09PSAxMjIpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDkzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodCA9PT0gMTIxKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA5Myk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCh0ICYgMjA0ODApID09PSAyMDQ4MCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMDApOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICg0MTk0MzA0IHwgMjA0OCkgJiYgdCA9PT0gMjA5MDA4KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk2KTsNCiAgICB9DQogICAgaWYgKGNvbnRleHQgJiAoMjA5NzE1MiB8IDEwMjQpICYmIHQgPT09IDI0MTc3Mykgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA5NSwgJ3lpZWxkJyk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gaXNTdHJpY3RSZXNlcnZlZFdvcmQocGFyc2VyLCBjb250ZXh0LCB0KSB7DQogICAgaWYgKHQgPT09IDIwOTAwOCkgew0KICAgICAgICBpZiAoY29udGV4dCAmICg0MTk0MzA0IHwgMjA0OCkpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA5Nik7DQogICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgfD0gMTI4Ow0KICAgIH0NCiAgICBpZiAodCA9PT0gMjQxNzczICYmIGNvbnRleHQgJiAyMDk3MTUyKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA5NSwgJ3lpZWxkJyk7DQogICAgcmV0dXJuICgodCAmIDIwNDgwKSA9PT0gMjA0ODAgfHwNCiAgICAgICAgKHQgJiAzNjg2NCkgPT09IDM2ODY0IHx8DQogICAgICAgIHQgPT0gMTIyKTsNCn0NCmZ1bmN0aW9uIGlzUHJvcGVydHlXaXRoUHJpdmF0ZUZpZWxkS2V5KGV4cHIpIHsNCiAgICByZXR1cm4gIWV4cHIucHJvcGVydHkgPyBmYWxzZSA6IGV4cHIucHJvcGVydHkudHlwZSA9PT0gJ1ByaXZhdGVJZGVudGlmaWVyJzsNCn0NCmZ1bmN0aW9uIGlzVmFsaWRMYWJlbChwYXJzZXIsIGxhYmVscywgbmFtZSwgaXNJdGVyYXRpb25TdGF0ZW1lbnQpIHsNCiAgICB3aGlsZSAobGFiZWxzKSB7DQogICAgICAgIGlmIChsYWJlbHNbJyQnICsgbmFtZV0pIHsNCiAgICAgICAgICAgIGlmIChpc0l0ZXJhdGlvblN0YXRlbWVudCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzQpOw0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzSXRlcmF0aW9uU3RhdGVtZW50ICYmIGxhYmVscy5sb29wKQ0KICAgICAgICAgICAgaXNJdGVyYXRpb25TdGF0ZW1lbnQgPSAwOw0KICAgICAgICBsYWJlbHMgPSBsYWJlbHNbJyQnXTsNCiAgICB9DQogICAgcmV0dXJuIDA7DQp9DQpmdW5jdGlvbiB2YWxpZGF0ZUFuZERlY2xhcmVMYWJlbChwYXJzZXIsIGxhYmVscywgbmFtZSkgew0KICAgIGxldCBzZXQgPSBsYWJlbHM7DQogICAgd2hpbGUgKHNldCkgew0KICAgICAgICBpZiAoc2V0WyckJyArIG5hbWVdKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTMzLCBuYW1lKTsNCiAgICAgICAgc2V0ID0gc2V0WyckJ107DQogICAgfQ0KICAgIGxhYmVsc1snJCcgKyBuYW1lXSA9IDE7DQp9DQpmdW5jdGlvbiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbm9kZSkgew0KICAgIGlmIChjb250ZXh0ICYgMikgew0KICAgICAgICBub2RlLnN0YXJ0ID0gc3RhcnQ7DQogICAgICAgIG5vZGUuZW5kID0gcGFyc2VyLnN0YXJ0UG9zOw0KICAgICAgICBub2RlLnJhbmdlID0gW3N0YXJ0LCBwYXJzZXIuc3RhcnRQb3NdOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmIDQpIHsNCiAgICAgICAgbm9kZS5sb2MgPSB7DQogICAgICAgICAgICBzdGFydDogew0KICAgICAgICAgICAgICAgIGxpbmUsDQogICAgICAgICAgICAgICAgY29sdW1uDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZW5kOiB7DQogICAgICAgICAgICAgICAgbGluZTogcGFyc2VyLnN0YXJ0TGluZSwNCiAgICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlci5zdGFydENvbHVtbg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBpZiAocGFyc2VyLnNvdXJjZUZpbGUpIHsNCiAgICAgICAgICAgIG5vZGUubG9jLnNvdXJjZSA9IHBhcnNlci5zb3VyY2VGaWxlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBub2RlOw0KfQ0KZnVuY3Rpb24gaXNFcXVhbFRhZ05hbWUoZWxlbWVudE5hbWUpIHsNCiAgICBzd2l0Y2ggKGVsZW1lbnROYW1lLnR5cGUpIHsNCiAgICAgICAgY2FzZSAnSlNYSWRlbnRpZmllcic6DQogICAgICAgICAgICByZXR1cm4gZWxlbWVudE5hbWUubmFtZTsNCiAgICAgICAgY2FzZSAnSlNYTmFtZXNwYWNlZE5hbWUnOg0KICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnROYW1lLm5hbWVzcGFjZSArICc6JyArIGVsZW1lbnROYW1lLm5hbWU7DQogICAgICAgIGNhc2UgJ0pTWE1lbWJlckV4cHJlc3Npb24nOg0KICAgICAgICAgICAgcmV0dXJuIGlzRXF1YWxUYWdOYW1lKGVsZW1lbnROYW1lLm9iamVjdCkgKyAnLicgKyBpc0VxdWFsVGFnTmFtZShlbGVtZW50TmFtZS5wcm9wZXJ0eSk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gY3JlYXRlQXJyb3dIZWFkUGFyc2luZ1Njb3BlKHBhcnNlciwgY29udGV4dCwgdmFsdWUpIHsNCiAgICBjb25zdCBzY29wZSA9IGFkZENoaWxkU2NvcGUoY3JlYXRlU2NvcGUoKSwgMTAyNCk7DQogICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHZhbHVlLCAxLCAwKTsNCiAgICByZXR1cm4gc2NvcGU7DQp9DQpmdW5jdGlvbiByZWNvcmRTY29wZUVycm9yKHBhcnNlciwgdHlwZSwgLi4ucGFyYW1zKSB7DQogICAgY29uc3QgeyBpbmRleCwgbGluZSwgY29sdW1uIH0gPSBwYXJzZXI7DQogICAgcmV0dXJuIHsNCiAgICAgICAgdHlwZSwNCiAgICAgICAgcGFyYW1zLA0KICAgICAgICBpbmRleCwNCiAgICAgICAgbGluZSwNCiAgICAgICAgY29sdW1uDQogICAgfTsNCn0NCmZ1bmN0aW9uIGNyZWF0ZVNjb3BlKCkgew0KICAgIHJldHVybiB7DQogICAgICAgIHBhcmVudDogdm9pZCAwLA0KICAgICAgICB0eXBlOiAyDQogICAgfTsNCn0NCmZ1bmN0aW9uIGFkZENoaWxkU2NvcGUocGFyZW50LCB0eXBlKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgcGFyZW50LA0KICAgICAgICB0eXBlLA0KICAgICAgICBzY29wZUVycm9yOiB2b2lkIDANCiAgICB9Ow0KfQ0KZnVuY3Rpb24gYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBuYW1lLCBraW5kLCBvcmlnaW4pIHsNCiAgICBpZiAoa2luZCAmIDQpIHsNCiAgICAgICAgYWRkVmFyTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBuYW1lLCBraW5kKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBuYW1lLCBraW5kLCBvcmlnaW4pOw0KICAgIH0NCiAgICBpZiAob3JpZ2luICYgNjQpIHsNCiAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIG5hbWUpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBuYW1lLCBraW5kLCBvcmlnaW4pIHsNCiAgICBjb25zdCB2YWx1ZSA9IHNjb3BlWycjJyArIG5hbWVdOw0KICAgIGlmICh2YWx1ZSAmJiAodmFsdWUgJiAyKSA9PT0gMCkgew0KICAgICAgICBpZiAoa2luZCAmIDEpIHsNCiAgICAgICAgICAgIHNjb3BlLnNjb3BlRXJyb3IgPSByZWNvcmRTY29wZUVycm9yKHBhcnNlciwgMTQxLCBuYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChjb250ZXh0ICYgMjU2ICYmDQogICAgICAgICAgICB2YWx1ZSAmIDY0ICYmDQogICAgICAgICAgICBvcmlnaW4gJiAyKSA7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQxLCBuYW1lKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoc2NvcGUudHlwZSAmIDEyOCAmJg0KICAgICAgICAoc2NvcGUucGFyZW50WycjJyArIG5hbWVdICYmIChzY29wZS5wYXJlbnRbJyMnICsgbmFtZV0gJiAyKSA9PT0gMCkpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQxLCBuYW1lKTsNCiAgICB9DQogICAgaWYgKHNjb3BlLnR5cGUgJiAxMDI0ICYmIHZhbHVlICYmICh2YWx1ZSAmIDIpID09PSAwKSB7DQogICAgICAgIGlmIChraW5kICYgMSkgew0KICAgICAgICAgICAgc2NvcGUuc2NvcGVFcnJvciA9IHJlY29yZFNjb3BlRXJyb3IocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChzY29wZS50eXBlICYgNjQpIHsNCiAgICAgICAgaWYgKHNjb3BlLnBhcmVudFsnIycgKyBuYW1lXSAmIDc2OCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1NCwgbmFtZSk7DQogICAgfQ0KICAgIHNjb3BlWycjJyArIG5hbWVdID0ga2luZDsNCn0NCmZ1bmN0aW9uIGFkZFZhck5hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbmFtZSwga2luZCkgew0KICAgIGxldCBjdXJyZW50U2NvcGUgPSBzY29wZTsNCiAgICB3aGlsZSAoY3VycmVudFNjb3BlICYmIChjdXJyZW50U2NvcGUudHlwZSAmIDI1NikgPT09IDApIHsNCiAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJyZW50U2NvcGVbJyMnICsgbmFtZV07DQogICAgICAgIGlmICh2YWx1ZSAmIDI0OCkgew0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAyNTYgJiYNCiAgICAgICAgICAgICAgICAoY29udGV4dCAmIDEwMjQpID09PSAwICYmDQogICAgICAgICAgICAgICAgKChraW5kICYgMTI4ICYmIHZhbHVlICYgNjgpIHx8DQogICAgICAgICAgICAgICAgICAgICh2YWx1ZSAmIDEyOCAmJiBraW5kICYgNjgpKSkgOw0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQxLCBuYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoY3VycmVudFNjb3BlID09PSBzY29wZSkgew0KICAgICAgICAgICAgaWYgKHZhbHVlICYgMSAmJiBraW5kICYgMSkgew0KICAgICAgICAgICAgICAgIGN1cnJlbnRTY29wZS5zY29wZUVycm9yID0gcmVjb3JkU2NvcGVFcnJvcihwYXJzZXIsIDE0MSwgbmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKHZhbHVlICYgKDUxMiB8IDI1NikpIHsNCiAgICAgICAgICAgIGlmICgodmFsdWUgJiA1MTIpID09PSAwIHx8DQogICAgICAgICAgICAgICAgKGNvbnRleHQgJiAyNTYpID09PSAwIHx8DQogICAgICAgICAgICAgICAgY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGN1cnJlbnRTY29wZVsnIycgKyBuYW1lXSA9IGtpbmQ7DQogICAgICAgIGN1cnJlbnRTY29wZSA9IGN1cnJlbnRTY29wZS5wYXJlbnQ7DQogICAgfQ0KfQ0KZnVuY3Rpb24gZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIG5hbWUpIHsNCiAgICBpZiAocGFyc2VyLmV4cG9ydGVkTmFtZXMgIT09IHZvaWQgMCAmJiBuYW1lICE9PSAnJykgew0KICAgICAgICBpZiAocGFyc2VyLmV4cG9ydGVkTmFtZXNbJyMnICsgbmFtZV0pIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0MiwgbmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VyLmV4cG9ydGVkTmFtZXNbJyMnICsgbmFtZV0gPSAxOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGFkZEJpbmRpbmdUb0V4cG9ydHMocGFyc2VyLCBuYW1lKSB7DQogICAgaWYgKHBhcnNlci5leHBvcnRlZEJpbmRpbmdzICE9PSB2b2lkIDAgJiYgbmFtZSAhPT0gJycpIHsNCiAgICAgICAgcGFyc2VyLmV4cG9ydGVkQmluZGluZ3NbJyMnICsgbmFtZV0gPSAxOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHB1c2hDb21tZW50KGNvbnRleHQsIGFycmF5KSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uICh0eXBlLCB2YWx1ZSwgc3RhcnQsIGVuZCwgbG9jKSB7DQogICAgICAgIGNvbnN0IGNvbW1lbnQgPSB7DQogICAgICAgICAgICB0eXBlLA0KICAgICAgICAgICAgdmFsdWUNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKGNvbnRleHQgJiAyKSB7DQogICAgICAgICAgICBjb21tZW50LnN0YXJ0ID0gc3RhcnQ7DQogICAgICAgICAgICBjb21tZW50LmVuZCA9IGVuZDsNCiAgICAgICAgICAgIGNvbW1lbnQucmFuZ2UgPSBbc3RhcnQsIGVuZF07DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbnRleHQgJiA0KSB7DQogICAgICAgICAgICBjb21tZW50LmxvYyA9IGxvYzsNCiAgICAgICAgfQ0KICAgICAgICBhcnJheS5wdXNoKGNvbW1lbnQpOw0KICAgIH07DQp9DQpmdW5jdGlvbiBwdXNoVG9rZW4oY29udGV4dCwgYXJyYXkpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHRva2VuLCBzdGFydCwgZW5kLCBsb2MpIHsNCiAgICAgICAgY29uc3QgdG9rZW5zID0gew0KICAgICAgICAgICAgdG9rZW4NCiAgICAgICAgfTsNCiAgICAgICAgaWYgKGNvbnRleHQgJiAyKSB7DQogICAgICAgICAgICB0b2tlbnMuc3RhcnQgPSBzdGFydDsNCiAgICAgICAgICAgIHRva2Vucy5lbmQgPSBlbmQ7DQogICAgICAgICAgICB0b2tlbnMucmFuZ2UgPSBbc3RhcnQsIGVuZF07DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbnRleHQgJiA0KSB7DQogICAgICAgICAgICB0b2tlbnMubG9jID0gbG9jOw0KICAgICAgICB9DQogICAgICAgIGFycmF5LnB1c2godG9rZW5zKTsNCiAgICB9Ow0KfQ0KZnVuY3Rpb24gaXNWYWxpZElkZW50aWZpZXIoY29udGV4dCwgdCkgew0KICAgIGlmIChjb250ZXh0ICYgKDEwMjQgfCAyMDk3MTUyKSkgew0KICAgICAgICBpZiAoY29udGV4dCAmIDIwNDggJiYgdCA9PT0gMjA5MDA4KQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZiAoY29udGV4dCAmIDIwOTcxNTIgJiYgdCA9PT0gMjQxNzczKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICByZXR1cm4gKHQgJiAxNDMzNjApID09PSAxNDMzNjAgfHwgKHQgJiAxMjI4OCkgPT09IDEyMjg4Ow0KICAgIH0NCiAgICByZXR1cm4gKCh0ICYgMTQzMzYwKSA9PT0gMTQzMzYwIHx8DQogICAgICAgICh0ICYgMTIyODgpID09PSAxMjI4OCB8fA0KICAgICAgICAodCAmIDM2ODY0KSA9PT0gMzY4NjQpOw0KfQ0KZnVuY3Rpb24gY2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgdCwgaXNBcnJvdykgew0KICAgIGlmICgodCAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICBpZiAoaXNBcnJvdykNCiAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSA1MTI7DQogICAgfQ0KICAgIGlmICghaXNWYWxpZElkZW50aWZpZXIoY29udGV4dCwgdCkpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KfQoKZnVuY3Rpb24gY3JlYXRlKHNvdXJjZSwgc291cmNlRmlsZSwgb25Db21tZW50LCBvblRva2VuKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgc291cmNlLA0KICAgICAgICBmbGFnczogMCwNCiAgICAgICAgaW5kZXg6IDAsDQogICAgICAgIGxpbmU6IDEsDQogICAgICAgIGNvbHVtbjogMCwNCiAgICAgICAgc3RhcnRQb3M6IDAsDQogICAgICAgIGVuZDogc291cmNlLmxlbmd0aCwNCiAgICAgICAgdG9rZW5Qb3M6IDAsDQogICAgICAgIHN0YXJ0Q29sdW1uOiAwLA0KICAgICAgICBjb2xQb3M6IDAsDQogICAgICAgIGxpbmVQb3M6IDEsDQogICAgICAgIHN0YXJ0TGluZTogMSwNCiAgICAgICAgc291cmNlRmlsZSwNCiAgICAgICAgdG9rZW5WYWx1ZTogJycsDQogICAgICAgIHRva2VuOiAxMDQ4NTc2LA0KICAgICAgICB0b2tlblJhdzogJycsDQogICAgICAgIHRva2VuUmVnRXhwOiB2b2lkIDAsDQogICAgICAgIGN1cnJlbnRDaGFyOiBzb3VyY2UuY2hhckNvZGVBdCgwKSwNCiAgICAgICAgZXhwb3J0ZWROYW1lczogW10sDQogICAgICAgIGV4cG9ydGVkQmluZGluZ3M6IFtdLA0KICAgICAgICBhc3NpZ25hYmxlOiAxLA0KICAgICAgICBkZXN0cnVjdGlibGU6IDAsDQogICAgICAgIG9uQ29tbWVudCwNCiAgICAgICAgb25Ub2tlbiwNCiAgICAgICAgbGVhZGluZ0RlY29yYXRvcnM6IFtdDQogICAgfTsNCn0NCmZ1bmN0aW9uIHBhcnNlU291cmNlKHNvdXJjZSwgb3B0aW9ucywgY29udGV4dCkgew0KICAgIGxldCBzb3VyY2VGaWxlID0gJyc7DQogICAgbGV0IG9uQ29tbWVudDsNCiAgICBsZXQgb25Ub2tlbjsNCiAgICBpZiAob3B0aW9ucyAhPSBudWxsKSB7DQogICAgICAgIGlmIChvcHRpb25zLm1vZHVsZSkNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMjA0OCB8IDEwMjQ7DQogICAgICAgIGlmIChvcHRpb25zLm5leHQpDQogICAgICAgICAgICBjb250ZXh0IHw9IDE7DQogICAgICAgIGlmIChvcHRpb25zLmxvYykNCiAgICAgICAgICAgIGNvbnRleHQgfD0gNDsNCiAgICAgICAgaWYgKG9wdGlvbnMucmFuZ2VzKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAyOw0KICAgICAgICBpZiAob3B0aW9ucy51bmlxdWVLZXlJblBhdHRlcm4pDQogICAgICAgICAgICBjb250ZXh0IHw9IC0yMTQ3NDgzNjQ4Ow0KICAgICAgICBpZiAob3B0aW9ucy5sZXhpY2FsKQ0KICAgICAgICAgICAgY29udGV4dCB8PSA2NDsNCiAgICAgICAgaWYgKG9wdGlvbnMud2ViY29tcGF0KQ0KICAgICAgICAgICAgY29udGV4dCB8PSAyNTY7DQogICAgICAgIGlmIChvcHRpb25zLmRpcmVjdGl2ZXMpDQogICAgICAgICAgICBjb250ZXh0IHw9IDggfCA1MTI7DQogICAgICAgIGlmIChvcHRpb25zLmdsb2JhbFJldHVybikNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMzI7DQogICAgICAgIGlmIChvcHRpb25zLnJhdykNCiAgICAgICAgICAgIGNvbnRleHQgfD0gNTEyOw0KICAgICAgICBpZiAob3B0aW9ucy5wcmVzZXJ2ZVBhcmVucykNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMTI4Ow0KICAgICAgICBpZiAob3B0aW9ucy5pbXBsaWVkU3RyaWN0KQ0KICAgICAgICAgICAgY29udGV4dCB8PSAxMDI0Ow0KICAgICAgICBpZiAob3B0aW9ucy5qc3gpDQogICAgICAgICAgICBjb250ZXh0IHw9IDE2Ow0KICAgICAgICBpZiAob3B0aW9ucy5pZGVudGlmaWVyUGF0dGVybikNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMjY4NDM1NDU2Ow0KICAgICAgICBpZiAob3B0aW9ucy5zcGVjRGV2aWF0aW9uKQ0KICAgICAgICAgICAgY29udGV4dCB8PSA1MzY4NzA5MTI7DQogICAgICAgIGlmIChvcHRpb25zLnNvdXJjZSkNCiAgICAgICAgICAgIHNvdXJjZUZpbGUgPSBvcHRpb25zLnNvdXJjZTsNCiAgICAgICAgaWYgKG9wdGlvbnMub25Db21tZW50ICE9IG51bGwpIHsNCiAgICAgICAgICAgIG9uQ29tbWVudCA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5vbkNvbW1lbnQpID8gcHVzaENvbW1lbnQoY29udGV4dCwgb3B0aW9ucy5vbkNvbW1lbnQpIDogb3B0aW9ucy5vbkNvbW1lbnQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9wdGlvbnMub25Ub2tlbiAhPSBudWxsKSB7DQogICAgICAgICAgICBvblRva2VuID0gQXJyYXkuaXNBcnJheShvcHRpb25zLm9uVG9rZW4pID8gcHVzaFRva2VuKGNvbnRleHQsIG9wdGlvbnMub25Ub2tlbikgOiBvcHRpb25zLm9uVG9rZW47DQogICAgICAgIH0NCiAgICB9DQogICAgY29uc3QgcGFyc2VyID0gY3JlYXRlKHNvdXJjZSwgc291cmNlRmlsZSwgb25Db21tZW50LCBvblRva2VuKTsNCiAgICBpZiAoY29udGV4dCAmIDEpDQogICAgICAgIHNraXBIYXNoQmFuZyhwYXJzZXIpOw0KICAgIGNvbnN0IHNjb3BlID0gY29udGV4dCAmIDY0ID8gY3JlYXRlU2NvcGUoKSA6IHZvaWQgMDsNCiAgICBsZXQgYm9keSA9IFtdOw0KICAgIGxldCBzb3VyY2VUeXBlID0gJ3NjcmlwdCc7DQogICAgaWYgKGNvbnRleHQgJiAyMDQ4KSB7DQogICAgICAgIHNvdXJjZVR5cGUgPSAnbW9kdWxlJzsNCiAgICAgICAgYm9keSA9IHBhcnNlTW9kdWxlSXRlbUxpc3QocGFyc2VyLCBjb250ZXh0IHwgODE5Miwgc2NvcGUpOw0KICAgICAgICBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHBhcnNlci5leHBvcnRlZEJpbmRpbmdzKSB7DQogICAgICAgICAgICAgICAgaWYgKGtleVswXSA9PT0gJyMnICYmICFzY29wZVtrZXldKQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDMsIGtleS5zbGljZSgxKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGJvZHkgPSBwYXJzZVN0YXRlbWVudExpc3QocGFyc2VyLCBjb250ZXh0IHwgODE5Miwgc2NvcGUpOw0KICAgIH0NCiAgICBjb25zdCBub2RlID0gew0KICAgICAgICB0eXBlOiAnUHJvZ3JhbScsDQogICAgICAgIHNvdXJjZVR5cGUsDQogICAgICAgIGJvZHkNCiAgICB9Ow0KICAgIGlmIChjb250ZXh0ICYgMikgew0KICAgICAgICBub2RlLnN0YXJ0ID0gMDsNCiAgICAgICAgbm9kZS5lbmQgPSBzb3VyY2UubGVuZ3RoOw0KICAgICAgICBub2RlLnJhbmdlID0gWzAsIHNvdXJjZS5sZW5ndGhdOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmIDQpIHsNCiAgICAgICAgbm9kZS5sb2MgPSB7DQogICAgICAgICAgICBzdGFydDogeyBsaW5lOiAxLCBjb2x1bW46IDAgfSwNCiAgICAgICAgICAgIGVuZDogeyBsaW5lOiBwYXJzZXIubGluZSwgY29sdW1uOiBwYXJzZXIuY29sdW1uIH0NCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHBhcnNlci5zb3VyY2VGaWxlKQ0KICAgICAgICAgICAgbm9kZS5sb2Muc291cmNlID0gc291cmNlRmlsZTsNCiAgICB9DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiBwYXJzZVN0YXRlbWVudExpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSkgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCB8IDEwNzM3NDE4MjQpOw0KICAgIGNvbnN0IHN0YXRlbWVudHMgPSBbXTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuID09PSAxMzQyODMyNjcpIHsNCiAgICAgICAgY29uc3QgeyBpbmRleCwgdG9rZW5Qb3MsIHRva2VuVmFsdWUsIGxpbmVQb3MsIGNvbFBvcywgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICAgICAgY29uc3QgZXhwciA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICBpZiAoaXNWYWxpZFN0cmljdE1vZGUocGFyc2VyLCBpbmRleCwgdG9rZW5Qb3MsIHRva2VuVmFsdWUpKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAxMDI0Ow0KICAgICAgICBzdGF0ZW1lbnRzLnB1c2gocGFyc2VEaXJlY3RpdmUocGFyc2VyLCBjb250ZXh0LCBleHByLCB0b2tlbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykpOw0KICAgIH0NCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxMDQ4NTc2KSB7DQogICAgICAgIHN0YXRlbWVudHMucHVzaChwYXJzZVN0YXRlbWVudExpc3RJdGVtKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIHt9KSk7DQogICAgfQ0KICAgIHJldHVybiBzdGF0ZW1lbnRzOw0KfQ0KZnVuY3Rpb24gcGFyc2VNb2R1bGVJdGVtTGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBzdGF0ZW1lbnRzID0gW107DQogICAgaWYgKGNvbnRleHQgJiA4KSB7DQogICAgICAgIHdoaWxlIChwYXJzZXIudG9rZW4gPT09IDEzNDI4MzI2Nykgew0KICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB0b2tlbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgc3RhdGVtZW50cy5wdXNoKHBhcnNlRGlyZWN0aXZlKHBhcnNlciwgY29udGV4dCwgcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCksIHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTA0ODU3Nikgew0KICAgICAgICBzdGF0ZW1lbnRzLnB1c2gocGFyc2VNb2R1bGVJdGVtKHBhcnNlciwgY29udGV4dCwgc2NvcGUpKTsNCiAgICB9DQogICAgcmV0dXJuIHN0YXRlbWVudHM7DQp9DQpmdW5jdGlvbiBwYXJzZU1vZHVsZUl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSkgew0KICAgIHBhcnNlci5sZWFkaW5nRGVjb3JhdG9ycyA9IHBhcnNlRGVjb3JhdG9ycyhwYXJzZXIsIGNvbnRleHQpOw0KICAgIGxldCBtb2R1bGVJdGVtOw0KICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgIGNhc2UgMjA1NjY6DQogICAgICAgICAgICBtb2R1bGVJdGVtID0gcGFyc2VFeHBvcnREZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDg2MTA4Og0KICAgICAgICAgICAgbW9kdWxlSXRlbSA9IHBhcnNlSW1wb3J0RGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIG1vZHVsZUl0ZW0gPSBwYXJzZVN0YXRlbWVudExpc3RJdGVtKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIHt9KTsNCiAgICB9DQogICAgaWYgKHBhcnNlci5sZWFkaW5nRGVjb3JhdG9ycy5sZW5ndGgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTY1KTsNCiAgICB9DQogICAgcmV0dXJuIG1vZHVsZUl0ZW07DQp9DQpmdW5jdGlvbiBwYXJzZVN0YXRlbWVudExpc3RJdGVtKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzKSB7DQogICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgY29uc3QgbGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgIGNvbnN0IGNvbHVtbiA9IHBhcnNlci5jb2xQb3M7DQogICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgY2FzZSA4NjEwNjoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCAxLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAxMzM6DQogICAgICAgIGNhc2UgODYwOTY6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VDbGFzc0RlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg2MDkyOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlTGV4aWNhbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyNDE3Mzk6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VMZXRJZGVudE9yVmFyRGVjbGFyYXRpb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU2NjoNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwMSwgJ2V4cG9ydCcpOw0KICAgICAgICBjYXNlIDg2MTA4Og0KICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgICAgIGNhc2UgNjcxNzQ0MTE6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUltcG9ydENhbGxEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIGNhc2UgNjcxMDg4Nzc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUltcG9ydE1ldGFEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwMSwgJ2ltcG9ydCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBjYXNlIDIwOTAwNzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUFzeW5jQXJyb3dPckFzeW5jRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHBhcnNlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzLCBhbGxvd0Z1bmNEZWNsLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgY2FzZSA4NjA5MDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVZhcmlhYmxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTc0Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlUmV0dXJuU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1NzE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VJZlN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTY5Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRm9yU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1NjQ6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VEb1doaWxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1ODA6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VXaGlsZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg2MTEyOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlU3dpdGNoU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMTA3NDc5MDQxNzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUVtcHR5U3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUgPyBhZGRDaGlsZFNjb3BlKHNjb3BlLCAyKSA6IHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg2MTE0Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGhyb3dTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU1NzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUJyZWFrU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU2MToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUNvbnRpbnVlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU3OToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVRyeVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTgxOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlV2l0aFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTYyOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRGVidWdnZXJTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDkwMDc6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VBc3luY0Fycm93T3JBc3luY0Z1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTU5Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTU3KTsNCiAgICAgICAgY2FzZSAyMDU2ODoNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1OCk7DQogICAgICAgIGNhc2UgODYxMDY6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCBjb250ZXh0ICYgMTAyNA0KICAgICAgICAgICAgICAgID8gNzQNCiAgICAgICAgICAgICAgICA6IChjb250ZXh0ICYgMjU2KSA9PT0gMA0KICAgICAgICAgICAgICAgICAgICA/IDc2DQogICAgICAgICAgICAgICAgICAgIDogNzUpOw0KICAgICAgICBjYXNlIDg2MDk2Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNzcpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRXhwcmVzc2lvbk9yTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIGFsbG93RnVuY0RlY2wsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbk9yTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIGFsbG93RnVuY0RlY2wsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuIH0gPSBwYXJzZXI7DQogICAgbGV0IGV4cHI7DQogICAgc3dpdGNoICh0b2tlbikgew0KICAgICAgICBjYXNlIDI0MTczOToNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA4Myk7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA4Mik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMiwgMCwgMSwgMCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgfQ0KICAgIGlmICh0b2tlbiAmIDE0MzM2MCAmJiBwYXJzZXIudG9rZW4gPT09IDIxKSB7DQogICAgICAgIHJldHVybiBwYXJzZUxhYmVsbGVkU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzLCB0b2tlblZhbHVlLCBleHByLCB0b2tlbiwgYWxsb3dGdW5jRGVjbCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGV4cHIgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgZXhwciA9IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQogICAgfQ0KICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgYm9keSA9IFtdOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIxNjI3MDApOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgYm9keS5wdXNoKHBhcnNlU3RhdGVtZW50TGlzdEl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMiwgeyAkOiBsYWJlbHMgfSkpOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMDc0NzkwNDE1KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0Jsb2NrU3RhdGVtZW50JywNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VSZXR1cm5TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChjb250ZXh0ICYgMzIpID09PSAwICYmIGNvbnRleHQgJiA4MTkyKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA5MCk7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBhcmd1bWVudCA9IHBhcnNlci5mbGFncyAmIDEgfHwgcGFyc2VyLnRva2VuICYgMTA0ODU3Ng0KICAgICAgICA/IG51bGwNCiAgICAgICAgOiBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdSZXR1cm5TdGF0ZW1lbnQnLA0KICAgICAgICBhcmd1bWVudA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgZXhwcmVzc2lvbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRXhwcmVzc2lvblN0YXRlbWVudCcsDQogICAgICAgIGV4cHJlc3Npb24NCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIHZhbHVlLCBleHByLCB0b2tlbiwgYWxsb3dGdW5jRGVjbCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIHZhbGlkYXRlQmluZGluZ0lkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwLCB0b2tlbiwgMSk7DQogICAgdmFsaWRhdGVBbmREZWNsYXJlTGFiZWwocGFyc2VyLCBsYWJlbHMsIHZhbHVlKTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGJvZHkgPSBhbGxvd0Z1bmNEZWNsICYmDQogICAgICAgIChjb250ZXh0ICYgMTAyNCkgPT09IDAgJiYNCiAgICAgICAgY29udGV4dCAmIDI1NiAmJg0KICAgICAgICBwYXJzZXIudG9rZW4gPT09IDg2MTA2DQogICAgICAgID8gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgYWRkQ2hpbGRTY29wZShzY29wZSwgMiksIG9yaWdpbiwgMCwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykNCiAgICAgICAgOiBwYXJzZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgYWxsb3dGdW5jRGVjbCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdMYWJlbGVkU3RhdGVtZW50JywNCiAgICAgICAgbGFiZWw6IGV4cHIsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXN5bmNBcnJvd09yQXN5bmNGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzLCBhbGxvd0Z1bmNEZWNsLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyB0b2tlbiwgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIGxldCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjEpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIHRva2VuVmFsdWUsIGV4cHIsIHRva2VuLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgY29uc3QgYXN5bmNOZXdMaW5lID0gcGFyc2VyLmZsYWdzICYgMTsNCiAgICBpZiAoIWFzeW5jTmV3TGluZSkgew0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA4NjEwNikgew0KICAgICAgICAgICAgaWYgKCFhbGxvd0Z1bmNEZWNsKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyMCk7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgMSwgMCwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAxNDMzNjApID09PSAxNDMzNjApIHsNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZUFzeW5jQXJyb3dBZnRlcklkZW50KHBhcnNlciwgY29udGV4dCwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkNCiAgICAgICAgICAgICAgICBleHByID0gcGFyc2VTZXF1ZW5jZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICBleHByID0gcGFyc2VBc3luY0Fycm93T3JDYWxsRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDEsIDEsIDAsIGFzeW5jTmV3TGluZSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMCkgew0KICAgICAgICAgICAgY2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgdG9rZW4sIDEpOw0KICAgICAgICAgICAgZXhwciA9IHBhcnNlQXJyb3dGcm9tSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblZhbHVlLCBleHByLCAwLCAxLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgfQ0KICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KQ0KICAgICAgICBleHByID0gcGFyc2VTZXF1ZW5jZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICBleHByID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICByZXR1cm4gcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZURpcmVjdGl2ZShwYXJzZXIsIGNvbnRleHQsIGV4cHJlc3Npb24sIHRva2VuLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKHRva2VuICE9PSAxMDc0NzkwNDE3KSB7DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgZXhwcmVzc2lvbiA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwcmVzc2lvbiwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTcpIHsNCiAgICAgICAgICAgIGV4cHJlc3Npb24gPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcmVzc2lvbik7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgIGV4cHJlc3Npb24gPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHJlc3Npb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIH0NCiAgICByZXR1cm4gY29udGV4dCAmIDggJiYgZXhwcmVzc2lvbi50eXBlID09PSAnTGl0ZXJhbCcgJiYgdHlwZW9mIGV4cHJlc3Npb24udmFsdWUgPT09ICdzdHJpbmcnDQogICAgICAgID8gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdFeHByZXNzaW9uU3RhdGVtZW50JywNCiAgICAgICAgICAgIGV4cHJlc3Npb24sDQogICAgICAgICAgICBkaXJlY3RpdmU6IGV4cHJlc3Npb24ucmF3LnNsaWNlKDEsIC0xKQ0KICAgICAgICB9KQ0KICAgICAgICA6IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnRXhwcmVzc2lvblN0YXRlbWVudCcsDQogICAgICAgICAgICBleHByZXNzaW9uDQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VFbXB0eVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRW1wdHlTdGF0ZW1lbnQnDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRocm93U3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgaWYgKHBhcnNlci5mbGFncyAmIDEpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDg4KTsNCiAgICBjb25zdCBhcmd1bWVudCA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1Rocm93U3RhdGVtZW50JywNCiAgICAgICAgYXJndW1lbnQNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSWZTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgNjcxNzQ0MTEpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICBjb25zdCB0ZXN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmUsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICBjb25zdCBjb25zZXF1ZW50ID0gcGFyc2VDb25zZXF1ZW50T3JBbHRlcm5hdGl2ZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGxldCBhbHRlcm5hdGUgPSBudWxsOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIwNTY1KSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGFsdGVybmF0ZSA9IHBhcnNlQ29uc2VxdWVudE9yQWx0ZXJuYXRpdmUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdJZlN0YXRlbWVudCcsDQogICAgICAgIHRlc3QsDQogICAgICAgIGNvbnNlcXVlbnQsDQogICAgICAgIGFsdGVybmF0ZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VDb25zZXF1ZW50T3JBbHRlcm5hdGl2ZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICByZXR1cm4gY29udGV4dCAmIDEwMjQgfHwNCiAgICAgICAgKGNvbnRleHQgJiAyNTYpID09PSAwIHx8DQogICAgICAgIHBhcnNlci50b2tlbiAhPT0gODYxMDYNCiAgICAgICAgPyBwYXJzZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCB7ICQ6IGxhYmVscyB9LCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICA6IHBhcnNlRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIGFkZENoaWxkU2NvcGUoc2NvcGUsIDIpLCAwLCAwLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlU3dpdGNoU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBjb25zdCBkaXNjcmltaW5hbnQgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMjE2MjcwMCk7DQogICAgY29uc3QgY2FzZXMgPSBbXTsNCiAgICBsZXQgc2VlbkRlZmF1bHQgPSAwOw0KICAgIGlmIChzY29wZSkNCiAgICAgICAgc2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCA4KTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KSB7DQogICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBsZXQgdGVzdCA9IG51bGw7DQogICAgICAgIGNvbnN0IGNvbnNlcXVlbnQgPSBbXTsNCiAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIwNTU4KSkgew0KICAgICAgICAgICAgdGVzdCA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIwNTYzKTsNCiAgICAgICAgICAgIGlmIChzZWVuRGVmYXVsdCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA4Nyk7DQogICAgICAgICAgICBzZWVuRGVmYXVsdCA9IDE7DQogICAgICAgIH0NCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjEpOw0KICAgICAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAyMDU1OCAmJg0KICAgICAgICAgICAgcGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1ICYmDQogICAgICAgICAgICBwYXJzZXIudG9rZW4gIT09IDIwNTYzKSB7DQogICAgICAgICAgICBjb25zZXF1ZW50LnB1c2gocGFyc2VTdGF0ZW1lbnRMaXN0SXRlbShwYXJzZXIsIGNvbnRleHQgfCA0MDk2LCBzY29wZSwgMiwgew0KICAgICAgICAgICAgICAgICQ6IGxhYmVscw0KICAgICAgICAgICAgfSkpOw0KICAgICAgICB9DQogICAgICAgIGNhc2VzLnB1c2goZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgIHR5cGU6ICdTd2l0Y2hDYXNlJywNCiAgICAgICAgICAgIHRlc3QsDQogICAgICAgICAgICBjb25zZXF1ZW50DQogICAgICAgIH0pKTsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTA3NDc5MDQxNSk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdTd2l0Y2hTdGF0ZW1lbnQnLA0KICAgICAgICBkaXNjcmltaW5hbnQsDQogICAgICAgIGNhc2VzDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVdoaWxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBjb25zdCB0ZXN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICBjb25zdCBib2R5ID0gcGFyc2VJdGVyYXRpb25TdGF0ZW1lbnRCb2R5KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdXaGlsZVN0YXRlbWVudCcsDQogICAgICAgIHRlc3QsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSXRlcmF0aW9uU3RhdGVtZW50Qm9keShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMpIHsNCiAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQocGFyc2VyLCAoKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4KSB8IDEzMTA3Miwgc2NvcGUsIDAsIHsgbG9vcDogMSwgJDogbGFiZWxzIH0sIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KfQ0KZnVuY3Rpb24gcGFyc2VDb250aW51ZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmICgoY29udGV4dCAmIDEzMTA3MikgPT09IDApDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDY2KTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBsZXQgbGFiZWwgPSBudWxsOw0KICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDAgJiYgcGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgICAgICBsYWJlbCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMCk7DQogICAgICAgIGlmICghaXNWYWxpZExhYmVsKHBhcnNlciwgbGFiZWxzLCB0b2tlblZhbHVlLCAxKSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEzNSwgdG9rZW5WYWx1ZSk7DQogICAgfQ0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnQ29udGludWVTdGF0ZW1lbnQnLA0KICAgICAgICBsYWJlbA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VCcmVha1N0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgbGV0IGxhYmVsID0gbnVsbDsNCiAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEpID09PSAwICYmIHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICBjb25zdCB7IHRva2VuVmFsdWUgfSA9IHBhcnNlcjsNCiAgICAgICAgbGFiZWwgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDApOw0KICAgICAgICBpZiAoIWlzVmFsaWRMYWJlbChwYXJzZXIsIGxhYmVscywgdG9rZW5WYWx1ZSwgMCkpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzUsIHRva2VuVmFsdWUpOw0KICAgIH0NCiAgICBlbHNlIGlmICgoY29udGV4dCAmICg0MDk2IHwgMTMxMDcyKSkgPT09IDApIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjcpOw0KICAgIH0NCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0JyZWFrU3RhdGVtZW50JywNCiAgICAgICAgbGFiZWwNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlV2l0aFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDg5KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCA2NzE3NDQxMSk7DQogICAgY29uc3Qgb2JqZWN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICBjb25zdCBib2R5ID0gcGFyc2VTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMiwgbGFiZWxzLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1dpdGhTdGF0ZW1lbnQnLA0KICAgICAgICBvYmplY3QsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRGVidWdnZXJTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0RlYnVnZ2VyU3RhdGVtZW50Jw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VUcnlTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBmaXJzdFNjb3BlID0gc2NvcGUgPyBhZGRDaGlsZFNjb3BlKHNjb3BlLCAzMikgOiB2b2lkIDA7DQogICAgY29uc3QgYmxvY2sgPSBwYXJzZUJsb2NrKHBhcnNlciwgY29udGV4dCwgZmlyc3RTY29wZSwgeyAkOiBsYWJlbHMgfSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgY29uc3QgaGFuZGxlciA9IGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIwNTU5KQ0KICAgICAgICA/IHBhcnNlQ2F0Y2hCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgIDogbnVsbDsNCiAgICBsZXQgZmluYWxpemVyID0gbnVsbDsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMDU2OCkgew0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBjb25zdCBmaW5hbGl6ZXJTY29wZSA9IGZpcnN0U2NvcGUgPyBhZGRDaGlsZFNjb3BlKHNjb3BlLCA0KSA6IHZvaWQgMDsNCiAgICAgICAgZmluYWxpemVyID0gcGFyc2VCbG9jayhwYXJzZXIsIGNvbnRleHQsIGZpbmFsaXplclNjb3BlLCB7ICQ6IGxhYmVscyB9LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQogICAgaWYgKCFoYW5kbGVyICYmICFmaW5hbGl6ZXIpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODYpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1RyeVN0YXRlbWVudCcsDQogICAgICAgIGJsb2NrLA0KICAgICAgICBoYW5kbGVyLA0KICAgICAgICBmaW5hbGl6ZXINCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQ2F0Y2hCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBsZXQgcGFyYW0gPSBudWxsOw0KICAgIGxldCBhZGRpdGlvbmFsU2NvcGUgPSBzY29wZTsNCiAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDY3MTc0NDExKSkgew0KICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICBzY29wZSA9IGFkZENoaWxkU2NvcGUoc2NvcGUsIDQpOw0KICAgICAgICBwYXJhbSA9IHBhcnNlQmluZGluZ1BhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgKHBhcnNlci50b2tlbiAmIDIwOTcxNTIpID09PSAyMDk3MTUyDQogICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgOiA1MTIsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgODQpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgODUpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgYWRkaXRpb25hbFNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgNjQpOw0KICAgIH0NCiAgICBjb25zdCBib2R5ID0gcGFyc2VCbG9jayhwYXJzZXIsIGNvbnRleHQsIGFkZGl0aW9uYWxTY29wZSwgeyAkOiBsYWJlbHMgfSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdDYXRjaENsYXVzZScsDQogICAgICAgIHBhcmFtLA0KICAgICAgICBib2R5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVN0YXRpY0Jsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoc2NvcGUpDQogICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgMik7DQogICAgY29uc3QgY3RvckNvbnRleHQgPSAxNjM4NCB8IDUyNDI4ODsNCiAgICBjb250ZXh0ID0gKChjb250ZXh0IHwgY3RvckNvbnRleHQpIF4gY3RvckNvbnRleHQpIHwgMjYyMTQ0Ow0KICAgIGNvbnN0IHsgYm9keSB9ID0gcGFyc2VCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB7fSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdTdGF0aWNCbG9jaycsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRG9XaGlsZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUl0ZXJhdGlvblN0YXRlbWVudEJvZHkocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzKTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMjA1ODApOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBjb25zdCB0ZXN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICBjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTA3NDc5MDQxNyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdEb1doaWxlU3RhdGVtZW50JywNCiAgICAgICAgYm9keSwNCiAgICAgICAgdGVzdA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VMZXRJZGVudE9yVmFyRGVjbGFyYXRpb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyB0b2tlbiwgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIGxldCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgaWYgKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCAyMDk3MTUyKSkgew0KICAgICAgICBjb25zdCBkZWNsYXJhdGlvbnMgPSBwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb25MaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDgsIDApOw0KICAgICAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgICAgICBraW5kOiAnbGV0JywNCiAgICAgICAgICAgIGRlY2xhcmF0aW9ucw0KICAgICAgICB9KTsNCiAgICB9DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIGlmIChjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODMpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxKSB7DQogICAgICAgIHJldHVybiBwYXJzZUxhYmVsbGVkU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwge30sIHRva2VuVmFsdWUsIGV4cHIsIHRva2VuLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTApIHsNCiAgICAgICAgbGV0IHNjb3BlID0gdm9pZCAwOw0KICAgICAgICBpZiAoY29udGV4dCAmIDY0KQ0KICAgICAgICAgICAgc2NvcGUgPSBjcmVhdGVBcnJvd0hlYWRQYXJzaW5nU2NvcGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblZhbHVlKTsNCiAgICAgICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEyOCkgXiAxMjg7DQogICAgICAgIGV4cHIgPSBwYXJzZUFycm93RnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIFtleHByXSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBleHByID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgZXhwciA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICB9DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgZXhwciA9IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQogICAgfQ0KICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlTGV4aWNhbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IGRlY2xhcmF0aW9ucyA9IHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luKTsNCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLA0KICAgICAgICBraW5kOiBraW5kICYgOCA/ICdsZXQnIDogJ2NvbnN0JywNCiAgICAgICAgZGVjbGFyYXRpb25zDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVZhcmlhYmxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IGRlY2xhcmF0aW9ucyA9IHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwgb3JpZ2luKTsNCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLA0KICAgICAgICBraW5kOiAndmFyJywNCiAgICAgICAgZGVjbGFyYXRpb25zDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb25MaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbikgew0KICAgIGxldCBiaW5kaW5nQ291bnQgPSAxOw0KICAgIGNvbnN0IGxpc3QgPSBbcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbildOw0KICAgIHdoaWxlIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTgpKSB7DQogICAgICAgIGJpbmRpbmdDb3VudCsrOw0KICAgICAgICBsaXN0LnB1c2gocGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbikpOw0KICAgIH0NCiAgICBpZiAoYmluZGluZ0NvdW50ID4gMSAmJiBvcmlnaW4gJiAzMiAmJiBwYXJzZXIudG9rZW4gJiAyNjIxNDQpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNTksIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KICAgIHJldHVybiBsaXN0Ow0KfQ0KZnVuY3Rpb24gcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbikgew0KICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBsZXQgaW5pdCA9IG51bGw7DQogICAgY29uc3QgaWQgPSBwYXJzZUJpbmRpbmdQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBpbml0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGlmIChvcmlnaW4gJiAzMiB8fCAodG9rZW4gJiAyMDk3MTUyKSA9PT0gMCkgew0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjc0NTQ5IHx8DQogICAgICAgICAgICAgICAgKHBhcnNlci50b2tlbiA9PT0gODczODg2OCAmJg0KICAgICAgICAgICAgICAgICAgICAodG9rZW4gJiAyMDk3MTUyIHx8IChraW5kICYgNCkgPT09IDAgfHwgY29udGV4dCAmIDEwMjQpKSkgew0KICAgICAgICAgICAgICAgIHJlcG9ydE1lc3NhZ2VBdCh0b2tlblBvcywgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCAtIDMsIDU4LCBwYXJzZXIudG9rZW4gPT09IDI3NDU0OSA/ICdvZicgOiAnaW4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmICgoa2luZCAmIDE2IHx8ICh0b2tlbiAmIDIwOTcxNTIpID4gMCkgJiYNCiAgICAgICAgKHBhcnNlci50b2tlbiAmIDI2MjE0NCkgIT09IDI2MjE0NCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA1Nywga2luZCAmIDE2ID8gJ2NvbnN0JyA6ICdkZXN0cnVjdHVyaW5nJyk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdG9yJywNCiAgICAgICAgaWQsDQogICAgICAgIGluaXQNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRm9yU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IGZvckF3YWl0ID0gKChjb250ZXh0ICYgNDE5NDMwNCkgPiAwIHx8ICgoY29udGV4dCAmIDIwNDgpID4gMCAmJiAoY29udGV4dCAmIDgxOTIpID4gMCkpICYmDQogICAgICAgIGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAyMDkwMDgpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBpZiAoc2NvcGUpDQogICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgMSk7DQogICAgbGV0IHRlc3QgPSBudWxsOw0KICAgIGxldCB1cGRhdGUgPSBudWxsOw0KICAgIGxldCBkZXN0cnVjdGlibGUgPSAwOw0KICAgIGxldCBpbml0ID0gbnVsbDsNCiAgICBsZXQgaXNWYXJEZWNsID0gcGFyc2VyLnRva2VuID09PSA4NjA5MCB8fCBwYXJzZXIudG9rZW4gPT09IDI0MTczOSB8fCBwYXJzZXIudG9rZW4gPT09IDg2MDkyOw0KICAgIGxldCByaWdodDsNCiAgICBjb25zdCB7IHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgaWYgKGlzVmFyRGVjbCkgew0KICAgICAgICBpZiAodG9rZW4gPT09IDI0MTczOSkgew0KICAgICAgICAgICAgaW5pdCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCAyMDk3MTUyKSkgew0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg3Mzg4NjgpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaW5pdCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgICAgICAgICAgICAgICAgICBraW5kOiAnbGV0JywNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChwYXJzZXIsIGNvbnRleHQgfCAxMzQyMTc3MjgsIHNjb3BlLCA4LCAzMikNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNvbnRleHQgJiAxMDI0KSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaXNWYXJEZWNsID0gZmFsc2U7DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICAgICAgICAgIGluaXQgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluaXQsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDI3NDU0OSkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTEyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgaW5pdCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB0b2tlbiA9PT0gODYwOTANCiAgICAgICAgICAgICAgICA/IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLA0KICAgICAgICAgICAgICAgICAgICBraW5kOiAndmFyJywNCiAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25zOiBwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb25MaXN0KHBhcnNlciwgY29udGV4dCB8IDEzNDIxNzcyOCwgc2NvcGUsIDQsIDMyKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICA6IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLA0KICAgICAgICAgICAgICAgICAgICBraW5kOiAnY29uc3QnLA0KICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbnM6IHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0IHwgMTM0MjE3NzI4LCBzY29wZSwgMTYsIDMyKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKHRva2VuID09PSAxMDc0NzkwNDE3KSB7DQogICAgICAgIGlmIChmb3JBd2FpdCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDgwKTsNCiAgICB9DQogICAgZWxzZSBpZiAoKHRva2VuICYgMjA5NzE1MikgPT09IDIwOTcxNTIpIHsNCiAgICAgICAgaW5pdCA9DQogICAgICAgICAgICB0b2tlbiA9PT0gMjE2MjcwMA0KICAgICAgICAgICAgICAgID8gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgdm9pZCAwLCAxLCAwLCAwLCAyLCAzMiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykNCiAgICAgICAgICAgICAgICA6IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgdm9pZCAwLCAxLCAwLCAwLCAyLCAzMiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgIGlmIChjb250ZXh0ICYgMjU2ICYmIGRlc3RydWN0aWJsZSAmIDY0KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2MSk7DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPQ0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlICYgMTYgPyAyIDogMTsNCiAgICAgICAgaW5pdCA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCB8IDEzNDIxNzcyOCwgaW5pdCwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpbml0ID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCB8IDEzNDIxNzcyOCwgMSwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgfQ0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMjYyMTQ0KSA9PT0gMjYyMTQ0KSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDI3NDU0OSkgew0KICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA3OCwgZm9yQXdhaXQgPyAnYXdhaXQnIDogJ29mJyk7DQogICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihwYXJzZXIsIGluaXQpOw0KICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgIHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxNik7DQogICAgICAgICAgICBjb25zdCBib2R5ID0gcGFyc2VJdGVyYXRpb25TdGF0ZW1lbnRCb2R5KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscyk7DQogICAgICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnRm9yT2ZTdGF0ZW1lbnQnLA0KICAgICAgICAgICAgICAgIGxlZnQ6IGluaXQsDQogICAgICAgICAgICAgICAgcmlnaHQsDQogICAgICAgICAgICAgICAgYm9keSwNCiAgICAgICAgICAgICAgICBhd2FpdDogZm9yQXdhaXQNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA3OCwgJ2luJyk7DQogICAgICAgIHJlaW50ZXJwcmV0VG9QYXR0ZXJuKHBhcnNlciwgaW5pdCk7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGlmIChmb3JBd2FpdCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDgwKTsNCiAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICAgICAgY29uc3QgYm9keSA9IHBhcnNlSXRlcmF0aW9uU3RhdGVtZW50Qm9keShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMpOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdGb3JJblN0YXRlbWVudCcsDQogICAgICAgICAgICBib2R5LA0KICAgICAgICAgICAgbGVmdDogaW5pdCwNCiAgICAgICAgICAgIHJpZ2h0DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAoZm9yQXdhaXQpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDgwKTsNCiAgICBpZiAoIWlzVmFyRGVjbCkgew0KICAgICAgICBpZiAoZGVzdHJ1Y3RpYmxlICYgOCAmJiBwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDc4LCAnbG9vcCcpOw0KICAgICAgICB9DQogICAgICAgIGluaXQgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCB8IDEzNDIxNzcyOCwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgaW5pdCk7DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KQ0KICAgICAgICBpbml0ID0gcGFyc2VTZXF1ZW5jZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zLCBpbml0KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMDc0NzkwNDE3KTsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE3KQ0KICAgICAgICB0ZXN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDEwNzQ3OTA0MTcpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE2KQ0KICAgICAgICB1cGRhdGUgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUl0ZXJhdGlvblN0YXRlbWVudEJvZHkocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0ZvclN0YXRlbWVudCcsDQogICAgICAgIGluaXQsDQogICAgICAgIHRlc3QsDQogICAgICAgIHVwZGF0ZSwNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKSB7DQogICAgaWYgKCFpc1ZhbGlkSWRlbnRpZmllcihjb250ZXh0LCBwYXJzZXIudG9rZW4pKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMTUpOw0KICAgIGlmICgocGFyc2VyLnRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgIGlmIChzY29wZSkNCiAgICAgICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcnNlci50b2tlblZhbHVlLCA4LCAwKTsNCiAgICByZXR1cm4gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQp9DQpmdW5jdGlvbiBwYXJzZUltcG9ydERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUpIHsNCiAgICBjb25zdCBzdGFydCA9IHBhcnNlci50b2tlblBvczsNCiAgICBjb25zdCBsaW5lID0gcGFyc2VyLmxpbmVQb3M7DQogICAgY29uc3QgY29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBsZXQgc291cmNlID0gbnVsbDsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBsZXQgc3BlY2lmaWVycyA9IFtdOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEzNDI4MzI2Nykgew0KICAgICAgICBzb3VyY2UgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgIGNvbnN0IGxvY2FsID0gcGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKTsNCiAgICAgICAgICAgIHNwZWNpZmllcnMgPSBbDQogICAgICAgICAgICAgICAgZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ltcG9ydERlZmF1bHRTcGVjaWZpZXInLA0KICAgICAgICAgICAgICAgICAgICBsb2NhbA0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICBdOw0KICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxOCkpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDg0NTcwMTQ6DQogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpZXJzLnB1c2gocGFyc2VJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW1wb3J0U3BlY2lmaWVyT3JOYW1lZEltcG9ydHMocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgc3BlY2lmaWVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwNSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDg0NTcwMTQ6DQogICAgICAgICAgICAgICAgICAgIHNwZWNpZmllcnMgPSBbcGFyc2VJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSldOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDIxNjI3MDA6DQogICAgICAgICAgICAgICAgICAgIHBhcnNlSW1wb3J0U3BlY2lmaWVyT3JOYW1lZEltcG9ydHMocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgc3BlY2lmaWVycyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgNjcxNzQ0MTE6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUltcG9ydENhbGxEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIGNhc2UgNjcxMDg4Nzc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUltcG9ydE1ldGFEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHNvdXJjZSA9IHBhcnNlTW9kdWxlU3BlY2lmaWVyKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSW1wb3J0RGVjbGFyYXRpb24nLA0KICAgICAgICBzcGVjaWZpZXJzLA0KICAgICAgICBzb3VyY2UNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyKHBhcnNlciwgY29udGV4dCwgc2NvcGUpIHsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgNzc5MzQpOw0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4KSB7DQogICAgICAgIHJlcG9ydE1lc3NhZ2VBdCh0b2tlblBvcywgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICB0eXBlOiAnSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyJywNCiAgICAgICAgbG9jYWw6IHBhcnNlUmVzdHJpY3RlZElkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTW9kdWxlU3BlY2lmaWVyKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxMjQwNCk7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTM0MjgzMjY3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMDMsICdJbXBvcnQnKTsNCiAgICByZXR1cm4gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQp9DQpmdW5jdGlvbiBwYXJzZUltcG9ydFNwZWNpZmllck9yTmFtZWRJbXBvcnRzKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHNwZWNpZmllcnMpIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgIGxldCB7IHRva2VuLCB0b2tlblZhbHVlLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGNvbnN0IGltcG9ydGVkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIGxldCBsb2NhbDsNCiAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCA3NzkzNCkpIHsNCiAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4IHx8IHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMDQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdmFsaWRhdGVCaW5kaW5nSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDE2LCBwYXJzZXIudG9rZW4sIDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdG9rZW5WYWx1ZSA9IHBhcnNlci50b2tlblZhbHVlOw0KICAgICAgICAgICAgbG9jYWwgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHZhbGlkYXRlQmluZGluZ0lkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAxNiwgdG9rZW4sIDApOw0KICAgICAgICAgICAgbG9jYWwgPSBpbXBvcnRlZDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICBhZGRCbG9ja05hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwgOCwgMCk7DQogICAgICAgIHNwZWNpZmllcnMucHVzaChmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgdHlwZTogJ0ltcG9ydFNwZWNpZmllcicsDQogICAgICAgICAgICBsb2NhbCwNCiAgICAgICAgICAgIGltcG9ydGVkDQogICAgICAgIH0pKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkNCiAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxOCk7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICByZXR1cm4gc3BlY2lmaWVyczsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0TWV0YURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCBleHByID0gcGFyc2VJbXBvcnRNZXRhRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJywNCiAgICAgICAgbmFtZTogJ2ltcG9ydCcNCiAgICB9KSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgZXhwciA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICByZXR1cm4gcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUltcG9ydENhbGxEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBsZXQgZXhwciA9IHBhcnNlSW1wb3J0RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgIGV4cHIgPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgIH0NCiAgICByZXR1cm4gcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUV4cG9ydERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUpIHsNCiAgICBjb25zdCBzdGFydCA9IHBhcnNlci50b2tlblBvczsNCiAgICBjb25zdCBsaW5lID0gcGFyc2VyLmxpbmVQb3M7DQogICAgY29uc3QgY29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IHNwZWNpZmllcnMgPSBbXTsNCiAgICBsZXQgZGVjbGFyYXRpb24gPSBudWxsOw0KICAgIGxldCBzb3VyY2UgPSBudWxsOw0KICAgIGxldCBrZXk7DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIwNTYzKSkgew0KICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgY2FzZSA4NjEwNjogew0KICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIDEsIDEsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMzM6DQogICAgICAgICAgICBjYXNlIDg2MDk2Og0KICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VDbGFzc0RlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAyMDkwMDc6DQogICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICBjb25zdCB7IGZsYWdzIH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIDEpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg2MTA2KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCA0LCAxLCAxLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUFzeW5jQXJyb3dPckNhbGxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZGVjbGFyYXRpb24sIDEsIDEsIDAsIGZsYWdzLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZGVjbGFyYXRpb24sIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGRlY2xhcmF0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBjcmVhdGVBcnJvd0hlYWRQYXJzaW5nU2NvcGUocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgW2RlY2xhcmF0aW9uXSwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsICdkZWZhdWx0Jyk7DQogICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ0V4cG9ydERlZmF1bHREZWNsYXJhdGlvbicsDQogICAgICAgICAgICBkZWNsYXJhdGlvbg0KICAgICAgICB9KTsNCiAgICB9DQogICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgY2FzZSA4NDU3MDE0OiB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIGxldCBleHBvcnRlZCA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBpc05hbWVkRGVjbGFyYXRpb24gPSBjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgNzc5MzQpOw0KICAgICAgICAgICAgaWYgKGlzTmFtZWREZWNsYXJhdGlvbikgew0KICAgICAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIHBhcnNlci50b2tlblZhbHVlKTsNCiAgICAgICAgICAgICAgICBleHBvcnRlZCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEyNDA0KTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEzNDI4MzI2NykNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMDMsICdFeHBvcnQnKTsNCiAgICAgICAgICAgIHNvdXJjZSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnRXhwb3J0QWxsRGVjbGFyYXRpb24nLA0KICAgICAgICAgICAgICAgIHNvdXJjZSwNCiAgICAgICAgICAgICAgICBleHBvcnRlZA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAyMTYyNzAwOiB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIGNvbnN0IHRtcEV4cG9ydGVkTmFtZXMgPSBbXTsNCiAgICAgICAgICAgIGNvbnN0IHRtcEV4cG9ydGVkQmluZGluZ3MgPSBbXTsNCiAgICAgICAgICAgIHdoaWxlIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCB0b2tlblZhbHVlLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICBjb25zdCBsb2NhbCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgIGxldCBleHBvcnRlZDsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA3NzkzNCkgew0KICAgICAgICAgICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwNCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0bXBFeHBvcnRlZE5hbWVzLnB1c2gocGFyc2VyLnRva2VuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG1wRXhwb3J0ZWRCaW5kaW5ncy5wdXNoKHRva2VuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGV4cG9ydGVkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcEV4cG9ydGVkTmFtZXMucHVzaChwYXJzZXIudG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0bXBFeHBvcnRlZEJpbmRpbmdzLnB1c2gocGFyc2VyLnRva2VuVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGV4cG9ydGVkID0gbG9jYWw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNwZWNpZmllcnMucHVzaChmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnRXhwb3J0U3BlY2lmaWVyJywNCiAgICAgICAgICAgICAgICAgICAgbG9jYWwsDQogICAgICAgICAgICAgICAgICAgIGV4cG9ydGVkDQogICAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpDQogICAgICAgICAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxOCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTA3NDc5MDQxNSk7DQogICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDEyNDA0KSkgew0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEzNDI4MzI2NykNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTAzLCAnRXhwb3J0Jyk7DQogICAgICAgICAgICAgICAgc291cmNlID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChzY29wZSkgew0KICAgICAgICAgICAgICAgIGxldCBpID0gMDsNCiAgICAgICAgICAgICAgICBsZXQgaU1heCA9IHRtcEV4cG9ydGVkTmFtZXMubGVuZ3RoOw0KICAgICAgICAgICAgICAgIGZvciAoOyBpIDwgaU1heDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGRlY2xhcmVVbmJvdW5kVmFyaWFibGUocGFyc2VyLCB0bXBFeHBvcnRlZE5hbWVzW2ldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaSA9IDA7DQogICAgICAgICAgICAgICAgaU1heCA9IHRtcEV4cG9ydGVkQmluZGluZ3MubGVuZ3RoOw0KICAgICAgICAgICAgICAgIGZvciAoOyBpIDwgaU1heDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGFkZEJpbmRpbmdUb0V4cG9ydHMocGFyc2VyLCB0bXBFeHBvcnRlZEJpbmRpbmdzW2ldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgODYwOTY6DQogICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlQ2xhc3NEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAyLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDg2MTA2Og0KICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwgMSwgMiwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAyNDE3Mzk6DQogICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlTGV4aWNhbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDgsIDY0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDg2MDkyOg0KICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUxleGljYWxEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxNiwgNjQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgODYwOTA6DQogICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlVmFyaWFibGVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNjQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgMjA5MDA3Og0KICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDAgJiYgcGFyc2VyLnRva2VuID09PSA4NjEwNikgew0KICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIDEsIDIsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGlmIChzY29wZSkgew0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBkZWNsYXJhdGlvbi5pZCA/IGRlY2xhcmF0aW9uLmlkLm5hbWUgOiAnJzsNCiAgICAgICAgICAgICAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIGtleSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRXhwb3J0TmFtZWREZWNsYXJhdGlvbicsDQogICAgICAgIGRlY2xhcmF0aW9uLA0KICAgICAgICBzcGVjaWZpZXJzLA0KICAgICAgICBzb3VyY2UNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgaXNQYXR0ZXJuLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IGV4cHIgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMiwgMCwgY2FuQXNzaWduLCBpc1BhdHRlcm4sIGluR3JvdXAsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIGluR3JvdXAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIHJldHVybiBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQp9DQpmdW5jdGlvbiBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpIHsNCiAgICBjb25zdCBleHByZXNzaW9ucyA9IFtleHByXTsNCiAgICB3aGlsZSAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTgpKSB7DQogICAgICAgIGV4cHJlc3Npb25zLnB1c2gocGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1NlcXVlbmNlRXhwcmVzc2lvbicsDQogICAgICAgIGV4cHJlc3Npb25zDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgY2FuQXNzaWduLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgZXhwciA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgMCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgcmV0dXJuIHBhcnNlci50b2tlbiA9PT0gMTgNCiAgICAgICAgPyBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpDQogICAgICAgIDogZXhwcjsNCn0NCmZ1bmN0aW9uIHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGxlZnQpIHsNCiAgICBjb25zdCB7IHRva2VuIH0gPSBwYXJzZXI7DQogICAgaWYgKCh0b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgICAgIGlmICgoIWlzUGF0dGVybiAmJiB0b2tlbiA9PT0gMTA3NzkzNjE1NyAmJiBsZWZ0LnR5cGUgPT09ICdBcnJheUV4cHJlc3Npb24nKSB8fA0KICAgICAgICAgICAgbGVmdC50eXBlID09PSAnT2JqZWN0RXhwcmVzc2lvbicpIHsNCiAgICAgICAgICAgIHJlaW50ZXJwcmV0VG9QYXR0ZXJuKHBhcnNlciwgbGVmdCk7DQogICAgICAgIH0NCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgY29uc3QgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAxLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGlzUGF0dGVybg0KICAgICAgICAgICAgPyB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgICAgICBsZWZ0LA0KICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICB9DQogICAgICAgICAgICA6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgIGxlZnQsDQogICAgICAgICAgICAgICAgb3BlcmF0b3I6IEtleXdvcmREZXNjVGFibGVbdG9rZW4gJiAyNTVdLA0KICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICB9KTsNCiAgICB9DQogICAgaWYgKCh0b2tlbiAmIDg0NTQxNDQpID09PSA4NDU0MTQ0KSB7DQogICAgICAgIGxlZnQgPSBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uLCA0LCB0b2tlbiwgbGVmdCk7DQogICAgfQ0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMikpIHsNCiAgICAgICAgbGVmdCA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgbGVmdCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIHJldHVybiBsZWZ0Ow0KfQ0KZnVuY3Rpb24gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbGVmdCkgew0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgbGVmdCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBpc1BhdHRlcm4NCiAgICAgICAgPyB7DQogICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgIHJpZ2h0DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgIG9wZXJhdG9yOiBLZXl3b3JkRGVzY1RhYmxlW3Rva2VuICYgMjU1XSwNCiAgICAgICAgICAgIHJpZ2h0DQogICAgICAgIH0pOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gbGVmdDsNCn0NCmZ1bmN0aW9uIHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdGVzdCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IGNvbnNlcXVlbnQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3MjgsIDEsIDAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIxKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgY29uc3QgYWx0ZXJuYXRlID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnQ29uZGl0aW9uYWxFeHByZXNzaW9uJywNCiAgICAgICAgdGVzdCwNCiAgICAgICAgY29uc2VxdWVudCwNCiAgICAgICAgYWx0ZXJuYXRlDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uLCBtaW5QcmVjLCBvcGVyYXRvciwgbGVmdCkgew0KICAgIGNvbnN0IGJpdCA9IC0oKGNvbnRleHQgJiAxMzQyMTc3MjgpID4gMCkgJiA4NzM4ODY4Ow0KICAgIGxldCB0Ow0KICAgIGxldCBwcmVjOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgew0KICAgICAgICB0ID0gcGFyc2VyLnRva2VuOw0KICAgICAgICBwcmVjID0gdCAmIDM4NDA7DQogICAgICAgIGlmICgodCAmIDUyNDI4OCAmJiBvcGVyYXRvciAmIDI2ODQzNTQ1NikgfHwgKG9wZXJhdG9yICYgNTI0Mjg4ICYmIHQgJiAyNjg0MzU0NTYpKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNjApOw0KICAgICAgICB9DQogICAgICAgIGlmIChwcmVjICsgKCh0ID09PSA4NDU3MjczKSA8PCA4KSAtICgoYml0ID09PSB0KSA8PCAxMikgPD0gbWluUHJlYykNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBsZWZ0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6IHQgJiA1MjQyODggfHwgdCAmIDI2ODQzNTQ1NiA/ICdMb2dpY2FsRXhwcmVzc2lvbicgOiAnQmluYXJ5RXhwcmVzc2lvbicsDQogICAgICAgICAgICBsZWZ0LA0KICAgICAgICAgICAgcmlnaHQ6IHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MsIHByZWMsIHQsIHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIGluR3JvdXAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKSwNCiAgICAgICAgICAgIG9wZXJhdG9yOiBLZXl3b3JkRGVzY1RhYmxlW3QgJiAyNTVdDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgcmV0dXJuIGxlZnQ7DQp9DQpmdW5jdGlvbiBwYXJzZVVuYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGlzTEhTLCBzdGFydCwgbGluZSwgY29sdW1uLCBpbkdyb3VwKSB7DQogICAgaWYgKCFpc0xIUykNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgY29uc3QgdW5hcnlPcGVyYXRvciA9IHBhcnNlci50b2tlbjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGFyZyA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIGluR3JvdXAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg0NTcyNzMpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDMxKTsNCiAgICBpZiAoY29udGV4dCAmIDEwMjQgJiYgdW5hcnlPcGVyYXRvciA9PT0gMTY4NjMyNzgpIHsNCiAgICAgICAgaWYgKGFyZy50eXBlID09PSAnSWRlbnRpZmllcicpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExOCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaXNQcm9wZXJ0eVdpdGhQcml2YXRlRmllbGRLZXkoYXJnKSkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTI0KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdVbmFyeUV4cHJlc3Npb24nLA0KICAgICAgICBvcGVyYXRvcjogS2V5d29yZERlc2NUYWJsZVt1bmFyeU9wZXJhdG9yICYgMjU1XSwNCiAgICAgICAgYXJndW1lbnQ6IGFyZywNCiAgICAgICAgcHJlZml4OiB0cnVlDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUFzeW5jRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzTEhTLCBjYW5Bc3NpZ24sIGlzUGF0dGVybiwgaW5OZXcsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuIH0gPSBwYXJzZXI7DQogICAgY29uc3QgZXhwciA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIGlzUGF0dGVybik7DQogICAgY29uc3QgeyBmbGFncyB9ID0gcGFyc2VyOw0KICAgIGlmICgoZmxhZ3MgJiAxKSA9PT0gMCkgew0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA4NjEwNikgew0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAxNDMzNjApID09PSAxNDMzNjApIHsNCiAgICAgICAgICAgIGlmICghaXNMSFMpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VBc3luY0Fycm93QWZ0ZXJJZGVudChwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCFpbk5ldyAmJiBwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgIHJldHVybiBwYXJzZUFzeW5jQXJyb3dPckNhbGxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgY2FuQXNzaWduLCAxLCAwLCBmbGFncywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgIGNsYXNzaWZ5SWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHRva2VuLCAxKTsNCiAgICAgICAgaWYgKGluTmV3KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDkpOw0KICAgICAgICByZXR1cm4gcGFyc2VBcnJvd0Zyb21JZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuVmFsdWUsIGV4cHIsIGluTmV3LCBjYW5Bc3NpZ24sIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICByZXR1cm4gZXhwcjsNCn0NCmZ1bmN0aW9uIHBhcnNlWWllbGRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgY2FuQXNzaWduLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKGluR3JvdXApDQogICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgfD0gMjU2Ow0KICAgIGlmIChjb250ZXh0ICYgMjA5NzE1Mikgew0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBpZiAoY29udGV4dCAmIDgzODg2MDgpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzMCk7DQogICAgICAgIGlmICghY2FuQXNzaWduKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjQpOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMikNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyMSk7DQogICAgICAgIGxldCBhcmd1bWVudCA9IG51bGw7DQogICAgICAgIGxldCBkZWxlZ2F0ZSA9IGZhbHNlOw0KICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEpID09PSAwKSB7DQogICAgICAgICAgICBkZWxlZ2F0ZSA9IGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDg0NTcwMTQpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmICgxMjI4OCB8IDY1NTM2KSB8fCBkZWxlZ2F0ZSkgew0KICAgICAgICAgICAgICAgIGFyZ3VtZW50ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdZaWVsZEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgYXJndW1lbnQsDQogICAgICAgICAgICBkZWxlZ2F0ZQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA5NSwgJ3lpZWxkJyk7DQogICAgcmV0dXJuIHBhcnNlSWRlbnRpZmllck9yQXJyb3cocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXdhaXRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5OZXcsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoaW5Hcm91cCkNCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSB8PSAxMjg7DQogICAgaWYgKGNvbnRleHQgJiA0MTk0MzA0IHx8IChjb250ZXh0ICYgMjA0OCAmJiBjb250ZXh0ICYgODE5MikpIHsNCiAgICAgICAgaWYgKGluTmV3KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgICAgIGlmIChjb250ZXh0ICYgODM4ODYwOCkgew0KICAgICAgICAgICAgcmVwb3J0TWVzc2FnZUF0KHBhcnNlci5pbmRleCwgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCwgMjkpOw0KICAgICAgICB9DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGNvbnN0IGFyZ3VtZW50ID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg0NTcyNzMpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzMSk7DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnQXdhaXRFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGFyZ3VtZW50DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmIDIwNDgpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk2KTsNCiAgICByZXR1cm4gcGFyc2VJZGVudGlmaWVyT3JBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VGdW5jdGlvbkJvZHkocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBmaXJzdFJlc3RyaWN0ZWQsIHNjb3BlRXJyb3IpIHsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMTYyNzAwKTsNCiAgICBjb25zdCBib2R5ID0gW107DQogICAgY29uc3QgcHJldkNvbnRleHQgPSBjb250ZXh0Ow0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgd2hpbGUgKHBhcnNlci50b2tlbiA9PT0gMTM0MjgzMjY3KSB7DQogICAgICAgICAgICBjb25zdCB7IGluZGV4LCB0b2tlblBvcywgdG9rZW5WYWx1ZSwgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICAgICAgICAgIGNvbnN0IGV4cHIgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIGlmIChpc1ZhbGlkU3RyaWN0TW9kZShwYXJzZXIsIGluZGV4LCB0b2tlblBvcywgdG9rZW5WYWx1ZSkpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0IHw9IDEwMjQ7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5mbGFncyAmIDEyOCkgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnRNZXNzYWdlQXQocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLnRva2VuUG9zLCA2NCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiA2NCkgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnRNZXNzYWdlQXQocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLnRva2VuUG9zLCA4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBib2R5LnB1c2gocGFyc2VEaXJlY3RpdmUocGFyc2VyLCBjb250ZXh0LCBleHByLCB0b2tlbiwgdG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KSB7DQogICAgICAgICAgICBpZiAoZmlyc3RSZXN0cmljdGVkKSB7DQogICAgICAgICAgICAgICAgaWYgKChmaXJzdFJlc3RyaWN0ZWQgJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKChmaXJzdFJlc3RyaWN0ZWQgJiAzNjg2NCkgPT09IDM2ODY0KSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocGFyc2VyLmZsYWdzICYgNTEyKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgICAgICBpZiAocGFyc2VyLmZsYWdzICYgMjU2KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbnRleHQgJiA2NCAmJg0KICAgICAgICAgICAgc2NvcGUgJiYNCiAgICAgICAgICAgIHNjb3BlRXJyb3IgIT09IHZvaWQgMCAmJg0KICAgICAgICAgICAgKHByZXZDb250ZXh0ICYgMTAyNCkgPT09IDAgJiYNCiAgICAgICAgICAgIChjb250ZXh0ICYgODE5MikgPT09IDApIHsNCiAgICAgICAgICAgIHJlcG9ydFNjb3BlRXJyb3Ioc2NvcGVFcnJvcik7DQogICAgICAgIH0NCiAgICB9DQogICAgcGFyc2VyLmZsYWdzID0NCiAgICAgICAgKHBhcnNlci5mbGFncyB8IDUxMiB8IDI1NiB8IDY0KSBeDQogICAgICAgICAgICAoNTEyIHwgMjU2IHwgNjQpOw0KICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSAocGFyc2VyLmRlc3RydWN0aWJsZSB8IDI1NikgXiAyNTY7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICBib2R5LnB1c2gocGFyc2VTdGF0ZW1lbnRMaXN0SXRlbShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCA0LCB7fSkpOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgb3JpZ2luICYgKDE2IHwgOCkgPyBjb250ZXh0IHwgMzI3NjggOiBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICBwYXJzZXIuZmxhZ3MgJj0gfigxMjggfCA2NCk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1NykNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMjQpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICB0eXBlOiAnQmxvY2tTdGF0ZW1lbnQnLA0KICAgICAgICBib2R5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVN1cGVyRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICBjYXNlIDY3MTA4OTkxOg0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTYyKTsNCiAgICAgICAgY2FzZSA2NzE3NDQxMTogew0KICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgNTI0Mjg4KSA9PT0gMCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNik7DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDE2Mzg0KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI3KTsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgNjkyNzE1NzE6DQogICAgICAgIGNhc2UgNjcxMDg4Nzc6IHsNCiAgICAgICAgICAgIGlmICgoY29udGV4dCAmIDI2MjE0NCkgPT09IDApDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjcpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxNjM4NCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNyk7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsICdzdXBlcicpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsgdHlwZTogJ1N1cGVyJyB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgaW5Hcm91cCwgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCBleHByZXNzaW9uID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDIsIDAsIGNhbkFzc2lnbiwgMCwgaW5Hcm91cCwgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIHJldHVybiBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHJlc3Npb24sIGluR3JvdXAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDUzKTsNCiAgICBjb25zdCB7IHRva2VuIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVXBkYXRlRXhwcmVzc2lvbicsDQogICAgICAgIGFyZ3VtZW50OiBleHByLA0KICAgICAgICBvcGVyYXRvcjogS2V5d29yZERlc2NUYWJsZVt0b2tlbiAmIDI1NV0sDQogICAgICAgIHByZWZpeDogZmFsc2UNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgaW5Hcm91cCwgaW5DaGFpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMzM2MTk5NjgpID09PSAzMzYxOTk2OCAmJiAocGFyc2VyLmZsYWdzICYgMSkgPT09IDApIHsNCiAgICAgICAgZXhwciA9IHBhcnNlVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgNjcxMDg4NjQpID09PSA2NzEwODg2NCkgew0KICAgICAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4Ow0KICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgY2FzZSA2NzEwODg3Nzogew0KICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIChjb250ZXh0IHwgMTA3Mzc0MTgyNCB8IDgxOTIpIF4gODE5Mik7DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VQcm9wZXJ0eU9yUHJpdmF0ZVByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIG9iamVjdDogZXhwciwNCiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA2OTI3MTU3MTogew0KICAgICAgICAgICAgICAgIGxldCByZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMjA0OCkgPT09IDIwNDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMjA0OCkgXiAyMDQ4Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMCk7DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIG9iamVjdDogZXhwciwNCiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgaWYgKHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyMDQ4Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNjcxNzQ0MTE6IHsNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEwMjQpID09PSAxMDI0KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAxMDI0KSBeIDEwMjQ7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBleHByOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQgcmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDIwNDgpID09PSAyMDQ4KSB7DQogICAgICAgICAgICAgICAgICAgIHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDIwNDgpIF4gMjA0ODsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgYXJncyA9IHBhcnNlQXJndW1lbnRzKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCk7DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQ2FsbEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgICAgICBjYWxsZWU6IGV4cHIsDQogICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogYXJncw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGlmIChyZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZykgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gMjA0ODsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDY3MTA4OTkxOiB7DQogICAgICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgKGNvbnRleHQgfCAxMDczNzQxODI0IHwgODE5MikgXiA4MTkyKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gMjA0ODsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlT3B0aW9uYWxDaGFpbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDIwNDgpID09PSAyMDQ4KSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE2MSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgICAgICBleHByID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1RhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIHRhZzogZXhwciwNCiAgICAgICAgICAgICAgICAgICAgcXVhc2k6IHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MDgNCiAgICAgICAgICAgICAgICAgICAgICAgID8gcGFyc2VUZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQgfCA2NTUzNikNCiAgICAgICAgICAgICAgICAgICAgICAgIDogcGFyc2VUZW1wbGF0ZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBpZiAoaW5DaGFpbiA9PT0gMCAmJiAocGFyc2VyLmZsYWdzICYgMjA0OCkgPT09IDIwNDgpIHsNCiAgICAgICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDIwNDgpIF4gMjA0ODsNCiAgICAgICAgZXhwciA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnQ2hhaW5FeHByZXNzaW9uJywNCiAgICAgICAgICAgIGV4cHJlc3Npb246IGV4cHINCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHJldHVybiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VPcHRpb25hbENoYWluKHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCByZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZyA9IGZhbHNlOw0KICAgIGxldCBub2RlOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxIHx8IHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgaWYgKChwYXJzZXIuZmxhZ3MgJiAyMDQ4KSA9PT0gMjA0OCkgew0KICAgICAgICAgICAgcmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcgPSB0cnVlOw0KICAgICAgICAgICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDIwNDgpIF4gMjA0ODsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMCk7DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgbm9kZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsDQogICAgICAgICAgICBvYmplY3Q6IGV4cHIsDQogICAgICAgICAgICBjb21wdXRlZDogdHJ1ZSwNCiAgICAgICAgICAgIG9wdGlvbmFsOiB0cnVlLA0KICAgICAgICAgICAgcHJvcGVydHkNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgY29uc3QgYXJncyA9IHBhcnNlQXJndW1lbnRzKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgbm9kZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnQ2FsbEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgY2FsbGVlOiBleHByLA0KICAgICAgICAgICAgYXJndW1lbnRzOiBhcmdzLA0KICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCA0MDk2KSkgPT09IDApDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNTUpOw0KICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgIG5vZGUgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ01lbWJlckV4cHJlc3Npb24nLA0KICAgICAgICAgICAgb2JqZWN0OiBleHByLA0KICAgICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUsDQogICAgICAgICAgICBwcm9wZXJ0eQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgaWYgKHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nKSB7DQogICAgICAgIHBhcnNlci5mbGFncyB8PSAyMDQ4Ow0KICAgIH0NCiAgICByZXR1cm4gbm9kZTsNCn0NCmZ1bmN0aW9uIHBhcnNlUHJvcGVydHlPclByaXZhdGVQcm9wZXJ0eU5hbWUocGFyc2VyLCBjb250ZXh0KSB7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAoMTQzMzYwIHwgNDA5NikpID09PSAwICYmIHBhcnNlci50b2tlbiAhPT0gMTMxKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDE1NSk7DQogICAgfQ0KICAgIHJldHVybiBjb250ZXh0ICYgMSAmJiBwYXJzZXIudG9rZW4gPT09IDEzMQ0KICAgICAgICA/IHBhcnNlUHJpdmF0ZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICA6IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KfQ0KZnVuY3Rpb24gcGFyc2VVcGRhdGVFeHByZXNzaW9uUHJlZml4ZWQocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoaW5OZXcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDU0KTsNCiAgICBpZiAoIWlzTEhTKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICBjb25zdCB7IHRva2VuIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBhcmcgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDUzKTsNCiAgICB9DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVXBkYXRlRXhwcmVzc2lvbicsDQogICAgICAgIGFyZ3VtZW50OiBhcmcsDQogICAgICAgIG9wZXJhdG9yOiBLZXl3b3JkRGVzY1RhYmxlW3Rva2VuICYgMjU1XSwNCiAgICAgICAgcHJlZml4OiB0cnVlDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgaW5OZXcsIGNhbkFzc2lnbiwgaXNQYXR0ZXJuLCBpbkdyb3VwLCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMTQzMzYwKSA9PT0gMTQzMzYwKSB7DQogICAgICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgICAgICBjYXNlIDIwOTAwODoNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VBd2FpdEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICBjYXNlIDI0MTc3MzoNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VZaWVsZEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBjYW5Bc3NpZ24sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgY2FzZSAyMDkwMDc6DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlQXN5bmNFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNMSFMsIGNhbkFzc2lnbiwgaXNQYXR0ZXJuLCBpbk5ldywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgeyB0b2tlbiwgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgICAgICBjb25zdCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCB8IDY1NTM2LCBpc1BhdHRlcm4pOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMCkgew0KICAgICAgICAgICAgaWYgKCFpc0xIUykNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICAgICAgICAgIGNsYXNzaWZ5SWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHRva2VuLCAxKTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUFycm93RnJvbUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCB0b2tlblZhbHVlLCBleHByLCBpbk5ldywgY2FuQXNzaWduLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDE2Mzg0ICYmIHRva2VuID09PSA1MzcwNzk5MjgpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMjcpOw0KICAgICAgICBpZiAodG9rZW4gPT09IDI0MTczOSkgew0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExMCk7DQogICAgICAgICAgICBpZiAoa2luZCAmICg4IHwgMTYpKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDk4KTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9DQogICAgICAgICAgICBjb250ZXh0ICYgMTAyNCAmJiAodG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgNCiAgICAgICAgICAgICAgICA/IDINCiAgICAgICAgICAgICAgICA6IDE7DQogICAgICAgIHJldHVybiBleHByOw0KICAgIH0NCiAgICBpZiAoKHBhcnNlci50b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICByZXR1cm4gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgIGNhc2UgMzM2MTk5OTU6DQogICAgICAgIGNhc2UgMzM2MTk5OTY6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VVcGRhdGVFeHByZXNzaW9uUHJlZml4ZWQocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDE2ODYzMjc4Og0KICAgICAgICBjYXNlIDE2ODQyODAwOg0KICAgICAgICBjYXNlIDE2ODQyODAxOg0KICAgICAgICBjYXNlIDI1MjMzOTcwOg0KICAgICAgICBjYXNlIDI1MjMzOTcxOg0KICAgICAgICBjYXNlIDE2ODYzMjc3Og0KICAgICAgICBjYXNlIDE2ODYzMjc5Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGluR3JvdXApOw0KICAgICAgICBjYXNlIDg2MTA2Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU9iamVjdExpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBjYW5Bc3NpZ24gPyAwIDogMSwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgNjkyNzE1NzE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VBcnJheUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBjYW5Bc3NpZ24gPyAwIDogMSwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgNjcxNzQ0MTE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VQYXJlbnRoZXNpemVkRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgMSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODYwMjE6DQogICAgICAgIGNhc2UgODYwMjI6DQogICAgICAgIGNhc2UgODYwMjM6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VOdWxsT3JUcnVlT3JGYWxzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA4NjExMzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVRoaXNFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIGNhc2UgNjU1NDA6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VSZWdFeHBMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMTMzOg0KICAgICAgICBjYXNlIDg2MDk2Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQ2xhc3NFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODYxMTE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VTdXBlckV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA2NzE3NDQwOToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVRlbXBsYXRlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDY3MTc0NDA4Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGVtcGxhdGUocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgY2FzZSA4NjEwOToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU5ld0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAxMzQyODMzODk6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VCaWdJbnRMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMTMxOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlUHJpdmF0ZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA4NjEwODoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUltcG9ydENhbGxPck1ldGFFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5OZXcsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg0NTYyNTg6DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDE2KQ0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUpTWFJvb3RFbGVtZW50T3JGcmFnbWVudChwYXJzZXIsIGNvbnRleHQsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgaWYgKGlzVmFsaWRJZGVudGlmaWVyKGNvbnRleHQsIHBhcnNlci50b2tlbikpDQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSWRlbnRpZmllck9yQXJyb3cocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0Q2FsbE9yTWV0YUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxMDg4NzcpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0TWV0YUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgaWYgKGluTmV3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMzgpOw0KICAgIGV4cHIgPSBwYXJzZUltcG9ydEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgaW5Hcm91cCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUltcG9ydE1ldGFFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgbWV0YSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmICgoY29udGV4dCAmIDIwNDgpID09PSAwKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxNjQpOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE0MzQ5NSAmJiBwYXJzZXIudG9rZW5WYWx1ZSAhPT0gJ21ldGEnKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdNZXRhUHJvcGVydHknLA0KICAgICAgICBtZXRhLA0KICAgICAgICBwcm9wZXJ0eTogcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCA2NzE3NDQxMSk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTQpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDEzOSk7DQogICAgY29uc3Qgc291cmNlID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0ltcG9ydEV4cHJlc3Npb24nLA0KICAgICAgICBzb3VyY2UNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQmlnSW50TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuUmF3LCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgY29udGV4dCAmIDUxMg0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdMaXRlcmFsJywNCiAgICAgICAgICAgIHZhbHVlOiB0b2tlblZhbHVlLA0KICAgICAgICAgICAgYmlnaW50OiB0b2tlblJhdy5zbGljZSgwLCAtMSksDQogICAgICAgICAgICByYXc6IHRva2VuUmF3DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZTogdG9rZW5WYWx1ZSwNCiAgICAgICAgICAgIGJpZ2ludDogdG9rZW5SYXcuc2xpY2UoMCwgLTEpDQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgNjcxNzQ0MDkpOw0KICAgIGNvbnN0IHF1YXNpcyA9IFtwYXJzZVRlbXBsYXRlRWxlbWVudChwYXJzZXIsIGNvbnRleHQsIHRva2VuVmFsdWUsIHRva2VuUmF3LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB0cnVlKV07DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdUZW1wbGF0ZUxpdGVyYWwnLA0KICAgICAgICBleHByZXNzaW9uczogW10sDQogICAgICAgIHF1YXNpcw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4Ow0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCA2NzE3NDQwOCk7DQogICAgY29uc3QgcXVhc2lzID0gWw0KICAgICAgICBwYXJzZVRlbXBsYXRlRWxlbWVudChwYXJzZXIsIGNvbnRleHQsIHRva2VuVmFsdWUsIHRva2VuUmF3LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBmYWxzZSkNCiAgICBdOw0KICAgIGNvbnN0IGV4cHJlc3Npb25zID0gW3BhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKV07DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODEpOw0KICAgIHdoaWxlICgocGFyc2VyLnRva2VuID0gc2NhblRlbXBsYXRlVGFpbChwYXJzZXIsIGNvbnRleHQpKSAhPT0gNjcxNzQ0MDkpIHsNCiAgICAgICAgY29uc3QgeyB0b2tlblZhbHVlLCB0b2tlblJhdywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCA2NzE3NDQwOCk7DQogICAgICAgIHF1YXNpcy5wdXNoKHBhcnNlVGVtcGxhdGVFbGVtZW50KHBhcnNlciwgY29udGV4dCwgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGZhbHNlKSk7DQogICAgICAgIGV4cHJlc3Npb25zLnB1c2gocGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDgxKTsNCiAgICB9DQogICAgew0KICAgICAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuUmF3LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA2NzE3NDQwOSk7DQogICAgICAgIHF1YXNpcy5wdXNoKHBhcnNlVGVtcGxhdGVFbGVtZW50KHBhcnNlciwgY29udGV4dCwgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHRydWUpKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgIHR5cGU6ICdUZW1wbGF0ZUxpdGVyYWwnLA0KICAgICAgICBleHByZXNzaW9ucywNCiAgICAgICAgcXVhc2lzDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRlbXBsYXRlRWxlbWVudChwYXJzZXIsIGNvbnRleHQsIGNvb2tlZCwgcmF3LCBzdGFydCwgbGluZSwgY29sLCB0YWlsKSB7DQogICAgY29uc3Qgbm9kZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sLCB7DQogICAgICAgIHR5cGU6ICdUZW1wbGF0ZUVsZW1lbnQnLA0KICAgICAgICB2YWx1ZTogew0KICAgICAgICAgICAgY29va2VkLA0KICAgICAgICAgICAgcmF3DQogICAgICAgIH0sDQogICAgICAgIHRhaWwNCiAgICB9KTsNCiAgICBjb25zdCB0YWlsU2l6ZSA9IHRhaWwgPyAxIDogMjsNCiAgICBpZiAoY29udGV4dCAmIDIpIHsNCiAgICAgICAgbm9kZS5zdGFydCArPSAxOw0KICAgICAgICBub2RlLnJhbmdlWzBdICs9IDE7DQogICAgICAgIG5vZGUuZW5kIC09IHRhaWxTaXplOw0KICAgICAgICBub2RlLnJhbmdlWzFdIC09IHRhaWxTaXplOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmIDQpIHsNCiAgICAgICAgbm9kZS5sb2Muc3RhcnQuY29sdW1uICs9IDE7DQogICAgICAgIG5vZGUubG9jLmVuZC5jb2x1bW4gLT0gdGFpbFNpemU7DQogICAgfQ0KICAgIHJldHVybiBub2RlOw0KfQ0KZnVuY3Rpb24gcGFyc2VTcHJlYWRFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTQpOw0KICAgIGNvbnN0IGFyZ3VtZW50ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnU3ByZWFkRWxlbWVudCcsDQogICAgICAgIGFyZ3VtZW50DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUFyZ3VtZW50cyhwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGFyZ3MgPSBbXTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNikgew0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgcmV0dXJuIGFyZ3M7DQogICAgfQ0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDE2KSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE0KSB7DQogICAgICAgICAgICBhcmdzLnB1c2gocGFyc2VTcHJlYWRFbGVtZW50KHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXJncy5wdXNoKHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNikNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIHJldHVybiBhcmdzOw0KfQ0KZnVuY3Rpb24gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgaXNQYXR0ZXJuKSB7DQogICAgY29uc3QgeyB0b2tlblZhbHVlLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBjb250ZXh0ICYgMjY4NDM1NDU2DQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLA0KICAgICAgICAgICAgbmFtZTogdG9rZW5WYWx1ZSwNCiAgICAgICAgICAgIHBhdHRlcm46IGlzUGF0dGVybiA9PT0gMQ0KICAgICAgICB9DQogICAgICAgIDogew0KICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLA0KICAgICAgICAgICAgbmFtZTogdG9rZW5WYWx1ZQ0KICAgICAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuUmF3LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTM0MjgzMzg5KSB7DQogICAgICAgIHJldHVybiBwYXJzZUJpZ0ludExpdGVyYWwocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgY29udGV4dCAmIDUxMg0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdMaXRlcmFsJywNCiAgICAgICAgICAgIHZhbHVlOiB0b2tlblZhbHVlLA0KICAgICAgICAgICAgcmF3OiB0b2tlblJhdw0KICAgICAgICB9DQogICAgICAgIDogew0KICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLA0KICAgICAgICAgICAgdmFsdWU6IHRva2VuVmFsdWUNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZU51bGxPclRydWVPckZhbHNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCByYXcgPSBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV07DQogICAgY29uc3QgdmFsdWUgPSBwYXJzZXIudG9rZW4gPT09IDg2MDIzID8gbnVsbCA6IHJhdyA9PT0gJ3RydWUnOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGNvbnRleHQgJiA1MTINCiAgICAgICAgPyB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZSwNCiAgICAgICAgICAgIHJhdw0KICAgICAgICB9DQogICAgICAgIDogew0KICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLA0KICAgICAgICAgICAgdmFsdWUNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRoaXNFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgdHlwZTogJ1RoaXNFeHByZXNzaW9uJw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgYWxsb3dHZW4sIGZsYWdzLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBpc0dlbmVyYXRvciA9IGFsbG93R2VuID8gb3B0aW9uYWxCaXQocGFyc2VyLCBjb250ZXh0LCA4NDU3MDE0KSA6IDA7DQogICAgbGV0IGlkID0gbnVsbDsNCiAgICBsZXQgZmlyc3RSZXN0cmljdGVkOw0KICAgIGxldCBmdW5jdGlvblNjb3BlID0gc2NvcGUgPyBjcmVhdGVTY29wZSgpIDogdm9pZCAwOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgIGlmICgoZmxhZ3MgJiAxKSA9PT0gMCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM3LCAnRnVuY3Rpb24nKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IGtpbmQgPSBvcmlnaW4gJiA0ICYmICgoY29udGV4dCAmIDgxOTIpID09PSAwIHx8IChjb250ZXh0ICYgMjA0OCkgPT09IDApDQogICAgICAgICAgICA/IDQNCiAgICAgICAgICAgIDogNjQ7DQogICAgICAgIHZhbGlkYXRlRnVuY3Rpb25OYW1lKHBhcnNlciwgY29udGV4dCB8ICgoY29udGV4dCAmIDMwNzIpIDw8IDExKSwgcGFyc2VyLnRva2VuKTsNCiAgICAgICAgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICBpZiAoa2luZCAmIDQpIHsNCiAgICAgICAgICAgICAgICBhZGRWYXJOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcnNlci50b2tlblZhbHVlLCBraW5kKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBwYXJzZXIudG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZ1bmN0aW9uU2NvcGUgPSBhZGRDaGlsZFNjb3BlKGZ1bmN0aW9uU2NvcGUsIDI1Nik7DQogICAgICAgICAgICBpZiAoZmxhZ3MpIHsNCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgIGRlY2xhcmVVbmJvdW5kVmFyaWFibGUocGFyc2VyLCBwYXJzZXIudG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZpcnN0UmVzdHJpY3RlZCA9IHBhcnNlci50b2tlbjsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgaWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnRleHQgPQ0KICAgICAgICAoKGNvbnRleHQgfCAzMjI0MzcxMikgXiAzMjI0MzcxMikgfA0KICAgICAgICAgICAgNjcxMDg4NjQgfA0KICAgICAgICAgICAgKChpc0FzeW5jICogMiArIGlzR2VuZXJhdG9yKSA8PCAyMSkgfA0KICAgICAgICAgICAgKGlzR2VuZXJhdG9yID8gMCA6IDEwNzM3NDE4MjQpOw0KICAgIGlmIChzY29wZSkNCiAgICAgICAgZnVuY3Rpb25TY29wZSA9IGFkZENoaWxkU2NvcGUoZnVuY3Rpb25TY29wZSwgNTEyKTsNCiAgICBjb25zdCBwYXJhbXMgPSBwYXJzZUZvcm1hbFBhcmFtZXRlcnNPckZvcm1hbExpc3QocGFyc2VyLCBjb250ZXh0IHwgODM4ODYwOCwgZnVuY3Rpb25TY29wZSwgMCwgMSk7DQogICAgY29uc3QgYm9keSA9IHBhcnNlRnVuY3Rpb25Cb2R5KHBhcnNlciwgKGNvbnRleHQgfCA4MTkyIHwgNDA5NiB8IDEzMTA3MikgXg0KICAgICAgICAoODE5MiB8IDQwOTYgfCAxMzEwNzIpLCBzY29wZSA/IGFkZENoaWxkU2NvcGUoZnVuY3Rpb25TY29wZSwgMTI4KSA6IGZ1bmN0aW9uU2NvcGUsIDgsIGZpcnN0UmVzdHJpY3RlZCwgc2NvcGUgPyBmdW5jdGlvblNjb3BlLnNjb3BlRXJyb3IgOiB2b2lkIDApOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRnVuY3Rpb25EZWNsYXJhdGlvbicsDQogICAgICAgIGlkLA0KICAgICAgICBwYXJhbXMsDQogICAgICAgIGJvZHksDQogICAgICAgIGFzeW5jOiBpc0FzeW5jID09PSAxLA0KICAgICAgICBnZW5lcmF0b3I6IGlzR2VuZXJhdG9yID09PSAxDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUZ1bmN0aW9uRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGlzQXN5bmMsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGlzR2VuZXJhdG9yID0gb3B0aW9uYWxCaXQocGFyc2VyLCBjb250ZXh0LCA4NDU3MDE0KTsNCiAgICBjb25zdCBnZW5lcmF0b3JBbmRBc3luY0ZsYWdzID0gKGlzQXN5bmMgKiAyICsgaXNHZW5lcmF0b3IpIDw8IDIxOw0KICAgIGxldCBpZCA9IG51bGw7DQogICAgbGV0IGZpcnN0UmVzdHJpY3RlZDsNCiAgICBsZXQgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBjcmVhdGVTY29wZSgpIDogdm9pZCAwOw0KICAgIGlmICgocGFyc2VyLnRva2VuICYgKDE0MzM2MCB8IDQwOTYgfCAzNjg2NCkpID4gMCkgew0KICAgICAgICB2YWxpZGF0ZUZ1bmN0aW9uTmFtZShwYXJzZXIsICgoY29udGV4dCB8IDB4MWVjMDAwMCkgXiAweDFlYzAwMDApIHwgZ2VuZXJhdG9yQW5kQXN5bmNGbGFncywgcGFyc2VyLnRva2VuKTsNCiAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgc2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCAyNTYpOw0KICAgICAgICBmaXJzdFJlc3RyaWN0ZWQgPSBwYXJzZXIudG9rZW47DQogICAgICAgIGlkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgfQ0KICAgIGNvbnRleHQgPQ0KICAgICAgICAoKGNvbnRleHQgfCAzMjI0MzcxMikgXiAzMjI0MzcxMikgfA0KICAgICAgICAgICAgNjcxMDg4NjQgfA0KICAgICAgICAgICAgZ2VuZXJhdG9yQW5kQXN5bmNGbGFncyB8DQogICAgICAgICAgICAoaXNHZW5lcmF0b3IgPyAwIDogMTA3Mzc0MTgyNCk7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBzY29wZSA9IGFkZENoaWxkU2NvcGUoc2NvcGUsIDUxMik7DQogICAgY29uc3QgcGFyYW1zID0gcGFyc2VGb3JtYWxQYXJhbWV0ZXJzT3JGb3JtYWxMaXN0KHBhcnNlciwgY29udGV4dCB8IDgzODg2MDgsIHNjb3BlLCBpbkdyb3VwLCAxKTsNCiAgICBjb25zdCBib2R5ID0gcGFyc2VGdW5jdGlvbkJvZHkocGFyc2VyLCBjb250ZXh0ICYgfigweDgwMDEwMDAgfCA4MTkyIHwgNDA5NiB8IDEzMTA3MiB8IDE2Mzg0KSwgc2NvcGUgPyBhZGRDaGlsZFNjb3BlKHNjb3BlLCAxMjgpIDogc2NvcGUsIDAsIGZpcnN0UmVzdHJpY3RlZCwgdm9pZCAwKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdGdW5jdGlvbkV4cHJlc3Npb24nLA0KICAgICAgICBpZCwNCiAgICAgICAgcGFyYW1zLA0KICAgICAgICBib2R5LA0KICAgICAgICBhc3luYzogaXNBc3luYyA9PT0gMSwNCiAgICAgICAgZ2VuZXJhdG9yOiBpc0dlbmVyYXRvciA9PT0gMQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VBcnJheUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBza2lwSW5pdGlhbGl6ZXIsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCBleHByID0gcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCB2b2lkIDAsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgMCwgMiwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKGNvbnRleHQgJiAyNTYgJiYgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDY0KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYxKTsNCiAgICB9DQogICAgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiA4KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYwKTsNCiAgICB9DQogICAgcmV0dXJuIGV4cHI7DQp9DQpmdW5jdGlvbiBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBza2lwSW5pdGlhbGl6ZXIsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBjb25zdCBlbGVtZW50cyA9IFtdOw0KICAgIGxldCBkZXN0cnVjdGlibGUgPSAwOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMjApIHsNCiAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE4KSkgew0KICAgICAgICAgICAgZWxlbWVudHMucHVzaChudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGxldCBsZWZ0Ow0KICAgICAgICAgICAgY29uc3QgeyB0b2tlbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgaWYgKHRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAxLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgbGVmdCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBpc1BhdHRlcm4NCiAgICAgICAgICAgICAgICAgICAgICAgID8gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50UGF0dGVybicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJz0nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgJiAyNTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMCB8IChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDEyOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAyMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgJiAyNTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMCB8IChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDEyOA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQgJiAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAzMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogKGtpbmQgJiAyKSA9PT0gMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMDsNCiAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgbGVmdCwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4ICYmIHBhcnNlci50b2tlbiAhPT0gMjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGxlZnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuICYgMjA5NzE1Mikgew0KICAgICAgICAgICAgICAgIGxlZnQgPQ0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gPT09IDIxNjI3MDANCiAgICAgICAgICAgICAgICAgICAgICAgID8gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPQ0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTYNCiAgICAgICAgICAgICAgICAgICAgICAgID8gMg0KICAgICAgICAgICAgICAgICAgICAgICAgOiAxOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMjApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiA4KSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDY5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGxlZnQsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuYXNzaWduYWJsZSAmIDIgPyAxNiA6IDA7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4ICYmIHBhcnNlci50b2tlbiAhPT0gMjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBsZWZ0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMzI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gMTQpIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDIwLCBraW5kLCBvcmlnaW4sIDAsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSAyMCkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSAyMCkgew0KICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgbGVmdCk7DQogICAgICAgICAgICAgICAgICAgIGlmICgoa2luZCAmICgyIHwgMSkpID09PSAwICYmIHRva2VuID09PSA2NzE3NDQxMSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAxICYmIGtpbmQgJiAoMiB8IDEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAzMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxlbWVudHMucHVzaChsZWZ0KTsNCiAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxOCkpIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMCkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDIwKTsNCiAgICBjb25zdCBub2RlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogaXNQYXR0ZXJuID8gJ0FycmF5UGF0dGVybicgOiAnQXJyYXlFeHByZXNzaW9uJywNCiAgICAgICAgZWxlbWVudHMNCiAgICB9KTsNCiAgICBpZiAoIXNraXBJbml0aWFsaXplciAmJiBwYXJzZXIudG9rZW4gJiA0MTk0MzA0KSB7DQogICAgICAgIHJldHVybiBwYXJzZUFycmF5T3JPYmplY3RBc3NpZ25tZW50UGF0dGVybihwYXJzZXIsIGNvbnRleHQsIGRlc3RydWN0aWJsZSwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBzdGFydCwgbGluZSwgY29sdW1uLCBub2RlKTsNCiAgICB9DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZTsNCiAgICByZXR1cm4gbm9kZTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXJyYXlPck9iamVjdEFzc2lnbm1lbnRQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgZGVzdHJ1Y3RpYmxlLCBpbkdyb3VwLCBpc1BhdHRlcm4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIG5vZGUpIHsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBpZiAoZGVzdHJ1Y3RpYmxlICYgMTYpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICBpZiAoIWlzUGF0dGVybikNCiAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4ocGFyc2VyLCBub2RlKTsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIGluR3JvdXAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPQ0KICAgICAgICAoKGRlc3RydWN0aWJsZSB8IDY0IHwgOCkgXg0KICAgICAgICAgICAgKDggfCA2NCkpIHwNCiAgICAgICAgICAgIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4ID8gMTI4IDogMCkgfA0KICAgICAgICAgICAgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAyNTYgPyAyNTYgOiAwKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGlzUGF0dGVybg0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50UGF0dGVybicsDQogICAgICAgICAgICBsZWZ0OiBub2RlLA0KICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50RXhwcmVzc2lvbicsDQogICAgICAgICAgICBsZWZ0OiBub2RlLA0KICAgICAgICAgICAgb3BlcmF0b3I6ICc9JywNCiAgICAgICAgICAgIHJpZ2h0DQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGNsb3NpbmdUb2tlbiwga2luZCwgb3JpZ2luLCBpc0FzeW5jLCBpbkdyb3VwLCBpc1BhdHRlcm4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGxldCBhcmd1bWVudCA9IG51bGw7DQogICAgbGV0IGRlc3RydWN0aWJsZSA9IDA7DQogICAgbGV0IHsgdG9rZW4sIHRva2VuVmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBpZiAodG9rZW4gJiAoNDA5NiB8IDE0MzM2MCkpIHsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICBhcmd1bWVudCA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgdG9rZW4gPSBwYXJzZXIudG9rZW47DQogICAgICAgIGFyZ3VtZW50ID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBhcmd1bWVudCwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4ICYmIHBhcnNlci50b2tlbiAhPT0gY2xvc2luZ1Rva2VuKSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyICYmIHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1NykNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2OSk7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGFyZ3VtZW50KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IGNsb3NpbmdUb2tlbiB8fCB0b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICBhZGRWYXJPckJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHRva2VuVmFsdWUsIGtpbmQsIG9yaWdpbik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMzI7DQogICAgICAgIH0NCiAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjggPyAxMjggOiAwOw0KICAgIH0NCiAgICBlbHNlIGlmICh0b2tlbiA9PT0gY2xvc2luZ1Rva2VuKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDM5KTsNCiAgICB9DQogICAgZWxzZSBpZiAodG9rZW4gJiAyMDk3MTUyKSB7DQogICAgICAgIGFyZ3VtZW50ID0NCiAgICAgICAgICAgIHBhcnNlci50b2tlbiA9PT0gMjE2MjcwMA0KICAgICAgICAgICAgICAgID8gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgIDogcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICB0b2tlbiA9IHBhcnNlci50b2tlbjsNCiAgICAgICAgaWYgKHRva2VuICE9PSAxMDc3OTM2MTU3ICYmIHRva2VuICE9PSBjbG9zaW5nVG9rZW4gJiYgdG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDgpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjkpOw0KICAgICAgICAgICAgYXJndW1lbnQgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGFyZ3VtZW50LCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuYXNzaWduYWJsZSAmIDIgPyAxNiA6IDA7DQogICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1NykNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIGFyZ3VtZW50ID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgYXJndW1lbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA4NDU0MTQ0KSA9PT0gODQ1NDE0NCkgew0KICAgICAgICAgICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIDQsIHRva2VuLCBhcmd1bWVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMikpIHsNCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnQgPSBwYXJzZUNvbmRpdGlvbmFsRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGFyZ3VtZW50LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMg0KICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgIGNsb3NpbmdUb2tlbiA9PT0gMTA3NDc5MDQxNSAmJiB0b2tlbiAhPT0gMTA3NzkzNjE1Nw0KICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgIDogcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDMyOw0KICAgICAgICBhcmd1bWVudCA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIGluR3JvdXAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmICh0b2tlbiA9PT0gMTA3NzkzNjE1NyAmJiB0b2tlbiAhPT0gY2xvc2luZ1Rva2VuICYmIHRva2VuICE9PSAxOCkgew0KICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGFyZ3VtZW50KTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0b2tlbiAhPT0gY2xvc2luZ1Rva2VuKSB7DQogICAgICAgICAgICAgICAgYXJndW1lbnQgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBhcmd1bWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDEgPyAzMiA6IDE2Ow0KICAgICAgICB9DQogICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGU7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IGNsb3NpbmdUb2tlbiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTU2KTsNCiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiBpc1BhdHRlcm4gPyAnUmVzdEVsZW1lbnQnIDogJ1NwcmVhZEVsZW1lbnQnLA0KICAgICAgICAgICAgYXJndW1lbnQ6IGFyZ3VtZW50DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSBjbG9zaW5nVG9rZW4pIHsNCiAgICAgICAgaWYgKGtpbmQgJiAxKQ0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IGlzQXN5bmMgPyAxNiA6IDMyOw0KICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTA3NzkzNjE1NykpIHsNCiAgICAgICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiAxNikNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihwYXJzZXIsIGFyZ3VtZW50KTsNCiAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBhcmd1bWVudCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBpc1BhdHRlcm4NCiAgICAgICAgICAgICAgICA/IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgICAgICAgICAgbGVmdDogYXJndW1lbnQsDQogICAgICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIDogew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiBhcmd1bWVudCwNCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc9JywNCiAgICAgICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IDE2Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGU7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6IGlzUGF0dGVybiA/ICdSZXN0RWxlbWVudCcgOiAnU3ByZWFkRWxlbWVudCcsDQogICAgICAgIGFyZ3VtZW50OiBhcmd1bWVudA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IG1vZGlmaWVyRmxhZ3MgPSAoa2luZCAmIDY0KSA9PT0gMCA/IDMxOTgxNTY4IDogMTQ2ODAwNjQ7DQogICAgY29udGV4dCA9DQogICAgICAgICgoY29udGV4dCB8IG1vZGlmaWVyRmxhZ3MpIF4gbW9kaWZpZXJGbGFncykgfA0KICAgICAgICAgICAgKChraW5kICYgODgpIDw8IDE4KSB8DQogICAgICAgICAgICAxMDA5MjU0NDA7DQogICAgbGV0IHNjb3BlID0gY29udGV4dCAmIDY0ID8gYWRkQ2hpbGRTY29wZShjcmVhdGVTY29wZSgpLCA1MTIpIDogdm9pZCAwOw0KICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlTWV0aG9kRm9ybWFscyhwYXJzZXIsIGNvbnRleHQgfCA4Mzg4NjA4LCBzY29wZSwga2luZCwgMSwgaW5Hcm91cCk7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBzY29wZSA9IGFkZENoaWxkU2NvcGUoc2NvcGUsIDEyOCk7DQogICAgY29uc3QgYm9keSA9IHBhcnNlRnVuY3Rpb25Cb2R5KHBhcnNlciwgY29udGV4dCAmIH4oMHg4MDAxMDAwIHwgODE5MiksIHNjb3BlLCAwLCB2b2lkIDAsIHZvaWQgMCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdGdW5jdGlvbkV4cHJlc3Npb24nLA0KICAgICAgICBwYXJhbXMsDQogICAgICAgIGJvZHksDQogICAgICAgIGFzeW5jOiAoa2luZCAmIDE2KSA+IDAsDQogICAgICAgIGdlbmVyYXRvcjogKGtpbmQgJiA4KSA+IDAsDQogICAgICAgIGlkOiBudWxsDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZU9iamVjdExpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBza2lwSW5pdGlhbGl6ZXIsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCBleHByID0gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgdm9pZCAwLCBza2lwSW5pdGlhbGl6ZXIsIGluR3JvdXAsIDAsIDIsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChjb250ZXh0ICYgMjU2ICYmIHBhcnNlci5kZXN0cnVjdGlibGUgJiA2NCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA2MSk7DQogICAgfQ0KICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgOCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA2MCk7DQogICAgfQ0KICAgIHJldHVybiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW107DQogICAgbGV0IGRlc3RydWN0aWJsZSA9IDA7DQogICAgbGV0IHByb3RvdHlwZUNvdW50ID0gMDsNCiAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4Ow0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgY29uc3QgeyB0b2tlbiwgdG9rZW5WYWx1ZSwgbGluZVBvcywgY29sUG9zLCB0b2tlblBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBpZiAodG9rZW4gPT09IDE0KSB7DQogICAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2gocGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEwNzQ3OTA0MTUsIGtpbmQsIG9yaWdpbiwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBsZXQgc3RhdGUgPSAwOw0KICAgICAgICAgICAgbGV0IGtleSA9IG51bGw7DQogICAgICAgICAgICBsZXQgdmFsdWU7DQogICAgICAgICAgICBjb25zdCB0ID0gcGFyc2VyLnRva2VuOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCA0MDk2KSB8fCBwYXJzZXIudG9rZW4gPT09IDEyMSkgew0KICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gNDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0ICYmICh0b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVCaW5kaW5nSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIHRva2VuLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRWYXJPckJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHRva2VuVmFsdWUsIGtpbmQsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMDc3OTM2MTU3KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDg7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDAgfCAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDEyOCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTI4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBjb250ZXh0ICYgLTIxNDc0ODM2NDggPyBPYmplY3QuYXNzaWduKHt9LCBrZXkpIDoga2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbiA9PT0gMjA5MDA4ID8gMTI4IDogMCkgfA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodG9rZW4gPT09IDEyMSA/IDE2IDogMCk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNvbnRleHQgJiAtMjE0NzQ4MzY0OCA/IE9iamVjdC5hc3NpZ24oe30sIGtleSkgOiBrZXk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjEpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5WYWx1ZSA9PT0gJ19fcHJvdG9fXycpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm90b3R5cGVDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b2tlbkFmdGVyQ29sb24gPSBwYXJzZXIudG9rZW47DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZUFmdGVyQ29sb24gPSBwYXJzZXIudG9rZW5WYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSB0ID09PSAxMjEgPyAxNiA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDEwNzc5MzYxNTcgfHwgdG9rZW4gPT09IDEwNzQ3OTA0MTUgfHwgdG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4ID8gMTI4IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjb3BlICYmICh0b2tlbkFmdGVyQ29sb24gJiAxNDMzNjApID09PSAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdmFsdWVBZnRlckNvbG9uLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMzINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiA0MTk0MzA0KSA9PT0gNDE5NDMwNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiAhPT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdmFsdWVBZnRlckNvbG9uLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDg0NTQxNDQpID09PSA4NDU0MTQ0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgNCwgdG9rZW4sIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgMjA5NzE1MikgPT09IDIwOTcxNTIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlICYgMTYgPyAyIDogMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiA4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuYXNzaWduYWJsZSAmIDIgPyAxNiA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA0MTk0MzA0KSA9PT0gNDE5NDMwNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgNCwgdG9rZW4sIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlICYgMiA/IDE2IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCAmJiB0b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMjA5MDA3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAodG9rZW4gPT09IDEyNDAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAyNTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRva2VuID09PSAxMjQwMw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDUxMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDEpIHwgMjsNCiAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFyc2VDb21wdXRlZFByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApOw0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmFzc2lnbmFibGU7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gJiAoMTQzMzYwIHwgNDA5NikpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDEyMSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDkzKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSAyMDkwMDcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyOSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID09PSAxMjQwMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0b2tlbiA9PT0gMTI0MDMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyA1MTINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWV0aG9kRGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDg0NTcwMTQpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDEyNDAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0MCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDEyNDAzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0MSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDE0MzQ4Mykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgOTMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgOCB8IDEgfCAodG9rZW4gPT09IDIwOTAwNyA/IDE2IDogMCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDI7DQogICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmFzc2lnbmFibGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWV0aG9kRGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDIwOTAwNykNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPT09IDEyNDAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAyNTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRva2VuID09PSAxMjQwMw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDUxMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDE7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTMwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4KSB7DQogICAgICAgICAgICAgICAga2V5ID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjEpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjEpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuVmFsdWUgPT09ICdfX3Byb3RvX18nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvdG90eXBlQ291bnQrKzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgMCwgMSwgMCwgaW5Hcm91cCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblZhbHVlOiB2YWx1ZUFmdGVyQ29sb24gfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDEwNzc5MzYxNTcgfHwgdG9rZW4gPT09IDEwNzQ3OTA0MTUgfHwgdG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB2YWx1ZUFmdGVyQ29sb24sIGtpbmQsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAzMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAyMDk3MTUyKSA9PT0gMjA5NzE1Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgJiAxNiA/IDIgOiAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci5kZXN0cnVjdGlibGUgJiA4KSAhPT0gOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmFzc2lnbmFibGUgJiAyID8gMTYgOiAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgNDE5NDMwNCkgPT09IDQxOTQzMDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDg0NTQxNDQpID09PSA4NDU0MTQ0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIDQsIHRva2VuLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUNvbmRpdGlvbmFsRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDMyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAzMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuYXNzaWduYWJsZSAmIDEgPyAwIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuYXNzaWduYWJsZSB8IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTMxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgICAgICAgICAga2V5ID0gcGFyc2VDb21wdXRlZFByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApOw0KICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMjU2ID8gMjU2IDogMDsNCiAgICAgICAgICAgICAgICBzdGF0ZSB8PSAyOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxKSB7DQogICAgICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdG9rZW5WYWx1ZSwgdG9rZW46IHRva2VuQWZ0ZXJDb2xvbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0b2tlbiA9PT0gMTA3NzkzNjE1Nw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTA3NzkzNjE1NyB8fCB0b2tlbiA9PT0gMTA3NDc5MDQxNSB8fCB0b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjb3BlICYmICh0b2tlbkFmdGVyQ29sb24gJiAxNDMzNjApID09PSAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDIwOTcxNTIpID09PSAyMDk3MTUyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuID09PSA2OTI3MTU3MQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHBhcnNlT2JqZWN0TGl0ZXJhbE9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuZGVzdHJ1Y3RpYmxlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSAmIDE2ID8gMiA6IDE7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChkZXN0cnVjdGlibGUgJiA4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDIgPyBkZXN0cnVjdGlibGUgfCAxNiA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA0MTk0MzA0KSA9PT0gNDE5NDMwNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgNCwgdG9rZW4sIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlICYgMSA/IDAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCAmJiBwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1NykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gODQ1NzAxNCkgew0KICAgICAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDg0NTcwMTQpOw0KICAgICAgICAgICAgICAgIHN0YXRlIHw9IDg7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHRva2VuLCBsaW5lLCBpbmRleCB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0TWVzc2FnZUF0KGluZGV4LCBsaW5lLCBpbmRleCwgdG9rZW4gPT09IDIwOTAwNw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gNDQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRva2VuID09PSAxMjQwMiB8fCBwYXJzZXIudG9rZW4gPT09IDEyNDAzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gNDMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiA0NSwgS2V5d29yZERlc2NUYWJsZVt0b2tlbiAmIDI1NV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAyIHwgMTsNCiAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFyc2VDb21wdXRlZFByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWV0aG9kRGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyMyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbdG9rZW4gJiAyNTVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4ID8gMTI4IDogMDsNCiAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGU7DQogICAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnUHJvcGVydHknLA0KICAgICAgICAgICAgICAgIGtleToga2V5LA0KICAgICAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgICAgIGtpbmQ6ICEoc3RhdGUgJiA3NjgpID8gJ2luaXQnIDogc3RhdGUgJiA1MTIgPyAnc2V0JyA6ICdnZXQnLA0KICAgICAgICAgICAgICAgIGNvbXB1dGVkOiAoc3RhdGUgJiAyKSA+IDAsDQogICAgICAgICAgICAgICAgbWV0aG9kOiAoc3RhdGUgJiAxKSA+IDAsDQogICAgICAgICAgICAgICAgc2hvcnRoYW5kOiAoc3RhdGUgJiA0KSA+IDANCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgfQ0KICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTgpDQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICBpZiAocHJvdG90eXBlQ291bnQgPiAxKQ0KICAgICAgICBkZXN0cnVjdGlibGUgfD0gNjQ7DQogICAgY29uc3Qgbm9kZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6IGlzUGF0dGVybiA/ICdPYmplY3RQYXR0ZXJuJyA6ICdPYmplY3RFeHByZXNzaW9uJywNCiAgICAgICAgcHJvcGVydGllcw0KICAgIH0pOw0KICAgIGlmICghc2tpcEluaXRpYWxpemVyICYmIHBhcnNlci50b2tlbiAmIDQxOTQzMDQpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlQXJyYXlPck9iamVjdEFzc2lnbm1lbnRQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgZGVzdHJ1Y3RpYmxlLCBpbkdyb3VwLCBpc1BhdHRlcm4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIG5vZGUpOw0KICAgIH0NCiAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlID0gZGVzdHJ1Y3RpYmxlOw0KICAgIHJldHVybiBub2RlOw0KfQ0KZnVuY3Rpb24gcGFyc2VNZXRob2RGb3JtYWxzKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQsIHR5cGUsIGluR3JvdXApIHsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgNjcxNzQ0MTEpOw0KICAgIGNvbnN0IHBhcmFtcyA9IFtdOw0KICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAxMjgpIF4gMTI4Ow0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE2KSB7DQogICAgICAgIGlmIChraW5kICYgNTEyKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzNSwgJ1NldHRlcicsICdvbmUnLCAnJyk7DQogICAgICAgIH0NCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIHJldHVybiBwYXJhbXM7DQogICAgfQ0KICAgIGlmIChraW5kICYgMjU2KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDM1LCAnR2V0dGVyJywgJ25vJywgJ3MnKTsNCiAgICB9DQogICAgaWYgKGtpbmQgJiA1MTIgJiYgcGFyc2VyLnRva2VuID09PSAxNCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAzNik7DQogICAgfQ0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgbGV0IHNldHRlckFyZ3MgPSAwOw0KICAgIGxldCBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAwOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgIGxldCBsZWZ0ID0gbnVsbDsNCiAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgIGlmICgoY29udGV4dCAmIDEwMjQpID09PSAwKSB7DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAzNjg2NCkgPT09IDM2ODY0KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyNTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSA1MTI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGVmdCA9IHBhcnNlQW5kQ2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQgfCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxNjI3MDApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIGluR3JvdXAsIDEsIHR5cGUsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxLCBpbkdyb3VwLCAxLCB0eXBlLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gMTQpIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCB0eXBlLCAwLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmICgzMiB8IDE2KSkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0OCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgbGVmdCA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgICAgICBsZWZ0OiBsZWZ0LA0KICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBzZXR0ZXJBcmdzKys7DQogICAgICAgIHBhcmFtcy5wdXNoKGxlZnQpOw0KICAgICAgICBpZiAoIWNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxOCkpDQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTYpIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChraW5kICYgNTEyICYmIHNldHRlckFyZ3MgIT09IDEpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMzUsICdTZXR0ZXInLCAnb25lJywgJycpOw0KICAgIH0NCiAgICBpZiAoc2NvcGUgJiYgc2NvcGUuc2NvcGVFcnJvciAhPT0gdm9pZCAwKQ0KICAgICAgICByZXBvcnRTY29wZUVycm9yKHNjb3BlLnNjb3BlRXJyb3IpOw0KICAgIGlmIChpc1NpbXBsZVBhcmFtZXRlckxpc3QpDQogICAgICAgIHBhcnNlci5mbGFncyB8PSAxMjg7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICByZXR1cm4gcGFyYW1zOw0KfQ0KZnVuY3Rpb24gcGFyc2VDb21wdXRlZFByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGtleSA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyOCwgMSwgMCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDIwKTsNCiAgICByZXR1cm4ga2V5Ow0KfQ0KZnVuY3Rpb24gcGFyc2VQYXJlbnRoZXNpemVkRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwga2luZCwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEyOCkgXiAxMjg7DQogICAgY29uc3QgeyB0b2tlblBvczogcGlTdGFydCwgbGluZVBvczogcGxTdGFydCwgY29sUG9zOiBwY1N0YXJ0IH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4IHwgMTA3Mzc0MTgyNCk7DQogICAgY29uc3Qgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBhZGRDaGlsZFNjb3BlKGNyZWF0ZVNjb3BlKCksIDEwMjQpIDogdm9pZCAwOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxNikpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlUGFyZW50aGVzaXplZEFycm93KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIFtdLCBjYW5Bc3NpZ24sIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBsZXQgZGVzdHJ1Y3RpYmxlID0gMDsNCiAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlICY9IH4oMjU2IHwgMTI4KTsNCiAgICBsZXQgZXhwcjsNCiAgICBsZXQgZXhwcmVzc2lvbnMgPSBbXTsNCiAgICBsZXQgaXNTZXF1ZW5jZSA9IDA7DQogICAgbGV0IGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDA7DQogICAgY29uc3QgeyB0b2tlblBvczogaVN0YXJ0LCBsaW5lUG9zOiBsU3RhcnQsIGNvbFBvczogY1N0YXJ0IH0gPSBwYXJzZXI7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDE2KSB7DQogICAgICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgaWYgKHRva2VuICYgKDE0MzM2MCB8IDQwOTYpKSB7DQogICAgICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICAgICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcnNlci50b2tlblZhbHVlLCAxLCAwKTsNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgMCwgMSwgMCwgMSwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNiB8fCBwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCh0b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCB8fA0KICAgICAgICAgICAgICAgICAgICAodG9rZW4gJiAzNjg2NCkgPT09IDM2ODY0KSB7DQogICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBleHByID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxNiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgZXhwcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKCh0b2tlbiAmIDIwOTcxNTIpID09PSAyMDk3MTUyKSB7DQogICAgICAgICAgICBleHByID0NCiAgICAgICAgICAgICAgICB0b2tlbiA9PT0gMjE2MjcwMA0KICAgICAgICAgICAgICAgICAgICA/IHBhcnNlT2JqZWN0TGl0ZXJhbE9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQgfCAxMDczNzQxODI0LCBzY29wZSwgMCwgMSwgMCwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgICAgICA6IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCB8IDEwNzM3NDE4MjQsIHNjb3BlLCAwLCAxLCAwLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTYgJiYgcGFyc2VyLnRva2VuICE9PSAxOCkgew0KICAgICAgICAgICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiA4KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTkpOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxNiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgZXhwcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHRva2VuID09PSAxNCkgew0KICAgICAgICAgICAgZXhwciA9IHBhcnNlU3ByZWFkT3JSZXN0RWxlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxNiwga2luZCwgb3JpZ2luLCAwLCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTYpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNzIpOw0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgIGlmIChpc1NlcXVlbmNlICYmIChwYXJzZXIudG9rZW4gPT09IDE2IHx8IHBhcnNlci50b2tlbiA9PT0gMTgpKSB7DQogICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChleHByKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSA4Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICBleHByID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICBpZiAoaXNTZXF1ZW5jZSAmJiAocGFyc2VyLnRva2VuID09PSAxNiB8fCBwYXJzZXIudG9rZW4gPT09IDE4KSkgew0KICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goZXhwcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgIGlmICghaXNTZXF1ZW5jZSkgew0KICAgICAgICAgICAgICAgICAgICBpc1NlcXVlbmNlID0gMTsNCiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMgPSBbZXhwcl07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGlzU2VxdWVuY2UpIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTgpKSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2gocGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICAgICAgZXhwciA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBpU3RhcnQsIGxTdGFydCwgY1N0YXJ0LCB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdTZXF1ZW5jZUV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGU7DQogICAgICAgICAgICByZXR1cm4gZXhwcjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNTZXF1ZW5jZSAmJiAocGFyc2VyLnRva2VuID09PSAxNiB8fCBwYXJzZXIudG9rZW4gPT09IDE4KSkgew0KICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChleHByKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE4KSkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBpZiAoIWlzU2VxdWVuY2UpIHsNCiAgICAgICAgICAgIGlzU2VxdWVuY2UgPSAxOw0KICAgICAgICAgICAgZXhwcmVzc2lvbnMgPSBbZXhwcl07DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTYpIHsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSA4Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGlzU2VxdWVuY2UpIHsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICBleHByID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIGlTdGFydCwgbFN0YXJ0LCBjU3RhcnQsIHsNCiAgICAgICAgICAgIHR5cGU6ICdTZXF1ZW5jZUV4cHJlc3Npb24nLA0KICAgICAgICAgICAgZXhwcmVzc2lvbnMNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxNik7DQogICAgaWYgKGRlc3RydWN0aWJsZSAmIDE2ICYmIGRlc3RydWN0aWJsZSAmIDgpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDE0Nik7DQogICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgJiAyNTYNCiAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICA6IDAgfCAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDEyOCkNCiAgICAgICAgICAgICAgICA/IDEyOA0KICAgICAgICAgICAgICAgIDogMDsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMCkgew0KICAgICAgICBpZiAoZGVzdHJ1Y3RpYmxlICYgKDMyIHwgMTYpKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDcpOw0KICAgICAgICBpZiAoY29udGV4dCAmICg0MTk0MzA0IHwgMjA0OCkgJiYgZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjkpOw0KICAgICAgICBpZiAoY29udGV4dCAmICgxMDI0IHwgMjA5NzE1MikgJiYgZGVzdHJ1Y3RpYmxlICYgMjU2KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzU2ltcGxlUGFyYW1ldGVyTGlzdCkNCiAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAxMjg7DQogICAgICAgIHJldHVybiBwYXJzZVBhcmVudGhlc2l6ZWRBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBpc1NlcXVlbmNlID8gZXhwcmVzc2lvbnMgOiBbZXhwcl0sIGNhbkFzc2lnbiwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQwKTsNCiAgICB9DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9ICgocGFyc2VyLmRlc3RydWN0aWJsZSB8IDI1NikgXiAyNTYpIHwgZGVzdHJ1Y3RpYmxlOw0KICAgIHJldHVybiBjb250ZXh0ICYgMTI4DQogICAgICAgID8gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHBpU3RhcnQsIHBsU3RhcnQsIHBjU3RhcnQsIHsNCiAgICAgICAgICAgIHR5cGU6ICdQYXJlbnRoZXNpemVkRXhwcmVzc2lvbicsDQogICAgICAgICAgICBleHByZXNzaW9uOiBleHByDQogICAgICAgIH0pDQogICAgICAgIDogZXhwcjsNCn0NCmZ1bmN0aW9uIHBhcnNlSWRlbnRpZmllck9yQXJyb3cocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgY29uc3QgZXhwciA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMCkgew0KICAgICAgICBsZXQgc2NvcGUgPSB2b2lkIDA7DQogICAgICAgIGlmIChjb250ZXh0ICYgNjQpDQogICAgICAgICAgICBzY29wZSA9IGNyZWF0ZUFycm93SGVhZFBhcnNpbmdTY29wZShwYXJzZXIsIGNvbnRleHQsIHRva2VuVmFsdWUpOw0KICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMTI4KSBeIDEyODsNCiAgICAgICAgcmV0dXJuIHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgW2V4cHJdLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgcmV0dXJuIGV4cHI7DQp9DQpmdW5jdGlvbiBwYXJzZUFycm93RnJvbUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgZXhwciwgaW5OZXcsIGNhbkFzc2lnbiwgaXNBc3luYywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmICghY2FuQXNzaWduKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA1NSk7DQogICAgaWYgKGluTmV3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA0OSk7DQogICAgcGFyc2VyLmZsYWdzICY9IH4xMjg7DQogICAgY29uc3Qgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBjcmVhdGVBcnJvd0hlYWRQYXJzaW5nU2NvcGUocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSkgOiB2b2lkIDA7DQogICAgcmV0dXJuIHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgW2V4cHJdLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlUGFyZW50aGVzaXplZEFycm93KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcmFtcywgY2FuQXNzaWduLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKCFjYW5Bc3NpZ24pDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDU1KTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7ICsraSkNCiAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4ocGFyc2VyLCBwYXJhbXNbaV0pOw0KICAgIHJldHVybiBwYXJzZUFycm93RnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcmFtcywgaXNBc3luYywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUFycm93RnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcmFtcywgaXNBc3luYywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIuZmxhZ3MgJiAxKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA0Nik7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTApOw0KICAgIGNvbnRleHQgPSAoKGNvbnRleHQgfCAxNTcyODY0MCkgXiAxNTcyODY0MCkgfCAoaXNBc3luYyA8PCAyMik7DQogICAgY29uc3QgZXhwcmVzc2lvbiA9IHBhcnNlci50b2tlbiAhPT0gMjE2MjcwMDsNCiAgICBsZXQgYm9keTsNCiAgICBpZiAoc2NvcGUgJiYgc2NvcGUuc2NvcGVFcnJvciAhPT0gdm9pZCAwKSB7DQogICAgICAgIHJlcG9ydFNjb3BlRXJyb3Ioc2NvcGUuc2NvcGVFcnJvcik7DQogICAgfQ0KICAgIGlmIChleHByZXNzaW9uKSB7DQogICAgICAgIGJvZHkgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgMTI4KTsNCiAgICAgICAgYm9keSA9IHBhcnNlRnVuY3Rpb25Cb2R5KHBhcnNlciwgKGNvbnRleHQgfCAxMzQyMjE4MjQgfCA4MTkyIHwgMTYzODQpIF4NCiAgICAgICAgICAgICgxMzQyMjE4MjQgfCA4MTkyIHwgMTYzODQpLCBzY29wZSwgMTYsIHZvaWQgMCwgdm9pZCAwKTsNCiAgICAgICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgICAgIGNhc2UgNjkyNzE1NzE6DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIuZmxhZ3MgJiAxKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgNjcxMDg4Nzc6DQogICAgICAgICAgICBjYXNlIDY3MTc0NDA5Og0KICAgICAgICAgICAgY2FzZSAyMjoNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTQpOw0KICAgICAgICAgICAgY2FzZSA2NzE3NDQxMToNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExMyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAxMDI0Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQgJiYgKHBhcnNlci5mbGFncyAmIDEpID09PSAwKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMzM2MTk5NjgpID09PSAzMzYxOTk2OCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyMik7DQogICAgfQ0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0Fycm93RnVuY3Rpb25FeHByZXNzaW9uJywNCiAgICAgICAgcGFyYW1zLA0KICAgICAgICBib2R5LA0KICAgICAgICBhc3luYzogaXNBc3luYyA9PT0gMSwNCiAgICAgICAgZXhwcmVzc2lvbg0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VGb3JtYWxQYXJhbWV0ZXJzT3JGb3JtYWxMaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGluR3JvdXAsIGtpbmQpIHsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgNjcxNzQ0MTEpOw0KICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAxMjgpIF4gMTI4Ow0KICAgIGNvbnN0IHBhcmFtcyA9IFtdOw0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTYpKQ0KICAgICAgICByZXR1cm4gcGFyYW1zOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgbGV0IGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDA7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTgpIHsNCiAgICAgICAgbGV0IGxlZnQ7DQogICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICBpZiAoKGNvbnRleHQgJiAxMDI0KSA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gMjU2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gNTEyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxlZnQgPSBwYXJzZUFuZENsYXNzaWZ5SWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBraW5kIHwgMSwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMTYyNzAwKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlT2JqZWN0TGl0ZXJhbE9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxLCBpbkdyb3VwLCAxLCBraW5kLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgaW5Hcm91cCwgMSwga2luZCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDE0KSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlU3ByZWFkT3JSZXN0RWxlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxNiwga2luZCwgMCwgMCwgaW5Hcm91cCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmICgzMiB8IDE2KSkgew0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQ4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBsZWZ0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgICAgIGxlZnQsDQogICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHBhcmFtcy5wdXNoKGxlZnQpOw0KICAgICAgICBpZiAoIWNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxOCkpDQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTYpIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChpc1NpbXBsZVBhcmFtZXRlckxpc3QpDQogICAgICAgIHBhcnNlci5mbGFncyB8PSAxMjg7DQogICAgaWYgKHNjb3BlICYmIChpc1NpbXBsZVBhcmFtZXRlckxpc3QgfHwgY29udGV4dCAmIDEwMjQpICYmIHNjb3BlLnNjb3BlRXJyb3IgIT09IHZvaWQgMCkgew0KICAgICAgICByZXBvcnRTY29wZUVycm9yKHNjb3BlLnNjb3BlRXJyb3IpOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIHJldHVybiBwYXJhbXM7DQp9DQpmdW5jdGlvbiBwYXJzZU1lbWJlRXhwcmVzc2lvbk5vQ2FsbChwYXJzZXIsIGNvbnRleHQsIGV4cHIsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuIH0gPSBwYXJzZXI7DQogICAgaWYgKHRva2VuICYgNjcxMDg4NjQpIHsNCiAgICAgICAgaWYgKHRva2VuID09PSA2NzEwODg3Nykgew0KICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDEwNzM3NDE4MjQpOw0KICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZVByb3BlcnR5T3JQcml2YXRlUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VNZW1iZUV4cHJlc3Npb25Ob0NhbGwocGFyc2VyLCBjb250ZXh0LCBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICBvYmplY3Q6IGV4cHIsDQogICAgICAgICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHByb3BlcnR5DQogICAgICAgICAgICB9KSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMCk7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VNZW1iZUV4cHJlc3Npb25Ob0NhbGwocGFyc2VyLCBjb250ZXh0LCBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICBvYmplY3Q6IGV4cHIsDQogICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsDQogICAgICAgICAgICAgICAgcHJvcGVydHkNCiAgICAgICAgICAgIH0pLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gNjcxNzQ0MDggfHwgdG9rZW4gPT09IDY3MTc0NDA5KSB7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VNZW1iZUV4cHJlc3Npb25Ob0NhbGwocGFyc2VyLCBjb250ZXh0LCBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgIHRhZzogZXhwciwNCiAgICAgICAgICAgICAgICBxdWFzaTogcGFyc2VyLnRva2VuID09PSA2NzE3NDQwOA0KICAgICAgICAgICAgICAgICAgICA/IHBhcnNlVGVtcGxhdGUocGFyc2VyLCBjb250ZXh0IHwgNjU1MzYpDQogICAgICAgICAgICAgICAgICAgIDogcGFyc2VUZW1wbGF0ZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICAgICAgfSksIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VOZXdFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IGlkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAwKTsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDY3MTA4ODc3KSkgew0KICAgICAgICBpZiAoY29udGV4dCAmIDY3MTA4ODY0ICYmIHBhcnNlci50b2tlbiA9PT0gMTQzNDk0KSB7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VNZXRhUHJvcGVydHkocGFyc2VyLCBjb250ZXh0LCBpZCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTIpOw0KICAgIH0NCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAxNjg0Mjc1MikgPT09IDE2ODQyNzUyKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYzLCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIH0NCiAgICBjb25zdCBleHByID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDIsIDEsIDAsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxMDg5OTEpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDE2Myk7DQogICAgY29uc3QgY2FsbGVlID0gcGFyc2VNZW1iZUV4cHJlc3Npb25Ob0NhbGwocGFyc2VyLCBjb250ZXh0LCBleHByLCBpbkdyb3VwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdOZXdFeHByZXNzaW9uJywNCiAgICAgICAgY2FsbGVlLA0KICAgICAgICBhcmd1bWVudHM6IHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEgPyBwYXJzZUFyZ3VtZW50cyhwYXJzZXIsIGNvbnRleHQsIGluR3JvdXApIDogW10NCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTWV0YVByb3BlcnR5KHBhcnNlciwgY29udGV4dCwgbWV0YSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdNZXRhUHJvcGVydHknLA0KICAgICAgICBtZXRhLA0KICAgICAgICBwcm9wZXJ0eQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VBc3luY0Fycm93QWZ0ZXJJZGVudChwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIwOTAwOCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMjkpOw0KICAgIGlmIChjb250ZXh0ICYgKDEwMjQgfCAyMDk3MTUyKSAmJiBwYXJzZXIudG9rZW4gPT09IDI0MTc3Mykgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAzMCk7DQogICAgfQ0KICAgIGlmICgocGFyc2VyLnRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgIHBhcnNlci5mbGFncyB8PSA1MTI7DQogICAgfQ0KICAgIHJldHVybiBwYXJzZUFycm93RnJvbUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5WYWx1ZSwgcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCksIDAsIGNhbkFzc2lnbiwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUFzeW5jQXJyb3dPckNhbGxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FsbGVlLCBjYW5Bc3NpZ24sIGtpbmQsIG9yaWdpbiwgZmxhZ3MsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IHNjb3BlID0gY29udGV4dCAmIDY0ID8gYWRkQ2hpbGRTY29wZShjcmVhdGVTY29wZSgpLCAxMDI0KSA6IHZvaWQgMDsNCiAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4Ow0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTYpKSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgICAgICBpZiAoZmxhZ3MgJiAxKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQ2KTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVBhcmVudGhlc2l6ZWRBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBbXSwgY2FuQXNzaWduLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsDQogICAgICAgICAgICBjYWxsZWUsDQogICAgICAgICAgICBhcmd1bWVudHM6IFtdDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBsZXQgZGVzdHJ1Y3RpYmxlID0gMDsNCiAgICBsZXQgZXhwciA9IG51bGw7DQogICAgbGV0IGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDA7DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9DQogICAgICAgIChwYXJzZXIuZGVzdHJ1Y3RpYmxlIHwgMjU2IHwgMTI4KSBeDQogICAgICAgICAgICAoMjU2IHwgMTI4KTsNCiAgICBjb25zdCBwYXJhbXMgPSBbXTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxNikgew0KICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmICh0b2tlbiAmICgxNDMzNjAgfCA0MDk2KSkgew0KICAgICAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgICAgIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBwYXJzZXIudG9rZW5WYWx1ZSwga2luZCwgMCk7DQogICAgICAgICAgICBleHByID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIDAsIDEsIDAsIDEsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTYgfHwgcGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgodG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDUxMjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKHRva2VuICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gMjU2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMSwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTYgJiYgcGFyc2VyLnRva2VuICE9PSAxOCkgew0KICAgICAgICAgICAgICAgICAgICBleHByID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGV4cHIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0b2tlbiAmIDIwOTcxNTIpIHsNCiAgICAgICAgICAgIGV4cHIgPQ0KICAgICAgICAgICAgICAgIHRva2VuID09PSAyMTYyNzAwDQogICAgICAgICAgICAgICAgICAgID8gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIDEsIDAsIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykNCiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCAxLCAwLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTYgJiYgcGFyc2VyLnRva2VuICE9PSAxOCkgew0KICAgICAgICAgICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiA4KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTkpOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDg0NTQxNDQpID09PSA4NDU0MTQ0KSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCBzdGFydCwgbGluZSwgY29sdW1uLCA0LCB0b2tlbiwgZXhwcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMikpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHRva2VuID09PSAxNCkgew0KICAgICAgICAgICAgZXhwciA9IHBhcnNlU3ByZWFkT3JSZXN0RWxlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxNiwga2luZCwgb3JpZ2luLCAxLCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAocGFyc2VyLnRva2VuID09PSAxNiA/IDAgOiAxNikgfCBwYXJzZXIuZGVzdHJ1Y3RpYmxlOw0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlOw0KICAgICAgICAgICAgcGFyYW1zLnB1c2goZXhwcik7DQogICAgICAgICAgICB3aGlsZSAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTgpKSB7DQogICAgICAgICAgICAgICAgcGFyYW1zLnB1c2gocGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5hc3NpZ25hYmxlOw0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGUgfCAxNjsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgY2FsbGVlLA0KICAgICAgICAgICAgICAgIGFyZ3VtZW50czogcGFyYW1zDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJhbXMucHVzaChleHByKTsNCiAgICAgICAgaWYgKCFjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxOCkpDQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1Ng0KICAgICAgICAgICAgPyAyNTYNCiAgICAgICAgICAgIDogMCB8IChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgICAgID8gMTI4DQogICAgICAgICAgICAgICAgOiAwOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiAoMzIgfCAxNikpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNSk7DQogICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiAxIHx8IGZsYWdzICYgMSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQ2KTsNCiAgICAgICAgaWYgKGRlc3RydWN0aWJsZSAmIDEyOCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI5KTsNCiAgICAgICAgaWYgKGNvbnRleHQgJiAoMTAyNCB8IDIwOTcxNTIpICYmIGRlc3RydWN0aWJsZSAmIDI1NikNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMwKTsNCiAgICAgICAgaWYgKGlzU2ltcGxlUGFyYW1ldGVyTGlzdCkNCiAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAxMjg7DQogICAgICAgIHJldHVybiBwYXJzZVBhcmVudGhlc2l6ZWRBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBwYXJhbXMsIGNhbkFzc2lnbiwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjApOw0KICAgIH0NCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsDQogICAgICAgIGNhbGxlZSwNCiAgICAgICAgYXJndW1lbnRzOiBwYXJhbXMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlUmVnRXhwTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuUmF3LCB0b2tlblJlZ0V4cCwgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gY29udGV4dCAmIDUxMg0KICAgICAgICA/IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZTogdG9rZW5WYWx1ZSwNCiAgICAgICAgICAgIHJlZ2V4OiB0b2tlblJlZ0V4cCwNCiAgICAgICAgICAgIHJhdzogdG9rZW5SYXcNCiAgICAgICAgfSkNCiAgICAgICAgOiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLA0KICAgICAgICAgICAgdmFsdWU6IHRva2VuVmFsdWUsDQogICAgICAgICAgICByZWdleDogdG9rZW5SZWdFeHANCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUNsYXNzRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgZmxhZ3MsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxNjc3NzIxNiB8IDEwMjQpIF4gMTY3NzcyMTY7DQogICAgbGV0IGRlY29yYXRvcnMgPSBwYXJzZURlY29yYXRvcnMocGFyc2VyLCBjb250ZXh0KTsNCiAgICBpZiAoZGVjb3JhdG9ycy5sZW5ndGgpIHsNCiAgICAgICAgc3RhcnQgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgICAgIGxpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICAgICAgY29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICB9DQogICAgaWYgKHBhcnNlci5sZWFkaW5nRGVjb3JhdG9ycy5sZW5ndGgpIHsNCiAgICAgICAgcGFyc2VyLmxlYWRpbmdEZWNvcmF0b3JzLnB1c2goLi4uZGVjb3JhdG9ycyk7DQogICAgICAgIGRlY29yYXRvcnMgPSBwYXJzZXIubGVhZGluZ0RlY29yYXRvcnM7DQogICAgICAgIHBhcnNlci5sZWFkaW5nRGVjb3JhdG9ycyA9IFtdOw0KICAgIH0NCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBsZXQgaWQgPSBudWxsOw0KICAgIGxldCBzdXBlckNsYXNzID0gbnVsbDsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUgfSA9IHBhcnNlcjsNCiAgICBpZiAocGFyc2VyLnRva2VuICYgNDA5NiAmJiBwYXJzZXIudG9rZW4gIT09IDIwNTY3KSB7DQogICAgICAgIGlmIChpc1N0cmljdFJlc2VydmVkV29yZChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlbikpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICBhZGRCbG9ja05hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwgMzIsIDApOw0KICAgICAgICAgICAgaWYgKGZsYWdzKSB7DQogICAgICAgICAgICAgICAgaWYgKGZsYWdzICYgMikgew0KICAgICAgICAgICAgICAgICAgICBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwgdG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpZiAoKGZsYWdzICYgMSkgPT09IDApDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzNywgJ0NsYXNzJyk7DQogICAgfQ0KICAgIGxldCBpbmhlcml0ZWRDb250ZXh0ID0gY29udGV4dDsNCiAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjA1NjcpKSB7DQogICAgICAgIHN1cGVyQ2xhc3MgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgaW5oZXJpdGVkQ29udGV4dCB8PSA1MjQyODg7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpbmhlcml0ZWRDb250ZXh0ID0gKGluaGVyaXRlZENvbnRleHQgfCA1MjQyODgpIF4gNTI0Mjg4Ow0KICAgIH0NCiAgICBjb25zdCBib2R5ID0gcGFyc2VDbGFzc0JvZHkocGFyc2VyLCBpbmhlcml0ZWRDb250ZXh0LCBjb250ZXh0LCBzY29wZSwgMiwgOCwgMCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBjb250ZXh0ICYgMQ0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdDbGFzc0RlY2xhcmF0aW9uJywNCiAgICAgICAgICAgIGlkLA0KICAgICAgICAgICAgc3VwZXJDbGFzcywNCiAgICAgICAgICAgIGRlY29yYXRvcnMsDQogICAgICAgICAgICBib2R5DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnQ2xhc3NEZWNsYXJhdGlvbicsDQogICAgICAgICAgICBpZCwNCiAgICAgICAgICAgIHN1cGVyQ2xhc3MsDQogICAgICAgICAgICBib2R5DQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VDbGFzc0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IGlkID0gbnVsbDsNCiAgICBsZXQgc3VwZXJDbGFzcyA9IG51bGw7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTAyNCB8IDE2Nzc3MjE2KSBeIDE2Nzc3MjE2Ow0KICAgIGNvbnN0IGRlY29yYXRvcnMgPSBwYXJzZURlY29yYXRvcnMocGFyc2VyLCBjb250ZXh0KTsNCiAgICBpZiAoZGVjb3JhdG9ycy5sZW5ndGgpIHsNCiAgICAgICAgc3RhcnQgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgICAgIGxpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICAgICAgY29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICB9DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgaWYgKHBhcnNlci50b2tlbiAmIDQwOTYgJiYgcGFyc2VyLnRva2VuICE9PSAyMDU2Nykgew0KICAgICAgICBpZiAoaXNTdHJpY3RSZXNlcnZlZFdvcmQocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW4pKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIH0NCiAgICAgICAgaWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICB9DQogICAgbGV0IGluaGVyaXRlZENvbnRleHQgPSBjb250ZXh0Ow0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMDU2NykpIHsNCiAgICAgICAgc3VwZXJDbGFzcyA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIGluR3JvdXAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICBpbmhlcml0ZWRDb250ZXh0IHw9IDUyNDI4ODsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGluaGVyaXRlZENvbnRleHQgPSAoaW5oZXJpdGVkQ29udGV4dCB8IDUyNDI4OCkgXiA1MjQyODg7DQogICAgfQ0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUNsYXNzQm9keShwYXJzZXIsIGluaGVyaXRlZENvbnRleHQsIGNvbnRleHQsIHZvaWQgMCwgMiwgMCwgaW5Hcm91cCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgY29udGV4dCAmIDENCiAgICAgICAgPyB7DQogICAgICAgICAgICB0eXBlOiAnQ2xhc3NFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGlkLA0KICAgICAgICAgICAgc3VwZXJDbGFzcywNCiAgICAgICAgICAgIGRlY29yYXRvcnMsDQogICAgICAgICAgICBib2R5DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnQ2xhc3NFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGlkLA0KICAgICAgICAgICAgc3VwZXJDbGFzcywNCiAgICAgICAgICAgIGJvZHkNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZURlY29yYXRvcnMocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgbGlzdCA9IFtdOw0KICAgIGlmIChjb250ZXh0ICYgMSkgew0KICAgICAgICB3aGlsZSAocGFyc2VyLnRva2VuID09PSAxMzMpIHsNCiAgICAgICAgICAgIGxpc3QucHVzaChwYXJzZURlY29yYXRvckxpc3QocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGxpc3Q7DQp9DQpmdW5jdGlvbiBwYXJzZURlY29yYXRvckxpc3QocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBsZXQgZXhwcmVzc2lvbiA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAyLCAwLCAxLCAwLCAwLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBleHByZXNzaW9uID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByZXNzaW9uLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0RlY29yYXRvcicsDQogICAgICAgIGV4cHJlc3Npb24NCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQ2xhc3NCb2R5KHBhcnNlciwgY29udGV4dCwgaW5oZXJpdGVkQ29udGV4dCwgc2NvcGUsIGtpbmQsIG9yaWdpbiwgaW5Hcm91cCkgew0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIxNjI3MDApOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgbGV0IGhhc0NvbnN0ciA9IHBhcnNlci5mbGFncyAmIDMyOw0KICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAzMikgXiAzMjsNCiAgICBjb25zdCBib2R5ID0gW107DQogICAgbGV0IGRlY29yYXRvcnM7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICBsZXQgbGVuZ3RoID0gMDsNCiAgICAgICAgZGVjb3JhdG9ycyA9IHBhcnNlRGVjb3JhdG9ycyhwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICBsZW5ndGggPSBkZWNvcmF0b3JzLmxlbmd0aDsNCiAgICAgICAgaWYgKGxlbmd0aCA+IDAgJiYgcGFyc2VyLnRva2VuVmFsdWUgPT09ICdjb25zdHJ1Y3RvcicpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwNyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwNik7DQogICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTA3NDc5MDQxNykpIHsNCiAgICAgICAgICAgIGlmIChsZW5ndGggPiAwKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNyk7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBib2R5LnB1c2gocGFyc2VDbGFzc0VsZW1lbnRMaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGluaGVyaXRlZENvbnRleHQsIGtpbmQsIGRlY29yYXRvcnMsIDAsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIG9yaWdpbiAmIDggPyBjb250ZXh0IHwgMzI3NjggOiBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzICYgfjMyKSB8IGhhc0NvbnN0cjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgdHlwZTogJ0NsYXNzQm9keScsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQ2xhc3NFbGVtZW50TGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBpbmhlcml0ZWRDb250ZXh0LCB0eXBlLCBkZWNvcmF0b3JzLCBpc1N0YXRpYywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCBraW5kID0gaXNTdGF0aWMgPyAzMiA6IDA7DQogICAgbGV0IGtleSA9IG51bGw7DQogICAgY29uc3QgeyB0b2tlbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGlmICh0b2tlbiAmICgxNDMzNjAgfCAzNjg2NCkpIHsNCiAgICAgICAga2V5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIHN3aXRjaCAodG9rZW4pIHsNCiAgICAgICAgICAgIGNhc2UgMzY5NzI6DQogICAgICAgICAgICAgICAgaWYgKCFpc1N0YXRpYyAmJg0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gIT09IDY3MTc0NDExICYmDQogICAgICAgICAgICAgICAgICAgIChwYXJzZXIudG9rZW4gJiAxMDQ4NTc2KSAhPT0gMTA0ODU3NiAmJg0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlQ2xhc3NFbGVtZW50TGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBpbmhlcml0ZWRDb250ZXh0LCB0eXBlLCBkZWNvcmF0b3JzLCAxLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDIwOTAwNzoNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSA2NzE3NDQxMSAmJiAocGFyc2VyLmZsYWdzICYgMSkgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxICYmIChwYXJzZXIudG9rZW4gJiAxMDczNzQxODI0KSA9PT0gMTA3Mzc0MTgyNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlUHJvcGVydHlEZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwga2V5LCBraW5kLCBkZWNvcmF0b3JzLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBraW5kIHw9IDE2IHwgKG9wdGlvbmFsQml0KHBhcnNlciwgY29udGV4dCwgODQ1NzAxNCkgPyA4IDogMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAxMjQwMjoNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEgJiYgKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpID09PSAxMDczNzQxODI0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VQcm9wZXJ0eURlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBrZXksIGtpbmQsIGRlY29yYXRvcnMsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGtpbmQgfD0gMjU2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTI0MDM6DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxICYmIChwYXJzZXIudG9rZW4gJiAxMDczNzQxODI0KSA9PT0gMTA3Mzc0MTgyNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlUHJvcGVydHlEZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwga2V5LCBraW5kLCBkZWNvcmF0b3JzLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBraW5kIHw9IDUxMjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAodG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgIGtpbmQgfD0gMjsNCiAgICAgICAga2V5ID0gcGFyc2VDb21wdXRlZFByb3BlcnR5TmFtZShwYXJzZXIsIGluaGVyaXRlZENvbnRleHQsIGluR3JvdXApOw0KICAgIH0NCiAgICBlbHNlIGlmICgodG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAga2V5ID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHRva2VuID09PSA4NDU3MDE0KSB7DQogICAgICAgIGtpbmQgfD0gODsNCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGNvbnRleHQgJiAxICYmIHBhcnNlci50b2tlbiA9PT0gMTMxKSB7DQogICAgICAgIGtpbmQgfD0gNDA5NjsNCiAgICAgICAga2V5ID0gcGFyc2VQcml2YXRlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQgfCAxNjM4NCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGNvbnRleHQgJiAxICYmIChwYXJzZXIudG9rZW4gJiAxMDczNzQxODI0KSA9PT0gMTA3Mzc0MTgyNCkgew0KICAgICAgICBraW5kIHw9IDEyODsNCiAgICB9DQogICAgZWxzZSBpZiAoaXNTdGF0aWMgJiYgdG9rZW4gPT09IDIxNjI3MDApIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlU3RhdGljQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHRva2VuID09PSAxMjIpIHsNCiAgICAgICAga2V5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDY3MTc0NDExKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgaWYgKGtpbmQgJiAoOCB8IDE2IHwgNzY4KSkgew0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICBrZXkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4KSB7DQogICAgICAgICAgICBrZXkgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgICAgICBraW5kIHw9IDI7DQogICAgICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSAxMjIpIHsNCiAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGNvbnRleHQgJiAxICYmIHBhcnNlci50b2tlbiA9PT0gMTMxKSB7DQogICAgICAgICAgICBraW5kIHw9IDQwOTY7DQogICAgICAgICAgICBrZXkgPSBwYXJzZVByaXZhdGVJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTMyKTsNCiAgICB9DQogICAgaWYgKChraW5kICYgMikgPT09IDApIHsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlblZhbHVlID09PSAnY29uc3RydWN0b3InKSB7DQogICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpID09PSAxMDczNzQxODI0KSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTI2KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKChraW5kICYgMzIpID09PSAwICYmIHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICBpZiAoa2luZCAmICg3NjggfCAxNiB8IDEyOCB8IDgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDUxLCAnYWNjZXNzb3InKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKGNvbnRleHQgJiA1MjQyODgpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiAzMikNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDUyKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDMyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGtpbmQgfD0gNjQ7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKGtpbmQgJiA0MDk2KSA9PT0gMCAmJg0KICAgICAgICAgICAga2luZCAmICgzMiB8IDc2OCB8IDggfCAxNikgJiYNCiAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlID09PSAncHJvdG90eXBlJykgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNTApOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgMSAmJiBwYXJzZXIudG9rZW4gIT09IDY3MTc0NDExKSB7DQogICAgICAgIHJldHVybiBwYXJzZVByb3BlcnR5RGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIGtleSwga2luZCwgZGVjb3JhdG9ycywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgfQ0KICAgIGNvbnN0IHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBjb250ZXh0ICYgMQ0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdNZXRob2REZWZpbml0aW9uJywNCiAgICAgICAgICAgIGtpbmQ6IChraW5kICYgMzIpID09PSAwICYmIGtpbmQgJiA2NA0KICAgICAgICAgICAgICAgID8gJ2NvbnN0cnVjdG9yJw0KICAgICAgICAgICAgICAgIDoga2luZCAmIDI1Ng0KICAgICAgICAgICAgICAgICAgICA/ICdnZXQnDQogICAgICAgICAgICAgICAgICAgIDoga2luZCAmIDUxMg0KICAgICAgICAgICAgICAgICAgICAgICAgPyAnc2V0Jw0KICAgICAgICAgICAgICAgICAgICAgICAgOiAnbWV0aG9kJywNCiAgICAgICAgICAgIHN0YXRpYzogKGtpbmQgJiAzMikgPiAwLA0KICAgICAgICAgICAgY29tcHV0ZWQ6IChraW5kICYgMikgPiAwLA0KICAgICAgICAgICAga2V5LA0KICAgICAgICAgICAgZGVjb3JhdG9ycywNCiAgICAgICAgICAgIHZhbHVlDQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnTWV0aG9kRGVmaW5pdGlvbicsDQogICAgICAgICAgICBraW5kOiAoa2luZCAmIDMyKSA9PT0gMCAmJiBraW5kICYgNjQNCiAgICAgICAgICAgICAgICA/ICdjb25zdHJ1Y3RvcicNCiAgICAgICAgICAgICAgICA6IGtpbmQgJiAyNTYNCiAgICAgICAgICAgICAgICAgICAgPyAnZ2V0Jw0KICAgICAgICAgICAgICAgICAgICA6IGtpbmQgJiA1MTINCiAgICAgICAgICAgICAgICAgICAgICAgID8gJ3NldCcNCiAgICAgICAgICAgICAgICAgICAgICAgIDogJ21ldGhvZCcsDQogICAgICAgICAgICBzdGF0aWM6IChraW5kICYgMzIpID4gMCwNCiAgICAgICAgICAgIGNvbXB1dGVkOiAoa2luZCAmIDIpID4gMCwNCiAgICAgICAgICAgIGtleSwNCiAgICAgICAgICAgIHZhbHVlDQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VQcml2YXRlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUgfSA9IHBhcnNlcjsNCiAgICBpZiAodG9rZW5WYWx1ZSA9PT0gJ2NvbnN0cnVjdG9yJykNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTI1KTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1ByaXZhdGVJZGVudGlmaWVyJywNCiAgICAgICAgbmFtZTogdG9rZW5WYWx1ZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VQcm9wZXJ0eURlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBrZXksIHN0YXRlLCBkZWNvcmF0b3JzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IHZhbHVlID0gbnVsbDsNCiAgICBpZiAoc3RhdGUgJiA4KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA1MzcwNzk5MjgpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICB2YWx1ZSA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTYzODQsIDIsIDAsIDEsIDAsIDAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpICE9PSAxMDczNzQxODI0KSB7DQogICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCB8IDE2Mzg0LCB2YWx1ZSwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTYzODQsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1Byb3BlcnR5RGVmaW5pdGlvbicsDQogICAgICAgIGtleSwNCiAgICAgICAgdmFsdWUsDQogICAgICAgIHN0YXRpYzogKHN0YXRlICYgMzIpID4gMCwNCiAgICAgICAgY29tcHV0ZWQ6IChzdGF0ZSAmIDIpID4gMCwNCiAgICAgICAgZGVjb3JhdG9ycw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VCaW5kaW5nUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0eXBlLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKQ0KICAgICAgICByZXR1cm4gcGFyc2VBbmRDbGFzc2lmeUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdHlwZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAoKHBhcnNlci50b2tlbiAmIDIwOTcxNTIpICE9PSAyMDk3MTUyKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICBjb25zdCBsZWZ0ID0gcGFyc2VyLnRva2VuID09PSA2OTI3MTU3MQ0KICAgICAgICA/IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIDAsIDEsIHR5cGUsIG9yaWdpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikNCiAgICAgICAgOiBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgMCwgMSwgdHlwZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDE2KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA0OCk7DQogICAgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAzMikNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNDgpOw0KICAgIHJldHVybiBsZWZ0Ow0KfQ0KZnVuY3Rpb24gcGFyc2VBbmRDbGFzc2lmeUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyB0b2tlblZhbHVlLCB0b2tlbiB9ID0gcGFyc2VyOw0KICAgIGlmIChjb250ZXh0ICYgMTAyNCkgew0KICAgICAgICBpZiAoKHRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKCh0b2tlbiAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCh0b2tlbiAmIDIwNDgwKSA9PT0gMjA0ODApIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTAwKTsNCiAgICB9DQogICAgaWYgKGNvbnRleHQgJiAoMjA0OCB8IDIwOTcxNTIpICYmIHRva2VuID09PSAyNDE3NzMpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMzApOw0KICAgIH0NCiAgICBpZiAodG9rZW4gPT09IDI0MTczOSkgew0KICAgICAgICBpZiAoa2luZCAmICg4IHwgMTYpKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgOTgpOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICg0MTk0MzA0IHwgMjA0OCkgJiYgdG9rZW4gPT09IDIwOTAwOCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA5Nik7DQogICAgfQ0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChzY29wZSkNCiAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCBraW5kLCBvcmlnaW4pOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsDQogICAgICAgIG5hbWU6IHRva2VuVmFsdWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYUm9vdEVsZW1lbnRPckZyYWdtZW50KHBhcnNlciwgY29udGV4dCwgaW5KU1hDaGlsZCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg0NTYyNTkpIHsNCiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnSlNYRnJhZ21lbnQnLA0KICAgICAgICAgICAgb3BlbmluZ0ZyYWdtZW50OiBwYXJzZU9wZW5pbmdGcmFnbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pLA0KICAgICAgICAgICAgY2hpbGRyZW46IHBhcnNlSlNYQ2hpbGRyZW4ocGFyc2VyLCBjb250ZXh0KSwNCiAgICAgICAgICAgIGNsb3NpbmdGcmFnbWVudDogcGFyc2VKU1hDbG9zaW5nRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgbGV0IGNsb3NpbmdFbGVtZW50ID0gbnVsbDsNCiAgICBsZXQgY2hpbGRyZW4gPSBbXTsNCiAgICBjb25zdCBvcGVuaW5nRWxlbWVudCA9IHBhcnNlSlNYT3BlbmluZ0ZyYWdtZW50T3JTZWxmQ2xvc2VFbGVtZW50KHBhcnNlciwgY29udGV4dCwgaW5KU1hDaGlsZCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKCFvcGVuaW5nRWxlbWVudC5zZWxmQ2xvc2luZykgew0KICAgICAgICBjaGlsZHJlbiA9IHBhcnNlSlNYQ2hpbGRyZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgY2xvc2luZ0VsZW1lbnQgPSBwYXJzZUpTWENsb3NpbmdFbGVtZW50KHBhcnNlciwgY29udGV4dCwgaW5KU1hDaGlsZCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGNvbnN0IGNsb3NlID0gaXNFcXVhbFRhZ05hbWUoY2xvc2luZ0VsZW1lbnQubmFtZSk7DQogICAgICAgIGlmIChpc0VxdWFsVGFnTmFtZShvcGVuaW5nRWxlbWVudC5uYW1lKSAhPT0gY2xvc2UpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNTAsIGNsb3NlKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hFbGVtZW50JywNCiAgICAgICAgY2hpbGRyZW4sDQogICAgICAgIG9wZW5pbmdFbGVtZW50LA0KICAgICAgICBjbG9zaW5nRWxlbWVudA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VPcGVuaW5nRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hPcGVuaW5nRnJhZ21lbnQnDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWENsb3NpbmdFbGVtZW50KHBhcnNlciwgY29udGV4dCwgaW5KU1hDaGlsZCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyNSk7DQogICAgY29uc3QgbmFtZSA9IHBhcnNlSlNYRWxlbWVudE5hbWUocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBpZiAoaW5KU1hDaGlsZCkgew0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgODQ1NjI1OSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBwYXJzZXIudG9rZW4gPSBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hDbG9zaW5nRWxlbWVudCcsDQogICAgICAgIG5hbWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYQ2xvc2luZ0ZyYWdtZW50KHBhcnNlciwgY29udGV4dCwgaW5KU1hDaGlsZCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyNSk7DQogICAgaWYgKGluSlNYQ2hpbGQpIHsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDg0NTYyNTkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDg0NTYyNTkpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWENsb3NpbmdGcmFnbWVudCcNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYQ2hpbGRyZW4ocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAyNSkgew0KICAgICAgICBwYXJzZXIuaW5kZXggPSBwYXJzZXIudG9rZW5Qb3MgPSBwYXJzZXIuc3RhcnRQb3M7DQogICAgICAgIHBhcnNlci5jb2x1bW4gPSBwYXJzZXIuY29sUG9zID0gcGFyc2VyLnN0YXJ0Q29sdW1uOw0KICAgICAgICBwYXJzZXIubGluZSA9IHBhcnNlci5saW5lUG9zID0gcGFyc2VyLnN0YXJ0TGluZTsNCiAgICAgICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIGNoaWxkcmVuLnB1c2gocGFyc2VKU1hDaGlsZChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICB9DQogICAgcmV0dXJuIGNoaWxkcmVuOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hDaGlsZChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMzgpDQogICAgICAgIHJldHVybiBwYXJzZUpTWFRleHQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMTYyNzAwKQ0KICAgICAgICByZXR1cm4gcGFyc2VKU1hFeHByZXNzaW9uQ29udGFpbmVyKHBhcnNlciwgY29udGV4dCwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODQ1NjI1OCkNCiAgICAgICAgcmV0dXJuIHBhcnNlSlNYUm9vdEVsZW1lbnRPckZyYWdtZW50KHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgcmVwb3J0KHBhcnNlciwgMCk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWFRleHQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3Qgbm9kZSA9IHsNCiAgICAgICAgdHlwZTogJ0pTWFRleHQnLA0KICAgICAgICB2YWx1ZTogcGFyc2VyLnRva2VuVmFsdWUNCiAgICB9Ow0KICAgIGlmIChjb250ZXh0ICYgNTEyKSB7DQogICAgICAgIG5vZGUucmF3ID0gcGFyc2VyLnRva2VuUmF3Ow0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIG5vZGUpOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hPcGVuaW5nRnJhZ21lbnRPclNlbGZDbG9zZUVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAxNDMzNjApICE9PSAxNDMzNjAgJiYgKHBhcnNlci50b2tlbiAmIDQwOTYpICE9PSA0MDk2KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICBjb25zdCB0YWdOYW1lID0gcGFyc2VKU1hFbGVtZW50TmFtZShwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBwYXJzZUpTWEF0dHJpYnV0ZXMocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdCBzZWxmQ2xvc2luZyA9IHBhcnNlci50b2tlbiA9PT0gODQ1NzAxNjsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA4NDU2MjU5KSB7DQogICAgICAgIHNjYW5KU1hUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDg0NTcwMTYpOw0KICAgICAgICBpZiAoaW5KU1hDaGlsZCkgew0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDg0NTYyNTkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hPcGVuaW5nRWxlbWVudCcsDQogICAgICAgIG5hbWU6IHRhZ05hbWUsDQogICAgICAgIGF0dHJpYnV0ZXMsDQogICAgICAgIHNlbGZDbG9zaW5nDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWEVsZW1lbnROYW1lKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIHNjYW5KU1hJZGVudGlmaWVyKHBhcnNlcik7DQogICAgbGV0IGtleSA9IHBhcnNlSlNYSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxKQ0KICAgICAgICByZXR1cm4gcGFyc2VKU1hOYW1lc3BhY2VkTmFtZShwYXJzZXIsIGNvbnRleHQsIGtleSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgd2hpbGUgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCA2NzEwODg3NykpIHsNCiAgICAgICAgc2NhbkpTWElkZW50aWZpZXIocGFyc2VyKTsNCiAgICAgICAga2V5ID0gcGFyc2VKU1hNZW1iZXJFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwga2V5LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgcmV0dXJuIGtleTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYTWVtYmVyRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIG9iamVjdCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VKU1hJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgb2JqZWN0LA0KICAgICAgICBwcm9wZXJ0eQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hBdHRyaWJ1dGVzKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBbXTsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSA4NDU3MDE2ICYmIHBhcnNlci50b2tlbiAhPT0gODQ1NjI1OSAmJiBwYXJzZXIudG9rZW4gIT09IDEwNDg1NzYpIHsNCiAgICAgICAgYXR0cmlidXRlcy5wdXNoKHBhcnNlSnN4QXR0cmlidXRlKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgIH0NCiAgICByZXR1cm4gYXR0cmlidXRlczsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYU3ByZWFkQXR0cmlidXRlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxNCk7DQogICAgY29uc3QgZXhwcmVzc2lvbiA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWFNwcmVhZEF0dHJpYnV0ZScsDQogICAgICAgIGFyZ3VtZW50OiBleHByZXNzaW9uDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpzeEF0dHJpYnV0ZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMTYyNzAwKQ0KICAgICAgICByZXR1cm4gcGFyc2VKU1hTcHJlYWRBdHRyaWJ1dGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBzY2FuSlNYSWRlbnRpZmllcihwYXJzZXIpOw0KICAgIGxldCB2YWx1ZSA9IG51bGw7DQogICAgbGV0IG5hbWUgPSBwYXJzZUpTWElkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMSkgew0KICAgICAgICBuYW1lID0gcGFyc2VKU1hOYW1lc3BhY2VkTmFtZShwYXJzZXIsIGNvbnRleHQsIG5hbWUsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgIGNvbnN0IHRva2VuID0gc2NhbkpTWEF0dHJpYnV0ZVZhbHVlKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBzd2l0Y2ggKHRva2VuKSB7DQogICAgICAgICAgICBjYXNlIDEzNDI4MzI2NzoNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSA4NDU2MjU4Og0KICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VKU1hSb290RWxlbWVudE9yRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlSlNYRXhwcmVzc2lvbkNvbnRhaW5lcihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYQXR0cmlidXRlJywNCiAgICAgICAgdmFsdWUsDQogICAgICAgIG5hbWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYTmFtZXNwYWNlZE5hbWUocGFyc2VyLCBjb250ZXh0LCBuYW1lc3BhY2UsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMjEpOw0KICAgIGNvbnN0IG5hbWUgPSBwYXJzZUpTWElkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWE5hbWVzcGFjZWROYW1lJywNCiAgICAgICAgbmFtZXNwYWNlLA0KICAgICAgICBuYW1lDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWEV4cHJlc3Npb25Db250YWluZXIocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBpc0F0dHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE0KQ0KICAgICAgICByZXR1cm4gcGFyc2VKU1hTcHJlYWRDaGlsZChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGxldCBleHByZXNzaW9uID0gbnVsbDsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KSB7DQogICAgICAgIGlmIChpc0F0dHIpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNTIpOw0KICAgICAgICBleHByZXNzaW9uID0gcGFyc2VKU1hFbXB0eUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIuc3RhcnRQb3MsIHBhcnNlci5zdGFydExpbmUsIHBhcnNlci5zdGFydENvbHVtbik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBleHByZXNzaW9uID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgfQ0KICAgIGlmIChpbkpTWENoaWxkKSB7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHNjYW5KU1hUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWEV4cHJlc3Npb25Db250YWluZXInLA0KICAgICAgICBleHByZXNzaW9uDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWFNwcmVhZENoaWxkKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxNCk7DQogICAgY29uc3QgZXhwcmVzc2lvbiA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWFNwcmVhZENoaWxkJywNCiAgICAgICAgZXhwcmVzc2lvbg0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hFbXB0eUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgcGFyc2VyLnN0YXJ0UG9zID0gcGFyc2VyLnRva2VuUG9zOw0KICAgIHBhcnNlci5zdGFydExpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICBwYXJzZXIuc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYRW1wdHlFeHByZXNzaW9uJw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYSWRlbnRpZmllcicsDQogICAgICAgIG5hbWU6IHRva2VuVmFsdWUNCiAgICB9KTsNCn0KZnVuY3Rpb24gcGFyc2VTY3JpcHQoc291cmNlLCBvcHRpb25zKSB7DQogICAgcmV0dXJuIHBhcnNlU291cmNlKHNvdXJjZSwgb3B0aW9ucywgMCk7DQp9Cgpjb25zdCBzeW1ib2xOb1Jlc3VsdCA9IFN5bWJvbCgic3ltYm9sTm9SZXN1bHQiKTsKY29uc3Qgc3ltYm9sUmVzdWx0ID0gU3ltYm9sKCJzeW1ib2xSZXN1bHQiKTsKZnVuY3Rpb24gcmVzdWx0KG5vZGUpIHsKICBub2RlW3N5bWJvbFJlc3VsdF0gPSB0cnVlOwogIHJldHVybiBub2RlOwp9CmNsYXNzIEFjb3JuQ29udGV4dCB7CiAgbm9kZTsKICBwYXJlbnQ7CiAgcGFyZW50S2V5OwogIGF0dGFjaGVkOwogIHJvb3Q7CiAgc3RhY2s7CiAgZW50cmllczsKICBjb25zdHJ1Y3Rvcihub2RlLCBwYXJlbnQsIHBhcmVudEtleSwgc3RhY2ssIHJvb3QgPSBmYWxzZSkgewogICAgdGhpcy5ub2RlID0gbm9kZTsKICAgIHRoaXMuc3RhY2sgPSBzdGFjazsKICAgIHRoaXMuZW50cmllcyA9IFtdOwogICAgaWYgKHBhcmVudCkgewogICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgICAgdGhpcy5wYXJlbnRLZXkgPSBwYXJlbnRLZXk7CiAgICAgIHRoaXMuYXR0YWNoZWQgPSB0cnVlOwogICAgfSBlbHNlIGlmICghcm9vdCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJOZXcgcGFyZW50IGlzbnQgYW4gaW5zdGFuY2Ugb2YgQWNvcm5Db250ZXh0LiIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5hdHRhY2hlZCA9IGZhbHNlOwogICAgfQogICAgdGhpcy5yb290ID0gcm9vdDsKICB9CiAgLy8gb25seSB1c2VkIGJ5IGFycmF5KCkgYW5kIGluZGV4KCkKICBnZXQgcGFyZW50T2JqZWN0KCkgewogICAgaWYgKCF0aGlzLnBhcmVudCB8fCAhdGhpcy5wYXJlbnRLZXkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBwYXJlbnQiKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnBhcmVudC5ub2RlW3RoaXMucGFyZW50S2V5XTsKICB9CiAgZ2V0IHBhcmVudEluZGV4KCkgewogICAgaWYgKCEodGhpcy5wYXJlbnRPYmplY3QgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYW4gYXJyYXkiKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnBhcmVudE9iamVjdC5pbmRleE9mKHRoaXMubm9kZSk7CiAgfQogIGRldGFjaCgpIHsKICAgIGlmICh0aGlzLnJvb3QpIHsKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNhbm5vdCBkZXRhY2ggdGhlIHJvb3QuIik7CiAgICB9IGVsc2UgaWYgKCF0aGlzLmF0dGFjaGVkKSB7CiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJDYW5ub3QgZGV0YWNoIGEgZGV0YWNoZWQgbm9kZS4iKTsKICAgIH0KICAgIGlmICh0aGlzLnBhcmVudE9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgIGNvbnN0IHBsYWNlID0gdGhpcy5wYXJlbnRPYmplY3QuaW5kZXhPZih0aGlzLm5vZGUpOwogICAgICBpZiAocGxhY2UgPT09IC0xKQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgdGhpcy5wYXJlbnRPYmplY3Quc3BsaWNlKHBsYWNlLCAxKTsKICAgIH0gZWxzZSB7CiAgICAgIGRlbGV0ZSB0aGlzLnBhcmVudC5ub2RlW3RoaXMucGFyZW50S2V5XTsKICAgIH0KICAgIHRoaXMuYXR0YWNoZWQgPSBmYWxzZTsKICAgIHJldHVybiB0cnVlOwogIH0KICAvLyBzdWNjZXNzID0gbmV3IEFjb3JuQ29udGV4dCwgZmFpbHVyZSA9IGZhbHNlCiAgcmVwbGFjZVdpdGgobm9kZSkgewogICAgaWYgKHRoaXMucm9vdCkgewogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQ2Fubm90IHJlcGxhY2UgdGhlIHJvb3QuIik7CiAgICB9IGVsc2UgaWYgKCF0aGlzLmF0dGFjaGVkKSB7CiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJDYW5ub3QgcmVwbGFjZSBhIGRldGFjaGVkIG5vZGUuIik7CiAgICB9CiAgICBpZiAodGhpcy5wYXJlbnRPYmplY3QgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICBjb25zdCBwbGFjZSA9IHRoaXMucGFyZW50T2JqZWN0LmluZGV4T2YodGhpcy5ub2RlKTsKICAgICAgaWYgKHBsYWNlID09PSAtMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLnBhcmVudE9iamVjdC5zcGxpY2UocGxhY2UsIDEsIG5vZGUpOwogICAgfSBlbHNlIHsKICAgICAgZGVsZXRlIHRoaXMucGFyZW50Lm5vZGVbdGhpcy5wYXJlbnRLZXldOwogICAgICB0aGlzLnBhcmVudC5ub2RlW3RoaXMucGFyZW50S2V5XSA9IG5vZGU7CiAgICB9CiAgICB0aGlzLmF0dGFjaGVkID0gZmFsc2U7CiAgICBjb25zdCBjcmVhdGVkID0gbmV3IEFjb3JuQ29udGV4dCgKICAgICAgbm9kZSwKICAgICAgdGhpcy5wYXJlbnQsCiAgICAgIHRoaXMucGFyZW50S2V5LAogICAgICB0aGlzLnN0YWNrCiAgICApOwogICAgZGVsZXRlIHRoaXMucGFyZW50OwogICAgdGhpcy5yZW1vdmVEZXNjZW5kYW50c0Zyb21TdGFjaygpOwogICAgY3JlYXRlZC5ub2RlW3N5bWJvbE5vUmVzdWx0XSA9IHRydWU7CiAgICB0aGlzLnN0YWNrLnB1c2goY3JlYXRlZCk7CiAgICBjcmVhdGVkLmFkZEVudHJpZXNUb1N0YWNrKCk7CiAgICBmb3IgKGNvbnN0IGN0eCBvZiBuZXcgQWNvcm5JdGVyYXRvcihjcmVhdGVkLm5vZGUpKSB7CiAgICAgIGlmIChjdHgubm9kZVtzeW1ib2xSZXN1bHRdKSB7CiAgICAgICAgZGVsZXRlIGN0eC5ub2RlW3N5bWJvbFJlc3VsdF07CiAgICAgICAgY3R4LnJlbW92ZURlc2NlbmRhbnRzRnJvbVN0YWNrKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3R4Lm5vZGVbc3ltYm9sTm9SZXN1bHRdID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNyZWF0ZWQ7CiAgfQogIGFkZEVudHJpZXNUb1N0YWNrKCkgewogICAgY29uc3QgZW50cmllcyA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5ub2RlKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5ub2RlW2tleV07CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJvYmplY3QiIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICBmb3IgKGNvbnN0IHN2IG9mIHZhbHVlKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHN2ICE9PSAib2JqZWN0IiB8fCBzdiA9PT0gbnVsbCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2Ygc3YudHlwZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZW50cmllcy5wdXNoKFtrZXksIHN2XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZS50eXBlID09PSAic3RyaW5nIikgewogICAgICAgIGVudHJpZXMucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzdGFydCA9IHRoaXMuc3RhY2subGVuZ3RoIC0gMTsKICAgIGxldCBsZW5ndGggPSBlbnRyaWVzLmxlbmd0aDsKICAgIGZvciAoY29uc3QgW2tleSwgbm9kZV0gb2YgZW50cmllcykgewogICAgICBjb25zdCBjdHggPSBuZXcgQWNvcm5Db250ZXh0KG5vZGUsIHRoaXMsIGtleSwgdGhpcy5zdGFjayk7CiAgICAgIHRoaXMuc3RhY2tbc3RhcnQgKyBsZW5ndGgtLV0gPSBjdHg7CiAgICAgIHRoaXMuZW50cmllcy5wdXNoKGN0eCk7CiAgICB9CiAgfQogIHJlbW92ZURlc2NlbmRhbnRzRnJvbVN0YWNrKCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVudHJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmVudHJpZXNbaV07CiAgICAgIGNvbnN0IHN0YWNrSSA9IHRoaXMuc3RhY2suaW5kZXhPZihlbnRyeSk7CiAgICAgIGlmIChzdGFja0kgIT09IC0xKSB7CiAgICAgICAgdGhpcy5zdGFjay5zcGxpY2Uoc3RhY2tJLCAxKTsKICAgICAgfQogICAgICBlbnRyeS5yZW1vdmVEZXNjZW5kYW50c0Zyb21TdGFjaygpOwogICAgfQogIH0KfQpjbGFzcyBBY29ybkl0ZXJhdG9yIHsKICBzdGFjazsKICBjb25zdHJ1Y3Rvcihhc3QpIHsKICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgIHRoaXMuc3RhY2sucHVzaCgKICAgICAgbmV3IEFjb3JuQ29udGV4dChhc3QsIHZvaWQgMCwgdm9pZCAwLCB0aGlzLnN0YWNrLCB0cnVlKQogICAgKTsKICB9CiAgbmV4dCgpIHsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9OwogICAgICB9CiAgICAgIGNvbnRleHQuYWRkRW50cmllc1RvU3RhY2soKTsKICAgICAgaWYgKGNvbnRleHQubm9kZVtzeW1ib2xOb1Jlc3VsdF0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByZXR1cm4geyB2YWx1ZTogY29udGV4dCwgZG9uZTogZmFsc2UgfTsKICAgIH0KICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpczsKICB9Cn0KCnZhciBtYWluJDEgPSB7fTsKCmNvbnN0IHJlcXVpcmUkJDAgPSAvKkBfX1BVUkVfXyovZ2V0QXVnbWVudGVkTmFtZXNwYWNlKHRzbGliX2VzNiQxKTsKCnZhciBmb3JrJDEgPSB7ZXhwb3J0czoge319OwoKdmFyIHR5cGVzID0ge307Cgp2YXIgaGFzUmVxdWlyZWRUeXBlczsKCmZ1bmN0aW9uIHJlcXVpcmVUeXBlcyAoKSB7CglpZiAoaGFzUmVxdWlyZWRUeXBlcykgcmV0dXJuIHR5cGVzOwoJaGFzUmVxdWlyZWRUeXBlcyA9IDE7CglPYmplY3QuZGVmaW5lUHJvcGVydHkodHlwZXMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXR5cGVzLkRlZiA9IHZvaWQgMDsKCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCXZhciBPcCA9IE9iamVjdC5wcm90b3R5cGU7Cgl2YXIgb2JqVG9TdHIgPSBPcC50b1N0cmluZzsKCXZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTsKCXZhciBCYXNlVHlwZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCYXNlVHlwZSgpIHsKCSAgICB9CgkgICAgQmFzZVR5cGUucHJvdG90eXBlLmFzc2VydCA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICBpZiAoIXRoaXMuY2hlY2sodmFsdWUsIGRlZXApKSB7CgkgICAgICAgICAgICB2YXIgc3RyID0gc2hhbGxvd1N0cmluZ2lmeSh2YWx1ZSk7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Ioc3RyICsgIiBkb2VzIG5vdCBtYXRjaCB0eXBlICIgKyB0aGlzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICB9OwoJICAgIEJhc2VUeXBlLnByb3RvdHlwZS5hcnJheU9mID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZWxlbVR5cGUgPSB0aGlzOwoJICAgICAgICByZXR1cm4gbmV3IEFycmF5VHlwZShlbGVtVHlwZSk7CgkgICAgfTsKCSAgICByZXR1cm4gQmFzZVR5cGU7Cgl9KCkpOwoJdmFyIEFycmF5VHlwZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICB0c2xpYl8xLl9fZXh0ZW5kcyhBcnJheVR5cGUsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlUeXBlKGVsZW1UeXBlKSB7CgkgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmVsZW1UeXBlID0gZWxlbVR5cGU7CgkgICAgICAgIF90aGlzLmtpbmQgPSAiQXJyYXlUeXBlIjsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheVR5cGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gIlsiICsgdGhpcy5lbGVtVHlwZSArICJdIjsKCSAgICB9OwoJICAgIEFycmF5VHlwZS5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAodmFsdWUsIGRlZXApIHsKCSAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCSAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmV2ZXJ5KGZ1bmN0aW9uIChlbGVtKSB7IHJldHVybiBfdGhpcy5lbGVtVHlwZS5jaGVjayhlbGVtLCBkZWVwKTsgfSk7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlUeXBlOwoJfShCYXNlVHlwZSkpOwoJdmFyIElkZW50aXR5VHlwZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICB0c2xpYl8xLl9fZXh0ZW5kcyhJZGVudGl0eVR5cGUsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWRlbnRpdHlUeXBlKHZhbHVlKSB7CgkgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIF90aGlzLmtpbmQgPSAiSWRlbnRpdHlUeXBlIjsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBJZGVudGl0eVR5cGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gU3RyaW5nKHRoaXMudmFsdWUpOwoJICAgIH07CgkgICAgSWRlbnRpdHlUeXBlLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdmFsdWUgPT09IHRoaXMudmFsdWU7CgkgICAgICAgIGlmICghcmVzdWx0ICYmIHR5cGVvZiBkZWVwID09PSAiZnVuY3Rpb24iKSB7CgkgICAgICAgICAgICBkZWVwKHRoaXMsIHZhbHVlKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIElkZW50aXR5VHlwZTsKCX0oQmFzZVR5cGUpKTsKCXZhciBPYmplY3RUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIHRzbGliXzEuX19leHRlbmRzKE9iamVjdFR5cGUsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gT2JqZWN0VHlwZShmaWVsZHMpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZmllbGRzID0gZmllbGRzOwoJICAgICAgICBfdGhpcy5raW5kID0gIk9iamVjdFR5cGUiOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIE9iamVjdFR5cGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gInsgIiArIHRoaXMuZmllbGRzLmpvaW4oIiwgIikgKyAiIH0iOwoJICAgIH07CgkgICAgT2JqZWN0VHlwZS5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAodmFsdWUsIGRlZXApIHsKCSAgICAgICAgcmV0dXJuIChvYmpUb1N0ci5jYWxsKHZhbHVlKSA9PT0gb2JqVG9TdHIuY2FsbCh7fSkgJiYKCSAgICAgICAgICAgIHRoaXMuZmllbGRzLmV2ZXJ5KGZ1bmN0aW9uIChmaWVsZCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC50eXBlLmNoZWNrKHZhbHVlW2ZpZWxkLm5hbWVdLCBkZWVwKTsKCSAgICAgICAgICAgIH0pKTsKCSAgICB9OwoJICAgIHJldHVybiBPYmplY3RUeXBlOwoJfShCYXNlVHlwZSkpOwoJdmFyIE9yVHlwZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICB0c2xpYl8xLl9fZXh0ZW5kcyhPclR5cGUsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gT3JUeXBlKHR5cGVzKSB7CgkgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLnR5cGVzID0gdHlwZXM7CgkgICAgICAgIF90aGlzLmtpbmQgPSAiT3JUeXBlIjsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBPclR5cGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50eXBlcy5qb2luKCIgfCAiKTsKCSAgICB9OwoJICAgIE9yVHlwZS5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAodmFsdWUsIGRlZXApIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudHlwZXMuc29tZShmdW5jdGlvbiAodHlwZSkgewoJICAgICAgICAgICAgcmV0dXJuIHR5cGUuY2hlY2sodmFsdWUsIGRlZXApOwoJICAgICAgICB9KTsKCSAgICB9OwoJICAgIHJldHVybiBPclR5cGU7Cgl9KEJhc2VUeXBlKSk7Cgl2YXIgUHJlZGljYXRlVHlwZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICB0c2xpYl8xLl9fZXh0ZW5kcyhQcmVkaWNhdGVUeXBlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFByZWRpY2F0ZVR5cGUobmFtZSwgcHJlZGljYXRlKSB7CgkgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBfdGhpcy5wcmVkaWNhdGUgPSBwcmVkaWNhdGU7CgkgICAgICAgIF90aGlzLmtpbmQgPSAiUHJlZGljYXRlVHlwZSI7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgUHJlZGljYXRlVHlwZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBQcmVkaWNhdGVUeXBlLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5wcmVkaWNhdGUodmFsdWUsIGRlZXApOwoJICAgICAgICBpZiAoIXJlc3VsdCAmJiB0eXBlb2YgZGVlcCA9PT0gImZ1bmN0aW9uIikgewoJICAgICAgICAgICAgZGVlcCh0aGlzLCB2YWx1ZSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIHJldHVybiBQcmVkaWNhdGVUeXBlOwoJfShCYXNlVHlwZSkpOwoJdmFyIERlZiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWYodHlwZSwgdHlwZU5hbWUpIHsKCSAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKCSAgICAgICAgdGhpcy50eXBlTmFtZSA9IHR5cGVOYW1lOwoJICAgICAgICB0aGlzLmJhc2VOYW1lcyA9IFtdOwoJICAgICAgICB0aGlzLm93bkZpZWxkcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkgICAgICAgIC8vIEluY2x1ZGVzIG93biB0eXBlTmFtZS4gUG9wdWxhdGVkIGR1cmluZyBmaW5hbGl6YXRpb24uCgkgICAgICAgIHRoaXMuYWxsU3VwZXJ0eXBlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkgICAgICAgIC8vIExpbmVhciBpbmhlcml0YW5jZSBoaWVyYXJjaHkuIFBvcHVsYXRlZCBkdXJpbmcgZmluYWxpemF0aW9uLgoJICAgICAgICB0aGlzLnN1cGVydHlwZUxpc3QgPSBbXTsKCSAgICAgICAgLy8gSW5jbHVkZXMgaW5oZXJpdGVkIGZpZWxkcy4KCSAgICAgICAgdGhpcy5hbGxGaWVsZHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJICAgICAgICAvLyBOb24taGlkZGVuIGtleXMgb2YgYWxsRmllbGRzLgoJICAgICAgICB0aGlzLmZpZWxkTmFtZXMgPSBbXTsKCSAgICAgICAgLy8gVGhpcyBwcm9wZXJ0eSB3aWxsIGJlIG92ZXJyaWRkZW4gYXMgdHJ1ZSBieSBpbmRpdmlkdWFsIERlZiBpbnN0YW5jZXMKCSAgICAgICAgLy8gd2hlbiB0aGV5IGFyZSBmaW5hbGl6ZWQuCgkgICAgICAgIHRoaXMuZmluYWxpemVkID0gZmFsc2U7CgkgICAgICAgIC8vIEZhbHNlIGJ5IGRlZmF1bHQgdW50aWwgLmJ1aWxkKC4uLikgaXMgY2FsbGVkIG9uIGFuIGluc3RhbmNlLgoJICAgICAgICB0aGlzLmJ1aWxkYWJsZSA9IGZhbHNlOwoJICAgICAgICB0aGlzLmJ1aWxkUGFyYW1zID0gW107CgkgICAgfQoJICAgIERlZi5wcm90b3R5cGUuaXNTdXBlcnR5cGVPZiA9IGZ1bmN0aW9uICh0aGF0KSB7CgkgICAgICAgIGlmICh0aGF0IGluc3RhbmNlb2YgRGVmKSB7CgkgICAgICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQgIT09IHRydWUgfHwKCSAgICAgICAgICAgICAgICB0aGF0LmZpbmFsaXplZCAhPT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwodGhhdC5hbGxTdXBlcnR5cGVzLCB0aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcih0aGF0ICsgIiBpcyBub3QgYSBEZWYiKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVmLnByb3RvdHlwZS5jaGVja0FsbEZpZWxkcyA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICB2YXIgYWxsRmllbGRzID0gdGhpcy5hbGxGaWVsZHM7CgkgICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCAhPT0gdHJ1ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiICsgdGhpcy50eXBlTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgZnVuY3Rpb24gY2hlY2tGaWVsZEJ5TmFtZShuYW1lKSB7CgkgICAgICAgICAgICB2YXIgZmllbGQgPSBhbGxGaWVsZHNbbmFtZV07CgkgICAgICAgICAgICB2YXIgdHlwZSA9IGZpZWxkLnR5cGU7CgkgICAgICAgICAgICB2YXIgY2hpbGQgPSBmaWVsZC5nZXRWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICByZXR1cm4gdHlwZS5jaGVjayhjaGlsZCwgZGVlcCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmCgkgICAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmCgkgICAgICAgICAgICBPYmplY3Qua2V5cyhhbGxGaWVsZHMpLmV2ZXJ5KGNoZWNrRmllbGRCeU5hbWUpOwoJICAgIH07CgkgICAgRGVmLnByb3RvdHlwZS5iYXNlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHN1cGVydHlwZU5hbWVzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBzdXBlcnR5cGVOYW1lc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiYXNlcyA9IHRoaXMuYmFzZU5hbWVzOwoJICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHsKCSAgICAgICAgICAgIGlmIChzdXBlcnR5cGVOYW1lcy5sZW5ndGggIT09IGJhc2VzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1cGVydHlwZU5hbWVzLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHN1cGVydHlwZU5hbWVzW2ldICE9PSBiYXNlc1tpXSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHN1cGVydHlwZU5hbWVzLmZvckVhY2goZnVuY3Rpb24gKGJhc2VOYW1lKSB7CgkgICAgICAgICAgICAvLyBUaGlzIGluZGV4T2YgbG9va3VwIG1heSBiZSBPKG4pLCBidXQgdGhlIHR5cGljYWwgbnVtYmVyIG9mIGJhc2UKCSAgICAgICAgICAgIC8vIG5hbWVzIGlzIHZlcnkgc21hbGwsIGFuZCBpbmRleE9mIGlzIGEgbmF0aXZlIEFycmF5IG1ldGhvZC4KCSAgICAgICAgICAgIGlmIChiYXNlcy5pbmRleE9mKGJhc2VOYW1lKSA8IDApIHsKCSAgICAgICAgICAgICAgICBiYXNlcy5wdXNoKGJhc2VOYW1lKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSk7CgkgICAgICAgIHJldHVybiB0aGlzOyAvLyBGb3IgY2hhaW5pbmcuCgkgICAgfTsKCSAgICByZXR1cm4gRGVmOwoJfSgpKTsKCXR5cGVzLkRlZiA9IERlZjsKCXZhciBGaWVsZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGaWVsZChuYW1lLCB0eXBlLCBkZWZhdWx0Rm4sIGhpZGRlbikgewoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwoJICAgICAgICB0aGlzLmRlZmF1bHRGbiA9IGRlZmF1bHRGbjsKCSAgICAgICAgdGhpcy5oaWRkZW4gPSAhIWhpZGRlbjsKCSAgICB9CgkgICAgRmllbGQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5uYW1lKSArICI6ICIgKyB0aGlzLnR5cGU7CgkgICAgfTsKCSAgICBGaWVsZC5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAob2JqKSB7CgkgICAgICAgIHZhciB2YWx1ZSA9IG9ialt0aGlzLm5hbWVdOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAidW5kZWZpbmVkIikgewoJICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0eXBlb2YgdGhpcy5kZWZhdWx0Rm4gPT09ICJmdW5jdGlvbiIpIHsKCSAgICAgICAgICAgIHZhbHVlID0gdGhpcy5kZWZhdWx0Rm4uY2FsbChvYmopOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB2YWx1ZTsKCSAgICB9OwoJICAgIHJldHVybiBGaWVsZDsKCX0oKSk7CglmdW5jdGlvbiBzaGFsbG93U3RyaW5naWZ5KHZhbHVlKSB7CgkgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CgkgICAgICAgIHJldHVybiAiWyIgKyB2YWx1ZS5tYXAoc2hhbGxvd1N0cmluZ2lmeSkuam9pbigiLCAiKSArICJdIjsKCSAgICB9CgkgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIpIHsKCSAgICAgICAgcmV0dXJuICJ7ICIgKyBPYmplY3Qua2V5cyh2YWx1ZSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKCSAgICAgICAgICAgIHJldHVybiBrZXkgKyAiOiAiICsgdmFsdWVba2V5XTsKCSAgICAgICAgfSkuam9pbigiLCAiKSArICIgfSI7CgkgICAgfQoJICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7Cgl9CglmdW5jdGlvbiB0eXBlc1BsdWdpbihfZm9yaykgewoJICAgIHZhciBUeXBlID0gewoJICAgICAgICBvcjogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIHR5cGVzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgICAgIHR5cGVzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gbmV3IE9yVHlwZSh0eXBlcy5tYXAoZnVuY3Rpb24gKHR5cGUpIHsgcmV0dXJuIFR5cGUuZnJvbSh0eXBlKTsgfSkpOwoJICAgICAgICB9LAoJICAgICAgICBmcm9tOiBmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHsKCSAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5VHlwZSB8fAoJICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgSWRlbnRpdHlUeXBlIHx8CgkgICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBPYmplY3RUeXBlIHx8CgkgICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBPclR5cGUgfHwKCSAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIFByZWRpY2F0ZVR5cGUpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBUaGUgRGVmIHR5cGUgaXMgdXNlZCBhcyBhIGhlbHBlciBmb3IgY29uc3RydWN0aW5nIGNvbXBvdW5kCgkgICAgICAgICAgICAvLyBpbnRlcmZhY2UgdHlwZXMgZm9yIEFTVCBub2Rlcy4KCSAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERlZikgewoJICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50eXBlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gU3VwcG9ydCBbRWxlbVR5cGVdIHN5bnRheC4KCSAgICAgICAgICAgIGlmIChpc0FycmF5LmNoZWNrKHZhbHVlKSkgewoJICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJvbmx5IG9uZSBlbGVtZW50IHR5cGUgaXMgcGVybWl0dGVkIGZvciB0eXBlZCBhcnJheXMiKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheVR5cGUoVHlwZS5mcm9tKHZhbHVlWzBdKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTdXBwb3J0IHsgc29tZUZpZWxkOiBGaWVsZFR5cGUsIC4uLiB9IHN5bnRheC4KCSAgICAgICAgICAgIGlmIChpc09iamVjdC5jaGVjayh2YWx1ZSkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdFR5cGUoT2JqZWN0LmtleXModmFsdWUpLm1hcChmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKG5hbWUsIFR5cGUuZnJvbSh2YWx1ZVtuYW1lXSwgbmFtZSkpOwoJICAgICAgICAgICAgICAgIH0pKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKCSAgICAgICAgICAgICAgICB2YXIgYmljZkluZGV4ID0gYnVpbHRJbkN0b3JGbnMuaW5kZXhPZih2YWx1ZSk7CgkgICAgICAgICAgICAgICAgaWYgKGJpY2ZJbmRleCA+PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBidWlsdEluQ3RvclR5cGVzW2JpY2ZJbmRleF07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJtaXNzaW5nIG5hbWUiKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcmVkaWNhdGVUeXBlKG5hbWUsIHZhbHVlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIEFzIGEgbGFzdCByZXNvcnQsIHRvVHlwZSByZXR1cm5zIGEgdHlwZSB0aGF0IG1hdGNoZXMgYW55IHZhbHVlIHRoYXQKCSAgICAgICAgICAgIC8vIGlzID09PSBmcm9tLiBUaGlzIGlzIHByaW1hcmlseSB1c2VmdWwgZm9yIGxpdGVyYWwgdmFsdWVzIGxpa2UKCSAgICAgICAgICAgIC8vIHRvVHlwZShudWxsKSwgYnV0IGl0IGhhcyB0aGUgYWRkaXRpb25hbCBhZHZhbnRhZ2Ugb2YgYWxsb3dpbmcKCSAgICAgICAgICAgIC8vIHRvVHlwZSB0byBiZSBhIHRvdGFsIGZ1bmN0aW9uLgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBJZGVudGl0eVR5cGUodmFsdWUpOwoJICAgICAgICB9LAoJICAgICAgICAvLyBEZWZpbmUgYSB0eXBlIHdob3NlIG5hbWUgaXMgcmVnaXN0ZXJlZCBpbiBhIG5hbWVzcGFjZSAodGhlIGRlZkNhY2hlKSBzbwoJICAgICAgICAvLyB0aGF0IGZ1dHVyZSBkZWZpbml0aW9ucyB3aWxsIHJldHVybiB0aGUgc2FtZSB0eXBlIGdpdmVuIHRoZSBzYW1lIG5hbWUuCgkgICAgICAgIC8vIEluIHBhcnRpY3VsYXIsIHRoaXMgc3lzdGVtIGFsbG93cyBmb3IgY2lyY3VsYXIgYW5kIGZvcndhcmQgZGVmaW5pdGlvbnMuCgkgICAgICAgIC8vIFRoZSBEZWYgb2JqZWN0IGQgcmV0dXJuZWQgZnJvbSBUeXBlLmRlZiBtYXkgYmUgdXNlZCB0byBjb25maWd1cmUgdGhlCgkgICAgICAgIC8vIHR5cGUgZC50eXBlIGJ5IGNhbGxpbmcgbWV0aG9kcyBzdWNoIGFzIGQuYmFzZXMsIGQuYnVpbGQsIGFuZCBkLmZpZWxkLgoJICAgICAgICBkZWY6IGZ1bmN0aW9uICh0eXBlTmFtZSkgewoJICAgICAgICAgICAgcmV0dXJuIGhhc093bi5jYWxsKGRlZkNhY2hlLCB0eXBlTmFtZSkKCSAgICAgICAgICAgICAgICA/IGRlZkNhY2hlW3R5cGVOYW1lXQoJICAgICAgICAgICAgICAgIDogZGVmQ2FjaGVbdHlwZU5hbWVdID0gbmV3IERlZkltcGwodHlwZU5hbWUpOwoJICAgICAgICB9LAoJICAgICAgICBoYXNEZWY6IGZ1bmN0aW9uICh0eXBlTmFtZSkgewoJICAgICAgICAgICAgcmV0dXJuIGhhc093bi5jYWxsKGRlZkNhY2hlLCB0eXBlTmFtZSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHZhciBidWlsdEluQ3RvckZucyA9IFtdOwoJICAgIHZhciBidWlsdEluQ3RvclR5cGVzID0gW107CgkgICAgZnVuY3Rpb24gZGVmQnVpbHRJblR5cGUobmFtZSwgZXhhbXBsZSkgewoJICAgICAgICB2YXIgb2JqU3RyID0gb2JqVG9TdHIuY2FsbChleGFtcGxlKTsKCSAgICAgICAgdmFyIHR5cGUgPSBuZXcgUHJlZGljYXRlVHlwZShuYW1lLCBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIG9ialRvU3RyLmNhbGwodmFsdWUpID09PSBvYmpTdHI7IH0pOwoJICAgICAgICBpZiAoZXhhbXBsZSAmJiB0eXBlb2YgZXhhbXBsZS5jb25zdHJ1Y3RvciA9PT0gImZ1bmN0aW9uIikgewoJICAgICAgICAgICAgYnVpbHRJbkN0b3JGbnMucHVzaChleGFtcGxlLmNvbnN0cnVjdG9yKTsKCSAgICAgICAgICAgIGJ1aWx0SW5DdG9yVHlwZXMucHVzaCh0eXBlKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdHlwZTsKCSAgICB9CgkgICAgLy8gVGhlc2UgdHlwZXMgY2hlY2sgdGhlIHVuZGVybHlpbmcgW1tDbGFzc11dIGF0dHJpYnV0ZSBvZiB0aGUgZ2l2ZW4KCSAgICAvLyB2YWx1ZSwgcmF0aGVyIHRoYW4gdXNpbmcgdGhlIHByb2JsZW1hdGljIHR5cGVvZiBvcGVyYXRvci4gTm90ZSBob3dldmVyCgkgICAgLy8gdGhhdCBubyBzdWJ0eXBpbmcgaXMgY29uc2lkZXJlZDsgc28sIGZvciBpbnN0YW5jZSwgaXNPYmplY3QuY2hlY2sKCSAgICAvLyByZXR1cm5zIGZhbHNlIGZvciBbXSwgLy4vLCBuZXcgRGF0ZSwgYW5kIG51bGwuCgkgICAgdmFyIGlzU3RyaW5nID0gZGVmQnVpbHRJblR5cGUoInN0cmluZyIsICJ0cnV0aHkiKTsKCSAgICB2YXIgaXNGdW5jdGlvbiA9IGRlZkJ1aWx0SW5UeXBlKCJmdW5jdGlvbiIsIGZ1bmN0aW9uICgpIHsgfSk7CgkgICAgdmFyIGlzQXJyYXkgPSBkZWZCdWlsdEluVHlwZSgiYXJyYXkiLCBbXSk7CgkgICAgdmFyIGlzT2JqZWN0ID0gZGVmQnVpbHRJblR5cGUoIm9iamVjdCIsIHt9KTsKCSAgICB2YXIgaXNSZWdFeHAgPSBkZWZCdWlsdEluVHlwZSgiUmVnRXhwIiwgLy4vKTsKCSAgICB2YXIgaXNEYXRlID0gZGVmQnVpbHRJblR5cGUoIkRhdGUiLCBuZXcgRGF0ZSgpKTsKCSAgICB2YXIgaXNOdW1iZXIgPSBkZWZCdWlsdEluVHlwZSgibnVtYmVyIiwgMyk7CgkgICAgdmFyIGlzQm9vbGVhbiA9IGRlZkJ1aWx0SW5UeXBlKCJib29sZWFuIiwgdHJ1ZSk7CgkgICAgdmFyIGlzTnVsbCA9IGRlZkJ1aWx0SW5UeXBlKCJudWxsIiwgbnVsbCk7CgkgICAgdmFyIGlzVW5kZWZpbmVkID0gZGVmQnVpbHRJblR5cGUoInVuZGVmaW5lZCIsIHVuZGVmaW5lZCk7CgkgICAgdmFyIGJ1aWx0SW5UeXBlcyA9IHsKCSAgICAgICAgc3RyaW5nOiBpc1N0cmluZywKCSAgICAgICAgZnVuY3Rpb246IGlzRnVuY3Rpb24sCgkgICAgICAgIGFycmF5OiBpc0FycmF5LAoJICAgICAgICBvYmplY3Q6IGlzT2JqZWN0LAoJICAgICAgICBSZWdFeHA6IGlzUmVnRXhwLAoJICAgICAgICBEYXRlOiBpc0RhdGUsCgkgICAgICAgIG51bWJlcjogaXNOdW1iZXIsCgkgICAgICAgIGJvb2xlYW46IGlzQm9vbGVhbiwKCSAgICAgICAgbnVsbDogaXNOdWxsLAoJICAgICAgICB1bmRlZmluZWQ6IGlzVW5kZWZpbmVkLAoJICAgIH07CgkgICAgLy8gSW4gb3JkZXIgdG8gcmV0dXJuIHRoZSBzYW1lIERlZiBpbnN0YW5jZSBldmVyeSB0aW1lIFR5cGUuZGVmIGlzIGNhbGxlZAoJICAgIC8vIHdpdGggYSBwYXJ0aWN1bGFyIG5hbWUsIHRob3NlIGluc3RhbmNlcyBuZWVkIHRvIGJlIHN0b3JlZCBpbiBhIGNhY2hlLgoJICAgIHZhciBkZWZDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkgICAgZnVuY3Rpb24gZGVmRnJvbVZhbHVlKHZhbHVlKSB7CgkgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSB7CgkgICAgICAgICAgICB2YXIgdHlwZSA9IHZhbHVlLnR5cGU7CgkgICAgICAgICAgICBpZiAodHlwZW9mIHR5cGUgPT09ICJzdHJpbmciICYmCgkgICAgICAgICAgICAgICAgaGFzT3duLmNhbGwoZGVmQ2FjaGUsIHR5cGUpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGQgPSBkZWZDYWNoZVt0eXBlXTsKCSAgICAgICAgICAgICAgICBpZiAoZC5maW5hbGl6ZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH0KCSAgICB2YXIgRGVmSW1wbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICAgICAgdHNsaWJfMS5fX2V4dGVuZHMoRGVmSW1wbCwgX3N1cGVyKTsKCSAgICAgICAgZnVuY3Rpb24gRGVmSW1wbCh0eXBlTmFtZSkgewoJICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV3IFByZWRpY2F0ZVR5cGUodHlwZU5hbWUsIGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgeyByZXR1cm4gX3RoaXMuY2hlY2sodmFsdWUsIGRlZXApOyB9KSwgdHlwZU5hbWUpIHx8IHRoaXM7CgkgICAgICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgICAgIH0KCSAgICAgICAgRGVmSW1wbC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAodmFsdWUsIGRlZXApIHsKCSAgICAgICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCAhPT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJlbWF0dXJlbHkgY2hlY2tpbmcgdW5maW5hbGl6ZWQgdHlwZSAiICsgdGhpcy50eXBlTmFtZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBBIERlZiB0eXBlIGNhbiBvbmx5IG1hdGNoIGFuIG9iamVjdCB2YWx1ZS4KCSAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgIT09ICJvYmplY3QiKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHZEZWYgPSBkZWZGcm9tVmFsdWUodmFsdWUpOwoJICAgICAgICAgICAgaWYgKCF2RGVmKSB7CgkgICAgICAgICAgICAgICAgLy8gSWYgd2UgY291bGRuJ3QgaW5mZXIgdGhlIERlZiBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHZhbHVlLAoJICAgICAgICAgICAgICAgIC8vIGFuZCB3ZSBleHBlY3RlZCBpdCB0byBiZSBhIFNvdXJjZUxvY2F0aW9uIG9yIGEgUG9zaXRpb24sIGl0IHdhcwoJICAgICAgICAgICAgICAgIC8vIHByb2JhYmx5IGp1c3QgbWlzc2luZyBhICJ0eXBlIiBmaWVsZCAoYmVjYXVzZSBFc3ByaW1hIGRvZXMgbm90CgkgICAgICAgICAgICAgICAgLy8gYXNzaWduIGEgdHlwZSBwcm9wZXJ0eSB0byBzdWNoIG5vZGVzKS4gQmUgb3B0aW1pc3RpYyBhbmQgbGV0CgkgICAgICAgICAgICAgICAgLy8gdGhpcy5jaGVja0FsbEZpZWxkcyBtYWtlIHRoZSBmaW5hbCBkZWNpc2lvbi4KCSAgICAgICAgICAgICAgICBpZiAodGhpcy50eXBlTmFtZSA9PT0gIlNvdXJjZUxvY2F0aW9uIiB8fAoJICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGVOYW1lID09PSAiUG9zaXRpb24iKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrQWxsRmllbGRzKHZhbHVlLCBkZWVwKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGlzLmNoZWNrQWxsRmllbGRzIGZvciBhbnkgb3RoZXIgdHlwZSBvZiBub2RlIGlzIGJvdGgKCSAgICAgICAgICAgICAgICAvLyBiYWQgZm9yIHBlcmZvcm1hbmNlIGFuZCB3YXkgdG9vIGZvcmdpdmluZy4KCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBJZiBjaGVja2luZyBkZWVwbHkgYW5kIHZEZWYgPT09IHRoaXMsIHRoZW4gd2Ugb25seSBuZWVkIHRvIGNhbGwKCSAgICAgICAgICAgIC8vIGNoZWNrQWxsRmllbGRzIG9uY2UuIENhbGxpbmcgY2hlY2tBbGxGaWVsZHMgaXMgdG9vIHN0cmljdCB3aGVuIGRlZXAKCSAgICAgICAgICAgIC8vIGlzIGZhbHNlLCBiZWNhdXNlIHRoZW4gd2Ugb25seSBjYXJlIGFib3V0IHRoaXMuaXNTdXBlcnR5cGVPZih2RGVmKS4KCSAgICAgICAgICAgIGlmIChkZWVwICYmIHZEZWYgPT09IHRoaXMpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja0FsbEZpZWxkcyh2YWx1ZSwgZGVlcCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBJbiBtb3N0IGNhc2VzIHdlIHJlbHkgZXhjbHVzaXZlbHkgb24gaXNTdXBlcnR5cGVPZiB0byBtYWtlIE8oMSkKCSAgICAgICAgICAgIC8vIHN1YnR5cGluZyBkZXRlcm1pbmF0aW9ucy4gVGhpcyBzdWZmaWNlcyBpbiBtb3N0IHNpdHVhdGlvbnMgb3V0c2lkZQoJICAgICAgICAgICAgLy8gb2YgdW5pdCB0ZXN0cywgc2luY2UgaW50ZXJmYWNlIGNvbmZvcm1hbmNlIGlzIGNoZWNrZWQgd2hlbmV2ZXIgbmV3CgkgICAgICAgICAgICAvLyBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgdXNpbmcgYnVpbGRlciBmdW5jdGlvbnMuCgkgICAgICAgICAgICBpZiAoIXRoaXMuaXNTdXBlcnR5cGVPZih2RGVmKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFRoZSBleGNlcHRpb24gaXMgd2hlbiBkZWVwIGlzIHRydWU7IHRoZW4sIHdlIHJlY3Vyc2l2ZWx5IGNoZWNrIGFsbAoJICAgICAgICAgICAgLy8gZmllbGRzLgoJICAgICAgICAgICAgaWYgKCFkZWVwKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBVc2UgdGhlIG1vcmUgc3BlY2lmaWMgRGVmICh2RGVmKSB0byBwZXJmb3JtIHRoZSBkZWVwIGNoZWNrLCBidXQKCSAgICAgICAgICAgIC8vIHNoYWxsb3ctY2hlY2sgZmllbGRzIGRlZmluZWQgYnkgdGhlIGxlc3Mgc3BlY2lmaWMgRGVmICh0aGlzKS4KCSAgICAgICAgICAgIHJldHVybiB2RGVmLmNoZWNrQWxsRmllbGRzKHZhbHVlLCBkZWVwKQoJICAgICAgICAgICAgICAgICYmIHRoaXMuY2hlY2tBbGxGaWVsZHModmFsdWUsIGZhbHNlKTsKCSAgICAgICAgfTsKCSAgICAgICAgRGVmSW1wbC5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoJICAgICAgICAgICAgdmFyIGJ1aWxkUGFyYW1zID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgICAgIGJ1aWxkUGFyYW1zW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBDYWxsaW5nIERlZi5wcm90b3R5cGUuYnVpbGQgbXVsdGlwbGUgdGltZXMgaGFzIHRoZSBlZmZlY3Qgb2YgbWVyZWx5CgkgICAgICAgICAgICAvLyByZWRlZmluaW5nIHRoaXMgcHJvcGVydHkuCgkgICAgICAgICAgICB0aGlzLmJ1aWxkUGFyYW1zID0gYnVpbGRQYXJhbXM7CgkgICAgICAgICAgICBpZiAodGhpcy5idWlsZGFibGUpIHsKCSAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIERlZiBpcyBhbHJlYWR5IGJ1aWxkYWJsZSwgdXBkYXRlIHNlbGYuYnVpbGRQYXJhbXMgYW5kCgkgICAgICAgICAgICAgICAgLy8gY29udGludWUgdXNpbmcgdGhlIG9sZCBidWlsZGVyIGZ1bmN0aW9uLgoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRXZlcnkgYnVpbGRhYmxlIHR5cGUgd2lsbCBoYXZlIGl0cyAidHlwZSIgZmllbGQgZmlsbGVkIGluCgkgICAgICAgICAgICAvLyBhdXRvbWF0aWNhbGx5LiBUaGlzIGluY2x1ZGVzIHR5cGVzIHRoYXQgYXJlIG5vdCBzdWJ0eXBlcyBvZiBOb2RlLAoJICAgICAgICAgICAgLy8gbGlrZSBTb3VyY2VMb2NhdGlvbiwgYnV0IHRoYXQgc2VlbXMgaGFybWxlc3MgKFRPRE8/KS4KCSAgICAgICAgICAgIHRoaXMuZmllbGQoInR5cGUiLCBTdHJpbmcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnR5cGVOYW1lOyB9KTsKCSAgICAgICAgICAgIC8vIE92ZXJyaWRlIERwLmJ1aWxkYWJsZSBmb3IgdGhpcyBEZWYgaW5zdGFuY2UuCgkgICAgICAgICAgICB0aGlzLmJ1aWxkYWJsZSA9IHRydWU7CgkgICAgICAgICAgICB2YXIgYWRkUGFyYW0gPSBmdW5jdGlvbiAoYnVpbHQsIHBhcmFtLCBhcmcsIGlzQXJnQXZhaWxhYmxlKSB7CgkgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGJ1aWx0LCBwYXJhbSkpCgkgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgICAgICAgICB2YXIgYWxsID0gX3RoaXMuYWxsRmllbGRzOwoJICAgICAgICAgICAgICAgIGlmICghaGFzT3duLmNhbGwoYWxsLCBwYXJhbSkpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiICsgcGFyYW0pOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBhbGxbcGFyYW1dOwoJICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZmllbGQudHlwZTsKCSAgICAgICAgICAgICAgICB2YXIgdmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGlzQXJnQXZhaWxhYmxlKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYXJnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWVsZC5kZWZhdWx0Rm4pIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gRXhwb3NlIHRoZSBwYXJ0aWFsbHktYnVpbHQgb2JqZWN0IHRvIHRoZSBkZWZhdWx0CgkgICAgICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uIGFzIGl0cyBgdGhpc2Agb2JqZWN0LgoJICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZpZWxkLmRlZmF1bHRGbi5jYWxsKGJ1aWx0KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gIm5vIHZhbHVlIG9yIGRlZmF1bHQgZnVuY3Rpb24gZ2l2ZW4gZm9yIGZpZWxkICIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkocGFyYW0pICsgIiBvZiAiICsgX3RoaXMudHlwZU5hbWUgKyAiKCIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYnVpbGRQYXJhbXMubWFwKGZ1bmN0aW9uIChuYW1lKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbFtuYW1lXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oIiwgIikgKyAiKSI7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCF0eXBlLmNoZWNrKHZhbHVlKSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Ioc2hhbGxvd1N0cmluZ2lmeSh2YWx1ZSkgKwoJICAgICAgICAgICAgICAgICAgICAgICAgIiBkb2VzIG5vdCBtYXRjaCBmaWVsZCAiICsgZmllbGQgKwoJICAgICAgICAgICAgICAgICAgICAgICAgIiBvZiB0eXBlICIgKyBfdGhpcy50eXBlTmFtZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJ1aWx0W3BhcmFtXSA9IHZhbHVlOwoJICAgICAgICAgICAgfTsKCSAgICAgICAgICAgIC8vIENhbGxpbmcgdGhlIGJ1aWxkZXIgZnVuY3Rpb24gd2lsbCBjb25zdHJ1Y3QgYW4gaW5zdGFuY2Ugb2YgdGhlIERlZiwKCSAgICAgICAgICAgIC8vIHdpdGggcG9zaXRpb25hbCBhcmd1bWVudHMgbWFwcGVkIHRvIHRoZSBmaWVsZHMgb3JpZ2luYWwgcGFzc2VkIHRvIC5idWlsZC4KCSAgICAgICAgICAgIC8vIElmIG5vdCBlbm91Z2ggYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGRlZmF1bHQgdmFsdWUgZm9yIHRoZSByZW1haW5pbmcgZmllbGRzCgkgICAgICAgICAgICAvLyB3aWxsIGJlIHVzZWQuCgkgICAgICAgICAgICB2YXIgYnVpbGRlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGFyZ2MgPSBhcmdzLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBpZiAoIV90aGlzLmZpbmFsaXplZCkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImF0dGVtcHRpbmcgdG8gaW5zdGFudGlhdGUgdW5maW5hbGl6ZWQgdHlwZSAiICsKCSAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGJ1aWx0ID0gT2JqZWN0LmNyZWF0ZShub2RlUHJvdG90eXBlKTsKCSAgICAgICAgICAgICAgICBfdGhpcy5idWlsZFBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSwgaSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IGFyZ2MpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGFkZFBhcmFtKGJ1aWx0LCBwYXJhbSwgYXJnc1tpXSwgdHJ1ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBhZGRQYXJhbShidWlsdCwgcGFyYW0sIG51bGwsIGZhbHNlKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKF90aGlzLmFsbEZpZWxkcykuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBkZWZhdWx0IHZhbHVlLgoJICAgICAgICAgICAgICAgICAgICBhZGRQYXJhbShidWlsdCwgcGFyYW0sIG51bGwsIGZhbHNlKTsKCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgInR5cGUiIGZpZWxkIHdhcyBmaWxsZWQgYXV0b21hdGljYWxseS4KCSAgICAgICAgICAgICAgICBpZiAoYnVpbHQudHlwZSAhPT0gX3RoaXMudHlwZU5hbWUpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWx0OwoJICAgICAgICAgICAgfTsKCSAgICAgICAgICAgIC8vIENhbGxpbmcgLmZyb20gb24gdGhlIGJ1aWxkZXIgZnVuY3Rpb24gd2lsbCBjb25zdHJ1Y3QgYW4gaW5zdGFuY2Ugb2YgdGhlIERlZiwKCSAgICAgICAgICAgIC8vIHVzaW5nIGZpZWxkIHZhbHVlcyBmcm9tIHRoZSBwYXNzZWQgb2JqZWN0LiBGb3IgZmllbGRzIG1pc3NpbmcgZnJvbSB0aGUgcGFzc2VkIG9iamVjdCwKCSAgICAgICAgICAgIC8vIHRoZWlyIGRlZmF1bHQgdmFsdWUgd2lsbCBiZSB1c2VkLgoJICAgICAgICAgICAgYnVpbGRlci5mcm9tID0gZnVuY3Rpb24gKG9iaikgewoJICAgICAgICAgICAgICAgIGlmICghX3RoaXMuZmluYWxpemVkKSB7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYXR0ZW1wdGluZyB0byBpbnN0YW50aWF0ZSB1bmZpbmFsaXplZCB0eXBlICIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudHlwZU5hbWUpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgYnVpbHQgPSBPYmplY3QuY3JlYXRlKG5vZGVQcm90b3R5cGUpOwoJICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKF90aGlzLmFsbEZpZWxkcykuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKG9iaiwgcGFyYW0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBhZGRQYXJhbShidWlsdCwgcGFyYW0sIG9ialtwYXJhbV0sIHRydWUpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgYWRkUGFyYW0oYnVpbHQsIHBhcmFtLCBudWxsLCBmYWxzZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgInR5cGUiIGZpZWxkIHdhcyBmaWxsZWQgYXV0b21hdGljYWxseS4KCSAgICAgICAgICAgICAgICBpZiAoYnVpbHQudHlwZSAhPT0gX3RoaXMudHlwZU5hbWUpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWx0OwoJICAgICAgICAgICAgfTsKCSAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShidWlsZGVycywgZ2V0QnVpbGRlck5hbWUodGhpcy50eXBlTmFtZSksIHsKCSAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJICAgICAgICAgICAgICAgIHZhbHVlOiBidWlsZGVyCgkgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9OwoJICAgICAgICAvLyBUaGUgcmVhc29uIGZpZWxkcyBhcmUgc3BlY2lmaWVkIHVzaW5nIC5maWVsZCguLi4pIGluc3RlYWQgb2YgYW4gb2JqZWN0CgkgICAgICAgIC8vIGxpdGVyYWwgc3ludGF4IGlzIHNvbWV3aGF0IHN1YnRsZTogdGhlIG9iamVjdCBsaXRlcmFsIHN5bnRheCB3b3VsZAoJICAgICAgICAvLyBzdXBwb3J0IG9ubHkgb25lIGtleSBhbmQgb25lIHZhbHVlLCBidXQgd2l0aCAuZmllbGQoLi4uKSB3ZSBjYW4gcGFzcwoJICAgICAgICAvLyBhbnkgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBzcGVjaWZ5IHRoZSBmaWVsZC4KCSAgICAgICAgRGVmSW1wbC5wcm90b3R5cGUuZmllbGQgPSBmdW5jdGlvbiAobmFtZSwgdHlwZSwgZGVmYXVsdEZuLCBoaWRkZW4pIHsKCSAgICAgICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCkgewoJICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIklnbm9yaW5nIGF0dGVtcHQgdG8gcmVkZWZpbmUgZmllbGQgIiArCgkgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KG5hbWUpICsgIiBvZiBmaW5hbGl6ZWQgdHlwZSAiICsKCSAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy50eXBlTmFtZSkpOwoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdGhpcy5vd25GaWVsZHNbbmFtZV0gPSBuZXcgRmllbGQobmFtZSwgVHlwZS5mcm9tKHR5cGUpLCBkZWZhdWx0Rm4sIGhpZGRlbik7CgkgICAgICAgICAgICByZXR1cm4gdGhpczsgLy8gRm9yIGNoYWluaW5nLgoJICAgICAgICB9OwoJICAgICAgICBEZWZJbXBsLnByb3RvdHlwZS5maW5hbGl6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgkgICAgICAgICAgICAvLyBJdCdzIG5vdCBhbiBlcnJvciB0byBmaW5hbGl6ZSBhIHR5cGUgbW9yZSB0aGFuIG9uY2UsIGJ1dCBvbmx5IHRoZQoJICAgICAgICAgICAgLy8gZmlyc3QgY2FsbCB0byAuZmluYWxpemUgZG9lcyBhbnl0aGluZy4KCSAgICAgICAgICAgIGlmICghdGhpcy5maW5hbGl6ZWQpIHsKCSAgICAgICAgICAgICAgICB2YXIgYWxsRmllbGRzID0gdGhpcy5hbGxGaWVsZHM7CgkgICAgICAgICAgICAgICAgdmFyIGFsbFN1cGVydHlwZXMgPSB0aGlzLmFsbFN1cGVydHlwZXM7CgkgICAgICAgICAgICAgICAgdGhpcy5iYXNlTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgZGVmID0gZGVmQ2FjaGVbbmFtZV07CgkgICAgICAgICAgICAgICAgICAgIGlmIChkZWYgaW5zdGFuY2VvZiBEZWYpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5maW5hbGl6ZSgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kKGFsbEZpZWxkcywgZGVmLmFsbEZpZWxkcyk7CgkgICAgICAgICAgICAgICAgICAgICAgICBleHRlbmQoYWxsU3VwZXJ0eXBlcywgZGVmLmFsbFN1cGVydHlwZXMpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAidW5rbm93biBzdXBlcnR5cGUgbmFtZSAiICsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShuYW1lKSArCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBmb3Igc3VidHlwZSAiICsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShfdGhpcy50eXBlTmFtZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgICAgICAvLyBUT0RPIFdhcm4gaWYgZmllbGRzIGFyZSBvdmVycmlkZGVuIHdpdGggaW5jb21wYXRpYmxlIHR5cGVzLgoJICAgICAgICAgICAgICAgIGV4dGVuZChhbGxGaWVsZHMsIHRoaXMub3duRmllbGRzKTsKCSAgICAgICAgICAgICAgICBhbGxTdXBlcnR5cGVzW3RoaXMudHlwZU5hbWVdID0gdGhpczsKCSAgICAgICAgICAgICAgICB0aGlzLmZpZWxkTmFtZXMubGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBmaWVsZE5hbWUgaW4gYWxsRmllbGRzKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChhbGxGaWVsZHMsIGZpZWxkTmFtZSkgJiYKCSAgICAgICAgICAgICAgICAgICAgICAgICFhbGxGaWVsZHNbZmllbGROYW1lXS5oaWRkZW4pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGROYW1lcy5wdXNoKGZpZWxkTmFtZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVHlwZXMgYXJlIGV4cG9ydGVkIG9ubHkgb25jZSB0aGV5IGhhdmUgYmVlbiBmaW5hbGl6ZWQuCgkgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hbWVkVHlwZXMsIHRoaXMudHlwZU5hbWUsIHsKCSAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKCSAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudHlwZQoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgIHRoaXMuZmluYWxpemVkID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAvLyBBIGxpbmVhcml6YXRpb24gb2YgdGhlIGluaGVyaXRhbmNlIGhpZXJhcmNoeS4KCSAgICAgICAgICAgICAgICBwb3B1bGF0ZVN1cGVydHlwZUxpc3QodGhpcy50eXBlTmFtZSwgdGhpcy5zdXBlcnR5cGVMaXN0KTsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5idWlsZGFibGUgJiYKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXBlcnR5cGVMaXN0Lmxhc3RJbmRleE9mKCJFeHByZXNzaW9uIikgPj0gMCkgewoJICAgICAgICAgICAgICAgICAgICB3cmFwRXhwcmVzc2lvbkJ1aWxkZXJXaXRoU3RhdGVtZW50KHRoaXMudHlwZU5hbWUpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfTsKCSAgICAgICAgcmV0dXJuIERlZkltcGw7CgkgICAgfShEZWYpKTsKCSAgICAvLyBOb3RlIHRoYXQgdGhlIGxpc3QgcmV0dXJuZWQgYnkgdGhpcyBmdW5jdGlvbiBpcyBhIGNvcHkgb2YgdGhlIGludGVybmFsCgkgICAgLy8gc3VwZXJ0eXBlTGlzdCwgKndpdGhvdXQqIHRoZSB0eXBlTmFtZSBpdHNlbGYgYXMgdGhlIGZpcnN0IGVsZW1lbnQuCgkgICAgZnVuY3Rpb24gZ2V0U3VwZXJ0eXBlTmFtZXModHlwZU5hbWUpIHsKCSAgICAgICAgaWYgKCFoYXNPd24uY2FsbChkZWZDYWNoZSwgdHlwZU5hbWUpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkID0gZGVmQ2FjaGVbdHlwZU5hbWVdOwoJICAgICAgICBpZiAoZC5maW5hbGl6ZWQgIT09IHRydWUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGQuc3VwZXJ0eXBlTGlzdC5zbGljZSgxKTsKCSAgICB9CgkgICAgLy8gUmV0dXJucyBhbiBvYmplY3QgbWFwcGluZyBmcm9tIGV2ZXJ5IGtub3duIHR5cGUgaW4gdGhlIGRlZkNhY2hlIHRvIHRoZQoJICAgIC8vIG1vc3Qgc3BlY2lmaWMgc3VwZXJ0eXBlIHdob3NlIG5hbWUgaXMgYW4gb3duIHByb3BlcnR5IG9mIHRoZSBjYW5kaWRhdGVzCgkgICAgLy8gb2JqZWN0LgoJICAgIGZ1bmN0aW9uIGNvbXB1dGVTdXBlcnR5cGVMb29rdXBUYWJsZShjYW5kaWRhdGVzKSB7CgkgICAgICAgIHZhciB0YWJsZSA9IHt9OwoJICAgICAgICB2YXIgdHlwZU5hbWVzID0gT2JqZWN0LmtleXMoZGVmQ2FjaGUpOwoJICAgICAgICB2YXIgdHlwZU5hbWVDb3VudCA9IHR5cGVOYW1lcy5sZW5ndGg7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHlwZU5hbWVDb3VudDsgKytpKSB7CgkgICAgICAgICAgICB2YXIgdHlwZU5hbWUgPSB0eXBlTmFtZXNbaV07CgkgICAgICAgICAgICB2YXIgZCA9IGRlZkNhY2hlW3R5cGVOYW1lXTsKCSAgICAgICAgICAgIGlmIChkLmZpbmFsaXplZCAhPT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIiArIHR5cGVOYW1lKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZC5zdXBlcnR5cGVMaXN0Lmxlbmd0aDsgKytqKSB7CgkgICAgICAgICAgICAgICAgdmFyIHN1cGVyVHlwZU5hbWUgPSBkLnN1cGVydHlwZUxpc3Rbal07CgkgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGNhbmRpZGF0ZXMsIHN1cGVyVHlwZU5hbWUpKSB7CgkgICAgICAgICAgICAgICAgICAgIHRhYmxlW3R5cGVOYW1lXSA9IHN1cGVyVHlwZU5hbWU7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGFibGU7CgkgICAgfQoJICAgIHZhciBidWlsZGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkgICAgLy8gVGhpcyBvYmplY3QgaXMgdXNlZCBhcyBwcm90b3R5cGUgZm9yIGFueSBub2RlIGNyZWF0ZWQgYnkgYSBidWlsZGVyLgoJICAgIHZhciBub2RlUHJvdG90eXBlID0ge307CgkgICAgLy8gQ2FsbCB0aGlzIGZ1bmN0aW9uIHRvIGRlZmluZSBhIG5ldyBtZXRob2QgdG8gYmUgc2hhcmVkIGJ5IGFsbCBBU1QKCSAgICAvLyBub2Rlcy4gVGhlIHJlcGxhY2VkIG1ldGhvZCAoaWYgYW55KSBpcyByZXR1cm5lZCBmb3IgZWFzeSB3cmFwcGluZy4KCSAgICBmdW5jdGlvbiBkZWZpbmVNZXRob2QobmFtZSwgZnVuYykgewoJICAgICAgICB2YXIgb2xkID0gbm9kZVByb3RvdHlwZVtuYW1lXTsKCSAgICAgICAgLy8gUGFzcyB1bmRlZmluZWQgYXMgZnVuYyB0byBkZWxldGUgbm9kZVByb3RvdHlwZVtuYW1lXS4KCSAgICAgICAgaWYgKGlzVW5kZWZpbmVkLmNoZWNrKGZ1bmMpKSB7CgkgICAgICAgICAgICBkZWxldGUgbm9kZVByb3RvdHlwZVtuYW1lXTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIGlzRnVuY3Rpb24uYXNzZXJ0KGZ1bmMpOwoJICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5vZGVQcm90b3R5cGUsIG5hbWUsIHsKCSAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCSAgICAgICAgICAgICAgICB2YWx1ZTogZnVuYwoJICAgICAgICAgICAgfSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9sZDsKCSAgICB9CgkgICAgZnVuY3Rpb24gZ2V0QnVpbGRlck5hbWUodHlwZU5hbWUpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVOYW1lLnJlcGxhY2UoL15bQS1aXSsvLCBmdW5jdGlvbiAodXBwZXJDYXNlUHJlZml4KSB7CgkgICAgICAgICAgICB2YXIgbGVuID0gdXBwZXJDYXNlUHJlZml4Lmxlbmd0aDsKCSAgICAgICAgICAgIHN3aXRjaCAobGVuKSB7CgkgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gIiI7CgkgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUncyBvbmx5IG9uZSBpbml0aWFsIGNhcGl0YWwgbGV0dGVyLCBqdXN0IGxvd2VyLWNhc2UgaXQuCgkgICAgICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gdXBwZXJDYXNlUHJlZml4LnRvTG93ZXJDYXNlKCk7CgkgICAgICAgICAgICAgICAgZGVmYXVsdDoKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUncyBtb3JlIHRoYW4gb25lIGluaXRpYWwgY2FwaXRhbCBsZXR0ZXIsIGxvd2VyLWNhc2UKCSAgICAgICAgICAgICAgICAgICAgLy8gYWxsIGJ1dCB0aGUgbGFzdCBvbmUsIHNvIHRoYXQgWE1MRGVmYXVsdERlY2xhcmF0aW9uIChmb3IKCSAgICAgICAgICAgICAgICAgICAgLy8gZXhhbXBsZSkgYmVjb21lcyB4bWxEZWZhdWx0RGVjbGFyYXRpb24uCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cHBlckNhc2VQcmVmaXguc2xpY2UoMCwgbGVuIC0gMSkudG9Mb3dlckNhc2UoKSArCgkgICAgICAgICAgICAgICAgICAgICAgICB1cHBlckNhc2VQcmVmaXguY2hhckF0KGxlbiAtIDEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCSAgICB9CgkgICAgZnVuY3Rpb24gZ2V0U3RhdGVtZW50QnVpbGRlck5hbWUodHlwZU5hbWUpIHsKCSAgICAgICAgdHlwZU5hbWUgPSBnZXRCdWlsZGVyTmFtZSh0eXBlTmFtZSk7CgkgICAgICAgIHJldHVybiB0eXBlTmFtZS5yZXBsYWNlKC8oRXhwcmVzc2lvbik/JC8sICJTdGF0ZW1lbnQiKTsKCSAgICB9CgkgICAgdmFyIG5hbWVkVHlwZXMgPSB7fTsKCSAgICAvLyBMaWtlIE9iamVjdC5rZXlzLCBidXQgYXdhcmUgb2Ygd2hhdCBmaWVsZHMgZWFjaCBBU1QgdHlwZSBzaG91bGQgaGF2ZS4KCSAgICBmdW5jdGlvbiBnZXRGaWVsZE5hbWVzKG9iamVjdCkgewoJICAgICAgICB2YXIgZCA9IGRlZkZyb21WYWx1ZShvYmplY3QpOwoJICAgICAgICBpZiAoZCkgewoJICAgICAgICAgICAgcmV0dXJuIGQuZmllbGROYW1lcy5zbGljZSgwKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoInR5cGUiIGluIG9iamVjdCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJkaWQgbm90IHJlY29nbml6ZSBvYmplY3Qgb2YgdHlwZSAiICsKCSAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShvYmplY3QudHlwZSkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmplY3QpOwoJICAgIH0KCSAgICAvLyBHZXQgdGhlIHZhbHVlIG9mIGFuIG9iamVjdCBwcm9wZXJ0eSwgdGFraW5nIG9iamVjdC50eXBlIGFuZCBkZWZhdWx0CgkgICAgLy8gZnVuY3Rpb25zIGludG8gYWNjb3VudC4KCSAgICBmdW5jdGlvbiBnZXRGaWVsZFZhbHVlKG9iamVjdCwgZmllbGROYW1lKSB7CgkgICAgICAgIHZhciBkID0gZGVmRnJvbVZhbHVlKG9iamVjdCk7CgkgICAgICAgIGlmIChkKSB7CgkgICAgICAgICAgICB2YXIgZmllbGQgPSBkLmFsbEZpZWxkc1tmaWVsZE5hbWVdOwoJICAgICAgICAgICAgaWYgKGZpZWxkKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdldFZhbHVlKG9iamVjdCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9iamVjdCAmJiBvYmplY3RbZmllbGROYW1lXTsKCSAgICB9CgkgICAgLy8gSXRlcmF0ZSBvdmVyIGFsbCBkZWZpbmVkIGZpZWxkcyBvZiBhbiBvYmplY3QsIGluY2x1ZGluZyB0aG9zZSBtaXNzaW5nCgkgICAgLy8gb3IgdW5kZWZpbmVkLCBwYXNzaW5nIGVhY2ggZmllbGQgbmFtZSBhbmQgZWZmZWN0aXZlIHZhbHVlIChhcyByZXR1cm5lZAoJICAgIC8vIGJ5IGdldEZpZWxkVmFsdWUpIHRvIHRoZSBjYWxsYmFjay4gSWYgdGhlIG9iamVjdCBoYXMgbm8gY29ycmVzcG9uZGluZwoJICAgIC8vIERlZiwgdGhlIGNhbGxiYWNrIHdpbGwgbmV2ZXIgYmUgY2FsbGVkLgoJICAgIGZ1bmN0aW9uIGVhY2hGaWVsZChvYmplY3QsIGNhbGxiYWNrLCBjb250ZXh0KSB7CgkgICAgICAgIGdldEZpZWxkTmFtZXMob2JqZWN0KS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CgkgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIG5hbWUsIGdldEZpZWxkVmFsdWUob2JqZWN0LCBuYW1lKSk7CgkgICAgICAgIH0sIGNvbnRleHQpOwoJICAgIH0KCSAgICAvLyBTaW1pbGFyIHRvIGVhY2hGaWVsZCwgZXhjZXB0IHRoYXQgaXRlcmF0aW9uIHN0b3BzIGFzIHNvb24gYXMgdGhlCgkgICAgLy8gY2FsbGJhY2sgcmV0dXJucyBhIHRydXRoeSB2YWx1ZS4gTGlrZSBBcnJheS5wcm90b3R5cGUuc29tZSwgdGhlIGZpbmFsCgkgICAgLy8gcmVzdWx0IGlzIGVpdGhlciB0cnVlIG9yIGZhbHNlIHRvIGluZGljYXRlcyB3aGV0aGVyIHRoZSBjYWxsYmFjawoJICAgIC8vIHJldHVybmVkIHRydWUgZm9yIGFueSBlbGVtZW50IG9yIG5vdC4KCSAgICBmdW5jdGlvbiBzb21lRmllbGQob2JqZWN0LCBjYWxsYmFjaywgY29udGV4dCkgewoJICAgICAgICByZXR1cm4gZ2V0RmllbGROYW1lcyhvYmplY3QpLnNvbWUoZnVuY3Rpb24gKG5hbWUpIHsKCSAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5jYWxsKHRoaXMsIG5hbWUsIGdldEZpZWxkVmFsdWUob2JqZWN0LCBuYW1lKSk7CgkgICAgICAgIH0sIGNvbnRleHQpOwoJICAgIH0KCSAgICAvLyBBZGRzIGFuIGFkZGl0aW9uYWwgYnVpbGRlciBmb3IgRXhwcmVzc2lvbiBzdWJ0eXBlcwoJICAgIC8vIHRoYXQgd3JhcHMgdGhlIGJ1aWx0IEV4cHJlc3Npb24gaW4gYW4gRXhwcmVzc2lvblN0YXRlbWVudHMuCgkgICAgZnVuY3Rpb24gd3JhcEV4cHJlc3Npb25CdWlsZGVyV2l0aFN0YXRlbWVudCh0eXBlTmFtZSkgewoJICAgICAgICB2YXIgd3JhcHBlck5hbWUgPSBnZXRTdGF0ZW1lbnRCdWlsZGVyTmFtZSh0eXBlTmFtZSk7CgkgICAgICAgIC8vIHNraXAgaWYgdGhlIGJ1aWxkZXIgYWxyZWFkeSBleGlzdHMKCSAgICAgICAgaWYgKGJ1aWxkZXJzW3dyYXBwZXJOYW1lXSkKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgLy8gdGhlIGJ1aWxkZXIgZnVuY3Rpb24gdG8gd3JhcCB3aXRoIGJ1aWxkZXJzLkV4cHJlc3Npb25TdGF0ZW1lbnQKCSAgICAgICAgdmFyIHdyYXBwZWQgPSBidWlsZGVyc1tnZXRCdWlsZGVyTmFtZSh0eXBlTmFtZSldOwoJICAgICAgICAvLyBza2lwIGlmIHRoZXJlIGlzIG5vdGhpbmcgdG8gd3JhcAoJICAgICAgICBpZiAoIXdyYXBwZWQpCgkgICAgICAgICAgICByZXR1cm47CgkgICAgICAgIHZhciBidWlsZGVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXJzLmV4cHJlc3Npb25TdGF0ZW1lbnQod3JhcHBlZC5hcHBseShidWlsZGVycywgYXJncykpOwoJICAgICAgICB9OwoJICAgICAgICBidWlsZGVyLmZyb20gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gYnVpbGRlcnMuZXhwcmVzc2lvblN0YXRlbWVudCh3cmFwcGVkLmZyb20uYXBwbHkoYnVpbGRlcnMsIGFyZ3MpKTsKCSAgICAgICAgfTsKCSAgICAgICAgYnVpbGRlcnNbd3JhcHBlck5hbWVdID0gYnVpbGRlcjsKCSAgICB9CgkgICAgZnVuY3Rpb24gcG9wdWxhdGVTdXBlcnR5cGVMaXN0KHR5cGVOYW1lLCBsaXN0KSB7CgkgICAgICAgIGxpc3QubGVuZ3RoID0gMDsKCSAgICAgICAgbGlzdC5wdXNoKHR5cGVOYW1lKTsKCSAgICAgICAgdmFyIGxhc3RTZWVuID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICAgICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgbGlzdC5sZW5ndGg7ICsrcG9zKSB7CgkgICAgICAgICAgICB0eXBlTmFtZSA9IGxpc3RbcG9zXTsKCSAgICAgICAgICAgIHZhciBkID0gZGVmQ2FjaGVbdHlwZU5hbWVdOwoJICAgICAgICAgICAgaWYgKGQuZmluYWxpemVkICE9PSB0cnVlKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElmIHdlIHNhdyB0eXBlTmFtZSBlYXJsaWVyIGluIHRoZSBicmVhZHRoLWZpcnN0IHRyYXZlcnNhbCwKCSAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgbGFzdC1zZWVuIG9jY3VycmVuY2UuCgkgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwobGFzdFNlZW4sIHR5cGVOYW1lKSkgewoJICAgICAgICAgICAgICAgIGRlbGV0ZSBsaXN0W2xhc3RTZWVuW3R5cGVOYW1lXV07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBSZWNvcmQgdGhlIG5ldyBpbmRleCBvZiB0aGUgbGFzdC1zZWVuIG9jY3VycmVuY2Ugb2YgdHlwZU5hbWUuCgkgICAgICAgICAgICBsYXN0U2Vlblt0eXBlTmFtZV0gPSBwb3M7CgkgICAgICAgICAgICAvLyBFbnF1ZXVlIHRoZSBiYXNlIG5hbWVzIG9mIHRoaXMgdHlwZS4KCSAgICAgICAgICAgIGxpc3QucHVzaC5hcHBseShsaXN0LCBkLmJhc2VOYW1lcyk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29tcGFjdGlvbiBsb29wIHRvIHJlbW92ZSBhcnJheSBob2xlcy4KCSAgICAgICAgZm9yICh2YXIgdG8gPSAwLCBmcm9tID0gdG8sIGxlbiA9IGxpc3QubGVuZ3RoOyBmcm9tIDwgbGVuOyArK2Zyb20pIHsKCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChsaXN0LCBmcm9tKSkgewoJICAgICAgICAgICAgICAgIGxpc3RbdG8rK10gPSBsaXN0W2Zyb21dOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGxpc3QubGVuZ3RoID0gdG87CgkgICAgfQoJICAgIGZ1bmN0aW9uIGV4dGVuZChpbnRvLCBmcm9tKSB7CgkgICAgICAgIE9iamVjdC5rZXlzKGZyb20pLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKCSAgICAgICAgICAgIGludG9bbmFtZV0gPSBmcm9tW25hbWVdOwoJICAgICAgICB9KTsKCSAgICAgICAgcmV0dXJuIGludG87CgkgICAgfQoJICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgewoJICAgICAgICBPYmplY3Qua2V5cyhkZWZDYWNoZSkuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICAgICAgZGVmQ2FjaGVbbmFtZV0uZmluYWxpemUoKTsKCSAgICAgICAgfSk7CgkgICAgfQoJICAgIHJldHVybiB7CgkgICAgICAgIFR5cGU6IFR5cGUsCgkgICAgICAgIGJ1aWx0SW5UeXBlczogYnVpbHRJblR5cGVzLAoJICAgICAgICBnZXRTdXBlcnR5cGVOYW1lczogZ2V0U3VwZXJ0eXBlTmFtZXMsCgkgICAgICAgIGNvbXB1dGVTdXBlcnR5cGVMb29rdXBUYWJsZTogY29tcHV0ZVN1cGVydHlwZUxvb2t1cFRhYmxlLAoJICAgICAgICBidWlsZGVyczogYnVpbGRlcnMsCgkgICAgICAgIGRlZmluZU1ldGhvZDogZGVmaW5lTWV0aG9kLAoJICAgICAgICBnZXRCdWlsZGVyTmFtZTogZ2V0QnVpbGRlck5hbWUsCgkgICAgICAgIGdldFN0YXRlbWVudEJ1aWxkZXJOYW1lOiBnZXRTdGF0ZW1lbnRCdWlsZGVyTmFtZSwKCSAgICAgICAgbmFtZWRUeXBlczogbmFtZWRUeXBlcywKCSAgICAgICAgZ2V0RmllbGROYW1lczogZ2V0RmllbGROYW1lcywKCSAgICAgICAgZ2V0RmllbGRWYWx1ZTogZ2V0RmllbGRWYWx1ZSwKCSAgICAgICAgZWFjaEZpZWxkOiBlYWNoRmllbGQsCgkgICAgICAgIHNvbWVGaWVsZDogc29tZUZpZWxkLAoJICAgICAgICBmaW5hbGl6ZTogZmluYWxpemUsCgkgICAgfTsKCX0KCXR5cGVzLmRlZmF1bHQgPSB0eXBlc1BsdWdpbjsKCXJldHVybiB0eXBlczsKfQoKdmFyIHBhdGhWaXNpdG9yID0ge2V4cG9ydHM6IHt9fTsKCnZhciBub2RlUGF0aCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgcGF0aCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRQYXRoOwoKZnVuY3Rpb24gcmVxdWlyZVBhdGggKCkgewoJaWYgKGhhc1JlcXVpcmVkUGF0aCkgcmV0dXJuIHBhdGguZXhwb3J0czsKCWhhc1JlcXVpcmVkUGF0aCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBPcCA9IE9iamVjdC5wcm90b3R5cGU7CgkJdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5OwoJCWZ1bmN0aW9uIHBhdGhQbHVnaW4oZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgaXNBcnJheSA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5hcnJheTsKCQkgICAgdmFyIGlzTnVtYmVyID0gdHlwZXMuYnVpbHRJblR5cGVzLm51bWJlcjsKCQkgICAgdmFyIFBhdGggPSBmdW5jdGlvbiBQYXRoKHZhbHVlLCBwYXJlbnRQYXRoLCBuYW1lKSB7CgkJICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUGF0aCkpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhdGggY29uc3RydWN0b3IgY2Fubm90IGJlIGludm9rZWQgd2l0aG91dCAnbmV3JyIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKHBhcmVudFBhdGgpIHsKCQkgICAgICAgICAgICBpZiAoIShwYXJlbnRQYXRoIGluc3RhbmNlb2YgUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICBwYXJlbnRQYXRoID0gbnVsbDsKCQkgICAgICAgICAgICBuYW1lID0gbnVsbDsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIFRoZSB2YWx1ZSBlbmNhcHN1bGF0ZWQgYnkgdGhpcyBQYXRoLCBnZW5lcmFsbHkgZXF1YWwgdG8KCQkgICAgICAgIC8vIHBhcmVudFBhdGgudmFsdWVbbmFtZV0gaWYgd2UgaGF2ZSBhIHBhcmVudFBhdGguCgkJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkJICAgICAgICAvLyBUaGUgaW1tZWRpYXRlIHBhcmVudCBQYXRoIG9mIHRoaXMgUGF0aC4KCQkgICAgICAgIHRoaXMucGFyZW50UGF0aCA9IHBhcmVudFBhdGg7CgkJICAgICAgICAvLyBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgb2YgcGFyZW50UGF0aC52YWx1ZSB0aHJvdWdoIHdoaWNoIHRoaXMKCQkgICAgICAgIC8vIFBhdGgncyB2YWx1ZSB3YXMgcmVhY2hlZC4KCQkgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CgkJICAgICAgICAvLyBDYWxsaW5nIHBhdGguZ2V0KCJjaGlsZCIpIG11bHRpcGxlIHRpbWVzIGFsd2F5cyByZXR1cm5zIHRoZSBzYW1lCgkJICAgICAgICAvLyBjaGlsZCBQYXRoIG9iamVjdCwgZm9yIGJvdGggcGVyZm9ybWFuY2UgYW5kIGNvbnNpc3RlbmN5IHJlYXNvbnMuCgkJICAgICAgICB0aGlzLl9fY2hpbGRDYWNoZSA9IG51bGw7CgkJICAgIH07CgkJICAgIHZhciBQcCA9IFBhdGgucHJvdG90eXBlOwoJCSAgICBmdW5jdGlvbiBnZXRDaGlsZENhY2hlKHBhdGgpIHsKCQkgICAgICAgIC8vIExhemlseSBjcmVhdGUgdGhlIGNoaWxkIGNhY2hlLiBUaGlzIGFsc28gY2hlYXBlbnMgY2FjaGUKCQkgICAgICAgIC8vIGludmFsaWRhdGlvbiwgc2luY2UgeW91IGNhbiBqdXN0IHJlc2V0IHBhdGguX19jaGlsZENhY2hlIHRvIG51bGwuCgkJICAgICAgICByZXR1cm4gcGF0aC5fX2NoaWxkQ2FjaGUgfHwgKHBhdGguX19jaGlsZENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKSk7CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gZ2V0Q2hpbGRQYXRoKHBhdGgsIG5hbWUpIHsKCQkgICAgICAgIHZhciBjYWNoZSA9IGdldENoaWxkQ2FjaGUocGF0aCk7CgkJICAgICAgICB2YXIgYWN0dWFsQ2hpbGRWYWx1ZSA9IHBhdGguZ2V0VmFsdWVQcm9wZXJ0eShuYW1lKTsKCQkgICAgICAgIHZhciBjaGlsZFBhdGggPSBjYWNoZVtuYW1lXTsKCQkgICAgICAgIGlmICghaGFzT3duLmNhbGwoY2FjaGUsIG5hbWUpIHx8CgkJICAgICAgICAgICAgLy8gRW5zdXJlIGNvbnNpc3RlbmN5IGJldHdlZW4gY2FjaGUgYW5kIHJlYWxpdHkuCgkJICAgICAgICAgICAgY2hpbGRQYXRoLnZhbHVlICE9PSBhY3R1YWxDaGlsZFZhbHVlKSB7CgkJICAgICAgICAgICAgY2hpbGRQYXRoID0gY2FjaGVbbmFtZV0gPSBuZXcgcGF0aC5jb25zdHJ1Y3RvcihhY3R1YWxDaGlsZFZhbHVlLCBwYXRoLCBuYW1lKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBjaGlsZFBhdGg7CgkJICAgIH0KCQkgICAgLy8gVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgb3ZlcnJpZGRlbiBieSBzdWJjbGFzc2VzIHRoYXQgbmVlZCB0bwoJCSAgICAvLyBoYW5kbGUgbWlzc2luZyBwcm9wZXJ0aWVzLCBldGMuCgkJICAgIFBwLmdldFZhbHVlUHJvcGVydHkgPSBmdW5jdGlvbiBnZXRWYWx1ZVByb3BlcnR5KG5hbWUpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlW25hbWVdOwoJCSAgICB9OwoJCSAgICBQcC5nZXQgPSBmdW5jdGlvbiBnZXQoKSB7CgkJICAgICAgICB2YXIgbmFtZXMgPSBbXTsKCQkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkJICAgICAgICAgICAgbmFtZXNbX2ldID0gYXJndW1lbnRzW19pXTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwYXRoID0gdGhpczsKCQkgICAgICAgIHZhciBjb3VudCA9IG5hbWVzLmxlbmd0aDsKCQkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewoJCSAgICAgICAgICAgIHBhdGggPSBnZXRDaGlsZFBhdGgocGF0aCwgbmFtZXNbaV0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBhdGg7CgkJICAgIH07CgkJICAgIFBwLmVhY2ggPSBmdW5jdGlvbiBlYWNoKGNhbGxiYWNrLCBjb250ZXh0KSB7CgkJICAgICAgICB2YXIgY2hpbGRQYXRocyA9IFtdOwoJCSAgICAgICAgdmFyIGxlbiA9IHRoaXMudmFsdWUubGVuZ3RoOwoJCSAgICAgICAgdmFyIGkgPSAwOwoJCSAgICAgICAgLy8gQ29sbGVjdCBhbGwgdGhlIG9yaWdpbmFsIGNoaWxkIHBhdGhzIGJlZm9yZSBpbnZva2luZyB0aGUgY2FsbGJhY2suCgkJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7CgkJICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKHRoaXMudmFsdWUsIGkpKSB7CgkJICAgICAgICAgICAgICAgIGNoaWxkUGF0aHNbaV0gPSB0aGlzLmdldChpKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICAvLyBJbnZva2UgdGhlIGNhbGxiYWNrIG9uIGp1c3QgdGhlIG9yaWdpbmFsIGNoaWxkIHBhdGhzLCByZWdhcmRsZXNzIG9mCgkJICAgICAgICAvLyBhbnkgbW9kaWZpY2F0aW9ucyBtYWRlIHRvIHRoZSBhcnJheSBieSB0aGUgY2FsbGJhY2suIEkgY2hvc2UgdGhlc2UKCQkgICAgICAgIC8vIHNlbWFudGljcyBvdmVyIGNsZXZlcmx5IGludm9raW5nIHRoZSBjYWxsYmFjayBvbiBuZXcgZWxlbWVudHMgYmVjYXVzZQoJCSAgICAgICAgLy8gdGhpcyB3YXkgaXMgbXVjaCBlYXNpZXIgdG8gcmVhc29uIGFib3V0LgoJCSAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgdGhpczsKCQkgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkgewoJCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChjaGlsZFBhdGhzLCBpKSkgewoJCSAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKGNvbnRleHQsIGNoaWxkUGF0aHNbaV0pOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgfTsKCQkgICAgUHAubWFwID0gZnVuY3Rpb24gbWFwKGNhbGxiYWNrLCBjb250ZXh0KSB7CgkJICAgICAgICB2YXIgcmVzdWx0ID0gW107CgkJICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGNoaWxkUGF0aCkgewoJCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNhbGxiYWNrLmNhbGwodGhpcywgY2hpbGRQYXRoKSk7CgkJICAgICAgICB9LCBjb250ZXh0KTsKCQkgICAgICAgIHJldHVybiByZXN1bHQ7CgkJICAgIH07CgkJICAgIFBwLmZpbHRlciA9IGZ1bmN0aW9uIGZpbHRlcihjYWxsYmFjaywgY29udGV4dCkgewoJCSAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoJCSAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChjaGlsZFBhdGgpIHsKCQkgICAgICAgICAgICBpZiAoY2FsbGJhY2suY2FsbCh0aGlzLCBjaGlsZFBhdGgpKSB7CgkJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNoaWxkUGF0aCk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfSwgY29udGV4dCk7CgkJICAgICAgICByZXR1cm4gcmVzdWx0OwoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiBlbXB0eU1vdmVzKCkgeyB9CgkJICAgIGZ1bmN0aW9uIGdldE1vdmVzKHBhdGgsIG9mZnNldCwgc3RhcnQsIGVuZCkgewoJCSAgICAgICAgaXNBcnJheS5hc3NlcnQocGF0aC52YWx1ZSk7CgkJICAgICAgICBpZiAob2Zmc2V0ID09PSAwKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGVtcHR5TW92ZXM7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgbGVuZ3RoID0gcGF0aC52YWx1ZS5sZW5ndGg7CgkJICAgICAgICBpZiAobGVuZ3RoIDwgMSkgewoJCSAgICAgICAgICAgIHJldHVybiBlbXB0eU1vdmVzOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIGFyZ2MgPSBhcmd1bWVudHMubGVuZ3RoOwoJCSAgICAgICAgaWYgKGFyZ2MgPT09IDIpIHsKCQkgICAgICAgICAgICBzdGFydCA9IDA7CgkJICAgICAgICAgICAgZW5kID0gbGVuZ3RoOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoYXJnYyA9PT0gMykgewoJCSAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoc3RhcnQsIDApOwoJCSAgICAgICAgICAgIGVuZCA9IGxlbmd0aDsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoc3RhcnQsIDApOwoJCSAgICAgICAgICAgIGVuZCA9IE1hdGgubWluKGVuZCwgbGVuZ3RoKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlzTnVtYmVyLmFzc2VydChzdGFydCk7CgkJICAgICAgICBpc051bWJlci5hc3NlcnQoZW5kKTsKCQkgICAgICAgIHZhciBtb3ZlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICAgICAgICB2YXIgY2FjaGUgPSBnZXRDaGlsZENhY2hlKHBhdGgpOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKCQkgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwocGF0aC52YWx1ZSwgaSkpIHsKCQkgICAgICAgICAgICAgICAgdmFyIGNoaWxkUGF0aCA9IHBhdGguZ2V0KGkpOwoJCSAgICAgICAgICAgICAgICBpZiAoY2hpbGRQYXRoLm5hbWUgIT09IGkpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgdmFyIG5ld0luZGV4ID0gaSArIG9mZnNldDsKCQkgICAgICAgICAgICAgICAgY2hpbGRQYXRoLm5hbWUgPSBuZXdJbmRleDsKCQkgICAgICAgICAgICAgICAgbW92ZXNbbmV3SW5kZXhdID0gY2hpbGRQYXRoOwoJCSAgICAgICAgICAgICAgICBkZWxldGUgY2FjaGVbaV07CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZGVsZXRlIGNhY2hlLmxlbmd0aDsKCQkgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJICAgICAgICAgICAgZm9yICh2YXIgbmV3SW5kZXggaW4gbW92ZXMpIHsKCQkgICAgICAgICAgICAgICAgdmFyIGNoaWxkUGF0aCA9IG1vdmVzW25ld0luZGV4XTsKCQkgICAgICAgICAgICAgICAgaWYgKGNoaWxkUGF0aC5uYW1lICE9PSArbmV3SW5kZXgpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY2FjaGVbbmV3SW5kZXhdID0gY2hpbGRQYXRoOwoJCSAgICAgICAgICAgICAgICBwYXRoLnZhbHVlW25ld0luZGV4XSA9IGNoaWxkUGF0aC52YWx1ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9OwoJCSAgICB9CgkJICAgIFBwLnNoaWZ0ID0gZnVuY3Rpb24gc2hpZnQoKSB7CgkJICAgICAgICB2YXIgbW92ZSA9IGdldE1vdmVzKHRoaXMsIC0xKTsKCQkgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLnZhbHVlLnNoaWZ0KCk7CgkJICAgICAgICBtb3ZlKCk7CgkJICAgICAgICByZXR1cm4gcmVzdWx0OwoJCSAgICB9OwoJCSAgICBQcC51bnNoaWZ0ID0gZnVuY3Rpb24gdW5zaGlmdCgpIHsKCQkgICAgICAgIHZhciBhcmdzID0gW107CgkJICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJCSAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBtb3ZlID0gZ2V0TW92ZXModGhpcywgYXJncy5sZW5ndGgpOwoJCSAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMudmFsdWUudW5zaGlmdC5hcHBseSh0aGlzLnZhbHVlLCBhcmdzKTsKCQkgICAgICAgIG1vdmUoKTsKCQkgICAgICAgIHJldHVybiByZXN1bHQ7CgkJICAgIH07CgkJICAgIFBwLnB1c2ggPSBmdW5jdGlvbiBwdXNoKCkgewoJCSAgICAgICAgdmFyIGFyZ3MgPSBbXTsKCQkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkJICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgaXNBcnJheS5hc3NlcnQodGhpcy52YWx1ZSk7CgkJICAgICAgICBkZWxldGUgZ2V0Q2hpbGRDYWNoZSh0aGlzKS5sZW5ndGg7CgkJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5wdXNoLmFwcGx5KHRoaXMudmFsdWUsIGFyZ3MpOwoJCSAgICB9OwoJCSAgICBQcC5wb3AgPSBmdW5jdGlvbiBwb3AoKSB7CgkJICAgICAgICBpc0FycmF5LmFzc2VydCh0aGlzLnZhbHVlKTsKCQkgICAgICAgIHZhciBjYWNoZSA9IGdldENoaWxkQ2FjaGUodGhpcyk7CgkJICAgICAgICBkZWxldGUgY2FjaGVbdGhpcy52YWx1ZS5sZW5ndGggLSAxXTsKCQkgICAgICAgIGRlbGV0ZSBjYWNoZS5sZW5ndGg7CgkJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5wb3AoKTsKCQkgICAgfTsKCQkgICAgUHAuaW5zZXJ0QXQgPSBmdW5jdGlvbiBpbnNlcnRBdChpbmRleCkgewoJCSAgICAgICAgdmFyIGFyZ2MgPSBhcmd1bWVudHMubGVuZ3RoOwoJCSAgICAgICAgdmFyIG1vdmUgPSBnZXRNb3Zlcyh0aGlzLCBhcmdjIC0gMSwgaW5kZXgpOwoJCSAgICAgICAgaWYgKG1vdmUgPT09IGVtcHR5TW92ZXMgJiYgYXJnYyA8PSAxKSB7CgkJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkJICAgICAgICB9CgkJICAgICAgICBpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTsKCQkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJnYzsgKytpKSB7CgkJICAgICAgICAgICAgdGhpcy52YWx1ZVtpbmRleCArIGkgLSAxXSA9IGFyZ3VtZW50c1tpXTsKCQkgICAgICAgIH0KCQkgICAgICAgIG1vdmUoKTsKCQkgICAgICAgIHJldHVybiB0aGlzOwoJCSAgICB9OwoJCSAgICBQcC5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbiBpbnNlcnRCZWZvcmUoKSB7CgkJICAgICAgICB2YXIgYXJncyA9IFtdOwoJCSAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCQkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgcHAgPSB0aGlzLnBhcmVudFBhdGg7CgkJICAgICAgICB2YXIgYXJnYyA9IGFyZ3MubGVuZ3RoOwoJCSAgICAgICAgdmFyIGluc2VydEF0QXJncyA9IFt0aGlzLm5hbWVdOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdjOyArK2kpIHsKCQkgICAgICAgICAgICBpbnNlcnRBdEFyZ3MucHVzaChhcmdzW2ldKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBwcC5pbnNlcnRBdC5hcHBseShwcCwgaW5zZXJ0QXRBcmdzKTsKCQkgICAgfTsKCQkgICAgUHAuaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbiBpbnNlcnRBZnRlcigpIHsKCQkgICAgICAgIHZhciBhcmdzID0gW107CgkJICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJCSAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIHZhciBhcmdjID0gYXJncy5sZW5ndGg7CgkJICAgICAgICB2YXIgaW5zZXJ0QXRBcmdzID0gW3RoaXMubmFtZSArIDFdOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdjOyArK2kpIHsKCQkgICAgICAgICAgICBpbnNlcnRBdEFyZ3MucHVzaChhcmdzW2ldKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBwcC5pbnNlcnRBdC5hcHBseShwcCwgaW5zZXJ0QXRBcmdzKTsKCQkgICAgfTsKCQkgICAgZnVuY3Rpb24gcmVwYWlyUmVsYXRpb25zaGlwV2l0aFBhcmVudChwYXRoKSB7CgkJICAgICAgICBpZiAoIShwYXRoIGluc3RhbmNlb2YgUGF0aCkpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHBwID0gcGF0aC5wYXJlbnRQYXRoOwoJCSAgICAgICAgaWYgKCFwcCkgewoJCSAgICAgICAgICAgIC8vIE9ycGhhbiBwYXRocyBoYXZlIG5vIHJlbGF0aW9uc2hpcCB0byByZXBhaXIuCgkJICAgICAgICAgICAgcmV0dXJuIHBhdGg7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgcGFyZW50VmFsdWUgPSBwcC52YWx1ZTsKCQkgICAgICAgIHZhciBwYXJlbnRDYWNoZSA9IGdldENoaWxkQ2FjaGUocHApOwoJCSAgICAgICAgLy8gTWFrZSBzdXJlIHBhcmVudENhY2hlW3BhdGgubmFtZV0gaXMgcG9wdWxhdGVkLgoJCSAgICAgICAgaWYgKHBhcmVudFZhbHVlW3BhdGgubmFtZV0gPT09IHBhdGgudmFsdWUpIHsKCQkgICAgICAgICAgICBwYXJlbnRDYWNoZVtwYXRoLm5hbWVdID0gcGF0aDsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKGlzQXJyYXkuY2hlY2socGFyZW50VmFsdWUpKSB7CgkJICAgICAgICAgICAgLy8gU29tZXRoaW5nIGNhdXNlZCBwYXRoLm5hbWUgdG8gYmVjb21lIG91dCBvZiBkYXRlLCBzbyBhdHRlbXB0IHRvCgkJICAgICAgICAgICAgLy8gcmVjb3ZlciBieSBzZWFyY2hpbmcgZm9yIHBhdGgudmFsdWUgaW4gcGFyZW50VmFsdWUuCgkJICAgICAgICAgICAgdmFyIGkgPSBwYXJlbnRWYWx1ZS5pbmRleE9mKHBhdGgudmFsdWUpOwoJCSAgICAgICAgICAgIGlmIChpID49IDApIHsKCQkgICAgICAgICAgICAgICAgcGFyZW50Q2FjaGVbcGF0aC5uYW1lID0gaV0gPSBwYXRoOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIC8vIElmIHBhdGgudmFsdWUgZGlzYWdyZWVzIHdpdGggcGFyZW50VmFsdWVbcGF0aC5uYW1lXSwgYW5kCgkJICAgICAgICAgICAgLy8gcGF0aC5uYW1lIGlzIG5vdCBhbiBhcnJheSBpbmRleCwgbGV0IHBhdGgudmFsdWUgYmVjb21lIHRoZSBuZXcKCQkgICAgICAgICAgICAvLyBwYXJlbnRWYWx1ZVtwYXRoLm5hbWVdIGFuZCB1cGRhdGUgcGFyZW50Q2FjaGUgYWNjb3JkaW5nbHkuCgkJICAgICAgICAgICAgcGFyZW50VmFsdWVbcGF0aC5uYW1lXSA9IHBhdGgudmFsdWU7CgkJICAgICAgICAgICAgcGFyZW50Q2FjaGVbcGF0aC5uYW1lXSA9IHBhdGg7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAocGFyZW50VmFsdWVbcGF0aC5uYW1lXSAhPT0gcGF0aC52YWx1ZSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAocGF0aC5wYXJlbnRQYXRoLmdldChwYXRoLm5hbWUpICE9PSBwYXRoKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBwYXRoOwoJCSAgICB9CgkJICAgIFBwLnJlcGxhY2UgPSBmdW5jdGlvbiByZXBsYWNlKHJlcGxhY2VtZW50KSB7CgkJICAgICAgICB2YXIgcmVzdWx0cyA9IFtdOwoJCSAgICAgICAgdmFyIHBhcmVudFZhbHVlID0gdGhpcy5wYXJlbnRQYXRoLnZhbHVlOwoJCSAgICAgICAgdmFyIHBhcmVudENhY2hlID0gZ2V0Q2hpbGRDYWNoZSh0aGlzLnBhcmVudFBhdGgpOwoJCSAgICAgICAgdmFyIGNvdW50ID0gYXJndW1lbnRzLmxlbmd0aDsKCQkgICAgICAgIHJlcGFpclJlbGF0aW9uc2hpcFdpdGhQYXJlbnQodGhpcyk7CgkJICAgICAgICBpZiAoaXNBcnJheS5jaGVjayhwYXJlbnRWYWx1ZSkpIHsKCQkgICAgICAgICAgICB2YXIgb3JpZ2luYWxMZW5ndGggPSBwYXJlbnRWYWx1ZS5sZW5ndGg7CgkJICAgICAgICAgICAgdmFyIG1vdmUgPSBnZXRNb3Zlcyh0aGlzLnBhcmVudFBhdGgsIGNvdW50IC0gMSwgdGhpcy5uYW1lICsgMSk7CgkJICAgICAgICAgICAgdmFyIHNwbGljZUFyZ3MgPSBbdGhpcy5uYW1lLCAxXTsKCQkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKCQkgICAgICAgICAgICAgICAgc3BsaWNlQXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIHZhciBzcGxpY2VkT3V0ID0gcGFyZW50VmFsdWUuc3BsaWNlLmFwcGx5KHBhcmVudFZhbHVlLCBzcGxpY2VBcmdzKTsKCQkgICAgICAgICAgICBpZiAoc3BsaWNlZE91dFswXSAhPT0gdGhpcy52YWx1ZSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAocGFyZW50VmFsdWUubGVuZ3RoICE9PSAob3JpZ2luYWxMZW5ndGggLSAxICsgY291bnQpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIG1vdmUoKTsKCQkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCQkgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMudmFsdWU7CgkJICAgICAgICAgICAgICAgIGRlbGV0ZSBwYXJlbnRDYWNoZVt0aGlzLm5hbWVdOwoJCSAgICAgICAgICAgICAgICB0aGlzLl9fY2hpbGRDYWNoZSA9IG51bGw7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50VmFsdWVbdGhpcy5uYW1lXSAhPT0gcmVwbGFjZW1lbnQpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgIT09IHJlcGxhY2VtZW50KSB7CgkJICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gcmVwbGFjZW1lbnQ7CgkJICAgICAgICAgICAgICAgICAgICB0aGlzLl9fY2hpbGRDYWNoZSA9IG51bGw7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKCQkgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh0aGlzLnBhcmVudFBhdGguZ2V0KHRoaXMubmFtZSArIGkpKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBpZiAocmVzdWx0c1swXSAhPT0gdGhpcykgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKGNvdW50ID09PSAxKSB7CgkJICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgIT09IHJlcGxhY2VtZW50KSB7CgkJICAgICAgICAgICAgICAgIHRoaXMuX19jaGlsZENhY2hlID0gbnVsbDsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHBhcmVudFZhbHVlW3RoaXMubmFtZV0gPSByZXBsYWNlbWVudDsKCQkgICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMCkgewoJCSAgICAgICAgICAgIGRlbGV0ZSBwYXJlbnRWYWx1ZVt0aGlzLm5hbWVdOwoJCSAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlOwoJCSAgICAgICAgICAgIHRoaXMuX19jaGlsZENhY2hlID0gbnVsbDsKCQkgICAgICAgICAgICAvLyBMZWF2ZSB0aGlzIHBhdGggY2FjaGVkIGFzIHBhcmVudENhY2hlW3RoaXMubmFtZV0sIGV2ZW4gdGhvdWdoCgkJICAgICAgICAgICAgLy8gaXQgbm8gbG9uZ2VyIGhhcyBhIHZhbHVlIGRlZmluZWQuCgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCByZXBsYWNlIHBhdGgiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiByZXN1bHRzOwoJCSAgICB9OwoJCSAgICByZXR1cm4gUGF0aDsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gcGF0aFBsdWdpbjsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChwYXRoLCBwYXRoLmV4cG9ydHMpKTsKCXJldHVybiBwYXRoLmV4cG9ydHM7Cn0KCnZhciBzY29wZSQxID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZFNjb3BlOwoKZnVuY3Rpb24gcmVxdWlyZVNjb3BlICgpIHsKCWlmIChoYXNSZXF1aXJlZFNjb3BlKSByZXR1cm4gc2NvcGUkMS5leHBvcnRzOwoJaGFzUmVxdWlyZWRTY29wZSA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwoJCWZ1bmN0aW9uIHNjb3BlUGx1Z2luKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIFR5cGUgPSB0eXBlcy5UeXBlOwoJCSAgICB2YXIgbmFtZWRUeXBlcyA9IHR5cGVzLm5hbWVkVHlwZXM7CgkJICAgIHZhciBOb2RlID0gbmFtZWRUeXBlcy5Ob2RlOwoJCSAgICB2YXIgRXhwcmVzc2lvbiA9IG5hbWVkVHlwZXMuRXhwcmVzc2lvbjsKCQkgICAgdmFyIGlzQXJyYXkgPSB0eXBlcy5idWlsdEluVHlwZXMuYXJyYXk7CgkJICAgIHZhciBiID0gdHlwZXMuYnVpbGRlcnM7CgkJICAgIHZhciBTY29wZSA9IGZ1bmN0aW9uIFNjb3BlKHBhdGgsIHBhcmVudFNjb3BlKSB7CgkJICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2NvcGUpKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJTY29wZSBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgaW52b2tlZCB3aXRob3V0ICduZXcnIik7CgkJICAgICAgICB9CgkJICAgICAgICBTY29wZVR5cGUuYXNzZXJ0KHBhdGgudmFsdWUpOwoJCSAgICAgICAgdmFyIGRlcHRoOwoJCSAgICAgICAgaWYgKHBhcmVudFNjb3BlKSB7CgkJICAgICAgICAgICAgaWYgKCEocGFyZW50U2NvcGUgaW5zdGFuY2VvZiBTY29wZSkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZGVwdGggPSBwYXJlbnRTY29wZS5kZXB0aCArIDE7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICBwYXJlbnRTY29wZSA9IG51bGw7CgkJICAgICAgICAgICAgZGVwdGggPSAwOwoJCSAgICAgICAgfQoJCSAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewoJCSAgICAgICAgICAgIHBhdGg6IHsgdmFsdWU6IHBhdGggfSwKCQkgICAgICAgICAgICBub2RlOiB7IHZhbHVlOiBwYXRoLnZhbHVlIH0sCgkJICAgICAgICAgICAgaXNHbG9iYWw6IHsgdmFsdWU6ICFwYXJlbnRTY29wZSwgZW51bWVyYWJsZTogdHJ1ZSB9LAoJCSAgICAgICAgICAgIGRlcHRoOiB7IHZhbHVlOiBkZXB0aCB9LAoJCSAgICAgICAgICAgIHBhcmVudDogeyB2YWx1ZTogcGFyZW50U2NvcGUgfSwKCQkgICAgICAgICAgICBiaW5kaW5nczogeyB2YWx1ZToge30gfSwKCQkgICAgICAgICAgICB0eXBlczogeyB2YWx1ZToge30gfSwKCQkgICAgICAgIH0pOwoJCSAgICB9OwoJCSAgICB2YXIgc2NvcGVUeXBlcyA9IFsKCQkgICAgICAgIC8vIFByb2dyYW0gbm9kZXMgaW50cm9kdWNlIGdsb2JhbCBzY29wZXMuCgkJICAgICAgICBuYW1lZFR5cGVzLlByb2dyYW0sCgkJICAgICAgICAvLyBGdW5jdGlvbiBpcyB0aGUgc3VwZXJ0eXBlIG9mIEZ1bmN0aW9uRXhwcmVzc2lvbiwKCQkgICAgICAgIC8vIEZ1bmN0aW9uRGVjbGFyYXRpb24sIEFycm93RXhwcmVzc2lvbiwgZXRjLgoJCSAgICAgICAgbmFtZWRUeXBlcy5GdW5jdGlvbiwKCQkgICAgICAgIC8vIEluIGNhc2UgeW91IGRpZG4ndCBrbm93LCB0aGUgY2F1Z2h0IHBhcmFtZXRlciBzaGFkb3dzIGFueSB2YXJpYWJsZQoJCSAgICAgICAgLy8gb2YgdGhlIHNhbWUgbmFtZSBpbiBhbiBvdXRlciBzY29wZS4KCQkgICAgICAgIG5hbWVkVHlwZXMuQ2F0Y2hDbGF1c2UKCQkgICAgXTsKCQkgICAgdmFyIFNjb3BlVHlwZSA9IFR5cGUub3IuYXBwbHkoVHlwZSwgc2NvcGVUeXBlcyk7CgkJICAgIFNjb3BlLmlzRXN0YWJsaXNoZWRCeSA9IGZ1bmN0aW9uIChub2RlKSB7CgkJICAgICAgICByZXR1cm4gU2NvcGVUeXBlLmNoZWNrKG5vZGUpOwoJCSAgICB9OwoJCSAgICB2YXIgU3AgPSBTY29wZS5wcm90b3R5cGU7CgkJICAgIC8vIFdpbGwgYmUgb3ZlcnJpZGRlbiBhZnRlciBhbiBpbnN0YW5jZSBsYXppbHkgY2FsbHMgc2NhblNjb3BlLgoJCSAgICBTcC5kaWRTY2FuID0gZmFsc2U7CgkJICAgIFNwLmRlY2xhcmVzID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkgICAgICAgIHRoaXMuc2NhbigpOwoJCSAgICAgICAgcmV0dXJuIGhhc093bi5jYWxsKHRoaXMuYmluZGluZ3MsIG5hbWUpOwoJCSAgICB9OwoJCSAgICBTcC5kZWNsYXJlc1R5cGUgPSBmdW5jdGlvbiAobmFtZSkgewoJCSAgICAgICAgdGhpcy5zY2FuKCk7CgkJICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwodGhpcy50eXBlcywgbmFtZSk7CgkJICAgIH07CgkJICAgIFNwLmRlY2xhcmVUZW1wb3JhcnkgPSBmdW5jdGlvbiAocHJlZml4KSB7CgkJICAgICAgICBpZiAocHJlZml4KSB7CgkJICAgICAgICAgICAgaWYgKCEvXlthLXokX10vaS50ZXN0KHByZWZpeCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICBwcmVmaXggPSAidCQiOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gSW5jbHVkZSB0aGlzLmRlcHRoIGluIHRoZSBuYW1lIHRvIG1ha2Ugc3VyZSB0aGUgbmFtZSBkb2VzIG5vdAoJCSAgICAgICAgLy8gY29sbGlkZSB3aXRoIGFueSB2YXJpYWJsZXMgaW4gbmVzdGVkL2VuY2xvc2luZyBzY29wZXMuCgkJICAgICAgICBwcmVmaXggKz0gdGhpcy5kZXB0aC50b1N0cmluZygzNikgKyAiJCI7CgkJICAgICAgICB0aGlzLnNjYW4oKTsKCQkgICAgICAgIHZhciBpbmRleCA9IDA7CgkJICAgICAgICB3aGlsZSAodGhpcy5kZWNsYXJlcyhwcmVmaXggKyBpbmRleCkpIHsKCQkgICAgICAgICAgICArK2luZGV4OwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIG5hbWUgPSBwcmVmaXggKyBpbmRleDsKCQkgICAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdzW25hbWVdID0gdHlwZXMuYnVpbGRlcnMuaWRlbnRpZmllcihuYW1lKTsKCQkgICAgfTsKCQkgICAgU3AuaW5qZWN0VGVtcG9yYXJ5ID0gZnVuY3Rpb24gKGlkZW50aWZpZXIsIGluaXQpIHsKCQkgICAgICAgIGlkZW50aWZpZXIgfHwgKGlkZW50aWZpZXIgPSB0aGlzLmRlY2xhcmVUZW1wb3JhcnkoKSk7CgkJICAgICAgICB2YXIgYm9keVBhdGggPSB0aGlzLnBhdGguZ2V0KCJib2R5Iik7CgkJICAgICAgICBpZiAobmFtZWRUeXBlcy5CbG9ja1N0YXRlbWVudC5jaGVjayhib2R5UGF0aC52YWx1ZSkpIHsKCQkgICAgICAgICAgICBib2R5UGF0aCA9IGJvZHlQYXRoLmdldCgiYm9keSIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgYm9keVBhdGgudW5zaGlmdChiLnZhcmlhYmxlRGVjbGFyYXRpb24oInZhciIsIFtiLnZhcmlhYmxlRGVjbGFyYXRvcihpZGVudGlmaWVyLCBpbml0IHx8IG51bGwpXSkpOwoJCSAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7CgkJICAgIH07CgkJICAgIFNwLnNjYW4gPSBmdW5jdGlvbiAoZm9yY2UpIHsKCQkgICAgICAgIGlmIChmb3JjZSB8fCAhdGhpcy5kaWRTY2FuKSB7CgkJICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLmJpbmRpbmdzKSB7CgkJICAgICAgICAgICAgICAgIC8vIEVtcHR5IG91dCB0aGlzLmJpbmRpbmdzLCBqdXN0IGluIGNhc2VzLgoJCSAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5iaW5kaW5nc1tuYW1lXTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgc2NhblNjb3BlKHRoaXMucGF0aCwgdGhpcy5iaW5kaW5ncywgdGhpcy50eXBlcyk7CgkJICAgICAgICAgICAgdGhpcy5kaWRTY2FuID0gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgfTsKCQkgICAgU3AuZ2V0QmluZGluZ3MgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB0aGlzLnNjYW4oKTsKCQkgICAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdzOwoJCSAgICB9OwoJCSAgICBTcC5nZXRUeXBlcyA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHRoaXMuc2NhbigpOwoJCSAgICAgICAgcmV0dXJuIHRoaXMudHlwZXM7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIHNjYW5TY29wZShwYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcykgewoJCSAgICAgICAgdmFyIG5vZGUgPSBwYXRoLnZhbHVlOwoJCSAgICAgICAgU2NvcGVUeXBlLmFzc2VydChub2RlKTsKCQkgICAgICAgIGlmIChuYW1lZFR5cGVzLkNhdGNoQ2xhdXNlLmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgLy8gQSBjYXRjaCBjbGF1c2UgZXN0YWJsaXNoZXMgYSBuZXcgc2NvcGUgYnV0IHRoZSBvbmx5IHZhcmlhYmxlCgkJICAgICAgICAgICAgLy8gYm91bmQgaW4gdGhhdCBzY29wZSBpcyB0aGUgY2F0Y2ggcGFyYW1ldGVyLiBBbnkgb3RoZXIKCQkgICAgICAgICAgICAvLyBkZWNsYXJhdGlvbnMgY3JlYXRlIGJpbmRpbmdzIGluIHRoZSBvdXRlciBzY29wZS4KCQkgICAgICAgICAgICB2YXIgcGFyYW0gPSBwYXRoLmdldCgicGFyYW0iKTsKCQkgICAgICAgICAgICBpZiAocGFyYW0udmFsdWUpIHsKCQkgICAgICAgICAgICAgICAgYWRkUGF0dGVybihwYXJhbSwgYmluZGluZ3MpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHJlY3Vyc2l2ZVNjYW5TY29wZShwYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcyk7CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gcmVjdXJzaXZlU2NhblNjb3BlKHBhdGgsIGJpbmRpbmdzLCBzY29wZVR5cGVzKSB7CgkJICAgICAgICB2YXIgbm9kZSA9IHBhdGgudmFsdWU7CgkJICAgICAgICBpZiAocGF0aC5wYXJlbnQgJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLkZ1bmN0aW9uRXhwcmVzc2lvbi5jaGVjayhwYXRoLnBhcmVudC5ub2RlKSAmJgoJCSAgICAgICAgICAgIHBhdGgucGFyZW50Lm5vZGUuaWQpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdGgucGFyZW50LmdldCgiaWQiKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCFub2RlKSA7CgkJICAgICAgICBlbHNlIGlmIChpc0FycmF5LmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgcGF0aC5lYWNoKGZ1bmN0aW9uIChjaGlsZFBhdGgpIHsKCQkgICAgICAgICAgICAgICAgcmVjdXJzaXZlU2NhbkNoaWxkKGNoaWxkUGF0aCwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5GdW5jdGlvbi5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIHBhdGguZ2V0KCJwYXJhbXMiKS5lYWNoKGZ1bmN0aW9uIChwYXJhbVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgYWRkUGF0dGVybihwYXJhbVBhdGgsIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICB9KTsKCQkgICAgICAgICAgICByZWN1cnNpdmVTY2FuQ2hpbGQocGF0aC5nZXQoImJvZHkiKSwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoKG5hbWVkVHlwZXMuVHlwZUFsaWFzICYmIG5hbWVkVHlwZXMuVHlwZUFsaWFzLmNoZWNrKG5vZGUpKSB8fAoJCSAgICAgICAgICAgIChuYW1lZFR5cGVzLkludGVyZmFjZURlY2xhcmF0aW9uICYmIG5hbWVkVHlwZXMuSW50ZXJmYWNlRGVjbGFyYXRpb24uY2hlY2sobm9kZSkpIHx8CgkJICAgICAgICAgICAgKG5hbWVkVHlwZXMuVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiAmJiBuYW1lZFR5cGVzLlRTVHlwZUFsaWFzRGVjbGFyYXRpb24uY2hlY2sobm9kZSkpIHx8CgkJICAgICAgICAgICAgKG5hbWVkVHlwZXMuVFNJbnRlcmZhY2VEZWNsYXJhdGlvbiAmJiBuYW1lZFR5cGVzLlRTSW50ZXJmYWNlRGVjbGFyYXRpb24uY2hlY2sobm9kZSkpKSB7CgkJICAgICAgICAgICAgYWRkVHlwZVBhdHRlcm4ocGF0aC5nZXQoImlkIiksIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5WYXJpYWJsZURlY2xhcmF0b3IuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdGguZ2V0KCJpZCIpLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgcmVjdXJzaXZlU2NhbkNoaWxkKHBhdGguZ2V0KCJpbml0IiksIGJpbmRpbmdzLCBzY29wZVR5cGVzKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gIkltcG9ydFNwZWNpZmllciIgfHwKCQkgICAgICAgICAgICBub2RlLnR5cGUgPT09ICJJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIiIHx8CgkJICAgICAgICAgICAgbm9kZS50eXBlID09PSAiSW1wb3J0RGVmYXVsdFNwZWNpZmllciIpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKAoJCSAgICAgICAgICAgIC8vIEVzcHJpbWEgdXNlZCB0byB1c2UgdGhlIC5uYW1lIGZpZWxkIHRvIHJlZmVyIHRvIHRoZSBsb2NhbAoJCSAgICAgICAgICAgIC8vIGJpbmRpbmcgaWRlbnRpZmllciBmb3IgSW1wb3J0U3BlY2lmaWVyIG5vZGVzLCBidXQgLmlkIGZvcgoJCSAgICAgICAgICAgIC8vIEltcG9ydE5hbWVzcGFjZVNwZWNpZmllciBhbmQgSW1wb3J0RGVmYXVsdFNwZWNpZmllciBub2Rlcy4KCQkgICAgICAgICAgICAvLyBFU1RyZWUvQWNvcm4vRVNwcmVlIHVzZSAubG9jYWwgZm9yIGFsbCB0aHJlZSBub2RlIHR5cGVzLgoJCSAgICAgICAgICAgIHBhdGguZ2V0KG5vZGUubG9jYWwgPyAibG9jYWwiIDoKCQkgICAgICAgICAgICAgICAgbm9kZS5uYW1lID8gIm5hbWUiIDogImlkIiksIGJpbmRpbmdzKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKE5vZGUuY2hlY2sobm9kZSkgJiYgIUV4cHJlc3Npb24uY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICB0eXBlcy5lYWNoRmllbGQobm9kZSwgZnVuY3Rpb24gKG5hbWUsIGNoaWxkKSB7CgkJICAgICAgICAgICAgICAgIHZhciBjaGlsZFBhdGggPSBwYXRoLmdldChuYW1lKTsKCQkgICAgICAgICAgICAgICAgaWYgKCFwYXRoSGFzVmFsdWUoY2hpbGRQYXRoLCBjaGlsZCkpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgcmVjdXJzaXZlU2NhbkNoaWxkKGNoaWxkUGF0aCwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIHBhdGhIYXNWYWx1ZShwYXRoLCB2YWx1ZSkgewoJCSAgICAgICAgaWYgKHBhdGgudmFsdWUgPT09IHZhbHVlKSB7CgkJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICB9CgkJICAgICAgICAvLyBFbXB0eSBhcnJheXMgYXJlIHByb2JhYmx5IHByb2R1Y2VkIGJ5IGRlZmF1bHRzLmVtcHR5QXJyYXksIGluIHdoaWNoCgkJICAgICAgICAvLyBjYXNlIGlzIG1ha2VzIHNlbnNlIHRvIHJlZ2FyZCB0aGVtIGFzIGVxdWl2YWxlbnQsIGlmIG5vdCA9PT0uCgkJICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXRoLnZhbHVlKSAmJgoJCSAgICAgICAgICAgIHBhdGgudmFsdWUubGVuZ3RoID09PSAwICYmCgkJICAgICAgICAgICAgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYKCQkgICAgICAgICAgICB2YWx1ZS5sZW5ndGggPT09IDApIHsKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgfQoJCSAgICBmdW5jdGlvbiByZWN1cnNpdmVTY2FuQ2hpbGQocGF0aCwgYmluZGluZ3MsIHNjb3BlVHlwZXMpIHsKCQkgICAgICAgIHZhciBub2RlID0gcGF0aC52YWx1ZTsKCQkgICAgICAgIGlmICghbm9kZSB8fCBFeHByZXNzaW9uLmNoZWNrKG5vZGUpKSA7CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLkZ1bmN0aW9uRGVjbGFyYXRpb24uY2hlY2sobm9kZSkgJiYKCQkgICAgICAgICAgICBub2RlLmlkICE9PSBudWxsKSB7CgkJICAgICAgICAgICAgYWRkUGF0dGVybihwYXRoLmdldCgiaWQiKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5DbGFzc0RlY2xhcmF0aW9uICYmCgkJICAgICAgICAgICAgbmFtZWRUeXBlcy5DbGFzc0RlY2xhcmF0aW9uLmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgYWRkUGF0dGVybihwYXRoLmdldCgiaWQiKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoU2NvcGVUeXBlLmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgaWYgKG5hbWVkVHlwZXMuQ2F0Y2hDbGF1c2UuY2hlY2sobm9kZSkgJiYKCQkgICAgICAgICAgICAgICAgLy8gVE9ETyBCcm9hZGVuIHRoaXMgdG8gYWNjZXB0IGFueSBwYXR0ZXJuLgoJCSAgICAgICAgICAgICAgICBuYW1lZFR5cGVzLklkZW50aWZpZXIuY2hlY2sobm9kZS5wYXJhbSkpIHsKCQkgICAgICAgICAgICAgICAgdmFyIGNhdGNoUGFyYW1OYW1lID0gbm9kZS5wYXJhbS5uYW1lOwoJCSAgICAgICAgICAgICAgICB2YXIgaGFkQmluZGluZyA9IGhhc093bi5jYWxsKGJpbmRpbmdzLCBjYXRjaFBhcmFtTmFtZSk7CgkJICAgICAgICAgICAgICAgIC8vIEFueSBkZWNsYXJhdGlvbnMgdGhhdCBvY2N1ciBpbnNpZGUgdGhlIGNhdGNoIGJvZHkgdGhhdCBkbwoJCSAgICAgICAgICAgICAgICAvLyBub3QgaGF2ZSB0aGUgc2FtZSBuYW1lIGFzIHRoZSBjYXRjaCBwYXJhbWV0ZXIgc2hvdWxkIGNvdW50CgkJICAgICAgICAgICAgICAgIC8vIGFzIGJpbmRpbmdzIGluIHRoZSBvdXRlciBzY29wZS4KCQkgICAgICAgICAgICAgICAgcmVjdXJzaXZlU2NhblNjb3BlKHBhdGguZ2V0KCJib2R5IiksIGJpbmRpbmdzLCBzY29wZVR5cGVzKTsKCQkgICAgICAgICAgICAgICAgLy8gSWYgYSBuZXcgYmluZGluZyBtYXRjaGluZyB0aGUgY2F0Y2ggcGFyYW1ldGVyIG5hbWUgd2FzCgkJICAgICAgICAgICAgICAgIC8vIGNyZWF0ZWQgd2hpbGUgc2Nhbm5pbmcgdGhlIGNhdGNoIGJvZHksIGlnbm9yZSBpdCBiZWNhdXNlIGl0CgkJICAgICAgICAgICAgICAgIC8vIGFjdHVhbGx5IHJlZmVycyB0byB0aGUgY2F0Y2ggcGFyYW1ldGVyIGFuZCBub3QgdGhlIG91dGVyCgkJICAgICAgICAgICAgICAgIC8vIHNjb3BlIHRoYXQgd2UncmUgY3VycmVudGx5IHNjYW5uaW5nLgoJCSAgICAgICAgICAgICAgICBpZiAoIWhhZEJpbmRpbmcpIHsKCQkgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBiaW5kaW5nc1tjYXRjaFBhcmFtTmFtZV07CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICByZWN1cnNpdmVTY2FuU2NvcGUocGF0aCwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIGFkZFBhdHRlcm4ocGF0dGVyblBhdGgsIGJpbmRpbmdzKSB7CgkJICAgICAgICB2YXIgcGF0dGVybiA9IHBhdHRlcm5QYXRoLnZhbHVlOwoJCSAgICAgICAgbmFtZWRUeXBlcy5QYXR0ZXJuLmFzc2VydChwYXR0ZXJuKTsKCQkgICAgICAgIGlmIChuYW1lZFR5cGVzLklkZW50aWZpZXIuY2hlY2socGF0dGVybikpIHsKCQkgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoYmluZGluZ3MsIHBhdHRlcm4ubmFtZSkpIHsKCQkgICAgICAgICAgICAgICAgYmluZGluZ3NbcGF0dGVybi5uYW1lXS5wdXNoKHBhdHRlcm5QYXRoKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgICAgIGJpbmRpbmdzW3BhdHRlcm4ubmFtZV0gPSBbcGF0dGVyblBhdGhdOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKG5hbWVkVHlwZXMuQXNzaWdubWVudFBhdHRlcm4gJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLkFzc2lnbm1lbnRQYXR0ZXJuLmNoZWNrKHBhdHRlcm4pKSB7CgkJICAgICAgICAgICAgYWRkUGF0dGVybihwYXR0ZXJuUGF0aC5nZXQoJ2xlZnQnKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5PYmplY3RQYXR0ZXJuICYmCgkJICAgICAgICAgICAgbmFtZWRUeXBlcy5PYmplY3RQYXR0ZXJuLmNoZWNrKHBhdHRlcm4pKSB7CgkJICAgICAgICAgICAgcGF0dGVyblBhdGguZ2V0KCdwcm9wZXJ0aWVzJykuZWFjaChmdW5jdGlvbiAocHJvcGVydHlQYXRoKSB7CgkJICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnR5UGF0aC52YWx1ZTsKCQkgICAgICAgICAgICAgICAgaWYgKG5hbWVkVHlwZXMuUGF0dGVybi5jaGVjayhwcm9wZXJ0eSkpIHsKCQkgICAgICAgICAgICAgICAgICAgIGFkZFBhdHRlcm4ocHJvcGVydHlQYXRoLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5Qcm9wZXJ0eS5jaGVjayhwcm9wZXJ0eSkpIHsKCQkgICAgICAgICAgICAgICAgICAgIGFkZFBhdHRlcm4ocHJvcGVydHlQYXRoLmdldCgndmFsdWUnKSwgYmluZGluZ3MpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5hbWVkVHlwZXMuU3ByZWFkUHJvcGVydHkgJiYKCQkgICAgICAgICAgICAgICAgICAgIG5hbWVkVHlwZXMuU3ByZWFkUHJvcGVydHkuY2hlY2socHJvcGVydHkpKSB7CgkJICAgICAgICAgICAgICAgICAgICBhZGRQYXR0ZXJuKHByb3BlcnR5UGF0aC5nZXQoJ2FyZ3VtZW50JyksIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5BcnJheVBhdHRlcm4gJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLkFycmF5UGF0dGVybi5jaGVjayhwYXR0ZXJuKSkgewoJCSAgICAgICAgICAgIHBhdHRlcm5QYXRoLmdldCgnZWxlbWVudHMnKS5lYWNoKGZ1bmN0aW9uIChlbGVtZW50UGF0aCkgewoJCSAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRQYXRoLnZhbHVlOwoJCSAgICAgICAgICAgICAgICBpZiAobmFtZWRUeXBlcy5QYXR0ZXJuLmNoZWNrKGVsZW1lbnQpKSB7CgkJICAgICAgICAgICAgICAgICAgICBhZGRQYXR0ZXJuKGVsZW1lbnRQYXRoLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5TcHJlYWRFbGVtZW50ICYmCgkJICAgICAgICAgICAgICAgICAgICBuYW1lZFR5cGVzLlNwcmVhZEVsZW1lbnQuY2hlY2soZWxlbWVudCkpIHsKCQkgICAgICAgICAgICAgICAgICAgIGFkZFBhdHRlcm4oZWxlbWVudFBhdGguZ2V0KCJhcmd1bWVudCIpLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB9KTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKG5hbWVkVHlwZXMuUHJvcGVydHlQYXR0ZXJuICYmCgkJICAgICAgICAgICAgbmFtZWRUeXBlcy5Qcm9wZXJ0eVBhdHRlcm4uY2hlY2socGF0dGVybikpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdHRlcm5QYXRoLmdldCgncGF0dGVybicpLCBiaW5kaW5ncyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmICgobmFtZWRUeXBlcy5TcHJlYWRFbGVtZW50UGF0dGVybiAmJgoJCSAgICAgICAgICAgIG5hbWVkVHlwZXMuU3ByZWFkRWxlbWVudFBhdHRlcm4uY2hlY2socGF0dGVybikpIHx8CgkJICAgICAgICAgICAgKG5hbWVkVHlwZXMuUmVzdEVsZW1lbnQgJiYKCQkgICAgICAgICAgICAgICAgbmFtZWRUeXBlcy5SZXN0RWxlbWVudC5jaGVjayhwYXR0ZXJuKSkgfHwKCQkgICAgICAgICAgICAobmFtZWRUeXBlcy5TcHJlYWRQcm9wZXJ0eVBhdHRlcm4gJiYKCQkgICAgICAgICAgICAgICAgbmFtZWRUeXBlcy5TcHJlYWRQcm9wZXJ0eVBhdHRlcm4uY2hlY2socGF0dGVybikpKSB7CgkJICAgICAgICAgICAgYWRkUGF0dGVybihwYXR0ZXJuUGF0aC5nZXQoJ2FyZ3VtZW50JyksIGJpbmRpbmdzKTsKCQkgICAgICAgIH0KCQkgICAgfQoJCSAgICBmdW5jdGlvbiBhZGRUeXBlUGF0dGVybihwYXR0ZXJuUGF0aCwgdHlwZXMpIHsKCQkgICAgICAgIHZhciBwYXR0ZXJuID0gcGF0dGVyblBhdGgudmFsdWU7CgkJICAgICAgICBuYW1lZFR5cGVzLlBhdHRlcm4uYXNzZXJ0KHBhdHRlcm4pOwoJCSAgICAgICAgaWYgKG5hbWVkVHlwZXMuSWRlbnRpZmllci5jaGVjayhwYXR0ZXJuKSkgewoJCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbCh0eXBlcywgcGF0dGVybi5uYW1lKSkgewoJCSAgICAgICAgICAgICAgICB0eXBlc1twYXR0ZXJuLm5hbWVdLnB1c2gocGF0dGVyblBhdGgpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICAgICAgdHlwZXNbcGF0dGVybi5uYW1lXSA9IFtwYXR0ZXJuUGF0aF07CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIFNwLmxvb2t1cCA9IGZ1bmN0aW9uIChuYW1lKSB7CgkJICAgICAgICBmb3IgKHZhciBzY29wZSA9IHRoaXM7IHNjb3BlOyBzY29wZSA9IHNjb3BlLnBhcmVudCkKCQkgICAgICAgICAgICBpZiAoc2NvcGUuZGVjbGFyZXMobmFtZSkpCgkJICAgICAgICAgICAgICAgIGJyZWFrOwoJCSAgICAgICAgcmV0dXJuIHNjb3BlOwoJCSAgICB9OwoJCSAgICBTcC5sb29rdXBUeXBlID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkgICAgICAgIGZvciAodmFyIHNjb3BlID0gdGhpczsgc2NvcGU7IHNjb3BlID0gc2NvcGUucGFyZW50KQoJCSAgICAgICAgICAgIGlmIChzY29wZS5kZWNsYXJlc1R5cGUobmFtZSkpCgkJICAgICAgICAgICAgICAgIGJyZWFrOwoJCSAgICAgICAgcmV0dXJuIHNjb3BlOwoJCSAgICB9OwoJCSAgICBTcC5nZXRHbG9iYWxTY29wZSA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CgkJICAgICAgICB3aGlsZSAoIXNjb3BlLmlzR2xvYmFsKQoJCSAgICAgICAgICAgIHNjb3BlID0gc2NvcGUucGFyZW50OwoJCSAgICAgICAgcmV0dXJuIHNjb3BlOwoJCSAgICB9OwoJCSAgICByZXR1cm4gU2NvcGU7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IHNjb3BlUGx1Z2luOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKHNjb3BlJDEsIHNjb3BlJDEuZXhwb3J0cykpOwoJcmV0dXJuIHNjb3BlJDEuZXhwb3J0czsKfQoKdmFyIGhhc1JlcXVpcmVkTm9kZVBhdGg7CgpmdW5jdGlvbiByZXF1aXJlTm9kZVBhdGggKCkgewoJaWYgKGhhc1JlcXVpcmVkTm9kZVBhdGgpIHJldHVybiBub2RlUGF0aC5leHBvcnRzOwoJaGFzUmVxdWlyZWROb2RlUGF0aCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBwYXRoXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlUGF0aCgpKTsKCQl2YXIgc2NvcGVfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTY29wZSgpKTsKCQlmdW5jdGlvbiBub2RlUGF0aFBsdWdpbihmb3JrKSB7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBuID0gdHlwZXMubmFtZWRUeXBlczsKCQkgICAgdmFyIGIgPSB0eXBlcy5idWlsZGVyczsKCQkgICAgdmFyIGlzTnVtYmVyID0gdHlwZXMuYnVpbHRJblR5cGVzLm51bWJlcjsKCQkgICAgdmFyIGlzQXJyYXkgPSB0eXBlcy5idWlsdEluVHlwZXMuYXJyYXk7CgkJICAgIHZhciBQYXRoID0gZm9yay51c2UocGF0aF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgU2NvcGUgPSBmb3JrLnVzZShzY29wZV8xLmRlZmF1bHQpOwoJCSAgICB2YXIgTm9kZVBhdGggPSBmdW5jdGlvbiBOb2RlUGF0aCh2YWx1ZSwgcGFyZW50UGF0aCwgbmFtZSkgewoJCSAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZVBhdGggY29uc3RydWN0b3IgY2Fubm90IGJlIGludm9rZWQgd2l0aG91dCAnbmV3JyIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgUGF0aC5jYWxsKHRoaXMsIHZhbHVlLCBwYXJlbnRQYXRoLCBuYW1lKTsKCQkgICAgfTsKCQkgICAgdmFyIE5QcCA9IE5vZGVQYXRoLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGF0aC5wcm90b3R5cGUsIHsKCQkgICAgICAgIGNvbnN0cnVjdG9yOiB7CgkJICAgICAgICAgICAgdmFsdWU6IE5vZGVQYXRoLAoJCSAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAoJCSAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAoJCSAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQoJCSAgICAgICAgfQoJCSAgICB9KTsKCQkgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTlBwLCB7CgkJICAgICAgICBub2RlOiB7CgkJICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CgkJICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibm9kZSIsIHsKCQkgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jb21wdXRlTm9kZSgpCgkJICAgICAgICAgICAgICAgIH0pOwoJCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ub2RlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0sCgkJICAgICAgICBwYXJlbnQ6IHsKCQkgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJwYXJlbnQiLCB7CgkJICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCgkJICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY29tcHV0ZVBhcmVudCgpCgkJICAgICAgICAgICAgICAgIH0pOwoJCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQ7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfSwKCQkgICAgICAgIHNjb3BlOiB7CgkJICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CgkJICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2NvcGUiLCB7CgkJICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCgkJICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY29tcHV0ZVNjb3BlKCkKCQkgICAgICAgICAgICAgICAgfSk7CgkJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjb3BlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgfSk7CgkJICAgIE5QcC5yZXBsYWNlID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgZGVsZXRlIHRoaXMubm9kZTsKCQkgICAgICAgIGRlbGV0ZSB0aGlzLnBhcmVudDsKCQkgICAgICAgIGRlbGV0ZSB0aGlzLnNjb3BlOwoJCSAgICAgICAgcmV0dXJuIFBhdGgucHJvdG90eXBlLnJlcGxhY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkgICAgfTsKCQkgICAgTlBwLnBydW5lID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHJlbWFpbmluZ05vZGVQYXRoID0gdGhpcy5wYXJlbnQ7CgkJICAgICAgICB0aGlzLnJlcGxhY2UoKTsKCQkgICAgICAgIHJldHVybiBjbGVhblVwTm9kZXNBZnRlclBydW5lKHJlbWFpbmluZ05vZGVQYXRoKTsKCQkgICAgfTsKCQkgICAgLy8gVGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBhbmNlc3RvciBQYXRoIHdob3NlIHZhbHVlIGlzIGEgTm9kZS4KCQkgICAgTlBwLl9jb21wdXRlTm9kZSA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7CgkJICAgICAgICBpZiAobi5Ob2RlLmNoZWNrKHZhbHVlKSkgewoJCSAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIHJldHVybiBwcCAmJiBwcC5ub2RlIHx8IG51bGw7CgkJICAgIH07CgkJICAgIC8vIFRoZSBmaXJzdCBhbmNlc3RvciBQYXRoIHdob3NlIHZhbHVlIGlzIGEgTm9kZSBkaXN0aW5jdCBmcm9tIHRoaXMubm9kZS4KCQkgICAgTlBwLl9jb21wdXRlUGFyZW50ID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52YWx1ZTsKCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIGlmICghbi5Ob2RlLmNoZWNrKHZhbHVlKSkgewoJCSAgICAgICAgICAgIHdoaWxlIChwcCAmJiAhbi5Ob2RlLmNoZWNrKHBwLnZhbHVlKSkgewoJCSAgICAgICAgICAgICAgICBwcCA9IHBwLnBhcmVudFBhdGg7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChwcCkgewoJCSAgICAgICAgICAgICAgICBwcCA9IHBwLnBhcmVudFBhdGg7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgd2hpbGUgKHBwICYmICFuLk5vZGUuY2hlY2socHAudmFsdWUpKSB7CgkJICAgICAgICAgICAgcHAgPSBwcC5wYXJlbnRQYXRoOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBwIHx8IG51bGw7CgkJICAgIH07CgkJICAgIC8vIFRoZSBjbG9zZXN0IGVuY2xvc2luZyBzY29wZSB0aGF0IGdvdmVybnMgdGhpcyBub2RlLgoJCSAgICBOUHAuX2NvbXB1dGVTY29wZSA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7CgkJICAgICAgICB2YXIgcHAgPSB0aGlzLnBhcmVudFBhdGg7CgkJICAgICAgICB2YXIgc2NvcGUgPSBwcCAmJiBwcC5zY29wZTsKCQkgICAgICAgIGlmIChuLk5vZGUuY2hlY2sodmFsdWUpICYmCgkJICAgICAgICAgICAgU2NvcGUuaXNFc3RhYmxpc2hlZEJ5KHZhbHVlKSkgewoJCSAgICAgICAgICAgIHNjb3BlID0gbmV3IFNjb3BlKHRoaXMsIHNjb3BlKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBzY29wZSB8fCBudWxsOwoJCSAgICB9OwoJCSAgICBOUHAuZ2V0VmFsdWVQcm9wZXJ0eSA9IGZ1bmN0aW9uIChuYW1lKSB7CgkJICAgICAgICByZXR1cm4gdHlwZXMuZ2V0RmllbGRWYWx1ZSh0aGlzLnZhbHVlLCBuYW1lKTsKCQkgICAgfTsKCQkgICAgLyoqCgkJICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoaXMubm9kZSBuZWVkcyB0byBiZSB3cmFwcGVkIGluIHBhcmVudGhlc2VzIGluIG9yZGVyCgkJICAgICAqIGZvciBhIHBhcnNlciB0byByZXByb2R1Y2UgdGhlIHNhbWUgbG9jYWwgQVNUIHN0cnVjdHVyZS4KCQkgICAgICoKCQkgICAgICogRm9yIGluc3RhbmNlLCBpbiB0aGUgZXhwcmVzc2lvbiBgKDEgKyAyKSAqIDNgLCB0aGUgQmluYXJ5RXhwcmVzc2lvbgoJCSAgICAgKiB3aG9zZSBvcGVyYXRvciBpcyAiKyIgbmVlZHMgcGFyZW50aGVzZXMsIGJlY2F1c2UgYDEgKyAyICogM2Agd291bGQKCQkgICAgICogcGFyc2UgZGlmZmVyZW50bHkuCgkJICAgICAqCgkJICAgICAqIElmIGFzc3VtZUV4cHJlc3Npb25Db250ZXh0ID09PSB0cnVlLCB3ZSBkb24ndCB3b3JyeSBhYm91dCBlZGdlIGNhc2VzCgkJICAgICAqIGxpa2UgYW4gYW5vbnltb3VzIEZ1bmN0aW9uRXhwcmVzc2lvbiBhcHBlYXJpbmcgbGV4aWNhbGx5IGZpcnN0IGluIGl0cwoJCSAgICAgKiBlbmNsb3Npbmcgc3RhdGVtZW50IGFuZCB0aHVzIG5lZWRpbmcgcGFyZW50aGVzZXMgdG8gYXZvaWQgYmVpbmcgcGFyc2VkCgkJICAgICAqIGFzIGEgRnVuY3Rpb25EZWNsYXJhdGlvbiB3aXRoIGEgbWlzc2luZyBuYW1lLgoJCSAgICAgKi8KCQkgICAgTlBwLm5lZWRzUGFyZW5zID0gZnVuY3Rpb24gKGFzc3VtZUV4cHJlc3Npb25Db250ZXh0KSB7CgkJICAgICAgICB2YXIgcHAgPSB0aGlzLnBhcmVudFBhdGg7CgkJICAgICAgICBpZiAoIXBwKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIG5vZGUgPSB0aGlzLnZhbHVlOwoJCSAgICAgICAgLy8gT25seSBleHByZXNzaW9ucyBuZWVkIHBhcmVudGhlc2VzLgoJCSAgICAgICAgaWYgKCFuLkV4cHJlc3Npb24uY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICAvLyBJZGVudGlmaWVycyBuZXZlciBuZWVkIHBhcmVudGhlc2VzLgoJCSAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gIklkZW50aWZpZXIiKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgd2hpbGUgKCFuLk5vZGUuY2hlY2socHAudmFsdWUpKSB7CgkJICAgICAgICAgICAgcHAgPSBwcC5wYXJlbnRQYXRoOwoJCSAgICAgICAgICAgIGlmICghcHApIHsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwYXJlbnQgPSBwcC52YWx1ZTsKCQkgICAgICAgIHN3aXRjaCAobm9kZS50eXBlKSB7CgkJICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50IjoKCQkgICAgICAgICAgICBjYXNlICJTcHJlYWRQcm9wZXJ0eSI6CgkJICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iCgkJICAgICAgICAgICAgICAgICAgICAmJiB0aGlzLm5hbWUgPT09ICJvYmplY3QiCgkJICAgICAgICAgICAgICAgICAgICAmJiBwYXJlbnQub2JqZWN0ID09PSBub2RlOwoJCSAgICAgICAgICAgIGNhc2UgIkJpbmFyeUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgIGNhc2UgIkxvZ2ljYWxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgc3dpdGNoIChwYXJlbnQudHlwZSkgewoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUgPT09ICJjYWxsZWUiCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHBhcmVudC5jYWxsZWUgPT09IG5vZGU7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkRWxlbWVudCI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRQcm9wZXJ0eSI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSAib2JqZWN0IgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBwYXJlbnQub2JqZWN0ID09PSBub2RlOwoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6IHsKCQkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbl8xID0gbm9kZTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG8gPSBwYXJlbnQub3BlcmF0b3I7CgkJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBwXzEgPSBQUkVDRURFTkNFW3BvXTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm8gPSBuXzEub3BlcmF0b3I7CgkJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5wID0gUFJFQ0VERU5DRVtub107CgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBwXzEgPiBucCkgewoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBwXzEgPT09IG5wICYmIHRoaXMubmFtZSA9PT0gInJpZ2h0IikgewoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ICE9PSBuXzEpIHsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgY2FzZSAiU2VxdWVuY2VFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgc3dpdGNoIChwYXJlbnQudHlwZSkgewoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKCQkgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbHRob3VnaCBwYXJlbnRoZXNlcyB3b3VsZG4ndCBodXJ0IGFyb3VuZCBzZXF1ZW5jZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4cHJlc3Npb25zIGluIHRoZSBoZWFkIG9mIGZvciBsb29wcywgdHJhZGl0aW9uYWwgc3R5bGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAvLyBkaWN0YXRlcyB0aGF0IGUuZy4gaSsrLCBqKysgc2hvdWxkIG5vdCBiZSB3cmFwcGVkIHdpdGgKCQkgICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXJlbnRoZXNlcy4KCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uU3RhdGVtZW50IjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lICE9PSAiZXhwcmVzc2lvbiI7CgkJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBlcnIgb24gdGhlIHNpZGUgb2Ygb3ZlcnBhcmVudGhlc2l6YXRpb24sIGFkZGluZwoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4cGxpY2l0IGV4Y2VwdGlvbnMgYWJvdmUgaWYgdGhpcyBwcm92ZXMgb3ZlcnplYWxvdXMuCgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBjYXNlICJZaWVsZEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJCaW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkxvZ2ljYWxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50IjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZFByb3BlcnR5IjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiTmV3RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJDb25kaXRpb25hbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiWWllbGRFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgY2FzZSAiTGl0ZXJhbCI6CgkJICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iCgkJICAgICAgICAgICAgICAgICAgICAmJiBpc051bWJlci5jaGVjayhub2RlLnZhbHVlKQoJCSAgICAgICAgICAgICAgICAgICAgJiYgdGhpcy5uYW1lID09PSAib2JqZWN0IgoJCSAgICAgICAgICAgICAgICAgICAgJiYgcGFyZW50Lm9iamVjdCA9PT0gbm9kZTsKCQkgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgc3dpdGNoIChwYXJlbnQudHlwZSkgewoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkUHJvcGVydHkiOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gImNhbGxlZSIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcGFyZW50LmNhbGxlZSA9PT0gbm9kZTsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gInRlc3QiCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHBhcmVudC50ZXN0ID09PSBub2RlOwoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gIm9iamVjdCIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcGFyZW50Lm9iamVjdCA9PT0gbm9kZTsKCQkgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZGVmYXVsdDoKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC50eXBlID09PSAiTmV3RXhwcmVzc2lvbiIgJiYKCQkgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9PT0gImNhbGxlZSIgJiYKCQkgICAgICAgICAgICAgICAgICAgIHBhcmVudC5jYWxsZWUgPT09IG5vZGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluc0NhbGxFeHByZXNzaW9uKG5vZGUpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoYXNzdW1lRXhwcmVzc2lvbkNvbnRleHQgIT09IHRydWUgJiYKCQkgICAgICAgICAgICAhdGhpcy5jYW5CZUZpcnN0SW5TdGF0ZW1lbnQoKSAmJgoJCSAgICAgICAgICAgIHRoaXMuZmlyc3RJblN0YXRlbWVudCgpKQoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiBpc0JpbmFyeShub2RlKSB7CgkJICAgICAgICByZXR1cm4gbi5CaW5hcnlFeHByZXNzaW9uLmNoZWNrKG5vZGUpCgkJICAgICAgICAgICAgfHwgbi5Mb2dpY2FsRXhwcmVzc2lvbi5jaGVjayhub2RlKTsKCQkgICAgfQoJCSAgICB2YXIgUFJFQ0VERU5DRSA9IHt9OwoJCSAgICBbWyJ8fCJdLAoJCSAgICAgICAgWyImJiJdLAoJCSAgICAgICAgWyJ8Il0sCgkJICAgICAgICBbIl4iXSwKCQkgICAgICAgIFsiJiJdLAoJCSAgICAgICAgWyI9PSIsICI9PT0iLCAiIT0iLCAiIT09Il0sCgkJICAgICAgICBbIjwiLCAiPiIsICI8PSIsICI+PSIsICJpbiIsICJpbnN0YW5jZW9mIl0sCgkJICAgICAgICBbIj4+IiwgIjw8IiwgIj4+PiJdLAoJCSAgICAgICAgWyIrIiwgIi0iXSwKCQkgICAgICAgIFsiKiIsICIvIiwgIiUiXQoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKHRpZXIsIGkpIHsKCQkgICAgICAgIHRpZXIuZm9yRWFjaChmdW5jdGlvbiAob3ApIHsKCQkgICAgICAgICAgICBQUkVDRURFTkNFW29wXSA9IGk7CgkJICAgICAgICB9KTsKCQkgICAgfSk7CgkJICAgIGZ1bmN0aW9uIGNvbnRhaW5zQ2FsbEV4cHJlc3Npb24obm9kZSkgewoJCSAgICAgICAgaWYgKG4uQ2FsbEV4cHJlc3Npb24uY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChpc0FycmF5LmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIG5vZGUuc29tZShjb250YWluc0NhbGxFeHByZXNzaW9uKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChuLk5vZGUuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gdHlwZXMuc29tZUZpZWxkKG5vZGUsIGZ1bmN0aW9uIChfbmFtZSwgY2hpbGQpIHsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zQ2FsbEV4cHJlc3Npb24oY2hpbGQpOwoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9CgkJICAgIE5QcC5jYW5CZUZpcnN0SW5TdGF0ZW1lbnQgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB2YXIgbm9kZSA9IHRoaXMubm9kZTsKCQkgICAgICAgIHJldHVybiAhbi5GdW5jdGlvbkV4cHJlc3Npb24uY2hlY2sobm9kZSkKCQkgICAgICAgICAgICAmJiAhbi5PYmplY3RFeHByZXNzaW9uLmNoZWNrKG5vZGUpOwoJCSAgICB9OwoJCSAgICBOUHAuZmlyc3RJblN0YXRlbWVudCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiBmaXJzdEluU3RhdGVtZW50KHRoaXMpOwoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiBmaXJzdEluU3RhdGVtZW50KHBhdGgpIHsKCQkgICAgICAgIGZvciAodmFyIG5vZGUsIHBhcmVudDsgcGF0aC5wYXJlbnQ7IHBhdGggPSBwYXRoLnBhcmVudCkgewoJCSAgICAgICAgICAgIG5vZGUgPSBwYXRoLm5vZGU7CgkJICAgICAgICAgICAgcGFyZW50ID0gcGF0aC5wYXJlbnQubm9kZTsKCQkgICAgICAgICAgICBpZiAobi5CbG9ja1N0YXRlbWVudC5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgucGFyZW50Lm5hbWUgPT09ICJib2R5IiAmJgoJCSAgICAgICAgICAgICAgICBwYXRoLm5hbWUgPT09IDApIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5ib2R5WzBdICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKG4uRXhwcmVzc2lvblN0YXRlbWVudC5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gImV4cHJlc3Npb24iKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuZXhwcmVzc2lvbiAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChuLlNlcXVlbmNlRXhwcmVzc2lvbi5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgucGFyZW50Lm5hbWUgPT09ICJleHByZXNzaW9ucyIgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAwKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuZXhwcmVzc2lvbnNbMF0gIT09IG5vZGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAobi5DYWxsRXhwcmVzc2lvbi5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gImNhbGxlZSIpIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5jYWxsZWUgIT09IG5vZGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAobi5NZW1iZXJFeHByZXNzaW9uLmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAib2JqZWN0IikgewoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50Lm9iamVjdCAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY29udGludWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChuLkNvbmRpdGlvbmFsRXhwcmVzc2lvbi5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gInRlc3QiKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQudGVzdCAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY29udGludWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChpc0JpbmFyeShwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gImxlZnQiKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubGVmdCAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY29udGludWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChuLlVuYXJ5RXhwcmVzc2lvbi5jaGVjayhwYXJlbnQpICYmCgkJICAgICAgICAgICAgICAgICFwYXJlbnQucHJlZml4ICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gImFyZ3VtZW50IikgewoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50LmFyZ3VtZW50ICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgIH0KCQkgICAgLyoqCgkJICAgICAqIFBydW5pbmcgY2VydGFpbiBub2RlcyB3aWxsIHJlc3VsdCBpbiBlbXB0eSBvciBpbmNvbXBsZXRlIG5vZGVzLCBoZXJlIHdlIGNsZWFuIHRob3NlIG5vZGVzIHVwLgoJCSAgICAgKi8KCQkgICAgZnVuY3Rpb24gY2xlYW5VcE5vZGVzQWZ0ZXJQcnVuZShyZW1haW5pbmdOb2RlUGF0aCkgewoJCSAgICAgICAgaWYgKG4uVmFyaWFibGVEZWNsYXJhdGlvbi5jaGVjayhyZW1haW5pbmdOb2RlUGF0aC5ub2RlKSkgewoJCSAgICAgICAgICAgIHZhciBkZWNsYXJhdGlvbnMgPSByZW1haW5pbmdOb2RlUGF0aC5nZXQoJ2RlY2xhcmF0aW9ucycpLnZhbHVlOwoJCSAgICAgICAgICAgIGlmICghZGVjbGFyYXRpb25zIHx8IGRlY2xhcmF0aW9ucy5sZW5ndGggPT09IDApIHsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIHJlbWFpbmluZ05vZGVQYXRoLnBydW5lKCk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobi5FeHByZXNzaW9uU3RhdGVtZW50LmNoZWNrKHJlbWFpbmluZ05vZGVQYXRoLm5vZGUpKSB7CgkJICAgICAgICAgICAgaWYgKCFyZW1haW5pbmdOb2RlUGF0aC5nZXQoJ2V4cHJlc3Npb24nKS52YWx1ZSkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gcmVtYWluaW5nTm9kZVBhdGgucHJ1bmUoKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuLklmU3RhdGVtZW50LmNoZWNrKHJlbWFpbmluZ05vZGVQYXRoLm5vZGUpKSB7CgkJICAgICAgICAgICAgY2xlYW5VcElmU3RhdGVtZW50QWZ0ZXJQcnVuZShyZW1haW5pbmdOb2RlUGF0aCk7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gcmVtYWluaW5nTm9kZVBhdGg7CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gY2xlYW5VcElmU3RhdGVtZW50QWZ0ZXJQcnVuZShpZlN0YXRlbWVudCkgewoJCSAgICAgICAgdmFyIHRlc3RFeHByZXNzaW9uID0gaWZTdGF0ZW1lbnQuZ2V0KCd0ZXN0JykudmFsdWU7CgkJICAgICAgICB2YXIgYWx0ZXJuYXRlID0gaWZTdGF0ZW1lbnQuZ2V0KCdhbHRlcm5hdGUnKS52YWx1ZTsKCQkgICAgICAgIHZhciBjb25zZXF1ZW50ID0gaWZTdGF0ZW1lbnQuZ2V0KCdjb25zZXF1ZW50JykudmFsdWU7CgkJICAgICAgICBpZiAoIWNvbnNlcXVlbnQgJiYgIWFsdGVybmF0ZSkgewoJCSAgICAgICAgICAgIHZhciB0ZXN0RXhwcmVzc2lvblN0YXRlbWVudCA9IGIuZXhwcmVzc2lvblN0YXRlbWVudCh0ZXN0RXhwcmVzc2lvbik7CgkJICAgICAgICAgICAgaWZTdGF0ZW1lbnQucmVwbGFjZSh0ZXN0RXhwcmVzc2lvblN0YXRlbWVudCk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmICghY29uc2VxdWVudCAmJiBhbHRlcm5hdGUpIHsKCQkgICAgICAgICAgICB2YXIgbmVnYXRlZFRlc3RFeHByZXNzaW9uID0gYi51bmFyeUV4cHJlc3Npb24oJyEnLCB0ZXN0RXhwcmVzc2lvbiwgdHJ1ZSk7CgkJICAgICAgICAgICAgaWYgKG4uVW5hcnlFeHByZXNzaW9uLmNoZWNrKHRlc3RFeHByZXNzaW9uKSAmJiB0ZXN0RXhwcmVzc2lvbi5vcGVyYXRvciA9PT0gJyEnKSB7CgkJICAgICAgICAgICAgICAgIG5lZ2F0ZWRUZXN0RXhwcmVzc2lvbiA9IHRlc3RFeHByZXNzaW9uLmFyZ3VtZW50OwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZlN0YXRlbWVudC5nZXQoInRlc3QiKS5yZXBsYWNlKG5lZ2F0ZWRUZXN0RXhwcmVzc2lvbik7CgkJICAgICAgICAgICAgaWZTdGF0ZW1lbnQuZ2V0KCJjb25zZXF1ZW50IikucmVwbGFjZShhbHRlcm5hdGUpOwoJCSAgICAgICAgICAgIGlmU3RhdGVtZW50LmdldCgiYWx0ZXJuYXRlIikucmVwbGFjZSgpOwoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIHJldHVybiBOb2RlUGF0aDsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gbm9kZVBhdGhQbHVnaW47CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAobm9kZVBhdGgsIG5vZGVQYXRoLmV4cG9ydHMpKTsKCXJldHVybiBub2RlUGF0aC5leHBvcnRzOwp9Cgp2YXIgaGFzUmVxdWlyZWRQYXRoVmlzaXRvcjsKCmZ1bmN0aW9uIHJlcXVpcmVQYXRoVmlzaXRvciAoKSB7CglpZiAoaGFzUmVxdWlyZWRQYXRoVmlzaXRvcikgcmV0dXJuIHBhdGhWaXNpdG9yLmV4cG9ydHM7CgloYXNSZXF1aXJlZFBhdGhWaXNpdG9yID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIG5vZGVfcGF0aF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZU5vZGVQYXRoKCkpOwoJCXZhciBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwoJCWZ1bmN0aW9uIHBhdGhWaXNpdG9yUGx1Z2luKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIE5vZGVQYXRoID0gZm9yay51c2Uobm9kZV9wYXRoXzEuZGVmYXVsdCk7CgkJICAgIHZhciBpc0FycmF5ID0gdHlwZXMuYnVpbHRJblR5cGVzLmFycmF5OwoJCSAgICB2YXIgaXNPYmplY3QgPSB0eXBlcy5idWlsdEluVHlwZXMub2JqZWN0OwoJCSAgICB2YXIgaXNGdW5jdGlvbiA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5mdW5jdGlvbjsKCQkgICAgdmFyIHVuZGVmaW5lZCQxOwoJCSAgICB2YXIgUGF0aFZpc2l0b3IgPSBmdW5jdGlvbiBQYXRoVmlzaXRvcigpIHsKCQkgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBQYXRoVmlzaXRvcikpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhdGhWaXNpdG9yIGNvbnN0cnVjdG9yIGNhbm5vdCBiZSBpbnZva2VkIHdpdGhvdXQgJ25ldyciKTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIFBlcm1hbmVudCBzdGF0ZS4KCQkgICAgICAgIHRoaXMuX3JldXNhYmxlQ29udGV4dFN0YWNrID0gW107CgkJICAgICAgICB0aGlzLl9tZXRob2ROYW1lVGFibGUgPSBjb21wdXRlTWV0aG9kTmFtZVRhYmxlKHRoaXMpOwoJCSAgICAgICAgdGhpcy5fc2hvdWxkVmlzaXRDb21tZW50cyA9CgkJICAgICAgICAgICAgaGFzT3duLmNhbGwodGhpcy5fbWV0aG9kTmFtZVRhYmxlLCAiQmxvY2siKSB8fAoJCSAgICAgICAgICAgICAgICBoYXNPd24uY2FsbCh0aGlzLl9tZXRob2ROYW1lVGFibGUsICJMaW5lIik7CgkJICAgICAgICB0aGlzLkNvbnRleHQgPSBtYWtlQ29udGV4dENvbnN0cnVjdG9yKHRoaXMpOwoJCSAgICAgICAgLy8gU3RhdGUgcmVzZXQgZXZlcnkgdGltZSBQYXRoVmlzaXRvci5wcm90b3R5cGUudmlzaXQgaXMgY2FsbGVkLgoJCSAgICAgICAgdGhpcy5fdmlzaXRpbmcgPSBmYWxzZTsKCQkgICAgICAgIHRoaXMuX2NoYW5nZVJlcG9ydGVkID0gZmFsc2U7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIGNvbXB1dGVNZXRob2ROYW1lVGFibGUodmlzaXRvcikgewoJCSAgICAgICAgdmFyIHR5cGVOYW1lcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICAgICAgICBmb3IgKHZhciBtZXRob2ROYW1lIGluIHZpc2l0b3IpIHsKCQkgICAgICAgICAgICBpZiAoL152aXNpdFtBLVpdLy50ZXN0KG1ldGhvZE5hbWUpKSB7CgkJICAgICAgICAgICAgICAgIHR5cGVOYW1lc1ttZXRob2ROYW1lLnNsaWNlKCJ2aXNpdCIubGVuZ3RoKV0gPSB0cnVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBzdXBlcnR5cGVUYWJsZSA9IHR5cGVzLmNvbXB1dGVTdXBlcnR5cGVMb29rdXBUYWJsZSh0eXBlTmFtZXMpOwoJCSAgICAgICAgdmFyIG1ldGhvZE5hbWVUYWJsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICAgICAgICB2YXIgdHlwZU5hbWVLZXlzID0gT2JqZWN0LmtleXMoc3VwZXJ0eXBlVGFibGUpOwoJCSAgICAgICAgdmFyIHR5cGVOYW1lQ291bnQgPSB0eXBlTmFtZUtleXMubGVuZ3RoOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlTmFtZUNvdW50OyArK2kpIHsKCQkgICAgICAgICAgICB2YXIgdHlwZU5hbWUgPSB0eXBlTmFtZUtleXNbaV07CgkJICAgICAgICAgICAgbWV0aG9kTmFtZSA9ICJ2aXNpdCIgKyBzdXBlcnR5cGVUYWJsZVt0eXBlTmFtZV07CgkJICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24uY2hlY2sodmlzaXRvclttZXRob2ROYW1lXSkpIHsKCQkgICAgICAgICAgICAgICAgbWV0aG9kTmFtZVRhYmxlW3R5cGVOYW1lXSA9IG1ldGhvZE5hbWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIG1ldGhvZE5hbWVUYWJsZTsKCQkgICAgfQoJCSAgICBQYXRoVmlzaXRvci5mcm9tTWV0aG9kc09iamVjdCA9IGZ1bmN0aW9uIGZyb21NZXRob2RzT2JqZWN0KG1ldGhvZHMpIHsKCQkgICAgICAgIGlmIChtZXRob2RzIGluc3RhbmNlb2YgUGF0aFZpc2l0b3IpIHsKCQkgICAgICAgICAgICByZXR1cm4gbWV0aG9kczsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmICghaXNPYmplY3QuY2hlY2sobWV0aG9kcykpIHsKCQkgICAgICAgICAgICAvLyBBbiBlbXB0eSB2aXNpdG9yPwoJCSAgICAgICAgICAgIHJldHVybiBuZXcgUGF0aFZpc2l0b3I7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgVmlzaXRvciA9IGZ1bmN0aW9uIFZpc2l0b3IoKSB7CgkJICAgICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFZpc2l0b3IpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVmlzaXRvciBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgaW52b2tlZCB3aXRob3V0ICduZXcnIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIFBhdGhWaXNpdG9yLmNhbGwodGhpcyk7CgkJICAgICAgICB9OwoJCSAgICAgICAgdmFyIFZwID0gVmlzaXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBWcCk7CgkJICAgICAgICBWcC5jb25zdHJ1Y3RvciA9IFZpc2l0b3I7CgkJICAgICAgICBleHRlbmQoVnAsIG1ldGhvZHMpOwoJCSAgICAgICAgZXh0ZW5kKFZpc2l0b3IsIFBhdGhWaXNpdG9yKTsKCQkgICAgICAgIGlzRnVuY3Rpb24uYXNzZXJ0KFZpc2l0b3IuZnJvbU1ldGhvZHNPYmplY3QpOwoJCSAgICAgICAgaXNGdW5jdGlvbi5hc3NlcnQoVmlzaXRvci52aXNpdCk7CgkJICAgICAgICByZXR1cm4gbmV3IFZpc2l0b3I7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIGV4dGVuZCh0YXJnZXQsIHNvdXJjZSkgewoJCSAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc291cmNlKSB7CgkJICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKHNvdXJjZSwgcHJvcGVydHkpKSB7CgkJICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiB0YXJnZXQ7CgkJICAgIH0KCQkgICAgUGF0aFZpc2l0b3IudmlzaXQgPSBmdW5jdGlvbiB2aXNpdChub2RlLCBtZXRob2RzKSB7CgkJICAgICAgICByZXR1cm4gUGF0aFZpc2l0b3IuZnJvbU1ldGhvZHNPYmplY3QobWV0aG9kcykudmlzaXQobm9kZSk7CgkJICAgIH07CgkJICAgIHZhciBQVnAgPSBQYXRoVmlzaXRvci5wcm90b3R5cGU7CgkJICAgIFBWcC52aXNpdCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIGlmICh0aGlzLl92aXNpdGluZykgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUmVjdXJzaXZlbHkgY2FsbGluZyB2aXNpdG9yLnZpc2l0KHBhdGgpIHJlc2V0cyB2aXNpdG9yIHN0YXRlLiAiICsKCQkgICAgICAgICAgICAgICAgIlRyeSB0aGlzLnZpc2l0KHBhdGgpIG9yIHRoaXMudHJhdmVyc2UocGF0aCkgaW5zdGVhZC4iKTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIFByaXZhdGUgc3RhdGUgdGhhdCBuZWVkcyB0byBiZSByZXNldCBiZWZvcmUgZXZlcnkgdHJhdmVyc2FsLgoJCSAgICAgICAgdGhpcy5fdmlzaXRpbmcgPSB0cnVlOwoJCSAgICAgICAgdGhpcy5fY2hhbmdlUmVwb3J0ZWQgPSBmYWxzZTsKCQkgICAgICAgIHRoaXMuX2Fib3J0UmVxdWVzdGVkID0gZmFsc2U7CgkJICAgICAgICB2YXIgYXJnYyA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmdjKTsKCQkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJnYzsgKytpKSB7CgkJICAgICAgICAgICAgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmICghKGFyZ3NbMF0gaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICBhcmdzWzBdID0gbmV3IE5vZGVQYXRoKHsgcm9vdDogYXJnc1swXSB9KS5nZXQoInJvb3QiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIENhbGxlZCB3aXRoIHRoZSBzYW1lIGFyZ3VtZW50cyBhcyAudmlzaXQuCgkJICAgICAgICB0aGlzLnJlc2V0LmFwcGx5KHRoaXMsIGFyZ3MpOwoJCSAgICAgICAgdmFyIGRpZE5vdFRocm93OwoJCSAgICAgICAgdHJ5IHsKCQkgICAgICAgICAgICB2YXIgcm9vdCA9IHRoaXMudmlzaXRXaXRob3V0UmVzZXQoYXJnc1swXSk7CgkJICAgICAgICAgICAgZGlkTm90VGhyb3cgPSB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgZmluYWxseSB7CgkJICAgICAgICAgICAgdGhpcy5fdmlzaXRpbmcgPSBmYWxzZTsKCQkgICAgICAgICAgICBpZiAoIWRpZE5vdFRocm93ICYmIHRoaXMuX2Fib3J0UmVxdWVzdGVkKSB7CgkJICAgICAgICAgICAgICAgIC8vIElmIHRoaXMudmlzaXRXaXRob3V0UmVzZXQgdGhyZXcgYW4gZXhjZXB0aW9uIGFuZAoJCSAgICAgICAgICAgICAgICAvLyB0aGlzLl9hYm9ydFJlcXVlc3RlZCB3YXMgc2V0IHRvIHRydWUsIHJldHVybiB0aGUgcm9vdCBvZgoJCSAgICAgICAgICAgICAgICAvLyB0aGUgQVNUIGluc3RlYWQgb2YgbGV0dGluZyB0aGUgZXhjZXB0aW9uIHByb3BhZ2F0ZSwgc28gdGhhdAoJCSAgICAgICAgICAgICAgICAvLyBjbGllbnQgY29kZSBkb2VzIG5vdCBoYXZlIHRvIHByb3ZpZGUgYSB0cnktY2F0Y2ggYmxvY2sgdG8KCQkgICAgICAgICAgICAgICAgLy8gaW50ZXJjZXB0IHRoZSBBYm9ydFJlcXVlc3QgZXhjZXB0aW9uLiAgT3RoZXIga2luZHMgb2YKCQkgICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9ucyB3aWxsIHByb3BhZ2F0ZSB3aXRob3V0IGJlaW5nIGludGVyY2VwdGVkIGFuZAoJCSAgICAgICAgICAgICAgICAvLyByZXRocm93biBieSBhIGNhdGNoIGJsb2NrLCBzbyB0aGVpciBzdGFja3Mgd2lsbCBhY2N1cmF0ZWx5CgkJICAgICAgICAgICAgICAgIC8vIHJlZmxlY3QgdGhlIG9yaWdpbmFsIHRocm93aW5nIGNvbnRleHQuCgkJICAgICAgICAgICAgICAgIHJldHVybiBhcmdzWzBdLnZhbHVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiByb290OwoJCSAgICB9OwoJCSAgICBQVnAuQWJvcnRSZXF1ZXN0ID0gZnVuY3Rpb24gQWJvcnRSZXF1ZXN0KCkgeyB9OwoJCSAgICBQVnAuYWJvcnQgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB2YXIgdmlzaXRvciA9IHRoaXM7CgkJICAgICAgICB2aXNpdG9yLl9hYm9ydFJlcXVlc3RlZCA9IHRydWU7CgkJICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyB2aXNpdG9yLkFib3J0UmVxdWVzdCgpOwoJCSAgICAgICAgLy8gSWYgeW91IGRlY2lkZSB0byBjYXRjaCB0aGlzIGV4Y2VwdGlvbiBhbmQgc3RvcCBpdCBmcm9tIHByb3BhZ2F0aW5nLAoJCSAgICAgICAgLy8gbWFrZSBzdXJlIHRvIGNhbGwgaXRzIGNhbmNlbCBtZXRob2QgdG8gYXZvaWQgc2lsZW5jaW5nIG90aGVyCgkJICAgICAgICAvLyBleGNlcHRpb25zIHRoYXQgbWlnaHQgYmUgdGhyb3duIGxhdGVyIGluIHRoZSB0cmF2ZXJzYWwuCgkJICAgICAgICByZXF1ZXN0LmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgICAgICB2aXNpdG9yLl9hYm9ydFJlcXVlc3RlZCA9IGZhbHNlOwoJCSAgICAgICAgfTsKCQkgICAgICAgIHRocm93IHJlcXVlc3Q7CgkJICAgIH07CgkJICAgIFBWcC5yZXNldCA9IGZ1bmN0aW9uIChfcGF0aCAvKiwgYWRkaXRpb25hbCBhcmd1bWVudHMgKi8pIHsKCQkgICAgICAgIC8vIEVtcHR5IHN0dWI7IG1heSBiZSByZWFzc2lnbmVkIG9yIG92ZXJyaWRkZW4gYnkgc3ViY2xhc3Nlcy4KCQkgICAgfTsKCQkgICAgUFZwLnZpc2l0V2l0aG91dFJlc2V0ID0gZnVuY3Rpb24gKHBhdGgpIHsKCQkgICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgdGhpcy5Db250ZXh0KSB7CgkJICAgICAgICAgICAgLy8gU2luY2UgdGhpcy5Db250ZXh0LnByb3RvdHlwZSA9PT0gdGhpcywgdGhlcmUncyBhIGNoYW5jZSB3ZQoJCSAgICAgICAgICAgIC8vIG1pZ2h0IGFjY2lkZW50YWxseSBjYWxsIGNvbnRleHQudmlzaXRXaXRob3V0UmVzZXQuIElmIHRoYXQKCQkgICAgICAgICAgICAvLyBoYXBwZW5zLCByZS1pbnZva2UgdGhlIG1ldGhvZCBhZ2FpbnN0IGNvbnRleHQudmlzaXRvci4KCQkgICAgICAgICAgICByZXR1cm4gdGhpcy52aXNpdG9yLnZpc2l0V2l0aG91dFJlc2V0KHBhdGgpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCEocGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgdmFsdWUgPSBwYXRoLnZhbHVlOwoJCSAgICAgICAgdmFyIG1ldGhvZE5hbWUgPSB2YWx1ZSAmJgoJCSAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYKCQkgICAgICAgICAgICB0eXBlb2YgdmFsdWUudHlwZSA9PT0gInN0cmluZyIgJiYKCQkgICAgICAgICAgICB0aGlzLl9tZXRob2ROYW1lVGFibGVbdmFsdWUudHlwZV07CgkJICAgICAgICBpZiAobWV0aG9kTmFtZSkgewoJCSAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5hY3F1aXJlQ29udGV4dChwYXRoKTsKCQkgICAgICAgICAgICB0cnkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5pbnZva2VWaXNpdG9yTWV0aG9kKG1ldGhvZE5hbWUpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBmaW5hbGx5IHsKCQkgICAgICAgICAgICAgICAgdGhpcy5yZWxlYXNlQ29udGV4dChjb250ZXh0KTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICAvLyBJZiB0aGVyZSB3YXMgbm8gdmlzaXRvciBtZXRob2QgdG8gY2FsbCwgdmlzaXQgdGhlIGNoaWxkcmVuIG9mCgkJICAgICAgICAgICAgLy8gdGhpcyBub2RlIGdlbmVyaWNhbGx5LgoJCSAgICAgICAgICAgIHJldHVybiB2aXNpdENoaWxkcmVuKHBhdGgsIHRoaXMpOwoJCSAgICAgICAgfQoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiB2aXNpdENoaWxkcmVuKHBhdGgsIHZpc2l0b3IpIHsKCQkgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCEodmlzaXRvciBpbnN0YW5jZW9mIFBhdGhWaXNpdG9yKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgdmFsdWUgPSBwYXRoLnZhbHVlOwoJCSAgICAgICAgaWYgKGlzQXJyYXkuY2hlY2sodmFsdWUpKSB7CgkJICAgICAgICAgICAgcGF0aC5lYWNoKHZpc2l0b3IudmlzaXRXaXRob3V0UmVzZXQsIHZpc2l0b3IpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoIWlzT2JqZWN0LmNoZWNrKHZhbHVlKSkgOwoJCSAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgdmFyIGNoaWxkTmFtZXMgPSB0eXBlcy5nZXRGaWVsZE5hbWVzKHZhbHVlKTsKCQkgICAgICAgICAgICAvLyBUaGUgLmNvbW1lbnRzIGZpZWxkIG9mIHRoZSBOb2RlIHR5cGUgaXMgaGlkZGVuLCBzbyB3ZSBvbmx5CgkJICAgICAgICAgICAgLy8gdmlzaXQgaXQgaWYgdGhlIHZpc2l0b3IgZGVmaW5lcyB2aXNpdEJsb2NrIG9yIHZpc2l0TGluZSwgYW5kCgkJICAgICAgICAgICAgLy8gdmFsdWUuY29tbWVudHMgaXMgZGVmaW5lZC4KCQkgICAgICAgICAgICBpZiAodmlzaXRvci5fc2hvdWxkVmlzaXRDb21tZW50cyAmJgoJCSAgICAgICAgICAgICAgICB2YWx1ZS5jb21tZW50cyAmJgoJCSAgICAgICAgICAgICAgICBjaGlsZE5hbWVzLmluZGV4T2YoImNvbW1lbnRzIikgPCAwKSB7CgkJICAgICAgICAgICAgICAgIGNoaWxkTmFtZXMucHVzaCgiY29tbWVudHMiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdmFyIGNoaWxkQ291bnQgPSBjaGlsZE5hbWVzLmxlbmd0aDsKCQkgICAgICAgICAgICB2YXIgY2hpbGRQYXRocyA9IFtdOwoJCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRDb3VudDsgKytpKSB7CgkJICAgICAgICAgICAgICAgIHZhciBjaGlsZE5hbWUgPSBjaGlsZE5hbWVzW2ldOwoJCSAgICAgICAgICAgICAgICBpZiAoIWhhc093bi5jYWxsKHZhbHVlLCBjaGlsZE5hbWUpKSB7CgkJICAgICAgICAgICAgICAgICAgICB2YWx1ZVtjaGlsZE5hbWVdID0gdHlwZXMuZ2V0RmllbGRWYWx1ZSh2YWx1ZSwgY2hpbGROYW1lKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjaGlsZFBhdGhzLnB1c2gocGF0aC5nZXQoY2hpbGROYW1lKSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRDb3VudDsgKytpKSB7CgkJICAgICAgICAgICAgICAgIHZpc2l0b3IudmlzaXRXaXRob3V0UmVzZXQoY2hpbGRQYXRoc1tpXSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBhdGgudmFsdWU7CgkJICAgIH0KCQkgICAgUFZwLmFjcXVpcmVDb250ZXh0ID0gZnVuY3Rpb24gKHBhdGgpIHsKCQkgICAgICAgIGlmICh0aGlzLl9yZXVzYWJsZUNvbnRleHRTdGFjay5sZW5ndGggPT09IDApIHsKCQkgICAgICAgICAgICByZXR1cm4gbmV3IHRoaXMuQ29udGV4dChwYXRoKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiB0aGlzLl9yZXVzYWJsZUNvbnRleHRTdGFjay5wb3AoKS5yZXNldChwYXRoKTsKCQkgICAgfTsKCQkgICAgUFZwLnJlbGVhc2VDb250ZXh0ID0gZnVuY3Rpb24gKGNvbnRleHQpIHsKCQkgICAgICAgIGlmICghKGNvbnRleHQgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHRoaXMuX3JldXNhYmxlQ29udGV4dFN0YWNrLnB1c2goY29udGV4dCk7CgkJICAgICAgICBjb250ZXh0LmN1cnJlbnRQYXRoID0gbnVsbDsKCQkgICAgfTsKCQkgICAgUFZwLnJlcG9ydENoYW5nZWQgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB0aGlzLl9jaGFuZ2VSZXBvcnRlZCA9IHRydWU7CgkJICAgIH07CgkJICAgIFBWcC53YXNDaGFuZ2VSZXBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLl9jaGFuZ2VSZXBvcnRlZDsKCQkgICAgfTsKCQkgICAgZnVuY3Rpb24gbWFrZUNvbnRleHRDb25zdHJ1Y3Rvcih2aXNpdG9yKSB7CgkJICAgICAgICBmdW5jdGlvbiBDb250ZXh0KHBhdGgpIHsKCQkgICAgICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgQ29udGV4dCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBhdGhWaXNpdG9yKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoIShwYXRoIGluc3RhbmNlb2YgTm9kZVBhdGgpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidmlzaXRvciIsIHsKCQkgICAgICAgICAgICAgICAgdmFsdWU6IHZpc2l0b3IsCgkJICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwKCQkgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKCQkgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZQoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgICAgIHRoaXMuY3VycmVudFBhdGggPSBwYXRoOwoJCSAgICAgICAgICAgIHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlID0gdHJ1ZTsKCQkgICAgICAgICAgICBPYmplY3Quc2VhbCh0aGlzKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmICghKHZpc2l0b3IgaW5zdGFuY2VvZiBQYXRoVmlzaXRvcikpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSB2aXNpdG9yIG9iamVjdCBpcyB0aGUgcHJvdG90eXBlIG9mIENvbnRleHQucHJvdG90eXBlLAoJCSAgICAgICAgLy8gc28gYWxsIHZpc2l0b3IgbWV0aG9kcyBhcmUgaW5oZXJpdGVkIGJ5IGNvbnRleHQgb2JqZWN0cy4KCQkgICAgICAgIHZhciBDcCA9IENvbnRleHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSh2aXNpdG9yKTsKCQkgICAgICAgIENwLmNvbnN0cnVjdG9yID0gQ29udGV4dDsKCQkgICAgICAgIGV4dGVuZChDcCwgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcyk7CgkJICAgICAgICByZXR1cm4gQ29udGV4dDsKCQkgICAgfQoJCSAgICAvLyBFdmVyeSBQYXRoVmlzaXRvciBoYXMgYSBkaWZmZXJlbnQgdGhpcy5Db250ZXh0IGNvbnN0cnVjdG9yIGFuZAoJCSAgICAvLyB0aGlzLkNvbnRleHQucHJvdG90eXBlIG9iamVjdCwgYnV0IHRob3NlIHByb3RvdHlwZXMgY2FuIGFsbCB1c2UgdGhlCgkJICAgIC8vIHNhbWUgcmVzZXQsIGludm9rZVZpc2l0b3JNZXRob2QsIGFuZCB0cmF2ZXJzZSBmdW5jdGlvbiBvYmplY3RzLgoJCSAgICB2YXIgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICAgIHNoYXJlZENvbnRleHRQcm90b01ldGhvZHMucmVzZXQgPQoJCSAgICAgICAgZnVuY3Rpb24gcmVzZXQocGF0aCkgewoJCSAgICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdGhpcy5jdXJyZW50UGF0aCA9IHBhdGg7CgkJICAgICAgICAgICAgdGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UgPSB0cnVlOwoJCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJCSAgICAgICAgfTsKCQkgICAgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcy5pbnZva2VWaXNpdG9yTWV0aG9kID0KCQkgICAgICAgIGZ1bmN0aW9uIGludm9rZVZpc2l0b3JNZXRob2QobWV0aG9kTmFtZSkgewoJCSAgICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHRoaXMuY3VycmVudFBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMudmlzaXRvclttZXRob2ROYW1lXS5jYWxsKHRoaXMsIHRoaXMuY3VycmVudFBhdGgpOwoJCSAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7CgkJICAgICAgICAgICAgICAgIC8vIFZpc2l0b3IgbWV0aG9kcyByZXR1cm4gZmFsc2UgdG8gaW5kaWNhdGUgdGhhdCB0aGV5IGhhdmUgaGFuZGxlZAoJCSAgICAgICAgICAgICAgICAvLyB0aGVpciBvd24gdHJhdmVyc2FsIG5lZWRzLCBhbmQgd2Ugc2hvdWxkIG5vdCBjb21wbGFpbiBpZgoJCSAgICAgICAgICAgICAgICAvLyB0aGlzLm5lZWRUb0NhbGxUcmF2ZXJzZSBpcyBzdGlsbCB0cnVlLgoJCSAgICAgICAgICAgICAgICB0aGlzLm5lZWRUb0NhbGxUcmF2ZXJzZSA9IGZhbHNlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCQxKSB7CgkJICAgICAgICAgICAgICAgIC8vIEFueSBvdGhlciBub24tdW5kZWZpbmVkIHZhbHVlIHJldHVybmVkIGZyb20gdGhlIHZpc2l0b3IgbWV0aG9kCgkJICAgICAgICAgICAgICAgIC8vIGlzIGludGVycHJldGVkIGFzIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgkJICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhdGggPSB0aGlzLmN1cnJlbnRQYXRoLnJlcGxhY2UocmVzdWx0KVswXTsKCQkgICAgICAgICAgICAgICAgaWYgKHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlKSB7CgkJICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzLnRyYXZlcnNlIHN0aWxsIGhhc24ndCBiZWVuIGNhbGxlZCwgdmlzaXQgdGhlCgkJICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbiBvZiB0aGUgcmVwbGFjZW1lbnQgbm9kZS4KCQkgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhdmVyc2UodGhpcy5jdXJyZW50UGF0aCk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlICE9PSBmYWxzZSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgZWl0aGVyIGNhbGwgdGhpcy50cmF2ZXJzZSBvciByZXR1cm4gZmFsc2UgaW4gIiArIG1ldGhvZE5hbWUpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB2YXIgcGF0aCA9IHRoaXMuY3VycmVudFBhdGg7CgkJICAgICAgICAgICAgcmV0dXJuIHBhdGggJiYgcGF0aC52YWx1ZTsKCQkgICAgICAgIH07CgkJICAgIHNoYXJlZENvbnRleHRQcm90b01ldGhvZHMudHJhdmVyc2UgPQoJCSAgICAgICAgZnVuY3Rpb24gdHJhdmVyc2UocGF0aCwgbmV3VmlzaXRvcikgewoJCSAgICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEodGhpcy5jdXJyZW50UGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB0aGlzLm5lZWRUb0NhbGxUcmF2ZXJzZSA9IGZhbHNlOwoJCSAgICAgICAgICAgIHJldHVybiB2aXNpdENoaWxkcmVuKHBhdGgsIFBhdGhWaXNpdG9yLmZyb21NZXRob2RzT2JqZWN0KG5ld1Zpc2l0b3IgfHwgdGhpcy52aXNpdG9yKSk7CgkJICAgICAgICB9OwoJCSAgICBzaGFyZWRDb250ZXh0UHJvdG9NZXRob2RzLnZpc2l0ID0KCQkgICAgICAgIGZ1bmN0aW9uIHZpc2l0KHBhdGgsIG5ld1Zpc2l0b3IpIHsKCQkgICAgICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgdGhpcy5Db250ZXh0KSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoIShwYXRoIGluc3RhbmNlb2YgTm9kZVBhdGgpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHRoaXMuY3VycmVudFBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UgPSBmYWxzZTsKCQkgICAgICAgICAgICByZXR1cm4gUGF0aFZpc2l0b3IuZnJvbU1ldGhvZHNPYmplY3QobmV3VmlzaXRvciB8fCB0aGlzLnZpc2l0b3IpLnZpc2l0V2l0aG91dFJlc2V0KHBhdGgpOwoJCSAgICAgICAgfTsKCQkgICAgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcy5yZXBvcnRDaGFuZ2VkID0gZnVuY3Rpb24gcmVwb3J0Q2hhbmdlZCgpIHsKCQkgICAgICAgIHRoaXMudmlzaXRvci5yZXBvcnRDaGFuZ2VkKCk7CgkJICAgIH07CgkJICAgIHNoYXJlZENvbnRleHRQcm90b01ldGhvZHMuYWJvcnQgPSBmdW5jdGlvbiBhYm9ydCgpIHsKCQkgICAgICAgIHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlID0gZmFsc2U7CgkJICAgICAgICB0aGlzLnZpc2l0b3IuYWJvcnQoKTsKCQkgICAgfTsKCQkgICAgcmV0dXJuIFBhdGhWaXNpdG9yOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBwYXRoVmlzaXRvclBsdWdpbjsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChwYXRoVmlzaXRvciwgcGF0aFZpc2l0b3IuZXhwb3J0cykpOwoJcmV0dXJuIHBhdGhWaXNpdG9yLmV4cG9ydHM7Cn0KCnZhciBlcXVpdiA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRFcXVpdjsKCmZ1bmN0aW9uIHJlcXVpcmVFcXVpdiAoKSB7CglpZiAoaGFzUmVxdWlyZWRFcXVpdikgcmV0dXJuIGVxdWl2LmV4cG9ydHM7CgloYXNSZXF1aXJlZEVxdWl2ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGdldEZpZWxkTmFtZXMgPSB0eXBlcy5nZXRGaWVsZE5hbWVzOwoJCSAgICB2YXIgZ2V0RmllbGRWYWx1ZSA9IHR5cGVzLmdldEZpZWxkVmFsdWU7CgkJICAgIHZhciBpc0FycmF5ID0gdHlwZXMuYnVpbHRJblR5cGVzLmFycmF5OwoJCSAgICB2YXIgaXNPYmplY3QgPSB0eXBlcy5idWlsdEluVHlwZXMub2JqZWN0OwoJCSAgICB2YXIgaXNEYXRlID0gdHlwZXMuYnVpbHRJblR5cGVzLkRhdGU7CgkJICAgIHZhciBpc1JlZ0V4cCA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5SZWdFeHA7CgkJICAgIHZhciBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwoJCSAgICBmdW5jdGlvbiBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQoYSwgYiwgcHJvYmxlbVBhdGgpIHsKCQkgICAgICAgIGlmIChpc0FycmF5LmNoZWNrKHByb2JsZW1QYXRoKSkgewoJCSAgICAgICAgICAgIHByb2JsZW1QYXRoLmxlbmd0aCA9IDA7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICBwcm9ibGVtUGF0aCA9IG51bGw7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gYXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCk7CgkJICAgIH0KCQkgICAgYXN0Tm9kZXNBcmVFcXVpdmFsZW50LmFzc2VydCA9IGZ1bmN0aW9uIChhLCBiKSB7CgkJICAgICAgICB2YXIgcHJvYmxlbVBhdGggPSBbXTsKCQkgICAgICAgIGlmICghYXN0Tm9kZXNBcmVFcXVpdmFsZW50KGEsIGIsIHByb2JsZW1QYXRoKSkgewoJCSAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aC5sZW5ndGggPT09IDApIHsKCQkgICAgICAgICAgICAgICAgaWYgKGEgIT09IGIpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIGRpZmZlciBpbiB0aGUgZm9sbG93aW5nIHBhdGg6ICIgKwoJCSAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVBhdGgubWFwKHN1YnNjcmlwdEZvclByb3BlcnR5KS5qb2luKCIiKSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiBzdWJzY3JpcHRGb3JQcm9wZXJ0eShwcm9wZXJ0eSkgewoJCSAgICAgICAgaWYgKC9bXyRhLXpdW18kYS16MC05XSovaS50ZXN0KHByb3BlcnR5KSkgewoJCSAgICAgICAgICAgIHJldHVybiAiLiIgKyBwcm9wZXJ0eTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiAiWyIgKyBKU09OLnN0cmluZ2lmeShwcm9wZXJ0eSkgKyAiXSI7CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gYXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgaWYgKGEgPT09IGIpIHsKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChpc0FycmF5LmNoZWNrKGEpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGFycmF5c0FyZUVxdWl2YWxlbnQoYSwgYiwgcHJvYmxlbVBhdGgpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKGlzT2JqZWN0LmNoZWNrKGEpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIG9iamVjdHNBcmVFcXVpdmFsZW50KGEsIGIsIHByb2JsZW1QYXRoKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChpc0RhdGUuY2hlY2soYSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gaXNEYXRlLmNoZWNrKGIpICYmICgrYSA9PT0gK2IpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKGlzUmVnRXhwLmNoZWNrKGEpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGlzUmVnRXhwLmNoZWNrKGIpICYmIChhLnNvdXJjZSA9PT0gYi5zb3VyY2UgJiYKCQkgICAgICAgICAgICAgICAgYS5nbG9iYWwgPT09IGIuZ2xvYmFsICYmCgkJICAgICAgICAgICAgICAgIGEubXVsdGlsaW5lID09PSBiLm11bHRpbGluZSAmJgoJCSAgICAgICAgICAgICAgICBhLmlnbm9yZUNhc2UgPT09IGIuaWdub3JlQ2FzZSk7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gYSA9PSBiOwoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIGFycmF5c0FyZUVxdWl2YWxlbnQoYSwgYiwgcHJvYmxlbVBhdGgpIHsKCQkgICAgICAgIGlzQXJyYXkuYXNzZXJ0KGEpOwoJCSAgICAgICAgdmFyIGFMZW5ndGggPSBhLmxlbmd0aDsKCQkgICAgICAgIGlmICghaXNBcnJheS5jaGVjayhiKSB8fCBiLmxlbmd0aCAhPT0gYUxlbmd0aCkgewoJCSAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgICAgICAgICBwcm9ibGVtUGF0aC5wdXNoKCJsZW5ndGgiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyArK2kpIHsKCQkgICAgICAgICAgICBpZiAocHJvYmxlbVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgcHJvYmxlbVBhdGgucHVzaChpKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKGkgaW4gYSAhPT0gaSBpbiBiKSB7CgkJICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCFhcmVFcXVpdmFsZW50KGFbaV0sIGJbaV0sIHByb2JsZW1QYXRoKSkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgICAgICAgICB2YXIgcHJvYmxlbVBhdGhUYWlsID0gcHJvYmxlbVBhdGgucG9wKCk7CgkJICAgICAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aFRhaWwgIT09IGkpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIiArIHByb2JsZW1QYXRoVGFpbCk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgfQoJCSAgICBmdW5jdGlvbiBvYmplY3RzQXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgaXNPYmplY3QuYXNzZXJ0KGEpOwoJCSAgICAgICAgaWYgKCFpc09iamVjdC5jaGVjayhiKSkgewoJCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIEZhc3QgcGF0aCBmb3IgYSBjb21tb24gcHJvcGVydHkgb2YgQVNUIG5vZGVzLgoJCSAgICAgICAgaWYgKGEudHlwZSAhPT0gYi50eXBlKSB7CgkJICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoKSB7CgkJICAgICAgICAgICAgICAgIHByb2JsZW1QYXRoLnB1c2goInR5cGUiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIGFOYW1lcyA9IGdldEZpZWxkTmFtZXMoYSk7CgkJICAgICAgICB2YXIgYU5hbWVDb3VudCA9IGFOYW1lcy5sZW5ndGg7CgkJICAgICAgICB2YXIgYk5hbWVzID0gZ2V0RmllbGROYW1lcyhiKTsKCQkgICAgICAgIHZhciBiTmFtZUNvdW50ID0gYk5hbWVzLmxlbmd0aDsKCQkgICAgICAgIGlmIChhTmFtZUNvdW50ID09PSBiTmFtZUNvdW50KSB7CgkJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTmFtZUNvdW50OyArK2kpIHsKCQkgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBhTmFtZXNbaV07CgkJICAgICAgICAgICAgICAgIHZhciBhQ2hpbGQgPSBnZXRGaWVsZFZhbHVlKGEsIG5hbWUpOwoJCSAgICAgICAgICAgICAgICB2YXIgYkNoaWxkID0gZ2V0RmllbGRWYWx1ZShiLCBuYW1lKTsKCQkgICAgICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoKSB7CgkJICAgICAgICAgICAgICAgICAgICBwcm9ibGVtUGF0aC5wdXNoKG5hbWUpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGlmICghYXJlRXF1aXZhbGVudChhQ2hpbGQsIGJDaGlsZCwgcHJvYmxlbVBhdGgpKSB7CgkJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoKSB7CgkJICAgICAgICAgICAgICAgICAgICB2YXIgcHJvYmxlbVBhdGhUYWlsID0gcHJvYmxlbVBhdGgucG9wKCk7CgkJICAgICAgICAgICAgICAgICAgICBpZiAocHJvYmxlbVBhdGhUYWlsICE9PSBuYW1lKSB7CgkJICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiICsgcHJvYmxlbVBhdGhUYWlsKTsKCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmICghcHJvYmxlbVBhdGgpIHsKCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICAvLyBTaW5jZSBhTmFtZUNvdW50ICE9PSBiTmFtZUNvdW50LCB3ZSBuZWVkIHRvIGZpbmQgc29tZSBuYW1lIHRoYXQncwoJCSAgICAgICAgLy8gbWlzc2luZyBpbiBhTmFtZXMgYnV0IHByZXNlbnQgaW4gYk5hbWVzLCBvciB2aWNlLXZlcnNhLgoJCSAgICAgICAgdmFyIHNlZW5OYW1lcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYU5hbWVDb3VudDsgKytpKSB7CgkJICAgICAgICAgICAgc2Vlbk5hbWVzW2FOYW1lc1tpXV0gPSB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgZm9yIChpID0gMDsgaSA8IGJOYW1lQ291bnQ7ICsraSkgewoJCSAgICAgICAgICAgIG5hbWUgPSBiTmFtZXNbaV07CgkJICAgICAgICAgICAgaWYgKCFoYXNPd24uY2FsbChzZWVuTmFtZXMsIG5hbWUpKSB7CgkJICAgICAgICAgICAgICAgIHByb2JsZW1QYXRoLnB1c2gobmFtZSk7CgkJICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZGVsZXRlIHNlZW5OYW1lc1tuYW1lXTsKCQkgICAgICAgIH0KCQkgICAgICAgIGZvciAobmFtZSBpbiBzZWVuTmFtZXMpIHsKCQkgICAgICAgICAgICBwcm9ibGVtUGF0aC5wdXNoKG5hbWUpOwoJCSAgICAgICAgICAgIGJyZWFrOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9CgkJICAgIHJldHVybiBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQ7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlcXVpdiwgZXF1aXYuZXhwb3J0cykpOwoJcmV0dXJuIGVxdWl2LmV4cG9ydHM7Cn0KCnZhciBoYXNSZXF1aXJlZEZvcms7CgpmdW5jdGlvbiByZXF1aXJlRm9yayAoKSB7CglpZiAoaGFzUmVxdWlyZWRGb3JrKSByZXR1cm4gZm9yayQxLmV4cG9ydHM7CgloYXNSZXF1aXJlZEZvcmsgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgcGF0aF92aXNpdG9yXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlUGF0aFZpc2l0b3IoKSk7CgkJdmFyIGVxdWl2XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXF1aXYoKSk7CgkJdmFyIHBhdGhfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVQYXRoKCkpOwoJCXZhciBub2RlX3BhdGhfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVOb2RlUGF0aCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZGVmcykgewoJCSAgICB2YXIgZm9yayA9IGNyZWF0ZUZvcmsoKTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgZGVmcy5mb3JFYWNoKGZvcmsudXNlKTsKCQkgICAgdHlwZXMuZmluYWxpemUoKTsKCQkgICAgdmFyIFBhdGhWaXNpdG9yID0gZm9yay51c2UocGF0aF92aXNpdG9yXzEuZGVmYXVsdCk7CgkJICAgIHJldHVybiB7CgkJICAgICAgICBUeXBlOiB0eXBlcy5UeXBlLAoJCSAgICAgICAgYnVpbHRJblR5cGVzOiB0eXBlcy5idWlsdEluVHlwZXMsCgkJICAgICAgICBuYW1lZFR5cGVzOiB0eXBlcy5uYW1lZFR5cGVzLAoJCSAgICAgICAgYnVpbGRlcnM6IHR5cGVzLmJ1aWxkZXJzLAoJCSAgICAgICAgZGVmaW5lTWV0aG9kOiB0eXBlcy5kZWZpbmVNZXRob2QsCgkJICAgICAgICBnZXRGaWVsZE5hbWVzOiB0eXBlcy5nZXRGaWVsZE5hbWVzLAoJCSAgICAgICAgZ2V0RmllbGRWYWx1ZTogdHlwZXMuZ2V0RmllbGRWYWx1ZSwKCQkgICAgICAgIGVhY2hGaWVsZDogdHlwZXMuZWFjaEZpZWxkLAoJCSAgICAgICAgc29tZUZpZWxkOiB0eXBlcy5zb21lRmllbGQsCgkJICAgICAgICBnZXRTdXBlcnR5cGVOYW1lczogdHlwZXMuZ2V0U3VwZXJ0eXBlTmFtZXMsCgkJICAgICAgICBnZXRCdWlsZGVyTmFtZTogdHlwZXMuZ2V0QnVpbGRlck5hbWUsCgkJICAgICAgICBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQ6IGZvcmsudXNlKGVxdWl2XzEuZGVmYXVsdCksCgkJICAgICAgICBmaW5hbGl6ZTogdHlwZXMuZmluYWxpemUsCgkJICAgICAgICBQYXRoOiBmb3JrLnVzZShwYXRoXzEuZGVmYXVsdCksCgkJICAgICAgICBOb2RlUGF0aDogZm9yay51c2Uobm9kZV9wYXRoXzEuZGVmYXVsdCksCgkJICAgICAgICBQYXRoVmlzaXRvcjogUGF0aFZpc2l0b3IsCgkJICAgICAgICB1c2U6IGZvcmsudXNlLAoJCSAgICAgICAgdmlzaXQ6IFBhdGhWaXNpdG9yLnZpc2l0LAoJCSAgICB9OwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJZnVuY3Rpb24gY3JlYXRlRm9yaygpIHsKCQkgICAgdmFyIHVzZWQgPSBbXTsKCQkgICAgdmFyIHVzZWRSZXN1bHQgPSBbXTsKCQkgICAgZnVuY3Rpb24gdXNlKHBsdWdpbikgewoJCSAgICAgICAgdmFyIGlkeCA9IHVzZWQuaW5kZXhPZihwbHVnaW4pOwoJCSAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHsKCQkgICAgICAgICAgICBpZHggPSB1c2VkLmxlbmd0aDsKCQkgICAgICAgICAgICB1c2VkLnB1c2gocGx1Z2luKTsKCQkgICAgICAgICAgICB1c2VkUmVzdWx0W2lkeF0gPSBwbHVnaW4oZm9yayk7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gdXNlZFJlc3VsdFtpZHhdOwoJCSAgICB9CgkJICAgIHZhciBmb3JrID0geyB1c2U6IHVzZSB9OwoJCSAgICByZXR1cm4gZm9yazsKCQl9CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZm9yayQxLCBmb3JrJDEuZXhwb3J0cykpOwoJcmV0dXJuIGZvcmskMS5leHBvcnRzOwp9Cgp2YXIgY29yZSA9IHtleHBvcnRzOiB7fX07Cgp2YXIgY29yZU9wZXJhdG9ycyA9IHt9OwoKdmFyIGhhc1JlcXVpcmVkQ29yZU9wZXJhdG9yczsKCmZ1bmN0aW9uIHJlcXVpcmVDb3JlT3BlcmF0b3JzICgpIHsKCWlmIChoYXNSZXF1aXJlZENvcmVPcGVyYXRvcnMpIHJldHVybiBjb3JlT3BlcmF0b3JzOwoJaGFzUmVxdWlyZWRDb3JlT3BlcmF0b3JzID0gMTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb3JlT3BlcmF0b3JzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgljb3JlT3BlcmF0b3JzLkxvZ2ljYWxPcGVyYXRvcnMgPSBjb3JlT3BlcmF0b3JzLkFzc2lnbm1lbnRPcGVyYXRvcnMgPSBjb3JlT3BlcmF0b3JzLkJpbmFyeU9wZXJhdG9ycyA9IHZvaWQgMDsKCWNvcmVPcGVyYXRvcnMuQmluYXJ5T3BlcmF0b3JzID0gWwoJICAgICI9PSIsICIhPSIsICI9PT0iLCAiIT09IiwKCSAgICAiPCIsICI8PSIsICI+IiwgIj49IiwKCSAgICAiPDwiLCAiPj4iLCAiPj4+IiwKCSAgICAiKyIsICItIiwgIioiLCAiLyIsICIlIiwKCSAgICAiJiIsCgkgICAgInwiLCAiXiIsICJpbiIsCgkgICAgImluc3RhbmNlb2YiLAoJXTsKCWNvcmVPcGVyYXRvcnMuQXNzaWdubWVudE9wZXJhdG9ycyA9IFsKCSAgICAiPSIsICIrPSIsICItPSIsICIqPSIsICIvPSIsICIlPSIsCgkgICAgIjw8PSIsICI+Pj0iLCAiPj4+PSIsCgkgICAgInw9IiwgIl49IiwgIiY9IiwKCV07Cgljb3JlT3BlcmF0b3JzLkxvZ2ljYWxPcGVyYXRvcnMgPSBbCgkgICAgInx8IiwgIiYmIiwKCV07CglyZXR1cm4gY29yZU9wZXJhdG9yczsKfQoKdmFyIHNoYXJlZCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRTaGFyZWQ7CgpmdW5jdGlvbiByZXF1aXJlU2hhcmVkICgpIHsKCWlmIChoYXNSZXF1aXJlZFNoYXJlZCkgcmV0dXJuIHNoYXJlZC5leHBvcnRzOwoJaGFzUmVxdWlyZWRTaGFyZWQgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgVHlwZSA9IHR5cGVzLlR5cGU7CgkJICAgIHZhciBidWlsdGluID0gdHlwZXMuYnVpbHRJblR5cGVzOwoJCSAgICB2YXIgaXNOdW1iZXIgPSBidWlsdGluLm51bWJlcjsKCQkgICAgLy8gQW4gZXhhbXBsZSBvZiBjb25zdHJ1Y3RpbmcgYSBuZXcgdHlwZSB3aXRoIGFyYml0cmFyeSBjb25zdHJhaW50cyBmcm9tCgkJICAgIC8vIGFuIGV4aXN0aW5nIHR5cGUuCgkJICAgIGZ1bmN0aW9uIGdlcSh0aGFuKSB7CgkJICAgICAgICByZXR1cm4gVHlwZS5mcm9tKGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gaXNOdW1iZXIuY2hlY2sodmFsdWUpICYmIHZhbHVlID49IHRoYW47IH0sIGlzTnVtYmVyICsgIiA+PSAiICsgdGhhbik7CgkJICAgIH0KCQkgICAgLy8gRGVmYXVsdCB2YWx1ZS1yZXR1cm5pbmcgZnVuY3Rpb25zIHRoYXQgbWF5IG9wdGlvbmFsbHkgYmUgcGFzc2VkIGFzIGEKCQkgICAgLy8gdGhpcmQgYXJndW1lbnQgdG8gRGVmLnByb3RvdHlwZS5maWVsZC4KCQkgICAgdmFyIGRlZmF1bHRzID0gewoJCSAgICAgICAgLy8gRnVuY3Rpb25zIHdlcmUgdXNlZCBiZWNhdXNlIChhbW9uZyBvdGhlciByZWFzb25zKSB0aGF0J3MgdGhlIG1vc3QKCQkgICAgICAgIC8vIGVsZWdhbnQgd2F5IHRvIGFsbG93IGZvciB0aGUgZW1wdHlBcnJheSBvbmUgYWx3YXlzIHRvIGdpdmUgYSBuZXcKCQkgICAgICAgIC8vIGFycmF5IGluc3RhbmNlLgoJCSAgICAgICAgIm51bGwiOiBmdW5jdGlvbiAoKSB7IHJldHVybiBudWxsOyB9LAoJCSAgICAgICAgImVtcHR5QXJyYXkiOiBmdW5jdGlvbiAoKSB7IHJldHVybiBbXTsgfSwKCQkgICAgICAgICJmYWxzZSI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9LAoJCSAgICAgICAgInRydWUiOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9LAoJCSAgICAgICAgInVuZGVmaW5lZCI6IGZ1bmN0aW9uICgpIHsgfSwKCQkgICAgICAgICJ1c2Ugc3RyaWN0IjogZnVuY3Rpb24gKCkgeyByZXR1cm4gInVzZSBzdHJpY3QiOyB9CgkJICAgIH07CgkJICAgIHZhciBuYWl2ZUlzUHJpbWl0aXZlID0gVHlwZS5vcihidWlsdGluLnN0cmluZywgYnVpbHRpbi5udW1iZXIsIGJ1aWx0aW4uYm9vbGVhbiwgYnVpbHRpbi5udWxsLCBidWlsdGluLnVuZGVmaW5lZCk7CgkJICAgIHZhciBpc1ByaW1pdGl2ZSA9IFR5cGUuZnJvbShmdW5jdGlvbiAodmFsdWUpIHsKCQkgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwoJCSAgICAgICAgaWYgKHR5cGUgPT09ICJvYmplY3QiIHx8CgkJICAgICAgICAgICAgdHlwZSA9PT0gImZ1bmN0aW9uIikgewoJCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICB9LCBuYWl2ZUlzUHJpbWl0aXZlLnRvU3RyaW5nKCkpOwoJCSAgICByZXR1cm4gewoJCSAgICAgICAgZ2VxOiBnZXEsCgkJICAgICAgICBkZWZhdWx0czogZGVmYXVsdHMsCgkJICAgICAgICBpc1ByaW1pdGl2ZTogaXNQcmltaXRpdmUsCgkJICAgIH07CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChzaGFyZWQsIHNoYXJlZC5leHBvcnRzKSk7CglyZXR1cm4gc2hhcmVkLmV4cG9ydHM7Cn0KCnZhciBoYXNSZXF1aXJlZENvcmU7CgpmdW5jdGlvbiByZXF1aXJlQ29yZSAoKSB7CglpZiAoaGFzUmVxdWlyZWRDb3JlKSByZXR1cm4gY29yZS5leHBvcnRzOwoJaGFzUmVxdWlyZWRDb3JlID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGNvcmVfb3BlcmF0b3JzXzEgPSByZXF1aXJlQ29yZU9wZXJhdG9ycygpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIFR5cGUgPSB0eXBlcy5UeXBlOwoJCSAgICB2YXIgZGVmID0gVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IFR5cGUub3I7CgkJICAgIHZhciBzaGFyZWQgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZmF1bHRzID0gc2hhcmVkLmRlZmF1bHRzOwoJCSAgICB2YXIgZ2VxID0gc2hhcmVkLmdlcTsKCQkgICAgLy8gQWJzdHJhY3Qgc3VwZXJ0eXBlIG9mIGFsbCBzeW50YWN0aWMgZW50aXRpZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBoYXZlIGEKCQkgICAgLy8gLmxvYyBmaWVsZC4KCQkgICAgZGVmKCJQcmludGFibGUiKQoJCSAgICAgICAgLmZpZWxkKCJsb2MiLCBvcihkZWYoIlNvdXJjZUxvY2F0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdLCB0cnVlKTsKCQkgICAgZGVmKCJOb2RlIikKCQkgICAgICAgIC5iYXNlcygiUHJpbnRhYmxlIikKCQkgICAgICAgIC5maWVsZCgidHlwZSIsIFN0cmluZykKCQkgICAgICAgIC5maWVsZCgiY29tbWVudHMiLCBvcihbZGVmKCJDb21tZW50IildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSwgdHJ1ZSk7CgkJICAgIGRlZigiU291cmNlTG9jYXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJzdGFydCIsIGRlZigiUG9zaXRpb24iKSkKCQkgICAgICAgIC5maWVsZCgiZW5kIiwgZGVmKCJQb3NpdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBvcihTdHJpbmcsIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJQb3NpdGlvbiIpCgkJICAgICAgICAuZmllbGQoImxpbmUiLCBnZXEoMSkpCgkJICAgICAgICAuZmllbGQoImNvbHVtbiIsIGdlcSgwKSk7CgkJICAgIGRlZigiRmlsZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9ncmFtIiwgIm5hbWUiKQoJCSAgICAgICAgLmZpZWxkKCJwcm9ncmFtIiwgZGVmKCJQcm9ncmFtIikpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBvcihTdHJpbmcsIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJQcm9ncmFtIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW2RlZigiU3RhdGVtZW50IildKTsKCQkgICAgZGVmKCJGdW5jdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiUGF0dGVybiIpXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQmxvY2tTdGF0ZW1lbnQiKSkKCQkgICAgICAgIC5maWVsZCgiZ2VuZXJhdG9yIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImFzeW5jIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIlN0YXRlbWVudCIpLmJhc2VzKCJOb2RlIik7CgkJICAgIC8vIFRoZSBlbXB0eSAuYnVpbGQoKSBoZXJlIG1lYW5zIHRoYXQgYW4gRW1wdHlTdGF0ZW1lbnQgY2FuIGJlIGNvbnN0cnVjdGVkCgkJICAgIC8vIChpLmUuIGl0J3Mgbm90IGFic3RyYWN0KSBidXQgdGhhdCBpdCBuZWVkcyBubyBhcmd1bWVudHMuCgkJICAgIGRlZigiRW1wdHlTdGF0ZW1lbnQiKS5iYXNlcygiU3RhdGVtZW50IikuYnVpbGQoKTsKCQkgICAgZGVmKCJCbG9ja1N0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW2RlZigiU3RhdGVtZW50IildKTsKCQkgICAgLy8gVE9ETyBGaWd1cmUgb3V0IGhvdyB0byBzaWxlbnRseSBjb2VyY2UgRXhwcmVzc2lvbnMgdG8KCQkgICAgLy8gRXhwcmVzc2lvblN0YXRlbWVudHMgd2hlcmUgYSBTdGF0ZW1lbnQgd2FzIGV4cGVjdGVkLgoJCSAgICBkZWYoIkV4cHJlc3Npb25TdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJJZlN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoInRlc3QiLCAiY29uc2VxdWVudCIsICJhbHRlcm5hdGUiKQoJCSAgICAgICAgLmZpZWxkKCJ0ZXN0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImNvbnNlcXVlbnQiLCBkZWYoIlN0YXRlbWVudCIpKQoJCSAgICAgICAgLmZpZWxkKCJhbHRlcm5hdGUiLCBvcihkZWYoIlN0YXRlbWVudCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiTGFiZWxlZFN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImxhYmVsIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJsYWJlbCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJTdGF0ZW1lbnQiKSk7CgkJICAgIGRlZigiQnJlYWtTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJsYWJlbCIpCgkJICAgICAgICAuZmllbGQoImxhYmVsIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJDb250aW51ZVN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImxhYmVsIikKCQkgICAgICAgIC5maWVsZCgibGFiZWwiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIldpdGhTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3QiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoIm9iamVjdCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJTdGF0ZW1lbnQiKSk7CgkJICAgIGRlZigiU3dpdGNoU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiZGlzY3JpbWluYW50IiwgImNhc2VzIiwgImxleGljYWwiKQoJCSAgICAgICAgLmZpZWxkKCJkaXNjcmltaW5hbnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiY2FzZXMiLCBbZGVmKCJTd2l0Y2hDYXNlIildKQoJCSAgICAgICAgLmZpZWxkKCJsZXhpY2FsIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIlJldHVyblN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpOwoJCSAgICBkZWYoIlRocm93U3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJUcnlTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJibG9jayIsICJoYW5kbGVyIiwgImZpbmFsaXplciIpCgkJICAgICAgICAuZmllbGQoImJsb2NrIiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKQoJCSAgICAgICAgLmZpZWxkKCJoYW5kbGVyIiwgb3IoZGVmKCJDYXRjaENsYXVzZSIpLCBudWxsKSwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlcnMgJiYgdGhpcy5oYW5kbGVyc1swXSB8fCBudWxsOwoJCSAgICB9KQoJCSAgICAgICAgLmZpZWxkKCJoYW5kbGVycyIsIFtkZWYoIkNhdGNoQ2xhdXNlIildLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVyID8gW3RoaXMuaGFuZGxlcl0gOiBbXTsKCQkgICAgfSwgdHJ1ZSkgLy8gSW5kaWNhdGVzIHRoaXMgZmllbGQgaXMgaGlkZGVuIGZyb20gZWFjaEZpZWxkIGl0ZXJhdGlvbi4KCQkgICAgICAgIC5maWVsZCgiZ3VhcmRlZEhhbmRsZXJzIiwgW2RlZigiQ2F0Y2hDbGF1c2UiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoImZpbmFsaXplciIsIG9yKGRlZigiQmxvY2tTdGF0ZW1lbnQiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNhdGNoQ2xhdXNlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtIiwgImd1YXJkIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbSIsIGRlZigiUGF0dGVybiIpKQoJCSAgICAgICAgLmZpZWxkKCJndWFyZCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQmxvY2tTdGF0ZW1lbnQiKSk7CgkJICAgIGRlZigiV2hpbGVTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJ0ZXN0IiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJ0ZXN0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJEb1doaWxlU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiYm9keSIsICJ0ZXN0IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiU3RhdGVtZW50IikpCgkJICAgICAgICAuZmllbGQoInRlc3QiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiRm9yU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiaW5pdCIsICJ0ZXN0IiwgInVwZGF0ZSIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgiaW5pdCIsIG9yKGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpLCBkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInRlc3QiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInVwZGF0ZSIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiU3RhdGVtZW50IikpOwoJCSAgICBkZWYoIkZvckluU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgibGVmdCIsICJyaWdodCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIG9yKGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpLCBkZWYoIkV4cHJlc3Npb24iKSkpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJEZWJ1Z2dlclN0YXRlbWVudCIpLmJhc2VzKCJTdGF0ZW1lbnQiKS5idWlsZCgpOwoJCSAgICBkZWYoIkRlY2xhcmF0aW9uIikuYmFzZXMoIlN0YXRlbWVudCIpOwoJCSAgICBkZWYoIkZ1bmN0aW9uRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGdW5jdGlvbiIsICJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInBhcmFtcyIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiRnVuY3Rpb25FeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRnVuY3Rpb24iLCAiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInBhcmFtcyIsICJib2R5Iik7CgkJICAgIGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgia2luZCIsICJkZWNsYXJhdGlvbnMiKQoJCSAgICAgICAgLmZpZWxkKCJraW5kIiwgb3IoInZhciIsICJsZXQiLCAiY29uc3QiKSkKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb25zIiwgW2RlZigiVmFyaWFibGVEZWNsYXJhdG9yIildKTsKCQkgICAgZGVmKCJWYXJpYWJsZURlY2xhcmF0b3IiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiaW5pdCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoImluaXQiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkV4cHJlc3Npb24iKS5iYXNlcygiTm9kZSIpOwoJCSAgICBkZWYoIlRoaXNFeHByZXNzaW9uIikuYmFzZXMoIkV4cHJlc3Npb24iKS5idWlsZCgpOwoJCSAgICBkZWYoIkFycmF5RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJlbGVtZW50cyIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRzIiwgW29yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKV0pOwoJCSAgICBkZWYoIk9iamVjdEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgicHJvcGVydGllcyIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbZGVmKCJQcm9wZXJ0eSIpXSk7CgkJICAgIC8vIFRPRE8gTm90IGluIHRoZSBNb3ppbGxhIFBhcnNlciBBUEksIGJ1dCB1c2VkIGJ5IEVzcHJpbWEuCgkJICAgIGRlZigiUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikgLy8gV2FudCB0byBiZSBhYmxlIHRvIHZpc2l0IFByb3BlcnR5IE5vZGVzLgoJCSAgICAgICAgLmJ1aWxkKCJraW5kIiwgImtleSIsICJ2YWx1ZSIpCgkJICAgICAgICAuZmllbGQoImtpbmQiLCBvcigiaW5pdCIsICJnZXQiLCAic2V0IikpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSkpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIlNlcXVlbmNlRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9ucyIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb25zIiwgW2RlZigiRXhwcmVzc2lvbiIpXSk7CgkJICAgIHZhciBVbmFyeU9wZXJhdG9yID0gb3IoIi0iLCAiKyIsICIhIiwgIn4iLCAidHlwZW9mIiwgInZvaWQiLCAiZGVsZXRlIik7CgkJICAgIGRlZigiVW5hcnlFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoIm9wZXJhdG9yIiwgImFyZ3VtZW50IiwgInByZWZpeCIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgVW5hcnlPcGVyYXRvcikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC8vIEVzcHJpbWEgZG9lc24ndCBib3RoZXIgd2l0aCB0aGlzIGZpZWxkLCBwcmVzdW1hYmx5IGJlY2F1c2UgaXQncwoJCSAgICAgICAgLy8gYWx3YXlzIHRydWUgZm9yIHVuYXJ5IG9wZXJhdG9ycy4KCQkgICAgICAgIC5maWVsZCgicHJlZml4IiwgQm9vbGVhbiwgZGVmYXVsdHNbInRydWUiXSk7CgkJICAgIHZhciBCaW5hcnlPcGVyYXRvciA9IG9yLmFwcGx5KHZvaWQgMCwgY29yZV9vcGVyYXRvcnNfMS5CaW5hcnlPcGVyYXRvcnMpOwoJCSAgICBkZWYoIkJpbmFyeUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlcmF0b3IiLCAibGVmdCIsICJyaWdodCIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgQmluYXJ5T3BlcmF0b3IpCgkJICAgICAgICAuZmllbGQoImxlZnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgicmlnaHQiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIHZhciBBc3NpZ25tZW50T3BlcmF0b3IgPSBvci5hcHBseSh2b2lkIDAsIGNvcmVfb3BlcmF0b3JzXzEuQXNzaWdubWVudE9wZXJhdG9ycyk7CgkJICAgIGRlZigiQXNzaWdubWVudEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlcmF0b3IiLCAibGVmdCIsICJyaWdodCIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgQXNzaWdubWVudE9wZXJhdG9yKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0Iiwgb3IoZGVmKCJQYXR0ZXJuIiksIGRlZigiTWVtYmVyRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgicmlnaHQiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIHZhciBVcGRhdGVPcGVyYXRvciA9IG9yKCIrKyIsICItLSIpOwoJCSAgICBkZWYoIlVwZGF0ZUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlcmF0b3IiLCAiYXJndW1lbnQiLCAicHJlZml4IikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBVcGRhdGVPcGVyYXRvcikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgicHJlZml4IiwgQm9vbGVhbik7CgkJICAgIHZhciBMb2dpY2FsT3BlcmF0b3IgPSBvci5hcHBseSh2b2lkIDAsIGNvcmVfb3BlcmF0b3JzXzEuTG9naWNhbE9wZXJhdG9ycyk7CgkJICAgIGRlZigiTG9naWNhbEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlcmF0b3IiLCAibGVmdCIsICJyaWdodCIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgTG9naWNhbE9wZXJhdG9yKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJ0ZXN0IiwgImNvbnNlcXVlbnQiLCAiYWx0ZXJuYXRlIikKCQkgICAgICAgIC5maWVsZCgidGVzdCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJjb25zZXF1ZW50IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImFsdGVybmF0ZSIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJOZXdFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImNhbGxlZSIsICJhcmd1bWVudHMiKQoJCSAgICAgICAgLmZpZWxkKCJjYWxsZWUiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC8vIFRoZSBNb3ppbGxhIFBhcnNlciBBUEkgZ2l2ZXMgdGhpcyB0eXBlIGFzIFtvcihkZWYoIkV4cHJlc3Npb24iKSwKCQkgICAgICAgIC8vIG51bGwpXSwgYnV0IG51bGwgdmFsdWVzIGRvbid0IHJlYWxseSBtYWtlIHNlbnNlIGF0IHRoZSBjYWxsIHNpdGUuCgkJICAgICAgICAvLyBUT0RPIFJlcG9ydCB0aGlzIG5vbnNlbnNlLgoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudHMiLCBbZGVmKCJFeHByZXNzaW9uIildKTsKCQkgICAgZGVmKCJDYWxsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJjYWxsZWUiLCAiYXJndW1lbnRzIikKCQkgICAgICAgIC5maWVsZCgiY2FsbGVlIiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAvLyBTZWUgY29tbWVudCBmb3IgTmV3RXhwcmVzc2lvbiBhYm92ZS4KCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnRzIiwgW2RlZigiRXhwcmVzc2lvbiIpXSk7CgkJICAgIGRlZigiTWVtYmVyRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3QiLCAicHJvcGVydHkiLCAiY29tcHV0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJvYmplY3QiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgicHJvcGVydHkiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciB0eXBlID0gdGhpcy5wcm9wZXJ0eS50eXBlOwoJCSAgICAgICAgaWYgKHR5cGUgPT09ICdMaXRlcmFsJyB8fAoJCSAgICAgICAgICAgIHR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJyB8fAoJCSAgICAgICAgICAgIHR5cGUgPT09ICdCaW5hcnlFeHByZXNzaW9uJykgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9KTsKCQkgICAgZGVmKCJQYXR0ZXJuIikuYmFzZXMoIk5vZGUiKTsKCQkgICAgZGVmKCJTd2l0Y2hDYXNlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInRlc3QiLCAiY29uc2VxdWVudCIpCgkJICAgICAgICAuZmllbGQoInRlc3QiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoImNvbnNlcXVlbnQiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pOwoJCSAgICBkZWYoIklkZW50aWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIiwgIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIikKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIFN0cmluZykKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiTGl0ZXJhbCIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoU3RyaW5nLCBCb29sZWFuLCBudWxsLCBOdW1iZXIsIFJlZ0V4cCkpCgkJICAgICAgICAuZmllbGQoInJlZ2V4Iiwgb3IoewoJCSAgICAgICAgcGF0dGVybjogU3RyaW5nLAoJCSAgICAgICAgZmxhZ3M6IFN0cmluZwoJCSAgICB9LCBudWxsKSwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgaWYgKHRoaXMudmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApIHsKCQkgICAgICAgICAgICB2YXIgZmxhZ3MgPSAiIjsKCQkgICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5pZ25vcmVDYXNlKQoJCSAgICAgICAgICAgICAgICBmbGFncyArPSAiaSI7CgkJICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUubXVsdGlsaW5lKQoJCSAgICAgICAgICAgICAgICBmbGFncyArPSAibSI7CgkJICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUuZ2xvYmFsKQoJCSAgICAgICAgICAgICAgICBmbGFncyArPSAiZyI7CgkJICAgICAgICAgICAgcmV0dXJuIHsKCQkgICAgICAgICAgICAgICAgcGF0dGVybjogdGhpcy52YWx1ZS5zb3VyY2UsCgkJICAgICAgICAgICAgICAgIGZsYWdzOiBmbGFncwoJCSAgICAgICAgICAgIH07CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gbnVsbDsKCQkgICAgfSk7CgkJICAgIC8vIEFic3RyYWN0IChub24tYnVpbGRhYmxlKSBjb21tZW50IHN1cGVydHlwZS4gTm90IGEgTm9kZS4KCQkgICAgZGVmKCJDb21tZW50IikKCQkgICAgICAgIC5iYXNlcygiUHJpbnRhYmxlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcpCgkJICAgICAgICAvLyBBIC5sZWFkaW5nIGNvbW1lbnQgY29tZXMgYmVmb3JlIHRoZSBub2RlLCB3aGVyZWFzIGEgLnRyYWlsaW5nCgkJICAgICAgICAvLyBjb21tZW50IGNvbWVzIGFmdGVyIGl0LiBUaGVzZSB0d28gZmllbGRzIHNob3VsZCBub3QgYm90aCBiZSB0cnVlLAoJCSAgICAgICAgLy8gYnV0IHRoZXkgbWlnaHQgYm90aCBiZSBmYWxzZSB3aGVuIHRoZSBjb21tZW50IGZhbGxzIGluc2lkZSBhIG5vZGUKCQkgICAgICAgIC8vIGFuZCB0aGUgbm9kZSBoYXMgbm8gY2hpbGRyZW4gZm9yIHRoZSBjb21tZW50IHRvIGxlYWQgb3IgdHJhaWwsCgkJICAgICAgICAvLyBlLmcuIHsgLypkYW5nbGluZyovIH0uCgkJICAgICAgICAuZmllbGQoImxlYWRpbmciLCBCb29sZWFuLCBkZWZhdWx0c1sidHJ1ZSJdKQoJCSAgICAgICAgLmZpZWxkKCJ0cmFpbGluZyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGNvcmUsIGNvcmUuZXhwb3J0cykpOwoJcmV0dXJuIGNvcmUuZXhwb3J0czsKfQoKdmFyIGVzNiA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRFczY7CgpmdW5jdGlvbiByZXF1aXJlRXM2ICgpIHsKCWlmIChoYXNSZXF1aXJlZEVzNikgcmV0dXJuIGVzNi5leHBvcnRzOwoJaGFzUmVxdWlyZWRFczYgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgY29yZV8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUNvcmUoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShjb3JlXzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIGRlZigiRnVuY3Rpb24iKQoJCSAgICAgICAgLmZpZWxkKCJnZW5lcmF0b3IiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJkZWZhdWx0cyIsIFtvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCldLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLy8gTGVnYWN5CgkJICAgICAgICAuZmllbGQoInJlc3QiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICAvLyBUaGUgRVNUcmVlIHdheSBvZiByZXByZXNlbnRpbmcgYSAuLi5yZXN0IHBhcmFtZXRlci4KCQkgICAgZGVmKCJSZXN0RWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgLy8gZm9yIEJhYnlsb24uIEZsb3cgcGFyc2VyIHB1dHMgaXQgb24gdGhlIGlkZW50aWZpZXIKCQkgICAgb3IoZGVmKCJUeXBlQW5ub3RhdGlvbiIpLCBkZWYoIlRTVHlwZUFubm90YXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlNwcmVhZEVsZW1lbnRQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIlBhdHRlcm4iKSk7CgkJICAgIGRlZigiRnVuY3Rpb25EZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInBhcmFtcyIsICJib2R5IiwgImdlbmVyYXRvciIsICJleHByZXNzaW9uIikKCQkgICAgICAgIC8vIE1heSBiZSBgbnVsbGAgaW4gdGhlIGNvbnRleHQgb2YgYGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgpIHt9YAoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSk7CgkJICAgIGRlZigiRnVuY3Rpb25FeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAicGFyYW1zIiwgImJvZHkiLCAiZ2VuZXJhdG9yIiwgImV4cHJlc3Npb24iKTsKCQkgICAgZGVmKCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkZ1bmN0aW9uIiwgIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJwYXJhbXMiLCAiYm9keSIsICJleHByZXNzaW9uIikKCQkgICAgICAgIC8vIFRoZSBmb3JjZWQgbnVsbCB2YWx1ZSBoZXJlIGlzIGNvbXBhdGlibGUgd2l0aCB0aGUgb3ZlcnJpZGRlbgoJCSAgICAgICAgLy8gZGVmaW5pdGlvbiBvZiB0aGUgImlkIiBmaWVsZCBpbiB0aGUgRnVuY3Rpb24gaW50ZXJmYWNlLgoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG51bGwsIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAvLyBBcnJvdyBmdW5jdGlvbiBib2RpZXMgYXJlIGFsbG93ZWQgdG8gYmUgZXhwcmVzc2lvbnMuCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBvcihkZWYoIkJsb2NrU3RhdGVtZW50IiksIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC8vIFRoZSBjdXJyZW50IHNwZWMgZm9yYmlkcyBhcnJvdyBnZW5lcmF0b3JzLCBzbyBJIGhhdmUgdGFrZW4gdGhlCgkJICAgICAgICAvLyBsaWJlcnR5IG9mIGVuZm9yY2luZyB0aGF0LiBUT0RPIFJlcG9ydCB0aGlzLgoJCSAgICAgICAgLmZpZWxkKCJnZW5lcmF0b3IiLCBmYWxzZSwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIkZvck9mU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgibGVmdCIsICJyaWdodCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIG9yKGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpLCBkZWYoIlBhdHRlcm4iKSkpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJZaWVsZEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiLCAiZGVsZWdhdGUiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgiZGVsZWdhdGUiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiR2VuZXJhdG9yRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IiwgImJsb2NrcyIsICJmaWx0ZXIiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJsb2NrcyIsIFtkZWYoIkNvbXByZWhlbnNpb25CbG9jayIpXSkKCQkgICAgICAgIC5maWVsZCgiZmlsdGVyIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKTsKCQkgICAgZGVmKCJDb21wcmVoZW5zaW9uRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IiwgImJsb2NrcyIsICJmaWx0ZXIiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJsb2NrcyIsIFtkZWYoIkNvbXByZWhlbnNpb25CbG9jayIpXSkKCQkgICAgICAgIC5maWVsZCgiZmlsdGVyIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKTsKCQkgICAgZGVmKCJDb21wcmVoZW5zaW9uQmxvY2siKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgibGVmdCIsICJyaWdodCIsICJlYWNoIikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIGRlZigiUGF0dGVybiIpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJlYWNoIiwgQm9vbGVhbik7CgkJICAgIGRlZigiUHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBvcihkZWYoIkxpdGVyYWwiKSwgZGVmKCJJZGVudGlmaWVyIiksIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgZGVmKCJQYXR0ZXJuIikpKQoJCSAgICAgICAgLmZpZWxkKCJtZXRob2QiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgic2hvcnRoYW5kIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImNvbXB1dGVkIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIk9iamVjdFByb3BlcnR5IikKCQkgICAgICAgIC5maWVsZCgic2hvcnRoYW5kIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIlByb3BlcnR5UGF0dGVybiIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiLCAicGF0dGVybiIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJwYXR0ZXJuIiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoImNvbXB1dGVkIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIk9iamVjdFBhdHRlcm4iKQoJCSAgICAgICAgLmJhc2VzKCJQYXR0ZXJuIikKCQkgICAgICAgIC5idWlsZCgicHJvcGVydGllcyIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbb3IoZGVmKCJQcm9wZXJ0eVBhdHRlcm4iKSwgZGVmKCJQcm9wZXJ0eSIpKV0pOwoJCSAgICBkZWYoIkFycmF5UGF0dGVybiIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJlbGVtZW50cyIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRzIiwgW29yKGRlZigiUGF0dGVybiIpLCBudWxsKV0pOwoJCSAgICBkZWYoIlNwcmVhZEVsZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJBcnJheUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJlbGVtZW50cyIsIFtvcihkZWYoIkV4cHJlc3Npb24iKSwgZGVmKCJTcHJlYWRFbGVtZW50IiksIGRlZigiUmVzdEVsZW1lbnQiKSwgbnVsbCldKTsKCQkgICAgZGVmKCJOZXdFeHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnRzIiwgW29yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIlNwcmVhZEVsZW1lbnQiKSldKTsKCQkgICAgZGVmKCJDYWxsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50cyIsIFtvcihkZWYoIkV4cHJlc3Npb24iKSwgZGVmKCJTcHJlYWRFbGVtZW50IikpXSk7CgkJICAgIC8vIE5vdGU6IHRoaXMgbm9kZSB0eXBlIGlzICpub3QqIGFuIEFzc2lnbm1lbnRFeHByZXNzaW9uIHdpdGggYSBQYXR0ZXJuIG9uCgkJICAgIC8vIHRoZSBsZWZ0LWhhbmQgc2lkZSEgVGhlIGV4aXN0aW5nIEFzc2lnbm1lbnRFeHByZXNzaW9uIHR5cGUgYWxyZWFkeQoJCSAgICAvLyBzdXBwb3J0cyBkZXN0cnVjdHVyaW5nIGFzc2lnbm1lbnRzLiBBc3NpZ25tZW50UGF0dGVybiBub2RlcyBtYXkgYXBwZWFyCgkJICAgIC8vIHdoZXJldmVyIGEgUGF0dGVybiBpcyBhbGxvd2VkLCBhbmQgdGhlIHJpZ2h0LWhhbmQgc2lkZSByZXByZXNlbnRzIGEKCQkgICAgLy8gZGVmYXVsdCB2YWx1ZSB0byBiZSBkZXN0cnVjdHVyZWQgYWdhaW5zdCB0aGUgbGVmdC1oYW5kIHNpZGUsIGlmIG5vCgkJICAgIC8vIHZhbHVlIGlzIG90aGVyd2lzZSBwcm92aWRlZC4gRm9yIGV4YW1wbGU6IGRlZmF1bHQgcGFyYW1ldGVyIHZhbHVlcy4KCQkgICAgZGVmKCJBc3NpZ25tZW50UGF0dGVybiIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJsZWZ0IiwgInJpZ2h0IikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIGRlZigiUGF0dGVybiIpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJNZXRob2REZWZpbml0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJraW5kIiwgImtleSIsICJ2YWx1ZSIsICJzdGF0aWMiKQoJCSAgICAgICAgLmZpZWxkKCJraW5kIiwgb3IoImNvbnN0cnVjdG9yIiwgIm1ldGhvZCIsICJnZXQiLCAic2V0IikpCgkJICAgICAgICAuZmllbGQoImtleSIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRnVuY3Rpb24iKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgic3RhdGljIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICB2YXIgQ2xhc3NCb2R5RWxlbWVudCA9IG9yKGRlZigiTWV0aG9kRGVmaW5pdGlvbiIpLCBkZWYoIlZhcmlhYmxlRGVjbGFyYXRvciIpLCBkZWYoIkNsYXNzUHJvcGVydHlEZWZpbml0aW9uIiksIGRlZigiQ2xhc3NQcm9wZXJ0eSIpKTsKCQkgICAgZGVmKCJDbGFzc1Byb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBvcihkZWYoIkxpdGVyYWwiKSwgZGVmKCJJZGVudGlmaWVyIiksIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiQ2xhc3NQcm9wZXJ0eURlZmluaXRpb24iKSAvLyBzdGF0aWMgcHJvcGVydHkKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJkZWZpbml0aW9uIikKCQkgICAgICAgIC8vIFllcywgVmlyZ2luaWEsIGNpcmN1bGFyIGRlZmluaXRpb25zIGFyZSBwZXJtaXR0ZWQuCgkJICAgICAgICAuZmllbGQoImRlZmluaXRpb24iLCBDbGFzc0JvZHlFbGVtZW50KTsKCQkgICAgZGVmKCJDbGFzc0JvZHkiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW0NsYXNzQm9keUVsZW1lbnRdKTsKCQkgICAgZGVmKCJDbGFzc0RlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IiwgInN1cGVyQ2xhc3MiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQ2xhc3NCb2R5IikpCgkJICAgICAgICAuZmllbGQoInN1cGVyQ2xhc3MiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNsYXNzRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IiwgInN1cGVyQ2xhc3MiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQ2xhc3NCb2R5IikpCgkJICAgICAgICAuZmllbGQoInN1cGVyQ2xhc3MiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlN1cGVyIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgLy8gU3BlY2lmaWVyIGFuZCBNb2R1bGVTcGVjaWZpZXIgYXJlIGFic3RyYWN0IG5vbi1zdGFuZGFyZCB0eXBlcwoJCSAgICAvLyBpbnRyb2R1Y2VkIGZvciBkZWZpbml0aW9uYWwgY29udmVuaWVuY2UuCgkJICAgIGRlZigiU3BlY2lmaWVyIikuYmFzZXMoIk5vZGUiKTsKCQkgICAgLy8gVGhpcyBzdXBlcnR5cGUgaXMgc2hhcmVkL2FidXNlZCBieSBib3RoIGRlZi9iYWJlbC5qcyBhbmQKCQkgICAgLy8gZGVmL2VzcHJpbWEuanMuIEluIHRoZSBmdXR1cmUsIGl0IHdpbGwgYmUgcG9zc2libGUgdG8gbG9hZCBvbmx5IG9uZSBzZXQKCQkgICAgLy8gb2YgZGVmaW5pdGlvbnMgYXBwcm9wcmlhdGUgZm9yIGEgZ2l2ZW4gcGFyc2VyLCBidXQgdW50aWwgdGhlbiB3ZSBtdXN0CgkJICAgIC8vIHJlbHkgb24gZGVmYXVsdCBmdW5jdGlvbnMgdG8gcmVjb25jaWxlIHRoZSBjb25mbGljdGluZyBBU1QgZm9ybWF0cy4KCQkgICAgZGVmKCJNb2R1bGVTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJTcGVjaWZpZXIiKQoJCSAgICAgICAgLy8gVGhpcyBsb2NhbCBmaWVsZCBpcyB1c2VkIGJ5IEJhYmVsL0Fjb3JuLiBJdCBzaG91bGQgbm90IHRlY2huaWNhbGx5CgkJICAgICAgICAvLyBiZSBvcHRpb25hbCBpbiB0aGUgQmFiZWwvQWNvcm4gQVNUIGZvcm1hdCwgYnV0IGl0IG11c3QgYmUgb3B0aW9uYWwKCQkgICAgICAgIC8vIGluIHRoZSBFc3ByaW1hIEFTVCBmb3JtYXQuCgkJICAgICAgICAuZmllbGQoImxvY2FsIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLy8gVGhlIGlkIGFuZCBuYW1lIGZpZWxkcyBhcmUgdXNlZCBieSBFc3ByaW1hLiBUaGUgaWQgZmllbGQgc2hvdWxkIG5vdAoJCSAgICAgICAgLy8gdGVjaG5pY2FsbHkgYmUgb3B0aW9uYWwgaW4gdGhlIEVzcHJpbWEgQVNUIGZvcm1hdCwgYnV0IGl0IG11c3QgYmUKCQkgICAgICAgIC8vIG9wdGlvbmFsIGluIHRoZSBCYWJlbC9BY29ybiBBU1QgZm9ybWF0LgoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIGltcG9ydCB7PGlkIFthcyBuYW1lXT59IGZyb20gLi4uOwoJCSAgICBkZWYoIkltcG9ydFNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoImltcG9ydGVkIiwgImxvY2FsIikKCQkgICAgICAgIC5maWVsZCgiaW1wb3J0ZWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIC8vIGltcG9ydCA8aWQ+IGZyb20gLi4uOwoJCSAgICBkZWYoIkltcG9ydERlZmF1bHRTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJNb2R1bGVTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJsb2NhbCIpOwoJCSAgICAvLyBpbXBvcnQgPCogYXMgaWQ+IGZyb20gLi4uOwoJCSAgICBkZWYoIkltcG9ydE5hbWVzcGFjZVNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoImxvY2FsIik7CgkJICAgIGRlZigiSW1wb3J0RGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoInNwZWNpZmllcnMiLCAic291cmNlIiwgImltcG9ydEtpbmQiKQoJCSAgICAgICAgLmZpZWxkKCJzcGVjaWZpZXJzIiwgW29yKGRlZigiSW1wb3J0U3BlY2lmaWVyIiksIGRlZigiSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyIiksIGRlZigiSW1wb3J0RGVmYXVsdFNwZWNpZmllciIpKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIGRlZigiTGl0ZXJhbCIpKQoJCSAgICAgICAgLmZpZWxkKCJpbXBvcnRLaW5kIiwgb3IoInZhbHVlIiwgInR5cGUiKSwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuICJ2YWx1ZSI7CgkJICAgIH0pOwoJCSAgICBkZWYoIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImRlY2xhcmF0aW9uIiwgInNwZWNpZmllcnMiLCAic291cmNlIikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb24iLCBvcihkZWYoIkRlY2xhcmF0aW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJzcGVjaWZpZXJzIiwgW2RlZigiRXhwb3J0U3BlY2lmaWVyIildLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBvcihkZWYoIkxpdGVyYWwiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkV4cG9ydFNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoImxvY2FsIiwgImV4cG9ydGVkIikKCQkgICAgICAgIC5maWVsZCgiZXhwb3J0ZWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJkZWNsYXJhdGlvbiIpCgkJICAgICAgICAuZmllbGQoImRlY2xhcmF0aW9uIiwgb3IoZGVmKCJEZWNsYXJhdGlvbiIpLCBkZWYoIkV4cHJlc3Npb24iKSkpOwoJCSAgICBkZWYoIkV4cG9ydEFsbERlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBkZWYoIkxpdGVyYWwiKSk7CgkJICAgIGRlZigiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInRhZyIsICJxdWFzaSIpCgkJICAgICAgICAuZmllbGQoInRhZyIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJxdWFzaSIsIGRlZigiVGVtcGxhdGVMaXRlcmFsIikpOwoJCSAgICBkZWYoIlRlbXBsYXRlTGl0ZXJhbCIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJxdWFzaXMiLCAiZXhwcmVzc2lvbnMiKQoJCSAgICAgICAgLmZpZWxkKCJxdWFzaXMiLCBbZGVmKCJUZW1wbGF0ZUVsZW1lbnQiKV0pCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb25zIiwgW2RlZigiRXhwcmVzc2lvbiIpXSk7CgkJICAgIGRlZigiVGVtcGxhdGVFbGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInRhaWwiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIHsgImNvb2tlZCI6IFN0cmluZywgInJhdyI6IFN0cmluZyB9KQoJCSAgICAgICAgLmZpZWxkKCJ0YWlsIiwgQm9vbGVhbik7CgkJICAgIGRlZigiTWV0YVByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoIm1ldGEiLCAicHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJtZXRhIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoInByb3BlcnR5IiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZXM2LCBlczYuZXhwb3J0cykpOwoJcmV0dXJuIGVzNi5leHBvcnRzOwp9Cgp2YXIgZXMyMDE2ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVzMjAxNjsKCmZ1bmN0aW9uIHJlcXVpcmVFczIwMTYgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXMyMDE2KSByZXR1cm4gZXMyMDE2LmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzMjAxNiA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBjb3JlX29wZXJhdG9yc18xID0gcmVxdWlyZUNvcmVPcGVyYXRvcnMoKTsKCQl2YXIgZXM2XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXM2KCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzNl8xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIHZhciBCaW5hcnlPcGVyYXRvciA9IG9yLmFwcGx5KHZvaWQgMCwgdHNsaWJfMS5fX3NwcmVhZEFycmF5cyhjb3JlX29wZXJhdG9yc18xLkJpbmFyeU9wZXJhdG9ycywgWyIqKiJdKSk7CgkJICAgIGRlZigiQmluYXJ5RXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgQmluYXJ5T3BlcmF0b3IpOwoJCSAgICB2YXIgQXNzaWdubWVudE9wZXJhdG9yID0gb3IuYXBwbHkodm9pZCAwLCB0c2xpYl8xLl9fc3ByZWFkQXJyYXlzKGNvcmVfb3BlcmF0b3JzXzEuQXNzaWdubWVudE9wZXJhdG9ycywgWyIqKj0iXSkpOwoJCSAgICBkZWYoIkFzc2lnbm1lbnRFeHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBBc3NpZ25tZW50T3BlcmF0b3IpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZXMyMDE2LCBlczIwMTYuZXhwb3J0cykpOwoJcmV0dXJuIGVzMjAxNi5leHBvcnRzOwp9Cgp2YXIgZXMyMDE3ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVzMjAxNzsKCmZ1bmN0aW9uIHJlcXVpcmVFczIwMTcgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXMyMDE3KSByZXR1cm4gZXMyMDE3LmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzMjAxNyA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBlczIwMTZfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTYoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlczIwMTZfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgZGVmKCJGdW5jdGlvbiIpCgkJICAgICAgICAuZmllbGQoImFzeW5jIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIkF3YWl0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZXMyMDE3LCBlczIwMTcuZXhwb3J0cykpOwoJcmV0dXJuIGVzMjAxNy5leHBvcnRzOwp9Cgp2YXIgZXMyMDE4ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVzMjAxODsKCmZ1bmN0aW9uIHJlcXVpcmVFczIwMTggKCkgewoJaWYgKGhhc1JlcXVpcmVkRXMyMDE4KSByZXR1cm4gZXMyMDE4LmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzMjAxOCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBlczIwMTdfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTcoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlczIwMTdfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgZGVmKCJGb3JPZlN0YXRlbWVudCIpCgkJICAgICAgICAuZmllbGQoImF3YWl0IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICAvLyBMZWdhY3kKCQkgICAgZGVmKCJTcHJlYWRQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIk9iamVjdEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0aWVzIiwgW29yKGRlZigiUHJvcGVydHkiKSwgZGVmKCJTcHJlYWRQcm9wZXJ0eSIpLCAvLyBMZWdhY3kKCQkgICAgICAgIGRlZigiU3ByZWFkRWxlbWVudCIpKV0pOwoJCSAgICBkZWYoIlRlbXBsYXRlRWxlbWVudCIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgeyAiY29va2VkIjogb3IoU3RyaW5nLCBudWxsKSwgInJhdyI6IFN0cmluZyB9KTsKCQkgICAgLy8gTGVnYWN5CgkJICAgIGRlZigiU3ByZWFkUHJvcGVydHlQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIlBhdHRlcm4iKSk7CgkJICAgIGRlZigiT2JqZWN0UGF0dGVybiIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbb3IoZGVmKCJQcm9wZXJ0eVBhdHRlcm4iKSwgZGVmKCJQcm9wZXJ0eSIpLCBkZWYoIlJlc3RFbGVtZW50IiksIGRlZigiU3ByZWFkUHJvcGVydHlQYXR0ZXJuIikpXSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczIwMTgsIGVzMjAxOC5leHBvcnRzKSk7CglyZXR1cm4gZXMyMDE4LmV4cG9ydHM7Cn0KCnZhciBlczIwMTkgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXMyMDE5OwoKZnVuY3Rpb24gcmVxdWlyZUVzMjAxOSAoKSB7CglpZiAoaGFzUmVxdWlyZWRFczIwMTkpIHJldHVybiBlczIwMTkuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXMyMDE5ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzMjAxOF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAxOCgpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzMjAxOF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICBkZWYoIkNhdGNoQ2xhdXNlIikKCQkgICAgICAgIC5maWVsZCgicGFyYW0iLCBvcihkZWYoIlBhdHRlcm4iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZXMyMDE5LCBlczIwMTkuZXhwb3J0cykpOwoJcmV0dXJuIGVzMjAxOS5leHBvcnRzOwp9Cgp2YXIgZXMyMDIwID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVzMjAyMDsKCmZ1bmN0aW9uIHJlcXVpcmVFczIwMjAgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXMyMDIwKSByZXR1cm4gZXMyMDIwLmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzMjAyMCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBjb3JlX29wZXJhdG9yc18xID0gcmVxdWlyZUNvcmVPcGVyYXRvcnMoKTsKCQl2YXIgZXMyMDE5XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDE5KCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXMyMDE5XzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIHNoYXJlZCA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBzaGFyZWQuZGVmYXVsdHM7CgkJICAgIGRlZigiSW1wb3J0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiRXhwb3J0QWxsRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJzb3VyY2UiLCAiZXhwb3J0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBkZWYoIkxpdGVyYWwiKSkKCQkgICAgICAgIC5maWVsZCgiZXhwb3J0ZWQiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCkpOwoJCSAgICAvLyBPcHRpb25hbCBjaGFpbmluZwoJCSAgICBkZWYoIkNoYWluRWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJDYWxsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iLCAiQ2hhaW5FbGVtZW50Iik7CgkJICAgIGRlZigiTWVtYmVyRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iLCAiQ2hhaW5FbGVtZW50Iik7CgkJICAgIGRlZigiQ2hhaW5FeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJDaGFpbkVsZW1lbnQiKSk7CgkJICAgIGRlZigiT3B0aW9uYWxDYWxsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkNhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiY2FsbGVlIiwgImFyZ3VtZW50cyIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbiwgZGVmYXVsdHNbInRydWUiXSk7CgkJICAgIC8vIERlcHJlY2F0ZWQgb3B0aW9uYWwgY2hhaW5pbmcgdHlwZSwgZG9lc24ndCB3b3JrIHdpdGggYmFiZWxQYXJzZXJANy4xMS4wIG9yIG5ld2VyCgkJICAgIGRlZigiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiTWVtYmVyRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoIm9iamVjdCIsICJwcm9wZXJ0eSIsICJjb21wdXRlZCIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbiwgZGVmYXVsdHNbInRydWUiXSk7CgkJICAgIC8vIE51bGxpc2ggY29hbGVzY2luZwoJCSAgICB2YXIgTG9naWNhbE9wZXJhdG9yID0gb3IuYXBwbHkodm9pZCAwLCB0c2xpYl8xLl9fc3ByZWFkQXJyYXlzKGNvcmVfb3BlcmF0b3JzXzEuTG9naWNhbE9wZXJhdG9ycywgWyI/PyJdKSk7CgkJICAgIGRlZigiTG9naWNhbEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJvcGVyYXRvciIsIExvZ2ljYWxPcGVyYXRvcik7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczIwMjAsIGVzMjAyMC5leHBvcnRzKSk7CglyZXR1cm4gZXMyMDIwLmV4cG9ydHM7Cn0KCnZhciBqc3ggPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkSnN4OwoKZnVuY3Rpb24gcmVxdWlyZUpzeCAoKSB7CglpZiAoaGFzUmVxdWlyZWRKc3gpIHJldHVybiBqc3guZXhwb3J0czsKCWhhc1JlcXVpcmVkSnN4ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzMjAyMF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAyMCgpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzMjAyMF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICBkZWYoIkpTWEF0dHJpYnV0ZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIiwgInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIG9yKGRlZigiSlNYSWRlbnRpZmllciIpLCBkZWYoIkpTWE5hbWVzcGFjZWROYW1lIikpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG9yKGRlZigiTGl0ZXJhbCIpLCAvLyBhdHRyPSJ2YWx1ZSIKCQkgICAgZGVmKCJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiksIC8vIGF0dHI9e3ZhbHVlfQoJCSAgICBkZWYoIkpTWEVsZW1lbnQiKSwgLy8gYXR0cj08ZGl2IC8+CgkJICAgIGRlZigiSlNYRnJhZ21lbnQiKSwgLy8gYXR0cj08PjwvPgoJCSAgICBudWxsIC8vIGF0dHI9IG9yIGp1c3QgYXR0cgoJCSAgICApLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJKU1hJZGVudGlmaWVyIikKCQkgICAgICAgIC5iYXNlcygiSWRlbnRpZmllciIpCgkJICAgICAgICAuYnVpbGQoIm5hbWUiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgU3RyaW5nKTsKCQkgICAgZGVmKCJKU1hOYW1lc3BhY2VkTmFtZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lc3BhY2UiLCAibmFtZSIpCgkJICAgICAgICAuZmllbGQoIm5hbWVzcGFjZSIsIGRlZigiSlNYSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgZGVmKCJKU1hJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIkpTWE1lbWJlckV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJNZW1iZXJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib2JqZWN0IiwgInByb3BlcnR5IikKCQkgICAgICAgIC5maWVsZCgib2JqZWN0Iiwgb3IoZGVmKCJKU1hJZGVudGlmaWVyIiksIGRlZigiSlNYTWVtYmVyRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgicHJvcGVydHkiLCBkZWYoIkpTWElkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0cy5mYWxzZSk7CgkJICAgIHZhciBKU1hFbGVtZW50TmFtZSA9IG9yKGRlZigiSlNYSWRlbnRpZmllciIpLCBkZWYoIkpTWE5hbWVzcGFjZWROYW1lIiksIGRlZigiSlNYTWVtYmVyRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJKU1hTcHJlYWRBdHRyaWJ1dGUiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgdmFyIEpTWEF0dHJpYnV0ZXMgPSBbb3IoZGVmKCJKU1hBdHRyaWJ1dGUiKSwgZGVmKCJKU1hTcHJlYWRBdHRyaWJ1dGUiKSldOwoJCSAgICBkZWYoIkpTWEV4cHJlc3Npb25Db250YWluZXIiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgZGVmKCJKU1hFbXB0eUV4cHJlc3Npb24iKSkpOwoJCSAgICB2YXIgSlNYQ2hpbGRyZW4gPSBbb3IoZGVmKCJKU1hUZXh0IiksIGRlZigiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIpLCBkZWYoIkpTWFNwcmVhZENoaWxkIiksIGRlZigiSlNYRWxlbWVudCIpLCBkZWYoIkpTWEZyYWdtZW50IiksIGRlZigiTGl0ZXJhbCIpIC8vIExlZ2FjeTogRXNwcmltYSBzaG91bGQgcmV0dXJuIEpTWFRleHQgaW5zdGVhZC4KCQkgICAgICAgICldOwoJCSAgICBkZWYoIkpTWEVsZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlbmluZ0VsZW1lbnQiLCAiY2xvc2luZ0VsZW1lbnQiLCAiY2hpbGRyZW4iKQoJCSAgICAgICAgLmZpZWxkKCJvcGVuaW5nRWxlbWVudCIsIGRlZigiSlNYT3BlbmluZ0VsZW1lbnQiKSkKCQkgICAgICAgIC5maWVsZCgiY2xvc2luZ0VsZW1lbnQiLCBvcihkZWYoIkpTWENsb3NpbmdFbGVtZW50IiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJjaGlsZHJlbiIsIEpTWENoaWxkcmVuLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgSlNYRWxlbWVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIC8vIExpdHRsZS1rbm93biBmYWN0OiB0aGUgYHRoaXNgIG9iamVjdCBpbnNpZGUgYSBkZWZhdWx0IGZ1bmN0aW9uCgkJICAgICAgICAvLyBpcyBub25lIG90aGVyIHRoYW4gdGhlIHBhcnRpYWxseS1idWlsdCBvYmplY3QgaXRzZWxmLCBhbmQgYW55CgkJICAgICAgICAvLyBmaWVsZHMgaW5pdGlhbGl6ZWQgZGlyZWN0bHkgZnJvbSBidWlsZGVyIGZ1bmN0aW9uIGFyZ3VtZW50cwoJCSAgICAgICAgLy8gKGxpa2Ugb3BlbmluZ0VsZW1lbnQsIGNsb3NpbmdFbGVtZW50LCBhbmQgY2hpbGRyZW4pIGFyZQoJCSAgICAgICAgLy8gZ3VhcmFudGVlZCB0byBiZSBhdmFpbGFibGUuCgkJICAgICAgICByZXR1cm4gdGhpcy5vcGVuaW5nRWxlbWVudC5uYW1lOwoJCSAgICB9LCB0cnVlKSAvLyBoaWRkZW4gZnJvbSB0cmF2ZXJzYWwKCQkgICAgICAgIC5maWVsZCgic2VsZkNsb3NpbmciLCBCb29sZWFuLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICByZXR1cm4gdGhpcy5vcGVuaW5nRWxlbWVudC5zZWxmQ2xvc2luZzsKCQkgICAgfSwgdHJ1ZSkgLy8gaGlkZGVuIGZyb20gdHJhdmVyc2FsCgkJICAgICAgICAuZmllbGQoImF0dHJpYnV0ZXMiLCBKU1hBdHRyaWJ1dGVzLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICByZXR1cm4gdGhpcy5vcGVuaW5nRWxlbWVudC5hdHRyaWJ1dGVzOwoJCSAgICB9LCB0cnVlKTsgLy8gaGlkZGVuIGZyb20gdHJhdmVyc2FsCgkJICAgIGRlZigiSlNYT3BlbmluZ0VsZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgibmFtZSIsICJhdHRyaWJ1dGVzIiwgInNlbGZDbG9zaW5nIikKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIEpTWEVsZW1lbnROYW1lKQoJCSAgICAgICAgLmZpZWxkKCJhdHRyaWJ1dGVzIiwgSlNYQXR0cmlidXRlcywgZGVmYXVsdHMuZW1wdHlBcnJheSkKCQkgICAgICAgIC5maWVsZCgic2VsZkNsb3NpbmciLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiSlNYQ2xvc2luZ0VsZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgibmFtZSIpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBKU1hFbGVtZW50TmFtZSk7CgkJICAgIGRlZigiSlNYRnJhZ21lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlbmluZ0ZyYWdtZW50IiwgImNsb3NpbmdGcmFnbWVudCIsICJjaGlsZHJlbiIpCgkJICAgICAgICAuZmllbGQoIm9wZW5pbmdGcmFnbWVudCIsIGRlZigiSlNYT3BlbmluZ0ZyYWdtZW50IikpCgkJICAgICAgICAuZmllbGQoImNsb3NpbmdGcmFnbWVudCIsIGRlZigiSlNYQ2xvc2luZ0ZyYWdtZW50IikpCgkJICAgICAgICAuZmllbGQoImNoaWxkcmVuIiwgSlNYQ2hpbGRyZW4sIGRlZmF1bHRzLmVtcHR5QXJyYXkpOwoJCSAgICBkZWYoIkpTWE9wZW5pbmdGcmFnbWVudCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiSlNYQ2xvc2luZ0ZyYWdtZW50IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJKU1hUZXh0IikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInJhdyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJyYXciLCBTdHJpbmcsIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJCSAgICB9KTsKCQkgICAgZGVmKCJKU1hFbXB0eUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkpTWFNwcmVhZENoaWxkIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoanN4LCBqc3guZXhwb3J0cykpOwoJcmV0dXJuIGpzeC5leHBvcnRzOwp9Cgp2YXIgZmxvdyA9IHtleHBvcnRzOiB7fX07Cgp2YXIgZXNQcm9wb3NhbHMgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXNQcm9wb3NhbHM7CgpmdW5jdGlvbiByZXF1aXJlRXNQcm9wb3NhbHMgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXNQcm9wb3NhbHMpIHJldHVybiBlc1Byb3Bvc2Fscy5leHBvcnRzOwoJaGFzUmVxdWlyZWRFc1Byb3Bvc2FscyA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJdmFyIGVzMjAyMF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAyMCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlczIwMjBfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIFR5cGUgPSB0eXBlcy5UeXBlOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IFR5cGUub3I7CgkJICAgIHZhciBzaGFyZWQgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZmF1bHRzID0gc2hhcmVkLmRlZmF1bHRzOwoJCSAgICBkZWYoIkF3YWl0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IiwgImFsbCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50Iiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJhbGwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIC8vIERlY29yYXRvcnMKCQkgICAgZGVmKCJEZWNvcmF0b3IiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiUHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJkZWNvcmF0b3JzIiwgb3IoW2RlZigiRGVjb3JhdG9yIildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiTWV0aG9kRGVmaW5pdGlvbiIpCgkJICAgICAgICAuZmllbGQoImRlY29yYXRvcnMiLCBvcihbZGVmKCJEZWNvcmF0b3IiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gUHJpdmF0ZSBuYW1lcwoJCSAgICBkZWYoIlByaXZhdGVOYW1lIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIsICJQYXR0ZXJuIikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJDbGFzc1ByaXZhdGVQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIkNsYXNzUHJvcGVydHkiKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiLCAidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBkZWYoIlByaXZhdGVOYW1lIikpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGVzUHJvcG9zYWxzLCBlc1Byb3Bvc2Fscy5leHBvcnRzKSk7CglyZXR1cm4gZXNQcm9wb3NhbHMuZXhwb3J0czsKfQoKdmFyIHR5cGVBbm5vdGF0aW9ucyA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRUeXBlQW5ub3RhdGlvbnM7CgpmdW5jdGlvbiByZXF1aXJlVHlwZUFubm90YXRpb25zICgpIHsKCWlmIChoYXNSZXF1aXJlZFR5cGVBbm5vdGF0aW9ucykgcmV0dXJuIHR5cGVBbm5vdGF0aW9ucy5leHBvcnRzOwoJaGFzUmVxdWlyZWRUeXBlQW5ub3RhdGlvbnMgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQkvKioKCQkgKiBUeXBlIGFubm90YXRpb24gZGVmcyBzaGFyZWQgYmV0d2VlbiBGbG93IGFuZCBUeXBlU2NyaXB0LgoJCSAqIFRoZXNlIGRlZnMgY291bGQgbm90IGJlIGRlZmluZWQgaW4gLi9mbG93LnRzIG9yIC4vdHlwZXNjcmlwdC50cyBkaXJlY3RseQoJCSAqIGJlY2F1c2UgdGhleSB1c2UgdGhlIHNhbWUgbmFtZS4KCQkgKi8KCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIHZhciBUeXBlQW5ub3RhdGlvbiA9IG9yKGRlZigiVHlwZUFubm90YXRpb24iKSwgZGVmKCJUU1R5cGVBbm5vdGF0aW9uIiksIG51bGwpOwoJCSAgICB2YXIgVHlwZVBhcmFtRGVjbCA9IG9yKGRlZigiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIiksIGRlZigiVFNUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKSwgbnVsbCk7CgkJICAgIGRlZigiSWRlbnRpZmllciIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgVHlwZUFubm90YXRpb24sIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIk9iamVjdFBhdHRlcm4iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIFR5cGVBbm5vdGF0aW9uLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJGdW5jdGlvbiIpCgkJICAgICAgICAuZmllbGQoInJldHVyblR5cGUiLCBUeXBlQW5ub3RhdGlvbiwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBUeXBlUGFyYW1EZWNsLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJDbGFzc1Byb3BlcnR5IikKCQkgICAgICAgIC5idWlsZCgia2V5IiwgInZhbHVlIiwgInR5cGVBbm5vdGF0aW9uIiwgInN0YXRpYyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBUeXBlQW5ub3RhdGlvbiwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIFsiQ2xhc3NEZWNsYXJhdGlvbiIsCgkJICAgICAgICAiQ2xhc3NFeHByZXNzaW9uIiwKCQkgICAgXS5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlTmFtZSkgewoJCSAgICAgICAgZGVmKHR5cGVOYW1lKQoJCSAgICAgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBUeXBlUGFyYW1EZWNsLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgICAgIC5maWVsZCgic3VwZXJUeXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSwgZGVmKCJUU1R5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgICAgIC5maWVsZCgiaW1wbGVtZW50cyIsIG9yKFtkZWYoIkNsYXNzSW1wbGVtZW50cyIpXSwgW2RlZigiVFNFeHByZXNzaW9uV2l0aFR5cGVBcmd1bWVudHMiKV0pLCBkZWZhdWx0cy5lbXB0eUFycmF5KTsKCQkgICAgfSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9ICh0eXBlQW5ub3RhdGlvbnMsIHR5cGVBbm5vdGF0aW9ucy5leHBvcnRzKSk7CglyZXR1cm4gdHlwZUFubm90YXRpb25zLmV4cG9ydHM7Cn0KCnZhciBoYXNSZXF1aXJlZEZsb3c7CgpmdW5jdGlvbiByZXF1aXJlRmxvdyAoKSB7CglpZiAoaGFzUmVxdWlyZWRGbG93KSByZXR1cm4gZmxvdy5leHBvcnRzOwoJaGFzUmVxdWlyZWRGbG93ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzX3Byb3Bvc2Fsc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzUHJvcG9zYWxzKCkpOwoJCXZhciB0eXBlX2Fubm90YXRpb25zXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZUFubm90YXRpb25zKCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXNfcHJvcG9zYWxzXzEuZGVmYXVsdCk7CgkJICAgIGZvcmsudXNlKHR5cGVfYW5ub3RhdGlvbnNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgLy8gQmFzZSB0eXBlcwoJCSAgICBkZWYoIkZsb3ciKS5iYXNlcygiTm9kZSIpOwoJCSAgICBkZWYoIkZsb3dUeXBlIikuYmFzZXMoIkZsb3ciKTsKCQkgICAgLy8gVHlwZSBhbm5vdGF0aW9ucwoJCSAgICBkZWYoIkFueVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRW1wdHlUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIk1peGVkVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJWb2lkVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJTeW1ib2xUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIk51bWJlclR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiQmlnSW50VHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJOdW1iZXJMaXRlcmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInJhdyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgTnVtYmVyKQoJCSAgICAgICAgLmZpZWxkKCJyYXciLCBTdHJpbmcpOwoJCSAgICAvLyBCYWJ5bG9uIDYgZGlmZmVycyBpbiBBU1QgZnJvbSBGbG93CgkJICAgIC8vIHNhbWUgYXMgTnVtYmVyTGl0ZXJhbFR5cGVBbm5vdGF0aW9uCgkJICAgIGRlZigiTnVtZXJpY0xpdGVyYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAicmF3IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBOdW1iZXIpCgkJICAgICAgICAuZmllbGQoInJhdyIsIFN0cmluZyk7CgkJICAgIGRlZigiQmlnSW50TGl0ZXJhbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIsICJyYXciKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG51bGwpCgkJICAgICAgICAuZmllbGQoInJhdyIsIFN0cmluZyk7CgkJICAgIGRlZigiU3RyaW5nVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJTdHJpbmdMaXRlcmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInJhdyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJyYXciLCBTdHJpbmcpOwoJCSAgICBkZWYoIkJvb2xlYW5UeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkJvb2xlYW5MaXRlcmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInJhdyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgicmF3IiwgU3RyaW5nKTsKCQkgICAgZGVmKCJUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJOdWxsYWJsZVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJOdWxsTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiTnVsbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiVGhpc1R5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRXhpc3RzVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJFeGlzdGVudGlhbFR5cGVQYXJhbSIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtcyIsICJyZXR1cm5UeXBlIiwgInJlc3QiLCAidHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbXMiLCBbZGVmKCJGdW5jdGlvblR5cGVQYXJhbSIpXSkKCQkgICAgICAgIC5maWVsZCgicmV0dXJuVHlwZSIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgicmVzdCIsIG9yKGRlZigiRnVuY3Rpb25UeXBlUGFyYW0iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKSwgbnVsbCkpOwoJCSAgICBkZWYoIkZ1bmN0aW9uVHlwZVBhcmFtIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoIm5hbWUiLCAidHlwZUFubm90YXRpb24iLCAib3B0aW9uYWwiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJBcnJheVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJlbGVtZW50VHlwZSIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRUeXBlIiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJPYmplY3RUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgicHJvcGVydGllcyIsICJpbmRleGVycyIsICJjYWxsUHJvcGVydGllcyIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbCgkJICAgICAgICBvcihkZWYoIk9iamVjdFR5cGVQcm9wZXJ0eSIpLCBkZWYoIk9iamVjdFR5cGVTcHJlYWRQcm9wZXJ0eSIpKQoJCSAgICBdKQoJCSAgICAgICAgLmZpZWxkKCJpbmRleGVycyIsIFtkZWYoIk9iamVjdFR5cGVJbmRleGVyIildLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJjYWxsUHJvcGVydGllcyIsIFtkZWYoIk9iamVjdFR5cGVDYWxsUHJvcGVydHkiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoImluZXhhY3QiLCBvcihCb29sZWFuLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pCgkJICAgICAgICAuZmllbGQoImV4YWN0IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImludGVybmFsU2xvdHMiLCBbZGVmKCJPYmplY3RUeXBlSW50ZXJuYWxTbG90IildLCBkZWZhdWx0cy5lbXB0eUFycmF5KTsKCQkgICAgZGVmKCJWYXJpYW5jZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJraW5kIikKCQkgICAgICAgIC5maWVsZCgia2luZCIsIG9yKCJwbHVzIiwgIm1pbnVzIikpOwoJCSAgICB2YXIgTGVnYWN5VmFyaWFuY2UgPSBvcihkZWYoIlZhcmlhbmNlIiksICJwbHVzIiwgIm1pbnVzIiwgbnVsbCk7CgkJICAgIGRlZigiT2JqZWN0VHlwZVByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJ2YWx1ZSIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSkpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgZGVmKCJGbG93VHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4pCgkJICAgICAgICAuZmllbGQoInZhcmlhbmNlIiwgTGVnYWN5VmFyaWFuY2UsIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIk9iamVjdFR5cGVJbmRleGVyIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImtleSIsICJ2YWx1ZSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImtleSIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkZsb3dUeXBlIikpCgkJICAgICAgICAuZmllbGQoInZhcmlhbmNlIiwgTGVnYWN5VmFyaWFuY2UsIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoInN0YXRpYyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJPYmplY3RUeXBlQ2FsbFByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iKSkKCQkgICAgICAgIC5maWVsZCgic3RhdGljIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIlF1YWxpZmllZFR5cGVJZGVudGlmaWVyIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInF1YWxpZmljYXRpb24iLCAiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJxdWFsaWZpY2F0aW9uIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiUXVhbGlmaWVkVHlwZUlkZW50aWZpZXIiKSkpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIkdlbmVyaWNUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBkZWYoIlF1YWxpZmllZFR5cGVJZGVudGlmaWVyIikpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSwgbnVsbCkpOwoJCSAgICBkZWYoIk1lbWJlclR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3QiLCAicHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJvYmplY3QiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgicHJvcGVydHkiLCBvcihkZWYoIk1lbWJlclR5cGVBbm5vdGF0aW9uIiksIGRlZigiR2VuZXJpY1R5cGVBbm5vdGF0aW9uIikpKTsKCQkgICAgZGVmKCJVbmlvblR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlcyIpCgkJICAgICAgICAuZmllbGQoInR5cGVzIiwgW2RlZigiRmxvd1R5cGUiKV0pOwoJCSAgICBkZWYoIkludGVyc2VjdGlvblR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlcyIpCgkJICAgICAgICAuZmllbGQoInR5cGVzIiwgW2RlZigiRmxvd1R5cGUiKV0pOwoJCSAgICBkZWYoIlR5cGVvZlR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJPYmplY3RUeXBlU3ByZWFkUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRmxvd1R5cGUiKSk7CgkJICAgIGRlZigiT2JqZWN0VHlwZUludGVybmFsU2xvdCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJ2YWx1ZSIsICJvcHRpb25hbCIsICJzdGF0aWMiLCAibWV0aG9kIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkZsb3dUeXBlIikpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgic3RhdGljIiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgibWV0aG9kIiwgQm9vbGVhbik7CgkJICAgIGRlZigiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtcyIpCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIlR5cGVQYXJhbWV0ZXIiKV0pOwoJCSAgICBkZWYoIlR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtcyIpCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIkZsb3dUeXBlIildKTsKCQkgICAgZGVmKCJUeXBlUGFyYW1ldGVyIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIiwgInZhcmlhbmNlIiwgImJvdW5kIiwgImRlZmF1bHQiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJ2YXJpYW5jZSIsIExlZ2FjeVZhcmlhbmNlLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJib3VuZCIsIG9yKGRlZigiVHlwZUFubm90YXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImRlZmF1bHQiLCBvcihkZWYoIkZsb3dUeXBlIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJDbGFzc1Byb3BlcnR5IikKCQkgICAgICAgIC5maWVsZCgidmFyaWFuY2UiLCBMZWdhY3lWYXJpYW5jZSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQ2xhc3NJbXBsZW1lbnRzIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImlkIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgic3VwZXJDbGFzcyIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBvcihkZWYoIlR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJJbnRlcmZhY2VUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIsICJleHRlbmRzIikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiT2JqZWN0VHlwZUFubm90YXRpb24iKSkKCQkgICAgICAgIC5maWVsZCgiZXh0ZW5kcyIsIG9yKFtkZWYoIkludGVyZmFjZUV4dGVuZHMiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJJbnRlcmZhY2VEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiYm9keSIsICJleHRlbmRzIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBvcihkZWYoIlR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiT2JqZWN0VHlwZUFubm90YXRpb24iKSkKCQkgICAgICAgIC5maWVsZCgiZXh0ZW5kcyIsIFtkZWYoIkludGVyZmFjZUV4dGVuZHMiKV0pOwoJCSAgICBkZWYoIkRlY2xhcmVJbnRlcmZhY2UiKQoJCSAgICAgICAgLmJhc2VzKCJJbnRlcmZhY2VEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImJvZHkiLCAiZXh0ZW5kcyIpOwoJCSAgICBkZWYoIkludGVyZmFjZUV4dGVuZHMiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlR5cGVBbGlhcyIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZVBhcmFtZXRlcnMiLCAicmlnaHQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRmxvd1R5cGUiKSk7CgkJICAgIGRlZigiRGVjbGFyZVR5cGVBbGlhcyIpCgkJICAgICAgICAuYmFzZXMoIlR5cGVBbGlhcyIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInR5cGVQYXJhbWV0ZXJzIiwgInJpZ2h0Iik7CgkJICAgIGRlZigiT3BhcXVlVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZVBhcmFtZXRlcnMiLCAiaW1wbHR5cGUiLCAic3VwZXJ0eXBlIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBvcihkZWYoIlR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgiaW1wbHR5cGUiLCBkZWYoIkZsb3dUeXBlIikpCgkJICAgICAgICAuZmllbGQoInN1cGVydHlwZSIsIG9yKGRlZigiRmxvd1R5cGUiKSwgbnVsbCkpOwoJCSAgICBkZWYoIkRlY2xhcmVPcGFxdWVUeXBlIikKCQkgICAgICAgIC5iYXNlcygiT3BhcXVlVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInR5cGVQYXJhbWV0ZXJzIiwgInN1cGVydHlwZSIpCgkJICAgICAgICAuZmllbGQoImltcGx0eXBlIiwgb3IoZGVmKCJGbG93VHlwZSIpLCBudWxsKSk7CgkJICAgIGRlZigiVHlwZUNhc3RFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJUeXBlQW5ub3RhdGlvbiIpKTsKCQkgICAgZGVmKCJUdXBsZVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlcyIpCgkJICAgICAgICAuZmllbGQoInR5cGVzIiwgW2RlZigiRmxvd1R5cGUiKV0pOwoJCSAgICBkZWYoIkRlY2xhcmVWYXJpYWJsZSIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImlkIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiRGVjbGFyZUZ1bmN0aW9uIikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJwcmVkaWNhdGUiLCBvcihkZWYoIkZsb3dQcmVkaWNhdGUiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkRlY2xhcmVDbGFzcyIpCgkJICAgICAgICAuYmFzZXMoIkludGVyZmFjZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiKTsKCQkgICAgZGVmKCJEZWNsYXJlTW9kdWxlIikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiTGl0ZXJhbCIpKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQmxvY2tTdGF0ZW1lbnQiKSk7CgkJICAgIGRlZigiRGVjbGFyZU1vZHVsZUV4cG9ydHMiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJUeXBlQW5ub3RhdGlvbiIpKTsKCQkgICAgZGVmKCJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImRlZmF1bHQiLCAiZGVjbGFyYXRpb24iLCAic3BlY2lmaWVycyIsICJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJkZWZhdWx0IiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb24iLCBvcihkZWYoIkRlY2xhcmVWYXJpYWJsZSIpLCBkZWYoIkRlY2xhcmVGdW5jdGlvbiIpLCBkZWYoIkRlY2xhcmVDbGFzcyIpLCBkZWYoIkZsb3dUeXBlIiksIC8vIEltcGxpZXMgZGVmYXVsdC4KCQkgICAgZGVmKCJUeXBlQWxpYXMiKSwgLy8gSW1wbGllcyBuYW1lZCB0eXBlCgkJICAgIGRlZigiRGVjbGFyZU9wYXF1ZVR5cGUiKSwgLy8gSW1wbGllcyBuYW1lZCBvcGFxdWUgdHlwZQoJCSAgICBkZWYoIkludGVyZmFjZURlY2xhcmF0aW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJzcGVjaWZpZXJzIiwgW29yKGRlZigiRXhwb3J0U3BlY2lmaWVyIiksIGRlZigiRXhwb3J0QmF0Y2hTcGVjaWZpZXIiKSldLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBvcihkZWYoIkxpdGVyYWwiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkRlY2xhcmVFeHBvcnRBbGxEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgic291cmNlIikKCQkgICAgICAgIC5maWVsZCgic291cmNlIiwgb3IoZGVmKCJMaXRlcmFsIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJJbXBvcnREZWNsYXJhdGlvbiIpCgkJICAgICAgICAuZmllbGQoImltcG9ydEtpbmQiLCBvcigidmFsdWUiLCAidHlwZSIsICJ0eXBlb2YiKSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gInZhbHVlIjsgfSk7CgkJICAgIGRlZigiRmxvd1ByZWRpY2F0ZSIpLmJhc2VzKCJGbG93Iik7CgkJICAgIGRlZigiSW5mZXJyZWRQcmVkaWNhdGUiKQoJCSAgICAgICAgLmJhc2VzKCJGbG93UHJlZGljYXRlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkRlY2xhcmVkUHJlZGljYXRlIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1ByZWRpY2F0ZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiRnVuY3Rpb24iKQoJCSAgICAgICAgLmZpZWxkKCJwcmVkaWNhdGUiLCBvcihkZWYoIkZsb3dQcmVkaWNhdGUiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFyZ3VtZW50cyIsIG9yKG51bGwsIGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIk5ld0V4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQXJndW1lbnRzIiwgb3IobnVsbCwgZGVmKCJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIEVudW1zCgkJICAgIGRlZigiRW51bURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIG9yKGRlZigiRW51bUJvb2xlYW5Cb2R5IiksIGRlZigiRW51bU51bWJlckJvZHkiKSwgZGVmKCJFbnVtU3RyaW5nQm9keSIpLCBkZWYoIkVudW1TeW1ib2xCb2R5IikpKTsKCQkgICAgZGVmKCJFbnVtQm9vbGVhbkJvZHkiKQoJCSAgICAgICAgLmJ1aWxkKCJtZW1iZXJzIiwgImV4cGxpY2l0VHlwZSIpCgkJICAgICAgICAuZmllbGQoIm1lbWJlcnMiLCBbZGVmKCJFbnVtQm9vbGVhbk1lbWJlciIpXSkKCQkgICAgICAgIC5maWVsZCgiZXhwbGljaXRUeXBlIiwgQm9vbGVhbik7CgkJICAgIGRlZigiRW51bU51bWJlckJvZHkiKQoJCSAgICAgICAgLmJ1aWxkKCJtZW1iZXJzIiwgImV4cGxpY2l0VHlwZSIpCgkJICAgICAgICAuZmllbGQoIm1lbWJlcnMiLCBbZGVmKCJFbnVtTnVtYmVyTWVtYmVyIildKQoJCSAgICAgICAgLmZpZWxkKCJleHBsaWNpdFR5cGUiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJFbnVtU3RyaW5nQm9keSIpCgkJICAgICAgICAuYnVpbGQoIm1lbWJlcnMiLCAiZXhwbGljaXRUeXBlIikKCQkgICAgICAgIC5maWVsZCgibWVtYmVycyIsIG9yKFtkZWYoIkVudW1TdHJpbmdNZW1iZXIiKV0sIFtkZWYoIkVudW1EZWZhdWx0ZWRNZW1iZXIiKV0pKQoJCSAgICAgICAgLmZpZWxkKCJleHBsaWNpdFR5cGUiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJFbnVtU3ltYm9sQm9keSIpCgkJICAgICAgICAuYnVpbGQoIm1lbWJlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJtZW1iZXJzIiwgW2RlZigiRW51bURlZmF1bHRlZE1lbWJlciIpXSk7CgkJICAgIGRlZigiRW51bUJvb2xlYW5NZW1iZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJpbml0IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgiaW5pdCIsIG9yKGRlZigiTGl0ZXJhbCIpLCBCb29sZWFuKSk7CgkJICAgIGRlZigiRW51bU51bWJlck1lbWJlciIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImluaXQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJpbml0IiwgZGVmKCJMaXRlcmFsIikpOwoJCSAgICBkZWYoIkVudW1TdHJpbmdNZW1iZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJpbml0IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgiaW5pdCIsIGRlZigiTGl0ZXJhbCIpKTsKCQkgICAgZGVmKCJFbnVtRGVmYXVsdGVkTWVtYmVyIikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGZsb3csIGZsb3cuZXhwb3J0cykpOwoJcmV0dXJuIGZsb3cuZXhwb3J0czsKfQoKdmFyIGVzcHJpbWEgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXNwcmltYTsKCmZ1bmN0aW9uIHJlcXVpcmVFc3ByaW1hICgpIHsKCWlmIChoYXNSZXF1aXJlZEVzcHJpbWEpIHJldHVybiBlc3ByaW1hLmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzcHJpbWEgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgZXMyMDIwXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDIwKCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXMyMDIwXzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuZmllbGQoImRlY2xhcmF0aW9ucyIsIFtvcihkZWYoIlZhcmlhYmxlRGVjbGFyYXRvciIpLCBkZWYoIklkZW50aWZpZXIiKSAvLyBFc3ByaW1hIGRldmlhdGlvbi4KCQkgICAgICAgICldKTsKCQkgICAgZGVmKCJQcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIGRlZigiUGF0dGVybiIpIC8vIEVzcHJpbWEgZGV2aWF0aW9uLgoJCSAgICApKTsKCQkgICAgZGVmKCJBcnJheVBhdHRlcm4iKQoJCSAgICAgICAgLmZpZWxkKCJlbGVtZW50cyIsIFtvcihkZWYoIlBhdHRlcm4iKSwgZGVmKCJTcHJlYWRFbGVtZW50IiksIG51bGwpXSk7CgkJICAgIGRlZigiT2JqZWN0UGF0dGVybiIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbb3IoZGVmKCJQcm9wZXJ0eSIpLCBkZWYoIlByb3BlcnR5UGF0dGVybiIpLCBkZWYoIlNwcmVhZFByb3BlcnR5UGF0dGVybiIpLCBkZWYoIlNwcmVhZFByb3BlcnR5IikgLy8gVXNlZCBieSBFc3ByaW1hLgoJCSAgICAgICAgKV0pOwoJCSAgICAvLyBMaWtlIE1vZHVsZVNwZWNpZmllciwgZXhjZXB0IHR5cGU6IkV4cG9ydFNwZWNpZmllciIgYW5kIGJ1aWxkYWJsZS4KCQkgICAgLy8gZXhwb3J0IHs8aWQgW2FzIG5hbWVdPn0gW2Zyb20gLi4uXTsKCQkgICAgZGVmKCJFeHBvcnRTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJNb2R1bGVTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJuYW1lIik7CgkJICAgIC8vIGV4cG9ydCA8Kj4gZnJvbSAuLi47CgkJICAgIGRlZigiRXhwb3J0QmF0Y2hTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRXhwb3J0RGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImRlZmF1bHQiLCAiZGVjbGFyYXRpb24iLCAic3BlY2lmaWVycyIsICJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJkZWZhdWx0IiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb24iLCBvcihkZWYoIkRlY2xhcmF0aW9uIiksIGRlZigiRXhwcmVzc2lvbiIpLCAvLyBJbXBsaWVzIGRlZmF1bHQuCgkJICAgIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJzcGVjaWZpZXJzIiwgW29yKGRlZigiRXhwb3J0U3BlY2lmaWVyIiksIGRlZigiRXhwb3J0QmF0Y2hTcGVjaWZpZXIiKSldLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBvcihkZWYoIkxpdGVyYWwiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkJsb2NrIikKCQkgICAgICAgIC5iYXNlcygiQ29tbWVudCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgLypvcHRpb25hbDoqLyAibGVhZGluZyIsICJ0cmFpbGluZyIpOwoJCSAgICBkZWYoIkxpbmUiKQoJCSAgICAgICAgLmJhc2VzKCJDb21tZW50IikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAvKm9wdGlvbmFsOiovICJsZWFkaW5nIiwgInRyYWlsaW5nIik7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlc3ByaW1hLCBlc3ByaW1hLmV4cG9ydHMpKTsKCXJldHVybiBlc3ByaW1hLmV4cG9ydHM7Cn0KCnZhciBiYWJlbCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgYmFiZWxDb3JlID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEJhYmVsQ29yZTsKCmZ1bmN0aW9uIHJlcXVpcmVCYWJlbENvcmUgKCkgewoJaWYgKGhhc1JlcXVpcmVkQmFiZWxDb3JlKSByZXR1cm4gYmFiZWxDb3JlLmV4cG9ydHM7CgloYXNSZXF1aXJlZEJhYmVsQ29yZSA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBlc19wcm9wb3NhbHNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFc1Byb3Bvc2FscygpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzX3Byb3Bvc2Fsc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICBkZWYoIk5vb3AiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRG9FeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW2RlZigiU3RhdGVtZW50IildKTsKCQkgICAgZGVmKCJCaW5kRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3QiLCAiY2FsbGVlIikKCQkgICAgICAgIC5maWVsZCgib2JqZWN0Iiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJjYWxsZWUiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyIikKCQkgICAgICAgIC5iYXNlcygiU3BlY2lmaWVyIikKCQkgICAgICAgIC5idWlsZCgiZXhwb3J0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJleHBvcnRlZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJFeHBvcnREZWZhdWx0U3BlY2lmaWVyIikKCQkgICAgICAgIC5iYXNlcygiU3BlY2lmaWVyIikKCQkgICAgICAgIC5idWlsZCgiZXhwb3J0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJleHBvcnRlZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJDb21tZW50QmxvY2siKQoJCSAgICAgICAgLmJhc2VzKCJDb21tZW50IikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAvKm9wdGlvbmFsOiovICJsZWFkaW5nIiwgInRyYWlsaW5nIik7CgkJICAgIGRlZigiQ29tbWVudExpbmUiKQoJCSAgICAgICAgLmJhc2VzKCJDb21tZW50IikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAvKm9wdGlvbmFsOiovICJsZWFkaW5nIiwgInRyYWlsaW5nIik7CgkJICAgIGRlZigiRGlyZWN0aXZlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkRpcmVjdGl2ZUxpdGVyYWwiKSk7CgkJICAgIGRlZigiRGlyZWN0aXZlTGl0ZXJhbCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiLCAiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcsIGRlZmF1bHRzWyJ1c2Ugc3RyaWN0Il0pOwoJCSAgICBkZWYoIkludGVycHJldGVyRGlyZWN0aXZlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcpOwoJCSAgICBkZWYoIkJsb2NrU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pCgkJICAgICAgICAuZmllbGQoImRpcmVjdGl2ZXMiLCBbZGVmKCJEaXJlY3RpdmUiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpOwoJCSAgICBkZWYoIlByb2dyYW0iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pCgkJICAgICAgICAuZmllbGQoImRpcmVjdGl2ZXMiLCBbZGVmKCJEaXJlY3RpdmUiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoImludGVycHJldGVyIiwgb3IoZGVmKCJJbnRlcnByZXRlckRpcmVjdGl2ZSIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIFNwbGl0IExpdGVyYWwKCQkgICAgZGVmKCJTdHJpbmdMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcpOwoJCSAgICBkZWYoIk51bWVyaWNMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBOdW1iZXIpCgkJICAgICAgICAuZmllbGQoInJhdyIsIG9yKFN0cmluZywgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImV4dHJhIiwgewoJCSAgICAgICAgcmF3VmFsdWU6IE51bWJlciwKCQkgICAgICAgIHJhdzogU3RyaW5nCgkJICAgIH0sIGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7CgkJICAgICAgICByZXR1cm4gewoJCSAgICAgICAgICAgIHJhd1ZhbHVlOiB0aGlzLnZhbHVlLAoJCSAgICAgICAgICAgIHJhdzogdGhpcy52YWx1ZSArICIiCgkJICAgICAgICB9OwoJCSAgICB9KTsKCQkgICAgZGVmKCJCaWdJbnRMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC8vIE9ubHkgU3RyaW5nIHJlYWxseSBzZWVtcyBhcHByb3ByaWF0ZSBoZXJlLCBzaW5jZSBCaWdJbnQgdmFsdWVzCgkJICAgICAgICAvLyBvZnRlbiBleGNlZWQgdGhlIGxpbWl0cyBvZiBKUyBudW1iZXJzLgoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG9yKFN0cmluZywgTnVtYmVyKSkKCQkgICAgICAgIC5maWVsZCgiZXh0cmEiLCB7CgkJICAgICAgICByYXdWYWx1ZTogU3RyaW5nLAoJCSAgICAgICAgcmF3OiBTdHJpbmcKCQkgICAgfSwgZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsKCQkgICAgICAgIHJldHVybiB7CgkJICAgICAgICAgICAgcmF3VmFsdWU6IFN0cmluZyh0aGlzLnZhbHVlKSwKCQkgICAgICAgICAgICByYXc6IHRoaXMudmFsdWUgKyAibiIKCQkgICAgICAgIH07CgkJICAgIH0pOwoJCSAgICBkZWYoIk51bGxMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG51bGwsIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkJvb2xlYW5MaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJSZWdFeHBMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTGl0ZXJhbCIpCgkJICAgICAgICAuYnVpbGQoInBhdHRlcm4iLCAiZmxhZ3MiKQoJCSAgICAgICAgLmZpZWxkKCJwYXR0ZXJuIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJmbGFncyIsIFN0cmluZykKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBSZWdFeHAsIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHRoaXMucGF0dGVybiwgdGhpcy5mbGFncyk7CgkJICAgIH0pOwoJCSAgICB2YXIgT2JqZWN0RXhwcmVzc2lvblByb3BlcnR5ID0gb3IoZGVmKCJQcm9wZXJ0eSIpLCBkZWYoIk9iamVjdE1ldGhvZCIpLCBkZWYoIk9iamVjdFByb3BlcnR5IiksIGRlZigiU3ByZWFkUHJvcGVydHkiKSwgZGVmKCJTcHJlYWRFbGVtZW50IikpOwoJCSAgICAvLyBTcGxpdCBQcm9wZXJ0eSAtPiBPYmplY3RQcm9wZXJ0eSBhbmQgT2JqZWN0TWV0aG9kCgkJICAgIGRlZigiT2JqZWN0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9wZXJ0aWVzIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtPYmplY3RFeHByZXNzaW9uUHJvcGVydHldKTsKCQkgICAgLy8gT2JqZWN0TWV0aG9kIGhvaXN0IC52YWx1ZSBwcm9wZXJ0aWVzIHRvIG93biBwcm9wZXJ0aWVzCgkJICAgIGRlZigiT2JqZWN0TWV0aG9kIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIsICJGdW5jdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtpbmQiLCAia2V5IiwgInBhcmFtcyIsICJib2R5IiwgImNvbXB1dGVkIikKCQkgICAgICAgIC5maWVsZCgia2luZCIsIG9yKCJtZXRob2QiLCAiZ2V0IiwgInNldCIpKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBvcihkZWYoIkxpdGVyYWwiKSwgZGVmKCJJZGVudGlmaWVyIiksIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiUGF0dGVybiIpXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQmxvY2tTdGF0ZW1lbnQiKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiZ2VuZXJhdG9yIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImFzeW5jIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImFjY2Vzc2liaWxpdHkiLCAvLyBUeXBlU2NyaXB0CgkJICAgIG9yKGRlZigiTGl0ZXJhbCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiZGVjb3JhdG9ycyIsIG9yKFtkZWYoIkRlY29yYXRvciIpXSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIk9iamVjdFByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJ2YWx1ZSIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIlBhdHRlcm4iKSkpCgkJICAgICAgICAuZmllbGQoImFjY2Vzc2liaWxpdHkiLCAvLyBUeXBlU2NyaXB0CgkJICAgIG9yKGRlZigiTGl0ZXJhbCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIHZhciBDbGFzc0JvZHlFbGVtZW50ID0gb3IoZGVmKCJNZXRob2REZWZpbml0aW9uIiksIGRlZigiVmFyaWFibGVEZWNsYXJhdG9yIiksIGRlZigiQ2xhc3NQcm9wZXJ0eURlZmluaXRpb24iKSwgZGVmKCJDbGFzc1Byb3BlcnR5IiksIGRlZigiQ2xhc3NQcml2YXRlUHJvcGVydHkiKSwgZGVmKCJDbGFzc01ldGhvZCIpLCBkZWYoIkNsYXNzUHJpdmF0ZU1ldGhvZCIpKTsKCQkgICAgLy8gTWV0aG9kRGVmaW5pdGlvbiAtPiBDbGFzc01ldGhvZAoJCSAgICBkZWYoIkNsYXNzQm9keSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbQ2xhc3NCb2R5RWxlbWVudF0pOwoJCSAgICBkZWYoIkNsYXNzTWV0aG9kIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiRnVuY3Rpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJraW5kIiwgImtleSIsICJwYXJhbXMiLCAiYm9keSIsICJjb21wdXRlZCIsICJzdGF0aWMiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBvcihkZWYoIkxpdGVyYWwiKSwgZGVmKCJJZGVudGlmaWVyIiksIGRlZigiRXhwcmVzc2lvbiIpKSk7CgkJICAgIGRlZigiQ2xhc3NQcml2YXRlTWV0aG9kIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiRnVuY3Rpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiLCAicGFyYW1zIiwgImJvZHkiLCAia2luZCIsICJjb21wdXRlZCIsICJzdGF0aWMiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBkZWYoIlByaXZhdGVOYW1lIikpOwoJCSAgICBbIkNsYXNzTWV0aG9kIiwKCQkgICAgICAgICJDbGFzc1ByaXZhdGVNZXRob2QiLAoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkJICAgICAgICBkZWYodHlwZU5hbWUpCgkJICAgICAgICAgICAgLmZpZWxkKCJraW5kIiwgb3IoImdldCIsICJzZXQiLCAibWV0aG9kIiwgImNvbnN0cnVjdG9yIiksIGZ1bmN0aW9uICgpIHsgcmV0dXJuICJtZXRob2QiOyB9KQoJCSAgICAgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiQmxvY2tTdGF0ZW1lbnQiKSkKCQkgICAgICAgICAgICAuZmllbGQoImNvbXB1dGVkIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBvcihCb29sZWFuLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgICAgICAuZmllbGQoImFic3RyYWN0Iiwgb3IoQm9vbGVhbiwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJhY2Nlc3MiLCBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJhY2Nlc3NpYmlsaXR5Iiwgb3IoInB1YmxpYyIsICJwcml2YXRlIiwgInByb3RlY3RlZCIsIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgICAgIC5maWVsZCgiZGVjb3JhdG9ycyIsIG9yKFtkZWYoIkRlY29yYXRvciIpXSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIG9yKEJvb2xlYW4sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgfSk7CgkJICAgIHZhciBPYmplY3RQYXR0ZXJuUHJvcGVydHkgPSBvcihkZWYoIlByb3BlcnR5IiksIGRlZigiUHJvcGVydHlQYXR0ZXJuIiksIGRlZigiU3ByZWFkUHJvcGVydHlQYXR0ZXJuIiksIGRlZigiU3ByZWFkUHJvcGVydHkiKSwgLy8gVXNlZCBieSBFc3ByaW1hCgkJICAgIGRlZigiT2JqZWN0UHJvcGVydHkiKSwgLy8gQmFiZWwgNgoJCSAgICBkZWYoIlJlc3RQcm9wZXJ0eSIpIC8vIEJhYmVsIDYKCQkgICAgKTsKCQkgICAgLy8gU3BsaXQgaW50byBSZXN0UHJvcGVydHkgYW5kIFNwcmVhZFByb3BlcnR5CgkJICAgIGRlZigiT2JqZWN0UGF0dGVybiIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9wZXJ0aWVzIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtPYmplY3RQYXR0ZXJuUHJvcGVydHldKQoJCSAgICAgICAgLmZpZWxkKCJkZWNvcmF0b3JzIiwgb3IoW2RlZigiRGVjb3JhdG9yIildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiU3ByZWFkUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJSZXN0UHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJGb3JBd2FpdFN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImxlZnQiLCAicmlnaHQiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoImxlZnQiLCBvcihkZWYoIlZhcmlhYmxlRGVjbGFyYXRpb24iKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJTdGF0ZW1lbnQiKSk7CgkJICAgIC8vIFRoZSBjYWxsZWUgbm9kZSBvZiBhIGR5bmFtaWMgaW1wb3J0KC4uLikgZXhwcmVzc2lvbi4KCQkgICAgZGVmKCJJbXBvcnQiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoYmFiZWxDb3JlLCBiYWJlbENvcmUuZXhwb3J0cykpOwoJcmV0dXJuIGJhYmVsQ29yZS5leHBvcnRzOwp9Cgp2YXIgaGFzUmVxdWlyZWRCYWJlbDsKCmZ1bmN0aW9uIHJlcXVpcmVCYWJlbCAoKSB7CglpZiAoaGFzUmVxdWlyZWRCYWJlbCkgcmV0dXJuIGJhYmVsLmV4cG9ydHM7CgloYXNSZXF1aXJlZEJhYmVsID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGJhYmVsX2NvcmVfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVCYWJlbENvcmUoKSk7CgkJdmFyIGZsb3dfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVGbG93KCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGJhYmVsX2NvcmVfMS5kZWZhdWx0KTsKCQkgICAgZm9yay51c2UoZmxvd18xLmRlZmF1bHQpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoYmFiZWwsIGJhYmVsLmV4cG9ydHMpKTsKCXJldHVybiBiYWJlbC5leHBvcnRzOwp9Cgp2YXIgdHlwZXNjcmlwdCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRUeXBlc2NyaXB0OwoKZnVuY3Rpb24gcmVxdWlyZVR5cGVzY3JpcHQgKCkgewoJaWYgKGhhc1JlcXVpcmVkVHlwZXNjcmlwdCkgcmV0dXJuIHR5cGVzY3JpcHQuZXhwb3J0czsKCWhhc1JlcXVpcmVkVHlwZXNjcmlwdCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBiYWJlbF9jb3JlXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlQmFiZWxDb3JlKCkpOwoJCXZhciB0eXBlX2Fubm90YXRpb25zXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZUFubm90YXRpb25zKCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgLy8gU2luY2UgVHlwZVNjcmlwdCBpcyBwYXJzZWQgYnkgQmFieWxvbiwgaW5jbHVkZSB0aGUgY29yZSBCYWJ5bG9uIHR5cGVzCgkJICAgIC8vIGJ1dCBvbWl0IHRoZSBGbG93LXJlbGF0ZWQgdHlwZXMuCgkJICAgIGZvcmsudXNlKGJhYmVsX2NvcmVfMS5kZWZhdWx0KTsKCQkgICAgZm9yay51c2UodHlwZV9hbm5vdGF0aW9uc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgbiA9IHR5cGVzLm5hbWVkVHlwZXM7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIHZhciBTdHJpbmdMaXRlcmFsID0gdHlwZXMuVHlwZS5mcm9tKGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJCSAgICAgICAgaWYgKG4uU3RyaW5nTGl0ZXJhbCAmJgoJCSAgICAgICAgICAgIG4uU3RyaW5nTGl0ZXJhbC5jaGVjayh2YWx1ZSwgZGVlcCkpIHsKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChuLkxpdGVyYWwgJiYKCQkgICAgICAgICAgICBuLkxpdGVyYWwuY2hlY2sodmFsdWUsIGRlZXApICYmCgkJICAgICAgICAgICAgdHlwZW9mIHZhbHVlLnZhbHVlID09PSAic3RyaW5nIikgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9LCAiU3RyaW5nTGl0ZXJhbCIpOwoJCSAgICBkZWYoIlRTVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKTsKCQkgICAgdmFyIFRTRW50aXR5TmFtZSA9IG9yKGRlZigiSWRlbnRpZmllciIpLCBkZWYoIlRTUXVhbGlmaWVkTmFtZSIpKTsKCQkgICAgZGVmKCJUU1R5cGVSZWZlcmVuY2UiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIikKCQkgICAgICAgIC5idWlsZCgidHlwZU5hbWUiLCAidHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlTmFtZSIsIFRTRW50aXR5TmFtZSk7CgkJICAgIC8vIEFuIGFic3RyYWN0IChub24tYnVpbGRhYmxlKSBiYXNlIHR5cGUgdGhhdCBwcm92aWRlIGEgY29tbW9ubHktbmVlZGVkCgkJICAgIC8vIG9wdGlvbmFsIC50eXBlUGFyYW1ldGVycyBmaWVsZC4KCQkgICAgZGVmKCJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVFNUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIEFuIGFic3RyYWN0IChub24tYnVpbGRhYmxlKSBiYXNlIHR5cGUgdGhhdCBwcm92aWRlIGEgY29tbW9ubHktbmVlZGVkCgkJICAgIC8vIG9wdGlvbmFsIC50eXBlUGFyYW1ldGVycyBmaWVsZC4KCQkgICAgZGVmKCJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVFNUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKSwgbnVsbCwgdm9pZCAwKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIEFuIGFic3RyYWN0IChub24tYnVpbGRhYmxlKSBiYXNlIHR5cGUgdGhhdCBwcm92aWRlIGEgY29tbW9ubHktbmVlZGVkCgkJICAgIC8vIG9wdGlvbmFsIC50eXBlQW5ub3RhdGlvbiBmaWVsZC4KCQkgICAgZGVmKCJUU0hhc09wdGlvbmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIG9yKGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNRdWFsaWZpZWROYW1lIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImxlZnQiLCAicmlnaHQiKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0IiwgVFNFbnRpdHlOYW1lKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIFRTRW50aXR5TmFtZSk7CgkJICAgIGRlZigiVFNBc0V4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIiwgIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIiwgInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpCgkJICAgICAgICAuZmllbGQoImV4dHJhIiwgb3IoeyBwYXJlbnRoZXNpemVkOiBCb29sZWFuIH0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU05vbk51bGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIsICJQYXR0ZXJuIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIFsKCQkgICAgICAgICJUU0FueUtleXdvcmQiLAoJCSAgICAgICAgIlRTQmlnSW50S2V5d29yZCIsCgkJICAgICAgICAiVFNCb29sZWFuS2V5d29yZCIsCgkJICAgICAgICAiVFNOZXZlcktleXdvcmQiLAoJCSAgICAgICAgIlRTTnVsbEtleXdvcmQiLAoJCSAgICAgICAgIlRTTnVtYmVyS2V5d29yZCIsCgkJICAgICAgICAiVFNPYmplY3RLZXl3b3JkIiwKCQkgICAgICAgICJUU1N0cmluZ0tleXdvcmQiLAoJCSAgICAgICAgIlRTU3ltYm9sS2V5d29yZCIsCgkJICAgICAgICAiVFNVbmRlZmluZWRLZXl3b3JkIiwKCQkgICAgICAgICJUU1Vua25vd25LZXl3b3JkIiwKCQkgICAgICAgICJUU1ZvaWRLZXl3b3JkIiwKCQkgICAgICAgICJUU1RoaXNUeXBlIiwKCQkgICAgXS5mb3JFYWNoKGZ1bmN0aW9uIChrZXl3b3JkVHlwZSkgewoJCSAgICAgICAgZGVmKGtleXdvcmRUeXBlKQoJCSAgICAgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgICAgICAuYnVpbGQoKTsKCQkgICAgfSk7CgkJICAgIGRlZigiVFNBcnJheVR5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJlbGVtZW50VHlwZSIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRUeXBlIiwgZGVmKCJUU1R5cGUiKSk7CgkJICAgIGRlZigiVFNMaXRlcmFsVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImxpdGVyYWwiKQoJCSAgICAgICAgLmZpZWxkKCJsaXRlcmFsIiwgb3IoZGVmKCJOdW1lcmljTGl0ZXJhbCIpLCBkZWYoIlN0cmluZ0xpdGVyYWwiKSwgZGVmKCJCb29sZWFuTGl0ZXJhbCIpLCBkZWYoIlRlbXBsYXRlTGl0ZXJhbCIpLCBkZWYoIlVuYXJ5RXhwcmVzc2lvbiIpKSk7CgkJICAgIFsiVFNVbmlvblR5cGUiLAoJCSAgICAgICAgIlRTSW50ZXJzZWN0aW9uVHlwZSIsCgkJICAgIF0uZm9yRWFjaChmdW5jdGlvbiAodHlwZU5hbWUpIHsKCQkgICAgICAgIGRlZih0eXBlTmFtZSkKCQkgICAgICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAgICAgLmJ1aWxkKCJ0eXBlcyIpCgkJICAgICAgICAgICAgLmZpZWxkKCJ0eXBlcyIsIFtkZWYoIlRTVHlwZSIpXSk7CgkJICAgIH0pOwoJCSAgICBkZWYoIlRTQ29uZGl0aW9uYWxUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgiY2hlY2tUeXBlIiwgImV4dGVuZHNUeXBlIiwgInRydWVUeXBlIiwgImZhbHNlVHlwZSIpCgkJICAgICAgICAuZmllbGQoImNoZWNrVHlwZSIsIGRlZigiVFNUeXBlIikpCgkJICAgICAgICAuZmllbGQoImV4dGVuZHNUeXBlIiwgZGVmKCJUU1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgidHJ1ZVR5cGUiLCBkZWYoIlRTVHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJmYWxzZVR5cGUiLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU0luZmVyVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVQYXJhbWV0ZXIiKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVyIiwgZGVmKCJUU1R5cGVQYXJhbWV0ZXIiKSk7CgkJICAgIGRlZigiVFNQYXJlbnRoZXNpemVkVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgdmFyIFBhcmFtZXRlcnNUeXBlID0gW29yKGRlZigiSWRlbnRpZmllciIpLCBkZWYoIlJlc3RFbGVtZW50IiksIGRlZigiQXJyYXlQYXR0ZXJuIiksIGRlZigiT2JqZWN0UGF0dGVybiIpKV07CgkJICAgIFsiVFNGdW5jdGlvblR5cGUiLAoJCSAgICAgICAgIlRTQ29uc3RydWN0b3JUeXBlIiwKCQkgICAgXS5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlTmFtZSkgewoJCSAgICAgICAgZGVmKHR5cGVOYW1lKQoJCSAgICAgICAgICAgIC5iYXNlcygiVFNUeXBlIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIsICJUU0hhc09wdGlvbmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgICAgIC5idWlsZCgicGFyYW1ldGVycyIpCgkJICAgICAgICAgICAgLmZpZWxkKCJwYXJhbWV0ZXJzIiwgUGFyYW1ldGVyc1R5cGUpOwoJCSAgICB9KTsKCQkgICAgZGVmKCJUU0RlY2xhcmVGdW5jdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInBhcmFtcyIsICJyZXR1cm5UeXBlIikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyZSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJhc3luYyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJnZW5lcmF0b3IiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiaWQiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIlBhdHRlcm4iKV0pCgkJICAgICAgICAvLyB0U0Z1bmN0aW9uVHlwZUFubm90YXRpb25Db21tb24KCQkgICAgICAgIC5maWVsZCgicmV0dXJuVHlwZSIsIG9yKGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpLCBkZWYoIk5vb3AiKSwgLy8gU3RpbGwgdXNlZD8KCQkgICAgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTRGVjbGFyZU1ldGhvZCIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJwYXJhbXMiLCAicmV0dXJuVHlwZSIpCgkJICAgICAgICAuZmllbGQoImFzeW5jIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImdlbmVyYXRvciIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbXMiLCBbZGVmKCJQYXR0ZXJuIildKQoJCSAgICAgICAgLy8gY2xhc3NNZXRob2RPclByb3BlcnR5Q29tbW9uCgkJICAgICAgICAuZmllbGQoImFic3RyYWN0IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImFjY2Vzc2liaWxpdHkiLCBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKQoJCSAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgia2V5Iiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiU3RyaW5nTGl0ZXJhbCIpLCBkZWYoIk51bWVyaWNMaXRlcmFsIiksIAoJCSAgICAvLyBPbmx5IGFsbG93ZWQgaWYgLmNvbXB1dGVkIGlzIHRydWUuCgkJICAgIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC8vIGNsYXNzTWV0aG9kT3JEZWNsYXJlTWV0aG9kQ29tbW9uCgkJICAgICAgICAuZmllbGQoImtpbmQiLCBvcigiZ2V0IiwgInNldCIsICJtZXRob2QiLCAiY29uc3RydWN0b3IiKSwgZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuICJtZXRob2QiOyB9KQoJCSAgICAgICAgLmZpZWxkKCJhY2Nlc3MiLCAvLyBOb3QgImFjY2Vzc2liaWxpdHkiPwoJCSAgICBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKQoJCSAgICAgICAgLmZpZWxkKCJkZWNvcmF0b3JzIiwgb3IoW2RlZigiRGVjb3JhdG9yIildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC8vIHRTRnVuY3Rpb25UeXBlQW5ub3RhdGlvbkNvbW1vbgoJCSAgICAgICAgLmZpZWxkKCJyZXR1cm5UeXBlIiwgb3IoZGVmKCJUU1R5cGVBbm5vdGF0aW9uIiksIGRlZigiTm9vcCIpLCAvLyBTdGlsbCB1c2VkPwoJCSAgICBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNNYXBwZWRUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgidHlwZVBhcmFtZXRlciIsICJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInJlYWRvbmx5Iiwgb3IoQm9vbGVhbiwgIisiLCAiLSIpLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlciIsIGRlZigiVFNUeXBlUGFyYW1ldGVyIikpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgb3IoQm9vbGVhbiwgIisiLCAiLSIpLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBvcihkZWYoIlRTVHlwZSIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNUdXBsZVR5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJlbGVtZW50VHlwZXMiKQoJCSAgICAgICAgLmZpZWxkKCJlbGVtZW50VHlwZXMiLCBbb3IoZGVmKCJUU1R5cGUiKSwgZGVmKCJUU05hbWVkVHVwbGVNZW1iZXIiKSldKTsKCQkgICAgZGVmKCJUU05hbWVkVHVwbGVNZW1iZXIiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJsYWJlbCIsICJlbGVtZW50VHlwZSIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoImxhYmVsIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRUeXBlIiwgZGVmKCJUU1R5cGUiKSk7CgkJICAgIGRlZigiVFNSZXN0VHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU09wdGlvbmFsVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU0luZGV4ZWRBY2Nlc3NUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgib2JqZWN0VHlwZSIsICJpbmRleFR5cGUiKQoJCSAgICAgICAgLmZpZWxkKCJvYmplY3RUeXBlIiwgZGVmKCJUU1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgiaW5kZXhUeXBlIiwgZGVmKCJUU1R5cGUiKSk7CgkJICAgIGRlZigiVFNUeXBlT3BlcmF0b3IiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVyYXRvciIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpOwoJCSAgICBkZWYoIlRTVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIG9yKGRlZigiVFNUeXBlIiksIGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpKSk7CgkJICAgIGRlZigiVFNJbmRleFNpZ25hdHVyZSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtZXRlcnMiLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbWV0ZXJzIiwgW2RlZigiSWRlbnRpZmllciIpXSkgLy8gTGVuZ3RoID09PSAxCgkJICAgICAgICAuZmllbGQoInJlYWRvbmx5IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIlRTUHJvcGVydHlTaWduYXR1cmUiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJUU0hhc09wdGlvbmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiLCAidHlwZUFubm90YXRpb24iLCAib3B0aW9uYWwiKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgicmVhZG9ubHkiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiaW5pdGlhbGl6ZXIiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTTWV0aG9kU2lnbmF0dXJlIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIiwgIlRTSGFzT3B0aW9uYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJwYXJhbWV0ZXJzIiwgInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgia2V5IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImNvbXB1dGVkIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoInBhcmFtZXRlcnMiLCBQYXJhbWV0ZXJzVHlwZSk7CgkJICAgIGRlZigiVFNUeXBlUHJlZGljYXRlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlQW5ub3RhdGlvbiIsICJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJwYXJhbWV0ZXJOYW1lIiwgInR5cGVBbm5vdGF0aW9uIiwgImFzc2VydHMiKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbWV0ZXJOYW1lIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiVFNUaGlzVHlwZSIpKSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBvcihkZWYoIlRTVHlwZUFubm90YXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImFzc2VydHMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIFsiVFNDYWxsU2lnbmF0dXJlRGVjbGFyYXRpb24iLAoJCSAgICAgICAgIlRTQ29uc3RydWN0U2lnbmF0dXJlRGVjbGFyYXRpb24iLAoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkJICAgICAgICBkZWYodHlwZU5hbWUpCgkJICAgICAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlcnMiLCAiVFNIYXNPcHRpb25hbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgICAgICAuYnVpbGQoInBhcmFtZXRlcnMiLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgICAgIC5maWVsZCgicGFyYW1ldGVycyIsIFBhcmFtZXRlcnNUeXBlKTsKCQkgICAgfSk7CgkJICAgIGRlZigiVFNFbnVtTWVtYmVyIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImluaXRpYWxpemVyIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgU3RyaW5nTGl0ZXJhbCkpCgkJICAgICAgICAuZmllbGQoImluaXRpYWxpemVyIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU1R5cGVRdWVyeSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImV4cHJOYW1lIikKCQkgICAgICAgIC5maWVsZCgiZXhwck5hbWUiLCBvcihUU0VudGl0eU5hbWUsIGRlZigiVFNJbXBvcnRUeXBlIikpKTsKCQkgICAgLy8gSW5mZXJyZWQgZnJvbSBCYWJ5bG9uJ3MgdHNQYXJzZVR5cGVNZW1iZXIgbWV0aG9kLgoJCSAgICB2YXIgVFNUeXBlTWVtYmVyID0gb3IoZGVmKCJUU0NhbGxTaWduYXR1cmVEZWNsYXJhdGlvbiIpLCBkZWYoIlRTQ29uc3RydWN0U2lnbmF0dXJlRGVjbGFyYXRpb24iKSwgZGVmKCJUU0luZGV4U2lnbmF0dXJlIiksIGRlZigiVFNNZXRob2RTaWduYXR1cmUiKSwgZGVmKCJUU1Byb3BlcnR5U2lnbmF0dXJlIikpOwoJCSAgICBkZWYoIlRTVHlwZUxpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJtZW1iZXJzIikKCQkgICAgICAgIC5maWVsZCgibWVtYmVycyIsIFtUU1R5cGVNZW1iZXJdKTsKCQkgICAgZGVmKCJUU1R5cGVQYXJhbWV0ZXIiKQoJCSAgICAgICAgLmJhc2VzKCJJZGVudGlmaWVyIikKCQkgICAgICAgIC5idWlsZCgibmFtZSIsICJjb25zdHJhaW50IiwgImRlZmF1bHQiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJjb25zdHJhaW50Iiwgb3IoZGVmKCJUU1R5cGUiKSwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKQoJCSAgICAgICAgLmZpZWxkKCJkZWZhdWx0Iiwgb3IoZGVmKCJUU1R5cGUiKSwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKTsKCQkgICAgZGVmKCJUU1R5cGVBc3NlcnRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIiwgIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlQW5ub3RhdGlvbiIsICJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlRTVHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImV4dHJhIiwgb3IoeyBwYXJlbnRoZXNpemVkOiBCb29sZWFuIH0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU1R5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1zIikKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiVFNUeXBlUGFyYW1ldGVyIildKTsKCQkgICAgZGVmKCJUU1R5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtcyIpCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIlRTVHlwZSIpXSk7CgkJICAgIGRlZigiVFNFbnVtRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgIm1lbWJlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJjb25zdCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJlIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoIm1lbWJlcnMiLCBbZGVmKCJUU0VudW1NZW1iZXIiKV0pCgkJICAgICAgICAuZmllbGQoImluaXRpYWxpemVyIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU1R5cGVBbGlhc0RlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJlIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJUU1R5cGUiKSk7CgkJICAgIGRlZigiVFNNb2R1bGVCbG9jayIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIFtkZWYoIlN0YXRlbWVudCIpXSk7CgkJICAgIGRlZigiVFNNb2R1bGVEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoU3RyaW5nTGl0ZXJhbCwgVFNFbnRpdHlOYW1lKSkKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyZSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJnbG9iYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIG9yKGRlZigiVFNNb2R1bGVCbG9jayIpLCBkZWYoIlRTTW9kdWxlRGVjbGFyYXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTSW1wb3J0VHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIsICJxdWFsaWZpZXIiLCAidHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIFN0cmluZ0xpdGVyYWwpCgkJICAgICAgICAuZmllbGQoInF1YWxpZmllciIsIG9yKFRTRW50aXR5TmFtZSwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKTsKCQkgICAgZGVmKCJUU0ltcG9ydEVxdWFsc0RlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJtb2R1bGVSZWZlcmVuY2UiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJpc0V4cG9ydCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJtb2R1bGVSZWZlcmVuY2UiLCBvcihUU0VudGl0eU5hbWUsIGRlZigiVFNFeHRlcm5hbE1vZHVsZVJlZmVyZW5jZSIpKSk7CgkJICAgIGRlZigiVFNFeHRlcm5hbE1vZHVsZVJlZmVyZW5jZSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBTdHJpbmdMaXRlcmFsKTsKCQkgICAgZGVmKCJUU0V4cG9ydEFzc2lnbm1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJUU05hbWVzcGFjZUV4cG9ydERlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIlRTSW50ZXJmYWNlQm9keSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIFtUU1R5cGVNZW1iZXJdKTsKCQkgICAgZGVmKCJUU0V4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cyIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIiwgInR5cGVQYXJhbWV0ZXJzIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIFRTRW50aXR5TmFtZSk7CgkJICAgIGRlZigiVFNJbnRlcmZhY2VEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIFRTRW50aXR5TmFtZSkKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyZSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJleHRlbmRzIiwgb3IoW2RlZigiVFNFeHByZXNzaW9uV2l0aFR5cGVBcmd1bWVudHMiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJUU0ludGVyZmFjZUJvZHkiKSk7CgkJICAgIGRlZigiVFNQYXJhbWV0ZXJQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJwYXJhbWV0ZXIiKQoJCSAgICAgICAgLmZpZWxkKCJhY2Nlc3NpYmlsaXR5Iiwgb3IoInB1YmxpYyIsICJwcml2YXRlIiwgInByb3RlY3RlZCIsIHZvaWQgMCksIGRlZmF1bHRzWyJ1bmRlZmluZWQiXSkKCQkgICAgICAgIC5maWVsZCgicmVhZG9ubHkiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgicGFyYW1ldGVyIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiQXNzaWdubWVudFBhdHRlcm4iKSkpOwoJCSAgICBkZWYoIkNsYXNzUHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJhY2Nlc3MiLCAvLyBOb3QgImFjY2Vzc2liaWxpdHkiPwoJCSAgICBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKTsKCQkgICAgLy8gRGVmaW5lZCBhbHJlYWR5IGluIGVzNiBhbmQgYmFiZWwtY29yZS4KCQkgICAgZGVmKCJDbGFzc0JvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW29yKGRlZigiTWV0aG9kRGVmaW5pdGlvbiIpLCBkZWYoIlZhcmlhYmxlRGVjbGFyYXRvciIpLCBkZWYoIkNsYXNzUHJvcGVydHlEZWZpbml0aW9uIiksIGRlZigiQ2xhc3NQcm9wZXJ0eSIpLCBkZWYoIkNsYXNzUHJpdmF0ZVByb3BlcnR5IiksIGRlZigiQ2xhc3NNZXRob2QiKSwgZGVmKCJDbGFzc1ByaXZhdGVNZXRob2QiKSwgCgkJICAgICAgICAvLyBKdXN0IG5lZWQgdG8gYWRkIHRoZXNlIHR5cGVzOgoJCSAgICAgICAgZGVmKCJUU0RlY2xhcmVNZXRob2QiKSwgVFNUeXBlTWVtYmVyKV0pOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAodHlwZXNjcmlwdCwgdHlwZXNjcmlwdC5leHBvcnRzKSk7CglyZXR1cm4gdHlwZXNjcmlwdC5leHBvcnRzOwp9Cgp2YXIgbmFtZWRUeXBlcyA9IHt9OwoKdmFyIGhhc1JlcXVpcmVkTmFtZWRUeXBlczsKCmZ1bmN0aW9uIHJlcXVpcmVOYW1lZFR5cGVzICgpIHsKCWlmIChoYXNSZXF1aXJlZE5hbWVkVHlwZXMpIHJldHVybiBuYW1lZFR5cGVzOwoJaGFzUmVxdWlyZWROYW1lZFR5cGVzID0gMTsKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJZXhwb3J0cy5uYW1lZFR5cGVzID0gdm9pZCAwOwoJCShmdW5jdGlvbiAobmFtZWRUeXBlcykgewoJCX0pKGV4cG9ydHMubmFtZWRUeXBlcyB8fCAoZXhwb3J0cy5uYW1lZFR5cGVzID0ge30pKTsgCgl9IChuYW1lZFR5cGVzKSk7CglyZXR1cm4gbmFtZWRUeXBlczsKfQoKKGZ1bmN0aW9uIChleHBvcnRzKSB7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy52aXNpdCA9IGV4cG9ydHMudXNlID0gZXhwb3J0cy5UeXBlID0gZXhwb3J0cy5zb21lRmllbGQgPSBleHBvcnRzLlBhdGhWaXNpdG9yID0gZXhwb3J0cy5QYXRoID0gZXhwb3J0cy5Ob2RlUGF0aCA9IGV4cG9ydHMubmFtZWRUeXBlcyA9IGV4cG9ydHMuZ2V0U3VwZXJ0eXBlTmFtZXMgPSBleHBvcnRzLmdldEZpZWxkVmFsdWUgPSBleHBvcnRzLmdldEZpZWxkTmFtZXMgPSBleHBvcnRzLmdldEJ1aWxkZXJOYW1lID0gZXhwb3J0cy5maW5hbGl6ZSA9IGV4cG9ydHMuZWFjaEZpZWxkID0gZXhwb3J0cy5kZWZpbmVNZXRob2QgPSBleHBvcnRzLmJ1aWx0SW5UeXBlcyA9IGV4cG9ydHMuYnVpbGRlcnMgPSBleHBvcnRzLmFzdE5vZGVzQXJlRXF1aXZhbGVudCA9IHZvaWQgMDsKCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCXZhciBmb3JrXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRm9yaygpKTsKCXZhciBjb3JlXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlQ29yZSgpKTsKCXZhciBlczZfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczYoKSk7Cgl2YXIgZXMyMDE2XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDE2KCkpOwoJdmFyIGVzMjAxN18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAxNygpKTsKCXZhciBlczIwMThfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTgoKSk7Cgl2YXIgZXMyMDE5XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDE5KCkpOwoJdmFyIGVzMjAyMF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAyMCgpKTsKCXZhciBqc3hfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVKc3goKSk7Cgl2YXIgZmxvd18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUZsb3coKSk7Cgl2YXIgZXNwcmltYV8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzcHJpbWEoKSk7Cgl2YXIgYmFiZWxfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVCYWJlbCgpKTsKCXZhciB0eXBlc2NyaXB0XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXNjcmlwdCgpKTsKCXZhciBlc19wcm9wb3NhbHNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFc1Byb3Bvc2FscygpKTsKCXZhciBuYW1lZFR5cGVzXzEgPSByZXF1aXJlTmFtZWRUeXBlcygpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJuYW1lZFR5cGVzIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5hbWVkVHlwZXNfMS5uYW1lZFR5cGVzOyB9IH0pOwoJdmFyIF9hID0gZm9ya18xLmRlZmF1bHQoWwoJICAgIC8vIFRoaXMgY29yZSBtb2R1bGUgb2YgQVNUIHR5cGVzIGNhcHR1cmVzIEVTNSBhcyBpdCBpcyBwYXJzZWQgdG9kYXkgYnkKCSAgICAvLyBnaXQ6Ly9naXRodWIuY29tL2FyaXlhL2VzcHJpbWEuZ2l0I21hc3Rlci4KCSAgICBjb3JlXzEuZGVmYXVsdCwKCSAgICAvLyBGZWVsIGZyZWUgdG8gYWRkIHRvIG9yIHJlbW92ZSBmcm9tIHRoaXMgbGlzdCBvZiBleHRlbnNpb24gbW9kdWxlcyB0bwoJICAgIC8vIGNvbmZpZ3VyZSB0aGUgcHJlY2lzZSB0eXBlIGhpZXJhcmNoeSB0aGF0IHlvdSBuZWVkLgoJICAgIGVzNl8xLmRlZmF1bHQsCgkgICAgZXMyMDE2XzEuZGVmYXVsdCwKCSAgICBlczIwMTdfMS5kZWZhdWx0LAoJICAgIGVzMjAxOF8xLmRlZmF1bHQsCgkgICAgZXMyMDE5XzEuZGVmYXVsdCwKCSAgICBlczIwMjBfMS5kZWZhdWx0LAoJICAgIGpzeF8xLmRlZmF1bHQsCgkgICAgZmxvd18xLmRlZmF1bHQsCgkgICAgZXNwcmltYV8xLmRlZmF1bHQsCgkgICAgYmFiZWxfMS5kZWZhdWx0LAoJICAgIHR5cGVzY3JpcHRfMS5kZWZhdWx0LAoJICAgIGVzX3Byb3Bvc2Fsc18xLmRlZmF1bHQsCgldKSwgYXN0Tm9kZXNBcmVFcXVpdmFsZW50ID0gX2EuYXN0Tm9kZXNBcmVFcXVpdmFsZW50LCBidWlsZGVycyA9IF9hLmJ1aWxkZXJzLCBidWlsdEluVHlwZXMgPSBfYS5idWlsdEluVHlwZXMsIGRlZmluZU1ldGhvZCA9IF9hLmRlZmluZU1ldGhvZCwgZWFjaEZpZWxkID0gX2EuZWFjaEZpZWxkLCBmaW5hbGl6ZSA9IF9hLmZpbmFsaXplLCBnZXRCdWlsZGVyTmFtZSA9IF9hLmdldEJ1aWxkZXJOYW1lLCBnZXRGaWVsZE5hbWVzID0gX2EuZ2V0RmllbGROYW1lcywgZ2V0RmllbGRWYWx1ZSA9IF9hLmdldEZpZWxkVmFsdWUsIGdldFN1cGVydHlwZU5hbWVzID0gX2EuZ2V0U3VwZXJ0eXBlTmFtZXMsIG4gPSBfYS5uYW1lZFR5cGVzLCBOb2RlUGF0aCA9IF9hLk5vZGVQYXRoLCBQYXRoID0gX2EuUGF0aCwgUGF0aFZpc2l0b3IgPSBfYS5QYXRoVmlzaXRvciwgc29tZUZpZWxkID0gX2Euc29tZUZpZWxkLCBUeXBlID0gX2EuVHlwZSwgdXNlID0gX2EudXNlLCB2aXNpdCA9IF9hLnZpc2l0OwoJZXhwb3J0cy5hc3ROb2Rlc0FyZUVxdWl2YWxlbnQgPSBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQ7CglleHBvcnRzLmJ1aWxkZXJzID0gYnVpbGRlcnM7CglleHBvcnRzLmJ1aWx0SW5UeXBlcyA9IGJ1aWx0SW5UeXBlczsKCWV4cG9ydHMuZGVmaW5lTWV0aG9kID0gZGVmaW5lTWV0aG9kOwoJZXhwb3J0cy5lYWNoRmllbGQgPSBlYWNoRmllbGQ7CglleHBvcnRzLmZpbmFsaXplID0gZmluYWxpemU7CglleHBvcnRzLmdldEJ1aWxkZXJOYW1lID0gZ2V0QnVpbGRlck5hbWU7CglleHBvcnRzLmdldEZpZWxkTmFtZXMgPSBnZXRGaWVsZE5hbWVzOwoJZXhwb3J0cy5nZXRGaWVsZFZhbHVlID0gZ2V0RmllbGRWYWx1ZTsKCWV4cG9ydHMuZ2V0U3VwZXJ0eXBlTmFtZXMgPSBnZXRTdXBlcnR5cGVOYW1lczsKCWV4cG9ydHMuTm9kZVBhdGggPSBOb2RlUGF0aDsKCWV4cG9ydHMuUGF0aCA9IFBhdGg7CglleHBvcnRzLlBhdGhWaXNpdG9yID0gUGF0aFZpc2l0b3I7CglleHBvcnRzLnNvbWVGaWVsZCA9IHNvbWVGaWVsZDsKCWV4cG9ydHMuVHlwZSA9IFR5cGU7CglleHBvcnRzLnVzZSA9IHVzZTsKCWV4cG9ydHMudmlzaXQgPSB2aXNpdDsKCS8vIFBvcHVsYXRlIHRoZSBleHBvcnRlZCBmaWVsZHMgb2YgdGhlIG5hbWVkVHlwZXMgbmFtZXNwYWNlLCB3aGlsZSBzdGlsbAoJLy8gcmV0YWluaW5nIGl0cyBtZW1iZXIgdHlwZXMuCglPYmplY3QuYXNzaWduKG5hbWVkVHlwZXNfMS5uYW1lZFR5cGVzLCBuKTsgCn0gKG1haW4kMSkpOwoKdmFyIGVzY29kZWdlbiA9IHt9OwoKdmFyIGVzdHJhdmVyc2UgPSB7fTsKCi8qCiAgQ29weXJpZ2h0IChDKSAyMDEyLTIwMTMgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxMiBBcml5YSBIaWRheWF0IDxhcml5YS5oaWRheWF0QGdtYWlsLmNvbT4KCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCiAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIDxDT1BZUklHSFQgSE9MREVSPiBCRSBMSUFCTEUgRk9SIEFOWQogIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTCiAgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOwogIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORAogIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCiAgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GCiAgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KKi8KCihmdW5jdGlvbiAoZXhwb3J0cykgewoJLypqc2xpbnQgdmFyczpmYWxzZSwgYml0d2lzZTp0cnVlKi8KCS8qanNoaW50IGluZGVudDo0Ki8KCS8qZ2xvYmFsIGV4cG9ydHM6dHJ1ZSovCgkoZnVuY3Rpb24gY2xvbmUoZXhwb3J0cykgewoKCSAgICB2YXIgU3ludGF4LAoJICAgICAgICBWaXNpdG9yT3B0aW9uLAoJICAgICAgICBWaXNpdG9yS2V5cywKCSAgICAgICAgQlJFQUssCgkgICAgICAgIFNLSVAsCgkgICAgICAgIFJFTU9WRTsKCgkgICAgZnVuY3Rpb24gZGVlcENvcHkob2JqKSB7CgkgICAgICAgIHZhciByZXQgPSB7fSwga2V5LCB2YWw7CgkgICAgICAgIGZvciAoa2V5IGluIG9iaikgewoJICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkgICAgICAgICAgICAgICAgdmFsID0gb2JqW2tleV07CgkgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdvYmplY3QnICYmIHZhbCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICByZXRba2V5XSA9IGRlZXBDb3B5KHZhbCk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0W2tleV0gPSB2YWw7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXQ7CgkgICAgfQoKCSAgICAvLyBiYXNlZCBvbiBMTFZNIGxpYmMrKyB1cHBlcl9ib3VuZCAvIGxvd2VyX2JvdW5kCgkgICAgLy8gTUlUIExpY2Vuc2UKCgkgICAgZnVuY3Rpb24gdXBwZXJCb3VuZChhcnJheSwgZnVuYykgewoJICAgICAgICB2YXIgZGlmZiwgbGVuLCBpLCBjdXJyZW50OwoKCSAgICAgICAgbGVuID0gYXJyYXkubGVuZ3RoOwoJICAgICAgICBpID0gMDsKCgkgICAgICAgIHdoaWxlIChsZW4pIHsKCSAgICAgICAgICAgIGRpZmYgPSBsZW4gPj4+IDE7CgkgICAgICAgICAgICBjdXJyZW50ID0gaSArIGRpZmY7CgkgICAgICAgICAgICBpZiAoZnVuYyhhcnJheVtjdXJyZW50XSkpIHsKCSAgICAgICAgICAgICAgICBsZW4gPSBkaWZmOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBpID0gY3VycmVudCArIDE7CgkgICAgICAgICAgICAgICAgbGVuIC09IGRpZmYgKyAxOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpOwoJICAgIH0KCgkgICAgU3ludGF4ID0gewoJICAgICAgICBBc3NpZ25tZW50RXhwcmVzc2lvbjogJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJywKCSAgICAgICAgQXNzaWdubWVudFBhdHRlcm46ICdBc3NpZ25tZW50UGF0dGVybicsCgkgICAgICAgIEFycmF5RXhwcmVzc2lvbjogJ0FycmF5RXhwcmVzc2lvbicsCgkgICAgICAgIEFycmF5UGF0dGVybjogJ0FycmF5UGF0dGVybicsCgkgICAgICAgIEFycm93RnVuY3Rpb25FeHByZXNzaW9uOiAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nLAoJICAgICAgICBBd2FpdEV4cHJlc3Npb246ICdBd2FpdEV4cHJlc3Npb24nLCAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgQmxvY2tTdGF0ZW1lbnQ6ICdCbG9ja1N0YXRlbWVudCcsCgkgICAgICAgIEJpbmFyeUV4cHJlc3Npb246ICdCaW5hcnlFeHByZXNzaW9uJywKCSAgICAgICAgQnJlYWtTdGF0ZW1lbnQ6ICdCcmVha1N0YXRlbWVudCcsCgkgICAgICAgIENhbGxFeHByZXNzaW9uOiAnQ2FsbEV4cHJlc3Npb24nLAoJICAgICAgICBDYXRjaENsYXVzZTogJ0NhdGNoQ2xhdXNlJywKCSAgICAgICAgQ2hhaW5FeHByZXNzaW9uOiAnQ2hhaW5FeHByZXNzaW9uJywKCSAgICAgICAgQ2xhc3NCb2R5OiAnQ2xhc3NCb2R5JywKCSAgICAgICAgQ2xhc3NEZWNsYXJhdGlvbjogJ0NsYXNzRGVjbGFyYXRpb24nLAoJICAgICAgICBDbGFzc0V4cHJlc3Npb246ICdDbGFzc0V4cHJlc3Npb24nLAoJICAgICAgICBDb21wcmVoZW5zaW9uQmxvY2s6ICdDb21wcmVoZW5zaW9uQmxvY2snLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIENvbXByZWhlbnNpb25FeHByZXNzaW9uOiAnQ29tcHJlaGVuc2lvbkV4cHJlc3Npb24nLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIENvbmRpdGlvbmFsRXhwcmVzc2lvbjogJ0NvbmRpdGlvbmFsRXhwcmVzc2lvbicsCgkgICAgICAgIENvbnRpbnVlU3RhdGVtZW50OiAnQ29udGludWVTdGF0ZW1lbnQnLAoJICAgICAgICBEZWJ1Z2dlclN0YXRlbWVudDogJ0RlYnVnZ2VyU3RhdGVtZW50JywKCSAgICAgICAgRGlyZWN0aXZlU3RhdGVtZW50OiAnRGlyZWN0aXZlU3RhdGVtZW50JywKCSAgICAgICAgRG9XaGlsZVN0YXRlbWVudDogJ0RvV2hpbGVTdGF0ZW1lbnQnLAoJICAgICAgICBFbXB0eVN0YXRlbWVudDogJ0VtcHR5U3RhdGVtZW50JywKCSAgICAgICAgRXhwb3J0QWxsRGVjbGFyYXRpb246ICdFeHBvcnRBbGxEZWNsYXJhdGlvbicsCgkgICAgICAgIEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbjogJ0V4cG9ydERlZmF1bHREZWNsYXJhdGlvbicsCgkgICAgICAgIEV4cG9ydE5hbWVkRGVjbGFyYXRpb246ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJywKCSAgICAgICAgRXhwb3J0U3BlY2lmaWVyOiAnRXhwb3J0U3BlY2lmaWVyJywKCSAgICAgICAgRXhwcmVzc2lvblN0YXRlbWVudDogJ0V4cHJlc3Npb25TdGF0ZW1lbnQnLAoJICAgICAgICBGb3JTdGF0ZW1lbnQ6ICdGb3JTdGF0ZW1lbnQnLAoJICAgICAgICBGb3JJblN0YXRlbWVudDogJ0ZvckluU3RhdGVtZW50JywKCSAgICAgICAgRm9yT2ZTdGF0ZW1lbnQ6ICdGb3JPZlN0YXRlbWVudCcsCgkgICAgICAgIEZ1bmN0aW9uRGVjbGFyYXRpb246ICdGdW5jdGlvbkRlY2xhcmF0aW9uJywKCSAgICAgICAgRnVuY3Rpb25FeHByZXNzaW9uOiAnRnVuY3Rpb25FeHByZXNzaW9uJywKCSAgICAgICAgR2VuZXJhdG9yRXhwcmVzc2lvbjogJ0dlbmVyYXRvckV4cHJlc3Npb24nLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIElkZW50aWZpZXI6ICdJZGVudGlmaWVyJywKCSAgICAgICAgSWZTdGF0ZW1lbnQ6ICdJZlN0YXRlbWVudCcsCgkgICAgICAgIEltcG9ydEV4cHJlc3Npb246ICdJbXBvcnRFeHByZXNzaW9uJywKCSAgICAgICAgSW1wb3J0RGVjbGFyYXRpb246ICdJbXBvcnREZWNsYXJhdGlvbicsCgkgICAgICAgIEltcG9ydERlZmF1bHRTcGVjaWZpZXI6ICdJbXBvcnREZWZhdWx0U3BlY2lmaWVyJywKCSAgICAgICAgSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyOiAnSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyJywKCSAgICAgICAgSW1wb3J0U3BlY2lmaWVyOiAnSW1wb3J0U3BlY2lmaWVyJywKCSAgICAgICAgTGl0ZXJhbDogJ0xpdGVyYWwnLAoJICAgICAgICBMYWJlbGVkU3RhdGVtZW50OiAnTGFiZWxlZFN0YXRlbWVudCcsCgkgICAgICAgIExvZ2ljYWxFeHByZXNzaW9uOiAnTG9naWNhbEV4cHJlc3Npb24nLAoJICAgICAgICBNZW1iZXJFeHByZXNzaW9uOiAnTWVtYmVyRXhwcmVzc2lvbicsCgkgICAgICAgIE1ldGFQcm9wZXJ0eTogJ01ldGFQcm9wZXJ0eScsCgkgICAgICAgIE1ldGhvZERlZmluaXRpb246ICdNZXRob2REZWZpbml0aW9uJywKCSAgICAgICAgTW9kdWxlU3BlY2lmaWVyOiAnTW9kdWxlU3BlY2lmaWVyJywKCSAgICAgICAgTmV3RXhwcmVzc2lvbjogJ05ld0V4cHJlc3Npb24nLAoJICAgICAgICBPYmplY3RFeHByZXNzaW9uOiAnT2JqZWN0RXhwcmVzc2lvbicsCgkgICAgICAgIE9iamVjdFBhdHRlcm46ICdPYmplY3RQYXR0ZXJuJywKCSAgICAgICAgUHJpdmF0ZUlkZW50aWZpZXI6ICdQcml2YXRlSWRlbnRpZmllcicsCgkgICAgICAgIFByb2dyYW06ICdQcm9ncmFtJywKCSAgICAgICAgUHJvcGVydHk6ICdQcm9wZXJ0eScsCgkgICAgICAgIFByb3BlcnR5RGVmaW5pdGlvbjogJ1Byb3BlcnR5RGVmaW5pdGlvbicsCgkgICAgICAgIFJlc3RFbGVtZW50OiAnUmVzdEVsZW1lbnQnLAoJICAgICAgICBSZXR1cm5TdGF0ZW1lbnQ6ICdSZXR1cm5TdGF0ZW1lbnQnLAoJICAgICAgICBTZXF1ZW5jZUV4cHJlc3Npb246ICdTZXF1ZW5jZUV4cHJlc3Npb24nLAoJICAgICAgICBTcHJlYWRFbGVtZW50OiAnU3ByZWFkRWxlbWVudCcsCgkgICAgICAgIFN1cGVyOiAnU3VwZXInLAoJICAgICAgICBTd2l0Y2hTdGF0ZW1lbnQ6ICdTd2l0Y2hTdGF0ZW1lbnQnLAoJICAgICAgICBTd2l0Y2hDYXNlOiAnU3dpdGNoQ2FzZScsCgkgICAgICAgIFRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbjogJ1RhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbicsCgkgICAgICAgIFRlbXBsYXRlRWxlbWVudDogJ1RlbXBsYXRlRWxlbWVudCcsCgkgICAgICAgIFRlbXBsYXRlTGl0ZXJhbDogJ1RlbXBsYXRlTGl0ZXJhbCcsCgkgICAgICAgIFRoaXNFeHByZXNzaW9uOiAnVGhpc0V4cHJlc3Npb24nLAoJICAgICAgICBUaHJvd1N0YXRlbWVudDogJ1Rocm93U3RhdGVtZW50JywKCSAgICAgICAgVHJ5U3RhdGVtZW50OiAnVHJ5U3RhdGVtZW50JywKCSAgICAgICAgVW5hcnlFeHByZXNzaW9uOiAnVW5hcnlFeHByZXNzaW9uJywKCSAgICAgICAgVXBkYXRlRXhwcmVzc2lvbjogJ1VwZGF0ZUV4cHJlc3Npb24nLAoJICAgICAgICBWYXJpYWJsZURlY2xhcmF0aW9uOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsCgkgICAgICAgIFZhcmlhYmxlRGVjbGFyYXRvcjogJ1ZhcmlhYmxlRGVjbGFyYXRvcicsCgkgICAgICAgIFdoaWxlU3RhdGVtZW50OiAnV2hpbGVTdGF0ZW1lbnQnLAoJICAgICAgICBXaXRoU3RhdGVtZW50OiAnV2l0aFN0YXRlbWVudCcsCgkgICAgICAgIFlpZWxkRXhwcmVzc2lvbjogJ1lpZWxkRXhwcmVzc2lvbicKCSAgICB9OwoKCSAgICBWaXNpdG9yS2V5cyA9IHsKCSAgICAgICAgQXNzaWdubWVudEV4cHJlc3Npb246IFsnbGVmdCcsICdyaWdodCddLAoJICAgICAgICBBc3NpZ25tZW50UGF0dGVybjogWydsZWZ0JywgJ3JpZ2h0J10sCgkgICAgICAgIEFycmF5RXhwcmVzc2lvbjogWydlbGVtZW50cyddLAoJICAgICAgICBBcnJheVBhdHRlcm46IFsnZWxlbWVudHMnXSwKCSAgICAgICAgQXJyb3dGdW5jdGlvbkV4cHJlc3Npb246IFsncGFyYW1zJywgJ2JvZHknXSwKCSAgICAgICAgQXdhaXRFeHByZXNzaW9uOiBbJ2FyZ3VtZW50J10sIC8vIENBVVRJT046IEl0J3MgZGVmZXJyZWQgdG8gRVM3LgoJICAgICAgICBCbG9ja1N0YXRlbWVudDogWydib2R5J10sCgkgICAgICAgIEJpbmFyeUV4cHJlc3Npb246IFsnbGVmdCcsICdyaWdodCddLAoJICAgICAgICBCcmVha1N0YXRlbWVudDogWydsYWJlbCddLAoJICAgICAgICBDYWxsRXhwcmVzc2lvbjogWydjYWxsZWUnLCAnYXJndW1lbnRzJ10sCgkgICAgICAgIENhdGNoQ2xhdXNlOiBbJ3BhcmFtJywgJ2JvZHknXSwKCSAgICAgICAgQ2hhaW5FeHByZXNzaW9uOiBbJ2V4cHJlc3Npb24nXSwKCSAgICAgICAgQ2xhc3NCb2R5OiBbJ2JvZHknXSwKCSAgICAgICAgQ2xhc3NEZWNsYXJhdGlvbjogWydpZCcsICdzdXBlckNsYXNzJywgJ2JvZHknXSwKCSAgICAgICAgQ2xhc3NFeHByZXNzaW9uOiBbJ2lkJywgJ3N1cGVyQ2xhc3MnLCAnYm9keSddLAoJICAgICAgICBDb21wcmVoZW5zaW9uQmxvY2s6IFsnbGVmdCcsICdyaWdodCddLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIENvbXByZWhlbnNpb25FeHByZXNzaW9uOiBbJ2Jsb2NrcycsICdmaWx0ZXInLCAnYm9keSddLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIENvbmRpdGlvbmFsRXhwcmVzc2lvbjogWyd0ZXN0JywgJ2NvbnNlcXVlbnQnLCAnYWx0ZXJuYXRlJ10sCgkgICAgICAgIENvbnRpbnVlU3RhdGVtZW50OiBbJ2xhYmVsJ10sCgkgICAgICAgIERlYnVnZ2VyU3RhdGVtZW50OiBbXSwKCSAgICAgICAgRGlyZWN0aXZlU3RhdGVtZW50OiBbXSwKCSAgICAgICAgRG9XaGlsZVN0YXRlbWVudDogWydib2R5JywgJ3Rlc3QnXSwKCSAgICAgICAgRW1wdHlTdGF0ZW1lbnQ6IFtdLAoJICAgICAgICBFeHBvcnRBbGxEZWNsYXJhdGlvbjogWydzb3VyY2UnXSwKCSAgICAgICAgRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uOiBbJ2RlY2xhcmF0aW9uJ10sCgkgICAgICAgIEV4cG9ydE5hbWVkRGVjbGFyYXRpb246IFsnZGVjbGFyYXRpb24nLCAnc3BlY2lmaWVycycsICdzb3VyY2UnXSwKCSAgICAgICAgRXhwb3J0U3BlY2lmaWVyOiBbJ2V4cG9ydGVkJywgJ2xvY2FsJ10sCgkgICAgICAgIEV4cHJlc3Npb25TdGF0ZW1lbnQ6IFsnZXhwcmVzc2lvbiddLAoJICAgICAgICBGb3JTdGF0ZW1lbnQ6IFsnaW5pdCcsICd0ZXN0JywgJ3VwZGF0ZScsICdib2R5J10sCgkgICAgICAgIEZvckluU3RhdGVtZW50OiBbJ2xlZnQnLCAncmlnaHQnLCAnYm9keSddLAoJICAgICAgICBGb3JPZlN0YXRlbWVudDogWydsZWZ0JywgJ3JpZ2h0JywgJ2JvZHknXSwKCSAgICAgICAgRnVuY3Rpb25EZWNsYXJhdGlvbjogWydpZCcsICdwYXJhbXMnLCAnYm9keSddLAoJICAgICAgICBGdW5jdGlvbkV4cHJlc3Npb246IFsnaWQnLCAncGFyYW1zJywgJ2JvZHknXSwKCSAgICAgICAgR2VuZXJhdG9yRXhwcmVzc2lvbjogWydibG9ja3MnLCAnZmlsdGVyJywgJ2JvZHknXSwgIC8vIENBVVRJT046IEl0J3MgZGVmZXJyZWQgdG8gRVM3LgoJICAgICAgICBJZGVudGlmaWVyOiBbXSwKCSAgICAgICAgSWZTdGF0ZW1lbnQ6IFsndGVzdCcsICdjb25zZXF1ZW50JywgJ2FsdGVybmF0ZSddLAoJICAgICAgICBJbXBvcnRFeHByZXNzaW9uOiBbJ3NvdXJjZSddLAoJICAgICAgICBJbXBvcnREZWNsYXJhdGlvbjogWydzcGVjaWZpZXJzJywgJ3NvdXJjZSddLAoJICAgICAgICBJbXBvcnREZWZhdWx0U3BlY2lmaWVyOiBbJ2xvY2FsJ10sCgkgICAgICAgIEltcG9ydE5hbWVzcGFjZVNwZWNpZmllcjogWydsb2NhbCddLAoJICAgICAgICBJbXBvcnRTcGVjaWZpZXI6IFsnaW1wb3J0ZWQnLCAnbG9jYWwnXSwKCSAgICAgICAgTGl0ZXJhbDogW10sCgkgICAgICAgIExhYmVsZWRTdGF0ZW1lbnQ6IFsnbGFiZWwnLCAnYm9keSddLAoJICAgICAgICBMb2dpY2FsRXhwcmVzc2lvbjogWydsZWZ0JywgJ3JpZ2h0J10sCgkgICAgICAgIE1lbWJlckV4cHJlc3Npb246IFsnb2JqZWN0JywgJ3Byb3BlcnR5J10sCgkgICAgICAgIE1ldGFQcm9wZXJ0eTogWydtZXRhJywgJ3Byb3BlcnR5J10sCgkgICAgICAgIE1ldGhvZERlZmluaXRpb246IFsna2V5JywgJ3ZhbHVlJ10sCgkgICAgICAgIE1vZHVsZVNwZWNpZmllcjogW10sCgkgICAgICAgIE5ld0V4cHJlc3Npb246IFsnY2FsbGVlJywgJ2FyZ3VtZW50cyddLAoJICAgICAgICBPYmplY3RFeHByZXNzaW9uOiBbJ3Byb3BlcnRpZXMnXSwKCSAgICAgICAgT2JqZWN0UGF0dGVybjogWydwcm9wZXJ0aWVzJ10sCgkgICAgICAgIFByaXZhdGVJZGVudGlmaWVyOiBbXSwKCSAgICAgICAgUHJvZ3JhbTogWydib2R5J10sCgkgICAgICAgIFByb3BlcnR5OiBbJ2tleScsICd2YWx1ZSddLAoJICAgICAgICBQcm9wZXJ0eURlZmluaXRpb246IFsna2V5JywgJ3ZhbHVlJ10sCgkgICAgICAgIFJlc3RFbGVtZW50OiBbICdhcmd1bWVudCcgXSwKCSAgICAgICAgUmV0dXJuU3RhdGVtZW50OiBbJ2FyZ3VtZW50J10sCgkgICAgICAgIFNlcXVlbmNlRXhwcmVzc2lvbjogWydleHByZXNzaW9ucyddLAoJICAgICAgICBTcHJlYWRFbGVtZW50OiBbJ2FyZ3VtZW50J10sCgkgICAgICAgIFN1cGVyOiBbXSwKCSAgICAgICAgU3dpdGNoU3RhdGVtZW50OiBbJ2Rpc2NyaW1pbmFudCcsICdjYXNlcyddLAoJICAgICAgICBTd2l0Y2hDYXNlOiBbJ3Rlc3QnLCAnY29uc2VxdWVudCddLAoJICAgICAgICBUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb246IFsndGFnJywgJ3F1YXNpJ10sCgkgICAgICAgIFRlbXBsYXRlRWxlbWVudDogW10sCgkgICAgICAgIFRlbXBsYXRlTGl0ZXJhbDogWydxdWFzaXMnLCAnZXhwcmVzc2lvbnMnXSwKCSAgICAgICAgVGhpc0V4cHJlc3Npb246IFtdLAoJICAgICAgICBUaHJvd1N0YXRlbWVudDogWydhcmd1bWVudCddLAoJICAgICAgICBUcnlTdGF0ZW1lbnQ6IFsnYmxvY2snLCAnaGFuZGxlcicsICdmaW5hbGl6ZXInXSwKCSAgICAgICAgVW5hcnlFeHByZXNzaW9uOiBbJ2FyZ3VtZW50J10sCgkgICAgICAgIFVwZGF0ZUV4cHJlc3Npb246IFsnYXJndW1lbnQnXSwKCSAgICAgICAgVmFyaWFibGVEZWNsYXJhdGlvbjogWydkZWNsYXJhdGlvbnMnXSwKCSAgICAgICAgVmFyaWFibGVEZWNsYXJhdG9yOiBbJ2lkJywgJ2luaXQnXSwKCSAgICAgICAgV2hpbGVTdGF0ZW1lbnQ6IFsndGVzdCcsICdib2R5J10sCgkgICAgICAgIFdpdGhTdGF0ZW1lbnQ6IFsnb2JqZWN0JywgJ2JvZHknXSwKCSAgICAgICAgWWllbGRFeHByZXNzaW9uOiBbJ2FyZ3VtZW50J10KCSAgICB9OwoKCSAgICAvLyB1bmlxdWUgaWQKCSAgICBCUkVBSyA9IHt9OwoJICAgIFNLSVAgPSB7fTsKCSAgICBSRU1PVkUgPSB7fTsKCgkgICAgVmlzaXRvck9wdGlvbiA9IHsKCSAgICAgICAgQnJlYWs6IEJSRUFLLAoJICAgICAgICBTa2lwOiBTS0lQLAoJICAgICAgICBSZW1vdmU6IFJFTU9WRQoJICAgIH07CgoJICAgIGZ1bmN0aW9uIFJlZmVyZW5jZShwYXJlbnQsIGtleSkgewoJICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKCSAgICAgICAgdGhpcy5rZXkgPSBrZXk7CgkgICAgfQoKCSAgICBSZWZlcmVuY2UucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiByZXBsYWNlKG5vZGUpIHsKCSAgICAgICAgdGhpcy5wYXJlbnRbdGhpcy5rZXldID0gbm9kZTsKCSAgICB9OwoKCSAgICBSZWZlcmVuY2UucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIHJlbW92ZSgpIHsKCSAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5wYXJlbnQpKSB7CgkgICAgICAgICAgICB0aGlzLnBhcmVudC5zcGxpY2UodGhpcy5rZXksIDEpOwoJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnJlcGxhY2UobnVsbCk7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICB9OwoKCSAgICBmdW5jdGlvbiBFbGVtZW50KG5vZGUsIHBhdGgsIHdyYXAsIHJlZikgewoJICAgICAgICB0aGlzLm5vZGUgPSBub2RlOwoJICAgICAgICB0aGlzLnBhdGggPSBwYXRoOwoJICAgICAgICB0aGlzLndyYXAgPSB3cmFwOwoJICAgICAgICB0aGlzLnJlZiA9IHJlZjsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoKSB7IH0KCgkgICAgLy8gQVBJOgoJICAgIC8vIHJldHVybiBwcm9wZXJ0eSBwYXRoIGFycmF5IGZyb20gcm9vdCB0byBjdXJyZW50IG5vZGUKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS5wYXRoID0gZnVuY3Rpb24gcGF0aCgpIHsKCSAgICAgICAgdmFyIGksIGl6LCBqLCBqeiwgcmVzdWx0LCBlbGVtZW50OwoKCSAgICAgICAgZnVuY3Rpb24gYWRkVG9QYXRoKHJlc3VsdCwgcGF0aCkgewoJICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF0aCkpIHsKCSAgICAgICAgICAgICAgICBmb3IgKGogPSAwLCBqeiA9IHBhdGgubGVuZ3RoOyBqIDwgano7ICsraikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwYXRoW2pdKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhdGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICAvLyByb290IG5vZGUKCSAgICAgICAgaWYgKCF0aGlzLl9fY3VycmVudC5wYXRoKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gZmlyc3Qgbm9kZSBpcyBzZW50aW5lbCwgc2Vjb25kIG5vZGUgaXMgcm9vdCBlbGVtZW50CgkgICAgICAgIHJlc3VsdCA9IFtdOwoJICAgICAgICBmb3IgKGkgPSAyLCBpeiA9IHRoaXMuX19sZWF2ZWxpc3QubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgZWxlbWVudCA9IHRoaXMuX19sZWF2ZWxpc3RbaV07CgkgICAgICAgICAgICBhZGRUb1BhdGgocmVzdWx0LCBlbGVtZW50LnBhdGgpOwoJICAgICAgICB9CgkgICAgICAgIGFkZFRvUGF0aChyZXN1bHQsIHRoaXMuX19jdXJyZW50LnBhdGgpOwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgoJICAgIC8vIEFQSToKCSAgICAvLyByZXR1cm4gdHlwZSBvZiBjdXJyZW50IG5vZGUKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS50eXBlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbm9kZSA9IHRoaXMuY3VycmVudCgpOwoJICAgICAgICByZXR1cm4gbm9kZS50eXBlIHx8IHRoaXMuX19jdXJyZW50LndyYXA7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIHJldHVybiBhcnJheSBvZiBwYXJlbnQgZWxlbWVudHMKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS5wYXJlbnRzID0gZnVuY3Rpb24gcGFyZW50cygpIHsKCSAgICAgICAgdmFyIGksIGl6LCByZXN1bHQ7CgoJICAgICAgICAvLyBmaXJzdCBub2RlIGlzIHNlbnRpbmVsCgkgICAgICAgIHJlc3VsdCA9IFtdOwoJICAgICAgICBmb3IgKGkgPSAxLCBpeiA9IHRoaXMuX19sZWF2ZWxpc3QubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5fX2xlYXZlbGlzdFtpXS5ub2RlKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICAvLyBBUEk6CgkgICAgLy8gcmV0dXJuIGN1cnJlbnQgbm9kZQoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmN1cnJlbnQgPSBmdW5jdGlvbiBjdXJyZW50KCkgewoJICAgICAgICByZXR1cm4gdGhpcy5fX2N1cnJlbnQubm9kZTsKCSAgICB9OwoKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS5fX2V4ZWN1dGUgPSBmdW5jdGlvbiBfX2V4ZWN1dGUoY2FsbGJhY2ssIGVsZW1lbnQpIHsKCSAgICAgICAgdmFyIHByZXZpb3VzLCByZXN1bHQ7CgoJICAgICAgICByZXN1bHQgPSB1bmRlZmluZWQ7CgoJICAgICAgICBwcmV2aW91cyAgPSB0aGlzLl9fY3VycmVudDsKCSAgICAgICAgdGhpcy5fX2N1cnJlbnQgPSBlbGVtZW50OwoJICAgICAgICB0aGlzLl9fc3RhdGUgPSBudWxsOwoJICAgICAgICBpZiAoY2FsbGJhY2spIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IGNhbGxiYWNrLmNhbGwodGhpcywgZWxlbWVudC5ub2RlLCB0aGlzLl9fbGVhdmVsaXN0W3RoaXMuX19sZWF2ZWxpc3QubGVuZ3RoIC0gMV0ubm9kZSk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5fX2N1cnJlbnQgPSBwcmV2aW91czsKCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIG5vdGlmeSBjb250cm9sIHNraXAgLyBicmVhawoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeShmbGFnKSB7CgkgICAgICAgIHRoaXMuX19zdGF0ZSA9IGZsYWc7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIHNraXAgY2hpbGQgbm9kZXMgb2YgY3VycmVudCBub2RlCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUuc2tpcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhpcy5ub3RpZnkoU0tJUCk7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIGJyZWFrIHRyYXZlcnNhbHMKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZVsnYnJlYWsnXSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhpcy5ub3RpZnkoQlJFQUspOwoJICAgIH07CgoJICAgIC8vIEFQSToKCSAgICAvLyByZW1vdmUgbm9kZQoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhpcy5ub3RpZnkoUkVNT1ZFKTsKCSAgICB9OwoKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS5fX2luaXRpYWxpemUgPSBmdW5jdGlvbihyb290LCB2aXNpdG9yKSB7CgkgICAgICAgIHRoaXMudmlzaXRvciA9IHZpc2l0b3I7CgkgICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CgkgICAgICAgIHRoaXMuX193b3JrbGlzdCA9IFtdOwoJICAgICAgICB0aGlzLl9fbGVhdmVsaXN0ID0gW107CgkgICAgICAgIHRoaXMuX19jdXJyZW50ID0gbnVsbDsKCSAgICAgICAgdGhpcy5fX3N0YXRlID0gbnVsbDsKCSAgICAgICAgdGhpcy5fX2ZhbGxiYWNrID0gbnVsbDsKCSAgICAgICAgaWYgKHZpc2l0b3IuZmFsbGJhY2sgPT09ICdpdGVyYXRpb24nKSB7CgkgICAgICAgICAgICB0aGlzLl9fZmFsbGJhY2sgPSBPYmplY3Qua2V5czsKCSAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmlzaXRvci5mYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewoJICAgICAgICAgICAgdGhpcy5fX2ZhbGxiYWNrID0gdmlzaXRvci5mYWxsYmFjazsKCSAgICAgICAgfQoKCSAgICAgICAgdGhpcy5fX2tleXMgPSBWaXNpdG9yS2V5czsKCSAgICAgICAgaWYgKHZpc2l0b3Iua2V5cykgewoJICAgICAgICAgICAgdGhpcy5fX2tleXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUodGhpcy5fX2tleXMpLCB2aXNpdG9yLmtleXMpOwoJICAgICAgICB9CgkgICAgfTsKCgkgICAgZnVuY3Rpb24gaXNOb2RlKG5vZGUpIHsKCSAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0eXBlb2Ygbm9kZSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG5vZGUudHlwZSA9PT0gJ3N0cmluZyc7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBpc1Byb3BlcnR5KG5vZGVUeXBlLCBrZXkpIHsKCSAgICAgICAgcmV0dXJuIChub2RlVHlwZSA9PT0gU3ludGF4Lk9iamVjdEV4cHJlc3Npb24gfHwgbm9kZVR5cGUgPT09IFN5bnRheC5PYmplY3RQYXR0ZXJuKSAmJiAncHJvcGVydGllcycgPT09IGtleTsKCSAgICB9CgkgIAoJICAgIGZ1bmN0aW9uIGNhbmRpZGF0ZUV4aXN0c0luTGVhdmVMaXN0KGxlYXZlbGlzdCwgY2FuZGlkYXRlKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSBsZWF2ZWxpc3QubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKCSAgICAgICAgICAgIGlmIChsZWF2ZWxpc3RbaV0ubm9kZSA9PT0gY2FuZGlkYXRlKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUudHJhdmVyc2UgPSBmdW5jdGlvbiB0cmF2ZXJzZShyb290LCB2aXNpdG9yKSB7CgkgICAgICAgIHZhciB3b3JrbGlzdCwKCSAgICAgICAgICAgIGxlYXZlbGlzdCwKCSAgICAgICAgICAgIGVsZW1lbnQsCgkgICAgICAgICAgICBub2RlLAoJICAgICAgICAgICAgbm9kZVR5cGUsCgkgICAgICAgICAgICByZXQsCgkgICAgICAgICAgICBrZXksCgkgICAgICAgICAgICBjdXJyZW50LAoJICAgICAgICAgICAgY3VycmVudDIsCgkgICAgICAgICAgICBjYW5kaWRhdGVzLAoJICAgICAgICAgICAgY2FuZGlkYXRlLAoJICAgICAgICAgICAgc2VudGluZWw7CgoJICAgICAgICB0aGlzLl9faW5pdGlhbGl6ZShyb290LCB2aXNpdG9yKTsKCgkgICAgICAgIHNlbnRpbmVsID0ge307CgoJICAgICAgICAvLyByZWZlcmVuY2UKCSAgICAgICAgd29ya2xpc3QgPSB0aGlzLl9fd29ya2xpc3Q7CgkgICAgICAgIGxlYXZlbGlzdCA9IHRoaXMuX19sZWF2ZWxpc3Q7CgoJICAgICAgICAvLyBpbml0aWFsaXplCgkgICAgICAgIHdvcmtsaXN0LnB1c2gobmV3IEVsZW1lbnQocm9vdCwgbnVsbCwgbnVsbCwgbnVsbCkpOwoJICAgICAgICBsZWF2ZWxpc3QucHVzaChuZXcgRWxlbWVudChudWxsLCBudWxsLCBudWxsLCBudWxsKSk7CgoJICAgICAgICB3aGlsZSAod29ya2xpc3QubGVuZ3RoKSB7CgkgICAgICAgICAgICBlbGVtZW50ID0gd29ya2xpc3QucG9wKCk7CgoJICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT09IHNlbnRpbmVsKSB7CgkgICAgICAgICAgICAgICAgZWxlbWVudCA9IGxlYXZlbGlzdC5wb3AoKTsKCgkgICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fX2V4ZWN1dGUodmlzaXRvci5sZWF2ZSwgZWxlbWVudCk7CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IEJSRUFLIHx8IHJldCA9PT0gQlJFQUspIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZWxlbWVudC5ub2RlKSB7CgoJICAgICAgICAgICAgICAgIHJldCA9IHRoaXMuX19leGVjdXRlKHZpc2l0b3IuZW50ZXIsIGVsZW1lbnQpOwoKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5fX3N0YXRlID09PSBCUkVBSyB8fCByZXQgPT09IEJSRUFLKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHdvcmtsaXN0LnB1c2goc2VudGluZWwpOwoJICAgICAgICAgICAgICAgIGxlYXZlbGlzdC5wdXNoKGVsZW1lbnQpOwoKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5fX3N0YXRlID09PSBTS0lQIHx8IHJldCA9PT0gU0tJUCkgewoJICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIG5vZGUgPSBlbGVtZW50Lm5vZGU7CgkgICAgICAgICAgICAgICAgbm9kZVR5cGUgPSBub2RlLnR5cGUgfHwgZWxlbWVudC53cmFwOwoJICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSB0aGlzLl9fa2V5c1tub2RlVHlwZV07CgkgICAgICAgICAgICAgICAgaWYgKCFjYW5kaWRhdGVzKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fZmFsbGJhY2spIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSB0aGlzLl9fZmFsbGJhY2sobm9kZSk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbm9kZSB0eXBlICcgKyBub2RlVHlwZSArICcuJyk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjYW5kaWRhdGVzLmxlbmd0aDsKCSAgICAgICAgICAgICAgICB3aGlsZSAoKGN1cnJlbnQgLT0gMSkgPj0gMCkgewoJICAgICAgICAgICAgICAgICAgICBrZXkgPSBjYW5kaWRhdGVzW2N1cnJlbnRdOwoJICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUgPSBub2RlW2tleV07CgkgICAgICAgICAgICAgICAgICAgIGlmICghY2FuZGlkYXRlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2FuZGlkYXRlKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDIgPSBjYW5kaWRhdGUubGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjdXJyZW50MiAtPSAxKSA+PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYW5kaWRhdGVbY3VycmVudDJdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUV4aXN0c0luTGVhdmVMaXN0KGxlYXZlbGlzdCwgY2FuZGlkYXRlW2N1cnJlbnQyXSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUHJvcGVydHkobm9kZVR5cGUsIGNhbmRpZGF0ZXNbY3VycmVudF0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBuZXcgRWxlbWVudChjYW5kaWRhdGVbY3VycmVudDJdLCBba2V5LCBjdXJyZW50Ml0sICdQcm9wZXJ0eScsIG51bGwpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOb2RlKGNhbmRpZGF0ZVtjdXJyZW50Ml0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBuZXcgRWxlbWVudChjYW5kaWRhdGVbY3VycmVudDJdLCBba2V5LCBjdXJyZW50Ml0sIG51bGwsIG51bGwpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrbGlzdC5wdXNoKGVsZW1lbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTm9kZShjYW5kaWRhdGUpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlRXhpc3RzSW5MZWF2ZUxpc3QobGVhdmVsaXN0LCBjYW5kaWRhdGUpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtsaXN0LnB1c2gobmV3IEVsZW1lbnQoY2FuZGlkYXRlLCBrZXksIG51bGwsIG51bGwpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiByZXBsYWNlKHJvb3QsIHZpc2l0b3IpIHsKCSAgICAgICAgdmFyIHdvcmtsaXN0LAoJICAgICAgICAgICAgbGVhdmVsaXN0LAoJICAgICAgICAgICAgbm9kZSwKCSAgICAgICAgICAgIG5vZGVUeXBlLAoJICAgICAgICAgICAgdGFyZ2V0LAoJICAgICAgICAgICAgZWxlbWVudCwKCSAgICAgICAgICAgIGN1cnJlbnQsCgkgICAgICAgICAgICBjdXJyZW50MiwKCSAgICAgICAgICAgIGNhbmRpZGF0ZXMsCgkgICAgICAgICAgICBjYW5kaWRhdGUsCgkgICAgICAgICAgICBzZW50aW5lbCwKCSAgICAgICAgICAgIG91dGVyLAoJICAgICAgICAgICAga2V5OwoKCSAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRWxlbShlbGVtZW50KSB7CgkgICAgICAgICAgICB2YXIgaSwKCSAgICAgICAgICAgICAgICBrZXksCgkgICAgICAgICAgICAgICAgbmV4dEVsZW0sCgkgICAgICAgICAgICAgICAgcGFyZW50OwoKCSAgICAgICAgICAgIGlmIChlbGVtZW50LnJlZi5yZW1vdmUoKSkgewoJICAgICAgICAgICAgICAgIC8vIFdoZW4gdGhlIHJlZmVyZW5jZSBpcyBhbiBlbGVtZW50IG9mIGFuIGFycmF5LgoJICAgICAgICAgICAgICAgIGtleSA9IGVsZW1lbnQucmVmLmtleTsKCSAgICAgICAgICAgICAgICBwYXJlbnQgPSBlbGVtZW50LnJlZi5wYXJlbnQ7CgoJICAgICAgICAgICAgICAgIC8vIElmIHJlbW92ZWQgZnJvbSBhcnJheSwgdGhlbiBkZWNyZWFzZSBmb2xsb3dpbmcgaXRlbXMnIGtleXMuCgkgICAgICAgICAgICAgICAgaSA9IHdvcmtsaXN0Lmxlbmd0aDsKCSAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CgkgICAgICAgICAgICAgICAgICAgIG5leHRFbGVtID0gd29ya2xpc3RbaV07CgkgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0RWxlbS5yZWYgJiYgbmV4dEVsZW0ucmVmLnBhcmVudCA9PT0gcGFyZW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAgKG5leHRFbGVtLnJlZi5rZXkgPCBrZXkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIC0tbmV4dEVsZW0ucmVmLmtleTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgdGhpcy5fX2luaXRpYWxpemUocm9vdCwgdmlzaXRvcik7CgoJICAgICAgICBzZW50aW5lbCA9IHt9OwoKCSAgICAgICAgLy8gcmVmZXJlbmNlCgkgICAgICAgIHdvcmtsaXN0ID0gdGhpcy5fX3dvcmtsaXN0OwoJICAgICAgICBsZWF2ZWxpc3QgPSB0aGlzLl9fbGVhdmVsaXN0OwoKCSAgICAgICAgLy8gaW5pdGlhbGl6ZQoJICAgICAgICBvdXRlciA9IHsKCSAgICAgICAgICAgIHJvb3Q6IHJvb3QKCSAgICAgICAgfTsKCSAgICAgICAgZWxlbWVudCA9IG5ldyBFbGVtZW50KHJvb3QsIG51bGwsIG51bGwsIG5ldyBSZWZlcmVuY2Uob3V0ZXIsICdyb290JykpOwoJICAgICAgICB3b3JrbGlzdC5wdXNoKGVsZW1lbnQpOwoJICAgICAgICBsZWF2ZWxpc3QucHVzaChlbGVtZW50KTsKCgkgICAgICAgIHdoaWxlICh3b3JrbGlzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIGVsZW1lbnQgPSB3b3JrbGlzdC5wb3AoKTsKCgkgICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gc2VudGluZWwpIHsKCSAgICAgICAgICAgICAgICBlbGVtZW50ID0gbGVhdmVsaXN0LnBvcCgpOwoKCSAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLl9fZXhlY3V0ZSh2aXNpdG9yLmxlYXZlLCBlbGVtZW50KTsKCgkgICAgICAgICAgICAgICAgLy8gbm9kZSBtYXkgYmUgcmVwbGFjZWQgd2l0aCBudWxsLAoJICAgICAgICAgICAgICAgIC8vIHNvIGRpc3Rpbmd1aXNoIGJldHdlZW4gdW5kZWZpbmVkIGFuZCBudWxsIGluIHRoaXMgcGxhY2UKCSAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0ICE9PSBCUkVBSyAmJiB0YXJnZXQgIT09IFNLSVAgJiYgdGFyZ2V0ICE9PSBSRU1PVkUpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gcmVwbGFjZQoJICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlZi5yZXBsYWNlKHRhcmdldCk7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5fX3N0YXRlID09PSBSRU1PVkUgfHwgdGFyZ2V0ID09PSBSRU1PVkUpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRWxlbShlbGVtZW50KTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IEJSRUFLIHx8IHRhcmdldCA9PT0gQlJFQUspIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dGVyLnJvb3Q7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHRhcmdldCA9IHRoaXMuX19leGVjdXRlKHZpc2l0b3IuZW50ZXIsIGVsZW1lbnQpOwoKCSAgICAgICAgICAgIC8vIG5vZGUgbWF5IGJlIHJlcGxhY2VkIHdpdGggbnVsbCwKCSAgICAgICAgICAgIC8vIHNvIGRpc3Rpbmd1aXNoIGJldHdlZW4gdW5kZWZpbmVkIGFuZCBudWxsIGluIHRoaXMgcGxhY2UKCSAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXQgIT09IEJSRUFLICYmIHRhcmdldCAhPT0gU0tJUCAmJiB0YXJnZXQgIT09IFJFTU9WRSkgewoJICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UKCSAgICAgICAgICAgICAgICBlbGVtZW50LnJlZi5yZXBsYWNlKHRhcmdldCk7CgkgICAgICAgICAgICAgICAgZWxlbWVudC5ub2RlID0gdGFyZ2V0OwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IFJFTU9WRSB8fCB0YXJnZXQgPT09IFJFTU9WRSkgewoJICAgICAgICAgICAgICAgIHJlbW92ZUVsZW0oZWxlbWVudCk7CgkgICAgICAgICAgICAgICAgZWxlbWVudC5ub2RlID0gbnVsbDsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAodGhpcy5fX3N0YXRlID09PSBCUkVBSyB8fCB0YXJnZXQgPT09IEJSRUFLKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIG91dGVyLnJvb3Q7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gbm9kZSBtYXkgYmUgbnVsbAoJICAgICAgICAgICAgbm9kZSA9IGVsZW1lbnQubm9kZTsKCSAgICAgICAgICAgIGlmICghbm9kZSkgewoJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHdvcmtsaXN0LnB1c2goc2VudGluZWwpOwoJICAgICAgICAgICAgbGVhdmVsaXN0LnB1c2goZWxlbWVudCk7CgoJICAgICAgICAgICAgaWYgKHRoaXMuX19zdGF0ZSA9PT0gU0tJUCB8fCB0YXJnZXQgPT09IFNLSVApIHsKCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBub2RlVHlwZSA9IG5vZGUudHlwZSB8fCBlbGVtZW50LndyYXA7CgkgICAgICAgICAgICBjYW5kaWRhdGVzID0gdGhpcy5fX2tleXNbbm9kZVR5cGVdOwoJICAgICAgICAgICAgaWYgKCFjYW5kaWRhdGVzKSB7CgkgICAgICAgICAgICAgICAgaWYgKHRoaXMuX19mYWxsYmFjaykgewoJICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzID0gdGhpcy5fX2ZhbGxiYWNrKG5vZGUpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGUgJyArIG5vZGVUeXBlICsgJy4nKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgY3VycmVudCA9IGNhbmRpZGF0ZXMubGVuZ3RoOwoJICAgICAgICAgICAgd2hpbGUgKChjdXJyZW50IC09IDEpID49IDApIHsKCSAgICAgICAgICAgICAgICBrZXkgPSBjYW5kaWRhdGVzW2N1cnJlbnRdOwoJICAgICAgICAgICAgICAgIGNhbmRpZGF0ZSA9IG5vZGVba2V5XTsKCSAgICAgICAgICAgICAgICBpZiAoIWNhbmRpZGF0ZSkgewoJICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNhbmRpZGF0ZSkpIHsKCSAgICAgICAgICAgICAgICAgICAgY3VycmVudDIgPSBjYW5kaWRhdGUubGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKGN1cnJlbnQyIC09IDEpID49IDApIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2FuZGlkYXRlW2N1cnJlbnQyXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUHJvcGVydHkobm9kZVR5cGUsIGNhbmRpZGF0ZXNbY3VycmVudF0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IG5ldyBFbGVtZW50KGNhbmRpZGF0ZVtjdXJyZW50Ml0sIFtrZXksIGN1cnJlbnQyXSwgJ1Byb3BlcnR5JywgbmV3IFJlZmVyZW5jZShjYW5kaWRhdGUsIGN1cnJlbnQyKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTm9kZShjYW5kaWRhdGVbY3VycmVudDJdKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBuZXcgRWxlbWVudChjYW5kaWRhdGVbY3VycmVudDJdLCBba2V5LCBjdXJyZW50Ml0sIG51bGwsIG5ldyBSZWZlcmVuY2UoY2FuZGlkYXRlLCBjdXJyZW50MikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtsaXN0LnB1c2goZWxlbWVudCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTm9kZShjYW5kaWRhdGUpKSB7CgkgICAgICAgICAgICAgICAgICAgIHdvcmtsaXN0LnB1c2gobmV3IEVsZW1lbnQoY2FuZGlkYXRlLCBrZXksIG51bGwsIG5ldyBSZWZlcmVuY2Uobm9kZSwga2V5KSkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIG91dGVyLnJvb3Q7CgkgICAgfTsKCgkgICAgZnVuY3Rpb24gdHJhdmVyc2Uocm9vdCwgdmlzaXRvcikgewoJICAgICAgICB2YXIgY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKCk7CgkgICAgICAgIHJldHVybiBjb250cm9sbGVyLnRyYXZlcnNlKHJvb3QsIHZpc2l0b3IpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gcmVwbGFjZShyb290LCB2aXNpdG9yKSB7CgkgICAgICAgIHZhciBjb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIoKTsKCSAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIucmVwbGFjZShyb290LCB2aXNpdG9yKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGV4dGVuZENvbW1lbnRSYW5nZShjb21tZW50LCB0b2tlbnMpIHsKCSAgICAgICAgdmFyIHRhcmdldDsKCgkgICAgICAgIHRhcmdldCA9IHVwcGVyQm91bmQodG9rZW5zLCBmdW5jdGlvbiBzZWFyY2godG9rZW4pIHsKCSAgICAgICAgICAgIHJldHVybiB0b2tlbi5yYW5nZVswXSA+IGNvbW1lbnQucmFuZ2VbMF07CgkgICAgICAgIH0pOwoKCSAgICAgICAgY29tbWVudC5leHRlbmRlZFJhbmdlID0gW2NvbW1lbnQucmFuZ2VbMF0sIGNvbW1lbnQucmFuZ2VbMV1dOwoKCSAgICAgICAgaWYgKHRhcmdldCAhPT0gdG9rZW5zLmxlbmd0aCkgewoJICAgICAgICAgICAgY29tbWVudC5leHRlbmRlZFJhbmdlWzFdID0gdG9rZW5zW3RhcmdldF0ucmFuZ2VbMF07CgkgICAgICAgIH0KCgkgICAgICAgIHRhcmdldCAtPSAxOwoJICAgICAgICBpZiAodGFyZ2V0ID49IDApIHsKCSAgICAgICAgICAgIGNvbW1lbnQuZXh0ZW5kZWRSYW5nZVswXSA9IHRva2Vuc1t0YXJnZXRdLnJhbmdlWzFdOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gY29tbWVudDsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGF0dGFjaENvbW1lbnRzKHRyZWUsIHByb3ZpZGVkQ29tbWVudHMsIHRva2VucykgewoJICAgICAgICAvLyBBdCBmaXJzdCwgd2Ugc2hvdWxkIGNhbGN1bGF0ZSBleHRlbmRlZCBjb21tZW50IHJhbmdlcy4KCSAgICAgICAgdmFyIGNvbW1lbnRzID0gW10sIGNvbW1lbnQsIGxlbiwgaSwgY3Vyc29yOwoKCSAgICAgICAgaWYgKCF0cmVlLnJhbmdlKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2F0dGFjaENvbW1lbnRzIG5lZWRzIHJhbmdlIGluZm9ybWF0aW9uJyk7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIHRva2VucyBhcnJheSBpcyBlbXB0eSwgd2UgYXR0YWNoIGNvbW1lbnRzIHRvIHRyZWUgYXMgJ2xlYWRpbmdDb21tZW50cycKCSAgICAgICAgaWYgKCF0b2tlbnMubGVuZ3RoKSB7CgkgICAgICAgICAgICBpZiAocHJvdmlkZWRDb21tZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBwcm92aWRlZENvbW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBkZWVwQ29weShwcm92aWRlZENvbW1lbnRzW2ldKTsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudC5leHRlbmRlZFJhbmdlID0gWzAsIHRyZWUucmFuZ2VbMF1dOwoJICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5wdXNoKGNvbW1lbnQpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB0cmVlLmxlYWRpbmdDb21tZW50cyA9IGNvbW1lbnRzOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHRyZWU7CgkgICAgICAgIH0KCgkgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHByb3ZpZGVkQ29tbWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsKCSAgICAgICAgICAgIGNvbW1lbnRzLnB1c2goZXh0ZW5kQ29tbWVudFJhbmdlKGRlZXBDb3B5KHByb3ZpZGVkQ29tbWVudHNbaV0pLCB0b2tlbnMpKTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gVGhpcyBpcyBiYXNlZCBvbiBKb2huIEZyZWVtYW4ncyBpbXBsZW1lbnRhdGlvbi4KCSAgICAgICAgY3Vyc29yID0gMDsKCSAgICAgICAgdHJhdmVyc2UodHJlZSwgewoJICAgICAgICAgICAgZW50ZXI6IGZ1bmN0aW9uIChub2RlKSB7CgkgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnQ7CgoJICAgICAgICAgICAgICAgIHdoaWxlIChjdXJzb3IgPCBjb21tZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IGNvbW1lbnRzW2N1cnNvcl07CgkgICAgICAgICAgICAgICAgICAgIGlmIChjb21tZW50LmV4dGVuZGVkUmFuZ2VbMV0gPiBub2RlLnJhbmdlWzBdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnQuZXh0ZW5kZWRSYW5nZVsxXSA9PT0gbm9kZS5yYW5nZVswXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVhZGluZ0NvbW1lbnRzID0gW107CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmxlYWRpbmdDb21tZW50cy5wdXNoKGNvbW1lbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuc3BsaWNlKGN1cnNvciwgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IgKz0gMTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gYWxyZWFkeSBvdXQgb2Ygb3duZWQgbm9kZQoJICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPT09IGNvbW1lbnRzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmlzaXRvck9wdGlvbi5CcmVhazsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChjb21tZW50c1tjdXJzb3JdLmV4dGVuZGVkUmFuZ2VbMF0gPiBub2RlLnJhbmdlWzFdKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBWaXNpdG9yT3B0aW9uLlNraXA7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCgkgICAgICAgIGN1cnNvciA9IDA7CgkgICAgICAgIHRyYXZlcnNlKHRyZWUsIHsKCSAgICAgICAgICAgIGxlYXZlOiBmdW5jdGlvbiAobm9kZSkgewoJICAgICAgICAgICAgICAgIHZhciBjb21tZW50OwoKCSAgICAgICAgICAgICAgICB3aGlsZSAoY3Vyc29yIDwgY29tbWVudHMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBjb21tZW50c1tjdXJzb3JdOwoJICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yYW5nZVsxXSA8IGNvbW1lbnQuZXh0ZW5kZWRSYW5nZVswXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnJhbmdlWzFdID09PSBjb21tZW50LmV4dGVuZGVkUmFuZ2VbMF0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbm9kZS50cmFpbGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS50cmFpbGluZ0NvbW1lbnRzID0gW107CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnRyYWlsaW5nQ29tbWVudHMucHVzaChjb21tZW50KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnNwbGljZShjdXJzb3IsIDEpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yICs9IDE7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgb3V0IG9mIG93bmVkIG5vZGUKCSAgICAgICAgICAgICAgICBpZiAoY3Vyc29yID09PSBjb21tZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpc2l0b3JPcHRpb24uQnJlYWs7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAoY29tbWVudHNbY3Vyc29yXS5leHRlbmRlZFJhbmdlWzBdID4gbm9kZS5yYW5nZVsxXSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmlzaXRvck9wdGlvbi5Ta2lwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSk7CgoJICAgICAgICByZXR1cm4gdHJlZTsKCSAgICB9CgoJICAgIGV4cG9ydHMuU3ludGF4ID0gU3ludGF4OwoJICAgIGV4cG9ydHMudHJhdmVyc2UgPSB0cmF2ZXJzZTsKCSAgICBleHBvcnRzLnJlcGxhY2UgPSByZXBsYWNlOwoJICAgIGV4cG9ydHMuYXR0YWNoQ29tbWVudHMgPSBhdHRhY2hDb21tZW50czsKCSAgICBleHBvcnRzLlZpc2l0b3JLZXlzID0gVmlzaXRvcktleXM7CgkgICAgZXhwb3J0cy5WaXNpdG9yT3B0aW9uID0gVmlzaXRvck9wdGlvbjsKCSAgICBleHBvcnRzLkNvbnRyb2xsZXIgPSBDb250cm9sbGVyOwoJICAgIGV4cG9ydHMuY2xvbmVFbnZpcm9ubWVudCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNsb25lKHt9KTsgfTsKCgkgICAgcmV0dXJuIGV4cG9ydHM7Cgl9KGV4cG9ydHMpKTsKCS8qIHZpbTogc2V0IHN3PTQgdHM9NCBldCB0dz04MCA6ICovIAp9IChlc3RyYXZlcnNlKSk7Cgp2YXIgdXRpbHMgPSB7fTsKCnZhciBhc3QgPSB7ZXhwb3J0czoge319OwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTMgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgoKICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoKICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICdBUyBJUycKICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZCiAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5ECiAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YKICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqLwoKKGZ1bmN0aW9uICgpIHsKCiAgICBmdW5jdGlvbiBpc0V4cHJlc3Npb24obm9kZSkgewogICAgICAgIGlmIChub2RlID09IG51bGwpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnQXJyYXlFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnQXNzaWdubWVudEV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdCaW5hcnlFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnQ2FsbEV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdDb25kaXRpb25hbEV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdGdW5jdGlvbkV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdJZGVudGlmaWVyJzoKICAgICAgICAgICAgY2FzZSAnTGl0ZXJhbCc6CiAgICAgICAgICAgIGNhc2UgJ0xvZ2ljYWxFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnTWVtYmVyRXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ05ld0V4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdPYmplY3RFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnU2VxdWVuY2VFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnVGhpc0V4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdVbmFyeUV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdVcGRhdGVFeHByZXNzaW9uJzoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJdGVyYXRpb25TdGF0ZW1lbnQobm9kZSkgewogICAgICAgIGlmIChub2RlID09IG51bGwpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnRG9XaGlsZVN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0ZvckluU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnRm9yU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnV2hpbGVTdGF0ZW1lbnQnOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1N0YXRlbWVudChub2RlKSB7CiAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBzd2l0Y2ggKG5vZGUudHlwZSkgewogICAgICAgICAgICBjYXNlICdCbG9ja1N0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0JyZWFrU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnQ29udGludWVTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdEZWJ1Z2dlclN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0RvV2hpbGVTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdFbXB0eVN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0V4cHJlc3Npb25TdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdGb3JJblN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0ZvclN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0lmU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnTGFiZWxlZFN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ1JldHVyblN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ1N3aXRjaFN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ1Rocm93U3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnVHJ5U3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnVmFyaWFibGVEZWNsYXJhdGlvbic6CiAgICAgICAgICAgIGNhc2UgJ1doaWxlU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnV2l0aFN0YXRlbWVudCc6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzU291cmNlRWxlbWVudChub2RlKSB7CiAgICAgIHJldHVybiBpc1N0YXRlbWVudChub2RlKSB8fCBub2RlICE9IG51bGwgJiYgbm9kZS50eXBlID09PSAnRnVuY3Rpb25EZWNsYXJhdGlvbic7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhaWxpbmdTdGF0ZW1lbnQobm9kZSkgewogICAgICAgIHN3aXRjaCAobm9kZS50eXBlKSB7CiAgICAgICAgY2FzZSAnSWZTdGF0ZW1lbnQnOgogICAgICAgICAgICBpZiAobm9kZS5hbHRlcm5hdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuYWx0ZXJuYXRlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBub2RlLmNvbnNlcXVlbnQ7CgogICAgICAgIGNhc2UgJ0xhYmVsZWRTdGF0ZW1lbnQnOgogICAgICAgIGNhc2UgJ0ZvclN0YXRlbWVudCc6CiAgICAgICAgY2FzZSAnRm9ySW5TdGF0ZW1lbnQnOgogICAgICAgIGNhc2UgJ1doaWxlU3RhdGVtZW50JzoKICAgICAgICBjYXNlICdXaXRoU3RhdGVtZW50JzoKICAgICAgICAgICAgcmV0dXJuIG5vZGUuYm9keTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gaXNQcm9ibGVtYXRpY0lmU3RhdGVtZW50KG5vZGUpIHsKICAgICAgICB2YXIgY3VycmVudDsKCiAgICAgICAgaWYgKG5vZGUudHlwZSAhPT0gJ0lmU3RhdGVtZW50JykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChub2RlLmFsdGVybmF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgY3VycmVudCA9IG5vZGUuY29uc2VxdWVudDsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChjdXJyZW50LnR5cGUgPT09ICdJZlN0YXRlbWVudCcpIHsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50LmFsdGVybmF0ZSA9PSBudWxsKSAgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnQgPSB0cmFpbGluZ1N0YXRlbWVudChjdXJyZW50KTsKICAgICAgICB9IHdoaWxlIChjdXJyZW50KTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGFzdC5leHBvcnRzID0gewogICAgICAgIGlzRXhwcmVzc2lvbjogaXNFeHByZXNzaW9uLAogICAgICAgIGlzU3RhdGVtZW50OiBpc1N0YXRlbWVudCwKICAgICAgICBpc0l0ZXJhdGlvblN0YXRlbWVudDogaXNJdGVyYXRpb25TdGF0ZW1lbnQsCiAgICAgICAgaXNTb3VyY2VFbGVtZW50OiBpc1NvdXJjZUVsZW1lbnQsCiAgICAgICAgaXNQcm9ibGVtYXRpY0lmU3RhdGVtZW50OiBpc1Byb2JsZW1hdGljSWZTdGF0ZW1lbnQsCgogICAgICAgIHRyYWlsaW5nU3RhdGVtZW50OiB0cmFpbGluZ1N0YXRlbWVudAogICAgfTsKfSgpKTsKLyogdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDogKi8KCnZhciBhc3RFeHBvcnRzID0gYXN0LmV4cG9ydHM7Cgp2YXIgY29kZSQxID0ge2V4cG9ydHM6IHt9fTsKCi8qCiAgQ29weXJpZ2h0IChDKSAyMDEzLTIwMTQgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxNCBJdmFuIE5pa3VsaW4gPGlmYWFhbkBnbWFpbC5jb20+CgogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTlkKICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsKICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRgogIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCgooZnVuY3Rpb24gKCkgewoKICAgIHZhciBFUzZSZWdleCwgRVM1UmVnZXgsIE5PTl9BU0NJSV9XSElURVNQQUNFUywgSURFTlRJRklFUl9TVEFSVCwgSURFTlRJRklFUl9QQVJULCBjaDsKCiAgICAvLyBTZWUgYHRvb2xzL2dlbmVyYXRlLWlkZW50aWZpZXItcmVnZXguanNgLgogICAgRVM1UmVnZXggPSB7CiAgICAgICAgLy8gRUNNQVNjcmlwdCA1LjEvVW5pY29kZSB2OS4wLjAgTm9uQXNjaWlJZGVudGlmaWVyU3RhcnQ6CiAgICAgICAgTm9uQXNjaWlJZGVudGlmaWVyU3RhcnQ6IC9bXHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDM3MC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjIwLVx1MDY0QVx1MDY2RVx1MDY2Rlx1MDY3MS1cdTA2RDNcdTA2RDVcdTA2RTVcdTA2RTZcdTA2RUVcdTA2RUZcdTA2RkEtXHUwNkZDXHUwNkZGXHUwNzEwXHUwNzEyLVx1MDcyRlx1MDc0RC1cdTA3QTVcdTA3QjFcdTA3Q0EtXHUwN0VBXHUwN0Y0XHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgxNVx1MDgxQVx1MDgyNFx1MDgyOFx1MDg0MC1cdTA4NThcdTA4QTAtXHUwOEI0XHUwOEI2LVx1MDhCRFx1MDkwNC1cdTA5MzlcdTA5M0RcdTA5NTBcdTA5NTgtXHUwOTYxXHUwOTcxLVx1MDk4MFx1MDk4NS1cdTA5OENcdTA5OEZcdTA5OTBcdTA5OTMtXHUwOUE4XHUwOUFBLVx1MDlCMFx1MDlCMlx1MDlCNi1cdTA5QjlcdTA5QkRcdTA5Q0VcdTA5RENcdTA5RERcdTA5REYtXHUwOUUxXHUwOUYwXHUwOUYxXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTU5LVx1MEE1Q1x1MEE1RVx1MEE3Mi1cdTBBNzRcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCRFx1MEFEMFx1MEFFMFx1MEFFMVx1MEFGOVx1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0RcdTBCNUNcdTBCNURcdTBCNUYtXHUwQjYxXHUwQjcxXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCRDBcdTBDMDUtXHUwQzBDXHUwQzBFLVx1MEMxMFx1MEMxMi1cdTBDMjhcdTBDMkEtXHUwQzM5XHUwQzNEXHUwQzU4LVx1MEM1QVx1MEM2MFx1MEM2MVx1MEM4MFx1MEM4NS1cdTBDOENcdTBDOEUtXHUwQzkwXHUwQzkyLVx1MENBOFx1MENBQS1cdTBDQjNcdTBDQjUtXHUwQ0I5XHUwQ0JEXHUwQ0RFXHUwQ0UwXHUwQ0UxXHUwQ0YxXHUwQ0YyXHUwRDA1LVx1MEQwQ1x1MEQwRS1cdTBEMTBcdTBEMTItXHUwRDNBXHUwRDNEXHUwRDRFXHUwRDU0LVx1MEQ1Nlx1MEQ1Ri1cdTBENjFcdTBEN0EtXHUwRDdGXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MEUwMS1cdTBFMzBcdTBFMzJcdTBFMzNcdTBFNDAtXHUwRTQ2XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCMFx1MEVCMlx1MEVCM1x1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFREMtXHUwRURGXHUwRjAwXHUwRjQwLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGODgtXHUwRjhDXHUxMDAwLVx1MTAyQVx1MTAzRlx1MTA1MC1cdTEwNTVcdTEwNUEtXHUxMDVEXHUxMDYxXHUxMDY1XHUxMDY2XHUxMDZFLVx1MTA3MFx1MTA3NS1cdTEwODFcdTEwOEVcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxMVx1MTcyMC1cdTE3MzFcdTE3NDAtXHUxNzUxXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3ODAtXHUxN0IzXHUxN0Q3XHUxN0RDXHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4ODRcdTE4ODctXHUxOEE4XHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5NTAtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QjAtXHUxOUM5XHUxQTAwLVx1MUExNlx1MUEyMC1cdTFBNTRcdTFBQTdcdTFCMDUtXHUxQjMzXHUxQjQ1LVx1MUI0Qlx1MUI4My1cdTFCQTBcdTFCQUVcdTFCQUZcdTFCQkEtXHUxQkU1XHUxQzAwLVx1MUMyM1x1MUM0RC1cdTFDNEZcdTFDNUEtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNFOS1cdTFDRUNcdTFDRUUtXHUxQ0YxXHUxQ0Y1XHUxQ0Y2XHUxRDAwLVx1MURCRlx1MUUwMC1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE5LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMkRcdTIxMkYtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNFRVx1MkNGMlx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDgwLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUyRTJGXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMjlcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOUQtXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FFXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdLywKICAgICAgICAvLyBFQ01BU2NyaXB0IDUuMS9Vbmljb2RlIHY5LjAuMCBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OgogICAgICAgIE5vbkFzY2lpSWRlbnRpZmllclBhcnQ6IC9bXHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDMwMC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4My1cdTA0ODdcdTA0OEEtXHUwNTJGXHUwNTMxLVx1MDU1Nlx1MDU1OVx1MDU2MS1cdTA1ODdcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MTAtXHUwNjFBXHUwNjIwLVx1MDY2OVx1MDY2RS1cdTA2RDNcdTA2RDUtXHUwNkRDXHUwNkRGLVx1MDZFOFx1MDZFQS1cdTA2RkNcdTA2RkZcdTA3MTAtXHUwNzRBXHUwNzRELVx1MDdCMVx1MDdDMC1cdTA3RjVcdTA3RkFcdTA4MDAtXHUwODJEXHUwODQwLVx1MDg1Qlx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOEQ0LVx1MDhFMVx1MDhFMy1cdTA5NjNcdTA5NjYtXHUwOTZGXHUwOTcxLVx1MDk4M1x1MDk4NS1cdTA5OENcdTA5OEZcdTA5OTBcdTA5OTMtXHUwOUE4XHUwOUFBLVx1MDlCMFx1MDlCMlx1MDlCNi1cdTA5QjlcdTA5QkMtXHUwOUM0XHUwOUM3XHUwOUM4XHUwOUNCLVx1MDlDRVx1MDlEN1x1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTNcdTA5RTYtXHUwOUYxXHUwQTAxLVx1MEEwM1x1MEEwNS1cdTBBMEFcdTBBMEZcdTBBMTBcdTBBMTMtXHUwQTI4XHUwQTJBLVx1MEEzMFx1MEEzMlx1MEEzM1x1MEEzNVx1MEEzNlx1MEEzOFx1MEEzOVx1MEEzQ1x1MEEzRS1cdTBBNDJcdTBBNDdcdTBBNDhcdTBBNEItXHUwQTREXHUwQTUxXHUwQTU5LVx1MEE1Q1x1MEE1RVx1MEE2Ni1cdTBBNzVcdTBBODEtXHUwQTgzXHUwQTg1LVx1MEE4RFx1MEE4Ri1cdTBBOTFcdTBBOTMtXHUwQUE4XHUwQUFBLVx1MEFCMFx1MEFCMlx1MEFCM1x1MEFCNS1cdTBBQjlcdTBBQkMtXHUwQUM1XHUwQUM3LVx1MEFDOVx1MEFDQi1cdTBBQ0RcdTBBRDBcdTBBRTAtXHUwQUUzXHUwQUU2LVx1MEFFRlx1MEFGOVx1MEIwMS1cdTBCMDNcdTBCMDUtXHUwQjBDXHUwQjBGXHUwQjEwXHUwQjEzLVx1MEIyOFx1MEIyQS1cdTBCMzBcdTBCMzJcdTBCMzNcdTBCMzUtXHUwQjM5XHUwQjNDLVx1MEI0NFx1MEI0N1x1MEI0OFx1MEI0Qi1cdTBCNERcdTBCNTZcdTBCNTdcdTBCNUNcdTBCNURcdTBCNUYtXHUwQjYzXHUwQjY2LVx1MEI2Rlx1MEI3MVx1MEI4Mlx1MEI4M1x1MEI4NS1cdTBCOEFcdTBCOEUtXHUwQjkwXHUwQjkyLVx1MEI5NVx1MEI5OVx1MEI5QVx1MEI5Q1x1MEI5RVx1MEI5Rlx1MEJBM1x1MEJBNFx1MEJBOC1cdTBCQUFcdTBCQUUtXHUwQkI5XHUwQkJFLVx1MEJDMlx1MEJDNi1cdTBCQzhcdTBCQ0EtXHUwQkNEXHUwQkQwXHUwQkQ3XHUwQkU2LVx1MEJFRlx1MEMwMC1cdTBDMDNcdTBDMDUtXHUwQzBDXHUwQzBFLVx1MEMxMFx1MEMxMi1cdTBDMjhcdTBDMkEtXHUwQzM5XHUwQzNELVx1MEM0NFx1MEM0Ni1cdTBDNDhcdTBDNEEtXHUwQzREXHUwQzU1XHUwQzU2XHUwQzU4LVx1MEM1QVx1MEM2MC1cdTBDNjNcdTBDNjYtXHUwQzZGXHUwQzgwLVx1MEM4M1x1MEM4NS1cdTBDOENcdTBDOEUtXHUwQzkwXHUwQzkyLVx1MENBOFx1MENBQS1cdTBDQjNcdTBDQjUtXHUwQ0I5XHUwQ0JDLVx1MENDNFx1MENDNi1cdTBDQzhcdTBDQ0EtXHUwQ0NEXHUwQ0Q1XHUwQ0Q2XHUwQ0RFXHUwQ0UwLVx1MENFM1x1MENFNi1cdTBDRUZcdTBDRjFcdTBDRjJcdTBEMDEtXHUwRDAzXHUwRDA1LVx1MEQwQ1x1MEQwRS1cdTBEMTBcdTBEMTItXHUwRDNBXHUwRDNELVx1MEQ0NFx1MEQ0Ni1cdTBENDhcdTBENEEtXHUwRDRFXHUwRDU0LVx1MEQ1N1x1MEQ1Ri1cdTBENjNcdTBENjYtXHUwRDZGXHUwRDdBLVx1MEQ3Rlx1MEQ4Mlx1MEQ4M1x1MEQ4NS1cdTBEOTZcdTBEOUEtXHUwREIxXHUwREIzLVx1MERCQlx1MERCRFx1MERDMC1cdTBEQzZcdTBEQ0FcdTBEQ0YtXHUwREQ0XHUwREQ2XHUwREQ4LVx1MERERlx1MERFNi1cdTBERUZcdTBERjJcdTBERjNcdTBFMDEtXHUwRTNBXHUwRTQwLVx1MEU0RVx1MEU1MC1cdTBFNTlcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUI5XHUwRUJCLVx1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFQzgtXHUwRUNEXHUwRUQwLVx1MEVEOVx1MEVEQy1cdTBFREZcdTBGMDBcdTBGMThcdTBGMTlcdTBGMjAtXHUwRjI5XHUwRjM1XHUwRjM3XHUwRjM5XHUwRjNFLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGNzEtXHUwRjg0XHUwRjg2LVx1MEY5N1x1MEY5OS1cdTBGQkNcdTBGQzZcdTEwMDAtXHUxMDQ5XHUxMDUwLVx1MTA5RFx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzNUQtXHUxMzVGXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxNFx1MTcyMC1cdTE3MzRcdTE3NDAtXHUxNzUzXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3NzJcdTE3NzNcdTE3ODAtXHUxN0QzXHUxN0Q3XHUxN0RDXHUxN0REXHUxN0UwLVx1MTdFOVx1MTgwQi1cdTE4MERcdTE4MTAtXHUxODE5XHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MTlEMC1cdTE5RDlcdTFBMDAtXHUxQTFCXHUxQTIwLVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFBN1x1MUFCMC1cdTFBQkRcdTFCMDAtXHUxQjRCXHUxQjUwLVx1MUI1OVx1MUI2Qi1cdTFCNzNcdTFCODAtXHUxQkYzXHUxQzAwLVx1MUMzN1x1MUM0MC1cdTFDNDlcdTFDNEQtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNEMC1cdTFDRDJcdTFDRDQtXHUxQ0Y2XHUxQ0Y4XHUxQ0Y5XHUxRDAwLVx1MURGNVx1MURGQi1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjAwQ1x1MjAwRFx1MjAzRlx1MjA0MFx1MjA1NFx1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIwRDAtXHUyMERDXHUyMEUxXHUyMEU1LVx1MjBGMFx1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTktXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEyRFx1MjEyRi1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEN0YtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJERTAtXHUyREZGXHUyRTJGXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMkZcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOTlcdTMwOUFcdTMwOUQtXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjJCXHVBNjQwLVx1QTY2Rlx1QTY3NC1cdUE2N0RcdUE2N0YtXHVBNkYxXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FFXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MjdcdUE4NDAtXHVBODczXHVBODgwLVx1QThDNVx1QThEMC1cdUE4RDlcdUE4RTAtXHVBOEY3XHVBOEZCXHVBOEZEXHVBOTAwLVx1QTkyRFx1QTkzMC1cdUE5NTNcdUE5NjAtXHVBOTdDXHVBOTgwLVx1QTlDMFx1QTlDRi1cdUE5RDlcdUE5RTAtXHVBOUZFXHVBQTAwLVx1QUEzNlx1QUE0MC1cdUFBNERcdUFBNTAtXHVBQTU5XHVBQTYwLVx1QUE3Nlx1QUE3QS1cdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFRlx1QUFGMi1cdUFBRjZcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFQVx1QUJFQ1x1QUJFRFx1QUJGMC1cdUFCRjlcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFELVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFMDAtXHVGRTBGXHVGRTIwLVx1RkUyRlx1RkUzM1x1RkUzNFx1RkU0RC1cdUZFNEZcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYxMC1cdUZGMTlcdUZGMjEtXHVGRjNBXHVGRjNGXHVGRjQxLVx1RkY1QVx1RkY2Ni1cdUZGQkVcdUZGQzItXHVGRkM3XHVGRkNBLVx1RkZDRlx1RkZEMi1cdUZGRDdcdUZGREEtXHVGRkRDXS8KICAgIH07CgogICAgRVM2UmVnZXggPSB7CiAgICAgICAgLy8gRUNNQVNjcmlwdCA2L1VuaWNvZGUgdjkuMC4wIE5vbkFzY2lpSWRlbnRpZmllclN0YXJ0OgogICAgICAgIE5vbkFzY2lpSWRlbnRpZmllclN0YXJ0OiAvW1x4QUFceEI1XHhCQVx4QzAtXHhENlx4RDgtXHhGNlx4RjgtXHUwMkMxXHUwMkM2LVx1MDJEMVx1MDJFMC1cdTAyRTRcdTAyRUNcdTAyRUVcdTAzNzAtXHUwMzc0XHUwMzc2XHUwMzc3XHUwMzdBLVx1MDM3RFx1MDM3Rlx1MDM4Nlx1MDM4OC1cdTAzOEFcdTAzOENcdTAzOEUtXHUwM0ExXHUwM0EzLVx1MDNGNVx1MDNGNy1cdTA0ODFcdTA0OEEtXHUwNTJGXHUwNTMxLVx1MDU1Nlx1MDU1OVx1MDU2MS1cdTA1ODdcdTA1RDAtXHUwNUVBXHUwNUYwLVx1MDVGMlx1MDYyMC1cdTA2NEFcdTA2NkVcdTA2NkZcdTA2NzEtXHUwNkQzXHUwNkQ1XHUwNkU1XHUwNkU2XHUwNkVFXHUwNkVGXHUwNkZBLVx1MDZGQ1x1MDZGRlx1MDcxMFx1MDcxMi1cdTA3MkZcdTA3NEQtXHUwN0E1XHUwN0IxXHUwN0NBLVx1MDdFQVx1MDdGNFx1MDdGNVx1MDdGQVx1MDgwMC1cdTA4MTVcdTA4MUFcdTA4MjRcdTA4MjhcdTA4NDAtXHUwODU4XHUwOEEwLVx1MDhCNFx1MDhCNi1cdTA4QkRcdTA5MDQtXHUwOTM5XHUwOTNEXHUwOTUwXHUwOTU4LVx1MDk2MVx1MDk3MS1cdTA5ODBcdTA5ODUtXHUwOThDXHUwOThGXHUwOTkwXHUwOTkzLVx1MDlBOFx1MDlBQS1cdTA5QjBcdTA5QjJcdTA5QjYtXHUwOUI5XHUwOUJEXHUwOUNFXHUwOURDXHUwOUREXHUwOURGLVx1MDlFMVx1MDlGMFx1MDlGMVx1MEEwNS1cdTBBMEFcdTBBMEZcdTBBMTBcdTBBMTMtXHUwQTI4XHUwQTJBLVx1MEEzMFx1MEEzMlx1MEEzM1x1MEEzNVx1MEEzNlx1MEEzOFx1MEEzOVx1MEE1OS1cdTBBNUNcdTBBNUVcdTBBNzItXHUwQTc0XHUwQTg1LVx1MEE4RFx1MEE4Ri1cdTBBOTFcdTBBOTMtXHUwQUE4XHUwQUFBLVx1MEFCMFx1MEFCMlx1MEFCM1x1MEFCNS1cdTBBQjlcdTBBQkRcdTBBRDBcdTBBRTBcdTBBRTFcdTBBRjlcdTBCMDUtXHUwQjBDXHUwQjBGXHUwQjEwXHUwQjEzLVx1MEIyOFx1MEIyQS1cdTBCMzBcdTBCMzJcdTBCMzNcdTBCMzUtXHUwQjM5XHUwQjNEXHUwQjVDXHUwQjVEXHUwQjVGLVx1MEI2MVx1MEI3MVx1MEI4M1x1MEI4NS1cdTBCOEFcdTBCOEUtXHUwQjkwXHUwQjkyLVx1MEI5NVx1MEI5OVx1MEI5QVx1MEI5Q1x1MEI5RVx1MEI5Rlx1MEJBM1x1MEJBNFx1MEJBOC1cdTBCQUFcdTBCQUUtXHUwQkI5XHUwQkQwXHUwQzA1LVx1MEMwQ1x1MEMwRS1cdTBDMTBcdTBDMTItXHUwQzI4XHUwQzJBLVx1MEMzOVx1MEMzRFx1MEM1OC1cdTBDNUFcdTBDNjBcdTBDNjFcdTBDODBcdTBDODUtXHUwQzhDXHUwQzhFLVx1MEM5MFx1MEM5Mi1cdTBDQThcdTBDQUEtXHUwQ0IzXHUwQ0I1LVx1MENCOVx1MENCRFx1MENERVx1MENFMFx1MENFMVx1MENGMVx1MENGMlx1MEQwNS1cdTBEMENcdTBEMEUtXHUwRDEwXHUwRDEyLVx1MEQzQVx1MEQzRFx1MEQ0RVx1MEQ1NC1cdTBENTZcdTBENUYtXHUwRDYxXHUwRDdBLVx1MEQ3Rlx1MEQ4NS1cdTBEOTZcdTBEOUEtXHUwREIxXHUwREIzLVx1MERCQlx1MERCRFx1MERDMC1cdTBEQzZcdTBFMDEtXHUwRTMwXHUwRTMyXHUwRTMzXHUwRTQwLVx1MEU0Nlx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjBcdTBFQjJcdTBFQjNcdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRURDLVx1MEVERlx1MEYwMFx1MEY0MC1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjg4LVx1MEY4Q1x1MTAwMC1cdTEwMkFcdTEwM0ZcdTEwNTAtXHUxMDU1XHUxMDVBLVx1MTA1RFx1MTA2MVx1MTA2NVx1MTA2Nlx1MTA2RS1cdTEwNzBcdTEwNzUtXHUxMDgxXHUxMDhFXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTFcdTE3MjAtXHUxNzMxXHUxNzQwLVx1MTc1MVx1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzgwLVx1MTdCM1x1MTdEN1x1MTdEQ1x1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEE4XHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5NTAtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QjAtXHUxOUM5XHUxQTAwLVx1MUExNlx1MUEyMC1cdTFBNTRcdTFBQTdcdTFCMDUtXHUxQjMzXHUxQjQ1LVx1MUI0Qlx1MUI4My1cdTFCQTBcdTFCQUVcdTFCQUZcdTFCQkEtXHUxQkU1XHUxQzAwLVx1MUMyM1x1MUM0RC1cdTFDNEZcdTFDNUEtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNFOS1cdTFDRUNcdTFDRUUtXHUxQ0YxXHUxQ0Y1XHUxQ0Y2XHUxRDAwLVx1MURCRlx1MUUwMC1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE4LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0VFXHUyQ0YyXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEODAtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyOVx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5Qi1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MUZcdUE2MkFcdUE2MkJcdUE2NDAtXHVBNjZFXHVBNjdGLVx1QTY5RFx1QTZBMC1cdUE2RUZcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgwMVx1QTgwMy1cdUE4MDVcdUE4MDctXHVBODBBXHVBODBDLVx1QTgyMlx1QTg0MC1cdUE4NzNcdUE4ODItXHVBOEIzXHVBOEYyLVx1QThGN1x1QThGQlx1QThGRFx1QTkwQS1cdUE5MjVcdUE5MzAtXHVBOTQ2XHVBOTYwLVx1QTk3Q1x1QTk4NC1cdUE5QjJcdUE5Q0ZcdUE5RTAtXHVBOUU0XHVBOUU2LVx1QTlFRlx1QTlGQS1cdUE5RkVcdUFBMDAtXHVBQTI4XHVBQTQwLVx1QUE0Mlx1QUE0NC1cdUFBNEJcdUFBNjAtXHVBQTc2XHVBQTdBXHVBQTdFLVx1QUFBRlx1QUFCMVx1QUFCNVx1QUFCNlx1QUFCOS1cdUFBQkRcdUFBQzBcdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFQVx1QUFGMi1cdUFBRjRcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFMlx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMURcdUZCMUYtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjIxLVx1RkYzQVx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ118XHVEODAwW1x1REMwMC1cdURDMEJcdURDMEQtXHVEQzI2XHVEQzI4LVx1REMzQVx1REMzQ1x1REMzRFx1REMzRi1cdURDNERcdURDNTAtXHVEQzVEXHVEQzgwLVx1RENGQVx1REQ0MC1cdURENzRcdURFODAtXHVERTlDXHVERUEwLVx1REVEMFx1REYwMC1cdURGMUZcdURGMzAtXHVERjRBXHVERjUwLVx1REY3NVx1REY4MC1cdURGOURcdURGQTAtXHVERkMzXHVERkM4LVx1REZDRlx1REZEMS1cdURGRDVdfFx1RDgwMVtcdURDMDAtXHVEQzlEXHVEQ0IwLVx1RENEM1x1RENEOC1cdURDRkJcdUREMDAtXHVERDI3XHVERDMwLVx1REQ2M1x1REUwMC1cdURGMzZcdURGNDAtXHVERjU1XHVERjYwLVx1REY2N118XHVEODAyW1x1REMwMC1cdURDMDVcdURDMDhcdURDMEEtXHVEQzM1XHVEQzM3XHVEQzM4XHVEQzNDXHVEQzNGLVx1REM1NVx1REM2MC1cdURDNzZcdURDODAtXHVEQzlFXHVEQ0UwLVx1RENGMlx1RENGNFx1RENGNVx1REQwMC1cdUREMTVcdUREMjAtXHVERDM5XHVERDgwLVx1RERCN1x1RERCRVx1RERCRlx1REUwMFx1REUxMC1cdURFMTNcdURFMTUtXHVERTE3XHVERTE5LVx1REUzM1x1REU2MC1cdURFN0NcdURFODAtXHVERTlDXHVERUMwLVx1REVDN1x1REVDOS1cdURFRTRcdURGMDAtXHVERjM1XHVERjQwLVx1REY1NVx1REY2MC1cdURGNzJcdURGODAtXHVERjkxXXxcdUQ4MDNbXHVEQzAwLVx1REM0OFx1REM4MC1cdURDQjJcdURDQzAtXHVEQ0YyXXxcdUQ4MDRbXHVEQzAzLVx1REMzN1x1REM4My1cdURDQUZcdURDRDAtXHVEQ0U4XHVERDAzLVx1REQyNlx1REQ1MC1cdURENzJcdURENzZcdUREODMtXHVEREIyXHVEREMxLVx1RERDNFx1REREQVx1REREQ1x1REUwMC1cdURFMTFcdURFMTMtXHVERTJCXHVERTgwLVx1REU4Nlx1REU4OFx1REU4QS1cdURFOERcdURFOEYtXHVERTlEXHVERTlGLVx1REVBOFx1REVCMC1cdURFREVcdURGMDUtXHVERjBDXHVERjBGXHVERjEwXHVERjEzLVx1REYyOFx1REYyQS1cdURGMzBcdURGMzJcdURGMzNcdURGMzUtXHVERjM5XHVERjNEXHVERjUwXHVERjVELVx1REY2MV18XHVEODA1W1x1REMwMC1cdURDMzRcdURDNDctXHVEQzRBXHVEQzgwLVx1RENBRlx1RENDNFx1RENDNVx1RENDN1x1REQ4MC1cdUREQUVcdURERDgtXHVERERCXHVERTAwLVx1REUyRlx1REU0NFx1REU4MC1cdURFQUFcdURGMDAtXHVERjE5XXxcdUQ4MDZbXHVEQ0EwLVx1RENERlx1RENGRlx1REVDMC1cdURFRjhdfFx1RDgwN1tcdURDMDAtXHVEQzA4XHVEQzBBLVx1REMyRVx1REM0MFx1REM3Mi1cdURDOEZdfFx1RDgwOFtcdURDMDAtXHVERjk5XXxcdUQ4MDlbXHVEQzAwLVx1REM2RVx1REM4MC1cdURENDNdfFtcdUQ4MENcdUQ4MUMtXHVEODIwXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REVEMC1cdURFRURcdURGMDAtXHVERjJGXHVERjQwLVx1REY0M1x1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MFx1REY5My1cdURGOUZcdURGRTBdfFx1RDgyMVtcdURDMDAtXHVERkVDXXxcdUQ4MjJbXHVEQzAwLVx1REVGMl18XHVEODJDW1x1REMwMFx1REMwMV18XHVEODJGW1x1REMwMC1cdURDNkFcdURDNzAtXHVEQzdDXHVEQzgwLVx1REM4OFx1REM5MC1cdURDOTldfFx1RDgzNVtcdURDMDAtXHVEQzU0XHVEQzU2LVx1REM5Q1x1REM5RVx1REM5Rlx1RENBMlx1RENBNVx1RENBNlx1RENBOS1cdURDQUNcdURDQUUtXHVEQ0I5XHVEQ0JCXHVEQ0JELVx1RENDM1x1RENDNS1cdUREMDVcdUREMDctXHVERDBBXHVERDBELVx1REQxNFx1REQxNi1cdUREMUNcdUREMUUtXHVERDM5XHVERDNCLVx1REQzRVx1REQ0MC1cdURENDRcdURENDZcdURENEEtXHVERDUwXHVERDUyLVx1REVBNVx1REVBOC1cdURFQzBcdURFQzItXHVERURBXHVERURDLVx1REVGQVx1REVGQy1cdURGMTRcdURGMTYtXHVERjM0XHVERjM2LVx1REY0RVx1REY1MC1cdURGNkVcdURGNzAtXHVERjg4XHVERjhBLVx1REZBOFx1REZBQS1cdURGQzJcdURGQzQtXHVERkNCXXxcdUQ4M0FbXHVEQzAwLVx1RENDNFx1REQwMC1cdURENDNdfFx1RDgzQltcdURFMDAtXHVERTAzXHVERTA1LVx1REUxRlx1REUyMVx1REUyMlx1REUyNFx1REUyN1x1REUyOS1cdURFMzJcdURFMzQtXHVERTM3XHVERTM5XHVERTNCXHVERTQyXHVERTQ3XHVERTQ5XHVERTRCXHVERTRELVx1REU0Rlx1REU1MVx1REU1Mlx1REU1NFx1REU1N1x1REU1OVx1REU1Qlx1REU1RFx1REU1Rlx1REU2MVx1REU2Mlx1REU2NFx1REU2Ny1cdURFNkFcdURFNkMtXHVERTcyXHVERTc0LVx1REU3N1x1REU3OS1cdURFN0NcdURFN0VcdURFODAtXHVERTg5XHVERThCLVx1REU5Qlx1REVBMS1cdURFQTNcdURFQTUtXHVERUE5XHVERUFCLVx1REVCQl18XHVEODY5W1x1REMwMC1cdURFRDZcdURGMDAtXHVERkZGXXxcdUQ4NkRbXHVEQzAwLVx1REYzNFx1REY0MC1cdURGRkZdfFx1RDg2RVtcdURDMDAtXHVEQzFEXHVEQzIwLVx1REZGRl18XHVEODczW1x1REMwMC1cdURFQTFdfFx1RDg3RVtcdURDMDAtXHVERTFEXS8sCiAgICAgICAgLy8gRUNNQVNjcmlwdCA2L1VuaWNvZGUgdjkuMC4wIE5vbkFzY2lpSWRlbnRpZmllclBhcnQ6CiAgICAgICAgTm9uQXNjaWlJZGVudGlmaWVyUGFydDogL1tceEFBXHhCNVx4QjdceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDMwMC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4My1cdTA0ODdcdTA0OEEtXHUwNTJGXHUwNTMxLVx1MDU1Nlx1MDU1OVx1MDU2MS1cdTA1ODdcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MTAtXHUwNjFBXHUwNjIwLVx1MDY2OVx1MDY2RS1cdTA2RDNcdTA2RDUtXHUwNkRDXHUwNkRGLVx1MDZFOFx1MDZFQS1cdTA2RkNcdTA2RkZcdTA3MTAtXHUwNzRBXHUwNzRELVx1MDdCMVx1MDdDMC1cdTA3RjVcdTA3RkFcdTA4MDAtXHUwODJEXHUwODQwLVx1MDg1Qlx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOEQ0LVx1MDhFMVx1MDhFMy1cdTA5NjNcdTA5NjYtXHUwOTZGXHUwOTcxLVx1MDk4M1x1MDk4NS1cdTA5OENcdTA5OEZcdTA5OTBcdTA5OTMtXHUwOUE4XHUwOUFBLVx1MDlCMFx1MDlCMlx1MDlCNi1cdTA5QjlcdTA5QkMtXHUwOUM0XHUwOUM3XHUwOUM4XHUwOUNCLVx1MDlDRVx1MDlEN1x1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTNcdTA5RTYtXHUwOUYxXHUwQTAxLVx1MEEwM1x1MEEwNS1cdTBBMEFcdTBBMEZcdTBBMTBcdTBBMTMtXHUwQTI4XHUwQTJBLVx1MEEzMFx1MEEzMlx1MEEzM1x1MEEzNVx1MEEzNlx1MEEzOFx1MEEzOVx1MEEzQ1x1MEEzRS1cdTBBNDJcdTBBNDdcdTBBNDhcdTBBNEItXHUwQTREXHUwQTUxXHUwQTU5LVx1MEE1Q1x1MEE1RVx1MEE2Ni1cdTBBNzVcdTBBODEtXHUwQTgzXHUwQTg1LVx1MEE4RFx1MEE4Ri1cdTBBOTFcdTBBOTMtXHUwQUE4XHUwQUFBLVx1MEFCMFx1MEFCMlx1MEFCM1x1MEFCNS1cdTBBQjlcdTBBQkMtXHUwQUM1XHUwQUM3LVx1MEFDOVx1MEFDQi1cdTBBQ0RcdTBBRDBcdTBBRTAtXHUwQUUzXHUwQUU2LVx1MEFFRlx1MEFGOVx1MEIwMS1cdTBCMDNcdTBCMDUtXHUwQjBDXHUwQjBGXHUwQjEwXHUwQjEzLVx1MEIyOFx1MEIyQS1cdTBCMzBcdTBCMzJcdTBCMzNcdTBCMzUtXHUwQjM5XHUwQjNDLVx1MEI0NFx1MEI0N1x1MEI0OFx1MEI0Qi1cdTBCNERcdTBCNTZcdTBCNTdcdTBCNUNcdTBCNURcdTBCNUYtXHUwQjYzXHUwQjY2LVx1MEI2Rlx1MEI3MVx1MEI4Mlx1MEI4M1x1MEI4NS1cdTBCOEFcdTBCOEUtXHUwQjkwXHUwQjkyLVx1MEI5NVx1MEI5OVx1MEI5QVx1MEI5Q1x1MEI5RVx1MEI5Rlx1MEJBM1x1MEJBNFx1MEJBOC1cdTBCQUFcdTBCQUUtXHUwQkI5XHUwQkJFLVx1MEJDMlx1MEJDNi1cdTBCQzhcdTBCQ0EtXHUwQkNEXHUwQkQwXHUwQkQ3XHUwQkU2LVx1MEJFRlx1MEMwMC1cdTBDMDNcdTBDMDUtXHUwQzBDXHUwQzBFLVx1MEMxMFx1MEMxMi1cdTBDMjhcdTBDMkEtXHUwQzM5XHUwQzNELVx1MEM0NFx1MEM0Ni1cdTBDNDhcdTBDNEEtXHUwQzREXHUwQzU1XHUwQzU2XHUwQzU4LVx1MEM1QVx1MEM2MC1cdTBDNjNcdTBDNjYtXHUwQzZGXHUwQzgwLVx1MEM4M1x1MEM4NS1cdTBDOENcdTBDOEUtXHUwQzkwXHUwQzkyLVx1MENBOFx1MENBQS1cdTBDQjNcdTBDQjUtXHUwQ0I5XHUwQ0JDLVx1MENDNFx1MENDNi1cdTBDQzhcdTBDQ0EtXHUwQ0NEXHUwQ0Q1XHUwQ0Q2XHUwQ0RFXHUwQ0UwLVx1MENFM1x1MENFNi1cdTBDRUZcdTBDRjFcdTBDRjJcdTBEMDEtXHUwRDAzXHUwRDA1LVx1MEQwQ1x1MEQwRS1cdTBEMTBcdTBEMTItXHUwRDNBXHUwRDNELVx1MEQ0NFx1MEQ0Ni1cdTBENDhcdTBENEEtXHUwRDRFXHUwRDU0LVx1MEQ1N1x1MEQ1Ri1cdTBENjNcdTBENjYtXHUwRDZGXHUwRDdBLVx1MEQ3Rlx1MEQ4Mlx1MEQ4M1x1MEQ4NS1cdTBEOTZcdTBEOUEtXHUwREIxXHUwREIzLVx1MERCQlx1MERCRFx1MERDMC1cdTBEQzZcdTBEQ0FcdTBEQ0YtXHUwREQ0XHUwREQ2XHUwREQ4LVx1MERERlx1MERFNi1cdTBERUZcdTBERjJcdTBERjNcdTBFMDEtXHUwRTNBXHUwRTQwLVx1MEU0RVx1MEU1MC1cdTBFNTlcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUI5XHUwRUJCLVx1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFQzgtXHUwRUNEXHUwRUQwLVx1MEVEOVx1MEVEQy1cdTBFREZcdTBGMDBcdTBGMThcdTBGMTlcdTBGMjAtXHUwRjI5XHUwRjM1XHUwRjM3XHUwRjM5XHUwRjNFLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGNzEtXHUwRjg0XHUwRjg2LVx1MEY5N1x1MEY5OS1cdTBGQkNcdTBGQzZcdTEwMDAtXHUxMDQ5XHUxMDUwLVx1MTA5RFx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzNUQtXHUxMzVGXHUxMzY5LVx1MTM3MVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTRcdTE3MjAtXHUxNzM0XHUxNzQwLVx1MTc1M1x1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzcyXHUxNzczXHUxNzgwLVx1MTdEM1x1MTdEN1x1MTdEQ1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODEwLVx1MTgxOVx1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5MjAtXHUxOTJCXHUxOTMwLVx1MTkzQlx1MTk0Ni1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTE5RDAtXHUxOURBXHUxQTAwLVx1MUExQlx1MUEyMC1cdTFBNUVcdTFBNjAtXHUxQTdDXHUxQTdGLVx1MUE4OVx1MUE5MC1cdTFBOTlcdTFBQTdcdTFBQjAtXHUxQUJEXHUxQjAwLVx1MUI0Qlx1MUI1MC1cdTFCNTlcdTFCNkItXHUxQjczXHUxQjgwLVx1MUJGM1x1MUMwMC1cdTFDMzdcdTFDNDAtXHUxQzQ5XHUxQzRELVx1MUM3RFx1MUM4MC1cdTFDODhcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNGNlx1MUNGOFx1MUNGOVx1MUQwMC1cdTFERjVcdTFERkItXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwMENcdTIwMERcdTIwM0ZcdTIwNDBcdTIwNTRcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE4LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEN0YtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJERTAtXHUyREZGXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMkZcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOTktXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjJCXHVBNjQwLVx1QTY2Rlx1QTY3NC1cdUE2N0RcdUE2N0YtXHVBNkYxXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FFXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MjdcdUE4NDAtXHVBODczXHVBODgwLVx1QThDNVx1QThEMC1cdUE4RDlcdUE4RTAtXHVBOEY3XHVBOEZCXHVBOEZEXHVBOTAwLVx1QTkyRFx1QTkzMC1cdUE5NTNcdUE5NjAtXHVBOTdDXHVBOTgwLVx1QTlDMFx1QTlDRi1cdUE5RDlcdUE5RTAtXHVBOUZFXHVBQTAwLVx1QUEzNlx1QUE0MC1cdUFBNERcdUFBNTAtXHVBQTU5XHVBQTYwLVx1QUE3Nlx1QUE3QS1cdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFRlx1QUFGMi1cdUFBRjZcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFQVx1QUJFQ1x1QUJFRFx1QUJGMC1cdUFCRjlcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFELVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFMDAtXHVGRTBGXHVGRTIwLVx1RkUyRlx1RkUzM1x1RkUzNFx1RkU0RC1cdUZFNEZcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYxMC1cdUZGMTlcdUZGMjEtXHVGRjNBXHVGRjNGXHVGRjQxLVx1RkY1QVx1RkY2Ni1cdUZGQkVcdUZGQzItXHVGRkM3XHVGRkNBLVx1RkZDRlx1RkZEMi1cdUZGRDdcdUZGREEtXHVGRkRDXXxcdUQ4MDBbXHVEQzAwLVx1REMwQlx1REMwRC1cdURDMjZcdURDMjgtXHVEQzNBXHVEQzNDXHVEQzNEXHVEQzNGLVx1REM0RFx1REM1MC1cdURDNURcdURDODAtXHVEQ0ZBXHVERDQwLVx1REQ3NFx1RERGRFx1REU4MC1cdURFOUNcdURFQTAtXHVERUQwXHVERUUwXHVERjAwLVx1REYxRlx1REYzMC1cdURGNEFcdURGNTAtXHVERjdBXHVERjgwLVx1REY5RFx1REZBMC1cdURGQzNcdURGQzgtXHVERkNGXHVERkQxLVx1REZENV18XHVEODAxW1x1REMwMC1cdURDOURcdURDQTAtXHVEQ0E5XHVEQ0IwLVx1RENEM1x1RENEOC1cdURDRkJcdUREMDAtXHVERDI3XHVERDMwLVx1REQ2M1x1REUwMC1cdURGMzZcdURGNDAtXHVERjU1XHVERjYwLVx1REY2N118XHVEODAyW1x1REMwMC1cdURDMDVcdURDMDhcdURDMEEtXHVEQzM1XHVEQzM3XHVEQzM4XHVEQzNDXHVEQzNGLVx1REM1NVx1REM2MC1cdURDNzZcdURDODAtXHVEQzlFXHVEQ0UwLVx1RENGMlx1RENGNFx1RENGNVx1REQwMC1cdUREMTVcdUREMjAtXHVERDM5XHVERDgwLVx1RERCN1x1RERCRVx1RERCRlx1REUwMC1cdURFMDNcdURFMDVcdURFMDZcdURFMEMtXHVERTEzXHVERTE1LVx1REUxN1x1REUxOS1cdURFMzNcdURFMzgtXHVERTNBXHVERTNGXHVERTYwLVx1REU3Q1x1REU4MC1cdURFOUNcdURFQzAtXHVERUM3XHVERUM5LVx1REVFNlx1REYwMC1cdURGMzVcdURGNDAtXHVERjU1XHVERjYwLVx1REY3Mlx1REY4MC1cdURGOTFdfFx1RDgwM1tcdURDMDAtXHVEQzQ4XHVEQzgwLVx1RENCMlx1RENDMC1cdURDRjJdfFx1RDgwNFtcdURDMDAtXHVEQzQ2XHVEQzY2LVx1REM2Rlx1REM3Ri1cdURDQkFcdURDRDAtXHVEQ0U4XHVEQ0YwLVx1RENGOVx1REQwMC1cdUREMzRcdUREMzYtXHVERDNGXHVERDUwLVx1REQ3M1x1REQ3Nlx1REQ4MC1cdUREQzRcdUREQ0EtXHVERENDXHVEREQwLVx1REREQVx1REREQ1x1REUwMC1cdURFMTFcdURFMTMtXHVERTM3XHVERTNFXHVERTgwLVx1REU4Nlx1REU4OFx1REU4QS1cdURFOERcdURFOEYtXHVERTlEXHVERTlGLVx1REVBOFx1REVCMC1cdURFRUFcdURFRjAtXHVERUY5XHVERjAwLVx1REYwM1x1REYwNS1cdURGMENcdURGMEZcdURGMTBcdURGMTMtXHVERjI4XHVERjJBLVx1REYzMFx1REYzMlx1REYzM1x1REYzNS1cdURGMzlcdURGM0MtXHVERjQ0XHVERjQ3XHVERjQ4XHVERjRCLVx1REY0RFx1REY1MFx1REY1N1x1REY1RC1cdURGNjNcdURGNjYtXHVERjZDXHVERjcwLVx1REY3NF18XHVEODA1W1x1REMwMC1cdURDNEFcdURDNTAtXHVEQzU5XHVEQzgwLVx1RENDNVx1RENDN1x1RENEMC1cdURDRDlcdUREODAtXHVEREI1XHVEREI4LVx1RERDMFx1REREOC1cdURERERcdURFMDAtXHVERTQwXHVERTQ0XHVERTUwLVx1REU1OVx1REU4MC1cdURFQjdcdURFQzAtXHVERUM5XHVERjAwLVx1REYxOVx1REYxRC1cdURGMkJcdURGMzAtXHVERjM5XXxcdUQ4MDZbXHVEQ0EwLVx1RENFOVx1RENGRlx1REVDMC1cdURFRjhdfFx1RDgwN1tcdURDMDAtXHVEQzA4XHVEQzBBLVx1REMzNlx1REMzOC1cdURDNDBcdURDNTAtXHVEQzU5XHVEQzcyLVx1REM4Rlx1REM5Mi1cdURDQTdcdURDQTktXHVEQ0I2XXxcdUQ4MDhbXHVEQzAwLVx1REY5OV18XHVEODA5W1x1REMwMC1cdURDNkVcdURDODAtXHVERDQzXXxbXHVEODBDXHVEODFDLVx1RDgyMFx1RDg0MC1cdUQ4NjhcdUQ4NkEtXHVEODZDXHVEODZGLVx1RDg3Ml1bXHVEQzAwLVx1REZGRl18XHVEODBEW1x1REMwMC1cdURDMkVdfFx1RDgxMVtcdURDMDAtXHVERTQ2XXxcdUQ4MUFbXHVEQzAwLVx1REUzOFx1REU0MC1cdURFNUVcdURFNjAtXHVERTY5XHVERUQwLVx1REVFRFx1REVGMC1cdURFRjRcdURGMDAtXHVERjM2XHVERjQwLVx1REY0M1x1REY1MC1cdURGNTlcdURGNjMtXHVERjc3XHVERjdELVx1REY4Rl18XHVEODFCW1x1REYwMC1cdURGNDRcdURGNTAtXHVERjdFXHVERjhGLVx1REY5Rlx1REZFMF18XHVEODIxW1x1REMwMC1cdURGRUNdfFx1RDgyMltcdURDMDAtXHVERUYyXXxcdUQ4MkNbXHVEQzAwXHVEQzAxXXxcdUQ4MkZbXHVEQzAwLVx1REM2QVx1REM3MC1cdURDN0NcdURDODAtXHVEQzg4XHVEQzkwLVx1REM5OVx1REM5RFx1REM5RV18XHVEODM0W1x1REQ2NS1cdURENjlcdURENkQtXHVERDcyXHVERDdCLVx1REQ4Mlx1REQ4NS1cdUREOEJcdUREQUEtXHVEREFEXHVERTQyLVx1REU0NF18XHVEODM1W1x1REMwMC1cdURDNTRcdURDNTYtXHVEQzlDXHVEQzlFXHVEQzlGXHVEQ0EyXHVEQ0E1XHVEQ0E2XHVEQ0E5LVx1RENBQ1x1RENBRS1cdURDQjlcdURDQkJcdURDQkQtXHVEQ0MzXHVEQ0M1LVx1REQwNVx1REQwNy1cdUREMEFcdUREMEQtXHVERDE0XHVERDE2LVx1REQxQ1x1REQxRS1cdUREMzlcdUREM0ItXHVERDNFXHVERDQwLVx1REQ0NFx1REQ0Nlx1REQ0QS1cdURENTBcdURENTItXHVERUE1XHVERUE4LVx1REVDMFx1REVDMi1cdURFREFcdURFREMtXHVERUZBXHVERUZDLVx1REYxNFx1REYxNi1cdURGMzRcdURGMzYtXHVERjRFXHVERjUwLVx1REY2RVx1REY3MC1cdURGODhcdURGOEEtXHVERkE4XHVERkFBLVx1REZDMlx1REZDNC1cdURGQ0JcdURGQ0UtXHVERkZGXXxcdUQ4MzZbXHVERTAwLVx1REUzNlx1REUzQi1cdURFNkNcdURFNzVcdURFODRcdURFOUItXHVERTlGXHVERUExLVx1REVBRl18XHVEODM4W1x1REMwMC1cdURDMDZcdURDMDgtXHVEQzE4XHVEQzFCLVx1REMyMVx1REMyM1x1REMyNFx1REMyNi1cdURDMkFdfFx1RDgzQVtcdURDMDAtXHVEQ0M0XHVEQ0QwLVx1RENENlx1REQwMC1cdURENEFcdURENTAtXHVERDU5XXxcdUQ4M0JbXHVERTAwLVx1REUwM1x1REUwNS1cdURFMUZcdURFMjFcdURFMjJcdURFMjRcdURFMjdcdURFMjktXHVERTMyXHVERTM0LVx1REUzN1x1REUzOVx1REUzQlx1REU0Mlx1REU0N1x1REU0OVx1REU0Qlx1REU0RC1cdURFNEZcdURFNTFcdURFNTJcdURFNTRcdURFNTdcdURFNTlcdURFNUJcdURFNURcdURFNUZcdURFNjFcdURFNjJcdURFNjRcdURFNjctXHVERTZBXHVERTZDLVx1REU3Mlx1REU3NC1cdURFNzdcdURFNzktXHVERTdDXHVERTdFXHVERTgwLVx1REU4OVx1REU4Qi1cdURFOUJcdURFQTEtXHVERUEzXHVERUE1LVx1REVBOVx1REVBQi1cdURFQkJdfFx1RDg2OVtcdURDMDAtXHVERUQ2XHVERjAwLVx1REZGRl18XHVEODZEW1x1REMwMC1cdURGMzRcdURGNDAtXHVERkZGXXxcdUQ4NkVbXHVEQzAwLVx1REMxRFx1REMyMC1cdURGRkZdfFx1RDg3M1tcdURDMDAtXHVERUExXXxcdUQ4N0VbXHVEQzAwLVx1REUxRF18XHVEQjQwW1x1REQwMC1cdURERUZdLwogICAgfTsKCiAgICBmdW5jdGlvbiBpc0RlY2ltYWxEaWdpdChjaCkgewogICAgICAgIHJldHVybiAweDMwIDw9IGNoICYmIGNoIDw9IDB4Mzk7ICAvLyAwLi45CiAgICB9CgogICAgZnVuY3Rpb24gaXNIZXhEaWdpdChjaCkgewogICAgICAgIHJldHVybiAweDMwIDw9IGNoICYmIGNoIDw9IDB4MzkgfHwgIC8vIDAuLjkKICAgICAgICAgICAgMHg2MSA8PSBjaCAmJiBjaCA8PSAweDY2IHx8ICAgICAvLyBhLi5mCiAgICAgICAgICAgIDB4NDEgPD0gY2ggJiYgY2ggPD0gMHg0NjsgICAgICAgLy8gQS4uRgogICAgfQoKICAgIGZ1bmN0aW9uIGlzT2N0YWxEaWdpdChjaCkgewogICAgICAgIHJldHVybiBjaCA+PSAweDMwICYmIGNoIDw9IDB4Mzc7ICAvLyAwLi43CiAgICB9CgogICAgLy8gNy4yIFdoaXRlIFNwYWNlCgogICAgTk9OX0FTQ0lJX1dISVRFU1BBQ0VTID0gWwogICAgICAgIDB4MTY4MCwKICAgICAgICAweDIwMDAsIDB4MjAwMSwgMHgyMDAyLCAweDIwMDMsIDB4MjAwNCwgMHgyMDA1LCAweDIwMDYsIDB4MjAwNywgMHgyMDA4LCAweDIwMDksIDB4MjAwQSwKICAgICAgICAweDIwMkYsIDB4MjA1RiwKICAgICAgICAweDMwMDAsCiAgICAgICAgMHhGRUZGCiAgICBdOwoKICAgIGZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjaCkgewogICAgICAgIHJldHVybiBjaCA9PT0gMHgyMCB8fCBjaCA9PT0gMHgwOSB8fCBjaCA9PT0gMHgwQiB8fCBjaCA9PT0gMHgwQyB8fCBjaCA9PT0gMHhBMCB8fAogICAgICAgICAgICBjaCA+PSAweDE2ODAgJiYgTk9OX0FTQ0lJX1dISVRFU1BBQ0VTLmluZGV4T2YoY2gpID49IDA7CiAgICB9CgogICAgLy8gNy4zIExpbmUgVGVybWluYXRvcnMKCiAgICBmdW5jdGlvbiBpc0xpbmVUZXJtaW5hdG9yKGNoKSB7CiAgICAgICAgcmV0dXJuIGNoID09PSAweDBBIHx8IGNoID09PSAweDBEIHx8IGNoID09PSAweDIwMjggfHwgY2ggPT09IDB4MjAyOTsKICAgIH0KCiAgICAvLyA3LjYgSWRlbnRpZmllciBOYW1lcyBhbmQgSWRlbnRpZmllcnMKCiAgICBmdW5jdGlvbiBmcm9tQ29kZVBvaW50KGNwKSB7CiAgICAgICAgaWYgKGNwIDw9IDB4RkZGRikgeyByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjcCk7IH0KICAgICAgICB2YXIgY3UxID0gU3RyaW5nLmZyb21DaGFyQ29kZShNYXRoLmZsb29yKChjcCAtIDB4MTAwMDApIC8gMHg0MDApICsgMHhEODAwKTsKICAgICAgICB2YXIgY3UyID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGNwIC0gMHgxMDAwMCkgJSAweDQwMCkgKyAweERDMDApOwogICAgICAgIHJldHVybiBjdTEgKyBjdTI7CiAgICB9CgogICAgSURFTlRJRklFUl9TVEFSVCA9IG5ldyBBcnJheSgweDgwKTsKICAgIGZvcihjaCA9IDA7IGNoIDwgMHg4MDsgKytjaCkgewogICAgICAgIElERU5USUZJRVJfU1RBUlRbY2hdID0KICAgICAgICAgICAgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDdBIHx8ICAvLyBhLi56CiAgICAgICAgICAgIGNoID49IDB4NDEgJiYgY2ggPD0gMHg1QSB8fCAgLy8gQS4uWgogICAgICAgICAgICBjaCA9PT0gMHgyNCB8fCBjaCA9PT0gMHg1RjsgIC8vICQgKGRvbGxhcikgYW5kIF8gKHVuZGVyc2NvcmUpCiAgICB9CgogICAgSURFTlRJRklFUl9QQVJUID0gbmV3IEFycmF5KDB4ODApOwogICAgZm9yKGNoID0gMDsgY2ggPCAweDgwOyArK2NoKSB7CiAgICAgICAgSURFTlRJRklFUl9QQVJUW2NoXSA9CiAgICAgICAgICAgIGNoID49IDB4NjEgJiYgY2ggPD0gMHg3QSB8fCAgLy8gYS4uegogICAgICAgICAgICBjaCA+PSAweDQxICYmIGNoIDw9IDB4NUEgfHwgIC8vIEEuLloKICAgICAgICAgICAgY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5IHx8ICAvLyAwLi45CiAgICAgICAgICAgIGNoID09PSAweDI0IHx8IGNoID09PSAweDVGOyAgLy8gJCAoZG9sbGFyKSBhbmQgXyAodW5kZXJzY29yZSkKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydEVTNShjaCkgewogICAgICAgIHJldHVybiBjaCA8IDB4ODAgPyBJREVOVElGSUVSX1NUQVJUW2NoXSA6IEVTNVJlZ2V4Lk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QoZnJvbUNvZGVQb2ludChjaCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmllclBhcnRFUzUoY2gpIHsKICAgICAgICByZXR1cm4gY2ggPCAweDgwID8gSURFTlRJRklFUl9QQVJUW2NoXSA6IEVTNVJlZ2V4Lk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdChmcm9tQ29kZVBvaW50KGNoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZGVudGlmaWVyU3RhcnRFUzYoY2gpIHsKICAgICAgICByZXR1cm4gY2ggPCAweDgwID8gSURFTlRJRklFUl9TVEFSVFtjaF0gOiBFUzZSZWdleC5Ob25Bc2NpaUlkZW50aWZpZXJTdGFydC50ZXN0KGZyb21Db2RlUG9pbnQoY2gpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJQYXJ0RVM2KGNoKSB7CiAgICAgICAgcmV0dXJuIGNoIDwgMHg4MCA/IElERU5USUZJRVJfUEFSVFtjaF0gOiBFUzZSZWdleC5Ob25Bc2NpaUlkZW50aWZpZXJQYXJ0LnRlc3QoZnJvbUNvZGVQb2ludChjaCkpOwogICAgfQoKICAgIGNvZGUkMS5leHBvcnRzID0gewogICAgICAgIGlzRGVjaW1hbERpZ2l0OiBpc0RlY2ltYWxEaWdpdCwKICAgICAgICBpc0hleERpZ2l0OiBpc0hleERpZ2l0LAogICAgICAgIGlzT2N0YWxEaWdpdDogaXNPY3RhbERpZ2l0LAogICAgICAgIGlzV2hpdGVTcGFjZTogaXNXaGl0ZVNwYWNlLAogICAgICAgIGlzTGluZVRlcm1pbmF0b3I6IGlzTGluZVRlcm1pbmF0b3IsCiAgICAgICAgaXNJZGVudGlmaWVyU3RhcnRFUzU6IGlzSWRlbnRpZmllclN0YXJ0RVM1LAogICAgICAgIGlzSWRlbnRpZmllclBhcnRFUzU6IGlzSWRlbnRpZmllclBhcnRFUzUsCiAgICAgICAgaXNJZGVudGlmaWVyU3RhcnRFUzY6IGlzSWRlbnRpZmllclN0YXJ0RVM2LAogICAgICAgIGlzSWRlbnRpZmllclBhcnRFUzY6IGlzSWRlbnRpZmllclBhcnRFUzYKICAgIH07Cn0oKSk7Ci8qIHZpbTogc2V0IHN3PTQgdHM9NCBldCB0dz04MCA6ICovCgp2YXIgY29kZUV4cG9ydHMgPSBjb2RlJDEuZXhwb3J0czsKCnZhciBrZXl3b3JkJDEgPSB7ZXhwb3J0czoge319OwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTMgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgoKICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoKICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZCiAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5ECiAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YKICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqLwoKKGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgY29kZSA9IGNvZGVFeHBvcnRzOwoKICAgIGZ1bmN0aW9uIGlzU3RyaWN0TW9kZVJlc2VydmVkV29yZEVTNihpZCkgewogICAgICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICBjYXNlICdpbXBsZW1lbnRzJzoKICAgICAgICBjYXNlICdpbnRlcmZhY2UnOgogICAgICAgIGNhc2UgJ3BhY2thZ2UnOgogICAgICAgIGNhc2UgJ3ByaXZhdGUnOgogICAgICAgIGNhc2UgJ3Byb3RlY3RlZCc6CiAgICAgICAgY2FzZSAncHVibGljJzoKICAgICAgICBjYXNlICdzdGF0aWMnOgogICAgICAgIGNhc2UgJ2xldCc6CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNLZXl3b3JkRVM1KGlkLCBzdHJpY3QpIHsKICAgICAgICAvLyB5aWVsZCBzaG91bGQgbm90IGJlIHRyZWF0ZWQgYXMga2V5d29yZCB1bmRlciBub24tc3RyaWN0IG1vZGUuCiAgICAgICAgaWYgKCFzdHJpY3QgJiYgaWQgPT09ICd5aWVsZCcpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaXNLZXl3b3JkRVM2KGlkLCBzdHJpY3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzS2V5d29yZEVTNihpZCwgc3RyaWN0KSB7CiAgICAgICAgaWYgKHN0cmljdCAmJiBpc1N0cmljdE1vZGVSZXNlcnZlZFdvcmRFUzYoaWQpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChpZC5sZW5ndGgpIHsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICdpZicpIHx8IChpZCA9PT0gJ2luJykgfHwgKGlkID09PSAnZG8nKTsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICd2YXInKSB8fCAoaWQgPT09ICdmb3InKSB8fCAoaWQgPT09ICduZXcnKSB8fCAoaWQgPT09ICd0cnknKTsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICd0aGlzJykgfHwgKGlkID09PSAnZWxzZScpIHx8IChpZCA9PT0gJ2Nhc2UnKSB8fAogICAgICAgICAgICAgICAgKGlkID09PSAndm9pZCcpIHx8IChpZCA9PT0gJ3dpdGgnKSB8fCAoaWQgPT09ICdlbnVtJyk7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgICByZXR1cm4gKGlkID09PSAnd2hpbGUnKSB8fCAoaWQgPT09ICdicmVhaycpIHx8IChpZCA9PT0gJ2NhdGNoJykgfHwKICAgICAgICAgICAgICAgIChpZCA9PT0gJ3Rocm93JykgfHwgKGlkID09PSAnY29uc3QnKSB8fCAoaWQgPT09ICd5aWVsZCcpIHx8CiAgICAgICAgICAgICAgICAoaWQgPT09ICdjbGFzcycpIHx8IChpZCA9PT0gJ3N1cGVyJyk7CiAgICAgICAgY2FzZSA2OgogICAgICAgICAgICByZXR1cm4gKGlkID09PSAncmV0dXJuJykgfHwgKGlkID09PSAndHlwZW9mJykgfHwgKGlkID09PSAnZGVsZXRlJykgfHwKICAgICAgICAgICAgICAgIChpZCA9PT0gJ3N3aXRjaCcpIHx8IChpZCA9PT0gJ2V4cG9ydCcpIHx8IChpZCA9PT0gJ2ltcG9ydCcpOwogICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ2RlZmF1bHQnKSB8fCAoaWQgPT09ICdmaW5hbGx5JykgfHwgKGlkID09PSAnZXh0ZW5kcycpOwogICAgICAgIGNhc2UgODoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ2Z1bmN0aW9uJykgfHwgKGlkID09PSAnY29udGludWUnKSB8fCAoaWQgPT09ICdkZWJ1Z2dlcicpOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICdpbnN0YW5jZW9mJyk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1Jlc2VydmVkV29yZEVTNShpZCwgc3RyaWN0KSB7CiAgICAgICAgcmV0dXJuIGlkID09PSAnbnVsbCcgfHwgaWQgPT09ICd0cnVlJyB8fCBpZCA9PT0gJ2ZhbHNlJyB8fCBpc0tleXdvcmRFUzUoaWQsIHN0cmljdCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNSZXNlcnZlZFdvcmRFUzYoaWQsIHN0cmljdCkgewogICAgICAgIHJldHVybiBpZCA9PT0gJ251bGwnIHx8IGlkID09PSAndHJ1ZScgfHwgaWQgPT09ICdmYWxzZScgfHwgaXNLZXl3b3JkRVM2KGlkLCBzdHJpY3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUmVzdHJpY3RlZFdvcmQoaWQpIHsKICAgICAgICByZXR1cm4gaWQgPT09ICdldmFsJyB8fCBpZCA9PT0gJ2FyZ3VtZW50cyc7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZGVudGlmaWVyTmFtZUVTNShpZCkgewogICAgICAgIHZhciBpLCBpeiwgY2g7CgogICAgICAgIGlmIChpZC5sZW5ndGggPT09IDApIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIGNoID0gaWQuY2hhckNvZGVBdCgwKTsKICAgICAgICBpZiAoIWNvZGUuaXNJZGVudGlmaWVyU3RhcnRFUzUoY2gpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IDEsIGl6ID0gaWQubGVuZ3RoOyBpIDwgaXo7ICsraSkgewogICAgICAgICAgICBjaCA9IGlkLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgIGlmICghY29kZS5pc0lkZW50aWZpZXJQYXJ0RVM1KGNoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY29kZVV0ZjE2KGxlYWQsIHRyYWlsKSB7CiAgICAgICAgcmV0dXJuIChsZWFkIC0gMHhEODAwKSAqIDB4NDAwICsgKHRyYWlsIC0gMHhEQzAwKSArIDB4MTAwMDA7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZGVudGlmaWVyTmFtZUVTNihpZCkgewogICAgICAgIHZhciBpLCBpeiwgY2gsIGxvd0NoLCBjaGVjazsKCiAgICAgICAgaWYgKGlkLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICAgICAgY2hlY2sgPSBjb2RlLmlzSWRlbnRpZmllclN0YXJ0RVM2OwogICAgICAgIGZvciAoaSA9IDAsIGl6ID0gaWQubGVuZ3RoOyBpIDwgaXo7ICsraSkgewogICAgICAgICAgICBjaCA9IGlkLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgIGlmICgweEQ4MDAgPD0gY2ggJiYgY2ggPD0gMHhEQkZGKSB7CiAgICAgICAgICAgICAgICArK2k7CiAgICAgICAgICAgICAgICBpZiAoaSA+PSBpeikgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICAgICAgICAgIGxvd0NoID0gaWQuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgICAgIGlmICghKDB4REMwMCA8PSBsb3dDaCAmJiBsb3dDaCA8PSAweERGRkYpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2ggPSBkZWNvZGVVdGYxNihjaCwgbG93Q2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY2hlY2soY2gpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hlY2sgPSBjb2RlLmlzSWRlbnRpZmllclBhcnRFUzY7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmllckVTNShpZCwgc3RyaWN0KSB7CiAgICAgICAgcmV0dXJuIGlzSWRlbnRpZmllck5hbWVFUzUoaWQpICYmICFpc1Jlc2VydmVkV29yZEVTNShpZCwgc3RyaWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJFUzYoaWQsIHN0cmljdCkgewogICAgICAgIHJldHVybiBpc0lkZW50aWZpZXJOYW1lRVM2KGlkKSAmJiAhaXNSZXNlcnZlZFdvcmRFUzYoaWQsIHN0cmljdCk7CiAgICB9CgogICAga2V5d29yZCQxLmV4cG9ydHMgPSB7CiAgICAgICAgaXNLZXl3b3JkRVM1OiBpc0tleXdvcmRFUzUsCiAgICAgICAgaXNLZXl3b3JkRVM2OiBpc0tleXdvcmRFUzYsCiAgICAgICAgaXNSZXNlcnZlZFdvcmRFUzU6IGlzUmVzZXJ2ZWRXb3JkRVM1LAogICAgICAgIGlzUmVzZXJ2ZWRXb3JkRVM2OiBpc1Jlc2VydmVkV29yZEVTNiwKICAgICAgICBpc1Jlc3RyaWN0ZWRXb3JkOiBpc1Jlc3RyaWN0ZWRXb3JkLAogICAgICAgIGlzSWRlbnRpZmllck5hbWVFUzU6IGlzSWRlbnRpZmllck5hbWVFUzUsCiAgICAgICAgaXNJZGVudGlmaWVyTmFtZUVTNjogaXNJZGVudGlmaWVyTmFtZUVTNiwKICAgICAgICBpc0lkZW50aWZpZXJFUzU6IGlzSWRlbnRpZmllckVTNSwKICAgICAgICBpc0lkZW50aWZpZXJFUzY6IGlzSWRlbnRpZmllckVTNgogICAgfTsKfSgpKTsKLyogdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDogKi8KCnZhciBrZXl3b3JkRXhwb3J0cyA9IGtleXdvcmQkMS5leHBvcnRzOwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTMgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgoKICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoKICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZCiAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5ECiAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YKICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqLwooZnVuY3Rpb24gKCkgewoKICAgIHV0aWxzLmFzdCA9IGFzdEV4cG9ydHM7CiAgICB1dGlscy5jb2RlID0gY29kZUV4cG9ydHM7CiAgICB1dGlscy5rZXl3b3JkID0ga2V5d29yZEV4cG9ydHM7Cn0oKSk7Cgp2YXIgc291cmNlTWFwID0ge307Cgp2YXIgc291cmNlTWFwR2VuZXJhdG9yID0ge307Cgp2YXIgYmFzZTY0VmxxJDEgPSB7fTsKCnZhciBiYXNlNjQkMiA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkQmFzZTY0OwoKZnVuY3Rpb24gcmVxdWlyZUJhc2U2NCAoKSB7CglpZiAoaGFzUmVxdWlyZWRCYXNlNjQpIHJldHVybiBiYXNlNjQkMjsKCWhhc1JlcXVpcmVkQmFzZTY0ID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgl2YXIgaW50VG9DaGFyTWFwID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nLnNwbGl0KCcnKTsKCgkvKioKCSAqIEVuY29kZSBhbiBpbnRlZ2VyIGluIHRoZSByYW5nZSBvZiAwIHRvIDYzIHRvIGEgc2luZ2xlIGJhc2UgNjQgZGlnaXQuCgkgKi8KCWJhc2U2NCQyLmVuY29kZSA9IGZ1bmN0aW9uIChudW1iZXIpIHsKCSAgaWYgKDAgPD0gbnVtYmVyICYmIG51bWJlciA8IGludFRvQ2hhck1hcC5sZW5ndGgpIHsKCSAgICByZXR1cm4gaW50VG9DaGFyTWFwW251bWJlcl07CgkgIH0KCSAgdGhyb3cgbmV3IFR5cGVFcnJvcigiTXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDYzOiAiICsgbnVtYmVyKTsKCX07CgoJLyoqCgkgKiBEZWNvZGUgYSBzaW5nbGUgYmFzZSA2NCBjaGFyYWN0ZXIgY29kZSBkaWdpdCB0byBhbiBpbnRlZ2VyLiBSZXR1cm5zIC0xIG9uCgkgKiBmYWlsdXJlLgoJICovCgliYXNlNjQkMi5kZWNvZGUgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgdmFyIGJpZ0EgPSA2NTsgICAgIC8vICdBJwoJICB2YXIgYmlnWiA9IDkwOyAgICAgLy8gJ1onCgoJICB2YXIgbGl0dGxlQSA9IDk3OyAgLy8gJ2EnCgkgIHZhciBsaXR0bGVaID0gMTIyOyAvLyAneicKCgkgIHZhciB6ZXJvID0gNDg7ICAgICAvLyAnMCcKCSAgdmFyIG5pbmUgPSA1NzsgICAgIC8vICc5JwoKCSAgdmFyIHBsdXMgPSA0MzsgICAgIC8vICcrJwoJICB2YXIgc2xhc2ggPSA0NzsgICAgLy8gJy8nCgoJICB2YXIgbGl0dGxlT2Zmc2V0ID0gMjY7CgkgIHZhciBudW1iZXJPZmZzZXQgPSA1MjsKCgkgIC8vIDAgLSAyNTogQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVoKCSAgaWYgKGJpZ0EgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gYmlnWikgewoJICAgIHJldHVybiAoY2hhckNvZGUgLSBiaWdBKTsKCSAgfQoKCSAgLy8gMjYgLSA1MTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoKCSAgaWYgKGxpdHRsZUEgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gbGl0dGxlWikgewoJICAgIHJldHVybiAoY2hhckNvZGUgLSBsaXR0bGVBICsgbGl0dGxlT2Zmc2V0KTsKCSAgfQoKCSAgLy8gNTIgLSA2MTogMDEyMzQ1Njc4OQoJICBpZiAoemVybyA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSBuaW5lKSB7CgkgICAgcmV0dXJuIChjaGFyQ29kZSAtIHplcm8gKyBudW1iZXJPZmZzZXQpOwoJICB9CgoJICAvLyA2MjogKwoJICBpZiAoY2hhckNvZGUgPT0gcGx1cykgewoJICAgIHJldHVybiA2MjsKCSAgfQoKCSAgLy8gNjM6IC8KCSAgaWYgKGNoYXJDb2RlID09IHNsYXNoKSB7CgkgICAgcmV0dXJuIDYzOwoJICB9CgoJICAvLyBJbnZhbGlkIGJhc2U2NCBkaWdpdC4KCSAgcmV0dXJuIC0xOwoJfTsKCXJldHVybiBiYXNlNjQkMjsKfQoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkQmFzZTY0VmxxOwoKZnVuY3Rpb24gcmVxdWlyZUJhc2U2NFZscSAoKSB7CglpZiAoaGFzUmVxdWlyZWRCYXNlNjRWbHEpIHJldHVybiBiYXNlNjRWbHEkMTsKCWhhc1JlcXVpcmVkQmFzZTY0VmxxID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKgoJICogQmFzZWQgb24gdGhlIEJhc2UgNjQgVkxRIGltcGxlbWVudGF0aW9uIGluIENsb3N1cmUgQ29tcGlsZXI6CgkgKiBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nsb3N1cmUtY29tcGlsZXIvc291cmNlL2Jyb3dzZS90cnVuay9zcmMvY29tL2dvb2dsZS9kZWJ1Z2dpbmcvc291cmNlbWFwL0Jhc2U2NFZMUS5qYXZhCgkgKgoJICogQ29weXJpZ2h0IDIwMTEgVGhlIENsb3N1cmUgQ29tcGlsZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KCSAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAoJICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZQoJICogbWV0OgoJICoKCSAqICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CgkgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCgkgKiAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlCgkgKiAgICBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZwoJICogICAgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkCgkgKiAgICB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgkgKiAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEdvb2dsZSBJbmMuIG5vciB0aGUgbmFtZXMgb2YgaXRzCgkgKiAgICBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQKCSAqICAgIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KCSAqCgkgKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTCgkgKiAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVAoJICogTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SCgkgKiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVAoJICogT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsCgkgKiBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UCgkgKiBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwKCSAqIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWQoJICogVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAoJICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFCgkgKiBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoJICovCgoJdmFyIGJhc2U2NCA9IHJlcXVpcmVCYXNlNjQoKTsKCgkvLyBBIHNpbmdsZSBiYXNlIDY0IGRpZ2l0IGNhbiBjb250YWluIDYgYml0cyBvZiBkYXRhLiBGb3IgdGhlIGJhc2UgNjQgdmFyaWFibGUKCS8vIGxlbmd0aCBxdWFudGl0aWVzIHdlIHVzZSBpbiB0aGUgc291cmNlIG1hcCBzcGVjLCB0aGUgZmlyc3QgYml0IGlzIHRoZSBzaWduLAoJLy8gdGhlIG5leHQgZm91ciBiaXRzIGFyZSB0aGUgYWN0dWFsIHZhbHVlLCBhbmQgdGhlIDZ0aCBiaXQgaXMgdGhlCgkvLyBjb250aW51YXRpb24gYml0LiBUaGUgY29udGludWF0aW9uIGJpdCB0ZWxscyB1cyB3aGV0aGVyIHRoZXJlIGFyZSBtb3JlCgkvLyBkaWdpdHMgaW4gdGhpcyB2YWx1ZSBmb2xsb3dpbmcgdGhpcyBkaWdpdC4KCS8vCgkvLyAgIENvbnRpbnVhdGlvbgoJLy8gICB8ICAgIFNpZ24KCS8vICAgfCAgICB8CgkvLyAgIFYgICAgVgoJLy8gICAxMDEwMTEKCgl2YXIgVkxRX0JBU0VfU0hJRlQgPSA1OwoKCS8vIGJpbmFyeTogMTAwMDAwCgl2YXIgVkxRX0JBU0UgPSAxIDw8IFZMUV9CQVNFX1NISUZUOwoKCS8vIGJpbmFyeTogMDExMTExCgl2YXIgVkxRX0JBU0VfTUFTSyA9IFZMUV9CQVNFIC0gMTsKCgkvLyBiaW5hcnk6IDEwMDAwMAoJdmFyIFZMUV9DT05USU5VQVRJT05fQklUID0gVkxRX0JBU0U7CgoJLyoqCgkgKiBDb252ZXJ0cyBmcm9tIGEgdHdvLWNvbXBsZW1lbnQgdmFsdWUgdG8gYSB2YWx1ZSB3aGVyZSB0aGUgc2lnbiBiaXQgaXMKCSAqIHBsYWNlZCBpbiB0aGUgbGVhc3Qgc2lnbmlmaWNhbnQgYml0LiAgRm9yIGV4YW1wbGUsIGFzIGRlY2ltYWxzOgoJICogICAxIGJlY29tZXMgMiAoMTAgYmluYXJ5KSwgLTEgYmVjb21lcyAzICgxMSBiaW5hcnkpCgkgKiAgIDIgYmVjb21lcyA0ICgxMDAgYmluYXJ5KSwgLTIgYmVjb21lcyA1ICgxMDEgYmluYXJ5KQoJICovCglmdW5jdGlvbiB0b1ZMUVNpZ25lZChhVmFsdWUpIHsKCSAgcmV0dXJuIGFWYWx1ZSA8IDAKCSAgICA/ICgoLWFWYWx1ZSkgPDwgMSkgKyAxCgkgICAgOiAoYVZhbHVlIDw8IDEpICsgMDsKCX0KCgkvKioKCSAqIENvbnZlcnRzIHRvIGEgdHdvLWNvbXBsZW1lbnQgdmFsdWUgZnJvbSBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwoJICogcGxhY2VkIGluIHRoZSBsZWFzdCBzaWduaWZpY2FudCBiaXQuICBGb3IgZXhhbXBsZSwgYXMgZGVjaW1hbHM6CgkgKiAgIDIgKDEwIGJpbmFyeSkgYmVjb21lcyAxLCAzICgxMSBiaW5hcnkpIGJlY29tZXMgLTEKCSAqICAgNCAoMTAwIGJpbmFyeSkgYmVjb21lcyAyLCA1ICgxMDEgYmluYXJ5KSBiZWNvbWVzIC0yCgkgKi8KCWZ1bmN0aW9uIGZyb21WTFFTaWduZWQoYVZhbHVlKSB7CgkgIHZhciBpc05lZ2F0aXZlID0gKGFWYWx1ZSAmIDEpID09PSAxOwoJICB2YXIgc2hpZnRlZCA9IGFWYWx1ZSA+PiAxOwoJICByZXR1cm4gaXNOZWdhdGl2ZQoJICAgID8gLXNoaWZ0ZWQKCSAgICA6IHNoaWZ0ZWQ7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBiYXNlIDY0IFZMUSBlbmNvZGVkIHZhbHVlLgoJICovCgliYXNlNjRWbHEkMS5lbmNvZGUgPSBmdW5jdGlvbiBiYXNlNjRWTFFfZW5jb2RlKGFWYWx1ZSkgewoJICB2YXIgZW5jb2RlZCA9ICIiOwoJICB2YXIgZGlnaXQ7CgoJICB2YXIgdmxxID0gdG9WTFFTaWduZWQoYVZhbHVlKTsKCgkgIGRvIHsKCSAgICBkaWdpdCA9IHZscSAmIFZMUV9CQVNFX01BU0s7CgkgICAgdmxxID4+Pj0gVkxRX0JBU0VfU0hJRlQ7CgkgICAgaWYgKHZscSA+IDApIHsKCSAgICAgIC8vIFRoZXJlIGFyZSBzdGlsbCBtb3JlIGRpZ2l0cyBpbiB0aGlzIHZhbHVlLCBzbyB3ZSBtdXN0IG1ha2Ugc3VyZSB0aGUKCSAgICAgIC8vIGNvbnRpbnVhdGlvbiBiaXQgaXMgbWFya2VkLgoJICAgICAgZGlnaXQgfD0gVkxRX0NPTlRJTlVBVElPTl9CSVQ7CgkgICAgfQoJICAgIGVuY29kZWQgKz0gYmFzZTY0LmVuY29kZShkaWdpdCk7CgkgIH0gd2hpbGUgKHZscSA+IDApOwoKCSAgcmV0dXJuIGVuY29kZWQ7Cgl9OwoKCS8qKgoJICogRGVjb2RlcyB0aGUgbmV4dCBiYXNlIDY0IFZMUSB2YWx1ZSBmcm9tIHRoZSBnaXZlbiBzdHJpbmcgYW5kIHJldHVybnMgdGhlCgkgKiB2YWx1ZSBhbmQgdGhlIHJlc3Qgb2YgdGhlIHN0cmluZyB2aWEgdGhlIG91dCBwYXJhbWV0ZXIuCgkgKi8KCWJhc2U2NFZscSQxLmRlY29kZSA9IGZ1bmN0aW9uIGJhc2U2NFZMUV9kZWNvZGUoYVN0ciwgYUluZGV4LCBhT3V0UGFyYW0pIHsKCSAgdmFyIHN0ckxlbiA9IGFTdHIubGVuZ3RoOwoJICB2YXIgcmVzdWx0ID0gMDsKCSAgdmFyIHNoaWZ0ID0gMDsKCSAgdmFyIGNvbnRpbnVhdGlvbiwgZGlnaXQ7CgoJICBkbyB7CgkgICAgaWYgKGFJbmRleCA+PSBzdHJMZW4pIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQgbW9yZSBkaWdpdHMgaW4gYmFzZSA2NCBWTFEgdmFsdWUuIik7CgkgICAgfQoKCSAgICBkaWdpdCA9IGJhc2U2NC5kZWNvZGUoYVN0ci5jaGFyQ29kZUF0KGFJbmRleCsrKSk7CgkgICAgaWYgKGRpZ2l0ID09PSAtMSkgewoJICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGJhc2U2NCBkaWdpdDogIiArIGFTdHIuY2hhckF0KGFJbmRleCAtIDEpKTsKCSAgICB9CgoJICAgIGNvbnRpbnVhdGlvbiA9ICEhKGRpZ2l0ICYgVkxRX0NPTlRJTlVBVElPTl9CSVQpOwoJICAgIGRpZ2l0ICY9IFZMUV9CQVNFX01BU0s7CgkgICAgcmVzdWx0ID0gcmVzdWx0ICsgKGRpZ2l0IDw8IHNoaWZ0KTsKCSAgICBzaGlmdCArPSBWTFFfQkFTRV9TSElGVDsKCSAgfSB3aGlsZSAoY29udGludWF0aW9uKTsKCgkgIGFPdXRQYXJhbS52YWx1ZSA9IGZyb21WTFFTaWduZWQocmVzdWx0KTsKCSAgYU91dFBhcmFtLnJlc3QgPSBhSW5kZXg7Cgl9OwoJcmV0dXJuIGJhc2U2NFZscSQxOwp9Cgp2YXIgdXRpbCQ0ID0ge307CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRVdGlsOwoKZnVuY3Rpb24gcmVxdWlyZVV0aWwgKCkgewoJaWYgKGhhc1JlcXVpcmVkVXRpbCkgcmV0dXJuIHV0aWwkNDsKCWhhc1JlcXVpcmVkVXRpbCA9IDE7CgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCQkvKgoJCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkJICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQoJCSAqLwoKCQkvKioKCQkgKiBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIGZvciBnZXR0aW5nIHZhbHVlcyBmcm9tIHBhcmFtZXRlci9vcHRpb25zCgkJICogb2JqZWN0cy4KCQkgKgoJCSAqIEBwYXJhbSBhcmdzIFRoZSBvYmplY3Qgd2UgYXJlIGV4dHJhY3RpbmcgdmFsdWVzIGZyb20KCQkgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2UgYXJlIGdldHRpbmcuCgkJICogQHBhcmFtIGRlZmF1bHRWYWx1ZSBBbiBvcHRpb25hbCB2YWx1ZSB0byByZXR1cm4gaWYgdGhlIHByb3BlcnR5IGlzIG1pc3NpbmcKCQkgKiBmcm9tIHRoZSBvYmplY3QuIElmIHRoaXMgaXMgbm90IHNwZWNpZmllZCBhbmQgdGhlIHByb3BlcnR5IGlzIG1pc3NpbmcsIGFuCgkJICogZXJyb3Igd2lsbCBiZSB0aHJvd24uCgkJICovCgkJZnVuY3Rpb24gZ2V0QXJnKGFBcmdzLCBhTmFtZSwgYURlZmF1bHRWYWx1ZSkgewoJCSAgaWYgKGFOYW1lIGluIGFBcmdzKSB7CgkJICAgIHJldHVybiBhQXJnc1thTmFtZV07CgkJICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMpIHsKCQkgICAgcmV0dXJuIGFEZWZhdWx0VmFsdWU7CgkJICB9IGVsc2UgewoJCSAgICB0aHJvdyBuZXcgRXJyb3IoJyInICsgYU5hbWUgKyAnIiBpcyBhIHJlcXVpcmVkIGFyZ3VtZW50LicpOwoJCSAgfQoJCX0KCQlleHBvcnRzLmdldEFyZyA9IGdldEFyZzsKCgkJdmFyIHVybFJlZ2V4cCA9IC9eKD86KFtcdytcLS5dKyk6KT9cL1wvKD86KFx3KzpcdyspQCk/KFtcdy4tXSopKD86OihcZCspKT8oLiopJC87CgkJdmFyIGRhdGFVcmxSZWdleHAgPSAvXmRhdGE6LitcLC4rJC87CgoJCWZ1bmN0aW9uIHVybFBhcnNlKGFVcmwpIHsKCQkgIHZhciBtYXRjaCA9IGFVcmwubWF0Y2godXJsUmVnZXhwKTsKCQkgIGlmICghbWF0Y2gpIHsKCQkgICAgcmV0dXJuIG51bGw7CgkJICB9CgkJICByZXR1cm4gewoJCSAgICBzY2hlbWU6IG1hdGNoWzFdLAoJCSAgICBhdXRoOiBtYXRjaFsyXSwKCQkgICAgaG9zdDogbWF0Y2hbM10sCgkJICAgIHBvcnQ6IG1hdGNoWzRdLAoJCSAgICBwYXRoOiBtYXRjaFs1XQoJCSAgfTsKCQl9CgkJZXhwb3J0cy51cmxQYXJzZSA9IHVybFBhcnNlOwoKCQlmdW5jdGlvbiB1cmxHZW5lcmF0ZShhUGFyc2VkVXJsKSB7CgkJICB2YXIgdXJsID0gJyc7CgkJICBpZiAoYVBhcnNlZFVybC5zY2hlbWUpIHsKCQkgICAgdXJsICs9IGFQYXJzZWRVcmwuc2NoZW1lICsgJzonOwoJCSAgfQoJCSAgdXJsICs9ICcvLyc7CgkJICBpZiAoYVBhcnNlZFVybC5hdXRoKSB7CgkJICAgIHVybCArPSBhUGFyc2VkVXJsLmF1dGggKyAnQCc7CgkJICB9CgkJICBpZiAoYVBhcnNlZFVybC5ob3N0KSB7CgkJICAgIHVybCArPSBhUGFyc2VkVXJsLmhvc3Q7CgkJICB9CgkJICBpZiAoYVBhcnNlZFVybC5wb3J0KSB7CgkJICAgIHVybCArPSAiOiIgKyBhUGFyc2VkVXJsLnBvcnQ7CgkJICB9CgkJICBpZiAoYVBhcnNlZFVybC5wYXRoKSB7CgkJICAgIHVybCArPSBhUGFyc2VkVXJsLnBhdGg7CgkJICB9CgkJICByZXR1cm4gdXJsOwoJCX0KCQlleHBvcnRzLnVybEdlbmVyYXRlID0gdXJsR2VuZXJhdGU7CgoJCS8qKgoJCSAqIE5vcm1hbGl6ZXMgYSBwYXRoLCBvciB0aGUgcGF0aCBwb3J0aW9uIG9mIGEgVVJMOgoJCSAqCgkJICogLSBSZXBsYWNlcyBjb25zZWN1dGl2ZSBzbGFzaGVzIHdpdGggb25lIHNsYXNoLgoJCSAqIC0gUmVtb3ZlcyB1bm5lY2Vzc2FyeSAnLicgcGFydHMuCgkJICogLSBSZW1vdmVzIHVubmVjZXNzYXJ5ICc8ZGlyPi8uLicgcGFydHMuCgkJICoKCQkgKiBCYXNlZCBvbiBjb2RlIGluIHRoZSBOb2RlLmpzICdwYXRoJyBjb3JlIG1vZHVsZS4KCQkgKgoJCSAqIEBwYXJhbSBhUGF0aCBUaGUgcGF0aCBvciB1cmwgdG8gbm9ybWFsaXplLgoJCSAqLwoJCWZ1bmN0aW9uIG5vcm1hbGl6ZShhUGF0aCkgewoJCSAgdmFyIHBhdGggPSBhUGF0aDsKCQkgIHZhciB1cmwgPSB1cmxQYXJzZShhUGF0aCk7CgkJICBpZiAodXJsKSB7CgkJICAgIGlmICghdXJsLnBhdGgpIHsKCQkgICAgICByZXR1cm4gYVBhdGg7CgkJICAgIH0KCQkgICAgcGF0aCA9IHVybC5wYXRoOwoJCSAgfQoJCSAgdmFyIGlzQWJzb2x1dGUgPSBleHBvcnRzLmlzQWJzb2x1dGUocGF0aCk7CgoJCSAgdmFyIHBhcnRzID0gcGF0aC5zcGxpdCgvXC8rLyk7CgkJICBmb3IgKHZhciBwYXJ0LCB1cCA9IDAsIGkgPSBwYXJ0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewoJCSAgICBwYXJ0ID0gcGFydHNbaV07CgkJICAgIGlmIChwYXJ0ID09PSAnLicpIHsKCQkgICAgICBwYXJ0cy5zcGxpY2UoaSwgMSk7CgkJICAgIH0gZWxzZSBpZiAocGFydCA9PT0gJy4uJykgewoJCSAgICAgIHVwKys7CgkJICAgIH0gZWxzZSBpZiAodXAgPiAwKSB7CgkJICAgICAgaWYgKHBhcnQgPT09ICcnKSB7CgkJICAgICAgICAvLyBUaGUgZmlyc3QgcGFydCBpcyBibGFuayBpZiB0aGUgcGF0aCBpcyBhYnNvbHV0ZS4gVHJ5aW5nIHRvIGdvCgkJICAgICAgICAvLyBhYm92ZSB0aGUgcm9vdCBpcyBhIG5vLW9wLiBUaGVyZWZvcmUgd2UgY2FuIHJlbW92ZSBhbGwgJy4uJyBwYXJ0cwoJCSAgICAgICAgLy8gZGlyZWN0bHkgYWZ0ZXIgdGhlIHJvb3QuCgkJICAgICAgICBwYXJ0cy5zcGxpY2UoaSArIDEsIHVwKTsKCQkgICAgICAgIHVwID0gMDsKCQkgICAgICB9IGVsc2UgewoJCSAgICAgICAgcGFydHMuc3BsaWNlKGksIDIpOwoJCSAgICAgICAgdXAtLTsKCQkgICAgICB9CgkJICAgIH0KCQkgIH0KCQkgIHBhdGggPSBwYXJ0cy5qb2luKCcvJyk7CgoJCSAgaWYgKHBhdGggPT09ICcnKSB7CgkJICAgIHBhdGggPSBpc0Fic29sdXRlID8gJy8nIDogJy4nOwoJCSAgfQoKCQkgIGlmICh1cmwpIHsKCQkgICAgdXJsLnBhdGggPSBwYXRoOwoJCSAgICByZXR1cm4gdXJsR2VuZXJhdGUodXJsKTsKCQkgIH0KCQkgIHJldHVybiBwYXRoOwoJCX0KCQlleHBvcnRzLm5vcm1hbGl6ZSA9IG5vcm1hbGl6ZTsKCgkJLyoqCgkJICogSm9pbnMgdHdvIHBhdGhzL1VSTHMuCgkJICoKCQkgKiBAcGFyYW0gYVJvb3QgVGhlIHJvb3QgcGF0aCBvciBVUkwuCgkJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIFVSTCB0byBiZSBqb2luZWQgd2l0aCB0aGUgcm9vdC4KCQkgKgoJCSAqIC0gSWYgYVBhdGggaXMgYSBVUkwgb3IgYSBkYXRhIFVSSSwgYVBhdGggaXMgcmV0dXJuZWQsIHVubGVzcyBhUGF0aCBpcyBhCgkJICogICBzY2hlbWUtcmVsYXRpdmUgVVJMOiBUaGVuIHRoZSBzY2hlbWUgb2YgYVJvb3QsIGlmIGFueSwgaXMgcHJlcGVuZGVkCgkJICogICBmaXJzdC4KCQkgKiAtIE90aGVyd2lzZSBhUGF0aCBpcyBhIHBhdGguIElmIGFSb290IGlzIGEgVVJMLCB0aGVuIGl0cyBwYXRoIHBvcnRpb24KCQkgKiAgIGlzIHVwZGF0ZWQgd2l0aCB0aGUgcmVzdWx0IGFuZCBhUm9vdCBpcyByZXR1cm5lZC4gT3RoZXJ3aXNlIHRoZSByZXN1bHQKCQkgKiAgIGlzIHJldHVybmVkLgoJCSAqICAgLSBJZiBhUGF0aCBpcyBhYnNvbHV0ZSwgdGhlIHJlc3VsdCBpcyBhUGF0aC4KCQkgKiAgIC0gT3RoZXJ3aXNlIHRoZSB0d28gcGF0aHMgYXJlIGpvaW5lZCB3aXRoIGEgc2xhc2guCgkJICogLSBKb2luaW5nIGZvciBleGFtcGxlICdodHRwOi8vJyBhbmQgJ3d3dy5leGFtcGxlLmNvbScgaXMgYWxzbyBzdXBwb3J0ZWQuCgkJICovCgkJZnVuY3Rpb24gam9pbihhUm9vdCwgYVBhdGgpIHsKCQkgIGlmIChhUm9vdCA9PT0gIiIpIHsKCQkgICAgYVJvb3QgPSAiLiI7CgkJICB9CgkJICBpZiAoYVBhdGggPT09ICIiKSB7CgkJICAgIGFQYXRoID0gIi4iOwoJCSAgfQoJCSAgdmFyIGFQYXRoVXJsID0gdXJsUGFyc2UoYVBhdGgpOwoJCSAgdmFyIGFSb290VXJsID0gdXJsUGFyc2UoYVJvb3QpOwoJCSAgaWYgKGFSb290VXJsKSB7CgkJICAgIGFSb290ID0gYVJvb3RVcmwucGF0aCB8fCAnLyc7CgkJICB9CgoJCSAgLy8gYGpvaW4oZm9vLCAnLy93d3cuZXhhbXBsZS5vcmcnKWAKCQkgIGlmIChhUGF0aFVybCAmJiAhYVBhdGhVcmwuc2NoZW1lKSB7CgkJICAgIGlmIChhUm9vdFVybCkgewoJCSAgICAgIGFQYXRoVXJsLnNjaGVtZSA9IGFSb290VXJsLnNjaGVtZTsKCQkgICAgfQoJCSAgICByZXR1cm4gdXJsR2VuZXJhdGUoYVBhdGhVcmwpOwoJCSAgfQoKCQkgIGlmIChhUGF0aFVybCB8fCBhUGF0aC5tYXRjaChkYXRhVXJsUmVnZXhwKSkgewoJCSAgICByZXR1cm4gYVBhdGg7CgkJICB9CgoJCSAgLy8gYGpvaW4oJ2h0dHA6Ly8nLCAnd3d3LmV4YW1wbGUuY29tJylgCgkJICBpZiAoYVJvb3RVcmwgJiYgIWFSb290VXJsLmhvc3QgJiYgIWFSb290VXJsLnBhdGgpIHsKCQkgICAgYVJvb3RVcmwuaG9zdCA9IGFQYXRoOwoJCSAgICByZXR1cm4gdXJsR2VuZXJhdGUoYVJvb3RVcmwpOwoJCSAgfQoKCQkgIHZhciBqb2luZWQgPSBhUGF0aC5jaGFyQXQoMCkgPT09ICcvJwoJCSAgICA/IGFQYXRoCgkJICAgIDogbm9ybWFsaXplKGFSb290LnJlcGxhY2UoL1wvKyQvLCAnJykgKyAnLycgKyBhUGF0aCk7CgoJCSAgaWYgKGFSb290VXJsKSB7CgkJICAgIGFSb290VXJsLnBhdGggPSBqb2luZWQ7CgkJICAgIHJldHVybiB1cmxHZW5lcmF0ZShhUm9vdFVybCk7CgkJICB9CgkJICByZXR1cm4gam9pbmVkOwoJCX0KCQlleHBvcnRzLmpvaW4gPSBqb2luOwoKCQlleHBvcnRzLmlzQWJzb2x1dGUgPSBmdW5jdGlvbiAoYVBhdGgpIHsKCQkgIHJldHVybiBhUGF0aC5jaGFyQXQoMCkgPT09ICcvJyB8fCB1cmxSZWdleHAudGVzdChhUGF0aCk7CgkJfTsKCgkJLyoqCgkJICogTWFrZSBhIHBhdGggcmVsYXRpdmUgdG8gYSBVUkwgb3IgYW5vdGhlciBwYXRoLgoJCSAqCgkJICogQHBhcmFtIGFSb290IFRoZSByb290IHBhdGggb3IgVVJMLgoJCSAqIEBwYXJhbSBhUGF0aCBUaGUgcGF0aCBvciBVUkwgdG8gYmUgbWFkZSByZWxhdGl2ZSB0byBhUm9vdC4KCQkgKi8KCQlmdW5jdGlvbiByZWxhdGl2ZShhUm9vdCwgYVBhdGgpIHsKCQkgIGlmIChhUm9vdCA9PT0gIiIpIHsKCQkgICAgYVJvb3QgPSAiLiI7CgkJICB9CgoJCSAgYVJvb3QgPSBhUm9vdC5yZXBsYWNlKC9cLyQvLCAnJyk7CgoJCSAgLy8gSXQgaXMgcG9zc2libGUgZm9yIHRoZSBwYXRoIHRvIGJlIGFib3ZlIHRoZSByb290LiBJbiB0aGlzIGNhc2UsIHNpbXBseQoJCSAgLy8gY2hlY2tpbmcgd2hldGhlciB0aGUgcm9vdCBpcyBhIHByZWZpeCBvZiB0aGUgcGF0aCB3b24ndCB3b3JrLiBJbnN0ZWFkLCB3ZQoJCSAgLy8gbmVlZCB0byByZW1vdmUgY29tcG9uZW50cyBmcm9tIHRoZSByb290IG9uZSBieSBvbmUsIHVudGlsIGVpdGhlciB3ZSBmaW5kCgkJICAvLyBhIHByZWZpeCB0aGF0IGZpdHMsIG9yIHdlIHJ1biBvdXQgb2YgY29tcG9uZW50cyB0byByZW1vdmUuCgkJICB2YXIgbGV2ZWwgPSAwOwoJCSAgd2hpbGUgKGFQYXRoLmluZGV4T2YoYVJvb3QgKyAnLycpICE9PSAwKSB7CgkJICAgIHZhciBpbmRleCA9IGFSb290Lmxhc3RJbmRleE9mKCIvIik7CgkJICAgIGlmIChpbmRleCA8IDApIHsKCQkgICAgICByZXR1cm4gYVBhdGg7CgkJICAgIH0KCgkJICAgIC8vIElmIHRoZSBvbmx5IHBhcnQgb2YgdGhlIHJvb3QgdGhhdCBpcyBsZWZ0IGlzIHRoZSBzY2hlbWUgKGkuZS4gaHR0cDovLywKCQkgICAgLy8gZmlsZTovLy8sIGV0Yy4pLCBvbmUgb3IgbW9yZSBzbGFzaGVzICgvKSwgb3Igc2ltcGx5IG5vdGhpbmcgYXQgYWxsLCB3ZQoJCSAgICAvLyBoYXZlIGV4aGF1c3RlZCBhbGwgY29tcG9uZW50cywgc28gdGhlIHBhdGggaXMgbm90IHJlbGF0aXZlIHRvIHRoZSByb290LgoJCSAgICBhUm9vdCA9IGFSb290LnNsaWNlKDAsIGluZGV4KTsKCQkgICAgaWYgKGFSb290Lm1hdGNoKC9eKFteXC9dKzpcLyk/XC8qJC8pKSB7CgkJICAgICAgcmV0dXJuIGFQYXRoOwoJCSAgICB9CgoJCSAgICArK2xldmVsOwoJCSAgfQoKCQkgIC8vIE1ha2Ugc3VyZSB3ZSBhZGQgYSAiLi4vIiBmb3IgZWFjaCBjb21wb25lbnQgd2UgcmVtb3ZlZCBmcm9tIHRoZSByb290LgoJCSAgcmV0dXJuIEFycmF5KGxldmVsICsgMSkuam9pbigiLi4vIikgKyBhUGF0aC5zdWJzdHIoYVJvb3QubGVuZ3RoICsgMSk7CgkJfQoJCWV4cG9ydHMucmVsYXRpdmUgPSByZWxhdGl2ZTsKCgkJdmFyIHN1cHBvcnRzTnVsbFByb3RvID0gKGZ1bmN0aW9uICgpIHsKCQkgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJCSAgcmV0dXJuICEoJ19fcHJvdG9fXycgaW4gb2JqKTsKCQl9KCkpOwoKCQlmdW5jdGlvbiBpZGVudGl0eSAocykgewoJCSAgcmV0dXJuIHM7CgkJfQoKCQkvKioKCQkgKiBCZWNhdXNlIGJlaGF2aW9yIGdvZXMgd2Fja3kgd2hlbiB5b3Ugc2V0IGBfX3Byb3RvX19gIG9uIG9iamVjdHMsIHdlCgkJICogaGF2ZSB0byBwcmVmaXggYWxsIHRoZSBzdHJpbmdzIGluIG91ciBzZXQgd2l0aCBhbiBhcmJpdHJhcnkgY2hhcmFjdGVyLgoJCSAqCgkJICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3NvdXJjZS1tYXAvcHVsbC8zMSBhbmQKCQkgKiBodHRwczovL2dpdGh1Yi5jb20vbW96aWxsYS9zb3VyY2UtbWFwL2lzc3Vlcy8zMAoJCSAqCgkJICogQHBhcmFtIFN0cmluZyBhU3RyCgkJICovCgkJZnVuY3Rpb24gdG9TZXRTdHJpbmcoYVN0cikgewoJCSAgaWYgKGlzUHJvdG9TdHJpbmcoYVN0cikpIHsKCQkgICAgcmV0dXJuICckJyArIGFTdHI7CgkJICB9CgoJCSAgcmV0dXJuIGFTdHI7CgkJfQoJCWV4cG9ydHMudG9TZXRTdHJpbmcgPSBzdXBwb3J0c051bGxQcm90byA/IGlkZW50aXR5IDogdG9TZXRTdHJpbmc7CgoJCWZ1bmN0aW9uIGZyb21TZXRTdHJpbmcoYVN0cikgewoJCSAgaWYgKGlzUHJvdG9TdHJpbmcoYVN0cikpIHsKCQkgICAgcmV0dXJuIGFTdHIuc2xpY2UoMSk7CgkJICB9CgoJCSAgcmV0dXJuIGFTdHI7CgkJfQoJCWV4cG9ydHMuZnJvbVNldFN0cmluZyA9IHN1cHBvcnRzTnVsbFByb3RvID8gaWRlbnRpdHkgOiBmcm9tU2V0U3RyaW5nOwoKCQlmdW5jdGlvbiBpc1Byb3RvU3RyaW5nKHMpIHsKCQkgIGlmICghcykgewoJCSAgICByZXR1cm4gZmFsc2U7CgkJICB9CgoJCSAgdmFyIGxlbmd0aCA9IHMubGVuZ3RoOwoKCQkgIGlmIChsZW5ndGggPCA5IC8qICJfX3Byb3RvX18iLmxlbmd0aCAqLykgewoJCSAgICByZXR1cm4gZmFsc2U7CgkJICB9CgoJCSAgaWYgKHMuY2hhckNvZGVBdChsZW5ndGggLSAxKSAhPT0gOTUgIC8qICdfJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSAyKSAhPT0gOTUgIC8qICdfJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSAzKSAhPT0gMTExIC8qICdvJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA0KSAhPT0gMTE2IC8qICd0JyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA1KSAhPT0gMTExIC8qICdvJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA2KSAhPT0gMTE0IC8qICdyJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA3KSAhPT0gMTEyIC8qICdwJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA4KSAhPT0gOTUgIC8qICdfJyAqLyB8fAoJCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA5KSAhPT0gOTUgIC8qICdfJyAqLykgewoJCSAgICByZXR1cm4gZmFsc2U7CgkJICB9CgoJCSAgZm9yICh2YXIgaSA9IGxlbmd0aCAtIDEwOyBpID49IDA7IGktLSkgewoJCSAgICBpZiAocy5jaGFyQ29kZUF0KGkpICE9PSAzNiAvKiAnJCcgKi8pIHsKCQkgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH0KCQkgIH0KCgkJICByZXR1cm4gdHJ1ZTsKCQl9CgoJCS8qKgoJCSAqIENvbXBhcmF0b3IgYmV0d2VlbiB0d28gbWFwcGluZ3Mgd2hlcmUgdGhlIG9yaWdpbmFsIHBvc2l0aW9ucyBhcmUgY29tcGFyZWQuCgkJICoKCQkgKiBPcHRpb25hbGx5IHBhc3MgaW4gYHRydWVgIGFzIGBvbmx5Q29tcGFyZUdlbmVyYXRlZGAgdG8gY29uc2lkZXIgdHdvCgkJICogbWFwcGluZ3Mgd2l0aCB0aGUgc2FtZSBvcmlnaW5hbCBzb3VyY2UvbGluZS9jb2x1bW4sIGJ1dCBkaWZmZXJlbnQgZ2VuZXJhdGVkCgkJICogbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEgbWFwcGluZyB3aXRoIGEKCQkgKiBzdHViYmVkIG91dCBtYXBwaW5nLgoJCSAqLwoJCWZ1bmN0aW9uIGNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJCSAgdmFyIGNtcCA9IHN0cmNtcChtYXBwaW5nQS5zb3VyY2UsIG1hcHBpbmdCLnNvdXJjZSk7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkJICBpZiAoY21wICE9PSAwIHx8IG9ubHlDb21wYXJlT3JpZ2luYWwpIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRDb2x1bW4gLSBtYXBwaW5nQi5nZW5lcmF0ZWRDb2x1bW47CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCQl9CgkJZXhwb3J0cy5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9ucyA9IGNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zOwoKCQkvKioKCQkgKiBDb21wYXJhdG9yIGJldHdlZW4gdHdvIG1hcHBpbmdzIHdpdGggZGVmbGF0ZWQgc291cmNlIGFuZCBuYW1lIGluZGljZXMgd2hlcmUKCQkgKiB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9ucyBhcmUgY29tcGFyZWQuCgkJICoKCQkgKiBPcHRpb25hbGx5IHBhc3MgaW4gYHRydWVgIGFzIGBvbmx5Q29tcGFyZUdlbmVyYXRlZGAgdG8gY29uc2lkZXIgdHdvCgkJICogbWFwcGluZ3Mgd2l0aCB0aGUgc2FtZSBnZW5lcmF0ZWQgbGluZSBhbmQgY29sdW1uLCBidXQgZGlmZmVyZW50CgkJICogc291cmNlL25hbWUvb3JpZ2luYWwgbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEKCQkgKiBtYXBwaW5nIHdpdGggYSBzdHViYmVkIG91dCBtYXBwaW5nLgoJCSAqLwoJCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCQkgIHZhciBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRMaW5lIC0gbWFwcGluZ0IuZ2VuZXJhdGVkTGluZTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRDb2x1bW4gLSBtYXBwaW5nQi5nZW5lcmF0ZWRDb2x1bW47CgkJICBpZiAoY21wICE9PSAwIHx8IG9ubHlDb21wYXJlR2VuZXJhdGVkKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbExpbmUgLSBtYXBwaW5nQi5vcmlnaW5hbExpbmU7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJCX0KCQlleHBvcnRzLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkID0gY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQ7CgoJCWZ1bmN0aW9uIHN0cmNtcChhU3RyMSwgYVN0cjIpIHsKCQkgIGlmIChhU3RyMSA9PT0gYVN0cjIpIHsKCQkgICAgcmV0dXJuIDA7CgkJICB9CgoJCSAgaWYgKGFTdHIxID09PSBudWxsKSB7CgkJICAgIHJldHVybiAxOyAvLyBhU3RyMiAhPT0gbnVsbAoJCSAgfQoKCQkgIGlmIChhU3RyMiA9PT0gbnVsbCkgewoJCSAgICByZXR1cm4gLTE7IC8vIGFTdHIxICE9PSBudWxsCgkJICB9CgoJCSAgaWYgKGFTdHIxID4gYVN0cjIpIHsKCQkgICAgcmV0dXJuIDE7CgkJICB9CgoJCSAgcmV0dXJuIC0xOwoJCX0KCgkJLyoqCgkJICogQ29tcGFyYXRvciBiZXR3ZWVuIHR3byBtYXBwaW5ncyB3aXRoIGluZmxhdGVkIHNvdXJjZSBhbmQgbmFtZSBzdHJpbmdzIHdoZXJlCgkJICogdGhlIGdlbmVyYXRlZCBwb3NpdGlvbnMgYXJlIGNvbXBhcmVkLgoJCSAqLwoJCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQikgewoJCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBzdHJjbXAobWFwcGluZ0Euc291cmNlLCBtYXBwaW5nQi5zb3VyY2UpOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbENvbHVtbiAtIG1hcHBpbmdCLm9yaWdpbmFsQ29sdW1uOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIHJldHVybiBzdHJjbXAobWFwcGluZ0EubmFtZSwgbWFwcGluZ0IubmFtZSk7CgkJfQoJCWV4cG9ydHMuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQgPSBjb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZDsKCgkJLyoqCgkJICogU3RyaXAgYW55IEpTT04gWFNTSSBhdm9pZGFuY2UgcHJlZml4IGZyb20gdGhlIHN0cmluZyAoYXMgZG9jdW1lbnRlZAoJCSAqIGluIHRoZSBzb3VyY2UgbWFwcyBzcGVjaWZpY2F0aW9uKSwgYW5kIHRoZW4gcGFyc2UgdGhlIHN0cmluZyBhcwoJCSAqIEpTT04uCgkJICovCgkJZnVuY3Rpb24gcGFyc2VTb3VyY2VNYXBJbnB1dChzdHIpIHsKCQkgIHJldHVybiBKU09OLnBhcnNlKHN0ci5yZXBsYWNlKC9eXCldfSdbXlxuXSpcbi8sICcnKSk7CgkJfQoJCWV4cG9ydHMucGFyc2VTb3VyY2VNYXBJbnB1dCA9IHBhcnNlU291cmNlTWFwSW5wdXQ7CgoJCS8qKgoJCSAqIENvbXB1dGUgdGhlIFVSTCBvZiBhIHNvdXJjZSBnaXZlbiB0aGUgdGhlIHNvdXJjZSByb290LCB0aGUgc291cmNlJ3MKCQkgKiBVUkwsIGFuZCB0aGUgc291cmNlIG1hcCdzIFVSTC4KCQkgKi8KCQlmdW5jdGlvbiBjb21wdXRlU291cmNlVVJMKHNvdXJjZVJvb3QsIHNvdXJjZVVSTCwgc291cmNlTWFwVVJMKSB7CgkJICBzb3VyY2VVUkwgPSBzb3VyY2VVUkwgfHwgJyc7CgoJCSAgaWYgKHNvdXJjZVJvb3QpIHsKCQkgICAgLy8gVGhpcyBmb2xsb3dzIHdoYXQgQ2hyb21lIGRvZXMuCgkJICAgIGlmIChzb3VyY2VSb290W3NvdXJjZVJvb3QubGVuZ3RoIC0gMV0gIT09ICcvJyAmJiBzb3VyY2VVUkxbMF0gIT09ICcvJykgewoJCSAgICAgIHNvdXJjZVJvb3QgKz0gJy8nOwoJCSAgICB9CgkJICAgIC8vIFRoZSBzcGVjIHNheXM6CgkJICAgIC8vICAgTGluZSA0OiBBbiBvcHRpb25hbCBzb3VyY2Ugcm9vdCwgdXNlZnVsIGZvciByZWxvY2F0aW5nIHNvdXJjZQoJCSAgICAvLyAgIGZpbGVzIG9uIGEgc2VydmVyIG9yIHJlbW92aW5nIHJlcGVhdGVkIHZhbHVlcyBpbiB0aGUKCQkgICAgLy8gICDigJxzb3VyY2Vz4oCdIGVudHJ5LiAgVGhpcyB2YWx1ZSBpcyBwcmVwZW5kZWQgdG8gdGhlIGluZGl2aWR1YWwKCQkgICAgLy8gICBlbnRyaWVzIGluIHRoZSDigJxzb3VyY2XigJ0gZmllbGQuCgkJICAgIHNvdXJjZVVSTCA9IHNvdXJjZVJvb3QgKyBzb3VyY2VVUkw7CgkJICB9CgoJCSAgLy8gSGlzdG9yaWNhbGx5LCBTb3VyY2VNYXBDb25zdW1lciBkaWQgbm90IHRha2UgdGhlIHNvdXJjZU1hcFVSTCBhcwoJCSAgLy8gYSBwYXJhbWV0ZXIuICBUaGlzIG1vZGUgaXMgc3RpbGwgc29tZXdoYXQgc3VwcG9ydGVkLCB3aGljaCBpcyB3aHkKCQkgIC8vIHRoaXMgY29kZSBibG9jayBpcyBjb25kaXRpb25hbC4gIEhvd2V2ZXIsIGl0J3MgcHJlZmVyYWJsZSB0byBwYXNzCgkJICAvLyB0aGUgc291cmNlIG1hcCBVUkwgdG8gU291cmNlTWFwQ29uc3VtZXIsIHNvIHRoYXQgdGhpcyBmdW5jdGlvbgoJCSAgLy8gY2FuIGltcGxlbWVudCB0aGUgc291cmNlIFVSTCByZXNvbHV0aW9uIGFsZ29yaXRobSBhcyBvdXRsaW5lZCBpbgoJCSAgLy8gdGhlIHNwZWMuICBUaGlzIGJsb2NrIGlzIGJhc2ljYWxseSB0aGUgZXF1aXZhbGVudCBvZjoKCQkgIC8vICAgIG5ldyBVUkwoc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpLnRvU3RyaW5nKCkKCQkgIC8vIC4uLiBleGNlcHQgaXQgYXZvaWRzIHVzaW5nIFVSTCwgd2hpY2ggd2Fzbid0IGF2YWlsYWJsZSBpbiB0aGUKCQkgIC8vIG9sZGVyIHJlbGVhc2VzIG9mIG5vZGUgc3RpbGwgc3VwcG9ydGVkIGJ5IHRoaXMgbGlicmFyeS4KCQkgIC8vCgkJICAvLyBUaGUgc3BlYyBzYXlzOgoJCSAgLy8gICBJZiB0aGUgc291cmNlcyBhcmUgbm90IGFic29sdXRlIFVSTHMgYWZ0ZXIgcHJlcGVuZGluZyBvZiB0aGUKCQkgIC8vICAg4oCcc291cmNlUm9vdOKAnSwgdGhlIHNvdXJjZXMgYXJlIHJlc29sdmVkIHJlbGF0aXZlIHRvIHRoZQoJCSAgLy8gICBTb3VyY2VNYXAgKGxpa2UgcmVzb2x2aW5nIHNjcmlwdCBzcmMgaW4gYSBodG1sIGRvY3VtZW50KS4KCQkgIGlmIChzb3VyY2VNYXBVUkwpIHsKCQkgICAgdmFyIHBhcnNlZCA9IHVybFBhcnNlKHNvdXJjZU1hcFVSTCk7CgkJICAgIGlmICghcGFyc2VkKSB7CgkJICAgICAgdGhyb3cgbmV3IEVycm9yKCJzb3VyY2VNYXBVUkwgY291bGQgbm90IGJlIHBhcnNlZCIpOwoJCSAgICB9CgkJICAgIGlmIChwYXJzZWQucGF0aCkgewoJCSAgICAgIC8vIFN0cmlwIHRoZSBsYXN0IHBhdGggY29tcG9uZW50LCBidXQga2VlcCB0aGUgIi8iLgoJCSAgICAgIHZhciBpbmRleCA9IHBhcnNlZC5wYXRoLmxhc3RJbmRleE9mKCcvJyk7CgkJICAgICAgaWYgKGluZGV4ID49IDApIHsKCQkgICAgICAgIHBhcnNlZC5wYXRoID0gcGFyc2VkLnBhdGguc3Vic3RyaW5nKDAsIGluZGV4ICsgMSk7CgkJICAgICAgfQoJCSAgICB9CgkJICAgIHNvdXJjZVVSTCA9IGpvaW4odXJsR2VuZXJhdGUocGFyc2VkKSwgc291cmNlVVJMKTsKCQkgIH0KCgkJICByZXR1cm4gbm9ybWFsaXplKHNvdXJjZVVSTCk7CgkJfQoJCWV4cG9ydHMuY29tcHV0ZVNvdXJjZVVSTCA9IGNvbXB1dGVTb3VyY2VVUkw7IAoJfSAodXRpbCQ0KSk7CglyZXR1cm4gdXRpbCQ0Owp9Cgp2YXIgYXJyYXlTZXQkMSA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkQXJyYXlTZXQ7CgpmdW5jdGlvbiByZXF1aXJlQXJyYXlTZXQgKCkgewoJaWYgKGhhc1JlcXVpcmVkQXJyYXlTZXQpIHJldHVybiBhcnJheVNldCQxOwoJaGFzUmVxdWlyZWRBcnJheVNldCA9IDE7CgkvKgoJICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgoJICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQoJICovCgoJdmFyIHV0aWwgPSByZXF1aXJlVXRpbCgpOwoJdmFyIGhhcyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7Cgl2YXIgaGFzTmF0aXZlTWFwID0gdHlwZW9mIE1hcCAhPT0gInVuZGVmaW5lZCI7CgoJLyoqCgkgKiBBIGRhdGEgc3RydWN0dXJlIHdoaWNoIGlzIGEgY29tYmluYXRpb24gb2YgYW4gYXJyYXkgYW5kIGEgc2V0LiBBZGRpbmcgYSBuZXcKCSAqIG1lbWJlciBpcyBPKDEpLCB0ZXN0aW5nIGZvciBtZW1iZXJzaGlwIGlzIE8oMSksIGFuZCBmaW5kaW5nIHRoZSBpbmRleCBvZiBhbgoJICogZWxlbWVudCBpcyBPKDEpLiBSZW1vdmluZyBlbGVtZW50cyBmcm9tIHRoZSBzZXQgaXMgbm90IHN1cHBvcnRlZC4gT25seQoJICogc3RyaW5ncyBhcmUgc3VwcG9ydGVkIGZvciBtZW1iZXJzaGlwLgoJICovCglmdW5jdGlvbiBBcnJheVNldCgpIHsKCSAgdGhpcy5fYXJyYXkgPSBbXTsKCSAgdGhpcy5fc2V0ID0gaGFzTmF0aXZlTWFwID8gbmV3IE1hcCgpIDogT2JqZWN0LmNyZWF0ZShudWxsKTsKCX0KCgkvKioKCSAqIFN0YXRpYyBtZXRob2QgZm9yIGNyZWF0aW5nIEFycmF5U2V0IGluc3RhbmNlcyBmcm9tIGFuIGV4aXN0aW5nIGFycmF5LgoJICovCglBcnJheVNldC5mcm9tQXJyYXkgPSBmdW5jdGlvbiBBcnJheVNldF9mcm9tQXJyYXkoYUFycmF5LCBhQWxsb3dEdXBsaWNhdGVzKSB7CgkgIHZhciBzZXQgPSBuZXcgQXJyYXlTZXQoKTsKCSAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgIHNldC5hZGQoYUFycmF5W2ldLCBhQWxsb3dEdXBsaWNhdGVzKTsKCSAgfQoJICByZXR1cm4gc2V0OwoJfTsKCgkvKioKCSAqIFJldHVybiBob3cgbWFueSB1bmlxdWUgaXRlbXMgYXJlIGluIHRoaXMgQXJyYXlTZXQuIElmIGR1cGxpY2F0ZXMgaGF2ZSBiZWVuCgkgKiBhZGRlZCwgdGhhbiB0aG9zZSBkbyBub3QgY291bnQgdG93YXJkcyB0aGUgc2l6ZS4KCSAqCgkgKiBAcmV0dXJucyBOdW1iZXIKCSAqLwoJQXJyYXlTZXQucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiBBcnJheVNldF9zaXplKCkgewoJICByZXR1cm4gaGFzTmF0aXZlTWFwID8gdGhpcy5fc2V0LnNpemUgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLl9zZXQpLmxlbmd0aDsKCX07CgoJLyoqCgkgKiBBZGQgdGhlIGdpdmVuIHN0cmluZyB0byB0aGlzIHNldC4KCSAqCgkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCSAqLwoJQXJyYXlTZXQucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIEFycmF5U2V0X2FkZChhU3RyLCBhQWxsb3dEdXBsaWNhdGVzKSB7CgkgIHZhciBzU3RyID0gaGFzTmF0aXZlTWFwID8gYVN0ciA6IHV0aWwudG9TZXRTdHJpbmcoYVN0cik7CgkgIHZhciBpc0R1cGxpY2F0ZSA9IGhhc05hdGl2ZU1hcCA/IHRoaXMuaGFzKGFTdHIpIDogaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKCSAgdmFyIGlkeCA9IHRoaXMuX2FycmF5Lmxlbmd0aDsKCSAgaWYgKCFpc0R1cGxpY2F0ZSB8fCBhQWxsb3dEdXBsaWNhdGVzKSB7CgkgICAgdGhpcy5fYXJyYXkucHVzaChhU3RyKTsKCSAgfQoJICBpZiAoIWlzRHVwbGljYXRlKSB7CgkgICAgaWYgKGhhc05hdGl2ZU1hcCkgewoJICAgICAgdGhpcy5fc2V0LnNldChhU3RyLCBpZHgpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLl9zZXRbc1N0cl0gPSBpZHg7CgkgICAgfQoJICB9Cgl9OwoKCS8qKgoJICogSXMgdGhlIGdpdmVuIHN0cmluZyBhIG1lbWJlciBvZiB0aGlzIHNldD8KCSAqCgkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCSAqLwoJQXJyYXlTZXQucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uIEFycmF5U2V0X2hhcyhhU3RyKSB7CgkgIGlmIChoYXNOYXRpdmVNYXApIHsKCSAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhhU3RyKTsKCSAgfSBlbHNlIHsKCSAgICB2YXIgc1N0ciA9IHV0aWwudG9TZXRTdHJpbmcoYVN0cik7CgkgICAgcmV0dXJuIGhhcy5jYWxsKHRoaXMuX3NldCwgc1N0cik7CgkgIH0KCX07CgoJLyoqCgkgKiBXaGF0IGlzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gc3RyaW5nIGluIHRoZSBhcnJheT8KCSAqCgkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCSAqLwoJQXJyYXlTZXQucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiBBcnJheVNldF9pbmRleE9mKGFTdHIpIHsKCSAgaWYgKGhhc05hdGl2ZU1hcCkgewoJICAgIHZhciBpZHggPSB0aGlzLl9zZXQuZ2V0KGFTdHIpOwoJICAgIGlmIChpZHggPj0gMCkgewoJICAgICAgICByZXR1cm4gaWR4OwoJICAgIH0KCSAgfSBlbHNlIHsKCSAgICB2YXIgc1N0ciA9IHV0aWwudG9TZXRTdHJpbmcoYVN0cik7CgkgICAgaWYgKGhhcy5jYWxsKHRoaXMuX3NldCwgc1N0cikpIHsKCSAgICAgIHJldHVybiB0aGlzLl9zZXRbc1N0cl07CgkgICAgfQoJICB9CgoJICB0aHJvdyBuZXcgRXJyb3IoJyInICsgYVN0ciArICciIGlzIG5vdCBpbiB0aGUgc2V0LicpOwoJfTsKCgkvKioKCSAqIFdoYXQgaXMgdGhlIGVsZW1lbnQgYXQgdGhlIGdpdmVuIGluZGV4PwoJICoKCSAqIEBwYXJhbSBOdW1iZXIgYUlkeAoJICovCglBcnJheVNldC5wcm90b3R5cGUuYXQgPSBmdW5jdGlvbiBBcnJheVNldF9hdChhSWR4KSB7CgkgIGlmIChhSWR4ID49IDAgJiYgYUlkeCA8IHRoaXMuX2FycmF5Lmxlbmd0aCkgewoJICAgIHJldHVybiB0aGlzLl9hcnJheVthSWR4XTsKCSAgfQoJICB0aHJvdyBuZXcgRXJyb3IoJ05vIGVsZW1lbnQgaW5kZXhlZCBieSAnICsgYUlkeCk7Cgl9OwoKCS8qKgoJICogUmV0dXJucyB0aGUgYXJyYXkgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBzZXQgKHdoaWNoIGhhcyB0aGUgcHJvcGVyIGluZGljZXMKCSAqIGluZGljYXRlZCBieSBpbmRleE9mKS4gTm90ZSB0aGF0IHRoaXMgaXMgYSBjb3B5IG9mIHRoZSBpbnRlcm5hbCBhcnJheSB1c2VkCgkgKiBmb3Igc3RvcmluZyB0aGUgbWVtYmVycyBzbyB0aGF0IG5vIG9uZSBjYW4gbWVzcyB3aXRoIGludGVybmFsIHN0YXRlLgoJICovCglBcnJheVNldC5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uIEFycmF5U2V0X3RvQXJyYXkoKSB7CgkgIHJldHVybiB0aGlzLl9hcnJheS5zbGljZSgpOwoJfTsKCglhcnJheVNldCQxLkFycmF5U2V0ID0gQXJyYXlTZXQ7CglyZXR1cm4gYXJyYXlTZXQkMTsKfQoKdmFyIG1hcHBpbmdMaXN0JDEgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZE1hcHBpbmdMaXN0OwoKZnVuY3Rpb24gcmVxdWlyZU1hcHBpbmdMaXN0ICgpIHsKCWlmIChoYXNSZXF1aXJlZE1hcHBpbmdMaXN0KSByZXR1cm4gbWFwcGluZ0xpc3QkMTsKCWhhc1JlcXVpcmVkTWFwcGluZ0xpc3QgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDE0IE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCXZhciB1dGlsID0gcmVxdWlyZVV0aWwoKTsKCgkvKioKCSAqIERldGVybWluZSB3aGV0aGVyIG1hcHBpbmdCIGlzIGFmdGVyIG1hcHBpbmdBIHdpdGggcmVzcGVjdCB0byBnZW5lcmF0ZWQKCSAqIHBvc2l0aW9uLgoJICovCglmdW5jdGlvbiBnZW5lcmF0ZWRQb3NpdGlvbkFmdGVyKG1hcHBpbmdBLCBtYXBwaW5nQikgewoJICAvLyBPcHRpbWl6ZWQgZm9yIG1vc3QgY29tbW9uIGNhc2UKCSAgdmFyIGxpbmVBID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZTsKCSAgdmFyIGxpbmVCID0gbWFwcGluZ0IuZ2VuZXJhdGVkTGluZTsKCSAgdmFyIGNvbHVtbkEgPSBtYXBwaW5nQS5nZW5lcmF0ZWRDb2x1bW47CgkgIHZhciBjb2x1bW5CID0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJICByZXR1cm4gbGluZUIgPiBsaW5lQSB8fCBsaW5lQiA9PSBsaW5lQSAmJiBjb2x1bW5CID49IGNvbHVtbkEgfHwKCSAgICAgICAgIHV0aWwuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQobWFwcGluZ0EsIG1hcHBpbmdCKSA8PSAwOwoJfQoKCS8qKgoJICogQSBkYXRhIHN0cnVjdHVyZSB0byBwcm92aWRlIGEgc29ydGVkIHZpZXcgb2YgYWNjdW11bGF0ZWQgbWFwcGluZ3MgaW4gYQoJICogcGVyZm9ybWFuY2UgY29uc2Npb3VzIG1hbm5lci4gSXQgdHJhZGVzIGEgbmVnbGliYWJsZSBvdmVyaGVhZCBpbiBnZW5lcmFsCgkgKiBjYXNlIGZvciBhIGxhcmdlIHNwZWVkdXAgaW4gY2FzZSBvZiBtYXBwaW5ncyBiZWluZyBhZGRlZCBpbiBvcmRlci4KCSAqLwoJZnVuY3Rpb24gTWFwcGluZ0xpc3QoKSB7CgkgIHRoaXMuX2FycmF5ID0gW107CgkgIHRoaXMuX3NvcnRlZCA9IHRydWU7CgkgIC8vIFNlcnZlcyBhcyBpbmZpbXVtCgkgIHRoaXMuX2xhc3QgPSB7Z2VuZXJhdGVkTGluZTogLTEsIGdlbmVyYXRlZENvbHVtbjogMH07Cgl9CgoJLyoqCgkgKiBJdGVyYXRlIHRocm91Z2ggaW50ZXJuYWwgaXRlbXMuIFRoaXMgbWV0aG9kIHRha2VzIHRoZSBzYW1lIGFyZ3VtZW50cyB0aGF0CgkgKiBgQXJyYXkucHJvdG90eXBlLmZvckVhY2hgIHRha2VzLgoJICoKCSAqIE5PVEU6IFRoZSBvcmRlciBvZiB0aGUgbWFwcGluZ3MgaXMgTk9UIGd1YXJhbnRlZWQuCgkgKi8KCU1hcHBpbmdMaXN0LnByb3RvdHlwZS51bnNvcnRlZEZvckVhY2ggPQoJICBmdW5jdGlvbiBNYXBwaW5nTGlzdF9mb3JFYWNoKGFDYWxsYmFjaywgYVRoaXNBcmcpIHsKCSAgICB0aGlzLl9hcnJheS5mb3JFYWNoKGFDYWxsYmFjaywgYVRoaXNBcmcpOwoJICB9OwoKCS8qKgoJICogQWRkIHRoZSBnaXZlbiBzb3VyY2UgbWFwcGluZy4KCSAqCgkgKiBAcGFyYW0gT2JqZWN0IGFNYXBwaW5nCgkgKi8KCU1hcHBpbmdMaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBNYXBwaW5nTGlzdF9hZGQoYU1hcHBpbmcpIHsKCSAgaWYgKGdlbmVyYXRlZFBvc2l0aW9uQWZ0ZXIodGhpcy5fbGFzdCwgYU1hcHBpbmcpKSB7CgkgICAgdGhpcy5fbGFzdCA9IGFNYXBwaW5nOwoJICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwoJICB9IGVsc2UgewoJICAgIHRoaXMuX3NvcnRlZCA9IGZhbHNlOwoJICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwoJICB9Cgl9OwoKCS8qKgoJICogUmV0dXJucyB0aGUgZmxhdCwgc29ydGVkIGFycmF5IG9mIG1hcHBpbmdzLiBUaGUgbWFwcGluZ3MgYXJlIHNvcnRlZCBieQoJICogZ2VuZXJhdGVkIHBvc2l0aW9uLgoJICoKCSAqIFdBUk5JTkc6IFRoaXMgbWV0aG9kIHJldHVybnMgaW50ZXJuYWwgZGF0YSB3aXRob3V0IGNvcHlpbmcsIGZvcgoJICogcGVyZm9ybWFuY2UuIFRoZSByZXR1cm4gdmFsdWUgbXVzdCBOT1QgYmUgbXV0YXRlZCwgYW5kIHNob3VsZCBiZSB0cmVhdGVkIGFzCgkgKiBhbiBpbW11dGFibGUgYm9ycm93LiBJZiB5b3Ugd2FudCB0byB0YWtlIG93bmVyc2hpcCwgeW91IG11c3QgbWFrZSB5b3VyIG93bgoJICogY29weS4KCSAqLwoJTWFwcGluZ0xpc3QucHJvdG90eXBlLnRvQXJyYXkgPSBmdW5jdGlvbiBNYXBwaW5nTGlzdF90b0FycmF5KCkgewoJICBpZiAoIXRoaXMuX3NvcnRlZCkgewoJICAgIHRoaXMuX2FycmF5LnNvcnQodXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZCk7CgkgICAgdGhpcy5fc29ydGVkID0gdHJ1ZTsKCSAgfQoJICByZXR1cm4gdGhpcy5fYXJyYXk7Cgl9OwoKCW1hcHBpbmdMaXN0JDEuTWFwcGluZ0xpc3QgPSBNYXBwaW5nTGlzdDsKCXJldHVybiBtYXBwaW5nTGlzdCQxOwp9CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRTb3VyY2VNYXBHZW5lcmF0b3I7CgpmdW5jdGlvbiByZXF1aXJlU291cmNlTWFwR2VuZXJhdG9yICgpIHsKCWlmIChoYXNSZXF1aXJlZFNvdXJjZU1hcEdlbmVyYXRvcikgcmV0dXJuIHNvdXJjZU1hcEdlbmVyYXRvcjsKCWhhc1JlcXVpcmVkU291cmNlTWFwR2VuZXJhdG9yID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgl2YXIgYmFzZTY0VkxRID0gcmVxdWlyZUJhc2U2NFZscSgpOwoJdmFyIHV0aWwgPSByZXF1aXJlVXRpbCgpOwoJdmFyIEFycmF5U2V0ID0gcmVxdWlyZUFycmF5U2V0KCkuQXJyYXlTZXQ7Cgl2YXIgTWFwcGluZ0xpc3QgPSByZXF1aXJlTWFwcGluZ0xpc3QoKS5NYXBwaW5nTGlzdDsKCgkvKioKCSAqIEFuIGluc3RhbmNlIG9mIHRoZSBTb3VyY2VNYXBHZW5lcmF0b3IgcmVwcmVzZW50cyBhIHNvdXJjZSBtYXAgd2hpY2ggaXMKCSAqIGJlaW5nIGJ1aWx0IGluY3JlbWVudGFsbHkuIFlvdSBtYXkgcGFzcyBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nCgkgKiBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBmaWxlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIGdlbmVyYXRlZCBzb3VyY2UuCgkgKiAgIC0gc291cmNlUm9vdDogQSByb290IGZvciBhbGwgcmVsYXRpdmUgVVJMcyBpbiB0aGlzIHNvdXJjZSBtYXAuCgkgKi8KCWZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcihhQXJncykgewoJICBpZiAoIWFBcmdzKSB7CgkgICAgYUFyZ3MgPSB7fTsKCSAgfQoJICB0aGlzLl9maWxlID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdmaWxlJywgbnVsbCk7CgkgIHRoaXMuX3NvdXJjZVJvb3QgPSB1dGlsLmdldEFyZyhhQXJncywgJ3NvdXJjZVJvb3QnLCBudWxsKTsKCSAgdGhpcy5fc2tpcFZhbGlkYXRpb24gPSB1dGlsLmdldEFyZyhhQXJncywgJ3NraXBWYWxpZGF0aW9uJywgZmFsc2UpOwoJICB0aGlzLl9zb3VyY2VzID0gbmV3IEFycmF5U2V0KCk7CgkgIHRoaXMuX25hbWVzID0gbmV3IEFycmF5U2V0KCk7CgkgIHRoaXMuX21hcHBpbmdzID0gbmV3IE1hcHBpbmdMaXN0KCk7CgkgIHRoaXMuX3NvdXJjZXNDb250ZW50cyA9IG51bGw7Cgl9CgoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgoJLyoqCgkgKiBDcmVhdGVzIGEgbmV3IFNvdXJjZU1hcEdlbmVyYXRvciBiYXNlZCBvbiBhIFNvdXJjZU1hcENvbnN1bWVyCgkgKgoJICogQHBhcmFtIGFTb3VyY2VNYXBDb25zdW1lciBUaGUgU291cmNlTWFwLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IuZnJvbVNvdXJjZU1hcCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9mcm9tU291cmNlTWFwKGFTb3VyY2VNYXBDb25zdW1lcikgewoJICAgIHZhciBzb3VyY2VSb290ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZVJvb3Q7CgkgICAgdmFyIGdlbmVyYXRvciA9IG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IoewoJICAgICAgZmlsZTogYVNvdXJjZU1hcENvbnN1bWVyLmZpbGUsCgkgICAgICBzb3VyY2VSb290OiBzb3VyY2VSb290CgkgICAgfSk7CgkgICAgYVNvdXJjZU1hcENvbnN1bWVyLmVhY2hNYXBwaW5nKGZ1bmN0aW9uIChtYXBwaW5nKSB7CgkgICAgICB2YXIgbmV3TWFwcGluZyA9IHsKCSAgICAgICAgZ2VuZXJhdGVkOiB7CgkgICAgICAgICAgbGluZTogbWFwcGluZy5nZW5lcmF0ZWRMaW5lLAoJICAgICAgICAgIGNvbHVtbjogbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4KCSAgICAgICAgfQoJICAgICAgfTsKCgkgICAgICBpZiAobWFwcGluZy5zb3VyY2UgIT0gbnVsbCkgewoJICAgICAgICBuZXdNYXBwaW5nLnNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwoJICAgICAgICBpZiAoc291cmNlUm9vdCAhPSBudWxsKSB7CgkgICAgICAgICAgbmV3TWFwcGluZy5zb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIG5ld01hcHBpbmcuc291cmNlKTsKCSAgICAgICAgfQoKCSAgICAgICAgbmV3TWFwcGluZy5vcmlnaW5hbCA9IHsKCSAgICAgICAgICBsaW5lOiBtYXBwaW5nLm9yaWdpbmFsTGluZSwKCSAgICAgICAgICBjb2x1bW46IG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KCSAgICAgICAgfTsKCgkgICAgICAgIGlmIChtYXBwaW5nLm5hbWUgIT0gbnVsbCkgewoJICAgICAgICAgIG5ld01hcHBpbmcubmFtZSA9IG1hcHBpbmcubmFtZTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIGdlbmVyYXRvci5hZGRNYXBwaW5nKG5ld01hcHBpbmcpOwoJICAgIH0pOwoJICAgIGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VzLmZvckVhY2goZnVuY3Rpb24gKHNvdXJjZUZpbGUpIHsKCSAgICAgIHZhciBzb3VyY2VSZWxhdGl2ZSA9IHNvdXJjZUZpbGU7CgkgICAgICBpZiAoc291cmNlUm9vdCAhPT0gbnVsbCkgewoJICAgICAgICBzb3VyY2VSZWxhdGl2ZSA9IHV0aWwucmVsYXRpdmUoc291cmNlUm9vdCwgc291cmNlRmlsZSk7CgkgICAgICB9CgoJICAgICAgaWYgKCFnZW5lcmF0b3IuX3NvdXJjZXMuaGFzKHNvdXJjZVJlbGF0aXZlKSkgewoJICAgICAgICBnZW5lcmF0b3IuX3NvdXJjZXMuYWRkKHNvdXJjZVJlbGF0aXZlKTsKCSAgICAgIH0KCgkgICAgICB2YXIgY29udGVudCA9IGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VDb250ZW50Rm9yKHNvdXJjZUZpbGUpOwoJICAgICAgaWYgKGNvbnRlbnQgIT0gbnVsbCkgewoJICAgICAgICBnZW5lcmF0b3Iuc2V0U291cmNlQ29udGVudChzb3VyY2VGaWxlLCBjb250ZW50KTsKCSAgICAgIH0KCSAgICB9KTsKCSAgICByZXR1cm4gZ2VuZXJhdG9yOwoJICB9OwoKCS8qKgoJICogQWRkIGEgc2luZ2xlIG1hcHBpbmcgZnJvbSBvcmlnaW5hbCBzb3VyY2UgbGluZSBhbmQgY29sdW1uIHRvIHRoZSBnZW5lcmF0ZWQKCSAqIHNvdXJjZSdzIGxpbmUgYW5kIGNvbHVtbiBmb3IgdGhpcyBzb3VyY2UgbWFwIGJlaW5nIGNyZWF0ZWQuIFRoZSBtYXBwaW5nCgkgKiBvYmplY3Qgc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBnZW5lcmF0ZWQ6IEFuIG9iamVjdCB3aXRoIHRoZSBnZW5lcmF0ZWQgbGluZSBhbmQgY29sdW1uIHBvc2l0aW9ucy4KCSAqICAgLSBvcmlnaW5hbDogQW4gb2JqZWN0IHdpdGggdGhlIG9yaWdpbmFsIGxpbmUgYW5kIGNvbHVtbiBwb3NpdGlvbnMuCgkgKiAgIC0gc291cmNlOiBUaGUgb3JpZ2luYWwgc291cmNlIGZpbGUgKHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VSb290KS4KCSAqICAgLSBuYW1lOiBBbiBvcHRpb25hbCBvcmlnaW5hbCB0b2tlbiBuYW1lIGZvciB0aGlzIG1hcHBpbmcuCgkgKi8KCVNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYWRkTWFwcGluZyA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9hZGRNYXBwaW5nKGFBcmdzKSB7CgkgICAgdmFyIGdlbmVyYXRlZCA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnZ2VuZXJhdGVkJyk7CgkgICAgdmFyIG9yaWdpbmFsID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdvcmlnaW5hbCcsIG51bGwpOwoJICAgIHZhciBzb3VyY2UgPSB1dGlsLmdldEFyZyhhQXJncywgJ3NvdXJjZScsIG51bGwpOwoJICAgIHZhciBuYW1lID0gdXRpbC5nZXRBcmcoYUFyZ3MsICduYW1lJywgbnVsbCk7CgoJICAgIGlmICghdGhpcy5fc2tpcFZhbGlkYXRpb24pIHsKCSAgICAgIHRoaXMuX3ZhbGlkYXRlTWFwcGluZyhnZW5lcmF0ZWQsIG9yaWdpbmFsLCBzb3VyY2UsIG5hbWUpOwoJICAgIH0KCgkgICAgaWYgKHNvdXJjZSAhPSBudWxsKSB7CgkgICAgICBzb3VyY2UgPSBTdHJpbmcoc291cmNlKTsKCSAgICAgIGlmICghdGhpcy5fc291cmNlcy5oYXMoc291cmNlKSkgewoJICAgICAgICB0aGlzLl9zb3VyY2VzLmFkZChzb3VyY2UpOwoJICAgICAgfQoJICAgIH0KCgkgICAgaWYgKG5hbWUgIT0gbnVsbCkgewoJICAgICAgbmFtZSA9IFN0cmluZyhuYW1lKTsKCSAgICAgIGlmICghdGhpcy5fbmFtZXMuaGFzKG5hbWUpKSB7CgkgICAgICAgIHRoaXMuX25hbWVzLmFkZChuYW1lKTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHRoaXMuX21hcHBpbmdzLmFkZCh7CgkgICAgICBnZW5lcmF0ZWRMaW5lOiBnZW5lcmF0ZWQubGluZSwKCSAgICAgIGdlbmVyYXRlZENvbHVtbjogZ2VuZXJhdGVkLmNvbHVtbiwKCSAgICAgIG9yaWdpbmFsTGluZTogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5saW5lLAoJICAgICAgb3JpZ2luYWxDb2x1bW46IG9yaWdpbmFsICE9IG51bGwgJiYgb3JpZ2luYWwuY29sdW1uLAoJICAgICAgc291cmNlOiBzb3VyY2UsCgkgICAgICBuYW1lOiBuYW1lCgkgICAgfSk7CgkgIH07CgoJLyoqCgkgKiBTZXQgdGhlIHNvdXJjZSBjb250ZW50IGZvciBhIHNvdXJjZSBmaWxlLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLnNldFNvdXJjZUNvbnRlbnQgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3Jfc2V0U291cmNlQ29udGVudChhU291cmNlRmlsZSwgYVNvdXJjZUNvbnRlbnQpIHsKCSAgICB2YXIgc291cmNlID0gYVNvdXJjZUZpbGU7CgkgICAgaWYgKHRoaXMuX3NvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgc291cmNlID0gdXRpbC5yZWxhdGl2ZSh0aGlzLl9zb3VyY2VSb290LCBzb3VyY2UpOwoJICAgIH0KCgkgICAgaWYgKGFTb3VyY2VDb250ZW50ICE9IG51bGwpIHsKCSAgICAgIC8vIEFkZCB0aGUgc291cmNlIGNvbnRlbnQgdG8gdGhlIF9zb3VyY2VzQ29udGVudHMgbWFwLgoJICAgICAgLy8gQ3JlYXRlIGEgbmV3IF9zb3VyY2VzQ29udGVudHMgbWFwIGlmIHRoZSBwcm9wZXJ0eSBpcyBudWxsLgoJICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKCSAgICAgICAgdGhpcy5fc291cmNlc0NvbnRlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICAgIH0KCSAgICAgIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldID0gYVNvdXJjZUNvbnRlbnQ7CgkgICAgfSBlbHNlIGlmICh0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKCSAgICAgIC8vIFJlbW92ZSB0aGUgc291cmNlIGZpbGUgZnJvbSB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAuCgkgICAgICAvLyBJZiB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAgaXMgZW1wdHksIHNldCB0aGUgcHJvcGVydHkgdG8gbnVsbC4KCSAgICAgIGRlbGV0ZSB0aGlzLl9zb3VyY2VzQ29udGVudHNbdXRpbC50b1NldFN0cmluZyhzb3VyY2UpXTsKCSAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9zb3VyY2VzQ29udGVudHMpLmxlbmd0aCA9PT0gMCkgewoJICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBudWxsOwoJICAgICAgfQoJICAgIH0KCSAgfTsKCgkvKioKCSAqIEFwcGxpZXMgdGhlIG1hcHBpbmdzIG9mIGEgc3ViLXNvdXJjZS1tYXAgZm9yIGEgc3BlY2lmaWMgc291cmNlIGZpbGUgdG8gdGhlCgkgKiBzb3VyY2UgbWFwIGJlaW5nIGdlbmVyYXRlZC4gRWFjaCBtYXBwaW5nIHRvIHRoZSBzdXBwbGllZCBzb3VyY2UgZmlsZSBpcwoJICogcmV3cml0dGVuIHVzaW5nIHRoZSBzdXBwbGllZCBzb3VyY2UgbWFwLiBOb3RlOiBUaGUgcmVzb2x1dGlvbiBmb3IgdGhlCgkgKiByZXN1bHRpbmcgbWFwcGluZ3MgaXMgdGhlIG1pbmltaXVtIG9mIHRoaXMgbWFwIGFuZCB0aGUgc3VwcGxpZWQgbWFwLgoJICoKCSAqIEBwYXJhbSBhU291cmNlTWFwQ29uc3VtZXIgVGhlIHNvdXJjZSBtYXAgdG8gYmUgYXBwbGllZC4KCSAqIEBwYXJhbSBhU291cmNlRmlsZSBPcHRpb25hbC4gVGhlIGZpbGVuYW1lIG9mIHRoZSBzb3VyY2UgZmlsZS4KCSAqICAgICAgICBJZiBvbWl0dGVkLCBTb3VyY2VNYXBDb25zdW1lcidzIGZpbGUgcHJvcGVydHkgd2lsbCBiZSB1c2VkLgoJICogQHBhcmFtIGFTb3VyY2VNYXBQYXRoIE9wdGlvbmFsLiBUaGUgZGlybmFtZSBvZiB0aGUgcGF0aCB0byB0aGUgc291cmNlIG1hcAoJICogICAgICAgIHRvIGJlIGFwcGxpZWQuIElmIHJlbGF0aXZlLCBpdCBpcyByZWxhdGl2ZSB0byB0aGUgU291cmNlTWFwQ29uc3VtZXIuCgkgKiAgICAgICAgVGhpcyBwYXJhbWV0ZXIgaXMgbmVlZGVkIHdoZW4gdGhlIHR3byBzb3VyY2UgbWFwcyBhcmVuJ3QgaW4gdGhlIHNhbWUKCSAqICAgICAgICBkaXJlY3RvcnksIGFuZCB0aGUgc291cmNlIG1hcCB0byBiZSBhcHBsaWVkIGNvbnRhaW5zIHJlbGF0aXZlIHNvdXJjZQoJICogICAgICAgIHBhdGhzLiBJZiBzbywgdGhvc2UgcmVsYXRpdmUgc291cmNlIHBhdGhzIG5lZWQgdG8gYmUgcmV3cml0dGVuCgkgKiAgICAgICAgcmVsYXRpdmUgdG8gdGhlIFNvdXJjZU1hcEdlbmVyYXRvci4KCSAqLwoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5hcHBseVNvdXJjZU1hcCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9hcHBseVNvdXJjZU1hcChhU291cmNlTWFwQ29uc3VtZXIsIGFTb3VyY2VGaWxlLCBhU291cmNlTWFwUGF0aCkgewoJICAgIHZhciBzb3VyY2VGaWxlID0gYVNvdXJjZUZpbGU7CgkgICAgLy8gSWYgYVNvdXJjZUZpbGUgaXMgb21pdHRlZCwgd2Ugd2lsbCB1c2UgdGhlIGZpbGUgcHJvcGVydHkgb2YgdGhlIFNvdXJjZU1hcAoJICAgIGlmIChhU291cmNlRmlsZSA9PSBudWxsKSB7CgkgICAgICBpZiAoYVNvdXJjZU1hcENvbnN1bWVyLmZpbGUgPT0gbnVsbCkgewoJICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCgkgICAgICAgICAgJ1NvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYXBwbHlTb3VyY2VNYXAgcmVxdWlyZXMgZWl0aGVyIGFuIGV4cGxpY2l0IHNvdXJjZSBmaWxlLCAnICsKCSAgICAgICAgICAnb3IgdGhlIHNvdXJjZSBtYXBcJ3MgImZpbGUiIHByb3BlcnR5LiBCb3RoIHdlcmUgb21pdHRlZC4nCgkgICAgICAgICk7CgkgICAgICB9CgkgICAgICBzb3VyY2VGaWxlID0gYVNvdXJjZU1hcENvbnN1bWVyLmZpbGU7CgkgICAgfQoJICAgIHZhciBzb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKCSAgICAvLyBNYWtlICJzb3VyY2VGaWxlIiByZWxhdGl2ZSBpZiBhbiBhYnNvbHV0ZSBVcmwgaXMgcGFzc2VkLgoJICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwoJICAgIH0KCSAgICAvLyBBcHBseWluZyB0aGUgU291cmNlTWFwIGNhbiBhZGQgYW5kIHJlbW92ZSBpdGVtcyBmcm9tIHRoZSBzb3VyY2VzIGFuZAoJICAgIC8vIHRoZSBuYW1lcyBhcnJheS4KCSAgICB2YXIgbmV3U291cmNlcyA9IG5ldyBBcnJheVNldCgpOwoJICAgIHZhciBuZXdOYW1lcyA9IG5ldyBBcnJheVNldCgpOwoKCSAgICAvLyBGaW5kIG1hcHBpbmdzIGZvciB0aGUgInNvdXJjZUZpbGUiCgkgICAgdGhpcy5fbWFwcGluZ3MudW5zb3J0ZWRGb3JFYWNoKGZ1bmN0aW9uIChtYXBwaW5nKSB7CgkgICAgICBpZiAobWFwcGluZy5zb3VyY2UgPT09IHNvdXJjZUZpbGUgJiYgbWFwcGluZy5vcmlnaW5hbExpbmUgIT0gbnVsbCkgewoJICAgICAgICAvLyBDaGVjayBpZiBpdCBjYW4gYmUgbWFwcGVkIGJ5IHRoZSBzb3VyY2UgbWFwLCB0aGVuIHVwZGF0ZSB0aGUgbWFwcGluZy4KCSAgICAgICAgdmFyIG9yaWdpbmFsID0gYVNvdXJjZU1hcENvbnN1bWVyLm9yaWdpbmFsUG9zaXRpb25Gb3IoewoJICAgICAgICAgIGxpbmU6IG1hcHBpbmcub3JpZ2luYWxMaW5lLAoJICAgICAgICAgIGNvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbgoJICAgICAgICB9KTsKCSAgICAgICAgaWYgKG9yaWdpbmFsLnNvdXJjZSAhPSBudWxsKSB7CgkgICAgICAgICAgLy8gQ29weSBtYXBwaW5nCgkgICAgICAgICAgbWFwcGluZy5zb3VyY2UgPSBvcmlnaW5hbC5zb3VyY2U7CgkgICAgICAgICAgaWYgKGFTb3VyY2VNYXBQYXRoICE9IG51bGwpIHsKCSAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5qb2luKGFTb3VyY2VNYXBQYXRoLCBtYXBwaW5nLnNvdXJjZSk7CgkgICAgICAgICAgfQoJICAgICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBtYXBwaW5nLnNvdXJjZSk7CgkgICAgICAgICAgfQoJICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxMaW5lID0gb3JpZ2luYWwubGluZTsKCSAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uID0gb3JpZ2luYWwuY29sdW1uOwoJICAgICAgICAgIGlmIChvcmlnaW5hbC5uYW1lICE9IG51bGwpIHsKCSAgICAgICAgICAgIG1hcHBpbmcubmFtZSA9IG9yaWdpbmFsLm5hbWU7CgkgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgdmFyIHNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwoJICAgICAgaWYgKHNvdXJjZSAhPSBudWxsICYmICFuZXdTb3VyY2VzLmhhcyhzb3VyY2UpKSB7CgkgICAgICAgIG5ld1NvdXJjZXMuYWRkKHNvdXJjZSk7CgkgICAgICB9CgoJICAgICAgdmFyIG5hbWUgPSBtYXBwaW5nLm5hbWU7CgkgICAgICBpZiAobmFtZSAhPSBudWxsICYmICFuZXdOYW1lcy5oYXMobmFtZSkpIHsKCSAgICAgICAgbmV3TmFtZXMuYWRkKG5hbWUpOwoJICAgICAgfQoKCSAgICB9LCB0aGlzKTsKCSAgICB0aGlzLl9zb3VyY2VzID0gbmV3U291cmNlczsKCSAgICB0aGlzLl9uYW1lcyA9IG5ld05hbWVzOwoKCSAgICAvLyBDb3B5IHNvdXJjZXNDb250ZW50cyBvZiBhcHBsaWVkIG1hcC4KCSAgICBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2VGaWxlKSB7CgkgICAgICB2YXIgY29udGVudCA9IGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VDb250ZW50Rm9yKHNvdXJjZUZpbGUpOwoJICAgICAgaWYgKGNvbnRlbnQgIT0gbnVsbCkgewoJICAgICAgICBpZiAoYVNvdXJjZU1hcFBhdGggIT0gbnVsbCkgewoJICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLmpvaW4oYVNvdXJjZU1hcFBhdGgsIHNvdXJjZUZpbGUpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgICAgICBzb3VyY2VGaWxlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBzb3VyY2VGaWxlKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNldFNvdXJjZUNvbnRlbnQoc291cmNlRmlsZSwgY29udGVudCk7CgkgICAgICB9CgkgICAgfSwgdGhpcyk7CgkgIH07CgoJLyoqCgkgKiBBIG1hcHBpbmcgY2FuIGhhdmUgb25lIG9mIHRoZSB0aHJlZSBsZXZlbHMgb2YgZGF0YToKCSAqCgkgKiAgIDEuIEp1c3QgdGhlIGdlbmVyYXRlZCBwb3NpdGlvbi4KCSAqICAgMi4gVGhlIEdlbmVyYXRlZCBwb3NpdGlvbiwgb3JpZ2luYWwgcG9zaXRpb24sIGFuZCBvcmlnaW5hbCBzb3VyY2UuCgkgKiAgIDMuIEdlbmVyYXRlZCBhbmQgb3JpZ2luYWwgcG9zaXRpb24sIG9yaWdpbmFsIHNvdXJjZSwgYXMgd2VsbCBhcyBhIG5hbWUKCSAqICAgICAgdG9rZW4uCgkgKgoJICogVG8gbWFpbnRhaW4gY29uc2lzdGVuY3ksIHdlIHZhbGlkYXRlIHRoYXQgYW55IG5ldyBtYXBwaW5nIGJlaW5nIGFkZGVkIGZhbGxzCgkgKiBpbiB0byBvbmUgb2YgdGhlc2UgY2F0ZWdvcmllcy4KCSAqLwoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmFsaWRhdGVNYXBwaW5nID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX3ZhbGlkYXRlTWFwcGluZyhhR2VuZXJhdGVkLCBhT3JpZ2luYWwsIGFTb3VyY2UsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYU5hbWUpIHsKCSAgICAvLyBXaGVuIGFPcmlnaW5hbCBpcyB0cnV0aHkgYnV0IGhhcyBlbXB0eSB2YWx1ZXMgZm9yIC5saW5lIGFuZCAuY29sdW1uLAoJICAgIC8vIGl0IGlzIG1vc3QgbGlrZWx5IGEgcHJvZ3JhbW1lciBlcnJvci4gSW4gdGhpcyBjYXNlIHdlIHRocm93IGEgdmVyeQoJICAgIC8vIHNwZWNpZmljIGVycm9yIG1lc3NhZ2UgdG8gdHJ5IHRvIGd1aWRlIHRoZW0gdGhlIHJpZ2h0IHdheS4KCSAgICAvLyBGb3IgZXhhbXBsZTogaHR0cHM6Ly9naXRodWIuY29tL1BvbHltZXIvcG9seW1lci1idW5kbGVyL3B1bGwvNTE5CgkgICAgaWYgKGFPcmlnaW5hbCAmJiB0eXBlb2YgYU9yaWdpbmFsLmxpbmUgIT09ICdudW1iZXInICYmIHR5cGVvZiBhT3JpZ2luYWwuY29sdW1uICE9PSAnbnVtYmVyJykgewoJICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCgkgICAgICAgICAgICAnb3JpZ2luYWwubGluZSBhbmQgb3JpZ2luYWwuY29sdW1uIGFyZSBub3QgbnVtYmVycyAtLSB5b3UgcHJvYmFibHkgbWVhbnQgdG8gb21pdCAnICsKCSAgICAgICAgICAgICd0aGUgb3JpZ2luYWwgbWFwcGluZyBlbnRpcmVseSBhbmQgb25seSBtYXAgdGhlIGdlbmVyYXRlZCBwb3NpdGlvbi4gSWYgc28sIHBhc3MgJyArCgkgICAgICAgICAgICAnbnVsbCBmb3IgdGhlIG9yaWdpbmFsIG1hcHBpbmcgaW5zdGVhZCBvZiBhbiBvYmplY3Qgd2l0aCBlbXB0eSBvciBudWxsIHZhbHVlcy4nCgkgICAgICAgICk7CgkgICAgfQoKCSAgICBpZiAoYUdlbmVyYXRlZCAmJiAnbGluZScgaW4gYUdlbmVyYXRlZCAmJiAnY29sdW1uJyBpbiBhR2VuZXJhdGVkCgkgICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAoJICAgICAgICAmJiAhYU9yaWdpbmFsICYmICFhU291cmNlICYmICFhTmFtZSkgewoJICAgICAgLy8gQ2FzZSAxLgoJICAgICAgcmV0dXJuOwoJICAgIH0KCSAgICBlbHNlIGlmIChhR2VuZXJhdGVkICYmICdsaW5lJyBpbiBhR2VuZXJhdGVkICYmICdjb2x1bW4nIGluIGFHZW5lcmF0ZWQKCSAgICAgICAgICAgICAmJiBhT3JpZ2luYWwgJiYgJ2xpbmUnIGluIGFPcmlnaW5hbCAmJiAnY29sdW1uJyBpbiBhT3JpZ2luYWwKCSAgICAgICAgICAgICAmJiBhR2VuZXJhdGVkLmxpbmUgPiAwICYmIGFHZW5lcmF0ZWQuY29sdW1uID49IDAKCSAgICAgICAgICAgICAmJiBhT3JpZ2luYWwubGluZSA+IDAgJiYgYU9yaWdpbmFsLmNvbHVtbiA+PSAwCgkgICAgICAgICAgICAgJiYgYVNvdXJjZSkgewoJICAgICAgLy8gQ2FzZXMgMiBhbmQgMy4KCSAgICAgIHJldHVybjsKCSAgICB9CgkgICAgZWxzZSB7CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbWFwcGluZzogJyArIEpTT04uc3RyaW5naWZ5KHsKCSAgICAgICAgZ2VuZXJhdGVkOiBhR2VuZXJhdGVkLAoJICAgICAgICBzb3VyY2U6IGFTb3VyY2UsCgkgICAgICAgIG9yaWdpbmFsOiBhT3JpZ2luYWwsCgkgICAgICAgIG5hbWU6IGFOYW1lCgkgICAgICB9KSk7CgkgICAgfQoJICB9OwoKCS8qKgoJICogU2VyaWFsaXplIHRoZSBhY2N1bXVsYXRlZCBtYXBwaW5ncyBpbiB0byB0aGUgc3RyZWFtIG9mIGJhc2UgNjQgVkxRcwoJICogc3BlY2lmaWVkIGJ5IHRoZSBzb3VyY2UgbWFwIGZvcm1hdC4KCSAqLwoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fc2VyaWFsaXplTWFwcGluZ3MgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3Jfc2VyaWFsaXplTWFwcGluZ3MoKSB7CgkgICAgdmFyIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gMDsKCSAgICB2YXIgcHJldmlvdXNHZW5lcmF0ZWRMaW5lID0gMTsKCSAgICB2YXIgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IDA7CgkgICAgdmFyIHByZXZpb3VzT3JpZ2luYWxMaW5lID0gMDsKCSAgICB2YXIgcHJldmlvdXNOYW1lID0gMDsKCSAgICB2YXIgcHJldmlvdXNTb3VyY2UgPSAwOwoJICAgIHZhciByZXN1bHQgPSAnJzsKCSAgICB2YXIgbmV4dDsKCSAgICB2YXIgbWFwcGluZzsKCSAgICB2YXIgbmFtZUlkeDsKCSAgICB2YXIgc291cmNlSWR4OwoKCSAgICB2YXIgbWFwcGluZ3MgPSB0aGlzLl9tYXBwaW5ncy50b0FycmF5KCk7CgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG1hcHBpbmdzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICBtYXBwaW5nID0gbWFwcGluZ3NbaV07CgkgICAgICBuZXh0ID0gJyc7CgoJICAgICAgaWYgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSAhPT0gcHJldmlvdXNHZW5lcmF0ZWRMaW5lKSB7CgkgICAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gMDsKCSAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSAhPT0gcHJldmlvdXNHZW5lcmF0ZWRMaW5lKSB7CgkgICAgICAgICAgbmV4dCArPSAnOyc7CgkgICAgICAgICAgcHJldmlvdXNHZW5lcmF0ZWRMaW5lKys7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICAgIGVsc2UgewoJICAgICAgICBpZiAoaSA+IDApIHsKCSAgICAgICAgICBpZiAoIXV0aWwuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQobWFwcGluZywgbWFwcGluZ3NbaSAtIDFdKSkgewoJICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgfQoJICAgICAgICAgIG5leHQgKz0gJywnOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uKTsKCSAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgoJICAgICAgaWYgKG1hcHBpbmcuc291cmNlICE9IG51bGwpIHsKCSAgICAgICAgc291cmNlSWR4ID0gdGhpcy5fc291cmNlcy5pbmRleE9mKG1hcHBpbmcuc291cmNlKTsKCSAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKHNvdXJjZUlkeCAtIHByZXZpb3VzU291cmNlKTsKCSAgICAgICAgcHJldmlvdXNTb3VyY2UgPSBzb3VyY2VJZHg7CgoJICAgICAgICAvLyBsaW5lcyBhcmUgc3RvcmVkIDAtYmFzZWQgaW4gU291cmNlTWFwIHNwZWMgdmVyc2lvbiAzCgkgICAgICAgIG5leHQgKz0gYmFzZTY0VkxRLmVuY29kZShtYXBwaW5nLm9yaWdpbmFsTGluZSAtIDEKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBwcmV2aW91c09yaWdpbmFsTGluZSk7CgkgICAgICAgIHByZXZpb3VzT3JpZ2luYWxMaW5lID0gbWFwcGluZy5vcmlnaW5hbExpbmUgLSAxOwoKCSAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBwcmV2aW91c09yaWdpbmFsQ29sdW1uKTsKCSAgICAgICAgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IG1hcHBpbmcub3JpZ2luYWxDb2x1bW47CgoJICAgICAgICBpZiAobWFwcGluZy5uYW1lICE9IG51bGwpIHsKCSAgICAgICAgICBuYW1lSWR4ID0gdGhpcy5fbmFtZXMuaW5kZXhPZihtYXBwaW5nLm5hbWUpOwoJICAgICAgICAgIG5leHQgKz0gYmFzZTY0VkxRLmVuY29kZShuYW1lSWR4IC0gcHJldmlvdXNOYW1lKTsKCSAgICAgICAgICBwcmV2aW91c05hbWUgPSBuYW1lSWR4OwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmVzdWx0ICs9IG5leHQ7CgkgICAgfQoKCSAgICByZXR1cm4gcmVzdWx0OwoJICB9OwoKCVNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuX2dlbmVyYXRlU291cmNlc0NvbnRlbnQgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfZ2VuZXJhdGVTb3VyY2VzQ29udGVudChhU291cmNlcywgYVNvdXJjZVJvb3QpIHsKCSAgICByZXR1cm4gYVNvdXJjZXMubWFwKGZ1bmN0aW9uIChzb3VyY2UpIHsKCSAgICAgIGlmICghdGhpcy5fc291cmNlc0NvbnRlbnRzKSB7CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgfQoJICAgICAgaWYgKGFTb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgICAgc291cmNlID0gdXRpbC5yZWxhdGl2ZShhU291cmNlUm9vdCwgc291cmNlKTsKCSAgICAgIH0KCSAgICAgIHZhciBrZXkgPSB1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSk7CgkgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuX3NvdXJjZXNDb250ZW50cywga2V5KQoJICAgICAgICA/IHRoaXMuX3NvdXJjZXNDb250ZW50c1trZXldCgkgICAgICAgIDogbnVsbDsKCSAgICB9LCB0aGlzKTsKCSAgfTsKCgkvKioKCSAqIEV4dGVybmFsaXplIHRoZSBzb3VyY2UgbWFwLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLnRvSlNPTiA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl90b0pTT04oKSB7CgkgICAgdmFyIG1hcCA9IHsKCSAgICAgIHZlcnNpb246IHRoaXMuX3ZlcnNpb24sCgkgICAgICBzb3VyY2VzOiB0aGlzLl9zb3VyY2VzLnRvQXJyYXkoKSwKCSAgICAgIG5hbWVzOiB0aGlzLl9uYW1lcy50b0FycmF5KCksCgkgICAgICBtYXBwaW5nczogdGhpcy5fc2VyaWFsaXplTWFwcGluZ3MoKQoJICAgIH07CgkgICAgaWYgKHRoaXMuX2ZpbGUgIT0gbnVsbCkgewoJICAgICAgbWFwLmZpbGUgPSB0aGlzLl9maWxlOwoJICAgIH0KCSAgICBpZiAodGhpcy5fc291cmNlUm9vdCAhPSBudWxsKSB7CgkgICAgICBtYXAuc291cmNlUm9vdCA9IHRoaXMuX3NvdXJjZVJvb3Q7CgkgICAgfQoJICAgIGlmICh0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKCSAgICAgIG1hcC5zb3VyY2VzQ29udGVudCA9IHRoaXMuX2dlbmVyYXRlU291cmNlc0NvbnRlbnQobWFwLnNvdXJjZXMsIG1hcC5zb3VyY2VSb290KTsKCSAgICB9CgoJICAgIHJldHVybiBtYXA7CgkgIH07CgoJLyoqCgkgKiBSZW5kZXIgdGhlIHNvdXJjZSBtYXAgYmVpbmcgZ2VuZXJhdGVkIHRvIGEgc3RyaW5nLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLnRvU3RyaW5nID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX3RvU3RyaW5nKCkgewoJICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpKTsKCSAgfTsKCglzb3VyY2VNYXBHZW5lcmF0b3IuU291cmNlTWFwR2VuZXJhdG9yID0gU291cmNlTWFwR2VuZXJhdG9yOwoJcmV0dXJuIHNvdXJjZU1hcEdlbmVyYXRvcjsKfQoKdmFyIHNvdXJjZU1hcENvbnN1bWVyID0ge307Cgp2YXIgYmluYXJ5U2VhcmNoID0ge307CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRCaW5hcnlTZWFyY2g7CgpmdW5jdGlvbiByZXF1aXJlQmluYXJ5U2VhcmNoICgpIHsKCWlmIChoYXNSZXF1aXJlZEJpbmFyeVNlYXJjaCkgcmV0dXJuIGJpbmFyeVNlYXJjaDsKCWhhc1JlcXVpcmVkQmluYXJ5U2VhcmNoID0gMTsKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJCS8qCgkJICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKCQkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCQkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkJICovCgoJCWV4cG9ydHMuR1JFQVRFU1RfTE9XRVJfQk9VTkQgPSAxOwoJCWV4cG9ydHMuTEVBU1RfVVBQRVJfQk9VTkQgPSAyOwoKCQkvKioKCQkgKiBSZWN1cnNpdmUgaW1wbGVtZW50YXRpb24gb2YgYmluYXJ5IHNlYXJjaC4KCQkgKgoJCSAqIEBwYXJhbSBhTG93IEluZGljZXMgaGVyZSBhbmQgbG93ZXIgZG8gbm90IGNvbnRhaW4gdGhlIG5lZWRsZS4KCQkgKiBAcGFyYW0gYUhpZ2ggSW5kaWNlcyBoZXJlIGFuZCBoaWdoZXIgZG8gbm90IGNvbnRhaW4gdGhlIG5lZWRsZS4KCQkgKiBAcGFyYW0gYU5lZWRsZSBUaGUgZWxlbWVudCBiZWluZyBzZWFyY2hlZCBmb3IuCgkJICogQHBhcmFtIGFIYXlzdGFjayBUaGUgbm9uLWVtcHR5IGFycmF5IGJlaW5nIHNlYXJjaGVkLgoJCSAqIEBwYXJhbSBhQ29tcGFyZSBGdW5jdGlvbiB3aGljaCB0YWtlcyB0d28gZWxlbWVudHMgYW5kIHJldHVybnMgLTEsIDAsIG9yIDEuCgkJICogQHBhcmFtIGFCaWFzIEVpdGhlciAnYmluYXJ5U2VhcmNoLkdSRUFURVNUX0xPV0VSX0JPVU5EJyBvcgoJCSAqICAgICAnYmluYXJ5U2VhcmNoLkxFQVNUX1VQUEVSX0JPVU5EJy4gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZQoJCSAqICAgICBjbG9zZXN0IGVsZW1lbnQgdGhhdCBpcyBzbWFsbGVyIHRoYW4gb3IgZ3JlYXRlciB0aGFuIHRoZSBvbmUgd2UgYXJlCgkJICogICAgIHNlYXJjaGluZyBmb3IsIHJlc3BlY3RpdmVseSwgaWYgdGhlIGV4YWN0IGVsZW1lbnQgY2Fubm90IGJlIGZvdW5kLgoJCSAqLwoJCWZ1bmN0aW9uIHJlY3Vyc2l2ZVNlYXJjaChhTG93LCBhSGlnaCwgYU5lZWRsZSwgYUhheXN0YWNrLCBhQ29tcGFyZSwgYUJpYXMpIHsKCQkgIC8vIFRoaXMgZnVuY3Rpb24gdGVybWluYXRlcyB3aGVuIG9uZSBvZiB0aGUgZm9sbG93aW5nIGlzIHRydWU6CgkJICAvLwoJCSAgLy8gICAxLiBXZSBmaW5kIHRoZSBleGFjdCBlbGVtZW50IHdlIGFyZSBsb29raW5nIGZvci4KCQkgIC8vCgkJICAvLyAgIDIuIFdlIGRpZCBub3QgZmluZCB0aGUgZXhhY3QgZWxlbWVudCwgYnV0IHdlIGNhbiByZXR1cm4gdGhlIGluZGV4IG9mCgkJICAvLyAgICAgIHRoZSBuZXh0LWNsb3Nlc3QgZWxlbWVudC4KCQkgIC8vCgkJICAvLyAgIDMuIFdlIGRpZCBub3QgZmluZCB0aGUgZXhhY3QgZWxlbWVudCwgYW5kIHRoZXJlIGlzIG5vIG5leHQtY2xvc2VzdAoJCSAgLy8gICAgICBlbGVtZW50IHRoYW4gdGhlIG9uZSB3ZSBhcmUgc2VhcmNoaW5nIGZvciwgc28gd2UgcmV0dXJuIC0xLgoJCSAgdmFyIG1pZCA9IE1hdGguZmxvb3IoKGFIaWdoIC0gYUxvdykgLyAyKSArIGFMb3c7CgkJICB2YXIgY21wID0gYUNvbXBhcmUoYU5lZWRsZSwgYUhheXN0YWNrW21pZF0sIHRydWUpOwoJCSAgaWYgKGNtcCA9PT0gMCkgewoJCSAgICAvLyBGb3VuZCB0aGUgZWxlbWVudCB3ZSBhcmUgbG9va2luZyBmb3IuCgkJICAgIHJldHVybiBtaWQ7CgkJICB9CgkJICBlbHNlIGlmIChjbXAgPiAwKSB7CgkJICAgIC8vIE91ciBuZWVkbGUgaXMgZ3JlYXRlciB0aGFuIGFIYXlzdGFja1ttaWRdLgoJCSAgICBpZiAoYUhpZ2ggLSBtaWQgPiAxKSB7CgkJICAgICAgLy8gVGhlIGVsZW1lbnQgaXMgaW4gdGhlIHVwcGVyIGhhbGYuCgkJICAgICAgcmV0dXJuIHJlY3Vyc2l2ZVNlYXJjaChtaWQsIGFIaWdoLCBhTmVlZGxlLCBhSGF5c3RhY2ssIGFDb21wYXJlLCBhQmlhcyk7CgkJICAgIH0KCgkJICAgIC8vIFRoZSBleGFjdCBuZWVkbGUgZWxlbWVudCB3YXMgbm90IGZvdW5kIGluIHRoaXMgaGF5c3RhY2suIERldGVybWluZSBpZgoJCSAgICAvLyB3ZSBhcmUgaW4gdGVybWluYXRpb24gY2FzZSAoMykgb3IgKDIpIGFuZCByZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHRoaW5nLgoJCSAgICBpZiAoYUJpYXMgPT0gZXhwb3J0cy5MRUFTVF9VUFBFUl9CT1VORCkgewoJCSAgICAgIHJldHVybiBhSGlnaCA8IGFIYXlzdGFjay5sZW5ndGggPyBhSGlnaCA6IC0xOwoJCSAgICB9IGVsc2UgewoJCSAgICAgIHJldHVybiBtaWQ7CgkJICAgIH0KCQkgIH0KCQkgIGVsc2UgewoJCSAgICAvLyBPdXIgbmVlZGxlIGlzIGxlc3MgdGhhbiBhSGF5c3RhY2tbbWlkXS4KCQkgICAgaWYgKG1pZCAtIGFMb3cgPiAxKSB7CgkJICAgICAgLy8gVGhlIGVsZW1lbnQgaXMgaW4gdGhlIGxvd2VyIGhhbGYuCgkJICAgICAgcmV0dXJuIHJlY3Vyc2l2ZVNlYXJjaChhTG93LCBtaWQsIGFOZWVkbGUsIGFIYXlzdGFjaywgYUNvbXBhcmUsIGFCaWFzKTsKCQkgICAgfQoKCQkgICAgLy8gd2UgYXJlIGluIHRlcm1pbmF0aW9uIGNhc2UgKDMpIG9yICgyKSBhbmQgcmV0dXJuIHRoZSBhcHByb3ByaWF0ZSB0aGluZy4KCQkgICAgaWYgKGFCaWFzID09IGV4cG9ydHMuTEVBU1RfVVBQRVJfQk9VTkQpIHsKCQkgICAgICByZXR1cm4gbWlkOwoJCSAgICB9IGVsc2UgewoJCSAgICAgIHJldHVybiBhTG93IDwgMCA/IC0xIDogYUxvdzsKCQkgICAgfQoJCSAgfQoJCX0KCgkJLyoqCgkJICogVGhpcyBpcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiBiaW5hcnkgc2VhcmNoIHdoaWNoIHdpbGwgYWx3YXlzIHRyeSBhbmQgcmV0dXJuCgkJICogdGhlIGluZGV4IG9mIHRoZSBjbG9zZXN0IGVsZW1lbnQgaWYgdGhlcmUgaXMgbm8gZXhhY3QgaGl0LiBUaGlzIGlzIGJlY2F1c2UKCQkgKiBtYXBwaW5ncyBiZXR3ZWVuIG9yaWdpbmFsIGFuZCBnZW5lcmF0ZWQgbGluZS9jb2wgcGFpcnMgYXJlIHNpbmdsZSBwb2ludHMsCgkJICogYW5kIHRoZXJlIGlzIGFuIGltcGxpY2l0IHJlZ2lvbiBiZXR3ZWVuIGVhY2ggb2YgdGhlbSwgc28gYSBtaXNzIGp1c3QgbWVhbnMKCQkgKiB0aGF0IHlvdSBhcmVuJ3Qgb24gdGhlIHZlcnkgc3RhcnQgb2YgYSByZWdpb24uCgkJICoKCQkgKiBAcGFyYW0gYU5lZWRsZSBUaGUgZWxlbWVudCB5b3UgYXJlIGxvb2tpbmcgZm9yLgoJCSAqIEBwYXJhbSBhSGF5c3RhY2sgVGhlIGFycmF5IHRoYXQgaXMgYmVpbmcgc2VhcmNoZWQuCgkJICogQHBhcmFtIGFDb21wYXJlIEEgZnVuY3Rpb24gd2hpY2ggdGFrZXMgdGhlIG5lZWRsZSBhbmQgYW4gZWxlbWVudCBpbiB0aGUKCQkgKiAgICAgYXJyYXkgYW5kIHJldHVybnMgLTEsIDAsIG9yIDEgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIG5lZWRsZSBpcyBsZXNzCgkJICogICAgIHRoYW4sIGVxdWFsIHRvLCBvciBncmVhdGVyIHRoYW4gdGhlIGVsZW1lbnQsIHJlc3BlY3RpdmVseS4KCQkgKiBAcGFyYW0gYUJpYXMgRWl0aGVyICdiaW5hcnlTZWFyY2guR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yCgkJICogICAgICdiaW5hcnlTZWFyY2guTEVBU1RfVVBQRVJfQk9VTkQnLiBTcGVjaWZpZXMgd2hldGhlciB0byByZXR1cm4gdGhlCgkJICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmUKCQkgKiAgICAgc2VhcmNoaW5nIGZvciwgcmVzcGVjdGl2ZWx5LCBpZiB0aGUgZXhhY3QgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQuCgkJICogICAgIERlZmF1bHRzIHRvICdiaW5hcnlTZWFyY2guR1JFQVRFU1RfTE9XRVJfQk9VTkQnLgoJCSAqLwoJCWV4cG9ydHMuc2VhcmNoID0gZnVuY3Rpb24gc2VhcmNoKGFOZWVkbGUsIGFIYXlzdGFjaywgYUNvbXBhcmUsIGFCaWFzKSB7CgkJICBpZiAoYUhheXN0YWNrLmxlbmd0aCA9PT0gMCkgewoJCSAgICByZXR1cm4gLTE7CgkJICB9CgoJCSAgdmFyIGluZGV4ID0gcmVjdXJzaXZlU2VhcmNoKC0xLCBhSGF5c3RhY2subGVuZ3RoLCBhTmVlZGxlLCBhSGF5c3RhY2ssCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYUNvbXBhcmUsIGFCaWFzIHx8IGV4cG9ydHMuR1JFQVRFU1RfTE9XRVJfQk9VTkQpOwoJCSAgaWYgKGluZGV4IDwgMCkgewoJCSAgICByZXR1cm4gLTE7CgkJICB9CgoJCSAgLy8gV2UgaGF2ZSBmb3VuZCBlaXRoZXIgdGhlIGV4YWN0IGVsZW1lbnQsIG9yIHRoZSBuZXh0LWNsb3Nlc3QgZWxlbWVudCB0aGFuCgkJICAvLyB0aGUgb25lIHdlIGFyZSBzZWFyY2hpbmcgZm9yLiBIb3dldmVyLCB0aGVyZSBtYXkgYmUgbW9yZSB0aGFuIG9uZSBzdWNoCgkJICAvLyBlbGVtZW50LiBNYWtlIHN1cmUgd2UgYWx3YXlzIHJldHVybiB0aGUgc21hbGxlc3Qgb2YgdGhlc2UuCgkJICB3aGlsZSAoaW5kZXggLSAxID49IDApIHsKCQkgICAgaWYgKGFDb21wYXJlKGFIYXlzdGFja1tpbmRleF0sIGFIYXlzdGFja1tpbmRleCAtIDFdLCB0cnVlKSAhPT0gMCkgewoJCSAgICAgIGJyZWFrOwoJCSAgICB9CgkJICAgIC0taW5kZXg7CgkJICB9CgoJCSAgcmV0dXJuIGluZGV4OwoJCX07IAoJfSAoYmluYXJ5U2VhcmNoKSk7CglyZXR1cm4gYmluYXJ5U2VhcmNoOwp9Cgp2YXIgcXVpY2tTb3J0ID0ge307CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRRdWlja1NvcnQ7CgpmdW5jdGlvbiByZXF1aXJlUXVpY2tTb3J0ICgpIHsKCWlmIChoYXNSZXF1aXJlZFF1aWNrU29ydCkgcmV0dXJuIHF1aWNrU29ydDsKCWhhc1JlcXVpcmVkUXVpY2tTb3J0ID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgkvLyBJdCB0dXJucyBvdXQgdGhhdCBzb21lIChtb3N0PykgSmF2YVNjcmlwdCBlbmdpbmVzIGRvbid0IHNlbGYtaG9zdAoJLy8gYEFycmF5LnByb3RvdHlwZS5zb3J0YC4gVGhpcyBtYWtlcyBzZW5zZSBiZWNhdXNlIEMrKyB3aWxsIGxpa2VseSByZW1haW4KCS8vIGZhc3RlciB0aGFuIEpTIHdoZW4gZG9pbmcgcmF3IENQVS1pbnRlbnNpdmUgc29ydGluZy4gSG93ZXZlciwgd2hlbiB1c2luZyBhCgkvLyBjdXN0b20gY29tcGFyYXRvciBmdW5jdGlvbiwgY2FsbGluZyBiYWNrIGFuZCBmb3J0aCBiZXR3ZWVuIHRoZSBWTSdzIEMrKyBhbmQKCS8vIEpJVCdkIEpTIGlzIHJhdGhlciBzbG93ICphbmQqIGxvc2VzIEpJVCB0eXBlIGluZm9ybWF0aW9uLCByZXN1bHRpbmcgaW4KCS8vIHdvcnNlIGdlbmVyYXRlZCBjb2RlIGZvciB0aGUgY29tcGFyYXRvciBmdW5jdGlvbiB0aGFuIHdvdWxkIGJlIG9wdGltYWwuIEluCgkvLyBmYWN0LCB3aGVuIHNvcnRpbmcgd2l0aCBhIGNvbXBhcmF0b3IsIHRoZXNlIGNvc3RzIG91dHdlaWdoIHRoZSBiZW5lZml0cyBvZgoJLy8gc29ydGluZyBpbiBDKysuIEJ5IHVzaW5nIG91ciBvd24gSlMtaW1wbGVtZW50ZWQgUXVpY2sgU29ydCAoYmVsb3cpLCB3ZSBnZXQKCS8vIGEgfjM1MDBtcyBtZWFuIHNwZWVkLXVwIGluIGBiZW5jaC9iZW5jaC5odG1sYC4KCgkvKioKCSAqIFN3YXAgdGhlIGVsZW1lbnRzIGluZGV4ZWQgYnkgYHhgIGFuZCBgeWAgaW4gdGhlIGFycmF5IGBhcnlgLgoJICoKCSAqIEBwYXJhbSB7QXJyYXl9IGFyeQoJICogICAgICAgIFRoZSBhcnJheS4KCSAqIEBwYXJhbSB7TnVtYmVyfSB4CgkgKiAgICAgICAgVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBpdGVtLgoJICogQHBhcmFtIHtOdW1iZXJ9IHkKCSAqICAgICAgICBUaGUgaW5kZXggb2YgdGhlIHNlY29uZCBpdGVtLgoJICovCglmdW5jdGlvbiBzd2FwKGFyeSwgeCwgeSkgewoJICB2YXIgdGVtcCA9IGFyeVt4XTsKCSAgYXJ5W3hdID0gYXJ5W3ldOwoJICBhcnlbeV0gPSB0ZW1wOwoJfQoKCS8qKgoJICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIHdpdGhpbiB0aGUgcmFuZ2UgYGxvdyAuLiBoaWdoYCBpbmNsdXNpdmUuCgkgKgoJICogQHBhcmFtIHtOdW1iZXJ9IGxvdwoJICogICAgICAgIFRoZSBsb3dlciBib3VuZCBvbiB0aGUgcmFuZ2UuCgkgKiBAcGFyYW0ge051bWJlcn0gaGlnaAoJICogICAgICAgIFRoZSB1cHBlciBib3VuZCBvbiB0aGUgcmFuZ2UuCgkgKi8KCWZ1bmN0aW9uIHJhbmRvbUludEluUmFuZ2UobG93LCBoaWdoKSB7CgkgIHJldHVybiBNYXRoLnJvdW5kKGxvdyArIChNYXRoLnJhbmRvbSgpICogKGhpZ2ggLSBsb3cpKSk7Cgl9CgoJLyoqCgkgKiBUaGUgUXVpY2sgU29ydCBhbGdvcml0aG0uCgkgKgoJICogQHBhcmFtIHtBcnJheX0gYXJ5CgkgKiAgICAgICAgQW4gYXJyYXkgdG8gc29ydC4KCSAqIEBwYXJhbSB7ZnVuY3Rpb259IGNvbXBhcmF0b3IKCSAqICAgICAgICBGdW5jdGlvbiB0byB1c2UgdG8gY29tcGFyZSB0d28gaXRlbXMuCgkgKiBAcGFyYW0ge051bWJlcn0gcAoJICogICAgICAgIFN0YXJ0IGluZGV4IG9mIHRoZSBhcnJheQoJICogQHBhcmFtIHtOdW1iZXJ9IHIKCSAqICAgICAgICBFbmQgaW5kZXggb2YgdGhlIGFycmF5CgkgKi8KCWZ1bmN0aW9uIGRvUXVpY2tTb3J0KGFyeSwgY29tcGFyYXRvciwgcCwgcikgewoJICAvLyBJZiBvdXIgbG93ZXIgYm91bmQgaXMgbGVzcyB0aGFuIG91ciB1cHBlciBib3VuZCwgd2UgKDEpIHBhcnRpdGlvbiB0aGUKCSAgLy8gYXJyYXkgaW50byB0d28gcGllY2VzIGFuZCAoMikgcmVjdXJzZSBvbiBlYWNoIGhhbGYuIElmIGl0IGlzIG5vdCwgdGhpcyBpcwoJICAvLyB0aGUgZW1wdHkgYXJyYXkgYW5kIG91ciBiYXNlIGNhc2UuCgoJICBpZiAocCA8IHIpIHsKCSAgICAvLyAoMSkgUGFydGl0aW9uaW5nLgoJICAgIC8vCgkgICAgLy8gVGhlIHBhcnRpdGlvbmluZyBjaG9vc2VzIGEgcGl2b3QgYmV0d2VlbiBgcGAgYW5kIGByYCBhbmQgbW92ZXMgYWxsCgkgICAgLy8gZWxlbWVudHMgdGhhdCBhcmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBwaXZvdCB0byB0aGUgYmVmb3JlIGl0LCBhbmQKCSAgICAvLyBhbGwgdGhlIGVsZW1lbnRzIHRoYXQgYXJlIGdyZWF0ZXIgdGhhbiBpdCBhZnRlciBpdC4gVGhlIGVmZmVjdCBpcyB0aGF0CgkgICAgLy8gb25jZSBwYXJ0aXRpb24gaXMgZG9uZSwgdGhlIHBpdm90IGlzIGluIHRoZSBleGFjdCBwbGFjZSBpdCB3aWxsIGJlIHdoZW4KCSAgICAvLyB0aGUgYXJyYXkgaXMgcHV0IGluIHNvcnRlZCBvcmRlciwgYW5kIGl0IHdpbGwgbm90IG5lZWQgdG8gYmUgbW92ZWQKCSAgICAvLyBhZ2Fpbi4gVGhpcyBydW5zIGluIE8obikgdGltZS4KCgkgICAgLy8gQWx3YXlzIGNob29zZSBhIHJhbmRvbSBwaXZvdCBzbyB0aGF0IGFuIGlucHV0IGFycmF5IHdoaWNoIGlzIHJldmVyc2UKCSAgICAvLyBzb3J0ZWQgZG9lcyBub3QgY2F1c2UgTyhuXjIpIHJ1bm5pbmcgdGltZS4KCSAgICB2YXIgcGl2b3RJbmRleCA9IHJhbmRvbUludEluUmFuZ2UocCwgcik7CgkgICAgdmFyIGkgPSBwIC0gMTsKCgkgICAgc3dhcChhcnksIHBpdm90SW5kZXgsIHIpOwoJICAgIHZhciBwaXZvdCA9IGFyeVtyXTsKCgkgICAgLy8gSW1tZWRpYXRlbHkgYWZ0ZXIgYGpgIGlzIGluY3JlbWVudGVkIGluIHRoaXMgbG9vcCwgdGhlIGZvbGxvd2luZyBob2xkCgkgICAgLy8gdHJ1ZToKCSAgICAvLwoJICAgIC8vICAgKiBFdmVyeSBlbGVtZW50IGluIGBhcnlbcCAuLiBpXWAgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBwaXZvdC4KCSAgICAvLwoJICAgIC8vICAgKiBFdmVyeSBlbGVtZW50IGluIGBhcnlbaSsxIC4uIGotMV1gIGlzIGdyZWF0ZXIgdGhhbiB0aGUgcGl2b3QuCgkgICAgZm9yICh2YXIgaiA9IHA7IGogPCByOyBqKyspIHsKCSAgICAgIGlmIChjb21wYXJhdG9yKGFyeVtqXSwgcGl2b3QpIDw9IDApIHsKCSAgICAgICAgaSArPSAxOwoJICAgICAgICBzd2FwKGFyeSwgaSwgaik7CgkgICAgICB9CgkgICAgfQoKCSAgICBzd2FwKGFyeSwgaSArIDEsIGopOwoJICAgIHZhciBxID0gaSArIDE7CgoJICAgIC8vICgyKSBSZWN1cnNlIG9uIGVhY2ggaGFsZi4KCgkgICAgZG9RdWlja1NvcnQoYXJ5LCBjb21wYXJhdG9yLCBwLCBxIC0gMSk7CgkgICAgZG9RdWlja1NvcnQoYXJ5LCBjb21wYXJhdG9yLCBxICsgMSwgcik7CgkgIH0KCX0KCgkvKioKCSAqIFNvcnQgdGhlIGdpdmVuIGFycmF5IGluLXBsYWNlIHdpdGggdGhlIGdpdmVuIGNvbXBhcmF0b3IgZnVuY3Rpb24uCgkgKgoJICogQHBhcmFtIHtBcnJheX0gYXJ5CgkgKiAgICAgICAgQW4gYXJyYXkgdG8gc29ydC4KCSAqIEBwYXJhbSB7ZnVuY3Rpb259IGNvbXBhcmF0b3IKCSAqICAgICAgICBGdW5jdGlvbiB0byB1c2UgdG8gY29tcGFyZSB0d28gaXRlbXMuCgkgKi8KCXF1aWNrU29ydC5xdWlja1NvcnQgPSBmdW5jdGlvbiAoYXJ5LCBjb21wYXJhdG9yKSB7CgkgIGRvUXVpY2tTb3J0KGFyeSwgY29tcGFyYXRvciwgMCwgYXJ5Lmxlbmd0aCAtIDEpOwoJfTsKCXJldHVybiBxdWlja1NvcnQ7Cn0KCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZFNvdXJjZU1hcENvbnN1bWVyOwoKZnVuY3Rpb24gcmVxdWlyZVNvdXJjZU1hcENvbnN1bWVyICgpIHsKCWlmIChoYXNSZXF1aXJlZFNvdXJjZU1hcENvbnN1bWVyKSByZXR1cm4gc291cmNlTWFwQ29uc3VtZXI7CgloYXNSZXF1aXJlZFNvdXJjZU1hcENvbnN1bWVyID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgl2YXIgdXRpbCA9IHJlcXVpcmVVdGlsKCk7Cgl2YXIgYmluYXJ5U2VhcmNoID0gcmVxdWlyZUJpbmFyeVNlYXJjaCgpOwoJdmFyIEFycmF5U2V0ID0gcmVxdWlyZUFycmF5U2V0KCkuQXJyYXlTZXQ7Cgl2YXIgYmFzZTY0VkxRID0gcmVxdWlyZUJhc2U2NFZscSgpOwoJdmFyIHF1aWNrU29ydCA9IHJlcXVpcmVRdWlja1NvcnQoKS5xdWlja1NvcnQ7CgoJZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXIoYVNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkgewoJICB2YXIgc291cmNlTWFwID0gYVNvdXJjZU1hcDsKCSAgaWYgKHR5cGVvZiBhU291cmNlTWFwID09PSAnc3RyaW5nJykgewoJICAgIHNvdXJjZU1hcCA9IHV0aWwucGFyc2VTb3VyY2VNYXBJbnB1dChhU291cmNlTWFwKTsKCSAgfQoKCSAgcmV0dXJuIHNvdXJjZU1hcC5zZWN0aW9ucyAhPSBudWxsCgkgICAgPyBuZXcgSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyKHNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkKCSAgICA6IG5ldyBCYXNpY1NvdXJjZU1hcENvbnN1bWVyKHNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCk7Cgl9CgoJU291cmNlTWFwQ29uc3VtZXIuZnJvbVNvdXJjZU1hcCA9IGZ1bmN0aW9uKGFTb3VyY2VNYXAsIGFTb3VyY2VNYXBVUkwpIHsKCSAgcmV0dXJuIEJhc2ljU291cmNlTWFwQ29uc3VtZXIuZnJvbVNvdXJjZU1hcChhU291cmNlTWFwLCBhU291cmNlTWFwVVJMKTsKCX07CgoJLyoqCgkgKiBUaGUgdmVyc2lvbiBvZiB0aGUgc291cmNlIG1hcHBpbmcgc3BlYyB0aGF0IHdlIGFyZSBjb25zdW1pbmcuCgkgKi8KCVNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgoJLy8gYF9fZ2VuZXJhdGVkTWFwcGluZ3NgIGFuZCBgX19vcmlnaW5hbE1hcHBpbmdzYCBhcmUgYXJyYXlzIHRoYXQgaG9sZCB0aGUKCS8vIHBhcnNlZCBtYXBwaW5nIGNvb3JkaW5hdGVzIGZyb20gdGhlIHNvdXJjZSBtYXAncyAibWFwcGluZ3MiIGF0dHJpYnV0ZS4gVGhleQoJLy8gYXJlIGxhemlseSBpbnN0YW50aWF0ZWQsIGFjY2Vzc2VkIHZpYSB0aGUgYF9nZW5lcmF0ZWRNYXBwaW5nc2AgYW5kCgkvLyBgX29yaWdpbmFsTWFwcGluZ3NgIGdldHRlcnMgcmVzcGVjdGl2ZWx5LCBhbmQgd2Ugb25seSBwYXJzZSB0aGUgbWFwcGluZ3MKCS8vIGFuZCBjcmVhdGUgdGhlc2UgYXJyYXlzIG9uY2UgcXVlcmllZCBmb3IgYSBzb3VyY2UgbG9jYXRpb24uIFdlIGp1bXAgdGhyb3VnaAoJLy8gdGhlc2UgaG9vcHMgYmVjYXVzZSB0aGVyZSBjYW4gYmUgbWFueSB0aG91c2FuZHMgb2YgbWFwcGluZ3MsIGFuZCBwYXJzaW5nCgkvLyB0aGVtIGlzIGV4cGVuc2l2ZSwgc28gd2Ugb25seSB3YW50IHRvIGRvIGl0IGlmIHdlIG11c3QuCgkvLwoJLy8gRWFjaCBvYmplY3QgaW4gdGhlIGFycmF5cyBpcyBvZiB0aGUgZm9ybToKCS8vCgkvLyAgICAgewoJLy8gICAgICAgZ2VuZXJhdGVkTGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgY29kZSwKCS8vICAgICAgIGdlbmVyYXRlZENvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBjb2RlLAoJLy8gICAgICAgc291cmNlOiBUaGUgcGF0aCB0byB0aGUgb3JpZ2luYWwgc291cmNlIGZpbGUgdGhhdCBnZW5lcmF0ZWQgdGhpcwoJLy8gICAgICAgICAgICAgICBjaHVuayBvZiBjb2RlLAoJLy8gICAgICAgb3JpZ2luYWxMaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZSB0aGF0CgkvLyAgICAgICAgICAgICAgICAgICAgIGNvcnJlc3BvbmRzIHRvIHRoaXMgY2h1bmsgb2YgZ2VuZXJhdGVkIGNvZGUsCgkvLyAgICAgICBvcmlnaW5hbENvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZSB0aGF0CgkvLyAgICAgICAgICAgICAgICAgICAgICAgY29ycmVzcG9uZHMgdG8gdGhpcyBjaHVuayBvZiBnZW5lcmF0ZWQgY29kZSwKCS8vICAgICAgIG5hbWU6IFRoZSBuYW1lIG9mIHRoZSBvcmlnaW5hbCBzeW1ib2wgd2hpY2ggZ2VuZXJhdGVkIHRoaXMgY2h1bmsgb2YKCS8vICAgICAgICAgICAgIGNvZGUuCgkvLyAgICAgfQoJLy8KCS8vIEFsbCBwcm9wZXJ0aWVzIGV4Y2VwdCBmb3IgYGdlbmVyYXRlZExpbmVgIGFuZCBgZ2VuZXJhdGVkQ29sdW1uYCBjYW4gYmUKCS8vIGBudWxsYC4KCS8vCgkvLyBgX2dlbmVyYXRlZE1hcHBpbmdzYCBpcyBvcmRlcmVkIGJ5IHRoZSBnZW5lcmF0ZWQgcG9zaXRpb25zLgoJLy8KCS8vIGBfb3JpZ2luYWxNYXBwaW5nc2AgaXMgb3JkZXJlZCBieSB0aGUgb3JpZ2luYWwgcG9zaXRpb25zLgoKCVNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fX2dlbmVyYXRlZE1hcHBpbmdzID0gbnVsbDsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUsICdfZ2VuZXJhdGVkTWFwcGluZ3MnLCB7CgkgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCSAgZW51bWVyYWJsZTogdHJ1ZSwKCSAgZ2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgaWYgKCF0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3MpIHsKCSAgICAgIHRoaXMuX3BhcnNlTWFwcGluZ3ModGhpcy5fbWFwcGluZ3MsIHRoaXMuc291cmNlUm9vdCk7CgkgICAgfQoKCSAgICByZXR1cm4gdGhpcy5fX2dlbmVyYXRlZE1hcHBpbmdzOwoJICB9Cgl9KTsKCglTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX19vcmlnaW5hbE1hcHBpbmdzID0gbnVsbDsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUsICdfb3JpZ2luYWxNYXBwaW5ncycsIHsKCSAgY29uZmlndXJhYmxlOiB0cnVlLAoJICBlbnVtZXJhYmxlOiB0cnVlLAoJICBnZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICBpZiAoIXRoaXMuX19vcmlnaW5hbE1hcHBpbmdzKSB7CgkgICAgICB0aGlzLl9wYXJzZU1hcHBpbmdzKHRoaXMuX21hcHBpbmdzLCB0aGlzLnNvdXJjZVJvb3QpOwoJICAgIH0KCgkgICAgcmV0dXJuIHRoaXMuX19vcmlnaW5hbE1hcHBpbmdzOwoJICB9Cgl9KTsKCglTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX2NoYXJJc01hcHBpbmdTZXBhcmF0b3IgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9jaGFySXNNYXBwaW5nU2VwYXJhdG9yKGFTdHIsIGluZGV4KSB7CgkgICAgdmFyIGMgPSBhU3RyLmNoYXJBdChpbmRleCk7CgkgICAgcmV0dXJuIGMgPT09ICI7IiB8fCBjID09PSAiLCI7CgkgIH07CgoJLyoqCgkgKiBQYXJzZSB0aGUgbWFwcGluZ3MgaW4gYSBzdHJpbmcgaW4gdG8gYSBkYXRhIHN0cnVjdHVyZSB3aGljaCB3ZSBjYW4gZWFzaWx5CgkgKiBxdWVyeSAodGhlIG9yZGVyZWQgYXJyYXlzIGluIHRoZSBgdGhpcy5fX2dlbmVyYXRlZE1hcHBpbmdzYCBhbmQKCSAqIGB0aGlzLl9fb3JpZ2luYWxNYXBwaW5nc2AgcHJvcGVydGllcykuCgkgKi8KCVNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fcGFyc2VNYXBwaW5ncyA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX3BhcnNlTWFwcGluZ3MoYVN0ciwgYVNvdXJjZVJvb3QpIHsKCSAgICB0aHJvdyBuZXcgRXJyb3IoIlN1YmNsYXNzZXMgbXVzdCBpbXBsZW1lbnQgX3BhcnNlTWFwcGluZ3MiKTsKCSAgfTsKCglTb3VyY2VNYXBDb25zdW1lci5HRU5FUkFURURfT1JERVIgPSAxOwoJU291cmNlTWFwQ29uc3VtZXIuT1JJR0lOQUxfT1JERVIgPSAyOwoKCVNvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EID0gMTsKCVNvdXJjZU1hcENvbnN1bWVyLkxFQVNUX1VQUEVSX0JPVU5EID0gMjsKCgkvKioKCSAqIEl0ZXJhdGUgb3ZlciBlYWNoIG1hcHBpbmcgYmV0d2VlbiBhbiBvcmlnaW5hbCBzb3VyY2UvbGluZS9jb2x1bW4gYW5kIGEKCSAqIGdlbmVyYXRlZCBsaW5lL2NvbHVtbiBpbiB0aGlzIHNvdXJjZSBtYXAuCgkgKgoJICogQHBhcmFtIEZ1bmN0aW9uIGFDYWxsYmFjawoJICogICAgICAgIFRoZSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aXRoIGVhY2ggbWFwcGluZy4KCSAqIEBwYXJhbSBPYmplY3QgYUNvbnRleHQKCSAqICAgICAgICBPcHRpb25hbC4gSWYgc3BlY2lmaWVkLCB0aGlzIG9iamVjdCB3aWxsIGJlIHRoZSB2YWx1ZSBvZiBgdGhpc2AgZXZlcnkKCSAqICAgICAgICB0aW1lIHRoYXQgYGFDYWxsYmFja2AgaXMgY2FsbGVkLgoJICogQHBhcmFtIGFPcmRlcgoJICogICAgICAgIEVpdGhlciBgU291cmNlTWFwQ29uc3VtZXIuR0VORVJBVEVEX09SREVSYCBvcgoJICogICAgICAgIGBTb3VyY2VNYXBDb25zdW1lci5PUklHSU5BTF9PUkRFUmAuIFNwZWNpZmllcyB3aGV0aGVyIHlvdSB3YW50IHRvCgkgKiAgICAgICAgaXRlcmF0ZSBvdmVyIHRoZSBtYXBwaW5ncyBzb3J0ZWQgYnkgdGhlIGdlbmVyYXRlZCBmaWxlJ3MgbGluZS9jb2x1bW4KCSAqICAgICAgICBvcmRlciBvciB0aGUgb3JpZ2luYWwncyBzb3VyY2UvbGluZS9jb2x1bW4gb3JkZXIsIHJlc3BlY3RpdmVseS4gRGVmYXVsdHMgdG8KCSAqICAgICAgICBgU291cmNlTWFwQ29uc3VtZXIuR0VORVJBVEVEX09SREVSYC4KCSAqLwoJU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmVhY2hNYXBwaW5nID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfZWFjaE1hcHBpbmcoYUNhbGxiYWNrLCBhQ29udGV4dCwgYU9yZGVyKSB7CgkgICAgdmFyIGNvbnRleHQgPSBhQ29udGV4dCB8fCBudWxsOwoJICAgIHZhciBvcmRlciA9IGFPcmRlciB8fCBTb3VyY2VNYXBDb25zdW1lci5HRU5FUkFURURfT1JERVI7CgoJICAgIHZhciBtYXBwaW5nczsKCSAgICBzd2l0Y2ggKG9yZGVyKSB7CgkgICAgY2FzZSBTb3VyY2VNYXBDb25zdW1lci5HRU5FUkFURURfT1JERVI6CgkgICAgICBtYXBwaW5ncyA9IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzOwoJICAgICAgYnJlYWs7CgkgICAgY2FzZSBTb3VyY2VNYXBDb25zdW1lci5PUklHSU5BTF9PUkRFUjoKCSAgICAgIG1hcHBpbmdzID0gdGhpcy5fb3JpZ2luYWxNYXBwaW5nczsKCSAgICAgIGJyZWFrOwoJICAgIGRlZmF1bHQ6CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gb3JkZXIgb2YgaXRlcmF0aW9uLiIpOwoJICAgIH0KCgkgICAgdmFyIHNvdXJjZVJvb3QgPSB0aGlzLnNvdXJjZVJvb3Q7CgkgICAgbWFwcGluZ3MubWFwKGZ1bmN0aW9uIChtYXBwaW5nKSB7CgkgICAgICB2YXIgc291cmNlID0gbWFwcGluZy5zb3VyY2UgPT09IG51bGwgPyBudWxsIDogdGhpcy5fc291cmNlcy5hdChtYXBwaW5nLnNvdXJjZSk7CgkgICAgICBzb3VyY2UgPSB1dGlsLmNvbXB1dGVTb3VyY2VVUkwoc291cmNlUm9vdCwgc291cmNlLCB0aGlzLl9zb3VyY2VNYXBVUkwpOwoJICAgICAgcmV0dXJuIHsKCSAgICAgICAgc291cmNlOiBzb3VyY2UsCgkgICAgICAgIGdlbmVyYXRlZExpbmU6IG1hcHBpbmcuZ2VuZXJhdGVkTGluZSwKCSAgICAgICAgZ2VuZXJhdGVkQ29sdW1uOiBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiwKCSAgICAgICAgb3JpZ2luYWxMaW5lOiBtYXBwaW5nLm9yaWdpbmFsTGluZSwKCSAgICAgICAgb3JpZ2luYWxDb2x1bW46IG1hcHBpbmcub3JpZ2luYWxDb2x1bW4sCgkgICAgICAgIG5hbWU6IG1hcHBpbmcubmFtZSA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLl9uYW1lcy5hdChtYXBwaW5nLm5hbWUpCgkgICAgICB9OwoJICAgIH0sIHRoaXMpLmZvckVhY2goYUNhbGxiYWNrLCBjb250ZXh0KTsKCSAgfTsKCgkvKioKCSAqIFJldHVybnMgYWxsIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBvcmlnaW5hbCBzb3VyY2UsCgkgKiBsaW5lLCBhbmQgY29sdW1uIHByb3ZpZGVkLiBJZiBubyBjb2x1bW4gaXMgcHJvdmlkZWQsIHJldHVybnMgYWxsIG1hcHBpbmdzCgkgKiBjb3JyZXNwb25kaW5nIHRvIGEgZWl0aGVyIHRoZSBsaW5lIHdlIGFyZSBzZWFyY2hpbmcgZm9yIG9yIHRoZSBuZXh0CgkgKiBjbG9zZXN0IGxpbmUgdGhhdCBoYXMgYW55IG1hcHBpbmdzLiBPdGhlcndpc2UsIHJldHVybnMgYWxsIG1hcHBpbmdzCgkgKiBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBsaW5lIGFuZCBlaXRoZXIgdGhlIGNvbHVtbiB3ZSBhcmUgc2VhcmNoaW5nIGZvcgoJICogb3IgdGhlIG5leHQgY2xvc2VzdCBjb2x1bW4gdGhhdCBoYXMgYW55IG9mZnNldHMuCgkgKgoJICogVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBzb3VyY2U6IFRoZSBmaWxlbmFtZSBvZiB0aGUgb3JpZ2luYWwgc291cmNlLgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLiAgVGhlIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBPcHRpb25hbC4gdGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZS4KCSAqICAgIFRoZSBjb2x1bW4gbnVtYmVyIGlzIDAtYmFzZWQuCgkgKgoJICogYW5kIGFuIGFycmF5IG9mIG9iamVjdHMgaXMgcmV0dXJuZWQsIGVhY2ggd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgbGluZSBudW1iZXIgaXMgMS1iYXNlZC4KCSAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLCBvciBudWxsLgoJICogICAgVGhlIGNvbHVtbiBudW1iZXIgaXMgMC1iYXNlZC4KCSAqLwoJU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmFsbEdlbmVyYXRlZFBvc2l0aW9uc0ZvciA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2FsbEdlbmVyYXRlZFBvc2l0aW9uc0ZvcihhQXJncykgewoJICAgIHZhciBsaW5lID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdsaW5lJyk7CgoJICAgIC8vIFdoZW4gdGhlcmUgaXMgbm8gZXhhY3QgbWF0Y2gsIEJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9maW5kTWFwcGluZwoJICAgIC8vIHJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBjbG9zZXN0IG1hcHBpbmcgbGVzcyB0aGFuIHRoZSBuZWVkbGUuIEJ5CgkgICAgLy8gc2V0dGluZyBuZWVkbGUub3JpZ2luYWxDb2x1bW4gdG8gMCwgd2UgdGh1cyBmaW5kIHRoZSBsYXN0IG1hcHBpbmcgZm9yCgkgICAgLy8gdGhlIGdpdmVuIGxpbmUsIHByb3ZpZGVkIHN1Y2ggYSBtYXBwaW5nIGV4aXN0cy4KCSAgICB2YXIgbmVlZGxlID0gewoJICAgICAgc291cmNlOiB1dGlsLmdldEFyZyhhQXJncywgJ3NvdXJjZScpLAoJICAgICAgb3JpZ2luYWxMaW5lOiBsaW5lLAoJICAgICAgb3JpZ2luYWxDb2x1bW46IHV0aWwuZ2V0QXJnKGFBcmdzLCAnY29sdW1uJywgMCkKCSAgICB9OwoKCSAgICBuZWVkbGUuc291cmNlID0gdGhpcy5fZmluZFNvdXJjZUluZGV4KG5lZWRsZS5zb3VyY2UpOwoJICAgIGlmIChuZWVkbGUuc291cmNlIDwgMCkgewoJICAgICAgcmV0dXJuIFtdOwoJICAgIH0KCgkgICAgdmFyIG1hcHBpbmdzID0gW107CgoJICAgIHZhciBpbmRleCA9IHRoaXMuX2ZpbmRNYXBwaW5nKG5lZWRsZSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvcmlnaW5hbExpbmUiLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvcmlnaW5hbENvbHVtbiIsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9ucywKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5hcnlTZWFyY2guTEVBU1RfVVBQRVJfQk9VTkQpOwoJICAgIGlmIChpbmRleCA+PSAwKSB7CgkgICAgICB2YXIgbWFwcGluZyA9IHRoaXMuX29yaWdpbmFsTWFwcGluZ3NbaW5kZXhdOwoKCSAgICAgIGlmIChhQXJncy5jb2x1bW4gPT09IHVuZGVmaW5lZCkgewoJICAgICAgICB2YXIgb3JpZ2luYWxMaW5lID0gbWFwcGluZy5vcmlnaW5hbExpbmU7CgoJICAgICAgICAvLyBJdGVyYXRlIHVudGlsIGVpdGhlciB3ZSBydW4gb3V0IG9mIG1hcHBpbmdzLCBvciB3ZSBydW4gaW50bwoJICAgICAgICAvLyBhIG1hcHBpbmcgZm9yIGEgZGlmZmVyZW50IGxpbmUgdGhhbiB0aGUgb25lIHdlIGZvdW5kLiBTaW5jZQoJICAgICAgICAvLyBtYXBwaW5ncyBhcmUgc29ydGVkLCB0aGlzIGlzIGd1YXJhbnRlZWQgdG8gZmluZCBhbGwgbWFwcGluZ3MgZm9yCgkgICAgICAgIC8vIHRoZSBsaW5lIHdlIGZvdW5kLgoJICAgICAgICB3aGlsZSAobWFwcGluZyAmJiBtYXBwaW5nLm9yaWdpbmFsTGluZSA9PT0gb3JpZ2luYWxMaW5lKSB7CgkgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CgkgICAgICAgICAgICBsaW5lOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkTGluZScsIG51bGwpLAoJICAgICAgICAgICAgY29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkQ29sdW1uJywgbnVsbCksCgkgICAgICAgICAgICBsYXN0Q29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnbGFzdEdlbmVyYXRlZENvbHVtbicsIG51bGwpCgkgICAgICAgICAgfSk7CgoJICAgICAgICAgIG1hcHBpbmcgPSB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzWysraW5kZXhdOwoJICAgICAgICB9CgkgICAgICB9IGVsc2UgewoJICAgICAgICB2YXIgb3JpZ2luYWxDb2x1bW4gPSBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uOwoKCSAgICAgICAgLy8gSXRlcmF0ZSB1bnRpbCBlaXRoZXIgd2UgcnVuIG91dCBvZiBtYXBwaW5ncywgb3Igd2UgcnVuIGludG8KCSAgICAgICAgLy8gYSBtYXBwaW5nIGZvciBhIGRpZmZlcmVudCBsaW5lIHRoYW4gdGhlIG9uZSB3ZSB3ZXJlIHNlYXJjaGluZyBmb3IuCgkgICAgICAgIC8vIFNpbmNlIG1hcHBpbmdzIGFyZSBzb3J0ZWQsIHRoaXMgaXMgZ3VhcmFudGVlZCB0byBmaW5kIGFsbCBtYXBwaW5ncyBmb3IKCSAgICAgICAgLy8gdGhlIGxpbmUgd2UgYXJlIHNlYXJjaGluZyBmb3IuCgkgICAgICAgIHdoaWxlIChtYXBwaW5nICYmCgkgICAgICAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsTGluZSA9PT0gbGluZSAmJgoJICAgICAgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbENvbHVtbiA9PSBvcmlnaW5hbENvbHVtbikgewoJICAgICAgICAgIG1hcHBpbmdzLnB1c2goewoJICAgICAgICAgICAgbGluZTogdXRpbC5nZXRBcmcobWFwcGluZywgJ2dlbmVyYXRlZExpbmUnLCBudWxsKSwKCSAgICAgICAgICAgIGNvbHVtbjogdXRpbC5nZXRBcmcobWFwcGluZywgJ2dlbmVyYXRlZENvbHVtbicsIG51bGwpLAoJICAgICAgICAgICAgbGFzdENvbHVtbjogdXRpbC5nZXRBcmcobWFwcGluZywgJ2xhc3RHZW5lcmF0ZWRDb2x1bW4nLCBudWxsKQoJICAgICAgICAgIH0pOwoKCSAgICAgICAgICBtYXBwaW5nID0gdGhpcy5fb3JpZ2luYWxNYXBwaW5nc1srK2luZGV4XTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIG1hcHBpbmdzOwoJICB9OwoKCXNvdXJjZU1hcENvbnN1bWVyLlNvdXJjZU1hcENvbnN1bWVyID0gU291cmNlTWFwQ29uc3VtZXI7CgoJLyoqCgkgKiBBIEJhc2ljU291cmNlTWFwQ29uc3VtZXIgaW5zdGFuY2UgcmVwcmVzZW50cyBhIHBhcnNlZCBzb3VyY2UgbWFwIHdoaWNoIHdlIGNhbgoJICogcXVlcnkgZm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcmlnaW5hbCBmaWxlIHBvc2l0aW9ucyBieSBnaXZpbmcgaXQgYSBmaWxlCgkgKiBwb3NpdGlvbiBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4KCSAqCgkgKiBUaGUgZmlyc3QgcGFyYW1ldGVyIGlzIHRoZSByYXcgc291cmNlIG1hcCAoZWl0aGVyIGFzIGEgSlNPTiBzdHJpbmcsIG9yCgkgKiBhbHJlYWR5IHBhcnNlZCB0byBhbiBvYmplY3QpLiBBY2NvcmRpbmcgdG8gdGhlIHNwZWMsIHNvdXJjZSBtYXBzIGhhdmUgdGhlCgkgKiBmb2xsb3dpbmcgYXR0cmlidXRlczoKCSAqCgkgKiAgIC0gdmVyc2lvbjogV2hpY2ggdmVyc2lvbiBvZiB0aGUgc291cmNlIG1hcCBzcGVjIHRoaXMgbWFwIGlzIGZvbGxvd2luZy4KCSAqICAgLSBzb3VyY2VzOiBBbiBhcnJheSBvZiBVUkxzIHRvIHRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZXMuCgkgKiAgIC0gbmFtZXM6IEFuIGFycmF5IG9mIGlkZW50aWZpZXJzIHdoaWNoIGNhbiBiZSByZWZlcnJlbmNlZCBieSBpbmRpdmlkdWFsIG1hcHBpbmdzLgoJICogICAtIHNvdXJjZVJvb3Q6IE9wdGlvbmFsLiBUaGUgVVJMIHJvb3QgZnJvbSB3aGljaCBhbGwgc291cmNlcyBhcmUgcmVsYXRpdmUuCgkgKiAgIC0gc291cmNlc0NvbnRlbnQ6IE9wdGlvbmFsLiBBbiBhcnJheSBvZiBjb250ZW50cyBvZiB0aGUgb3JpZ2luYWwgc291cmNlIGZpbGVzLgoJICogICAtIG1hcHBpbmdzOiBBIHN0cmluZyBvZiBiYXNlNjQgVkxRcyB3aGljaCBjb250YWluIHRoZSBhY3R1YWwgbWFwcGluZ3MuCgkgKiAgIC0gZmlsZTogT3B0aW9uYWwuIFRoZSBnZW5lcmF0ZWQgZmlsZSB0aGlzIHNvdXJjZSBtYXAgaXMgYXNzb2NpYXRlZCB3aXRoLgoJICoKCSAqIEhlcmUgaXMgYW4gZXhhbXBsZSBzb3VyY2UgbWFwLCB0YWtlbiBmcm9tIHRoZSBzb3VyY2UgbWFwIHNwZWNbMF06CgkgKgoJICogICAgIHsKCSAqICAgICAgIHZlcnNpb24gOiAzLAoJICogICAgICAgZmlsZTogIm91dC5qcyIsCgkgKiAgICAgICBzb3VyY2VSb290IDogIiIsCgkgKiAgICAgICBzb3VyY2VzOiBbImZvby5qcyIsICJiYXIuanMiXSwKCSAqICAgICAgIG5hbWVzOiBbInNyYyIsICJtYXBzIiwgImFyZSIsICJmdW4iXSwKCSAqICAgICAgIG1hcHBpbmdzOiAiQUEsQUI7O0FCQ0RFOyIKCSAqICAgICB9CgkgKgoJICogVGhlIHNlY29uZCBwYXJhbWV0ZXIsIGlmIGdpdmVuLCBpcyBhIHN0cmluZyB3aG9zZSB2YWx1ZSBpcyB0aGUgVVJMCgkgKiBhdCB3aGljaCB0aGUgc291cmNlIG1hcCB3YXMgZm91bmQuICBUaGlzIFVSTCBpcyB1c2VkIHRvIGNvbXB1dGUgdGhlCgkgKiBzb3VyY2VzIGFycmF5LgoJICoKCSAqIFswXTogaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xVTFSR0FlaFF3UnlwVVRvdkYxS1JscGlPRnplMGItXzJnYzZmQUgwS1kway9lZGl0P3BsaT0xIwoJICovCglmdW5jdGlvbiBCYXNpY1NvdXJjZU1hcENvbnN1bWVyKGFTb3VyY2VNYXAsIGFTb3VyY2VNYXBVUkwpIHsKCSAgdmFyIHNvdXJjZU1hcCA9IGFTb3VyY2VNYXA7CgkgIGlmICh0eXBlb2YgYVNvdXJjZU1hcCA9PT0gJ3N0cmluZycpIHsKCSAgICBzb3VyY2VNYXAgPSB1dGlsLnBhcnNlU291cmNlTWFwSW5wdXQoYVNvdXJjZU1hcCk7CgkgIH0KCgkgIHZhciB2ZXJzaW9uID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAndmVyc2lvbicpOwoJICB2YXIgc291cmNlcyA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ3NvdXJjZXMnKTsKCSAgLy8gU2FzcyAzLjMgbGVhdmVzIG91dCB0aGUgJ25hbWVzJyBhcnJheSwgc28gd2UgZGV2aWF0ZSBmcm9tIHRoZSBzcGVjICh3aGljaAoJICAvLyByZXF1aXJlcyB0aGUgYXJyYXkpIHRvIHBsYXkgbmljZSBoZXJlLgoJICB2YXIgbmFtZXMgPSB1dGlsLmdldEFyZyhzb3VyY2VNYXAsICduYW1lcycsIFtdKTsKCSAgdmFyIHNvdXJjZVJvb3QgPSB1dGlsLmdldEFyZyhzb3VyY2VNYXAsICdzb3VyY2VSb290JywgbnVsbCk7CgkgIHZhciBzb3VyY2VzQ29udGVudCA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ3NvdXJjZXNDb250ZW50JywgbnVsbCk7CgkgIHZhciBtYXBwaW5ncyA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ21hcHBpbmdzJyk7CgkgIHZhciBmaWxlID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAnZmlsZScsIG51bGwpOwoKCSAgLy8gT25jZSBhZ2FpbiwgU2FzcyBkZXZpYXRlcyBmcm9tIHRoZSBzcGVjIGFuZCBzdXBwbGllcyB0aGUgdmVyc2lvbiBhcyBhCgkgIC8vIHN0cmluZyByYXRoZXIgdGhhbiBhIG51bWJlciwgc28gd2UgdXNlIGxvb3NlIGVxdWFsaXR5IGNoZWNraW5nIGhlcmUuCgkgIGlmICh2ZXJzaW9uICE9IHRoaXMuX3ZlcnNpb24pIHsKCSAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIHZlcnNpb246ICcgKyB2ZXJzaW9uKTsKCSAgfQoKCSAgaWYgKHNvdXJjZVJvb3QpIHsKCSAgICBzb3VyY2VSb290ID0gdXRpbC5ub3JtYWxpemUoc291cmNlUm9vdCk7CgkgIH0KCgkgIHNvdXJjZXMgPSBzb3VyY2VzCgkgICAgLm1hcChTdHJpbmcpCgkgICAgLy8gU29tZSBzb3VyY2UgbWFwcyBwcm9kdWNlIHJlbGF0aXZlIHNvdXJjZSBwYXRocyBsaWtlICIuL2Zvby5qcyIgaW5zdGVhZCBvZgoJICAgIC8vICJmb28uanMiLiAgTm9ybWFsaXplIHRoZXNlIGZpcnN0IHNvIHRoYXQgZnV0dXJlIGNvbXBhcmlzb25zIHdpbGwgc3VjY2VlZC4KCSAgICAvLyBTZWUgYnVnemlsLmxhLzEwOTA3NjguCgkgICAgLm1hcCh1dGlsLm5vcm1hbGl6ZSkKCSAgICAvLyBBbHdheXMgZW5zdXJlIHRoYXQgYWJzb2x1dGUgc291cmNlcyBhcmUgaW50ZXJuYWxseSBzdG9yZWQgcmVsYXRpdmUgdG8KCSAgICAvLyB0aGUgc291cmNlIHJvb3QsIGlmIHRoZSBzb3VyY2Ugcm9vdCBpcyBhYnNvbHV0ZS4gTm90IGRvaW5nIHRoaXMgd291bGQKCSAgICAvLyBiZSBwYXJ0aWN1bGFybHkgcHJvYmxlbWF0aWMgd2hlbiB0aGUgc291cmNlIHJvb3QgaXMgYSBwcmVmaXggb2YgdGhlCgkgICAgLy8gc291cmNlICh2YWxpZCwgYnV0IHdoeT8/KS4gU2VlIGdpdGh1YiBpc3N1ZSAjMTk5IGFuZCBidWd6aWwubGEvMTE4ODk4Mi4KCSAgICAubWFwKGZ1bmN0aW9uIChzb3VyY2UpIHsKCSAgICAgIHJldHVybiBzb3VyY2VSb290ICYmIHV0aWwuaXNBYnNvbHV0ZShzb3VyY2VSb290KSAmJiB1dGlsLmlzQWJzb2x1dGUoc291cmNlKQoJICAgICAgICA/IHV0aWwucmVsYXRpdmUoc291cmNlUm9vdCwgc291cmNlKQoJICAgICAgICA6IHNvdXJjZTsKCSAgICB9KTsKCgkgIC8vIFBhc3MgYHRydWVgIGJlbG93IHRvIGFsbG93IGR1cGxpY2F0ZSBuYW1lcyBhbmQgc291cmNlcy4gV2hpbGUgc291cmNlIG1hcHMKCSAgLy8gYXJlIGludGVuZGVkIHRvIGJlIGNvbXByZXNzZWQgYW5kIGRlZHVwbGljYXRlZCwgdGhlIFR5cGVTY3JpcHQgY29tcGlsZXIKCSAgLy8gc29tZXRpbWVzIGdlbmVyYXRlcyBzb3VyY2UgbWFwcyB3aXRoIGR1cGxpY2F0ZXMgaW4gdGhlbS4gU2VlIEdpdGh1YiBpc3N1ZQoJICAvLyAjNzIgYW5kIGJ1Z3ppbC5sYS84ODk0OTIuCgkgIHRoaXMuX25hbWVzID0gQXJyYXlTZXQuZnJvbUFycmF5KG5hbWVzLm1hcChTdHJpbmcpLCB0cnVlKTsKCSAgdGhpcy5fc291cmNlcyA9IEFycmF5U2V0LmZyb21BcnJheShzb3VyY2VzLCB0cnVlKTsKCgkgIHRoaXMuX2Fic29sdXRlU291cmNlcyA9IHRoaXMuX3NvdXJjZXMudG9BcnJheSgpLm1hcChmdW5jdGlvbiAocykgewoJICAgIHJldHVybiB1dGlsLmNvbXB1dGVTb3VyY2VVUkwoc291cmNlUm9vdCwgcywgYVNvdXJjZU1hcFVSTCk7CgkgIH0pOwoKCSAgdGhpcy5zb3VyY2VSb290ID0gc291cmNlUm9vdDsKCSAgdGhpcy5zb3VyY2VzQ29udGVudCA9IHNvdXJjZXNDb250ZW50OwoJICB0aGlzLl9tYXBwaW5ncyA9IG1hcHBpbmdzOwoJICB0aGlzLl9zb3VyY2VNYXBVUkwgPSBhU291cmNlTWFwVVJMOwoJICB0aGlzLmZpbGUgPSBmaWxlOwoJfQoKCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUpOwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuY29uc3VtZXIgPSBTb3VyY2VNYXBDb25zdW1lcjsKCgkvKioKCSAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gZmluZCB0aGUgaW5kZXggb2YgYSBzb3VyY2UuICBSZXR1cm5zIC0xIGlmIG5vdAoJICogZm91bmQuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9maW5kU291cmNlSW5kZXggPSBmdW5jdGlvbihhU291cmNlKSB7CgkgIHZhciByZWxhdGl2ZVNvdXJjZSA9IGFTb3VyY2U7CgkgIGlmICh0aGlzLnNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgIHJlbGF0aXZlU291cmNlID0gdXRpbC5yZWxhdGl2ZSh0aGlzLnNvdXJjZVJvb3QsIHJlbGF0aXZlU291cmNlKTsKCSAgfQoKCSAgaWYgKHRoaXMuX3NvdXJjZXMuaGFzKHJlbGF0aXZlU291cmNlKSkgewoJICAgIHJldHVybiB0aGlzLl9zb3VyY2VzLmluZGV4T2YocmVsYXRpdmVTb3VyY2UpOwoJICB9CgoJICAvLyBNYXliZSBhU291cmNlIGlzIGFuIGFic29sdXRlIFVSTCBhcyByZXR1cm5lZCBieSB8c291cmNlc3wuICBJbgoJICAvLyB0aGlzIGNhc2Ugd2UgY2FuJ3Qgc2ltcGx5IHVuZG8gdGhlIHRyYW5zZm9ybS4KCSAgdmFyIGk7CgkgIGZvciAoaSA9IDA7IGkgPCB0aGlzLl9hYnNvbHV0ZVNvdXJjZXMubGVuZ3RoOyArK2kpIHsKCSAgICBpZiAodGhpcy5fYWJzb2x1dGVTb3VyY2VzW2ldID09IGFTb3VyY2UpIHsKCSAgICAgIHJldHVybiBpOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIC0xOwoJfTsKCgkvKioKCSAqIENyZWF0ZSBhIEJhc2ljU291cmNlTWFwQ29uc3VtZXIgZnJvbSBhIFNvdXJjZU1hcEdlbmVyYXRvci4KCSAqCgkgKiBAcGFyYW0gU291cmNlTWFwR2VuZXJhdG9yIGFTb3VyY2VNYXAKCSAqICAgICAgICBUaGUgc291cmNlIG1hcCB0aGF0IHdpbGwgYmUgY29uc3VtZWQuCgkgKiBAcGFyYW0gU3RyaW5nIGFTb3VyY2VNYXBVUkwKCSAqICAgICAgICBUaGUgVVJMIGF0IHdoaWNoIHRoZSBzb3VyY2UgbWFwIGNhbiBiZSBmb3VuZCAob3B0aW9uYWwpCgkgKiBAcmV0dXJucyBCYXNpY1NvdXJjZU1hcENvbnN1bWVyCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIuZnJvbVNvdXJjZU1hcCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2Zyb21Tb3VyY2VNYXAoYVNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkgewoJICAgIHZhciBzbWMgPSBPYmplY3QuY3JlYXRlKEJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlKTsKCgkgICAgdmFyIG5hbWVzID0gc21jLl9uYW1lcyA9IEFycmF5U2V0LmZyb21BcnJheShhU291cmNlTWFwLl9uYW1lcy50b0FycmF5KCksIHRydWUpOwoJICAgIHZhciBzb3VyY2VzID0gc21jLl9zb3VyY2VzID0gQXJyYXlTZXQuZnJvbUFycmF5KGFTb3VyY2VNYXAuX3NvdXJjZXMudG9BcnJheSgpLCB0cnVlKTsKCSAgICBzbWMuc291cmNlUm9vdCA9IGFTb3VyY2VNYXAuX3NvdXJjZVJvb3Q7CgkgICAgc21jLnNvdXJjZXNDb250ZW50ID0gYVNvdXJjZU1hcC5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudChzbWMuX3NvdXJjZXMudG9BcnJheSgpLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc21jLnNvdXJjZVJvb3QpOwoJICAgIHNtYy5maWxlID0gYVNvdXJjZU1hcC5fZmlsZTsKCSAgICBzbWMuX3NvdXJjZU1hcFVSTCA9IGFTb3VyY2VNYXBVUkw7CgkgICAgc21jLl9hYnNvbHV0ZVNvdXJjZXMgPSBzbWMuX3NvdXJjZXMudG9BcnJheSgpLm1hcChmdW5jdGlvbiAocykgewoJICAgICAgcmV0dXJuIHV0aWwuY29tcHV0ZVNvdXJjZVVSTChzbWMuc291cmNlUm9vdCwgcywgYVNvdXJjZU1hcFVSTCk7CgkgICAgfSk7CgoJICAgIC8vIEJlY2F1c2Ugd2UgYXJlIG1vZGlmeWluZyB0aGUgZW50cmllcyAoYnkgY29udmVydGluZyBzdHJpbmcgc291cmNlcyBhbmQKCSAgICAvLyBuYW1lcyB0byBpbmRpY2VzIGludG8gdGhlIHNvdXJjZXMgYW5kIG5hbWVzIEFycmF5U2V0cyksIHdlIGhhdmUgdG8gbWFrZQoJICAgIC8vIGEgY29weSBvZiB0aGUgZW50cnkgb3IgZWxzZSBiYWQgdGhpbmdzIGhhcHBlbi4gU2hhcmVkIG11dGFibGUgc3RhdGUKCSAgICAvLyBzdHJpa2VzIGFnYWluISBTZWUgZ2l0aHViIGlzc3VlICMxOTEuCgoJICAgIHZhciBnZW5lcmF0ZWRNYXBwaW5ncyA9IGFTb3VyY2VNYXAuX21hcHBpbmdzLnRvQXJyYXkoKS5zbGljZSgpOwoJICAgIHZhciBkZXN0R2VuZXJhdGVkTWFwcGluZ3MgPSBzbWMuX19nZW5lcmF0ZWRNYXBwaW5ncyA9IFtdOwoJICAgIHZhciBkZXN0T3JpZ2luYWxNYXBwaW5ncyA9IHNtYy5fX29yaWdpbmFsTWFwcGluZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdlbmVyYXRlZE1hcHBpbmdzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CgkgICAgICB2YXIgc3JjTWFwcGluZyA9IGdlbmVyYXRlZE1hcHBpbmdzW2ldOwoJICAgICAgdmFyIGRlc3RNYXBwaW5nID0gbmV3IE1hcHBpbmc7CgkgICAgICBkZXN0TWFwcGluZy5nZW5lcmF0ZWRMaW5lID0gc3JjTWFwcGluZy5nZW5lcmF0ZWRMaW5lOwoJICAgICAgZGVzdE1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uID0gc3JjTWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgoJICAgICAgaWYgKHNyY01hcHBpbmcuc291cmNlKSB7CgkgICAgICAgIGRlc3RNYXBwaW5nLnNvdXJjZSA9IHNvdXJjZXMuaW5kZXhPZihzcmNNYXBwaW5nLnNvdXJjZSk7CgkgICAgICAgIGRlc3RNYXBwaW5nLm9yaWdpbmFsTGluZSA9IHNyY01hcHBpbmcub3JpZ2luYWxMaW5lOwoJICAgICAgICBkZXN0TWFwcGluZy5vcmlnaW5hbENvbHVtbiA9IHNyY01hcHBpbmcub3JpZ2luYWxDb2x1bW47CgoJICAgICAgICBpZiAoc3JjTWFwcGluZy5uYW1lKSB7CgkgICAgICAgICAgZGVzdE1hcHBpbmcubmFtZSA9IG5hbWVzLmluZGV4T2Yoc3JjTWFwcGluZy5uYW1lKTsKCSAgICAgICAgfQoKCSAgICAgICAgZGVzdE9yaWdpbmFsTWFwcGluZ3MucHVzaChkZXN0TWFwcGluZyk7CgkgICAgICB9CgoJICAgICAgZGVzdEdlbmVyYXRlZE1hcHBpbmdzLnB1c2goZGVzdE1hcHBpbmcpOwoJICAgIH0KCgkgICAgcXVpY2tTb3J0KHNtYy5fX29yaWdpbmFsTWFwcGluZ3MsIHV0aWwuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMpOwoKCSAgICByZXR1cm4gc21jOwoJICB9OwoKCS8qKgoJICogVGhlIHZlcnNpb24gb2YgdGhlIHNvdXJjZSBtYXBwaW5nIHNwZWMgdGhhdCB3ZSBhcmUgY29uc3VtaW5nLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgoJLyoqCgkgKiBUaGUgbGlzdCBvZiBvcmlnaW5hbCBzb3VyY2VzLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUsICdzb3VyY2VzJywgewoJICBnZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICByZXR1cm4gdGhpcy5fYWJzb2x1dGVTb3VyY2VzLnNsaWNlKCk7CgkgIH0KCX0pOwoKCS8qKgoJICogUHJvdmlkZSB0aGUgSklUIHdpdGggYSBuaWNlIHNoYXBlIC8gaGlkZGVuIGNsYXNzLgoJICovCglmdW5jdGlvbiBNYXBwaW5nKCkgewoJICB0aGlzLmdlbmVyYXRlZExpbmUgPSAwOwoJICB0aGlzLmdlbmVyYXRlZENvbHVtbiA9IDA7CgkgIHRoaXMuc291cmNlID0gbnVsbDsKCSAgdGhpcy5vcmlnaW5hbExpbmUgPSBudWxsOwoJICB0aGlzLm9yaWdpbmFsQ29sdW1uID0gbnVsbDsKCSAgdGhpcy5uYW1lID0gbnVsbDsKCX0KCgkvKioKCSAqIFBhcnNlIHRoZSBtYXBwaW5ncyBpbiBhIHN0cmluZyBpbiB0byBhIGRhdGEgc3RydWN0dXJlIHdoaWNoIHdlIGNhbiBlYXNpbHkKCSAqIHF1ZXJ5ICh0aGUgb3JkZXJlZCBhcnJheXMgaW4gdGhlIGB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3NgIGFuZAoJICogYHRoaXMuX19vcmlnaW5hbE1hcHBpbmdzYCBwcm9wZXJ0aWVzKS4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX3BhcnNlTWFwcGluZ3MgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9wYXJzZU1hcHBpbmdzKGFTdHIsIGFTb3VyY2VSb290KSB7CgkgICAgdmFyIGdlbmVyYXRlZExpbmUgPSAxOwoJICAgIHZhciBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiA9IDA7CgkgICAgdmFyIHByZXZpb3VzT3JpZ2luYWxMaW5lID0gMDsKCSAgICB2YXIgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IDA7CgkgICAgdmFyIHByZXZpb3VzU291cmNlID0gMDsKCSAgICB2YXIgcHJldmlvdXNOYW1lID0gMDsKCSAgICB2YXIgbGVuZ3RoID0gYVN0ci5sZW5ndGg7CgkgICAgdmFyIGluZGV4ID0gMDsKCSAgICB2YXIgY2FjaGVkU2VnbWVudHMgPSB7fTsKCSAgICB2YXIgdGVtcCA9IHt9OwoJICAgIHZhciBvcmlnaW5hbE1hcHBpbmdzID0gW107CgkgICAgdmFyIGdlbmVyYXRlZE1hcHBpbmdzID0gW107CgkgICAgdmFyIG1hcHBpbmcsIHN0ciwgc2VnbWVudCwgZW5kLCB2YWx1ZTsKCgkgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7CgkgICAgICBpZiAoYVN0ci5jaGFyQXQoaW5kZXgpID09PSAnOycpIHsKCSAgICAgICAgZ2VuZXJhdGVkTGluZSsrOwoJICAgICAgICBpbmRleCsrOwoJICAgICAgICBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiA9IDA7CgkgICAgICB9CgkgICAgICBlbHNlIGlmIChhU3RyLmNoYXJBdChpbmRleCkgPT09ICcsJykgewoJICAgICAgICBpbmRleCsrOwoJICAgICAgfQoJICAgICAgZWxzZSB7CgkgICAgICAgIG1hcHBpbmcgPSBuZXcgTWFwcGluZygpOwoJICAgICAgICBtYXBwaW5nLmdlbmVyYXRlZExpbmUgPSBnZW5lcmF0ZWRMaW5lOwoKCSAgICAgICAgLy8gQmVjYXVzZSBlYWNoIG9mZnNldCBpcyBlbmNvZGVkIHJlbGF0aXZlIHRvIHRoZSBwcmV2aW91cyBvbmUsCgkgICAgICAgIC8vIG1hbnkgc2VnbWVudHMgb2Z0ZW4gaGF2ZSB0aGUgc2FtZSBlbmNvZGluZy4gV2UgY2FuIGV4cGxvaXQgdGhpcwoJICAgICAgICAvLyBmYWN0IGJ5IGNhY2hpbmcgdGhlIHBhcnNlZCB2YXJpYWJsZSBsZW5ndGggZmllbGRzIG9mIGVhY2ggc2VnbWVudCwKCSAgICAgICAgLy8gYWxsb3dpbmcgdXMgdG8gYXZvaWQgYSBzZWNvbmQgcGFyc2UgaWYgd2UgZW5jb3VudGVyIHRoZSBzYW1lCgkgICAgICAgIC8vIHNlZ21lbnQgYWdhaW4uCgkgICAgICAgIGZvciAoZW5kID0gaW5kZXg7IGVuZCA8IGxlbmd0aDsgZW5kKyspIHsKCSAgICAgICAgICBpZiAodGhpcy5fY2hhcklzTWFwcGluZ1NlcGFyYXRvcihhU3RyLCBlbmQpKSB7CgkgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgc3RyID0gYVN0ci5zbGljZShpbmRleCwgZW5kKTsKCgkgICAgICAgIHNlZ21lbnQgPSBjYWNoZWRTZWdtZW50c1tzdHJdOwoJICAgICAgICBpZiAoc2VnbWVudCkgewoJICAgICAgICAgIGluZGV4ICs9IHN0ci5sZW5ndGg7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgc2VnbWVudCA9IFtdOwoJICAgICAgICAgIHdoaWxlIChpbmRleCA8IGVuZCkgewoJICAgICAgICAgICAgYmFzZTY0VkxRLmRlY29kZShhU3RyLCBpbmRleCwgdGVtcCk7CgkgICAgICAgICAgICB2YWx1ZSA9IHRlbXAudmFsdWU7CgkgICAgICAgICAgICBpbmRleCA9IHRlbXAucmVzdDsKCSAgICAgICAgICAgIHNlZ21lbnQucHVzaCh2YWx1ZSk7CgkgICAgICAgICAgfQoKCSAgICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPT09IDIpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRm91bmQgYSBzb3VyY2UsIGJ1dCBubyBsaW5lIGFuZCBjb2x1bW4nKTsKCSAgICAgICAgICB9CgoJICAgICAgICAgIGlmIChzZWdtZW50Lmxlbmd0aCA9PT0gMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBhIHNvdXJjZSBhbmQgbGluZSwgYnV0IG5vIGNvbHVtbicpOwoJICAgICAgICAgIH0KCgkgICAgICAgICAgY2FjaGVkU2VnbWVudHNbc3RyXSA9IHNlZ21lbnQ7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIEdlbmVyYXRlZCBjb2x1bW4uCgkgICAgICAgIG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uID0gcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gKyBzZWdtZW50WzBdOwoJICAgICAgICBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiA9IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uOwoKCSAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID4gMSkgewoJICAgICAgICAgIC8vIE9yaWdpbmFsIHNvdXJjZS4KCSAgICAgICAgICBtYXBwaW5nLnNvdXJjZSA9IHByZXZpb3VzU291cmNlICsgc2VnbWVudFsxXTsKCSAgICAgICAgICBwcmV2aW91c1NvdXJjZSArPSBzZWdtZW50WzFdOwoKCSAgICAgICAgICAvLyBPcmlnaW5hbCBsaW5lLgoJICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxMaW5lID0gcHJldmlvdXNPcmlnaW5hbExpbmUgKyBzZWdtZW50WzJdOwoJICAgICAgICAgIHByZXZpb3VzT3JpZ2luYWxMaW5lID0gbWFwcGluZy5vcmlnaW5hbExpbmU7CgkgICAgICAgICAgLy8gTGluZXMgYXJlIHN0b3JlZCAwLWJhc2VkCgkgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbExpbmUgKz0gMTsKCgkgICAgICAgICAgLy8gT3JpZ2luYWwgY29sdW1uLgoJICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxDb2x1bW4gPSBwcmV2aW91c09yaWdpbmFsQ29sdW1uICsgc2VnbWVudFszXTsKCSAgICAgICAgICBwcmV2aW91c09yaWdpbmFsQ29sdW1uID0gbWFwcGluZy5vcmlnaW5hbENvbHVtbjsKCgkgICAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID4gNCkgewoJICAgICAgICAgICAgLy8gT3JpZ2luYWwgbmFtZS4KCSAgICAgICAgICAgIG1hcHBpbmcubmFtZSA9IHByZXZpb3VzTmFtZSArIHNlZ21lbnRbNF07CgkgICAgICAgICAgICBwcmV2aW91c05hbWUgKz0gc2VnbWVudFs0XTsKCSAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIGdlbmVyYXRlZE1hcHBpbmdzLnB1c2gobWFwcGluZyk7CgkgICAgICAgIGlmICh0eXBlb2YgbWFwcGluZy5vcmlnaW5hbExpbmUgPT09ICdudW1iZXInKSB7CgkgICAgICAgICAgb3JpZ2luYWxNYXBwaW5ncy5wdXNoKG1hcHBpbmcpOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfQoKCSAgICBxdWlja1NvcnQoZ2VuZXJhdGVkTWFwcGluZ3MsIHV0aWwuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQpOwoJICAgIHRoaXMuX19nZW5lcmF0ZWRNYXBwaW5ncyA9IGdlbmVyYXRlZE1hcHBpbmdzOwoKCSAgICBxdWlja1NvcnQob3JpZ2luYWxNYXBwaW5ncywgdXRpbC5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9ucyk7CgkgICAgdGhpcy5fX29yaWdpbmFsTWFwcGluZ3MgPSBvcmlnaW5hbE1hcHBpbmdzOwoJICB9OwoKCS8qKgoJICogRmluZCB0aGUgbWFwcGluZyB0aGF0IGJlc3QgbWF0Y2hlcyB0aGUgaHlwb3RoZXRpY2FsICJuZWVkbGUiIG1hcHBpbmcgdGhhdAoJICogd2UgYXJlIHNlYXJjaGluZyBmb3IgaW4gdGhlIGdpdmVuICJoYXlzdGFjayIgb2YgbWFwcGluZ3MuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9maW5kTWFwcGluZyA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2ZpbmRNYXBwaW5nKGFOZWVkbGUsIGFNYXBwaW5ncywgYUxpbmVOYW1lLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhQ29sdW1uTmFtZSwgYUNvbXBhcmF0b3IsIGFCaWFzKSB7CgkgICAgLy8gVG8gcmV0dXJuIHRoZSBwb3NpdGlvbiB3ZSBhcmUgc2VhcmNoaW5nIGZvciwgd2UgbXVzdCBmaXJzdCBmaW5kIHRoZQoJICAgIC8vIG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgdGhlbiByZXR1cm4gdGhlIG9wcG9zaXRlIHBvc2l0aW9uIGl0CgkgICAgLy8gcG9pbnRzIHRvLiBCZWNhdXNlIHRoZSBtYXBwaW5ncyBhcmUgc29ydGVkLCB3ZSBjYW4gdXNlIGJpbmFyeSBzZWFyY2ggdG8KCSAgICAvLyBmaW5kIHRoZSBiZXN0IG1hcHBpbmcuCgoJICAgIGlmIChhTmVlZGxlW2FMaW5lTmFtZV0gPD0gMCkgewoJICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTGluZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAxLCBnb3QgJwoJICAgICAgICAgICAgICAgICAgICAgICAgICArIGFOZWVkbGVbYUxpbmVOYW1lXSk7CgkgICAgfQoJICAgIGlmIChhTmVlZGxlW2FDb2x1bW5OYW1lXSA8IDApIHsKCSAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0NvbHVtbiBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwLCBnb3QgJwoJICAgICAgICAgICAgICAgICAgICAgICAgICArIGFOZWVkbGVbYUNvbHVtbk5hbWVdKTsKCSAgICB9CgoJICAgIHJldHVybiBiaW5hcnlTZWFyY2guc2VhcmNoKGFOZWVkbGUsIGFNYXBwaW5ncywgYUNvbXBhcmF0b3IsIGFCaWFzKTsKCSAgfTsKCgkvKioKCSAqIENvbXB1dGUgdGhlIGxhc3QgY29sdW1uIGZvciBlYWNoIGdlbmVyYXRlZCBtYXBwaW5nLiBUaGUgbGFzdCBjb2x1bW4gaXMKCSAqIGluY2x1c2l2ZS4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuY29tcHV0ZUNvbHVtblNwYW5zID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfY29tcHV0ZUNvbHVtblNwYW5zKCkgewoJICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5ncy5sZW5ndGg7ICsraW5kZXgpIHsKCSAgICAgIHZhciBtYXBwaW5nID0gdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3NbaW5kZXhdOwoKCSAgICAgIC8vIE1hcHBpbmdzIGRvIG5vdCBjb250YWluIGEgZmllbGQgZm9yIHRoZSBsYXN0IGdlbmVyYXRlZCBjb2x1bW50LiBXZQoJICAgICAgLy8gY2FuIGNvbWUgdXAgd2l0aCBhbiBvcHRpbWlzdGljIGVzdGltYXRlLCBob3dldmVyLCBieSBhc3N1bWluZyB0aGF0CgkgICAgICAvLyBtYXBwaW5ncyBhcmUgY29udGlndW91cyAoaS5lLiBnaXZlbiB0d28gY29uc2VjdXRpdmUgbWFwcGluZ3MsIHRoZQoJICAgICAgLy8gZmlyc3QgbWFwcGluZyBlbmRzIHdoZXJlIHRoZSBzZWNvbmQgb25lIHN0YXJ0cykuCgkgICAgICBpZiAoaW5kZXggKyAxIDwgdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3MubGVuZ3RoKSB7CgkgICAgICAgIHZhciBuZXh0TWFwcGluZyA9IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzW2luZGV4ICsgMV07CgoJICAgICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lID09PSBuZXh0TWFwcGluZy5nZW5lcmF0ZWRMaW5lKSB7CgkgICAgICAgICAgbWFwcGluZy5sYXN0R2VuZXJhdGVkQ29sdW1uID0gbmV4dE1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uIC0gMTsKCSAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIC8vIFRoZSBsYXN0IG1hcHBpbmcgZm9yIGVhY2ggbGluZSBzcGFucyB0aGUgZW50aXJlIGxpbmUuCgkgICAgICBtYXBwaW5nLmxhc3RHZW5lcmF0ZWRDb2x1bW4gPSBJbmZpbml0eTsKCSAgICB9CgkgIH07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBvcmlnaW5hbCBzb3VyY2UsIGxpbmUsIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBnZW5lcmF0ZWQKCSAqIHNvdXJjZSdzIGxpbmUgYW5kIGNvbHVtbiBwb3NpdGlvbnMgcHJvdmlkZWQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIGFuIG9iamVjdAoJICogd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4gIFRoZSBsaW5lIG51bWJlcgoJICogICAgIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4gIFRoZSBjb2x1bW4KCSAqICAgICBudW1iZXIgaXMgMC1iYXNlZC4KCSAqICAgLSBiaWFzOiBFaXRoZXIgJ1NvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EJyBvcgoJICogICAgICdTb3VyY2VNYXBDb25zdW1lci5MRUFTVF9VUFBFUl9CT1VORCcuIFNwZWNpZmllcyB3aGV0aGVyIHRvIHJldHVybiB0aGUKCSAqICAgICBjbG9zZXN0IGVsZW1lbnQgdGhhdCBpcyBzbWFsbGVyIHRoYW4gb3IgZ3JlYXRlciB0aGFuIHRoZSBvbmUgd2UgYXJlCgkgKiAgICAgc2VhcmNoaW5nIGZvciwgcmVzcGVjdGl2ZWx5LCBpZiB0aGUgZXhhY3QgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQuCgkgKiAgICAgRGVmYXVsdHMgdG8gJ1NvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EJy4KCSAqCgkgKiBhbmQgYW4gb2JqZWN0IGlzIHJldHVybmVkIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBzb3VyY2U6IFRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZSwgb3IgbnVsbC4KCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLCBvciBudWxsLiAgVGhlCgkgKiAgICAgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLgoJICogICAtIG5hbWU6IFRoZSBvcmlnaW5hbCBpZGVudGlmaWVyLCBvciBudWxsLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5vcmlnaW5hbFBvc2l0aW9uRm9yID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfb3JpZ2luYWxQb3NpdGlvbkZvcihhQXJncykgewoJICAgIHZhciBuZWVkbGUgPSB7CgkgICAgICBnZW5lcmF0ZWRMaW5lOiB1dGlsLmdldEFyZyhhQXJncywgJ2xpbmUnKSwKCSAgICAgIGdlbmVyYXRlZENvbHVtbjogdXRpbC5nZXRBcmcoYUFyZ3MsICdjb2x1bW4nKQoJICAgIH07CgoJICAgIHZhciBpbmRleCA9IHRoaXMuX2ZpbmRNYXBwaW5nKAoJICAgICAgbmVlZGxlLAoJICAgICAgdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3MsCgkgICAgICAiZ2VuZXJhdGVkTGluZSIsCgkgICAgICAiZ2VuZXJhdGVkQ29sdW1uIiwKCSAgICAgIHV0aWwuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQsCgkgICAgICB1dGlsLmdldEFyZyhhQXJncywgJ2JpYXMnLCBTb3VyY2VNYXBDb25zdW1lci5HUkVBVEVTVF9MT1dFUl9CT1VORCkKCSAgICApOwoKCSAgICBpZiAoaW5kZXggPj0gMCkgewoJICAgICAgdmFyIG1hcHBpbmcgPSB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5nc1tpbmRleF07CgoJICAgICAgaWYgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSA9PT0gbmVlZGxlLmdlbmVyYXRlZExpbmUpIHsKCSAgICAgICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdzb3VyY2UnLCBudWxsKTsKCSAgICAgICAgaWYgKHNvdXJjZSAhPT0gbnVsbCkgewoJICAgICAgICAgIHNvdXJjZSA9IHRoaXMuX3NvdXJjZXMuYXQoc291cmNlKTsKCSAgICAgICAgICBzb3VyY2UgPSB1dGlsLmNvbXB1dGVTb3VyY2VVUkwodGhpcy5zb3VyY2VSb290LCBzb3VyY2UsIHRoaXMuX3NvdXJjZU1hcFVSTCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG5hbWUgPSB1dGlsLmdldEFyZyhtYXBwaW5nLCAnbmFtZScsIG51bGwpOwoJICAgICAgICBpZiAobmFtZSAhPT0gbnVsbCkgewoJICAgICAgICAgIG5hbWUgPSB0aGlzLl9uYW1lcy5hdChuYW1lKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gewoJICAgICAgICAgIHNvdXJjZTogc291cmNlLAoJICAgICAgICAgIGxpbmU6IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdvcmlnaW5hbExpbmUnLCBudWxsKSwKCSAgICAgICAgICBjb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdvcmlnaW5hbENvbHVtbicsIG51bGwpLAoJICAgICAgICAgIG5hbWU6IG5hbWUKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiB7CgkgICAgICBzb3VyY2U6IG51bGwsCgkgICAgICBsaW5lOiBudWxsLAoJICAgICAgY29sdW1uOiBudWxsLAoJICAgICAgbmFtZTogbnVsbAoJICAgIH07CgkgIH07CgoJLyoqCgkgKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBoYXZlIHRoZSBzb3VyY2UgY29udGVudCBmb3IgZXZlcnkgc291cmNlIGluIHRoZSBzb3VyY2UKCSAqIG1hcCwgZmFsc2Ugb3RoZXJ3aXNlLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5oYXNDb250ZW50c09mQWxsU291cmNlcyA9CgkgIGZ1bmN0aW9uIEJhc2ljU291cmNlTWFwQ29uc3VtZXJfaGFzQ29udGVudHNPZkFsbFNvdXJjZXMoKSB7CgkgICAgaWYgKCF0aGlzLnNvdXJjZXNDb250ZW50KSB7CgkgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfQoJICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50Lmxlbmd0aCA+PSB0aGlzLl9zb3VyY2VzLnNpemUoKSAmJgoJICAgICAgIXRoaXMuc291cmNlc0NvbnRlbnQuc29tZShmdW5jdGlvbiAoc2MpIHsgcmV0dXJuIHNjID09IG51bGw7IH0pOwoJICB9OwoKCS8qKgoJICogUmV0dXJucyB0aGUgb3JpZ2luYWwgc291cmNlIGNvbnRlbnQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIHRoZSB1cmwgb2YgdGhlCgkgKiBvcmlnaW5hbCBzb3VyY2UgZmlsZS4gUmV0dXJucyBudWxsIGlmIG5vIG9yaWdpbmFsIHNvdXJjZSBjb250ZW50IGlzCgkgKiBhdmFpbGFibGUuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLnNvdXJjZUNvbnRlbnRGb3IgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9zb3VyY2VDb250ZW50Rm9yKGFTb3VyY2UsIG51bGxPbk1pc3NpbmcpIHsKCSAgICBpZiAoIXRoaXMuc291cmNlc0NvbnRlbnQpIHsKCSAgICAgIHJldHVybiBudWxsOwoJICAgIH0KCgkgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZFNvdXJjZUluZGV4KGFTb3VyY2UpOwoJICAgIGlmIChpbmRleCA+PSAwKSB7CgkgICAgICByZXR1cm4gdGhpcy5zb3VyY2VzQ29udGVudFtpbmRleF07CgkgICAgfQoKCSAgICB2YXIgcmVsYXRpdmVTb3VyY2UgPSBhU291cmNlOwoJICAgIGlmICh0aGlzLnNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgcmVsYXRpdmVTb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHRoaXMuc291cmNlUm9vdCwgcmVsYXRpdmVTb3VyY2UpOwoJICAgIH0KCgkgICAgdmFyIHVybDsKCSAgICBpZiAodGhpcy5zb3VyY2VSb290ICE9IG51bGwKCSAgICAgICAgJiYgKHVybCA9IHV0aWwudXJsUGFyc2UodGhpcy5zb3VyY2VSb290KSkpIHsKCSAgICAgIC8vIFhYWDogZmlsZTovLyBVUklzIGFuZCBhYnNvbHV0ZSBwYXRocyBsZWFkIHRvIHVuZXhwZWN0ZWQgYmVoYXZpb3IgZm9yCgkgICAgICAvLyBtYW55IHVzZXJzLiBXZSBjYW4gaGVscCB0aGVtIG91dCB3aGVuIHRoZXkgZXhwZWN0IGZpbGU6Ly8gVVJJcyB0bwoJICAgICAgLy8gYmVoYXZlIGxpa2UgaXQgd291bGQgaWYgdGhleSB3ZXJlIHJ1bm5pbmcgYSBsb2NhbCBIVFRQIHNlcnZlci4gU2VlCgkgICAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD04ODU1OTcuCgkgICAgICB2YXIgZmlsZVVyaUFic1BhdGggPSByZWxhdGl2ZVNvdXJjZS5yZXBsYWNlKC9eZmlsZTpcL1wvLywgIiIpOwoJICAgICAgaWYgKHVybC5zY2hlbWUgPT0gImZpbGUiCgkgICAgICAgICAgJiYgdGhpcy5fc291cmNlcy5oYXMoZmlsZVVyaUFic1BhdGgpKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50W3RoaXMuX3NvdXJjZXMuaW5kZXhPZihmaWxlVXJpQWJzUGF0aCldCgkgICAgICB9CgoJICAgICAgaWYgKCghdXJsLnBhdGggfHwgdXJsLnBhdGggPT0gIi8iKQoJICAgICAgICAgICYmIHRoaXMuX3NvdXJjZXMuaGFzKCIvIiArIHJlbGF0aXZlU291cmNlKSkgewoJICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VzQ29udGVudFt0aGlzLl9zb3VyY2VzLmluZGV4T2YoIi8iICsgcmVsYXRpdmVTb3VyY2UpXTsKCSAgICAgIH0KCSAgICB9CgoJICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCByZWN1cnNpdmVseSBmcm9tCgkgICAgLy8gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5zb3VyY2VDb250ZW50Rm9yLiBJbiB0aGF0IGNhc2UsIHdlCgkgICAgLy8gZG9uJ3Qgd2FudCB0byB0aHJvdyBpZiB3ZSBjYW4ndCBmaW5kIHRoZSBzb3VyY2UgLSB3ZSBqdXN0IHdhbnQgdG8KCSAgICAvLyByZXR1cm4gbnVsbCwgc28gd2UgcHJvdmlkZSBhIGZsYWcgdG8gZXhpdCBncmFjZWZ1bGx5LgoJICAgIGlmIChudWxsT25NaXNzaW5nKSB7CgkgICAgICByZXR1cm4gbnVsbDsKCSAgICB9CgkgICAgZWxzZSB7CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoJyInICsgcmVsYXRpdmVTb3VyY2UgKyAnIiBpcyBub3QgaW4gdGhlIFNvdXJjZU1hcC4nKTsKCSAgICB9CgkgIH07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBnZW5lcmF0ZWQgbGluZSBhbmQgY29sdW1uIGluZm9ybWF0aW9uIGZvciB0aGUgb3JpZ2luYWwgc291cmNlLAoJICogbGluZSwgYW5kIGNvbHVtbiBwb3NpdGlvbnMgcHJvdmlkZWQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIGFuIG9iamVjdCB3aXRoCgkgKiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIHNvdXJjZTogVGhlIGZpbGVuYW1lIG9mIHRoZSBvcmlnaW5hbCBzb3VyY2UuCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UuICBUaGUgbGluZSBudW1iZXIKCSAqICAgICBpcyAxLWJhc2VkLgoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZS4gIFRoZSBjb2x1bW4KCSAqICAgICBudW1iZXIgaXMgMC1iYXNlZC4KCSAqICAgLSBiaWFzOiBFaXRoZXIgJ1NvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EJyBvcgoJICogICAgICdTb3VyY2VNYXBDb25zdW1lci5MRUFTVF9VUFBFUl9CT1VORCcuIFNwZWNpZmllcyB3aGV0aGVyIHRvIHJldHVybiB0aGUKCSAqICAgICBjbG9zZXN0IGVsZW1lbnQgdGhhdCBpcyBzbWFsbGVyIHRoYW4gb3IgZ3JlYXRlciB0aGFuIHRoZSBvbmUgd2UgYXJlCgkgKiAgICAgc2VhcmNoaW5nIGZvciwgcmVzcGVjdGl2ZWx5LCBpZiB0aGUgZXhhY3QgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQuCgkgKiAgICAgRGVmYXVsdHMgdG8gJ1NvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EJy4KCSAqCgkgKiBhbmQgYW4gb2JqZWN0IGlzIHJldHVybmVkIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UsIG9yIG51bGwuICBUaGUKCSAqICAgICBsaW5lIG51bWJlciBpcyAxLWJhc2VkLgoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UsIG9yIG51bGwuCgkgKiAgICAgVGhlIGNvbHVtbiBudW1iZXIgaXMgMC1iYXNlZC4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuZ2VuZXJhdGVkUG9zaXRpb25Gb3IgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9nZW5lcmF0ZWRQb3NpdGlvbkZvcihhQXJncykgewoJICAgIHZhciBzb3VyY2UgPSB1dGlsLmdldEFyZyhhQXJncywgJ3NvdXJjZScpOwoJICAgIHNvdXJjZSA9IHRoaXMuX2ZpbmRTb3VyY2VJbmRleChzb3VyY2UpOwoJICAgIGlmIChzb3VyY2UgPCAwKSB7CgkgICAgICByZXR1cm4gewoJICAgICAgICBsaW5lOiBudWxsLAoJICAgICAgICBjb2x1bW46IG51bGwsCgkgICAgICAgIGxhc3RDb2x1bW46IG51bGwKCSAgICAgIH07CgkgICAgfQoKCSAgICB2YXIgbmVlZGxlID0gewoJICAgICAgc291cmNlOiBzb3VyY2UsCgkgICAgICBvcmlnaW5hbExpbmU6IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbGluZScpLAoJICAgICAgb3JpZ2luYWxDb2x1bW46IHV0aWwuZ2V0QXJnKGFBcmdzLCAnY29sdW1uJykKCSAgICB9OwoKCSAgICB2YXIgaW5kZXggPSB0aGlzLl9maW5kTWFwcGluZygKCSAgICAgIG5lZWRsZSwKCSAgICAgIHRoaXMuX29yaWdpbmFsTWFwcGluZ3MsCgkgICAgICAib3JpZ2luYWxMaW5lIiwKCSAgICAgICJvcmlnaW5hbENvbHVtbiIsCgkgICAgICB1dGlsLmNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zLAoJICAgICAgdXRpbC5nZXRBcmcoYUFyZ3MsICdiaWFzJywgU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQpCgkgICAgKTsKCgkgICAgaWYgKGluZGV4ID49IDApIHsKCSAgICAgIHZhciBtYXBwaW5nID0gdGhpcy5fb3JpZ2luYWxNYXBwaW5nc1tpbmRleF07CgoJICAgICAgaWYgKG1hcHBpbmcuc291cmNlID09PSBuZWVkbGUuc291cmNlKSB7CgkgICAgICAgIHJldHVybiB7CgkgICAgICAgICAgbGluZTogdXRpbC5nZXRBcmcobWFwcGluZywgJ2dlbmVyYXRlZExpbmUnLCBudWxsKSwKCSAgICAgICAgICBjb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdnZW5lcmF0ZWRDb2x1bW4nLCBudWxsKSwKCSAgICAgICAgICBsYXN0Q29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnbGFzdEdlbmVyYXRlZENvbHVtbicsIG51bGwpCgkgICAgICAgIH07CgkgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gewoJICAgICAgbGluZTogbnVsbCwKCSAgICAgIGNvbHVtbjogbnVsbCwKCSAgICAgIGxhc3RDb2x1bW46IG51bGwKCSAgICB9OwoJICB9OwoKCXNvdXJjZU1hcENvbnN1bWVyLkJhc2ljU291cmNlTWFwQ29uc3VtZXIgPSBCYXNpY1NvdXJjZU1hcENvbnN1bWVyOwoKCS8qKgoJICogQW4gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyIGluc3RhbmNlIHJlcHJlc2VudHMgYSBwYXJzZWQgc291cmNlIG1hcCB3aGljaAoJICogd2UgY2FuIHF1ZXJ5IGZvciBpbmZvcm1hdGlvbi4gSXQgZGlmZmVycyBmcm9tIEJhc2ljU291cmNlTWFwQ29uc3VtZXIgaW4KCSAqIHRoYXQgaXQgdGFrZXMgImluZGV4ZWQiIHNvdXJjZSBtYXBzIChpLmUuIG9uZXMgd2l0aCBhICJzZWN0aW9ucyIgZmllbGQpIGFzCgkgKiBpbnB1dC4KCSAqCgkgKiBUaGUgZmlyc3QgcGFyYW1ldGVyIGlzIGEgcmF3IHNvdXJjZSBtYXAgKGVpdGhlciBhcyBhIEpTT04gc3RyaW5nLCBvciBhbHJlYWR5CgkgKiBwYXJzZWQgdG8gYW4gb2JqZWN0KS4gQWNjb3JkaW5nIHRvIHRoZSBzcGVjIGZvciBpbmRleGVkIHNvdXJjZSBtYXBzLCB0aGV5CgkgKiBoYXZlIHRoZSBmb2xsb3dpbmcgYXR0cmlidXRlczoKCSAqCgkgKiAgIC0gdmVyc2lvbjogV2hpY2ggdmVyc2lvbiBvZiB0aGUgc291cmNlIG1hcCBzcGVjIHRoaXMgbWFwIGlzIGZvbGxvd2luZy4KCSAqICAgLSBmaWxlOiBPcHRpb25hbC4gVGhlIGdlbmVyYXRlZCBmaWxlIHRoaXMgc291cmNlIG1hcCBpcyBhc3NvY2lhdGVkIHdpdGguCgkgKiAgIC0gc2VjdGlvbnM6IEEgbGlzdCBvZiBzZWN0aW9uIGRlZmluaXRpb25zLgoJICoKCSAqIEVhY2ggdmFsdWUgdW5kZXIgdGhlICJzZWN0aW9ucyIgZmllbGQgaGFzIHR3byBmaWVsZHM6CgkgKiAgIC0gb2Zmc2V0OiBUaGUgb2Zmc2V0IGludG8gdGhlIG9yaWdpbmFsIHNwZWNpZmllZCBhdCB3aGljaCB0aGlzIHNlY3Rpb24KCSAqICAgICAgIGJlZ2lucyB0byBhcHBseSwgZGVmaW5lZCBhcyBhbiBvYmplY3Qgd2l0aCBhICJsaW5lIiBhbmQgImNvbHVtbiIKCSAqICAgICAgIGZpZWxkLgoJICogICAtIG1hcDogQSBzb3VyY2UgbWFwIGRlZmluaXRpb24uIFRoaXMgc291cmNlIG1hcCBjb3VsZCBhbHNvIGJlIGluZGV4ZWQsCgkgKiAgICAgICBidXQgZG9lc24ndCBoYXZlIHRvIGJlLgoJICoKCSAqIEluc3RlYWQgb2YgdGhlICJtYXAiIGZpZWxkLCBpdCdzIGFsc28gcG9zc2libGUgdG8gaGF2ZSBhICJ1cmwiIGZpZWxkCgkgKiBzcGVjaWZ5aW5nIGEgVVJMIHRvIHJldHJpZXZlIGEgc291cmNlIG1hcCBmcm9tLCBidXQgdGhhdCdzIGN1cnJlbnRseQoJICogdW5zdXBwb3J0ZWQuCgkgKgoJICogSGVyZSdzIGFuIGV4YW1wbGUgc291cmNlIG1hcCwgdGFrZW4gZnJvbSB0aGUgc291cmNlIG1hcCBzcGVjWzBdLCBidXQKCSAqIG1vZGlmaWVkIHRvIG9taXQgYSBzZWN0aW9uIHdoaWNoIHVzZXMgdGhlICJ1cmwiIGZpZWxkLgoJICoKCSAqICB7CgkgKiAgICB2ZXJzaW9uIDogMywKCSAqICAgIGZpbGU6ICJhcHAuanMiLAoJICogICAgc2VjdGlvbnM6IFt7CgkgKiAgICAgIG9mZnNldDoge2xpbmU6MTAwLCBjb2x1bW46MTB9LAoJICogICAgICBtYXA6IHsKCSAqICAgICAgICB2ZXJzaW9uIDogMywKCSAqICAgICAgICBmaWxlOiAic2VjdGlvbi5qcyIsCgkgKiAgICAgICAgc291cmNlczogWyJmb28uanMiLCAiYmFyLmpzIl0sCgkgKiAgICAgICAgbmFtZXM6IFsic3JjIiwgIm1hcHMiLCAiYXJlIiwgImZ1biJdLAoJICogICAgICAgIG1hcHBpbmdzOiAiQUFBQSxFOztBQkNERTsiCgkgKiAgICAgIH0KCSAqICAgIH1dLAoJICogIH0KCSAqCgkgKiBUaGUgc2Vjb25kIHBhcmFtZXRlciwgaWYgZ2l2ZW4sIGlzIGEgc3RyaW5nIHdob3NlIHZhbHVlIGlzIHRoZSBVUkwKCSAqIGF0IHdoaWNoIHRoZSBzb3VyY2UgbWFwIHdhcyBmb3VuZC4gIFRoaXMgVVJMIGlzIHVzZWQgdG8gY29tcHV0ZSB0aGUKCSAqIHNvdXJjZXMgYXJyYXkuCgkgKgoJICogWzBdOiBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFVMVJHQWVoUXdSeXBVVG92RjFLUmxwaU9GemUwYi1fMmdjNmZBSDBLWTBrL2VkaXQjaGVhZGluZz1oLjUzNWVzM3hlcHJndAoJICovCglmdW5jdGlvbiBJbmRleGVkU291cmNlTWFwQ29uc3VtZXIoYVNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkgewoJICB2YXIgc291cmNlTWFwID0gYVNvdXJjZU1hcDsKCSAgaWYgKHR5cGVvZiBhU291cmNlTWFwID09PSAnc3RyaW5nJykgewoJICAgIHNvdXJjZU1hcCA9IHV0aWwucGFyc2VTb3VyY2VNYXBJbnB1dChhU291cmNlTWFwKTsKCSAgfQoKCSAgdmFyIHZlcnNpb24gPSB1dGlsLmdldEFyZyhzb3VyY2VNYXAsICd2ZXJzaW9uJyk7CgkgIHZhciBzZWN0aW9ucyA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ3NlY3Rpb25zJyk7CgoJICBpZiAodmVyc2lvbiAhPSB0aGlzLl92ZXJzaW9uKSB7CgkgICAgdGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCB2ZXJzaW9uOiAnICsgdmVyc2lvbik7CgkgIH0KCgkgIHRoaXMuX3NvdXJjZXMgPSBuZXcgQXJyYXlTZXQoKTsKCSAgdGhpcy5fbmFtZXMgPSBuZXcgQXJyYXlTZXQoKTsKCgkgIHZhciBsYXN0T2Zmc2V0ID0gewoJICAgIGxpbmU6IC0xLAoJICAgIGNvbHVtbjogMAoJICB9OwoJICB0aGlzLl9zZWN0aW9ucyA9IHNlY3Rpb25zLm1hcChmdW5jdGlvbiAocykgewoJICAgIGlmIChzLnVybCkgewoJICAgICAgLy8gVGhlIHVybCBmaWVsZCB3aWxsIHJlcXVpcmUgc3VwcG9ydCBmb3IgYXN5bmNocm9uaWNpdHkuCgkgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9pc3N1ZXMvMTYKCSAgICAgIHRocm93IG5ldyBFcnJvcignU3VwcG9ydCBmb3IgdXJsIGZpZWxkIGluIHNlY3Rpb25zIG5vdCBpbXBsZW1lbnRlZC4nKTsKCSAgICB9CgkgICAgdmFyIG9mZnNldCA9IHV0aWwuZ2V0QXJnKHMsICdvZmZzZXQnKTsKCSAgICB2YXIgb2Zmc2V0TGluZSA9IHV0aWwuZ2V0QXJnKG9mZnNldCwgJ2xpbmUnKTsKCSAgICB2YXIgb2Zmc2V0Q29sdW1uID0gdXRpbC5nZXRBcmcob2Zmc2V0LCAnY29sdW1uJyk7CgoJICAgIGlmIChvZmZzZXRMaW5lIDwgbGFzdE9mZnNldC5saW5lIHx8CgkgICAgICAgIChvZmZzZXRMaW5lID09PSBsYXN0T2Zmc2V0LmxpbmUgJiYgb2Zmc2V0Q29sdW1uIDwgbGFzdE9mZnNldC5jb2x1bW4pKSB7CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlY3Rpb24gb2Zmc2V0cyBtdXN0IGJlIG9yZGVyZWQgYW5kIG5vbi1vdmVybGFwcGluZy4nKTsKCSAgICB9CgkgICAgbGFzdE9mZnNldCA9IG9mZnNldDsKCgkgICAgcmV0dXJuIHsKCSAgICAgIGdlbmVyYXRlZE9mZnNldDogewoJICAgICAgICAvLyBUaGUgb2Zmc2V0IGZpZWxkcyBhcmUgMC1iYXNlZCwgYnV0IHdlIHVzZSAxLWJhc2VkIGluZGljZXMgd2hlbgoJICAgICAgICAvLyBlbmNvZGluZy9kZWNvZGluZyBmcm9tIFZMUS4KCSAgICAgICAgZ2VuZXJhdGVkTGluZTogb2Zmc2V0TGluZSArIDEsCgkgICAgICAgIGdlbmVyYXRlZENvbHVtbjogb2Zmc2V0Q29sdW1uICsgMQoJICAgICAgfSwKCSAgICAgIGNvbnN1bWVyOiBuZXcgU291cmNlTWFwQ29uc3VtZXIodXRpbC5nZXRBcmcocywgJ21hcCcpLCBhU291cmNlTWFwVVJMKQoJICAgIH0KCSAgfSk7Cgl9CgoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlKTsKCUluZGV4ZWRTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTb3VyY2VNYXBDb25zdW1lcjsKCgkvKioKCSAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBzb3VyY2UgbWFwcGluZyBzcGVjIHRoYXQgd2UgYXJlIGNvbnN1bWluZy4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgoJLyoqCgkgKiBUaGUgbGlzdCBvZiBvcmlnaW5hbCBzb3VyY2VzLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSwgJ3NvdXJjZXMnLCB7CgkgIGdldDogZnVuY3Rpb24gKCkgewoJICAgIHZhciBzb3VyY2VzID0gW107CgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykgewoJICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLl9zZWN0aW9uc1tpXS5jb25zdW1lci5zb3VyY2VzLmxlbmd0aDsgaisrKSB7CgkgICAgICAgIHNvdXJjZXMucHVzaCh0aGlzLl9zZWN0aW9uc1tpXS5jb25zdW1lci5zb3VyY2VzW2pdKTsKCSAgICAgIH0KCSAgICB9CgkgICAgcmV0dXJuIHNvdXJjZXM7CgkgIH0KCX0pOwoKCS8qKgoJICogUmV0dXJucyB0aGUgb3JpZ2luYWwgc291cmNlLCBsaW5lLCBhbmQgY29sdW1uIGluZm9ybWF0aW9uIGZvciB0aGUgZ2VuZXJhdGVkCgkgKiBzb3VyY2UncyBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zIHByb3ZpZGVkLiBUaGUgb25seSBhcmd1bWVudCBpcyBhbiBvYmplY3QKCSAqIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UuICBUaGUgbGluZSBudW1iZXIKCSAqICAgICBpcyAxLWJhc2VkLgoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UuICBUaGUgY29sdW1uCgkgKiAgICAgbnVtYmVyIGlzIDAtYmFzZWQuCgkgKgoJICogYW5kIGFuIG9iamVjdCBpcyByZXR1cm5lZCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gc291cmNlOiBUaGUgb3JpZ2luYWwgc291cmNlIGZpbGUsIG9yIG51bGwuCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UsIG9yIG51bGwuICBUaGUKCSAqICAgICBsaW5lIG51bWJlciBpcyAxLWJhc2VkLgoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgIGNvbHVtbiBudW1iZXIgaXMgMC1iYXNlZC4KCSAqICAgLSBuYW1lOiBUaGUgb3JpZ2luYWwgaWRlbnRpZmllciwgb3IgbnVsbC4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5vcmlnaW5hbFBvc2l0aW9uRm9yID0KCSAgZnVuY3Rpb24gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyX29yaWdpbmFsUG9zaXRpb25Gb3IoYUFyZ3MpIHsKCSAgICB2YXIgbmVlZGxlID0gewoJICAgICAgZ2VuZXJhdGVkTGluZTogdXRpbC5nZXRBcmcoYUFyZ3MsICdsaW5lJyksCgkgICAgICBnZW5lcmF0ZWRDb2x1bW46IHV0aWwuZ2V0QXJnKGFBcmdzLCAnY29sdW1uJykKCSAgICB9OwoKCSAgICAvLyBGaW5kIHRoZSBzZWN0aW9uIGNvbnRhaW5pbmcgdGhlIGdlbmVyYXRlZCBwb3NpdGlvbiB3ZSdyZSB0cnlpbmcgdG8gbWFwCgkgICAgLy8gdG8gYW4gb3JpZ2luYWwgcG9zaXRpb24uCgkgICAgdmFyIHNlY3Rpb25JbmRleCA9IGJpbmFyeVNlYXJjaC5zZWFyY2gobmVlZGxlLCB0aGlzLl9zZWN0aW9ucywKCSAgICAgIGZ1bmN0aW9uKG5lZWRsZSwgc2VjdGlvbikgewoJICAgICAgICB2YXIgY21wID0gbmVlZGxlLmdlbmVyYXRlZExpbmUgLSBzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lOwoJICAgICAgICBpZiAoY21wKSB7CgkgICAgICAgICAgcmV0dXJuIGNtcDsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIChuZWVkbGUuZ2VuZXJhdGVkQ29sdW1uIC0KCSAgICAgICAgICAgICAgICBzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRDb2x1bW4pOwoJICAgICAgfSk7CgkgICAgdmFyIHNlY3Rpb24gPSB0aGlzLl9zZWN0aW9uc1tzZWN0aW9uSW5kZXhdOwoKCSAgICBpZiAoIXNlY3Rpb24pIHsKCSAgICAgIHJldHVybiB7CgkgICAgICAgIHNvdXJjZTogbnVsbCwKCSAgICAgICAgbGluZTogbnVsbCwKCSAgICAgICAgY29sdW1uOiBudWxsLAoJICAgICAgICBuYW1lOiBudWxsCgkgICAgICB9OwoJICAgIH0KCgkgICAgcmV0dXJuIHNlY3Rpb24uY29uc3VtZXIub3JpZ2luYWxQb3NpdGlvbkZvcih7CgkgICAgICBsaW5lOiBuZWVkbGUuZ2VuZXJhdGVkTGluZSAtCgkgICAgICAgIChzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lIC0gMSksCgkgICAgICBjb2x1bW46IG5lZWRsZS5nZW5lcmF0ZWRDb2x1bW4gLQoJICAgICAgICAoc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkTGluZSA9PT0gbmVlZGxlLmdlbmVyYXRlZExpbmUKCSAgICAgICAgID8gc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkQ29sdW1uIC0gMQoJICAgICAgICAgOiAwKSwKCSAgICAgIGJpYXM6IGFBcmdzLmJpYXMKCSAgICB9KTsKCSAgfTsKCgkvKioKCSAqIFJldHVybiB0cnVlIGlmIHdlIGhhdmUgdGhlIHNvdXJjZSBjb250ZW50IGZvciBldmVyeSBzb3VyY2UgaW4gdGhlIHNvdXJjZQoJICogbWFwLCBmYWxzZSBvdGhlcndpc2UuCgkgKi8KCUluZGV4ZWRTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuaGFzQ29udGVudHNPZkFsbFNvdXJjZXMgPQoJICBmdW5jdGlvbiBJbmRleGVkU291cmNlTWFwQ29uc3VtZXJfaGFzQ29udGVudHNPZkFsbFNvdXJjZXMoKSB7CgkgICAgcmV0dXJuIHRoaXMuX3NlY3Rpb25zLmV2ZXJ5KGZ1bmN0aW9uIChzKSB7CgkgICAgICByZXR1cm4gcy5jb25zdW1lci5oYXNDb250ZW50c09mQWxsU291cmNlcygpOwoJICAgIH0pOwoJICB9OwoKCS8qKgoJICogUmV0dXJucyB0aGUgb3JpZ2luYWwgc291cmNlIGNvbnRlbnQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIHRoZSB1cmwgb2YgdGhlCgkgKiBvcmlnaW5hbCBzb3VyY2UgZmlsZS4gUmV0dXJucyBudWxsIGlmIG5vIG9yaWdpbmFsIHNvdXJjZSBjb250ZW50IGlzCgkgKiBhdmFpbGFibGUuCgkgKi8KCUluZGV4ZWRTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuc291cmNlQ29udGVudEZvciA9CgkgIGZ1bmN0aW9uIEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcl9zb3VyY2VDb250ZW50Rm9yKGFTb3VyY2UsIG51bGxPbk1pc3NpbmcpIHsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7CgkgICAgICB2YXIgc2VjdGlvbiA9IHRoaXMuX3NlY3Rpb25zW2ldOwoKCSAgICAgIHZhciBjb250ZW50ID0gc2VjdGlvbi5jb25zdW1lci5zb3VyY2VDb250ZW50Rm9yKGFTb3VyY2UsIHRydWUpOwoJICAgICAgaWYgKGNvbnRlbnQpIHsKCSAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CgkgICAgICB9CgkgICAgfQoJICAgIGlmIChudWxsT25NaXNzaW5nKSB7CgkgICAgICByZXR1cm4gbnVsbDsKCSAgICB9CgkgICAgZWxzZSB7CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoJyInICsgYVNvdXJjZSArICciIGlzIG5vdCBpbiB0aGUgU291cmNlTWFwLicpOwoJICAgIH0KCSAgfTsKCgkvKioKCSAqIFJldHVybnMgdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBvcmlnaW5hbCBzb3VyY2UsCgkgKiBsaW5lLCBhbmQgY29sdW1uIHBvc2l0aW9ucyBwcm92aWRlZC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0IHdpdGgKCSAqIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gc291cmNlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIG9yaWdpbmFsIHNvdXJjZS4KCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZS4gIFRoZSBsaW5lIG51bWJlcgoJICogICAgIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLiAgVGhlIGNvbHVtbgoJICogICAgIG51bWJlciBpcyAwLWJhc2VkLgoJICoKCSAqIGFuZCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuIAoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UsIG9yIG51bGwuCgkgKiAgICAgVGhlIGNvbHVtbiBudW1iZXIgaXMgMC1iYXNlZC4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5nZW5lcmF0ZWRQb3NpdGlvbkZvciA9CgkgIGZ1bmN0aW9uIEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcl9nZW5lcmF0ZWRQb3NpdGlvbkZvcihhQXJncykgewoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgIHZhciBzZWN0aW9uID0gdGhpcy5fc2VjdGlvbnNbaV07CgoJICAgICAgLy8gT25seSBjb25zaWRlciB0aGlzIHNlY3Rpb24gaWYgdGhlIHJlcXVlc3RlZCBzb3VyY2UgaXMgaW4gdGhlIGxpc3Qgb2YKCSAgICAgIC8vIHNvdXJjZXMgb2YgdGhlIGNvbnN1bWVyLgoJICAgICAgaWYgKHNlY3Rpb24uY29uc3VtZXIuX2ZpbmRTb3VyY2VJbmRleCh1dGlsLmdldEFyZyhhQXJncywgJ3NvdXJjZScpKSA9PT0gLTEpIHsKCSAgICAgICAgY29udGludWU7CgkgICAgICB9CgkgICAgICB2YXIgZ2VuZXJhdGVkUG9zaXRpb24gPSBzZWN0aW9uLmNvbnN1bWVyLmdlbmVyYXRlZFBvc2l0aW9uRm9yKGFBcmdzKTsKCSAgICAgIGlmIChnZW5lcmF0ZWRQb3NpdGlvbikgewoJICAgICAgICB2YXIgcmV0ID0gewoJICAgICAgICAgIGxpbmU6IGdlbmVyYXRlZFBvc2l0aW9uLmxpbmUgKwoJICAgICAgICAgICAgKHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZExpbmUgLSAxKSwKCSAgICAgICAgICBjb2x1bW46IGdlbmVyYXRlZFBvc2l0aW9uLmNvbHVtbiArCgkgICAgICAgICAgICAoc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkTGluZSA9PT0gZ2VuZXJhdGVkUG9zaXRpb24ubGluZQoJICAgICAgICAgICAgID8gc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkQ29sdW1uIC0gMQoJICAgICAgICAgICAgIDogMCkKCSAgICAgICAgfTsKCSAgICAgICAgcmV0dXJuIHJldDsKCSAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiB7CgkgICAgICBsaW5lOiBudWxsLAoJICAgICAgY29sdW1uOiBudWxsCgkgICAgfTsKCSAgfTsKCgkvKioKCSAqIFBhcnNlIHRoZSBtYXBwaW5ncyBpbiBhIHN0cmluZyBpbiB0byBhIGRhdGEgc3RydWN0dXJlIHdoaWNoIHdlIGNhbiBlYXNpbHkKCSAqIHF1ZXJ5ICh0aGUgb3JkZXJlZCBhcnJheXMgaW4gdGhlIGB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3NgIGFuZAoJICogYHRoaXMuX19vcmlnaW5hbE1hcHBpbmdzYCBwcm9wZXJ0aWVzKS4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fcGFyc2VNYXBwaW5ncyA9CgkgIGZ1bmN0aW9uIEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcl9wYXJzZU1hcHBpbmdzKGFTdHIsIGFTb3VyY2VSb290KSB7CgkgICAgdGhpcy5fX2dlbmVyYXRlZE1hcHBpbmdzID0gW107CgkgICAgdGhpcy5fX29yaWdpbmFsTWFwcGluZ3MgPSBbXTsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7CgkgICAgICB2YXIgc2VjdGlvbiA9IHRoaXMuX3NlY3Rpb25zW2ldOwoJICAgICAgdmFyIHNlY3Rpb25NYXBwaW5ncyA9IHNlY3Rpb24uY29uc3VtZXIuX2dlbmVyYXRlZE1hcHBpbmdzOwoJICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWN0aW9uTWFwcGluZ3MubGVuZ3RoOyBqKyspIHsKCSAgICAgICAgdmFyIG1hcHBpbmcgPSBzZWN0aW9uTWFwcGluZ3Nbal07CgoJICAgICAgICB2YXIgc291cmNlID0gc2VjdGlvbi5jb25zdW1lci5fc291cmNlcy5hdChtYXBwaW5nLnNvdXJjZSk7CgkgICAgICAgIHNvdXJjZSA9IHV0aWwuY29tcHV0ZVNvdXJjZVVSTChzZWN0aW9uLmNvbnN1bWVyLnNvdXJjZVJvb3QsIHNvdXJjZSwgdGhpcy5fc291cmNlTWFwVVJMKTsKCSAgICAgICAgdGhpcy5fc291cmNlcy5hZGQoc291cmNlKTsKCSAgICAgICAgc291cmNlID0gdGhpcy5fc291cmNlcy5pbmRleE9mKHNvdXJjZSk7CgoJICAgICAgICB2YXIgbmFtZSA9IG51bGw7CgkgICAgICAgIGlmIChtYXBwaW5nLm5hbWUpIHsKCSAgICAgICAgICBuYW1lID0gc2VjdGlvbi5jb25zdW1lci5fbmFtZXMuYXQobWFwcGluZy5uYW1lKTsKCSAgICAgICAgICB0aGlzLl9uYW1lcy5hZGQobmFtZSk7CgkgICAgICAgICAgbmFtZSA9IHRoaXMuX25hbWVzLmluZGV4T2YobmFtZSk7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIFRoZSBtYXBwaW5ncyBjb21pbmcgZnJvbSB0aGUgY29uc3VtZXIgZm9yIHRoZSBzZWN0aW9uIGhhdmUKCSAgICAgICAgLy8gZ2VuZXJhdGVkIHBvc2l0aW9ucyByZWxhdGl2ZSB0byB0aGUgc3RhcnQgb2YgdGhlIHNlY3Rpb24sIHNvIHdlCgkgICAgICAgIC8vIG5lZWQgdG8gb2Zmc2V0IHRoZW0gdG8gYmUgcmVsYXRpdmUgdG8gdGhlIHN0YXJ0IG9mIHRoZSBjb25jYXRlbmF0ZWQKCSAgICAgICAgLy8gZ2VuZXJhdGVkIGZpbGUuCgkgICAgICAgIHZhciBhZGp1c3RlZE1hcHBpbmcgPSB7CgkgICAgICAgICAgc291cmNlOiBzb3VyY2UsCgkgICAgICAgICAgZ2VuZXJhdGVkTGluZTogbWFwcGluZy5nZW5lcmF0ZWRMaW5lICsKCSAgICAgICAgICAgIChzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lIC0gMSksCgkgICAgICAgICAgZ2VuZXJhdGVkQ29sdW1uOiBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiArCgkgICAgICAgICAgICAoc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkTGluZSA9PT0gbWFwcGluZy5nZW5lcmF0ZWRMaW5lCgkgICAgICAgICAgICA/IHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZENvbHVtbiAtIDEKCSAgICAgICAgICAgIDogMCksCgkgICAgICAgICAgb3JpZ2luYWxMaW5lOiBtYXBwaW5nLm9yaWdpbmFsTGluZSwKCSAgICAgICAgICBvcmlnaW5hbENvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbiwKCSAgICAgICAgICBuYW1lOiBuYW1lCgkgICAgICAgIH07CgoJICAgICAgICB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3MucHVzaChhZGp1c3RlZE1hcHBpbmcpOwoJICAgICAgICBpZiAodHlwZW9mIGFkanVzdGVkTWFwcGluZy5vcmlnaW5hbExpbmUgPT09ICdudW1iZXInKSB7CgkgICAgICAgICAgdGhpcy5fX29yaWdpbmFsTWFwcGluZ3MucHVzaChhZGp1c3RlZE1hcHBpbmcpOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfQoKCSAgICBxdWlja1NvcnQodGhpcy5fX2dlbmVyYXRlZE1hcHBpbmdzLCB1dGlsLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkKTsKCSAgICBxdWlja1NvcnQodGhpcy5fX29yaWdpbmFsTWFwcGluZ3MsIHV0aWwuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMpOwoJICB9OwoKCXNvdXJjZU1hcENvbnN1bWVyLkluZGV4ZWRTb3VyY2VNYXBDb25zdW1lciA9IEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcjsKCXJldHVybiBzb3VyY2VNYXBDb25zdW1lcjsKfQoKdmFyIHNvdXJjZU5vZGUgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZFNvdXJjZU5vZGU7CgpmdW5jdGlvbiByZXF1aXJlU291cmNlTm9kZSAoKSB7CglpZiAoaGFzUmVxdWlyZWRTb3VyY2VOb2RlKSByZXR1cm4gc291cmNlTm9kZTsKCWhhc1JlcXVpcmVkU291cmNlTm9kZSA9IDE7CgkvKgoJICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgoJICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQoJICovCgoJdmFyIFNvdXJjZU1hcEdlbmVyYXRvciA9IHJlcXVpcmVTb3VyY2VNYXBHZW5lcmF0b3IoKS5Tb3VyY2VNYXBHZW5lcmF0b3I7Cgl2YXIgdXRpbCA9IHJlcXVpcmVVdGlsKCk7CgoJLy8gTWF0Y2hlcyBhIFdpbmRvd3Mtc3R5bGUgYFxyXG5gIG5ld2xpbmUgb3IgYSBgXG5gIG5ld2xpbmUgdXNlZCBieSBhbGwgb3RoZXIKCS8vIG9wZXJhdGluZyBzeXN0ZW1zIHRoZXNlIGRheXMgKGNhcHR1cmluZyB0aGUgcmVzdWx0KS4KCXZhciBSRUdFWF9ORVdMSU5FID0gLyhccj9cbikvOwoKCS8vIE5ld2xpbmUgY2hhcmFjdGVyIGNvZGUgZm9yIGNoYXJDb2RlQXQoKSBjb21wYXJpc29ucwoJdmFyIE5FV0xJTkVfQ09ERSA9IDEwOwoKCS8vIFByaXZhdGUgc3ltYm9sIGZvciBpZGVudGlmeWluZyBgU291cmNlTm9kZWBzIHdoZW4gbXVsdGlwbGUgdmVyc2lvbnMgb2YKCS8vIHRoZSBzb3VyY2UtbWFwIGxpYnJhcnkgYXJlIGxvYWRlZC4gVGhpcyBNVVNUIE5PVCBDSEFOR0UgYWNyb3NzCgkvLyB2ZXJzaW9ucyEKCXZhciBpc1NvdXJjZU5vZGUgPSAiJCQkaXNTb3VyY2VOb2RlJCQkIjsKCgkvKioKCSAqIFNvdXJjZU5vZGVzIHByb3ZpZGUgYSB3YXkgdG8gYWJzdHJhY3Qgb3ZlciBpbnRlcnBvbGF0aW5nL2NvbmNhdGVuYXRpbmcKCSAqIHNuaXBwZXRzIG9mIGdlbmVyYXRlZCBKYXZhU2NyaXB0IHNvdXJjZSBjb2RlIHdoaWxlIG1haW50YWluaW5nIHRoZSBsaW5lIGFuZAoJICogY29sdW1uIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgb3JpZ2luYWwgc291cmNlIGNvZGUuCgkgKgoJICogQHBhcmFtIGFMaW5lIFRoZSBvcmlnaW5hbCBsaW5lIG51bWJlci4KCSAqIEBwYXJhbSBhQ29sdW1uIFRoZSBvcmlnaW5hbCBjb2x1bW4gbnVtYmVyLgoJICogQHBhcmFtIGFTb3VyY2UgVGhlIG9yaWdpbmFsIHNvdXJjZSdzIGZpbGVuYW1lLgoJICogQHBhcmFtIGFDaHVua3MgT3B0aW9uYWwuIEFuIGFycmF5IG9mIHN0cmluZ3Mgd2hpY2ggYXJlIHNuaXBwZXRzIG9mCgkgKiAgICAgICAgZ2VuZXJhdGVkIEpTLCBvciBvdGhlciBTb3VyY2VOb2Rlcy4KCSAqIEBwYXJhbSBhTmFtZSBUaGUgb3JpZ2luYWwgaWRlbnRpZmllci4KCSAqLwoJZnVuY3Rpb24gU291cmNlTm9kZShhTGluZSwgYUNvbHVtbiwgYVNvdXJjZSwgYUNodW5rcywgYU5hbWUpIHsKCSAgdGhpcy5jaGlsZHJlbiA9IFtdOwoJICB0aGlzLnNvdXJjZUNvbnRlbnRzID0ge307CgkgIHRoaXMubGluZSA9IGFMaW5lID09IG51bGwgPyBudWxsIDogYUxpbmU7CgkgIHRoaXMuY29sdW1uID0gYUNvbHVtbiA9PSBudWxsID8gbnVsbCA6IGFDb2x1bW47CgkgIHRoaXMuc291cmNlID0gYVNvdXJjZSA9PSBudWxsID8gbnVsbCA6IGFTb3VyY2U7CgkgIHRoaXMubmFtZSA9IGFOYW1lID09IG51bGwgPyBudWxsIDogYU5hbWU7CgkgIHRoaXNbaXNTb3VyY2VOb2RlXSA9IHRydWU7CgkgIGlmIChhQ2h1bmtzICE9IG51bGwpIHRoaXMuYWRkKGFDaHVua3MpOwoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIFNvdXJjZU5vZGUgZnJvbSBnZW5lcmF0ZWQgY29kZSBhbmQgYSBTb3VyY2VNYXBDb25zdW1lci4KCSAqCgkgKiBAcGFyYW0gYUdlbmVyYXRlZENvZGUgVGhlIGdlbmVyYXRlZCBjb2RlCgkgKiBAcGFyYW0gYVNvdXJjZU1hcENvbnN1bWVyIFRoZSBTb3VyY2VNYXAgZm9yIHRoZSBnZW5lcmF0ZWQgY29kZQoJICogQHBhcmFtIGFSZWxhdGl2ZVBhdGggT3B0aW9uYWwuIFRoZSBwYXRoIHRoYXQgcmVsYXRpdmUgc291cmNlcyBpbiB0aGUKCSAqICAgICAgICBTb3VyY2VNYXBDb25zdW1lciBzaG91bGQgYmUgcmVsYXRpdmUgdG8uCgkgKi8KCVNvdXJjZU5vZGUuZnJvbVN0cmluZ1dpdGhTb3VyY2VNYXAgPQoJICBmdW5jdGlvbiBTb3VyY2VOb2RlX2Zyb21TdHJpbmdXaXRoU291cmNlTWFwKGFHZW5lcmF0ZWRDb2RlLCBhU291cmNlTWFwQ29uc3VtZXIsIGFSZWxhdGl2ZVBhdGgpIHsKCSAgICAvLyBUaGUgU291cmNlTm9kZSB3ZSB3YW50IHRvIGZpbGwgd2l0aCB0aGUgZ2VuZXJhdGVkIGNvZGUKCSAgICAvLyBhbmQgdGhlIFNvdXJjZU1hcAoJICAgIHZhciBub2RlID0gbmV3IFNvdXJjZU5vZGUoKTsKCgkgICAgLy8gQWxsIGV2ZW4gaW5kaWNlcyBvZiB0aGlzIGFycmF5IGFyZSBvbmUgbGluZSBvZiB0aGUgZ2VuZXJhdGVkIGNvZGUsCgkgICAgLy8gd2hpbGUgYWxsIG9kZCBpbmRpY2VzIGFyZSB0aGUgbmV3bGluZXMgYmV0d2VlbiB0d28gYWRqYWNlbnQgbGluZXMKCSAgICAvLyAoc2luY2UgYFJFR0VYX05FV0xJTkVgIGNhcHR1cmVzIGl0cyBtYXRjaCkuCgkgICAgLy8gUHJvY2Vzc2VkIGZyYWdtZW50cyBhcmUgYWNjZXNzZWQgYnkgY2FsbGluZyBgc2hpZnROZXh0TGluZWAuCgkgICAgdmFyIHJlbWFpbmluZ0xpbmVzID0gYUdlbmVyYXRlZENvZGUuc3BsaXQoUkVHRVhfTkVXTElORSk7CgkgICAgdmFyIHJlbWFpbmluZ0xpbmVzSW5kZXggPSAwOwoJICAgIHZhciBzaGlmdE5leHRMaW5lID0gZnVuY3Rpb24oKSB7CgkgICAgICB2YXIgbGluZUNvbnRlbnRzID0gZ2V0TmV4dExpbmUoKTsKCSAgICAgIC8vIFRoZSBsYXN0IGxpbmUgb2YgYSBmaWxlIG1pZ2h0IG5vdCBoYXZlIGEgbmV3bGluZS4KCSAgICAgIHZhciBuZXdMaW5lID0gZ2V0TmV4dExpbmUoKSB8fCAiIjsKCSAgICAgIHJldHVybiBsaW5lQ29udGVudHMgKyBuZXdMaW5lOwoKCSAgICAgIGZ1bmN0aW9uIGdldE5leHRMaW5lKCkgewoJICAgICAgICByZXR1cm4gcmVtYWluaW5nTGluZXNJbmRleCA8IHJlbWFpbmluZ0xpbmVzLmxlbmd0aCA/CgkgICAgICAgICAgICByZW1haW5pbmdMaW5lc1tyZW1haW5pbmdMaW5lc0luZGV4KytdIDogdW5kZWZpbmVkOwoJICAgICAgfQoJICAgIH07CgoJICAgIC8vIFdlIG5lZWQgdG8gcmVtZW1iZXIgdGhlIHBvc2l0aW9uIG9mICJyZW1haW5pbmdMaW5lcyIKCSAgICB2YXIgbGFzdEdlbmVyYXRlZExpbmUgPSAxLCBsYXN0R2VuZXJhdGVkQ29sdW1uID0gMDsKCgkgICAgLy8gVGhlIGdlbmVyYXRlIFNvdXJjZU5vZGVzIHdlIG5lZWQgYSBjb2RlIHJhbmdlLgoJICAgIC8vIFRvIGV4dHJhY3QgaXQgY3VycmVudCBhbmQgbGFzdCBtYXBwaW5nIGlzIHVzZWQuCgkgICAgLy8gSGVyZSB3ZSBzdG9yZSB0aGUgbGFzdCBtYXBwaW5nLgoJICAgIHZhciBsYXN0TWFwcGluZyA9IG51bGw7CgoJICAgIGFTb3VyY2VNYXBDb25zdW1lci5lYWNoTWFwcGluZyhmdW5jdGlvbiAobWFwcGluZykgewoJICAgICAgaWYgKGxhc3RNYXBwaW5nICE9PSBudWxsKSB7CgkgICAgICAgIC8vIFdlIGFkZCB0aGUgY29kZSBmcm9tICJsYXN0TWFwcGluZyIgdG8gIm1hcHBpbmciOgoJICAgICAgICAvLyBGaXJzdCBjaGVjayBpZiB0aGVyZSBpcyBhIG5ldyBsaW5lIGluIGJldHdlZW4uCgkgICAgICAgIGlmIChsYXN0R2VuZXJhdGVkTGluZSA8IG1hcHBpbmcuZ2VuZXJhdGVkTGluZSkgewoJICAgICAgICAgIC8vIEFzc29jaWF0ZSBmaXJzdCBsaW5lIHdpdGggImxhc3RNYXBwaW5nIgoJICAgICAgICAgIGFkZE1hcHBpbmdXaXRoQ29kZShsYXN0TWFwcGluZywgc2hpZnROZXh0TGluZSgpKTsKCSAgICAgICAgICBsYXN0R2VuZXJhdGVkTGluZSsrOwoJICAgICAgICAgIGxhc3RHZW5lcmF0ZWRDb2x1bW4gPSAwOwoJICAgICAgICAgIC8vIFRoZSByZW1haW5pbmcgY29kZSBpcyBhZGRlZCB3aXRob3V0IG1hcHBpbmcKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAvLyBUaGVyZSBpcyBubyBuZXcgbGluZSBpbiBiZXR3ZWVuLgoJICAgICAgICAgIC8vIEFzc29jaWF0ZSB0aGUgY29kZSBiZXR3ZWVuICJsYXN0R2VuZXJhdGVkQ29sdW1uIiBhbmQKCSAgICAgICAgICAvLyAibWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4iIHdpdGggImxhc3RNYXBwaW5nIgoJICAgICAgICAgIHZhciBuZXh0TGluZSA9IHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdIHx8ICcnOwoJICAgICAgICAgIHZhciBjb2RlID0gbmV4dExpbmUuc3Vic3RyKDAsIG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uIC0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0R2VuZXJhdGVkQ29sdW1uKTsKCSAgICAgICAgICByZW1haW5pbmdMaW5lc1tyZW1haW5pbmdMaW5lc0luZGV4XSA9IG5leHRMaW5lLnN1YnN0cihtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbik7CgkgICAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbiA9IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uOwoJICAgICAgICAgIGFkZE1hcHBpbmdXaXRoQ29kZShsYXN0TWFwcGluZywgY29kZSk7CgkgICAgICAgICAgLy8gTm8gbW9yZSByZW1haW5pbmcgY29kZSwgY29udGludWUKCSAgICAgICAgICBsYXN0TWFwcGluZyA9IG1hcHBpbmc7CgkgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgICAvLyBXZSBhZGQgdGhlIGdlbmVyYXRlZCBjb2RlIHVudGlsIHRoZSBmaXJzdCBtYXBwaW5nCgkgICAgICAvLyB0byB0aGUgU291cmNlTm9kZSB3aXRob3V0IGFueSBtYXBwaW5nLgoJICAgICAgLy8gRWFjaCBsaW5lIGlzIGFkZGVkIGFzIHNlcGFyYXRlIHN0cmluZy4KCSAgICAgIHdoaWxlIChsYXN0R2VuZXJhdGVkTGluZSA8IG1hcHBpbmcuZ2VuZXJhdGVkTGluZSkgewoJICAgICAgICBub2RlLmFkZChzaGlmdE5leHRMaW5lKCkpOwoJICAgICAgICBsYXN0R2VuZXJhdGVkTGluZSsrOwoJICAgICAgfQoJICAgICAgaWYgKGxhc3RHZW5lcmF0ZWRDb2x1bW4gPCBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbikgewoJICAgICAgICB2YXIgbmV4dExpbmUgPSByZW1haW5pbmdMaW5lc1tyZW1haW5pbmdMaW5lc0luZGV4XSB8fCAnJzsKCSAgICAgICAgbm9kZS5hZGQobmV4dExpbmUuc3Vic3RyKDAsIG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uKSk7CgkgICAgICAgIHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdID0gbmV4dExpbmUuc3Vic3RyKG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uKTsKCSAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbiA9IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uOwoJICAgICAgfQoJICAgICAgbGFzdE1hcHBpbmcgPSBtYXBwaW5nOwoJICAgIH0sIHRoaXMpOwoJICAgIC8vIFdlIGhhdmUgcHJvY2Vzc2VkIGFsbCBtYXBwaW5ncy4KCSAgICBpZiAocmVtYWluaW5nTGluZXNJbmRleCA8IHJlbWFpbmluZ0xpbmVzLmxlbmd0aCkgewoJICAgICAgaWYgKGxhc3RNYXBwaW5nKSB7CgkgICAgICAgIC8vIEFzc29jaWF0ZSB0aGUgcmVtYWluaW5nIGNvZGUgaW4gdGhlIGN1cnJlbnQgbGluZSB3aXRoICJsYXN0TWFwcGluZyIKCSAgICAgICAgYWRkTWFwcGluZ1dpdGhDb2RlKGxhc3RNYXBwaW5nLCBzaGlmdE5leHRMaW5lKCkpOwoJICAgICAgfQoJICAgICAgLy8gYW5kIGFkZCB0aGUgcmVtYWluaW5nIGxpbmVzIHdpdGhvdXQgYW55IG1hcHBpbmcKCSAgICAgIG5vZGUuYWRkKHJlbWFpbmluZ0xpbmVzLnNwbGljZShyZW1haW5pbmdMaW5lc0luZGV4KS5qb2luKCIiKSk7CgkgICAgfQoKCSAgICAvLyBDb3B5IHNvdXJjZXNDb250ZW50IGludG8gU291cmNlTm9kZQoJICAgIGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VzLmZvckVhY2goZnVuY3Rpb24gKHNvdXJjZUZpbGUpIHsKCSAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CgkgICAgICBpZiAoY29udGVudCAhPSBudWxsKSB7CgkgICAgICAgIGlmIChhUmVsYXRpdmVQYXRoICE9IG51bGwpIHsKCSAgICAgICAgICBzb3VyY2VGaWxlID0gdXRpbC5qb2luKGFSZWxhdGl2ZVBhdGgsIHNvdXJjZUZpbGUpOwoJICAgICAgICB9CgkgICAgICAgIG5vZGUuc2V0U291cmNlQ29udGVudChzb3VyY2VGaWxlLCBjb250ZW50KTsKCSAgICAgIH0KCSAgICB9KTsKCgkgICAgcmV0dXJuIG5vZGU7CgoJICAgIGZ1bmN0aW9uIGFkZE1hcHBpbmdXaXRoQ29kZShtYXBwaW5nLCBjb2RlKSB7CgkgICAgICBpZiAobWFwcGluZyA9PT0gbnVsbCB8fCBtYXBwaW5nLnNvdXJjZSA9PT0gdW5kZWZpbmVkKSB7CgkgICAgICAgIG5vZGUuYWRkKGNvZGUpOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgdmFyIHNvdXJjZSA9IGFSZWxhdGl2ZVBhdGgKCSAgICAgICAgICA/IHV0aWwuam9pbihhUmVsYXRpdmVQYXRoLCBtYXBwaW5nLnNvdXJjZSkKCSAgICAgICAgICA6IG1hcHBpbmcuc291cmNlOwoJICAgICAgICBub2RlLmFkZChuZXcgU291cmNlTm9kZShtYXBwaW5nLm9yaWdpbmFsTGluZSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbENvbHVtbiwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nLm5hbWUpKTsKCSAgICAgIH0KCSAgICB9CgkgIH07CgoJLyoqCgkgKiBBZGQgYSBjaHVuayBvZiBnZW5lcmF0ZWQgSlMgdG8gdGhpcyBzb3VyY2Ugbm9kZS4KCSAqCgkgKiBAcGFyYW0gYUNodW5rIEEgc3RyaW5nIHNuaXBwZXQgb2YgZ2VuZXJhdGVkIEpTIGNvZGUsIGFub3RoZXIgaW5zdGFuY2Ugb2YKCSAqICAgICAgICBTb3VyY2VOb2RlLCBvciBhbiBhcnJheSB3aGVyZSBlYWNoIG1lbWJlciBpcyBvbmUgb2YgdGhvc2UgdGhpbmdzLgoJICovCglTb3VyY2VOb2RlLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX2FkZChhQ2h1bmspIHsKCSAgaWYgKEFycmF5LmlzQXJyYXkoYUNodW5rKSkgewoJICAgIGFDaHVuay5mb3JFYWNoKGZ1bmN0aW9uIChjaHVuaykgewoJICAgICAgdGhpcy5hZGQoY2h1bmspOwoJICAgIH0sIHRoaXMpOwoJICB9CgkgIGVsc2UgaWYgKGFDaHVua1tpc1NvdXJjZU5vZGVdIHx8IHR5cGVvZiBhQ2h1bmsgPT09ICJzdHJpbmciKSB7CgkgICAgaWYgKGFDaHVuaykgewoJICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGFDaHVuayk7CgkgICAgfQoJICB9CgkgIGVsc2UgewoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCgkgICAgICAiRXhwZWN0ZWQgYSBTb3VyY2VOb2RlLCBzdHJpbmcsIG9yIGFuIGFycmF5IG9mIFNvdXJjZU5vZGVzIGFuZCBzdHJpbmdzLiBHb3QgIiArIGFDaHVuawoJICAgICk7CgkgIH0KCSAgcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogQWRkIGEgY2h1bmsgb2YgZ2VuZXJhdGVkIEpTIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzb3VyY2Ugbm9kZS4KCSAqCgkgKiBAcGFyYW0gYUNodW5rIEEgc3RyaW5nIHNuaXBwZXQgb2YgZ2VuZXJhdGVkIEpTIGNvZGUsIGFub3RoZXIgaW5zdGFuY2Ugb2YKCSAqICAgICAgICBTb3VyY2VOb2RlLCBvciBhbiBhcnJheSB3aGVyZSBlYWNoIG1lbWJlciBpcyBvbmUgb2YgdGhvc2UgdGhpbmdzLgoJICovCglTb3VyY2VOb2RlLnByb3RvdHlwZS5wcmVwZW5kID0gZnVuY3Rpb24gU291cmNlTm9kZV9wcmVwZW5kKGFDaHVuaykgewoJICBpZiAoQXJyYXkuaXNBcnJheShhQ2h1bmspKSB7CgkgICAgZm9yICh2YXIgaSA9IGFDaHVuay5sZW5ndGgtMTsgaSA+PSAwOyBpLS0pIHsKCSAgICAgIHRoaXMucHJlcGVuZChhQ2h1bmtbaV0pOwoJICAgIH0KCSAgfQoJICBlbHNlIGlmIChhQ2h1bmtbaXNTb3VyY2VOb2RlXSB8fCB0eXBlb2YgYUNodW5rID09PSAic3RyaW5nIikgewoJICAgIHRoaXMuY2hpbGRyZW4udW5zaGlmdChhQ2h1bmspOwoJICB9CgkgIGVsc2UgewoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCgkgICAgICAiRXhwZWN0ZWQgYSBTb3VyY2VOb2RlLCBzdHJpbmcsIG9yIGFuIGFycmF5IG9mIFNvdXJjZU5vZGVzIGFuZCBzdHJpbmdzLiBHb3QgIiArIGFDaHVuawoJICAgICk7CgkgIH0KCSAgcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogV2FsayBvdmVyIHRoZSB0cmVlIG9mIEpTIHNuaXBwZXRzIGluIHRoaXMgbm9kZSBhbmQgaXRzIGNoaWxkcmVuLiBUaGUKCSAqIHdhbGtpbmcgZnVuY3Rpb24gaXMgY2FsbGVkIG9uY2UgZm9yIGVhY2ggc25pcHBldCBvZiBKUyBhbmQgaXMgcGFzc2VkIHRoYXQKCSAqIHNuaXBwZXQgYW5kIHRoZSBpdHMgb3JpZ2luYWwgYXNzb2NpYXRlZCBzb3VyY2UncyBsaW5lL2NvbHVtbiBsb2NhdGlvbi4KCSAqCgkgKiBAcGFyYW0gYUZuIFRoZSB0cmF2ZXJzYWwgZnVuY3Rpb24uCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3dhbGsoYUZuKSB7CgkgIHZhciBjaHVuazsKCSAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICBjaHVuayA9IHRoaXMuY2hpbGRyZW5baV07CgkgICAgaWYgKGNodW5rW2lzU291cmNlTm9kZV0pIHsKCSAgICAgIGNodW5rLndhbGsoYUZuKTsKCSAgICB9CgkgICAgZWxzZSB7CgkgICAgICBpZiAoY2h1bmsgIT09ICcnKSB7CgkgICAgICAgIGFGbihjaHVuaywgeyBzb3VyY2U6IHRoaXMuc291cmNlLAoJICAgICAgICAgICAgICAgICAgICAgbGluZTogdGhpcy5saW5lLAoJICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbiwKCSAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSB9KTsKCSAgICAgIH0KCSAgICB9CgkgIH0KCX07CgoJLyoqCgkgKiBMaWtlIGBTdHJpbmcucHJvdG90eXBlLmpvaW5gIGV4Y2VwdCBmb3IgU291cmNlTm9kZXMuIEluc2VydHMgYGFTdHJgIGJldHdlZW4KCSAqIGVhY2ggb2YgYHRoaXMuY2hpbGRyZW5gLgoJICoKCSAqIEBwYXJhbSBhU2VwIFRoZSBzZXBhcmF0b3IuCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLmpvaW4gPSBmdW5jdGlvbiBTb3VyY2VOb2RlX2pvaW4oYVNlcCkgewoJICB2YXIgbmV3Q2hpbGRyZW47CgkgIHZhciBpOwoJICB2YXIgbGVuID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7CgkgIGlmIChsZW4gPiAwKSB7CgkgICAgbmV3Q2hpbGRyZW4gPSBbXTsKCSAgICBmb3IgKGkgPSAwOyBpIDwgbGVuLTE7IGkrKykgewoJICAgICAgbmV3Q2hpbGRyZW4ucHVzaCh0aGlzLmNoaWxkcmVuW2ldKTsKCSAgICAgIG5ld0NoaWxkcmVuLnB1c2goYVNlcCk7CgkgICAgfQoJICAgIG5ld0NoaWxkcmVuLnB1c2godGhpcy5jaGlsZHJlbltpXSk7CgkgICAgdGhpcy5jaGlsZHJlbiA9IG5ld0NoaWxkcmVuOwoJICB9CgkgIHJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIENhbGwgU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlIG9uIHRoZSB2ZXJ5IHJpZ2h0LW1vc3Qgc291cmNlIHNuaXBwZXQuIFVzZWZ1bAoJICogZm9yIHRyaW1taW5nIHdoaXRlc3BhY2UgZnJvbSB0aGUgZW5kIG9mIGEgc291cmNlIG5vZGUsIGV0Yy4KCSAqCgkgKiBAcGFyYW0gYVBhdHRlcm4gVGhlIHBhdHRlcm4gdG8gcmVwbGFjZS4KCSAqIEBwYXJhbSBhUmVwbGFjZW1lbnQgVGhlIHRoaW5nIHRvIHJlcGxhY2UgdGhlIHBhdHRlcm4gd2l0aC4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUucmVwbGFjZVJpZ2h0ID0gZnVuY3Rpb24gU291cmNlTm9kZV9yZXBsYWNlUmlnaHQoYVBhdHRlcm4sIGFSZXBsYWNlbWVudCkgewoJICB2YXIgbGFzdENoaWxkID0gdGhpcy5jaGlsZHJlblt0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDFdOwoJICBpZiAobGFzdENoaWxkW2lzU291cmNlTm9kZV0pIHsKCSAgICBsYXN0Q2hpbGQucmVwbGFjZVJpZ2h0KGFQYXR0ZXJuLCBhUmVwbGFjZW1lbnQpOwoJICB9CgkgIGVsc2UgaWYgKHR5cGVvZiBsYXN0Q2hpbGQgPT09ICdzdHJpbmcnKSB7CgkgICAgdGhpcy5jaGlsZHJlblt0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDFdID0gbGFzdENoaWxkLnJlcGxhY2UoYVBhdHRlcm4sIGFSZXBsYWNlbWVudCk7CgkgIH0KCSAgZWxzZSB7CgkgICAgdGhpcy5jaGlsZHJlbi5wdXNoKCcnLnJlcGxhY2UoYVBhdHRlcm4sIGFSZXBsYWNlbWVudCkpOwoJICB9CgkgIHJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIFNldCB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGEgc291cmNlIGZpbGUuIFRoaXMgd2lsbCBiZSBhZGRlZCB0byB0aGUgU291cmNlTWFwR2VuZXJhdG9yCgkgKiBpbiB0aGUgc291cmNlc0NvbnRlbnQgZmllbGQuCgkgKgoJICogQHBhcmFtIGFTb3VyY2VGaWxlIFRoZSBmaWxlbmFtZSBvZiB0aGUgc291cmNlIGZpbGUKCSAqIEBwYXJhbSBhU291cmNlQ29udGVudCBUaGUgY29udGVudCBvZiB0aGUgc291cmNlIGZpbGUKCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUuc2V0U291cmNlQ29udGVudCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU5vZGVfc2V0U291cmNlQ29udGVudChhU291cmNlRmlsZSwgYVNvdXJjZUNvbnRlbnQpIHsKCSAgICB0aGlzLnNvdXJjZUNvbnRlbnRzW3V0aWwudG9TZXRTdHJpbmcoYVNvdXJjZUZpbGUpXSA9IGFTb3VyY2VDb250ZW50OwoJICB9OwoKCS8qKgoJICogV2FsayBvdmVyIHRoZSB0cmVlIG9mIFNvdXJjZU5vZGVzLiBUaGUgd2Fsa2luZyBmdW5jdGlvbiBpcyBjYWxsZWQgZm9yIGVhY2gKCSAqIHNvdXJjZSBmaWxlIGNvbnRlbnQgYW5kIGlzIHBhc3NlZCB0aGUgZmlsZW5hbWUgYW5kIHNvdXJjZSBjb250ZW50LgoJICoKCSAqIEBwYXJhbSBhRm4gVGhlIHRyYXZlcnNhbCBmdW5jdGlvbi4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUud2Fsa1NvdXJjZUNvbnRlbnRzID0KCSAgZnVuY3Rpb24gU291cmNlTm9kZV93YWxrU291cmNlQ29udGVudHMoYUZuKSB7CgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIGlmICh0aGlzLmNoaWxkcmVuW2ldW2lzU291cmNlTm9kZV0pIHsKCSAgICAgICAgdGhpcy5jaGlsZHJlbltpXS53YWxrU291cmNlQ29udGVudHMoYUZuKTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHZhciBzb3VyY2VzID0gT2JqZWN0LmtleXModGhpcy5zb3VyY2VDb250ZW50cyk7CgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNvdXJjZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIGFGbih1dGlsLmZyb21TZXRTdHJpbmcoc291cmNlc1tpXSksIHRoaXMuc291cmNlQ29udGVudHNbc291cmNlc1tpXV0pOwoJICAgIH0KCSAgfTsKCgkvKioKCSAqIFJldHVybiB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgc291cmNlIG5vZGUuIFdhbGtzIG92ZXIgdGhlIHRyZWUKCSAqIGFuZCBjb25jYXRlbmF0ZXMgYWxsIHRoZSB2YXJpb3VzIHNuaXBwZXRzIHRvZ2V0aGVyIHRvIG9uZSBzdHJpbmcuCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gU291cmNlTm9kZV90b1N0cmluZygpIHsKCSAgdmFyIHN0ciA9ICIiOwoJICB0aGlzLndhbGsoZnVuY3Rpb24gKGNodW5rKSB7CgkgICAgc3RyICs9IGNodW5rOwoJICB9KTsKCSAgcmV0dXJuIHN0cjsKCX07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBzb3VyY2Ugbm9kZSBhbG9uZyB3aXRoIGEgc291cmNlCgkgKiBtYXAuCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLnRvU3RyaW5nV2l0aFNvdXJjZU1hcCA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfdG9TdHJpbmdXaXRoU291cmNlTWFwKGFBcmdzKSB7CgkgIHZhciBnZW5lcmF0ZWQgPSB7CgkgICAgY29kZTogIiIsCgkgICAgbGluZTogMSwKCSAgICBjb2x1bW46IDAKCSAgfTsKCSAgdmFyIG1hcCA9IG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IoYUFyZ3MpOwoJICB2YXIgc291cmNlTWFwcGluZ0FjdGl2ZSA9IGZhbHNlOwoJICB2YXIgbGFzdE9yaWdpbmFsU291cmNlID0gbnVsbDsKCSAgdmFyIGxhc3RPcmlnaW5hbExpbmUgPSBudWxsOwoJICB2YXIgbGFzdE9yaWdpbmFsQ29sdW1uID0gbnVsbDsKCSAgdmFyIGxhc3RPcmlnaW5hbE5hbWUgPSBudWxsOwoJICB0aGlzLndhbGsoZnVuY3Rpb24gKGNodW5rLCBvcmlnaW5hbCkgewoJICAgIGdlbmVyYXRlZC5jb2RlICs9IGNodW5rOwoJICAgIGlmIChvcmlnaW5hbC5zb3VyY2UgIT09IG51bGwKCSAgICAgICAgJiYgb3JpZ2luYWwubGluZSAhPT0gbnVsbAoJICAgICAgICAmJiBvcmlnaW5hbC5jb2x1bW4gIT09IG51bGwpIHsKCSAgICAgIGlmKGxhc3RPcmlnaW5hbFNvdXJjZSAhPT0gb3JpZ2luYWwuc291cmNlCgkgICAgICAgICB8fCBsYXN0T3JpZ2luYWxMaW5lICE9PSBvcmlnaW5hbC5saW5lCgkgICAgICAgICB8fCBsYXN0T3JpZ2luYWxDb2x1bW4gIT09IG9yaWdpbmFsLmNvbHVtbgoJICAgICAgICAgfHwgbGFzdE9yaWdpbmFsTmFtZSAhPT0gb3JpZ2luYWwubmFtZSkgewoJICAgICAgICBtYXAuYWRkTWFwcGluZyh7CgkgICAgICAgICAgc291cmNlOiBvcmlnaW5hbC5zb3VyY2UsCgkgICAgICAgICAgb3JpZ2luYWw6IHsKCSAgICAgICAgICAgIGxpbmU6IG9yaWdpbmFsLmxpbmUsCgkgICAgICAgICAgICBjb2x1bW46IG9yaWdpbmFsLmNvbHVtbgoJICAgICAgICAgIH0sCgkgICAgICAgICAgZ2VuZXJhdGVkOiB7CgkgICAgICAgICAgICBsaW5lOiBnZW5lcmF0ZWQubGluZSwKCSAgICAgICAgICAgIGNvbHVtbjogZ2VuZXJhdGVkLmNvbHVtbgoJICAgICAgICAgIH0sCgkgICAgICAgICAgbmFtZTogb3JpZ2luYWwubmFtZQoJICAgICAgICB9KTsKCSAgICAgIH0KCSAgICAgIGxhc3RPcmlnaW5hbFNvdXJjZSA9IG9yaWdpbmFsLnNvdXJjZTsKCSAgICAgIGxhc3RPcmlnaW5hbExpbmUgPSBvcmlnaW5hbC5saW5lOwoJICAgICAgbGFzdE9yaWdpbmFsQ29sdW1uID0gb3JpZ2luYWwuY29sdW1uOwoJICAgICAgbGFzdE9yaWdpbmFsTmFtZSA9IG9yaWdpbmFsLm5hbWU7CgkgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gdHJ1ZTsKCSAgICB9IGVsc2UgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKCSAgICAgIG1hcC5hZGRNYXBwaW5nKHsKCSAgICAgICAgZ2VuZXJhdGVkOiB7CgkgICAgICAgICAgbGluZTogZ2VuZXJhdGVkLmxpbmUsCgkgICAgICAgICAgY29sdW1uOiBnZW5lcmF0ZWQuY29sdW1uCgkgICAgICAgIH0KCSAgICAgIH0pOwoJICAgICAgbGFzdE9yaWdpbmFsU291cmNlID0gbnVsbDsKCSAgICAgIHNvdXJjZU1hcHBpbmdBY3RpdmUgPSBmYWxzZTsKCSAgICB9CgkgICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuZ3RoID0gY2h1bmsubGVuZ3RoOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7CgkgICAgICBpZiAoY2h1bmsuY2hhckNvZGVBdChpZHgpID09PSBORVdMSU5FX0NPREUpIHsKCSAgICAgICAgZ2VuZXJhdGVkLmxpbmUrKzsKCSAgICAgICAgZ2VuZXJhdGVkLmNvbHVtbiA9IDA7CgkgICAgICAgIC8vIE1hcHBpbmdzIGVuZCBhdCBlb2wKCSAgICAgICAgaWYgKGlkeCArIDEgPT09IGxlbmd0aCkgewoJICAgICAgICAgIGxhc3RPcmlnaW5hbFNvdXJjZSA9IG51bGw7CgkgICAgICAgICAgc291cmNlTWFwcGluZ0FjdGl2ZSA9IGZhbHNlOwoJICAgICAgICB9IGVsc2UgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKCSAgICAgICAgICBtYXAuYWRkTWFwcGluZyh7CgkgICAgICAgICAgICBzb3VyY2U6IG9yaWdpbmFsLnNvdXJjZSwKCSAgICAgICAgICAgIG9yaWdpbmFsOiB7CgkgICAgICAgICAgICAgIGxpbmU6IG9yaWdpbmFsLmxpbmUsCgkgICAgICAgICAgICAgIGNvbHVtbjogb3JpZ2luYWwuY29sdW1uCgkgICAgICAgICAgICB9LAoJICAgICAgICAgICAgZ2VuZXJhdGVkOiB7CgkgICAgICAgICAgICAgIGxpbmU6IGdlbmVyYXRlZC5saW5lLAoJICAgICAgICAgICAgICBjb2x1bW46IGdlbmVyYXRlZC5jb2x1bW4KCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbC5uYW1lCgkgICAgICAgICAgfSk7CgkgICAgICAgIH0KCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIGdlbmVyYXRlZC5jb2x1bW4rKzsKCSAgICAgIH0KCSAgICB9CgkgIH0pOwoJICB0aGlzLndhbGtTb3VyY2VDb250ZW50cyhmdW5jdGlvbiAoc291cmNlRmlsZSwgc291cmNlQ29udGVudCkgewoJICAgIG1hcC5zZXRTb3VyY2VDb250ZW50KHNvdXJjZUZpbGUsIHNvdXJjZUNvbnRlbnQpOwoJICB9KTsKCgkgIHJldHVybiB7IGNvZGU6IGdlbmVyYXRlZC5jb2RlLCBtYXA6IG1hcCB9OwoJfTsKCglzb3VyY2VOb2RlLlNvdXJjZU5vZGUgPSBTb3VyY2VOb2RlOwoJcmV0dXJuIHNvdXJjZU5vZGU7Cn0KCi8qCiAqIENvcHlyaWdodCAyMDA5LTIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0UudHh0IG9yOgogKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCiAqLwoKdmFyIGhhc1JlcXVpcmVkU291cmNlTWFwOwoKZnVuY3Rpb24gcmVxdWlyZVNvdXJjZU1hcCAoKSB7CglpZiAoaGFzUmVxdWlyZWRTb3VyY2VNYXApIHJldHVybiBzb3VyY2VNYXA7CgloYXNSZXF1aXJlZFNvdXJjZU1hcCA9IDE7Cglzb3VyY2VNYXAuU291cmNlTWFwR2VuZXJhdG9yID0gcmVxdWlyZVNvdXJjZU1hcEdlbmVyYXRvcigpLlNvdXJjZU1hcEdlbmVyYXRvcjsKCXNvdXJjZU1hcC5Tb3VyY2VNYXBDb25zdW1lciA9IHJlcXVpcmVTb3VyY2VNYXBDb25zdW1lcigpLlNvdXJjZU1hcENvbnN1bWVyOwoJc291cmNlTWFwLlNvdXJjZU5vZGUgPSByZXF1aXJlU291cmNlTm9kZSgpLlNvdXJjZU5vZGU7CglyZXR1cm4gc291cmNlTWFwOwp9Cgpjb25zdCBuYW1lJEcgPSAiZXNjb2RlZ2VuIjsKY29uc3QgZGVzY3JpcHRpb24gPSAiRUNNQVNjcmlwdCBjb2RlIGdlbmVyYXRvciI7CmNvbnN0IGhvbWVwYWdlID0gImh0dHA6Ly9naXRodWIuY29tL2VzdG9vbHMvZXNjb2RlZ2VuIjsKY29uc3QgbWFpbiA9ICJlc2NvZGVnZW4uanMiOwpjb25zdCBiaW4gPSB7Cgllc2dlbmVyYXRlOiAiLi9iaW4vZXNnZW5lcmF0ZS5qcyIsCgllc2NvZGVnZW46ICIuL2Jpbi9lc2NvZGVnZW4uanMiCn07CmNvbnN0IGZpbGVzID0gWwoJIkxJQ0VOU0UuQlNEIiwKCSJSRUFETUUubWQiLAoJImJpbiIsCgkiZXNjb2RlZ2VuLmpzIiwKCSJwYWNrYWdlLmpzb24iCl07CmNvbnN0IHZlcnNpb24kMSA9ICIyLjEuMCI7CmNvbnN0IGVuZ2luZXMgPSB7Cglub2RlOiAiPj02LjAiCn07CmNvbnN0IG1haW50YWluZXJzID0gWwoJewoJCW5hbWU6ICJZdXN1a2UgU3V6dWtpIiwKCQllbWFpbDogInV0YXRhbmUudGVhQGdtYWlsLmNvbSIsCgkJd2ViOiAiaHR0cDovL2dpdGh1Yi5jb20vQ29uc3RlbGxhdGlvbiIKCX0KXTsKY29uc3QgcmVwb3NpdG9yeSA9IHsKCXR5cGU6ICJnaXQiLAoJdXJsOiAiaHR0cDovL2dpdGh1Yi5jb20vZXN0b29scy9lc2NvZGVnZW4uZ2l0Igp9Owpjb25zdCBkZXBlbmRlbmNpZXMgPSB7Cgllc3RyYXZlcnNlOiAiXjUuMi4wIiwKCWVzdXRpbHM6ICJeMi4wLjIiLAoJZXNwcmltYTogIl40LjAuMSIKfTsKY29uc3Qgb3B0aW9uYWxEZXBlbmRlbmNpZXMgPSB7Cgkic291cmNlLW1hcCI6ICJ+MC42LjEiCn07CmNvbnN0IGRldkRlcGVuZGVuY2llcyA9IHsKCWFjb3JuOiAiXjguMC40IiwKCWJsdWViaXJkOiAiXjMuNC43IiwKCSJib3dlci1yZWdpc3RyeS1jbGllbnQiOiAiXjEuMC4wIiwKCWNoYWk6ICJeNC4yLjAiLAoJImNoYWktZXhjbHVkZSI6ICJeMi4wLjIiLAoJImNvbW1vbmpzLWV2ZXJ5d2hlcmUiOiAiXjAuOS43IiwKCWd1bHA6ICJeNC4wLjIiLAoJImd1bHAtZXNsaW50IjogIl42LjAuMCIsCgkiZ3VscC1tb2NoYSI6ICJeNy4wLjIiLAoJbWluaW1pc3Q6ICJeMS4yLjUiLAoJb3B0aW9uYXRvcjogIl4wLjkuMSIsCglzZW12ZXI6ICJeNy4zLjQiCn07CmNvbnN0IGxpY2Vuc2UgPSAiQlNELTItQ2xhdXNlIjsKY29uc3Qgc2NyaXB0cyA9IHsKCXRlc3Q6ICJndWxwIHRyYXZpcyIsCgkidW5pdC10ZXN0IjogImd1bHAgdGVzdCIsCglsaW50OiAiZ3VscCBsaW50IiwKCXJlbGVhc2U6ICJub2RlIHRvb2xzL3JlbGVhc2UuanMiLAoJImJ1aWxkLW1pbiI6ICIuL25vZGVfbW9kdWxlcy8uYmluL2Nqc2lmeSAtbWEgcGF0aDogdG9vbHMvZW50cnktcG9pbnQuanMgPiBlc2NvZGVnZW4uYnJvd3Nlci5taW4uanMiLAoJYnVpbGQ6ICIuL25vZGVfbW9kdWxlcy8uYmluL2Nqc2lmeSAtYSBwYXRoOiB0b29scy9lbnRyeS1wb2ludC5qcyA+IGVzY29kZWdlbi5icm93c2VyLmpzIgp9Owpjb25zdCByZXF1aXJlJCQzID0gewoJbmFtZTogbmFtZSRHLAoJZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLAoJaG9tZXBhZ2U6IGhvbWVwYWdlLAoJbWFpbjogbWFpbiwKCWJpbjogYmluLAoJZmlsZXM6IGZpbGVzLAoJdmVyc2lvbjogdmVyc2lvbiQxLAoJZW5naW5lczogZW5naW5lcywKCW1haW50YWluZXJzOiBtYWludGFpbmVycywKCXJlcG9zaXRvcnk6IHJlcG9zaXRvcnksCglkZXBlbmRlbmNpZXM6IGRlcGVuZGVuY2llcywKCW9wdGlvbmFsRGVwZW5kZW5jaWVzOiBvcHRpb25hbERlcGVuZGVuY2llcywKCWRldkRlcGVuZGVuY2llczogZGV2RGVwZW5kZW5jaWVzLAoJbGljZW5zZTogbGljZW5zZSwKCXNjcmlwdHM6IHNjcmlwdHMKfTsKCi8qCiAgQ29weXJpZ2h0IChDKSAyMDEyLTIwMTQgWXVzdWtlIFN1enVraSA8dXRhdGFuZS50ZWFAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxNSBJbmd2YXIgU3RlcGFueWFuIDxtZUBycmV2ZXJzZXIuY29tPgogIENvcHlyaWdodCAoQykgMjAxNCBJdmFuIE5pa3VsaW4gPGlmYWFhbkBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyLTIwMTMgTWljaGFlbCBGaWNhcnJhIDxlc2NvZGVnZW4uY29weXJpZ2h0QG1pY2hhZWwuZmljYXJyYS5tZT4KICBDb3B5cmlnaHQgKEMpIDIwMTItMjAxMyBNYXRoaWFzIEJ5bmVucyA8bWF0aGlhc0BxaXdpLmJlPgogIENvcHlyaWdodCAoQykgMjAxMyBJcmFrbGkgR296YWxpc2h2aWxpIDxyZm9iaWNAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxMiBSb2JlcnQgR3VzdC1CYXJkb24gPGRvbmF0ZUByb2JlcnQuZ3VzdC1iYXJkb24ub3JnPgogIENvcHlyaWdodCAoQykgMjAxMiBKb2huIEZyZWVtYW4gPGpmcmVlbWFuMDhAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxMS0yMDEyIEFyaXlhIEhpZGF5YXQgPGFyaXlhLmhpZGF5YXRAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxMiBKb29zdC1XaW0gQm9la2VzdGVpam4gPGpvb3N0LXdpbUBib2VrZXN0ZWlqbi5ubD4KICBDb3B5cmlnaHQgKEMpIDIwMTIgS3JpcyBLb3dhbCA8a3Jpcy5rb3dhbEBjaXhhci5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyIEFycGFkIEJvcnNvcyA8YXJwYWQuYm9yc29zQGdvb2dsZW1haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAyMCBBcHBsZSBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCgogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTlkKICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsKICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRgogIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCgooZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qZ2xvYmFsIGV4cG9ydHM6dHJ1ZSwgcmVxdWlyZTp0cnVlLCBnbG9iYWw6dHJ1ZSovCgkoZnVuY3Rpb24gKCkgewoKCSAgICB2YXIgU3ludGF4LAoJICAgICAgICBQcmVjZWRlbmNlLAoJICAgICAgICBCaW5hcnlQcmVjZWRlbmNlLAoJICAgICAgICBTb3VyY2VOb2RlLAoJICAgICAgICBlc3RyYXZlcnNlJDEsCgkgICAgICAgIGVzdXRpbHMsCgkgICAgICAgIGJhc2UsCgkgICAgICAgIGluZGVudCwKCSAgICAgICAganNvbiwKCSAgICAgICAgcmVudW1iZXIsCgkgICAgICAgIGhleGFkZWNpbWFsLAoJICAgICAgICBxdW90ZXMsCgkgICAgICAgIGVzY2FwZWxlc3MsCgkgICAgICAgIG5ld2xpbmUsCgkgICAgICAgIHNwYWNlLAoJICAgICAgICBwYXJlbnRoZXNlcywKCSAgICAgICAgc2VtaWNvbG9ucywKCSAgICAgICAgc2FmZUNvbmNhdGVuYXRpb24sCgkgICAgICAgIGRpcmVjdGl2ZSwKCSAgICAgICAgZXh0cmEsCgkgICAgICAgIHBhcnNlLAoJICAgICAgICBzb3VyY2VNYXAsCgkgICAgICAgIHNvdXJjZUNvZGUsCgkgICAgICAgIHByZXNlcnZlQmxhbmtMaW5lcywKCSAgICAgICAgRk9STUFUX01JTklGWSwKCSAgICAgICAgRk9STUFUX0RFRkFVTFRTOwoKCSAgICBlc3RyYXZlcnNlJDEgPSBlc3RyYXZlcnNlOwoJICAgIGVzdXRpbHMgPSB1dGlsczsKCgkgICAgU3ludGF4ID0gZXN0cmF2ZXJzZSQxLlN5bnRheDsKCgkgICAgLy8gR2VuZXJhdGlvbiBpcyBkb25lIGJ5IGdlbmVyYXRlRXhwcmVzc2lvbi4KCSAgICBmdW5jdGlvbiBpc0V4cHJlc3Npb24obm9kZSkgewoJICAgICAgICByZXR1cm4gQ29kZUdlbmVyYXRvci5FeHByZXNzaW9uLmhhc093blByb3BlcnR5KG5vZGUudHlwZSk7CgkgICAgfQoKCSAgICAvLyBHZW5lcmF0aW9uIGlzIGRvbmUgYnkgZ2VuZXJhdGVTdGF0ZW1lbnQuCgkgICAgZnVuY3Rpb24gaXNTdGF0ZW1lbnQobm9kZSkgewoJICAgICAgICByZXR1cm4gQ29kZUdlbmVyYXRvci5TdGF0ZW1lbnQuaGFzT3duUHJvcGVydHkobm9kZS50eXBlKTsKCSAgICB9CgoJICAgIFByZWNlZGVuY2UgPSB7CgkgICAgICAgIFNlcXVlbmNlOiAwLAoJICAgICAgICBZaWVsZDogMSwKCSAgICAgICAgQXNzaWdubWVudDogMSwKCSAgICAgICAgQ29uZGl0aW9uYWw6IDIsCgkgICAgICAgIEFycm93RnVuY3Rpb246IDIsCgkgICAgICAgIENvYWxlc2NlOiAzLAoJICAgICAgICBMb2dpY2FsT1I6IDQsCgkgICAgICAgIExvZ2ljYWxBTkQ6IDUsCgkgICAgICAgIEJpdHdpc2VPUjogNiwKCSAgICAgICAgQml0d2lzZVhPUjogNywKCSAgICAgICAgQml0d2lzZUFORDogOCwKCSAgICAgICAgRXF1YWxpdHk6IDksCgkgICAgICAgIFJlbGF0aW9uYWw6IDEwLAoJICAgICAgICBCaXR3aXNlU0hJRlQ6IDExLAoJICAgICAgICBBZGRpdGl2ZTogMTIsCgkgICAgICAgIE11bHRpcGxpY2F0aXZlOiAxMywKCSAgICAgICAgRXhwb25lbnRpYXRpb246IDE0LAoJICAgICAgICBBd2FpdDogMTUsCgkgICAgICAgIFVuYXJ5OiAxNSwKCSAgICAgICAgUG9zdGZpeDogMTYsCgkgICAgICAgIE9wdGlvbmFsQ2hhaW5pbmc6IDE3LAoJICAgICAgICBDYWxsOiAxOCwKCSAgICAgICAgTmV3OiAxOSwKCSAgICAgICAgVGFnZ2VkVGVtcGxhdGU6IDIwLAoJICAgICAgICBNZW1iZXI6IDIxLAoJICAgICAgICBQcmltYXJ5OiAyMgoJICAgIH07CgoJICAgIEJpbmFyeVByZWNlZGVuY2UgPSB7CgkgICAgICAgICc/Pyc6IFByZWNlZGVuY2UuQ29hbGVzY2UsCgkgICAgICAgICd8fCc6IFByZWNlZGVuY2UuTG9naWNhbE9SLAoJICAgICAgICAnJiYnOiBQcmVjZWRlbmNlLkxvZ2ljYWxBTkQsCgkgICAgICAgICd8JzogUHJlY2VkZW5jZS5CaXR3aXNlT1IsCgkgICAgICAgICdeJzogUHJlY2VkZW5jZS5CaXR3aXNlWE9SLAoJICAgICAgICAnJic6IFByZWNlZGVuY2UuQml0d2lzZUFORCwKCSAgICAgICAgJz09JzogUHJlY2VkZW5jZS5FcXVhbGl0eSwKCSAgICAgICAgJyE9JzogUHJlY2VkZW5jZS5FcXVhbGl0eSwKCSAgICAgICAgJz09PSc6IFByZWNlZGVuY2UuRXF1YWxpdHksCgkgICAgICAgICchPT0nOiBQcmVjZWRlbmNlLkVxdWFsaXR5LAoJICAgICAgICAnaXMnOiBQcmVjZWRlbmNlLkVxdWFsaXR5LAoJICAgICAgICAnaXNudCc6IFByZWNlZGVuY2UuRXF1YWxpdHksCgkgICAgICAgICc8JzogUHJlY2VkZW5jZS5SZWxhdGlvbmFsLAoJICAgICAgICAnPic6IFByZWNlZGVuY2UuUmVsYXRpb25hbCwKCSAgICAgICAgJzw9JzogUHJlY2VkZW5jZS5SZWxhdGlvbmFsLAoJICAgICAgICAnPj0nOiBQcmVjZWRlbmNlLlJlbGF0aW9uYWwsCgkgICAgICAgICdpbic6IFByZWNlZGVuY2UuUmVsYXRpb25hbCwKCSAgICAgICAgJ2luc3RhbmNlb2YnOiBQcmVjZWRlbmNlLlJlbGF0aW9uYWwsCgkgICAgICAgICc8PCc6IFByZWNlZGVuY2UuQml0d2lzZVNISUZULAoJICAgICAgICAnPj4nOiBQcmVjZWRlbmNlLkJpdHdpc2VTSElGVCwKCSAgICAgICAgJz4+Pic6IFByZWNlZGVuY2UuQml0d2lzZVNISUZULAoJICAgICAgICAnKyc6IFByZWNlZGVuY2UuQWRkaXRpdmUsCgkgICAgICAgICctJzogUHJlY2VkZW5jZS5BZGRpdGl2ZSwKCSAgICAgICAgJyonOiBQcmVjZWRlbmNlLk11bHRpcGxpY2F0aXZlLAoJICAgICAgICAnJSc6IFByZWNlZGVuY2UuTXVsdGlwbGljYXRpdmUsCgkgICAgICAgICcvJzogUHJlY2VkZW5jZS5NdWx0aXBsaWNhdGl2ZSwKCSAgICAgICAgJyoqJzogUHJlY2VkZW5jZS5FeHBvbmVudGlhdGlvbgoJICAgIH07CgoJICAgIC8vRmxhZ3MKCSAgICB2YXIgRl9BTExPV19JTiA9IDEsCgkgICAgICAgIEZfQUxMT1dfQ0FMTCA9IDEgPDwgMSwKCSAgICAgICAgRl9BTExPV19VTlBBUkFUSF9ORVcgPSAxIDw8IDIsCgkgICAgICAgIEZfRlVOQ19CT0RZID0gMSA8PCAzLAoJICAgICAgICBGX0RJUkVDVElWRV9DVFggPSAxIDw8IDQsCgkgICAgICAgIEZfU0VNSUNPTE9OX09QVCA9IDEgPDwgNSwKCSAgICAgICAgRl9GT1VORF9DT0FMRVNDRSA9IDEgPDwgNjsKCgkgICAgLy9FeHByZXNzaW9uIGZsYWcgc2V0cwoJICAgIC8vTk9URTogRmxhZyBvcmRlcjoKCSAgICAvLyBGX0FMTE9XX0lOCgkgICAgLy8gRl9BTExPV19DQUxMCgkgICAgLy8gRl9BTExPV19VTlBBUkFUSF9ORVcKCSAgICB2YXIgRV9GVFQgPSBGX0FMTE9XX0NBTEwgfCBGX0FMTE9XX1VOUEFSQVRIX05FVywKCSAgICAgICAgRV9UVEYgPSBGX0FMTE9XX0lOIHwgRl9BTExPV19DQUxMLAoJICAgICAgICBFX1RUVCA9IEZfQUxMT1dfSU4gfCBGX0FMTE9XX0NBTEwgfCBGX0FMTE9XX1VOUEFSQVRIX05FVywKCSAgICAgICAgRV9URkYgPSBGX0FMTE9XX0lOLAoJICAgICAgICBFX0ZGVCA9IEZfQUxMT1dfVU5QQVJBVEhfTkVXLAoJICAgICAgICBFX1RGVCA9IEZfQUxMT1dfSU4gfCBGX0FMTE9XX1VOUEFSQVRIX05FVzsKCgkgICAgLy9TdGF0ZW1lbnQgZmxhZyBzZXRzCgkgICAgLy9OT1RFOiBGbGFnIG9yZGVyOgoJICAgIC8vIEZfQUxMT1dfSU4KCSAgICAvLyBGX0ZVTkNfQk9EWQoJICAgIC8vIEZfRElSRUNUSVZFX0NUWAoJICAgIC8vIEZfU0VNSUNPTE9OX09QVAoJICAgIHZhciBTX1RGRkYgPSBGX0FMTE9XX0lOLAoJICAgICAgICBTX1RGRlQgPSBGX0FMTE9XX0lOIHwgRl9TRU1JQ09MT05fT1BULAoJICAgICAgICBTX0ZGRkYgPSAweDAwLAoJICAgICAgICBTX1RGVEYgPSBGX0FMTE9XX0lOIHwgRl9ESVJFQ1RJVkVfQ1RYLAoJICAgICAgICBTX1RURkYgPSBGX0FMTE9XX0lOIHwgRl9GVU5DX0JPRFk7CgoJICAgIGZ1bmN0aW9uIGdldERlZmF1bHRPcHRpb25zKCkgewoJICAgICAgICAvLyBkZWZhdWx0IG9wdGlvbnMKCSAgICAgICAgcmV0dXJuIHsKCSAgICAgICAgICAgIGluZGVudDogbnVsbCwKCSAgICAgICAgICAgIGJhc2U6IG51bGwsCgkgICAgICAgICAgICBwYXJzZTogbnVsbCwKCSAgICAgICAgICAgIGNvbW1lbnQ6IGZhbHNlLAoJICAgICAgICAgICAgZm9ybWF0OiB7CgkgICAgICAgICAgICAgICAgaW5kZW50OiB7CgkgICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnICAgICcsCgkgICAgICAgICAgICAgICAgICAgIGJhc2U6IDAsCgkgICAgICAgICAgICAgICAgICAgIGFkanVzdE11bHRpbGluZUNvbW1lbnQ6IGZhbHNlCgkgICAgICAgICAgICAgICAgfSwKCSAgICAgICAgICAgICAgICBuZXdsaW5lOiAnXG4nLAoJICAgICAgICAgICAgICAgIHNwYWNlOiAnICcsCgkgICAgICAgICAgICAgICAganNvbjogZmFsc2UsCgkgICAgICAgICAgICAgICAgcmVudW1iZXI6IGZhbHNlLAoJICAgICAgICAgICAgICAgIGhleGFkZWNpbWFsOiBmYWxzZSwKCSAgICAgICAgICAgICAgICBxdW90ZXM6ICdzaW5nbGUnLAoJICAgICAgICAgICAgICAgIGVzY2FwZWxlc3M6IGZhbHNlLAoJICAgICAgICAgICAgICAgIGNvbXBhY3Q6IGZhbHNlLAoJICAgICAgICAgICAgICAgIHBhcmVudGhlc2VzOiB0cnVlLAoJICAgICAgICAgICAgICAgIHNlbWljb2xvbnM6IHRydWUsCgkgICAgICAgICAgICAgICAgc2FmZUNvbmNhdGVuYXRpb246IGZhbHNlLAoJICAgICAgICAgICAgICAgIHByZXNlcnZlQmxhbmtMaW5lczogZmFsc2UKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBtb3o6IHsKCSAgICAgICAgICAgICAgICBjb21wcmVoZW5zaW9uRXhwcmVzc2lvblN0YXJ0c1dpdGhBc3NpZ25tZW50OiBmYWxzZSwKCSAgICAgICAgICAgICAgICBzdGFybGVzc0dlbmVyYXRvcjogZmFsc2UKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBzb3VyY2VNYXA6IG51bGwsCgkgICAgICAgICAgICBzb3VyY2VNYXBSb290OiBudWxsLAoJICAgICAgICAgICAgc291cmNlTWFwV2l0aENvZGU6IGZhbHNlLAoJICAgICAgICAgICAgZGlyZWN0aXZlOiBmYWxzZSwKCSAgICAgICAgICAgIHJhdzogdHJ1ZSwKCSAgICAgICAgICAgIHZlcmJhdGltOiBudWxsLAoJICAgICAgICAgICAgc291cmNlQ29kZTogbnVsbAoJICAgICAgICB9OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gc3RyaW5nUmVwZWF0KHN0ciwgbnVtKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSAnJzsKCgkgICAgICAgIGZvciAobnVtIHw9IDA7IG51bSA+IDA7IG51bSA+Pj49IDEsIHN0ciArPSBzdHIpIHsKCSAgICAgICAgICAgIGlmIChudW0gJiAxKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN0cjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGhhc0xpbmVUZXJtaW5hdG9yKHN0cikgewoJICAgICAgICByZXR1cm4gKC9bXHJcbl0vZykudGVzdChzdHIpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZW5kc1dpdGhMaW5lVGVybWluYXRvcihzdHIpIHsKCSAgICAgICAgdmFyIGxlbiA9IHN0ci5sZW5ndGg7CgkgICAgICAgIHJldHVybiBsZW4gJiYgZXN1dGlscy5jb2RlLmlzTGluZVRlcm1pbmF0b3Ioc3RyLmNoYXJDb2RlQXQobGVuIC0gMSkpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gbWVyZ2UodGFyZ2V0LCBvdmVycmlkZSkgewoJICAgICAgICB2YXIga2V5OwoJICAgICAgICBmb3IgKGtleSBpbiBvdmVycmlkZSkgewoJICAgICAgICAgICAgaWYgKG92ZXJyaWRlLmhhc093blByb3BlcnR5KGtleSkpIHsKCSAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IG92ZXJyaWRlW2tleV07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRhcmdldDsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIHVwZGF0ZURlZXBseSh0YXJnZXQsIG92ZXJyaWRlKSB7CgkgICAgICAgIHZhciBrZXksIHZhbDsKCgkgICAgICAgIGZ1bmN0aW9uIGlzSGFzaE9iamVjdCh0YXJnZXQpIHsKCSAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0JyAmJiB0YXJnZXQgaW5zdGFuY2VvZiBPYmplY3QgJiYgISh0YXJnZXQgaW5zdGFuY2VvZiBSZWdFeHApOwoJICAgICAgICB9CgoJICAgICAgICBmb3IgKGtleSBpbiBvdmVycmlkZSkgewoJICAgICAgICAgICAgaWYgKG92ZXJyaWRlLmhhc093blByb3BlcnR5KGtleSkpIHsKCSAgICAgICAgICAgICAgICB2YWwgPSBvdmVycmlkZVtrZXldOwoJICAgICAgICAgICAgICAgIGlmIChpc0hhc2hPYmplY3QodmFsKSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaXNIYXNoT2JqZWN0KHRhcmdldFtrZXldKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGVlcGx5KHRhcmdldFtrZXldLCB2YWwpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSB1cGRhdGVEZWVwbHkoe30sIHZhbCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRhcmdldDsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlTnVtYmVyKHZhbHVlKSB7CgkgICAgICAgIHZhciByZXN1bHQsIHBvaW50LCB0ZW1wLCBleHBvbmVudCwgcG9zOwoKCSAgICAgICAgaWYgKHZhbHVlICE9PSB2YWx1ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOdW1lcmljIGxpdGVyYWwgd2hvc2UgdmFsdWUgaXMgTmFOJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHZhbHVlIDwgMCB8fCAodmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTnVtZXJpYyBsaXRlcmFsIHdob3NlIHZhbHVlIGlzIG5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCgkgICAgICAgIGlmICh2YWx1ZSA9PT0gMSAvIDApIHsKCSAgICAgICAgICAgIHJldHVybiBqc29uID8gJ251bGwnIDogcmVudW1iZXIgPyAnMWU0MDAnIDogJzFlKzQwMCc7CgkgICAgICAgIH0KCgkgICAgICAgIHJlc3VsdCA9ICcnICsgdmFsdWU7CgkgICAgICAgIGlmICghcmVudW1iZXIgfHwgcmVzdWx0Lmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCgkgICAgICAgIHBvaW50ID0gcmVzdWx0LmluZGV4T2YoJy4nKTsKCSAgICAgICAgaWYgKCFqc29uICYmIHJlc3VsdC5jaGFyQ29kZUF0KDApID09PSAweDMwICAvKiAwICovICYmIHBvaW50ID09PSAxKSB7CgkgICAgICAgICAgICBwb2ludCA9IDA7CgkgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuc2xpY2UoMSk7CgkgICAgICAgIH0KCSAgICAgICAgdGVtcCA9IHJlc3VsdDsKCSAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoJ2UrJywgJ2UnKTsKCSAgICAgICAgZXhwb25lbnQgPSAwOwoJICAgICAgICBpZiAoKHBvcyA9IHRlbXAuaW5kZXhPZignZScpKSA+IDApIHsKCSAgICAgICAgICAgIGV4cG9uZW50ID0gK3RlbXAuc2xpY2UocG9zICsgMSk7CgkgICAgICAgICAgICB0ZW1wID0gdGVtcC5zbGljZSgwLCBwb3MpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChwb2ludCA+PSAwKSB7CgkgICAgICAgICAgICBleHBvbmVudCAtPSB0ZW1wLmxlbmd0aCAtIHBvaW50IC0gMTsKCSAgICAgICAgICAgIHRlbXAgPSArKHRlbXAuc2xpY2UoMCwgcG9pbnQpICsgdGVtcC5zbGljZShwb2ludCArIDEpKSArICcnOwoJICAgICAgICB9CgkgICAgICAgIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlICh0ZW1wLmNoYXJDb2RlQXQodGVtcC5sZW5ndGggKyBwb3MgLSAxKSA9PT0gMHgzMCAgLyogMCAqLykgewoJICAgICAgICAgICAgLS1wb3M7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHBvcyAhPT0gMCkgewoJICAgICAgICAgICAgZXhwb25lbnQgLT0gcG9zOwoJICAgICAgICAgICAgdGVtcCA9IHRlbXAuc2xpY2UoMCwgcG9zKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZXhwb25lbnQgIT09IDApIHsKCSAgICAgICAgICAgIHRlbXAgKz0gJ2UnICsgZXhwb25lbnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCh0ZW1wLmxlbmd0aCA8IHJlc3VsdC5sZW5ndGggfHwKCSAgICAgICAgICAgICAgICAgICAgKGhleGFkZWNpbWFsICYmIHZhbHVlID4gMWUxMiAmJiBNYXRoLmZsb29yKHZhbHVlKSA9PT0gdmFsdWUgJiYgKHRlbXAgPSAnMHgnICsgdmFsdWUudG9TdHJpbmcoMTYpKS5sZW5ndGggPCByZXN1bHQubGVuZ3RoKSkgJiYKCSAgICAgICAgICAgICAgICArdGVtcCA9PT0gdmFsdWUpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IHRlbXA7CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfQoKCSAgICAvLyBHZW5lcmF0ZSB2YWxpZCBSZWdFeHAgZXhwcmVzc2lvbi4KCSAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9Db25zdGVsbGF0aW9uL2l2IEVuZ2luZQoKCSAgICBmdW5jdGlvbiBlc2NhcGVSZWdFeHBDaGFyYWN0ZXIoY2gsIHByZXZpb3VzSXNCYWNrc2xhc2gpIHsKCSAgICAgICAgLy8gbm90IGhhbmRsaW5nICdcJyBhbmQgaGFuZGxpbmcgXHUyMDI4IG9yIFx1MjAyOSB0byB1bmljb2RlIGVzY2FwZSBzZXF1ZW5jZQoJICAgICAgICBpZiAoKGNoICYgfjEpID09PSAweDIwMjgpIHsKCSAgICAgICAgICAgIHJldHVybiAocHJldmlvdXNJc0JhY2tzbGFzaCA/ICd1JyA6ICdcXHUnKSArICgoY2ggPT09IDB4MjAyOCkgPyAnMjAyOCcgOiAnMjAyOScpOwoJICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAxMCB8fCBjaCA9PT0gMTMpIHsgIC8vIFxuLCBccgoJICAgICAgICAgICAgcmV0dXJuIChwcmV2aW91c0lzQmFja3NsYXNoID8gJycgOiAnXFwnKSArICgoY2ggPT09IDEwKSA/ICduJyA6ICdyJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVSZWdFeHAocmVnKSB7CgkgICAgICAgIHZhciBtYXRjaCwgcmVzdWx0LCBmbGFncywgaSwgaXosIGNoLCBjaGFyYWN0ZXJJbkJyYWNrLCBwcmV2aW91c0lzQmFja3NsYXNoOwoKCSAgICAgICAgcmVzdWx0ID0gcmVnLnRvU3RyaW5nKCk7CgoJICAgICAgICBpZiAocmVnLnNvdXJjZSkgewoJICAgICAgICAgICAgLy8gZXh0cmFjdCBmbGFnIGZyb20gdG9TdHJpbmcgcmVzdWx0CgkgICAgICAgICAgICBtYXRjaCA9IHJlc3VsdC5tYXRjaCgvXC8oW14vXSopJC8pOwoJICAgICAgICAgICAgaWYgKCFtYXRjaCkgewoJICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgZmxhZ3MgPSBtYXRjaFsxXTsKCSAgICAgICAgICAgIHJlc3VsdCA9ICcnOwoKCSAgICAgICAgICAgIGNoYXJhY3RlckluQnJhY2sgPSBmYWxzZTsKCSAgICAgICAgICAgIHByZXZpb3VzSXNCYWNrc2xhc2ggPSBmYWxzZTsKCSAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gcmVnLnNvdXJjZS5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgY2ggPSByZWcuc291cmNlLmNoYXJDb2RlQXQoaSk7CgoJICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXNJc0JhY2tzbGFzaCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoY2hhcmFjdGVySW5CcmFjaykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA5MykgeyAgLy8gXQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3RlckluQnJhY2sgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDcpIHsgIC8vIC8KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDkxKSB7ICAvLyBbCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVySW5CcmFjayA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGVzY2FwZVJlZ0V4cENoYXJhY3RlcihjaCwgcHJldmlvdXNJc0JhY2tzbGFzaCk7CgkgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzSXNCYWNrc2xhc2ggPSBjaCA9PT0gOTI7ICAvLyBcCgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gaWYgbmV3IFJlZ0V4cCgiXFxcbicpIGlzIHByb3ZpZGVkLCBjcmVhdGUgL1xuLwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZXNjYXBlUmVnRXhwQ2hhcmFjdGVyKGNoLCBwcmV2aW91c0lzQmFja3NsYXNoKTsKCSAgICAgICAgICAgICAgICAgICAgLy8gcHJldmVudCBsaWtlIC9cXFsvXS8KCSAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNJc0JhY2tzbGFzaCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gJy8nICsgcmVzdWx0ICsgJy8nICsgZmxhZ3M7CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBlc2NhcGVBbGxvd2VkQ2hhcmFjdGVyKGNvZGUsIG5leHQpIHsKCSAgICAgICAgdmFyIGhleDsKCgkgICAgICAgIGlmIChjb2RlID09PSAweDA4ICAvKiBcYiAqLykgewoJICAgICAgICAgICAgcmV0dXJuICdcXGInOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY29kZSA9PT0gMHgwQyAgLyogXGYgKi8pIHsKCSAgICAgICAgICAgIHJldHVybiAnXFxmJzsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4MDkgIC8qIFx0ICovKSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xcdCc7CgkgICAgICAgIH0KCgkgICAgICAgIGhleCA9IGNvZGUudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7CgkgICAgICAgIGlmIChqc29uIHx8IGNvZGUgPiAweEZGKSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xcdScgKyAnMDAwMCcuc2xpY2UoaGV4Lmxlbmd0aCkgKyBoZXg7CgkgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMHgwMDAwICYmICFlc3V0aWxzLmNvZGUuaXNEZWNpbWFsRGlnaXQobmV4dCkpIHsKCSAgICAgICAgICAgIHJldHVybiAnXFwwJzsKCSAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAweDAwMEIgIC8qIFx2ICovKSB7IC8vICdcdicKCSAgICAgICAgICAgIHJldHVybiAnXFx4MEInOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgcmV0dXJuICdcXHgnICsgJzAwJy5zbGljZShoZXgubGVuZ3RoKSArIGhleDsKCSAgICAgICAgfQoJICAgIH0KCgkgICAgZnVuY3Rpb24gZXNjYXBlRGlzYWxsb3dlZENoYXJhY3Rlcihjb2RlKSB7CgkgICAgICAgIGlmIChjb2RlID09PSAweDVDICAvKiBcICovKSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xcXFwnOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY29kZSA9PT0gMHgwQSAgLyogXG4gKi8pIHsKCSAgICAgICAgICAgIHJldHVybiAnXFxuJzsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4MEQgIC8qIFxyICovKSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xccic7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChjb2RlID09PSAweDIwMjgpIHsKCSAgICAgICAgICAgIHJldHVybiAnXFx1MjAyOCc7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChjb2RlID09PSAweDIwMjkpIHsKCSAgICAgICAgICAgIHJldHVybiAnXFx1MjAyOSc7CgkgICAgICAgIH0KCgkgICAgICAgIHRocm93IG5ldyBFcnJvcignSW5jb3JyZWN0bHkgY2xhc3NpZmllZCBjaGFyYWN0ZXInKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGVzY2FwZURpcmVjdGl2ZShzdHIpIHsKCSAgICAgICAgdmFyIGksIGl6LCBjb2RlLCBxdW90ZTsKCgkgICAgICAgIHF1b3RlID0gcXVvdGVzID09PSAnZG91YmxlJyA/ICciJyA6ICdcJyc7CgkgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RyLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgIGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKCSAgICAgICAgICAgIGlmIChjb2RlID09PSAweDI3ICAvKiAnICovKSB7CgkgICAgICAgICAgICAgICAgcXVvdGUgPSAnIic7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MjIgIC8qICIgKi8pIHsKCSAgICAgICAgICAgICAgICBxdW90ZSA9ICdcJyc7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4NUMgIC8qIFwgKi8pIHsKCSAgICAgICAgICAgICAgICArK2k7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiBxdW90ZSArIHN0ciArIHF1b3RlOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZXNjYXBlU3RyaW5nKHN0cikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJycsIGksIGxlbiwgY29kZSwgc2luZ2xlUXVvdGVzID0gMCwgZG91YmxlUXVvdGVzID0gMCwgc2luZ2xlLCBxdW90ZTsKCgkgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHN0ci5sZW5ndGg7IGkgPCBsZW47ICsraSkgewoJICAgICAgICAgICAgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwoJICAgICAgICAgICAgaWYgKGNvZGUgPT09IDB4MjcgIC8qICcgKi8pIHsKCSAgICAgICAgICAgICAgICArK3NpbmdsZVF1b3RlczsKCSAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMHgyMiAgLyogIiAqLykgewoJICAgICAgICAgICAgICAgICsrZG91YmxlUXVvdGVzOwoJICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAweDJGICAvKiAvICovICYmIGpzb24pIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcJzsKCSAgICAgICAgICAgIH0gZWxzZSBpZiAoZXN1dGlscy5jb2RlLmlzTGluZVRlcm1pbmF0b3IoY29kZSkgfHwgY29kZSA9PT0gMHg1QyAgLyogXCAqLykgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlc2NhcGVEaXNhbGxvd2VkQ2hhcmFjdGVyKGNvZGUpOwoJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgfSBlbHNlIGlmICghZXN1dGlscy5jb2RlLmlzSWRlbnRpZmllclBhcnRFUzUoY29kZSkgJiYgKGpzb24gJiYgY29kZSA8IDB4MjAgIC8qIFNQICovIHx8ICFqc29uICYmICFlc2NhcGVsZXNzICYmIChjb2RlIDwgMHgyMCAgLyogU1AgKi8gfHwgY29kZSA+IDB4N0UgIC8qIH4gKi8pKSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlc2NhcGVBbGxvd2VkQ2hhcmFjdGVyKGNvZGUsIHN0ci5jaGFyQ29kZUF0KGkgKyAxKSk7CgkgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKCSAgICAgICAgfQoKCSAgICAgICAgc2luZ2xlID0gIShxdW90ZXMgPT09ICdkb3VibGUnIHx8IChxdW90ZXMgPT09ICdhdXRvJyAmJiBkb3VibGVRdW90ZXMgPCBzaW5nbGVRdW90ZXMpKTsKCSAgICAgICAgcXVvdGUgPSBzaW5nbGUgPyAnXCcnIDogJyInOwoKCSAgICAgICAgaWYgKCEoc2luZ2xlID8gc2luZ2xlUXVvdGVzIDogZG91YmxlUXVvdGVzKSkgewoJICAgICAgICAgICAgcmV0dXJuIHF1b3RlICsgcmVzdWx0ICsgcXVvdGU7CgkgICAgICAgIH0KCgkgICAgICAgIHN0ciA9IHJlc3VsdDsKCSAgICAgICAgcmVzdWx0ID0gcXVvdGU7CgoJICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzdHIubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKCSAgICAgICAgICAgIGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKCSAgICAgICAgICAgIGlmICgoY29kZSA9PT0gMHgyNyAgLyogJyAqLyAmJiBzaW5nbGUpIHx8IChjb2RlID09PSAweDIyICAvKiAiICovICYmICFzaW5nbGUpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICdcXCc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdCArIHF1b3RlOwoJICAgIH0KCgkgICAgLyoqCgkgICAgICogZmxhdHRlbiBhbiBhcnJheSB0byBhIHN0cmluZywgd2hlcmUgdGhlIGFycmF5IGNhbiBjb250YWluCgkgICAgICogZWl0aGVyIHN0cmluZ3Mgb3IgbmVzdGVkIGFycmF5cwoJICAgICAqLwoJICAgIGZ1bmN0aW9uIGZsYXR0ZW5Ub1N0cmluZyhhcnIpIHsKCSAgICAgICAgdmFyIGksIGl6LCBlbGVtLCByZXN1bHQgPSAnJzsKCSAgICAgICAgZm9yIChpID0gMCwgaXogPSBhcnIubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgZWxlbSA9IGFycltpXTsKCSAgICAgICAgICAgIHJlc3VsdCArPSBBcnJheS5pc0FycmF5KGVsZW0pID8gZmxhdHRlblRvU3RyaW5nKGVsZW0pIDogZWxlbTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0KCgkgICAgLyoqCgkgICAgICogY29udmVydCBnZW5lcmF0ZWQgdG8gYSBTb3VyY2VOb2RlIHdoZW4gc291cmNlIG1hcHMgYXJlIGVuYWJsZWQuCgkgICAgICovCgkgICAgZnVuY3Rpb24gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChnZW5lcmF0ZWQsIG5vZGUpIHsKCSAgICAgICAgaWYgKCFzb3VyY2VNYXApIHsKCSAgICAgICAgICAgIC8vIHdpdGggbm8gc291cmNlIG1hcHMsIGdlbmVyYXRlZCBpcyBlaXRoZXIgYW4KCSAgICAgICAgICAgIC8vIGFycmF5IG9yIGEgc3RyaW5nLiAgaWYgYW4gYXJyYXksIGZsYXR0ZW4gaXQuCgkgICAgICAgICAgICAvLyBpZiBhIHN0cmluZywganVzdCByZXR1cm4gaXQKCSAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGdlbmVyYXRlZCkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmxhdHRlblRvU3RyaW5nKGdlbmVyYXRlZCk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZWQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgewoJICAgICAgICAgICAgaWYgKGdlbmVyYXRlZCBpbnN0YW5jZW9mIFNvdXJjZU5vZGUpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVkOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBub2RlID0ge307CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG5vZGUubG9jID09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBuZXcgU291cmNlTm9kZShudWxsLCBudWxsLCBzb3VyY2VNYXAsIGdlbmVyYXRlZCwgbm9kZS5uYW1lIHx8IG51bGwpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgU291cmNlTm9kZShub2RlLmxvYy5zdGFydC5saW5lLCBub2RlLmxvYy5zdGFydC5jb2x1bW4sIChzb3VyY2VNYXAgPT09IHRydWUgPyBub2RlLmxvYy5zb3VyY2UgfHwgbnVsbCA6IHNvdXJjZU1hcCksIGdlbmVyYXRlZCwgbm9kZS5uYW1lIHx8IG51bGwpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gbm9FbXB0eVNwYWNlKCkgewoJICAgICAgICByZXR1cm4gKHNwYWNlKSA/IHNwYWNlIDogJyAnOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gam9pbihsZWZ0LCByaWdodCkgewoJICAgICAgICB2YXIgbGVmdFNvdXJjZSwKCSAgICAgICAgICAgIHJpZ2h0U291cmNlLAoJICAgICAgICAgICAgbGVmdENoYXJDb2RlLAoJICAgICAgICAgICAgcmlnaHRDaGFyQ29kZTsKCgkgICAgICAgIGxlZnRTb3VyY2UgPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGxlZnQpLnRvU3RyaW5nKCk7CgkgICAgICAgIGlmIChsZWZ0U291cmNlLmxlbmd0aCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIFtyaWdodF07CgkgICAgICAgIH0KCgkgICAgICAgIHJpZ2h0U291cmNlID0gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyaWdodCkudG9TdHJpbmcoKTsKCSAgICAgICAgaWYgKHJpZ2h0U291cmNlLmxlbmd0aCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIFtsZWZ0XTsKCSAgICAgICAgfQoKCSAgICAgICAgbGVmdENoYXJDb2RlID0gbGVmdFNvdXJjZS5jaGFyQ29kZUF0KGxlZnRTb3VyY2UubGVuZ3RoIC0gMSk7CgkgICAgICAgIHJpZ2h0Q2hhckNvZGUgPSByaWdodFNvdXJjZS5jaGFyQ29kZUF0KDApOwoKCSAgICAgICAgaWYgKChsZWZ0Q2hhckNvZGUgPT09IDB4MkIgIC8qICsgKi8gfHwgbGVmdENoYXJDb2RlID09PSAweDJEICAvKiAtICovKSAmJiBsZWZ0Q2hhckNvZGUgPT09IHJpZ2h0Q2hhckNvZGUgfHwKCSAgICAgICAgICAgIGVzdXRpbHMuY29kZS5pc0lkZW50aWZpZXJQYXJ0RVM1KGxlZnRDaGFyQ29kZSkgJiYgZXN1dGlscy5jb2RlLmlzSWRlbnRpZmllclBhcnRFUzUocmlnaHRDaGFyQ29kZSkgfHwKCSAgICAgICAgICAgIGxlZnRDaGFyQ29kZSA9PT0gMHgyRiAgLyogLyAqLyAmJiByaWdodENoYXJDb2RlID09PSAweDY5ICAvKiBpICovKSB7IC8vIGluZml4IHdvcmQgb3BlcmF0b3JzIGFsbCBzdGFydCB3aXRoIGBpYAoJICAgICAgICAgICAgcmV0dXJuIFtsZWZ0LCBub0VtcHR5U3BhY2UoKSwgcmlnaHRdOwoJICAgICAgICB9IGVsc2UgaWYgKGVzdXRpbHMuY29kZS5pc1doaXRlU3BhY2UobGVmdENoYXJDb2RlKSB8fCBlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihsZWZ0Q2hhckNvZGUpIHx8CgkgICAgICAgICAgICAgICAgZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShyaWdodENoYXJDb2RlKSB8fCBlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihyaWdodENoYXJDb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIFtsZWZ0LCByaWdodF07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtsZWZ0LCBzcGFjZSwgcmlnaHRdOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gYWRkSW5kZW50KHN0bXQpIHsKCSAgICAgICAgcmV0dXJuIFtiYXNlLCBzdG10XTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIHdpdGhJbmRlbnQoZm4pIHsKCSAgICAgICAgdmFyIHByZXZpb3VzQmFzZTsKCSAgICAgICAgcHJldmlvdXNCYXNlID0gYmFzZTsKCSAgICAgICAgYmFzZSArPSBpbmRlbnQ7CgkgICAgICAgIGZuKGJhc2UpOwoJICAgICAgICBiYXNlID0gcHJldmlvdXNCYXNlOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gY2FsY3VsYXRlU3BhY2VzKHN0cikgewoJICAgICAgICB2YXIgaTsKCSAgICAgICAgZm9yIChpID0gc3RyLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CgkgICAgICAgICAgICBpZiAoZXN1dGlscy5jb2RlLmlzTGluZVRlcm1pbmF0b3Ioc3RyLmNoYXJDb2RlQXQoaSkpKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIChzdHIubGVuZ3RoIC0gMSkgLSBpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gYWRqdXN0TXVsdGlsaW5lQ29tbWVudCh2YWx1ZSwgc3BlY2lhbEJhc2UpIHsKCSAgICAgICAgdmFyIGFycmF5LCBpLCBsZW4sIGxpbmUsIGosIHNwYWNlcywgcHJldmlvdXNCYXNlLCBzbjsKCgkgICAgICAgIGFycmF5ID0gdmFsdWUuc3BsaXQoL1xyXG58W1xyXG5dLyk7CgkgICAgICAgIHNwYWNlcyA9IE51bWJlci5NQVhfVkFMVUU7CgoJICAgICAgICAvLyBmaXJzdCBsaW5lIGRvZXNuJ3QgaGF2ZSBpbmRlbnRhdGlvbgoJICAgICAgICBmb3IgKGkgPSAxLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47ICsraSkgewoJICAgICAgICAgICAgbGluZSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgaiA9IDA7CgkgICAgICAgICAgICB3aGlsZSAoaiA8IGxpbmUubGVuZ3RoICYmIGVzdXRpbHMuY29kZS5pc1doaXRlU3BhY2UobGluZS5jaGFyQ29kZUF0KGopKSkgewoJICAgICAgICAgICAgICAgICsrajsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChzcGFjZXMgPiBqKSB7CgkgICAgICAgICAgICAgICAgc3BhY2VzID0gajsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgaWYgKHR5cGVvZiBzcGVjaWFsQmFzZSAhPT0gJ3VuZGVmaW5lZCcpIHsKCSAgICAgICAgICAgIC8vIHBhdHRlcm4gbGlrZQoJICAgICAgICAgICAgLy8gewoJICAgICAgICAgICAgLy8gICB2YXIgdCA9IDIwOyAgLyoKCSAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAqIHRoaXMgaXMgY29tbWVudAoJICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICBwcmV2aW91c0Jhc2UgPSBiYXNlOwoJICAgICAgICAgICAgaWYgKGFycmF5WzFdW3NwYWNlc10gPT09ICcqJykgewoJICAgICAgICAgICAgICAgIHNwZWNpYWxCYXNlICs9ICcgJzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGJhc2UgPSBzcGVjaWFsQmFzZTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIGlmIChzcGFjZXMgJiAxKSB7CgkgICAgICAgICAgICAgICAgLy8gLyoKCSAgICAgICAgICAgICAgICAvLyAgKgoJICAgICAgICAgICAgICAgIC8vICAqLwoJICAgICAgICAgICAgICAgIC8vIElmIHNwYWNlcyBhcmUgb2RkIG51bWJlciwgYWJvdmUgcGF0dGVybiBpcyBjb25zaWRlcmVkLgoJICAgICAgICAgICAgICAgIC8vIFdlIHdhc3RlIDEgc3BhY2UuCgkgICAgICAgICAgICAgICAgLS1zcGFjZXM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBwcmV2aW91c0Jhc2UgPSBiYXNlOwoJICAgICAgICB9CgoJICAgICAgICBmb3IgKGkgPSAxLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47ICsraSkgewoJICAgICAgICAgICAgc24gPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGFkZEluZGVudChhcnJheVtpXS5zbGljZShzcGFjZXMpKSk7CgkgICAgICAgICAgICBhcnJheVtpXSA9IHNvdXJjZU1hcCA/IHNuLmpvaW4oJycpIDogc247CgkgICAgICAgIH0KCgkgICAgICAgIGJhc2UgPSBwcmV2aW91c0Jhc2U7CgoJICAgICAgICByZXR1cm4gYXJyYXkuam9pbignXG4nKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ29tbWVudChjb21tZW50LCBzcGVjaWFsQmFzZSkgewoJICAgICAgICBpZiAoY29tbWVudC50eXBlID09PSAnTGluZScpIHsKCSAgICAgICAgICAgIGlmIChlbmRzV2l0aExpbmVUZXJtaW5hdG9yKGNvbW1lbnQudmFsdWUpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuICcvLycgKyBjb21tZW50LnZhbHVlOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBBbHdheXMgdXNlIExpbmVUZXJtaW5hdG9yCgkgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICcvLycgKyBjb21tZW50LnZhbHVlOwoJICAgICAgICAgICAgICAgIGlmICghcHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXG4nOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChleHRyYS5mb3JtYXQuaW5kZW50LmFkanVzdE11bHRpbGluZUNvbW1lbnQgJiYgL1tcblxyXS8udGVzdChjb21tZW50LnZhbHVlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGFkanVzdE11bHRpbGluZUNvbW1lbnQoJy8qJyArIGNvbW1lbnQudmFsdWUgKyAnKi8nLCBzcGVjaWFsQmFzZSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuICcvKicgKyBjb21tZW50LnZhbHVlICsgJyovJzsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGFkZENvbW1lbnRzKHN0bXQsIHJlc3VsdCkgewoJICAgICAgICB2YXIgaSwgbGVuLCBjb21tZW50LCBzYXZlLCB0YWlsaW5nVG9TdGF0ZW1lbnQsIHNwZWNpYWxCYXNlLCBmcmFnbWVudCwKCSAgICAgICAgICAgIGV4dFJhbmdlLCByYW5nZSwgcHJldlJhbmdlLCBwcmVmaXgsIGluZml4LCBzdWZmaXgsIGNvdW50OwoKCSAgICAgICAgaWYgKHN0bXQubGVhZGluZ0NvbW1lbnRzICYmIHN0bXQubGVhZGluZ0NvbW1lbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHNhdmUgPSByZXN1bHQ7CgoJICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBzdG10LmxlYWRpbmdDb21tZW50c1swXTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKCgkgICAgICAgICAgICAgICAgZXh0UmFuZ2UgPSBjb21tZW50LmV4dGVuZGVkUmFuZ2U7CgkgICAgICAgICAgICAgICAgcmFuZ2UgPSBjb21tZW50LnJhbmdlOwoKCSAgICAgICAgICAgICAgICBwcmVmaXggPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhleHRSYW5nZVswXSwgcmFuZ2VbMF0pOwoJICAgICAgICAgICAgICAgIGNvdW50ID0gKHByZWZpeC5tYXRjaCgvXG4vZykgfHwgW10pLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0cmluZ1JlcGVhdCgnXG4nLCBjb3VudCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQoZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocHJlZml4KTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHByZXZSYW5nZSA9IHJhbmdlOwoKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAxLCBsZW4gPSBzdG10LmxlYWRpbmdDb21tZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgICAgICAgICAgICAgICAgICBjb21tZW50ID0gc3RtdC5sZWFkaW5nQ29tbWVudHNbaV07CgkgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gY29tbWVudC5yYW5nZTsKCgkgICAgICAgICAgICAgICAgICAgIGluZml4ID0gc291cmNlQ29kZS5zdWJzdHJpbmcocHJldlJhbmdlWzFdLCByYW5nZVswXSk7CgkgICAgICAgICAgICAgICAgICAgIGNvdW50ID0gKGluZml4Lm1hdGNoKC9cbi9nKSB8fCBbXSkubGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzdHJpbmdSZXBlYXQoJ1xuJywgY291bnQpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KGdlbmVyYXRlQ29tbWVudChjb21tZW50KSkpOwoKCSAgICAgICAgICAgICAgICAgICAgcHJldlJhbmdlID0gcmFuZ2U7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBzdWZmaXggPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhyYW5nZVsxXSwgZXh0UmFuZ2VbMV0pOwoJICAgICAgICAgICAgICAgIGNvdW50ID0gKHN1ZmZpeC5tYXRjaCgvXG4vZykgfHwgW10pLmxlbmd0aDsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzdHJpbmdSZXBlYXQoJ1xuJywgY291bnQpKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgY29tbWVudCA9IHN0bXQubGVhZGluZ0NvbW1lbnRzWzBdOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwoJICAgICAgICAgICAgICAgIGlmIChzYWZlQ29uY2F0ZW5hdGlvbiAmJiBzdG10LnR5cGUgPT09IFN5bnRheC5Qcm9ncmFtICYmIHN0bXQuYm9keS5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJ1xuJyk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGdlbmVyYXRlQ29tbWVudChjb21tZW50KSk7CgkgICAgICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnXG4nKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDEsIGxlbiA9IHN0bXQubGVhZGluZ0NvbW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBzdG10LmxlYWRpbmdDb21tZW50c1tpXTsKCSAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBbZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQoZnJhZ21lbnQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5wdXNoKCdcbicpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudChmcmFnbWVudCkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQoc2F2ZSkpOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoc3RtdC50cmFpbGluZ0NvbW1lbnRzKSB7CgoJICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBzdG10LnRyYWlsaW5nQ29tbWVudHNbMF07CgkgICAgICAgICAgICAgICAgZXh0UmFuZ2UgPSBjb21tZW50LmV4dGVuZGVkUmFuZ2U7CgkgICAgICAgICAgICAgICAgcmFuZ2UgPSBjb21tZW50LnJhbmdlOwoKCSAgICAgICAgICAgICAgICBwcmVmaXggPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhleHRSYW5nZVswXSwgcmFuZ2VbMF0pOwoJICAgICAgICAgICAgICAgIGNvdW50ID0gKHByZWZpeC5tYXRjaCgvXG4vZykgfHwgW10pLmxlbmd0aDsKCgkgICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzdHJpbmdSZXBlYXQoJ1xuJywgY291bnQpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KGdlbmVyYXRlQ29tbWVudChjb21tZW50KSkpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHByZWZpeCk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGdlbmVyYXRlQ29tbWVudChjb21tZW50KSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICB0YWlsaW5nVG9TdGF0ZW1lbnQgPSAhZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKSk7CgkgICAgICAgICAgICAgICAgc3BlY2lhbEJhc2UgPSBzdHJpbmdSZXBlYXQoJyAnLCBjYWxjdWxhdGVTcGFjZXModG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChbYmFzZSwgcmVzdWx0LCBpbmRlbnRdKS50b1N0cmluZygpKSk7CgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gc3RtdC50cmFpbGluZ0NvbW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBzdG10LnRyYWlsaW5nQ29tbWVudHNbaV07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0YWlsaW5nVG9TdGF0ZW1lbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGFzc3VtZSB0YXJnZXQgbGlrZSBmb2xsb3dpbmcgc2NyaXB0CgkgICAgICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmFyIHQgPSAyMDsgIC8qKgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAqIFRoaXMgaXMgY29tbWVudCBvZiB0CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICovCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGNhc2UKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBbcmVzdWx0LCBpbmRlbnRdOwoJICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBbcmVzdWx0LCBzcGVjaWFsQmFzZV07CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZUNvbW1lbnQoY29tbWVudCwgc3BlY2lhbEJhc2UpKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtyZXN1bHQsIGFkZEluZGVudChnZW5lcmF0ZUNvbW1lbnQoY29tbWVudCkpXTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSAmJiAhZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtyZXN1bHQsICdcbiddOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVCbGFua0xpbmVzKHN0YXJ0LCBlbmQsIHJlc3VsdCkgewoJICAgICAgICB2YXIgaiwgbmV3bGluZUNvdW50ID0gMDsKCgkgICAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDwgZW5kOyBqKyspIHsKCSAgICAgICAgICAgIGlmIChzb3VyY2VDb2RlW2pdID09PSAnXG4nKSB7CgkgICAgICAgICAgICAgICAgbmV3bGluZUNvdW50Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIGZvciAoaiA9IDE7IGogPCBuZXdsaW5lQ291bnQ7IGorKykgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgIH0KCSAgICB9CgoJICAgIGZ1bmN0aW9uIHBhcmVudGhlc2l6ZSh0ZXh0LCBjdXJyZW50LCBzaG91bGQpIHsKCSAgICAgICAgaWYgKGN1cnJlbnQgPCBzaG91bGQpIHsKCSAgICAgICAgICAgIHJldHVybiBbJygnLCB0ZXh0LCAnKSddOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0ZXh0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVWZXJiYXRpbVN0cmluZyhzdHJpbmcpIHsKCSAgICAgICAgdmFyIGksIGl6LCByZXN1bHQ7CgkgICAgICAgIHJlc3VsdCA9IHN0cmluZy5zcGxpdCgvXHJcbnxcbi8pOwoJICAgICAgICBmb3IgKGkgPSAxLCBpeiA9IHJlc3VsdC5sZW5ndGg7IGkgPCBpejsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHRbaV0gPSBuZXdsaW5lICsgYmFzZSArIHJlc3VsdFtpXTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVWZXJiYXRpbShleHByLCBwcmVjZWRlbmNlKSB7CgkgICAgICAgIHZhciB2ZXJiYXRpbSwgcmVzdWx0LCBwcmVjOwoJICAgICAgICB2ZXJiYXRpbSA9IGV4cHJbZXh0cmEudmVyYmF0aW1dOwoKCSAgICAgICAgaWYgKHR5cGVvZiB2ZXJiYXRpbSA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IHBhcmVudGhlc2l6ZShnZW5lcmF0ZVZlcmJhdGltU3RyaW5nKHZlcmJhdGltKSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAvLyB2ZXJiYXRpbSBpcyBvYmplY3QKCSAgICAgICAgICAgIHJlc3VsdCA9IGdlbmVyYXRlVmVyYmF0aW1TdHJpbmcodmVyYmF0aW0uY29udGVudCk7CgkgICAgICAgICAgICBwcmVjID0gKHZlcmJhdGltLnByZWNlZGVuY2UgIT0gbnVsbCkgPyB2ZXJiYXRpbS5wcmVjZWRlbmNlIDogUHJlY2VkZW5jZS5TZXF1ZW5jZTsKCSAgICAgICAgICAgIHJlc3VsdCA9IHBhcmVudGhlc2l6ZShyZXN1bHQsIHByZWMsIHByZWNlZGVuY2UpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQsIGV4cHIpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gQ29kZUdlbmVyYXRvcigpIHsKCSAgICB9CgoJICAgIC8vIEhlbHBlcnMuCgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLm1heWJlQmxvY2sgPSBmdW5jdGlvbihzdG10LCBmbGFncykgewoJICAgICAgICB2YXIgcmVzdWx0LCBub0xlYWRpbmdDb21tZW50LCB0aGF0ID0gdGhpczsKCgkgICAgICAgIG5vTGVhZGluZ0NvbW1lbnQgPSAhZXh0cmEuY29tbWVudCB8fCAhc3RtdC5sZWFkaW5nQ29tbWVudHM7CgoJICAgICAgICBpZiAoc3RtdC50eXBlID09PSBTeW50YXguQmxvY2tTdGF0ZW1lbnQgJiYgbm9MZWFkaW5nQ29tbWVudCkgewoJICAgICAgICAgICAgcmV0dXJuIFtzcGFjZSwgdGhpcy5nZW5lcmF0ZVN0YXRlbWVudChzdG10LCBmbGFncyldOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoc3RtdC50eXBlID09PSBTeW50YXguRW1wdHlTdGF0ZW1lbnQgJiYgbm9MZWFkaW5nQ29tbWVudCkgewoJICAgICAgICAgICAgcmV0dXJuICc7JzsKCSAgICAgICAgfQoKCSAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBbCgkgICAgICAgICAgICAgICAgbmV3bGluZSwKCSAgICAgICAgICAgICAgICBhZGRJbmRlbnQodGhhdC5nZW5lcmF0ZVN0YXRlbWVudChzdG10LCBmbGFncykpCgkgICAgICAgICAgICBdOwoJICAgICAgICB9KTsKCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUubWF5YmVCbG9ja1N1ZmZpeCA9IGZ1bmN0aW9uIChzdG10LCByZXN1bHQpIHsKCSAgICAgICAgdmFyIGVuZHMgPSBlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKTsKCSAgICAgICAgaWYgKHN0bXQudHlwZSA9PT0gU3ludGF4LkJsb2NrU3RhdGVtZW50ICYmICghZXh0cmEuY29tbWVudCB8fCAhc3RtdC5sZWFkaW5nQ29tbWVudHMpICYmICFlbmRzKSB7CgkgICAgICAgICAgICByZXR1cm4gW3Jlc3VsdCwgc3BhY2VdOwoJICAgICAgICB9CgkgICAgICAgIGlmIChlbmRzKSB7CgkgICAgICAgICAgICByZXR1cm4gW3Jlc3VsdCwgYmFzZV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtyZXN1bHQsIG5ld2xpbmUsIGJhc2VdOwoJICAgIH07CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlSWRlbnRpZmllcihub2RlKSB7CgkgICAgICAgIHJldHVybiB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKG5vZGUubmFtZSwgbm9kZSk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZUFzeW5jUHJlZml4KG5vZGUsIHNwYWNlUmVxdWlyZWQpIHsKCSAgICAgICAgcmV0dXJuIG5vZGUuYXN5bmMgPyAnYXN5bmMnICsgKHNwYWNlUmVxdWlyZWQgPyBub0VtcHR5U3BhY2UoKSA6IHNwYWNlKSA6ICcnOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVTdGFyU3VmZml4KG5vZGUpIHsKCSAgICAgICAgdmFyIGlzR2VuZXJhdG9yID0gbm9kZS5nZW5lcmF0b3IgJiYgIWV4dHJhLm1vei5zdGFybGVzc0dlbmVyYXRvcjsKCSAgICAgICAgcmV0dXJuIGlzR2VuZXJhdG9yID8gJyonICsgc3BhY2UgOiAnJzsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlTWV0aG9kUHJlZml4KHByb3ApIHsKCSAgICAgICAgdmFyIGZ1bmMgPSBwcm9wLnZhbHVlLCBwcmVmaXggPSAnJzsKCSAgICAgICAgaWYgKGZ1bmMuYXN5bmMpIHsKCSAgICAgICAgICAgIHByZWZpeCArPSBnZW5lcmF0ZUFzeW5jUHJlZml4KGZ1bmMsICFwcm9wLmNvbXB1dGVkKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZnVuYy5nZW5lcmF0b3IpIHsKCSAgICAgICAgICAgIC8vIGF2b2lkIHNwYWNlIGJlZm9yZSBtZXRob2QgbmFtZQoJICAgICAgICAgICAgcHJlZml4ICs9IGdlbmVyYXRlU3RhclN1ZmZpeChmdW5jKSA/ICcqJyA6ICcnOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBwcmVmaXg7CgkgICAgfQoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZVBhdHRlcm4gPSBmdW5jdGlvbiAobm9kZSwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gU3ludGF4LklkZW50aWZpZXIpIHsKCSAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUlkZW50aWZpZXIobm9kZSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKG5vZGUsIHByZWNlZGVuY2UsIGZsYWdzKTsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUZ1bmN0aW9uUGFyYW1zID0gZnVuY3Rpb24gKG5vZGUpIHsKCSAgICAgICAgdmFyIGksIGl6LCByZXN1bHQsIGhhc0RlZmF1bHQ7CgoJICAgICAgICBoYXNEZWZhdWx0ID0gZmFsc2U7CgoJICAgICAgICBpZiAobm9kZS50eXBlID09PSBTeW50YXguQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24gJiYKCSAgICAgICAgICAgICAgICAhbm9kZS5yZXN0ICYmICghbm9kZS5kZWZhdWx0cyB8fCBub2RlLmRlZmF1bHRzLmxlbmd0aCA9PT0gMCkgJiYKCSAgICAgICAgICAgICAgICBub2RlLnBhcmFtcy5sZW5ndGggPT09IDEgJiYgbm9kZS5wYXJhbXNbMF0udHlwZSA9PT0gU3ludGF4LklkZW50aWZpZXIpIHsKCSAgICAgICAgICAgIC8vIGFyZyA9PiB7IH0gY2FzZQoJICAgICAgICAgICAgcmVzdWx0ID0gW2dlbmVyYXRlQXN5bmNQcmVmaXgobm9kZSwgdHJ1ZSksIGdlbmVyYXRlSWRlbnRpZmllcihub2RlLnBhcmFtc1swXSldOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS50eXBlID09PSBTeW50YXguQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24gPyBbZ2VuZXJhdGVBc3luY1ByZWZpeChub2RlLCBmYWxzZSldIDogW107CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnKCcpOwoJICAgICAgICAgICAgaWYgKG5vZGUuZGVmYXVsdHMpIHsKCSAgICAgICAgICAgICAgICBoYXNEZWZhdWx0ID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gbm9kZS5wYXJhbXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgIGlmIChoYXNEZWZhdWx0ICYmIG5vZGUuZGVmYXVsdHNbaV0pIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIGRlZmF1bHQgdmFsdWVzLgoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlQXNzaWdubWVudChub2RlLnBhcmFtc1tpXSwgbm9kZS5kZWZhdWx0c1tpXSwgJz0nLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZVBhdHRlcm4obm9kZS5wYXJhbXNbaV0sIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXopIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAobm9kZS5yZXN0KSB7CgkgICAgICAgICAgICAgICAgaWYgKG5vZGUucGFyYW1zLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcuLi4nKTsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZUlkZW50aWZpZXIobm9kZS5yZXN0KSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJyknKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUZ1bmN0aW9uQm9keSA9IGZ1bmN0aW9uIChub2RlKSB7CgkgICAgICAgIHZhciByZXN1bHQsIGV4cHI7CgoJICAgICAgICByZXN1bHQgPSB0aGlzLmdlbmVyYXRlRnVuY3Rpb25QYXJhbXMobm9kZSk7CgoJICAgICAgICBpZiAobm9kZS50eXBlID09PSBTeW50YXguQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24pIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNwYWNlKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCc9PicpOwoJICAgICAgICB9CgoJICAgICAgICBpZiAobm9kZS5leHByZXNzaW9uKSB7CgkgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSk7CgkgICAgICAgICAgICBleHByID0gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24obm9kZS5ib2R5LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKTsKCSAgICAgICAgICAgIGlmIChleHByLnRvU3RyaW5nKCkuY2hhckF0KDApID09PSAneycpIHsKCSAgICAgICAgICAgICAgICBleHByID0gWycoJywgZXhwciwgJyknXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGV4cHIpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKG5vZGUuYm9keSwgU19UVEZGKSk7CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVJdGVyYXRpb25Gb3JTdGF0ZW1lbnQgPSBmdW5jdGlvbiAob3BlcmF0b3IsIHN0bXQsIGZsYWdzKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSBbJ2ZvcicgKyAoc3RtdC5hd2FpdCA/IG5vRW1wdHlTcGFjZSgpICsgJ2F3YWl0JyA6ICcnKSArIHNwYWNlICsgJygnXSwgdGhhdCA9IHRoaXM7CgkgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKHN0bXQubGVmdC50eXBlID09PSBTeW50YXguVmFyaWFibGVEZWNsYXJhdGlvbikgewoJICAgICAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzdG10LmxlZnQua2luZCArIG5vRW1wdHlTcGFjZSgpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmxlZnQuZGVjbGFyYXRpb25zWzBdLCBTX0ZGRkYpKTsKCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5sZWZ0LCBQcmVjZWRlbmNlLkNhbGwsIEVfVFRUKSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIG9wZXJhdG9yKTsKCSAgICAgICAgICAgIHJlc3VsdCA9IFtqb2luKAoJICAgICAgICAgICAgICAgIHJlc3VsdCwKCSAgICAgICAgICAgICAgICB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnJpZ2h0LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKQoJICAgICAgICAgICAgKSwgJyknXTsKCSAgICAgICAgfSk7CgkgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIGZsYWdzKSk7CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVQcm9wZXJ0eUtleSA9IGZ1bmN0aW9uIChleHByLCBjb21wdXRlZCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gW107CgoJICAgICAgICBpZiAoY29tcHV0ZWQpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdbJyk7CgkgICAgICAgIH0KCgkgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpKTsKCgkgICAgICAgIGlmIChjb21wdXRlZCkgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJ10nKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUFzc2lnbm1lbnQgPSBmdW5jdGlvbiAobGVmdCwgcmlnaHQsIG9wZXJhdG9yLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICBpZiAoUHJlY2VkZW5jZS5Bc3NpZ25tZW50IDwgcHJlY2VkZW5jZSkgewoJICAgICAgICAgICAgZmxhZ3MgfD0gRl9BTExPV19JTjsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZSgKCSAgICAgICAgICAgIFsKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihsZWZ0LCBQcmVjZWRlbmNlLkNhbGwsIGZsYWdzKSwKCSAgICAgICAgICAgICAgICBzcGFjZSArIG9wZXJhdG9yICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24ocmlnaHQsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgZmxhZ3MpCgkgICAgICAgICAgICBdLAoJICAgICAgICAgICAgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LAoJICAgICAgICAgICAgcHJlY2VkZW5jZQoJICAgICAgICApOwoJICAgIH07CgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLnNlbWljb2xvbiA9IGZ1bmN0aW9uIChmbGFncykgewoJICAgICAgICBpZiAoIXNlbWljb2xvbnMgJiYgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQpIHsKCSAgICAgICAgICAgIHJldHVybiAnJzsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gJzsnOwoJICAgIH07CgoJICAgIC8vIFN0YXRlbWVudHMuCgoJICAgIENvZGVHZW5lcmF0b3IuU3RhdGVtZW50ID0gewoKCSAgICAgICAgQmxvY2tTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJhbmdlLCBjb250ZW50LCByZXN1bHQgPSBbJ3snLCBuZXdsaW5lXSwgdGhhdCA9IHRoaXM7CgoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGZ1bmN0aW9ucyB3aXRob3V0IGFueSBjb2RlCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQuYm9keS5sZW5ndGggPT09IDAgJiYgcHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gc3RtdC5yYW5nZTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlWzFdIC0gcmFuZ2VbMF0gPiAyKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gc291cmNlQ29kZS5zdWJzdHJpbmcocmFuZ2VbMF0gKyAxLCByYW5nZVsxXSAtIDEpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRbMF0gPT09ICdcbicpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBbJ3snXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNvbnRlbnQpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICB2YXIgaSwgaXosIGZyYWdtZW50LCBib2R5RmxhZ3M7CgkgICAgICAgICAgICAgICAgYm9keUZsYWdzID0gU19URkZGOwoJICAgICAgICAgICAgICAgIGlmIChmbGFncyAmIEZfRlVOQ19CT0RZKSB7CgkgICAgICAgICAgICAgICAgICAgIGJvZHlGbGFncyB8PSBGX0RJUkVDVElWRV9DVFg7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IHN0bXQuYm9keS5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBzcGFjZXMgYmVmb3JlIHRoZSBmaXJzdCBsaW5lCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmJvZHlbMF0ubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gc3RtdC5ib2R5WzBdLmxlYWRpbmdDb21tZW50c1swXS5leHRlbmRlZFJhbmdlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gc291cmNlQ29kZS5zdWJzdHJpbmcocmFuZ2VbMF0sIHJhbmdlWzFdKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRbMF0gPT09ICdcbicpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsneyddOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5WzBdLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZUJsYW5rTGluZXMoc3RtdC5yYW5nZVswXSwgc3RtdC5ib2R5WzBdLnJhbmdlWzBdLCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgc3BhY2VzIGJldHdlZW4gbGluZXMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5W2kgLSAxXS50cmFpbGluZ0NvbW1lbnRzICAmJiAhc3RtdC5ib2R5W2ldLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZUJsYW5rTGluZXMoc3RtdC5ib2R5W2kgLSAxXS5yYW5nZVsxXSwgc3RtdC5ib2R5W2ldLnJhbmdlWzBdLCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IGl6IC0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKHN0bXQuYm9keVtpXS5sZWFkaW5nQ29tbWVudHMgJiYgcHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5ib2R5W2ldLCBib2R5RmxhZ3MpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBhZGRJbmRlbnQodGhhdC5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmJvZHlbaV0sIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmICghZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGZyYWdtZW50KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcyAmJiBpIDwgaXogLSAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgYWRkIGEgbmV3IGxpbmUgaWYgdGhlcmUgYXJlIGxlYWRpbmcgY29tZW50cwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIHRoZSBuZXh0IHN0YXRlbWVudAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5W2kgKyAxXS5sZWFkaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNwYWNlcyBhZnRlciB0aGUgbGFzdCBsaW5lCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaXogLSAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbaV0udHJhaWxpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZUJsYW5rTGluZXMoc3RtdC5ib2R5W2ldLnJhbmdlWzFdLCBzdG10LnJhbmdlWzFdLCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudCgnfScpKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBCcmVha1N0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoc3RtdC5sYWJlbCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAnYnJlYWsgJyArIHN0bXQubGFiZWwubmFtZSArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiAnYnJlYWsnICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgQ29udGludWVTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgaWYgKHN0bXQubGFiZWwpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gJ2NvbnRpbnVlICcgKyBzdG10LmxhYmVsLm5hbWUgKyB0aGlzLnNlbWljb2xvbihmbGFncyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gJ2NvbnRpbnVlJyArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIENsYXNzQm9keTogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWyAneycsIG5ld2xpbmVdLCB0aGF0ID0gdGhpczsKCgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uIChpbmRlbnQpIHsKCSAgICAgICAgICAgICAgICB2YXIgaSwgaXo7CgoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RtdC5ib2R5Lmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaW5kZW50KTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5ib2R5W2ldLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChiYXNlKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCd9Jyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgQ2xhc3NEZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudDsKCSAgICAgICAgICAgIHJlc3VsdCAgPSBbJ2NsYXNzJ107CgkgICAgICAgICAgICBpZiAoc3RtdC5pZCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmlkLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKHN0bXQuc3VwZXJDbGFzcykgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gam9pbignZXh0ZW5kcycsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3VwZXJDbGFzcywgUHJlY2VkZW5jZS5VbmFyeSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgZnJhZ21lbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmJvZHksIFNfVEZGVCkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIERpcmVjdGl2ZVN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoZXh0cmEucmF3ICYmIHN0bXQucmF3KSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHN0bXQucmF3ICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGVzY2FwZURpcmVjdGl2ZShzdG10LmRpcmVjdGl2ZSkgKyB0aGlzLnNlbWljb2xvbihmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBEb1doaWxlU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIC8vIEJlY2F1c2UgYGRvIDQyIHdoaWxlIChjb25kKWAgaXMgU3ludGF4IEVycm9yLiBXZSBuZWVkIHNlbWljb2xvbi4KCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBqb2luKCdkbycsIHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIFNfVEZGRikpOwoJICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5tYXliZUJsb2NrU3VmZml4KHN0bXQuYm9keSwgcmVzdWx0KTsKCSAgICAgICAgICAgIHJldHVybiBqb2luKHJlc3VsdCwgWwoJICAgICAgICAgICAgICAgICd3aGlsZScgKyBzcGFjZSArICcoJywKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnRlc3QsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAnKScgKyB0aGlzLnNlbWljb2xvbihmbGFncykKCSAgICAgICAgICAgIF0pOwoJICAgICAgICB9LAoKCSAgICAgICAgQ2F0Y2hDbGF1c2U6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgdGhhdCA9IHRoaXM7CgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICB2YXIgZ3VhcmQ7CgoJICAgICAgICAgICAgICAgIGlmIChzdG10LnBhcmFtKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgICAgICdjYXRjaCcgKyBzcGFjZSArICcoJywKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQucGFyYW0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgICAgICcpJwoJICAgICAgICAgICAgICAgICAgICBdOwoKCSAgICAgICAgICAgICAgICAgICAgaWYgKHN0bXQuZ3VhcmQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGd1YXJkID0gdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5ndWFyZCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNwbGljZSgyLCAwLCAnIGlmICcsIGd1YXJkKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsnY2F0Y2gnXTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIFNfVEZGRikpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIERlYnVnZ2VyU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiAnZGVidWdnZXInICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgRW1wdHlTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuICc7JzsKCSAgICAgICAgfSwKCgkgICAgICAgIEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWyAnZXhwb3J0JyBdLCBib2R5RmxhZ3M7CgoJICAgICAgICAgICAgYm9keUZsYWdzID0gKGZsYWdzICYgRl9TRU1JQ09MT05fT1BUKSA/IFNfVEZGVCA6IFNfVEZGRjsKCgkgICAgICAgICAgICAvLyBleHBvcnQgZGVmYXVsdCBIb2lzdGFibGVEZWNsYXJhdGlvbltEZWZhdWx0XQoJICAgICAgICAgICAgLy8gZXhwb3J0IGRlZmF1bHQgQXNzaWdubWVudEV4cHJlc3Npb25bSW5dIDsKCSAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCAnZGVmYXVsdCcpOwoJICAgICAgICAgICAgaWYgKGlzU3RhdGVtZW50KHN0bXQuZGVjbGFyYXRpb24pKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5kZWNsYXJhdGlvbiwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmRlY2xhcmF0aW9uLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKSArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRXhwb3J0TmFtZWREZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWyAnZXhwb3J0JyBdLCBib2R5RmxhZ3MsIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgICAgIGJvZHlGbGFncyA9IChmbGFncyAmIEZfU0VNSUNPTE9OX09QVCkgPyBTX1RGRlQgOiBTX1RGRkY7CgoJICAgICAgICAgICAgLy8gZXhwb3J0IFZhcmlhYmxlU3RhdGVtZW50CgkgICAgICAgICAgICAvLyBleHBvcnQgRGVjbGFyYXRpb25bRGVmYXVsdF0KCSAgICAgICAgICAgIGlmIChzdG10LmRlY2xhcmF0aW9uKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuZGVjbGFyYXRpb24sIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIGV4cG9ydCBFeHBvcnRDbGF1c2VbTm9SZWZlcmVuY2VdIEZyb21DbGF1c2UgOwoJICAgICAgICAgICAgLy8gZXhwb3J0IEV4cG9ydENsYXVzZSA7CgkgICAgICAgICAgICBpZiAoc3RtdC5zcGVjaWZpZXJzKSB7CgkgICAgICAgICAgICAgICAgaWYgKHN0bXQuc3BlY2lmaWVycy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsICd7JyArIHNwYWNlICsgJ30nKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0bXQuc3BlY2lmaWVyc1swXS50eXBlID09PSBTeW50YXguRXhwb3J0QmF0Y2hTcGVjaWZpZXIpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3BlY2lmaWVyc1swXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgJ3snKTsKCSAgICAgICAgICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoaW5kZW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSwgaXo7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RtdC5zcGVjaWZpZXJzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpbmRlbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3BlY2lmaWVyc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChiYXNlICsgJ30nKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChzdG10LnNvdXJjZSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgWwoJICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20nICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBNb2R1bGVTcGVjaWZpZXIKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc291cmNlLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCksCgkgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbWljb2xvbihmbGFncykKCSAgICAgICAgICAgICAgICAgICAgXSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5zZW1pY29sb24oZmxhZ3MpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRXhwb3J0QWxsRGVjbGFyYXRpb246IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgLy8gZXhwb3J0ICogRnJvbUNsYXVzZSA7CgkgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgICdleHBvcnQnICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgJyonICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgJ2Zyb20nICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgLy8gTW9kdWxlU3BlY2lmaWVyCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zb3VyY2UsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICB0aGlzLnNlbWljb2xvbihmbGFncykKCSAgICAgICAgICAgIF07CgkgICAgICAgIH0sCgoJICAgICAgICBFeHByZXNzaW9uU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50OwoKCSAgICAgICAgICAgIGZ1bmN0aW9uIGlzQ2xhc3NQcmVmaXhlZChmcmFnbWVudCkgewoJICAgICAgICAgICAgICAgIHZhciBjb2RlOwoJICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudC5zbGljZSgwLCA1KSAhPT0gJ2NsYXNzJykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNvZGUgPSBmcmFnbWVudC5jaGFyQ29kZUF0KDUpOwoJICAgICAgICAgICAgICAgIHJldHVybiBjb2RlID09PSAweDdCICAvKiAneycgKi8gfHwgZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShjb2RlKSB8fCBlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihjb2RlKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBmdW5jdGlvbiBpc0Z1bmN0aW9uUHJlZml4ZWQoZnJhZ21lbnQpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29kZTsKCSAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnQuc2xpY2UoMCwgOCkgIT09ICdmdW5jdGlvbicpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBjb2RlID0gZnJhZ21lbnQuY2hhckNvZGVBdCg4KTsKCSAgICAgICAgICAgICAgICByZXR1cm4gY29kZSA9PT0gMHgyOCAvKiAnKCcgKi8gfHwgZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShjb2RlKSB8fCBjb2RlID09PSAweDJBICAvKiAnKicgKi8gfHwgZXN1dGlscy5jb2RlLmlzTGluZVRlcm1pbmF0b3IoY29kZSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgZnVuY3Rpb24gaXNBc3luY1ByZWZpeGVkKGZyYWdtZW50KSB7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGUsIGksIGl6OwoJICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudC5zbGljZSgwLCA1KSAhPT0gJ2FzeW5jJykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmICghZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShmcmFnbWVudC5jaGFyQ29kZUF0KDUpKSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDYsIGl6ID0gZnJhZ21lbnQubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoIWVzdXRpbHMuY29kZS5pc1doaXRlU3BhY2UoZnJhZ21lbnQuY2hhckNvZGVBdChpKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChpID09PSBpeikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudC5zbGljZShpLCBpICsgOCkgIT09ICdmdW5jdGlvbicpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBjb2RlID0gZnJhZ21lbnQuY2hhckNvZGVBdChpICsgOCk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IDB4MjggLyogJygnICovIHx8IGVzdXRpbHMuY29kZS5pc1doaXRlU3BhY2UoY29kZSkgfHwgY29kZSA9PT0gMHgyQSAgLyogJyonICovIHx8IGVzdXRpbHMuY29kZS5pc0xpbmVUZXJtaW5hdG9yKGNvZGUpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdCA9IFt0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmV4cHJlc3Npb24sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKV07CgkgICAgICAgICAgICAvLyAxMi40ICd7JywgJ2Z1bmN0aW9uJywgJ2NsYXNzJyBpcyBub3QgYWxsb3dlZCBpbiB0aGlzIHBvc2l0aW9uLgoJICAgICAgICAgICAgLy8gd3JhcCBleHByZXNzaW9uIHdpdGggcGFyZW50aGVzZXMKCSAgICAgICAgICAgIGZyYWdtZW50ID0gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCk7CgkgICAgICAgICAgICBpZiAoZnJhZ21lbnQuY2hhckNvZGVBdCgwKSA9PT0gMHg3QiAgLyogJ3snICovIHx8ICAvLyBPYmplY3RFeHByZXNzaW9uCgkgICAgICAgICAgICAgICAgICAgIGlzQ2xhc3NQcmVmaXhlZChmcmFnbWVudCkgfHwKCSAgICAgICAgICAgICAgICAgICAgaXNGdW5jdGlvblByZWZpeGVkKGZyYWdtZW50KSB8fAoJICAgICAgICAgICAgICAgICAgICBpc0FzeW5jUHJlZml4ZWQoZnJhZ21lbnQpIHx8CgkgICAgICAgICAgICAgICAgICAgIChkaXJlY3RpdmUgJiYgKGZsYWdzICYgRl9ESVJFQ1RJVkVfQ1RYKSAmJiBzdG10LmV4cHJlc3Npb24udHlwZSA9PT0gU3ludGF4LkxpdGVyYWwgJiYgdHlwZW9mIHN0bXQuZXhwcmVzc2lvbi52YWx1ZSA9PT0gJ3N0cmluZycpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWycoJywgcmVzdWx0LCAnKScgKyB0aGlzLnNlbWljb2xvbihmbGFncyldOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLnNlbWljb2xvbihmbGFncykpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEltcG9ydERlY2xhcmF0aW9uOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIC8vIEVTNjogMTUuMi4xIHZhbGlkIGltcG9ydCBkZWNsYXJhdGlvbnM6CgkgICAgICAgICAgICAvLyAgICAgLSBpbXBvcnQgSW1wb3J0Q2xhdXNlIEZyb21DbGF1c2UgOwoJICAgICAgICAgICAgLy8gICAgIC0gaW1wb3J0IE1vZHVsZVNwZWNpZmllciA7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBjdXJzb3IsIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgICAgIC8vIElmIG5vIEltcG9ydENsYXVzZSBpcyBwcmVzZW50LAoJICAgICAgICAgICAgLy8gdGhpcyBzaG91bGQgYmUgYGltcG9ydCBNb2R1bGVTcGVjaWZpZXJgIHNvIHNraXAgYGZyb21gCgkgICAgICAgICAgICAvLyBNb2R1bGVTcGVjaWZpZXIgaXMgU3RyaW5nTGl0ZXJhbC4KCSAgICAgICAgICAgIGlmIChzdG10LnNwZWNpZmllcnMubGVuZ3RoID09PSAwKSB7CgkgICAgICAgICAgICAgICAgLy8gaW1wb3J0IE1vZHVsZVNwZWNpZmllciA7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICAgICAgICAgJ2ltcG9ydCcsCgkgICAgICAgICAgICAgICAgICAgIHNwYWNlLAoJICAgICAgICAgICAgICAgICAgICAvLyBNb2R1bGVTcGVjaWZpZXIKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zb3VyY2UsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW1pY29sb24oZmxhZ3MpCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBpbXBvcnQgSW1wb3J0Q2xhdXNlIEZyb21DbGF1c2UgOwoJICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICdpbXBvcnQnCgkgICAgICAgICAgICBdOwoJICAgICAgICAgICAgY3Vyc29yID0gMDsKCgkgICAgICAgICAgICAvLyBJbXBvcnRlZEJpbmRpbmcKCSAgICAgICAgICAgIGlmIChzdG10LnNwZWNpZmllcnNbY3Vyc29yXS50eXBlID09PSBTeW50YXguSW1wb3J0RGVmYXVsdFNwZWNpZmllcikgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbCgkgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnNwZWNpZmllcnNbY3Vyc29yXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpCgkgICAgICAgICAgICAgICAgXSk7CgkgICAgICAgICAgICAgICAgKytjdXJzb3I7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHN0bXQuc3BlY2lmaWVyc1tjdXJzb3JdKSB7CgkgICAgICAgICAgICAgICAgaWYgKGN1cnNvciAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQuc3BlY2lmaWVyc1tjdXJzb3JdLnR5cGUgPT09IFN5bnRheC5JbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gTmFtZVNwYWNlSW1wb3J0CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zcGVjaWZpZXJzW2N1cnNvcl0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKQoJICAgICAgICAgICAgICAgICAgICBdKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAvLyBOYW1lZEltcG9ydHMKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UgKyAneycpOwoKCSAgICAgICAgICAgICAgICAgICAgaWYgKChzdG10LnNwZWNpZmllcnMubGVuZ3RoIC0gY3Vyc29yKSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1wb3J0IHsgLi4uIH0gZnJvbSAiLi4uIjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3BlY2lmaWVyc1tjdXJzb3JdLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UgKyAnfScgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbXBvcnQgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLi4uLAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLi4uLAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gfSBmcm9tICIuLi4iOwoJICAgICAgICAgICAgICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoaW5kZW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGksIGl6OwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IGN1cnNvciwgaXogPSBzdG10LnNwZWNpZmllcnMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpbmRlbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnNwZWNpZmllcnNbaV0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYmFzZSArICd9JyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgWwoJICAgICAgICAgICAgICAgICdmcm9tJyArIHNwYWNlLAoJICAgICAgICAgICAgICAgIC8vIE1vZHVsZVNwZWNpZmllcgoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc291cmNlLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCksCgkgICAgICAgICAgICAgICAgdGhpcy5zZW1pY29sb24oZmxhZ3MpCgkgICAgICAgICAgICBdKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBWYXJpYWJsZURlY2xhcmF0b3I6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIGl0ZW1GbGFncyA9IChmbGFncyAmIEZfQUxMT1dfSU4pID8gRV9UVFQgOiBFX0ZUVDsKCSAgICAgICAgICAgIGlmIChzdG10LmluaXQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmlkLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIGl0ZW1GbGFncyksCgkgICAgICAgICAgICAgICAgICAgIHNwYWNlLAoJICAgICAgICAgICAgICAgICAgICAnPScsCgkgICAgICAgICAgICAgICAgICAgIHNwYWNlLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmluaXQsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgaXRlbUZsYWdzKQoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVBhdHRlcm4oc3RtdC5pZCwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBpdGVtRmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgVmFyaWFibGVEZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICAvLyBWYXJpYWJsZURlY2xhcmF0b3IgaXMgdHlwZWQgYXMgU3RhdGVtZW50LAoJICAgICAgICAgICAgLy8gYnV0IGpvaW5lZCB3aXRoIGNvbW1hIChub3QgTGluZVRlcm1pbmF0b3IpLgoJICAgICAgICAgICAgLy8gU28gaWYgY29tbWVudCBpcyBhdHRhY2hlZCB0byB0YXJnZXQgbm9kZSwgd2Ugc2hvdWxkIHNwZWNpYWxpemUuCgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBpLCBpeiwgbm9kZSwgYm9keUZsYWdzLCB0aGF0ID0gdGhpczsKCgkgICAgICAgICAgICByZXN1bHQgPSBbIHN0bXQua2luZCBdOwoKCSAgICAgICAgICAgIGJvZHlGbGFncyA9IChmbGFncyAmIEZfQUxMT1dfSU4pID8gU19URkZGIDogU19GRkZGOwoKCSAgICAgICAgICAgIGZ1bmN0aW9uIGJsb2NrKCkgewoJICAgICAgICAgICAgICAgIG5vZGUgPSBzdG10LmRlY2xhcmF0aW9uc1swXTsKCSAgICAgICAgICAgICAgICBpZiAoZXh0cmEuY29tbWVudCAmJiBub2RlLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnXG4nKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQobm9kZSwgYm9keUZsYWdzKSkpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5vRW1wdHlTcGFjZSgpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZVN0YXRlbWVudChub2RlLCBib2R5RmxhZ3MpKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDEsIGl6ID0gc3RtdC5kZWNsYXJhdGlvbnMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBub2RlID0gc3RtdC5kZWNsYXJhdGlvbnNbaV07CgkgICAgICAgICAgICAgICAgICAgIGlmIChleHRyYS5jb21tZW50ICYmIG5vZGUubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KG5vZGUsIGJvZHlGbGFncykpKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQobm9kZSwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHN0bXQuZGVjbGFyYXRpb25zLmxlbmd0aCA+IDEpIHsKCSAgICAgICAgICAgICAgICB3aXRoSW5kZW50KGJsb2NrKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgYmxvY2soKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLnNlbWljb2xvbihmbGFncykpOwoKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBUaHJvd1N0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gW2pvaW4oCgkgICAgICAgICAgICAgICAgJ3Rocm93JywKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmFyZ3VtZW50LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkKCSAgICAgICAgICAgICksIHRoaXMuc2VtaWNvbG9uKGZsYWdzKV07CgkgICAgICAgIH0sCgoJICAgICAgICBUcnlTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgaSwgaXosIGd1YXJkZWRIYW5kbGVyczsKCgkgICAgICAgICAgICByZXN1bHQgPSBbJ3RyeScsIHRoaXMubWF5YmVCbG9jayhzdG10LmJsb2NrLCBTX1RGRkYpXTsKCSAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubWF5YmVCbG9ja1N1ZmZpeChzdG10LmJsb2NrLCByZXN1bHQpOwoKCSAgICAgICAgICAgIGlmIChzdG10LmhhbmRsZXJzKSB7CgkgICAgICAgICAgICAgICAgLy8gb2xkIGludGVyZmFjZQoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RtdC5oYW5kbGVycy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuaGFuZGxlcnNbaV0sIFNfVEZGRikpOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc3RtdC5maW5hbGl6ZXIgfHwgaSArIDEgIT09IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoc3RtdC5oYW5kbGVyc1tpXS5ib2R5LCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBndWFyZGVkSGFuZGxlcnMgPSBzdG10Lmd1YXJkZWRIYW5kbGVycyB8fCBbXTsKCgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBndWFyZGVkSGFuZGxlcnMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgdGhpcy5nZW5lcmF0ZVN0YXRlbWVudChndWFyZGVkSGFuZGxlcnNbaV0sIFNfVEZGRikpOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc3RtdC5maW5hbGl6ZXIgfHwgaSArIDEgIT09IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoZ3VhcmRlZEhhbmRsZXJzW2ldLmJvZHksIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIC8vIG5ldyBpbnRlcmZhY2UKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC5oYW5kbGVyKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHN0bXQuaGFuZGxlcikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RtdC5oYW5kbGVyLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgdGhpcy5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmhhbmRsZXJbaV0sIFNfVEZGRikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmZpbmFsaXplciB8fCBpICsgMSAhPT0gaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5tYXliZUJsb2NrU3VmZml4KHN0bXQuaGFuZGxlcltpXS5ib2R5LCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuaGFuZGxlciwgU19URkZGKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RtdC5maW5hbGl6ZXIpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoc3RtdC5oYW5kbGVyLmJvZHksIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoc3RtdC5maW5hbGl6ZXIpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgWydmaW5hbGx5JywgdGhpcy5tYXliZUJsb2NrKHN0bXQuZmluYWxpemVyLCBTX1RGRkYpXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgU3dpdGNoU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50LCBpLCBpeiwgYm9keUZsYWdzLCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgJ3N3aXRjaCcgKyBzcGFjZSArICcoJywKCSAgICAgICAgICAgICAgICAgICAgdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5kaXNjcmltaW5hbnQsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgJyknICsgc3BhY2UgKyAneycgKyBuZXdsaW5lCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgaWYgKHN0bXQuY2FzZXMpIHsKCSAgICAgICAgICAgICAgICBib2R5RmxhZ3MgPSBTX1RGRkY7CgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdG10LmNhc2VzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IGl6IC0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGFkZEluZGVudCh0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuY2FzZXNbaV0sIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmICghZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGZyYWdtZW50KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQoJ30nKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgU3dpdGNoQ2FzZTogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudCwgaSwgaXosIGJvZHlGbGFncywgdGhhdCA9IHRoaXM7CgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC50ZXN0KSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgICAgIGpvaW4oJ2Nhc2UnLCB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnRlc3QsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSksCgkgICAgICAgICAgICAgICAgICAgICAgICAnOicKCSAgICAgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBbJ2RlZmF1bHQ6J107CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpID0gMDsKCSAgICAgICAgICAgICAgICBpeiA9IHN0bXQuY29uc2VxdWVudC5sZW5ndGg7CgkgICAgICAgICAgICAgICAgaWYgKGl6ICYmIHN0bXQuY29uc2VxdWVudFswXS50eXBlID09PSBTeW50YXguQmxvY2tTdGF0ZW1lbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGF0Lm1heWJlQmxvY2soc3RtdC5jb25zZXF1ZW50WzBdLCBTX1RGRkYpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGkgPSAxOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKGkgIT09IGl6ICYmICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGJvZHlGbGFncyA9IFNfVEZGRjsKCSAgICAgICAgICAgICAgICBmb3IgKDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IGl6IC0gMSAmJiBmbGFncyAmIEZfU0VNSUNPTE9OX09QVCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGFkZEluZGVudCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuY29uc2VxdWVudFtpXSwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgKyAxICE9PSBpeiAmJiAhZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGZyYWdtZW50KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBJZlN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBib2R5RmxhZ3MsIHNlbWljb2xvbk9wdGlvbmFsLCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgJ2lmJyArIHNwYWNlICsgJygnLAoJICAgICAgICAgICAgICAgICAgICB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnRlc3QsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgJyknCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgc2VtaWNvbG9uT3B0aW9uYWwgPSBmbGFncyAmIEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgIGJvZHlGbGFncyA9IFNfVEZGRjsKCSAgICAgICAgICAgIGlmIChzZW1pY29sb25PcHRpb25hbCkgewoJICAgICAgICAgICAgICAgIGJvZHlGbGFncyB8PSBGX1NFTUlDT0xPTl9PUFQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoc3RtdC5hbHRlcm5hdGUpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLm1heWJlQmxvY2soc3RtdC5jb25zZXF1ZW50LCBTX1RGRkYpKTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoc3RtdC5jb25zZXF1ZW50LCByZXN1bHQpOwoJICAgICAgICAgICAgICAgIGlmIChzdG10LmFsdGVybmF0ZS50eXBlID09PSBTeW50YXguSWZTdGF0ZW1lbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIFsnZWxzZSAnLCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuYWx0ZXJuYXRlLCBib2R5RmxhZ3MpXSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIGpvaW4oJ2Vsc2UnLCB0aGlzLm1heWJlQmxvY2soc3RtdC5hbHRlcm5hdGUsIGJvZHlGbGFncykpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmNvbnNlcXVlbnQsIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEZvclN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsnZm9yJyArIHNwYWNlICsgJygnXTsKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC5pbml0KSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmluaXQudHlwZSA9PT0gU3ludGF4LlZhcmlhYmxlRGVjbGFyYXRpb24pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5pbml0LCBTX0ZGRkYpKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZfQUxMT1dfSU4gYmVjb21lcyBmYWxzZS4KCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuaW5pdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9GVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCc7Jyk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnOycpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQudGVzdCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQudGVzdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJzsnKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnOycpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQudXBkYXRlKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC51cGRhdGUsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcpJyk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyknKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLm1heWJlQmxvY2soc3RtdC5ib2R5LCBmbGFncyAmIEZfU0VNSUNPTE9OX09QVCA/IFNfVEZGVCA6IFNfVEZGRikpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEZvckluU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlSXRlcmF0aW9uRm9yU3RhdGVtZW50KCdpbicsIHN0bXQsIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKTsKCSAgICAgICAgfSwKCgkgICAgICAgIEZvck9mU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlSXRlcmF0aW9uRm9yU3RhdGVtZW50KCdvZicsIHN0bXQsIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKTsKCSAgICAgICAgfSwKCgkgICAgICAgIExhYmVsZWRTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIFtzdG10LmxhYmVsLm5hbWUgKyAnOicsIHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKV07CgkgICAgICAgIH0sCgoJICAgICAgICBQcm9ncmFtOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50LCBpLCBpeiwgYm9keUZsYWdzOwoJICAgICAgICAgICAgaXogPSBzdG10LmJvZHkubGVuZ3RoOwoJICAgICAgICAgICAgcmVzdWx0ID0gW3NhZmVDb25jYXRlbmF0aW9uICYmIGl6ID4gMCA/ICdcbicgOiAnJ107CgkgICAgICAgICAgICBib2R5RmxhZ3MgPSBTX1RGVEY7CgkgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgIGlmICghc2FmZUNvbmNhdGVuYXRpb24gJiYgaSA9PT0gaXogLSAxKSB7CgkgICAgICAgICAgICAgICAgICAgIGJvZHlGbGFncyB8PSBGX1NFTUlDT0xPTl9PUFQ7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBzcGFjZXMgYmVmb3JlIHRoZSBmaXJzdCBsaW5lCgkgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0bXQuYm9keVswXS5sZWFkaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZUJsYW5rTGluZXMoc3RtdC5yYW5nZVswXSwgc3RtdC5ib2R5W2ldLnJhbmdlWzBdLCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgc3BhY2VzIGJldHdlZW4gbGluZXMKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0bXQuYm9keVtpIC0gMV0udHJhaWxpbmdDb21tZW50cyAmJiAhc3RtdC5ib2R5W2ldLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LmJvZHlbaSAtIDFdLnJhbmdlWzFdLCBzdG10LmJvZHlbaV0ucmFuZ2VbMF0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gYWRkSW5kZW50KHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5ib2R5W2ldLCBib2R5RmxhZ3MpKTsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXogJiYgIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChmcmFnbWVudCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbaSArIDFdLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNwYWNlcyBhZnRlciB0aGUgbGFzdCBsaW5lCgkgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBpeiAtIDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5W2ldLnRyYWlsaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZUJsYW5rTGluZXMoc3RtdC5ib2R5W2ldLnJhbmdlWzFdLCBzdG10LnJhbmdlWzFdLCByZXN1bHQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEZ1bmN0aW9uRGVjbGFyYXRpb246IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICAgICBnZW5lcmF0ZUFzeW5jUHJlZml4KHN0bXQsIHRydWUpLAoJICAgICAgICAgICAgICAgICdmdW5jdGlvbicsCgkgICAgICAgICAgICAgICAgZ2VuZXJhdGVTdGFyU3VmZml4KHN0bXQpIHx8IG5vRW1wdHlTcGFjZSgpLAoJICAgICAgICAgICAgICAgIHN0bXQuaWQgPyBnZW5lcmF0ZUlkZW50aWZpZXIoc3RtdC5pZCkgOiAnJywKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRnVuY3Rpb25Cb2R5KHN0bXQpCgkgICAgICAgICAgICBdOwoJICAgICAgICB9LAoKCSAgICAgICAgUmV0dXJuU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChzdG10LmFyZ3VtZW50KSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFtqb2luKAoJICAgICAgICAgICAgICAgICAgICAncmV0dXJuJywKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5hcmd1bWVudCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpCgkgICAgICAgICAgICAgICAgKSwgdGhpcy5zZW1pY29sb24oZmxhZ3MpXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBbJ3JldHVybicgKyB0aGlzLnNlbWljb2xvbihmbGFncyldOwoJICAgICAgICB9LAoKCSAgICAgICAgV2hpbGVTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgdGhhdCA9IHRoaXM7CgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbCgkgICAgICAgICAgICAgICAgICAgICd3aGlsZScgKyBzcGFjZSArICcoJywKCSAgICAgICAgICAgICAgICAgICAgdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC50ZXN0LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCksCgkgICAgICAgICAgICAgICAgICAgICcpJwoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgV2l0aFN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgJ3dpdGgnICsgc3BhY2UgKyAnKCcsCgkgICAgICAgICAgICAgICAgICAgIHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQub2JqZWN0LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCksCgkgICAgICAgICAgICAgICAgICAgICcpJwoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9CgoJICAgIH07CgoJICAgIG1lcmdlKENvZGVHZW5lcmF0b3IucHJvdG90eXBlLCBDb2RlR2VuZXJhdG9yLlN0YXRlbWVudCk7CgoJICAgIC8vIEV4cHJlc3Npb25zLgoKCSAgICBDb2RlR2VuZXJhdG9yLkV4cHJlc3Npb24gPSB7CgoJICAgICAgICBTZXF1ZW5jZUV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgaSwgaXo7CgkgICAgICAgICAgICBpZiAoUHJlY2VkZW5jZS5TZXF1ZW5jZSA8IHByZWNlZGVuY2UpIHsKCSAgICAgICAgICAgICAgICBmbGFncyB8PSBGX0FMTE9XX0lOOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0ID0gW107CgkgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGV4cHIuZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuZXhwcmVzc2lvbnNbaV0sIFByZWNlZGVuY2UuQXNzaWdubWVudCwgZmxhZ3MpKTsKCSAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuU2VxdWVuY2UsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgQXNzaWdubWVudEV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVBc3NpZ25tZW50KGV4cHIubGVmdCwgZXhwci5yaWdodCwgZXhwci5vcGVyYXRvciwgcHJlY2VkZW5jZSwgZmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgQXJyb3dGdW5jdGlvbkV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZSh0aGlzLmdlbmVyYXRlRnVuY3Rpb25Cb2R5KGV4cHIpLCBQcmVjZWRlbmNlLkFycm93RnVuY3Rpb24sIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChQcmVjZWRlbmNlLkNvbmRpdGlvbmFsIDwgcHJlY2VkZW5jZSkgewoJICAgICAgICAgICAgICAgIGZsYWdzIHw9IEZfQUxMT1dfSU47CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKAoJICAgICAgICAgICAgICAgIFsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci50ZXN0LCBQcmVjZWRlbmNlLkNvYWxlc2NlLCBmbGFncyksCgkgICAgICAgICAgICAgICAgICAgIHNwYWNlICsgJz8nICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuY29uc2VxdWVudCwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBmbGFncyksCgkgICAgICAgICAgICAgICAgICAgIHNwYWNlICsgJzonICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYWx0ZXJuYXRlLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIGZsYWdzKQoJICAgICAgICAgICAgICAgIF0sCgkgICAgICAgICAgICAgICAgUHJlY2VkZW5jZS5Db25kaXRpb25hbCwKCSAgICAgICAgICAgICAgICBwcmVjZWRlbmNlCgkgICAgICAgICAgICApOwoJICAgICAgICB9LAoKCSAgICAgICAgTG9naWNhbEV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgaWYgKGV4cHIub3BlcmF0b3IgPT09ICc/PycpIHsKCSAgICAgICAgICAgICAgICBmbGFncyB8PSBGX0ZPVU5EX0NPQUxFU0NFOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmluYXJ5RXhwcmVzc2lvbihleHByLCBwcmVjZWRlbmNlLCBmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBCaW5hcnlFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGxlZnRQcmVjZWRlbmNlLCByaWdodFByZWNlZGVuY2UsIGN1cnJlbnRQcmVjZWRlbmNlLCBmcmFnbWVudCwgbGVmdFNvdXJjZTsKCSAgICAgICAgICAgIGN1cnJlbnRQcmVjZWRlbmNlID0gQmluYXJ5UHJlY2VkZW5jZVtleHByLm9wZXJhdG9yXTsKCSAgICAgICAgICAgIGxlZnRQcmVjZWRlbmNlID0gZXhwci5vcGVyYXRvciA9PT0gJyoqJyA/IFByZWNlZGVuY2UuUG9zdGZpeCA6IGN1cnJlbnRQcmVjZWRlbmNlOwoJICAgICAgICAgICAgcmlnaHRQcmVjZWRlbmNlID0gZXhwci5vcGVyYXRvciA9PT0gJyoqJyA/IGN1cnJlbnRQcmVjZWRlbmNlIDogY3VycmVudFByZWNlZGVuY2UgKyAxOwoKCSAgICAgICAgICAgIGlmIChjdXJyZW50UHJlY2VkZW5jZSA8IHByZWNlZGVuY2UpIHsKCSAgICAgICAgICAgICAgICBmbGFncyB8PSBGX0FMTE9XX0lOOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5sZWZ0LCBsZWZ0UHJlY2VkZW5jZSwgZmxhZ3MpOwoKCSAgICAgICAgICAgIGxlZnRTb3VyY2UgPSBmcmFnbWVudC50b1N0cmluZygpOwoKCSAgICAgICAgICAgIGlmIChsZWZ0U291cmNlLmNoYXJDb2RlQXQobGVmdFNvdXJjZS5sZW5ndGggLSAxKSA9PT0gMHgyRiAvKiAvICovICYmIGVzdXRpbHMuY29kZS5pc0lkZW50aWZpZXJQYXJ0RVM1KGV4cHIub3BlcmF0b3IuY2hhckNvZGVBdCgwKSkpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbZnJhZ21lbnQsIG5vRW1wdHlTcGFjZSgpLCBleHByLm9wZXJhdG9yXTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihmcmFnbWVudCwgZXhwci5vcGVyYXRvcik7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnJpZ2h0LCByaWdodFByZWNlZGVuY2UsIGZsYWdzKTsKCgkgICAgICAgICAgICBpZiAoZXhwci5vcGVyYXRvciA9PT0gJy8nICYmIGZyYWdtZW50LnRvU3RyaW5nKCkuY2hhckF0KDApID09PSAnLycgfHwKCSAgICAgICAgICAgIGV4cHIub3BlcmF0b3Iuc2xpY2UoLTEpID09PSAnPCcgJiYgZnJhZ21lbnQudG9TdHJpbmcoKS5zbGljZSgwLCAzKSA9PT0gJyEtLScpIHsKCSAgICAgICAgICAgICAgICAvLyBJZiAnLycgY29uY2F0cyB3aXRoICcvJyBvciBgPGAgY29uY2F0cyB3aXRoIGAhLS1gLCBpdCBpcyBpbnRlcnByZXRlZCBhcyBjb21tZW50IHN0YXJ0CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9FbXB0eVNwYWNlKCkpOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIGZyYWdtZW50KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZXhwci5vcGVyYXRvciA9PT0gJ2luJyAmJiAhKGZsYWdzICYgRl9BTExPV19JTikpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gWycoJywgcmVzdWx0LCAnKSddOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKChleHByLm9wZXJhdG9yID09PSAnfHwnIHx8IGV4cHIub3BlcmF0b3IgPT09ICcmJicpICYmIChmbGFncyAmIEZfRk9VTkRfQ09BTEVTQ0UpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFsnKCcsIHJlc3VsdCwgJyknXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBjdXJyZW50UHJlY2VkZW5jZSwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBDYWxsRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBpLCBpejsKCgkgICAgICAgICAgICAvLyBGX0FMTE9XX1VOUEFSQVRIX05FVyBiZWNvbWVzIGZhbHNlLgoJICAgICAgICAgICAgcmVzdWx0ID0gW3RoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuY2FsbGVlLCBQcmVjZWRlbmNlLkNhbGwsIEVfVFRGKV07CgoJICAgICAgICAgICAgaWYgKGV4cHIub3B0aW9uYWwpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnPy4nKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQucHVzaCgnKCcpOwoJICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBleHByWydhcmd1bWVudHMnXS5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwclsnYXJndW1lbnRzJ11baV0sIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJyknKTsKCgkgICAgICAgICAgICBpZiAoIShmbGFncyAmIEZfQUxMT1dfQ0FMTCkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gWycoJywgcmVzdWx0LCAnKSddOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLkNhbGwsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgQ2hhaW5FeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChQcmVjZWRlbmNlLk9wdGlvbmFsQ2hhaW5pbmcgPCBwcmVjZWRlbmNlKSB7CgkgICAgICAgICAgICAgICAgZmxhZ3MgfD0gRl9BTExPV19DQUxMOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmV4cHJlc3Npb24sIFByZWNlZGVuY2UuT3B0aW9uYWxDaGFpbmluZywgZmxhZ3MpOwoKCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLk9wdGlvbmFsQ2hhaW5pbmcsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgTmV3RXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBsZW5ndGgsIGksIGl6LCBpdGVtRmxhZ3M7CgkgICAgICAgICAgICBsZW5ndGggPSBleHByWydhcmd1bWVudHMnXS5sZW5ndGg7CgoJICAgICAgICAgICAgLy8gRl9BTExPV19DQUxMIGJlY29tZXMgZmFsc2UuCgkgICAgICAgICAgICAvLyBGX0FMTE9XX1VOUEFSQVRIX05FVyBtYXkgYmVjb21lIGZhbHNlLgoJICAgICAgICAgICAgaXRlbUZsYWdzID0gKGZsYWdzICYgRl9BTExPV19VTlBBUkFUSF9ORVcgJiYgIXBhcmVudGhlc2VzICYmIGxlbmd0aCA9PT0gMCkgPyBFX1RGVCA6IEVfVEZGOwoKCSAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4oCgkgICAgICAgICAgICAgICAgJ25ldycsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5jYWxsZWUsIFByZWNlZGVuY2UuTmV3LCBpdGVtRmxhZ3MpCgkgICAgICAgICAgICApOwoKCSAgICAgICAgICAgIGlmICghKGZsYWdzICYgRl9BTExPV19VTlBBUkFUSF9ORVcpIHx8IHBhcmVudGhlc2VzIHx8IGxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnKCcpOwoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gbGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByWydhcmd1bWVudHMnXVtpXSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcpJyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuTmV3LCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIE1lbWJlckV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQ7CgoJICAgICAgICAgICAgLy8gRl9BTExPV19VTlBBUkFUSF9ORVcgYmVjb21lcyBmYWxzZS4KCSAgICAgICAgICAgIHJlc3VsdCA9IFt0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLm9iamVjdCwgUHJlY2VkZW5jZS5DYWxsLCAoZmxhZ3MgJiBGX0FMTE9XX0NBTEwpID8gRV9UVEYgOiBFX1RGRildOwoKCSAgICAgICAgICAgIGlmIChleHByLmNvbXB1dGVkKSB7CgkgICAgICAgICAgICAgICAgaWYgKGV4cHIub3B0aW9uYWwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJz8uJyk7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnWycpOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucHJvcGVydHksIFByZWNlZGVuY2UuU2VxdWVuY2UsIGZsYWdzICYgRl9BTExPV19DQUxMID8gRV9UVFQgOiBFX1RGVCkpOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCddJyk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIGlmICghZXhwci5vcHRpb25hbCAmJiBleHByLm9iamVjdC50eXBlID09PSBTeW50YXguTGl0ZXJhbCAmJiB0eXBlb2YgZXhwci5vYmplY3QudmFsdWUgPT09ICdudW1iZXInKSB7CgkgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCk7CgkgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBhbGwgdHJ1ZSwKCSAgICAgICAgICAgICAgICAgICAgLy8gICAxLiBObyBmbG9hdGluZyBwb2ludAoJICAgICAgICAgICAgICAgICAgICAvLyAgIDIuIERvbid0IGhhdmUgZXhwb25lbnRzCgkgICAgICAgICAgICAgICAgICAgIC8vICAgMy4gVGhlIGxhc3QgY2hhcmFjdGVyIGlzIGEgZGVjaW1hbCBkaWdpdAoJICAgICAgICAgICAgICAgICAgICAvLyAgIDQuIE5vdCBoZXhhZGVjaW1hbCBPUiBvY3RhbCBudW1iZXIgbGl0ZXJhbAoJICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG91bGQgYWRkIGEgZmxvYXRpbmcgcG9pbnQuCgkgICAgICAgICAgICAgICAgICAgIGlmICgKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5pbmRleE9mKCcuJykgPCAwICYmCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIS9bZUV4WF0vLnRlc3QoZnJhZ21lbnQpICYmCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXN1dGlscy5jb2RlLmlzRGVjaW1hbERpZ2l0KGZyYWdtZW50LmNoYXJDb2RlQXQoZnJhZ21lbnQubGVuZ3RoIC0gMSkpICYmCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIShmcmFnbWVudC5sZW5ndGggPj0gMiAmJiBmcmFnbWVudC5jaGFyQ29kZUF0KDApID09PSA0OCkgIC8vICcwJwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyAnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChleHByLm9wdGlvbmFsID8gJz8uJyA6ICcuJyk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVJZGVudGlmaWVyKGV4cHIucHJvcGVydHkpKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5NZW1iZXIsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgTWV0YVByb3BlcnR5OiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgICAgICByZXN1bHQgPSBbXTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHR5cGVvZiBleHByLm1ldGEgPT09ICJzdHJpbmciID8gZXhwci5tZXRhIDogZ2VuZXJhdGVJZGVudGlmaWVyKGV4cHIubWV0YSkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJy4nKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHR5cGVvZiBleHByLnByb3BlcnR5ID09PSAic3RyaW5nIiA/IGV4cHIucHJvcGVydHkgOiBnZW5lcmF0ZUlkZW50aWZpZXIoZXhwci5wcm9wZXJ0eSkpOwoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuTWVtYmVyLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIFVuYXJ5RXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudCwgcmlnaHRDaGFyQ29kZSwgbGVmdFNvdXJjZSwgbGVmdENoYXJDb2RlOwoJICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmFyZ3VtZW50LCBQcmVjZWRlbmNlLlVuYXJ5LCBFX1RUVCk7CgoJICAgICAgICAgICAgaWYgKHNwYWNlID09PSAnJykgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4oZXhwci5vcGVyYXRvciwgZnJhZ21lbnQpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbZXhwci5vcGVyYXRvcl07CgkgICAgICAgICAgICAgICAgaWYgKGV4cHIub3BlcmF0b3IubGVuZ3RoID4gMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUsIHZvaWQsIHR5cGVvZgoJICAgICAgICAgICAgICAgICAgICAvLyBnZXQgYHR5cGVvZiBbXWAsIG5vdCBgdHlwZW9mW11gCgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCBpbnNlcnRpbmcgc3BhY2VzIGJldHdlZW4gb3BlcmF0b3IgYW5kIGFyZ3VtZW50IGlmIGl0IGlzIHVubmVjZXNzYXJ5CgkgICAgICAgICAgICAgICAgICAgIC8vIGxpa2UsIGAhY29uZGAKCSAgICAgICAgICAgICAgICAgICAgbGVmdFNvdXJjZSA9IHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpOwoJICAgICAgICAgICAgICAgICAgICBsZWZ0Q2hhckNvZGUgPSBsZWZ0U291cmNlLmNoYXJDb2RlQXQobGVmdFNvdXJjZS5sZW5ndGggLSAxKTsKCSAgICAgICAgICAgICAgICAgICAgcmlnaHRDaGFyQ29kZSA9IGZyYWdtZW50LnRvU3RyaW5nKCkuY2hhckNvZGVBdCgwKTsKCgkgICAgICAgICAgICAgICAgICAgIGlmICgoKGxlZnRDaGFyQ29kZSA9PT0gMHgyQiAgLyogKyAqLyB8fCBsZWZ0Q2hhckNvZGUgPT09IDB4MkQgIC8qIC0gKi8pICYmIGxlZnRDaGFyQ29kZSA9PT0gcmlnaHRDaGFyQ29kZSkgfHwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXN1dGlscy5jb2RlLmlzSWRlbnRpZmllclBhcnRFUzUobGVmdENoYXJDb2RlKSAmJiBlc3V0aWxzLmNvZGUuaXNJZGVudGlmaWVyUGFydEVTNShyaWdodENoYXJDb2RlKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5vRW1wdHlTcGFjZSgpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLlVuYXJ5LCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIFlpZWxkRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0OwoJICAgICAgICAgICAgaWYgKGV4cHIuZGVsZWdhdGUpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAneWllbGQqJzsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gJ3lpZWxkJzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChleHByLmFyZ3VtZW50KSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbigKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmFyZ3VtZW50LCBQcmVjZWRlbmNlLllpZWxkLCBFX1RUVCkKCSAgICAgICAgICAgICAgICApOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuWWllbGQsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgQXdhaXRFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBqb2luKAoJICAgICAgICAgICAgICAgIGV4cHIuYWxsID8gJ2F3YWl0KicgOiAnYXdhaXQnLAoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYXJndW1lbnQsIFByZWNlZGVuY2UuQXdhaXQsIEVfVFRUKQoJICAgICAgICAgICAgKTsKCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLkF3YWl0LCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIFVwZGF0ZUV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgaWYgKGV4cHIucHJlZml4KSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZSgKCSAgICAgICAgICAgICAgICAgICAgWwoJICAgICAgICAgICAgICAgICAgICAgICAgZXhwci5vcGVyYXRvciwKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYXJndW1lbnQsIFByZWNlZGVuY2UuVW5hcnksIEVfVFRUKQoJICAgICAgICAgICAgICAgICAgICBdLAoJICAgICAgICAgICAgICAgICAgICBQcmVjZWRlbmNlLlVuYXJ5LAoJICAgICAgICAgICAgICAgICAgICBwcmVjZWRlbmNlCgkgICAgICAgICAgICAgICAgKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUoCgkgICAgICAgICAgICAgICAgWwoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmFyZ3VtZW50LCBQcmVjZWRlbmNlLlBvc3RmaXgsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgZXhwci5vcGVyYXRvcgoJICAgICAgICAgICAgICAgIF0sCgkgICAgICAgICAgICAgICAgUHJlY2VkZW5jZS5Qb3N0Zml4LAoJICAgICAgICAgICAgICAgIHByZWNlZGVuY2UKCSAgICAgICAgICAgICk7CgkgICAgICAgIH0sCgoJICAgICAgICBGdW5jdGlvbkV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICBnZW5lcmF0ZUFzeW5jUHJlZml4KGV4cHIsIHRydWUpLAoJICAgICAgICAgICAgICAgICdmdW5jdGlvbicKCSAgICAgICAgICAgIF07CgkgICAgICAgICAgICBpZiAoZXhwci5pZCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGdlbmVyYXRlU3RhclN1ZmZpeChleHByKSB8fCBub0VtcHR5U3BhY2UoKSk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVJZGVudGlmaWVyKGV4cHIuaWQpKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVTdGFyU3VmZml4KGV4cHIpIHx8IHNwYWNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoZXhwcikpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEFycmF5UGF0dGVybjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5BcnJheUV4cHJlc3Npb24oZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MsIHRydWUpOwoJICAgICAgICB9LAoKCSAgICAgICAgQXJyYXlFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MsIGlzUGF0dGVybikgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgbXVsdGlsaW5lLCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIGlmICghZXhwci5lbGVtZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gJ1tdJzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG11bHRpbGluZSA9IGlzUGF0dGVybiA/IGZhbHNlIDogZXhwci5lbGVtZW50cy5sZW5ndGggPiAxOwoJICAgICAgICAgICAgcmVzdWx0ID0gWydbJywgbXVsdGlsaW5lID8gbmV3bGluZSA6ICcnXTsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKGluZGVudCkgewoJICAgICAgICAgICAgICAgIHZhciBpLCBpejsKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGV4cHIuZWxlbWVudHMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoIWV4cHIuZWxlbWVudHNbaV0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtdWx0aWxpbmUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpbmRlbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgKyAxID09PSBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChtdWx0aWxpbmUgPyBpbmRlbnQgOiAnJyk7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmVsZW1lbnRzW2ldLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIChtdWx0aWxpbmUgPyBuZXdsaW5lIDogc3BhY2UpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgaWYgKG11bHRpbGluZSAmJiAhZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKG11bHRpbGluZSA/IGJhc2UgOiAnJyk7CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnXScpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIFJlc3RFbGVtZW50OiBmdW5jdGlvbihleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuICcuLi4nICsgdGhpcy5nZW5lcmF0ZVBhdHRlcm4oZXhwci5hcmd1bWVudCk7CgkgICAgICAgIH0sCgoJICAgICAgICBDbGFzc0V4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQ7CgkgICAgICAgICAgICByZXN1bHQgPSBbJ2NsYXNzJ107CgkgICAgICAgICAgICBpZiAoZXhwci5pZCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmlkLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKGV4cHIuc3VwZXJDbGFzcykgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gam9pbignZXh0ZW5kcycsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuc3VwZXJDbGFzcywgUHJlY2VkZW5jZS5VbmFyeSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgZnJhZ21lbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZVN0YXRlbWVudChleHByLmJvZHksIFNfVEZGVCkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIE1ldGhvZERlZmluaXRpb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQ7CgkgICAgICAgICAgICBpZiAoZXhwclsnc3RhdGljJ10pIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbJ3N0YXRpYycgKyBzcGFjZV07CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKGV4cHIua2luZCA9PT0gJ2dldCcgfHwgZXhwci5raW5kID09PSAnc2V0JykgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gWwoJICAgICAgICAgICAgICAgICAgICBqb2luKGV4cHIua2luZCwgdGhpcy5nZW5lcmF0ZVByb3BlcnR5S2V5KGV4cHIua2V5LCBleHByLmNvbXB1dGVkKSksCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoZXhwci52YWx1ZSkKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBmcmFnbWVudCA9IFsKCSAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVNZXRob2RQcmVmaXgoZXhwciksCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVQcm9wZXJ0eUtleShleHByLmtleSwgZXhwci5jb21wdXRlZCksCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoZXhwci52YWx1ZSkKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGpvaW4ocmVzdWx0LCBmcmFnbWVudCk7CgkgICAgICAgIH0sCgoJICAgICAgICBQcm9wZXJ0eTogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoZXhwci5raW5kID09PSAnZ2V0JyB8fCBleHByLmtpbmQgPT09ICdzZXQnKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICAgICAgICAgZXhwci5raW5kLCBub0VtcHR5U3BhY2UoKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVByb3BlcnR5S2V5KGV4cHIua2V5LCBleHByLmNvbXB1dGVkKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUZ1bmN0aW9uQm9keShleHByLnZhbHVlKQoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKGV4cHIuc2hvcnRoYW5kKSB7CgkgICAgICAgICAgICAgICAgaWYgKGV4cHIudmFsdWUudHlwZSA9PT0gIkFzc2lnbm1lbnRQYXR0ZXJuIikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Bc3NpZ25tZW50UGF0dGVybihleHByLnZhbHVlLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlUHJvcGVydHlLZXkoZXhwci5rZXksIGV4cHIuY29tcHV0ZWQpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChleHByLm1ldGhvZCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTWV0aG9kUHJlZml4KGV4cHIpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlUHJvcGVydHlLZXkoZXhwci5rZXksIGV4cHIuY29tcHV0ZWQpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRnVuY3Rpb25Cb2R5KGV4cHIudmFsdWUpCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVQcm9wZXJ0eUtleShleHByLmtleSwgZXhwci5jb21wdXRlZCksCgkgICAgICAgICAgICAgICAgJzonICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci52YWx1ZSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkKCSAgICAgICAgICAgIF07CgkgICAgICAgIH0sCgoJICAgICAgICBPYmplY3RFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciBtdWx0aWxpbmUsIHJlc3VsdCwgZnJhZ21lbnQsIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgICAgIGlmICghZXhwci5wcm9wZXJ0aWVzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAne30nOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbXVsdGlsaW5lID0gZXhwci5wcm9wZXJ0aWVzLmxlbmd0aCA+IDE7CgoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnByb3BlcnRpZXNbMF0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKTsKCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgICAgIGlmICghbXVsdGlsaW5lKSB7CgkgICAgICAgICAgICAgICAgLy8gaXNzdWVzIDQKCSAgICAgICAgICAgICAgICAvLyBEbyBub3QgdHJhbnNmb3JtIGZyb20KCSAgICAgICAgICAgICAgICAvLyAgIGRlamF2dS5DbGFzcy5kZWNsYXJlKHsKCSAgICAgICAgICAgICAgICAvLyAgICAgICBtZXRob2QyOiBmdW5jdGlvbiAoKSB7fQoJICAgICAgICAgICAgICAgIC8vICAgfSk7CgkgICAgICAgICAgICAgICAgLy8gdG8KCSAgICAgICAgICAgICAgICAvLyAgIGRlamF2dS5DbGFzcy5kZWNsYXJlKHttZXRob2QyOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgLy8gICAgICAgfX0pOwoJICAgICAgICAgICAgICAgIGlmICghaGFzTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChmcmFnbWVudCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgJ3snLCBzcGFjZSwgZnJhZ21lbnQsIHNwYWNlLCAnfScgXTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoaW5kZW50KSB7CgkgICAgICAgICAgICAgICAgdmFyIGksIGl6OwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsgJ3snLCBuZXdsaW5lLCBpbmRlbnQsIGZyYWdtZW50IF07CgoJICAgICAgICAgICAgICAgIGlmIChtdWx0aWxpbmUpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgbmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDEsIGl6ID0gZXhwci5wcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZGVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnByb3BlcnRpZXNbaV0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgoJICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goYmFzZSk7CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnfScpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEFzc2lnbm1lbnRQYXR0ZXJuOiBmdW5jdGlvbihleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVBc3NpZ25tZW50KGV4cHIubGVmdCwgZXhwci5yaWdodCwgJz0nLCBwcmVjZWRlbmNlLCBmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBPYmplY3RQYXR0ZXJuOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGksIGl6LCBtdWx0aWxpbmUsIHByb3BlcnR5LCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIGlmICghZXhwci5wcm9wZXJ0aWVzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAne30nOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIG11bHRpbGluZSA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKGV4cHIucHJvcGVydGllcy5sZW5ndGggPT09IDEpIHsKCSAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IGV4cHIucHJvcGVydGllc1swXTsKCSAgICAgICAgICAgICAgICBpZiAoCgkgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5LnR5cGUgPT09IFN5bnRheC5Qcm9wZXJ0eQoJICAgICAgICAgICAgICAgICAgICAmJiBwcm9wZXJ0eS52YWx1ZS50eXBlICE9PSBTeW50YXguSWRlbnRpZmllcgoJICAgICAgICAgICAgICAgICkgewoJICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmUgPSB0cnVlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBleHByLnByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IGV4cHIucHJvcGVydGllc1tpXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKAoJICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9PT0gU3ludGF4LlByb3BlcnR5CgkgICAgICAgICAgICAgICAgICAgICAgICAmJiAhcHJvcGVydHkuc2hvcnRoYW5kCgkgICAgICAgICAgICAgICAgICAgICkgewoJICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0ID0gWyd7JywgbXVsdGlsaW5lID8gbmV3bGluZSA6ICcnIF07CgoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoaW5kZW50KSB7CgkgICAgICAgICAgICAgICAgdmFyIGksIGl6OwoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gZXhwci5wcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobXVsdGlsaW5lID8gaW5kZW50IDogJycpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnByb3BlcnRpZXNbaV0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyAobXVsdGlsaW5lID8gbmV3bGluZSA6IHNwYWNlKSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICBpZiAobXVsdGlsaW5lICYmICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2gobXVsdGlsaW5lID8gYmFzZSA6ICcnKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCd9Jyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgVGhpc0V4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuICd0aGlzJzsKCSAgICAgICAgfSwKCgkgICAgICAgIFN1cGVyOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiAnc3VwZXInOwoJICAgICAgICB9LAoKCSAgICAgICAgSWRlbnRpZmllcjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVJZGVudGlmaWVyKGV4cHIpOwoJICAgICAgICB9LAoKCSAgICAgICAgSW1wb3J0RGVmYXVsdFNwZWNpZmllcjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVJZGVudGlmaWVyKGV4cHIuaWQgfHwgZXhwci5sb2NhbCk7CgkgICAgICAgIH0sCgoJICAgICAgICBJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXI6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFsnKiddOwoJICAgICAgICAgICAgdmFyIGlkID0gZXhwci5pZCB8fCBleHByLmxvY2FsOwoJICAgICAgICAgICAgaWYgKGlkKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UgKyAnYXMnICsgbm9FbXB0eVNwYWNlKCkgKyBnZW5lcmF0ZUlkZW50aWZpZXIoaWQpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBJbXBvcnRTcGVjaWZpZXI6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIGltcG9ydGVkID0gZXhwci5pbXBvcnRlZDsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbIGltcG9ydGVkLm5hbWUgXTsKCSAgICAgICAgICAgIHZhciBsb2NhbCA9IGV4cHIubG9jYWw7CgkgICAgICAgICAgICBpZiAobG9jYWwgJiYgbG9jYWwubmFtZSAhPT0gaW1wb3J0ZWQubmFtZSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5vRW1wdHlTcGFjZSgpICsgJ2FzJyArIG5vRW1wdHlTcGFjZSgpICsgZ2VuZXJhdGVJZGVudGlmaWVyKGxvY2FsKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRXhwb3J0U3BlY2lmaWVyOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciBsb2NhbCA9IGV4cHIubG9jYWw7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWyBsb2NhbC5uYW1lIF07CgkgICAgICAgICAgICB2YXIgZXhwb3J0ZWQgPSBleHByLmV4cG9ydGVkOwoJICAgICAgICAgICAgaWYgKGV4cG9ydGVkICYmIGV4cG9ydGVkLm5hbWUgIT09IGxvY2FsLm5hbWUpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChub0VtcHR5U3BhY2UoKSArICdhcycgKyBub0VtcHR5U3BhY2UoKSArIGdlbmVyYXRlSWRlbnRpZmllcihleHBvcnRlZCkpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIExpdGVyYWw6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJhdzsKCSAgICAgICAgICAgIGlmIChleHByLmhhc093blByb3BlcnR5KCdyYXcnKSAmJiBwYXJzZSAmJiBleHRyYS5yYXcpIHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICByYXcgPSBwYXJzZShleHByLnJhdykuYm9keVswXS5leHByZXNzaW9uOwoJICAgICAgICAgICAgICAgICAgICBpZiAocmF3LnR5cGUgPT09IFN5bnRheC5MaXRlcmFsKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmF3LnZhbHVlID09PSBleHByLnZhbHVlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4cHIucmF3OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewoJICAgICAgICAgICAgICAgICAgICAvLyBub3QgdXNlIHJhdyBwcm9wZXJ0eQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZXhwci5yZWdleCkgewoJICAgICAgICAgICAgICByZXR1cm4gJy8nICsgZXhwci5yZWdleC5wYXR0ZXJuICsgJy8nICsgZXhwci5yZWdleC5mbGFnczsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAodHlwZW9mIGV4cHIudmFsdWUgPT09ICdiaWdpbnQnKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGV4cHIudmFsdWUudG9TdHJpbmcoKSArICduJzsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBgZXhwci52YWx1ZWAgY2FuIGJlIG51bGwgaWYgYGV4cHIuYmlnaW50YCBleGlzdHMuIFdlIG5lZWQgdG8gY2hlY2sKCSAgICAgICAgICAgIC8vIGBleHByLmJpZ2ludGAgZmlyc3QuCgkgICAgICAgICAgICBpZiAoZXhwci5iaWdpbnQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZXhwci5iaWdpbnQgKyAnbic7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKGV4cHIudmFsdWUgPT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gJ251bGwnOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0eXBlb2YgZXhwci52YWx1ZSA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlU3RyaW5nKGV4cHIudmFsdWUpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0eXBlb2YgZXhwci52YWx1ZSA9PT0gJ251bWJlcicpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVOdW1iZXIoZXhwci52YWx1ZSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHR5cGVvZiBleHByLnZhbHVlID09PSAnYm9vbGVhbicpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZXhwci52YWx1ZSA/ICd0cnVlJyA6ICdmYWxzZSc7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlUmVnRXhwKGV4cHIudmFsdWUpOwoJICAgICAgICB9LAoKCSAgICAgICAgR2VuZXJhdG9yRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5Db21wcmVoZW5zaW9uRXhwcmVzc2lvbihleHByLCBwcmVjZWRlbmNlLCBmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBDb21wcmVoZW5zaW9uRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICAvLyBHZW5lcmF0b3JFeHByZXNzaW9uIHNob3VsZCBiZSBwYXJlbnRoZXNpemVkIHdpdGggKC4uLiksIENvbXByZWhlbnNpb25FeHByZXNzaW9uIHdpdGggWy4uLl0KCSAgICAgICAgICAgIC8vIER1ZSB0byBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD04ODM0NjggcG9zaXRpb24gb2YgZXhwci5ib2R5IGNhbiBkaWZmZXIgaW4gU3BpZGVybW9ua2V5IGFuZCBFUzYKCgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBpLCBpeiwgZnJhZ21lbnQsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgcmVzdWx0ID0gKGV4cHIudHlwZSA9PT0gU3ludGF4LkdlbmVyYXRvckV4cHJlc3Npb24pID8gWycoJ10gOiBbJ1snXTsKCgkgICAgICAgICAgICBpZiAoZXh0cmEubW96LmNvbXByZWhlbnNpb25FeHByZXNzaW9uU3RhcnRzV2l0aEFzc2lnbm1lbnQpIHsKCSAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYm9keSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChleHByLmJsb2NrcykgewoJICAgICAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGV4cHIuYmxvY2tzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5ibG9ja3NbaV0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCB8fCBleHRyYS5tb3ouY29tcHJlaGVuc2lvbkV4cHJlc3Npb25TdGFydHNXaXRoQXNzaWdubWVudCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBmcmFnbWVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChleHByLmZpbHRlcikgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCAnaWYnICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5maWx0ZXIsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgWyAnKCcsIGZyYWdtZW50LCAnKScgXSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKCFleHRyYS5tb3ouY29tcHJlaGVuc2lvbkV4cHJlc3Npb25TdGFydHNXaXRoQXNzaWdubWVudCkgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5ib2R5LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKTsKCgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIGZyYWdtZW50KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQucHVzaCgoZXhwci50eXBlID09PSBTeW50YXguR2VuZXJhdG9yRXhwcmVzc2lvbikgPyAnKScgOiAnXScpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIENvbXByZWhlbnNpb25CbG9jazogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgZnJhZ21lbnQ7CgkgICAgICAgICAgICBpZiAoZXhwci5sZWZ0LnR5cGUgPT09IFN5bnRheC5WYXJpYWJsZURlY2xhcmF0aW9uKSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBbCgkgICAgICAgICAgICAgICAgICAgIGV4cHIubGVmdC5raW5kLCBub0VtcHR5U3BhY2UoKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVN0YXRlbWVudChleHByLmxlZnQuZGVjbGFyYXRpb25zWzBdLCBTX0ZGRkYpCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmxlZnQsIFByZWNlZGVuY2UuQ2FsbCwgRV9UVFQpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGZyYWdtZW50ID0gam9pbihmcmFnbWVudCwgZXhwci5vZiA/ICdvZicgOiAnaW4nKTsKCSAgICAgICAgICAgIGZyYWdtZW50ID0gam9pbihmcmFnbWVudCwgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5yaWdodCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCgkgICAgICAgICAgICByZXR1cm4gWyAnZm9yJyArIHNwYWNlICsgJygnLCBmcmFnbWVudCwgJyknIF07CgkgICAgICAgIH0sCgoJICAgICAgICBTcHJlYWRFbGVtZW50OiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAgICAgJy4uLicsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5hcmd1bWVudCwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkKCSAgICAgICAgICAgIF07CgkgICAgICAgIH0sCgoJICAgICAgICBUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIGl0ZW1GbGFncyA9IEVfVFRGOwoJICAgICAgICAgICAgaWYgKCEoZmxhZ3MgJiBGX0FMTE9XX0NBTEwpKSB7CgkgICAgICAgICAgICAgICAgaXRlbUZsYWdzID0gRV9URkY7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIudGFnLCBQcmVjZWRlbmNlLkNhbGwsIGl0ZW1GbGFncyksCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5xdWFzaSwgUHJlY2VkZW5jZS5QcmltYXJ5LCBFX0ZGVCkKCSAgICAgICAgICAgIF07CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5UYWdnZWRUZW1wbGF0ZSwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBUZW1wbGF0ZUVsZW1lbnQ6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgLy8gRG9uJ3QgdXNlICJjb29rZWQiLiBTaW5jZSB0YWdnZWQgdGVtcGxhdGUgY2FuIHVzZSByYXcgdGVtcGxhdGUKCSAgICAgICAgICAgIC8vIHJlcHJlc2VudGF0aW9uLiBTbyBpZiB3ZSBkbyBzbywgaXQgYnJlYWtzIHRoZSBzY3JpcHQgc2VtYW50aWNzLgoJICAgICAgICAgICAgcmV0dXJuIGV4cHIudmFsdWUucmF3OwoJICAgICAgICB9LAoKCSAgICAgICAgVGVtcGxhdGVMaXRlcmFsOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGksIGl6OwoJICAgICAgICAgICAgcmVzdWx0ID0gWyAnYCcgXTsKCSAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gZXhwci5xdWFzaXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucXVhc2lzW2ldLCBQcmVjZWRlbmNlLlByaW1hcnksIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXopIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyR7JyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5leHByZXNzaW9uc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UgKyAnfScpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdgJyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgTW9kdWxlU3BlY2lmaWVyOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLkxpdGVyYWwoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgSW1wb3J0RXhwcmVzc2lvbjogZnVuY3Rpb24oZXhwciwgcHJlY2VkZW5jZSwgZmxhZykgewoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShbCgkgICAgICAgICAgICAgICAgJ2ltcG9ydCgnLAoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuc291cmNlLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAnKScKCSAgICAgICAgICAgIF0sIFByZWNlZGVuY2UuQ2FsbCwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0KCSAgICB9OwoKCSAgICBtZXJnZShDb2RlR2VuZXJhdG9yLnByb3RvdHlwZSwgQ29kZUdlbmVyYXRvci5FeHByZXNzaW9uKTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVFeHByZXNzaW9uID0gZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgIHZhciByZXN1bHQsIHR5cGU7CgoJICAgICAgICB0eXBlID0gZXhwci50eXBlIHx8IFN5bnRheC5Qcm9wZXJ0eTsKCgkgICAgICAgIGlmIChleHRyYS52ZXJiYXRpbSAmJiBleHByLmhhc093blByb3BlcnR5KGV4dHJhLnZlcmJhdGltKSkgewoJICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlVmVyYmF0aW0oZXhwciwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0KCgkgICAgICAgIHJlc3VsdCA9IHRoaXNbdHlwZV0oZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpOwoKCgkgICAgICAgIGlmIChleHRyYS5jb21tZW50KSB7CgkgICAgICAgICAgICByZXN1bHQgPSBhZGRDb21tZW50cyhleHByLCByZXN1bHQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCwgZXhwcik7CgkgICAgfTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVTdGF0ZW1lbnQgPSBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgdmFyIHJlc3VsdCwKCSAgICAgICAgICAgIGZyYWdtZW50OwoKCSAgICAgICAgcmVzdWx0ID0gdGhpc1tzdG10LnR5cGVdKHN0bXQsIGZsYWdzKTsKCgkgICAgICAgIC8vIEF0dGFjaCBjb21tZW50cwoKCSAgICAgICAgaWYgKGV4dHJhLmNvbW1lbnQpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IGFkZENvbW1lbnRzKHN0bXQsIHJlc3VsdCk7CgkgICAgICAgIH0KCgkgICAgICAgIGZyYWdtZW50ID0gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCk7CgkgICAgICAgIGlmIChzdG10LnR5cGUgPT09IFN5bnRheC5Qcm9ncmFtICYmICFzYWZlQ29uY2F0ZW5hdGlvbiAmJiBuZXdsaW5lID09PSAnJyAmJiAgZnJhZ21lbnQuY2hhckF0KGZyYWdtZW50Lmxlbmd0aCAtIDEpID09PSAnXG4nKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBzb3VyY2VNYXAgPyB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkucmVwbGFjZVJpZ2h0KC9ccyskLywgJycpIDogZnJhZ21lbnQucmVwbGFjZSgvXHMrJC8sICcnKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0LCBzdG10KTsKCSAgICB9OwoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZUludGVybmFsKG5vZGUpIHsKCSAgICAgICAgdmFyIGNvZGVnZW47CgoJICAgICAgICBjb2RlZ2VuID0gbmV3IENvZGVHZW5lcmF0b3IoKTsKCSAgICAgICAgaWYgKGlzU3RhdGVtZW50KG5vZGUpKSB7CgkgICAgICAgICAgICByZXR1cm4gY29kZWdlbi5nZW5lcmF0ZVN0YXRlbWVudChub2RlLCBTX1RGRkYpOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoaXNFeHByZXNzaW9uKG5vZGUpKSB7CgkgICAgICAgICAgICByZXR1cm4gY29kZWdlbi5nZW5lcmF0ZUV4cHJlc3Npb24obm9kZSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpOwoJICAgICAgICB9CgoJICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbm9kZSB0eXBlOiAnICsgbm9kZS50eXBlKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlKG5vZGUsIG9wdGlvbnMpIHsKCSAgICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0gZ2V0RGVmYXVsdE9wdGlvbnMoKSwgcmVzdWx0LCBwYWlyOwoKCSAgICAgICAgaWYgKG9wdGlvbnMgIT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gT2Jzb2xldGUgb3B0aW9ucwoJICAgICAgICAgICAgLy8KCSAgICAgICAgICAgIC8vICAgYG9wdGlvbnMuaW5kZW50YAoJICAgICAgICAgICAgLy8gICBgb3B0aW9ucy5iYXNlYAoJICAgICAgICAgICAgLy8KCSAgICAgICAgICAgIC8vIEluc3RlYWQgb2YgdGhlbSwgd2UgY2FuIHVzZSBgb3B0aW9uLmZvcm1hdC5pbmRlbnRgLgoJICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmluZGVudCA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9ucy5mb3JtYXQuaW5kZW50LnN0eWxlID0gb3B0aW9ucy5pbmRlbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuYmFzZSA9PT0gJ251bWJlcicpIHsKCSAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9ucy5mb3JtYXQuaW5kZW50LmJhc2UgPSBvcHRpb25zLmJhc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBvcHRpb25zID0gdXBkYXRlRGVlcGx5KGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTsKCSAgICAgICAgICAgIGluZGVudCA9IG9wdGlvbnMuZm9ybWF0LmluZGVudC5zdHlsZTsKCSAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5iYXNlID09PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgICAgIGJhc2UgPSBvcHRpb25zLmJhc2U7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIGJhc2UgPSBzdHJpbmdSZXBlYXQoaW5kZW50LCBvcHRpb25zLmZvcm1hdC5pbmRlbnQuYmFzZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICBvcHRpb25zID0gZGVmYXVsdE9wdGlvbnM7CgkgICAgICAgICAgICBpbmRlbnQgPSBvcHRpb25zLmZvcm1hdC5pbmRlbnQuc3R5bGU7CgkgICAgICAgICAgICBiYXNlID0gc3RyaW5nUmVwZWF0KGluZGVudCwgb3B0aW9ucy5mb3JtYXQuaW5kZW50LmJhc2UpOwoJICAgICAgICB9CgkgICAgICAgIGpzb24gPSBvcHRpb25zLmZvcm1hdC5qc29uOwoJICAgICAgICByZW51bWJlciA9IG9wdGlvbnMuZm9ybWF0LnJlbnVtYmVyOwoJICAgICAgICBoZXhhZGVjaW1hbCA9IGpzb24gPyBmYWxzZSA6IG9wdGlvbnMuZm9ybWF0LmhleGFkZWNpbWFsOwoJICAgICAgICBxdW90ZXMgPSBqc29uID8gJ2RvdWJsZScgOiBvcHRpb25zLmZvcm1hdC5xdW90ZXM7CgkgICAgICAgIGVzY2FwZWxlc3MgPSBvcHRpb25zLmZvcm1hdC5lc2NhcGVsZXNzOwoJICAgICAgICBuZXdsaW5lID0gb3B0aW9ucy5mb3JtYXQubmV3bGluZTsKCSAgICAgICAgc3BhY2UgPSBvcHRpb25zLmZvcm1hdC5zcGFjZTsKCSAgICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0LmNvbXBhY3QpIHsKCSAgICAgICAgICAgIG5ld2xpbmUgPSBzcGFjZSA9IGluZGVudCA9IGJhc2UgPSAnJzsKCSAgICAgICAgfQoJICAgICAgICBwYXJlbnRoZXNlcyA9IG9wdGlvbnMuZm9ybWF0LnBhcmVudGhlc2VzOwoJICAgICAgICBzZW1pY29sb25zID0gb3B0aW9ucy5mb3JtYXQuc2VtaWNvbG9uczsKCSAgICAgICAgc2FmZUNvbmNhdGVuYXRpb24gPSBvcHRpb25zLmZvcm1hdC5zYWZlQ29uY2F0ZW5hdGlvbjsKCSAgICAgICAgZGlyZWN0aXZlID0gb3B0aW9ucy5kaXJlY3RpdmU7CgkgICAgICAgIHBhcnNlID0ganNvbiA/IG51bGwgOiBvcHRpb25zLnBhcnNlOwoJICAgICAgICBzb3VyY2VNYXAgPSBvcHRpb25zLnNvdXJjZU1hcDsKCSAgICAgICAgc291cmNlQ29kZSA9IG9wdGlvbnMuc291cmNlQ29kZTsKCSAgICAgICAgcHJlc2VydmVCbGFua0xpbmVzID0gb3B0aW9ucy5mb3JtYXQucHJlc2VydmVCbGFua0xpbmVzICYmIHNvdXJjZUNvZGUgIT09IG51bGw7CgkgICAgICAgIGV4dHJhID0gb3B0aW9uczsKCgkgICAgICAgIGlmIChzb3VyY2VNYXApIHsKCSAgICAgICAgICAgIGlmICghZXhwb3J0cy5icm93c2VyKSB7CgkgICAgICAgICAgICAgICAgLy8gV2UgYXNzdW1lIGVudmlyb25tZW50IGlzIG5vZGUuanMKCSAgICAgICAgICAgICAgICAvLyBBbmQgcHJldmVudCBmcm9tIGluY2x1ZGluZyBzb3VyY2UtbWFwIGJ5IGJyb3dzZXJpZnkKCSAgICAgICAgICAgICAgICBTb3VyY2VOb2RlID0gcmVxdWlyZVNvdXJjZU1hcCgpLlNvdXJjZU5vZGU7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIFNvdXJjZU5vZGUgPSBjb21tb25qc0dsb2JhbC5zb3VyY2VNYXAuU291cmNlTm9kZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgcmVzdWx0ID0gZ2VuZXJhdGVJbnRlcm5hbChub2RlKTsKCgkgICAgICAgIGlmICghc291cmNlTWFwKSB7CgkgICAgICAgICAgICBwYWlyID0ge2NvZGU6IHJlc3VsdC50b1N0cmluZygpLCBtYXA6IG51bGx9OwoJICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuc291cmNlTWFwV2l0aENvZGUgPyBwYWlyIDogcGFpci5jb2RlOwoJICAgICAgICB9CgoKCSAgICAgICAgcGFpciA9IHJlc3VsdC50b1N0cmluZ1dpdGhTb3VyY2VNYXAoewoJICAgICAgICAgICAgZmlsZTogb3B0aW9ucy5maWxlLAoJICAgICAgICAgICAgc291cmNlUm9vdDogb3B0aW9ucy5zb3VyY2VNYXBSb290CgkgICAgICAgIH0pOwoKCSAgICAgICAgaWYgKG9wdGlvbnMuc291cmNlQ29udGVudCkgewoJICAgICAgICAgICAgcGFpci5tYXAuc2V0U291cmNlQ29udGVudChvcHRpb25zLnNvdXJjZU1hcCwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zb3VyY2VDb250ZW50KTsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKG9wdGlvbnMuc291cmNlTWFwV2l0aENvZGUpIHsKCSAgICAgICAgICAgIHJldHVybiBwYWlyOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcGFpci5tYXAudG9TdHJpbmcoKTsKCSAgICB9CgoJICAgIEZPUk1BVF9NSU5JRlkgPSB7CgkgICAgICAgIGluZGVudDogewoJICAgICAgICAgICAgc3R5bGU6ICcnLAoJICAgICAgICAgICAgYmFzZTogMAoJICAgICAgICB9LAoJICAgICAgICByZW51bWJlcjogdHJ1ZSwKCSAgICAgICAgaGV4YWRlY2ltYWw6IHRydWUsCgkgICAgICAgIHF1b3RlczogJ2F1dG8nLAoJICAgICAgICBlc2NhcGVsZXNzOiB0cnVlLAoJICAgICAgICBjb21wYWN0OiB0cnVlLAoJICAgICAgICBwYXJlbnRoZXNlczogZmFsc2UsCgkgICAgICAgIHNlbWljb2xvbnM6IGZhbHNlCgkgICAgfTsKCgkgICAgRk9STUFUX0RFRkFVTFRTID0gZ2V0RGVmYXVsdE9wdGlvbnMoKS5mb3JtYXQ7CgoJICAgIGV4cG9ydHMudmVyc2lvbiA9IHJlcXVpcmUkJDMudmVyc2lvbjsKCSAgICBleHBvcnRzLmdlbmVyYXRlID0gZ2VuZXJhdGU7CgkgICAgZXhwb3J0cy5hdHRhY2hDb21tZW50cyA9IGVzdHJhdmVyc2UkMS5hdHRhY2hDb21tZW50czsKCSAgICBleHBvcnRzLlByZWNlZGVuY2UgPSB1cGRhdGVEZWVwbHkoe30sIFByZWNlZGVuY2UpOwoJICAgIGV4cG9ydHMuYnJvd3NlciA9IGZhbHNlOwoJICAgIGV4cG9ydHMuRk9STUFUX01JTklGWSA9IEZPUk1BVF9NSU5JRlk7CgkgICAgZXhwb3J0cy5GT1JNQVRfREVGQVVMVFMgPSBGT1JNQVRfREVGQVVMVFM7Cgl9KCkpOwoJLyogdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDogKi8gCn0gKGVzY29kZWdlbikpOwoKY29uc3QgQUNDRVNTX0tFWSA9IGBfX2Nvcml1bS5hY2Nlc3NvcmA7CmNvbnN0IEdMT0JBTF9QUk9YWSA9ICJfX2Nvcml1bS5nbG9iYWxfcHJveHkiOwpjb25zdCBHTE9CQUxfTkFNRSA9ICJfX2Nvcml1bS5nbG9iYWxfbmFtZSI7CmNvbnN0IFVOREVGSU5BQkxFID0gWyJldmFsIiwgImxvY2F0aW9uIiwgInRvcCJdOwpjb25zdCBjVGFyZ2V0ID0gInQkdCI7CmNvbnN0IGNQcm9wID0gInQkcCI7CmNvbnN0IGNWYWx1ZSA9ICJ0JHYiOwpmdW5jdGlvbiByZXdyaXRlKGpzKSB7CiAgdHJ5IHsKICAgIGNvbnN0IHRyZWUgPSBwYXJzZVNjcmlwdChqcywgewogICAgICByYW5nZXM6IHRydWUsCiAgICAgIG1vZHVsZTogZmFsc2UsCiAgICAgIGdsb2JhbFJldHVybjogdHJ1ZQogICAgfSk7CiAgICBmb3IgKGNvbnN0IGN0eCBvZiBuZXcgQWNvcm5JdGVyYXRvcih0cmVlKSkgewogICAgICB0eXBlTG9vcDoKICAgICAgICBzd2l0Y2ggKGN0eC5ub2RlWyJ0eXBlIl0pIHsKICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHsgY2FsbGVlIH0gPSBjdHgubm9kZTsKICAgICAgICAgICAgICBpZiAoY2FsbGVlLnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBjYWxsZWUubmFtZSA9PT0gImV2YWwiICYmIGN0eC5ub2RlLmFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGN0eC5yZXBsYWNlV2l0aCgKICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNvbmRpdGlvbmFsRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuYmluYXJ5RXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICI9PT0iLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoImV2YWwiKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoImV2YWxTbmFwc2hvdCIpCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24obWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoImV2YWwiKSwgWwogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNhbGxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZXZhbFNjb3BlIikKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm5vZGUuYXJndW1lbnRzLm1hcCgoYXJnKSA9PiByZXN1bHQoYXJnKSkKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBdKSwKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZXZhbCIpLAogICAgICAgICAgICAgICAgICAgICAgY3R4Lm5vZGUuYXJndW1lbnRzLm1hcCgoYXJnKSA9PiByZXN1bHQoYXJnKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiSWRlbnRpZmllciI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiQXJyYXlQYXR0ZXJuIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9iamVjdFBhdHRlcm4iOgogICAgICAgICAgICAgICAgY2FzZSAiTGFiZWxlZFN0YXRlbWVudCI6CiAgICAgICAgICAgICAgICBjYXNlICJNZXRob2REZWZpbml0aW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkNsYXNzRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgICAgY2FzZSAiUmVzdEVsZW1lbnQiOgogICAgICAgICAgICAgICAgY2FzZSAiRXhwb3J0U3BlY2lmaWVyIjoKICAgICAgICAgICAgICAgIGNhc2UgIkltcG9ydFNwZWNpZmllciI6CiAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGlmIChjdHgucGFyZW50S2V5ID09PSAicHJvcGVydHkiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlRGVjbGFyYXRvciI6CiAgICAgICAgICAgICAgICAgIGlmIChjdHgucGFyZW50S2V5ID09PSAiaWQiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIlByb3BlcnR5IjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJrZXkiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIkZ1bmN0aW9uRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJpZCIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICBjYXNlICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGlmIChjdHgucGFyZW50S2V5ID09PSAicGFyYW1zIikKICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50UGF0dGVybiI6CiAgICAgICAgICAgICAgICAgIGlmIChjdHgucGFyZW50S2V5ID09PSAibGVmdCIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIVVOREVGSU5BQkxFLmluY2x1ZGVzKGN0eC5ub2RlLm5hbWUpKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iIHx8IGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIkFzc2lnbm1lbnRFeHByZXNzaW9uIiAmJiBjdHgucGFyZW50S2V5ID09PSAibGVmdCIpIHsKICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQucmVwbGFjZVdpdGgoCiAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5jYWxsRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKEFDQ0VTU19LRVkpLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoInNldDEiKQogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgY3R4Lm5vZGUsCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChjdHgubm9kZS5uYW1lKSwKICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB3aGF0IHRoZSBpbnRlbmRlZCB2YWx1ZSBpcwogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmFycm93RnVuY3Rpb25FeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1RhcmdldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1Byb3ApLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLnR5cGUgPT09ICJVcGRhdGVFeHByZXNzaW9uIiA/IG1haW4kMS5idWlsZGVycy51cGRhdGVFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQubm9kZS5vcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNUYXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1Byb3ApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLnByZWZpeAogICAgICAgICAgICAgICAgICAgICAgICApIDogbWFpbiQxLmJ1aWxkZXJzLmFzc2lnbm1lbnRFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQubm9kZS5vcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNUYXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1Byb3ApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgLy8gc2V0CiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuYXJyb3dGdW5jdGlvbkV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFttYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVmFsdWUpXSwKICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmFzc2lnbm1lbnRFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICI9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubm9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Lm5vZGUudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iID8gbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoInVuZGVmaW5lZCIpIDogY3R4LnBhcmVudC5ub2RlLnJpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmxpdGVyYWwoZ2VuZXJhdGVQYXJ0aWFsKGpzLCBjdHgucGFyZW50KSkKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5yZXBsYWNlV2l0aCgKICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNhbGxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoQUNDRVNTX0tFWSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZ2V0IikKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFtjdHgubm9kZSwgbWFpbiQxLmJ1aWxkZXJzLmxpdGVyYWwoY3R4Lm5vZGUubmFtZSldCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiQXJyYXlQYXR0ZXJuIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9iamVjdFBhdHRlcm4iOgogICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGlmIChjdHgucGFyZW50Py5ub2RlLm9wZXJhdG9yID09PSAiZGVsZXRlIikKICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjdHgubm9kZS5jb21wdXRlZCkgewogICAgICAgICAgICAgICAgaWYgKGN0eC5ub2RlLm9iamVjdC50eXBlID09PSAiU3VwZXIiKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGN0eC5ub2RlLnByb3BlcnR5LnR5cGUgPT09ICJMaXRlcmFsIikgewogICAgICAgICAgICAgICAgICBpZiAoIVVOREVGSU5BQkxFLmluY2x1ZGVzKGN0eC5ub2RlLnByb3BlcnR5LnZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGN0eC5ub2RlLnByb3BlcnR5LnR5cGUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAiSWRlbnRpZmllciI6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFVTkRFRklOQUJMRS5pbmNsdWRlcyhjdHgubm9kZS5wcm9wZXJ0eS5uYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICJMaXRlcmFsIjoKICAgICAgICAgICAgICAgICAgICBpZiAoIVVOREVGSU5BQkxFLmluY2x1ZGVzKGN0eC5ub2RlLnByb3BlcnR5LnZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCBwcm9wZXJ0eUFyZ3VtZW50OwogICAgICAgICAgICAgIGlmIChjdHgubm9kZS5jb21wdXRlZCkgewogICAgICAgICAgICAgICAgcHJvcGVydHlBcmd1bWVudCA9IHJlc3VsdChjdHgubm9kZS5wcm9wZXJ0eSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdHgubm9kZS5wcm9wZXJ0eS50eXBlID09PSAiSWRlbnRpZmllciIpIHsKICAgICAgICAgICAgICAgIHByb3BlcnR5QXJndW1lbnQgPSBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChjdHgubm9kZS5wcm9wZXJ0eS5uYW1lKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjdHgucGFyZW50Py5ub2RlLnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIiAmJiBjdHgucGFyZW50S2V5ID09PSAiY2FsbGVlIikgewogICAgICAgICAgICAgICAgY3R4LnBhcmVudC5yZXBsYWNlV2l0aCgKICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNhbGxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoQUNDRVNTX0tFWSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigibmV3MiIpCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQoY3R4Lm5vZGUub2JqZWN0KSwKICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXJndW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQobWFpbiQxLmJ1aWxkZXJzLmFycmF5RXhwcmVzc2lvbihjdHgucGFyZW50Lm5vZGUuYXJndW1lbnRzKSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChnZW5lcmF0ZVBhcnRpYWwoanMsIGN0eC5wYXJlbnQpKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIkNhbGxFeHByZXNzaW9uIiAmJiBjdHgucGFyZW50S2V5ID09PSAiY2FsbGVlIikgewogICAgICAgICAgICAgICAgY3R4LnBhcmVudC5yZXBsYWNlV2l0aCgKICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNhbGxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoQUNDRVNTX0tFWSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiY2FsbDIiKQogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KGN0eC5ub2RlLm9iamVjdCksCiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUFyZ3VtZW50LAogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KG1haW4kMS5idWlsZGVycy5hcnJheUV4cHJlc3Npb24oY3R4LnBhcmVudC5ub2RlLmFyZ3VtZW50cykpLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmxpdGVyYWwoZ2VuZXJhdGVQYXJ0aWFsKGpzLCBjdHgucGFyZW50KSkKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdHgucGFyZW50Py5ub2RlLnR5cGUgPT09ICJVcGRhdGVFeHByZXNzaW9uIiB8fCBjdHgucGFyZW50Py5ub2RlLnR5cGUgPT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgJiYgY3R4LnBhcmVudEtleSA9PT0gImxlZnQiKSB7CiAgICAgICAgICAgICAgICBjdHgucGFyZW50LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJzZXQyIikKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgIGN0eC5ub2RlLm9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXJndW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuYXJyb3dGdW5jdGlvbkV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVGFyZ2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Py5ub2RlLnR5cGUgPT09ICJVcGRhdGVFeHByZXNzaW9uIiA/IG1haW4kMS5idWlsZGVycy51cGRhdGVFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQubm9kZS5vcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNUYXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1Byb3ApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLnByZWZpeAogICAgICAgICAgICAgICAgICAgICAgICApIDogbWFpbiQxLmJ1aWxkZXJzLmFzc2lnbm1lbnRFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQubm9kZS5vcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNUYXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1Byb3ApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudD8ubm9kZS50eXBlID09PSAiVXBkYXRlRXhwcmVzc2lvbiIgPyBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigidW5kZWZpbmVkIikgOiBjdHgucGFyZW50Lm5vZGUucmlnaHQsCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChnZW5lcmF0ZVBhcnRpYWwoanMsIGN0eC5wYXJlbnQpKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJnZXQyIikKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdChjdHgubm9kZS5vYmplY3QpLAogICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBcmd1bWVudCwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5saXRlcmFsKGdlbmVyYXRlUGFydGlhbChqcywgY3R4KSkKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBlc2NvZGVnZW4uZ2VuZXJhdGUodHJlZSk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIGNvbnNvbGUuZXJyb3IoInBhcnNpbmcgZXJyb3IiKTsKICAgIHJldHVybiAiIjsKICB9Cn0Kd2luZG93WyJiIl0gPSBtYWluJDEuYnVpbGRlcnM7CndpbmRvd1sianNyIl0gPSByZXdyaXRlOwpmdW5jdGlvbiBnZW5lcmF0ZVBhcnRpYWwoc2NyaXB0LCBjdHgpIHsKICBsZXQgcmVzdWx0MiA9IGN0eC5ub2RlLnJhbmdlID8gc2NyaXB0LnNsaWNlKGN0eC5ub2RlLnJhbmdlWzBdLCBjdHgubm9kZS5yYW5nZVsxXSkgOiBlc2NvZGVnZW4uZ2VuZXJhdGUoY3R4Lm5vZGUpOwogIGlmIChjdHgubm9kZS50eXBlLmluY2x1ZGVzKCJFeHByZXNzaW9uIikgJiYgY3R4LnBhcmVudD8ubm9kZS50eXBlLmluY2x1ZGVzKCJFeHByZXNzaW9uIikpIHsKICAgIHJlc3VsdDIgPSBgKCR7cmVzdWx0Mn0pYDsKICB9CiAgcmV0dXJuIHJlc3VsdDI7Cn0KCmZ1bmN0aW9uIGFjY2VzcyhhcGdsb2JhbCkgewogIGNvbnN0IG1vZCA9IHsKICAgIGdldDI6ICh0YXJnZXQsIGtleSkgPT4gewogICAgICByZXR1cm4gbW9kLmdldCh0YXJnZXRba2V5XSwga2V5KTsKICAgIH0sCiAgICBnZXQ6IChvYmplY3QsIGtleSkgPT4gewogICAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAic3RyaW5nIiAmJiBVTkRFRklOQUJMRS5pbmNsdWRlcyhrZXkpICYmICh0eXBlb2Ygb2JqZWN0ID09PSAib2JqZWN0IiAmJiBvYmplY3QgIT09IG51bGwgfHwgdHlwZW9mIG9iamVjdCA9PT0gImZ1bmN0aW9uIikgJiYgR0xPQkFMX1BST1hZIGluIG9iamVjdCkgewogICAgICAgICAgcmV0dXJuIG9iamVjdFtHTE9CQUxfUFJPWFldOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgICByZXR1cm4gb2JqZWN0OwogICAgfSwKICAgIHNldDI6ICh0YXJnZXQsIGtleSwgb3BlcmF0ZSwgcmlnaHRoYW5kKSA9PiB7CiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAic3RyaW5nIikgewogICAgICAgIGlmICh0YXJnZXQgPT09IGdsb2JhbCkgewogICAgICAgICAgaWYgKGtleSA9PT0gImxvY2F0aW9uIikgewogICAgICAgICAgICB0YXJnZXQgPSBsb2NhdGlvbltHTE9CQUxfUFJPWFldOwogICAgICAgICAgICBrZXkgPSAiaHJlZiI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgodHlwZW9mIHRhcmdldCA9PT0gIm9iamVjdCIgJiYgdGFyZ2V0ICE9PSBudWxsIHx8IHR5cGVvZiB0YXJnZXQgPT09ICJmdW5jdGlvbiIpICYmIEFDQ0VTU19LRVkgaW4gdGFyZ2V0ICYmIHRhcmdldFtBQ0NFU1NfS0VZXS5zZXQyICE9PSBtb2Quc2V0MikgewogICAgICAgICAgcmV0dXJuIHRhcmdldFtBQ0NFU1NfS0VZXS5zZXQyKHRhcmdldCwga2V5LCBvcGVyYXRlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG9wZXJhdGUobW9kLmdldCh0YXJnZXQsIGtleSksIGtleSwgcmlnaHRoYW5kKTsKICAgIH0sCiAgICBzZXQxOiAodGFyZ2V0LCBuYW1lLCBvcGVyYXRlLCBzZXQsIHJpZ2h0aGFuZCkgPT4gewogICAgICBjb25zb2xlLmxvZyh0YXJnZXQsIG5hbWUsIG9wZXJhdGUsIHNldCwgcmlnaHRoYW5kKTsKICAgICAgY29uc3QgcHJveHkgPSBtb2QuZ2V0KHRhcmdldCwgbmFtZSk7CiAgICAgIGNvbnN0IHByb3BlcnR5ID0gU3ltYm9sKCk7CiAgICAgIGNvbnN0IG9iamVjdCA9IHsKICAgICAgICBbcHJvcGVydHldOiBwcm94eQogICAgICB9OwogICAgICBjb25zdCByZXN1bHQgPSBvcGVyYXRlKG9iamVjdCwgcHJvcGVydHksIHJpZ2h0aGFuZCk7CiAgICAgIGNvbnN0IHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgICAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICJvYmplY3QiICYmIHRhcmdldCAhPT0gbnVsbCAmJiB0YXJnZXRbR0xPQkFMX05BTUVdID09PSAibG9jYXRpb24iKSB7CiAgICAgICAgY29uc29sZS5sb2coIndpbGwgc2V0IGxvY2F0aW9uIHRvICIgKyB2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0KHZhbHVlKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIG5ldzI6ICh0YXJnZXQsIGtleSwgYXJncykgPT4gewogICAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QobW9kLmdldCh0YXJnZXRba2V5XSwga2V5KSwgYXJncyk7CiAgICB9LAogICAgY2FsbDI6ICh0YXJnZXQsIGtleSwgYXJncykgPT4gewogICAgICByZXR1cm4gUmVmbGVjdC5hcHBseShtb2QuZ2V0KHRhcmdldFtrZXldLCBrZXkpLCB0YXJnZXQsIGFyZ3MpOwogICAgfSwKICAgIGV2YWxTY29wZTogKGNvZGUpID0+IHsKICAgICAgcmV0dXJuIGFwZ2xvYmFsLmpzUmV3cml0ZShjb2RlKTsKICAgIH0KICAgIC8vIGltcG9ydDogKGJhc2VVUkw6IHN0cmluZyB8IHVuZGVmaW5lZCwgdXJsOiBzdHJpbmcpOiBQcm9taXNlPHVua25vd24+ID0+IHsKICAgIC8vICAgLy8gQHRzLWlnbm9yZQogICAgLy8gICByZXR1cm4gaW1wb3J0KAogICAgLy8gICAgIC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8KICAgIC8vICAgICByb3V0ZUpTKAogICAgLy8gICAgICAgbmV3IFN0b21wVVJMKAogICAgLy8gICAgICAgICBuZXcgVVJMKHVybCwgYmFzZVVSTCB8fCB0aGlzLmNsaWVudC51cmwudG9TdHJpbmcoKSksCiAgICAvLyAgICAgICAgIHRoaXMuY2xpZW50LnVybAogICAgLy8gICAgICAgKSwKICAgIC8vICAgICAgIHRoaXMuY2xpZW50LnVybCwKICAgIC8vICAgICAgIHRoaXMuY2xpZW50LmNvbmZpZywKICAgIC8vICAgICAgICdnZW5lcmljTW9kdWxlJwogICAgLy8gICAgICkKICAgIC8vICAgKTsKICAgIC8vIH0sCiAgfTsKICByZXR1cm4gbW9kOwp9CgpmdW5jdGlvbiBob29rKHdpbikgewogIGNvbnN0IGFwaSA9IHsKICAgIGhvb2ssCiAgICBqc1Jld3JpdGU6IHJld3JpdGUKICB9OwogIGFwaVsiYWNjZXNzb3IiXSA9IGFjY2VzcyhhcGkpOwogIHdpblsiX19jb3JpdW0iXSA9IGFwaTsKfQoKLyoKICBAbGljZW5zZQoJUm9sbHVwLmpzIHYzLjI5LjAKCVdlZCwgMDYgU2VwIDIwMjMgMDU6MzI6NDAgR01UIC0gY29tbWl0IDg4NGU2NzgxZWQ2N2IxYzk0MjMyZmRmODBjZmU2YjFkOGZhZmI5ZDUKCglodHRwczovL2dpdGh1Yi5jb20vcm9sbHVwL3JvbGx1cAoKCVJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4KKi8KdmFyIGU9IjMuMjkuMCI7ZnVuY3Rpb24gdChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBzPXtleHBvcnRzOnt9fTshZnVuY3Rpb24oZSl7Y29uc3QgdD0iLCIuY2hhckNvZGVBdCgwKSxzPSI7Ii5jaGFyQ29kZUF0KDApLGk9IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iLG49bmV3IFVpbnQ4QXJyYXkoNjQpLHI9bmV3IFVpbnQ4QXJyYXkoMTI4KTtmb3IobGV0IGU9MDtlPGkubGVuZ3RoO2UrKyl7Y29uc3QgdD1pLmNoYXJDb2RlQXQoZSk7bltlXT10LHJbdF09ZTt9Y29uc3Qgbz0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyP25ldyBUZXh0RGVjb2RlcjoidW5kZWZpbmVkIiE9dHlwZW9mIEJ1ZmZlcj97ZGVjb2RlOmU9PkJ1ZmZlci5mcm9tKGUuYnVmZmVyLGUuYnl0ZU9mZnNldCxlLmJ5dGVMZW5ndGgpLnRvU3RyaW5nKCl9OntkZWNvZGUoZSl7bGV0IHQ9IiI7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspdCs9U3RyaW5nLmZyb21DaGFyQ29kZShlW3NdKTtyZXR1cm4gdH19O2Z1bmN0aW9uIGEoZSl7Y29uc3QgdD1uZXcgSW50MzJBcnJheSg1KSxzPVtdO2xldCBpPTA7ZG97Y29uc3Qgbj1sKGUsaSkscj1bXTtsZXQgbz0hMCxhPTA7dFswXT0wO2ZvcihsZXQgcz1pO3M8bjtzKyspe2xldCBpO3M9YyhlLHMsdCwwKTtjb25zdCBsPXRbMF07bDxhJiYobz0hMSksYT1sLGgoZSxzLG4pPyhzPWMoZSxzLHQsMSkscz1jKGUscyx0LDIpLHM9YyhlLHMsdCwzKSxoKGUscyxuKT8ocz1jKGUscyx0LDQpLGk9W2wsdFsxXSx0WzJdLHRbM10sdFs0XV0pOmk9W2wsdFsxXSx0WzJdLHRbM11dKTppPVtsXSxyLnB1c2goaSk7fW98fHUocikscy5wdXNoKHIpLGk9bisxO313aGlsZShpPD1lLmxlbmd0aCk7cmV0dXJuIHN9ZnVuY3Rpb24gbChlLHQpe2NvbnN0IHM9ZS5pbmRleE9mKCI7Iix0KTtyZXR1cm4gLTE9PT1zP2UubGVuZ3RoOnN9ZnVuY3Rpb24gYyhlLHQscyxpKXtsZXQgbj0wLG89MCxhPTA7ZG97Y29uc3Qgcz1lLmNoYXJDb2RlQXQodCsrKTthPXJbc10sbnw9KDMxJmEpPDxvLG8rPTU7fXdoaWxlKDMyJmEpO2NvbnN0IGw9MSZuO3JldHVybiBuPj4+PTEsbCYmKG49LTIxNDc0ODM2NDh8LW4pLHNbaV0rPW4sdH1mdW5jdGlvbiBoKGUscyxpKXtyZXR1cm4gIShzPj1pKSYmZS5jaGFyQ29kZUF0KHMpIT09dH1mdW5jdGlvbiB1KGUpe2Uuc29ydChkKTt9ZnVuY3Rpb24gZChlLHQpe3JldHVybiBlWzBdLXRbMF19ZnVuY3Rpb24gcChlKXtjb25zdCBpPW5ldyBJbnQzMkFycmF5KDUpLG49MTYzODQscj1uLTM2LGE9bmV3IFVpbnQ4QXJyYXkobiksbD1hLnN1YmFycmF5KDAscik7bGV0IGM9MCxoPSIiO2ZvcihsZXQgdT0wO3U8ZS5sZW5ndGg7dSsrKXtjb25zdCBkPWVbdV07aWYodT4wJiYoYz09PW4mJihoKz1vLmRlY29kZShhKSxjPTApLGFbYysrXT1zKSwwIT09ZC5sZW5ndGgpe2lbMF09MDtmb3IobGV0IGU9MDtlPGQubGVuZ3RoO2UrKyl7Y29uc3Qgcz1kW2VdO2M+ciYmKGgrPW8uZGVjb2RlKGwpLGEuY29weVdpdGhpbigwLHIsYyksYy09ciksZT4wJiYoYVtjKytdPXQpLGM9ZihhLGMsaSxzLDApLDEhPT1zLmxlbmd0aCYmKGM9ZihhLGMsaSxzLDEpLGM9ZihhLGMsaSxzLDIpLGM9ZihhLGMsaSxzLDMpLDQhPT1zLmxlbmd0aCYmKGM9ZihhLGMsaSxzLDQpKSk7fX19cmV0dXJuIGgrby5kZWNvZGUoYS5zdWJhcnJheSgwLGMpKX1mdW5jdGlvbiBmKGUsdCxzLGkscil7Y29uc3Qgbz1pW3JdO2xldCBhPW8tc1tyXTtzW3JdPW8sYT1hPDA/LWE8PDF8MTphPDwxO2Rve2xldCBzPTMxJmE7YT4+Pj01LGE+MCYmKHN8PTMyKSxlW3QrK109bltzXTt9d2hpbGUoYT4wKTtyZXR1cm4gdH1lLmRlY29kZT1hLGUuZW5jb2RlPXAsT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO30ocy5leHBvcnRzKTt2YXIgaT1zLmV4cG9ydHM7Y2xhc3Mgbntjb25zdHJ1Y3RvcihlKXt0aGlzLmJpdHM9ZSBpbnN0YW5jZW9mIG4/ZS5iaXRzLnNsaWNlKCk6W107fWFkZChlKXt0aGlzLmJpdHNbZT4+NV18PTE8PCgzMSZlKTt9aGFzKGUpe3JldHVybiAhISh0aGlzLmJpdHNbZT4+NV0mMTw8KDMxJmUpKX19bGV0IHI9Y2xhc3MgZXtjb25zdHJ1Y3RvcihlLHQscyl7dGhpcy5zdGFydD1lLHRoaXMuZW5kPXQsdGhpcy5vcmlnaW5hbD1zLHRoaXMuaW50cm89IiIsdGhpcy5vdXRybz0iIix0aGlzLmNvbnRlbnQ9cyx0aGlzLnN0b3JlTmFtZT0hMSx0aGlzLmVkaXRlZD0hMSx0aGlzLnByZXZpb3VzPW51bGwsdGhpcy5uZXh0PW51bGw7fWFwcGVuZExlZnQoZSl7dGhpcy5vdXRybys9ZTt9YXBwZW5kUmlnaHQoZSl7dGhpcy5pbnRybz10aGlzLmludHJvK2U7fWNsb25lKCl7Y29uc3QgdD1uZXcgZSh0aGlzLnN0YXJ0LHRoaXMuZW5kLHRoaXMub3JpZ2luYWwpO3JldHVybiB0LmludHJvPXRoaXMuaW50cm8sdC5vdXRybz10aGlzLm91dHJvLHQuY29udGVudD10aGlzLmNvbnRlbnQsdC5zdG9yZU5hbWU9dGhpcy5zdG9yZU5hbWUsdC5lZGl0ZWQ9dGhpcy5lZGl0ZWQsdH1jb250YWlucyhlKXtyZXR1cm4gdGhpcy5zdGFydDxlJiZlPHRoaXMuZW5kfWVhY2hOZXh0KGUpe2xldCB0PXRoaXM7Zm9yKDt0OyllKHQpLHQ9dC5uZXh0O31lYWNoUHJldmlvdXMoZSl7bGV0IHQ9dGhpcztmb3IoO3Q7KWUodCksdD10LnByZXZpb3VzO31lZGl0KGUsdCxzKXtyZXR1cm4gdGhpcy5jb250ZW50PWUsc3x8KHRoaXMuaW50cm89IiIsdGhpcy5vdXRybz0iIiksdGhpcy5zdG9yZU5hbWU9dCx0aGlzLmVkaXRlZD0hMCx0aGlzfXByZXBlbmRMZWZ0KGUpe3RoaXMub3V0cm89ZSt0aGlzLm91dHJvO31wcmVwZW5kUmlnaHQoZSl7dGhpcy5pbnRybz1lK3RoaXMuaW50cm87fXNwbGl0KHQpe2NvbnN0IHM9dC10aGlzLnN0YXJ0LGk9dGhpcy5vcmlnaW5hbC5zbGljZSgwLHMpLG49dGhpcy5vcmlnaW5hbC5zbGljZShzKTt0aGlzLm9yaWdpbmFsPWk7Y29uc3Qgcj1uZXcgZSh0LHRoaXMuZW5kLG4pO3JldHVybiByLm91dHJvPXRoaXMub3V0cm8sdGhpcy5vdXRybz0iIix0aGlzLmVuZD10LHRoaXMuZWRpdGVkPyhyLmVkaXQoIiIsITEpLHRoaXMuY29udGVudD0iIik6dGhpcy5jb250ZW50PWksci5uZXh0PXRoaXMubmV4dCxyLm5leHQmJihyLm5leHQucHJldmlvdXM9ciksci5wcmV2aW91cz10aGlzLHRoaXMubmV4dD1yLHJ9dG9TdHJpbmcoKXtyZXR1cm4gdGhpcy5pbnRybyt0aGlzLmNvbnRlbnQrdGhpcy5vdXRyb310cmltRW5kKGUpe2lmKHRoaXMub3V0cm89dGhpcy5vdXRyby5yZXBsYWNlKGUsIiIpLHRoaXMub3V0cm8ubGVuZ3RoKXJldHVybiAhMDtjb25zdCB0PXRoaXMuY29udGVudC5yZXBsYWNlKGUsIiIpO3JldHVybiB0Lmxlbmd0aD8odCE9PXRoaXMuY29udGVudCYmKHRoaXMuc3BsaXQodGhpcy5zdGFydCt0Lmxlbmd0aCkuZWRpdCgiIix2b2lkIDAsITApLHRoaXMuZWRpdGVkJiZ0aGlzLmVkaXQodCx0aGlzLnN0b3JlTmFtZSwhMCkpLCEwKToodGhpcy5lZGl0KCIiLHZvaWQgMCwhMCksdGhpcy5pbnRybz10aGlzLmludHJvLnJlcGxhY2UoZSwiIiksISF0aGlzLmludHJvLmxlbmd0aHx8dm9pZCAwKX10cmltU3RhcnQoZSl7aWYodGhpcy5pbnRybz10aGlzLmludHJvLnJlcGxhY2UoZSwiIiksdGhpcy5pbnRyby5sZW5ndGgpcmV0dXJuICEwO2NvbnN0IHQ9dGhpcy5jb250ZW50LnJlcGxhY2UoZSwiIik7aWYodC5sZW5ndGgpe2lmKHQhPT10aGlzLmNvbnRlbnQpe2NvbnN0IGU9dGhpcy5zcGxpdCh0aGlzLmVuZC10Lmxlbmd0aCk7dGhpcy5lZGl0ZWQmJmUuZWRpdCh0LHRoaXMuc3RvcmVOYW1lLCEwKSx0aGlzLmVkaXQoIiIsdm9pZCAwLCEwKTt9cmV0dXJuICEwfXJldHVybiB0aGlzLmVkaXQoIiIsdm9pZCAwLCEwKSx0aGlzLm91dHJvPXRoaXMub3V0cm8ucmVwbGFjZShlLCIiKSwhIXRoaXMub3V0cm8ubGVuZ3RofHx2b2lkIDB9fTtmdW5jdGlvbiBvKCl7cmV0dXJuICJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiYiZnVuY3Rpb24iPT10eXBlb2Ygd2luZG93LmJ0b2E/ZT0+d2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGUpKSk6ImZ1bmN0aW9uIj09dHlwZW9mIEJ1ZmZlcj9lPT5CdWZmZXIuZnJvbShlLCJ1dGYtOCIpLnRvU3RyaW5nKCJiYXNlNjQiKTooKT0+e3Rocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZW52aXJvbm1lbnQ6IGB3aW5kb3cuYnRvYWAgb3IgYEJ1ZmZlcmAgc2hvdWxkIGJlIHN1cHBvcnRlZC4iKX19Y29uc3QgYT1vKCk7Y2xhc3MgbHtjb25zdHJ1Y3RvcihlKXt0aGlzLnZlcnNpb249Myx0aGlzLmZpbGU9ZS5maWxlLHRoaXMuc291cmNlcz1lLnNvdXJjZXMsdGhpcy5zb3VyY2VzQ29udGVudD1lLnNvdXJjZXNDb250ZW50LHRoaXMubmFtZXM9ZS5uYW1lcyx0aGlzLm1hcHBpbmdzPWkuZW5jb2RlKGUubWFwcGluZ3MpLHZvaWQgMCE9PWUueF9nb29nbGVfaWdub3JlTGlzdCYmKHRoaXMueF9nb29nbGVfaWdub3JlTGlzdD1lLnhfZ29vZ2xlX2lnbm9yZUxpc3QpO310b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzKX10b1VybCgpe3JldHVybiAiZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCIrYSh0aGlzLnRvU3RyaW5nKCkpfX1mdW5jdGlvbiBjKGUsdCl7Y29uc3Qgcz1lLnNwbGl0KC9bL1xcXS8pLGk9dC5zcGxpdCgvWy9cXF0vKTtmb3Iocy5wb3AoKTtzWzBdPT09aVswXTspcy5zaGlmdCgpLGkuc2hpZnQoKTtpZihzLmxlbmd0aCl7bGV0IGU9cy5sZW5ndGg7Zm9yKDtlLS07KXNbZV09Ii4uIjt9cmV0dXJuIHMuY29uY2F0KGkpLmpvaW4oIi8iKX1jb25zdCBoPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7ZnVuY3Rpb24gdShlKXtyZXR1cm4gIltvYmplY3QgT2JqZWN0XSI9PT1oLmNhbGwoZSl9ZnVuY3Rpb24gZChlKXtjb25zdCB0PWUuc3BsaXQoIlxuIikscz1bXTtmb3IobGV0IGU9MCxpPTA7ZTx0Lmxlbmd0aDtlKyspcy5wdXNoKGkpLGkrPXRbZV0ubGVuZ3RoKzE7cmV0dXJuIGZ1bmN0aW9uKGUpe2xldCB0PTAsaT1zLmxlbmd0aDtmb3IoO3Q8aTspe2NvbnN0IG49dCtpPj4xO2U8c1tuXT9pPW46dD1uKzE7fWNvbnN0IG49dC0xO3JldHVybiB7bGluZTpuLGNvbHVtbjplLXNbbl19fX1jb25zdCBwPS9cdy87Y2xhc3MgZntjb25zdHJ1Y3RvcihlKXt0aGlzLmhpcmVzPWUsdGhpcy5nZW5lcmF0ZWRDb2RlTGluZT0wLHRoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbj0wLHRoaXMucmF3PVtdLHRoaXMucmF3U2VnbWVudHM9dGhpcy5yYXdbdGhpcy5nZW5lcmF0ZWRDb2RlTGluZV09W10sdGhpcy5wZW5kaW5nPW51bGw7fWFkZEVkaXQoZSx0LHMsaSl7aWYodC5sZW5ndGgpe2NvbnN0IHQ9W3RoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbixlLHMubGluZSxzLmNvbHVtbl07aT49MCYmdC5wdXNoKGkpLHRoaXMucmF3U2VnbWVudHMucHVzaCh0KTt9ZWxzZSB0aGlzLnBlbmRpbmcmJnRoaXMucmF3U2VnbWVudHMucHVzaCh0aGlzLnBlbmRpbmcpO3RoaXMuYWR2YW5jZSh0KSx0aGlzLnBlbmRpbmc9bnVsbDt9YWRkVW5lZGl0ZWRDaHVuayhlLHQscyxpLG4pe2xldCByPXQuc3RhcnQsbz0hMCxhPSExO2Zvcig7cjx0LmVuZDspe2lmKHRoaXMuaGlyZXN8fG98fG4uaGFzKHIpKXtjb25zdCB0PVt0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4sZSxpLmxpbmUsaS5jb2x1bW5dOyJib3VuZGFyeSI9PT10aGlzLmhpcmVzP3AudGVzdChzW3JdKT9hfHwodGhpcy5yYXdTZWdtZW50cy5wdXNoKHQpLGE9ITApOih0aGlzLnJhd1NlZ21lbnRzLnB1c2godCksYT0hMSk6dGhpcy5yYXdTZWdtZW50cy5wdXNoKHQpO30iXG4iPT09c1tyXT8oaS5saW5lKz0xLGkuY29sdW1uPTAsdGhpcy5nZW5lcmF0ZWRDb2RlTGluZSs9MSx0aGlzLnJhd1t0aGlzLmdlbmVyYXRlZENvZGVMaW5lXT10aGlzLnJhd1NlZ21lbnRzPVtdLHRoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbj0wLG89ITApOihpLmNvbHVtbis9MSx0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4rPTEsbz0hMSkscis9MTt9dGhpcy5wZW5kaW5nPW51bGw7fWFkdmFuY2UoZSl7aWYoIWUpcmV0dXJuO2NvbnN0IHQ9ZS5zcGxpdCgiXG4iKTtpZih0Lmxlbmd0aD4xKXtmb3IobGV0IGU9MDtlPHQubGVuZ3RoLTE7ZSsrKXRoaXMuZ2VuZXJhdGVkQ29kZUxpbmUrKyx0aGlzLnJhd1t0aGlzLmdlbmVyYXRlZENvZGVMaW5lXT10aGlzLnJhd1NlZ21lbnRzPVtdO3RoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbj0wO310aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4rPXRbdC5sZW5ndGgtMV0ubGVuZ3RoO319Y29uc3QgbT0iXG4iLGc9e2luc2VydExlZnQ6ITEsaW5zZXJ0UmlnaHQ6ITEsc3RvcmVOYW1lOiExfTtjbGFzcyB5e2NvbnN0cnVjdG9yKGUsdD17fSl7Y29uc3Qgcz1uZXcgcigwLGUubGVuZ3RoLGUpO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse29yaWdpbmFsOnt3cml0YWJsZTohMCx2YWx1ZTplfSxvdXRybzp7d3JpdGFibGU6ITAsdmFsdWU6IiJ9LGludHJvOnt3cml0YWJsZTohMCx2YWx1ZToiIn0sZmlyc3RDaHVuazp7d3JpdGFibGU6ITAsdmFsdWU6c30sbGFzdENodW5rOnt3cml0YWJsZTohMCx2YWx1ZTpzfSxsYXN0U2VhcmNoZWRDaHVuazp7d3JpdGFibGU6ITAsdmFsdWU6c30sYnlTdGFydDp7d3JpdGFibGU6ITAsdmFsdWU6e319LGJ5RW5kOnt3cml0YWJsZTohMCx2YWx1ZTp7fX0sZmlsZW5hbWU6e3dyaXRhYmxlOiEwLHZhbHVlOnQuZmlsZW5hbWV9LGluZGVudEV4Y2x1c2lvblJhbmdlczp7d3JpdGFibGU6ITAsdmFsdWU6dC5pbmRlbnRFeGNsdXNpb25SYW5nZXN9LHNvdXJjZW1hcExvY2F0aW9uczp7d3JpdGFibGU6ITAsdmFsdWU6bmV3IG59LHN0b3JlZE5hbWVzOnt3cml0YWJsZTohMCx2YWx1ZTp7fX0saW5kZW50U3RyOnt3cml0YWJsZTohMCx2YWx1ZTp2b2lkIDB9LGlnbm9yZUxpc3Q6e3dyaXRhYmxlOiEwLHZhbHVlOnQuaWdub3JlTGlzdH19KSx0aGlzLmJ5U3RhcnRbMF09cyx0aGlzLmJ5RW5kW2UubGVuZ3RoXT1zO31hZGRTb3VyY2VtYXBMb2NhdGlvbihlKXt0aGlzLnNvdXJjZW1hcExvY2F0aW9ucy5hZGQoZSk7fWFwcGVuZChlKXtpZigic3RyaW5nIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcigib3V0cm8gY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7cmV0dXJuIHRoaXMub3V0cm8rPWUsdGhpc31hcHBlbmRMZWZ0KGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiB0KXRocm93IG5ldyBUeXBlRXJyb3IoImluc2VydGVkIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZyIpO3RoaXMuX3NwbGl0KGUpO2NvbnN0IHM9dGhpcy5ieUVuZFtlXTtyZXR1cm4gcz9zLmFwcGVuZExlZnQodCk6dGhpcy5pbnRybys9dCx0aGlzfWFwcGVuZFJpZ2h0KGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiB0KXRocm93IG5ldyBUeXBlRXJyb3IoImluc2VydGVkIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZyIpO3RoaXMuX3NwbGl0KGUpO2NvbnN0IHM9dGhpcy5ieVN0YXJ0W2VdO3JldHVybiBzP3MuYXBwZW5kUmlnaHQodCk6dGhpcy5vdXRybys9dCx0aGlzfWNsb25lKCl7Y29uc3QgZT1uZXcgeSh0aGlzLm9yaWdpbmFsLHtmaWxlbmFtZTp0aGlzLmZpbGVuYW1lfSk7bGV0IHQ9dGhpcy5maXJzdENodW5rLHM9ZS5maXJzdENodW5rPWUubGFzdFNlYXJjaGVkQ2h1bms9dC5jbG9uZSgpO2Zvcig7dDspe2UuYnlTdGFydFtzLnN0YXJ0XT1zLGUuYnlFbmRbcy5lbmRdPXM7Y29uc3QgaT10Lm5leHQsbj1pJiZpLmNsb25lKCk7biYmKHMubmV4dD1uLG4ucHJldmlvdXM9cyxzPW4pLHQ9aTt9cmV0dXJuIGUubGFzdENodW5rPXMsdGhpcy5pbmRlbnRFeGNsdXNpb25SYW5nZXMmJihlLmluZGVudEV4Y2x1c2lvblJhbmdlcz10aGlzLmluZGVudEV4Y2x1c2lvblJhbmdlcy5zbGljZSgpKSxlLnNvdXJjZW1hcExvY2F0aW9ucz1uZXcgbih0aGlzLnNvdXJjZW1hcExvY2F0aW9ucyksZS5pbnRybz10aGlzLmludHJvLGUub3V0cm89dGhpcy5vdXRybyxlfWdlbmVyYXRlRGVjb2RlZE1hcChlKXtlPWV8fHt9O2NvbnN0IHQ9T2JqZWN0LmtleXModGhpcy5zdG9yZWROYW1lcykscz1uZXcgZihlLmhpcmVzKSxpPWQodGhpcy5vcmlnaW5hbCk7cmV0dXJuIHRoaXMuaW50cm8mJnMuYWR2YW5jZSh0aGlzLmludHJvKSx0aGlzLmZpcnN0Q2h1bmsuZWFjaE5leHQoKGU9Pntjb25zdCBuPWkoZS5zdGFydCk7ZS5pbnRyby5sZW5ndGgmJnMuYWR2YW5jZShlLmludHJvKSxlLmVkaXRlZD9zLmFkZEVkaXQoMCxlLmNvbnRlbnQsbixlLnN0b3JlTmFtZT90LmluZGV4T2YoZS5vcmlnaW5hbCk6LTEpOnMuYWRkVW5lZGl0ZWRDaHVuaygwLGUsdGhpcy5vcmlnaW5hbCxuLHRoaXMuc291cmNlbWFwTG9jYXRpb25zKSxlLm91dHJvLmxlbmd0aCYmcy5hZHZhbmNlKGUub3V0cm8pO30pKSx7ZmlsZTplLmZpbGU/ZS5maWxlLnNwbGl0KC9bL1xcXS8pLnBvcCgpOnZvaWQgMCxzb3VyY2VzOltlLnNvdXJjZT9jKGUuZmlsZXx8IiIsZS5zb3VyY2UpOmUuZmlsZXx8IiJdLHNvdXJjZXNDb250ZW50OmUuaW5jbHVkZUNvbnRlbnQ/W3RoaXMub3JpZ2luYWxdOnZvaWQgMCxuYW1lczp0LG1hcHBpbmdzOnMucmF3LHhfZ29vZ2xlX2lnbm9yZUxpc3Q6dGhpcy5pZ25vcmVMaXN0P1swXTp2b2lkIDB9fWdlbmVyYXRlTWFwKGUpe3JldHVybiBuZXcgbCh0aGlzLmdlbmVyYXRlRGVjb2RlZE1hcChlKSl9X2Vuc3VyZWluZGVudFN0cigpe3ZvaWQgMD09PXRoaXMuaW5kZW50U3RyJiYodGhpcy5pbmRlbnRTdHI9ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLnNwbGl0KCJcbiIpLHM9dC5maWx0ZXIoKGU9Pi9eXHQrLy50ZXN0KGUpKSksaT10LmZpbHRlcigoZT0+L14gezIsfS8udGVzdChlKSkpO2lmKDA9PT1zLmxlbmd0aCYmMD09PWkubGVuZ3RoKXJldHVybiBudWxsO2lmKHMubGVuZ3RoPj1pLmxlbmd0aClyZXR1cm4gIlx0Ijtjb25zdCBuPWkucmVkdWNlKCgoZSx0KT0+e2NvbnN0IHM9L14gKy8uZXhlYyh0KVswXS5sZW5ndGg7cmV0dXJuIE1hdGgubWluKHMsZSl9KSwxLzApO3JldHVybiBuZXcgQXJyYXkobisxKS5qb2luKCIgIil9KHRoaXMub3JpZ2luYWwpKTt9X2dldFJhd0luZGVudFN0cmluZygpe3JldHVybiB0aGlzLl9lbnN1cmVpbmRlbnRTdHIoKSx0aGlzLmluZGVudFN0cn1nZXRJbmRlbnRTdHJpbmcoKXtyZXR1cm4gdGhpcy5fZW5zdXJlaW5kZW50U3RyKCksbnVsbD09PXRoaXMuaW5kZW50U3RyPyJcdCI6dGhpcy5pbmRlbnRTdHJ9aW5kZW50KGUsdCl7Y29uc3Qgcz0vXlteXHJcbl0vZ207aWYodShlKSYmKHQ9ZSxlPXZvaWQgMCksdm9pZCAwPT09ZSYmKHRoaXMuX2Vuc3VyZWluZGVudFN0cigpLGU9dGhpcy5pbmRlbnRTdHJ8fCJcdCIpLCIiPT09ZSlyZXR1cm4gdGhpcztjb25zdCBpPXt9O2lmKCh0PXR8fHt9KS5leGNsdWRlKXsoIm51bWJlciI9PXR5cGVvZiB0LmV4Y2x1ZGVbMF0/W3QuZXhjbHVkZV06dC5leGNsdWRlKS5mb3JFYWNoKChlPT57Zm9yKGxldCB0PWVbMF07dDxlWzFdO3QrPTEpaVt0XT0hMDt9KSk7fWxldCBuPSExIT09dC5pbmRlbnRTdGFydDtjb25zdCByPXQ9Pm4/YCR7ZX0ke3R9YDoobj0hMCx0KTt0aGlzLmludHJvPXRoaXMuaW50cm8ucmVwbGFjZShzLHIpO2xldCBvPTAsYT10aGlzLmZpcnN0Q2h1bms7Zm9yKDthOyl7Y29uc3QgdD1hLmVuZDtpZihhLmVkaXRlZClpW29dfHwoYS5jb250ZW50PWEuY29udGVudC5yZXBsYWNlKHMsciksYS5jb250ZW50Lmxlbmd0aCYmKG49IlxuIj09PWEuY29udGVudFthLmNvbnRlbnQubGVuZ3RoLTFdKSk7ZWxzZSBmb3Iobz1hLnN0YXJ0O288dDspe2lmKCFpW29dKXtjb25zdCB0PXRoaXMub3JpZ2luYWxbb107IlxuIj09PXQ/bj0hMDoiXHIiIT09dCYmbiYmKG49ITEsbz09PWEuc3RhcnR8fCh0aGlzLl9zcGxpdENodW5rKGEsbyksYT1hLm5leHQpLGEucHJlcGVuZFJpZ2h0KGUpKTt9bys9MTt9bz1hLmVuZCxhPWEubmV4dDt9cmV0dXJuIHRoaXMub3V0cm89dGhpcy5vdXRyby5yZXBsYWNlKHMsciksdGhpc31pbnNlcnQoKXt0aHJvdyBuZXcgRXJyb3IoIm1hZ2ljU3RyaW5nLmluc2VydCguLi4pIGlzIGRlcHJlY2F0ZWQuIFVzZSBwcmVwZW5kUmlnaHQoLi4uKSBvciBhcHBlbmRMZWZ0KC4uLikiKX1pbnNlcnRMZWZ0KGUsdCl7cmV0dXJuIGcuaW5zZXJ0TGVmdHx8KGNvbnNvbGUud2FybigibWFnaWNTdHJpbmcuaW5zZXJ0TGVmdCguLi4pIGlzIGRlcHJlY2F0ZWQuIFVzZSBtYWdpY1N0cmluZy5hcHBlbmRMZWZ0KC4uLikgaW5zdGVhZCIpLGcuaW5zZXJ0TGVmdD0hMCksdGhpcy5hcHBlbmRMZWZ0KGUsdCl9aW5zZXJ0UmlnaHQoZSx0KXtyZXR1cm4gZy5pbnNlcnRSaWdodHx8KGNvbnNvbGUud2FybigibWFnaWNTdHJpbmcuaW5zZXJ0UmlnaHQoLi4uKSBpcyBkZXByZWNhdGVkLiBVc2UgbWFnaWNTdHJpbmcucHJlcGVuZFJpZ2h0KC4uLikgaW5zdGVhZCIpLGcuaW5zZXJ0UmlnaHQ9ITApLHRoaXMucHJlcGVuZFJpZ2h0KGUsdCl9bW92ZShlLHQscyl7aWYocz49ZSYmczw9dCl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBtb3ZlIGEgc2VsZWN0aW9uIGluc2lkZSBpdHNlbGYiKTt0aGlzLl9zcGxpdChlKSx0aGlzLl9zcGxpdCh0KSx0aGlzLl9zcGxpdChzKTtjb25zdCBpPXRoaXMuYnlTdGFydFtlXSxuPXRoaXMuYnlFbmRbdF0scj1pLnByZXZpb3VzLG89bi5uZXh0LGE9dGhpcy5ieVN0YXJ0W3NdO2lmKCFhJiZuPT09dGhpcy5sYXN0Q2h1bmspcmV0dXJuIHRoaXM7Y29uc3QgbD1hP2EucHJldmlvdXM6dGhpcy5sYXN0Q2h1bms7cmV0dXJuIHImJihyLm5leHQ9byksbyYmKG8ucHJldmlvdXM9ciksbCYmKGwubmV4dD1pKSxhJiYoYS5wcmV2aW91cz1uKSxpLnByZXZpb3VzfHwodGhpcy5maXJzdENodW5rPW4ubmV4dCksbi5uZXh0fHwodGhpcy5sYXN0Q2h1bms9aS5wcmV2aW91cyx0aGlzLmxhc3RDaHVuay5uZXh0PW51bGwpLGkucHJldmlvdXM9bCxuLm5leHQ9YXx8bnVsbCxsfHwodGhpcy5maXJzdENodW5rPWkpLGF8fCh0aGlzLmxhc3RDaHVuaz1uKSx0aGlzfW92ZXJ3cml0ZShlLHQscyxpKXtyZXR1cm4gaT1pfHx7fSx0aGlzLnVwZGF0ZShlLHQscyx7Li4uaSxvdmVyd3JpdGU6IWkuY29udGVudE9ubHl9KX11cGRhdGUoZSx0LHMsaSl7aWYoInN0cmluZyIhPXR5cGVvZiBzKXRocm93IG5ldyBUeXBlRXJyb3IoInJlcGxhY2VtZW50IGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZyIpO2Zvcig7ZTwwOyllKz10aGlzLm9yaWdpbmFsLmxlbmd0aDtmb3IoO3Q8MDspdCs9dGhpcy5vcmlnaW5hbC5sZW5ndGg7aWYodD50aGlzLm9yaWdpbmFsLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoImVuZCBpcyBvdXQgb2YgYm91bmRzIik7aWYoZT09PXQpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgb3ZlcndyaXRlIGEgemVyby1sZW5ndGggcmFuZ2Ug4oCTIHVzZSBhcHBlbmRMZWZ0IG9yIHByZXBlbmRSaWdodCBpbnN0ZWFkIik7dGhpcy5fc3BsaXQoZSksdGhpcy5fc3BsaXQodCksITA9PT1pJiYoZy5zdG9yZU5hbWV8fChjb25zb2xlLndhcm4oIlRoZSBmaW5hbCBhcmd1bWVudCB0byBtYWdpY1N0cmluZy5vdmVyd3JpdGUoLi4uKSBzaG91bGQgYmUgYW4gb3B0aW9ucyBvYmplY3QuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcmljaC1oYXJyaXMvbWFnaWMtc3RyaW5nIiksZy5zdG9yZU5hbWU9ITApLGk9e3N0b3JlTmFtZTohMH0pO2NvbnN0IG49dm9pZCAwIT09aSYmaS5zdG9yZU5hbWUsbz12b2lkIDAhPT1pJiZpLm92ZXJ3cml0ZTtpZihuKXtjb25zdCBzPXRoaXMub3JpZ2luYWwuc2xpY2UoZSx0KTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5zdG9yZWROYW1lcyxzLHt3cml0YWJsZTohMCx2YWx1ZTohMCxlbnVtZXJhYmxlOiEwfSk7fWNvbnN0IGE9dGhpcy5ieVN0YXJ0W2VdLGw9dGhpcy5ieUVuZFt0XTtpZihhKXtsZXQgZT1hO2Zvcig7ZSE9PWw7KXtpZihlLm5leHQhPT10aGlzLmJ5U3RhcnRbZS5lbmRdKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IG92ZXJ3cml0ZSBhY3Jvc3MgYSBzcGxpdCBwb2ludCIpO2U9ZS5uZXh0LGUuZWRpdCgiIiwhMSk7fWEuZWRpdChzLG4sIW8pO31lbHNlIHtjb25zdCBpPW5ldyByKGUsdCwiIikuZWRpdChzLG4pO2wubmV4dD1pLGkucHJldmlvdXM9bDt9cmV0dXJuIHRoaXN9cHJlcGVuZChlKXtpZigic3RyaW5nIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcigib3V0cm8gY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7cmV0dXJuIHRoaXMuaW50cm89ZSt0aGlzLmludHJvLHRoaXN9cHJlcGVuZExlZnQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5zZXJ0ZWQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7dGhpcy5fc3BsaXQoZSk7Y29uc3Qgcz10aGlzLmJ5RW5kW2VdO3JldHVybiBzP3MucHJlcGVuZExlZnQodCk6dGhpcy5pbnRybz10K3RoaXMuaW50cm8sdGhpc31wcmVwZW5kUmlnaHQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5zZXJ0ZWQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7dGhpcy5fc3BsaXQoZSk7Y29uc3Qgcz10aGlzLmJ5U3RhcnRbZV07cmV0dXJuIHM/cy5wcmVwZW5kUmlnaHQodCk6dGhpcy5vdXRybz10K3RoaXMub3V0cm8sdGhpc31yZW1vdmUoZSx0KXtmb3IoO2U8MDspZSs9dGhpcy5vcmlnaW5hbC5sZW5ndGg7Zm9yKDt0PDA7KXQrPXRoaXMub3JpZ2luYWwubGVuZ3RoO2lmKGU9PT10KXJldHVybiB0aGlzO2lmKGU8MHx8dD50aGlzLm9yaWdpbmFsLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIkNoYXJhY3RlciBpcyBvdXQgb2YgYm91bmRzIik7aWYoZT50KXRocm93IG5ldyBFcnJvcigiZW5kIG11c3QgYmUgZ3JlYXRlciB0aGFuIHN0YXJ0Iik7dGhpcy5fc3BsaXQoZSksdGhpcy5fc3BsaXQodCk7bGV0IHM9dGhpcy5ieVN0YXJ0W2VdO2Zvcig7czspcy5pbnRybz0iIixzLm91dHJvPSIiLHMuZWRpdCgiIikscz10PnMuZW5kP3RoaXMuYnlTdGFydFtzLmVuZF06bnVsbDtyZXR1cm4gdGhpc31sYXN0Q2hhcigpe2lmKHRoaXMub3V0cm8ubGVuZ3RoKXJldHVybiB0aGlzLm91dHJvW3RoaXMub3V0cm8ubGVuZ3RoLTFdO2xldCBlPXRoaXMubGFzdENodW5rO2Rve2lmKGUub3V0cm8ubGVuZ3RoKXJldHVybiBlLm91dHJvW2Uub3V0cm8ubGVuZ3RoLTFdO2lmKGUuY29udGVudC5sZW5ndGgpcmV0dXJuIGUuY29udGVudFtlLmNvbnRlbnQubGVuZ3RoLTFdO2lmKGUuaW50cm8ubGVuZ3RoKXJldHVybiBlLmludHJvW2UuaW50cm8ubGVuZ3RoLTFdfXdoaWxlKGU9ZS5wcmV2aW91cyk7cmV0dXJuIHRoaXMuaW50cm8ubGVuZ3RoP3RoaXMuaW50cm9bdGhpcy5pbnRyby5sZW5ndGgtMV06IiJ9bGFzdExpbmUoKXtsZXQgZT10aGlzLm91dHJvLmxhc3RJbmRleE9mKG0pO2lmKC0xIT09ZSlyZXR1cm4gdGhpcy5vdXRyby5zdWJzdHIoZSsxKTtsZXQgdD10aGlzLm91dHJvLHM9dGhpcy5sYXN0Q2h1bms7ZG97aWYocy5vdXRyby5sZW5ndGg+MCl7aWYoZT1zLm91dHJvLmxhc3RJbmRleE9mKG0pLC0xIT09ZSlyZXR1cm4gcy5vdXRyby5zdWJzdHIoZSsxKSt0O3Q9cy5vdXRybyt0O31pZihzLmNvbnRlbnQubGVuZ3RoPjApe2lmKGU9cy5jb250ZW50Lmxhc3RJbmRleE9mKG0pLC0xIT09ZSlyZXR1cm4gcy5jb250ZW50LnN1YnN0cihlKzEpK3Q7dD1zLmNvbnRlbnQrdDt9aWYocy5pbnRyby5sZW5ndGg+MCl7aWYoZT1zLmludHJvLmxhc3RJbmRleE9mKG0pLC0xIT09ZSlyZXR1cm4gcy5pbnRyby5zdWJzdHIoZSsxKSt0O3Q9cy5pbnRybyt0O319d2hpbGUocz1zLnByZXZpb3VzKTtyZXR1cm4gZT10aGlzLmludHJvLmxhc3RJbmRleE9mKG0pLC0xIT09ZT90aGlzLmludHJvLnN1YnN0cihlKzEpK3Q6dGhpcy5pbnRybyt0fXNsaWNlKGU9MCx0PXRoaXMub3JpZ2luYWwubGVuZ3RoKXtmb3IoO2U8MDspZSs9dGhpcy5vcmlnaW5hbC5sZW5ndGg7Zm9yKDt0PDA7KXQrPXRoaXMub3JpZ2luYWwubGVuZ3RoO2xldCBzPSIiLGk9dGhpcy5maXJzdENodW5rO2Zvcig7aSYmKGkuc3RhcnQ+ZXx8aS5lbmQ8PWUpOyl7aWYoaS5zdGFydDx0JiZpLmVuZD49dClyZXR1cm4gcztpPWkubmV4dDt9aWYoaSYmaS5lZGl0ZWQmJmkuc3RhcnQhPT1lKXRocm93IG5ldyBFcnJvcihgQ2Fubm90IHVzZSByZXBsYWNlZCBjaGFyYWN0ZXIgJHtlfSBhcyBzbGljZSBzdGFydCBhbmNob3IuYCk7Y29uc3Qgbj1pO2Zvcig7aTspeyFpLmludHJvfHxuPT09aSYmaS5zdGFydCE9PWV8fChzKz1pLmludHJvKTtjb25zdCByPWkuc3RhcnQ8dCYmaS5lbmQ+PXQ7aWYociYmaS5lZGl0ZWQmJmkuZW5kIT09dCl0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCB1c2UgcmVwbGFjZWQgY2hhcmFjdGVyICR7dH0gYXMgc2xpY2UgZW5kIGFuY2hvci5gKTtjb25zdCBvPW49PT1pP2UtaS5zdGFydDowLGE9cj9pLmNvbnRlbnQubGVuZ3RoK3QtaS5lbmQ6aS5jb250ZW50Lmxlbmd0aDtpZihzKz1pLmNvbnRlbnQuc2xpY2UobyxhKSwhaS5vdXRyb3x8ciYmaS5lbmQhPT10fHwocys9aS5vdXRybykscilicmVhaztpPWkubmV4dDt9cmV0dXJuIHN9c25pcChlLHQpe2NvbnN0IHM9dGhpcy5jbG9uZSgpO3JldHVybiBzLnJlbW92ZSgwLGUpLHMucmVtb3ZlKHQscy5vcmlnaW5hbC5sZW5ndGgpLHN9X3NwbGl0KGUpe2lmKHRoaXMuYnlTdGFydFtlXXx8dGhpcy5ieUVuZFtlXSlyZXR1cm47bGV0IHQ9dGhpcy5sYXN0U2VhcmNoZWRDaHVuaztjb25zdCBzPWU+dC5lbmQ7Zm9yKDt0Oyl7aWYodC5jb250YWlucyhlKSlyZXR1cm4gdGhpcy5fc3BsaXRDaHVuayh0LGUpO3Q9cz90aGlzLmJ5U3RhcnRbdC5lbmRdOnRoaXMuYnlFbmRbdC5zdGFydF07fX1fc3BsaXRDaHVuayhlLHQpe2lmKGUuZWRpdGVkJiZlLmNvbnRlbnQubGVuZ3RoKXtjb25zdCBzPWQodGhpcy5vcmlnaW5hbCkodCk7dGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc3BsaXQgYSBjaHVuayB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gZWRpdGVkICgke3MubGluZX06JHtzLmNvbHVtbn0g4oCTICIke2Uub3JpZ2luYWx9IilgKX1jb25zdCBzPWUuc3BsaXQodCk7cmV0dXJuIHRoaXMuYnlFbmRbdF09ZSx0aGlzLmJ5U3RhcnRbdF09cyx0aGlzLmJ5RW5kW3MuZW5kXT1zLGU9PT10aGlzLmxhc3RDaHVuayYmKHRoaXMubGFzdENodW5rPXMpLHRoaXMubGFzdFNlYXJjaGVkQ2h1bms9ZSwhMH10b1N0cmluZygpe2xldCBlPXRoaXMuaW50cm8sdD10aGlzLmZpcnN0Q2h1bms7Zm9yKDt0OyllKz10LnRvU3RyaW5nKCksdD10Lm5leHQ7cmV0dXJuIGUrdGhpcy5vdXRyb31pc0VtcHR5KCl7bGV0IGU9dGhpcy5maXJzdENodW5rO2Rve2lmKGUuaW50cm8ubGVuZ3RoJiZlLmludHJvLnRyaW0oKXx8ZS5jb250ZW50Lmxlbmd0aCYmZS5jb250ZW50LnRyaW0oKXx8ZS5vdXRyby5sZW5ndGgmJmUub3V0cm8udHJpbSgpKXJldHVybiAhMX13aGlsZShlPWUubmV4dCk7cmV0dXJuICEwfWxlbmd0aCgpe2xldCBlPXRoaXMuZmlyc3RDaHVuayx0PTA7ZG97dCs9ZS5pbnRyby5sZW5ndGgrZS5jb250ZW50Lmxlbmd0aCtlLm91dHJvLmxlbmd0aDt9d2hpbGUoZT1lLm5leHQpO3JldHVybiB0fXRyaW1MaW5lcygpe3JldHVybiB0aGlzLnRyaW0oIltcXHJcXG5dIil9dHJpbShlKXtyZXR1cm4gdGhpcy50cmltU3RhcnQoZSkudHJpbUVuZChlKX10cmltRW5kQWJvcnRlZChlKXtjb25zdCB0PW5ldyBSZWdFeHAoKGV8fCJcXHMiKSsiKyQiKTtpZih0aGlzLm91dHJvPXRoaXMub3V0cm8ucmVwbGFjZSh0LCIiKSx0aGlzLm91dHJvLmxlbmd0aClyZXR1cm4gITA7bGV0IHM9dGhpcy5sYXN0Q2h1bms7ZG97Y29uc3QgZT1zLmVuZCxpPXMudHJpbUVuZCh0KTtpZihzLmVuZCE9PWUmJih0aGlzLmxhc3RDaHVuaz09PXMmJih0aGlzLmxhc3RDaHVuaz1zLm5leHQpLHRoaXMuYnlFbmRbcy5lbmRdPXMsdGhpcy5ieVN0YXJ0W3MubmV4dC5zdGFydF09cy5uZXh0LHRoaXMuYnlFbmRbcy5uZXh0LmVuZF09cy5uZXh0KSxpKXJldHVybiAhMDtzPXMucHJldmlvdXM7fXdoaWxlKHMpO3JldHVybiAhMX10cmltRW5kKGUpe3JldHVybiB0aGlzLnRyaW1FbmRBYm9ydGVkKGUpLHRoaXN9dHJpbVN0YXJ0QWJvcnRlZChlKXtjb25zdCB0PW5ldyBSZWdFeHAoIl4iKyhlfHwiXFxzIikrIisiKTtpZih0aGlzLmludHJvPXRoaXMuaW50cm8ucmVwbGFjZSh0LCIiKSx0aGlzLmludHJvLmxlbmd0aClyZXR1cm4gITA7bGV0IHM9dGhpcy5maXJzdENodW5rO2Rve2NvbnN0IGU9cy5lbmQsaT1zLnRyaW1TdGFydCh0KTtpZihzLmVuZCE9PWUmJihzPT09dGhpcy5sYXN0Q2h1bmsmJih0aGlzLmxhc3RDaHVuaz1zLm5leHQpLHRoaXMuYnlFbmRbcy5lbmRdPXMsdGhpcy5ieVN0YXJ0W3MubmV4dC5zdGFydF09cy5uZXh0LHRoaXMuYnlFbmRbcy5uZXh0LmVuZF09cy5uZXh0KSxpKXJldHVybiAhMDtzPXMubmV4dDt9d2hpbGUocyk7cmV0dXJuICExfXRyaW1TdGFydChlKXtyZXR1cm4gdGhpcy50cmltU3RhcnRBYm9ydGVkKGUpLHRoaXN9aGFzQ2hhbmdlZCgpe3JldHVybiB0aGlzLm9yaWdpbmFsIT09dGhpcy50b1N0cmluZygpfV9yZXBsYWNlUmVnZXhwKGUsdCl7ZnVuY3Rpb24gcyhlLHMpe3JldHVybiAic3RyaW5nIj09dHlwZW9mIHQ/dC5yZXBsYWNlKC9cJChcJHwmfFxkKykvZywoKHQscyk9PntpZigiJCI9PT1zKXJldHVybiAiJCI7aWYoIiYiPT09cylyZXR1cm4gZVswXTtyZXR1cm4gK3M8ZS5sZW5ndGg/ZVsrc106YCQke3N9YH0pKTp0KC4uLmUsZS5pbmRleCxzLGUuZ3JvdXBzKX1pZihlLmdsb2JhbCl7KGZ1bmN0aW9uKGUsdCl7bGV0IHM7Y29uc3QgaT1bXTtmb3IoO3M9ZS5leGVjKHQpOylpLnB1c2gocyk7cmV0dXJuIGl9KShlLHRoaXMub3JpZ2luYWwpLmZvckVhY2goKGU9PntudWxsIT1lLmluZGV4JiZ0aGlzLm92ZXJ3cml0ZShlLmluZGV4LGUuaW5kZXgrZVswXS5sZW5ndGgscyhlLHRoaXMub3JpZ2luYWwpKTt9KSk7fWVsc2Uge2NvbnN0IHQ9dGhpcy5vcmlnaW5hbC5tYXRjaChlKTt0JiZudWxsIT10LmluZGV4JiZ0aGlzLm92ZXJ3cml0ZSh0LmluZGV4LHQuaW5kZXgrdFswXS5sZW5ndGgscyh0LHRoaXMub3JpZ2luYWwpKTt9cmV0dXJuIHRoaXN9X3JlcGxhY2VTdHJpbmcoZSx0KXtjb25zdHtvcmlnaW5hbDpzfT10aGlzLGk9cy5pbmRleE9mKGUpO3JldHVybiAtMSE9PWkmJnRoaXMub3ZlcndyaXRlKGksaStlLmxlbmd0aCx0KSx0aGlzfXJlcGxhY2UoZSx0KXtyZXR1cm4gInN0cmluZyI9PXR5cGVvZiBlP3RoaXMuX3JlcGxhY2VTdHJpbmcoZSx0KTp0aGlzLl9yZXBsYWNlUmVnZXhwKGUsdCl9X3JlcGxhY2VBbGxTdHJpbmcoZSx0KXtjb25zdHtvcmlnaW5hbDpzfT10aGlzLGk9ZS5sZW5ndGg7Zm9yKGxldCBuPXMuaW5kZXhPZihlKTstMSE9PW47bj1zLmluZGV4T2YoZSxuK2kpKXRoaXMub3ZlcndyaXRlKG4sbitpLHQpO3JldHVybiB0aGlzfXJlcGxhY2VBbGwoZSx0KXtpZigic3RyaW5nIj09dHlwZW9mIGUpcmV0dXJuIHRoaXMuX3JlcGxhY2VBbGxTdHJpbmcoZSx0KTtpZighZS5nbG9iYWwpdGhyb3cgbmV3IFR5cGVFcnJvcigiTWFnaWNTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwgY2FsbGVkIHdpdGggYSBub24tZ2xvYmFsIFJlZ0V4cCBhcmd1bWVudCIpO3JldHVybiB0aGlzLl9yZXBsYWNlUmVnZXhwKGUsdCl9fWNvbnN0IHg9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtjb25zdCBFPS9eKD86XC98KD86W0EtWmEtel06KT9bL1xcfF0pLyxiPS9eXC4/XC5cLy8sdj0vXFwvZyxTPS9bL1xcXS8sQT0vXC5bXi5dKyQvO2Z1bmN0aW9uIGsoZSl7cmV0dXJuIEUudGVzdChlKX1mdW5jdGlvbiBJKGUpe3JldHVybiBiLnRlc3QoZSl9ZnVuY3Rpb24gdyhlKXtyZXR1cm4gZS5yZXBsYWNlKHYsIi8iKX1mdW5jdGlvbiBQKGUpe3JldHVybiBlLnNwbGl0KFMpLnBvcCgpfHwiIn1mdW5jdGlvbiBDKGUpe2NvbnN0IHQ9L1svXFxdW14vXFxdKiQvLmV4ZWMoZSk7aWYoIXQpcmV0dXJuICIuIjtyZXR1cm4gZS5zbGljZSgwLC10WzBdLmxlbmd0aCl8fCIvIn1mdW5jdGlvbiAkKGUpe2NvbnN0IHQ9QS5leGVjKFAoZSkpO3JldHVybiB0P3RbMF06IiJ9ZnVuY3Rpb24gTiQ1KGUsdCl7Y29uc3Qgcz1lLnNwbGl0KFMpLmZpbHRlcihCb29sZWFuKSxpPXQuc3BsaXQoUykuZmlsdGVyKEJvb2xlYW4pO2ZvcigiLiI9PT1zWzBdJiZzLnNoaWZ0KCksIi4iPT09aVswXSYmaS5zaGlmdCgpO3NbMF0mJmlbMF0mJnNbMF09PT1pWzBdOylzLnNoaWZ0KCksaS5zaGlmdCgpO2Zvcig7Ii4uIj09PWlbMF0mJnMubGVuZ3RoPjA7KWkuc2hpZnQoKSxzLnBvcCgpO2Zvcig7cy5wb3AoKTspaS51bnNoaWZ0KCIuLiIpO3JldHVybiBpLmpvaW4oIi8iKX1mdW5jdGlvbiBfKC4uLmUpe2NvbnN0IHQ9ZS5zaGlmdCgpO2lmKCF0KXJldHVybiAiLyI7bGV0IHM9dC5zcGxpdChTKTtmb3IoY29uc3QgdCBvZiBlKWlmKGsodCkpcz10LnNwbGl0KFMpO2Vsc2Uge2NvbnN0IGU9dC5zcGxpdChTKTtmb3IoOyIuIj09PWVbMF18fCIuLiI9PT1lWzBdOyl7Ii4uIj09PWUuc2hpZnQoKSYmcy5wb3AoKTt9cy5wdXNoKC4uLmUpO31yZXR1cm4gcy5qb2luKCIvIil9Y29uc3QgUiQzPS9bXG5ccidcXFx1MjAyOFx1MjAyOV0vLE09LyhbXG5ccidcdTIwMjhcdTIwMjldKS9nLE89L1xcL2c7ZnVuY3Rpb24gRChlKXtyZXR1cm4gUiQzLnRlc3QoZSk/ZS5yZXBsYWNlKE8sIlxcXFwiKS5yZXBsYWNlKE0sIlxcJDEiKTplfWZ1bmN0aW9uIEwoZSl7Y29uc3QgdD1QKGUpO3JldHVybiB0LnNsaWNlKDAsTWF0aC5tYXgoMCx0Lmxlbmd0aC0kKGUpLmxlbmd0aCkpfWZ1bmN0aW9uIFQoZSl7cmV0dXJuIGsoZSk/TiQ1KF8oKSxlKTplfWZ1bmN0aW9uIFYoZSl7cmV0dXJuICIvIj09PWVbMF18fCIuIj09PWVbMF0mJigiLyI9PT1lWzFdfHwiLiI9PT1lWzFdKXx8ayhlKX1jb25zdCBCPS9eKFwuXC5cLykqXC5cLiQvO2Z1bmN0aW9uIHooZSx0LHMsaSl7Zm9yKDt0LnN0YXJ0c1dpdGgoIi4uLyIpOyl0PXQuc2xpY2UoMyksZT0iXy8iK2U7bGV0IG49dyhOJDUoQyhlKSx0KSk7aWYocyYmbi5lbmRzV2l0aCgiLmpzIikmJihuPW4uc2xpY2UoMCwtMykpLGkpe2lmKCIiPT09bilyZXR1cm4gIi4uLyIrUCh0KTtpZihCLnRlc3QobikpcmV0dXJuIFsuLi5uLnNwbGl0KCIvIiksIi4uIixQKHQpXS5qb2luKCIvIil9cmV0dXJuIG4/bi5zdGFydHNXaXRoKCIuLiIpP246Ii4vIituOiIuIn1sZXQgRiQzID0gY2xhc3MgRntjb25zdHJ1Y3RvcihlLHQscyl7dGhpcy5vcHRpb25zPXQsdGhpcy5pbnB1dEJhc2U9cyx0aGlzLmRlZmF1bHRWYXJpYWJsZU5hbWU9IiIsdGhpcy5uYW1lc3BhY2VWYXJpYWJsZU5hbWU9IiIsdGhpcy52YXJpYWJsZU5hbWU9IiIsdGhpcy5maWxlTmFtZT1udWxsLHRoaXMuaW1wb3J0QXNzZXJ0aW9ucz1udWxsLHRoaXMuaWQ9ZS5pZCx0aGlzLm1vZHVsZUluZm89ZS5pbmZvLHRoaXMucmVub3JtYWxpemVSZW5kZXJQYXRoPWUucmVub3JtYWxpemVSZW5kZXJQYXRoLHRoaXMuc3VnZ2VzdGVkVmFyaWFibGVOYW1lPWUuc3VnZ2VzdGVkVmFyaWFibGVOYW1lO31nZXRGaWxlTmFtZSgpe2lmKHRoaXMuZmlsZU5hbWUpcmV0dXJuIHRoaXMuZmlsZU5hbWU7Y29uc3R7cGF0aHM6ZX09dGhpcy5vcHRpb25zO3JldHVybiB0aGlzLmZpbGVOYW1lPSgiZnVuY3Rpb24iPT10eXBlb2YgZT9lKHRoaXMuaWQpOmVbdGhpcy5pZF0pfHwodGhpcy5yZW5vcm1hbGl6ZVJlbmRlclBhdGg/dyhOJDUodGhpcy5pbnB1dEJhc2UsdGhpcy5pZCkpOnRoaXMuaWQpfWdldEltcG9ydEFzc2VydGlvbnMoZSl7cmV0dXJuIHRoaXMuaW1wb3J0QXNzZXJ0aW9uc3x8KHRoaXMuaW1wb3J0QXNzZXJ0aW9ucz1mdW5jdGlvbihlLHtnZXRPYmplY3Q6dH0pe2lmKCFlKXJldHVybiBudWxsO2NvbnN0IHM9T2JqZWN0LmVudHJpZXMoZSkubWFwKCgoW2UsdF0pPT5bZSxgJyR7dH0nYF0pKTtpZihzLmxlbmd0aD4wKXJldHVybiB0KHMse2xpbmVCcmVha0luZGVudDpudWxsfSk7cmV0dXJuIG51bGx9KCJlcyI9PT10aGlzLm9wdGlvbnMuZm9ybWF0JiZ0aGlzLm9wdGlvbnMuZXh0ZXJuYWxJbXBvcnRBc3NlcnRpb25zJiZ0aGlzLm1vZHVsZUluZm8uYXNzZXJ0aW9ucyxlKSl9Z2V0SW1wb3J0UGF0aChlKXtyZXR1cm4gRCh0aGlzLnJlbm9ybWFsaXplUmVuZGVyUGF0aD96KGUsdGhpcy5nZXRGaWxlTmFtZSgpLCJhbWQiPT09dGhpcy5vcHRpb25zLmZvcm1hdCwhMSk6dGhpcy5nZXRGaWxlTmFtZSgpKX19O2Z1bmN0aW9uIGooZSx0LHMpe2NvbnN0IGk9ZS5nZXQodCk7aWYodm9pZCAwIT09aSlyZXR1cm4gaTtjb25zdCBuPXMoKTtyZXR1cm4gZS5zZXQodCxuKSxufWZ1bmN0aW9uIFUkMigpe3JldHVybiBuZXcgU2V0fWZ1bmN0aW9uIEcoKXtyZXR1cm4gW119Y29uc3QgVz1TeW1ib2woIlVua25vd24gS2V5IikscT1TeW1ib2woIlVua25vd24gTm9uLUFjY2Vzc29yIEtleSIpLEg9U3ltYm9sKCJVbmtub3duIEludGVnZXIiKSxLPVN5bWJvbCgiU3ltYm9sLnRvU3RyaW5nVGFnIiksWT1bXSxYPVtXXSxRPVtxXSxaPVtIXSxKPVN5bWJvbCgiRW50aXRpZXMiKTtjbGFzcyBlZXtjb25zdHJ1Y3Rvcigpe3RoaXMuZW50aXR5UGF0aHM9T2JqZWN0LmNyZWF0ZShudWxsLHtbSl06e3ZhbHVlOm5ldyBTZXR9fSk7fXRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKGUsdCl7Y29uc3Qgcz10aGlzLmdldEVudGl0aWVzKGUpO3JldHVybiAhIXMuaGFzKHQpfHwocy5hZGQodCksITEpfXdpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRFbnRpdGllcyhlKTtpZihuLmhhcyh0KSlyZXR1cm4gaTtuLmFkZCh0KTtjb25zdCByPXMoKTtyZXR1cm4gbi5kZWxldGUodCkscn1nZXRFbnRpdGllcyhlKXtsZXQgdD10aGlzLmVudGl0eVBhdGhzO2Zvcihjb25zdCBzIG9mIGUpdD10W3NdPXRbc118fE9iamVjdC5jcmVhdGUobnVsbCx7W0pdOnt2YWx1ZTpuZXcgU2V0fX0pO3JldHVybiB0W0pdfX1jb25zdCB0ZT1uZXcgZWU7Y2xhc3Mgc2V7Y29uc3RydWN0b3IoKXt0aGlzLmVudGl0eVBhdGhzPU9iamVjdC5jcmVhdGUobnVsbCx7W0pdOnt2YWx1ZTpuZXcgTWFwfX0pO310cmFja0VudGl0eUF0UGF0aEFuZEdldElmVHJhY2tlZChlLHQscyl7bGV0IGk9dGhpcy5lbnRpdHlQYXRocztmb3IoY29uc3QgdCBvZiBlKWk9aVt0XT1pW3RdfHxPYmplY3QuY3JlYXRlKG51bGwse1tKXTp7dmFsdWU6bmV3IE1hcH19KTtjb25zdCBuPWooaVtKXSx0LFUkMik7cmV0dXJuICEhbi5oYXMocyl8fChuLmFkZChzKSwhMSl9fWNvbnN0IGllPVN5bWJvbCgiVW5rbm93biBWYWx1ZSIpLG5lPVN5bWJvbCgiVW5rbm93biBUcnV0aHkgVmFsdWUiKTtjbGFzcyByZXtjb25zdHJ1Y3Rvcigpe3RoaXMuaW5jbHVkZWQ9ITE7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtsZShlKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIGllfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiBhZX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuICEwfWluY2x1ZGUoZSx0LHMpe3RoaXMuaW5jbHVkZWQ9ITA7fWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7Zm9yKGNvbnN0IHMgb2YgdClzLmluY2x1ZGUoZSwhMSk7fXNob3VsZEJlSW5jbHVkZWQoZSl7cmV0dXJuICEwfX1jb25zdCBvZT1uZXcgY2xhc3MgZXh0ZW5kcyByZXt9LGFlPVtvZSwhMV0sbGU9ZT0+e2Zvcihjb25zdCB0IG9mIGUuYXJncyl0Py5kZW9wdGltaXplUGF0aChYKTt9LGNlPXthcmdzOltudWxsXSx0eXBlOjB9LGhlPXthcmdzOltudWxsLG9lXSx0eXBlOjF9LHVlPXthcmdzOltudWxsXSx0eXBlOjIsd2l0aE5ldzohMX07Y2xhc3MgZGUgZXh0ZW5kcyByZXtjb25zdHJ1Y3RvcihlKXtzdXBlcigpLHRoaXMubmFtZT1lLHRoaXMuYWx3YXlzUmVuZGVyZWQ9ITEsdGhpcy5mb3JiaWRkZW5OYW1lcz1udWxsLHRoaXMuaW5pdFJlYWNoZWQ9ITEsdGhpcy5pc0lkPSExLHRoaXMuaXNSZWFzc2lnbmVkPSExLHRoaXMua2luZD1udWxsLHRoaXMucmVuZGVyQmFzZU5hbWU9bnVsbCx0aGlzLnJlbmRlck5hbWU9bnVsbDt9YWRkUmVmZXJlbmNlKGUpe31mb3JiaWROYW1lKGUpeyh0aGlzLmZvcmJpZGRlbk5hbWVzfHwodGhpcy5mb3JiaWRkZW5OYW1lcz1uZXcgU2V0KSkuYWRkKGUpO31nZXRCYXNlVmFyaWFibGVOYW1lKCl7cmV0dXJuIHRoaXMucmVuZGVyQmFzZU5hbWV8fHRoaXMucmVuZGVyTmFtZXx8dGhpcy5uYW1lfWdldE5hbWUoZSx0KXtpZih0Py4odGhpcykpcmV0dXJuIHRoaXMubmFtZTtjb25zdCBzPXRoaXMucmVuZGVyTmFtZXx8dGhpcy5uYW1lO3JldHVybiB0aGlzLnJlbmRlckJhc2VOYW1lP2Ake3RoaXMucmVuZGVyQmFzZU5hbWV9JHtlKHMpfWA6c31oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9LHMpe3JldHVybiAwIT09dHx8ZS5sZW5ndGg+MH1pbmNsdWRlKCl7dGhpcy5pbmNsdWRlZD0hMDt9bWFya0NhbGxlZEZyb21UcnlTdGF0ZW1lbnQoKXt9c2V0UmVuZGVyTmFtZXMoZSx0KXt0aGlzLnJlbmRlckJhc2VOYW1lPWUsdGhpcy5yZW5kZXJOYW1lPXQ7fX1jbGFzcyBwZSBleHRlbmRzIGRle2NvbnN0cnVjdG9yKGUsdCl7c3VwZXIodCksdGhpcy5yZWZlcmVuY2VkPSExLHRoaXMubW9kdWxlPWUsdGhpcy5pc05hbWVzcGFjZT0iKiI9PT10O31hZGRSZWZlcmVuY2UoZSl7dGhpcy5yZWZlcmVuY2VkPSEwLCJkZWZhdWx0IiE9PXRoaXMubmFtZSYmIioiIT09dGhpcy5uYW1lfHx0aGlzLm1vZHVsZS5zdWdnZXN0TmFtZShlLm5hbWUpO31oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9KXtyZXR1cm4gMCE9PXR8fGUubGVuZ3RoPih0aGlzLmlzTmFtZXNwYWNlPzE6MCl9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWR8fCh0aGlzLmluY2x1ZGVkPSEwLHRoaXMubW9kdWxlLnVzZWQ9ITApO319Y29uc3QgZmU9T2JqZWN0LmZyZWV6ZShPYmplY3QuY3JlYXRlKG51bGwpKSxtZT1PYmplY3QuZnJlZXplKHt9KSxnZT1PYmplY3QuZnJlZXplKFtdKSx5ZT1PYmplY3QuZnJlZXplKG5ldyBjbGFzcyBleHRlbmRzIFNldHthZGQoKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBhZGQgdG8gZW1wdHkgc2V0Iil9fSk7dmFyIHhlPW5ldyBTZXQoWyJhd2FpdCIsImJyZWFrIiwiY2FzZSIsImNhdGNoIiwiY2xhc3MiLCJjb25zdCIsImNvbnRpbnVlIiwiZGVidWdnZXIiLCJkZWZhdWx0IiwiZGVsZXRlIiwiZG8iLCJlbHNlIiwiZW51bSIsImV2YWwiLCJleHBvcnQiLCJleHRlbmRzIiwiZmFsc2UiLCJmaW5hbGx5IiwiZm9yIiwiZnVuY3Rpb24iLCJpZiIsImltcGxlbWVudHMiLCJpbXBvcnQiLCJpbiIsImluc3RhbmNlb2YiLCJpbnRlcmZhY2UiLCJsZXQiLCJOYU4iLCJuZXciLCJudWxsIiwicGFja2FnZSIsInByaXZhdGUiLCJwcm90ZWN0ZWQiLCJwdWJsaWMiLCJyZXR1cm4iLCJzdGF0aWMiLCJzdXBlciIsInN3aXRjaCIsInRoaXMiLCJ0aHJvdyIsInRydWUiLCJ0cnkiLCJ0eXBlb2YiLCJ1bmRlZmluZWQiLCJ2YXIiLCJ2b2lkIiwid2hpbGUiLCJ3aXRoIiwieWllbGQiXSk7Y29uc3QgRWU9L1teXHckXS9nLGJlPWU9PihlPT4vXGQvLnRlc3QoZVswXSkpKGUpfHx4ZS5oYXMoZSl8fCJhcmd1bWVudHMiPT09ZTtmdW5jdGlvbiB2ZShlKXtyZXR1cm4gZT1lLnJlcGxhY2UoLy0oXHcpL2csKChlLHQpPT50LnRvVXBwZXJDYXNlKCkpKS5yZXBsYWNlKEVlLCJfIiksYmUoZSkmJihlPWBfJHtlfWApLGV8fCJfIn1jb25zdCBTZT0id2FybiIsQWU9ImluZm8iLGtlPSJkZWJ1ZyIsSWU9e1trZV06MCxbQWVdOjEsc2lsZW50OjMsW1NlXToyfTtmdW5jdGlvbiB3ZShlLHQpe3JldHVybiBlLnN0YXJ0PD10JiZ0PGUuZW5kfWZ1bmN0aW9uIFBlKGUsdCxzKXtyZXR1cm4gZnVuY3Rpb24oZSx0PXt9KXtjb25zdHtvZmZzZXRMaW5lOnM9MCxvZmZzZXRDb2x1bW46aT0wfT10O2xldCBuPTA7Y29uc3Qgcj1lLnNwbGl0KCJcbiIpLm1hcCgoKGUsdCk9Pntjb25zdCBzPW4rZS5sZW5ndGgrMSxpPXtzdGFydDpuLGVuZDpzLGxpbmU6dH07cmV0dXJuIG49cyxpfSkpO2xldCBvPTA7cmV0dXJuIGZ1bmN0aW9uKHQsbil7aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD1lLmluZGV4T2YodCxuPz8wKSksLTE9PT10KXJldHVybjtsZXQgYT1yW29dO2NvbnN0IGw9dD49YS5lbmQ/MTotMTtmb3IoO2E7KXtpZih3ZShhLHQpKXJldHVybiB7bGluZTpzK2EubGluZSxjb2x1bW46aSt0LWEuc3RhcnQsY2hhcmFjdGVyOnR9O28rPWwsYT1yW29dO319fShlLHMpKHQscyYmcy5zdGFydEluZGV4KX1mdW5jdGlvbiBDZShlKXtyZXR1cm4gZS5yZXBsYWNlKC9eXHQrLywoZT0+ZS5zcGxpdCgiXHQiKS5qb2luKCIgICIpKSl9Y29uc3QgJGU9MTIwLE5lPTEwLF9lPSIuLi4iO2Z1bmN0aW9uIFJlKGUsdCxzKXtsZXQgaT1lLnNwbGl0KCJcbiIpO2lmKHQ+aS5sZW5ndGgpcmV0dXJuICIiO2NvbnN0IG49TWF0aC5tYXgoQ2UoaVt0LTFdLnNsaWNlKDAscykpLmxlbmd0aCtOZStfZS5sZW5ndGgsJGUpLHI9TWF0aC5tYXgoMCx0LTMpO2xldCBvPU1hdGgubWluKHQrMixpLmxlbmd0aCk7Zm9yKGk9aS5zbGljZShyLG8pOyEvXFMvLnRlc3QoaVtpLmxlbmd0aC0xXSk7KWkucG9wKCksby09MTtjb25zdCBhPVN0cmluZyhvKS5sZW5ndGg7cmV0dXJuIGkubWFwKCgoZSxpKT0+e2NvbnN0IG89citpKzE9PT10O2xldCBsPVN0cmluZyhpK3IrMSk7Zm9yKDtsLmxlbmd0aDxhOylsPWAgJHtsfWA7bGV0IGM9Q2UoZSk7aWYoYy5sZW5ndGg+biYmKGM9YCR7Yy5zbGljZSgwLG4tX2UubGVuZ3RoKX0ke19lfWApLG8pe2NvbnN0IHQ9ZnVuY3Rpb24oZSl7bGV0IHQ9IiI7Zm9yKDtlLS07KXQrPSIgIjtyZXR1cm4gdH0oYSsyK0NlKGUuc2xpY2UoMCxzKSkubGVuZ3RoKSsiXiI7cmV0dXJuIGAke2x9OiAke2N9XG4ke3R9YH1yZXR1cm4gYCR7bH06ICR7Y31gfSkpLmpvaW4oIlxuIil9ZnVuY3Rpb24gTWUoZSx0KXtjb25zdCBzPWUubGVuZ3RoPD0xLGk9ZS5tYXAoKGU9PmAiJHtlfSJgKSk7bGV0IG49cz9pWzBdOmAke2kuc2xpY2UoMCwtMSkuam9pbigiLCAiKX0gYW5kICR7aS5zbGljZSgtMSlbMF19YDtyZXR1cm4gdCYmKG4rPWAgJHtzP3RbMF06dFsxXX1gKSxufWZ1bmN0aW9uIE9lKGUpe3JldHVybiBgaHR0cHM6Ly9yb2xsdXBqcy5vcmcvJHtlfWB9Y29uc3QgRGU9InRyb3VibGVzaG9vdGluZy8jZXJyb3ItbmFtZS1pcy1ub3QtZXhwb3J0ZWQtYnktbW9kdWxlIixMZT0idHJvdWJsZXNob290aW5nLyN3YXJuaW5nLXNvdXJjZW1hcC1pcy1saWtlbHktdG8tYmUtaW5jb3JyZWN0IixUZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtYW1kLWlkIixWZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZGlyIixCZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZXhwb3J0cyIsemU9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWV4dGVuZCIsRmU9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWZvcm1hdCIsamU9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWV4cGVyaW1lbnRhbGRlZXBkeW5hbWljY2h1bmtvcHRpbWl6YXRpb24iLFVlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1nbG9iYWxzIixHZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtaW5saW5lZHluYW1pY2ltcG9ydHMiLFdlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1pbnRlcm9wIixxZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtbWFudWFsY2h1bmtzIixIZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtbmFtZSIsS2U9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LXNvdXJjZW1hcGZpbGUiLFllPSJwbHVnaW4tZGV2ZWxvcG1lbnQvI3RoaXMtZ2V0bW9kdWxlaW5mbyI7ZnVuY3Rpb24gWGUoZSl7dGhyb3cgZSBpbnN0YW5jZW9mIEVycm9yfHwoZT1PYmplY3QuYXNzaWduKG5ldyBFcnJvcihlLm1lc3NhZ2UpLGUpLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJuYW1lIix7dmFsdWU6IlJvbGx1cEVycm9yIn0pKSxlfWZ1bmN0aW9uIFFlKGUsdCxzLGkpe2lmKCJvYmplY3QiPT10eXBlb2YgdCl7Y29uc3R7bGluZTpzLGNvbHVtbjpufT10O2UubG9jPXtjb2x1bW46bixmaWxlOmksbGluZTpzfTt9ZWxzZSB7ZS5wb3M9dDtjb25zdHtsaW5lOm4sY29sdW1uOnJ9PVBlKHMsdCx7b2Zmc2V0TGluZToxfSk7ZS5sb2M9e2NvbHVtbjpyLGZpbGU6aSxsaW5lOm59O31pZih2b2lkIDA9PT1lLmZyYW1lKXtjb25zdHtsaW5lOnQsY29sdW1uOml9PWUubG9jO2UuZnJhbWU9UmUocyx0LGkpO319Y29uc3QgWmU9IkFERE9OX0VSUk9SIixKZT0iQUxSRUFEWV9DTE9TRUQiLGV0PSJBTk9OWU1PVVNfUExVR0lOX0NBQ0hFIix0dD0iQVNTRVRfTk9UX0ZJTkFMSVNFRCIsc3Q9IkNBTk5PVF9FTUlUX0ZST01fT1BUSU9OU19IT09LIixpdD0iQ0hVTktfTk9UX0dFTkVSQVRFRCIsbnQ9IkNJUkNVTEFSX1JFRVhQT1JUIixydD0iREVQUkVDQVRFRF9GRUFUVVJFIixvdD0iRFVQTElDQVRFX1BMVUdJTl9OQU1FIixhdD0iRklMRV9OQU1FX0NPTkZMSUNUIixsdD0iSUxMRUdBTF9JREVOVElGSUVSX0FTX05BTUUiLGN0PSJJTlZBTElEX0NIVU5LIixodD0iSU5WQUxJRF9FWFBPUlRfT1BUSU9OIix1dD0iSU5WQUxJRF9MT0dfUE9TSVRJT04iLGR0PSJJTlZBTElEX09QVElPTiIscHQ9IklOVkFMSURfUExVR0lOX0hPT0siLGZ0PSJJTlZBTElEX1JPTExVUF9QSEFTRSIsbXQ9IklOVkFMSURfU0VUQVNTRVRTT1VSQ0UiLGd0PSJNSVNTSU5HX0VYUE9SVCIseXQ9Ik1JU1NJTkdfR0xPQkFMX05BTUUiLHh0PSJNSVNTSU5HX0lNUExJQ0lUX0RFUEVOREFOVCIsRXQ9Ik1JU1NJTkdfTkFNRV9PUFRJT05fRk9SX0lJRkVfRVhQT1JUIixidD0iTUlTU0lOR19OT0RFX0JVSUxUSU5TIix2dD0iTUlTU0lOR19PUFRJT04iLFN0PSJNSVhFRF9FWFBPUlRTIixBdD0iTk9fVFJBTlNGT1JNX01BUF9PUl9BU1RfV0lUSE9VVF9DT0RFIixrdD0iT1BUSU1JWkVfQ0hVTktfU1RBVFVTIixJdD0iUExVR0lOX0VSUk9SIix3dD0iU09VUkNFTUFQX0JST0tFTiIsUHQ9IlVORVhQRUNURURfTkFNRURfSU1QT1JUIixDdD0iVU5LTk9XTl9PUFRJT04iLCR0PSJVTlJFU09MVkVEX0VOVFJZIixOdD0iVU5SRVNPTFZFRF9JTVBPUlQiLF90PSJWQUxJREFUSU9OX0VSUk9SIjtmdW5jdGlvbiBSdCgpe3JldHVybiB7Y29kZTpKZSxtZXNzYWdlOidCdW5kbGUgaXMgYWxyZWFkeSBjbG9zZWQsIG5vIG1vcmUgY2FsbHMgdG8gImdlbmVyYXRlIiBvciAid3JpdGUiIGFyZSBhbGxvd2VkLid9fWZ1bmN0aW9uIE10KGUpe3JldHVybiB7Y29kZToiQ0FOTk9UX0NBTExfTkFNRVNQQUNFIixtZXNzYWdlOmBDYW5ub3QgY2FsbCBhIG5hbWVzcGFjZSAoIiR7ZX0iKS5gfX1mdW5jdGlvbiBPdCh7ZmlsZU5hbWU6ZSxjb2RlOnR9LHMpe2NvbnN0IGk9e2NvZGU6IkNIVU5LX0lOVkFMSUQiLG1lc3NhZ2U6YENodW5rICIke2V9IiBpcyBub3QgdmFsaWQgSmF2YVNjcmlwdDogJHtzLm1lc3NhZ2V9LmB9O3JldHVybiBRZShpLHMubG9jLHQsZSksaX1mdW5jdGlvbiBEdChlKXtyZXR1cm4ge2NvZGU6IkNJUkNVTEFSX0RFUEVOREVOQ1kiLGlkczplLG1lc3NhZ2U6YENpcmN1bGFyIGRlcGVuZGVuY3k6ICR7ZS5tYXAoVCkuam9pbigiIC0+ICIpfWB9fWZ1bmN0aW9uIEx0KGUsdCx7bGluZTpzLGNvbHVtbjppfSl7cmV0dXJuIHtjb2RlOiJGSVJTVF9TSURFX0VGRkVDVCIsbWVzc2FnZTpgRmlyc3Qgc2lkZSBlZmZlY3QgaW4gJHtUKHQpfSBpcyBhdCAoJHtzfToke2l9KVxuJHtSZShlLHMsaSl9YH19ZnVuY3Rpb24gVHQoZSx0KXtyZXR1cm4ge2NvZGU6IklMTEVHQUxfUkVBU1NJR05NRU5UIixtZXNzYWdlOmBJbGxlZ2FsIHJlYXNzaWdubWVudCBvZiBpbXBvcnQgIiR7ZX0iIGluICIke1QodCl9Ii5gfX1mdW5jdGlvbiBWdChlLHQscyxpKXtyZXR1cm4ge2NvZGU6IklOQ09OU0lTVEVOVF9JTVBPUlRfQVNTRVJUSU9OUyIsbWVzc2FnZTpgTW9kdWxlICIke1QoaSl9IiB0cmllZCB0byBpbXBvcnQgIiR7VChzKX0iIHdpdGggJHtCdCh0KX0gYXNzZXJ0aW9ucywgYnV0IGl0IHdhcyBhbHJlYWR5IGltcG9ydGVkIGVsc2V3aGVyZSB3aXRoICR7QnQoZSl9IGFzc2VydGlvbnMuIFBsZWFzZSBlbnN1cmUgdGhhdCBpbXBvcnQgYXNzZXJ0aW9ucyBmb3IgdGhlIHNhbWUgbW9kdWxlIGFyZSBhbHdheXMgY29uc2lzdGVudC5gfX1jb25zdCBCdD1lPT57Y29uc3QgdD1PYmplY3QuZW50cmllcyhlKTtyZXR1cm4gMD09PXQubGVuZ3RoPyJubyI6dC5tYXAoKChbZSx0XSk9PmAiJHtlfSI6ICIke3R9ImApKS5qb2luKCIsICIpfTtmdW5jdGlvbiB6dChlLHQscyl7cmV0dXJuIHtjb2RlOmh0LG1lc3NhZ2U6YCIke2V9IiB3YXMgc3BlY2lmaWVkIGZvciAib3V0cHV0LmV4cG9ydHMiLCBidXQgZW50cnkgbW9kdWxlICIke1Qocyl9IiBoYXMgdGhlIGZvbGxvd2luZyBleHBvcnRzOiAke01lKHQpfWAsdXJsOk9lKEJlKX19ZnVuY3Rpb24gRnQoZSx0LHMsaSl7cmV0dXJuIHtjb2RlOmR0LG1lc3NhZ2U6YEludmFsaWQgdmFsdWUgJHt2b2lkIDA9PT1pPyIiOmAke0pTT04uc3RyaW5naWZ5KGkpfSBgfWZvciBvcHRpb24gIiR7ZX0iIC0gJHtzfS5gLHVybDpPZSh0KX19ZnVuY3Rpb24ganQoZSx0LHMpe2NvbnN0IGk9Ii5qc29uIj09PSQocyk7cmV0dXJuIHtiaW5kaW5nOmUsY29kZTpndCxleHBvcnRlcjpzLGlkOnQsbWVzc2FnZTpgIiR7ZX0iIGlzIG5vdCBleHBvcnRlZCBieSAiJHtUKHMpfSIsIGltcG9ydGVkIGJ5ICIke1QodCl9Ii4ke2k/IiAoTm90ZSB0aGF0IHlvdSBuZWVkIEByb2xsdXAvcGx1Z2luLWpzb24gdG8gaW1wb3J0IEpTT04gZmlsZXMpIjoiIn1gLHVybDpPZShEZSl9fWZ1bmN0aW9uIFV0KGUpe2NvbnN0IHQ9Wy4uLmUuaW1wbGljaXRseUxvYWRlZEJlZm9yZV0ubWFwKChlPT5UKGUuaWQpKSkuc29ydCgpO3JldHVybiB7Y29kZTp4dCxtZXNzYWdlOmBNb2R1bGUgIiR7VChlLmlkKX0iIHRoYXQgc2hvdWxkIGJlIGltcGxpY2l0bHkgbG9hZGVkIGJlZm9yZSAke01lKHQpfSBpcyBub3QgaW5jbHVkZWQgaW4gdGhlIG1vZHVsZSBncmFwaC4gRWl0aGVyIGl0IHdhcyBub3QgaW1wb3J0ZWQgYnkgYW4gaW5jbHVkZWQgbW9kdWxlIG9yIG9ubHkgdmlhIGEgdHJlZS1zaGFrZW4gZHluYW1pYyBpbXBvcnQsIG9yIG5vIGltcG9ydGVkIGJpbmRpbmdzIHdlcmUgdXNlZCBhbmQgaXQgaGFkIG90aGVyd2lzZSBubyBzaWRlLWVmZmVjdHMuYH19ZnVuY3Rpb24gR3QoZSx0LHMpe3JldHVybiB7Y29kZTprdCxtZXNzYWdlOmAke3N9LCB0aGVyZSBhcmVcbiR7ZX0gY2h1bmtzLCBvZiB3aGljaFxuJHt0fSBhcmUgYmVsb3cgbWluQ2h1bmtTaXplLmB9fWZ1bmN0aW9uIFd0KGUsdCx7aG9vazpzLGlkOml9PXt9KXtjb25zdCBuPWUuY29kZTtyZXR1cm4gZS5wbHVnaW5Db2RlfHxudWxsPT1ufHwic3RyaW5nIj09dHlwZW9mIG4mJigic3RyaW5nIiE9dHlwZW9mIG58fG4uc3RhcnRzV2l0aCgiUExVR0lOXyIpKXx8KGUucGx1Z2luQ29kZT1uKSxlLmNvZGU9SXQsZS5wbHVnaW49dCxzJiYoZS5ob29rPXMpLGkmJihlLmlkPWkpLGV9ZnVuY3Rpb24gcXQoZSl7cmV0dXJuIHtjb2RlOnd0LG1lc3NhZ2U6YE11bHRpcGxlIGNvbmZsaWN0aW5nIGNvbnRlbnRzIGZvciBzb3VyY2VtYXAgc291cmNlICR7ZX1gfX1mdW5jdGlvbiBIdChlLHQscyl7Y29uc3QgaT1zPyJyZWV4cG9ydCI6ImltcG9ydCI7cmV0dXJuIHtjb2RlOlB0LGV4cG9ydGVyOmUsbWVzc2FnZTpgVGhlIG5hbWVkIGV4cG9ydCAiJHt0fSIgd2FzICR7aX1lZCBmcm9tIHRoZSBleHRlcm5hbCBtb2R1bGUgIiR7VChlKX0iIGV2ZW4gdGhvdWdoIGl0cyBpbnRlcm9wIHR5cGUgaXMgImRlZmF1bHRPbmx5Ii4gRWl0aGVyIHJlbW92ZSBvciBjaGFuZ2UgdGhpcyAke2l9IG9yIGNoYW5nZSB0aGUgdmFsdWUgb2YgdGhlICJvdXRwdXQuaW50ZXJvcCIgb3B0aW9uLmAsdXJsOk9lKFdlKX19ZnVuY3Rpb24gS3QoZSl7cmV0dXJuIHtjb2RlOlB0LGV4cG9ydGVyOmUsbWVzc2FnZTpgVGhlcmUgd2FzIGEgbmFtZXNwYWNlICIqIiByZWV4cG9ydCBmcm9tIHRoZSBleHRlcm5hbCBtb2R1bGUgIiR7VChlKX0iIGV2ZW4gdGhvdWdoIGl0cyBpbnRlcm9wIHR5cGUgaXMgImRlZmF1bHRPbmx5Ii4gVGhpcyB3aWxsIGJlIGlnbm9yZWQgYXMgbmFtZXNwYWNlIHJlZXhwb3J0cyBvbmx5IHJlZXhwb3J0IG5hbWVkIGV4cG9ydHMuIElmIHRoaXMgaXMgbm90IGludGVuZGVkLCBlaXRoZXIgcmVtb3ZlIG9yIGNoYW5nZSB0aGlzIHJlZXhwb3J0IG9yIGNoYW5nZSB0aGUgdmFsdWUgb2YgdGhlICJvdXRwdXQuaW50ZXJvcCIgb3B0aW9uLmAsdXJsOk9lKFdlKX19ZnVuY3Rpb24gWXQoZSl7cmV0dXJuIHtjb2RlOl90LG1lc3NhZ2U6ZX19ZnVuY3Rpb24gWHQoZSx0LHMsaSxuKXtRdChlLHQscyxpLm9uTG9nLGkuc3RyaWN0RGVwcmVjYXRpb25zLG4pO31mdW5jdGlvbiBRdChlLHQscyxpLG4scil7aWYoc3x8bil7Y29uc3Qgcz1mdW5jdGlvbihlLHQscyl7cmV0dXJuIHtjb2RlOnJ0LG1lc3NhZ2U6ZSx1cmw6T2UodCksLi4ucz97cGx1Z2luOnN9Ont9fX0oZSx0LHIpO2lmKG4pcmV0dXJuIFhlKHMpO2koU2Uscyk7fX1jbGFzcyBadHtjb25zdHJ1Y3RvcihlLHQscyxpLG4scil7dGhpcy5vcHRpb25zPWUsdGhpcy5pZD10LHRoaXMucmVub3JtYWxpemVSZW5kZXJQYXRoPW4sdGhpcy5keW5hbWljSW1wb3J0ZXJzPVtdLHRoaXMuZXhlY0luZGV4PTEvMCx0aGlzLmV4cG9ydGVkVmFyaWFibGVzPW5ldyBNYXAsdGhpcy5pbXBvcnRlcnM9W10sdGhpcy5yZWV4cG9ydGVkPSExLHRoaXMudXNlZD0hMSx0aGlzLmRlY2xhcmF0aW9ucz1uZXcgTWFwLHRoaXMubW9zdENvbW1vblN1Z2dlc3Rpb249MCx0aGlzLm5hbWVTdWdnZXN0aW9ucz1uZXcgTWFwLHRoaXMuc3VnZ2VzdGVkVmFyaWFibGVOYW1lPXZlKHQuc3BsaXQoL1svXFxdLykucG9wKCkpO2NvbnN0e2ltcG9ydGVyczpvLGR5bmFtaWNJbXBvcnRlcnM6YX09dGhpcyxsPXRoaXMuaW5mbz17YXNzZXJ0aW9uczpyLGFzdDpudWxsLGNvZGU6bnVsbCxkeW5hbWljYWxseUltcG9ydGVkSWRSZXNvbHV0aW9uczpnZSxkeW5hbWljYWxseUltcG9ydGVkSWRzOmdlLGdldCBkeW5hbWljSW1wb3J0ZXJzKCl7cmV0dXJuIGEuc29ydCgpfSxleHBvcnRlZEJpbmRpbmdzOm51bGwsZXhwb3J0czpudWxsLGhhc0RlZmF1bHRFeHBvcnQ6bnVsbCxnZXQgaGFzTW9kdWxlU2lkZUVmZmVjdHMoKXtyZXR1cm4gWHQoIkFjY2Vzc2luZyBNb2R1bGVJbmZvLmhhc01vZHVsZVNpZGVFZmZlY3RzIGZyb20gcGx1Z2lucyBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIE1vZHVsZUluZm8ubW9kdWxlU2lkZUVmZmVjdHMgaW5zdGVhZC4iLFllLCEwLGUpLGwubW9kdWxlU2lkZUVmZmVjdHN9LGlkOnQsaW1wbGljaXRseUxvYWRlZEFmdGVyT25lT2Y6Z2UsaW1wbGljaXRseUxvYWRlZEJlZm9yZTpnZSxpbXBvcnRlZElkUmVzb2x1dGlvbnM6Z2UsaW1wb3J0ZWRJZHM6Z2UsZ2V0IGltcG9ydGVycygpe3JldHVybiBvLnNvcnQoKX0saXNFbnRyeTohMSxpc0V4dGVybmFsOiEwLGlzSW5jbHVkZWQ6bnVsbCxtZXRhOmksbW9kdWxlU2lkZUVmZmVjdHM6cyxzeW50aGV0aWNOYW1lZEV4cG9ydHM6ITF9O09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmluZm8sImhhc01vZHVsZVNpZGVFZmZlY3RzIix7ZW51bWVyYWJsZTohMX0pO31nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUoZSl7Y29uc3QgdD10aGlzLmRlY2xhcmF0aW9ucy5nZXQoZSk7aWYodClyZXR1cm4gW3RdO2NvbnN0IHM9bmV3IHBlKHRoaXMsZSk7cmV0dXJuIHRoaXMuZGVjbGFyYXRpb25zLnNldChlLHMpLHRoaXMuZXhwb3J0ZWRWYXJpYWJsZXMuc2V0KHMsZSksW3NdfXN1Z2dlc3ROYW1lKGUpe2NvbnN0IHQ9KHRoaXMubmFtZVN1Z2dlc3Rpb25zLmdldChlKT8/MCkrMTt0aGlzLm5hbWVTdWdnZXN0aW9ucy5zZXQoZSx0KSx0PnRoaXMubW9zdENvbW1vblN1Z2dlc3Rpb24mJih0aGlzLm1vc3RDb21tb25TdWdnZXN0aW9uPXQsdGhpcy5zdWdnZXN0ZWRWYXJpYWJsZU5hbWU9ZSk7fXdhcm5VbnVzZWRJbXBvcnRzKCl7Y29uc3QgZT1bLi4udGhpcy5kZWNsYXJhdGlvbnNdLmZpbHRlcigoKFtlLHRdKT0+IioiIT09ZSYmIXQuaW5jbHVkZWQmJiF0aGlzLnJlZXhwb3J0ZWQmJiF0LnJlZmVyZW5jZWQpKS5tYXAoKChbZV0pPT5lKSk7aWYoMD09PWUubGVuZ3RoKXJldHVybjtjb25zdCB0PW5ldyBTZXQ7Zm9yKGNvbnN0IHMgb2YgZSlmb3IoY29uc3QgZSBvZiB0aGlzLmRlY2xhcmF0aW9ucy5nZXQocykubW9kdWxlLmltcG9ydGVycyl0LmFkZChlKTtjb25zdCBzPVsuLi50XTt2YXIgaSxuLHI7dGhpcy5vcHRpb25zLm9uTG9nKFNlLHtjb2RlOiJVTlVTRURfRVhURVJOQUxfSU1QT1JUIixleHBvcnRlcjppPXRoaXMuaWQsaWRzOnI9cyxtZXNzYWdlOmAke01lKG49ZSxbImlzIiwiYXJlIl0pfSBpbXBvcnRlZCBmcm9tIGV4dGVybmFsIG1vZHVsZSAiJHtpfSIgYnV0IG5ldmVyIHVzZWQgaW4gJHtNZShyLm1hcCgoZT0+VChlKSkpKX0uYCxuYW1lczpufSk7fX1jb25zdCBKdD17QXJyYXlQYXR0ZXJuKGUsdCl7Zm9yKGNvbnN0IHMgb2YgdC5lbGVtZW50cylzJiZKdFtzLnR5cGVdKGUscyk7fSxBc3NpZ25tZW50UGF0dGVybihlLHQpe0p0W3QubGVmdC50eXBlXShlLHQubGVmdCk7fSxJZGVudGlmaWVyKGUsdCl7ZS5wdXNoKHQubmFtZSk7fSxNZW1iZXJFeHByZXNzaW9uKCl7fSxPYmplY3RQYXR0ZXJuKGUsdCl7Zm9yKGNvbnN0IHMgb2YgdC5wcm9wZXJ0aWVzKSJSZXN0RWxlbWVudCI9PT1zLnR5cGU/SnQuUmVzdEVsZW1lbnQoZSxzKTpKdFtzLnZhbHVlLnR5cGVdKGUscy52YWx1ZSk7fSxSZXN0RWxlbWVudChlLHQpe0p0W3QuYXJndW1lbnQudHlwZV0oZSx0LmFyZ3VtZW50KTt9fSxlcz1mdW5jdGlvbihlKXtjb25zdCB0PVtdO3JldHVybiBKdFtlLnR5cGVdKHQsZSksdH07ZnVuY3Rpb24gdHMoKXtyZXR1cm4ge2Jyb2tlbkZsb3c6ITEsaGFzQnJlYWs6ITEsaGFzQ29udGludWU6ITEsaW5jbHVkZWRDYWxsQXJndW1lbnRzOm5ldyBTZXQsaW5jbHVkZWRMYWJlbHM6bmV3IFNldH19ZnVuY3Rpb24gc3MoKXtyZXR1cm4ge2FjY2Vzc2VkOm5ldyBlZSxhc3NpZ25lZDpuZXcgZWUsYnJva2VuRmxvdzohMSxjYWxsZWQ6bmV3IHNlLGhhc0JyZWFrOiExLGhhc0NvbnRpbnVlOiExLGlnbm9yZTp7YnJlYWtzOiExLGNvbnRpbnVlczohMSxsYWJlbHM6bmV3IFNldCxyZXR1cm5ZaWVsZDohMSx0aGlzOiExfSxpbmNsdWRlZExhYmVsczpuZXcgU2V0LGluc3RhbnRpYXRlZDpuZXcgc2UscmVwbGFjZWRWYXJpYWJsZUluaXRzOm5ldyBNYXB9fWZ1bmN0aW9uIGlzKGUsdD1udWxsKXtyZXR1cm4gT2JqZWN0LmNyZWF0ZSh0LGUpfW5ldyBTZXQoImJyZWFrIGNhc2UgY2xhc3MgY2F0Y2ggY29uc3QgY29udGludWUgZGVidWdnZXIgZGVmYXVsdCBkZWxldGUgZG8gZWxzZSBleHBvcnQgZXh0ZW5kcyBmaW5hbGx5IGZvciBmdW5jdGlvbiBpZiBpbXBvcnQgaW4gaW5zdGFuY2VvZiBsZXQgbmV3IHJldHVybiBzdXBlciBzd2l0Y2ggdGhpcyB0aHJvdyB0cnkgdHlwZW9mIHZhciB2b2lkIHdoaWxlIHdpdGggeWllbGQgZW51bSBhd2FpdCBpbXBsZW1lbnRzIHBhY2thZ2UgcHJvdGVjdGVkIHN0YXRpYyBpbnRlcmZhY2UgcHJpdmF0ZSBwdWJsaWMgYXJndW1lbnRzIEluZmluaXR5IE5hTiB1bmRlZmluZWQgbnVsbCB0cnVlIGZhbHNlIGV2YWwgdW5ldmFsIGlzRmluaXRlIGlzTmFOIHBhcnNlRmxvYXQgcGFyc2VJbnQgZGVjb2RlVVJJIGRlY29kZVVSSUNvbXBvbmVudCBlbmNvZGVVUkkgZW5jb2RlVVJJQ29tcG9uZW50IGVzY2FwZSB1bmVzY2FwZSBPYmplY3QgRnVuY3Rpb24gQm9vbGVhbiBTeW1ib2wgRXJyb3IgRXZhbEVycm9yIEludGVybmFsRXJyb3IgUmFuZ2VFcnJvciBSZWZlcmVuY2VFcnJvciBTeW50YXhFcnJvciBUeXBlRXJyb3IgVVJJRXJyb3IgTnVtYmVyIE1hdGggRGF0ZSBTdHJpbmcgUmVnRXhwIEFycmF5IEludDhBcnJheSBVaW50OEFycmF5IFVpbnQ4Q2xhbXBlZEFycmF5IEludDE2QXJyYXkgVWludDE2QXJyYXkgSW50MzJBcnJheSBVaW50MzJBcnJheSBGbG9hdDMyQXJyYXkgRmxvYXQ2NEFycmF5IE1hcCBTZXQgV2Vha01hcCBXZWFrU2V0IFNJTUQgQXJyYXlCdWZmZXIgRGF0YVZpZXcgSlNPTiBQcm9taXNlIEdlbmVyYXRvciBHZW5lcmF0b3JGdW5jdGlvbiBSZWZsZWN0IFByb3h5IEludGwiLnNwbGl0KCIgIikpLmFkZCgiIik7Y29uc3QgbnM9bmV3IGNsYXNzIGV4dGVuZHMgcmV7Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKCl7fX0scnM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6b2V9fSxvcz1uZXcgY2xhc3MgZXh0ZW5kcyByZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP0VzKGZzLGVbMF0pOmFlfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eHMoZnMsZVswXSx0LHMpfX0sYXM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6b3N9fSxscz1uZXcgY2xhc3MgZXh0ZW5kcyByZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP0VzKG1zLGVbMF0pOmFlfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eHMobXMsZVswXSx0LHMpfX0sY3M9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6bHN9fSxocz1uZXcgY2xhc3MgZXh0ZW5kcyByZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP0VzKHlzLGVbMF0pOmFlfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eHMoeXMsZVswXSx0LHMpfX0sdXM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6aHN9fSxkcz17dmFsdWU6e2hhc0VmZmVjdHNXaGVuQ2FsbGVkKHthcmdzOmV9LHQpe2NvbnN0IHM9ZVsyXTtyZXR1cm4gZS5sZW5ndGg8M3x8InN5bWJvbCI9PXR5cGVvZiBzLmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHRlLHtkZW9wdGltaXplQ2FjaGUoKXt9fSkmJnMuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSx1ZSx0KX0scmV0dXJuczpoc319LHBzPWlzKHtoYXNPd25Qcm9wZXJ0eTphcyxpc1Byb3RvdHlwZU9mOmFzLHByb3BlcnR5SXNFbnVtZXJhYmxlOmFzLHRvTG9jYWxlU3RyaW5nOnVzLHRvU3RyaW5nOnVzLHZhbHVlT2Y6cnN9KSxmcz1pcyh7dmFsdWVPZjphc30scHMpLG1zPWlzKHt0b0V4cG9uZW50aWFsOnVzLHRvRml4ZWQ6dXMsdG9Mb2NhbGVTdHJpbmc6dXMsdG9QcmVjaXNpb246dXMsdmFsdWVPZjpjc30scHMpLGdzPWlzKHtleGVjOnJzLHRlc3Q6YXN9LHBzKSx5cz1pcyh7YW5jaG9yOnVzLGF0OnJzLGJpZzp1cyxibGluazp1cyxib2xkOnVzLGNoYXJBdDp1cyxjaGFyQ29kZUF0OmNzLGNvZGVQb2ludEF0OnJzLGNvbmNhdDp1cyxlbmRzV2l0aDphcyxmaXhlZDp1cyxmb250Y29sb3I6dXMsZm9udHNpemU6dXMsaW5jbHVkZXM6YXMsaW5kZXhPZjpjcyxpdGFsaWNzOnVzLGxhc3RJbmRleE9mOmNzLGxpbms6dXMsbG9jYWxlQ29tcGFyZTpjcyxtYXRjaDpycyxtYXRjaEFsbDpycyxub3JtYWxpemU6dXMscGFkRW5kOnVzLHBhZFN0YXJ0OnVzLHJlcGVhdDp1cyxyZXBsYWNlOmRzLHJlcGxhY2VBbGw6ZHMsc2VhcmNoOmNzLHNsaWNlOnVzLHNtYWxsOnVzLHNwbGl0OnJzLHN0YXJ0c1dpdGg6YXMsc3RyaWtlOnVzLHN1Yjp1cyxzdWJzdHI6dXMsc3Vic3RyaW5nOnVzLHN1cDp1cyx0b0xvY2FsZUxvd2VyQ2FzZTp1cyx0b0xvY2FsZVVwcGVyQ2FzZTp1cyx0b0xvd2VyQ2FzZTp1cyx0b1N0cmluZzp1cyx0b1VwcGVyQ2FzZTp1cyx0cmltOnVzLHRyaW1FbmQ6dXMsdHJpbUxlZnQ6dXMsdHJpbVJpZ2h0OnVzLHRyaW1TdGFydDp1cyx2YWx1ZU9mOnVzfSxwcyk7ZnVuY3Rpb24geHMoZSx0LHMsaSl7cmV0dXJuICJzdHJpbmciIT10eXBlb2YgdHx8IWVbdF18fChlW3RdLmhhc0VmZmVjdHNXaGVuQ2FsbGVkPy4ocyxpKXx8ITEpfWZ1bmN0aW9uIEVzKGUsdCl7cmV0dXJuICJzdHJpbmciPT10eXBlb2YgdCYmZVt0XT9bZVt0XS5yZXR1cm5zLCExXTphZX1mdW5jdGlvbiBicyhlLHQscyl7cyhlLHQpO31mdW5jdGlvbiB2cyhlLHQscyl7fXZhciBTcz17fTtTcy5Qcm9ncmFtPVNzLkJsb2NrU3RhdGVtZW50PVNzLlN0YXRpY0Jsb2NrPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUuYm9keTtpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJTdGF0ZW1lbnQiKTt9fSxTcy5TdGF0ZW1lbnQ9YnMsU3MuRW1wdHlTdGF0ZW1lbnQ9dnMsU3MuRXhwcmVzc2lvblN0YXRlbWVudD1Tcy5QYXJlbnRoZXNpemVkRXhwcmVzc2lvbj1Tcy5DaGFpbkV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuZXhwcmVzc2lvbix0LCJFeHByZXNzaW9uIil9LFNzLklmU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmNvbnNlcXVlbnQsdCwiU3RhdGVtZW50IiksZS5hbHRlcm5hdGUmJnMoZS5hbHRlcm5hdGUsdCwiU3RhdGVtZW50Iik7fSxTcy5MYWJlbGVkU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gcyhlLmJvZHksdCwiU3RhdGVtZW50Iil9LFNzLkJyZWFrU3RhdGVtZW50PVNzLkNvbnRpbnVlU3RhdGVtZW50PXZzLFNzLldpdGhTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3MoZS5vYmplY3QsdCwiRXhwcmVzc2lvbiIpLHMoZS5ib2R5LHQsIlN0YXRlbWVudCIpO30sU3MuU3dpdGNoU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUuZGlzY3JpbWluYW50LHQsIkV4cHJlc3Npb24iKTtmb3IodmFyIGk9MCxuPWUuY2FzZXM7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldO3IudGVzdCYmcyhyLnRlc3QsdCwiRXhwcmVzc2lvbiIpO2Zvcih2YXIgbz0wLGE9ci5jb25zZXF1ZW50O288YS5sZW5ndGg7bys9MSl7cyhhW29dLHQsIlN0YXRlbWVudCIpO319fSxTcy5Td2l0Y2hDYXNlPWZ1bmN0aW9uKGUsdCxzKXtlLnRlc3QmJnMoZS50ZXN0LHQsIkV4cHJlc3Npb24iKTtmb3IodmFyIGk9MCxuPWUuY29uc2VxdWVudDtpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJTdGF0ZW1lbnQiKTt9fSxTcy5SZXR1cm5TdGF0ZW1lbnQ9U3MuWWllbGRFeHByZXNzaW9uPVNzLkF3YWl0RXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7ZS5hcmd1bWVudCYmcyhlLmFyZ3VtZW50LHQsIkV4cHJlc3Npb24iKTt9LFNzLlRocm93U3RhdGVtZW50PVNzLlNwcmVhZEVsZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuYXJndW1lbnQsdCwiRXhwcmVzc2lvbiIpfSxTcy5UcnlTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3MoZS5ibG9jayx0LCJTdGF0ZW1lbnQiKSxlLmhhbmRsZXImJnMoZS5oYW5kbGVyLHQpLGUuZmluYWxpemVyJiZzKGUuZmluYWxpemVyLHQsIlN0YXRlbWVudCIpO30sU3MuQ2F0Y2hDbGF1c2U9ZnVuY3Rpb24oZSx0LHMpe2UucGFyYW0mJnMoZS5wYXJhbSx0LCJQYXR0ZXJuIikscyhlLmJvZHksdCwiU3RhdGVtZW50Iik7fSxTcy5XaGlsZVN0YXRlbWVudD1Tcy5Eb1doaWxlU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmJvZHksdCwiU3RhdGVtZW50Iik7fSxTcy5Gb3JTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe2UuaW5pdCYmcyhlLmluaXQsdCwiRm9ySW5pdCIpLGUudGVzdCYmcyhlLnRlc3QsdCwiRXhwcmVzc2lvbiIpLGUudXBkYXRlJiZzKGUudXBkYXRlLHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0LCJTdGF0ZW1lbnQiKTt9LFNzLkZvckluU3RhdGVtZW50PVNzLkZvck9mU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUubGVmdCx0LCJGb3JJbml0IikscyhlLnJpZ2h0LHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0LCJTdGF0ZW1lbnQiKTt9LFNzLkZvckluaXQ9ZnVuY3Rpb24oZSx0LHMpeyJWYXJpYWJsZURlY2xhcmF0aW9uIj09PWUudHlwZT9zKGUsdCk6cyhlLHQsIkV4cHJlc3Npb24iKTt9LFNzLkRlYnVnZ2VyU3RhdGVtZW50PXZzLFNzLkZ1bmN0aW9uRGVjbGFyYXRpb249ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUsdCwiRnVuY3Rpb24iKX0sU3MuVmFyaWFibGVEZWNsYXJhdGlvbj1mdW5jdGlvbihlLHQscyl7Zm9yKHZhciBpPTAsbj1lLmRlY2xhcmF0aW9ucztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0KTt9fSxTcy5WYXJpYWJsZURlY2xhcmF0b3I9ZnVuY3Rpb24oZSx0LHMpe3MoZS5pZCx0LCJQYXR0ZXJuIiksZS5pbml0JiZzKGUuaW5pdCx0LCJFeHByZXNzaW9uIik7fSxTcy5GdW5jdGlvbj1mdW5jdGlvbihlLHQscyl7ZS5pZCYmcyhlLmlkLHQsIlBhdHRlcm4iKTtmb3IodmFyIGk9MCxuPWUucGFyYW1zO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQsIlBhdHRlcm4iKTt9cyhlLmJvZHksdCxlLmV4cHJlc3Npb24/IkV4cHJlc3Npb24iOiJTdGF0ZW1lbnQiKTt9LFNzLlBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpeyJJZGVudGlmaWVyIj09PWUudHlwZT9zKGUsdCwiVmFyaWFibGVQYXR0ZXJuIik6Ik1lbWJlckV4cHJlc3Npb24iPT09ZS50eXBlP3MoZSx0LCJNZW1iZXJQYXR0ZXJuIik6cyhlLHQpO30sU3MuVmFyaWFibGVQYXR0ZXJuPXZzLFNzLk1lbWJlclBhdHRlcm49YnMsU3MuUmVzdEVsZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuYXJndW1lbnQsdCwiUGF0dGVybiIpfSxTcy5BcnJheVBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5lbGVtZW50cztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07ciYmcyhyLHQsIlBhdHRlcm4iKTt9fSxTcy5PYmplY3RQYXR0ZXJuPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07IlByb3BlcnR5Ij09PXIudHlwZT8oci5jb21wdXRlZCYmcyhyLmtleSx0LCJFeHByZXNzaW9uIikscyhyLnZhbHVlLHQsIlBhdHRlcm4iKSk6IlJlc3RFbGVtZW50Ij09PXIudHlwZSYmcyhyLmFyZ3VtZW50LHQsIlBhdHRlcm4iKTt9fSxTcy5FeHByZXNzaW9uPWJzLFNzLlRoaXNFeHByZXNzaW9uPVNzLlN1cGVyPVNzLk1ldGFQcm9wZXJ0eT12cyxTcy5BcnJheUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5lbGVtZW50cztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07ciYmcyhyLHQsIkV4cHJlc3Npb24iKTt9fSxTcy5PYmplY3RFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0KTt9fSxTcy5GdW5jdGlvbkV4cHJlc3Npb249U3MuQXJyb3dGdW5jdGlvbkV4cHJlc3Npb249U3MuRnVuY3Rpb25EZWNsYXJhdGlvbixTcy5TZXF1ZW5jZUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5leHByZXNzaW9ucztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJFeHByZXNzaW9uIik7fX0sU3MuVGVtcGxhdGVMaXRlcmFsPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucXVhc2lzO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQpO31mb3IodmFyIHI9MCxvPWUuZXhwcmVzc2lvbnM7cjxvLmxlbmd0aDtyKz0xKXtzKG9bcl0sdCwiRXhwcmVzc2lvbiIpO319LFNzLlRlbXBsYXRlRWxlbWVudD12cyxTcy5VbmFyeUV4cHJlc3Npb249U3MuVXBkYXRlRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cyhlLmFyZ3VtZW50LHQsIkV4cHJlc3Npb24iKTt9LFNzLkJpbmFyeUV4cHJlc3Npb249U3MuTG9naWNhbEV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS5sZWZ0LHQsIkV4cHJlc3Npb24iKSxzKGUucmlnaHQsdCwiRXhwcmVzc2lvbiIpO30sU3MuQXNzaWdubWVudEV4cHJlc3Npb249U3MuQXNzaWdubWVudFBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe3MoZS5sZWZ0LHQsIlBhdHRlcm4iKSxzKGUucmlnaHQsdCwiRXhwcmVzc2lvbiIpO30sU3MuQ29uZGl0aW9uYWxFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmNvbnNlcXVlbnQsdCwiRXhwcmVzc2lvbiIpLHMoZS5hbHRlcm5hdGUsdCwiRXhwcmVzc2lvbiIpO30sU3MuTmV3RXhwcmVzc2lvbj1Tcy5DYWxsRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7aWYocyhlLmNhbGxlZSx0LCJFeHByZXNzaW9uIiksZS5hcmd1bWVudHMpZm9yKHZhciBpPTAsbj1lLmFyZ3VtZW50cztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJFeHByZXNzaW9uIik7fX0sU3MuTWVtYmVyRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cyhlLm9iamVjdCx0LCJFeHByZXNzaW9uIiksZS5jb21wdXRlZCYmcyhlLnByb3BlcnR5LHQsIkV4cHJlc3Npb24iKTt9LFNzLkV4cG9ydE5hbWVkRGVjbGFyYXRpb249U3MuRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uPWZ1bmN0aW9uKGUsdCxzKXtlLmRlY2xhcmF0aW9uJiZzKGUuZGVjbGFyYXRpb24sdCwiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiI9PT1lLnR5cGV8fGUuZGVjbGFyYXRpb24uaWQ/IlN0YXRlbWVudCI6IkV4cHJlc3Npb24iKSxlLnNvdXJjZSYmcyhlLnNvdXJjZSx0LCJFeHByZXNzaW9uIik7fSxTcy5FeHBvcnRBbGxEZWNsYXJhdGlvbj1mdW5jdGlvbihlLHQscyl7ZS5leHBvcnRlZCYmcyhlLmV4cG9ydGVkLHQpLHMoZS5zb3VyY2UsdCwiRXhwcmVzc2lvbiIpO30sU3MuSW1wb3J0RGVjbGFyYXRpb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5zcGVjaWZpZXJzO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQpO31zKGUuc291cmNlLHQsIkV4cHJlc3Npb24iKTt9LFNzLkltcG9ydEV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS5zb3VyY2UsdCwiRXhwcmVzc2lvbiIpO30sU3MuSW1wb3J0U3BlY2lmaWVyPVNzLkltcG9ydERlZmF1bHRTcGVjaWZpZXI9U3MuSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyPVNzLklkZW50aWZpZXI9U3MuUHJpdmF0ZUlkZW50aWZpZXI9U3MuTGl0ZXJhbD12cyxTcy5UYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS50YWcsdCwiRXhwcmVzc2lvbiIpLHMoZS5xdWFzaSx0LCJFeHByZXNzaW9uIik7fSxTcy5DbGFzc0RlY2xhcmF0aW9uPVNzLkNsYXNzRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cmV0dXJuIHMoZSx0LCJDbGFzcyIpfSxTcy5DbGFzcz1mdW5jdGlvbihlLHQscyl7ZS5pZCYmcyhlLmlkLHQsIlBhdHRlcm4iKSxlLnN1cGVyQ2xhc3MmJnMoZS5zdXBlckNsYXNzLHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0KTt9LFNzLkNsYXNzQm9keT1mdW5jdGlvbihlLHQscyl7Zm9yKHZhciBpPTAsbj1lLmJvZHk7aTxuLmxlbmd0aDtpKz0xKXtzKG5baV0sdCk7fX0sU3MuTWV0aG9kRGVmaW5pdGlvbj1Tcy5Qcm9wZXJ0eURlZmluaXRpb249U3MuUHJvcGVydHk9ZnVuY3Rpb24oZSx0LHMpe2UuY29tcHV0ZWQmJnMoZS5rZXksdCwiRXhwcmVzc2lvbiIpLGUudmFsdWUmJnMoZS52YWx1ZSx0LCJFeHByZXNzaW9uIik7fTtjb25zdCBBcz0iQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iLGtzPSJCaW5hcnlFeHByZXNzaW9uIixJcz0iQmxvY2tTdGF0ZW1lbnQiLHdzPSJDYWxsRXhwcmVzc2lvbiIsUHM9IkNoYWluRXhwcmVzc2lvbiIsQ3M9IkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsJHM9IkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIsTnM9IkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iLF9zPSJFeHByZXNzaW9uU3RhdGVtZW50IixScz0iRnVuY3Rpb25EZWNsYXJhdGlvbiIsTXM9IklkZW50aWZpZXIiLE9zPSJMb2dpY2FsRXhwcmVzc2lvbiIsRHM9Ik5ld0V4cHJlc3Npb24iLExzPSJQcm9ncmFtIixUcz0iU2VxdWVuY2VFeHByZXNzaW9uIixWcz0iVmFyaWFibGVEZWNsYXJhdG9yIixCcz0iVmFyaWFibGVEZWNsYXJhdGlvbiI7bGV0IHpzPSJzb3VyY2VNYSI7enMrPSJwcGluZ1VSTCI7Y29uc3QgRnM9bmV3IFJlZ0V4cChgXiNbIFxcZlxcclxcdFxcdlxcdTAwYTBcXHUxNjgwXFx1MjAwMC1cXHUyMDBhXFx1MjAyOFxcdTIwMjlcXHUyMDJmXFx1MjA1ZlxcdTMwMDBcXHVmZWZmXSske3pzfT0uK2ApLGpzPSJfcm9sbHVwQW5ub3RhdGlvbnMiLFVzPSJfcm9sbHVwUmVtb3ZlZCI7ZnVuY3Rpb24gR3MoZSx0LHM9ZS50eXBlKXtjb25zdHthbm5vdGF0aW9uczppLGNvZGU6bn09dDtsZXQgcj1pW3QuYW5ub3RhdGlvbkluZGV4XTtmb3IoO3ImJmUuc3RhcnQ+PXIuZW5kOylIcyhlLHIsbikscj1pWysrdC5hbm5vdGF0aW9uSW5kZXhdO2lmKHImJnIuZW5kPD1lLmVuZClmb3IoU3Nbc10oZSx0LEdzKTsocj1pW3QuYW5ub3RhdGlvbkluZGV4XSkmJnIuZW5kPD1lLmVuZDspKyt0LmFubm90YXRpb25JbmRleCxYcyhlLHIsITEpO31jb25zdCBXcz0vW15ccyhdL2cscXM9L1xTL2c7ZnVuY3Rpb24gSHMoZSx0LHMpe2NvbnN0IGk9W107bGV0IG47aWYoS3Mocy5zbGljZSh0LmVuZCxlLnN0YXJ0KSxXcykpe2NvbnN0IHQ9ZS5zdGFydDtmb3IoOzspe3N3aXRjaChpLnB1c2goZSksZS50eXBlKXtjYXNlIF9zOmNhc2UgUHM6ZT1lLmV4cHJlc3Npb247Y29udGludWU7Y2FzZSBUczppZihLcyhzLnNsaWNlKHQsZS5zdGFydCkscXMpKXtlPWUuZXhwcmVzc2lvbnNbMF07Y29udGludWV9bj0hMDticmVhaztjYXNlIENzOmlmKEtzKHMuc2xpY2UodCxlLnN0YXJ0KSxxcykpe2U9ZS50ZXN0O2NvbnRpbnVlfW49ITA7YnJlYWs7Y2FzZSBPczpjYXNlIGtzOmlmKEtzKHMuc2xpY2UodCxlLnN0YXJ0KSxxcykpe2U9ZS5sZWZ0O2NvbnRpbnVlfW49ITA7YnJlYWs7Y2FzZSBOczpjYXNlICRzOmU9ZS5kZWNsYXJhdGlvbjtjb250aW51ZTtjYXNlIEJzOntjb25zdCB0PWU7aWYoImNvbnN0Ij09PXQua2luZCl7ZT10LmRlY2xhcmF0aW9uc1swXS5pbml0O2NvbnRpbnVlfW49ITA7YnJlYWt9Y2FzZSBWczplPWUuaW5pdDtjb250aW51ZTtjYXNlIFJzOmNhc2UgQXM6Y2FzZSB3czpjYXNlIERzOmJyZWFrO2RlZmF1bHQ6bj0hMDt9YnJlYWt9fWVsc2Ugbj0hMDtpZihuKVhzKGUsdCwhMSk7ZWxzZSBmb3IoY29uc3QgZSBvZiBpKVhzKGUsdCwhMCk7fWZ1bmN0aW9uIEtzKGUsdCl7bGV0IHM7Zm9yKDtudWxsIT09KHM9dC5leGVjKGUpKTspe2lmKCIvIj09PXNbMF0pe2NvbnN0IHM9ZS5jaGFyQ29kZUF0KHQubGFzdEluZGV4KTtpZig0Mj09PXMpe3QubGFzdEluZGV4PWUuaW5kZXhPZigiKi8iLHQubGFzdEluZGV4KzEpKzI7Y29udGludWV9aWYoNDc9PT1zKXt0Lmxhc3RJbmRleD1lLmluZGV4T2YoIlxuIix0Lmxhc3RJbmRleCsxKSsxO2NvbnRpbnVlfX1yZXR1cm4gdC5sYXN0SW5kZXg9MCwhMX1yZXR1cm4gITB9Y29uc3QgWXM9W1sicHVyZSIsL1sjQF1fX1BVUkVfXy9dLFsibm9TaWRlRWZmZWN0cyIsL1sjQF1fX05PX1NJREVfRUZGRUNUU19fL11dO2Z1bmN0aW9uIFhzKGUsdCxzKXtjb25zdCBpPXM/anM6VXMsbj1lW2ldO24/bi5wdXNoKHQpOmVbaV09W3RdO31jb25zdCBRcz17SW1wb3J0RXhwcmVzc2lvbjpbImFyZ3VtZW50cyJdLExpdGVyYWw6W10sUHJvZ3JhbTpbImJvZHkiXX07Y29uc3QgWnM9InZhcmlhYmxlcyI7Y2xhc3MgSnMgZXh0ZW5kcyByZXtjb25zdHJ1Y3RvcihlLHQscyxpPSExKXtzdXBlcigpLHRoaXMuZGVvcHRpbWl6ZWQ9ITEsdGhpcy5lc1RyZWVOb2RlPWk/ZTpudWxsLHRoaXMua2V5cz1Rc1tlLnR5cGVdfHxmdW5jdGlvbihlKXtyZXR1cm4gUXNbZS50eXBlXT1PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PiJvYmplY3QiPT10eXBlb2YgZVt0XSYmOTUhPT10LmNoYXJDb2RlQXQoMCkpKSxRc1tlLnR5cGVdfShlKSx0aGlzLnBhcmVudD10LHRoaXMuY29udGV4dD10LmNvbnRleHQsdGhpcy5jcmVhdGVTY29wZShzKSx0aGlzLnBhcnNlTm9kZShlKSx0aGlzLmluaXRpYWxpc2UoKSx0aGlzLmNvbnRleHQubWFnaWNTdHJpbmcuYWRkU291cmNlbWFwTG9jYXRpb24odGhpcy5zdGFydCksdGhpcy5jb250ZXh0Lm1hZ2ljU3RyaW5nLmFkZFNvdXJjZW1hcExvY2F0aW9uKHRoaXMuZW5kKTt9YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXt9YmluZCgpe2Zvcihjb25zdCBlIG9mIHRoaXMua2V5cyl7Y29uc3QgdD10aGlzW2VdO2lmKEFycmF5LmlzQXJyYXkodCkpZm9yKGNvbnN0IGUgb2YgdCllPy5iaW5kKCk7ZWxzZSB0JiZ0LmJpbmQoKTt9fWNyZWF0ZVNjb3BlKGUpe3RoaXMuc2NvcGU9ZTt9aGFzRWZmZWN0cyhlKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5rZXlzKXtjb25zdCBzPXRoaXNbdF07aWYobnVsbCE9PXMpaWYoQXJyYXkuaXNBcnJheShzKSl7Zm9yKGNvbnN0IHQgb2YgcylpZih0Py5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1lbHNlIGlmKHMuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITB9cmV0dXJuICExfWhhc0VmZmVjdHNBc0Fzc2lnbm1lbnRUYXJnZXQoZSx0KXtyZXR1cm4gdGhpcy5oYXNFZmZlY3RzKGUpfHx0aGlzLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFksdGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb24sZSl9aW5jbHVkZShlLHQscyl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5rZXlzKXtjb25zdCBpPXRoaXNbc107aWYobnVsbCE9PWkpaWYoQXJyYXkuaXNBcnJheShpKSlmb3IoY29uc3QgcyBvZiBpKXM/LmluY2x1ZGUoZSx0KTtlbHNlIGkuaW5jbHVkZShlLHQpO319aW5jbHVkZUFzQXNzaWdubWVudFRhcmdldChlLHQscyl7dGhpcy5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt9aW5zZXJ0U2VtaWNvbG9uKGUpeyI7IiE9PWUub3JpZ2luYWxbdGhpcy5lbmQtMV0mJmUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpO31wYXJzZU5vZGUoZSx0KXtmb3IoY29uc3RbcyxpXW9mIE9iamVjdC5lbnRyaWVzKGUpKWlmKCF0aGlzLmhhc093blByb3BlcnR5KHMpKWlmKDk1PT09cy5jaGFyQ29kZUF0KDApKXtpZihzPT09anMpe2NvbnN0IGU9aTt0aGlzLmFubm90YXRpb25zPWUsdGhpcy5jb250ZXh0Lm9wdGlvbnMudHJlZXNoYWtlLmFubm90YXRpb25zJiYodGhpcy5hbm5vdGF0aW9uTm9TaWRlRWZmZWN0cz1lLnNvbWUoKGU9PiJub1NpZGVFZmZlY3RzIj09PWUuYW5ub3RhdGlvblR5cGUpKSx0aGlzLmFubm90YXRpb25QdXJlPWUuc29tZSgoZT0+InB1cmUiPT09ZS5hbm5vdGF0aW9uVHlwZSkpKTt9ZWxzZSBpZihzPT09VXMpZm9yKGNvbnN0e3N0YXJ0OmUsZW5kOnR9b2YgaSl0aGlzLmNvbnRleHQubWFnaWNTdHJpbmcucmVtb3ZlKGUsdCk7fWVsc2UgaWYoIm9iamVjdCIhPXR5cGVvZiBpfHxudWxsPT09aSl0aGlzW3NdPWk7ZWxzZSBpZihBcnJheS5pc0FycmF5KGkpKXt0aGlzW3NdPVtdO2Zvcihjb25zdCBlIG9mIGkpdGhpc1tzXS5wdXNoKG51bGw9PT1lP251bGw6bmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3IoZS50eXBlKSkoZSx0aGlzLHRoaXMuc2NvcGUsdD8uaW5jbHVkZXMocykpKTt9ZWxzZSB0aGlzW3NdPW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKGkudHlwZSkpKGksdGhpcyx0aGlzLnNjb3BlLHQ/LmluY2x1ZGVzKHMpKTt9cmVuZGVyKGUsdCl7Zm9yKGNvbnN0IHMgb2YgdGhpcy5rZXlzKXtjb25zdCBpPXRoaXNbc107aWYobnVsbCE9PWkpaWYoQXJyYXkuaXNBcnJheShpKSlmb3IoY29uc3QgcyBvZiBpKXM/LnJlbmRlcihlLHQpO2Vsc2UgaS5yZW5kZXIoZSx0KTt9fXNldEFzc2lnbmVkVmFsdWUoZSl7dGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb249e2FyZ3M6W251bGwsZV0sdHlwZToxfTt9c2hvdWxkQmVJbmNsdWRlZChlKXtyZXR1cm4gdGhpcy5pbmNsdWRlZHx8IWUuYnJva2VuRmxvdyYmdGhpcy5oYXNFZmZlY3RzKHNzKCkpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtmb3IoY29uc3QgZSBvZiB0aGlzLmtleXMpe2NvbnN0IHQ9dGhpc1tlXTtpZihudWxsIT09dClpZihBcnJheS5pc0FycmF5KHQpKWZvcihjb25zdCBlIG9mIHQpZT8uZGVvcHRpbWl6ZVBhdGgoWCk7ZWxzZSB0LmRlb3B0aW1pemVQYXRoKFgpO310aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319Y2xhc3MgZWkgZXh0ZW5kcyBKc3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dC5sZW5ndGg+MCYmdGhpcy5hcmd1bWVudC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLFtXLC4uLnRdLHMpO31oYXNFZmZlY3RzKGUpe3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKTtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czp0fT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7cmV0dXJuIHRoaXMuYXJndW1lbnQuaGFzRWZmZWN0cyhlKXx8dCYmKCJhbHdheXMiPT09dHx8dGhpcy5hcmd1bWVudC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChYLGNlLGUpKX1hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChbVyxXXSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fWNsYXNzIHRpIGV4dGVuZHMgcmV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSx0aGlzLmRlc2NyaXB0aW9uPWU7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHthcmdzOmUsdHlwZTp0fSxzKXsyPT09dCYmMD09PXMubGVuZ3RoJiZ0aGlzLmRlc2NyaXB0aW9uLm11dGF0ZXNTZWxmQXNBcnJheSYmZVswXT8uZGVvcHRpbWl6ZVBhdGgoWik7fWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUse2FyZ3M6dH0pe3JldHVybiBlLmxlbmd0aD4wP2FlOlt0aGlzLmRlc2NyaXB0aW9uLnJldHVybnNQcmltaXRpdmV8fCgic2VsZiI9PT10aGlzLmRlc2NyaXB0aW9uLnJldHVybnM/dFswXXx8b2U6dGhpcy5kZXNjcmlwdGlvbi5yZXR1cm5zKCkpLCExXX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7Y29uc3R7dHlwZTppfT10O2lmKGUubGVuZ3RoPigwPT09aT8xOjApKXJldHVybiAhMDtpZigyPT09aSl7Y29uc3R7YXJnczplfT10O2lmKCEwPT09dGhpcy5kZXNjcmlwdGlvbi5tdXRhdGVzU2VsZkFzQXJyYXkmJmVbMF0/Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFosaGUscykpcmV0dXJuICEwO2lmKHRoaXMuZGVzY3JpcHRpb24uY2FsbHNBcmdzKWZvcihjb25zdCB0IG9mIHRoaXMuZGVzY3JpcHRpb24uY2FsbHNBcmdzKWlmKGVbdCsxXT8uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSx1ZSxzKSlyZXR1cm4gITB9cmV0dXJuICExfX1jb25zdCBzaT1bbmV3IHRpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITEscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6b3N9KV0saWk9W25ldyB0aSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiExLHJldHVybnM6bnVsbCxyZXR1cm5zUHJpbWl0aXZlOmhzfSldLG5pPVtuZXcgdGkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheTohMSxyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpsc30pXSxyaT1bbmV3IHRpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITEscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6b2V9KV0sb2k9L15cZCskLztjbGFzcyBhaSBleHRlbmRzIHJle2NvbnN0cnVjdG9yKGUsdCxzPSExKXtpZihzdXBlcigpLHRoaXMucHJvdG90eXBlRXhwcmVzc2lvbj10LHRoaXMuaW1tdXRhYmxlPXMsdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ9bmV3IFNldCx0aGlzLmFsbFByb3BlcnRpZXM9W10sdGhpcy5kZW9wdGltaXplZFBhdGhzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5PU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5nZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLmhhc0xvc3RUcmFjaz0hMSx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXI9ITEsdGhpcy5oYXNVbmtub3duRGVvcHRpbWl6ZWRQcm9wZXJ0eT0hMSx0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLnNldHRlcnNCeUtleT1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMudW5rbm93bkludGVnZXJQcm9wcz1bXSx0aGlzLnVubWF0Y2hhYmxlR2V0dGVycz1bXSx0aGlzLnVubWF0Y2hhYmxlUHJvcGVydGllc0FuZEdldHRlcnM9W10sdGhpcy51bm1hdGNoYWJsZVNldHRlcnM9W10sQXJyYXkuaXNBcnJheShlKSl0aGlzLmJ1aWxkUHJvcGVydHlNYXBzKGUpO2Vsc2Uge3RoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleT10aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXk9ZTtmb3IoY29uc3QgdCBvZiBPYmplY3QudmFsdWVzKGUpKXRoaXMuYWxsUHJvcGVydGllcy5wdXNoKC4uLnQpO319ZGVvcHRpbWl6ZUFsbFByb3BlcnRpZXMoZSl7Y29uc3QgdD10aGlzLmhhc0xvc3RUcmFja3x8dGhpcy5oYXNVbmtub3duRGVvcHRpbWl6ZWRQcm9wZXJ0eTtpZihlP3RoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkUHJvcGVydHk9ITA6dGhpcy5oYXNMb3N0VHJhY2s9ITAsIXQpe2Zvcihjb25zdCBlIG9mIFsuLi5PYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleSksLi4uT2JqZWN0LnZhbHVlcyh0aGlzLnNldHRlcnNCeUtleSldKWZvcihjb25zdCB0IG9mIGUpdC5kZW9wdGltaXplUGF0aChYKTt0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/LmRlb3B0aW1pemVQYXRoKFtXLFddKSx0aGlzLmRlb3B0aW1pemVDYWNoZWRFbnRpdGllcygpO319ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0W2ksLi4ubl09dCx7YXJnczpyLHR5cGU6b309ZTtpZih0aGlzLmhhc0xvc3RUcmFja3x8KDI9PT1vfHx0Lmxlbmd0aD4xKSYmKHRoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkUHJvcGVydHl8fCJzdHJpbmciPT10eXBlb2YgaSYmdGhpcy5kZW9wdGltaXplZFBhdGhzW2ldKSlyZXR1cm4gdm9pZCBsZShlKTtjb25zdFthLGwsY109Mj09PW98fHQubGVuZ3RoPjE/W3RoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleSx0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZVByb3BlcnRpZXNBbmRHZXR0ZXJzXTowPT09bz9bdGhpcy5wcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5LHRoaXMuZ2V0dGVyc0J5S2V5LHRoaXMudW5tYXRjaGFibGVHZXR0ZXJzXTpbdGhpcy5wcm9wZXJ0aWVzQW5kU2V0dGVyc0J5S2V5LHRoaXMuc2V0dGVyc0J5S2V5LHRoaXMudW5tYXRjaGFibGVTZXR0ZXJzXTtpZigic3RyaW5nIj09dHlwZW9mIGkpe2lmKGFbaV0pe2NvbnN0IHQ9bFtpXTtpZih0KWZvcihjb25zdCBpIG9mIHQpaS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLG4scyk7aWYoIXRoaXMuaW1tdXRhYmxlKWZvcihjb25zdCBlIG9mIHIpZSYmdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO3JldHVybn1mb3IoY29uc3QgdCBvZiBjKXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO2lmKG9pLnRlc3QoaSkpZm9yKGNvbnN0IHQgb2YgdGhpcy51bmtub3duSW50ZWdlclByb3BzKXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO31lbHNlIHtmb3IoY29uc3QgdCBvZiBbLi4uT2JqZWN0LnZhbHVlcyhsKSxjXSlmb3IoY29uc3QgaSBvZiB0KWkuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO2Zvcihjb25zdCB0IG9mIHRoaXMudW5rbm93bkludGVnZXJQcm9wcyl0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsbixzKTt9aWYoIXRoaXMuaW1tdXRhYmxlKWZvcihjb25zdCBlIG9mIHIpZSYmdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO3RoaXMucHJvdG90eXBlRXhwcmVzc2lvbj8uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplSW50ZWdlclByb3BlcnRpZXMoKXtpZighKHRoaXMuaGFzTG9zdFRyYWNrfHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZFByb3BlcnR5fHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXIpKXt0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXI9ITA7Zm9yKGNvbnN0W2UsdF1vZiBPYmplY3QuZW50cmllcyh0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXkpKWlmKG9pLnRlc3QoZSkpZm9yKGNvbnN0IGUgb2YgdCllLmRlb3B0aW1pemVQYXRoKFgpO3RoaXMuZGVvcHRpbWl6ZUNhY2hlZEludGVnZXJFbnRpdGllcygpO319ZGVvcHRpbWl6ZVBhdGgoZSl7aWYodGhpcy5oYXNMb3N0VHJhY2t8fHRoaXMuaW1tdXRhYmxlKXJldHVybjtjb25zdCB0PWVbMF07aWYoMT09PWUubGVuZ3RoKXtpZigic3RyaW5nIiE9dHlwZW9mIHQpcmV0dXJuIHQ9PT1IP3RoaXMuZGVvcHRpbWl6ZUludGVnZXJQcm9wZXJ0aWVzKCk6dGhpcy5kZW9wdGltaXplQWxsUHJvcGVydGllcyh0PT09cSk7aWYoIXRoaXMuZGVvcHRpbWl6ZWRQYXRoc1t0XSl7dGhpcy5kZW9wdGltaXplZFBhdGhzW3RdPSEwO2NvbnN0IGU9dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5W3RdO2lmKGUpZm9yKGNvbnN0IHQgb2YgZSl0LmRlb3B0aW1pemVDYWNoZSgpO319Y29uc3Qgcz0xPT09ZS5sZW5ndGg/WDplLnNsaWNlKDEpO2Zvcihjb25zdCBlIG9mICJzdHJpbmciPT10eXBlb2YgdD9bLi4udGhpcy5wcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5W3RdfHx0aGlzLnVubWF0Y2hhYmxlUHJvcGVydGllc0FuZEdldHRlcnMsLi4udGhpcy5zZXR0ZXJzQnlLZXlbdF18fHRoaXMudW5tYXRjaGFibGVTZXR0ZXJzXTp0aGlzLmFsbFByb3BlcnRpZXMpZS5kZW9wdGltaXplUGF0aChzKTt0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/LmRlb3B0aW1pemVQYXRoKDE9PT1lLmxlbmd0aD9bLi4uZSxXXTplKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIG5lO2NvbnN0IGk9ZVswXSxuPXRoaXMuZ2V0TWVtYmVyRXhwcmVzc2lvbkFuZFRyYWNrRGVvcHQoaSxzKTtyZXR1cm4gbj9uLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLnNsaWNlKDEpLHQscyk6dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uP3RoaXMucHJvdG90eXBlRXhwcmVzc2lvbi5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpOjEhPT1lLmxlbmd0aD9pZTp2b2lkIDB9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7aWYoMD09PWUubGVuZ3RoKXJldHVybiBhZTtjb25zdFtuLC4uLnJdPWUsbz10aGlzLmdldE1lbWJlckV4cHJlc3Npb25BbmRUcmFja0Rlb3B0KG4saSk7cmV0dXJuIG8/by5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChyLHQscyxpKTp0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpOmFlfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtjb25zdFtpLC4uLm5dPWU7aWYobi5sZW5ndGg+MHx8Mj09PXQudHlwZSl7Y29uc3Qgcj10aGlzLmdldE1lbWJlckV4cHJlc3Npb24oaSk7cmV0dXJuIHI/ci5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChuLHQscyk6IXRoaXMucHJvdG90eXBlRXhwcmVzc2lvbnx8dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX1pZihpPT09cSlyZXR1cm4gITE7aWYodGhpcy5oYXNMb3N0VHJhY2spcmV0dXJuICEwO2NvbnN0W3IsbyxhXT0wPT09dC50eXBlP1t0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXksdGhpcy5nZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZUdldHRlcnNdOlt0aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXksdGhpcy5zZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZVNldHRlcnNdO2lmKCJzdHJpbmciPT10eXBlb2YgaSl7aWYocltpXSl7Y29uc3QgZT1vW2ldO2lmKGUpZm9yKGNvbnN0IGkgb2YgZSlpZihpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKG4sdCxzKSlyZXR1cm4gITA7cmV0dXJuICExfWZvcihjb25zdCBlIG9mIGEpaWYoZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChuLHQscykpcmV0dXJuICEwfWVsc2UgZm9yKGNvbnN0IGUgb2YgWy4uLk9iamVjdC52YWx1ZXMobyksYV0pZm9yKGNvbnN0IGkgb2YgZSlpZihpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKG4sdCxzKSlyZXR1cm4gITA7cmV0dXJuICEhdGhpcy5wcm90b3R5cGVFeHByZXNzaW9uJiZ0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWJ1aWxkUHJvcGVydHlNYXBzKGUpe2NvbnN0e2FsbFByb3BlcnRpZXM6dCxwcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5OnMscHJvcGVydGllc0FuZFNldHRlcnNCeUtleTppLHNldHRlcnNCeUtleTpuLGdldHRlcnNCeUtleTpyLHVua25vd25JbnRlZ2VyUHJvcHM6byx1bm1hdGNoYWJsZVByb3BlcnRpZXNBbmRHZXR0ZXJzOmEsdW5tYXRjaGFibGVHZXR0ZXJzOmwsdW5tYXRjaGFibGVTZXR0ZXJzOmN9PXRoaXMsaD1bXTtmb3IobGV0IHU9ZS5sZW5ndGgtMTt1Pj0wO3UtLSl7Y29uc3R7a2V5OmQsa2luZDpwLHByb3BlcnR5OmZ9PWVbdV07aWYodC5wdXNoKGYpLCJzdHJpbmciPT10eXBlb2YgZCkic2V0Ij09PXA/aVtkXXx8KGlbZF09W2YsLi4uaF0sbltkXT1bZiwuLi5jXSk6ImdldCI9PT1wP3NbZF18fChzW2RdPVtmLC4uLmFdLHJbZF09W2YsLi4ubF0pOihpW2RdfHwoaVtkXT1bZiwuLi5oXSksc1tkXXx8KHNbZF09W2YsLi4uYV0pKTtlbHNlIHtpZihkPT09SCl7by5wdXNoKGYpO2NvbnRpbnVlfSJzZXQiPT09cCYmYy5wdXNoKGYpLCJnZXQiPT09cCYmbC5wdXNoKGYpLCJnZXQiIT09cCYmaC5wdXNoKGYpLCJzZXQiIT09cCYmYS5wdXNoKGYpO319fWRlb3B0aW1pemVDYWNoZWRFbnRpdGllcygpe2Zvcihjb25zdCBlIG9mIE9iamVjdC52YWx1ZXModGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5KSlmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQpZS5kZW9wdGltaXplUGF0aChYKTt9ZGVvcHRpbWl6ZUNhY2hlZEludGVnZXJFbnRpdGllcygpe2Zvcihjb25zdFtlLHRdb2YgT2JqZWN0LmVudHJpZXModGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5KSlpZihvaS50ZXN0KGUpKWZvcihjb25zdCBlIG9mIHQpZS5kZW9wdGltaXplQ2FjaGUoKTtmb3IoY29uc3QgZSBvZiB0aGlzLmFkZGl0aW9uYWxFeHByZXNzaW9uc1RvQmVEZW9wdGltaXplZCllLmRlb3B0aW1pemVQYXRoKFopO31nZXRNZW1iZXJFeHByZXNzaW9uKGUpe2lmKHRoaXMuaGFzTG9zdFRyYWNrfHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZFByb3BlcnR5fHwic3RyaW5nIiE9dHlwZW9mIGV8fHRoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkSW50ZWdlciYmb2kudGVzdChlKXx8dGhpcy5kZW9wdGltaXplZFBhdGhzW2VdKXJldHVybiBvZTtjb25zdCB0PXRoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleVtlXTtyZXR1cm4gMT09PXQ/Lmxlbmd0aD90WzBdOnR8fHRoaXMudW5tYXRjaGFibGVQcm9wZXJ0aWVzQW5kR2V0dGVycy5sZW5ndGg+MHx8dGhpcy51bmtub3duSW50ZWdlclByb3BzLmxlbmd0aD4wJiZvaS50ZXN0KGUpP29lOm51bGx9Z2V0TWVtYmVyRXhwcmVzc2lvbkFuZFRyYWNrRGVvcHQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIGUpcmV0dXJuIG9lO2NvbnN0IHM9dGhpcy5nZXRNZW1iZXJFeHByZXNzaW9uKGUpO2lmKHMhPT1vZSYmIXRoaXMuaW1tdXRhYmxlKXsodGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5W2VdPXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWRCeUtleVtlXXx8W10pLnB1c2godCk7fXJldHVybiBzfX1jb25zdCBsaT1lPT4ic3RyaW5nIj09dHlwZW9mIGUmJi9eXGQrJC8udGVzdChlKSxjaT1uZXcgY2xhc3MgZXh0ZW5kcyByZXtkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQpezIhPT1lLnR5cGV8fDEhPT10Lmxlbmd0aHx8bGkodFswXSl8fGxlKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIDE9PT1lLmxlbmd0aCYmbGkoZVswXSk/dm9pZCAwOmllfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiBlLmxlbmd0aD4xfHwyPT09dH19LGhpPW5ldyBhaSh7X19wcm90b19fOm51bGwsaGFzT3duUHJvcGVydHk6c2ksaXNQcm90b3R5cGVPZjpzaSxwcm9wZXJ0eUlzRW51bWVyYWJsZTpzaSx0b0xvY2FsZVN0cmluZzppaSx0b1N0cmluZzppaSx2YWx1ZU9mOnJpfSxjaSwhMCksdWk9W3trZXk6SCxraW5kOiJpbml0Iixwcm9wZXJ0eTpvZX0se2tleToibGVuZ3RoIixraW5kOiJpbml0Iixwcm9wZXJ0eTpsc31dLGRpPVtuZXcgdGkoe2NhbGxzQXJnczpbMF0sbXV0YXRlc1NlbGZBc0FycmF5OiJkZW9wdC1vbmx5IixyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpvc30pXSxwaT1bbmV3IHRpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6bHN9KV0sZmk9W25ldyB0aSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiEwLHJldHVybnM6KCk9Pm5ldyBhaSh1aSxBaSkscmV0dXJuc1ByaW1pdGl2ZTpudWxsfSldLG1pPVtuZXcgdGkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczooKT0+bmV3IGFpKHVpLEFpKSxyZXR1cm5zUHJpbWl0aXZlOm51bGx9KV0sZ2k9W25ldyB0aSh7Y2FsbHNBcmdzOlswXSxtdXRhdGVzU2VsZkFzQXJyYXk6ImRlb3B0LW9ubHkiLHJldHVybnM6KCk9Pm5ldyBhaSh1aSxBaSkscmV0dXJuc1ByaW1pdGl2ZTpudWxsfSldLHlpPVtuZXcgdGkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheTohMCxyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpsc30pXSx4aT1bbmV3IHRpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITAscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6b2V9KV0sRWk9W25ldyB0aSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiJkZW9wdC1vbmx5IixyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpvZX0pXSxiaT1bbmV3IHRpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6b2V9KV0sdmk9W25ldyB0aSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiEwLHJldHVybnM6InNlbGYiLHJldHVybnNQcmltaXRpdmU6bnVsbH0pXSxTaT1bbmV3IHRpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheTohMCxyZXR1cm5zOiJzZWxmIixyZXR1cm5zUHJpbWl0aXZlOm51bGx9KV0sQWk9bmV3IGFpKHtfX3Byb3RvX186bnVsbCxhdDpFaSxjb25jYXQ6bWksY29weVdpdGhpbjp2aSxlbnRyaWVzOm1pLGV2ZXJ5OmRpLGZpbGw6dmksZmlsdGVyOmdpLGZpbmQ6YmksZmluZEluZGV4OnBpLGZpbmRMYXN0OmJpLGZpbmRMYXN0SW5kZXg6cGksZmxhdDptaSxmbGF0TWFwOmdpLGZvckVhY2g6YmksaW5jbHVkZXM6c2ksaW5kZXhPZjpuaSxqb2luOmlpLGtleXM6cmksbGFzdEluZGV4T2Y6bmksbWFwOmdpLHBvcDp4aSxwdXNoOnlpLHJlZHVjZTpiaSxyZWR1Y2VSaWdodDpiaSxyZXZlcnNlOnZpLHNoaWZ0OnhpLHNsaWNlOm1pLHNvbWU6ZGksc29ydDpTaSxzcGxpY2U6ZmksdG9Mb2NhbGVTdHJpbmc6aWksdG9TdHJpbmc6aWksdW5zaGlmdDp5aSx2YWx1ZXM6RWl9LGhpLCEwKTtjbGFzcyBraSBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLm9iamVjdEVudGl0eT1udWxsO31kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKX1nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtsZXQgZT0hMTtmb3IobGV0IHQ9MDt0PHRoaXMuZWxlbWVudHMubGVuZ3RoO3QrKyl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzW3RdO3MmJihlfHxzIGluc3RhbmNlb2YgZWkpJiYoZT0hMCxzLmRlb3B0aW1pemVQYXRoKFgpKTt9dGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9Z2V0T2JqZWN0RW50aXR5KCl7aWYobnVsbCE9PXRoaXMub2JqZWN0RW50aXR5KXJldHVybiB0aGlzLm9iamVjdEVudGl0eTtjb25zdCBlPVt7a2V5OiJsZW5ndGgiLGtpbmQ6ImluaXQiLHByb3BlcnR5OmxzfV07bGV0IHQ9ITE7Zm9yKGxldCBzPTA7czx0aGlzLmVsZW1lbnRzLmxlbmd0aDtzKyspe2NvbnN0IGk9dGhpcy5lbGVtZW50c1tzXTt0fHxpIGluc3RhbmNlb2YgZWk/aSYmKHQ9ITAsZS51bnNoaWZ0KHtrZXk6SCxraW5kOiJpbml0Iixwcm9wZXJ0eTppfSkpOmk/ZS5wdXNoKHtrZXk6U3RyaW5nKHMpLGtpbmQ6ImluaXQiLHByb3BlcnR5Oml9KTplLnB1c2goe2tleTpTdHJpbmcocyksa2luZDoiaW5pdCIscHJvcGVydHk6bnN9KTt9cmV0dXJuIHRoaXMub2JqZWN0RW50aXR5PW5ldyBhaShlLEFpKX19Y2xhc3MgSWkgZXh0ZW5kcyBKc3thZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpe2Zvcihjb25zdCBzIG9mIHRoaXMuZWxlbWVudHMpcz8uYWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KTt9ZGVjbGFyZShlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIHRoaXMuZWxlbWVudHMpbnVsbCE9PXMmJnQucHVzaCguLi5zLmRlY2xhcmUoZSxvZSkpO3JldHVybiB0fWRlb3B0aW1pemVQYXRoKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5lbGVtZW50cyllPy5kZW9wdGltaXplUGF0aChZKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2Zvcihjb25zdCBlIG9mIHRoaXMuZWxlbWVudHMpaWYoZT8uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSx0LHMpKXJldHVybiAhMDtyZXR1cm4gITF9bWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpe2Zvcihjb25zdCBlIG9mIHRoaXMuZWxlbWVudHMpZT8ubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO319Y2xhc3Mgd2kgZXh0ZW5kcyBkZXtjb25zdHJ1Y3RvcihlLHQscyxpKXtzdXBlcihlKSx0aGlzLmluaXQ9cyx0aGlzLmNhbGxlZEZyb21UcnlTdGF0ZW1lbnQ9ITEsdGhpcy5hZGRpdGlvbmFsSW5pdGlhbGl6ZXJzPW51bGwsdGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1bXSx0aGlzLmRlY2xhcmF0aW9ucz10P1t0XTpbXSx0aGlzLmRlb3B0aW1pemF0aW9uVHJhY2tlcj1pLmRlb3B0aW1pemF0aW9uVHJhY2tlcix0aGlzLm1vZHVsZT1pLm1vZHVsZTt9YWRkRGVjbGFyYXRpb24oZSx0KXt0aGlzLmRlY2xhcmF0aW9ucy5wdXNoKGUpLHRoaXMubWFya0luaXRpYWxpemVyc0ZvckRlb3B0aW1pemF0aW9uKCkucHVzaCh0KTt9Y29uc29saWRhdGVJbml0aWFsaXplcnMoKXtpZih0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnMpe2Zvcihjb25zdCBlIG9mIHRoaXMuYWRkaXRpb25hbEluaXRpYWxpemVycyllLmRlb3B0aW1pemVQYXRoKFgpO3RoaXMuYWRkaXRpb25hbEluaXRpYWxpemVycz1udWxsO319ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMuaXNSZWFzc2lnbmVkP2xlKGUpOnMud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgodCx0aGlzLmluaXQsKCgpPT50aGlzLmluaXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKSx2b2lkIDApO31kZW9wdGltaXplUGF0aChlKXtpZighdGhpcy5pc1JlYXNzaWduZWQmJiF0aGlzLmRlb3B0aW1pemF0aW9uVHJhY2tlci50cmFja0VudGl0eUF0UGF0aEFuZEdldElmVHJhY2tlZChlLHRoaXMpKWlmKDA9PT1lLmxlbmd0aCl7aWYoIXRoaXMuaXNSZWFzc2lnbmVkKXt0aGlzLmlzUmVhc3NpZ25lZD0hMDtjb25zdCBlPXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ7dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1nZTtmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7dGhpcy5pbml0LmRlb3B0aW1pemVQYXRoKFgpO319ZWxzZSB0aGlzLmluaXQuZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuaXNSZWFzc2lnbmVkP2llOnQud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgoZSx0aGlzLmluaXQsKCgpPT4odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKHMpLHRoaXMuaW5pdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpKSksaWUpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiB0aGlzLmlzUmVhc3NpZ25lZD9hZTpzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsdGhpcy5pbml0LCgoKT0+KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSx0aGlzLmluaXQuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSkpKSxhZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N3aXRjaCh0LnR5cGUpe2Nhc2UgMDpyZXR1cm4gISF0aGlzLmlzUmVhc3NpZ25lZHx8IXMuYWNjZXNzZWQudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSYmdGhpcy5pbml0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTtjYXNlIDE6cmV0dXJuICEhdGhpcy5pbmNsdWRlZHx8MCE9PWUubGVuZ3RoJiYoISF0aGlzLmlzUmVhc3NpZ25lZHx8IXMuYXNzaWduZWQudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSYmdGhpcy5pbml0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKSk7Y2FzZSAyOnJldHVybiAhIXRoaXMuaXNSZWFzc2lnbmVkfHwhKHQud2l0aE5ldz9zLmluc3RhbnRpYXRlZDpzLmNhbGxlZCkudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0LmFyZ3MsdGhpcykmJnRoaXMuaW5pdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9fWluY2x1ZGUoKXtpZighdGhpcy5pbmNsdWRlZCl7dGhpcy5pbmNsdWRlZD0hMDtmb3IoY29uc3QgZSBvZiB0aGlzLmRlY2xhcmF0aW9ucyl7ZS5pbmNsdWRlZHx8ZS5pbmNsdWRlKHRzKCksITEpO2xldCB0PWUucGFyZW50O2Zvcig7IXQuaW5jbHVkZWQmJih0LmluY2x1ZGVkPSEwLHQudHlwZSE9PUxzKTspdD10LnBhcmVudDt9fX1pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe2lmKHRoaXMuaXNSZWFzc2lnbmVkfHxlLmluY2x1ZGVkQ2FsbEFyZ3VtZW50cy5oYXModGhpcy5pbml0KSlmb3IoY29uc3QgcyBvZiB0KXMuaW5jbHVkZShlLCExKTtlbHNlIGUuaW5jbHVkZWRDYWxsQXJndW1lbnRzLmFkZCh0aGlzLmluaXQpLHRoaXMuaW5pdC5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpLGUuaW5jbHVkZWRDYWxsQXJndW1lbnRzLmRlbGV0ZSh0aGlzLmluaXQpO31tYXJrQ2FsbGVkRnJvbVRyeVN0YXRlbWVudCgpe3RoaXMuY2FsbGVkRnJvbVRyeVN0YXRlbWVudD0hMDt9bWFya0luaXRpYWxpemVyc0ZvckRlb3B0aW1pemF0aW9uKCl7cmV0dXJuIG51bGw9PT10aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnMmJih0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnM9W3RoaXMuaW5pdF0sdGhpcy5pbml0PW9lLHRoaXMuaXNSZWFzc2lnbmVkPSEwKSx0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnN9bWVyZ2VEZWNsYXJhdGlvbnMoZSl7Y29uc3R7ZGVjbGFyYXRpb25zOnR9PXRoaXM7Zm9yKGNvbnN0IHMgb2YgZS5kZWNsYXJhdGlvbnMpdC5wdXNoKHMpO2NvbnN0IHM9dGhpcy5tYXJrSW5pdGlhbGl6ZXJzRm9yRGVvcHRpbWl6YXRpb24oKTtpZihzLnB1c2goZS5pbml0KSxlLmFkZGl0aW9uYWxJbml0aWFsaXplcnMpZm9yKGNvbnN0IHQgb2YgZS5hZGRpdGlvbmFsSW5pdGlhbGl6ZXJzKXMucHVzaCh0KTt9fWNvbnN0IFBpPWdlLENpPW5ldyBTZXQoW1ddKSwkaT1uZXcgZWUsTmk9bmV3IFNldChbb2VdKTtjbGFzcyBfaSBleHRlbmRzIHdpe2NvbnN0cnVjdG9yKGUsdCxzKXtzdXBlcihlLHQsb2UscyksdGhpcy5kZW9wdGltaXphdGlvbkludGVyYWN0aW9ucz1bXSx0aGlzLmRlb3B0aW1pemF0aW9ucz1uZXcgZWUsdGhpcy5kZW9wdGltaXplZEZpZWxkcz1uZXcgU2V0LHRoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQ9bmV3IFNldDt9YWRkRW50aXR5VG9CZURlb3B0aW1pemVkKGUpe2lmKGU9PT1vZSl7aWYoIXRoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQuaGFzKG9lKSl7dGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZC5hZGQob2UpO2Zvcihjb25zdHtpbnRlcmFjdGlvbjplfW9mIHRoaXMuZGVvcHRpbWl6YXRpb25JbnRlcmFjdGlvbnMpbGUoZSk7dGhpcy5kZW9wdGltaXphdGlvbkludGVyYWN0aW9ucz1QaTt9fWVsc2UgaWYodGhpcy5kZW9wdGltaXplZEZpZWxkcy5oYXMoVykpZS5kZW9wdGltaXplUGF0aChYKTtlbHNlIGlmKCF0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkLmhhcyhlKSl7dGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZC5hZGQoZSk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5kZW9wdGltaXplZEZpZWxkcyllLmRlb3B0aW1pemVQYXRoKFt0XSk7Zm9yKGNvbnN0e2ludGVyYWN0aW9uOnQscGF0aDpzfW9mIHRoaXMuZGVvcHRpbWl6YXRpb25JbnRlcmFjdGlvbnMpZS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCh0LHMsdGUpO319ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0KXtpZih0Lmxlbmd0aD49Mnx8dGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZC5oYXMob2UpfHx0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zLmxlbmd0aD49MjB8fDE9PT10Lmxlbmd0aCYmKHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHMuaGFzKFcpfHwyPT09ZS50eXBlJiZ0aGlzLmRlb3B0aW1pemVkRmllbGRzLmhhcyh0WzBdKSkpbGUoZSk7ZWxzZSBpZighdGhpcy5kZW9wdGltaXphdGlvbnMudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQodCxlLmFyZ3MpKXtmb3IoY29uc3QgcyBvZiB0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkKXMuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHRlKTt0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkLmhhcyhvZSl8fHRoaXMuZGVvcHRpbWl6YXRpb25JbnRlcmFjdGlvbnMucHVzaCh7aW50ZXJhY3Rpb246ZSxwYXRoOnR9KTt9fWRlb3B0aW1pemVQYXRoKGUpe2lmKDA9PT1lLmxlbmd0aHx8dGhpcy5kZW9wdGltaXplZEZpZWxkcy5oYXMoVykpcmV0dXJuO2NvbnN0IHQ9ZVswXTtpZighdGhpcy5kZW9wdGltaXplZEZpZWxkcy5oYXModCkpe3RoaXMuZGVvcHRpbWl6ZWRGaWVsZHMuYWRkKHQpO2Zvcihjb25zdCB0IG9mIHRoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQpdC5kZW9wdGltaXplUGF0aChlKTt0PT09VyYmKHRoaXMuZGVvcHRpbWl6YXRpb25JbnRlcmFjdGlvbnM9UGksdGhpcy5kZW9wdGltaXphdGlvbnM9JGksdGhpcy5kZW9wdGltaXplZEZpZWxkcz1DaSx0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkPU5pKTt9fWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUpe3JldHVybiAwPT09ZS5sZW5ndGg/dGhpcy5kZW9wdGltaXplUGF0aChYKTp0aGlzLmRlb3B0aW1pemVkRmllbGRzLmhhcyhlWzBdKXx8dGhpcy5kZW9wdGltaXplUGF0aChbZVswXV0pLGFlfX1jb25zdCBSaT0iMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpfJCIsTWk9NjQ7ZnVuY3Rpb24gT2koZSl7bGV0IHQ9IiI7ZG97Y29uc3Qgcz1lJU1pO2U9ZS9NaXwwLHQ9Umlbc10rdDt9d2hpbGUoMCE9PWUpO3JldHVybiB0fWZ1bmN0aW9uIERpKGUsdCxzKXtsZXQgaT1lLG49MTtmb3IoO3QuaGFzKGkpfHx4ZS5oYXMoaSl8fHM/LmhhcyhpKTspaT1gJHtlfSQke09pKG4rKyl9YDtyZXR1cm4gdC5hZGQoaSksaX1sZXQgTGk9Y2xhc3N7Y29uc3RydWN0b3IoKXt0aGlzLmNoaWxkcmVuPVtdLHRoaXMudmFyaWFibGVzPW5ldyBNYXA7fWFkZERlY2xhcmF0aW9uKGUsdCxzLGkpe2NvbnN0IG49ZS5uYW1lO2xldCByPXRoaXMudmFyaWFibGVzLmdldChuKTtyZXR1cm4gcj9yLmFkZERlY2xhcmF0aW9uKGUscyk6KHI9bmV3IHdpKGUubmFtZSxlLHN8fG5zLHQpLHRoaXMudmFyaWFibGVzLnNldChuLHIpKSxyfWNvbnRhaW5zKGUpe3JldHVybiB0aGlzLnZhcmlhYmxlcy5oYXMoZSl9ZmluZFZhcmlhYmxlKGUpe3Rocm93IG5ldyBFcnJvcigiSW50ZXJuYWwgRXJyb3I6IGZpbmRWYXJpYWJsZSBuZWVkcyB0byBiZSBpbXBsZW1lbnRlZCBieSBhIHN1YmNsYXNzIil9fTtjbGFzcyBUaSBleHRlbmRzIExpe2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksdGhpcy5hY2Nlc3NlZE91dHNpZGVWYXJpYWJsZXM9bmV3IE1hcCx0aGlzLnBhcmVudD1lLGUuY2hpbGRyZW4ucHVzaCh0aGlzKTt9YWRkQWNjZXNzZWREeW5hbWljSW1wb3J0KGUpeyh0aGlzLmFjY2Vzc2VkRHluYW1pY0ltcG9ydHN8fCh0aGlzLmFjY2Vzc2VkRHluYW1pY0ltcG9ydHM9bmV3IFNldCkpLmFkZChlKSx0aGlzLnBhcmVudCBpbnN0YW5jZW9mIFRpJiZ0aGlzLnBhcmVudC5hZGRBY2Nlc3NlZER5bmFtaWNJbXBvcnQoZSk7fWFkZEFjY2Vzc2VkR2xvYmFscyhlLHQpe2NvbnN0IHM9dC5nZXQodGhpcyl8fG5ldyBTZXQ7Zm9yKGNvbnN0IHQgb2YgZSlzLmFkZCh0KTt0LnNldCh0aGlzLHMpLHRoaXMucGFyZW50IGluc3RhbmNlb2YgVGkmJnRoaXMucGFyZW50LmFkZEFjY2Vzc2VkR2xvYmFscyhlLHQpO31hZGROYW1lc3BhY2VNZW1iZXJBY2Nlc3MoZSx0KXt0aGlzLmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy5zZXQoZSx0KSx0aGlzLnBhcmVudC5hZGROYW1lc3BhY2VNZW1iZXJBY2Nlc3MoZSx0KTt9YWRkUmV0dXJuRXhwcmVzc2lvbihlKXt0aGlzLnBhcmVudCBpbnN0YW5jZW9mIFRpJiZ0aGlzLnBhcmVudC5hZGRSZXR1cm5FeHByZXNzaW9uKGUpO31hZGRVc2VkT3V0c2lkZU5hbWVzKGUsdCxzLGkpe2Zvcihjb25zdCBpIG9mIHRoaXMuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLnZhbHVlcygpKWkuaW5jbHVkZWQmJihlLmFkZChpLmdldEJhc2VWYXJpYWJsZU5hbWUoKSksInN5c3RlbSI9PT10JiZzLmhhcyhpKSYmZS5hZGQoImV4cG9ydHMiKSk7Y29uc3Qgbj1pLmdldCh0aGlzKTtpZihuKWZvcihjb25zdCB0IG9mIG4pZS5hZGQodCk7fWNvbnRhaW5zKGUpe3JldHVybiB0aGlzLnZhcmlhYmxlcy5oYXMoZSl8fHRoaXMucGFyZW50LmNvbnRhaW5zKGUpfWRlY29uZmxpY3QoZSx0LHMpe2NvbnN0IGk9bmV3IFNldDtpZih0aGlzLmFkZFVzZWRPdXRzaWRlTmFtZXMoaSxlLHQscyksdGhpcy5hY2Nlc3NlZER5bmFtaWNJbXBvcnRzKWZvcihjb25zdCBlIG9mIHRoaXMuYWNjZXNzZWREeW5hbWljSW1wb3J0cyllLmlubGluZU5hbWVzcGFjZSYmaS5hZGQoZS5pbmxpbmVOYW1lc3BhY2UuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpKTtmb3IoY29uc3RbZSx0XW9mIHRoaXMudmFyaWFibGVzKSh0LmluY2x1ZGVkfHx0LmFsd2F5c1JlbmRlcmVkKSYmdC5zZXRSZW5kZXJOYW1lcyhudWxsLERpKGUsaSx0LmZvcmJpZGRlbk5hbWVzKSk7Zm9yKGNvbnN0IGkgb2YgdGhpcy5jaGlsZHJlbilpLmRlY29uZmxpY3QoZSx0LHMpO31maW5kTGV4aWNhbEJvdW5kYXJ5KCl7cmV0dXJuIHRoaXMucGFyZW50LmZpbmRMZXhpY2FsQm91bmRhcnkoKX1maW5kVmFyaWFibGUoZSl7Y29uc3QgdD10aGlzLnZhcmlhYmxlcy5nZXQoZSl8fHRoaXMuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLmdldChlKTtpZih0KXJldHVybiB0O2NvbnN0IHM9dGhpcy5wYXJlbnQuZmluZFZhcmlhYmxlKGUpO3JldHVybiB0aGlzLmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy5zZXQoZSxzKSxzfX1jbGFzcyBWaSBleHRlbmRzIFRpe2NvbnN0cnVjdG9yKGUsdCl7c3VwZXIoZSksdGhpcy5wYXJhbWV0ZXJzPVtdLHRoaXMuaGFzUmVzdD0hMSx0aGlzLmNvbnRleHQ9dCx0aGlzLmhvaXN0ZWRCb2R5VmFyU2NvcGU9bmV3IFRpKHRoaXMpO31hZGRQYXJhbWV0ZXJEZWNsYXJhdGlvbihlKXtjb25zdHtuYW1lOnR9PWUscz1uZXcgX2kodCxlLHRoaXMuY29udGV4dCksaT10aGlzLmhvaXN0ZWRCb2R5VmFyU2NvcGUudmFyaWFibGVzLmdldCh0KTtyZXR1cm4gaSYmKHRoaXMuaG9pc3RlZEJvZHlWYXJTY29wZS52YXJpYWJsZXMuc2V0KHQscykscy5tZXJnZURlY2xhcmF0aW9ucyhpKSksdGhpcy52YXJpYWJsZXMuc2V0KHQscyksc31hZGRQYXJhbWV0ZXJWYXJpYWJsZXMoZSx0KXt0aGlzLnBhcmFtZXRlcnM9ZTtmb3IoY29uc3QgdCBvZiBlKWZvcihjb25zdCBlIG9mIHQpZS5hbHdheXNSZW5kZXJlZD0hMDt0aGlzLmhhc1Jlc3Q9dDt9aW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KXtsZXQgcz0hMSxpPSExO2NvbnN0IG49dGhpcy5oYXNSZXN0JiZ0aGlzLnBhcmFtZXRlcnNbdGhpcy5wYXJhbWV0ZXJzLmxlbmd0aC0xXTtmb3IoY29uc3QgcyBvZiB0KWlmKHMgaW5zdGFuY2VvZiBlaSl7Zm9yKGNvbnN0IHMgb2YgdClzLmluY2x1ZGUoZSwhMSk7YnJlYWt9Zm9yKGxldCByPXQubGVuZ3RoLTE7cj49MDtyLS0pe2NvbnN0IG89dGhpcy5wYXJhbWV0ZXJzW3JdfHxuLGE9dFtyXTtpZihvKWlmKHM9ITEsMD09PW8ubGVuZ3RoKWk9ITA7ZWxzZSBmb3IoY29uc3QgZSBvZiBvKWUuaW5jbHVkZWQmJihpPSEwKSxlLmNhbGxlZEZyb21UcnlTdGF0ZW1lbnQmJihzPSEwKTshaSYmYS5zaG91bGRCZUluY2x1ZGVkKGUpJiYoaT0hMCksaSYmYS5pbmNsdWRlKGUscyk7fX19Y2xhc3MgQmkgZXh0ZW5kcyBWaXtjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5yZXR1cm5FeHByZXNzaW9uPW51bGwsdGhpcy5yZXR1cm5FeHByZXNzaW9ucz1bXTt9YWRkUmV0dXJuRXhwcmVzc2lvbihlKXt0aGlzLnJldHVybkV4cHJlc3Npb25zLnB1c2goZSk7fWdldFJldHVybkV4cHJlc3Npb24oKXtyZXR1cm4gbnVsbD09PXRoaXMucmV0dXJuRXhwcmVzc2lvbiYmdGhpcy51cGRhdGVSZXR1cm5FeHByZXNzaW9uKCksdGhpcy5yZXR1cm5FeHByZXNzaW9ufXVwZGF0ZVJldHVybkV4cHJlc3Npb24oKXtpZigxPT09dGhpcy5yZXR1cm5FeHByZXNzaW9ucy5sZW5ndGgpdGhpcy5yZXR1cm5FeHByZXNzaW9uPXRoaXMucmV0dXJuRXhwcmVzc2lvbnNbMF07ZWxzZSB7dGhpcy5yZXR1cm5FeHByZXNzaW9uPW9lO2Zvcihjb25zdCBlIG9mIHRoaXMucmV0dXJuRXhwcmVzc2lvbnMpZS5kZW9wdGltaXplUGF0aChYKTt9fX1mdW5jdGlvbiB6aShlLHQpe2lmKCJNZW1iZXJFeHByZXNzaW9uIj09PWUudHlwZSlyZXR1cm4gIWUuY29tcHV0ZWQmJnppKGUub2JqZWN0LGUpO2lmKCJJZGVudGlmaWVyIj09PWUudHlwZSl7aWYoIXQpcmV0dXJuICEwO3N3aXRjaCh0LnR5cGUpe2Nhc2UiTWVtYmVyRXhwcmVzc2lvbiI6cmV0dXJuIHQuY29tcHV0ZWR8fGU9PT10Lm9iamVjdDtjYXNlIk1ldGhvZERlZmluaXRpb24iOnJldHVybiB0LmNvbXB1dGVkO2Nhc2UiUHJvcGVydHlEZWZpbml0aW9uIjpjYXNlIlByb3BlcnR5IjpyZXR1cm4gdC5jb21wdXRlZHx8ZT09PXQudmFsdWU7Y2FzZSJFeHBvcnRTcGVjaWZpZXIiOmNhc2UiSW1wb3J0U3BlY2lmaWVyIjpyZXR1cm4gZT09PXQubG9jYWw7Y2FzZSJMYWJlbGVkU3RhdGVtZW50IjpjYXNlIkJyZWFrU3RhdGVtZW50IjpjYXNlIkNvbnRpbnVlU3RhdGVtZW50IjpyZXR1cm4gITE7ZGVmYXVsdDpyZXR1cm4gITB9fXJldHVybiAhMX1jb25zdCBGaT1TeW1ib2woIlB1cmVGdW5jdGlvbiIpLGppPSgpPT57fSxVaT1TeW1ib2woIlZhbHVlIFByb3BlcnRpZXMiKSxHaT0oKT0+bmUsV2k9KCk9PiExLHFpPSgpPT4hMCxIaT17ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpqaSxnZXRMaXRlcmFsVmFsdWU6R2ksaGFzRWZmZWN0c1doZW5DYWxsZWQ6V2l9LEtpPXtkZW9wdGltaXplQXJndW1lbnRzT25DYWxsOmppLGdldExpdGVyYWxWYWx1ZTpHaSxoYXNFZmZlY3RzV2hlbkNhbGxlZDpxaX0sWWk9e19fcHJvdG9fXzpudWxsLFtVaV06S2l9LFhpPXtfX3Byb3RvX186bnVsbCxbVWldOkhpfSxRaT17X19wcm90b19fOm51bGwsW1VpXTp7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpqaSxnZXRMaXRlcmFsVmFsdWU6R2ksaGFzRWZmZWN0c1doZW5DYWxsZWQoe2FyZ3M6ZX0sdCl7Y29uc3RbcyxpXT1lO3JldHVybiAhKGkgaW5zdGFuY2VvZiByZSl8fGkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWCxjZSx0KX19fSxaaT17X19wcm90b19fOm51bGwsW1VpXTp7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbCh7YXJnczpbLGVdfSl7ZT8uZGVvcHRpbWl6ZVBhdGgoWCk7fSxnZXRMaXRlcmFsVmFsdWU6R2ksaGFzRWZmZWN0c1doZW5DYWxsZWQ6KHthcmdzOmV9LHQpPT5lLmxlbmd0aDw9MXx8ZVsxXS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChRLGhlLHQpfX0sSmk9e19fcHJvdG9fXzpudWxsLFtVaV06S2kscHJvdG90eXBlOllpfSxlbj17X19wcm90b19fOm51bGwsW1VpXTpIaSxwcm90b3R5cGU6WWl9LHRuPXtfX3Byb3RvX186bnVsbCxbVWldOntkZW9wdGltaXplQXJndW1lbnRzT25DYWxsOmppLGdldExpdGVyYWxWYWx1ZTpHaSxoYXNFZmZlY3RzV2hlbkNhbGxlZDooe2FyZ3M6ZX0pPT5lLmxlbmd0aD4xJiYhKGVbMV1pbnN0YW5jZW9mIGtpKX0scHJvdG90eXBlOllpfSxzbj17X19wcm90b19fOm51bGwsW1VpXTpIaSxmcm9tOllpLG9mOlhpLHByb3RvdHlwZTpZaX0sbm49e19fcHJvdG9fXzpudWxsLFtVaV06SGksc3VwcG9ydGVkTG9jYWxlc09mOmVufSxybj17Z2xvYmFsOllpLGdsb2JhbFRoaXM6WWksc2VsZjpZaSx3aW5kb3c6WWksX19wcm90b19fOm51bGwsW1VpXTpLaSxBcnJheTp7X19wcm90b19fOm51bGwsW1VpXTpLaSxmcm9tOllpLGlzQXJyYXk6WGksb2Y6WGkscHJvdG90eXBlOllpfSxBcnJheUJ1ZmZlcjp7X19wcm90b19fOm51bGwsW1VpXTpIaSxpc1ZpZXc6WGkscHJvdG90eXBlOllpfSxBdG9taWNzOllpLEJpZ0ludDpKaSxCaWdJbnQ2NEFycmF5OkppLEJpZ1VpbnQ2NEFycmF5OkppLEJvb2xlYW46ZW4sY29uc3RydWN0b3I6SmksRGF0YVZpZXc6ZW4sRGF0ZTp7X19wcm90b19fOm51bGwsW1VpXTpIaSxub3c6WGkscGFyc2U6WGkscHJvdG90eXBlOllpLFVUQzpYaX0sZGVjb2RlVVJJOlhpLGRlY29kZVVSSUNvbXBvbmVudDpYaSxlbmNvZGVVUkk6WGksZW5jb2RlVVJJQ29tcG9uZW50OlhpLEVycm9yOmVuLGVzY2FwZTpYaSxldmFsOllpLEV2YWxFcnJvcjplbixGbG9hdDMyQXJyYXk6c24sRmxvYXQ2NEFycmF5OnNuLEZ1bmN0aW9uOkppLGhhc093blByb3BlcnR5OllpLEluZmluaXR5OllpLEludDE2QXJyYXk6c24sSW50MzJBcnJheTpzbixJbnQ4QXJyYXk6c24saXNGaW5pdGU6WGksaXNOYU46WGksaXNQcm90b3R5cGVPZjpZaSxKU09OOllpLE1hcDp0bixNYXRoOntfX3Byb3RvX186bnVsbCxbVWldOktpLGFiczpYaSxhY29zOlhpLGFjb3NoOlhpLGFzaW46WGksYXNpbmg6WGksYXRhbjpYaSxhdGFuMjpYaSxhdGFuaDpYaSxjYnJ0OlhpLGNlaWw6WGksY2x6MzI6WGksY29zOlhpLGNvc2g6WGksZXhwOlhpLGV4cG0xOlhpLGZsb29yOlhpLGZyb3VuZDpYaSxoeXBvdDpYaSxpbXVsOlhpLGxvZzpYaSxsb2cxMDpYaSxsb2cxcDpYaSxsb2cyOlhpLG1heDpYaSxtaW46WGkscG93OlhpLHJhbmRvbTpYaSxyb3VuZDpYaSxzaWduOlhpLHNpbjpYaSxzaW5oOlhpLHNxcnQ6WGksdGFuOlhpLHRhbmg6WGksdHJ1bmM6WGl9LE5hTjpZaSxOdW1iZXI6e19fcHJvdG9fXzpudWxsLFtVaV06SGksaXNGaW5pdGU6WGksaXNJbnRlZ2VyOlhpLGlzTmFOOlhpLGlzU2FmZUludGVnZXI6WGkscGFyc2VGbG9hdDpYaSxwYXJzZUludDpYaSxwcm90b3R5cGU6WWl9LE9iamVjdDp7X19wcm90b19fOm51bGwsW1VpXTpIaSxjcmVhdGU6WGksZGVmaW5lUHJvcGVydHk6WmksZGVmaW5lUHJvcGVydGllczpaaSxmcmVlemU6WmksZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOlhpLGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6WGksZ2V0T3duUHJvcGVydHlOYW1lczpYaSxnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6WGksZ2V0UHJvdG90eXBlT2Y6WGksaGFzT3duOlhpLGlzOlhpLGlzRXh0ZW5zaWJsZTpYaSxpc0Zyb3plbjpYaSxpc1NlYWxlZDpYaSxrZXlzOlhpLGZyb21FbnRyaWVzOllpLGVudHJpZXM6UWksdmFsdWVzOlFpLHByb3RvdHlwZTpZaX0scGFyc2VGbG9hdDpYaSxwYXJzZUludDpYaSxQcm9taXNlOntfX3Byb3RvX186bnVsbCxbVWldOktpLGFsbDpZaSxhbGxTZXR0bGVkOllpLGFueTpZaSxwcm90b3R5cGU6WWkscmFjZTpZaSxyZWplY3Q6WWkscmVzb2x2ZTpZaX0scHJvcGVydHlJc0VudW1lcmFibGU6WWksUHJveHk6WWksUmFuZ2VFcnJvcjplbixSZWZlcmVuY2VFcnJvcjplbixSZWZsZWN0OllpLFJlZ0V4cDplbixTZXQ6dG4sU2hhcmVkQXJyYXlCdWZmZXI6SmksU3RyaW5nOntfX3Byb3RvX186bnVsbCxbVWldOkhpLGZyb21DaGFyQ29kZTpYaSxmcm9tQ29kZVBvaW50OlhpLHByb3RvdHlwZTpZaSxyYXc6WGl9LFN5bWJvbDp7X19wcm90b19fOm51bGwsW1VpXTpIaSxmb3I6WGksa2V5Rm9yOlhpLHByb3RvdHlwZTpZaSx0b1N0cmluZ1RhZzp7X19wcm90b19fOm51bGwsW1VpXTp7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpqaSxnZXRMaXRlcmFsVmFsdWU6KCk9PkssaGFzRWZmZWN0c1doZW5DYWxsZWQ6cWl9fX0sU3ludGF4RXJyb3I6ZW4sdG9Mb2NhbGVTdHJpbmc6WWksdG9TdHJpbmc6WWksVHlwZUVycm9yOmVuLFVpbnQxNkFycmF5OnNuLFVpbnQzMkFycmF5OnNuLFVpbnQ4QXJyYXk6c24sVWludDhDbGFtcGVkQXJyYXk6c24sdW5lc2NhcGU6WGksVVJJRXJyb3I6ZW4sdmFsdWVPZjpZaSxXZWFrTWFwOnRuLFdlYWtTZXQ6dG4sY2xlYXJJbnRlcnZhbDpKaSxjbGVhclRpbWVvdXQ6SmksY29uc29sZTp7X19wcm90b19fOm51bGwsW1VpXTpLaSxhc3NlcnQ6SmksY2xlYXI6SmksY291bnQ6SmksY291bnRSZXNldDpKaSxkZWJ1ZzpKaSxkaXI6SmksZGlyeG1sOkppLGVycm9yOkppLGV4Y2VwdGlvbjpKaSxncm91cDpKaSxncm91cENvbGxhcHNlZDpKaSxncm91cEVuZDpKaSxpbmZvOkppLGxvZzpKaSx0YWJsZTpKaSx0aW1lOkppLHRpbWVFbmQ6SmksdGltZUxvZzpKaSx0cmFjZTpKaSx3YXJuOkppfSxJbnRsOntfX3Byb3RvX186bnVsbCxbVWldOktpLENvbGxhdG9yOm5uLERhdGVUaW1lRm9ybWF0Om5uLERpc3BsYXlOYW1lczpubixMaXN0Rm9ybWF0Om5uLExvY2FsZTpubixOdW1iZXJGb3JtYXQ6bm4sUGx1cmFsUnVsZXM6bm4sUmVsYXRpdmVUaW1lRm9ybWF0Om5uLFNlZ21lbnRlcjpubn0sc2V0SW50ZXJ2YWw6Smksc2V0VGltZW91dDpKaSxUZXh0RGVjb2RlcjpKaSxUZXh0RW5jb2RlcjpKaSxVUkw6e19fcHJvdG9fXzpudWxsLFtVaV06S2kscHJvdG90eXBlOllpLGNhblBhcnNlOlhpfSxVUkxTZWFyY2hQYXJhbXM6SmksQWJvcnRDb250cm9sbGVyOkppLEFib3J0U2lnbmFsOkppLGFkZEV2ZW50TGlzdGVuZXI6WWksYWxlcnQ6WWksQW5hbHlzZXJOb2RlOkppLEFuaW1hdGlvbjpKaSxBbmltYXRpb25FdmVudDpKaSxhcHBsaWNhdGlvbkNhY2hlOllpLEFwcGxpY2F0aW9uQ2FjaGU6SmksQXBwbGljYXRpb25DYWNoZUVycm9yRXZlbnQ6SmksYXRvYjpZaSxBdHRyOkppLEF1ZGlvOkppLEF1ZGlvQnVmZmVyOkppLEF1ZGlvQnVmZmVyU291cmNlTm9kZTpKaSxBdWRpb0NvbnRleHQ6SmksQXVkaW9EZXN0aW5hdGlvbk5vZGU6SmksQXVkaW9MaXN0ZW5lcjpKaSxBdWRpb05vZGU6SmksQXVkaW9QYXJhbTpKaSxBdWRpb1Byb2Nlc3NpbmdFdmVudDpKaSxBdWRpb1NjaGVkdWxlZFNvdXJjZU5vZGU6SmksQXVkaW9Xb3JrbGV0Tm9kZTpKaSxCYXJQcm9wOkppLEJhc2VBdWRpb0NvbnRleHQ6SmksQmF0dGVyeU1hbmFnZXI6SmksQmVmb3JlVW5sb2FkRXZlbnQ6SmksQmlxdWFkRmlsdGVyTm9kZTpKaSxCbG9iOkppLEJsb2JFdmVudDpKaSxibHVyOllpLEJyb2FkY2FzdENoYW5uZWw6SmksYnRvYTpZaSxCeXRlTGVuZ3RoUXVldWluZ1N0cmF0ZWd5OkppLENhY2hlOkppLGNhY2hlczpZaSxDYWNoZVN0b3JhZ2U6SmksY2FuY2VsQW5pbWF0aW9uRnJhbWU6WWksY2FuY2VsSWRsZUNhbGxiYWNrOllpLENhbnZhc0NhcHR1cmVNZWRpYVN0cmVhbVRyYWNrOkppLENhbnZhc0dyYWRpZW50OkppLENhbnZhc1BhdHRlcm46SmksQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEOkppLENoYW5uZWxNZXJnZXJOb2RlOkppLENoYW5uZWxTcGxpdHRlck5vZGU6SmksQ2hhcmFjdGVyRGF0YTpKaSxjbGllbnRJbmZvcm1hdGlvbjpZaSxDbGlwYm9hcmRFdmVudDpKaSxjbG9zZTpZaSxjbG9zZWQ6WWksQ2xvc2VFdmVudDpKaSxDb21tZW50OkppLENvbXBvc2l0aW9uRXZlbnQ6SmksY29uZmlybTpZaSxDb25zdGFudFNvdXJjZU5vZGU6SmksQ29udm9sdmVyTm9kZTpKaSxDb3VudFF1ZXVpbmdTdHJhdGVneTpKaSxjcmVhdGVJbWFnZUJpdG1hcDpZaSxDcmVkZW50aWFsOkppLENyZWRlbnRpYWxzQ29udGFpbmVyOkppLGNyeXB0bzpZaSxDcnlwdG86SmksQ3J5cHRvS2V5OkppLENTUzpKaSxDU1NDb25kaXRpb25SdWxlOkppLENTU0ZvbnRGYWNlUnVsZTpKaSxDU1NHcm91cGluZ1J1bGU6SmksQ1NTSW1wb3J0UnVsZTpKaSxDU1NLZXlmcmFtZVJ1bGU6SmksQ1NTS2V5ZnJhbWVzUnVsZTpKaSxDU1NNZWRpYVJ1bGU6SmksQ1NTTmFtZXNwYWNlUnVsZTpKaSxDU1NQYWdlUnVsZTpKaSxDU1NSdWxlOkppLENTU1J1bGVMaXN0OkppLENTU1N0eWxlRGVjbGFyYXRpb246SmksQ1NTU3R5bGVSdWxlOkppLENTU1N0eWxlU2hlZXQ6SmksQ1NTU3VwcG9ydHNSdWxlOkppLEN1c3RvbUVsZW1lbnRSZWdpc3RyeTpKaSxjdXN0b21FbGVtZW50czpZaSxDdXN0b21FdmVudDp7X19wcm90b19fOm51bGwsW1VpXTp7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbCh7YXJnczplfSl7ZVsyXT8uZGVvcHRpbWl6ZVBhdGgoWyJkZXRhaWwiXSk7fSxnZXRMaXRlcmFsVmFsdWU6R2ksaGFzRWZmZWN0c1doZW5DYWxsZWQ6V2l9LHByb3RvdHlwZTpZaX0sRGF0YVRyYW5zZmVyOkppLERhdGFUcmFuc2Zlckl0ZW06SmksRGF0YVRyYW5zZmVySXRlbUxpc3Q6SmksZGVmYXVsdHN0YXR1czpZaSxkZWZhdWx0U3RhdHVzOllpLERlbGF5Tm9kZTpKaSxEZXZpY2VNb3Rpb25FdmVudDpKaSxEZXZpY2VPcmllbnRhdGlvbkV2ZW50OkppLGRldmljZVBpeGVsUmF0aW86WWksZGlzcGF0Y2hFdmVudDpZaSxkb2N1bWVudDpZaSxEb2N1bWVudDpKaSxEb2N1bWVudEZyYWdtZW50OkppLERvY3VtZW50VHlwZTpKaSxET01FcnJvcjpKaSxET01FeGNlcHRpb246SmksRE9NSW1wbGVtZW50YXRpb246SmksRE9NTWF0cml4OkppLERPTU1hdHJpeFJlYWRPbmx5OkppLERPTVBhcnNlcjpKaSxET01Qb2ludDpKaSxET01Qb2ludFJlYWRPbmx5OkppLERPTVF1YWQ6SmksRE9NUmVjdDpKaSxET01SZWN0UmVhZE9ubHk6SmksRE9NU3RyaW5nTGlzdDpKaSxET01TdHJpbmdNYXA6SmksRE9NVG9rZW5MaXN0OkppLERyYWdFdmVudDpKaSxEeW5hbWljc0NvbXByZXNzb3JOb2RlOkppLEVsZW1lbnQ6SmksRXJyb3JFdmVudDpKaSxFdmVudDpKaSxFdmVudFNvdXJjZTpKaSxFdmVudFRhcmdldDpKaSxleHRlcm5hbDpZaSxmZXRjaDpZaSxGaWxlOkppLEZpbGVMaXN0OkppLEZpbGVSZWFkZXI6SmksZmluZDpZaSxmb2N1czpZaSxGb2N1c0V2ZW50OkppLEZvbnRGYWNlOkppLEZvbnRGYWNlU2V0TG9hZEV2ZW50OkppLEZvcm1EYXRhOkppLGZyYW1lczpZaSxHYWluTm9kZTpKaSxHYW1lcGFkOkppLEdhbWVwYWRCdXR0b246SmksR2FtZXBhZEV2ZW50OkppLGdldENvbXB1dGVkU3R5bGU6WWksZ2V0U2VsZWN0aW9uOllpLEhhc2hDaGFuZ2VFdmVudDpKaSxIZWFkZXJzOkppLGhpc3Rvcnk6WWksSGlzdG9yeTpKaSxIVE1MQWxsQ29sbGVjdGlvbjpKaSxIVE1MQW5jaG9yRWxlbWVudDpKaSxIVE1MQXJlYUVsZW1lbnQ6SmksSFRNTEF1ZGlvRWxlbWVudDpKaSxIVE1MQmFzZUVsZW1lbnQ6SmksSFRNTEJvZHlFbGVtZW50OkppLEhUTUxCUkVsZW1lbnQ6SmksSFRNTEJ1dHRvbkVsZW1lbnQ6SmksSFRNTENhbnZhc0VsZW1lbnQ6SmksSFRNTENvbGxlY3Rpb246SmksSFRNTENvbnRlbnRFbGVtZW50OkppLEhUTUxEYXRhRWxlbWVudDpKaSxIVE1MRGF0YUxpc3RFbGVtZW50OkppLEhUTUxEZXRhaWxzRWxlbWVudDpKaSxIVE1MRGlhbG9nRWxlbWVudDpKaSxIVE1MRGlyZWN0b3J5RWxlbWVudDpKaSxIVE1MRGl2RWxlbWVudDpKaSxIVE1MRExpc3RFbGVtZW50OkppLEhUTUxEb2N1bWVudDpKaSxIVE1MRWxlbWVudDpKaSxIVE1MRW1iZWRFbGVtZW50OkppLEhUTUxGaWVsZFNldEVsZW1lbnQ6SmksSFRNTEZvbnRFbGVtZW50OkppLEhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uOkppLEhUTUxGb3JtRWxlbWVudDpKaSxIVE1MRnJhbWVFbGVtZW50OkppLEhUTUxGcmFtZVNldEVsZW1lbnQ6SmksSFRNTEhlYWRFbGVtZW50OkppLEhUTUxIZWFkaW5nRWxlbWVudDpKaSxIVE1MSFJFbGVtZW50OkppLEhUTUxIdG1sRWxlbWVudDpKaSxIVE1MSUZyYW1lRWxlbWVudDpKaSxIVE1MSW1hZ2VFbGVtZW50OkppLEhUTUxJbnB1dEVsZW1lbnQ6SmksSFRNTExhYmVsRWxlbWVudDpKaSxIVE1MTGVnZW5kRWxlbWVudDpKaSxIVE1MTElFbGVtZW50OkppLEhUTUxMaW5rRWxlbWVudDpKaSxIVE1MTWFwRWxlbWVudDpKaSxIVE1MTWFycXVlZUVsZW1lbnQ6SmksSFRNTE1lZGlhRWxlbWVudDpKaSxIVE1MTWVudUVsZW1lbnQ6SmksSFRNTE1ldGFFbGVtZW50OkppLEhUTUxNZXRlckVsZW1lbnQ6SmksSFRNTE1vZEVsZW1lbnQ6SmksSFRNTE9iamVjdEVsZW1lbnQ6SmksSFRNTE9MaXN0RWxlbWVudDpKaSxIVE1MT3B0R3JvdXBFbGVtZW50OkppLEhUTUxPcHRpb25FbGVtZW50OkppLEhUTUxPcHRpb25zQ29sbGVjdGlvbjpKaSxIVE1MT3V0cHV0RWxlbWVudDpKaSxIVE1MUGFyYWdyYXBoRWxlbWVudDpKaSxIVE1MUGFyYW1FbGVtZW50OkppLEhUTUxQaWN0dXJlRWxlbWVudDpKaSxIVE1MUHJlRWxlbWVudDpKaSxIVE1MUHJvZ3Jlc3NFbGVtZW50OkppLEhUTUxRdW90ZUVsZW1lbnQ6SmksSFRNTFNjcmlwdEVsZW1lbnQ6SmksSFRNTFNlbGVjdEVsZW1lbnQ6SmksSFRNTFNoYWRvd0VsZW1lbnQ6SmksSFRNTFNsb3RFbGVtZW50OkppLEhUTUxTb3VyY2VFbGVtZW50OkppLEhUTUxTcGFuRWxlbWVudDpKaSxIVE1MU3R5bGVFbGVtZW50OkppLEhUTUxUYWJsZUNhcHRpb25FbGVtZW50OkppLEhUTUxUYWJsZUNlbGxFbGVtZW50OkppLEhUTUxUYWJsZUNvbEVsZW1lbnQ6SmksSFRNTFRhYmxlRWxlbWVudDpKaSxIVE1MVGFibGVSb3dFbGVtZW50OkppLEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50OkppLEhUTUxUZW1wbGF0ZUVsZW1lbnQ6SmksSFRNTFRleHRBcmVhRWxlbWVudDpKaSxIVE1MVGltZUVsZW1lbnQ6SmksSFRNTFRpdGxlRWxlbWVudDpKaSxIVE1MVHJhY2tFbGVtZW50OkppLEhUTUxVTGlzdEVsZW1lbnQ6SmksSFRNTFVua25vd25FbGVtZW50OkppLEhUTUxWaWRlb0VsZW1lbnQ6SmksSURCQ3Vyc29yOkppLElEQkN1cnNvcldpdGhWYWx1ZTpKaSxJREJEYXRhYmFzZTpKaSxJREJGYWN0b3J5OkppLElEQkluZGV4OkppLElEQktleVJhbmdlOkppLElEQk9iamVjdFN0b3JlOkppLElEQk9wZW5EQlJlcXVlc3Q6SmksSURCUmVxdWVzdDpKaSxJREJUcmFuc2FjdGlvbjpKaSxJREJWZXJzaW9uQ2hhbmdlRXZlbnQ6SmksSWRsZURlYWRsaW5lOkppLElJUkZpbHRlck5vZGU6SmksSW1hZ2U6SmksSW1hZ2VCaXRtYXA6SmksSW1hZ2VCaXRtYXBSZW5kZXJpbmdDb250ZXh0OkppLEltYWdlQ2FwdHVyZTpKaSxJbWFnZURhdGE6SmksaW5kZXhlZERCOllpLGlubmVySGVpZ2h0OllpLGlubmVyV2lkdGg6WWksSW5wdXRFdmVudDpKaSxJbnRlcnNlY3Rpb25PYnNlcnZlcjpKaSxJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5OkppLGlzU2VjdXJlQ29udGV4dDpZaSxLZXlib2FyZEV2ZW50OkppLEtleWZyYW1lRWZmZWN0OkppLGxlbmd0aDpZaSxsb2NhbFN0b3JhZ2U6WWksbG9jYXRpb246WWksTG9jYXRpb246SmksbG9jYXRpb25iYXI6WWksbWF0Y2hNZWRpYTpZaSxNZWRpYURldmljZUluZm86SmksTWVkaWFEZXZpY2VzOkppLE1lZGlhRWxlbWVudEF1ZGlvU291cmNlTm9kZTpKaSxNZWRpYUVuY3J5cHRlZEV2ZW50OkppLE1lZGlhRXJyb3I6SmksTWVkaWFLZXlNZXNzYWdlRXZlbnQ6SmksTWVkaWFLZXlTZXNzaW9uOkppLE1lZGlhS2V5U3RhdHVzTWFwOkppLE1lZGlhS2V5U3lzdGVtQWNjZXNzOkppLE1lZGlhTGlzdDpKaSxNZWRpYVF1ZXJ5TGlzdDpKaSxNZWRpYVF1ZXJ5TGlzdEV2ZW50OkppLE1lZGlhUmVjb3JkZXI6SmksTWVkaWFTZXR0aW5nc1JhbmdlOkppLE1lZGlhU291cmNlOkppLE1lZGlhU3RyZWFtOkppLE1lZGlhU3RyZWFtQXVkaW9EZXN0aW5hdGlvbk5vZGU6SmksTWVkaWFTdHJlYW1BdWRpb1NvdXJjZU5vZGU6SmksTWVkaWFTdHJlYW1FdmVudDpKaSxNZWRpYVN0cmVhbVRyYWNrOkppLE1lZGlhU3RyZWFtVHJhY2tFdmVudDpKaSxtZW51YmFyOllpLE1lc3NhZ2VDaGFubmVsOkppLE1lc3NhZ2VFdmVudDpKaSxNZXNzYWdlUG9ydDpKaSxNSURJQWNjZXNzOkppLE1JRElDb25uZWN0aW9uRXZlbnQ6SmksTUlESUlucHV0OkppLE1JRElJbnB1dE1hcDpKaSxNSURJTWVzc2FnZUV2ZW50OkppLE1JRElPdXRwdXQ6SmksTUlESU91dHB1dE1hcDpKaSxNSURJUG9ydDpKaSxNaW1lVHlwZTpKaSxNaW1lVHlwZUFycmF5OkppLE1vdXNlRXZlbnQ6SmksbW92ZUJ5OllpLG1vdmVUbzpZaSxNdXRhdGlvbkV2ZW50OkppLE11dGF0aW9uT2JzZXJ2ZXI6SmksTXV0YXRpb25SZWNvcmQ6SmksbmFtZTpZaSxOYW1lZE5vZGVNYXA6SmksTmF2aWdhdGlvblByZWxvYWRNYW5hZ2VyOkppLG5hdmlnYXRvcjpZaSxOYXZpZ2F0b3I6SmksTmV0d29ya0luZm9ybWF0aW9uOkppLE5vZGU6SmksTm9kZUZpbHRlcjpZaSxOb2RlSXRlcmF0b3I6SmksTm9kZUxpc3Q6SmksTm90aWZpY2F0aW9uOkppLE9mZmxpbmVBdWRpb0NvbXBsZXRpb25FdmVudDpKaSxPZmZsaW5lQXVkaW9Db250ZXh0OkppLG9mZnNjcmVlbkJ1ZmZlcmluZzpZaSxPZmZzY3JlZW5DYW52YXM6Smksb3BlbjpZaSxvcGVuRGF0YWJhc2U6WWksT3B0aW9uOkppLG9yaWdpbjpZaSxPc2NpbGxhdG9yTm9kZTpKaSxvdXRlckhlaWdodDpZaSxvdXRlcldpZHRoOllpLFBhZ2VUcmFuc2l0aW9uRXZlbnQ6SmkscGFnZVhPZmZzZXQ6WWkscGFnZVlPZmZzZXQ6WWksUGFubmVyTm9kZTpKaSxwYXJlbnQ6WWksUGF0aDJEOkppLFBheW1lbnRBZGRyZXNzOkppLFBheW1lbnRSZXF1ZXN0OkppLFBheW1lbnRSZXF1ZXN0VXBkYXRlRXZlbnQ6SmksUGF5bWVudFJlc3BvbnNlOkppLHBlcmZvcm1hbmNlOllpLFBlcmZvcm1hbmNlOkppLFBlcmZvcm1hbmNlRW50cnk6SmksUGVyZm9ybWFuY2VMb25nVGFza1RpbWluZzpKaSxQZXJmb3JtYW5jZU1hcms6SmksUGVyZm9ybWFuY2VNZWFzdXJlOkppLFBlcmZvcm1hbmNlTmF2aWdhdGlvbjpKaSxQZXJmb3JtYW5jZU5hdmlnYXRpb25UaW1pbmc6SmksUGVyZm9ybWFuY2VPYnNlcnZlcjpKaSxQZXJmb3JtYW5jZU9ic2VydmVyRW50cnlMaXN0OkppLFBlcmZvcm1hbmNlUGFpbnRUaW1pbmc6SmksUGVyZm9ybWFuY2VSZXNvdXJjZVRpbWluZzpKaSxQZXJmb3JtYW5jZVRpbWluZzpKaSxQZXJpb2RpY1dhdmU6SmksUGVybWlzc2lvbnM6SmksUGVybWlzc2lvblN0YXR1czpKaSxwZXJzb25hbGJhcjpZaSxQaG90b0NhcGFiaWxpdGllczpKaSxQbHVnaW46SmksUGx1Z2luQXJyYXk6SmksUG9pbnRlckV2ZW50OkppLFBvcFN0YXRlRXZlbnQ6SmkscG9zdE1lc3NhZ2U6WWksUHJlc2VudGF0aW9uOkppLFByZXNlbnRhdGlvbkF2YWlsYWJpbGl0eTpKaSxQcmVzZW50YXRpb25Db25uZWN0aW9uOkppLFByZXNlbnRhdGlvbkNvbm5lY3Rpb25BdmFpbGFibGVFdmVudDpKaSxQcmVzZW50YXRpb25Db25uZWN0aW9uQ2xvc2VFdmVudDpKaSxQcmVzZW50YXRpb25Db25uZWN0aW9uTGlzdDpKaSxQcmVzZW50YXRpb25SZWNlaXZlcjpKaSxQcmVzZW50YXRpb25SZXF1ZXN0OkppLHByaW50OllpLFByb2Nlc3NpbmdJbnN0cnVjdGlvbjpKaSxQcm9ncmVzc0V2ZW50OkppLFByb21pc2VSZWplY3Rpb25FdmVudDpKaSxwcm9tcHQ6WWksUHVzaE1hbmFnZXI6SmksUHVzaFN1YnNjcmlwdGlvbjpKaSxQdXNoU3Vic2NyaXB0aW9uT3B0aW9uczpKaSxxdWV1ZU1pY3JvdGFzazpZaSxSYWRpb05vZGVMaXN0OkppLFJhbmdlOkppLFJlYWRhYmxlU3RyZWFtOkppLFJlbW90ZVBsYXliYWNrOkppLHJlbW92ZUV2ZW50TGlzdGVuZXI6WWksUmVxdWVzdDpKaSxyZXF1ZXN0QW5pbWF0aW9uRnJhbWU6WWkscmVxdWVzdElkbGVDYWxsYmFjazpZaSxyZXNpemVCeTpZaSxSZXNpemVPYnNlcnZlcjpKaSxSZXNpemVPYnNlcnZlckVudHJ5OkppLHJlc2l6ZVRvOllpLFJlc3BvbnNlOkppLFJUQ0NlcnRpZmljYXRlOkppLFJUQ0RhdGFDaGFubmVsOkppLFJUQ0RhdGFDaGFubmVsRXZlbnQ6SmksUlRDRHRsc1RyYW5zcG9ydDpKaSxSVENJY2VDYW5kaWRhdGU6SmksUlRDSWNlVHJhbnNwb3J0OkppLFJUQ1BlZXJDb25uZWN0aW9uOkppLFJUQ1BlZXJDb25uZWN0aW9uSWNlRXZlbnQ6SmksUlRDUnRwUmVjZWl2ZXI6SmksUlRDUnRwU2VuZGVyOkppLFJUQ1NjdHBUcmFuc3BvcnQ6SmksUlRDU2Vzc2lvbkRlc2NyaXB0aW9uOkppLFJUQ1N0YXRzUmVwb3J0OkppLFJUQ1RyYWNrRXZlbnQ6Smksc2NyZWVuOllpLFNjcmVlbjpKaSxzY3JlZW5MZWZ0OllpLFNjcmVlbk9yaWVudGF0aW9uOkppLHNjcmVlblRvcDpZaSxzY3JlZW5YOllpLHNjcmVlblk6WWksU2NyaXB0UHJvY2Vzc29yTm9kZTpKaSxzY3JvbGw6WWksc2Nyb2xsYmFyczpZaSxzY3JvbGxCeTpZaSxzY3JvbGxUbzpZaSxzY3JvbGxYOllpLHNjcm9sbFk6WWksU2VjdXJpdHlQb2xpY3lWaW9sYXRpb25FdmVudDpKaSxTZWxlY3Rpb246SmksU2VydmljZVdvcmtlcjpKaSxTZXJ2aWNlV29ya2VyQ29udGFpbmVyOkppLFNlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb246Smksc2Vzc2lvblN0b3JhZ2U6WWksU2hhZG93Um9vdDpKaSxTaGFyZWRXb3JrZXI6SmksU291cmNlQnVmZmVyOkppLFNvdXJjZUJ1ZmZlckxpc3Q6Smksc3BlZWNoU3ludGhlc2lzOllpLFNwZWVjaFN5bnRoZXNpc0V2ZW50OkppLFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZTpKaSxTdGF0aWNSYW5nZTpKaSxzdGF0dXM6WWksc3RhdHVzYmFyOllpLFN0ZXJlb1Bhbm5lck5vZGU6Smksc3RvcDpZaSxTdG9yYWdlOkppLFN0b3JhZ2VFdmVudDpKaSxTdG9yYWdlTWFuYWdlcjpKaSxzdHlsZU1lZGlhOllpLFN0eWxlU2hlZXQ6SmksU3R5bGVTaGVldExpc3Q6SmksU3VidGxlQ3J5cHRvOkppLFNWR0FFbGVtZW50OkppLFNWR0FuZ2xlOkppLFNWR0FuaW1hdGVkQW5nbGU6SmksU1ZHQW5pbWF0ZWRCb29sZWFuOkppLFNWR0FuaW1hdGVkRW51bWVyYXRpb246SmksU1ZHQW5pbWF0ZWRJbnRlZ2VyOkppLFNWR0FuaW1hdGVkTGVuZ3RoOkppLFNWR0FuaW1hdGVkTGVuZ3RoTGlzdDpKaSxTVkdBbmltYXRlZE51bWJlcjpKaSxTVkdBbmltYXRlZE51bWJlckxpc3Q6SmksU1ZHQW5pbWF0ZWRQcmVzZXJ2ZUFzcGVjdFJhdGlvOkppLFNWR0FuaW1hdGVkUmVjdDpKaSxTVkdBbmltYXRlZFN0cmluZzpKaSxTVkdBbmltYXRlZFRyYW5zZm9ybUxpc3Q6SmksU1ZHQW5pbWF0ZUVsZW1lbnQ6SmksU1ZHQW5pbWF0ZU1vdGlvbkVsZW1lbnQ6SmksU1ZHQW5pbWF0ZVRyYW5zZm9ybUVsZW1lbnQ6SmksU1ZHQW5pbWF0aW9uRWxlbWVudDpKaSxTVkdDaXJjbGVFbGVtZW50OkppLFNWR0NsaXBQYXRoRWxlbWVudDpKaSxTVkdDb21wb25lbnRUcmFuc2ZlckZ1bmN0aW9uRWxlbWVudDpKaSxTVkdEZWZzRWxlbWVudDpKaSxTVkdEZXNjRWxlbWVudDpKaSxTVkdEaXNjYXJkRWxlbWVudDpKaSxTVkdFbGVtZW50OkppLFNWR0VsbGlwc2VFbGVtZW50OkppLFNWR0ZFQmxlbmRFbGVtZW50OkppLFNWR0ZFQ29sb3JNYXRyaXhFbGVtZW50OkppLFNWR0ZFQ29tcG9uZW50VHJhbnNmZXJFbGVtZW50OkppLFNWR0ZFQ29tcG9zaXRlRWxlbWVudDpKaSxTVkdGRUNvbnZvbHZlTWF0cml4RWxlbWVudDpKaSxTVkdGRURpZmZ1c2VMaWdodGluZ0VsZW1lbnQ6SmksU1ZHRkVEaXNwbGFjZW1lbnRNYXBFbGVtZW50OkppLFNWR0ZFRGlzdGFudExpZ2h0RWxlbWVudDpKaSxTVkdGRURyb3BTaGFkb3dFbGVtZW50OkppLFNWR0ZFRmxvb2RFbGVtZW50OkppLFNWR0ZFRnVuY0FFbGVtZW50OkppLFNWR0ZFRnVuY0JFbGVtZW50OkppLFNWR0ZFRnVuY0dFbGVtZW50OkppLFNWR0ZFRnVuY1JFbGVtZW50OkppLFNWR0ZFR2F1c3NpYW5CbHVyRWxlbWVudDpKaSxTVkdGRUltYWdlRWxlbWVudDpKaSxTVkdGRU1lcmdlRWxlbWVudDpKaSxTVkdGRU1lcmdlTm9kZUVsZW1lbnQ6SmksU1ZHRkVNb3JwaG9sb2d5RWxlbWVudDpKaSxTVkdGRU9mZnNldEVsZW1lbnQ6SmksU1ZHRkVQb2ludExpZ2h0RWxlbWVudDpKaSxTVkdGRVNwZWN1bGFyTGlnaHRpbmdFbGVtZW50OkppLFNWR0ZFU3BvdExpZ2h0RWxlbWVudDpKaSxTVkdGRVRpbGVFbGVtZW50OkppLFNWR0ZFVHVyYnVsZW5jZUVsZW1lbnQ6SmksU1ZHRmlsdGVyRWxlbWVudDpKaSxTVkdGb3JlaWduT2JqZWN0RWxlbWVudDpKaSxTVkdHRWxlbWVudDpKaSxTVkdHZW9tZXRyeUVsZW1lbnQ6SmksU1ZHR3JhZGllbnRFbGVtZW50OkppLFNWR0dyYXBoaWNzRWxlbWVudDpKaSxTVkdJbWFnZUVsZW1lbnQ6SmksU1ZHTGVuZ3RoOkppLFNWR0xlbmd0aExpc3Q6SmksU1ZHTGluZWFyR3JhZGllbnRFbGVtZW50OkppLFNWR0xpbmVFbGVtZW50OkppLFNWR01hcmtlckVsZW1lbnQ6SmksU1ZHTWFza0VsZW1lbnQ6SmksU1ZHTWF0cml4OkppLFNWR01ldGFkYXRhRWxlbWVudDpKaSxTVkdNUGF0aEVsZW1lbnQ6SmksU1ZHTnVtYmVyOkppLFNWR051bWJlckxpc3Q6SmksU1ZHUGF0aEVsZW1lbnQ6SmksU1ZHUGF0dGVybkVsZW1lbnQ6SmksU1ZHUG9pbnQ6SmksU1ZHUG9pbnRMaXN0OkppLFNWR1BvbHlnb25FbGVtZW50OkppLFNWR1BvbHlsaW5lRWxlbWVudDpKaSxTVkdQcmVzZXJ2ZUFzcGVjdFJhdGlvOkppLFNWR1JhZGlhbEdyYWRpZW50RWxlbWVudDpKaSxTVkdSZWN0OkppLFNWR1JlY3RFbGVtZW50OkppLFNWR1NjcmlwdEVsZW1lbnQ6SmksU1ZHU2V0RWxlbWVudDpKaSxTVkdTdG9wRWxlbWVudDpKaSxTVkdTdHJpbmdMaXN0OkppLFNWR1N0eWxlRWxlbWVudDpKaSxTVkdTVkdFbGVtZW50OkppLFNWR1N3aXRjaEVsZW1lbnQ6SmksU1ZHU3ltYm9sRWxlbWVudDpKaSxTVkdUZXh0Q29udGVudEVsZW1lbnQ6SmksU1ZHVGV4dEVsZW1lbnQ6SmksU1ZHVGV4dFBhdGhFbGVtZW50OkppLFNWR1RleHRQb3NpdGlvbmluZ0VsZW1lbnQ6SmksU1ZHVGl0bGVFbGVtZW50OkppLFNWR1RyYW5zZm9ybTpKaSxTVkdUcmFuc2Zvcm1MaXN0OkppLFNWR1RTcGFuRWxlbWVudDpKaSxTVkdVbml0VHlwZXM6SmksU1ZHVXNlRWxlbWVudDpKaSxTVkdWaWV3RWxlbWVudDpKaSxUYXNrQXR0cmlidXRpb25UaW1pbmc6SmksVGV4dDpKaSxUZXh0RXZlbnQ6SmksVGV4dE1ldHJpY3M6SmksVGV4dFRyYWNrOkppLFRleHRUcmFja0N1ZTpKaSxUZXh0VHJhY2tDdWVMaXN0OkppLFRleHRUcmFja0xpc3Q6SmksVGltZVJhbmdlczpKaSx0b29sYmFyOllpLHRvcDpZaSxUb3VjaDpKaSxUb3VjaEV2ZW50OkppLFRvdWNoTGlzdDpKaSxUcmFja0V2ZW50OkppLFRyYW5zaXRpb25FdmVudDpKaSxUcmVlV2Fsa2VyOkppLFVJRXZlbnQ6SmksVmFsaWRpdHlTdGF0ZTpKaSx2aXN1YWxWaWV3cG9ydDpZaSxWaXN1YWxWaWV3cG9ydDpKaSxWVFRDdWU6SmksV2F2ZVNoYXBlck5vZGU6SmksV2ViQXNzZW1ibHk6WWksV2ViR0wyUmVuZGVyaW5nQ29udGV4dDpKaSxXZWJHTEFjdGl2ZUluZm86SmksV2ViR0xCdWZmZXI6SmksV2ViR0xDb250ZXh0RXZlbnQ6SmksV2ViR0xGcmFtZWJ1ZmZlcjpKaSxXZWJHTFByb2dyYW06SmksV2ViR0xRdWVyeTpKaSxXZWJHTFJlbmRlcmJ1ZmZlcjpKaSxXZWJHTFJlbmRlcmluZ0NvbnRleHQ6SmksV2ViR0xTYW1wbGVyOkppLFdlYkdMU2hhZGVyOkppLFdlYkdMU2hhZGVyUHJlY2lzaW9uRm9ybWF0OkppLFdlYkdMU3luYzpKaSxXZWJHTFRleHR1cmU6SmksV2ViR0xUcmFuc2Zvcm1GZWVkYmFjazpKaSxXZWJHTFVuaWZvcm1Mb2NhdGlvbjpKaSxXZWJHTFZlcnRleEFycmF5T2JqZWN0OkppLFdlYlNvY2tldDpKaSxXaGVlbEV2ZW50OkppLFdpbmRvdzpKaSxXb3JrZXI6SmksV3JpdGFibGVTdHJlYW06SmksWE1MRG9jdW1lbnQ6SmksWE1MSHR0cFJlcXVlc3Q6SmksWE1MSHR0cFJlcXVlc3RFdmVudFRhcmdldDpKaSxYTUxIdHRwUmVxdWVzdFVwbG9hZDpKaSxYTUxTZXJpYWxpemVyOkppLFhQYXRoRXZhbHVhdG9yOkppLFhQYXRoRXhwcmVzc2lvbjpKaSxYUGF0aFJlc3VsdDpKaSxYU0xUUHJvY2Vzc29yOkppfTtmb3IoY29uc3QgZSBvZiBbIndpbmRvdyIsImdsb2JhbCIsInNlbGYiLCJnbG9iYWxUaGlzIl0pcm5bZV09cm47ZnVuY3Rpb24gb24oZSl7bGV0IHQ9cm47Zm9yKGNvbnN0IHMgb2YgZSl7aWYoInN0cmluZyIhPXR5cGVvZiBzKXJldHVybiBudWxsO2lmKHQ9dFtzXSwhdClyZXR1cm4gbnVsbH1yZXR1cm4gdFtVaV19Y2xhc3MgYW4gZXh0ZW5kcyBkZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5pc1JlYXNzaWduZWQ9ITA7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtzd2l0Y2goZS50eXBlKXtjYXNlIDA6Y2FzZSAxOnJldHVybiB2b2lkKG9uKFt0aGlzLm5hbWUsLi4udF0uc2xpY2UoMCwtMSkpfHxzdXBlci5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpO2Nhc2UgMjp7Y29uc3QgaT1vbihbdGhpcy5uYW1lLC4uLnRdKTtyZXR1cm4gdm9pZChpP2kuZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbChlKTpzdXBlci5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpfX19Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtjb25zdCBpPW9uKFt0aGlzLm5hbWUsLi4uZV0pO3JldHVybiBpP2kuZ2V0TGl0ZXJhbFZhbHVlKCk6aWV9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N3aXRjaCh0LnR5cGUpe2Nhc2UgMDpyZXR1cm4gMD09PWUubGVuZ3RoPyJ1bmRlZmluZWQiIT09dGhpcy5uYW1lJiYhb24oW3RoaXMubmFtZV0pOiFvbihbdGhpcy5uYW1lLC4uLmVdLnNsaWNlKDAsLTEpKTtjYXNlIDE6cmV0dXJuICEwO2Nhc2UgMjp7Y29uc3QgaT1vbihbdGhpcy5uYW1lLC4uLmVdKTtyZXR1cm4gIWl8fGkuaGFzRWZmZWN0c1doZW5DYWxsZWQodCxzKX19fX1jb25zdCBsbj17X19wcm90b19fOm51bGwsY2xhc3M6ITAsY29uc3Q6ITAsbGV0OiEwLHZhcjohMH07Y2xhc3MgY24gZXh0ZW5kcyBKc3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy52YXJpYWJsZT1udWxsLHRoaXMuaXNURFpBY2Nlc3M9bnVsbDt9YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXt0Lmhhcyh0aGlzLnZhcmlhYmxlKSYmZS5wdXNoKHRoaXMudmFyaWFibGUpO31iaW5kKCl7IXRoaXMudmFyaWFibGUmJnppKHRoaXMsdGhpcy5wYXJlbnQpJiYodGhpcy52YXJpYWJsZT10aGlzLnNjb3BlLmZpbmRWYXJpYWJsZSh0aGlzLm5hbWUpLHRoaXMudmFyaWFibGUuYWRkUmVmZXJlbmNlKHRoaXMpKTt9ZGVjbGFyZShlLHQpe2xldCBzO2NvbnN0e3RyZWVzaGFrZTppfT10aGlzLmNvbnRleHQub3B0aW9ucztzd2l0Y2goZSl7Y2FzZSJ2YXIiOnM9dGhpcy5zY29wZS5hZGREZWNsYXJhdGlvbih0aGlzLHRoaXMuY29udGV4dCx0LCEwKSxpJiZpLmNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uJiZzLm1hcmtJbml0aWFsaXplcnNGb3JEZW9wdGltaXphdGlvbigpO2JyZWFrO2Nhc2UiZnVuY3Rpb24iOmNhc2UibGV0IjpjYXNlImNvbnN0IjpjYXNlImNsYXNzIjpzPXRoaXMuc2NvcGUuYWRkRGVjbGFyYXRpb24odGhpcyx0aGlzLmNvbnRleHQsdCwhMSk7YnJlYWs7Y2FzZSJwYXJhbWV0ZXIiOnM9dGhpcy5zY29wZS5hZGRQYXJhbWV0ZXJEZWNsYXJhdGlvbih0aGlzKTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgSW50ZXJuYWwgRXJyb3I6IFVuZXhwZWN0ZWQgaWRlbnRpZmllciBraW5kICR7ZX0uYCl9cmV0dXJuIHMua2luZD1lLFt0aGlzLnZhcmlhYmxlPXNdfWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhcmlhYmxlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7MCE9PWUubGVuZ3RofHx0aGlzLnNjb3BlLmNvbnRhaW5zKHRoaXMubmFtZSl8fHRoaXMuZGlzYWxsb3dJbXBvcnRSZWFzc2lnbm1lbnQoKSx0aGlzLnZhcmlhYmxlPy5kZW9wdGltaXplUGF0aChlKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0W24scl09dGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTtyZXR1cm4gW24scnx8dGhpcy5pc1B1cmVGdW5jdGlvbihlKV19aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEoIXRoaXMuaXNQb3NzaWJsZVREWigpfHwidmFyIj09PXRoaXMudmFyaWFibGUua2luZCl8fHRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZS51bmtub3duR2xvYmFsU2lkZUVmZmVjdHMmJnRoaXMudmFyaWFibGUgaW5zdGFuY2VvZiBhbiYmIXRoaXMuaXNQdXJlRnVuY3Rpb24oWSkmJnRoaXMudmFyaWFibGUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSxjZSxlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7c3dpdGNoKHQudHlwZSl7Y2FzZSAwOnJldHVybiBudWxsIT09dGhpcy52YXJpYWJsZSYmIXRoaXMuaXNQdXJlRnVuY3Rpb24oZSkmJnRoaXMuZ2V0VmFyaWFibGVSZXNwZWN0aW5nVERaKCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO2Nhc2UgMTpyZXR1cm4gKGUubGVuZ3RoPjA/dGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKTp0aGlzLnZhcmlhYmxlKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7Y2FzZSAyOnJldHVybiAhdGhpcy5pc1B1cmVGdW5jdGlvbihlKSYmdGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9fWluY2x1ZGUoKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsbnVsbCE9PXRoaXMudmFyaWFibGUmJnRoaXMuY29udGV4dC5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZSh0aGlzLnZhcmlhYmxlKSk7fWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7dGhpcy52YXJpYWJsZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpO31pc1Bvc3NpYmxlVERaKCl7aWYobnVsbCE9PXRoaXMuaXNURFpBY2Nlc3MpcmV0dXJuIHRoaXMuaXNURFpBY2Nlc3M7aWYoISh0aGlzLnZhcmlhYmxlIGluc3RhbmNlb2Ygd2kmJnRoaXMudmFyaWFibGUua2luZCYmdGhpcy52YXJpYWJsZS5raW5kIGluIGxuJiZ0aGlzLnZhcmlhYmxlLm1vZHVsZT09PXRoaXMuY29udGV4dC5tb2R1bGUpKXJldHVybiB0aGlzLmlzVERaQWNjZXNzPSExO2xldCBlO3JldHVybiB0aGlzLnZhcmlhYmxlLmRlY2xhcmF0aW9ucyYmMT09PXRoaXMudmFyaWFibGUuZGVjbGFyYXRpb25zLmxlbmd0aCYmKGU9dGhpcy52YXJpYWJsZS5kZWNsYXJhdGlvbnNbMF0pJiZ0aGlzLnN0YXJ0PGUuc3RhcnQmJmhuKHRoaXMpPT09aG4oZSk/dGhpcy5pc1REWkFjY2Vzcz0hMDp0aGlzLnZhcmlhYmxlLmluaXRSZWFjaGVkP3RoaXMuaXNURFpBY2Nlc3M9ITE6dGhpcy5pc1REWkFjY2Vzcz0hMH1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7dGhpcy52YXJpYWJsZS5pbml0UmVhY2hlZD0hMDt9cmVuZGVyKGUse3NuaXBwZXRzOntnZXRQcm9wZXJ0eUFjY2Vzczp0fSx1c2VPcmlnaW5hbE5hbWU6c30se3JlbmRlcmVkUGFyZW50VHlwZTppLGlzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpuLGlzU2hvcnRoYW5kUHJvcGVydHk6cn09ZmUpe2lmKHRoaXMudmFyaWFibGUpe2NvbnN0IG89dGhpcy52YXJpYWJsZS5nZXROYW1lKHQscyk7byE9PXRoaXMubmFtZSYmKGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdGhpcy5lbmQsbyx7Y29udGVudE9ubHk6ITAsc3RvcmVOYW1lOiEwfSksciYmZS5wcmVwZW5kUmlnaHQodGhpcy5zdGFydCxgJHt0aGlzLm5hbWV9OiBgKSksImV2YWwiPT09byYmaT09PXdzJiZuJiZlLmFwcGVuZFJpZ2h0KHRoaXMuc3RhcnQsIjAsICIpO319YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMudmFyaWFibGUgaW5zdGFuY2VvZiB3aSYmKHRoaXMudmFyaWFibGUuY29uc29saWRhdGVJbml0aWFsaXplcnMoKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpKTt9ZGlzYWxsb3dJbXBvcnRSZWFzc2lnbm1lbnQoKXtyZXR1cm4gdGhpcy5jb250ZXh0LmVycm9yKFR0KHRoaXMubmFtZSx0aGlzLmNvbnRleHQubW9kdWxlLmlkKSx0aGlzLnN0YXJ0KX1nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKXtyZXR1cm4gdGhpcy5pc1Bvc3NpYmxlVERaKCk/b2U6dGhpcy52YXJpYWJsZX1pc1B1cmVGdW5jdGlvbihlKXtsZXQgdD10aGlzLmNvbnRleHQubWFudWFsUHVyZUZ1bmN0aW9uc1t0aGlzLm5hbWVdO2Zvcihjb25zdCBzIG9mIGUpe2lmKCF0KXJldHVybiAhMTtpZih0W0ZpXSlyZXR1cm4gITA7dD10W3NdO31yZXR1cm4gdD8uW0ZpXX19ZnVuY3Rpb24gaG4oZSl7Zm9yKDtlJiYhL15Qcm9ncmFtfEZ1bmN0aW9uLy50ZXN0KGUudHlwZSk7KWU9ZS5wYXJlbnQ7cmV0dXJuIGV9ZnVuY3Rpb24gdW4oZSx0LHMsaSl7aWYodC5yZW1vdmUocyxpKSxlLmFubm90YXRpb25zKWZvcihjb25zdCBpIG9mIGUuYW5ub3RhdGlvbnMpe2lmKCEoaS5zdGFydDxzKSlyZXR1cm47dC5yZW1vdmUoaS5zdGFydCxpLmVuZCk7fX1mdW5jdGlvbiBkbihlLHQpe2lmKGUuYW5ub3RhdGlvbnN8fGUucGFyZW50LnR5cGUhPT1fc3x8KGU9ZS5wYXJlbnQpLGUuYW5ub3RhdGlvbnMpZm9yKGNvbnN0IHMgb2YgZS5hbm5vdGF0aW9ucyl0LnJlbW92ZShzLnN0YXJ0LHMuZW5kKTt9Y29uc3QgcG49e2lzTm9TdGF0ZW1lbnQ6ITB9O2Z1bmN0aW9uIGZuKGUsdCxzPTApe2xldCBpLG47Zm9yKGk9ZS5pbmRleE9mKHQscyk7Oyl7aWYoLTE9PT0ocz1lLmluZGV4T2YoIi8iLHMpKXx8cz49aSlyZXR1cm4gaTtuPWUuY2hhckNvZGVBdCgrK3MpLCsrcywocz00Nz09PW4/ZS5pbmRleE9mKCJcbiIscykrMTplLmluZGV4T2YoIiovIixzKSsyKT5pJiYoaT1lLmluZGV4T2YodCxzKSk7fX1jb25zdCBtbj0vXFMvZztmdW5jdGlvbiBnbihlLHQpe21uLmxhc3RJbmRleD10O3JldHVybiBtbi5leGVjKGUpLmluZGV4fWZ1bmN0aW9uIHluKGUpe2xldCB0LHMsaT0wO2Zvcih0PWUuaW5kZXhPZigiXG4iLGkpOzspe2lmKGk9ZS5pbmRleE9mKCIvIixpKSwtMT09PWl8fGk+dClyZXR1cm4gW3QsdCsxXTtpZihzPWUuY2hhckNvZGVBdChpKzEpLDQ3PT09cylyZXR1cm4gW2ksdCsxXTtpPWUuaW5kZXhPZigiKi8iLGkrMykrMixpPnQmJih0PWUuaW5kZXhPZigiXG4iLGkpKTt9fWZ1bmN0aW9uIHhuKGUsdCxzLGksbil7bGV0IHIsbyxhLGwsYz1lWzBdLGg9IWMuaW5jbHVkZWR8fGMubmVlZHNCb3VuZGFyaWVzO2gmJihsPXMreW4odC5vcmlnaW5hbC5zbGljZShzLGMuc3RhcnQpKVsxXSk7Zm9yKGxldCBzPTE7czw9ZS5sZW5ndGg7cysrKXI9YyxvPWwsYT1oLGM9ZVtzXSxoPXZvaWQgMCE9PWMmJighYy5pbmNsdWRlZHx8Yy5uZWVkc0JvdW5kYXJpZXMpLGF8fGg/KGw9ci5lbmQreW4odC5vcmlnaW5hbC5zbGljZShyLmVuZCx2b2lkIDA9PT1jP2k6Yy5zdGFydCkpWzFdLHIuaW5jbHVkZWQ/YT9yLnJlbmRlcih0LG4se2VuZDpsLHN0YXJ0Om99KTpyLnJlbmRlcih0LG4pOnVuKHIsdCxvLGwpKTpyLnJlbmRlcih0LG4pO31mdW5jdGlvbiBFbihlLHQscyxpKXtjb25zdCBuPVtdO2xldCByLG8sYSxsLGM9cy0xO2Zvcihjb25zdCBpIG9mIGUpe2Zvcih2b2lkIDAhPT1yJiYoYz1yLmVuZCtmbih0Lm9yaWdpbmFsLnNsaWNlKHIuZW5kLGkuc3RhcnQpLCIsIikpLG89YT1jKzEreW4odC5vcmlnaW5hbC5zbGljZShjKzEsaS5zdGFydCkpWzFdO2w9dC5vcmlnaW5hbC5jaGFyQ29kZUF0KG8pLDMyPT09bHx8OT09PWx8fDEwPT09bHx8MTM9PT1sOylvKys7dm9pZCAwIT09ciYmbi5wdXNoKHtjb250ZW50RW5kOmEsZW5kOm8sbm9kZTpyLHNlcGFyYXRvcjpjLHN0YXJ0OnN9KSxyPWkscz1vO31yZXR1cm4gbi5wdXNoKHtjb250ZW50RW5kOmksZW5kOmksbm9kZTpyLHNlcGFyYXRvcjpudWxsLHN0YXJ0OnN9KSxufWZ1bmN0aW9uIGJuKGUsdCxzKXtmb3IoOzspe2NvbnN0W2ksbl09eW4oZS5vcmlnaW5hbC5zbGljZSh0LHMpKTtpZigtMT09PWkpYnJlYWs7ZS5yZW1vdmUodCtpLHQrPW4pO319Y2xhc3Mgdm4gZXh0ZW5kcyBUaXthZGREZWNsYXJhdGlvbihlLHQscyxpKXtpZihpKXtjb25zdCBuPXRoaXMucGFyZW50LmFkZERlY2xhcmF0aW9uKGUsdCxzLGkpO3JldHVybiBuLm1hcmtJbml0aWFsaXplcnNGb3JEZW9wdGltaXphdGlvbigpLG59cmV0dXJuIHN1cGVyLmFkZERlY2xhcmF0aW9uKGUsdCxzLCExKX19Y2xhc3MgU24gZXh0ZW5kcyBKc3tpbml0aWFsaXNlKCl7dmFyIGUsdDt0aGlzLmRpcmVjdGl2ZSYmInVzZSBzdHJpY3QiIT09dGhpcy5kaXJlY3RpdmUmJnRoaXMucGFyZW50LnR5cGU9PT1McyYmdGhpcy5jb250ZXh0LmxvZyhTZSwoZT10aGlzLmRpcmVjdGl2ZSx7Y29kZToiTU9EVUxFX0xFVkVMX0RJUkVDVElWRSIsaWQ6dD10aGlzLmNvbnRleHQubW9kdWxlLmlkLG1lc3NhZ2U6YE1vZHVsZSBsZXZlbCBkaXJlY3RpdmVzIGNhdXNlIGVycm9ycyB3aGVuIGJ1bmRsZWQsICIke2V9IiBpbiAiJHtUKHQpfSIgd2FzIGlnbm9yZWQuYH0pLHRoaXMuc3RhcnQpO31yZW5kZXIoZSx0KXtzdXBlci5yZW5kZXIoZSx0KSx0aGlzLmluY2x1ZGVkJiZ0aGlzLmluc2VydFNlbWljb2xvbihlKTt9c2hvdWxkQmVJbmNsdWRlZChlKXtyZXR1cm4gdGhpcy5kaXJlY3RpdmUmJiJ1c2Ugc3RyaWN0IiE9PXRoaXMuZGlyZWN0aXZlP3RoaXMucGFyZW50LnR5cGUhPT1MczpzdXBlci5zaG91bGRCZUluY2x1ZGVkKGUpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1jbGFzcyBBbiBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmRpcmVjdGx5SW5jbHVkZWQ9ITE7fWFkZEltcGxpY2l0UmV0dXJuRXhwcmVzc2lvblRvU2NvcGUoKXtjb25zdCBlPXRoaXMuYm9keVt0aGlzLmJvZHkubGVuZ3RoLTFdO2UmJiJSZXR1cm5TdGF0ZW1lbnQiPT09ZS50eXBlfHx0aGlzLnNjb3BlLmFkZFJldHVybkV4cHJlc3Npb24ob2UpO31jcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPXRoaXMucGFyZW50LnByZXZlbnRDaGlsZEJsb2NrU2NvcGU/ZTpuZXcgdm4oZSk7fWhhc0VmZmVjdHMoZSl7aWYodGhpcy5kZW9wdGltaXplQm9keSlyZXR1cm4gITA7Zm9yKGNvbnN0IHQgb2YgdGhpcy5ib2R5KXtpZihlLmJyb2tlbkZsb3cpYnJlYWs7aWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe2lmKCF0aGlzLmRlb3B0aW1pemVCb2R5fHwhdGhpcy5kaXJlY3RseUluY2x1ZGVkKXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuZGlyZWN0bHlJbmNsdWRlZD0hMCx0aGlzLmRlb3B0aW1pemVCb2R5JiYodD0hMCk7Zm9yKGNvbnN0IHMgb2YgdGhpcy5ib2R5KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9fWluaXRpYWxpc2UoKXtjb25zdCBlPXRoaXMuYm9keVswXTt0aGlzLmRlb3B0aW1pemVCb2R5PWUgaW5zdGFuY2VvZiBTbiYmInVzZSBhc20iPT09ZS5kaXJlY3RpdmU7fXJlbmRlcihlLHQpe3RoaXMuYm9keS5sZW5ndGg+MD94bih0aGlzLmJvZHksZSx0aGlzLnN0YXJ0KzEsdGhpcy5lbmQtMSx0KTpzdXBlci5yZW5kZXIoZSx0KTt9fWNsYXNzIGtuIGV4dGVuZHMgSnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuZGVjbGFyYXRpb25Jbml0PW51bGw7fWFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCl7dGhpcy5hcmd1bWVudC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpO31kZWNsYXJlKGUsdCl7cmV0dXJuIHRoaXMuZGVjbGFyYXRpb25Jbml0PXQsdGhpcy5hcmd1bWVudC5kZWNsYXJlKGUsb2UpfWRlb3B0aW1pemVQYXRoKGUpezA9PT1lLmxlbmd0aCYmdGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChZKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiBlLmxlbmd0aD4wfHx0aGlzLmFyZ3VtZW50Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFksdCxzKX1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7dGhpcy5hcmd1bWVudC5tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMCxudWxsIT09dGhpcy5kZWNsYXJhdGlvbkluaXQmJih0aGlzLmRlY2xhcmF0aW9uSW5pdC5kZW9wdGltaXplUGF0aChbVyxXXSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKSk7fX1jbGFzcyBJbiBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLm9iamVjdEVudGl0eT1udWxsLHRoaXMuZGVvcHRpbWl6ZWRSZXR1cm49ITE7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtpZigyPT09ZS50eXBlKXtjb25zdHtwYXJhbWV0ZXJzOnR9PXRoaXMuc2NvcGUse2FyZ3M6c309ZTtsZXQgaT0hMTtmb3IobGV0IGU9MDtlPHMubGVuZ3RoLTE7ZSsrKXtjb25zdCBuPXRoaXMucGFyYW1zW2VdLHI9c1tlKzFdO2l8fG4gaW5zdGFuY2VvZiBrbj8oaT0hMCxyLmRlb3B0aW1pemVQYXRoKFgpKTpuIGluc3RhbmNlb2YgY24/KHRbZV1bMF0uYWRkRW50aXR5VG9CZURlb3B0aW1pemVkKHIpLHRoaXMuYWRkQXJndW1lbnRUb0JlRGVvcHRpbWl6ZWQocikpOm4/ci5kZW9wdGltaXplUGF0aChYKTp0aGlzLmFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKHIpO319ZWxzZSB0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplUGF0aChlKSwxPT09ZS5sZW5ndGgmJmVbMF09PT1XJiZ0aGlzLnNjb3BlLmdldFJldHVybkV4cHJlc3Npb24oKS5kZW9wdGltaXplUGF0aChYKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiBlLmxlbmd0aD4wP3RoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSk6dGhpcy5hc3luYz8odGhpcy5kZW9wdGltaXplZFJldHVybnx8KHRoaXMuZGVvcHRpbWl6ZWRSZXR1cm49ITAsdGhpcy5zY29wZS5nZXRSZXR1cm5FeHByZXNzaW9uKCkuZGVvcHRpbWl6ZVBhdGgoWCksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKSksYWUpOlt0aGlzLnNjb3BlLmdldFJldHVybkV4cHJlc3Npb24oKSwhMV19aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2lmKGUubGVuZ3RoPjB8fDIhPT10LnR5cGUpcmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO2lmKHRoaXMuYW5ub3RhdGlvbk5vU2lkZUVmZmVjdHMpcmV0dXJuICExO2lmKHRoaXMuYXN5bmMpe2NvbnN0e3Byb3BlcnR5UmVhZFNpZGVFZmZlY3RzOmV9PXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZSx0PXRoaXMuc2NvcGUuZ2V0UmV0dXJuRXhwcmVzc2lvbigpO2lmKHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWyJ0aGVuIl0sdWUscyl8fGUmJigiYWx3YXlzIj09PWV8fHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWyJ0aGVuIl0sY2UscykpKXJldHVybiAhMH1mb3IoY29uc3QgZSBvZiB0aGlzLnBhcmFtcylpZihlLmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3JldHVybiAhMX1pbmNsdWRlKGUsdCl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITA7Y29uc3R7YnJva2VuRmxvdzpzfT1lO2UuYnJva2VuRmxvdz0hMSx0aGlzLmJvZHkuaW5jbHVkZShlLHQpLGUuYnJva2VuRmxvdz1zO31pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe3RoaXMuc2NvcGUuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KTt9aW5pdGlhbGlzZSgpe3RoaXMuc2NvcGUuYWRkUGFyYW1ldGVyVmFyaWFibGVzKHRoaXMucGFyYW1zLm1hcCgoZT0+ZS5kZWNsYXJlKCJwYXJhbWV0ZXIiLG9lKSkpLHRoaXMucGFyYW1zW3RoaXMucGFyYW1zLmxlbmd0aC0xXWluc3RhbmNlb2Yga24pLHRoaXMuYm9keSBpbnN0YW5jZW9mIEFuP3RoaXMuYm9keS5hZGRJbXBsaWNpdFJldHVybkV4cHJlc3Npb25Ub1Njb3BlKCk6dGhpcy5zY29wZS5hZGRSZXR1cm5FeHByZXNzaW9uKHRoaXMuYm9keSk7fXBhcnNlTm9kZShlKXtlLmJvZHkudHlwZT09PUlzJiYodGhpcy5ib2R5PW5ldyBBbihlLmJvZHksdGhpcyx0aGlzLnNjb3BlLmhvaXN0ZWRCb2R5VmFyU2NvcGUpKSxzdXBlci5wYXJzZU5vZGUoZSk7fWFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpe31hcHBseURlb3B0aW1pemF0aW9ucygpe319SW4ucHJvdG90eXBlLnByZXZlbnRDaGlsZEJsb2NrU2NvcGU9ITA7Y2xhc3Mgd24gZXh0ZW5kcyBJbntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgQmkoZSx0aGlzLmNvbnRleHQpO31oYXNFZmZlY3RzKCl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSwhMX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7aWYoc3VwZXIuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXJldHVybiAhMDtpZih0aGlzLmFubm90YXRpb25Ob1NpZGVFZmZlY3RzKXJldHVybiAhMTtpZigyPT09dC50eXBlKXtjb25zdHtpZ25vcmU6ZSxicm9rZW5GbG93OnR9PXM7aWYocy5pZ25vcmU9e2JyZWFrczohMSxjb250aW51ZXM6ITEsbGFiZWxzOm5ldyBTZXQscmV0dXJuWWllbGQ6ITAsdGhpczohMX0sdGhpcy5ib2R5Lmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3MuaWdub3JlPWUscy5icm9rZW5GbG93PXQ7fXJldHVybiAhMX1pbmNsdWRlKGUsdCl7c3VwZXIuaW5jbHVkZShlLHQpO2Zvcihjb25zdCBzIG9mIHRoaXMucGFyYW1zKXMgaW5zdGFuY2VvZiBjbnx8cy5pbmNsdWRlKGUsdCk7fWdldE9iamVjdEVudGl0eSgpe3JldHVybiBudWxsIT09dGhpcy5vYmplY3RFbnRpdHk/dGhpcy5vYmplY3RFbnRpdHk6dGhpcy5vYmplY3RFbnRpdHk9bmV3IGFpKFtdLGhpKX19ZnVuY3Rpb24gUG4oZSx7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOnQsc25pcHBldHM6e186cyxnZXRPYmplY3Q6aSxnZXRQcm9wZXJ0eUFjY2VzczpufX0scj0iIil7aWYoMT09PWUubGVuZ3RoJiYxPT09dC5nZXQoZVswXSkubGVuZ3RoKXtjb25zdCBpPWVbMF07cmV0dXJuIGBleHBvcnRzKCcke3QuZ2V0KGkpfScsJHtzfSR7aS5nZXROYW1lKG4pfSR7cn0pYH17Y29uc3Qgcz1bXTtmb3IoY29uc3QgaSBvZiBlKWZvcihjb25zdCBlIG9mIHQuZ2V0KGkpKXMucHVzaChbZSxpLmdldE5hbWUobikrcl0pO3JldHVybiBgZXhwb3J0cygke2kocyx7bGluZUJyZWFrSW5kZW50Om51bGx9KX0pYH19ZnVuY3Rpb24gQ24oZSx0LHMsaSx7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOm4sc25pcHBldHM6e186cn19KXtpLnByZXBlbmRSaWdodCh0LGBleHBvcnRzKCcke24uZ2V0KGUpfScsJHtyfWApLGkuYXBwZW5kTGVmdChzLCIpIik7fWZ1bmN0aW9uICRuKGUsdCxzLGksbixyKXtjb25zdHtfOm8sZ2V0UHJvcGVydHlBY2Nlc3M6YX09ci5zbmlwcGV0cztuLmFwcGVuZExlZnQocyxgLCR7b30ke1BuKFtlXSxyKX0sJHtvfSR7ZS5nZXROYW1lKGEpfWApLGkmJihuLnByZXBlbmRSaWdodCh0LCIoIiksbi5hcHBlbmRMZWZ0KHMsIikiKSk7fWNsYXNzIE5uIGV4dGVuZHMgSnN7YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXtmb3IoY29uc3QgcyBvZiB0aGlzLnByb3BlcnRpZXMpIlByb3BlcnR5Ij09PXMudHlwZT9zLnZhbHVlLmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCk6cy5hcmd1bWVudC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpO31kZWNsYXJlKGUsdCl7Y29uc3Qgcz1bXTtmb3IoY29uc3QgaSBvZiB0aGlzLnByb3BlcnRpZXMpcy5wdXNoKC4uLmkuZGVjbGFyZShlLHQpKTtyZXR1cm4gc31kZW9wdGltaXplUGF0aChlKXtpZigwPT09ZS5sZW5ndGgpZm9yKGNvbnN0IHQgb2YgdGhpcy5wcm9wZXJ0aWVzKXQuZGVvcHRpbWl6ZVBhdGgoZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtmb3IoY29uc3QgZSBvZiB0aGlzLnByb3BlcnRpZXMpaWYoZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChZLHQscykpcmV0dXJuICEwO3JldHVybiAhMX1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5wcm9wZXJ0aWVzKWUubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO319Y2xhc3MgX24gZXh0ZW5kcyB3aXtjb25zdHJ1Y3RvcihlKXtzdXBlcigiYXJndW1lbnRzIixudWxsLG9lLGUpLHRoaXMuZGVvcHRpbWl6ZWRBcmd1bWVudHM9W107fWFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpe3RoaXMuaW5jbHVkZWQ/ZS5kZW9wdGltaXplUGF0aChYKTp0aGlzLmRlb3B0aW1pemVkQXJndW1lbnRzLnB1c2goZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiAwIT09dHx8ZS5sZW5ndGg+MX1pbmNsdWRlKCl7c3VwZXIuaW5jbHVkZSgpO2Zvcihjb25zdCBlIG9mIHRoaXMuZGVvcHRpbWl6ZWRBcmd1bWVudHMpZS5kZW9wdGltaXplUGF0aChYKTt0aGlzLmRlb3B0aW1pemVkQXJndW1lbnRzLmxlbmd0aD0wO319Y2xhc3MgUm4gZXh0ZW5kcyBfaXtjb25zdHJ1Y3RvcihlKXtzdXBlcigidGhpcyIsbnVsbCxlKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAocy5yZXBsYWNlZFZhcmlhYmxlSW5pdHMuZ2V0KHRoaXMpfHxvZSkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfX1jbGFzcyBNbiBleHRlbmRzIEJpe2NvbnN0cnVjdG9yKGUsdCl7c3VwZXIoZSx0KSx0aGlzLnZhcmlhYmxlcy5zZXQoImFyZ3VtZW50cyIsdGhpcy5hcmd1bWVudHNWYXJpYWJsZT1uZXcgX24odCkpLHRoaXMudmFyaWFibGVzLnNldCgidGhpcyIsdGhpcy50aGlzVmFyaWFibGU9bmV3IFJuKHQpKTt9ZmluZExleGljYWxCb3VuZGFyeSgpe3JldHVybiB0aGlzfWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7aWYoc3VwZXIuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KSx0aGlzLmFyZ3VtZW50c1ZhcmlhYmxlLmluY2x1ZGVkKWZvcihjb25zdCBzIG9mIHQpcy5pbmNsdWRlZHx8cy5pbmNsdWRlKGUsITEpO319Y2xhc3MgT24gZXh0ZW5kcyBJbntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgTW4oZSx0aGlzLmNvbnRleHQpLHRoaXMuY29uc3RydWN0ZWRFbnRpdHk9bmV3IGFpKE9iamVjdC5jcmVhdGUobnVsbCksaGkpLHRoaXMuc2NvcGUudGhpc1ZhcmlhYmxlLmFkZEVudGl0eVRvQmVEZW9wdGltaXplZCh0aGlzLmNvbnN0cnVjdGVkRW50aXR5KTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N1cGVyLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKSwyPT09ZS50eXBlJiYwPT09dC5sZW5ndGgmJmUuYXJnc1swXSYmdGhpcy5zY29wZS50aGlzVmFyaWFibGUuYWRkRW50aXR5VG9CZURlb3B0aW1pemVkKGUuYXJnc1swXSk7fWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSwhdGhpcy5hbm5vdGF0aW9uTm9TaWRlRWZmZWN0cyYmISF0aGlzLmlkPy5oYXNFZmZlY3RzKGUpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtpZihzdXBlci5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpcmV0dXJuICEwO2lmKHRoaXMuYW5ub3RhdGlvbk5vU2lkZUVmZmVjdHMpcmV0dXJuICExO2lmKDI9PT10LnR5cGUpe2NvbnN0IGU9cy5yZXBsYWNlZFZhcmlhYmxlSW5pdHMuZ2V0KHRoaXMuc2NvcGUudGhpc1ZhcmlhYmxlKTtzLnJlcGxhY2VkVmFyaWFibGVJbml0cy5zZXQodGhpcy5zY29wZS50aGlzVmFyaWFibGUsdC53aXRoTmV3P3RoaXMuY29uc3RydWN0ZWRFbnRpdHk6b2UpO2NvbnN0e2Jyb2tlbkZsb3c6aSxpZ25vcmU6bixyZXBsYWNlZFZhcmlhYmxlSW5pdHM6cn09cztpZihzLmlnbm9yZT17YnJlYWtzOiExLGNvbnRpbnVlczohMSxsYWJlbHM6bmV3IFNldCxyZXR1cm5ZaWVsZDohMCx0aGlzOnQud2l0aE5ld30sdGhpcy5ib2R5Lmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3MuYnJva2VuRmxvdz1pLGU/ci5zZXQodGhpcy5zY29wZS50aGlzVmFyaWFibGUsZSk6ci5kZWxldGUodGhpcy5zY29wZS50aGlzVmFyaWFibGUpLHMuaWdub3JlPW47fXJldHVybiAhMX1pbmNsdWRlKGUsdCl7c3VwZXIuaW5jbHVkZShlLHQpLHRoaXMuaWQ/LmluY2x1ZGUoKTtjb25zdCBzPXRoaXMuc2NvcGUuYXJndW1lbnRzVmFyaWFibGUuaW5jbHVkZWQ7Zm9yKGNvbnN0IGkgb2YgdGhpcy5wYXJhbXMpaSBpbnN0YW5jZW9mIGNuJiYhc3x8aS5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXtzdXBlci5pbml0aWFsaXNlKCksdGhpcy5pZD8uZGVjbGFyZSgiZnVuY3Rpb24iLHRoaXMpO31hZGRBcmd1bWVudFRvQmVEZW9wdGltaXplZChlKXt0aGlzLnNjb3BlLmFyZ3VtZW50c1ZhcmlhYmxlLmFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpO31nZXRPYmplY3RFbnRpdHkoKXtyZXR1cm4gbnVsbCE9PXRoaXMub2JqZWN0RW50aXR5P3RoaXMub2JqZWN0RW50aXR5OnRoaXMub2JqZWN0RW50aXR5PW5ldyBhaShbe2tleToicHJvdG90eXBlIixraW5kOiJpbml0Iixwcm9wZXJ0eTpuZXcgYWkoW10saGkpfV0saGkpfX1jbGFzcyBEbiBleHRlbmRzIEpze2hhc0VmZmVjdHMoKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEwfWluY2x1ZGUoZSx0KXtpZih0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksIXRoaXMuaW5jbHVkZWQpe3RoaXMuaW5jbHVkZWQ9ITA7ZTppZighdGhpcy5jb250ZXh0LnVzZXNUb3BMZXZlbEF3YWl0KXtsZXQgZT10aGlzLnBhcmVudDtkb3tpZihlIGluc3RhbmNlb2YgT258fGUgaW5zdGFuY2VvZiB3bilicmVhayBlfXdoaWxlKGU9ZS5wYXJlbnQpO3RoaXMuY29udGV4dC51c2VzVG9wTGV2ZWxBd2FpdD0hMDt9fXRoaXMuYXJndW1lbnQuaW5jbHVkZShlLHQpO319Y29uc3QgTG49eyIhPSI6KGUsdCk9PmUhPXQsIiE9PSI6KGUsdCk9PmUhPT10LCIlIjooZSx0KT0+ZSV0LCImIjooZSx0KT0+ZSZ0LCIqIjooZSx0KT0+ZSp0LCIqKiI6KGUsdCk9PmUqKnQsIisiOihlLHQpPT5lK3QsIi0iOihlLHQpPT5lLXQsIi8iOihlLHQpPT5lL3QsIjwiOihlLHQpPT5lPHQsIjw8IjooZSx0KT0+ZTw8dCwiPD0iOihlLHQpPT5lPD10LCI9PSI6KGUsdCk9PmU9PXQsIj09PSI6KGUsdCk9PmU9PT10LCI+IjooZSx0KT0+ZT50LCI+PSI6KGUsdCk9PmU+PXQsIj4+IjooZSx0KT0+ZT4+dCwiPj4+IjooZSx0KT0+ZT4+PnQsIl4iOihlLHQpPT5lXnQsInwiOihlLHQpPT5lfHR9O2Z1bmN0aW9uIFRuKGUsdCxzKXtpZihzLmFyZ3VtZW50cy5sZW5ndGg+MClpZihzLmFyZ3VtZW50c1tzLmFyZ3VtZW50cy5sZW5ndGgtMV0uaW5jbHVkZWQpZm9yKGNvbnN0IGkgb2Ygcy5hcmd1bWVudHMpaS5yZW5kZXIoZSx0KTtlbHNlIHtsZXQgaT1zLmFyZ3VtZW50cy5sZW5ndGgtMjtmb3IoO2k+PTAmJiFzLmFyZ3VtZW50c1tpXS5pbmNsdWRlZDspaS0tO2lmKGk+PTApe2ZvcihsZXQgbj0wO248PWk7bisrKXMuYXJndW1lbnRzW25dLnJlbmRlcihlLHQpO2UucmVtb3ZlKGZuKGUub3JpZ2luYWwsIiwiLHMuYXJndW1lbnRzW2ldLmVuZCkscy5lbmQtMSk7fWVsc2UgZS5yZW1vdmUoZm4oZS5vcmlnaW5hbCwiKCIscy5jYWxsZWUuZW5kKSsxLHMuZW5kLTEpO319Y2xhc3MgVm4gZXh0ZW5kcyBKc3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCgpe31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIGUubGVuZ3RoPjB8fG51bGw9PT10aGlzLnZhbHVlJiYxMTAhPT10aGlzLmNvbnRleHQuY29kZS5jaGFyQ29kZUF0KHRoaXMuc3RhcnQpfHwiYmlnaW50Ij09dHlwZW9mIHRoaXMudmFsdWV8fDQ3PT09dGhpcy5jb250ZXh0LmNvZGUuY2hhckNvZGVBdCh0aGlzLnN0YXJ0KT9pZTp0aGlzLnZhbHVlfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUpe3JldHVybiAxIT09ZS5sZW5ndGg/YWU6RXModGhpcy5tZW1iZXJzLGVbMF0pfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtzd2l0Y2godC50eXBlKXtjYXNlIDA6cmV0dXJuIGUubGVuZ3RoPihudWxsPT09dGhpcy52YWx1ZT8wOjEpO2Nhc2UgMTpyZXR1cm4gITA7Y2FzZSAyOnJldHVybiAhISh0aGlzLmluY2x1ZGVkJiZ0aGlzLnZhbHVlIGluc3RhbmNlb2YgUmVnRXhwJiYodGhpcy52YWx1ZS5nbG9iYWx8fHRoaXMudmFsdWUuc3RpY2t5KSl8fCgxIT09ZS5sZW5ndGh8fHhzKHRoaXMubWVtYmVycyxlWzBdLHQscykpfX1pbml0aWFsaXNlKCl7dGhpcy5tZW1iZXJzPWZ1bmN0aW9uKGUpe2lmKGUgaW5zdGFuY2VvZiBSZWdFeHApcmV0dXJuIGdzO3N3aXRjaCh0eXBlb2YgZSl7Y2FzZSJib29sZWFuIjpyZXR1cm4gZnM7Y2FzZSJudW1iZXIiOnJldHVybiBtcztjYXNlInN0cmluZyI6cmV0dXJuIHlzfXJldHVybiBPYmplY3QuY3JlYXRlKG51bGwpfSh0aGlzLnZhbHVlKTt9cGFyc2VOb2RlKGUpe3RoaXMudmFsdWU9ZS52YWx1ZSx0aGlzLnJlZ2V4PWUucmVnZXgsc3VwZXIucGFyc2VOb2RlKGUpO31yZW5kZXIoZSl7InN0cmluZyI9PXR5cGVvZiB0aGlzLnZhbHVlJiZlLmluZGVudEV4Y2x1c2lvblJhbmdlcy5wdXNoKFt0aGlzLnN0YXJ0KzEsdGhpcy5lbmQtMV0pO319ZnVuY3Rpb24gQm4oZSl7cmV0dXJuIGUuY29tcHV0ZWQ/ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIFZuKXJldHVybiBTdHJpbmcoZS52YWx1ZSk7cmV0dXJuIG51bGx9KGUucHJvcGVydHkpOmUucHJvcGVydHkubmFtZX1mdW5jdGlvbiB6bihlKXtjb25zdCB0PWUucHJvcGVydHlLZXkscz1lLm9iamVjdDtpZigic3RyaW5nIj09dHlwZW9mIHQpe2lmKHMgaW5zdGFuY2VvZiBjbilyZXR1cm4gW3trZXk6cy5uYW1lLHBvczpzLnN0YXJ0fSx7a2V5OnQscG9zOmUucHJvcGVydHkuc3RhcnR9XTtpZihzIGluc3RhbmNlb2YgRm4pe2NvbnN0IGk9em4ocyk7cmV0dXJuIGkmJlsuLi5pLHtrZXk6dCxwb3M6ZS5wcm9wZXJ0eS5zdGFydH1dfX1yZXR1cm4gbnVsbH1jbGFzcyBGbiBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLnZhcmlhYmxlPW51bGwsdGhpcy5hc3NpZ25tZW50RGVvcHRpbWl6ZWQ9ITEsdGhpcy5ib3VuZD0hMSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPVtdLHRoaXMuaXNVbmRlZmluZWQ9ITE7fWJpbmQoKXt0aGlzLmJvdW5kPSEwO2NvbnN0IGU9em4odGhpcyksdD1lJiZ0aGlzLnNjb3BlLmZpbmRWYXJpYWJsZShlWzBdLmtleSk7aWYodD8uaXNOYW1lc3BhY2Upe2NvbnN0IHM9am4odCxlLnNsaWNlKDEpLHRoaXMuY29udGV4dCk7cz8idW5kZWZpbmVkIj09PXM/dGhpcy5pc1VuZGVmaW5lZD0hMDoodGhpcy52YXJpYWJsZT1zLHRoaXMuc2NvcGUuYWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKGZ1bmN0aW9uKGUpe2xldCB0PWVbMF0ua2V5O2ZvcihsZXQgcz0xO3M8ZS5sZW5ndGg7cysrKXQrPSIuIitlW3NdLmtleTtyZXR1cm4gdH0oZSkscykpOnN1cGVyLmJpbmQoKTt9ZWxzZSBzdXBlci5iaW5kKCk7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhcmlhYmxlP3RoaXMudmFyaWFibGUuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpOnRoaXMuaXNVbmRlZmluZWR8fCh0Lmxlbmd0aDw3P3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsW3RoaXMuZ2V0UHJvcGVydHlLZXkoKSwuLi50XSxzKTpsZShlKSk7fWRlb3B0aW1pemVDYWNoZSgpe2NvbnN0e2V4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkOmUsb2JqZWN0OnR9PXRoaXM7dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1nZSx0aGlzLnByb3BlcnR5S2V5PVcsdC5kZW9wdGltaXplUGF0aChYKTtmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7fWRlb3B0aW1pemVQYXRoKGUpe2lmKDA9PT1lLmxlbmd0aCYmdGhpcy5kaXNhbGxvd05hbWVzcGFjZVJlYXNzaWdubWVudCgpLHRoaXMudmFyaWFibGUpdGhpcy52YXJpYWJsZS5kZW9wdGltaXplUGF0aChlKTtlbHNlIGlmKCF0aGlzLmlzVW5kZWZpbmVkJiZlLmxlbmd0aDw3KXtjb25zdCB0PXRoaXMuZ2V0UHJvcGVydHlLZXkoKTt0aGlzLm9iamVjdC5kZW9wdGltaXplUGF0aChbdD09PVc/cTp0LC4uLmVdKTt9fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpOnRoaXMuaXNVbmRlZmluZWQ/dm9pZCAwOnRoaXMucHJvcGVydHlLZXkhPT1XJiZlLmxlbmd0aDw3Pyh0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkLnB1c2gocyksdGhpcy5vYmplY3QuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKFt0aGlzLmdldFByb3BlcnR5S2V5KCksLi4uZV0sdCxzKSk6aWV9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTp0aGlzLmlzVW5kZWZpbmVkP1tucywhMV06dGhpcy5wcm9wZXJ0eUtleSE9PVcmJmUubGVuZ3RoPDc/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSx0aGlzLm9iamVjdC5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChbdGhpcy5nZXRQcm9wZXJ0eUtleSgpLC4uLmVdLHQscyxpKSk6YWV9aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMucHJvcGVydHkuaGFzRWZmZWN0cyhlKXx8dGhpcy5vYmplY3QuaGFzRWZmZWN0cyhlKXx8dGhpcy5oYXNBY2Nlc3NFZmZlY3QoZSl9aGFzRWZmZWN0c0FzQXNzaWdubWVudFRhcmdldChlLHQpe3JldHVybiB0JiYhdGhpcy5kZW9wdGltaXplZCYmdGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuYXNzaWdubWVudERlb3B0aW1pemVkfHx0aGlzLmFwcGx5QXNzaWdubWVudERlb3B0aW1pemF0aW9uKCksdGhpcy5wcm9wZXJ0eS5oYXNFZmZlY3RzKGUpfHx0aGlzLm9iamVjdC5oYXNFZmZlY3RzKGUpfHx0JiZ0aGlzLmhhc0FjY2Vzc0VmZmVjdChlKXx8dGhpcy5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChZLHRoaXMuYXNzaWdubWVudEludGVyYWN0aW9uLGUpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy52YXJpYWJsZT90aGlzLnZhcmlhYmxlLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTohIXRoaXMuaXNVbmRlZmluZWR8fCghKGUubGVuZ3RoPDcpfHx0aGlzLm9iamVjdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChbdGhpcy5nZXRQcm9wZXJ0eUtleSgpLC4uLmVdLHQscykpfWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlUHJvcGVydGllcyhlLHQpO31pbmNsdWRlQXNBc3NpZ25tZW50VGFyZ2V0KGUsdCxzKXt0aGlzLmFzc2lnbm1lbnREZW9wdGltaXplZHx8dGhpcy5hcHBseUFzc2lnbm1lbnREZW9wdGltaXphdGlvbigpLHM/dGhpcy5pbmNsdWRlKGUsdCk6dGhpcy5pbmNsdWRlUHJvcGVydGllcyhlLHQpO31pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe3RoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpOnN1cGVyLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLnByb3BlcnR5S2V5PUJuKHRoaXMpLHRoaXMuYWNjZXNzSW50ZXJhY3Rpb249e2FyZ3M6W3RoaXMub2JqZWN0XSx0eXBlOjB9O31pc1NraXBwZWRBc09wdGlvbmFsKGUpe3JldHVybiAhdGhpcy52YXJpYWJsZSYmIXRoaXMuaXNVbmRlZmluZWQmJih0aGlzLm9iamVjdC5pc1NraXBwZWRBc09wdGlvbmFsPy4oZSl8fHRoaXMub3B0aW9uYWwmJm51bGw9PXRoaXMub2JqZWN0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHRlLGUpKX1yZW5kZXIoZSx0LHtyZW5kZXJlZFBhcmVudFR5cGU6cyxpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6aSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpufT1mZSl7aWYodGhpcy52YXJpYWJsZXx8dGhpcy5pc1VuZGVmaW5lZCl7Y29uc3R7c25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOm59fT10O2xldCByPXRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXROYW1lKG4pOiJ1bmRlZmluZWQiO3MmJmkmJihyPSIwLCAiK3IpLGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdGhpcy5lbmQscix7Y29udGVudE9ubHk6ITAsc3RvcmVOYW1lOiEwfSk7fWVsc2UgcyYmaSYmZS5hcHBlbmRSaWdodCh0aGlzLnN0YXJ0LCIwLCAiKSx0aGlzLm9iamVjdC5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpufSksdGhpcy5wcm9wZXJ0eS5yZW5kZXIoZSx0KTt9c2V0QXNzaWduZWRWYWx1ZShlKXt0aGlzLmFzc2lnbm1lbnRJbnRlcmFjdGlvbj17YXJnczpbdGhpcy5vYmplY3QsZV0sdHlwZToxfTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwO2NvbnN0e3Byb3BlcnR5UmVhZFNpZGVFZmZlY3RzOmV9PXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZTtpZih0aGlzLmJvdW5kJiZlJiYhdGhpcy52YXJpYWJsZSYmIXRoaXMuaXNVbmRlZmluZWQpe2NvbnN0IGU9dGhpcy5nZXRQcm9wZXJ0eUtleSgpO3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuYWNjZXNzSW50ZXJhY3Rpb24sW2VdLHRlKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319YXBwbHlBc3NpZ25tZW50RGVvcHRpbWl6YXRpb24oKXt0aGlzLmFzc2lnbm1lbnREZW9wdGltaXplZD0hMDtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czplfT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7dGhpcy5ib3VuZCYmZSYmIXRoaXMudmFyaWFibGUmJiF0aGlzLmlzVW5kZWZpbmVkJiYodGhpcy5vYmplY3QuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgodGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb24sW3RoaXMuZ2V0UHJvcGVydHlLZXkoKV0sdGUpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCkpO31kaXNhbGxvd05hbWVzcGFjZVJlYXNzaWdubWVudCgpe2lmKHRoaXMub2JqZWN0IGluc3RhbmNlb2YgY24pe3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKHRoaXMub2JqZWN0Lm5hbWUpLmlzTmFtZXNwYWNlJiYodGhpcy52YXJpYWJsZSYmdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMudmFyaWFibGUpLHRoaXMuY29udGV4dC5sb2coU2UsVHQodGhpcy5vYmplY3QubmFtZSx0aGlzLmNvbnRleHQubW9kdWxlLmlkKSx0aGlzLnN0YXJ0KSk7fX1nZXRQcm9wZXJ0eUtleSgpe2lmKG51bGw9PT10aGlzLnByb3BlcnR5S2V5KXt0aGlzLnByb3BlcnR5S2V5PVc7Y29uc3QgZT10aGlzLnByb3BlcnR5LmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHRlLHRoaXMpO3JldHVybiB0aGlzLnByb3BlcnR5S2V5PWU9PT1LP2U6InN5bWJvbCI9PXR5cGVvZiBlP1c6U3RyaW5nKGUpfXJldHVybiB0aGlzLnByb3BlcnR5S2V5fWhhc0FjY2Vzc0VmZmVjdChlKXtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czp0fT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7cmV0dXJuICEodGhpcy52YXJpYWJsZXx8dGhpcy5pc1VuZGVmaW5lZCkmJnQmJigiYWx3YXlzIj09PXR8fHRoaXMub2JqZWN0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFt0aGlzLmdldFByb3BlcnR5S2V5KCldLHRoaXMuYWNjZXNzSW50ZXJhY3Rpb24sZSkpfWluY2x1ZGVQcm9wZXJ0aWVzKGUsdCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy52YXJpYWJsZSYmdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMudmFyaWFibGUpKSx0aGlzLm9iamVjdC5pbmNsdWRlKGUsdCksdGhpcy5wcm9wZXJ0eS5pbmNsdWRlKGUsdCk7fX1mdW5jdGlvbiBqbihlLHQscyl7aWYoMD09PXQubGVuZ3RoKXJldHVybiBlO2lmKCFlLmlzTmFtZXNwYWNlfHxlIGluc3RhbmNlb2YgcGUpcmV0dXJuIG51bGw7Y29uc3QgaT10WzBdLmtleSxuPWUuY29udGV4dC50cmFjZUV4cG9ydChpKTtpZighbil7aWYoMT09PXQubGVuZ3RoKXtjb25zdCBuPWUuY29udGV4dC5maWxlTmFtZTtyZXR1cm4gcy5sb2coU2UsanQoaSxzLm1vZHVsZS5pZCxuKSx0WzBdLnBvcyksInVuZGVmaW5lZCJ9cmV0dXJuIG51bGx9cmV0dXJuIGpuKG4sdC5zbGljZSgxKSxzKX1jbGFzcyBVbiBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLnJldHVybkV4cHJlc3Npb249bnVsbCx0aGlzLmRlb3B0aW1pemFibGVEZXBlbmRlbnRFeHByZXNzaW9ucz1bXSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPW5ldyBTZXQ7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtjb25zdHthcmdzOml9PWUsW24scl09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKHMpO2lmKHIpcmV0dXJuO2NvbnN0IG89aS5maWx0ZXIoKGU9PiEhZSYmZSE9PW9lKSk7aWYoMCE9PW8ubGVuZ3RoKWlmKG49PT1vZSlmb3IoY29uc3QgZSBvZiBvKWUuZGVvcHRpbWl6ZVBhdGgoWCk7ZWxzZSBzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKHQsbiwoKCk9Pntmb3IoY29uc3QgZSBvZiBvKXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO24uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO30pLG51bGwpO31kZW9wdGltaXplQ2FjaGUoKXtpZih0aGlzLnJldHVybkV4cHJlc3Npb24/LlswXSE9PW9lKXt0aGlzLnJldHVybkV4cHJlc3Npb249YWU7Y29uc3R7ZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zOmUsZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6dH09dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPXllLHRoaXMuZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zPWdlO2Zvcihjb25zdCB0IG9mIGUpdC5kZW9wdGltaXplQ2FjaGUoKTtmb3IoY29uc3QgZSBvZiB0KWUuZGVvcHRpbWl6ZVBhdGgoWCk7fX1kZW9wdGltaXplUGF0aChlKXtpZigwPT09ZS5sZW5ndGh8fHRoaXMuY29udGV4dC5kZW9wdGltaXphdGlvblRyYWNrZXIudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSlyZXR1cm47Y29uc3RbdF09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKCk7dCE9PW9lJiZ0LmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe2NvbnN0W2ldPXRoaXMuZ2V0UmV0dXJuRXhwcmVzc2lvbih0KTtyZXR1cm4gaT09PW9lP2llOnQud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgoZSxpLCgoKT0+KHRoaXMuZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zLnB1c2gocyksaS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpKSksaWUpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKHMpO3JldHVybiBuWzBdPT09b2U/bjpzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsbiwoKCk9Pnt0aGlzLmRlb3B0aW1pemFibGVEZXBlbmRlbnRFeHByZXNzaW9ucy5wdXNoKGkpO2NvbnN0W3Isb109blswXS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTtyZXR1cm4gW3Isb3x8blsxXV19KSxhZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0e3R5cGU6aX09dDtpZigyPT09aSl7Y29uc3R7YXJnczppLHdpdGhOZXc6bn09dDtpZigobj9zLmluc3RhbnRpYXRlZDpzLmNhbGxlZCkudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSxpLHRoaXMpKXJldHVybiAhMX1lbHNlIGlmKCgxPT09aT9zLmFzc2lnbmVkOnMuYWNjZXNzZWQpLnRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKGUsdGhpcykpcmV0dXJuICExO2NvbnN0W24scl09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKCk7cmV0dXJuICgxPT09aXx8IXIpJiZuLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX19Y2xhc3MgR24gZXh0ZW5kcyBVbntiaW5kKCl7aWYoc3VwZXIuYmluZCgpLHRoaXMuY2FsbGVlIGluc3RhbmNlb2YgY24pe3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKHRoaXMuY2FsbGVlLm5hbWUpLmlzTmFtZXNwYWNlJiZ0aGlzLmNvbnRleHQubG9nKFNlLE10KHRoaXMuY2FsbGVlLm5hbWUpLHRoaXMuc3RhcnQpLCJldmFsIj09PXRoaXMuY2FsbGVlLm5hbWUmJnRoaXMuY29udGV4dC5sb2coU2Use2NvZGU6IkVWQUwiLGlkOmU9dGhpcy5jb250ZXh0Lm1vZHVsZS5pZCxtZXNzYWdlOmBVc2Ugb2YgZXZhbCBpbiAiJHtUKGUpfSIgaXMgc3Ryb25nbHkgZGlzY291cmFnZWQgYXMgaXQgcG9zZXMgc2VjdXJpdHkgcmlza3MgYW5kIG1heSBjYXVzZSBpc3N1ZXMgd2l0aCBtaW5pZmljYXRpb24uYCx1cmw6T2UoInRyb3VibGVzaG9vdGluZy8jYXZvaWRpbmctZXZhbCIpfSx0aGlzLnN0YXJ0KTt9dmFyIGU7dGhpcy5pbnRlcmFjdGlvbj17YXJnczpbdGhpcy5jYWxsZWUgaW5zdGFuY2VvZiBGbiYmIXRoaXMuY2FsbGVlLnZhcmlhYmxlP3RoaXMuY2FsbGVlLm9iamVjdDpudWxsLC4uLnRoaXMuYXJndW1lbnRzXSx0eXBlOjIsd2l0aE5ldzohMX07fWhhc0VmZmVjdHMoZSl7dHJ5e2Zvcihjb25zdCB0IG9mIHRoaXMuYXJndW1lbnRzKWlmKHQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7cmV0dXJuICF0aGlzLmFubm90YXRpb25QdXJlJiYodGhpcy5jYWxsZWUuaGFzRWZmZWN0cyhlKXx8dGhpcy5jYWxsZWUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSx0aGlzLmludGVyYWN0aW9uLGUpKX1maW5hbGx5e3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKTt9fWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdD8oc3VwZXIuaW5jbHVkZShlLHQpLHQ9PT1acyYmdGhpcy5jYWxsZWUgaW5zdGFuY2VvZiBjbiYmdGhpcy5jYWxsZWUudmFyaWFibGUmJnRoaXMuY2FsbGVlLnZhcmlhYmxlLm1hcmtDYWxsZWRGcm9tVHJ5U3RhdGVtZW50KCkpOih0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY2FsbGVlLmluY2x1ZGUoZSwhMSkpLHRoaXMuY2FsbGVlLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdGhpcy5hcmd1bWVudHMpO31pc1NraXBwZWRBc09wdGlvbmFsKGUpe3JldHVybiB0aGlzLmNhbGxlZS5pc1NraXBwZWRBc09wdGlvbmFsPy4oZSl8fHRoaXMub3B0aW9uYWwmJm51bGw9PXRoaXMuY2FsbGVlLmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHRlLGUpfXJlbmRlcihlLHQse3JlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnN9PWZlKXt0aGlzLmNhbGxlZS5yZW5kZXIoZSx0LHtpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6ITAscmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c30pLFRuKGUsdCx0aGlzKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMuY2FsbGVlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuaW50ZXJhY3Rpb24sWSx0ZSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9Z2V0UmV0dXJuRXhwcmVzc2lvbihlPXRlKXtyZXR1cm4gbnVsbD09PXRoaXMucmV0dXJuRXhwcmVzc2lvbj8odGhpcy5yZXR1cm5FeHByZXNzaW9uPWFlLHRoaXMucmV0dXJuRXhwcmVzc2lvbj10aGlzLmNhbGxlZS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChZLHRoaXMuaW50ZXJhY3Rpb24sZSx0aGlzKSk6dGhpcy5yZXR1cm5FeHByZXNzaW9ufX1jbGFzcyBXbiBleHRlbmRzIFZpe2FkZERlY2xhcmF0aW9uKGUsdCxzLGkpe2NvbnN0IG49dGhpcy52YXJpYWJsZXMuZ2V0KGUubmFtZSk7cmV0dXJuIG4/KHRoaXMucGFyZW50LmFkZERlY2xhcmF0aW9uKGUsdCxucyxpKSxuLmFkZERlY2xhcmF0aW9uKGUscyksbik6dGhpcy5wYXJlbnQuYWRkRGVjbGFyYXRpb24oZSx0LHMsaSl9fWNsYXNzIHFuIGV4dGVuZHMgVGl7Y29uc3RydWN0b3IoZSx0LHMpe3N1cGVyKGUpLHRoaXMudmFyaWFibGVzLnNldCgidGhpcyIsdGhpcy50aGlzVmFyaWFibGU9bmV3IHdpKCJ0aGlzIixudWxsLHQscykpLHRoaXMuaW5zdGFuY2VTY29wZT1uZXcgVGkodGhpcyksdGhpcy5pbnN0YW5jZVNjb3BlLnZhcmlhYmxlcy5zZXQoInRoaXMiLG5ldyBSbihzKSk7fWZpbmRMZXhpY2FsQm91bmRhcnkoKXtyZXR1cm4gdGhpc319Y2xhc3MgSG4gZXh0ZW5kcyBKc3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5hY2Nlc3NlZFZhbHVlPW51bGw7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PWUudHlwZSYmImdldCI9PT10aGlzLmtpbmQmJjA9PT10Lmxlbmd0aHx8MT09PWUudHlwZSYmInNldCI9PT10aGlzLmtpbmQmJjA9PT10Lmxlbmd0aD90aGlzLnZhbHVlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHthcmdzOmUuYXJncyx0eXBlOjIsd2l0aE5ldzohMX0sWSxzKTp2b2lkIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX1kZW9wdGltaXplQ2FjaGUoKXt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5nZXRBY2Nlc3NlZFZhbHVlKClbMF0uZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpfWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMua2V5Lmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAiZ2V0Ij09PXRoaXMua2luZCYmMD09PXQudHlwZSYmMD09PWUubGVuZ3RofHwic2V0Ij09PXRoaXMua2luZCYmMT09PXQudHlwZT90aGlzLnZhbHVlLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFkse2FyZ3M6dC5hcmdzLHR5cGU6Mix3aXRoTmV3OiExfSxzKTp0aGlzLmdldEFjY2Vzc2VkVmFsdWUoKVswXS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9Z2V0QWNjZXNzZWRWYWx1ZSgpe3JldHVybiBudWxsPT09dGhpcy5hY2Nlc3NlZFZhbHVlPyJnZXQiPT09dGhpcy5raW5kPyh0aGlzLmFjY2Vzc2VkVmFsdWU9YWUsdGhpcy5hY2Nlc3NlZFZhbHVlPXRoaXMudmFsdWUuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoWSx1ZSx0ZSx0aGlzKSk6dGhpcy5hY2Nlc3NlZFZhbHVlPVt0aGlzLnZhbHVlLCExXTp0aGlzLmFjY2Vzc2VkVmFsdWV9fWNsYXNzIEtuIGV4dGVuZHMgSG57YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fWNsYXNzIFluIGV4dGVuZHMgcmV7Y29uc3RydWN0b3IoZSx0KXtzdXBlcigpLHRoaXMub2JqZWN0PWUsdGhpcy5rZXk9dDt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsW3RoaXMua2V5LC4uLnRdLHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLm9iamVjdC5kZW9wdGltaXplUGF0aChbdGhpcy5rZXksLi4uZV0pO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLm9iamVjdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoW3RoaXMua2V5LC4uLmVdLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMub2JqZWN0LmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKFt0aGlzLmtleSwuLi5lXSx0LHMsaSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLm9iamVjdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChbdGhpcy5rZXksLi4uZV0sdCxzKX19Y2xhc3MgWG4gZXh0ZW5kcyBKc3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgVGkoZSk7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZUNhY2hlKCl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQWxsUHJvcGVydGllcygpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLmdldE9iamVjdEVudGl0eSgpLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl9aGFzRWZmZWN0cyhlKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7Y29uc3QgdD10aGlzLnN1cGVyQ2xhc3M/Lmhhc0VmZmVjdHMoZSl8fHRoaXMuYm9keS5oYXNFZmZlY3RzKGUpO3JldHVybiB0aGlzLmlkPy5tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCksdHx8c3VwZXIuaGFzRWZmZWN0cyhlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIDI9PT10LnR5cGUmJjA9PT1lLmxlbmd0aD8hdC53aXRoTmV3fHwobnVsbD09PXRoaXMuY2xhc3NDb25zdHJ1Y3Rvcj90aGlzLnN1cGVyQ2xhc3M/Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTp0aGlzLmNsYXNzQ29uc3RydWN0b3IuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXx8ITE6dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZShlLHQpe3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSx0aGlzLmluY2x1ZGVkPSEwLHRoaXMuc3VwZXJDbGFzcz8uaW5jbHVkZShlLHQpLHRoaXMuYm9keS5pbmNsdWRlKGUsdCksdGhpcy5pZCYmKHRoaXMuaWQubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpLHRoaXMuaWQuaW5jbHVkZSgpKTt9aW5pdGlhbGlzZSgpe3RoaXMuaWQ/LmRlY2xhcmUoImNsYXNzIix0aGlzKTtmb3IoY29uc3QgZSBvZiB0aGlzLmJvZHkuYm9keSlpZihlIGluc3RhbmNlb2YgS24mJiJjb25zdHJ1Y3RvciI9PT1lLmtpbmQpcmV0dXJuIHZvaWQodGhpcy5jbGFzc0NvbnN0cnVjdG9yPWUpO3RoaXMuY2xhc3NDb25zdHJ1Y3Rvcj1udWxsO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITA7Zm9yKGNvbnN0IGUgb2YgdGhpcy5ib2R5LmJvZHkpZS5zdGF0aWN8fGUgaW5zdGFuY2VvZiBLbiYmImNvbnN0cnVjdG9yIj09PWUua2luZHx8ZS5kZW9wdGltaXplUGF0aChYKTt0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO31nZXRPYmplY3RFbnRpdHkoKXtpZihudWxsIT09dGhpcy5vYmplY3RFbnRpdHkpcmV0dXJuIHRoaXMub2JqZWN0RW50aXR5O2NvbnN0IGU9W10sdD1bXTtmb3IoY29uc3QgcyBvZiB0aGlzLmJvZHkuYm9keSl7Y29uc3QgaT1zLnN0YXRpYz9lOnQsbj1zLmtpbmQ7aWYoaT09PXQmJiFuKWNvbnRpbnVlO2NvbnN0IHI9InNldCI9PT1ufHwiZ2V0Ij09PW4/bjoiaW5pdCI7bGV0IG87aWYocy5jb21wdXRlZCl7Y29uc3QgZT1zLmtleS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoWSx0ZSx0aGlzKTtpZigic3ltYm9sIj09dHlwZW9mIGUpe2kucHVzaCh7a2V5Olcsa2luZDpyLHByb3BlcnR5OnN9KTtjb250aW51ZX1vPVN0cmluZyhlKTt9ZWxzZSBvPXMua2V5IGluc3RhbmNlb2YgY24/cy5rZXkubmFtZTpTdHJpbmcocy5rZXkudmFsdWUpO2kucHVzaCh7a2V5Om8sa2luZDpyLHByb3BlcnR5OnN9KTt9cmV0dXJuIGUudW5zaGlmdCh7a2V5OiJwcm90b3R5cGUiLGtpbmQ6ImluaXQiLHByb3BlcnR5Om5ldyBhaSh0LHRoaXMuc3VwZXJDbGFzcz9uZXcgWW4odGhpcy5zdXBlckNsYXNzLCJwcm90b3R5cGUiKTpoaSl9KSx0aGlzLm9iamVjdEVudGl0eT1uZXcgYWkoZSx0aGlzLnN1cGVyQ2xhc3N8fGhpKX19Y2xhc3MgUW4gZXh0ZW5kcyBYbntpbml0aWFsaXNlKCl7c3VwZXIuaW5pdGlhbGlzZSgpLG51bGwhPT10aGlzLmlkJiYodGhpcy5pZC52YXJpYWJsZS5pc0lkPSEwKTt9cGFyc2VOb2RlKGUpe251bGwhPT1lLmlkJiYodGhpcy5pZD1uZXcgY24oZS5pZCx0aGlzLHRoaXMuc2NvcGUucGFyZW50KSksc3VwZXIucGFyc2VOb2RlKGUpO31yZW5kZXIoZSx0KXtjb25zdHtleHBvcnROYW1lc0J5VmFyaWFibGU6cyxmb3JtYXQ6aSxzbmlwcGV0czp7XzpuLGdldFByb3BlcnR5QWNjZXNzOnJ9fT10O2lmKHRoaXMuaWQpe2NvbnN0e3ZhcmlhYmxlOm8sbmFtZTphfT10aGlzLmlkOyJzeXN0ZW0iPT09aSYmcy5oYXMobykmJmUuYXBwZW5kTGVmdCh0aGlzLmVuZCxgJHtufSR7UG4oW29dLHQpfTtgKTtjb25zdCBsPW8uZ2V0TmFtZShyKTtpZihsIT09YSlyZXR1cm4gdGhpcy5zdXBlckNsYXNzPy5yZW5kZXIoZSx0KSx0aGlzLmJvZHkucmVuZGVyKGUsey4uLnQsdXNlT3JpZ2luYWxOYW1lOmU9PmU9PT1vfSksZS5wcmVwZW5kUmlnaHQodGhpcy5zdGFydCxgbGV0ICR7bH0ke259PSR7bn1gKSx2b2lkIGUucHJlcGVuZExlZnQodGhpcy5lbmQsIjsiKX1zdXBlci5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXtzdXBlci5hcHBseURlb3B0aW1pemF0aW9ucygpO2NvbnN0e2lkOmUsc2NvcGU6dH09dGhpcztpZihlKXtjb25zdHtuYW1lOnMsdmFyaWFibGU6aX09ZTtmb3IoY29uc3QgZSBvZiB0LmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy52YWx1ZXMoKSllIT09aSYmZS5mb3JiaWROYW1lKHMpO319fWNsYXNzIFpuIGV4dGVuZHMgWG57cmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c309ZmUpe3N1cGVyLnJlbmRlcihlLHQpLHM9PT1fcyYmKGUuYXBwZW5kUmlnaHQodGhpcy5zdGFydCwiKCIpLGUucHJlcGVuZExlZnQodGhpcy5lbmQsIikiKSk7fX1jbGFzcyBKbiBleHRlbmRzIHJle2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksdGhpcy5leHByZXNzaW9ucz1lLHRoaXMuaW5jbHVkZWQ9ITE7fWRlb3B0aW1pemVQYXRoKGUpe2Zvcihjb25zdCB0IG9mIHRoaXMuZXhwcmVzc2lvbnMpdC5kZW9wdGltaXplUGF0aChlKTt9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIFtuZXcgSm4odGhpcy5leHByZXNzaW9ucy5tYXAoKG49Pm4uZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF0pKSksITFdfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtmb3IoY29uc3QgaSBvZiB0aGlzLmV4cHJlc3Npb25zKWlmKGkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXJldHVybiAhMDtyZXR1cm4gITF9fWZ1bmN0aW9uIGVyKGUsdCl7Y29uc3R7YnJva2VuRmxvdzpzLGhhc0JyZWFrOmksaGFzQ29udGludWU6bixpZ25vcmU6cn09ZSx7YnJlYWtzOm8sY29udGludWVzOmF9PXI7cmV0dXJuIHIuYnJlYWtzPSEwLHIuY29udGludWVzPSEwLGUuaGFzQnJlYWs9ITEsZS5oYXNDb250aW51ZT0hMSwhIXQuaGFzRWZmZWN0cyhlKXx8KHIuYnJlYWtzPW8sci5jb250aW51ZXM9YSxlLmhhc0JyZWFrPWksZS5oYXNDb250aW51ZT1uLGUuYnJva2VuRmxvdz1zLCExKX1mdW5jdGlvbiB0cihlLHQscyl7Y29uc3R7YnJva2VuRmxvdzppLGhhc0JyZWFrOm4saGFzQ29udGludWU6cn09ZTtlLmhhc0JyZWFrPSExLGUuaGFzQ29udGludWU9ITEsdC5pbmNsdWRlKGUscyx7YXNTaW5nbGVTdGF0ZW1lbnQ6ITB9KSxlLmhhc0JyZWFrPW4sZS5oYXNDb250aW51ZT1yLGUuYnJva2VuRmxvdz1pO31jbGFzcyBzciBleHRlbmRzIEpze2hhc0VmZmVjdHMoKXtyZXR1cm4gITF9aW5pdGlhbGlzZSgpe3RoaXMuY29udGV4dC5hZGRFeHBvcnQodGhpcyk7fXJlbmRlcihlLHQscyl7ZS5yZW1vdmUocy5zdGFydCxzLmVuZCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1zci5wcm90b3R5cGUubmVlZHNCb3VuZGFyaWVzPSEwO2NsYXNzIGlyIGV4dGVuZHMgT257aW5pdGlhbGlzZSgpe3N1cGVyLmluaXRpYWxpc2UoKSxudWxsIT09dGhpcy5pZCYmKHRoaXMuaWQudmFyaWFibGUuaXNJZD0hMCk7fXBhcnNlTm9kZShlKXtudWxsIT09ZS5pZCYmKHRoaXMuaWQ9bmV3IGNuKGUuaWQsdGhpcyx0aGlzLnNjb3BlLnBhcmVudCkpLHN1cGVyLnBhcnNlTm9kZShlKTt9fWNsYXNzIG5yIGV4dGVuZHMgSnN7aW5jbHVkZShlLHQpe3N1cGVyLmluY2x1ZGUoZSx0KSx0JiZ0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy52YXJpYWJsZSk7fWluaXRpYWxpc2UoKXtjb25zdCBlPXRoaXMuZGVjbGFyYXRpb247dGhpcy5kZWNsYXJhdGlvbk5hbWU9ZS5pZCYmZS5pZC5uYW1lfHx0aGlzLmRlY2xhcmF0aW9uLm5hbWUsdGhpcy52YXJpYWJsZT10aGlzLnNjb3BlLmFkZEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbih0aGlzLmRlY2xhcmF0aW9uTmFtZXx8dGhpcy5jb250ZXh0LmdldE1vZHVsZU5hbWUoKSx0aGlzLHRoaXMuY29udGV4dCksdGhpcy5jb250ZXh0LmFkZEV4cG9ydCh0aGlzKTt9cmVuZGVyKGUsdCxzKXtjb25zdHtzdGFydDppLGVuZDpufT1zLHI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZ24oZSxmbihlLCJkZWZhdWx0Iix0KSs3KX0oZS5vcmlnaW5hbCx0aGlzLnN0YXJ0KTtpZih0aGlzLmRlY2xhcmF0aW9uIGluc3RhbmNlb2YgaXIpdGhpcy5yZW5kZXJOYW1lZERlY2xhcmF0aW9uKGUscixudWxsPT09dGhpcy5kZWNsYXJhdGlvbi5pZD9mdW5jdGlvbihlLHQpe2NvbnN0IHM9Zm4oZSwiZnVuY3Rpb24iLHQpKzg7ZT1lLnNsaWNlKHMsZm4oZSwiKCIscykpO2NvbnN0IGk9Zm4oZSwiKiIpO3JldHVybiAtMT09PWk/czpzK2krMX0oZS5vcmlnaW5hbCxyKTpudWxsLHQpO2Vsc2UgaWYodGhpcy5kZWNsYXJhdGlvbiBpbnN0YW5jZW9mIFFuKXRoaXMucmVuZGVyTmFtZWREZWNsYXJhdGlvbihlLHIsbnVsbD09PXRoaXMuZGVjbGFyYXRpb24uaWQ/Zm4oZS5vcmlnaW5hbCwiY2xhc3MiLGkpKzU6bnVsbCx0KTtlbHNlIHtpZih0aGlzLnZhcmlhYmxlLmdldE9yaWdpbmFsVmFyaWFibGUoKSE9PXRoaXMudmFyaWFibGUpcmV0dXJuIHZvaWQgdW4odGhpcyxlLGksbik7aWYoIXRoaXMudmFyaWFibGUuaW5jbHVkZWQpcmV0dXJuIGUucmVtb3ZlKHRoaXMuc3RhcnQsciksdGhpcy5kZWNsYXJhdGlvbi5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpfc30pLHZvaWQoIjsiIT09ZS5vcmlnaW5hbFt0aGlzLmVuZC0xXSYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLCI7IikpO3RoaXMucmVuZGVyVmFyaWFibGVEZWNsYXJhdGlvbihlLHIsdCk7fXRoaXMuZGVjbGFyYXRpb24ucmVuZGVyKGUsdCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fXJlbmRlck5hbWVkRGVjbGFyYXRpb24oZSx0LHMsaSl7Y29uc3R7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOm4sZm9ybWF0OnIsc25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOm99fT1pLGE9dGhpcy52YXJpYWJsZS5nZXROYW1lKG8pO2UucmVtb3ZlKHRoaXMuc3RhcnQsdCksbnVsbCE9PXMmJmUuYXBwZW5kTGVmdChzLGAgJHthfWApLCJzeXN0ZW0iPT09ciYmdGhpcy5kZWNsYXJhdGlvbiBpbnN0YW5jZW9mIFFuJiZuLmhhcyh0aGlzLnZhcmlhYmxlKSYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLGAgJHtQbihbdGhpcy52YXJpYWJsZV0saSl9O2ApO31yZW5kZXJWYXJpYWJsZURlY2xhcmF0aW9uKGUsdCx7Zm9ybWF0OnMsZXhwb3J0TmFtZXNCeVZhcmlhYmxlOmksc25pcHBldHM6e2Nuc3Q6bixnZXRQcm9wZXJ0eUFjY2VzczpyfX0pe2NvbnN0IG89NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSksYT0ic3lzdGVtIj09PXMmJmkuZ2V0KHRoaXMudmFyaWFibGUpO2E/KGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdCxgJHtufSAke3RoaXMudmFyaWFibGUuZ2V0TmFtZShyKX0gPSBleHBvcnRzKCcke2FbMF19JywgYCksZS5hcHBlbmRSaWdodChvP3RoaXMuZW5kLTE6dGhpcy5lbmQsIikiKyhvPyIiOiI7IikpKTooZS5vdmVyd3JpdGUodGhpcy5zdGFydCx0LGAke259ICR7dGhpcy52YXJpYWJsZS5nZXROYW1lKHIpfSA9IGApLG98fGUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpKTt9fW5yLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3MgcnIgZXh0ZW5kcyBKc3tiaW5kKCl7dGhpcy5kZWNsYXJhdGlvbj8uYmluZCgpO31oYXNFZmZlY3RzKGUpe3JldHVybiAhIXRoaXMuZGVjbGFyYXRpb24/Lmhhc0VmZmVjdHMoZSl9aW5pdGlhbGlzZSgpe3RoaXMuY29udGV4dC5hZGRFeHBvcnQodGhpcyk7fXJlbmRlcihlLHQscyl7Y29uc3R7c3RhcnQ6aSxlbmQ6bn09cztudWxsPT09dGhpcy5kZWNsYXJhdGlvbj9lLnJlbW92ZShpLG4pOihlLnJlbW92ZSh0aGlzLnN0YXJ0LHRoaXMuZGVjbGFyYXRpb24uc3RhcnQpLHRoaXMuZGVjbGFyYXRpb24ucmVuZGVyKGUsdCx7ZW5kOm4sc3RhcnQ6aX0pKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fXJyLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3Mgb3IgZXh0ZW5kcyBPbntyZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpzfT1mZSl7c3VwZXIucmVuZGVyKGUsdCkscz09PV9zJiYoZS5hcHBlbmRSaWdodCh0aGlzLnN0YXJ0LCIoIiksZS5wcmVwZW5kTGVmdCh0aGlzLmVuZCwiKSIpKTt9fWNsYXNzIGFyIGV4dGVuZHMgdm57Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuaG9pc3RlZERlY2xhcmF0aW9ucz1bXTt9YWRkRGVjbGFyYXRpb24oZSx0LHMsaSl7cmV0dXJuIHRoaXMuaG9pc3RlZERlY2xhcmF0aW9ucy5wdXNoKGUpLHN1cGVyLmFkZERlY2xhcmF0aW9uKGUsdCxzLGkpfX1jb25zdCBscj1TeW1ib2woInVuc2V0Iik7Y2xhc3MgY3IgZXh0ZW5kcyBKc3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy50ZXN0VmFsdWU9bHI7fWRlb3B0aW1pemVDYWNoZSgpe3RoaXMudGVzdFZhbHVlPWllO31oYXNFZmZlY3RzKGUpe2lmKHRoaXMudGVzdC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtjb25zdCB0PXRoaXMuZ2V0VGVzdFZhbHVlKCk7aWYoInN5bWJvbCI9PXR5cGVvZiB0KXtjb25zdHticm9rZW5GbG93OnR9PWU7aWYodGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSkpcmV0dXJuICEwO2NvbnN0IHM9ZS5icm9rZW5GbG93O3JldHVybiBlLmJyb2tlbkZsb3c9dCxudWxsPT09dGhpcy5hbHRlcm5hdGU/ITE6ISF0aGlzLmFsdGVybmF0ZS5oYXNFZmZlY3RzKGUpfHwoZS5icm9rZW5GbG93PWUuYnJva2VuRmxvdyYmcywhMSl9cmV0dXJuIHQ/dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSk6ISF0aGlzLmFsdGVybmF0ZT8uaGFzRWZmZWN0cyhlKX1pbmNsdWRlKGUsdCl7aWYodGhpcy5pbmNsdWRlZD0hMCx0KXRoaXMuaW5jbHVkZVJlY3Vyc2l2ZWx5KHQsZSk7ZWxzZSB7Y29uc3QgdD10aGlzLmdldFRlc3RWYWx1ZSgpOyJzeW1ib2wiPT10eXBlb2YgdD90aGlzLmluY2x1ZGVVbmtub3duVGVzdChlKTp0aGlzLmluY2x1ZGVLbm93blRlc3QoZSx0KTt9fXBhcnNlTm9kZShlKXt0aGlzLmNvbnNlcXVlbnRTY29wZT1uZXcgYXIodGhpcy5zY29wZSksdGhpcy5jb25zZXF1ZW50PW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKGUuY29uc2VxdWVudC50eXBlKSkoZS5jb25zZXF1ZW50LHRoaXMsdGhpcy5jb25zZXF1ZW50U2NvcGUpLGUuYWx0ZXJuYXRlJiYodGhpcy5hbHRlcm5hdGVTY29wZT1uZXcgYXIodGhpcy5zY29wZSksdGhpcy5hbHRlcm5hdGU9bmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3IoZS5hbHRlcm5hdGUudHlwZSkpKGUuYWx0ZXJuYXRlLHRoaXMsdGhpcy5hbHRlcm5hdGVTY29wZSkpLHN1cGVyLnBhcnNlTm9kZShlKTt9cmVuZGVyKGUsdCl7Y29uc3R7c25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOnN9fT10LGk9dGhpcy5nZXRUZXN0VmFsdWUoKSxuPVtdLHI9dGhpcy50ZXN0LmluY2x1ZGVkLG89IXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZTtyP3RoaXMudGVzdC5yZW5kZXIoZSx0KTplLnJlbW92ZSh0aGlzLnN0YXJ0LHRoaXMuY29uc2VxdWVudC5zdGFydCksdGhpcy5jb25zZXF1ZW50LmluY2x1ZGVkJiYob3x8InN5bWJvbCI9PXR5cGVvZiBpfHxpKT90aGlzLmNvbnNlcXVlbnQucmVuZGVyKGUsdCk6KGUub3ZlcndyaXRlKHRoaXMuY29uc2VxdWVudC5zdGFydCx0aGlzLmNvbnNlcXVlbnQuZW5kLHI/IjsiOiIiKSxuLnB1c2goLi4udGhpcy5jb25zZXF1ZW50U2NvcGUuaG9pc3RlZERlY2xhcmF0aW9ucykpLHRoaXMuYWx0ZXJuYXRlJiYoIXRoaXMuYWx0ZXJuYXRlLmluY2x1ZGVkfHwhbyYmInN5bWJvbCIhPXR5cGVvZiBpJiZpPyhyJiZ0aGlzLnNob3VsZEtlZXBBbHRlcm5hdGVCcmFuY2goKT9lLm92ZXJ3cml0ZSh0aGlzLmFsdGVybmF0ZS5zdGFydCx0aGlzLmVuZCwiOyIpOmUucmVtb3ZlKHRoaXMuY29uc2VxdWVudC5lbmQsdGhpcy5lbmQpLG4ucHVzaCguLi50aGlzLmFsdGVybmF0ZVNjb3BlLmhvaXN0ZWREZWNsYXJhdGlvbnMpKToocj8xMDE9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5hbHRlcm5hdGUuc3RhcnQtMSkmJmUucHJlcGVuZExlZnQodGhpcy5hbHRlcm5hdGUuc3RhcnQsIiAiKTplLnJlbW92ZSh0aGlzLmNvbnNlcXVlbnQuZW5kLHRoaXMuYWx0ZXJuYXRlLnN0YXJ0KSx0aGlzLmFsdGVybmF0ZS5yZW5kZXIoZSx0KSkpLHRoaXMucmVuZGVySG9pc3RlZERlY2xhcmF0aW9ucyhuLGUscyk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fWdldFRlc3RWYWx1ZSgpe3JldHVybiB0aGlzLnRlc3RWYWx1ZT09PWxyP3RoaXMudGVzdFZhbHVlPXRoaXMudGVzdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoWSx0ZSx0aGlzKTp0aGlzLnRlc3RWYWx1ZX1pbmNsdWRlS25vd25UZXN0KGUsdCl7dGhpcy50ZXN0LnNob3VsZEJlSW5jbHVkZWQoZSkmJnRoaXMudGVzdC5pbmNsdWRlKGUsITEpLHQmJnRoaXMuY29uc2VxdWVudC5zaG91bGRCZUluY2x1ZGVkKGUpJiZ0aGlzLmNvbnNlcXVlbnQuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pLCF0JiZ0aGlzLmFsdGVybmF0ZT8uc2hvdWxkQmVJbmNsdWRlZChlKSYmdGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pO31pbmNsdWRlUmVjdXJzaXZlbHkoZSx0KXt0aGlzLnRlc3QuaW5jbHVkZSh0LGUpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKHQsZSksdGhpcy5hbHRlcm5hdGU/LmluY2x1ZGUodCxlKTt9aW5jbHVkZVVua25vd25UZXN0KGUpe3RoaXMudGVzdC5pbmNsdWRlKGUsITEpO2NvbnN0e2Jyb2tlbkZsb3c6dH09ZTtsZXQgcz0hMTt0aGlzLmNvbnNlcXVlbnQuc2hvdWxkQmVJbmNsdWRlZChlKSYmKHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKGUsITEse2FzU2luZ2xlU3RhdGVtZW50OiEwfSkscz1lLmJyb2tlbkZsb3csZS5icm9rZW5GbG93PXQpLHRoaXMuYWx0ZXJuYXRlPy5zaG91bGRCZUluY2x1ZGVkKGUpJiYodGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pLGUuYnJva2VuRmxvdz1lLmJyb2tlbkZsb3cmJnMpO31yZW5kZXJIb2lzdGVkRGVjbGFyYXRpb25zKGUsdCxzKXtjb25zdCBpPVsuLi5uZXcgU2V0KGUubWFwKChlPT57Y29uc3QgdD1lLnZhcmlhYmxlO3JldHVybiB0LmluY2x1ZGVkP3QuZ2V0TmFtZShzKToiIn0pKSldLmZpbHRlcihCb29sZWFuKS5qb2luKCIsICIpO2lmKGkpe2NvbnN0IGU9dGhpcy5wYXJlbnQudHlwZSxzPWUhPT1McyYmZSE9PUlzO3QucHJlcGVuZFJpZ2h0KHRoaXMuc3RhcnQsYCR7cz8ieyAiOiIifXZhciAke2l9OyBgKSxzJiZ0LmFwcGVuZExlZnQodGhpcy5lbmQsIiB9Iik7fX1zaG91bGRLZWVwQWx0ZXJuYXRlQnJhbmNoKCl7bGV0IGU9dGhpcy5wYXJlbnQ7ZG97aWYoZSBpbnN0YW5jZW9mIGNyJiZlLmFsdGVybmF0ZSlyZXR1cm4gITA7aWYoZSBpbnN0YW5jZW9mIEFuKXJldHVybiAhMTtlPWUucGFyZW50O313aGlsZShlKTtyZXR1cm4gITF9fWNsYXNzIGhyIGV4dGVuZHMgSnN7YmluZCgpe31oYXNFZmZlY3RzKCl7cmV0dXJuICExfWluaXRpYWxpc2UoKXt0aGlzLmNvbnRleHQuYWRkSW1wb3J0KHRoaXMpO31yZW5kZXIoZSx0LHMpe2UucmVtb3ZlKHMuc3RhcnQscy5lbmQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319aHIucHJvdG90eXBlLm5lZWRzQm91bmRhcmllcz0hMDtjbGFzcyB1ciBleHRlbmRzIEpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1jb25zdCBkcj0iX2ludGVyb3BEZWZhdWx0Iixwcj0iX2ludGVyb3BEZWZhdWx0Q29tcGF0Iixmcj0iX2ludGVyb3BOYW1lc3BhY2UiLG1yPSJfaW50ZXJvcE5hbWVzcGFjZUNvbXBhdCIsZ3I9Il9pbnRlcm9wTmFtZXNwYWNlRGVmYXVsdCIseXI9Il9pbnRlcm9wTmFtZXNwYWNlRGVmYXVsdE9ubHkiLHhyPSJfbWVyZ2VOYW1lc3BhY2VzIixFcj17YXV0bzpkcixjb21wYXQ6cHIsZGVmYXVsdDpudWxsLGRlZmF1bHRPbmx5Om51bGwsZXNNb2R1bGU6bnVsbH0sYnI9KGUsdCk9PiJlc01vZHVsZSI9PT1lfHx0JiYoImF1dG8iPT09ZXx8ImNvbXBhdCI9PT1lKSx2cj17YXV0bzpmcixjb21wYXQ6bXIsZGVmYXVsdDpncixkZWZhdWx0T25seTp5cixlc01vZHVsZTpudWxsfSxTcj0oZSx0KT0+ImVzTW9kdWxlIiE9PWUmJmJyKGUsdCksQXI9KGUsdCxzLGksbixyLG8pPT57Y29uc3QgYT1uZXcgU2V0KGUpO2Zvcihjb25zdCBlIG9mIFRyKXQuaGFzKGUpJiZhLmFkZChlKTtyZXR1cm4gVHIubWFwKChlPT5hLmhhcyhlKT9rcltlXShzLGksbixyLG8sYSk6IiIpKS5qb2luKCIiKX0sa3I9e1twcl0oZSx0LHMpe2NvbnN0e186aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn09dCxbbyxhXT1uKFsiZSJdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOnByfSk7cmV0dXJuIGAke299JHtQcih0KX0ke2l9PyR7aX0ke3M/SXIodCk6d3IodCl9JHthfSR7cn0ke3J9YH0sW2RyXShlLHQscyl7Y29uc3R7XzppLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOm4sbjpyfT10LFtvLGFdPW4oWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6ZHJ9KTtyZXR1cm4gYCR7b31lJHtpfSYmJHtpfWUuX19lc01vZHVsZSR7aX0/JHtpfSR7cz9Jcih0KTp3cih0KX0ke2F9JHtyfSR7cn1gfSxbbXJdKGUsdCxzLGksbixyKXtjb25zdHtfOm8sZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246YSxuOmx9PXQ7aWYoci5oYXMoZ3IpKXtjb25zdFtlLHNdPWEoWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bXJ9KTtyZXR1cm4gYCR7ZX0ke1ByKHQpfSR7b30/JHtvfWUke299OiR7b30ke2dyfShlKSR7c30ke2x9JHtsfWB9cmV0dXJuIGBmdW5jdGlvbiAke21yfShlKSR7b317JHtsfSR7ZX1pZiR7b30oJHtQcih0KX0pJHtvfXJldHVybiBlOyR7bH1gK0NyKGUsZSx0LHMsaSxuKStgfSR7bH0ke2x9YH0sW3lyXShlLHQscyxpLG4pe2NvbnN0e2dldERpcmVjdFJldHVybkZ1bmN0aW9uOnIsZ2V0T2JqZWN0Om8sbjphfT10LFtsLGNdPXIoWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6eXJ9KTtyZXR1cm4gYCR7bH0ke0RyKGksTHIobixvKFtbIl9fcHJvdG9fXyIsIm51bGwiXSxbImRlZmF1bHQiLCJlIl1dLHtsaW5lQnJlYWtJbmRlbnQ6bnVsbH0pLHQpKX0ke2N9JHthfSR7YX1gfSxbZ3JdKGUsdCxzLGksbil7Y29uc3R7XzpyLG46b309dDtyZXR1cm4gYGZ1bmN0aW9uICR7Z3J9KGUpJHtyfXske299YCtDcihlLGUsdCxzLGksbikrYH0ke299JHtvfWB9LFtmcl0oZSx0LHMsaSxuLHIpe2NvbnN0e186byxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjphLG46bH09dDtpZihyLmhhcyhncikpe2NvbnN0W2UsdF09YShbImUiXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpmcn0pO3JldHVybiBgJHtlfWUke299JiYke299ZS5fX2VzTW9kdWxlJHtvfT8ke299ZSR7b306JHtvfSR7Z3J9KGUpJHt0fSR7bH0ke2x9YH1yZXR1cm4gYGZ1bmN0aW9uICR7ZnJ9KGUpJHtvfXske2x9JHtlfWlmJHtvfShlJHtvfSYmJHtvfWUuX19lc01vZHVsZSkke299cmV0dXJuIGU7JHtsfWArQ3IoZSxlLHQscyxpLG4pK2B9JHtsfSR7bH1gfSxbeHJdKGUsdCxzLGksbil7Y29uc3R7XzpyLGNuc3Q6byxuOmF9PXQsbD0idmFyIj09PW8mJnM7cmV0dXJuIGBmdW5jdGlvbiAke3hyfShuLCBtKSR7cn17JHthfSR7ZX0ke05yKGB7JHthfSR7ZX0ke2V9JHtlfWlmJHtyfShrJHtyfSE9PSR7cn0nZGVmYXVsdCcke3J9JiYke3J9IShrIGluIG4pKSR7cn17JHthfWArKHM/bD9ScjpNcjpPcikoZSxlK2UrZStlLHQpK2Ake2V9JHtlfSR7ZX19JHthfWArYCR7ZX0ke2V9fWAsbCxlLHQpfSR7YX0ke2V9cmV0dXJuICR7RHIoaSxMcihuLCJuIix0KSl9OyR7YX19JHthfSR7YX1gfX0sSXI9KHtfOmUsZ2V0T2JqZWN0OnR9KT0+YGUke2V9OiR7ZX0ke3QoW1siZGVmYXVsdCIsImUiXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9YCx3cj0oe186ZSxnZXRQcm9wZXJ0eUFjY2Vzczp0fSk9PmBlJHt0KCJkZWZhdWx0Iil9JHtlfToke2V9ZWAsUHI9KHtfOmV9KT0+YGUke2V9JiYke2V9dHlwZW9mIGUke2V9PT09JHtlfSdvYmplY3QnJHtlfSYmJHtlfSdkZWZhdWx0JyR7ZX1pbiBlYCxDcj0oZSx0LHMsaSxuLHIpPT57Y29uc3R7XzpvLGNuc3Q6YSxnZXRPYmplY3Q6bCxnZXRQcm9wZXJ0eUFjY2VzczpjLG46aCxzOnV9PXMsZD1geyR7aH1gKyhpP19yOk9yKShlLHQrZStlLHMpK2Ake3R9JHtlfX1gO3JldHVybiBgJHt0fSR7YX0gbiR7b309JHtvfU9iamVjdC5jcmVhdGUobnVsbCR7cj9gLCR7b317JHtvfVtTeW1ib2wudG9TdHJpbmdUYWddOiR7b30ke1ZyKGwpfSR7b319YDoiIn0pOyR7aH0ke3R9aWYke299KGUpJHtvfXske2h9JHt0fSR7ZX0keyRyKGQsIWkscyl9JHtofSR7dH19JHtofSR7dH1uJHtjKCJkZWZhdWx0Iil9JHtvfT0ke299ZTske2h9JHt0fXJldHVybiAke0RyKG4sIm4iKX0ke3V9JHtofWB9LCRyPShlLHQse186cyxjbnN0OmksZ2V0RnVuY3Rpb25JbnRybzpuLHM6cn0pPT4idmFyIiE9PWl8fHQ/YGZvciR7c30oJHtpfSBrIGluIGUpJHtzfSR7ZX1gOmBPYmplY3Qua2V5cyhlKS5mb3JFYWNoKCR7bihbImsiXSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX0ke2V9KSR7cn1gLE5yPShlLHQscyx7XzppLGNuc3Q6bixnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpyLGdldEZ1bmN0aW9uSW50cm86byxuOmF9KT0+e2lmKHQpe2NvbnN0W3Qsbl09cihbImUiXSx7ZnVuY3Rpb25SZXR1cm46ITEsbGluZUJyZWFrSW5kZW50OntiYXNlOnMsdDpzfSxuYW1lOm51bGx9KTtyZXR1cm4gYG0uZm9yRWFjaCgke3R9ZSR7aX0mJiR7aX10eXBlb2YgZSR7aX0hPT0ke2l9J3N0cmluZycke2l9JiYke2l9IUFycmF5LmlzQXJyYXkoZSkke2l9JiYke2l9T2JqZWN0LmtleXMoZSkuZm9yRWFjaCgke28oWyJrIl0se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9JHtlfSkke259KTtgfXJldHVybiBgZm9yJHtpfSh2YXIgaSR7aX09JHtpfTA7JHtpfWkke2l9PCR7aX1tLmxlbmd0aDske2l9aSsrKSR7aX17JHthfSR7c30ke3N9JHtufSBlJHtpfT0ke2l9bVtpXTske2F9JHtzfSR7c31pZiR7aX0odHlwZW9mIGUke2l9IT09JHtpfSdzdHJpbmcnJHtpfSYmJHtpfSFBcnJheS5pc0FycmF5KGUpKSR7aX17JHtpfWZvciR7aX0oJHtufSBrIGluIGUpJHtpfSR7ZX0ke2l9fSR7YX0ke3N9fWB9LF9yPShlLHQscyk9Pntjb25zdHtfOmksbjpufT1zO3JldHVybiBgJHt0fWlmJHtpfShrJHtpfSE9PSR7aX0nZGVmYXVsdCcpJHtpfXske259YCtScihlLHQrZSxzKStgJHt0fX0ke259YH0sUnI9KGUsdCx7XzpzLGNuc3Q6aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn0pPT57Y29uc3RbbyxhXT1uKFtdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtyZXR1cm4gYCR7dH0ke2l9IGQke3N9PSR7c31PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsJHtzfWspOyR7cn0ke3R9T2JqZWN0LmRlZmluZVByb3BlcnR5KG4sJHtzfWssJHtzfWQuZ2V0JHtzfT8ke3N9ZCR7c306JHtzfXske3J9JHt0fSR7ZX1lbnVtZXJhYmxlOiR7c310cnVlLCR7cn0ke3R9JHtlfWdldDoke3N9JHtvfWVba10ke2F9JHtyfSR7dH19KTske3J9YH0sTXI9KGUsdCx7XzpzLGNuc3Q6aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn0pPT57Y29uc3RbbyxhXT1uKFtdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtyZXR1cm4gYCR7dH0ke2l9IGQke3N9PSR7c31PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsJHtzfWspOyR7cn0ke3R9aWYke3N9KGQpJHtzfXske3J9JHt0fSR7ZX1PYmplY3QuZGVmaW5lUHJvcGVydHkobiwke3N9aywke3N9ZC5nZXQke3N9PyR7c31kJHtzfToke3N9eyR7cn0ke3R9JHtlfSR7ZX1lbnVtZXJhYmxlOiR7c310cnVlLCR7cn0ke3R9JHtlfSR7ZX1nZXQ6JHtzfSR7b31lW2tdJHthfSR7cn0ke3R9JHtlfX0pOyR7cn0ke3R9fSR7cn1gfSxPcj0oZSx0LHtfOnMsbjppfSk9PmAke3R9bltrXSR7c309JHtzfWVba107JHtpfWAsRHI9KGUsdCk9PmU/YE9iamVjdC5mcmVlemUoJHt0fSlgOnQsTHI9KGUsdCx7XzpzLGdldE9iamVjdDppfSk9PmU/YE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgke3R9LCR7c31TeW1ib2wudG9TdHJpbmdUYWcsJHtzfSR7VnIoaSl9KWA6dCxUcj1PYmplY3Qua2V5cyhrcik7ZnVuY3Rpb24gVnIoZSl7cmV0dXJuIGUoW1sidmFsdWUiLCInTW9kdWxlJyJdXSx7bGluZUJyZWFrSW5kZW50Om51bGx9KX1mdW5jdGlvbiBCcihlLHQpe3JldHVybiBudWxsIT09ZS5yZW5kZXJCYXNlTmFtZSYmdC5oYXMoZSkmJmUuaXNSZWFzc2lnbmVkfWNsYXNzIHpyIGV4dGVuZHMgSnN7ZGVjbGFyZURlY2xhcmF0b3IoZSl7dGhpcy5pZC5kZWNsYXJlKGUsdGhpcy5pbml0fHxucyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMuaWQuZGVvcHRpbWl6ZVBhdGgoZSk7fWhhc0VmZmVjdHMoZSl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpO2NvbnN0IHQ9dGhpcy5pbml0Py5oYXNFZmZlY3RzKGUpO3JldHVybiB0aGlzLmlkLm1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKSx0fHx0aGlzLmlkLmhhc0VmZmVjdHMoZSl9aW5jbHVkZShlLHQpe2NvbnN0e2Rlb3B0aW1pemVkOnMsaWQ6aSxpbml0Om59PXRoaXM7c3x8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsbj8uaW5jbHVkZShlLHQpLGkubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpLCh0fHxpLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZpLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCl7Y29uc3R7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOnMsc25pcHBldHM6e186aSxnZXRQcm9wZXJ0eUFjY2VzczpufX09dCx7ZW5kOnIsaWQ6byxpbml0OmEsc3RhcnQ6bH09dGhpcyxjPW8uaW5jbHVkZWQ7aWYoYylvLnJlbmRlcihlLHQpO2Vsc2Uge2NvbnN0IHQ9Zm4oZS5vcmlnaW5hbCwiPSIsby5lbmQpO2UucmVtb3ZlKGwsZ24oZS5vcmlnaW5hbCx0KzEpKTt9aWYoYSl7aWYobyBpbnN0YW5jZW9mIGNuJiZhIGluc3RhbmNlb2YgWm4mJiFhLmlkKXtvLnZhcmlhYmxlLmdldE5hbWUobikhPT1vLm5hbWUmJmUuYXBwZW5kTGVmdChhLnN0YXJ0KzUsYCAke28ubmFtZX1gKTt9YS5yZW5kZXIoZSx0LGM/ZmU6e3JlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Ol9zfSk7fWVsc2UgbyBpbnN0YW5jZW9mIGNuJiZCcihvLnZhcmlhYmxlLHMpJiZlLmFwcGVuZExlZnQocixgJHtpfT0ke2l9dm9pZCAwYCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtjb25zdHtpZDplLGluaXQ6dH09dGhpcztpZih0JiZlIGluc3RhbmNlb2YgY24mJnQgaW5zdGFuY2VvZiBabiYmIXQuaWQpe2NvbnN0e25hbWU6cyx2YXJpYWJsZTppfT1lO2Zvcihjb25zdCBlIG9mIHQuc2NvcGUuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLnZhbHVlcygpKWUhPT1pJiZlLmZvcmJpZE5hbWUocyk7fX19ZnVuY3Rpb24gRnIoZSx0LHMpe3JldHVybiAiZXh0ZXJuYWwiPT09dD92cltzKGUgaW5zdGFuY2VvZiBadD9lLmlkOm51bGwpXToiZGVmYXVsdCI9PT10P3lyOm51bGx9Y29uc3QganI9e2FtZDpbInJlcXVpcmUiXSxjanM6WyJyZXF1aXJlIl0sc3lzdGVtOlsibW9kdWxlIl19O2Z1bmN0aW9uIFVyKGUpe2NvbnN0IHQ9W107Zm9yKGNvbnN0IHMgb2YgZS5wcm9wZXJ0aWVzKXtpZigiUmVzdEVsZW1lbnQiPT09cy50eXBlfHxzLmNvbXB1dGVkfHwiSWRlbnRpZmllciIhPT1zLmtleS50eXBlKXJldHVybjt0LnB1c2gocy5rZXkubmFtZSk7fXJldHVybiB0fWNsYXNzIEdyIGV4dGVuZHMgSnN7YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fWNvbnN0IFdyPSJST0xMVVBfRklMRV9VUkxfIixxcj0iaW1wb3J0Ijtjb25zdCBIcj17YW1kOlsiZG9jdW1lbnQiLCJtb2R1bGUiLCJVUkwiXSxjanM6WyJkb2N1bWVudCIsInJlcXVpcmUiLCJVUkwiXSxlczpbXSxpaWZlOlsiZG9jdW1lbnQiLCJVUkwiXSxzeXN0ZW06WyJtb2R1bGUiXSx1bWQ6WyJkb2N1bWVudCIsInJlcXVpcmUiLCJVUkwiXX0sS3I9e2FtZDpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdLGNqczpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdLGVzOltdLGlpZmU6WyJkb2N1bWVudCIsIlVSTCJdLHN5c3RlbTpbIm1vZHVsZSIsIlVSTCJdLHVtZDpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdfSxZcj0oZSx0PSJVUkwiKT0+YG5ldyAke3R9KCR7ZX0pLmhyZWZgLFhyPShlLHQ9ITEpPT5ZcihgJyR7RChlKX0nLCAke3Q/InR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgPyBsb2NhdGlvbi5ocmVmIDogIjoiIn1kb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjIHx8IGRvY3VtZW50LmJhc2VVUklgKSxRcj1lPT4odCx7Y2h1bmtJZDpzfSk9Pntjb25zdCBpPWUocyk7cmV0dXJuIG51bGw9PT10P2AoeyB1cmw6ICR7aX0gfSlgOiJ1cmwiPT09dD9pOiJ1bmRlZmluZWQifSxacj1lPT5gcmVxdWlyZSgndScgKyAncmwnKS5wYXRoVG9GaWxlVVJMKCR7ZX0pLmhyZWZgLEpyPWU9PlpyKGBfX2Rpcm5hbWUgKyAnLyR7ZX0nYCksZW89KGUsdD0hMSk9PmAke3Q/InR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgPyBsb2NhdGlvbi5ocmVmIDogIjoiIn0oZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYyB8fCBuZXcgVVJMKCcke0QoZSl9JywgZG9jdW1lbnQuYmFzZVVSSSkuaHJlZilgLHRvPXthbWQ6ZT0+KCIuIiE9PWVbMF0mJihlPSIuLyIrZSksWXIoYHJlcXVpcmUudG9VcmwoJyR7ZX0nKSwgZG9jdW1lbnQuYmFzZVVSSWApKSxjanM6ZT0+YCh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnID8gJHtKcihlKX0gOiAke1hyKGUpfSlgLGVzOmU9PllyKGAnJHtlfScsIGltcG9ydC5tZXRhLnVybGApLGlpZmU6ZT0+WHIoZSksc3lzdGVtOmU9PllyKGAnJHtlfScsIG1vZHVsZS5tZXRhLnVybGApLHVtZDplPT5gKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGxvY2F0aW9uID09PSAndW5kZWZpbmVkJyA/ICR7SnIoZSl9IDogJHtYcihlLCEwKX0pYH0sc289e2FtZDpRcigoKCk9PllyKCJtb2R1bGUudXJpLCBkb2N1bWVudC5iYXNlVVJJIikpKSxjanM6UXIoKGU9PmAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJyA/ICR7WnIoIl9fZmlsZW5hbWUiKX0gOiAke2VvKGUpfSlgKSksaWlmZTpRcigoZT0+ZW8oZSkpKSxzeXN0ZW06KGUse3NuaXBwZXRzOntnZXRQcm9wZXJ0eUFjY2Vzczp0fX0pPT5udWxsPT09ZT8ibW9kdWxlLm1ldGEiOmBtb2R1bGUubWV0YSR7dChlKX1gLHVtZDpRcigoZT0+YCh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBsb2NhdGlvbiA9PT0gJ3VuZGVmaW5lZCcgPyAke1pyKCJfX2ZpbGVuYW1lIil9IDogJHtlbyhlLCEwKX0pYCkpfTtjbGFzcyBpbyBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmhhc0NhY2hlZEVmZmVjdD1udWxsLHRoaXMuaGFzTG9nZ2VkRWZmZWN0PSExO31oYXNDYWNoZWRFZmZlY3RzKCl7cmV0dXJuICEhdGhpcy5pbmNsdWRlZCYmKG51bGw9PT10aGlzLmhhc0NhY2hlZEVmZmVjdD90aGlzLmhhc0NhY2hlZEVmZmVjdD10aGlzLmhhc0VmZmVjdHMoc3MoKSk6dGhpcy5oYXNDYWNoZWRFZmZlY3QpfWhhc0VmZmVjdHMoZSl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5ib2R5KWlmKHQuaGFzRWZmZWN0cyhlKSl7aWYodGhpcy5jb250ZXh0Lm9wdGlvbnMuZXhwZXJpbWVudGFsTG9nU2lkZUVmZmVjdHMmJiF0aGlzLmhhc0xvZ2dlZEVmZmVjdCl7dGhpcy5oYXNMb2dnZWRFZmZlY3Q9ITA7Y29uc3R7Y29kZTplLGxvZzpzLG1vZHVsZTppfT10aGlzLmNvbnRleHQ7cyhBZSxMdChlLGkuaWQsUGUoZSx0LnN0YXJ0LHtvZmZzZXRMaW5lOjF9KSksdC5zdGFydCk7fXJldHVybiB0aGlzLmhhc0NhY2hlZEVmZmVjdD0hMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5ib2R5KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCl7bGV0IHM9dGhpcy5zdGFydDtpZihlLm9yaWdpbmFsLnN0YXJ0c1dpdGgoIiMhIikmJihzPU1hdGgubWluKGUub3JpZ2luYWwuaW5kZXhPZigiXG4iKSsxLHRoaXMuZW5kKSxlLnJlbW92ZSgwLHMpKSx0aGlzLmJvZHkubGVuZ3RoPjApe2Zvcig7Ii8iPT09ZS5vcmlnaW5hbFtzXSYmL1sqL10vLnRlc3QoZS5vcmlnaW5hbFtzKzFdKTspe2NvbnN0IHQ9eW4oZS5vcmlnaW5hbC5zbGljZShzLHRoaXMuYm9keVswXS5zdGFydCkpO2lmKC0xPT09dFswXSlicmVhaztzKz10WzFdO314bih0aGlzLmJvZHksZSxzLHRoaXMuZW5kLHQpO31lbHNlIHN1cGVyLnJlbmRlcihlLHQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319Y2xhc3Mgbm8gZXh0ZW5kcyBKc3toYXNFZmZlY3RzKGUpe2lmKHRoaXMudGVzdD8uaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7Zm9yKGNvbnN0IHQgb2YgdGhpcy5jb25zZXF1ZW50KXtpZihlLmJyb2tlbkZsb3cpYnJlYWs7aWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy50ZXN0Py5pbmNsdWRlKGUsdCk7Zm9yKGNvbnN0IHMgb2YgdGhpcy5jb25zZXF1ZW50KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCxzKXtpZih0aGlzLmNvbnNlcXVlbnQubGVuZ3RoPjApe3RoaXMudGVzdCYmdGhpcy50ZXN0LnJlbmRlcihlLHQpO2NvbnN0IGk9dGhpcy50ZXN0P3RoaXMudGVzdC5lbmQ6Zm4oZS5vcmlnaW5hbCwiZGVmYXVsdCIsdGhpcy5zdGFydCkrNyxuPWZuKGUub3JpZ2luYWwsIjoiLGkpKzE7eG4odGhpcy5jb25zZXF1ZW50LGUsbixzLmVuZCx0KTt9ZWxzZSBzdXBlci5yZW5kZXIoZSx0KTt9fW5vLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3Mgcm8gZXh0ZW5kcyBKc3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCgpe31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIGUubGVuZ3RoPjB8fDEhPT10aGlzLnF1YXNpcy5sZW5ndGg/aWU6dGhpcy5xdWFzaXNbMF0udmFsdWUuY29va2VkfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUpe3JldHVybiAxIT09ZS5sZW5ndGg/YWU6RXMoeXMsZVswXSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAwPT09dC50eXBlP2UubGVuZ3RoPjE6MiE9PXQudHlwZXx8MSE9PWUubGVuZ3RofHx4cyh5cyxlWzBdLHQscyl9cmVuZGVyKGUsdCl7ZS5pbmRlbnRFeGNsdXNpb25SYW5nZXMucHVzaChbdGhpcy5zdGFydCx0aGlzLmVuZF0pLHN1cGVyLnJlbmRlcihlLHQpO319Y2xhc3Mgb28gZXh0ZW5kcyBkZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCJ1bmRlZmluZWQiKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKCl7fX1jbGFzcyBhbyBleHRlbmRzIHdpe2NvbnN0cnVjdG9yKGUsdCxzKXtzdXBlcihlLHQsdC5kZWNsYXJhdGlvbixzKSx0aGlzLmhhc0lkPSExLHRoaXMub3JpZ2luYWxJZD1udWxsLHRoaXMub3JpZ2luYWxWYXJpYWJsZT1udWxsO2NvbnN0IGk9dC5kZWNsYXJhdGlvbjsoaSBpbnN0YW5jZW9mIGlyfHxpIGluc3RhbmNlb2YgUW4pJiZpLmlkPyh0aGlzLmhhc0lkPSEwLHRoaXMub3JpZ2luYWxJZD1pLmlkKTppIGluc3RhbmNlb2YgY24mJih0aGlzLm9yaWdpbmFsSWQ9aSk7fWFkZFJlZmVyZW5jZShlKXt0aGlzLmhhc0lkfHwodGhpcy5uYW1lPWUubmFtZSk7fWZvcmJpZE5hbWUoZSl7Y29uc3QgdD10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTt0PT09dGhpcz9zdXBlci5mb3JiaWROYW1lKGUpOnQuZm9yYmlkTmFtZShlKTt9Z2V0QXNzaWduZWRWYXJpYWJsZU5hbWUoKXtyZXR1cm4gdGhpcy5vcmlnaW5hbElkJiZ0aGlzLm9yaWdpbmFsSWQubmFtZXx8bnVsbH1nZXRCYXNlVmFyaWFibGVOYW1lKCl7Y29uc3QgZT10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTtyZXR1cm4gZT09PXRoaXM/c3VwZXIuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpOmUuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpfWdldERpcmVjdE9yaWdpbmFsVmFyaWFibGUoKXtyZXR1cm4gIXRoaXMub3JpZ2luYWxJZHx8IXRoaXMuaGFzSWQmJih0aGlzLm9yaWdpbmFsSWQuaXNQb3NzaWJsZVREWigpfHx0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUuaXNSZWFzc2lnbmVkfHx0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUgaW5zdGFuY2VvZiBvb3x8InN5bnRoZXRpY05hbWVzcGFjZSJpbiB0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUpP251bGw6dGhpcy5vcmlnaW5hbElkLnZhcmlhYmxlfWdldE5hbWUoZSl7Y29uc3QgdD10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTtyZXR1cm4gdD09PXRoaXM/c3VwZXIuZ2V0TmFtZShlKTp0LmdldE5hbWUoZSl9Z2V0T3JpZ2luYWxWYXJpYWJsZSgpe2lmKHRoaXMub3JpZ2luYWxWYXJpYWJsZSlyZXR1cm4gdGhpcy5vcmlnaW5hbFZhcmlhYmxlO2xldCBlLHQ9dGhpcztjb25zdCBzPW5ldyBTZXQ7ZG97cy5hZGQodCksZT10LHQ9ZS5nZXREaXJlY3RPcmlnaW5hbFZhcmlhYmxlKCk7fXdoaWxlKHQgaW5zdGFuY2VvZiBhbyYmIXMuaGFzKHQpKTtyZXR1cm4gdGhpcy5vcmlnaW5hbFZhcmlhYmxlPXR8fGV9fWNsYXNzIGxvIGV4dGVuZHMgVGl7Y29uc3RydWN0b3IoZSx0KXtzdXBlcihlKSx0aGlzLmNvbnRleHQ9dCx0aGlzLnZhcmlhYmxlcy5zZXQoInRoaXMiLG5ldyB3aSgidGhpcyIsbnVsbCxucyx0KSk7fWFkZEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbihlLHQscyl7Y29uc3QgaT1uZXcgYW8oZSx0LHMpO3JldHVybiB0aGlzLnZhcmlhYmxlcy5zZXQoImRlZmF1bHQiLGkpLGl9YWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKCl7fWRlY29uZmxpY3QoZSx0LHMpe2Zvcihjb25zdCBpIG9mIHRoaXMuY2hpbGRyZW4paS5kZWNvbmZsaWN0KGUsdCxzKTt9ZmluZExleGljYWxCb3VuZGFyeSgpe3JldHVybiB0aGlzfWZpbmRWYXJpYWJsZShlKXtjb25zdCB0PXRoaXMudmFyaWFibGVzLmdldChlKXx8dGhpcy5hY2Nlc3NlZE91dHNpZGVWYXJpYWJsZXMuZ2V0KGUpO2lmKHQpcmV0dXJuIHQ7Y29uc3Qgcz10aGlzLmNvbnRleHQudHJhY2VWYXJpYWJsZShlKXx8dGhpcy5wYXJlbnQuZmluZFZhcmlhYmxlKGUpO3JldHVybiBzIGluc3RhbmNlb2YgYW4mJnRoaXMuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLnNldChlLHMpLHN9fWNvbnN0IGNvPXsiISI6ZT0+IWUsIisiOmU9PitlLCItIjplPT4tZSxkZWxldGU6KCk9PmllLHR5cGVvZjplPT50eXBlb2YgZSx2b2lkOigpPT57fSwifiI6ZT0+fmV9O2NsYXNzIGhvIGV4dGVuZHMgSnN7ZGVvcHRpbWl6ZVBhdGgoKXtmb3IoY29uc3QgZSBvZiB0aGlzLmRlY2xhcmF0aW9ucyllLmRlb3B0aW1pemVQYXRoKFkpO31oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aCgpe3JldHVybiAhMX1pbmNsdWRlKGUsdCx7YXNTaW5nbGVTdGF0ZW1lbnQ6c309ZmUpe3RoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IGkgb2YgdGhpcy5kZWNsYXJhdGlvbnMpeyh0fHxpLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZpLmluY2x1ZGUoZSx0KTtjb25zdHtpZDpuLGluaXQ6cn09aTtzJiZuLmluY2x1ZGUoZSx0KSxyJiZuLmluY2x1ZGVkJiYhci5pbmNsdWRlZCYmKG4gaW5zdGFuY2VvZiBObnx8biBpbnN0YW5jZW9mIElpKSYmci5pbmNsdWRlKGUsdCk7fX1pbml0aWFsaXNlKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5kZWNsYXJhdGlvbnMpZS5kZWNsYXJlRGVjbGFyYXRvcih0aGlzLmtpbmQpO31yZW5kZXIoZSx0LHM9ZmUpe2lmKGZ1bmN0aW9uKGUsdCl7Zm9yKGNvbnN0IHMgb2YgZSl7aWYoIXMuaWQuaW5jbHVkZWQpcmV0dXJuICExO2lmKHMuaWQudHlwZT09PU1zKXtpZih0LmhhcyhzLmlkLnZhcmlhYmxlKSlyZXR1cm4gITF9ZWxzZSB7Y29uc3QgZT1bXTtpZihzLmlkLmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCksZS5sZW5ndGg+MClyZXR1cm4gITF9fXJldHVybiAhMH0odGhpcy5kZWNsYXJhdGlvbnMsdC5leHBvcnROYW1lc0J5VmFyaWFibGUpKXtmb3IoY29uc3QgcyBvZiB0aGlzLmRlY2xhcmF0aW9ucylzLnJlbmRlcihlLHQpO3MuaXNOb1N0YXRlbWVudHx8NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSl8fGUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpO31lbHNlIHRoaXMucmVuZGVyUmVwbGFjZWREZWNsYXJhdGlvbnMoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9cmVuZGVyRGVjbGFyYXRpb25FbmQoZSx0LHMsaSxuLHIsbyl7NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSkmJmUucmVtb3ZlKHRoaXMuZW5kLTEsdGhpcy5lbmQpLHQrPSI7IixudWxsPT09cz9lLmFwcGVuZExlZnQobix0KTooMTAhPT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQoaS0xKXx8MTAhPT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQpJiYxMyE9PWUub3JpZ2luYWwuY2hhckNvZGVBdCh0aGlzLmVuZCl8fChpLS0sMTM9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQoaSkmJmktLSksaT09PXMrMT9lLm92ZXJ3cml0ZShzLG4sdCk6KGUub3ZlcndyaXRlKHMscysxLHQpLGUucmVtb3ZlKGksbikpKSxyLmxlbmd0aD4wJiZlLmFwcGVuZExlZnQobixgICR7UG4ocixvKX07YCk7fXJlbmRlclJlcGxhY2VkRGVjbGFyYXRpb25zKGUsdCl7Y29uc3Qgcz1Fbih0aGlzLmRlY2xhcmF0aW9ucyxlLHRoaXMuc3RhcnQrdGhpcy5raW5kLmxlbmd0aCx0aGlzLmVuZC0oNTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSk/MTowKSk7bGV0IGksbjtuPWduKGUub3JpZ2luYWwsdGhpcy5zdGFydCt0aGlzLmtpbmQubGVuZ3RoKTtsZXQgcj1uLTE7ZS5yZW1vdmUodGhpcy5zdGFydCxyKTtsZXQgbyxsPSExLGM9ITEsaD0iIjtjb25zdCB1PVtdLGQ9ZnVuY3Rpb24oZSx0LHMpe2xldCBpPW51bGw7aWYoInN5c3RlbSI9PT10LmZvcm1hdCl7Zm9yKGNvbnN0e25vZGU6bn1vZiBlKW4uaWQgaW5zdGFuY2VvZiBjbiYmbi5pbml0JiYwPT09cy5sZW5ndGgmJjE9PT10LmV4cG9ydE5hbWVzQnlWYXJpYWJsZS5nZXQobi5pZC52YXJpYWJsZSk/Lmxlbmd0aD8oaT1uLmlkLnZhcmlhYmxlLHMucHVzaChpKSk6bi5pZC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhzLHQuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKTtzLmxlbmd0aD4xP2k9bnVsbDppJiYocy5sZW5ndGg9MCk7fXJldHVybiBpfShzLHQsdSk7Zm9yKGNvbnN0e25vZGU6dSxzdGFydDpwLHNlcGFyYXRvcjpmLGNvbnRlbnRFbmQ6bSxlbmQ6Z31vZiBzKWlmKHUuaW5jbHVkZWQpe2lmKHUucmVuZGVyKGUsdCksbz0iIiwhdS5pZC5pbmNsdWRlZHx8dS5pZCBpbnN0YW5jZW9mIGNuJiZCcih1LmlkLnZhcmlhYmxlLHQuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKSljJiYoaCs9IjsiKSxsPSExO2Vsc2Uge2lmKGQmJmQ9PT11LmlkLnZhcmlhYmxlKXtjb25zdCBzPWZuKGUub3JpZ2luYWwsIj0iLHUuaWQuZW5kKTtDbihkLGduKGUub3JpZ2luYWwscysxKSxudWxsPT09Zj9tOmYsZSx0KTt9bD9oKz0iLCI6KGMmJihoKz0iOyIpLG8rPWAke3RoaXMua2luZH0gYCxsPSEwKTt9bj09PXIrMT9lLm92ZXJ3cml0ZShyLG4saCtvKTooZS5vdmVyd3JpdGUocixyKzEsaCksZS5hcHBlbmRMZWZ0KG4sbykpLGk9bSxuPWcsYz0hMCxyPWYsaD0iIjt9ZWxzZSBlLnJlbW92ZShwLGcpO3RoaXMucmVuZGVyRGVjbGFyYXRpb25FbmQoZSxoLHIsaSxuLHUsdCk7fX1jb25zdCB1bz17QXJyYXlFeHByZXNzaW9uOmtpLEFycmF5UGF0dGVybjpJaSxBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjp3bixBc3NpZ25tZW50RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7Y29uc3R7ZGVvcHRpbWl6ZWQ6dCxsZWZ0OnMsb3BlcmF0b3I6aSxyaWdodDpufT10aGlzO3JldHVybiB0fHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksbi5oYXNFZmZlY3RzKGUpfHxzLmhhc0VmZmVjdHNBc0Fzc2lnbm1lbnRUYXJnZXQoZSwiPSIhPT1pKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMucmlnaHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoZSx0KXtjb25zdHtkZW9wdGltaXplZDpzLGxlZnQ6aSxyaWdodDpuLG9wZXJhdG9yOnJ9PXRoaXM7c3x8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsKHR8fCI9IiE9PXJ8fGkuaW5jbHVkZWR8fGkuaGFzRWZmZWN0c0FzQXNzaWdubWVudFRhcmdldChzcygpLCExKSkmJmkuaW5jbHVkZUFzQXNzaWdubWVudFRhcmdldChlLHQsIj0iIT09ciksbi5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLmxlZnQuc2V0QXNzaWduZWRWYWx1ZSh0aGlzLnJpZ2h0KTt9cmVuZGVyKGUsdCx7cHJldmVudEFTSTpzLHJlbmRlcmVkUGFyZW50VHlwZTppLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Om59PWZlKXtjb25zdHtsZWZ0OnIscmlnaHQ6byxzdGFydDphLGVuZDpsLHBhcmVudDpjfT10aGlzO2lmKHIuaW5jbHVkZWQpci5yZW5kZXIoZSx0KSxvLnJlbmRlcihlLHQpO2Vsc2Uge2NvbnN0IGw9Z24oZS5vcmlnaW5hbCxmbihlLm9yaWdpbmFsLCI9IixyLmVuZCkrMSk7ZS5yZW1vdmUoYSxsKSxzJiZibihlLGwsby5zdGFydCksby5yZW5kZXIoZSx0LHtyZW5kZXJlZFBhcmVudFR5cGU6aXx8Yy50eXBlLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Om58fGMudHlwZX0pO31pZigic3lzdGVtIj09PXQuZm9ybWF0KWlmKHIgaW5zdGFuY2VvZiBjbil7Y29uc3Qgcz1yLnZhcmlhYmxlLGk9dC5leHBvcnROYW1lc0J5VmFyaWFibGUuZ2V0KHMpO2lmKGkpcmV0dXJuIHZvaWQoMT09PWkubGVuZ3RoP0NuKHMsYSxsLGUsdCk6JG4ocyxhLGwsYy50eXBlIT09X3MsZSx0KSl9ZWxzZSB7Y29uc3Qgcz1bXTtpZihyLmFkZEV4cG9ydGVkVmFyaWFibGVzKHMsdC5leHBvcnROYW1lc0J5VmFyaWFibGUpLHMubGVuZ3RoPjApcmV0dXJuIHZvaWQgZnVuY3Rpb24oZSx0LHMsaSxuLHIpe2NvbnN0e186byxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDphfT1yLnNuaXBwZXRzO24ucHJlcGVuZFJpZ2h0KHQsYShbInYiXSxgJHtQbihlLHIpfSwke299dmAse25lZWRzQXJyb3dSZXR1cm5QYXJlbnM6ITAsbmVlZHNXcmFwcGVkRnVuY3Rpb246aX0pKSxuLmFwcGVuZExlZnQocywiKSIpO30ocyxhLGwsbj09PV9zLGUsdCl9ci5pbmNsdWRlZCYmciBpbnN0YW5jZW9mIE5uJiYobj09PV9zfHxuPT09QXMpJiYoZS5hcHBlbmRSaWdodChhLCIoIiksZS5wcmVwZW5kTGVmdChsLCIpIikpO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5sZWZ0LmRlb3B0aW1pemVQYXRoKFkpLHRoaXMucmlnaHQuZGVvcHRpbWl6ZVBhdGgoWCksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fSxBc3NpZ25tZW50UGF0dGVybjpjbGFzcyBleHRlbmRzIEpze2FkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCl7dGhpcy5sZWZ0LmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCk7fWRlY2xhcmUoZSx0KXtyZXR1cm4gdGhpcy5sZWZ0LmRlY2xhcmUoZSx0KX1kZW9wdGltaXplUGF0aChlKXswPT09ZS5sZW5ndGgmJnRoaXMubGVmdC5kZW9wdGltaXplUGF0aChlKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiBlLmxlbmd0aD4wfHx0aGlzLmxlZnQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSx0LHMpfW1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKXt0aGlzLmxlZnQubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO31yZW5kZXIoZSx0LHtpc1Nob3J0aGFuZFByb3BlcnR5OnN9PWZlKXt0aGlzLmxlZnQucmVuZGVyKGUsdCx7aXNTaG9ydGhhbmRQcm9wZXJ0eTpzfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMubGVmdC5kZW9wdGltaXplUGF0aChZKSx0aGlzLnJpZ2h0LmRlb3B0aW1pemVQYXRoKFgpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCk7fX0sQXdhaXRFeHByZXNzaW9uOkRuLEJpbmFyeUV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBKc3tkZW9wdGltaXplQ2FjaGUoKXt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtpZihlLmxlbmd0aD4wKXJldHVybiBpZTtjb25zdCBpPXRoaXMubGVmdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoWSx0LHMpO2lmKCJzeW1ib2wiPT10eXBlb2YgaSlyZXR1cm4gaWU7Y29uc3Qgbj10aGlzLnJpZ2h0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHQscyk7aWYoInN5bWJvbCI9PXR5cGVvZiBuKXJldHVybiBpZTtjb25zdCByPUxuW3RoaXMub3BlcmF0b3JdO3JldHVybiByP3IoaSxuKTppZX1oYXNFZmZlY3RzKGUpe3JldHVybiAiKyI9PT10aGlzLm9wZXJhdG9yJiZ0aGlzLnBhcmVudCBpbnN0YW5jZW9mIFNuJiYiIj09PXRoaXMubGVmdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoWSx0ZSx0aGlzKXx8c3VwZXIuaGFzRWZmZWN0cyhlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9KXtyZXR1cm4gMCE9PXR8fGUubGVuZ3RoPjF9cmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c309ZmUpe3RoaXMubGVmdC5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpzfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTt9fSxCbG9ja1N0YXRlbWVudDpBbixCcmVha1N0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7aWYodGhpcy5sYWJlbCl7aWYoIWUuaWdub3JlLmxhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSlyZXR1cm4gITA7ZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKTt9ZWxzZSB7aWYoIWUuaWdub3JlLmJyZWFrcylyZXR1cm4gITA7ZS5oYXNCcmVhaz0hMDt9cmV0dXJuIGUuYnJva2VuRmxvdz0hMCwhMX1pbmNsdWRlKGUpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5sYWJlbD8odGhpcy5sYWJlbC5pbmNsdWRlKCksZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSk6ZS5oYXNCcmVhaz0hMCxlLmJyb2tlbkZsb3c9ITA7fX0sQ2FsbEV4cHJlc3Npb246R24sQ2F0Y2hDbGF1c2U6Y2xhc3MgZXh0ZW5kcyBKc3tjcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPW5ldyBXbihlLHRoaXMuY29udGV4dCk7fXBhcnNlTm9kZShlKXtjb25zdHtwYXJhbTp0fT1lO3QmJih0aGlzLnBhcmFtPW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKHQudHlwZSkpKHQsdGhpcyx0aGlzLnNjb3BlKSx0aGlzLnBhcmFtLmRlY2xhcmUoInBhcmFtZXRlciIsb2UpKSxzdXBlci5wYXJzZU5vZGUoZSk7fX0sQ2hhaW5FeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgSnN7ZGVvcHRpbWl6ZUNhY2hlKCl7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7aWYoIXRoaXMuZXhwcmVzc2lvbi5pc1NraXBwZWRBc09wdGlvbmFsKHMpKXJldHVybiB0aGlzLmV4cHJlc3Npb24uZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKX1oYXNFZmZlY3RzKGUpe3JldHVybiAhdGhpcy5leHByZXNzaW9uLmlzU2tpcHBlZEFzT3B0aW9uYWwodGhpcykmJnRoaXMuZXhwcmVzc2lvbi5oYXNFZmZlY3RzKGUpfX0sQ2xhc3NCb2R5OmNsYXNzIGV4dGVuZHMgSnN7Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgcW4oZSx0aGlzLnBhcmVudCx0aGlzLmNvbnRleHQpO31pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy5zY29wZS50aGlzVmFyaWFibGUpO2Zvcihjb25zdCBzIG9mIHRoaXMuYm9keSlzLmluY2x1ZGUoZSx0KTt9cGFyc2VOb2RlKGUpe2NvbnN0IHQ9dGhpcy5ib2R5PVtdO2Zvcihjb25zdCBzIG9mIGUuYm9keSl0LnB1c2gobmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3Iocy50eXBlKSkocyx0aGlzLHMuc3RhdGljP3RoaXMuc2NvcGU6dGhpcy5zY29wZS5pbnN0YW5jZVNjb3BlKSk7c3VwZXIucGFyc2VOb2RlKGUpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319LENsYXNzRGVjbGFyYXRpb246UW4sQ2xhc3NFeHByZXNzaW9uOlpuLENvbmRpdGlvbmFsRXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPVtdLHRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQ9ITEsdGhpcy51c2VkQnJhbmNoPW51bGw7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmNvbnNlcXVlbnQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpLHRoaXMuYWx0ZXJuYXRlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZUNhY2hlKCl7aWYobnVsbCE9PXRoaXMudXNlZEJyYW5jaCl7Y29uc3QgZT10aGlzLnVzZWRCcmFuY2g9PT10aGlzLmNvbnNlcXVlbnQ/dGhpcy5hbHRlcm5hdGU6dGhpcy5jb25zZXF1ZW50O3RoaXMudXNlZEJyYW5jaD1udWxsLGUuZGVvcHRpbWl6ZVBhdGgoWCk7Y29uc3R7ZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6dH09dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPWdlO2Zvcihjb25zdCBlIG9mIHQpZS5kZW9wdGltaXplQ2FjaGUoKTt9fWRlb3B0aW1pemVQYXRoKGUpe2NvbnN0IHQ9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dD90LmRlb3B0aW1pemVQYXRoKGUpOih0aGlzLmNvbnNlcXVlbnQuZGVvcHRpbWl6ZVBhdGgoZSksdGhpcy5hbHRlcm5hdGUuZGVvcHRpbWl6ZVBhdGgoZSkpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChzKSxpLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscykpOmllfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIG4/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSxuLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpKTpbbmV3IEpuKFt0aGlzLmNvbnNlcXVlbnQuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF0sdGhpcy5hbHRlcm5hdGUuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF1dKSwhMV19aGFzRWZmZWN0cyhlKXtpZih0aGlzLnRlc3QuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7Y29uc3QgdD10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gdD90Lmhhc0VmZmVjdHMoZSk6dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSl8fHRoaXMuYWx0ZXJuYXRlLmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/aS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk6dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXx8dGhpcy5hbHRlcm5hdGUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwO2NvbnN0IHM9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dHx8dGhpcy50ZXN0LnNob3VsZEJlSW5jbHVkZWQoZSl8fG51bGw9PT1zPyh0aGlzLnRlc3QuaW5jbHVkZShlLHQpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKGUsdCksdGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLHQpKTpzLmluY2x1ZGUoZSx0KTt9aW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KXtjb25zdCBzPXRoaXMuZ2V0VXNlZEJyYW5jaCgpO3M/cy5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpOih0aGlzLmNvbnNlcXVlbnQuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KSx0aGlzLmFsdGVybmF0ZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpKTt9cmVuZGVyKGUsdCx7aXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OnMscHJldmVudEFTSTppLHJlbmRlcmVkUGFyZW50VHlwZTpuLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnJ9PWZlKXtjb25zdCBvPXRoaXMuZ2V0VXNlZEJyYW5jaCgpO2lmKHRoaXMudGVzdC5pbmNsdWRlZCl0aGlzLnRlc3QucmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6cn0pLHRoaXMuY29uc2VxdWVudC5yZW5kZXIoZSx0KSx0aGlzLmFsdGVybmF0ZS5yZW5kZXIoZSx0KTtlbHNlIHtjb25zdCBhPWZuKGUub3JpZ2luYWwsIjoiLHRoaXMuY29uc2VxdWVudC5lbmQpLGw9Z24oZS5vcmlnaW5hbCwodGhpcy5jb25zZXF1ZW50LmluY2x1ZGVkP2ZuKGUub3JpZ2luYWwsIj8iLHRoaXMudGVzdC5lbmQpOmEpKzEpO2kmJmJuKGUsbCxvLnN0YXJ0KSxlLnJlbW92ZSh0aGlzLnN0YXJ0LGwpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlZCYmZS5yZW1vdmUoYSx0aGlzLmVuZCksZG4odGhpcyxlKSxvLnJlbmRlcihlLHQse2lzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpzLHByZXZlbnRBU0k6ITAscmVuZGVyZWRQYXJlbnRUeXBlOm58fHRoaXMucGFyZW50LnR5cGUscmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6cnx8dGhpcy5wYXJlbnQudHlwZX0pO319Z2V0VXNlZEJyYW5jaCgpe2lmKHRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQpcmV0dXJuIHRoaXMudXNlZEJyYW5jaDt0aGlzLmlzQnJhbmNoUmVzb2x1dGlvbkFuYWx5c2VkPSEwO2NvbnN0IGU9dGhpcy50ZXN0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChZLHRlLHRoaXMpO3JldHVybiAic3ltYm9sIj09dHlwZW9mIGU/bnVsbDp0aGlzLnVzZWRCcmFuY2g9ZT90aGlzLmNvbnNlcXVlbnQ6dGhpcy5hbHRlcm5hdGV9fSxDb250aW51ZVN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7aWYodGhpcy5sYWJlbCl7aWYoIWUuaWdub3JlLmxhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSlyZXR1cm4gITA7ZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKTt9ZWxzZSB7aWYoIWUuaWdub3JlLmNvbnRpbnVlcylyZXR1cm4gITA7ZS5oYXNDb250aW51ZT0hMDt9cmV0dXJuIGUuYnJva2VuRmxvdz0hMCwhMX1pbmNsdWRlKGUpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5sYWJlbD8odGhpcy5sYWJlbC5pbmNsdWRlKCksZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSk6ZS5oYXNDb250aW51ZT0hMCxlLmJyb2tlbkZsb3c9ITA7fX0sRG9XaGlsZVN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7cmV0dXJuICEhdGhpcy50ZXN0Lmhhc0VmZmVjdHMoZSl8fGVyKGUsdGhpcy5ib2R5KX1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLnRlc3QuaW5jbHVkZShlLHQpLHRyKGUsdGhpcy5ib2R5LHQpO319LEVtcHR5U3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgSnN7aGFzRWZmZWN0cygpe3JldHVybiAhMX19LEV4cG9ydEFsbERlY2xhcmF0aW9uOnNyLEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbjpucixFeHBvcnROYW1lZERlY2xhcmF0aW9uOnJyLEV4cG9ydFNwZWNpZmllcjpjbGFzcyBleHRlbmRzIEpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX0sRXhwcmVzc2lvblN0YXRlbWVudDpTbixGb3JJblN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2NyZWF0ZVNjb3BlKGUpe3RoaXMuc2NvcGU9bmV3IHZuKGUpO31oYXNFZmZlY3RzKGUpe2NvbnN0e2JvZHk6dCxkZW9wdGltaXplZDpzLGxlZnQ6aSxyaWdodDpufT10aGlzO3JldHVybiBzfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksISghaS5oYXNFZmZlY3RzQXNBc3NpZ25tZW50VGFyZ2V0KGUsITEpJiYhbi5oYXNFZmZlY3RzKGUpKXx8ZXIoZSx0KX1pbmNsdWRlKGUsdCl7Y29uc3R7Ym9keTpzLGRlb3B0aW1pemVkOmksbGVmdDpuLHJpZ2h0OnJ9PXRoaXM7aXx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsbi5pbmNsdWRlQXNBc3NpZ25tZW50VGFyZ2V0KGUsdHx8ITAsITEpLHIuaW5jbHVkZShlLHQpLHRyKGUscyx0KTt9aW5pdGlhbGlzZSgpe3RoaXMubGVmdC5zZXRBc3NpZ25lZFZhbHVlKG9lKTt9cmVuZGVyKGUsdCl7dGhpcy5sZWZ0LnJlbmRlcihlLHQscG4pLHRoaXMucmlnaHQucmVuZGVyKGUsdCxwbiksMTEwPT09ZS5vcmlnaW5hbC5jaGFyQ29kZUF0KHRoaXMucmlnaHQuc3RhcnQtMSkmJmUucHJlcGVuZExlZnQodGhpcy5yaWdodC5zdGFydCwiICIpLHRoaXMuYm9keS5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMubGVmdC5kZW9wdGltaXplUGF0aChZKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319LEZvck9mU3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgSnN7Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgdm4oZSk7fWhhc0VmZmVjdHMoKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEwfWluY2x1ZGUoZSx0KXtjb25zdHtib2R5OnMsZGVvcHRpbWl6ZWQ6aSxsZWZ0Om4scmlnaHQ6cn09dGhpcztpfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlZD0hMCxuLmluY2x1ZGVBc0Fzc2lnbm1lbnRUYXJnZXQoZSx0fHwhMCwhMSksci5pbmNsdWRlKGUsdCksdHIoZSxzLHQpO31pbml0aWFsaXNlKCl7dGhpcy5sZWZ0LnNldEFzc2lnbmVkVmFsdWUob2UpO31yZW5kZXIoZSx0KXt0aGlzLmxlZnQucmVuZGVyKGUsdCxwbiksdGhpcy5yaWdodC5yZW5kZXIoZSx0LHBuKSwxMDI9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5yaWdodC5zdGFydC0xKSYmZS5wcmVwZW5kTGVmdCh0aGlzLnJpZ2h0LnN0YXJ0LCIgIiksdGhpcy5ib2R5LnJlbmRlcihlLHQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5sZWZ0LmRlb3B0aW1pemVQYXRoKFkpLHRoaXMucmlnaHQuZGVvcHRpbWl6ZVBhdGgoWCksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fSxGb3JTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBKc3tjcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPW5ldyB2bihlKTt9aGFzRWZmZWN0cyhlKXtyZXR1cm4gISEodGhpcy5pbml0Py5oYXNFZmZlY3RzKGUpfHx0aGlzLnRlc3Q/Lmhhc0VmZmVjdHMoZSl8fHRoaXMudXBkYXRlPy5oYXNFZmZlY3RzKGUpKXx8ZXIoZSx0aGlzLmJvZHkpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuaW5pdD8uaW5jbHVkZShlLHQse2FzU2luZ2xlU3RhdGVtZW50OiEwfSksdGhpcy50ZXN0Py5pbmNsdWRlKGUsdCksdGhpcy51cGRhdGU/LmluY2x1ZGUoZSx0KSx0cihlLHRoaXMuYm9keSx0KTt9cmVuZGVyKGUsdCl7dGhpcy5pbml0Py5yZW5kZXIoZSx0LHBuKSx0aGlzLnRlc3Q/LnJlbmRlcihlLHQscG4pLHRoaXMudXBkYXRlPy5yZW5kZXIoZSx0LHBuKSx0aGlzLmJvZHkucmVuZGVyKGUsdCk7fX0sRnVuY3Rpb25EZWNsYXJhdGlvbjppcixGdW5jdGlvbkV4cHJlc3Npb246b3IsSWRlbnRpZmllcjpjbixJZlN0YXRlbWVudDpjcixJbXBvcnRBdHRyaWJ1dGU6Y2xhc3MgZXh0ZW5kcyBKc3t9LEltcG9ydERlY2xhcmF0aW9uOmhyLEltcG9ydERlZmF1bHRTcGVjaWZpZXI6dXIsSW1wb3J0RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmlubGluZU5hbWVzcGFjZT1udWxsLHRoaXMuYXNzZXJ0aW9ucz1udWxsLHRoaXMubWVjaGFuaXNtPW51bGwsdGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lPXZvaWQgMCx0aGlzLnJlc29sdXRpb249bnVsbCx0aGlzLnJlc29sdXRpb25TdHJpbmc9bnVsbDt9YmluZCgpe3RoaXMuc291cmNlLmJpbmQoKTt9Z2V0RGV0ZXJtaW5pc3RpY0ltcG9ydGVkTmFtZXMoKXtjb25zdCBlPXRoaXMucGFyZW50O2lmKGUgaW5zdGFuY2VvZiBTbilyZXR1cm4gZ2U7aWYoZSBpbnN0YW5jZW9mIERuKXtjb25zdCB0PWUucGFyZW50O2lmKHQgaW5zdGFuY2VvZiBTbilyZXR1cm4gZ2U7aWYodCBpbnN0YW5jZW9mIHpyKXtjb25zdCBlPXQuaWQ7cmV0dXJuIGUgaW5zdGFuY2VvZiBObj9VcihlKTp2b2lkIDB9aWYodCBpbnN0YW5jZW9mIEZuKXtjb25zdCBlPXQucHJvcGVydHk7aWYoIXQuY29tcHV0ZWQmJmUgaW5zdGFuY2VvZiBjbilyZXR1cm4gW2UubmFtZV19fWVsc2UgaWYoZSBpbnN0YW5jZW9mIEZuKXtjb25zdCB0PWUucGFyZW50LHM9ZS5wcm9wZXJ0eTtpZighKHQgaW5zdGFuY2VvZiBHbiYmcyBpbnN0YW5jZW9mIGNuKSlyZXR1cm47Y29uc3QgaT1zLm5hbWU7aWYodC5wYXJlbnQgaW5zdGFuY2VvZiBTbiYmWyJjYXRjaCIsImZpbmFsbHkiXS5pbmNsdWRlcyhpKSlyZXR1cm4gZ2U7aWYoInRoZW4iIT09aSlyZXR1cm47aWYoMD09PXQuYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gZ2U7Y29uc3Qgbj10LmFyZ3VtZW50c1swXTtpZigxIT09dC5hcmd1bWVudHMubGVuZ3RofHwhKG4gaW5zdGFuY2VvZiB3bnx8biBpbnN0YW5jZW9mIG9yKSlyZXR1cm47aWYoMD09PW4ucGFyYW1zLmxlbmd0aClyZXR1cm4gZ2U7Y29uc3Qgcj1uLnBhcmFtc1swXTtyZXR1cm4gMT09PW4ucGFyYW1zLmxlbmd0aCYmciBpbnN0YW5jZW9mIE5uP1VyKHIpOnZvaWQgMH19aGFzRWZmZWN0cygpe3JldHVybiAhMH1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jb250ZXh0LmluY2x1ZGVEeW5hbWljSW1wb3J0KHRoaXMpLHRoaXMuc2NvcGUuYWRkQWNjZXNzZWREeW5hbWljSW1wb3J0KHRoaXMpKSx0aGlzLnNvdXJjZS5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLmNvbnRleHQuYWRkRHluYW1pY0ltcG9ydCh0aGlzKTt9cGFyc2VOb2RlKGUpe3N1cGVyLnBhcnNlTm9kZShlLFsic291cmNlIl0pO31yZW5kZXIoZSx0KXtjb25zdHtzbmlwcGV0czp7XzpzLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOmksZ2V0T2JqZWN0Om4sZ2V0UHJvcGVydHlBY2Nlc3M6cn19PXQ7aWYodGhpcy5pbmxpbmVOYW1lc3BhY2Upe2NvbnN0W3Qsc109aShbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7ZS5vdmVyd3JpdGUodGhpcy5zdGFydCx0aGlzLmVuZCxgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigke3R9JHt0aGlzLmlubGluZU5hbWVzcGFjZS5nZXROYW1lKHIpfSR7c30pYCk7fWVsc2Uge2lmKHRoaXMubWVjaGFuaXNtJiYoZS5vdmVyd3JpdGUodGhpcy5zdGFydCxmbihlLm9yaWdpbmFsLCIoIix0aGlzLnN0YXJ0KzYpKzEsdGhpcy5tZWNoYW5pc20ubGVmdCksZS5vdmVyd3JpdGUodGhpcy5lbmQtMSx0aGlzLmVuZCx0aGlzLm1lY2hhbmlzbS5yaWdodCkpLHRoaXMucmVzb2x1dGlvblN0cmluZyl7aWYoZS5vdmVyd3JpdGUodGhpcy5zb3VyY2Uuc3RhcnQsdGhpcy5zb3VyY2UuZW5kLHRoaXMucmVzb2x1dGlvblN0cmluZyksdGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lKXtjb25zdFt0LHNdPWkoWyJuIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO2UucHJlcGVuZExlZnQodGhpcy5lbmQsYC50aGVuKCR7dH1uLiR7dGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lfSR7c30pYCk7fX1lbHNlIHRoaXMuc291cmNlLnJlbmRlcihlLHQpOyEwIT09dGhpcy5hc3NlcnRpb25zJiYodGhpcy5hcmd1bWVudHMmJmUub3ZlcndyaXRlKHRoaXMuc291cmNlLmVuZCx0aGlzLmVuZC0xLCIiLHtjb250ZW50T25seTohMH0pLHRoaXMuYXNzZXJ0aW9ucyYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLTEsYCwke3N9JHtuKFtbImFzc2VydCIsdGhpcy5hc3NlcnRpb25zXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9YCkpO319c2V0RXh0ZXJuYWxSZXNvbHV0aW9uKGUsdCxzLGksbixyLG8sYSxsKXtjb25zdHtmb3JtYXQ6Y309czt0aGlzLmlubGluZU5hbWVzcGFjZT1udWxsLHRoaXMucmVzb2x1dGlvbj10LHRoaXMucmVzb2x1dGlvblN0cmluZz1vLHRoaXMubmFtZXNwYWNlRXhwb3J0TmFtZT1hLHRoaXMuYXNzZXJ0aW9ucz1sO2NvbnN0IGg9Wy4uLmpyW2NdfHxbXV07bGV0IHU7KCh7aGVscGVyOnUsbWVjaGFuaXNtOnRoaXMubWVjaGFuaXNtfT10aGlzLmdldER5bmFtaWNJbXBvcnRNZWNoYW5pc21BbmRIZWxwZXIodCxlLHMsaSxuKSkpLHUmJmgucHVzaCh1KSxoLmxlbmd0aD4wJiZ0aGlzLnNjb3BlLmFkZEFjY2Vzc2VkR2xvYmFscyhoLHIpO31zZXRJbnRlcm5hbFJlc29sdXRpb24oZSl7dGhpcy5pbmxpbmVOYW1lc3BhY2U9ZTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9Z2V0RHluYW1pY0ltcG9ydE1lY2hhbmlzbUFuZEhlbHBlcihlLHQse2NvbXBhY3Q6cyxkeW5hbWljSW1wb3J0RnVuY3Rpb246aSxkeW5hbWljSW1wb3J0SW5DanM6bixmb3JtYXQ6cixnZW5lcmF0ZWRDb2RlOnthcnJvd0Z1bmN0aW9uczpvfSxpbnRlcm9wOmF9LHtfOmwsZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246YyxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDpofSx1KXtjb25zdCBkPXUuaG9va0ZpcnN0U3luYygicmVuZGVyRHluYW1pY0ltcG9ydCIsW3tjdXN0b21SZXNvbHV0aW9uOiJzdHJpbmciPT10eXBlb2YgdGhpcy5yZXNvbHV0aW9uP3RoaXMucmVzb2x1dGlvbjpudWxsLGZvcm1hdDpyLG1vZHVsZUlkOnRoaXMuY29udGV4dC5tb2R1bGUuaWQsdGFyZ2V0TW9kdWxlSWQ6dGhpcy5yZXNvbHV0aW9uJiYic3RyaW5nIiE9dHlwZW9mIHRoaXMucmVzb2x1dGlvbj90aGlzLnJlc29sdXRpb24uaWQ6bnVsbH1dKTtpZihkKXJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOmR9O2NvbnN0IHA9IXRoaXMucmVzb2x1dGlvbnx8InN0cmluZyI9PXR5cGVvZiB0aGlzLnJlc29sdXRpb247c3dpdGNoKHIpe2Nhc2UiY2pzIjp7aWYobiYmKCFlfHwic3RyaW5nIj09dHlwZW9mIGV8fGUgaW5zdGFuY2VvZiBadCkpcmV0dXJuIHtoZWxwZXI6bnVsbCxtZWNoYW5pc206bnVsbH07Y29uc3Qgcz1GcihlLHQsYSk7bGV0IGk9InJlcXVpcmUoIixyPSIpIjtzJiYoaT1gLyojX19QVVJFX18qLyR7c30oJHtpfWAscis9IikiKTtjb25zdFtsLHVdPWMoW10se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO3JldHVybiBpPWBQcm9taXNlLnJlc29sdmUoKS50aGVuKCR7bH0ke2l9YCxyKz1gJHt1fSlgLCFvJiZwJiYoaT1oKFsidCJdLGAke2l9dCR7cn1gLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOiExLG5lZWRzV3JhcHBlZEZ1bmN0aW9uOiEwfSkscj0iKSIpLHtoZWxwZXI6cyxtZWNoYW5pc206e2xlZnQ6aSxyaWdodDpyfX19Y2FzZSJhbWQiOntjb25zdCBpPXM/ImMiOiJyZXNvbHZlIixuPXM/ImUiOiJyZWplY3QiLHI9RnIoZSx0LGEpLFt1LGRdPWMoWyJtIl0se2Z1bmN0aW9uUmV0dXJuOiExLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pLGY9cj9gJHt1fSR7aX0oLyojX19QVVJFX18qLyR7cn0obSkpJHtkfWA6aSxbbSxnXT1jKFtpLG5dLHtmdW5jdGlvblJldHVybjohMSxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtsZXQgeT1gbmV3IFByb21pc2UoJHttfXJlcXVpcmUoW2AseD1gXSwke2x9JHtmfSwke2x9JHtufSkke2d9KWA7cmV0dXJuICFvJiZwJiYoeT1oKFsidCJdLGAke3l9dCR7eH1gLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOiExLG5lZWRzV3JhcHBlZEZ1bmN0aW9uOiEwfSkseD0iKSIpLHtoZWxwZXI6cixtZWNoYW5pc206e2xlZnQ6eSxyaWdodDp4fX19Y2FzZSJzeXN0ZW0iOnJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOntsZWZ0OiJtb2R1bGUuaW1wb3J0KCIscmlnaHQ6IikifX07Y2FzZSJlcyI6aWYoaSlyZXR1cm4ge2hlbHBlcjpudWxsLG1lY2hhbmlzbTp7bGVmdDpgJHtpfShgLHJpZ2h0OiIpIn19fXJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOm51bGx9fX0sSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyOkdyLEltcG9ydFNwZWNpZmllcjpjbGFzcyBleHRlbmRzIEpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX0sTGFiZWxlZFN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7Y29uc3QgdD1lLmJyb2tlbkZsb3c7cmV0dXJuIGUuaWdub3JlLmxhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSwhIXRoaXMuYm9keS5oYXNFZmZlY3RzKGUpfHwoZS5pZ25vcmUubGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuaW5jbHVkZWRMYWJlbHMuaGFzKHRoaXMubGFiZWwubmFtZSkmJihlLmluY2x1ZGVkTGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuYnJva2VuRmxvdz10KSwhMSl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Y29uc3Qgcz1lLmJyb2tlbkZsb3c7dGhpcy5ib2R5LmluY2x1ZGUoZSx0KSwodHx8ZS5pbmNsdWRlZExhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSkmJih0aGlzLmxhYmVsLmluY2x1ZGUoKSxlLmluY2x1ZGVkTGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuYnJva2VuRmxvdz1zKTt9cmVuZGVyKGUsdCl7dGhpcy5sYWJlbC5pbmNsdWRlZD90aGlzLmxhYmVsLnJlbmRlcihlLHQpOmUucmVtb3ZlKHRoaXMuc3RhcnQsZ24oZS5vcmlnaW5hbCxmbihlLm9yaWdpbmFsLCI6Iix0aGlzLmxhYmVsLmVuZCkrMSkpLHRoaXMuYm9keS5yZW5kZXIoZSx0KTt9fSxMaXRlcmFsOlZuLExvZ2ljYWxFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgSnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ9W10sdGhpcy5pc0JyYW5jaFJlc29sdXRpb25BbmFseXNlZD0hMSx0aGlzLnVzZWRCcmFuY2g9bnVsbDt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMubGVmdC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyksdGhpcy5yaWdodC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVDYWNoZSgpe2lmKHRoaXMudXNlZEJyYW5jaCl7Y29uc3QgZT10aGlzLnVzZWRCcmFuY2g9PT10aGlzLmxlZnQ/dGhpcy5yaWdodDp0aGlzLmxlZnQ7dGhpcy51c2VkQnJhbmNoPW51bGwsZS5kZW9wdGltaXplUGF0aChYKTtjb25zdHtjb250ZXh0OnQsZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6c309dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPWdlO2Zvcihjb25zdCBlIG9mIHMpZS5kZW9wdGltaXplQ2FjaGUoKTt0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fWRlb3B0aW1pemVQYXRoKGUpe2NvbnN0IHQ9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dD90LmRlb3B0aW1pemVQYXRoKGUpOih0aGlzLmxlZnQuZGVvcHRpbWl6ZVBhdGgoZSksdGhpcy5yaWdodC5kZW9wdGltaXplUGF0aChlKSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7Y29uc3QgaT10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gaT8odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKHMpLGkuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKSk6aWV9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7Y29uc3Qgbj10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gbj8odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKGkpLG4uZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSkpOltuZXcgSm4oW3RoaXMubGVmdC5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKVswXSx0aGlzLnJpZ2h0LmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpWzBdXSksITFdfWhhc0VmZmVjdHMoZSl7cmV0dXJuICEhdGhpcy5sZWZ0Lmhhc0VmZmVjdHMoZSl8fHRoaXMuZ2V0VXNlZEJyYW5jaCgpIT09dGhpcy5sZWZ0JiZ0aGlzLnJpZ2h0Lmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/aS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk6dGhpcy5sZWZ0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXx8dGhpcy5yaWdodC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Y29uc3Qgcz10aGlzLmdldFVzZWRCcmFuY2goKTt0fHxzPT09dGhpcy5yaWdodCYmdGhpcy5sZWZ0LnNob3VsZEJlSW5jbHVkZWQoZSl8fCFzPyh0aGlzLmxlZnQuaW5jbHVkZShlLHQpLHRoaXMucmlnaHQuaW5jbHVkZShlLHQpKTpzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCx7aXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OnMscHJldmVudEFTSTppLHJlbmRlcmVkUGFyZW50VHlwZTpuLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnJ9PWZlKXtpZih0aGlzLmxlZnQuaW5jbHVkZWQmJnRoaXMucmlnaHQuaW5jbHVkZWQpdGhpcy5sZWZ0LnJlbmRlcihlLHQse3ByZXZlbnRBU0k6aSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpyfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTtlbHNlIHtjb25zdCBvPWZuKGUub3JpZ2luYWwsdGhpcy5vcGVyYXRvcix0aGlzLmxlZnQuZW5kKTtpZih0aGlzLnJpZ2h0LmluY2x1ZGVkKXtjb25zdCB0PWduKGUub3JpZ2luYWwsbysyKTtlLnJlbW92ZSh0aGlzLnN0YXJ0LHQpLGkmJmJuKGUsdCx0aGlzLnJpZ2h0LnN0YXJ0KTt9ZWxzZSBlLnJlbW92ZShvLHRoaXMuZW5kKTtkbih0aGlzLGUpLHRoaXMuZ2V0VXNlZEJyYW5jaCgpLnJlbmRlcihlLHQse2lzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpzLHByZXZlbnRBU0k6aSxyZW5kZXJlZFBhcmVudFR5cGU6bnx8dGhpcy5wYXJlbnQudHlwZSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpyfHx0aGlzLnBhcmVudC50eXBlfSk7fX1nZXRVc2VkQnJhbmNoKCl7aWYoIXRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQpe3RoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQ9ITA7Y29uc3QgZT10aGlzLmxlZnQuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKFksdGUsdGhpcyk7aWYoInN5bWJvbCI9PXR5cGVvZiBlKXJldHVybiBudWxsO3RoaXMudXNlZEJyYW5jaD0ifHwiPT09dGhpcy5vcGVyYXRvciYmZXx8IiYmIj09PXRoaXMub3BlcmF0b3ImJiFlfHwiPz8iPT09dGhpcy5vcGVyYXRvciYmbnVsbCE9ZT90aGlzLmxlZnQ6dGhpcy5yaWdodDt9cmV0dXJuIHRoaXMudXNlZEJyYW5jaH19LE1lbWJlckV4cHJlc3Npb246Rm4sTWV0YVByb3BlcnR5OmNsYXNzIGV4dGVuZHMgSnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMubWV0YVByb3BlcnR5PW51bGwsdGhpcy5wcmVsaW1pbmFyeUNodW5rSWQ9bnVsbCx0aGlzLnJlZmVyZW5jZUlkPW51bGw7fWdldFJlZmVyZW5jZWRGaWxlTmFtZShlKXtjb25zdHttZXRhOntuYW1lOnR9LG1ldGFQcm9wZXJ0eTpzfT10aGlzO3JldHVybiB0PT09cXImJnM/LnN0YXJ0c1dpdGgoV3IpP2UuZ2V0RmlsZU5hbWUocy5zbGljZSgxNikpOm51bGx9aGFzRWZmZWN0cygpe3JldHVybiAhMX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9KXtyZXR1cm4gZS5sZW5ndGg+MXx8MCE9PXR9aW5jbHVkZSgpe2lmKCF0aGlzLmluY2x1ZGVkJiYodGhpcy5pbmNsdWRlZD0hMCx0aGlzLm1ldGEubmFtZT09PXFyKSl7dGhpcy5jb250ZXh0LmFkZEltcG9ydE1ldGEodGhpcyk7Y29uc3QgZT10aGlzLnBhcmVudCx0PXRoaXMubWV0YVByb3BlcnR5PWUgaW5zdGFuY2VvZiBGbiYmInN0cmluZyI9PXR5cGVvZiBlLnByb3BlcnR5S2V5P2UucHJvcGVydHlLZXk6bnVsbDt0Py5zdGFydHNXaXRoKFdyKSYmKHRoaXMucmVmZXJlbmNlSWQ9dC5zbGljZSgxNikpO319cmVuZGVyKGUse2Zvcm1hdDp0LHBsdWdpbkRyaXZlcjpzLHNuaXBwZXRzOml9KXtjb25zdHtjb250ZXh0Onttb2R1bGU6e2lkOm59fSxtZXRhOntuYW1lOnJ9LG1ldGFQcm9wZXJ0eTpvLHBhcmVudDphLHByZWxpbWluYXJ5Q2h1bmtJZDpsLHJlZmVyZW5jZUlkOmMsc3RhcnQ6aCxlbmQ6dX09dGhpcztpZihyIT09cXIpcmV0dXJuO2NvbnN0IGQ9bDtpZihjKXtjb25zdCBpPXMuZ2V0RmlsZU5hbWUoYykscj13KE4kNShDKGQpLGkpKSxvPXMuaG9va0ZpcnN0U3luYygicmVzb2x2ZUZpbGVVcmwiLFt7Y2h1bmtJZDpkLGZpbGVOYW1lOmksZm9ybWF0OnQsbW9kdWxlSWQ6bixyZWZlcmVuY2VJZDpjLHJlbGF0aXZlUGF0aDpyfV0pfHx0b1t0XShyKTtyZXR1cm4gdm9pZCBlLm92ZXJ3cml0ZShhLnN0YXJ0LGEuZW5kLG8se2NvbnRlbnRPbmx5OiEwfSl9Y29uc3QgcD1zLmhvb2tGaXJzdFN5bmMoInJlc29sdmVJbXBvcnRNZXRhIixbbyx7Y2h1bmtJZDpkLGZvcm1hdDp0LG1vZHVsZUlkOm59XSl8fHNvW3RdPy4obyx7Y2h1bmtJZDpkLHNuaXBwZXRzOml9KTsic3RyaW5nIj09dHlwZW9mIHAmJihhIGluc3RhbmNlb2YgRm4/ZS5vdmVyd3JpdGUoYS5zdGFydCxhLmVuZCxwLHtjb250ZW50T25seTohMH0pOmUub3ZlcndyaXRlKGgsdSxwLHtjb250ZW50T25seTohMH0pKTt9c2V0UmVzb2x1dGlvbihlLHQscyl7dGhpcy5wcmVsaW1pbmFyeUNodW5rSWQ9cztjb25zdCBpPSh0aGlzLm1ldGFQcm9wZXJ0eT8uc3RhcnRzV2l0aChXcik/S3I6SHIpW2VdO2kubGVuZ3RoPjAmJnRoaXMuc2NvcGUuYWRkQWNjZXNzZWRHbG9iYWxzKGksdCk7fX0sTWV0aG9kRGVmaW5pdGlvbjpLbixOZXdFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgSnN7aGFzRWZmZWN0cyhlKXt0cnl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5hcmd1bWVudHMpaWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtyZXR1cm4gIXRoaXMuYW5ub3RhdGlvblB1cmUmJih0aGlzLmNhbGxlZS5oYXNFZmZlY3RzKGUpfHx0aGlzLmNhbGxlZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChZLHRoaXMuaW50ZXJhY3Rpb24sZSkpfWZpbmFsbHl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpO319aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx7dHlwZTp0fSl7cmV0dXJuIGUubGVuZ3RoPjB8fDAhPT10fWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdD9zdXBlci5pbmNsdWRlKGUsdCk6KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jYWxsZWUuaW5jbHVkZShlLCExKSksdGhpcy5jYWxsZWUuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0aGlzLmFyZ3VtZW50cyk7fWluaXRpYWxpc2UoKXt0aGlzLmludGVyYWN0aW9uPXthcmdzOltudWxsLC4uLnRoaXMuYXJndW1lbnRzXSx0eXBlOjIsd2l0aE5ldzohMH07fXJlbmRlcihlLHQpe3RoaXMuY2FsbGVlLnJlbmRlcihlLHQpLFRuKGUsdCx0aGlzKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMuY2FsbGVlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuaW50ZXJhY3Rpb24sWSx0ZSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fSxPYmplY3RFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgSnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMub2JqZWN0RW50aXR5PW51bGw7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZUNhY2hlKCl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQWxsUHJvcGVydGllcygpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLmdldE9iamVjdEVudGl0eSgpLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLmdldE9iamVjdEVudGl0eSgpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX1yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpzfT1mZSl7c3VwZXIucmVuZGVyKGUsdCkscyE9PV9zJiZzIT09QXN8fChlLmFwcGVuZFJpZ2h0KHRoaXMuc3RhcnQsIigiKSxlLnByZXBlbmRMZWZ0KHRoaXMuZW5kLCIpIikpO31hcHBseURlb3B0aW1pemF0aW9ucygpe31nZXRPYmplY3RFbnRpdHkoKXtpZihudWxsIT09dGhpcy5vYmplY3RFbnRpdHkpcmV0dXJuIHRoaXMub2JqZWN0RW50aXR5O2xldCBlPWhpO2NvbnN0IHQ9W107Zm9yKGNvbnN0IHMgb2YgdGhpcy5wcm9wZXJ0aWVzKXtpZihzIGluc3RhbmNlb2YgZWkpe3QucHVzaCh7a2V5Olcsa2luZDoiaW5pdCIscHJvcGVydHk6c30pO2NvbnRpbnVlfWxldCBpO2lmKHMuY29tcHV0ZWQpe2NvbnN0IGU9cy5rZXkuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKFksdGUsdGhpcyk7aWYoInN5bWJvbCI9PXR5cGVvZiBlKXt0LnB1c2goe2tleTpXLGtpbmQ6cy5raW5kLHByb3BlcnR5OnN9KTtjb250aW51ZX1pPVN0cmluZyhlKTt9ZWxzZSBpZihpPXMua2V5IGluc3RhbmNlb2YgY24/cy5rZXkubmFtZTpTdHJpbmcocy5rZXkudmFsdWUpLCJfX3Byb3RvX18iPT09aSYmImluaXQiPT09cy5raW5kKXtlPXMudmFsdWUgaW5zdGFuY2VvZiBWbiYmbnVsbD09PXMudmFsdWUudmFsdWU/bnVsbDpzLnZhbHVlO2NvbnRpbnVlfXQucHVzaCh7a2V5Omksa2luZDpzLmtpbmQscHJvcGVydHk6c30pO31yZXR1cm4gdGhpcy5vYmplY3RFbnRpdHk9bmV3IGFpKHQsZSl9fSxPYmplY3RQYXR0ZXJuOk5uLFByaXZhdGVJZGVudGlmaWVyOmNsYXNzIGV4dGVuZHMgSnN7fSxQcm9ncmFtOmlvLFByb3BlcnR5OmNsYXNzIGV4dGVuZHMgSG57Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuZGVjbGFyYXRpb25Jbml0PW51bGw7fWRlY2xhcmUoZSx0KXtyZXR1cm4gdGhpcy5kZWNsYXJhdGlvbkluaXQ9dCx0aGlzLnZhbHVlLmRlY2xhcmUoZSxvZSl9aGFzRWZmZWN0cyhlKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7Y29uc3QgdD10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2UucHJvcGVydHlSZWFkU2lkZUVmZmVjdHM7cmV0dXJuICJPYmplY3RQYXR0ZXJuIj09PXRoaXMucGFyZW50LnR5cGUmJiJhbHdheXMiPT09dHx8dGhpcy5rZXkuaGFzRWZmZWN0cyhlKXx8dGhpcy52YWx1ZS5oYXNFZmZlY3RzKGUpfW1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKXt0aGlzLnZhbHVlLm1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKTt9cmVuZGVyKGUsdCl7dGhpcy5zaG9ydGhhbmR8fHRoaXMua2V5LnJlbmRlcihlLHQpLHRoaXMudmFsdWUucmVuZGVyKGUsdCx7aXNTaG9ydGhhbmRQcm9wZXJ0eTp0aGlzLnNob3J0aGFuZH0pO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsbnVsbCE9PXRoaXMuZGVjbGFyYXRpb25Jbml0JiYodGhpcy5kZWNsYXJhdGlvbkluaXQuZGVvcHRpbWl6ZVBhdGgoW1csV10pLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCkpO319LFByb3BlcnR5RGVmaW5pdGlvbjpjbGFzcyBleHRlbmRzIEpze2Rlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhbHVlPy5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMudmFsdWU/LmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLnZhbHVlP3RoaXMudmFsdWUuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKTppZX1nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKXtyZXR1cm4gdGhpcy52YWx1ZT90aGlzLnZhbHVlLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpOmFlfWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMua2V5Lmhhc0VmZmVjdHMoZSl8fHRoaXMuc3RhdGljJiYhIXRoaXMudmFsdWU/Lmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAhdGhpcy52YWx1ZXx8dGhpcy52YWx1ZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fSxSZXN0RWxlbWVudDprbixSZXR1cm5TdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBKc3toYXNFZmZlY3RzKGUpe3JldHVybiAhKGUuaWdub3JlLnJldHVybllpZWxkJiYhdGhpcy5hcmd1bWVudD8uaGFzRWZmZWN0cyhlKSl8fChlLmJyb2tlbkZsb3c9ITAsITEpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuYXJndW1lbnQ/LmluY2x1ZGUoZSx0KSxlLmJyb2tlbkZsb3c9ITA7fWluaXRpYWxpc2UoKXt0aGlzLnNjb3BlLmFkZFJldHVybkV4cHJlc3Npb24odGhpcy5hcmd1bWVudHx8b2UpO31yZW5kZXIoZSx0KXt0aGlzLmFyZ3VtZW50JiYodGhpcy5hcmd1bWVudC5yZW5kZXIoZSx0LHtwcmV2ZW50QVNJOiEwfSksdGhpcy5hcmd1bWVudC5zdGFydD09PXRoaXMuc3RhcnQrNiYmZS5wcmVwZW5kTGVmdCh0aGlzLnN0YXJ0KzYsIiAiKSk7fX0sU2VxdWVuY2VFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgSnN7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMuZXhwcmVzc2lvbnNbdGhpcy5leHByZXNzaW9ucy5sZW5ndGgtMV0uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLmV4cHJlc3Npb25zW3RoaXMuZXhwcmVzc2lvbnMubGVuZ3RoLTFdLmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLmV4cHJlc3Npb25zW3RoaXMuZXhwcmVzc2lvbnMubGVuZ3RoLTFdLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9aGFzRWZmZWN0cyhlKXtmb3IoY29uc3QgdCBvZiB0aGlzLmV4cHJlc3Npb25zKWlmKHQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7cmV0dXJuICExfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5leHByZXNzaW9uc1t0aGlzLmV4cHJlc3Npb25zLmxlbmd0aC0xXS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Y29uc3Qgcz10aGlzLmV4cHJlc3Npb25zW3RoaXMuZXhwcmVzc2lvbnMubGVuZ3RoLTFdO2Zvcihjb25zdCBpIG9mIHRoaXMuZXhwcmVzc2lvbnMpKHR8fGk9PT1zJiYhKHRoaXMucGFyZW50IGluc3RhbmNlb2YgU24pfHxpLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZpLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCx7cmVuZGVyZWRQYXJlbnRUeXBlOnMsaXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OmkscHJldmVudEFTSTpufT1mZSl7bGV0IHI9MCxvPW51bGw7Y29uc3QgYT10aGlzLmV4cHJlc3Npb25zW3RoaXMuZXhwcmVzc2lvbnMubGVuZ3RoLTFdO2Zvcihjb25zdHtub2RlOmwsc2VwYXJhdG9yOmMsc3RhcnQ6aCxlbmQ6dX1vZiBFbih0aGlzLmV4cHJlc3Npb25zLGUsdGhpcy5zdGFydCx0aGlzLmVuZCkpaWYobC5pbmNsdWRlZClpZihyKyssbz1jLDE9PT1yJiZuJiZibihlLGgsbC5zdGFydCksMT09PXIpe2NvbnN0IG49c3x8dGhpcy5wYXJlbnQudHlwZTtsLnJlbmRlcihlLHQse2lzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDppJiZsPT09YSxyZW5kZXJlZFBhcmVudFR5cGU6bixyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpufSk7fWVsc2UgbC5yZW5kZXIoZSx0KTtlbHNlIHVuKGwsZSxoLHUpO28mJmUucmVtb3ZlKG8sdGhpcy5lbmQpO319LFNwcmVhZEVsZW1lbnQ6ZWksU3RhdGljQmxvY2s6Y2xhc3MgZXh0ZW5kcyBKc3tjcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPW5ldyB2bihlKTt9aGFzRWZmZWN0cyhlKXtmb3IoY29uc3QgdCBvZiB0aGlzLmJvZHkpaWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtyZXR1cm4gITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5ib2R5KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCl7aWYodGhpcy5ib2R5Lmxlbmd0aD4wKXtjb25zdCBzPWZuKGUub3JpZ2luYWwuc2xpY2UodGhpcy5zdGFydCx0aGlzLmVuZCksInsiKSsxO3huKHRoaXMuYm9keSxlLHRoaXMuc3RhcnQrcyx0aGlzLmVuZC0xLHQpO31lbHNlIHN1cGVyLnJlbmRlcihlLHQpO319LFN1cGVyOmNsYXNzIGV4dGVuZHMgSnN7YmluZCgpe3RoaXMudmFyaWFibGU9dGhpcy5zY29wZS5maW5kVmFyaWFibGUoInRoaXMiKTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMudmFyaWFibGUuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLnZhcmlhYmxlLmRlb3B0aW1pemVQYXRoKGUpO31pbmNsdWRlKCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMudmFyaWFibGUpKTt9fSxTd2l0Y2hDYXNlOm5vLFN3aXRjaFN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2NyZWF0ZVNjb3BlKGUpe3RoaXMucGFyZW50U2NvcGU9ZSx0aGlzLnNjb3BlPW5ldyB2bihlKTt9aGFzRWZmZWN0cyhlKXtpZih0aGlzLmRpc2NyaW1pbmFudC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtjb25zdHticm9rZW5GbG93OnQsaGFzQnJlYWs6cyxpZ25vcmU6aX09ZSx7YnJlYWtzOm59PWk7aS5icmVha3M9ITAsZS5oYXNCcmVhaz0hMTtsZXQgcj0hMDtmb3IoY29uc3QgcyBvZiB0aGlzLmNhc2VzKXtpZihzLmhhc0VmZmVjdHMoZSkpcmV0dXJuICEwO3ImJihyPWUuYnJva2VuRmxvdyYmIWUuaGFzQnJlYWspLGUuaGFzQnJlYWs9ITEsZS5icm9rZW5GbG93PXQ7fXJldHVybiBudWxsIT09dGhpcy5kZWZhdWx0Q2FzZSYmKGUuYnJva2VuRmxvdz1yKSxpLmJyZWFrcz1uLGUuaGFzQnJlYWs9cywhMX1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLmRpc2NyaW1pbmFudC5pbmNsdWRlKGUsdCk7Y29uc3R7YnJva2VuRmxvdzpzLGhhc0JyZWFrOml9PWU7ZS5oYXNCcmVhaz0hMTtsZXQgbj0hMCxyPXR8fG51bGwhPT10aGlzLmRlZmF1bHRDYXNlJiZ0aGlzLmRlZmF1bHRDYXNlPHRoaXMuY2FzZXMubGVuZ3RoLTE7Zm9yKGxldCBpPXRoaXMuY2FzZXMubGVuZ3RoLTE7aT49MDtpLS0pe2NvbnN0IG89dGhpcy5jYXNlc1tpXTtpZihvLmluY2x1ZGVkJiYocj0hMCksIXIpe2NvbnN0IGU9c3MoKTtlLmlnbm9yZS5icmVha3M9ITAscj1vLmhhc0VmZmVjdHMoZSk7fXI/KG8uaW5jbHVkZShlLHQpLG4mJihuPWUuYnJva2VuRmxvdyYmIWUuaGFzQnJlYWspLGUuaGFzQnJlYWs9ITEsZS5icm9rZW5GbG93PXMpOm49czt9ciYmbnVsbCE9PXRoaXMuZGVmYXVsdENhc2UmJihlLmJyb2tlbkZsb3c9biksZS5oYXNCcmVhaz1pO31pbml0aWFsaXNlKCl7Zm9yKGxldCBlPTA7ZTx0aGlzLmNhc2VzLmxlbmd0aDtlKyspaWYobnVsbD09PXRoaXMuY2FzZXNbZV0udGVzdClyZXR1cm4gdm9pZCh0aGlzLmRlZmF1bHRDYXNlPWUpO3RoaXMuZGVmYXVsdENhc2U9bnVsbDt9cGFyc2VOb2RlKGUpe3RoaXMuZGlzY3JpbWluYW50PW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKGUuZGlzY3JpbWluYW50LnR5cGUpKShlLmRpc2NyaW1pbmFudCx0aGlzLHRoaXMucGFyZW50U2NvcGUpLHN1cGVyLnBhcnNlTm9kZShlKTt9cmVuZGVyKGUsdCl7dGhpcy5kaXNjcmltaW5hbnQucmVuZGVyKGUsdCksdGhpcy5jYXNlcy5sZW5ndGg+MCYmeG4odGhpcy5jYXNlcyxlLHRoaXMuY2FzZXNbMF0uc3RhcnQsdGhpcy5lbmQtMSx0KTt9fSxUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBVbntiaW5kKCl7aWYoc3VwZXIuYmluZCgpLHRoaXMudGFnLnR5cGU9PT1Ncyl7Y29uc3QgZT10aGlzLnRhZy5uYW1lO3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKGUpLmlzTmFtZXNwYWNlJiZ0aGlzLmNvbnRleHQubG9nKFNlLE10KGUpLHRoaXMuc3RhcnQpO319aGFzRWZmZWN0cyhlKXt0cnl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5xdWFzaS5leHByZXNzaW9ucylpZih0Lmhhc0VmZmVjdHMoZSkpcmV0dXJuICEwO3JldHVybiB0aGlzLnRhZy5oYXNFZmZlY3RzKGUpfHx0aGlzLnRhZy5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChZLHRoaXMuaW50ZXJhY3Rpb24sZSl9ZmluYWxseXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7fX1pbmNsdWRlKGUsdCl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHQ/c3VwZXIuaW5jbHVkZShlLHQpOih0aGlzLmluY2x1ZGVkPSEwLHRoaXMudGFnLmluY2x1ZGUoZSx0KSx0aGlzLnF1YXNpLmluY2x1ZGUoZSx0KSksdGhpcy50YWcuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0aGlzLmFyZ3MpO2NvbnN0W3NdPXRoaXMuZ2V0UmV0dXJuRXhwcmVzc2lvbigpO3MuaW5jbHVkZWR8fHMuaW5jbHVkZShlLCExKTt9aW5pdGlhbGlzZSgpe3RoaXMuYXJncz1bb2UsLi4udGhpcy5xdWFzaS5leHByZXNzaW9uc10sdGhpcy5pbnRlcmFjdGlvbj17YXJnczpbdGhpcy50YWcgaW5zdGFuY2VvZiBGbiYmIXRoaXMudGFnLnZhcmlhYmxlP3RoaXMudGFnLm9iamVjdDpudWxsLC4uLnRoaXMuYXJnc10sdHlwZToyLHdpdGhOZXc6ITF9O31yZW5kZXIoZSx0KXt0aGlzLnRhZy5yZW5kZXIoZSx0LHtpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6ITB9KSx0aGlzLnF1YXNpLnJlbmRlcihlLHQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy50YWcuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgodGhpcy5pbnRlcmFjdGlvbixZLHRlKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO31nZXRSZXR1cm5FeHByZXNzaW9uKGU9dGUpe3JldHVybiBudWxsPT09dGhpcy5yZXR1cm5FeHByZXNzaW9uPyh0aGlzLnJldHVybkV4cHJlc3Npb249YWUsdGhpcy5yZXR1cm5FeHByZXNzaW9uPXRoaXMudGFnLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKFksdGhpcy5pbnRlcmFjdGlvbixlLHRoaXMpKTp0aGlzLnJldHVybkV4cHJlc3Npb259fSxUZW1wbGF0ZUVsZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBKc3tiaW5kKCl7fWhhc0VmZmVjdHMoKXtyZXR1cm4gITF9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWQ9ITA7fXBhcnNlTm9kZShlKXt0aGlzLnZhbHVlPWUudmFsdWUsc3VwZXIucGFyc2VOb2RlKGUpO31yZW5kZXIoKXt9fSxUZW1wbGF0ZUxpdGVyYWw6cm8sVGhpc0V4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBKc3tiaW5kKCl7dGhpcy52YXJpYWJsZT10aGlzLnNjb3BlLmZpbmRWYXJpYWJsZSgidGhpcyIpO31kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dGhpcy52YXJpYWJsZS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMudmFyaWFibGUuZGVvcHRpbWl6ZVBhdGgoZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PWUubGVuZ3RoPzAhPT10LnR5cGU6dGhpcy52YXJpYWJsZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWR8fCh0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY29udGV4dC5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZSh0aGlzLnZhcmlhYmxlKSk7fWluaXRpYWxpc2UoKXt0aGlzLmFsaWFzPXRoaXMuc2NvcGUuZmluZExleGljYWxCb3VuZGFyeSgpaW5zdGFuY2VvZiBsbz90aGlzLmNvbnRleHQubW9kdWxlQ29udGV4dDpudWxsLCJ1bmRlZmluZWQiPT09dGhpcy5hbGlhcyYmdGhpcy5jb250ZXh0LmxvZyhTZSx7Y29kZToiVEhJU19JU19VTkRFRklORUQiLG1lc3NhZ2U6IlRoZSAndGhpcycga2V5d29yZCBpcyBlcXVpdmFsZW50IHRvICd1bmRlZmluZWQnIGF0IHRoZSB0b3AgbGV2ZWwgb2YgYW4gRVMgbW9kdWxlLCBhbmQgaGFzIGJlZW4gcmV3cml0dGVuIix1cmw6T2UoInRyb3VibGVzaG9vdGluZy8jZXJyb3ItdGhpcy1pcy11bmRlZmluZWQiKX0sdGhpcy5zdGFydCk7fXJlbmRlcihlKXtudWxsIT09dGhpcy5hbGlhcyYmZS5vdmVyd3JpdGUodGhpcy5zdGFydCx0aGlzLmVuZCx0aGlzLmFsaWFzLHtjb250ZW50T25seTohMSxzdG9yZU5hbWU6ITB9KTt9fSxUaHJvd1N0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoKXtyZXR1cm4gITB9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5hcmd1bWVudC5pbmNsdWRlKGUsdCksZS5icm9rZW5GbG93PSEwO31yZW5kZXIoZSx0KXt0aGlzLmFyZ3VtZW50LnJlbmRlcihlLHQse3ByZXZlbnRBU0k6ITB9KSx0aGlzLmFyZ3VtZW50LnN0YXJ0PT09dGhpcy5zdGFydCs1JiZlLnByZXBlbmRMZWZ0KHRoaXMuc3RhcnQrNSwiICIpO319LFRyeVN0YXRlbWVudDpjbGFzcyBleHRlbmRzIEpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmRpcmVjdGx5SW5jbHVkZWQ9ITEsdGhpcy5pbmNsdWRlZExhYmVsc0FmdGVyQmxvY2s9bnVsbDt9aGFzRWZmZWN0cyhlKXtyZXR1cm4gKHRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZS50cnlDYXRjaERlb3B0aW1pemF0aW9uP3RoaXMuYmxvY2suYm9keS5sZW5ndGg+MDp0aGlzLmJsb2NrLmhhc0VmZmVjdHMoZSkpfHwhIXRoaXMuZmluYWxpemVyPy5oYXNFZmZlY3RzKGUpfWluY2x1ZGUoZSx0KXtjb25zdCBzPXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZT8udHJ5Q2F0Y2hEZW9wdGltaXphdGlvbix7YnJva2VuRmxvdzppLGluY2x1ZGVkTGFiZWxzOm59PWU7aWYodGhpcy5kaXJlY3RseUluY2x1ZGVkJiZzKXtpZih0aGlzLmluY2x1ZGVkTGFiZWxzQWZ0ZXJCbG9jaylmb3IoY29uc3QgZSBvZiB0aGlzLmluY2x1ZGVkTGFiZWxzQWZ0ZXJCbG9jayluLmFkZChlKTt9ZWxzZSB0aGlzLmluY2x1ZGVkPSEwLHRoaXMuZGlyZWN0bHlJbmNsdWRlZD0hMCx0aGlzLmJsb2NrLmluY2x1ZGUoZSxzP1pzOnQpLG4uc2l6ZT4wJiYodGhpcy5pbmNsdWRlZExhYmVsc0FmdGVyQmxvY2s9Wy4uLm5dKSxlLmJyb2tlbkZsb3c9aTtudWxsIT09dGhpcy5oYW5kbGVyJiYodGhpcy5oYW5kbGVyLmluY2x1ZGUoZSx0KSxlLmJyb2tlbkZsb3c9aSksdGhpcy5maW5hbGl6ZXI/LmluY2x1ZGUoZSx0KTt9fSxVbmFyeUV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBKc3tnZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe2lmKGUubGVuZ3RoPjApcmV0dXJuIGllO2NvbnN0IGk9dGhpcy5hcmd1bWVudC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoWSx0LHMpO3JldHVybiAic3ltYm9sIj09dHlwZW9mIGk/aWU6Y29bdGhpcy5vcGVyYXRvcl0oaSl9aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEoInR5cGVvZiI9PT10aGlzLm9wZXJhdG9yJiZ0aGlzLmFyZ3VtZW50IGluc3RhbmNlb2YgY24pJiYodGhpcy5hcmd1bWVudC5oYXNFZmZlY3RzKGUpfHwiZGVsZXRlIj09PXRoaXMub3BlcmF0b3ImJnRoaXMuYXJndW1lbnQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWSxoZSxlKSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx7dHlwZTp0fSl7cmV0dXJuIDAhPT10fHxlLmxlbmd0aD4oInZvaWQiPT09dGhpcy5vcGVyYXRvcj8wOjEpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMCwiZGVsZXRlIj09PXRoaXMub3BlcmF0b3ImJih0aGlzLmFyZ3VtZW50LmRlb3B0aW1pemVQYXRoKFkpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCkpO319LFVua25vd25Ob2RlOmNsYXNzIGV4dGVuZHMgSnN7aGFzRWZmZWN0cygpe3JldHVybiAhMH1pbmNsdWRlKGUpe3N1cGVyLmluY2x1ZGUoZSwhMCk7fX0sVXBkYXRlRXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIEpze2hhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSx0aGlzLmFyZ3VtZW50Lmhhc0VmZmVjdHNBc0Fzc2lnbm1lbnRUYXJnZXQoZSwhMCl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx7dHlwZTp0fSl7cmV0dXJuIGUubGVuZ3RoPjF8fDAhPT10fWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlZD0hMCx0aGlzLmFyZ3VtZW50LmluY2x1ZGVBc0Fzc2lnbm1lbnRUYXJnZXQoZSx0LCEwKTt9aW5pdGlhbGlzZSgpe3RoaXMuYXJndW1lbnQuc2V0QXNzaWduZWRWYWx1ZShvZSk7fXJlbmRlcihlLHQpe2NvbnN0e2V4cG9ydE5hbWVzQnlWYXJpYWJsZTpzLGZvcm1hdDppLHNuaXBwZXRzOntfOm59fT10O2lmKHRoaXMuYXJndW1lbnQucmVuZGVyKGUsdCksInN5c3RlbSI9PT1pKXtjb25zdCBpPXRoaXMuYXJndW1lbnQudmFyaWFibGUscj1zLmdldChpKTtpZihyKWlmKHRoaXMucHJlZml4KTE9PT1yLmxlbmd0aD9DbihpLHRoaXMuc3RhcnQsdGhpcy5lbmQsZSx0KTokbihpLHRoaXMuc3RhcnQsdGhpcy5lbmQsdGhpcy5wYXJlbnQudHlwZSE9PV9zLGUsdCk7ZWxzZSB7Y29uc3Qgcz10aGlzLm9wZXJhdG9yWzBdOyFmdW5jdGlvbihlLHQscyxpLG4scixvKXtjb25zdHtfOmF9PXIuc25pcHBldHM7bi5wcmVwZW5kUmlnaHQodCxgJHtQbihbZV0scixvKX0sJHthfWApLGkmJihuLnByZXBlbmRSaWdodCh0LCIoIiksbi5hcHBlbmRMZWZ0KHMsIikiKSk7fShpLHRoaXMuc3RhcnQsdGhpcy5lbmQsdGhpcy5wYXJlbnQudHlwZSE9PV9zLGUsdCxgJHtufSR7c30ke259MWApO319fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7aWYodGhpcy5kZW9wdGltaXplZD0hMCx0aGlzLmFyZ3VtZW50LmRlb3B0aW1pemVQYXRoKFkpLHRoaXMuYXJndW1lbnQgaW5zdGFuY2VvZiBjbil7dGhpcy5zY29wZS5maW5kVmFyaWFibGUodGhpcy5hcmd1bWVudC5uYW1lKS5pc1JlYXNzaWduZWQ9ITA7fXRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCk7fX0sVmFyaWFibGVEZWNsYXJhdGlvbjpobyxWYXJpYWJsZURlY2xhcmF0b3I6enIsV2hpbGVTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBKc3toYXNFZmZlY3RzKGUpe3JldHVybiAhIXRoaXMudGVzdC5oYXNFZmZlY3RzKGUpfHxlcihlLHRoaXMuYm9keSl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy50ZXN0LmluY2x1ZGUoZSx0KSx0cihlLHRoaXMuYm9keSx0KTt9fSxZaWVsZEV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBKc3toYXNFZmZlY3RzKGUpe3JldHVybiB0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksIShlLmlnbm9yZS5yZXR1cm5ZaWVsZCYmIXRoaXMuYXJndW1lbnQ/Lmhhc0VmZmVjdHMoZSkpfXJlbmRlcihlLHQpe3RoaXMuYXJndW1lbnQmJih0aGlzLmFyZ3VtZW50LnJlbmRlcihlLHQse3ByZXZlbnRBU0k6ITB9KSx0aGlzLmFyZ3VtZW50LnN0YXJ0PT09dGhpcy5zdGFydCs1JiZlLnByZXBlbmRMZWZ0KHRoaXMuc3RhcnQrNSwiICIpKTt9fX0scG89Il9taXNzaW5nRXhwb3J0U2hpbSI7Y2xhc3MgZm8gZXh0ZW5kcyBkZXtjb25zdHJ1Y3RvcihlKXtzdXBlcihwbyksdGhpcy5tb2R1bGU9ZTt9aW5jbHVkZSgpe3N1cGVyLmluY2x1ZGUoKSx0aGlzLm1vZHVsZS5uZWVkc0V4cG9ydFNoaW09ITA7fX1jbGFzcyBtbyBleHRlbmRzIGRle2NvbnN0cnVjdG9yKGUpe3N1cGVyKGUuZ2V0TW9kdWxlTmFtZSgpKSx0aGlzLm1lbWJlclZhcmlhYmxlcz1udWxsLHRoaXMubWVyZ2VkTmFtZXNwYWNlcz1bXSx0aGlzLnJlZmVyZW5jZWRFYXJseT0hMSx0aGlzLnJlZmVyZW5jZXM9W10sdGhpcy5jb250ZXh0PWUsdGhpcy5tb2R1bGU9ZS5tb2R1bGU7fWFkZFJlZmVyZW5jZShlKXt0aGlzLnJlZmVyZW5jZXMucHVzaChlKSx0aGlzLm5hbWU9ZS5uYW1lO31kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7aWYodC5sZW5ndGg+MXx8MT09PXQubGVuZ3RoJiYyPT09ZS50eXBlKXtjb25zdCBpPXRbMF07InN0cmluZyI9PXR5cGVvZiBpP3RoaXMuZ2V0TWVtYmVyVmFyaWFibGVzKClbaV0/LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdC5zbGljZSgxKSxzKTpsZShlKTt9fWRlb3B0aW1pemVQYXRoKGUpe2lmKGUubGVuZ3RoPjEpe2NvbnN0IHQ9ZVswXTsic3RyaW5nIj09dHlwZW9mIHQmJnRoaXMuZ2V0TWVtYmVyVmFyaWFibGVzKClbdF0/LmRlb3B0aW1pemVQYXRoKGUuc2xpY2UoMSkpO319Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUpe3JldHVybiBlWzBdPT09Sz8iTW9kdWxlIjppZX1nZXRNZW1iZXJWYXJpYWJsZXMoKXtpZih0aGlzLm1lbWJlclZhcmlhYmxlcylyZXR1cm4gdGhpcy5tZW1iZXJWYXJpYWJsZXM7Y29uc3QgZT1PYmplY3QuY3JlYXRlKG51bGwpLHQ9Wy4uLnRoaXMuY29udGV4dC5nZXRFeHBvcnRzKCksLi4udGhpcy5jb250ZXh0LmdldFJlZXhwb3J0cygpXS5zb3J0KCk7Zm9yKGNvbnN0IHMgb2YgdClpZigiKiIhPT1zWzBdJiZzIT09dGhpcy5tb2R1bGUuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMpe2NvbnN0IHQ9dGhpcy5jb250ZXh0LnRyYWNlRXhwb3J0KHMpO3QmJihlW3NdPXQpO31yZXR1cm4gdGhpcy5tZW1iZXJWYXJpYWJsZXM9ZX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7Y29uc3R7dHlwZTppfT10O2lmKDA9PT1lLmxlbmd0aClyZXR1cm4gITA7aWYoMT09PWUubGVuZ3RoJiYyIT09aSlyZXR1cm4gMT09PWk7Y29uc3Qgbj1lWzBdO2lmKCJzdHJpbmciIT10eXBlb2YgbilyZXR1cm4gITA7Y29uc3Qgcj10aGlzLmdldE1lbWJlclZhcmlhYmxlcygpW25dO3JldHVybiAhcnx8ci5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLnNsaWNlKDEpLHQscyl9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jb250ZXh0LmluY2x1ZGVBbGxFeHBvcnRzKCk7fXByZXBhcmUoZSl7dGhpcy5tZXJnZWROYW1lc3BhY2VzLmxlbmd0aD4wJiZ0aGlzLm1vZHVsZS5zY29wZS5hZGRBY2Nlc3NlZEdsb2JhbHMoW3hyXSxlKTt9cmVuZGVyQmxvY2soZSl7Y29uc3R7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOnQsZm9ybWF0OnMsZnJlZXplOmksaW5kZW50Om4sbmFtZXNwYWNlVG9TdHJpbmdUYWc6cixzbmlwcGV0czp7XzpvLGNuc3Q6YSxnZXRPYmplY3Q6bCxnZXRQcm9wZXJ0eUFjY2VzczpjLG46aCxzOnV9fT1lLGQ9dGhpcy5nZXRNZW1iZXJWYXJpYWJsZXMoKSxwPU9iamVjdC5lbnRyaWVzKGQpLmZpbHRlcigoKFtlLHRdKT0+dC5pbmNsdWRlZCkpLm1hcCgoKFtlLHRdKT0+dGhpcy5yZWZlcmVuY2VkRWFybHl8fHQuaXNSZWFzc2lnbmVkfHx0PT09dGhpcz9bbnVsbCxgZ2V0ICR7ZX0ke299KCkke299eyR7b31yZXR1cm4gJHt0LmdldE5hbWUoYyl9JHt1fSR7b319YF06W2UsdC5nZXROYW1lKGMpXSkpO3AudW5zaGlmdChbbnVsbCxgX19wcm90b19fOiR7b31udWxsYF0pO2xldCBmPWwocCx7bGluZUJyZWFrSW5kZW50OntiYXNlOiIiLHQ6bn19KTtpZih0aGlzLm1lcmdlZE5hbWVzcGFjZXMubGVuZ3RoPjApe2NvbnN0IGU9dGhpcy5tZXJnZWROYW1lc3BhY2VzLm1hcCgoZT0+ZS5nZXROYW1lKGMpKSk7Zj1gLyojX19QVVJFX18qLyR7eHJ9KCR7Zn0sJHtvfVske2Uuam9pbihgLCR7b31gKX1dKWA7fWVsc2UgciYmKGY9YC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoJHtmfSwke299U3ltYm9sLnRvU3RyaW5nVGFnLCR7b30ke1ZyKGwpfSlgKSxpJiYoZj1gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoJHtmfSlgKTtyZXR1cm4gZj1gJHthfSAke3RoaXMuZ2V0TmFtZShjKX0ke299PSR7b30ke2Z9O2AsInN5c3RlbSI9PT1zJiZ0Lmhhcyh0aGlzKSYmKGYrPWAke2h9JHtQbihbdGhpc10sZSl9O2ApLGZ9cmVuZGVyRmlyc3QoKXtyZXR1cm4gdGhpcy5yZWZlcmVuY2VkRWFybHl9c2V0TWVyZ2VkTmFtZXNwYWNlcyhlKXt0aGlzLm1lcmdlZE5hbWVzcGFjZXM9ZTtjb25zdCB0PXRoaXMuY29udGV4dC5nZXRNb2R1bGVFeGVjSW5kZXgoKTtmb3IoY29uc3QgZSBvZiB0aGlzLnJlZmVyZW5jZXMpaWYoZS5jb250ZXh0LmdldE1vZHVsZUV4ZWNJbmRleCgpPD10KXt0aGlzLnJlZmVyZW5jZWRFYXJseT0hMDticmVha319fW1vLnByb3RvdHlwZS5pc05hbWVzcGFjZT0hMDtjbGFzcyBnbyBleHRlbmRzIGRle2NvbnN0cnVjdG9yKGUsdCxzKXtzdXBlcih0KSx0aGlzLmJhc2VWYXJpYWJsZT1udWxsLHRoaXMuY29udGV4dD1lLHRoaXMubW9kdWxlPWUubW9kdWxlLHRoaXMuc3ludGhldGljTmFtZXNwYWNlPXM7fWdldEJhc2VWYXJpYWJsZSgpe2lmKHRoaXMuYmFzZVZhcmlhYmxlKXJldHVybiB0aGlzLmJhc2VWYXJpYWJsZTtsZXQgZT10aGlzLnN5bnRoZXRpY05hbWVzcGFjZTtmb3IoO2UgaW5zdGFuY2VvZiBhb3x8ZSBpbnN0YW5jZW9mIGdvOyl7aWYoZSBpbnN0YW5jZW9mIGFvKXtjb25zdCB0PWUuZ2V0T3JpZ2luYWxWYXJpYWJsZSgpO2lmKHQ9PT1lKWJyZWFrO2U9dDt9ZSBpbnN0YW5jZW9mIGdvJiYoZT1lLnN5bnRoZXRpY05hbWVzcGFjZSk7fXJldHVybiB0aGlzLmJhc2VWYXJpYWJsZT1lfWdldEJhc2VWYXJpYWJsZU5hbWUoKXtyZXR1cm4gdGhpcy5zeW50aGV0aWNOYW1lc3BhY2UuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpfWdldE5hbWUoZSl7cmV0dXJuIGAke3RoaXMuc3ludGhldGljTmFtZXNwYWNlLmdldE5hbWUoZSl9JHtlKHRoaXMubmFtZSl9YH1pbmNsdWRlKCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy5zeW50aGV0aWNOYW1lc3BhY2UpO31zZXRSZW5kZXJOYW1lcyhlLHQpe3N1cGVyLnNldFJlbmRlck5hbWVzKGUsdCk7fX12YXIgeW87IWZ1bmN0aW9uKGUpe2VbZS5MT0FEX0FORF9QQVJTRT0wXT0iTE9BRF9BTkRfUEFSU0UiLGVbZS5BTkFMWVNFPTFdPSJBTkFMWVNFIixlW2UuR0VORVJBVEU9Ml09IkdFTkVSQVRFIjt9KHlvfHwoeW89e30pKTtjb25zdCB4bz1uZXcgV2Vha01hcDtmdW5jdGlvbiBFbyhlLHQpe2lmKGUpe2NvbnN0IHQ9eG8uZ2V0KGUpO3QmJmZ1bmN0aW9uKGUpe3ZvaWQgMD09PWUuZW5jb2RlZE1hcHBpbmdzJiZlLmRlY29kZWRNYXBwaW5ncyYmKGUuZW5jb2RlZE1hcHBpbmdzPWkuZW5jb2RlKGUuZGVjb2RlZE1hcHBpbmdzKSksZS5kZWNvZGVkTWFwcGluZ3M9dm9pZCAwO30odCk7fWlmKHQpZm9yKGNvbnN0IGUgb2YgdCllLm1pc3Npbmd8fEVvKGUpO31mdW5jdGlvbiBibyhlKXtpZighZSlyZXR1cm4gbnVsbDtpZigic3RyaW5nIj09dHlwZW9mIGUmJihlPUpTT04ucGFyc2UoZSkpLCFlLm1hcHBpbmdzKXJldHVybiB7bWFwcGluZ3M6W10sbmFtZXM6W10sc291cmNlczpbXSx2ZXJzaW9uOjN9O2NvbnN0IHQ9ZS5tYXBwaW5ncyxzPUFycmF5LmlzQXJyYXkodCksbj17ZGVjb2RlZE1hcHBpbmdzOnM/dDp2b2lkIDAsZW5jb2RlZE1hcHBpbmdzOnM/dm9pZCAwOnR9LHI9ey4uLmUsZ2V0IG1hcHBpbmdzKCl7cmV0dXJuIG4uZGVjb2RlZE1hcHBpbmdzfHwobi5kZWNvZGVkTWFwcGluZ3M9bi5lbmNvZGVkTWFwcGluZ3M/aS5kZWNvZGUobi5lbmNvZGVkTWFwcGluZ3MpOltdLG4uZW5jb2RlZE1hcHBpbmdzPXZvaWQgMCksbi5kZWNvZGVkTWFwcGluZ3N9fTtyZXR1cm4geG8uc2V0KHIsbikscn1mdW5jdGlvbiB2byhlKXtyZXR1cm4gZS5pZH1jb25zdCBTbz1lPT57Y29uc3QgdD1lLmtleTtyZXR1cm4gdCYmKHQubmFtZXx8dC52YWx1ZSl9O2Z1bmN0aW9uIEFvKGUsdCl7Y29uc3Qgcz1PYmplY3Qua2V5cyhlKTtyZXR1cm4gcy5sZW5ndGghPT1PYmplY3Qua2V5cyh0KS5sZW5ndGh8fHMuc29tZSgocz0+ZVtzXSE9PXRbc10pKX12YXIga289InBlcmZvcm1hbmNlImluKCJ1bmRlZmluZWQiPT10eXBlb2YgZ2xvYmFsVGhpcz8idW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdz97fTp3aW5kb3c6Z2xvYmFsVGhpcyk/cGVyZm9ybWFuY2U6e25vdzooKT0+MH0sSW89e21lbW9yeVVzYWdlOigpPT4oe2hlYXBVc2VkOjB9KX07bGV0IHdvPW5ldyBNYXA7ZnVuY3Rpb24gUG8oZSx0KXtzd2l0Y2godCl7Y2FzZSAxOnJldHVybiBgIyAke2V9YDtjYXNlIDI6cmV0dXJuIGAjIyAke2V9YDtjYXNlIDM6cmV0dXJuIGU7ZGVmYXVsdDpyZXR1cm4gYCR7IiAgIi5yZXBlYXQodC00KX0tICR7ZX1gfX1mdW5jdGlvbiBDbyhlLHQ9Myl7ZT1QbyhlLHQpO2NvbnN0IHM9SW8ubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZCxpPWtvLm5vdygpLG49d28uZ2V0KGUpO3ZvaWQgMD09PW4/d28uc2V0KGUse21lbW9yeTowLHN0YXJ0TWVtb3J5OnMsc3RhcnRUaW1lOmksdGltZTowLHRvdGFsTWVtb3J5OjB9KToobi5zdGFydE1lbW9yeT1zLG4uc3RhcnRUaW1lPWkpO31mdW5jdGlvbiAkbyhlLHQ9Myl7ZT1QbyhlLHQpO2NvbnN0IHM9d28uZ2V0KGUpO2lmKHZvaWQgMCE9PXMpe2NvbnN0IGU9SW8ubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtzLm1lbW9yeSs9ZS1zLnN0YXJ0TWVtb3J5LHMudGltZSs9a28ubm93KCktcy5zdGFydFRpbWUscy50b3RhbE1lbW9yeT1NYXRoLm1heChzLnRvdGFsTWVtb3J5LGUpO319ZnVuY3Rpb24gTm8oKXtjb25zdCBlPXt9O2Zvcihjb25zdFt0LHttZW1vcnk6cyx0aW1lOmksdG90YWxNZW1vcnk6bn1db2Ygd28pZVt0XT1baSxzLG5dO3JldHVybiBlfWxldCBfbz1qaSxSbz1qaTtjb25zdCBNbz1bImF1Z21lbnRDaHVua0hhc2giLCJidWlsZEVuZCIsImJ1aWxkU3RhcnQiLCJnZW5lcmF0ZUJ1bmRsZSIsImxvYWQiLCJtb2R1bGVQYXJzZWQiLCJvcHRpb25zIiwib3V0cHV0T3B0aW9ucyIsInJlbmRlckNodW5rIiwicmVuZGVyRHluYW1pY0ltcG9ydCIsInJlbmRlclN0YXJ0IiwicmVzb2x2ZUR5bmFtaWNJbXBvcnQiLCJyZXNvbHZlRmlsZVVybCIsInJlc29sdmVJZCIsInJlc29sdmVJbXBvcnRNZXRhIiwic2hvdWxkVHJhbnNmb3JtQ2FjaGVkTW9kdWxlIiwidHJhbnNmb3JtIiwid3JpdGVCdW5kbGUiXTtmdW5jdGlvbiBPbyhlLHQpe2Zvcihjb25zdCBzIG9mIE1vKWlmKHMgaW4gZSl7bGV0IGk9YHBsdWdpbiAke3R9YDtlLm5hbWUmJihpKz1gICgke2UubmFtZX0pYCksaSs9YCAtICR7c31gO2NvbnN0IG49ZnVuY3Rpb24oLi4uZSl7X28oaSw0KTtjb25zdCB0PXIuYXBwbHkodGhpcyxlKTtyZXR1cm4gUm8oaSw0KSx0fTtsZXQgcjsiZnVuY3Rpb24iPT10eXBlb2YgZVtzXS5oYW5kbGVyPyhyPWVbc10uaGFuZGxlcixlW3NdLmhhbmRsZXI9bik6KHI9ZVtzXSxlW3NdPW4pO31yZXR1cm4gZX1mdW5jdGlvbiBEbyhlKXtlLmlzRXhlY3V0ZWQ9ITA7Y29uc3QgdD1bZV0scz1uZXcgU2V0O2Zvcihjb25zdCBlIG9mIHQpZm9yKGNvbnN0IGkgb2YgWy4uLmUuZGVwZW5kZW5jaWVzLC4uLmUuaW1wbGljaXRseUxvYWRlZEJlZm9yZV0paSBpbnN0YW5jZW9mIFp0fHxpLmlzRXhlY3V0ZWR8fCFpLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMmJiFlLmltcGxpY2l0bHlMb2FkZWRCZWZvcmUuaGFzKGkpfHxzLmhhcyhpLmlkKXx8KGkuaXNFeGVjdXRlZD0hMCxzLmFkZChpLmlkKSx0LnB1c2goaSkpO31jb25zdCBMbz17aWRlbnRpZmllcjpudWxsLGxvY2FsTmFtZTpwb307ZnVuY3Rpb24gVG8oZSx0LHMsaSxuPW5ldyBNYXApe2NvbnN0IHI9bi5nZXQodCk7aWYocil7aWYoci5oYXMoZSkpcmV0dXJuIGk/W251bGxdOlhlKChvPXQsYT1lLmlkLHtjb2RlOm50LGV4cG9ydGVyOmEsbWVzc2FnZTpgIiR7b30iIGNhbm5vdCBiZSBleHBvcnRlZCBmcm9tICIke1QoYSl9IiBhcyBpdCBpcyBhIHJlZXhwb3J0IHRoYXQgcmVmZXJlbmNlcyBpdHNlbGYuYH0pKTtyLmFkZChlKTt9ZWxzZSBuLnNldCh0LG5ldyBTZXQoW2VdKSk7dmFyIG8sYTtyZXR1cm4gZS5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUodCx7aW1wb3J0ZXJGb3JTaWRlRWZmZWN0czpzLGlzRXhwb3J0QWxsU2VhcmNoOmksc2VhcmNoZWROYW1lc0FuZE1vZHVsZXM6bn0pfWZ1bmN0aW9uIFZvKGUsdCl7Y29uc3Qgcz1qKHQuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUsZSxVJDIpO2xldCBpPWU7Y29uc3Qgbj1uZXcgU2V0KFtpXSk7Zm9yKDs7KXtjb25zdCBlPWkubW9kdWxlO2lmKGk9aSBpbnN0YW5jZW9mIGFvP2kuZ2V0RGlyZWN0T3JpZ2luYWxWYXJpYWJsZSgpOmkgaW5zdGFuY2VvZiBnbz9pLnN5bnRoZXRpY05hbWVzcGFjZTpudWxsLCFpfHxuLmhhcyhpKSlicmVhaztuLmFkZChpKSxzLmFkZChlKTtjb25zdCB0PWUuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUuZ2V0KGkpO2lmKHQpZm9yKGNvbnN0IGUgb2YgdClzLmFkZChlKTt9cmV0dXJuIHN9Y2xhc3MgQm97Y29uc3RydWN0b3IoZSx0LHMsaSxuLHIsbyxhKXt0aGlzLmdyYXBoPWUsdGhpcy5pZD10LHRoaXMub3B0aW9ucz1zLHRoaXMuYWx0ZXJuYXRpdmVSZWV4cG9ydE1vZHVsZXM9bmV3IE1hcCx0aGlzLmNodW5rRmlsZU5hbWVzPW5ldyBTZXQsdGhpcy5jaHVua05hbWVzPVtdLHRoaXMuY3ljbGVzPW5ldyBTZXQsdGhpcy5kZXBlbmRlbmNpZXM9bmV3IFNldCx0aGlzLmR5bmFtaWNEZXBlbmRlbmNpZXM9bmV3IFNldCx0aGlzLmR5bmFtaWNJbXBvcnRlcnM9W10sdGhpcy5keW5hbWljSW1wb3J0cz1bXSx0aGlzLmV4ZWNJbmRleD0xLzAsdGhpcy5pbXBsaWNpdGx5TG9hZGVkQWZ0ZXI9bmV3IFNldCx0aGlzLmltcGxpY2l0bHlMb2FkZWRCZWZvcmU9bmV3IFNldCx0aGlzLmltcG9ydERlc2NyaXB0aW9ucz1uZXcgTWFwLHRoaXMuaW1wb3J0TWV0YXM9W10sdGhpcy5pbXBvcnRlZEZyb21Ob3RUcmVlc2hha2VuPSExLHRoaXMuaW1wb3J0ZXJzPVtdLHRoaXMuaW5jbHVkZWREeW5hbWljSW1wb3J0ZXJzPVtdLHRoaXMuaW5jbHVkZWRJbXBvcnRzPW5ldyBTZXQsdGhpcy5pc0V4ZWN1dGVkPSExLHRoaXMuaXNVc2VyRGVmaW5lZEVudHJ5UG9pbnQ9ITEsdGhpcy5uZWVkc0V4cG9ydFNoaW09ITEsdGhpcy5zaWRlRWZmZWN0RGVwZW5kZW5jaWVzQnlWYXJpYWJsZT1uZXcgTWFwLHRoaXMuc291cmNlc1dpdGhBc3NlcnRpb25zPW5ldyBNYXAsdGhpcy5hbGxFeHBvcnROYW1lcz1udWxsLHRoaXMuYXN0PW51bGwsdGhpcy5leHBvcnRBbGxNb2R1bGVzPVtdLHRoaXMuZXhwb3J0QWxsU291cmNlcz1uZXcgU2V0LHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlPW51bGwsdGhpcy5leHBvcnRTaGltVmFyaWFibGU9bmV3IGZvKHRoaXMpLHRoaXMuZXhwb3J0cz1uZXcgTWFwLHRoaXMubmFtZXNwYWNlUmVleHBvcnRzQnlOYW1lPW5ldyBNYXAsdGhpcy5yZWV4cG9ydERlc2NyaXB0aW9ucz1uZXcgTWFwLHRoaXMucmVsZXZhbnREZXBlbmRlbmNpZXM9bnVsbCx0aGlzLnN5bnRoZXRpY0V4cG9ydHM9bmV3IE1hcCx0aGlzLnN5bnRoZXRpY05hbWVzcGFjZT1udWxsLHRoaXMudHJhbnNmb3JtRGVwZW5kZW5jaWVzPVtdLHRoaXMudHJhbnNpdGl2ZVJlZXhwb3J0cz1udWxsLHRoaXMuZXhjbHVkZUZyb21Tb3VyY2VtYXA9L1wwLy50ZXN0KHQpLHRoaXMuY29udGV4dD1zLm1vZHVsZUNvbnRleHQodCksdGhpcy5wcmVzZXJ2ZVNpZ25hdHVyZT10aGlzLm9wdGlvbnMucHJlc2VydmVFbnRyeVNpZ25hdHVyZXM7Y29uc3QgbD10aGlzLHtkeW5hbWljSW1wb3J0czpjLGR5bmFtaWNJbXBvcnRlcnM6aCxleHBvcnRBbGxTb3VyY2VzOnUsZXhwb3J0czpkLGltcGxpY2l0bHlMb2FkZWRBZnRlcjpwLGltcGxpY2l0bHlMb2FkZWRCZWZvcmU6ZixpbXBvcnRlcnM6bSxyZWV4cG9ydERlc2NyaXB0aW9uczpnLHNvdXJjZXNXaXRoQXNzZXJ0aW9uczp5fT10aGlzO3RoaXMuaW5mbz17YXNzZXJ0aW9uczphLGFzdDpudWxsLGNvZGU6bnVsbCxnZXQgZHluYW1pY2FsbHlJbXBvcnRlZElkUmVzb2x1dGlvbnMoKXtyZXR1cm4gYy5tYXAoKCh7YXJndW1lbnQ6ZX0pPT4ic3RyaW5nIj09dHlwZW9mIGUmJmwucmVzb2x2ZWRJZHNbZV0pKS5maWx0ZXIoQm9vbGVhbil9LGdldCBkeW5hbWljYWxseUltcG9ydGVkSWRzKCl7cmV0dXJuIGMubWFwKCgoe2lkOmV9KT0+ZSkpLmZpbHRlcigoZT0+bnVsbCE9ZSkpfSxnZXQgZHluYW1pY0ltcG9ydGVycygpe3JldHVybiBoLnNvcnQoKX0sZ2V0IGV4cG9ydGVkQmluZGluZ3MoKXtjb25zdCBlPXsiLiI6Wy4uLmQua2V5cygpXX07Zm9yKGNvbnN0W3Qse3NvdXJjZTpzfV1vZiBnKShlW3NdPz8oZVtzXT1bXSkpLnB1c2godCk7Zm9yKGNvbnN0IHQgb2YgdSkoZVt0XT8/KGVbdF09W10pKS5wdXNoKCIqIik7cmV0dXJuIGV9LGdldCBleHBvcnRzKCl7cmV0dXJuIFsuLi5kLmtleXMoKSwuLi5nLmtleXMoKSwuLi5bLi4udV0ubWFwKCgoKT0+IioiKSldfSxnZXQgaGFzRGVmYXVsdEV4cG9ydCgpe3JldHVybiBsLmFzdD9sLmV4cG9ydHMuaGFzKCJkZWZhdWx0Iil8fGcuaGFzKCJkZWZhdWx0Iik6bnVsbH0sZ2V0IGhhc01vZHVsZVNpZGVFZmZlY3RzKCl7cmV0dXJuIFh0KCJBY2Nlc3NpbmcgTW9kdWxlSW5mby5oYXNNb2R1bGVTaWRlRWZmZWN0cyBmcm9tIHBsdWdpbnMgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBNb2R1bGVJbmZvLm1vZHVsZVNpZGVFZmZlY3RzIGluc3RlYWQuIixZZSwhMCxzKSx0aGlzLm1vZHVsZVNpZGVFZmZlY3RzfSxpZDp0LGdldCBpbXBsaWNpdGx5TG9hZGVkQWZ0ZXJPbmVPZigpe3JldHVybiBBcnJheS5mcm9tKHAsdm8pLnNvcnQoKX0sZ2V0IGltcGxpY2l0bHlMb2FkZWRCZWZvcmUoKXtyZXR1cm4gQXJyYXkuZnJvbShmLHZvKS5zb3J0KCl9LGdldCBpbXBvcnRlZElkUmVzb2x1dGlvbnMoKXtyZXR1cm4gQXJyYXkuZnJvbSh5LmtleXMoKSwoZT0+bC5yZXNvbHZlZElkc1tlXSkpLmZpbHRlcihCb29sZWFuKX0sZ2V0IGltcG9ydGVkSWRzKCl7cmV0dXJuIEFycmF5LmZyb20oeS5rZXlzKCksKGU9PmwucmVzb2x2ZWRJZHNbZV0/LmlkKSkuZmlsdGVyKEJvb2xlYW4pfSxnZXQgaW1wb3J0ZXJzKCl7cmV0dXJuIG0uc29ydCgpfSxpc0VudHJ5OmksaXNFeHRlcm5hbDohMSxnZXQgaXNJbmNsdWRlZCgpe3JldHVybiBlLnBoYXNlIT09eW8uR0VORVJBVEU/bnVsbDpsLmlzSW5jbHVkZWQoKX0sbWV0YTp7Li4ub30sbW9kdWxlU2lkZUVmZmVjdHM6bixzeW50aGV0aWNOYW1lZEV4cG9ydHM6cn0sT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuaW5mbywiaGFzTW9kdWxlU2lkZUVmZmVjdHMiLHtlbnVtZXJhYmxlOiExfSk7fWJhc2VuYW1lKCl7Y29uc3QgZT1QKHRoaXMuaWQpLHQ9JCh0aGlzLmlkKTtyZXR1cm4gdmUodD9lLnNsaWNlKDAsLXQubGVuZ3RoKTplKX1iaW5kUmVmZXJlbmNlcygpe3RoaXMuYXN0LmJpbmQoKTt9ZXJyb3IoZSx0KXtyZXR1cm4gdGhpcy5hZGRMb2NhdGlvblRvTG9nUHJvcHMoZSx0KSxYZShlKX1lc3RpbWF0ZVNpemUoKXtsZXQgZT0wO2Zvcihjb25zdCB0IG9mIHRoaXMuYXN0LmJvZHkpdC5pbmNsdWRlZCYmKGUrPXQuZW5kLXQuc3RhcnQpO3JldHVybiBlfWdldEFsbEV4cG9ydE5hbWVzKCl7aWYodGhpcy5hbGxFeHBvcnROYW1lcylyZXR1cm4gdGhpcy5hbGxFeHBvcnROYW1lczt0aGlzLmFsbEV4cG9ydE5hbWVzPW5ldyBTZXQoWy4uLnRoaXMuZXhwb3J0cy5rZXlzKCksLi4udGhpcy5yZWV4cG9ydERlc2NyaXB0aW9ucy5rZXlzKCldKTtmb3IoY29uc3QgZSBvZiB0aGlzLmV4cG9ydEFsbE1vZHVsZXMpaWYoZSBpbnN0YW5jZW9mIFp0KXRoaXMuYWxsRXhwb3J0TmFtZXMuYWRkKGAqJHtlLmlkfWApO2Vsc2UgZm9yKGNvbnN0IHQgb2YgZS5nZXRBbGxFeHBvcnROYW1lcygpKSJkZWZhdWx0IiE9PXQmJnRoaXMuYWxsRXhwb3J0TmFtZXMuYWRkKHQpO3JldHVybiAic3RyaW5nIj09dHlwZW9mIHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMmJnRoaXMuYWxsRXhwb3J0TmFtZXMuZGVsZXRlKHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMpLHRoaXMuYWxsRXhwb3J0TmFtZXN9Z2V0RGVwZW5kZW5jaWVzVG9CZUluY2x1ZGVkKCl7aWYodGhpcy5yZWxldmFudERlcGVuZGVuY2llcylyZXR1cm4gdGhpcy5yZWxldmFudERlcGVuZGVuY2llczt0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzPW5ldyBTZXQ7Y29uc3QgZT1uZXcgU2V0LHQ9bmV3IFNldCxzPW5ldyBTZXQodGhpcy5pbmNsdWRlZEltcG9ydHMpO2lmKHRoaXMuaW5mby5pc0VudHJ5fHx0aGlzLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5sZW5ndGg+MHx8dGhpcy5uYW1lc3BhY2UuaW5jbHVkZWR8fHRoaXMuaW1wbGljaXRseUxvYWRlZEFmdGVyLnNpemU+MClmb3IoY29uc3QgZSBvZiBbLi4udGhpcy5nZXRSZWV4cG9ydHMoKSwuLi50aGlzLmdldEV4cG9ydHMoKV0pe2NvbnN0W3RdPXRoaXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKGUpO3Q/LmluY2x1ZGVkJiZzLmFkZCh0KTt9Zm9yKGxldCBpIG9mIHMpe2NvbnN0IHM9dGhpcy5zaWRlRWZmZWN0RGVwZW5kZW5jaWVzQnlWYXJpYWJsZS5nZXQoaSk7aWYocylmb3IoY29uc3QgZSBvZiBzKXQuYWRkKGUpO2kgaW5zdGFuY2VvZiBnbz9pPWkuZ2V0QmFzZVZhcmlhYmxlKCk6aSBpbnN0YW5jZW9mIGFvJiYoaT1pLmdldE9yaWdpbmFsVmFyaWFibGUoKSksZS5hZGQoaS5tb2R1bGUpO31pZih0aGlzLm9wdGlvbnMudHJlZXNoYWtlJiYibm8tdHJlZXNoYWtlIiE9PXRoaXMuaW5mby5tb2R1bGVTaWRlRWZmZWN0cyl0aGlzLmFkZFJlbGV2YW50U2lkZUVmZmVjdERlcGVuZGVuY2llcyh0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzLGUsdCk7ZWxzZSBmb3IoY29uc3QgZSBvZiB0aGlzLmRlcGVuZGVuY2llcyl0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzLmFkZChlKTtmb3IoY29uc3QgdCBvZiBlKXRoaXMucmVsZXZhbnREZXBlbmRlbmNpZXMuYWRkKHQpO3JldHVybiB0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzfWdldEV4cG9ydE5hbWVzQnlWYXJpYWJsZSgpe2lmKHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKXJldHVybiB0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZTtjb25zdCBlPW5ldyBNYXA7Zm9yKGNvbnN0IHQgb2YgdGhpcy5nZXRBbGxFeHBvcnROYW1lcygpKXtsZXRbc109dGhpcy5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUodCk7aWYocyBpbnN0YW5jZW9mIGFvJiYocz1zLmdldE9yaWdpbmFsVmFyaWFibGUoKSksIXN8fCEocy5pbmNsdWRlZHx8cyBpbnN0YW5jZW9mIHBlKSljb250aW51ZTtjb25zdCBpPWUuZ2V0KHMpO2k/aS5wdXNoKHQpOmUuc2V0KHMsW3RdKTt9cmV0dXJuIHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlPWV9Z2V0RXhwb3J0cygpe3JldHVybiBbLi4udGhpcy5leHBvcnRzLmtleXMoKV19Z2V0UmVleHBvcnRzKCl7aWYodGhpcy50cmFuc2l0aXZlUmVleHBvcnRzKXJldHVybiB0aGlzLnRyYW5zaXRpdmVSZWV4cG9ydHM7dGhpcy50cmFuc2l0aXZlUmVleHBvcnRzPVtdO2NvbnN0IGU9bmV3IFNldCh0aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zLmtleXMoKSk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5leHBvcnRBbGxNb2R1bGVzKWlmKHQgaW5zdGFuY2VvZiBadCllLmFkZChgKiR7dC5pZH1gKTtlbHNlIGZvcihjb25zdCBzIG9mIFsuLi50LmdldFJlZXhwb3J0cygpLC4uLnQuZ2V0RXhwb3J0cygpXSkiZGVmYXVsdCIhPT1zJiZlLmFkZChzKTtyZXR1cm4gdGhpcy50cmFuc2l0aXZlUmVleHBvcnRzPVsuLi5lXX1nZXRSZW5kZXJlZEV4cG9ydHMoKXtjb25zdCBlPVtdLHQ9W107Zm9yKGNvbnN0IHMgb2YgdGhpcy5leHBvcnRzLmtleXMoKSl7Y29uc3RbaV09dGhpcy5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUocyk7KGkmJmkuaW5jbHVkZWQ/ZTp0KS5wdXNoKHMpO31yZXR1cm4ge3JlbW92ZWRFeHBvcnRzOnQscmVuZGVyZWRFeHBvcnRzOmV9fWdldFN5bnRoZXRpY05hbWVzcGFjZSgpe3JldHVybiBudWxsPT09dGhpcy5zeW50aGV0aWNOYW1lc3BhY2UmJih0aGlzLnN5bnRoZXRpY05hbWVzcGFjZT12b2lkIDAsW3RoaXMuc3ludGhldGljTmFtZXNwYWNlXT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZSgic3RyaW5nIj09dHlwZW9mIHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHM/dGhpcy5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0czoiZGVmYXVsdCIse29ubHlFeHBsaWNpdDohMH0pKSx0aGlzLnN5bnRoZXRpY05hbWVzcGFjZT90aGlzLnN5bnRoZXRpY05hbWVzcGFjZTpYZSgoZT10aGlzLmlkLHQ9dGhpcy5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0cyx7Y29kZToiU1lOVEhFVElDX05BTUVEX0VYUE9SVFNfTkVFRF9OQU1FU1BBQ0VfRVhQT1JUIixleHBvcnRlcjplLG1lc3NhZ2U6YE1vZHVsZSAiJHtUKGUpfSIgdGhhdCBpcyBtYXJrZWQgd2l0aCBcYHN5bnRoZXRpY05hbWVkRXhwb3J0czogJHtKU09OLnN0cmluZ2lmeSh0KX1cYCBuZWVkcyAkeyJzdHJpbmciPT10eXBlb2YgdCYmImRlZmF1bHQiIT09dD9gYW4gZXhwbGljaXQgZXhwb3J0IG5hbWVkICIke3R9ImA6ImEgZGVmYXVsdCBleHBvcnQifSB0aGF0IGRvZXMgbm90IHJlZXhwb3J0IGFuIHVucmVzb2x2ZWQgbmFtZWQgZXhwb3J0IG9mIHRoZSBzYW1lIG1vZHVsZS5gfSkpO3ZhciBlLHQ7fWdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlLHtpbXBvcnRlckZvclNpZGVFZmZlY3RzOnQsaXNFeHBvcnRBbGxTZWFyY2g6cyxvbmx5RXhwbGljaXQ6aSxzZWFyY2hlZE5hbWVzQW5kTW9kdWxlczpufT1tZSl7aWYoIioiPT09ZVswXSl7aWYoMT09PWUubGVuZ3RoKXJldHVybiBbdGhpcy5uYW1lc3BhY2VdO3JldHVybiB0aGlzLmdyYXBoLm1vZHVsZXNCeUlkLmdldChlLnNsaWNlKDEpKS5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUoIioiKX1jb25zdCByPXRoaXMucmVleHBvcnREZXNjcmlwdGlvbnMuZ2V0KGUpO2lmKHIpe2NvbnN0W2VdPVRvKHIubW9kdWxlLHIubG9jYWxOYW1lLHQsITEsbik7cmV0dXJuIGU/KHQmJih6byhlLHQsdGhpcyksdGhpcy5pbmZvLm1vZHVsZVNpZGVFZmZlY3RzJiZqKHQuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUsZSxVJDIpLmFkZCh0aGlzKSksW2VdKTp0aGlzLmVycm9yKGp0KHIubG9jYWxOYW1lLHRoaXMuaWQsci5tb2R1bGUuaWQpLHIuc3RhcnQpfWNvbnN0IG89dGhpcy5leHBvcnRzLmdldChlKTtpZihvKXtpZihvPT09TG8pcmV0dXJuIFt0aGlzLmV4cG9ydFNoaW1WYXJpYWJsZV07Y29uc3QgZT1vLmxvY2FsTmFtZSxzPXRoaXMudHJhY2VWYXJpYWJsZShlLHtpbXBvcnRlckZvclNpZGVFZmZlY3RzOnQsc2VhcmNoZWROYW1lc0FuZE1vZHVsZXM6bn0pO3JldHVybiB0JiYoem8ocyx0LHRoaXMpLGoodC5zaWRlRWZmZWN0RGVwZW5kZW5jaWVzQnlWYXJpYWJsZSxzLFUkMikuYWRkKHRoaXMpKSxbc119aWYoaSlyZXR1cm4gW251bGxdO2lmKCJkZWZhdWx0IiE9PWUpe2NvbnN0IHM9dGhpcy5uYW1lc3BhY2VSZWV4cG9ydHNCeU5hbWUuZ2V0KGUpPz90aGlzLmdldFZhcmlhYmxlRnJvbU5hbWVzcGFjZVJlZXhwb3J0cyhlLHQsbik7aWYodGhpcy5uYW1lc3BhY2VSZWV4cG9ydHNCeU5hbWUuc2V0KGUscyksc1swXSlyZXR1cm4gc31yZXR1cm4gdGhpcy5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0cz9baih0aGlzLnN5bnRoZXRpY0V4cG9ydHMsZSwoKCk9Pm5ldyBnbyh0aGlzLmFzdENvbnRleHQsZSx0aGlzLmdldFN5bnRoZXRpY05hbWVzcGFjZSgpKSkpXTohcyYmdGhpcy5vcHRpb25zLnNoaW1NaXNzaW5nRXhwb3J0cz8odGhpcy5zaGltTWlzc2luZ0V4cG9ydChlKSxbdGhpcy5leHBvcnRTaGltVmFyaWFibGVdKTpbbnVsbF19aGFzRWZmZWN0cygpe3JldHVybiAibm8tdHJlZXNoYWtlIj09PXRoaXMuaW5mby5tb2R1bGVTaWRlRWZmZWN0c3x8dGhpcy5hc3QuaGFzQ2FjaGVkRWZmZWN0cygpfWluY2x1ZGUoKXtjb25zdCBlPXRzKCk7dGhpcy5hc3Quc2hvdWxkQmVJbmNsdWRlZChlKSYmdGhpcy5hc3QuaW5jbHVkZShlLCExKTt9aW5jbHVkZUFsbEV4cG9ydHMoZSl7dGhpcy5pc0V4ZWN1dGVkfHwoRG8odGhpcyksdGhpcy5ncmFwaC5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMCk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5leHBvcnRzLmtleXMoKSlpZihlfHx0IT09dGhpcy5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0cyl7Y29uc3QgZT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZSh0KVswXTtlLmRlb3B0aW1pemVQYXRoKFgpLGUuaW5jbHVkZWR8fHRoaXMuaW5jbHVkZVZhcmlhYmxlKGUpO31mb3IoY29uc3QgZSBvZiB0aGlzLmdldFJlZXhwb3J0cygpKXtjb25zdFt0XT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKTt0JiYodC5kZW9wdGltaXplUGF0aChYKSx0LmluY2x1ZGVkfHx0aGlzLmluY2x1ZGVWYXJpYWJsZSh0KSx0IGluc3RhbmNlb2YgcGUmJih0Lm1vZHVsZS5yZWV4cG9ydGVkPSEwKSk7fWUmJnRoaXMubmFtZXNwYWNlLnNldE1lcmdlZE5hbWVzcGFjZXModGhpcy5pbmNsdWRlQW5kR2V0QWRkaXRpb25hbE1lcmdlZE5hbWVzcGFjZXMoKSk7fWluY2x1ZGVBbGxJbkJ1bmRsZSgpe3RoaXMuYXN0LmluY2x1ZGUodHMoKSwhMCksdGhpcy5pbmNsdWRlQWxsRXhwb3J0cyghMSk7fWluY2x1ZGVFeHBvcnRzQnlOYW1lcyhlKXt0aGlzLmlzRXhlY3V0ZWR8fChEbyh0aGlzKSx0aGlzLmdyYXBoLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwKTtsZXQgdD0hMTtmb3IoY29uc3QgcyBvZiBlKXtjb25zdCBlPXRoaXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKHMpWzBdO2UmJihlLmRlb3B0aW1pemVQYXRoKFgpLGUuaW5jbHVkZWR8fHRoaXMuaW5jbHVkZVZhcmlhYmxlKGUpKSx0aGlzLmV4cG9ydHMuaGFzKHMpfHx0aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zLmhhcyhzKXx8KHQ9ITApO310JiZ0aGlzLm5hbWVzcGFjZS5zZXRNZXJnZWROYW1lc3BhY2VzKHRoaXMuaW5jbHVkZUFuZEdldEFkZGl0aW9uYWxNZXJnZWROYW1lc3BhY2VzKCkpO31pc0luY2x1ZGVkKCl7cmV0dXJuIHRoaXMuYXN0JiYodGhpcy5hc3QuaW5jbHVkZWR8fHRoaXMubmFtZXNwYWNlLmluY2x1ZGVkfHx0aGlzLmltcG9ydGVkRnJvbU5vdFRyZWVzaGFrZW58fHRoaXMuZXhwb3J0U2hpbVZhcmlhYmxlLmluY2x1ZGVkKX1saW5rSW1wb3J0cygpe3RoaXMuYWRkTW9kdWxlc1RvSW1wb3J0RGVzY3JpcHRpb25zKHRoaXMuaW1wb3J0RGVzY3JpcHRpb25zKSx0aGlzLmFkZE1vZHVsZXNUb0ltcG9ydERlc2NyaXB0aW9ucyh0aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zKTtjb25zdCBlPVtdO2Zvcihjb25zdCB0IG9mIHRoaXMuZXhwb3J0QWxsU291cmNlcyl7Y29uc3Qgcz10aGlzLmdyYXBoLm1vZHVsZXNCeUlkLmdldCh0aGlzLnJlc29sdmVkSWRzW3RdLmlkKTtzIGluc3RhbmNlb2YgWnQ/ZS5wdXNoKHMpOnRoaXMuZXhwb3J0QWxsTW9kdWxlcy5wdXNoKHMpO310aGlzLmV4cG9ydEFsbE1vZHVsZXMucHVzaCguLi5lKTt9bG9nKGUsdCxzKXt0aGlzLmFkZExvY2F0aW9uVG9Mb2dQcm9wcyh0LHMpLHRoaXMub3B0aW9ucy5vbkxvZyhlLHQpO31yZW5kZXIoZSl7Y29uc3QgdD10aGlzLm1hZ2ljU3RyaW5nLmNsb25lKCk7dGhpcy5hc3QucmVuZGVyKHQsZSksdC50cmltKCk7Y29uc3R7dXNlc1RvcExldmVsQXdhaXQ6c309dGhpcy5hc3RDb250ZXh0O3JldHVybiBzJiYiZXMiIT09ZS5mb3JtYXQmJiJzeXN0ZW0iIT09ZS5mb3JtYXQ/WGUoKGk9dGhpcy5pZCxuPWUuZm9ybWF0LHtjb2RlOiJJTlZBTElEX1RMQV9GT1JNQVQiLGlkOmksbWVzc2FnZTpgTW9kdWxlIGZvcm1hdCAiJHtufSIgZG9lcyBub3Qgc3VwcG9ydCB0b3AtbGV2ZWwgYXdhaXQuIFVzZSB0aGUgImVzIiBvciAic3lzdGVtIiBvdXRwdXQgZm9ybWF0cyByYXRoZXIuYH0pKTp7c291cmNlOnQsdXNlc1RvcExldmVsQXdhaXQ6c307dmFyIGksbjt9c2V0U291cmNlKHthc3Q6ZSxjb2RlOnQsY3VzdG9tVHJhbnNmb3JtQ2FjaGU6cyxvcmlnaW5hbENvZGU6aSxvcmlnaW5hbFNvdXJjZW1hcDpuLHJlc29sdmVkSWRzOnIsc291cmNlbWFwQ2hhaW46byx0cmFuc2Zvcm1EZXBlbmRlbmNpZXM6YSx0cmFuc2Zvcm1GaWxlczpsLC4uLmN9KXtfbygiZ2VuZXJhdGUgYXN0IiwzKSx0aGlzLmluZm8uY29kZT10LHRoaXMub3JpZ2luYWxDb2RlPWksdGhpcy5vcmlnaW5hbFNvdXJjZW1hcD1ibyhuKSx0aGlzLnNvdXJjZW1hcENoYWluPW8ubWFwKChlPT5lLm1pc3Npbmc/ZTpibyhlKSkpLEVvKHRoaXMub3JpZ2luYWxTb3VyY2VtYXAsdGhpcy5zb3VyY2VtYXBDaGFpbiksbCYmKHRoaXMudHJhbnNmb3JtRmlsZXM9bCksdGhpcy50cmFuc2Zvcm1EZXBlbmRlbmNpZXM9YSx0aGlzLmN1c3RvbVRyYW5zZm9ybUNhY2hlPXMsdGhpcy51cGRhdGVPcHRpb25zKGMpO2NvbnN0IGg9ZT8/dGhpcy50cnlQYXJzZSgpO1JvKCJnZW5lcmF0ZSBhc3QiLDMpLF9vKCJhbmFseXplIGFzdCIsMyksdGhpcy5yZXNvbHZlZElkcz1yPz9PYmplY3QuY3JlYXRlKG51bGwpO2NvbnN0IHU9dGhpcy5pZDt0aGlzLm1hZ2ljU3RyaW5nPW5ldyB5KHQse2ZpbGVuYW1lOnRoaXMuZXhjbHVkZUZyb21Tb3VyY2VtYXA/bnVsbDp1LGluZGVudEV4Y2x1c2lvblJhbmdlczpbXX0pLHRoaXMuYXN0Q29udGV4dD17YWRkRHluYW1pY0ltcG9ydDp0aGlzLmFkZER5bmFtaWNJbXBvcnQuYmluZCh0aGlzKSxhZGRFeHBvcnQ6dGhpcy5hZGRFeHBvcnQuYmluZCh0aGlzKSxhZGRJbXBvcnQ6dGhpcy5hZGRJbXBvcnQuYmluZCh0aGlzKSxhZGRJbXBvcnRNZXRhOnRoaXMuYWRkSW1wb3J0TWV0YS5iaW5kKHRoaXMpLGNvZGU6dCxkZW9wdGltaXphdGlvblRyYWNrZXI6dGhpcy5ncmFwaC5kZW9wdGltaXphdGlvblRyYWNrZXIsZXJyb3I6dGhpcy5lcnJvci5iaW5kKHRoaXMpLGZpbGVOYW1lOnUsZ2V0RXhwb3J0czp0aGlzLmdldEV4cG9ydHMuYmluZCh0aGlzKSxnZXRNb2R1bGVFeGVjSW5kZXg6KCk9PnRoaXMuZXhlY0luZGV4LGdldE1vZHVsZU5hbWU6dGhpcy5iYXNlbmFtZS5iaW5kKHRoaXMpLGdldE5vZGVDb25zdHJ1Y3RvcjplPT51b1tlXXx8dW8uVW5rbm93bk5vZGUsZ2V0UmVleHBvcnRzOnRoaXMuZ2V0UmVleHBvcnRzLmJpbmQodGhpcyksaW1wb3J0RGVzY3JpcHRpb25zOnRoaXMuaW1wb3J0RGVzY3JpcHRpb25zLGluY2x1ZGVBbGxFeHBvcnRzOigpPT50aGlzLmluY2x1ZGVBbGxFeHBvcnRzKCEwKSxpbmNsdWRlRHluYW1pY0ltcG9ydDp0aGlzLmluY2x1ZGVEeW5hbWljSW1wb3J0LmJpbmQodGhpcyksaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGU6dGhpcy5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZS5iaW5kKHRoaXMpLGxvZzp0aGlzLmxvZy5iaW5kKHRoaXMpLG1hZ2ljU3RyaW5nOnRoaXMubWFnaWNTdHJpbmcsbWFudWFsUHVyZUZ1bmN0aW9uczp0aGlzLmdyYXBoLnB1cmVGdW5jdGlvbnMsbW9kdWxlOnRoaXMsbW9kdWxlQ29udGV4dDp0aGlzLmNvbnRleHQsb3B0aW9uczp0aGlzLm9wdGlvbnMscmVxdWVzdFRyZWVzaGFraW5nUGFzczooKT0+dGhpcy5ncmFwaC5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMCx0cmFjZUV4cG9ydDplPT50aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKVswXSx0cmFjZVZhcmlhYmxlOnRoaXMudHJhY2VWYXJpYWJsZS5iaW5kKHRoaXMpLHVzZXNUb3BMZXZlbEF3YWl0OiExfSx0aGlzLnNjb3BlPW5ldyBsbyh0aGlzLmdyYXBoLnNjb3BlLHRoaXMuYXN0Q29udGV4dCksdGhpcy5uYW1lc3BhY2U9bmV3IG1vKHRoaXMuYXN0Q29udGV4dCksdGhpcy5hc3Q9bmV3IGlvKGgse2NvbnRleHQ6dGhpcy5hc3RDb250ZXh0LHR5cGU6Ik1vZHVsZSJ9LHRoaXMuc2NvcGUpLGV8fCExIT09dGhpcy5vcHRpb25zLmNhY2hlP3RoaXMuaW5mby5hc3Q9aDpPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5pbmZvLCJhc3QiLHtnZXQ6KCk9PntpZih0aGlzLmdyYXBoLmFzdExydS5oYXModSkpcmV0dXJuIHRoaXMuZ3JhcGguYXN0THJ1LmdldCh1KTt7Y29uc3QgZT10aGlzLnRyeVBhcnNlKCk7cmV0dXJuIHRoaXMuZ3JhcGguYXN0THJ1LnNldCh1LGUpLGV9fX0pLFJvKCJhbmFseXplIGFzdCIsMyk7fXRvSlNPTigpe3JldHVybiB7YXNzZXJ0aW9uczp0aGlzLmluZm8uYXNzZXJ0aW9ucyxhc3Q6dGhpcy5pbmZvLmFzdCxjb2RlOnRoaXMuaW5mby5jb2RlLGN1c3RvbVRyYW5zZm9ybUNhY2hlOnRoaXMuY3VzdG9tVHJhbnNmb3JtQ2FjaGUsZGVwZW5kZW5jaWVzOkFycmF5LmZyb20odGhpcy5kZXBlbmRlbmNpZXMsdm8pLGlkOnRoaXMuaWQsbWV0YTp0aGlzLmluZm8ubWV0YSxtb2R1bGVTaWRlRWZmZWN0czp0aGlzLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMsb3JpZ2luYWxDb2RlOnRoaXMub3JpZ2luYWxDb2RlLG9yaWdpbmFsU291cmNlbWFwOnRoaXMub3JpZ2luYWxTb3VyY2VtYXAscmVzb2x2ZWRJZHM6dGhpcy5yZXNvbHZlZElkcyxzb3VyY2VtYXBDaGFpbjp0aGlzLnNvdXJjZW1hcENoYWluLHN5bnRoZXRpY05hbWVkRXhwb3J0czp0aGlzLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzLHRyYW5zZm9ybURlcGVuZGVuY2llczp0aGlzLnRyYW5zZm9ybURlcGVuZGVuY2llcyx0cmFuc2Zvcm1GaWxlczp0aGlzLnRyYW5zZm9ybUZpbGVzfX10cmFjZVZhcmlhYmxlKGUse2ltcG9ydGVyRm9yU2lkZUVmZmVjdHM6dCxpc0V4cG9ydEFsbFNlYXJjaDpzLHNlYXJjaGVkTmFtZXNBbmRNb2R1bGVzOml9PW1lKXtjb25zdCBuPXRoaXMuc2NvcGUudmFyaWFibGVzLmdldChlKTtpZihuKXJldHVybiBuO2NvbnN0IHI9dGhpcy5pbXBvcnREZXNjcmlwdGlvbnMuZ2V0KGUpO2lmKHIpe2NvbnN0IGU9ci5tb2R1bGU7aWYoZSBpbnN0YW5jZW9mIEJvJiYiKiI9PT1yLm5hbWUpcmV0dXJuIGUubmFtZXNwYWNlO2NvbnN0W25dPVRvKGUsci5uYW1lLHR8fHRoaXMscyxpKTtyZXR1cm4gbnx8dGhpcy5lcnJvcihqdChyLm5hbWUsdGhpcy5pZCxlLmlkKSxyLnN0YXJ0KX1yZXR1cm4gbnVsbH11cGRhdGVPcHRpb25zKHttZXRhOmUsbW9kdWxlU2lkZUVmZmVjdHM6dCxzeW50aGV0aWNOYW1lZEV4cG9ydHM6c30pe251bGwhPXQmJih0aGlzLmluZm8ubW9kdWxlU2lkZUVmZmVjdHM9dCksbnVsbCE9cyYmKHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHM9cyksbnVsbCE9ZSYmT2JqZWN0LmFzc2lnbih0aGlzLmluZm8ubWV0YSxlKTt9YWRkRHluYW1pY0ltcG9ydChlKXtsZXQgdD1lLnNvdXJjZTt0IGluc3RhbmNlb2Ygcm8/MT09PXQucXVhc2lzLmxlbmd0aCYmdC5xdWFzaXNbMF0udmFsdWUuY29va2VkJiYodD10LnF1YXNpc1swXS52YWx1ZS5jb29rZWQpOnQgaW5zdGFuY2VvZiBWbiYmInN0cmluZyI9PXR5cGVvZiB0LnZhbHVlJiYodD10LnZhbHVlKSx0aGlzLmR5bmFtaWNJbXBvcnRzLnB1c2goe2FyZ3VtZW50OnQsaWQ6bnVsbCxub2RlOmUscmVzb2x1dGlvbjpudWxsfSk7fWFkZEV4cG9ydChlKXtpZihlIGluc3RhbmNlb2YgbnIpdGhpcy5leHBvcnRzLnNldCgiZGVmYXVsdCIse2lkZW50aWZpZXI6ZS52YXJpYWJsZS5nZXRBc3NpZ25lZFZhcmlhYmxlTmFtZSgpLGxvY2FsTmFtZToiZGVmYXVsdCJ9KTtlbHNlIGlmKGUgaW5zdGFuY2VvZiBzcil7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTtpZih0aGlzLmFkZFNvdXJjZSh0LGUpLGUuZXhwb3J0ZWQpe2NvbnN0IHM9ZS5leHBvcnRlZC5uYW1lO3RoaXMucmVleHBvcnREZXNjcmlwdGlvbnMuc2V0KHMse2xvY2FsTmFtZToiKiIsbW9kdWxlOm51bGwsc291cmNlOnQsc3RhcnQ6ZS5zdGFydH0pO31lbHNlIHRoaXMuZXhwb3J0QWxsU291cmNlcy5hZGQodCk7fWVsc2UgaWYoZS5zb3VyY2UgaW5zdGFuY2VvZiBWbil7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTt0aGlzLmFkZFNvdXJjZSh0LGUpO2Zvcihjb25zdHtleHBvcnRlZDpzLGxvY2FsOmksc3RhcnQ6bn1vZiBlLnNwZWNpZmllcnMpe2NvbnN0IGU9cyBpbnN0YW5jZW9mIFZuP3MudmFsdWU6cy5uYW1lO3RoaXMucmVleHBvcnREZXNjcmlwdGlvbnMuc2V0KGUse2xvY2FsTmFtZTppIGluc3RhbmNlb2YgVm4/aS52YWx1ZTppLm5hbWUsbW9kdWxlOm51bGwsc291cmNlOnQsc3RhcnQ6bn0pO319ZWxzZSBpZihlLmRlY2xhcmF0aW9uKXtjb25zdCB0PWUuZGVjbGFyYXRpb247aWYodCBpbnN0YW5jZW9mIGhvKWZvcihjb25zdCBlIG9mIHQuZGVjbGFyYXRpb25zKWZvcihjb25zdCB0IG9mIGVzKGUuaWQpKXRoaXMuZXhwb3J0cy5zZXQodCx7aWRlbnRpZmllcjpudWxsLGxvY2FsTmFtZTp0fSk7ZWxzZSB7Y29uc3QgZT10LmlkLm5hbWU7dGhpcy5leHBvcnRzLnNldChlLHtpZGVudGlmaWVyOm51bGwsbG9jYWxOYW1lOmV9KTt9fWVsc2UgZm9yKGNvbnN0e2xvY2FsOnQsZXhwb3J0ZWQ6c31vZiBlLnNwZWNpZmllcnMpe2NvbnN0IGU9dC5uYW1lLGk9cyBpbnN0YW5jZW9mIGNuP3MubmFtZTpzLnZhbHVlO3RoaXMuZXhwb3J0cy5zZXQoaSx7aWRlbnRpZmllcjpudWxsLGxvY2FsTmFtZTplfSk7fX1hZGRJbXBvcnQoZSl7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTt0aGlzLmFkZFNvdXJjZSh0LGUpO2Zvcihjb25zdCBzIG9mIGUuc3BlY2lmaWVycyl7Y29uc3QgZT1zIGluc3RhbmNlb2YgdXI/ImRlZmF1bHQiOnMgaW5zdGFuY2VvZiBHcj8iKiI6cy5pbXBvcnRlZCBpbnN0YW5jZW9mIGNuP3MuaW1wb3J0ZWQubmFtZTpzLmltcG9ydGVkLnZhbHVlO3RoaXMuaW1wb3J0RGVzY3JpcHRpb25zLnNldChzLmxvY2FsLm5hbWUse21vZHVsZTpudWxsLG5hbWU6ZSxzb3VyY2U6dCxzdGFydDpzLnN0YXJ0fSk7fX1hZGRJbXBvcnRNZXRhKGUpe3RoaXMuaW1wb3J0TWV0YXMucHVzaChlKTt9YWRkTG9jYXRpb25Ub0xvZ1Byb3BzKGUsdCl7ZS5pZD10aGlzLmlkLGUucG9zPXQ7bGV0IHM9dGhpcy5pbmZvLmNvZGU7Y29uc3QgaT1QZShzLHQse29mZnNldExpbmU6MX0pO2lmKGkpe2xldHtjb2x1bW46bixsaW5lOnJ9PWk7dHJ5eygoe2NvbHVtbjpuLGxpbmU6cn09ZnVuY3Rpb24oZSx0KXtjb25zdCBzPWUuZmlsdGVyKChlPT4hZS5taXNzaW5nKSk7ZTpmb3IoO3MubGVuZ3RoPjA7KXtjb25zdCBlPXMucG9wKCkubWFwcGluZ3NbdC5saW5lLTFdO2lmKGUpe2NvbnN0IHM9ZS5maWx0ZXIoKGU9PmUubGVuZ3RoPjEpKSxpPXNbcy5sZW5ndGgtMV07Zm9yKGNvbnN0IGUgb2YgcylpZihlWzBdPj10LmNvbHVtbnx8ZT09PWkpe3Q9e2NvbHVtbjplWzNdLGxpbmU6ZVsyXSsxfTtjb250aW51ZSBlfX10aHJvdyBuZXcgRXJyb3IoIkNhbid0IHJlc29sdmUgb3JpZ2luYWwgbG9jYXRpb24gb2YgZXJyb3IuIil9cmV0dXJuIHR9KHRoaXMuc291cmNlbWFwQ2hhaW4se2NvbHVtbjpuLGxpbmU6cn0pKSkscz10aGlzLm9yaWdpbmFsQ29kZTt9Y2F0Y2goZSl7dGhpcy5vcHRpb25zLm9uTG9nKFNlLGZ1bmN0aW9uKGUsdCxzLGksbil7cmV0dXJuIHtjYXVzZTplLGNvZGU6IlNPVVJDRU1BUF9FUlJPUiIsaWQ6dCxsb2M6e2NvbHVtbjpzLGZpbGU6dCxsaW5lOml9LG1lc3NhZ2U6YEVycm9yIHdoZW4gdXNpbmcgc291cmNlbWFwIGZvciByZXBvcnRpbmcgYW4gZXJyb3I6ICR7ZS5tZXNzYWdlfWAscG9zOm59fShlLHRoaXMuaWQsbixyLHQpKTt9UWUoZSx7Y29sdW1uOm4sbGluZTpyfSxzLHRoaXMuaWQpO319YWRkTW9kdWxlc1RvSW1wb3J0RGVzY3JpcHRpb25zKGUpe2Zvcihjb25zdCB0IG9mIGUudmFsdWVzKCkpe2NvbnN0e2lkOmV9PXRoaXMucmVzb2x2ZWRJZHNbdC5zb3VyY2VdO3QubW9kdWxlPXRoaXMuZ3JhcGgubW9kdWxlc0J5SWQuZ2V0KGUpO319YWRkUmVsZXZhbnRTaWRlRWZmZWN0RGVwZW5kZW5jaWVzKGUsdCxzKXtjb25zdCBpPW5ldyBTZXQsbj1yPT57Zm9yKGNvbnN0IG8gb2YgcilpLmhhcyhvKXx8KGkuYWRkKG8pLHQuaGFzKG8pP2UuYWRkKG8pOihvLmluZm8ubW9kdWxlU2lkZUVmZmVjdHN8fHMuaGFzKG8pKSYmKG8gaW5zdGFuY2VvZiBadHx8by5oYXNFZmZlY3RzKCk/ZS5hZGQobyk6bihvLmRlcGVuZGVuY2llcykpKTt9O24odGhpcy5kZXBlbmRlbmNpZXMpLG4ocyk7fWFkZFNvdXJjZShlLHQpe2NvbnN0IHM9KGk9dC5hc3NlcnRpb25zLGk/Lmxlbmd0aD9PYmplY3QuZnJvbUVudHJpZXMoaS5tYXAoKGU9PltTbyhlKSxlLnZhbHVlLnZhbHVlXSkpKTptZSk7dmFyIGk7Y29uc3Qgbj10aGlzLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucy5nZXQoZSk7bj9BbyhuLHMpJiZ0aGlzLmxvZyhTZSxWdChuLHMsZSx0aGlzLmlkKSx0LnN0YXJ0KTp0aGlzLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucy5zZXQoZSxzKTt9Z2V0VmFyaWFibGVGcm9tTmFtZXNwYWNlUmVleHBvcnRzKGUsdCxzKXtsZXQgaT1udWxsO2NvbnN0IG49bmV3IE1hcCxyPW5ldyBTZXQ7Zm9yKGNvbnN0IG8gb2YgdGhpcy5leHBvcnRBbGxNb2R1bGVzKXtpZihvLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzPT09ZSljb250aW51ZTtjb25zdFthLGxdPVRvKG8sZSx0LCEwLEZvKHMpKTtvIGluc3RhbmNlb2YgWnR8fGw/ci5hZGQoYSk6YSBpbnN0YW5jZW9mIGdvP2l8fChpPWEpOmEmJm4uc2V0KGEsbyk7fWlmKG4uc2l6ZT4wKXtjb25zdCB0PVsuLi5uXSxzPXRbMF1bMF07cmV0dXJuIDE9PT10Lmxlbmd0aD9bc106KHRoaXMub3B0aW9ucy5vbkxvZyhTZSwobz1lLGE9dGhpcy5pZCxsPXQubWFwKCgoWyxlXSk9PmUuaWQpKSx7YmluZGluZzpvLGNvZGU6Ik5BTUVTUEFDRV9DT05GTElDVCIsaWRzOmwsbWVzc2FnZTpgQ29uZmxpY3RpbmcgbmFtZXNwYWNlczogIiR7VChhKX0iIHJlLWV4cG9ydHMgIiR7b30iIGZyb20gb25lIG9mIHRoZSBtb2R1bGVzICR7TWUobC5tYXAoKGU9PlQoZSkpKSl9ICh3aWxsIGJlIGlnbm9yZWQpLmAscmVleHBvcnRlcjphfSkpLFtudWxsXSl9dmFyIG8sYSxsO2lmKHIuc2l6ZT4wKXtjb25zdCB0PVsuLi5yXSxzPXRbMF07cmV0dXJuIHQubGVuZ3RoPjEmJnRoaXMub3B0aW9ucy5vbkxvZyhTZSxmdW5jdGlvbihlLHQscyxpKXtyZXR1cm4ge2JpbmRpbmc6ZSxjb2RlOiJBTUJJR1VPVVNfRVhURVJOQUxfTkFNRVNQQUNFUyIsaWRzOmksbWVzc2FnZTpgQW1iaWd1b3VzIGV4dGVybmFsIG5hbWVzcGFjZSByZXNvbHV0aW9uOiAiJHtUKHQpfSIgcmUtZXhwb3J0cyAiJHtlfSIgZnJvbSBvbmUgb2YgdGhlIGV4dGVybmFsIG1vZHVsZXMgJHtNZShpLm1hcCgoZT0+VChlKSkpKX0sIGd1ZXNzaW5nICIke1Qocyl9Ii5gLHJlZXhwb3J0ZXI6dH19KGUsdGhpcy5pZCxzLm1vZHVsZS5pZCx0Lm1hcCgoZT0+ZS5tb2R1bGUuaWQpKSkpLFtzLCEwXX1yZXR1cm4gaT9baV06W251bGxdfWluY2x1ZGVBbmRHZXRBZGRpdGlvbmFsTWVyZ2VkTmFtZXNwYWNlcygpe2NvbnN0IGU9bmV3IFNldCx0PW5ldyBTZXQ7Zm9yKGNvbnN0IHMgb2YgW3RoaXMsLi4udGhpcy5leHBvcnRBbGxNb2R1bGVzXSlpZihzIGluc3RhbmNlb2YgWnQpe2NvbnN0W3RdPXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKCIqIik7dC5pbmNsdWRlKCksdGhpcy5pbmNsdWRlZEltcG9ydHMuYWRkKHQpLGUuYWRkKHQpO31lbHNlIGlmKHMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMpe2NvbnN0IGU9cy5nZXRTeW50aGV0aWNOYW1lc3BhY2UoKTtlLmluY2x1ZGUoKSx0aGlzLmluY2x1ZGVkSW1wb3J0cy5hZGQoZSksdC5hZGQoZSk7fXJldHVybiBbLi4udCwuLi5lXX1pbmNsdWRlRHluYW1pY0ltcG9ydChlKXtjb25zdCB0PXRoaXMuZHluYW1pY0ltcG9ydHMuZmluZCgodD0+dC5ub2RlPT09ZSkpLnJlc29sdXRpb247aWYodCBpbnN0YW5jZW9mIEJvKXt0LmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5wdXNoKHRoaXMpO2NvbnN0IHM9dGhpcy5vcHRpb25zLnRyZWVzaGFrZT9lLmdldERldGVybWluaXN0aWNJbXBvcnRlZE5hbWVzKCk6dm9pZCAwO3M/dC5pbmNsdWRlRXhwb3J0c0J5TmFtZXMocyk6dC5pbmNsdWRlQWxsRXhwb3J0cyghMCk7fX1pbmNsdWRlVmFyaWFibGUoZSl7Y29uc3QgdD1lLm1vZHVsZTtpZihlLmluY2x1ZGVkKXQgaW5zdGFuY2VvZiBCbyYmdCE9PXRoaXMmJlZvKGUsdGhpcyk7ZWxzZSBpZihlLmluY2x1ZGUoKSx0aGlzLmdyYXBoLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwLHQgaW5zdGFuY2VvZiBCbyYmKHQuaXNFeGVjdXRlZHx8RG8odCksdCE9PXRoaXMpKXtjb25zdCB0PVZvKGUsdGhpcyk7Zm9yKGNvbnN0IGUgb2YgdCllLmlzRXhlY3V0ZWR8fERvKGUpO319aW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUoZSl7dGhpcy5pbmNsdWRlVmFyaWFibGUoZSk7Y29uc3QgdD1lLm1vZHVsZTt0JiZ0IT09dGhpcyYmdGhpcy5pbmNsdWRlZEltcG9ydHMuYWRkKGUpO31zaGltTWlzc2luZ0V4cG9ydChlKXt2YXIgdCxzO3RoaXMub3B0aW9ucy5vbkxvZyhTZSwodD10aGlzLmlkLHtiaW5kaW5nOnM9ZSxjb2RlOiJTSElNTUVEX0VYUE9SVCIsZXhwb3J0ZXI6dCxtZXNzYWdlOmBNaXNzaW5nIGV4cG9ydCAiJHtzfSIgaGFzIGJlZW4gc2hpbW1lZCBpbiBtb2R1bGUgIiR7VCh0KX0iLmB9KSksdGhpcy5leHBvcnRzLnNldChlLExvKTt9dHJ5UGFyc2UoKXt0cnl7cmV0dXJuIHRoaXMuZ3JhcGguY29udGV4dFBhcnNlKHRoaXMuaW5mby5jb2RlKX1jYXRjaChlKXtyZXR1cm4gdGhpcy5lcnJvcihmdW5jdGlvbihlLHQpe2xldCBzPWUubWVzc2FnZS5yZXBsYWNlKC8gXChcZCs6XGQrXCkkLywiIik7cmV0dXJuIHQuZW5kc1dpdGgoIi5qc29uIik/cys9IiAoTm90ZSB0aGF0IHlvdSBuZWVkIEByb2xsdXAvcGx1Z2luLWpzb24gdG8gaW1wb3J0IEpTT04gZmlsZXMpIjp0LmVuZHNXaXRoKCIuanMiKXx8KHMrPSIgKE5vdGUgdGhhdCB5b3UgbmVlZCBwbHVnaW5zIHRvIGltcG9ydCBmaWxlcyB0aGF0IGFyZSBub3QgSmF2YVNjcmlwdCkiKSx7Y2F1c2U6ZSxjb2RlOiJQQVJTRV9FUlJPUiIsaWQ6dCxtZXNzYWdlOnN9fShlLHRoaXMuaWQpLGUucG9zKX19fWZ1bmN0aW9uIHpvKGUsdCxzKXtpZihlLm1vZHVsZSBpbnN0YW5jZW9mIEJvJiZlLm1vZHVsZSE9PXMpe2NvbnN0IGk9ZS5tb2R1bGUuY3ljbGVzO2lmKGkuc2l6ZT4wKXtjb25zdCBuPXMuY3ljbGVzO2Zvcihjb25zdCByIG9mIG4paWYoaS5oYXMocikpe3QuYWx0ZXJuYXRpdmVSZWV4cG9ydE1vZHVsZXMuc2V0KGUscyk7YnJlYWt9fX19Y29uc3QgRm89ZT0+ZSYmbmV3IE1hcChBcnJheS5mcm9tKGUsKChbZSx0XSk9PltlLG5ldyBTZXQodCldKSkpO2Z1bmN0aW9uIGpvKGUpe3JldHVybiBlLmVuZHNXaXRoKCIuanMiKT9lLnNsaWNlKDAsLTMpOmV9ZnVuY3Rpb24gVW8oZSx0KXtyZXR1cm4gZS5hdXRvSWQ/YCR7ZS5iYXNlUGF0aD9lLmJhc2VQYXRoKyIvIjoiIn0ke2pvKHQpfWA6ZS5pZD8/IiJ9ZnVuY3Rpb24gR28oZSx0LHMsaSxuLHIsbyxhPSJyZXR1cm4gIil7Y29uc3R7XzpsLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOmMsZ2V0RnVuY3Rpb25JbnRybzpoLGdldFByb3BlcnR5QWNjZXNzOnUsbjpkLHM6cH09bjtpZighcylyZXR1cm4gYCR7ZH0ke2R9JHthfSR7ZnVuY3Rpb24oZSx0LHMsaSxuKXtpZihlLmxlbmd0aD4wKXJldHVybiBlWzBdLmxvY2FsO2Zvcihjb25zdHtkZWZhdWx0VmFyaWFibGVOYW1lOmUsaW1wb3J0UGF0aDpyLGlzQ2h1bms6byxuYW1lOmEsbmFtZWRFeHBvcnRzTW9kZTpsLG5hbWVzcGFjZVZhcmlhYmxlTmFtZTpjLHJlZXhwb3J0czpofW9mIHQpaWYoaClyZXR1cm4gV28oYSxoWzBdLmltcG9ydGVkLGwsbyxlLGMscyxyLGksbil9KGUsdCxpLG8sdSl9O2A7bGV0IGY9IiI7Zm9yKGNvbnN0e2RlZmF1bHRWYXJpYWJsZU5hbWU6ZSxpbXBvcnRQYXRoOm4saXNDaHVuazphLG5hbWU6aCxuYW1lZEV4cG9ydHNNb2RlOnAsbmFtZXNwYWNlVmFyaWFibGVOYW1lOm0scmVleHBvcnRzOmd9b2YgdClpZihnJiZzKWZvcihjb25zdCB0IG9mIGcpaWYoIioiIT09dC5yZWV4cG9ydGVkKXtjb25zdCBzPVdvKGgsdC5pbXBvcnRlZCxwLGEsZSxtLGksbixvLHUpO2lmKGYmJihmKz1kKSwiKiIhPT10LmltcG9ydGVkJiZ0Lm5lZWRzTGl2ZUJpbmRpbmcpe2NvbnN0W2UsaV09YyhbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7Zis9YE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCR7bH0nJHt0LnJlZXhwb3J0ZWR9Jywke2x9eyR7ZH0ke3J9ZW51bWVyYWJsZToke2x9dHJ1ZSwke2R9JHtyfWdldDoke2x9JHtlfSR7c30ke2l9JHtkfX0pO2A7fWVsc2UgZis9YGV4cG9ydHMke3UodC5yZWV4cG9ydGVkKX0ke2x9PSR7bH0ke3N9O2A7fWZvcihjb25zdHtleHBvcnRlZDp0LGxvY2FsOnN9b2YgZSl7Y29uc3QgZT1gZXhwb3J0cyR7dSh0KX1gO2UhPT1zJiYoZiYmKGYrPWQpLGYrPWAke2V9JHtsfT0ke2x9JHtzfTtgKTt9Zm9yKGNvbnN0e25hbWU6ZSxyZWV4cG9ydHM6aX1vZiB0KWlmKGkmJnMpZm9yKGNvbnN0IHQgb2YgaSlpZigiKiI9PT10LnJlZXhwb3J0ZWQpe2YmJihmKz1kKTtjb25zdCBzPWB7JHtkfSR7cn1pZiR7bH0oayR7bH0hPT0ke2x9J2RlZmF1bHQnJHtsfSYmJHtsfSFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZXhwb3J0cywke2x9aykpJHtsfSR7S28oZSx0Lm5lZWRzTGl2ZUJpbmRpbmcscixuKX0ke3B9JHtkfX1gO2YrPWBPYmplY3Qua2V5cygke2V9KS5mb3JFYWNoKCR7aChbImsiXSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX0ke3N9KTtgO31yZXR1cm4gZj9gJHtkfSR7ZH0ke2Z9YDoiIn1mdW5jdGlvbiBXbyhlLHQscyxpLG4scixvLGEsbCxjKXtpZigiZGVmYXVsdCI9PT10KXtpZighaSl7Y29uc3QgdD1vKGEpLHM9RXJbdF0/bjplO3JldHVybiBicih0LGwpP2Ake3N9JHtjKCJkZWZhdWx0Iil9YDpzfXJldHVybiBzP2Ake2V9JHtjKCJkZWZhdWx0Iil9YDplfXJldHVybiAiKiI9PT10PyhpPyFzOnZyW28oYSldKT9yOmU6YCR7ZX0ke2ModCl9YH1mdW5jdGlvbiBxbyhlKXtyZXR1cm4gZShbWyJ2YWx1ZSIsInRydWUiXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9ZnVuY3Rpb24gSG8oZSx0LHMse186aSxnZXRPYmplY3Q6bn0pe2lmKGUpe2lmKHQpcmV0dXJuIHM/YE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGV4cG9ydHMsJHtpfSR7bihbWyJfX2VzTW9kdWxlIixxbyhuKV0sW251bGwsYFtTeW1ib2wudG9TdHJpbmdUYWddOiR7aX0ke1ZyKG4pfWBdXSx7bGluZUJyZWFrSW5kZW50Om51bGx9KX0pO2A6YE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCR7aX0nX19lc01vZHVsZScsJHtpfSR7cW8obil9KTtgO2lmKHMpcmV0dXJuIGBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywke2l9U3ltYm9sLnRvU3RyaW5nVGFnLCR7aX0ke1ZyKG4pfSk7YH1yZXR1cm4gIiJ9Y29uc3QgS289KGUsdCxzLHtfOmksZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246bixuOnJ9KT0+e2lmKHQpe2NvbnN0W3Qsb109bihbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7cmV0dXJuIGBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywke2l9aywke2l9eyR7cn0ke3N9JHtzfWVudW1lcmFibGU6JHtpfXRydWUsJHtyfSR7c30ke3N9Z2V0OiR7aX0ke3R9JHtlfVtrXSR7b30ke3J9JHtzfX0pYH1yZXR1cm4gYGV4cG9ydHNba10ke2l9PSR7aX0ke2V9W2tdYH07ZnVuY3Rpb24gWW8oZSx0LHMsaSxuLHIsbyxhKXtjb25zdHtfOmwsY25zdDpjLG46aH09YSx1PW5ldyBTZXQsZD1bXSxwPShlLHQscyk9Pnt1LmFkZCh0KSxkLnB1c2goYCR7Y30gJHtlfSR7bH09JHtsfS8qI19fUFVSRV9fKi8ke3R9KCR7c30pO2ApO307Zm9yKGNvbnN0e2RlZmF1bHRWYXJpYWJsZU5hbWU6cyxpbXBvcnRzOmksaW1wb3J0UGF0aDpuLGlzQ2h1bms6cixuYW1lOm8sbmFtZWRFeHBvcnRzTW9kZTphLG5hbWVzcGFjZVZhcmlhYmxlTmFtZTpsLHJlZXhwb3J0czpjfW9mIGUpaWYocil7Zm9yKGNvbnN0e2ltcG9ydGVkOmUscmVleHBvcnRlZDp0fW9mIFsuLi5pfHxbXSwuLi5jfHxbXV0paWYoIioiPT09ZSYmIioiIT09dCl7YXx8cChsLHlyLG8pO2JyZWFrfX1lbHNlIHtjb25zdCBlPXQobik7bGV0IHI9ITEsYT0hMTtmb3IoY29uc3R7aW1wb3J0ZWQ6dCxyZWV4cG9ydGVkOm59b2YgWy4uLml8fFtdLC4uLmN8fFtdXSl7bGV0IGksYzsiZGVmYXVsdCI9PT10P3J8fChyPSEwLHMhPT1sJiYoYz1zLGk9RXJbZV0pKToiKiIhPT10fHwiKiI9PT1ufHxhfHwoYT0hMCxpPXZyW2VdLGM9bCksaSYmcChjLGksbyk7fX1yZXR1cm4gYCR7QXIodSxyLG8sYSxzLGksbil9JHtkLmxlbmd0aD4wP2Ake2Quam9pbihoKX0ke2h9JHtofWA6IiJ9YH1mdW5jdGlvbiBYbyhlLHQpe3JldHVybiAiLiIhPT1lWzBdP2U6dD8ocz1lKS5lbmRzV2l0aCgiLmpzIik/czpzKyIuanMiOmpvKGUpO3ZhciBzO31jb25zdCBRbz1uZXcgU2V0KFsuLi50KFsiYXNzZXJ0IiwiYXN5bmNfaG9va3MiLCJidWZmZXIiLCJjaGlsZF9wcm9jZXNzIiwiY2x1c3RlciIsImNvbnNvbGUiLCJjb25zdGFudHMiLCJjcnlwdG8iLCJkZ3JhbSIsImRpYWdub3N0aWNzX2NoYW5uZWwiLCJkbnMiLCJkb21haW4iLCJldmVudHMiLCJmcyIsImh0dHAiLCJodHRwMiIsImh0dHBzIiwiaW5zcGVjdG9yIiwibW9kdWxlIiwibmV0Iiwib3MiLCJwYXRoIiwicGVyZl9ob29rcyIsInByb2Nlc3MiLCJwdW55Y29kZSIsInF1ZXJ5c3RyaW5nIiwicmVhZGxpbmUiLCJyZXBsIiwic3RyZWFtIiwic3RyaW5nX2RlY29kZXIiLCJ0aW1lcnMiLCJ0bHMiLCJ0cmFjZV9ldmVudHMiLCJ0dHkiLCJ1cmwiLCJ1dGlsIiwidjgiLCJ2bSIsIndhc2kiLCJ3b3JrZXJfdGhyZWFkcyIsInpsaWIiXSksImFzc2VydC9zdHJpY3QiLCJkbnMvcHJvbWlzZXMiLCJmcy9wcm9taXNlcyIsInBhdGgvcG9zaXgiLCJwYXRoL3dpbjMyIiwicmVhZGxpbmUvcHJvbWlzZXMiLCJzdHJlYW0vY29uc3VtZXJzIiwic3RyZWFtL3Byb21pc2VzIiwic3RyZWFtL3dlYiIsInRpbWVycy9wcm9taXNlcyIsInV0aWwvdHlwZXMiXSk7ZnVuY3Rpb24gWm8oZSx0KXtjb25zdCBzPXQubWFwKCgoe2ltcG9ydFBhdGg6ZX0pPT5lKSkuZmlsdGVyKChlPT5Rby5oYXMoZSl8fGUuc3RhcnRzV2l0aCgibm9kZToiKSkpOzAhPT1zLmxlbmd0aCYmZShTZSxmdW5jdGlvbihlKXtyZXR1cm4ge2NvZGU6YnQsaWRzOmUsbWVzc2FnZTpgQ3JlYXRpbmcgYSBicm93c2VyIGJ1bmRsZSB0aGF0IGRlcGVuZHMgb24gTm9kZS5qcyBidWlsdC1pbiBtb2R1bGVzICgke01lKGUpfSkuIFlvdSBtaWdodCBuZWVkIHRvIGluY2x1ZGUgaHR0cHM6Ly9naXRodWIuY29tL0ZyZWRLU2Nob3R0L3JvbGx1cC1wbHVnaW4tcG9seWZpbGwtbm9kZWB9fShzKSk7fWNvbnN0IEpvPShlLHQpPT5lLnNwbGl0KCIuIikubWFwKHQpLmpvaW4oIiIpO2Z1bmN0aW9uIGVhKGUsdCxzLGkse186bixnZXRQcm9wZXJ0eUFjY2VzczpyfSl7Y29uc3Qgbz1lLnNwbGl0KCIuIik7b1swXT0oImZ1bmN0aW9uIj09dHlwZW9mIHM/cyhvWzBdKTpzW29bMF1dKXx8b1swXTtjb25zdCBhPW8ucG9wKCk7bGV0IGw9dCxjPVsuLi5vLm1hcCgoZT0+KGwrPXIoZSksYCR7bH0ke259PSR7bn0ke2x9JHtufXx8JHtufXt9YCkpKSxgJHtsfSR7cihhKX1gXS5qb2luKGAsJHtufWApK2Ake259PSR7bn0ke2l9YDtyZXR1cm4gby5sZW5ndGg+MCYmKGM9YCgke2N9KWApLGN9ZnVuY3Rpb24gdGEoZSl7bGV0IHQ9ZS5sZW5ndGg7Zm9yKDt0LS07KXtjb25zdHtpbXBvcnRzOnMscmVleHBvcnRzOml9PWVbdF07aWYoc3x8aSlyZXR1cm4gZS5zbGljZSgwLHQrMSl9cmV0dXJuIFtdfWNvbnN0IHNhPSh7ZGVwZW5kZW5jaWVzOmUsZXhwb3J0czp0fSk9Pntjb25zdCBzPW5ldyBTZXQodC5tYXAoKGU9PmUuZXhwb3J0ZWQpKSk7cy5hZGQoImRlZmF1bHQiKTtmb3IoY29uc3R7cmVleHBvcnRzOnR9b2YgZSlpZih0KWZvcihjb25zdCBlIG9mIHQpIioiIT09ZS5yZWV4cG9ydGVkJiZzLmFkZChlLnJlZXhwb3J0ZWQpO3JldHVybiBzfSxpYT0oZSx0LHtfOnMsY25zdDppLGdldE9iamVjdDpuLG46cn0pPT5lP2Ake3J9JHt0fSR7aX0gX3N0YXJFeGNsdWRlcyR7c309JHtzfSR7bihbLi4uZV0ubWFwKChlPT5bZSwiMSJdKSkse2xpbmVCcmVha0luZGVudDp7YmFzZTp0LHQ6dH19KX07YDoiIixuYT0oZSx0LHtfOnMsbjppfSk9PmUubGVuZ3RoPjA/YCR7aX0ke3R9dmFyICR7ZS5qb2luKGAsJHtzfWApfTtgOiIiLHJhPShlLHQscyk9Pm9hKGUuZmlsdGVyKChlPT5lLmhvaXN0ZWQpKS5tYXAoKGU9Pih7bmFtZTplLmV4cG9ydGVkLHZhbHVlOmUubG9jYWx9KSkpLHQscyk7ZnVuY3Rpb24gb2EoZSx0LHtfOnMsbjppfSl7cmV0dXJuIDA9PT1lLmxlbmd0aD8iIjoxPT09ZS5sZW5ndGg/YGV4cG9ydHMoJyR7ZVswXS5uYW1lfScsJHtzfSR7ZVswXS52YWx1ZX0pOyR7aX0ke2l9YDpgZXhwb3J0cyh7JHtpfWArZS5tYXAoKCh7bmFtZTplLHZhbHVlOml9KT0+YCR7dH0ke2V9OiR7c30ke2l9YCkpLmpvaW4oYCwke2l9YCkrYCR7aX19KTske2l9JHtpfWB9Y29uc3QgYWE9KGUsdCxzKT0+b2EoZS5maWx0ZXIoKGU9PmUuZXhwcmVzc2lvbikpLm1hcCgoZT0+KHtuYW1lOmUuZXhwb3J0ZWQsdmFsdWU6ZS5sb2NhbH0pKSksdCxzKSxsYT0oZSx0LHMpPT5vYShlLmZpbHRlcigoZT0+ZS5sb2NhbD09PXBvKSkubWFwKChlPT4oe25hbWU6ZS5leHBvcnRlZCx2YWx1ZTpwb30pKSksdCxzKTtmdW5jdGlvbiBjYShlLHQscyl7cmV0dXJuIGU/YCR7dH0ke0pvKGUscyl9YDoibnVsbCJ9dmFyIGhhPXthbWQ6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsZGVwZW5kZW5jaWVzOnMsZXhwb3J0czppLGhhc0RlZmF1bHRFeHBvcnQ6bixoYXNFeHBvcnRzOnIsaWQ6byxpbmRlbnQ6YSxpbnRybzpsLGlzRW50cnlGYWNhZGU6Yyxpc01vZHVsZUZhY2FkZTpoLG5hbWVkRXhwb3J0c01vZGU6dSxsb2c6ZCxvdXRybzpwLHNuaXBwZXRzOmZ9LHthbWQ6bSxlc01vZHVsZTpnLGV4dGVybmFsTGl2ZUJpbmRpbmdzOnksZnJlZXplOngsaW50ZXJvcDpFLG5hbWVzcGFjZVRvU3RyaW5nVGFnOmIsc3RyaWN0OnZ9KXtabyhkLHMpO2NvbnN0IFM9cy5tYXAoKGU9PmAnJHtYbyhlLmltcG9ydFBhdGgsbS5mb3JjZUpzRXh0ZW5zaW9uRm9ySW1wb3J0cyl9J2ApKSxBPXMubWFwKChlPT5lLm5hbWUpKSx7bjprLGdldE5vbkFycm93RnVuY3Rpb25JbnRybzpJLF86d309Zjt1JiZyJiYoQS51bnNoaWZ0KCJleHBvcnRzIiksUy51bnNoaWZ0KCInZXhwb3J0cyciKSksdC5oYXMoInJlcXVpcmUiKSYmKEEudW5zaGlmdCgicmVxdWlyZSIpLFMudW5zaGlmdCgiJ3JlcXVpcmUnIikpLHQuaGFzKCJtb2R1bGUiKSYmKEEudW5zaGlmdCgibW9kdWxlIiksUy51bnNoaWZ0KCInbW9kdWxlJyIpKTtjb25zdCBQPVVvKG0sbyksQz0oUD9gJyR7UH0nLCR7d31gOiIiKSsoUy5sZW5ndGg+MD9gWyR7Uy5qb2luKGAsJHt3fWApfV0sJHt3fWA6IiIpLCQ9dj9gJHt3fSd1c2Ugc3RyaWN0JztgOiIiO2UucHJlcGVuZChgJHtsfSR7WW8ocyxFLHkseCxiLHQsYSxmKX1gKTtjb25zdCBOPUdvKGkscyx1LEUsZixhLHkpO2xldCBfPUhvKHUmJnIsYyYmKCEwPT09Z3x8ImlmLWRlZmF1bHQtcHJvcCI9PT1nJiZuKSxoJiZiLGYpO18mJihfPWsraytfKSxlLmFwcGVuZChgJHtOfSR7X30ke3B9YCkuaW5kZW50KGEpLnByZXBlbmQoYCR7bS5kZWZpbmV9KCR7Q30oJHtJKEEse2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7JH0ke2t9JHtrfWApLmFwcGVuZChgJHtrfSR7a319KSk7YCk7fSxjanM6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsZGVwZW5kZW5jaWVzOnMsZXhwb3J0czppLGhhc0RlZmF1bHRFeHBvcnQ6bixoYXNFeHBvcnRzOnIsaW5kZW50Om8saW50cm86YSxpc0VudHJ5RmFjYWRlOmwsaXNNb2R1bGVGYWNhZGU6YyxuYW1lZEV4cG9ydHNNb2RlOmgsb3V0cm86dSxzbmlwcGV0czpkfSx7Y29tcGFjdDpwLGVzTW9kdWxlOmYsZXh0ZXJuYWxMaXZlQmluZGluZ3M6bSxmcmVlemU6ZyxpbnRlcm9wOnksbmFtZXNwYWNlVG9TdHJpbmdUYWc6eCxzdHJpY3Q6RX0pe2NvbnN0e186YixuOnZ9PWQsUz1FP2AndXNlIHN0cmljdCc7JHt2fSR7dn1gOiIiO2xldCBBPUhvKGgmJnIsbCYmKCEwPT09Znx8ImlmLWRlZmF1bHQtcHJvcCI9PT1mJiZuKSxjJiZ4LGQpO0EmJihBKz12K3YpO2NvbnN0IGs9ZnVuY3Rpb24oZSx7Xzp0LGNuc3Q6cyxuOml9LG4pe2xldCByPSIiLG89ITE7Zm9yKGNvbnN0e2ltcG9ydFBhdGg6YSxuYW1lOmwscmVleHBvcnRzOmMsaW1wb3J0czpofW9mIGUpY3x8aD8ocis9biYmbz8iLCI6YCR7cj9gOyR7aX1gOiIifSR7c30gYCxvPSEwLHIrPWAke2x9JHt0fT0ke3R9cmVxdWlyZSgnJHthfScpYCk6KHImJihyKz1uJiYhbz8iLCI6YDske2l9YCksbz0hMSxyKz1gcmVxdWlyZSgnJHthfScpYCk7aWYocilyZXR1cm4gYCR7cn07JHtpfSR7aX1gO3JldHVybiAiIn0ocyxkLHApLEk9WW8ocyx5LG0sZyx4LHQsbyxkKTtlLnByZXBlbmQoYCR7U30ke2F9JHtBfSR7a30ke0l9YCk7Y29uc3Qgdz1HbyhpLHMsaCx5LGQsbyxtLGBtb2R1bGUuZXhwb3J0cyR7Yn09JHtifWApO2UuYXBwZW5kKGAke3d9JHt1fWApO30sZXM6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsaW5kZW50OnMsaW50cm86aSxvdXRybzpuLGRlcGVuZGVuY2llczpyLGV4cG9ydHM6byxzbmlwcGV0czphfSx7ZXh0ZXJuYWxMaXZlQmluZGluZ3M6bCxmcmVlemU6YyxuYW1lc3BhY2VUb1N0cmluZ1RhZzpofSl7Y29uc3R7bjp1fT1hLGQ9ZnVuY3Rpb24oZSx7Xzp0fSl7Y29uc3Qgcz1bXTtmb3IoY29uc3R7aW1wb3J0UGF0aDppLHJlZXhwb3J0czpuLGltcG9ydHM6cixuYW1lOm8sYXNzZXJ0aW9uczphfW9mIGUpe2NvbnN0IGU9YCcke2l9JyR7YT9gJHt0fWFzc2VydCR7dH0ke2F9YDoiIn07YDtpZihufHxyKXtpZihyKXtsZXQgaT1udWxsLG49bnVsbDtjb25zdCBvPVtdO2Zvcihjb25zdCBlIG9mIHIpImRlZmF1bHQiPT09ZS5pbXBvcnRlZD9pPWU6IioiPT09ZS5pbXBvcnRlZD9uPWU6by5wdXNoKGUpO24mJnMucHVzaChgaW1wb3J0JHt0fSoke3R9YXMgJHtuLmxvY2FsfSBmcm9tJHt0fSR7ZX1gKSxpJiYwPT09by5sZW5ndGg/cy5wdXNoKGBpbXBvcnQgJHtpLmxvY2FsfSBmcm9tJHt0fSR7ZX1gKTpvLmxlbmd0aD4wJiZzLnB1c2goYGltcG9ydCAke2k/YCR7aS5sb2NhbH0sJHt0fWA6IiJ9eyR7dH0ke28ubWFwKChlPT5lLmltcG9ydGVkPT09ZS5sb2NhbD9lLmltcG9ydGVkOmAke2UuaW1wb3J0ZWR9IGFzICR7ZS5sb2NhbH1gKSkuam9pbihgLCR7dH1gKX0ke3R9fSR7dH1mcm9tJHt0fSR7ZX1gKTt9aWYobil7bGV0IGk9bnVsbDtjb25zdCBhPVtdLGw9W107Zm9yKGNvbnN0IGUgb2YgbikiKiI9PT1lLnJlZXhwb3J0ZWQ/aT1lOiIqIj09PWUuaW1wb3J0ZWQ/YS5wdXNoKGUpOmwucHVzaChlKTtpZihpJiZzLnB1c2goYGV4cG9ydCR7dH0qJHt0fWZyb20ke3R9JHtlfWApLGEubGVuZ3RoPjApe3ImJnIuc29tZSgoZT0+IioiPT09ZS5pbXBvcnRlZCYmZS5sb2NhbD09PW8pKXx8cy5wdXNoKGBpbXBvcnQke3R9KiR7dH1hcyAke299IGZyb20ke3R9JHtlfWApO2Zvcihjb25zdCBlIG9mIGEpcy5wdXNoKGBleHBvcnQke3R9eyR7dH0ke289PT1lLnJlZXhwb3J0ZWQ/bzpgJHtvfSBhcyAke2UucmVleHBvcnRlZH1gfSB9O2ApO31sLmxlbmd0aD4wJiZzLnB1c2goYGV4cG9ydCR7dH17JHt0fSR7bC5tYXAoKGU9PmUuaW1wb3J0ZWQ9PT1lLnJlZXhwb3J0ZWQ/ZS5pbXBvcnRlZDpgJHtlLmltcG9ydGVkfSBhcyAke2UucmVleHBvcnRlZH1gKSkuam9pbihgLCR7dH1gKX0ke3R9fSR7dH1mcm9tJHt0fSR7ZX1gKTt9fWVsc2Ugcy5wdXNoKGBpbXBvcnQke3R9JHtlfWApO31yZXR1cm4gc30ocixhKTtkLmxlbmd0aD4wJiYoaSs9ZC5qb2luKHUpK3UrdSksKGkrPUFyKG51bGwsdCxzLGEsbCxjLGgpKSYmZS5wcmVwZW5kKGkpO2NvbnN0IHA9ZnVuY3Rpb24oZSx7Xzp0LGNuc3Q6c30pe2NvbnN0IGk9W10sbj1bXTtmb3IoY29uc3QgciBvZiBlKXIuZXhwcmVzc2lvbiYmaS5wdXNoKGAke3N9ICR7ci5sb2NhbH0ke3R9PSR7dH0ke3IuZXhwcmVzc2lvbn07YCksbi5wdXNoKHIuZXhwb3J0ZWQ9PT1yLmxvY2FsP3IubG9jYWw6YCR7ci5sb2NhbH0gYXMgJHtyLmV4cG9ydGVkfWApO24ubGVuZ3RoPjAmJmkucHVzaChgZXhwb3J0JHt0fXske3R9JHtuLmpvaW4oYCwke3R9YCl9JHt0fX07YCk7cmV0dXJuIGl9KG8sYSk7cC5sZW5ndGg+MCYmZS5hcHBlbmQodSt1K3Auam9pbih1KS50cmltKCkpLG4mJmUuYXBwZW5kKG4pLGUudHJpbSgpO30saWlmZTpmdW5jdGlvbihlLHthY2Nlc3NlZEdsb2JhbHM6dCxkZXBlbmRlbmNpZXM6cyxleHBvcnRzOmksaGFzRGVmYXVsdEV4cG9ydDpuLGhhc0V4cG9ydHM6cixpbmRlbnQ6byxpbnRybzphLG5hbWVkRXhwb3J0c01vZGU6bCxsb2c6YyxvdXRybzpoLHNuaXBwZXRzOnV9LHtjb21wYWN0OmQsZXNNb2R1bGU6cCxleHRlbmQ6ZixmcmVlemU6bSxleHRlcm5hbExpdmVCaW5kaW5nczpnLGdsb2JhbHM6eSxpbnRlcm9wOngsbmFtZTpFLG5hbWVzcGFjZVRvU3RyaW5nVGFnOmIsc3RyaWN0OnZ9KXtjb25zdHtfOlMsZ2V0Tm9uQXJyb3dGdW5jdGlvbkludHJvOkEsZ2V0UHJvcGVydHlBY2Nlc3M6ayxuOkl9PXUsdz1FJiZFLmluY2x1ZGVzKCIuIiksUD0hZiYmIXc7aWYoRSYmUCYmKGJlKEM9RSl8fEVlLnRlc3QoQykpKXJldHVybiBYZShmdW5jdGlvbihlKXtyZXR1cm4ge2NvZGU6bHQsbWVzc2FnZTpgR2l2ZW4gbmFtZSAiJHtlfSIgaXMgbm90IGEgbGVnYWwgSlMgaWRlbnRpZmllci4gSWYgeW91IG5lZWQgdGhpcywgeW91IGNhbiB0cnkgIm91dHB1dC5leHRlbmQ6IHRydWUiLmAsdXJsOk9lKHplKX19KEUpKTt2YXIgQztabyhjLHMpO2NvbnN0ICQ9dGEocyksTj0kLm1hcCgoZT0+ZS5nbG9iYWxOYW1lfHwibnVsbCIpKSxfPSQubWFwKChlPT5lLm5hbWUpKTtyJiYhRSYmYyhTZSx7Y29kZTpFdCxtZXNzYWdlOidJZiB5b3UgZG8gbm90IHN1cHBseSAib3V0cHV0Lm5hbWUiLCB5b3UgbWF5IG5vdCBiZSBhYmxlIHRvIGFjY2VzcyB0aGUgZXhwb3J0cyBvZiBhbiBJSUZFIGJ1bmRsZS4nLHVybDpPZShIZSl9KSxsJiZyJiYoZj8oTi51bnNoaWZ0KGB0aGlzJHtKbyhFLGspfSR7U309JHtTfXRoaXMke0pvKEUsayl9JHtTfXx8JHtTfXt9YCksXy51bnNoaWZ0KCJleHBvcnRzIikpOihOLnVuc2hpZnQoInt9IiksXy51bnNoaWZ0KCJleHBvcnRzIikpKTtjb25zdCBSPXY/YCR7b30ndXNlIHN0cmljdCc7JHtJfWA6IiIsTT1ZbyhzLHgsZyxtLGIsdCxvLHUpO2UucHJlcGVuZChgJHthfSR7TX1gKTtsZXQgTz1gKCR7QShfLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske0l9JHtSfSR7SX1gO3ImJighRXx8ZiYmbHx8KE89KFA/YHZhciAke0V9YDpgdGhpcyR7Sm8oRSxrKX1gKStgJHtTfT0ke1N9JHtPfWApLHcmJihPPWZ1bmN0aW9uKGUsdCxzLHtfOmksZ2V0UHJvcGVydHlBY2Nlc3M6bixzOnJ9LG8pe2NvbnN0IGE9ZS5zcGxpdCgiLiIpO2FbMF09KCJmdW5jdGlvbiI9PXR5cGVvZiBzP3MoYVswXSk6c1thWzBdXSl8fGFbMF0sYS5wb3AoKTtsZXQgbD10O3JldHVybiBhLm1hcCgoZT0+KGwrPW4oZSksYCR7bH0ke2l9PSR7aX0ke2x9JHtpfXx8JHtpfXt9JHtyfWApKSkuam9pbihvPyIsIjoiXG4iKSsobyYmYS5sZW5ndGg+MD8iOyI6IlxuIil9KEUsInRoaXMiLHksdSxkKStPKSk7bGV0IEQ9YCR7SX0ke0l9fSkoJHtOLmpvaW4oYCwke1N9YCl9KTtgO3ImJiFmJiZsJiYoRD1gJHtJfSR7SX0ke299cmV0dXJuIGV4cG9ydHM7JHtEfWApO2NvbnN0IEw9R28oaSxzLGwseCx1LG8sZyk7bGV0IFQ9SG8obCYmciwhMD09PXB8fCJpZi1kZWZhdWx0LXByb3AiPT09cCYmbixiLHUpO1QmJihUPUkrSStUKSxlLmFwcGVuZChgJHtMfSR7VH0ke2h9YCkuaW5kZW50KG8pLnByZXBlbmQoTykuYXBwZW5kKEQpO30sc3lzdGVtOmZ1bmN0aW9uKGUse2FjY2Vzc2VkR2xvYmFsczp0LGRlcGVuZGVuY2llczpzLGV4cG9ydHM6aSxoYXNFeHBvcnRzOm4saW5kZW50OnIsaW50cm86byxzbmlwcGV0czphLG91dHJvOmwsdXNlc1RvcExldmVsQXdhaXQ6Y30se2V4dGVybmFsTGl2ZUJpbmRpbmdzOmgsZnJlZXplOnUsbmFtZTpkLG5hbWVzcGFjZVRvU3RyaW5nVGFnOnAsc3RyaWN0OmYsc3lzdGVtTnVsbFNldHRlcnM6bX0pe2NvbnN0e186ZyxnZXRGdW5jdGlvbkludHJvOnksZ2V0Tm9uQXJyb3dGdW5jdGlvbkludHJvOngsbjpFLHM6Yn09YSx7aW1wb3J0QmluZGluZ3M6dixzZXR0ZXJzOlMsc3RhckV4Y2x1ZGVzOkF9PWZ1bmN0aW9uKGUsdCxzLHtfOmksY25zdDpuLGdldE9iamVjdDpyLGdldFByb3BlcnR5QWNjZXNzOm8sbjphfSl7Y29uc3QgbD1bXSxjPVtdO2xldCBoPW51bGw7Zm9yKGNvbnN0e2ltcG9ydHM6dSxyZWV4cG9ydHM6ZH1vZiBlKXtjb25zdCBwPVtdO2lmKHUpZm9yKGNvbnN0IGUgb2YgdSlsLnB1c2goZS5sb2NhbCksIioiPT09ZS5pbXBvcnRlZD9wLnB1c2goYCR7ZS5sb2NhbH0ke2l9PSR7aX1tb2R1bGU7YCk6cC5wdXNoKGAke2UubG9jYWx9JHtpfT0ke2l9bW9kdWxlJHtvKGUuaW1wb3J0ZWQpfTtgKTtpZihkKXtjb25zdCBhPVtdO2xldCBsPSExO2Zvcihjb25zdHtpbXBvcnRlZDplLHJlZXhwb3J0ZWQ6dH1vZiBkKSIqIj09PXQ/bD0hMDphLnB1c2goW3QsIioiPT09ZT8ibW9kdWxlIjpgbW9kdWxlJHtvKGUpfWBdKTtpZihhLmxlbmd0aD4xfHxsKXtjb25zdCBvPXIoYSx7bGluZUJyZWFrSW5kZW50Om51bGx9KTtsPyhofHwoaD1zYSh7ZGVwZW5kZW5jaWVzOmUsZXhwb3J0czp0fSkpLHAucHVzaChgJHtufSBzZXR0ZXIke2l9PSR7aX0ke299O2AsYGZvciR7aX0oJHtufSBuYW1lIGluIG1vZHVsZSkke2l9e2AsYCR7c31pZiR7aX0oIV9zdGFyRXhjbHVkZXNbbmFtZV0pJHtpfXNldHRlcltuYW1lXSR7aX09JHtpfW1vZHVsZVtuYW1lXTtgLCJ9IiwiZXhwb3J0cyhzZXR0ZXIpOyIpKTpwLnB1c2goYGV4cG9ydHMoJHtvfSk7YCk7fWVsc2Uge2NvbnN0W2UsdF09YVswXTtwLnB1c2goYGV4cG9ydHMoJyR7ZX0nLCR7aX0ke3R9KTtgKTt9fWMucHVzaChwLmpvaW4oYCR7YX0ke3N9JHtzfSR7c31gKSk7fXJldHVybiB7aW1wb3J0QmluZGluZ3M6bCxzZXR0ZXJzOmMsc3RhckV4Y2x1ZGVzOmh9fShzLGkscixhKSxrPWQ/YCcke2R9Jywke2d9YDoiIixJPXQuaGFzKCJtb2R1bGUiKT9bImV4cG9ydHMiLCJtb2R1bGUiXTpuP1siZXhwb3J0cyJdOltdO2xldCB3PWBTeXN0ZW0ucmVnaXN0ZXIoJHtrfVtgK3MubWFwKCgoe2ltcG9ydFBhdGg6ZX0pPT5gJyR7ZX0nYCkpLmpvaW4oYCwke2d9YCkrYF0sJHtnfSgke3goSSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX17JHtFfSR7cn0ke2Y/Iid1c2Ugc3RyaWN0JzsiOiIifWAraWEoQSxyLGEpK25hKHYscixhKStgJHtFfSR7cn1yZXR1cm4ke2d9eyR7Uy5sZW5ndGg+MD9gJHtFfSR7cn0ke3J9c2V0dGVyczoke2d9WyR7Uy5tYXAoKGU9PmU/YCR7eShbIm1vZHVsZSJdLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske0V9JHtyfSR7cn0ke3J9JHtlfSR7RX0ke3J9JHtyfX1gOm0/Im51bGwiOmAke3koW10se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9e31gKSkuam9pbihgLCR7Z31gKX1dLGA6IiJ9JHtFfWA7dys9YCR7cn0ke3J9ZXhlY3V0ZToke2d9KCR7eChbXSx7aXNBc3luYzpjLG5hbWU6bnVsbH0pfXske0V9JHtFfWA7Y29uc3QgUD1gJHtyfSR7cn19KSR7RX0ke3J9fSR7Yn0ke0V9fSkpO2A7ZS5wcmVwZW5kKG8rQXIobnVsbCx0LHIsYSxoLHUscCkrcmEoaSxyLGEpKS5hcHBlbmQoYCR7bH0ke0V9JHtFfWArYWEoaSxyLGEpK2xhKGkscixhKSkuaW5kZW50KGAke3J9JHtyfSR7cn1gKS5hcHBlbmQoUCkucHJlcGVuZCh3KTt9LHVtZDpmdW5jdGlvbihlLHthY2Nlc3NlZEdsb2JhbHM6dCxkZXBlbmRlbmNpZXM6cyxleHBvcnRzOmksaGFzRGVmYXVsdEV4cG9ydDpuLGhhc0V4cG9ydHM6cixpZDpvLGluZGVudDphLGludHJvOmwsbmFtZWRFeHBvcnRzTW9kZTpjLGxvZzpoLG91dHJvOnUsc25pcHBldHM6ZH0se2FtZDpwLGNvbXBhY3Q6Zixlc01vZHVsZTptLGV4dGVuZDpnLGV4dGVybmFsTGl2ZUJpbmRpbmdzOnksZnJlZXplOngsaW50ZXJvcDpFLG5hbWU6YixuYW1lc3BhY2VUb1N0cmluZ1RhZzp2LGdsb2JhbHM6Uyxub0NvbmZsaWN0OkEsc3RyaWN0Omt9KXtjb25zdHtfOkksY25zdDp3LGdldEZ1bmN0aW9uSW50cm86UCxnZXROb25BcnJvd0Z1bmN0aW9uSW50cm86QyxnZXRQcm9wZXJ0eUFjY2VzczokLG46TixzOl99PWQsUj1mPyJmIjoiZmFjdG9yeSIsTT1mPyJnIjoiZ2xvYmFsIjtpZihyJiYhYilyZXR1cm4gWGUoe2NvZGU6RXQsbWVzc2FnZTonWW91IG11c3Qgc3VwcGx5ICJvdXRwdXQubmFtZSIgZm9yIFVNRCBidW5kbGVzIHRoYXQgaGF2ZSBleHBvcnRzIHNvIHRoYXQgdGhlIGV4cG9ydHMgYXJlIGFjY2Vzc2libGUgaW4gZW52aXJvbm1lbnRzIHdpdGhvdXQgYSBtb2R1bGUgbG9hZGVyLicsdXJsOk9lKEhlKX0pO1pvKGgscyk7Y29uc3QgTz1zLm1hcCgoZT0+YCcke1hvKGUuaW1wb3J0UGF0aCxwLmZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzKX0nYCkpLEQ9cy5tYXAoKGU9PmByZXF1aXJlKCcke2UuaW1wb3J0UGF0aH0nKWApKSxMPXRhKHMpLFQ9TC5tYXAoKGU9PmNhKGUuZ2xvYmFsTmFtZSxNLCQpKSksVj1MLm1hcCgoZT0+ZS5uYW1lKSk7YyYmKHJ8fEEpJiYoTy51bnNoaWZ0KCInZXhwb3J0cyciKSxELnVuc2hpZnQoImV4cG9ydHMiKSxULnVuc2hpZnQoZWEoYixNLFMsKGc/YCR7Y2EoYixNLCQpfSR7SX18fCR7SX1gOiIiKSsie30iLGQpKSxWLnVuc2hpZnQoImV4cG9ydHMiKSk7Y29uc3QgQj1VbyhwLG8pLHo9KEI/YCcke0J9Jywke0l9YDoiIikrKE8ubGVuZ3RoPjA/YFske08uam9pbihgLCR7SX1gKX1dLCR7SX1gOiIiKSxGPXAuZGVmaW5lLGo9IWMmJnI/YG1vZHVsZS5leHBvcnRzJHtJfT0ke0l9YDoiIixVPWs/YCR7SX0ndXNlIHN0cmljdCc7JHtOfWA6IiI7bGV0IEc7aWYoQSl7Y29uc3QgZT1mPyJlIjoiZXhwb3J0cyI7bGV0IHQ7aWYoIWMmJnIpdD1gJHt3fSAke2V9JHtJfT0ke0l9JHtlYShiLE0sUyxgJHtSfSgke1Quam9pbihgLCR7SX1gKX0pYCxkKX07YDtlbHNlIHt0PWAke3d9ICR7ZX0ke0l9PSR7SX0ke1Quc2hpZnQoKX07JHtOfSR7YX0ke2F9JHtSfSgke1tlLC4uLlRdLmpvaW4oYCwke0l9YCl9KTtgO31HPWAoJHtQKFtdLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske059JHthfSR7YX0ke3d9IGN1cnJlbnQke0l9PSR7SX0ke2Z1bmN0aW9uKGUsdCx7XzpzLGdldFByb3BlcnR5QWNjZXNzOml9KXtsZXQgbj10O3JldHVybiBlLnNwbGl0KCIuIikubWFwKChlPT5uKz1pKGUpKSkuam9pbihgJHtzfSYmJHtzfWApfShiLE0sZCl9OyR7Tn0ke2F9JHthfSR7dH0ke059JHthfSR7YX0ke2V9Lm5vQ29uZmxpY3Qke0l9PSR7SX0ke1AoW10se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7SX0ke2NhKGIsTSwkKX0ke0l9PSR7SX1jdXJyZW50OyR7SX1yZXR1cm4gJHtlfSR7X30ke0l9fTske059JHthfX0pKClgO31lbHNlIEc9YCR7Un0oJHtULmpvaW4oYCwke0l9YCl9KWAsIWMmJnImJihHPWVhKGIsTSxTLEcsZCkpO2NvbnN0IFc9cnx8QSYmY3x8VC5sZW5ndGg+MCxxPVtSXTtXJiZxLnVuc2hpZnQoTSk7Y29uc3QgSD1XP2B0aGlzLCR7SX1gOiIiLEs9Vz9gKCR7TX0ke0l9PSR7SX10eXBlb2YgZ2xvYmFsVGhpcyR7SX0hPT0ke0l9J3VuZGVmaW5lZCcke0l9PyR7SX1nbG9iYWxUaGlzJHtJfToke0l9JHtNfSR7SX18fCR7SX1zZWxmLCR7SX1gOiIiLFk9Vz8iKSI6IiIsWD1XP2Ake2F9dHlwZW9mIGV4cG9ydHMke0l9PT09JHtJfSdvYmplY3QnJHtJfSYmJHtJfXR5cGVvZiBtb2R1bGUke0l9IT09JHtJfSd1bmRlZmluZWQnJHtJfT8ke0l9JHtqfSR7Un0oJHtELmpvaW4oYCwke0l9YCl9KSR7SX06JHtOfWA6IiIsUT1gKCR7QyhxLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske059YCtYK2Ake2F9dHlwZW9mICR7Rn0ke0l9PT09JHtJfSdmdW5jdGlvbicke0l9JiYke0l9JHtGfS5hbWQke0l9PyR7SX0ke0Z9KCR7en0ke1J9KSR7SX06JHtOfWArYCR7YX0ke0t9JHtHfSR7WX07JHtOfWArYH0pKCR7SH0oJHtDKFYse2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7VX0ke059YCxaPU4rTisifSkpOyI7ZS5wcmVwZW5kKGAke2x9JHtZbyhzLEUseSx4LHYsdCxhLGQpfWApO2NvbnN0IEo9R28oaSxzLGMsRSxkLGEseSk7bGV0IGVlPUhvKGMmJnIsITA9PT1tfHwiaWYtZGVmYXVsdC1wcm9wIj09PW0mJm4sdixkKTtlZSYmKGVlPU4rTitlZSksZS5hcHBlbmQoYCR7Sn0ke2VlfSR7dX1gKS50cmltKCkuaW5kZW50KGEpLmFwcGVuZChaKS5wcmVwZW5kKFEpO319O2NvbnN0IHVhPShlLHQpPT50P2Ake2V9XG4ke3R9YDplLGRhPShlLHQpPT50P2Ake2V9XG5cbiR7dH1gOmU7YXN5bmMgZnVuY3Rpb24gcGEoZSx0LHMpe3RyeXtsZXRbaSxuLHIsb109YXdhaXQgUHJvbWlzZS5hbGwoW3QuaG9va1JlZHVjZVZhbHVlKCJiYW5uZXIiLGUuYmFubmVyKHMpLFtzXSx1YSksdC5ob29rUmVkdWNlVmFsdWUoImZvb3RlciIsZS5mb290ZXIocyksW3NdLHVhKSx0Lmhvb2tSZWR1Y2VWYWx1ZSgiaW50cm8iLGUuaW50cm8ocyksW3NdLGRhKSx0Lmhvb2tSZWR1Y2VWYWx1ZSgib3V0cm8iLGUub3V0cm8ocyksW3NdLGRhKV0pO3JldHVybiByJiYocis9IlxuXG4iKSxvJiYobz1gXG5cbiR7b31gKSxpJiYoaSs9IlxuIiksbiYmKG49IlxuIituKSx7YmFubmVyOmksZm9vdGVyOm4saW50cm86cixvdXRybzpvfX1jYXRjaChlKXtyZXR1cm4gWGUoKGk9ZS5tZXNzYWdlLG49ZS5ob29rLHI9ZS5wbHVnaW4se2NvZGU6WmUsbWVzc2FnZTpgQ291bGQgbm90IHJldHJpZXZlICIke259Ii4gQ2hlY2sgY29uZmlndXJhdGlvbiBvZiBwbHVnaW4gIiR7cn0iLlxuXHRFcnJvciBNZXNzYWdlOiAke2l9YH0pKX12YXIgaSxuLHI7fWNvbnN0IGZhPXthbWQ6eWEsY2pzOnlhLGVzOmdhLGlpZmU6eWEsc3lzdGVtOmdhLHVtZDp5YX07ZnVuY3Rpb24gbWEoZSx0LHMsaSxuLHIsbyxhLGwsYyxoLHUsZCxwKXtjb25zdCBmPVsuLi5lXS5yZXZlcnNlKCk7Zm9yKGNvbnN0IGUgb2YgZillLnNjb3BlLmFkZFVzZWRPdXRzaWRlTmFtZXMoaSxuLHUsZCk7IWZ1bmN0aW9uKGUsdCxzKXtmb3IoY29uc3QgaSBvZiB0KXtmb3IoY29uc3QgdCBvZiBpLnNjb3BlLnZhcmlhYmxlcy52YWx1ZXMoKSl0LmluY2x1ZGVkJiYhKHQucmVuZGVyQmFzZU5hbWV8fHQgaW5zdGFuY2VvZiBhbyYmdC5nZXRPcmlnaW5hbFZhcmlhYmxlKCkhPT10KSYmdC5zZXRSZW5kZXJOYW1lcyhudWxsLERpKHQubmFtZSxlLHQuZm9yYmlkZGVuTmFtZXMpKTtpZihzLmhhcyhpKSl7Y29uc3QgdD1pLm5hbWVzcGFjZTt0LnNldFJlbmRlck5hbWVzKG51bGwsRGkodC5uYW1lLGUsdC5mb3JiaWRkZW5OYW1lcykpO319fShpLGYscCksZmFbbl0oaSxzLHQscixvLGEsbCxjLGgpO2Zvcihjb25zdCBlIG9mIGYpZS5zY29wZS5kZWNvbmZsaWN0KG4sdSxkKTt9ZnVuY3Rpb24gZ2EoZSx0LHMsaSxuLHIsbyxhLGwpe2Zvcihjb25zdCB0IG9mIHMuZGVwZW5kZW5jaWVzKShufHx0IGluc3RhbmNlb2YgRiQzKSYmKHQudmFyaWFibGVOYW1lPURpKHQuc3VnZ2VzdGVkVmFyaWFibGVOYW1lLGUsbnVsbCkpO2Zvcihjb25zdCBzIG9mIHQpe2NvbnN0IHQ9cy5tb2R1bGUsaT1zLm5hbWU7cy5pc05hbWVzcGFjZSYmKG58fHQgaW5zdGFuY2VvZiBadCk/cy5zZXRSZW5kZXJOYW1lcyhudWxsLCh0IGluc3RhbmNlb2YgWnQ/YS5nZXQodCk6by5nZXQodCkpLnZhcmlhYmxlTmFtZSk6dCBpbnN0YW5jZW9mIFp0JiYiZGVmYXVsdCI9PT1pP3Muc2V0UmVuZGVyTmFtZXMobnVsbCxEaShbLi4udC5leHBvcnRlZFZhcmlhYmxlc10uc29tZSgoKFtlLHRdKT0+IioiPT09dCYmZS5pbmNsdWRlZCkpP3Quc3VnZ2VzdGVkVmFyaWFibGVOYW1lKyJfX2RlZmF1bHQiOnQuc3VnZ2VzdGVkVmFyaWFibGVOYW1lLGUscy5mb3JiaWRkZW5OYW1lcykpOnMuc2V0UmVuZGVyTmFtZXMobnVsbCxEaShpLGUscy5mb3JiaWRkZW5OYW1lcykpO31mb3IoY29uc3QgdCBvZiBsKXQuc2V0UmVuZGVyTmFtZXMobnVsbCxEaSh0Lm5hbWUsZSx0LmZvcmJpZGRlbk5hbWVzKSk7fWZ1bmN0aW9uIHlhKGUsdCx7ZGVjb25mbGljdGVkRGVmYXVsdDpzLGRlY29uZmxpY3RlZE5hbWVzcGFjZTppLGRlcGVuZGVuY2llczpufSxyLG8sYSxsLGMpe2Zvcihjb25zdCB0IG9mIG4pdC52YXJpYWJsZU5hbWU9RGkodC5zdWdnZXN0ZWRWYXJpYWJsZU5hbWUsZSxudWxsKTtmb3IoY29uc3QgdCBvZiBpKXQubmFtZXNwYWNlVmFyaWFibGVOYW1lPURpKGAke3Quc3VnZ2VzdGVkVmFyaWFibGVOYW1lfV9fbmFtZXNwYWNlYCxlLG51bGwpO2Zvcihjb25zdCB0IG9mIHMpdC5kZWZhdWx0VmFyaWFibGVOYW1lPWkuaGFzKHQpJiZTcihyKHQuaWQpLGEpP3QubmFtZXNwYWNlVmFyaWFibGVOYW1lOkRpKGAke3Quc3VnZ2VzdGVkVmFyaWFibGVOYW1lfV9fZGVmYXVsdGAsZSxudWxsKTtmb3IoY29uc3QgZSBvZiB0KXtjb25zdCB0PWUubW9kdWxlO2lmKHQgaW5zdGFuY2VvZiBadCl7Y29uc3Qgcz1jLmdldCh0KSxpPWUubmFtZTtpZigiZGVmYXVsdCI9PT1pKXtjb25zdCBpPXIodC5pZCksbj1FcltpXT9zLmRlZmF1bHRWYXJpYWJsZU5hbWU6cy52YXJpYWJsZU5hbWU7YnIoaSxhKT9lLnNldFJlbmRlck5hbWVzKG4sImRlZmF1bHQiKTplLnNldFJlbmRlck5hbWVzKG51bGwsbik7fWVsc2UgIioiPT09aT9lLnNldFJlbmRlck5hbWVzKG51bGwsdnJbcih0LmlkKV0/cy5uYW1lc3BhY2VWYXJpYWJsZU5hbWU6cy52YXJpYWJsZU5hbWUpOmUuc2V0UmVuZGVyTmFtZXMocy52YXJpYWJsZU5hbWUsbnVsbCk7fWVsc2Uge2NvbnN0IHM9bC5nZXQodCk7byYmZS5pc05hbWVzcGFjZT9lLnNldFJlbmRlck5hbWVzKG51bGwsImRlZmF1bHQiPT09cy5leHBvcnRNb2RlP3MubmFtZXNwYWNlVmFyaWFibGVOYW1lOnMudmFyaWFibGVOYW1lKToiZGVmYXVsdCI9PT1zLmV4cG9ydE1vZGU/ZS5zZXRSZW5kZXJOYW1lcyhudWxsLHMudmFyaWFibGVOYW1lKTplLnNldFJlbmRlck5hbWVzKHMudmFyaWFibGVOYW1lLHMuZ2V0VmFyaWFibGVFeHBvcnROYW1lKGUpKTt9fX1mdW5jdGlvbiB4YShlLHtleHBvcnRzOnQsbmFtZTpzLGZvcm1hdDppfSxuLHIpe2NvbnN0IG89ZS5nZXRFeHBvcnROYW1lcygpO2lmKCJkZWZhdWx0Ij09PXQpe2lmKDEhPT1vLmxlbmd0aHx8ImRlZmF1bHQiIT09b1swXSlyZXR1cm4gWGUoenQoImRlZmF1bHQiLG8sbikpfWVsc2UgaWYoIm5vbmUiPT09dCYmby5sZW5ndGg+MClyZXR1cm4gWGUoenQoIm5vbmUiLG8sbikpO3JldHVybiAiYXV0byI9PT10JiYoMD09PW8ubGVuZ3RoP3Q9Im5vbmUiOjE9PT1vLmxlbmd0aCYmImRlZmF1bHQiPT09b1swXT90PSJkZWZhdWx0IjooImVzIiE9PWkmJiJzeXN0ZW0iIT09aSYmby5pbmNsdWRlcygiZGVmYXVsdCIpJiZyKFNlLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOlN0LGlkOmUsbWVzc2FnZTpgRW50cnkgbW9kdWxlICIke1QoZSl9IiBpcyB1c2luZyBuYW1lZCBhbmQgZGVmYXVsdCBleHBvcnRzIHRvZ2V0aGVyLiBDb25zdW1lcnMgb2YgeW91ciBidW5kbGUgd2lsbCBoYXZlIHRvIHVzZSBcYCR7dHx8ImNodW5rIn0uZGVmYXVsdFxgIHRvIGFjY2VzcyB0aGUgZGVmYXVsdCBleHBvcnQsIHdoaWNoIG1heSBub3QgYmUgd2hhdCB5b3Ugd2FudC4gVXNlIFxgb3V0cHV0LmV4cG9ydHM6ICJuYW1lZCJcYCB0byBkaXNhYmxlIHRoaXMgd2FybmluZy5gLHVybDpPZShCZSl9fShuLHMpKSx0PSJuYW1lZCIpKSx0fWZ1bmN0aW9uIEVhKGUpe2NvbnN0IHQ9ZS5zcGxpdCgiXG4iKSxzPXQuZmlsdGVyKChlPT4vXlx0Ky8udGVzdChlKSkpLGk9dC5maWx0ZXIoKGU9Pi9eIHsyLH0vLnRlc3QoZSkpKTtpZigwPT09cy5sZW5ndGgmJjA9PT1pLmxlbmd0aClyZXR1cm4gbnVsbDtpZihzLmxlbmd0aD49aS5sZW5ndGgpcmV0dXJuICJcdCI7Y29uc3Qgbj1pLnJlZHVjZSgoKGUsdCk9Pntjb25zdCBzPS9eICsvLmV4ZWModClbMF0ubGVuZ3RoO3JldHVybiBNYXRoLm1pbihzLGUpfSksMS8wKTtyZXR1cm4gIiAiLnJlcGVhdChuKX1mdW5jdGlvbiBiYShlLHQscyxpLG4scil7Y29uc3Qgbz1lLmdldERlcGVuZGVuY2llc1RvQmVJbmNsdWRlZCgpO2Zvcihjb25zdCBlIG9mIG8pe2lmKGUgaW5zdGFuY2VvZiBadCl7dC5wdXNoKHIuZ2V0KGUpKTtjb250aW51ZX1jb25zdCBvPW4uZ2V0KGUpO289PT1pP3MuaGFzKGUpfHwocy5hZGQoZSksYmEoZSx0LHMsaSxuLHIpKTp0LnB1c2gobyk7fX1jb25zdCB2YT0iIX57IixTYT0ifX4iLEFhPW5ldyBSZWdFeHAoYCR7dmF9WzAtOWEtekEtWl8kXXsxLDU5fSR7U2F9YCwiZyIpLGthPShlLHQpPT5lLnJlcGxhY2UoQWEsKGU9PnQuZ2V0KGUpfHxlKSksSWE9KGUsdCxzKT0+ZS5yZXBsYWNlKEFhLChlPT5lPT09dD9zOmUpKSx3YT0oZSx0KT0+e2NvbnN0IHM9bmV3IFNldCxpPWUucmVwbGFjZShBYSwoZT0+dC5oYXMoZSk/KHMuYWRkKGUpLGAke3ZhfSR7IjAiLnJlcGVhdChlLmxlbmd0aC01KX0ke1NhfWApOmUpKTtyZXR1cm4ge2NvbnRhaW5lZFBsYWNlaG9sZGVyczpzLHRyYW5zZm9ybWVkQ29kZTppfX0sUGE9U3ltYm9sKCJidW5kbGVLZXlzIiksQ2E9e3R5cGU6InBsYWNlaG9sZGVyIn07ZnVuY3Rpb24gJGEoZSx0LHMpe3JldHVybiBWKGUpP1hlKFl0KGBJbnZhbGlkIHBhdHRlcm4gIiR7ZX0iIGZvciAiJHt0fSIsIHBhdHRlcm5zIGNhbiBiZSBuZWl0aGVyIGFic29sdXRlIG5vciByZWxhdGl2ZSBwYXRocy4gSWYgeW91IHdhbnQgeW91ciBmaWxlcyB0byBiZSBzdG9yZWQgaW4gYSBzdWJkaXJlY3RvcnksIHdyaXRlIGl0cyBuYW1lIHdpdGhvdXQgYSBsZWFkaW5nIHNsYXNoIGxpa2UgdGhpczogc3ViZGlyZWN0b3J5L3BhdHRlcm4uYCkpOmUucmVwbGFjZSgvXFsoXHcrKSg6XGQrKT9dL2csKChlLGksbik9PntpZighcy5oYXNPd25Qcm9wZXJ0eShpKXx8biYmImhhc2giIT09aSlyZXR1cm4gWGUoWXQoYCJbJHtpfSR7bnx8IiJ9XSIgaXMgbm90IGEgdmFsaWQgcGxhY2Vob2xkZXIgaW4gdGhlICIke3R9IiBwYXR0ZXJuLmApKTtjb25zdCByPXNbaV0obiYmTnVtYmVyLnBhcnNlSW50KG4uc2xpY2UoMSkpKTtyZXR1cm4gVihyKT9YZShZdChgSW52YWxpZCBzdWJzdGl0dXRpb24gIiR7cn0iIGZvciBwbGFjZWhvbGRlciAiWyR7aX1dIiBpbiAiJHt0fSIgcGF0dGVybiwgY2FuIGJlIG5laXRoZXIgYWJzb2x1dGUgbm9yIHJlbGF0aXZlIHBhdGguYCkpOnJ9KSl9ZnVuY3Rpb24gTmEoZSx7W1BhXTp0fSl7aWYoIXQuaGFzKGUudG9Mb3dlckNhc2UoKSkpcmV0dXJuIGU7Y29uc3Qgcz0kKGUpO2U9ZS5zbGljZSgwLE1hdGgubWF4KDAsZS5sZW5ndGgtcy5sZW5ndGgpKTtsZXQgaSxuPTE7Zm9yKDt0LmhhcygoaT1lKyArK24rcykudG9Mb3dlckNhc2UoKSk7KTtyZXR1cm4gaX1jb25zdCBfYT1uZXcgU2V0KFsiLmpzIiwiLmpzeCIsIi50cyIsIi50c3giLCIubWpzIiwiLm10cyIsIi5janMiLCIuY3RzIl0pO2Z1bmN0aW9uIFJhKGUsdCxzLGkpe2NvbnN0IG49ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dChlLmlkKTp0W2UuaWRdO3JldHVybiBufHwocz8oaShTZSwocj1lLmlkLG89ZS52YXJpYWJsZU5hbWUse2NvZGU6eXQsaWQ6cixtZXNzYWdlOmBObyBuYW1lIHdhcyBwcm92aWRlZCBmb3IgZXh0ZXJuYWwgbW9kdWxlICIke3J9IiBpbiAib3V0cHV0Lmdsb2JhbHMiIOKAkyBndWVzc2luZyAiJHtvfSIuYCxuYW1lczpbb10sdXJsOk9lKFVlKX0pKSxlLnZhcmlhYmxlTmFtZSk6dm9pZCAwKTt2YXIgcixvO31jbGFzcyBNYXtjb25zdHJ1Y3RvcihlLHQscyxpLG4scixvLGEsbCxjLGgsdSxkLHAsZil7dGhpcy5vcmRlcmVkTW9kdWxlcz1lLHRoaXMuaW5wdXRPcHRpb25zPXQsdGhpcy5vdXRwdXRPcHRpb25zPXMsdGhpcy51bnNldE9wdGlvbnM9aSx0aGlzLnBsdWdpbkRyaXZlcj1uLHRoaXMubW9kdWxlc0J5SWQ9cix0aGlzLmNodW5rQnlNb2R1bGU9byx0aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZT1hLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZT1sLHRoaXMuaW5jbHVkZWROYW1lc3BhY2VzPWMsdGhpcy5tYW51YWxDaHVua0FsaWFzPWgsdGhpcy5nZXRQbGFjZWhvbGRlcj11LHRoaXMuYnVuZGxlPWQsdGhpcy5pbnB1dEJhc2U9cCx0aGlzLnNuaXBwZXRzPWYsdGhpcy5lbnRyeU1vZHVsZXM9W10sdGhpcy5leHBvcnRNb2RlPSJuYW1lZCIsdGhpcy5mYWNhZGVNb2R1bGU9bnVsbCx0aGlzLm5hbWVzcGFjZVZhcmlhYmxlTmFtZT0iIix0aGlzLnZhcmlhYmxlTmFtZT0iIix0aGlzLmFjY2Vzc2VkR2xvYmFsc0J5U2NvcGU9bmV3IE1hcCx0aGlzLmRlcGVuZGVuY2llcz1uZXcgU2V0LHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcz1bXSx0aGlzLmR5bmFtaWNOYW1lPW51bGwsdGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGU9bmV3IE1hcCx0aGlzLmV4cG9ydHM9bmV3IFNldCx0aGlzLmV4cG9ydHNCeU5hbWU9bmV3IE1hcCx0aGlzLmZpbGVOYW1lPW51bGwsdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcz1bXSx0aGlzLmltcGxpY2l0bHlMb2FkZWRCZWZvcmU9bmV3IFNldCx0aGlzLmltcG9ydHM9bmV3IFNldCx0aGlzLmluY2x1ZGVkRHluYW1pY0ltcG9ydHM9bnVsbCx0aGlzLmluY2x1ZGVkUmVleHBvcnRzQnlNb2R1bGU9bmV3IE1hcCx0aGlzLmlzRW1wdHk9ITAsdGhpcy5uYW1lPW51bGwsdGhpcy5uZWVkc0V4cG9ydHNTaGltPSExLHRoaXMucHJlUmVuZGVyZWRDaHVua0luZm89bnVsbCx0aGlzLnByZWxpbWluYXJ5RmlsZU5hbWU9bnVsbCx0aGlzLnByZWxpbWluYXJ5U291cmNlbWFwRmlsZU5hbWU9bnVsbCx0aGlzLnJlbmRlcmVkQ2h1bmtJbmZvPW51bGwsdGhpcy5yZW5kZXJlZERlcGVuZGVuY2llcz1udWxsLHRoaXMucmVuZGVyZWRNb2R1bGVzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5zb3J0ZWRFeHBvcnROYW1lcz1udWxsLHRoaXMuc3RyaWN0RmFjYWRlPSExLHRoaXMuZXhlY0luZGV4PWUubGVuZ3RoPjA/ZVswXS5leGVjSW5kZXg6MS8wO2NvbnN0IG09bmV3IFNldChlKTtmb3IoY29uc3QgdCBvZiBlKXtvLnNldCh0LHRoaXMpLHQubmFtZXNwYWNlLmluY2x1ZGVkJiYhcy5wcmVzZXJ2ZU1vZHVsZXMmJmMuYWRkKHQpLHRoaXMuaXNFbXB0eSYmdC5pc0luY2x1ZGVkKCkmJih0aGlzLmlzRW1wdHk9ITEpLCh0LmluZm8uaXNFbnRyeXx8cy5wcmVzZXJ2ZU1vZHVsZXMpJiZ0aGlzLmVudHJ5TW9kdWxlcy5wdXNoKHQpO2Zvcihjb25zdCBlIG9mIHQuaW5jbHVkZWREeW5hbWljSW1wb3J0ZXJzKW0uaGFzKGUpfHwodGhpcy5keW5hbWljRW50cnlNb2R1bGVzLnB1c2godCksdC5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0cyYmKGMuYWRkKHQpLHRoaXMuZXhwb3J0cy5hZGQodC5uYW1lc3BhY2UpKSk7dC5pbXBsaWNpdGx5TG9hZGVkQWZ0ZXIuc2l6ZT4wJiZ0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzLnB1c2godCk7fXRoaXMuc3VnZ2VzdGVkVmFyaWFibGVOYW1lPXZlKHRoaXMuZ2VuZXJhdGVWYXJpYWJsZU5hbWUoKSk7fXN0YXRpYyBnZW5lcmF0ZUZhY2FkZShlLHQscyxpLG4scixvLGEsbCxjLGgsdSxkLHAsZil7Y29uc3QgbT1uZXcgTWEoW10sZSx0LHMsaSxuLHIsbyxhLGwsbnVsbCx1LGQscCxmKTttLmFzc2lnbkZhY2FkZU5hbWUoaCxjKSxhLmhhcyhjKXx8YS5zZXQoYyxtKTtmb3IoY29uc3QgZSBvZiBjLmdldERlcGVuZGVuY2llc1RvQmVJbmNsdWRlZCgpKW0uZGVwZW5kZW5jaWVzLmFkZChlIGluc3RhbmNlb2YgQm8/ci5nZXQoZSk6by5nZXQoZSkpO3JldHVybiAhbS5kZXBlbmRlbmNpZXMuaGFzKHIuZ2V0KGMpKSYmYy5pbmZvLm1vZHVsZVNpZGVFZmZlY3RzJiZjLmhhc0VmZmVjdHMoKSYmbS5kZXBlbmRlbmNpZXMuYWRkKHIuZ2V0KGMpKSxtLmVuc3VyZVJlZXhwb3J0c0FyZUF2YWlsYWJsZUZvck1vZHVsZShjKSxtLmZhY2FkZU1vZHVsZT1jLG0uc3RyaWN0RmFjYWRlPSEwLG19Y2FuTW9kdWxlQmVGYWNhZGUoZSx0KXtjb25zdCBzPWUuZ2V0RXhwb3J0TmFtZXNCeVZhcmlhYmxlKCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5leHBvcnRzKWlmKCFzLmhhcyhlKSlyZXR1cm4gITE7Zm9yKGNvbnN0IGkgb2YgdClpZighKGkubW9kdWxlPT09ZXx8cy5oYXMoaSl8fGkgaW5zdGFuY2VvZiBnbyYmcy5oYXMoaS5nZXRCYXNlVmFyaWFibGUoKSkpKXJldHVybiAhMTtyZXR1cm4gITB9ZmluYWxpemVDaHVuayhlLHQscyxpKXtjb25zdCBuPXRoaXMuZ2V0UmVuZGVyZWRDaHVua0luZm8oKSxyPWU9PmthKGUsaSksbz1uLmZpbGVOYW1lLGE9dGhpcy5maWxlTmFtZT1yKG8pO3JldHVybiB7Li4ubixjb2RlOmUsZHluYW1pY0ltcG9ydHM6bi5keW5hbWljSW1wb3J0cy5tYXAociksZmlsZU5hbWU6YSxpbXBsaWNpdGx5TG9hZGVkQmVmb3JlOm4uaW1wbGljaXRseUxvYWRlZEJlZm9yZS5tYXAociksaW1wb3J0ZWRCaW5kaW5nczpPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMobi5pbXBvcnRlZEJpbmRpbmdzKS5tYXAoKChbZSx0XSk9PltyKGUpLHRdKSkpLGltcG9ydHM6bi5pbXBvcnRzLm1hcChyKSxtYXA6dCxwcmVsaW1pbmFyeUZpbGVOYW1lOm8scmVmZXJlbmNlZEZpbGVzOm4ucmVmZXJlbmNlZEZpbGVzLm1hcChyKSxzb3VyY2VtYXBGaWxlTmFtZTpzfX1nZW5lcmF0ZUV4cG9ydHMoKXt0aGlzLnNvcnRlZEV4cG9ydE5hbWVzPW51bGw7Y29uc3QgZT1uZXcgU2V0KHRoaXMuZXhwb3J0cyk7aWYobnVsbCE9PXRoaXMuZmFjYWRlTW9kdWxlJiYoITEhPT10aGlzLmZhY2FkZU1vZHVsZS5wcmVzZXJ2ZVNpZ25hdHVyZXx8dGhpcy5zdHJpY3RGYWNhZGUpKXtjb25zdCB0PXRoaXMuZmFjYWRlTW9kdWxlLmdldEV4cG9ydE5hbWVzQnlWYXJpYWJsZSgpO2Zvcihjb25zdFtzLGldb2YgdCl7dGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGUuc2V0KHMsWy4uLmldKTtmb3IoY29uc3QgZSBvZiBpKXRoaXMuZXhwb3J0c0J5TmFtZS5zZXQoZSxzKTtlLmRlbGV0ZShzKTt9fXRoaXMub3V0cHV0T3B0aW9ucy5taW5pZnlJbnRlcm5hbEV4cG9ydHM/ZnVuY3Rpb24oZSx0LHMpe2xldCBpPTA7Zm9yKGNvbnN0IG4gb2YgZSl7bGV0W2VdPW4ubmFtZTtpZih0LmhhcyhlKSlkb3tlPU9pKCsraSksNDk9PT1lLmNoYXJDb2RlQXQoMCkmJihpKz05KjY0KiooZS5sZW5ndGgtMSksZT1PaShpKSk7fXdoaWxlKHhlLmhhcyhlKXx8dC5oYXMoZSkpO3Quc2V0KGUsbikscy5zZXQobixbZV0pO319KGUsdGhpcy5leHBvcnRzQnlOYW1lLHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKTpmdW5jdGlvbihlLHQscyl7Zm9yKGNvbnN0IGkgb2YgZSl7bGV0IGU9MCxuPWkubmFtZTtmb3IoO3QuaGFzKG4pOyluPWkubmFtZSsiJCIrICsrZTt0LnNldChuLGkpLHMuc2V0KGksW25dKTt9fShlLHRoaXMuZXhwb3J0c0J5TmFtZSx0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZSksKHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXN8fHRoaXMuZmFjYWRlTW9kdWxlJiZ0aGlzLmZhY2FkZU1vZHVsZS5pbmZvLmlzRW50cnkpJiYodGhpcy5leHBvcnRNb2RlPXhhKHRoaXMsdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuZmFjYWRlTW9kdWxlLmlkLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSk7fWdlbmVyYXRlRmFjYWRlcygpe2NvbnN0IGU9W10sdD1uZXcgU2V0KFsuLi50aGlzLmVudHJ5TW9kdWxlcywuLi50aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzXSkscz1uZXcgU2V0KHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcy5tYXAoKCh7bmFtZXNwYWNlOmV9KT0+ZSkpKTtmb3IoY29uc3QgZSBvZiB0KWlmKGUucHJlc2VydmVTaWduYXR1cmUpZm9yKGNvbnN0IHQgb2YgZS5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKS5rZXlzKCkpdGhpcy5jaHVua0J5TW9kdWxlLmdldCh0Lm1vZHVsZSk9PT10aGlzJiZzLmFkZCh0KTtmb3IoY29uc3QgaSBvZiB0KXtjb25zdCB0PUFycmF5LmZyb20obmV3IFNldChpLmNodW5rTmFtZXMuZmlsdGVyKCgoe2lzVXNlckRlZmluZWQ6ZX0pPT5lKSkubWFwKCgoe25hbWU6ZX0pPT5lKSkpLChlPT4oe25hbWU6ZX0pKSk7aWYoMD09PXQubGVuZ3RoJiZpLmlzVXNlckRlZmluZWRFbnRyeVBvaW50JiZ0LnB1c2goe30pLHQucHVzaCguLi5BcnJheS5mcm9tKGkuY2h1bmtGaWxlTmFtZXMsKGU9Pih7ZmlsZU5hbWU6ZX0pKSkpLDA9PT10Lmxlbmd0aCYmdC5wdXNoKHt9KSwhdGhpcy5mYWNhZGVNb2R1bGUpe2NvbnN0IGU9IXRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXMmJigic3RyaWN0Ij09PWkucHJlc2VydmVTaWduYXR1cmV8fCJleHBvcnRzLW9ubHkiPT09aS5wcmVzZXJ2ZVNpZ25hdHVyZSYmaS5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKS5zaXplPjApO2UmJiF0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGkscyl8fCh0aGlzLmZhY2FkZU1vZHVsZT1pLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZS5zZXQoaSx0aGlzKSxpLnByZXNlcnZlU2lnbmF0dXJlJiYodGhpcy5zdHJpY3RGYWNhZGU9ZSksdGhpcy5hc3NpZ25GYWNhZGVOYW1lKHQuc2hpZnQoKSxpLHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXMpKTt9Zm9yKGNvbnN0IHMgb2YgdCllLnB1c2goTWEuZ2VuZXJhdGVGYWNhZGUodGhpcy5pbnB1dE9wdGlvbnMsdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMudW5zZXRPcHRpb25zLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMubW9kdWxlc0J5SWQsdGhpcy5jaHVua0J5TW9kdWxlLHRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcyxpLHMsdGhpcy5nZXRQbGFjZWhvbGRlcix0aGlzLmJ1bmRsZSx0aGlzLmlucHV0QmFzZSx0aGlzLnNuaXBwZXRzKSk7fWZvcihjb25zdCBlIG9mIHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcyllLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzfHwoIXRoaXMuZmFjYWRlTW9kdWxlJiZ0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGUscyk/KHRoaXMuZmFjYWRlTW9kdWxlPWUsdGhpcy5mYWNhZGVDaHVua0J5TW9kdWxlLnNldChlLHRoaXMpLHRoaXMuc3RyaWN0RmFjYWRlPSEwLHRoaXMuZHluYW1pY05hbWU9T2EoZSkpOnRoaXMuZmFjYWRlTW9kdWxlPT09ZSYmIXRoaXMuc3RyaWN0RmFjYWRlJiZ0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGUscyk/dGhpcy5zdHJpY3RGYWNhZGU9ITA6dGhpcy5mYWNhZGVDaHVua0J5TW9kdWxlLmdldChlKT8uc3RyaWN0RmFjYWRlfHwodGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMuYWRkKGUpLHRoaXMuZXhwb3J0cy5hZGQoZS5uYW1lc3BhY2UpKSk7cmV0dXJuIHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXN8fHRoaXMuYWRkTmVjZXNzYXJ5SW1wb3J0c0ZvckZhY2FkZXMoKSxlfWdldENodW5rTmFtZSgpe3JldHVybiB0aGlzLm5hbWU/Pyh0aGlzLm5hbWU9dGhpcy5vdXRwdXRPcHRpb25zLnNhbml0aXplRmlsZU5hbWUodGhpcy5nZXRGYWxsYmFja0NodW5rTmFtZSgpKSl9Z2V0RXhwb3J0TmFtZXMoKXtyZXR1cm4gdGhpcy5zb3J0ZWRFeHBvcnROYW1lcz8/KHRoaXMuc29ydGVkRXhwb3J0TmFtZXM9Wy4uLnRoaXMuZXhwb3J0c0J5TmFtZS5rZXlzKCldLnNvcnQoKSl9Z2V0RmlsZU5hbWUoKXtyZXR1cm4gdGhpcy5maWxlTmFtZXx8dGhpcy5nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCkuZmlsZU5hbWV9Z2V0SW1wb3J0UGF0aChlKXtyZXR1cm4gRCh6KGUsdGhpcy5nZXRGaWxlTmFtZSgpLCJhbWQiPT09dGhpcy5vdXRwdXRPcHRpb25zLmZvcm1hdCYmIXRoaXMub3V0cHV0T3B0aW9ucy5hbWQuZm9yY2VKc0V4dGVuc2lvbkZvckltcG9ydHMsITApKX1nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCl7aWYodGhpcy5wcmVsaW1pbmFyeUZpbGVOYW1lKXJldHVybiB0aGlzLnByZWxpbWluYXJ5RmlsZU5hbWU7bGV0IGUsdD1udWxsO2NvbnN0e2NodW5rRmlsZU5hbWVzOnMsZW50cnlGaWxlTmFtZXM6aSxmaWxlOm4sZm9ybWF0OnIscHJlc2VydmVNb2R1bGVzOm99PXRoaXMub3V0cHV0T3B0aW9ucztpZihuKWU9UChuKTtlbHNlIGlmKG51bGw9PT10aGlzLmZpbGVOYW1lKXtjb25zdFtuLGFdPW98fHRoaXMuZmFjYWRlTW9kdWxlPy5pc1VzZXJEZWZpbmVkRW50cnlQb2ludD9baSwib3V0cHV0LmVudHJ5RmlsZU5hbWVzIl06W3MsIm91dHB1dC5jaHVua0ZpbGVOYW1lcyJdO2U9JGEoImZ1bmN0aW9uIj09dHlwZW9mIG4/bih0aGlzLmdldFByZVJlbmRlcmVkQ2h1bmtJbmZvKCkpOm4sYSx7Zm9ybWF0OigpPT5yLGhhc2g6ZT0+dHx8KHQ9dGhpcy5nZXRQbGFjZWhvbGRlcihhLGUpKSxuYW1lOigpPT50aGlzLmdldENodW5rTmFtZSgpfSksdHx8KGU9TmEoZSx0aGlzLmJ1bmRsZSkpO31lbHNlIGU9dGhpcy5maWxlTmFtZTtyZXR1cm4gdHx8KHRoaXMuYnVuZGxlW2VdPUNhKSx0aGlzLnByZWxpbWluYXJ5RmlsZU5hbWU9e2ZpbGVOYW1lOmUsaGFzaFBsYWNlaG9sZGVyOnR9fWdldFByZWxpbWluYXJ5U291cmNlbWFwRmlsZU5hbWUoKXtpZih0aGlzLnByZWxpbWluYXJ5U291cmNlbWFwRmlsZU5hbWUpcmV0dXJuIHRoaXMucHJlbGltaW5hcnlTb3VyY2VtYXBGaWxlTmFtZTtsZXQgZT1udWxsLHQ9bnVsbDtjb25zdHtzb3VyY2VtYXBGaWxlTmFtZXM6cyxmb3JtYXQ6aX09dGhpcy5vdXRwdXRPcHRpb25zO2lmKCFzKXJldHVybiBudWxsO3tjb25zdFtuLHJdPVtzLCJvdXRwdXQuc291cmNlbWFwRmlsZU5hbWVzIl07ZT0kYSgiZnVuY3Rpb24iPT10eXBlb2Ygbj9uKHRoaXMuZ2V0UHJlUmVuZGVyZWRDaHVua0luZm8oKSk6bixyLHtjaHVua2hhc2g6KCk9PnRoaXMuZ2V0UHJlbGltaW5hcnlGaWxlTmFtZSgpLmhhc2hQbGFjZWhvbGRlcnx8IiIsZm9ybWF0OigpPT5pLGhhc2g6ZT0+dHx8KHQ9dGhpcy5nZXRQbGFjZWhvbGRlcihyLGUpKSxuYW1lOigpPT50aGlzLmdldENodW5rTmFtZSgpfSksdHx8KGU9TmEoZSx0aGlzLmJ1bmRsZSkpO31yZXR1cm4gdGhpcy5wcmVsaW1pbmFyeVNvdXJjZW1hcEZpbGVOYW1lPXtmaWxlTmFtZTplLGhhc2hQbGFjZWhvbGRlcjp0fX1nZXRSZW5kZXJlZENodW5rSW5mbygpe3JldHVybiB0aGlzLnJlbmRlcmVkQ2h1bmtJbmZvP3RoaXMucmVuZGVyZWRDaHVua0luZm86dGhpcy5yZW5kZXJlZENodW5rSW5mbz17Li4udGhpcy5nZXRQcmVSZW5kZXJlZENodW5rSW5mbygpLGR5bmFtaWNJbXBvcnRzOnRoaXMuZ2V0RHluYW1pY0RlcGVuZGVuY2llcygpLm1hcChWYSksZmlsZU5hbWU6dGhpcy5nZXRGaWxlTmFtZSgpLGltcGxpY2l0bHlMb2FkZWRCZWZvcmU6QXJyYXkuZnJvbSh0aGlzLmltcGxpY2l0bHlMb2FkZWRCZWZvcmUsVmEpLGltcG9ydGVkQmluZGluZ3M6TGEodGhpcy5nZXRSZW5kZXJlZERlcGVuZGVuY2llcygpLFZhKSxpbXBvcnRzOkFycmF5LmZyb20odGhpcy5kZXBlbmRlbmNpZXMsVmEpLG1vZHVsZXM6dGhpcy5yZW5kZXJlZE1vZHVsZXMscmVmZXJlbmNlZEZpbGVzOnRoaXMuZ2V0UmVmZXJlbmNlZEZpbGVzKCl9fWdldFZhcmlhYmxlRXhwb3J0TmFtZShlKXtyZXR1cm4gdGhpcy5vdXRwdXRPcHRpb25zLnByZXNlcnZlTW9kdWxlcyYmZSBpbnN0YW5jZW9mIG1vPyIqIjp0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZS5nZXQoZSlbMF19bGluaygpe3RoaXMuZGVwZW5kZW5jaWVzPWZ1bmN0aW9uKGUsdCxzLGkpe2NvbnN0IG49W10scj1uZXcgU2V0O2ZvcihsZXQgbz10Lmxlbmd0aC0xO28+PTA7by0tKXtjb25zdCBhPXRbb107aWYoIXIuaGFzKGEpKXtjb25zdCB0PVtdO2JhKGEsdCxyLGUscyxpKSxuLnVuc2hpZnQodCk7fX1jb25zdCBvPW5ldyBTZXQ7Zm9yKGNvbnN0IGUgb2Ygbilmb3IoY29uc3QgdCBvZiBlKW8uYWRkKHQpO3JldHVybiBvfSh0aGlzLHRoaXMub3JkZXJlZE1vZHVsZXMsdGhpcy5jaHVua0J5TW9kdWxlLHRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlKTtmb3IoY29uc3QgZSBvZiB0aGlzLm9yZGVyZWRNb2R1bGVzKXRoaXMuYWRkSW1wbGljaXRseUxvYWRlZEJlZm9yZUZyb21Nb2R1bGUoZSksdGhpcy5zZXRVcENodW5rSW1wb3J0c0FuZEV4cG9ydHNGb3JNb2R1bGUoZSk7fWFzeW5jIHJlbmRlcigpe2NvbnN0e2RlcGVuZGVuY2llczplLGV4cG9ydE1vZGU6dCxmYWNhZGVNb2R1bGU6cyxpbnB1dE9wdGlvbnM6e29uTG9nOml9LG91dHB1dE9wdGlvbnM6bixwbHVnaW5Ecml2ZXI6cixzbmlwcGV0czpvfT10aGlzLHtmb3JtYXQ6YSxob2lzdFRyYW5zaXRpdmVJbXBvcnRzOmwscHJlc2VydmVNb2R1bGVzOmN9PW47aWYobCYmIWMmJm51bGwhPT1zKWZvcihjb25zdCB0IG9mIGUpdCBpbnN0YW5jZW9mIE1hJiZ0aGlzLmlubGluZUNodW5rRGVwZW5kZW5jaWVzKHQpO2NvbnN0IGg9dGhpcy5nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCksdT10aGlzLmdldFByZWxpbWluYXJ5U291cmNlbWFwRmlsZU5hbWUoKSx7YWNjZXNzZWRHbG9iYWxzOmQsaW5kZW50OnAsbWFnaWNTdHJpbmc6ZixyZW5kZXJlZFNvdXJjZTptLHVzZWRNb2R1bGVzOmcsdXNlc1RvcExldmVsQXdhaXQ6eX09dGhpcy5yZW5kZXJNb2R1bGVzKGguZmlsZU5hbWUpLHg9Wy4uLnRoaXMuZ2V0UmVuZGVyZWREZXBlbmRlbmNpZXMoKS52YWx1ZXMoKV0sRT0ibm9uZSI9PT10P1tdOnRoaXMuZ2V0Q2h1bmtFeHBvcnREZWNsYXJhdGlvbnMoYSk7bGV0IGI9RS5sZW5ndGg+MCx2PSExO2Zvcihjb25zdCBlIG9mIHgpe2NvbnN0e3JlZXhwb3J0czp0fT1lO3Q/Lmxlbmd0aCYmKGI9ITAsIXYmJnQuc29tZSgoZT0+ImRlZmF1bHQiPT09ZS5yZWV4cG9ydGVkKSkmJih2PSEwKSwiZXMiPT09YSYmKGUucmVleHBvcnRzPXQuZmlsdGVyKCgoe3JlZXhwb3J0ZWQ6ZX0pPT4hRS5maW5kKCgoe2V4cG9ydGVkOnR9KT0+dD09PWUpKSkpKSk7fWlmKCF2KWZvcihjb25zdHtleHBvcnRlZDplfW9mIEUpaWYoImRlZmF1bHQiPT09ZSl7dj0hMDticmVha31jb25zdHtpbnRybzpTLG91dHJvOkEsYmFubmVyOmssZm9vdGVyOkl9PWF3YWl0IHBhKG4scix0aGlzLmdldFJlbmRlcmVkQ2h1bmtJbmZvKCkpO3JldHVybiBoYVthXShtLHthY2Nlc3NlZEdsb2JhbHM6ZCxkZXBlbmRlbmNpZXM6eCxleHBvcnRzOkUsaGFzRGVmYXVsdEV4cG9ydDp2LGhhc0V4cG9ydHM6YixpZDpoLmZpbGVOYW1lLGluZGVudDpwLGludHJvOlMsaXNFbnRyeUZhY2FkZTpjfHxudWxsIT09cyYmcy5pbmZvLmlzRW50cnksaXNNb2R1bGVGYWNhZGU6bnVsbCE9PXMsbG9nOmksbmFtZWRFeHBvcnRzTW9kZToiZGVmYXVsdCIhPT10LG91dHJvOkEsc25pcHBldHM6byx1c2VzVG9wTGV2ZWxBd2FpdDp5fSxuKSxrJiZmLnByZXBlbmQoayksSSYmZi5hcHBlbmQoSSkse2NodW5rOnRoaXMsbWFnaWNTdHJpbmc6ZixwcmVsaW1pbmFyeUZpbGVOYW1lOmgscHJlbGltaW5hcnlTb3VyY2VtYXBGaWxlTmFtZTp1LHVzZWRNb2R1bGVzOmd9fWFkZEltcGxpY2l0bHlMb2FkZWRCZWZvcmVGcm9tTW9kdWxlKGUpe2NvbnN0e2NodW5rQnlNb2R1bGU6dCxpbXBsaWNpdGx5TG9hZGVkQmVmb3JlOnN9PXRoaXM7Zm9yKGNvbnN0IGkgb2YgZS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlKXtjb25zdCBlPXQuZ2V0KGkpO2UmJmUhPT10aGlzJiZzLmFkZChlKTt9fWFkZE5lY2Vzc2FyeUltcG9ydHNGb3JGYWNhZGVzKCl7Zm9yKGNvbnN0W2UsdF1vZiB0aGlzLmluY2x1ZGVkUmVleHBvcnRzQnlNb2R1bGUpaWYodGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMuaGFzKGUpKWZvcihjb25zdCBlIG9mIHQpdGhpcy5pbXBvcnRzLmFkZChlKTt9YXNzaWduRmFjYWRlTmFtZSh7ZmlsZU5hbWU6ZSxuYW1lOnR9LHMsaSl7ZT90aGlzLmZpbGVOYW1lPWU6dGhpcy5uYW1lPXRoaXMub3V0cHV0T3B0aW9ucy5zYW5pdGl6ZUZpbGVOYW1lKHR8fChpP3RoaXMuZ2V0UHJlc2VydmVNb2R1bGVzQ2h1bmtOYW1lRnJvbU1vZHVsZShzKTpPYShzKSkpO31jaGVja0NpcmN1bGFyRGVwZW5kZW5jeUltcG9ydChlLHQpe2NvbnN0IHM9ZS5tb2R1bGU7aWYocyBpbnN0YW5jZW9mIEJvKXtjb25zdCBsPXRoaXMuY2h1bmtCeU1vZHVsZS5nZXQocyk7bGV0IGM7ZG97aWYoYz10LmFsdGVybmF0aXZlUmVleHBvcnRNb2R1bGVzLmdldChlKSxjKXt0aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGMpIT09bCYmdGhpcy5pbnB1dE9wdGlvbnMub25Mb2coU2UsKGk9cy5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKS5nZXQoZSk/LlswXXx8IioiLG49cy5pZCxyPWMuaWQsbz10LmlkLGE9dGhpcy5vdXRwdXRPcHRpb25zLnByZXNlcnZlTW9kdWxlcyx7Y29kZToiQ1lDTElDX0NST1NTX0NIVU5LX1JFRVhQT1JUIixleHBvcnRlcjpuLGlkOm8sbWVzc2FnZTpgRXhwb3J0ICIke2l9IiBvZiBtb2R1bGUgIiR7VChuKX0iIHdhcyByZWV4cG9ydGVkIHRocm91Z2ggbW9kdWxlICIke1Qocil9IiB3aGlsZSBib3RoIG1vZHVsZXMgYXJlIGRlcGVuZGVuY2llcyBvZiBlYWNoIG90aGVyIGFuZCB3aWxsIGVuZCB1cCBpbiBkaWZmZXJlbnQgY2h1bmtzIGJ5IGN1cnJlbnQgUm9sbHVwIHNldHRpbmdzLiBUaGlzIHNjZW5hcmlvIGlzIG5vdCB3ZWxsIHN1cHBvcnRlZCBhdCB0aGUgbW9tZW50IGFzIGl0IHdpbGwgcHJvZHVjZSBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgYmV0d2VlbiBjaHVua3MgYW5kIHdpbGwgbGlrZWx5IGxlYWQgdG8gYnJva2VuIGV4ZWN1dGlvbiBvcmRlci5cbkVpdGhlciBjaGFuZ2UgdGhlIGltcG9ydCBpbiAiJHtUKG8pfSIgdG8gcG9pbnQgZGlyZWN0bHkgdG8gdGhlIGV4cG9ydGluZyBtb2R1bGUgb3IgJHthPydkbyBub3QgdXNlICJvdXRwdXQucHJlc2VydmVNb2R1bGVzIic6J3JlY29uZmlndXJlICJvdXRwdXQubWFudWFsQ2h1bmtzIid9IHRvIGVuc3VyZSB0aGVzZSBtb2R1bGVzIGVuZCB1cCBpbiB0aGUgc2FtZSBjaHVuay5gLHJlZXhwb3J0ZXI6cn0pKSx0PWM7fX13aGlsZShjKX12YXIgaSxuLHIsbyxhO31lbnN1cmVSZWV4cG9ydHNBcmVBdmFpbGFibGVGb3JNb2R1bGUoZSl7Y29uc3QgdD1bXSxzPWUuZ2V0RXhwb3J0TmFtZXNCeVZhcmlhYmxlKCk7Zm9yKGNvbnN0IGkgb2Ygcy5rZXlzKCkpe2NvbnN0IHM9aSBpbnN0YW5jZW9mIGdvLG49cz9pLmdldEJhc2VWYXJpYWJsZSgpOmk7aWYodGhpcy5jaGVja0NpcmN1bGFyRGVwZW5kZW5jeUltcG9ydChuLGUpLCEobiBpbnN0YW5jZW9mIG1vJiZ0aGlzLm91dHB1dE9wdGlvbnMucHJlc2VydmVNb2R1bGVzKSl7Y29uc3QgZT1uLm1vZHVsZTtpZihlIGluc3RhbmNlb2YgQm8pe2NvbnN0IGk9dGhpcy5jaHVua0J5TW9kdWxlLmdldChlKTtpJiZpIT09dGhpcyYmKGkuZXhwb3J0cy5hZGQobiksdC5wdXNoKG4pLHMmJnRoaXMuaW1wb3J0cy5hZGQobikpO319fXQubGVuZ3RoPjAmJnRoaXMuaW5jbHVkZWRSZWV4cG9ydHNCeU1vZHVsZS5zZXQoZSx0KTt9Z2VuZXJhdGVWYXJpYWJsZU5hbWUoKXtpZih0aGlzLm1hbnVhbENodW5rQWxpYXMpcmV0dXJuIHRoaXMubWFudWFsQ2h1bmtBbGlhcztjb25zdCBlPXRoaXMuZW50cnlNb2R1bGVzWzBdfHx0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzWzBdfHx0aGlzLmR5bmFtaWNFbnRyeU1vZHVsZXNbMF18fHRoaXMub3JkZXJlZE1vZHVsZXNbdGhpcy5vcmRlcmVkTW9kdWxlcy5sZW5ndGgtMV07cmV0dXJuIGU/T2EoZSk6ImNodW5rIn1nZXRDaHVua0V4cG9ydERlY2xhcmF0aW9ucyhlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIHRoaXMuZ2V0RXhwb3J0TmFtZXMoKSl7aWYoIioiPT09c1swXSljb250aW51ZTtjb25zdCBpPXRoaXMuZXhwb3J0c0J5TmFtZS5nZXQocyk7aWYoIShpIGluc3RhbmNlb2YgZ28pKXtjb25zdCB0PWkubW9kdWxlO2lmKHQpe2NvbnN0IGk9dGhpcy5jaHVua0J5TW9kdWxlLmdldCh0KTtpZihpIT09dGhpcyl7aWYoIWl8fCJlcyIhPT1lKWNvbnRpbnVlO2NvbnN0IHQ9dGhpcy5yZW5kZXJlZERlcGVuZGVuY2llcy5nZXQoaSk7aWYoIXQpY29udGludWU7Y29uc3R7aW1wb3J0czpuLHJlZXhwb3J0czpyfT10LG89cj8uZmluZCgoKHtyZWV4cG9ydGVkOmV9KT0+ZT09PXMpKSxhPW4/LmZpbmQoKCh7aW1wb3J0ZWQ6ZX0pPT5lPT09bz8uaW1wb3J0ZWQpKTtpZighYSljb250aW51ZX19fWxldCBuPW51bGwscj0hMSxvPWkuZ2V0TmFtZSh0aGlzLnNuaXBwZXRzLmdldFByb3BlcnR5QWNjZXNzKTtpZihpIGluc3RhbmNlb2Ygd2kpe2Zvcihjb25zdCBlIG9mIGkuZGVjbGFyYXRpb25zKWlmKGUucGFyZW50IGluc3RhbmNlb2YgaXJ8fGUgaW5zdGFuY2VvZiBuciYmZS5kZWNsYXJhdGlvbiBpbnN0YW5jZW9mIGlyKXtyPSEwO2JyZWFrfX1lbHNlIGkgaW5zdGFuY2VvZiBnbyYmKG49bywiZXMiPT09ZSYmKG89aS5yZW5kZXJOYW1lKSk7dC5wdXNoKHtleHBvcnRlZDpzLGV4cHJlc3Npb246bixob2lzdGVkOnIsbG9jYWw6b30pO31yZXR1cm4gdH1nZXREZXBlbmRlbmNpZXNUb0JlRGVjb25mbGljdGVkKGUsdCxzKXtjb25zdCBpPW5ldyBTZXQsbj1uZXcgU2V0LHI9bmV3IFNldDtmb3IoY29uc3QgdCBvZiBbLi4udGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGUua2V5cygpLC4uLnRoaXMuaW1wb3J0c10paWYoZXx8dC5pc05hbWVzcGFjZSl7Y29uc3Qgbz10Lm1vZHVsZTtpZihvIGluc3RhbmNlb2YgWnQpe2NvbnN0IGE9dGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGUuZ2V0KG8pO2kuYWRkKGEpLGUmJigiZGVmYXVsdCI9PT10Lm5hbWU/RXJbcyhvLmlkKV0mJm4uYWRkKGEpOiIqIj09PXQubmFtZSYmdnJbcyhvLmlkKV0mJnIuYWRkKGEpKTt9ZWxzZSB7Y29uc3Qgcz10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KG8pO3MhPT10aGlzJiYoaS5hZGQocyksZSYmImRlZmF1bHQiPT09cy5leHBvcnRNb2RlJiZ0LmlzTmFtZXNwYWNlJiZyLmFkZChzKSk7fX1pZih0KWZvcihjb25zdCBlIG9mIHRoaXMuZGVwZW5kZW5jaWVzKWkuYWRkKGUpO3JldHVybiB7ZGVjb25mbGljdGVkRGVmYXVsdDpuLGRlY29uZmxpY3RlZE5hbWVzcGFjZTpyLGRlcGVuZGVuY2llczppfX1nZXREeW5hbWljRGVwZW5kZW5jaWVzKCl7cmV0dXJuIHRoaXMuZ2V0SW5jbHVkZWREeW5hbWljSW1wb3J0cygpLm1hcCgoZT0+ZS5mYWNhZGVDaHVua3x8ZS5jaHVua3x8ZS5leHRlcm5hbENodW5rfHxlLnJlc29sdXRpb24pKS5maWx0ZXIoKGU9PmUhPT10aGlzJiYoZSBpbnN0YW5jZW9mIE1hfHxlIGluc3RhbmNlb2YgRiQzKSkpfWdldER5bmFtaWNJbXBvcnRTdHJpbmdBbmRBc3NlcnRpb25zKGUsdCl7aWYoZSBpbnN0YW5jZW9mIFp0KXtjb25zdCBzPXRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLmdldChlKTtyZXR1cm4gW2AnJHtzLmdldEltcG9ydFBhdGgodCl9J2Ascy5nZXRJbXBvcnRBc3NlcnRpb25zKHRoaXMuc25pcHBldHMpXX1yZXR1cm4gW2V8fCIiLCJlcyI9PT10aGlzLm91dHB1dE9wdGlvbnMuZm9ybWF0JiZ0aGlzLm91dHB1dE9wdGlvbnMuZXh0ZXJuYWxJbXBvcnRBc3NlcnRpb25zfHxudWxsXX1nZXRGYWxsYmFja0NodW5rTmFtZSgpe3JldHVybiB0aGlzLm1hbnVhbENodW5rQWxpYXM/dGhpcy5tYW51YWxDaHVua0FsaWFzOnRoaXMuZHluYW1pY05hbWU/dGhpcy5keW5hbWljTmFtZTp0aGlzLmZpbGVOYW1lP0wodGhpcy5maWxlTmFtZSk6TCh0aGlzLm9yZGVyZWRNb2R1bGVzW3RoaXMub3JkZXJlZE1vZHVsZXMubGVuZ3RoLTFdLmlkKX1nZXRJbXBvcnRTcGVjaWZpZXJzKCl7Y29uc3R7aW50ZXJvcDplfT10aGlzLm91dHB1dE9wdGlvbnMsdD1uZXcgTWFwO2Zvcihjb25zdCBzIG9mIHRoaXMuaW1wb3J0cyl7Y29uc3QgaT1zLm1vZHVsZTtsZXQgbixyO2lmKGkgaW5zdGFuY2VvZiBadCl7aWYobj10aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZS5nZXQoaSkscj1zLm5hbWUsImRlZmF1bHQiIT09ciYmIioiIT09ciYmImRlZmF1bHRPbmx5Ij09PWUoaS5pZCkpcmV0dXJuIFhlKEh0KGkuaWQsciwhMSkpfWVsc2Ugbj10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGkpLHI9bi5nZXRWYXJpYWJsZUV4cG9ydE5hbWUocyk7aih0LG4sRykucHVzaCh7aW1wb3J0ZWQ6cixsb2NhbDpzLmdldE5hbWUodGhpcy5zbmlwcGV0cy5nZXRQcm9wZXJ0eUFjY2Vzcyl9KTt9cmV0dXJuIHR9Z2V0SW5jbHVkZWREeW5hbWljSW1wb3J0cygpe2lmKHRoaXMuaW5jbHVkZWREeW5hbWljSW1wb3J0cylyZXR1cm4gdGhpcy5pbmNsdWRlZER5bmFtaWNJbXBvcnRzO2NvbnN0IGU9W107Zm9yKGNvbnN0IHQgb2YgdGhpcy5vcmRlcmVkTW9kdWxlcylmb3IoY29uc3R7bm9kZTpzLHJlc29sdXRpb246aX1vZiB0LmR5bmFtaWNJbXBvcnRzKXMuaW5jbHVkZWQmJmUucHVzaChpIGluc3RhbmNlb2YgQm8/e2NodW5rOnRoaXMuY2h1bmtCeU1vZHVsZS5nZXQoaSksZXh0ZXJuYWxDaHVuazpudWxsLGZhY2FkZUNodW5rOnRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZS5nZXQoaSksbm9kZTpzLHJlc29sdXRpb246aX06aSBpbnN0YW5jZW9mIFp0P3tjaHVuazpudWxsLGV4dGVybmFsQ2h1bms6dGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGUuZ2V0KGkpLGZhY2FkZUNodW5rOm51bGwsbm9kZTpzLHJlc29sdXRpb246aX06e2NodW5rOm51bGwsZXh0ZXJuYWxDaHVuazpudWxsLGZhY2FkZUNodW5rOm51bGwsbm9kZTpzLHJlc29sdXRpb246aX0pO3JldHVybiB0aGlzLmluY2x1ZGVkRHluYW1pY0ltcG9ydHM9ZX1nZXRQcmVSZW5kZXJlZENodW5rSW5mbygpe2lmKHRoaXMucHJlUmVuZGVyZWRDaHVua0luZm8pcmV0dXJuIHRoaXMucHJlUmVuZGVyZWRDaHVua0luZm87Y29uc3R7ZHluYW1pY0VudHJ5TW9kdWxlczplLGZhY2FkZU1vZHVsZTp0LGltcGxpY2l0RW50cnlNb2R1bGVzOnMsb3JkZXJlZE1vZHVsZXM6aX09dGhpcztyZXR1cm4gdGhpcy5wcmVSZW5kZXJlZENodW5rSW5mbz17ZXhwb3J0czp0aGlzLmdldEV4cG9ydE5hbWVzKCksZmFjYWRlTW9kdWxlSWQ6dCYmdC5pZCxpc0R5bmFtaWNFbnRyeTplLmxlbmd0aD4wLGlzRW50cnk6ISF0Py5pbmZvLmlzRW50cnksaXNJbXBsaWNpdEVudHJ5OnMubGVuZ3RoPjAsbW9kdWxlSWRzOmkubWFwKCgoe2lkOmV9KT0+ZSkpLG5hbWU6dGhpcy5nZXRDaHVua05hbWUoKSx0eXBlOiJjaHVuayJ9fWdldFByZXNlcnZlTW9kdWxlc0NodW5rTmFtZUZyb21Nb2R1bGUoZSl7Y29uc3QgdD1EYShlKTtpZih0KXJldHVybiB0O2NvbnN0e3ByZXNlcnZlTW9kdWxlc1Jvb3Q6cyxzYW5pdGl6ZUZpbGVOYW1lOml9PXRoaXMub3V0cHV0T3B0aW9ucyxuPWkodyhlLmlkLnNwbGl0KFRhLDEpWzBdKSkscj0kKG4pLG89X2EuaGFzKHIpP24uc2xpY2UoMCwtci5sZW5ndGgpOm47cmV0dXJuIGsobyk/cyYmXyhvKS5zdGFydHNXaXRoKHMpP28uc2xpY2Uocy5sZW5ndGgpLnJlcGxhY2UoL15bL1xcXS8sIiIpOk4kNSh0aGlzLmlucHV0QmFzZSxvKTpgX3ZpcnR1YWwvJHtQKG8pfWB9Z2V0UmVleHBvcnRTcGVjaWZpZXJzKCl7Y29uc3R7ZXh0ZXJuYWxMaXZlQmluZGluZ3M6ZSxpbnRlcm9wOnR9PXRoaXMub3V0cHV0T3B0aW9ucyxzPW5ldyBNYXA7Zm9yKGxldCBpIG9mIHRoaXMuZ2V0RXhwb3J0TmFtZXMoKSl7bGV0IG4scixvPSExO2lmKCIqIj09PWlbMF0pe2NvbnN0IHM9aS5zbGljZSgxKTsiZGVmYXVsdE9ubHkiPT09dChzKSYmdGhpcy5pbnB1dE9wdGlvbnMub25Mb2coU2UsS3QocykpLG89ZSxuPXRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLmdldCh0aGlzLm1vZHVsZXNCeUlkLmdldChzKSkscj1pPSIqIjt9ZWxzZSB7Y29uc3Qgcz10aGlzLmV4cG9ydHNCeU5hbWUuZ2V0KGkpO2lmKHMgaW5zdGFuY2VvZiBnbyljb250aW51ZTtjb25zdCBhPXMubW9kdWxlO2lmKGEgaW5zdGFuY2VvZiBCbyl7aWYobj10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGEpLG49PT10aGlzKWNvbnRpbnVlO3I9bi5nZXRWYXJpYWJsZUV4cG9ydE5hbWUocyksbz1zLmlzUmVhc3NpZ25lZDt9ZWxzZSB7aWYobj10aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZS5nZXQoYSkscj1zLm5hbWUsImRlZmF1bHQiIT09ciYmIioiIT09ciYmImRlZmF1bHRPbmx5Ij09PXQoYS5pZCkpcmV0dXJuIFhlKEh0KGEuaWQsciwhMCkpO289ZSYmKCJkZWZhdWx0IiE9PXJ8fGJyKHQoYS5pZCksITApKTt9fWoocyxuLEcpLnB1c2goe2ltcG9ydGVkOnIsbmVlZHNMaXZlQmluZGluZzpvLHJlZXhwb3J0ZWQ6aX0pO31yZXR1cm4gc31nZXRSZWZlcmVuY2VkRmlsZXMoKXtjb25zdCBlPW5ldyBTZXQ7Zm9yKGNvbnN0IHQgb2YgdGhpcy5vcmRlcmVkTW9kdWxlcylmb3IoY29uc3QgcyBvZiB0LmltcG9ydE1ldGFzKXtjb25zdCB0PXMuZ2V0UmVmZXJlbmNlZEZpbGVOYW1lKHRoaXMucGx1Z2luRHJpdmVyKTt0JiZlLmFkZCh0KTt9cmV0dXJuIFsuLi5lXX1nZXRSZW5kZXJlZERlcGVuZGVuY2llcygpe2lmKHRoaXMucmVuZGVyZWREZXBlbmRlbmNpZXMpcmV0dXJuIHRoaXMucmVuZGVyZWREZXBlbmRlbmNpZXM7Y29uc3QgZT10aGlzLmdldEltcG9ydFNwZWNpZmllcnMoKSx0PXRoaXMuZ2V0UmVleHBvcnRTcGVjaWZpZXJzKCkscz1uZXcgTWFwLGk9dGhpcy5nZXRGaWxlTmFtZSgpO2Zvcihjb25zdCBuIG9mIHRoaXMuZGVwZW5kZW5jaWVzKXtjb25zdCByPWUuZ2V0KG4pfHxudWxsLG89dC5nZXQobil8fG51bGwsYT1uIGluc3RhbmNlb2YgRiQzfHwiZGVmYXVsdCIhPT1uLmV4cG9ydE1vZGUsbD1uLmdldEltcG9ydFBhdGgoaSk7cy5zZXQobix7YXNzZXJ0aW9uczpuIGluc3RhbmNlb2YgRiQzP24uZ2V0SW1wb3J0QXNzZXJ0aW9ucyh0aGlzLnNuaXBwZXRzKTpudWxsLGRlZmF1bHRWYXJpYWJsZU5hbWU6bi5kZWZhdWx0VmFyaWFibGVOYW1lLGdsb2JhbE5hbWU6biBpbnN0YW5jZW9mIEYkMyYmKCJ1bWQiPT09dGhpcy5vdXRwdXRPcHRpb25zLmZvcm1hdHx8ImlpZmUiPT09dGhpcy5vdXRwdXRPcHRpb25zLmZvcm1hdCkmJlJhKG4sdGhpcy5vdXRwdXRPcHRpb25zLmdsb2JhbHMsbnVsbCE9PShyfHxvKSx0aGlzLmlucHV0T3B0aW9ucy5vbkxvZyksaW1wb3J0UGF0aDpsLGltcG9ydHM6cixpc0NodW5rOm4gaW5zdGFuY2VvZiBNYSxuYW1lOm4udmFyaWFibGVOYW1lLG5hbWVkRXhwb3J0c01vZGU6YSxuYW1lc3BhY2VWYXJpYWJsZU5hbWU6bi5uYW1lc3BhY2VWYXJpYWJsZU5hbWUscmVleHBvcnRzOm99KTt9cmV0dXJuIHRoaXMucmVuZGVyZWREZXBlbmRlbmNpZXM9c31pbmxpbmVDaHVua0RlcGVuZGVuY2llcyhlKXtmb3IoY29uc3QgdCBvZiBlLmRlcGVuZGVuY2llcyl0aGlzLmRlcGVuZGVuY2llcy5oYXModCl8fCh0aGlzLmRlcGVuZGVuY2llcy5hZGQodCksdCBpbnN0YW5jZW9mIE1hJiZ0aGlzLmlubGluZUNodW5rRGVwZW5kZW5jaWVzKHQpKTt9cmVuZGVyTW9kdWxlcyhlKXtjb25zdHthY2Nlc3NlZEdsb2JhbHNCeVNjb3BlOnQsZGVwZW5kZW5jaWVzOnMsZXhwb3J0TmFtZXNCeVZhcmlhYmxlOmksaW5jbHVkZWROYW1lc3BhY2VzOm4saW5wdXRPcHRpb25zOntvbkxvZzpyfSxpc0VtcHR5Om8sb3JkZXJlZE1vZHVsZXM6YSxvdXRwdXRPcHRpb25zOmgscGx1Z2luRHJpdmVyOnAscmVuZGVyZWRNb2R1bGVzOm0sc25pcHBldHM6Z309dGhpcyx7Y29tcGFjdDpFLGR5bmFtaWNJbXBvcnRGdW5jdGlvbjpiLGZvcm1hdDp2LGZyZWV6ZTpTLG5hbWVzcGFjZVRvU3RyaW5nVGFnOkF9PWgse186ayxjbnN0Okksbjp3fT1nO3RoaXMuc2V0RHluYW1pY0ltcG9ydFJlc29sdXRpb25zKGUpLHRoaXMuc2V0SW1wb3J0TWV0YVJlc29sdXRpb25zKGUpLHRoaXMuc2V0SWRlbnRpZmllclJlbmRlclJlc29sdXRpb25zKCk7Y29uc3QgUD1uZXcgY2xhc3MgZXtjb25zdHJ1Y3RvcihlPXt9KXt0aGlzLmludHJvPWUuaW50cm98fCIiLHRoaXMuc2VwYXJhdG9yPXZvaWQgMCE9PWUuc2VwYXJhdG9yP2Uuc2VwYXJhdG9yOiJcbiIsdGhpcy5zb3VyY2VzPVtdLHRoaXMudW5pcXVlU291cmNlcz1bXSx0aGlzLnVuaXF1ZVNvdXJjZUluZGV4QnlGaWxlbmFtZT17fTt9YWRkU291cmNlKGUpe2lmKGUgaW5zdGFuY2VvZiB5KXJldHVybiB0aGlzLmFkZFNvdXJjZSh7Y29udGVudDplLGZpbGVuYW1lOmUuZmlsZW5hbWUsc2VwYXJhdG9yOnRoaXMuc2VwYXJhdG9yfSk7aWYoIXUoZSl8fCFlLmNvbnRlbnQpdGhyb3cgbmV3IEVycm9yKCJidW5kbGUuYWRkU291cmNlKCkgdGFrZXMgYW4gb2JqZWN0IHdpdGggYSBgY29udGVudGAgcHJvcGVydHksIHdoaWNoIHNob3VsZCBiZSBhbiBpbnN0YW5jZSBvZiBNYWdpY1N0cmluZywgYW5kIGFuIG9wdGlvbmFsIGBmaWxlbmFtZWAiKTtpZihbImZpbGVuYW1lIiwiaWdub3JlTGlzdCIsImluZGVudEV4Y2x1c2lvblJhbmdlcyIsInNlcGFyYXRvciJdLmZvckVhY2goKHQ9Pnt4LmNhbGwoZSx0KXx8KGVbdF09ZS5jb250ZW50W3RdKTt9KSksdm9pZCAwPT09ZS5zZXBhcmF0b3ImJihlLnNlcGFyYXRvcj10aGlzLnNlcGFyYXRvciksZS5maWxlbmFtZSlpZih4LmNhbGwodGhpcy51bmlxdWVTb3VyY2VJbmRleEJ5RmlsZW5hbWUsZS5maWxlbmFtZSkpe2NvbnN0IHQ9dGhpcy51bmlxdWVTb3VyY2VzW3RoaXMudW5pcXVlU291cmNlSW5kZXhCeUZpbGVuYW1lW2UuZmlsZW5hbWVdXTtpZihlLmNvbnRlbnQub3JpZ2luYWwhPT10LmNvbnRlbnQpdGhyb3cgbmV3IEVycm9yKGBJbGxlZ2FsIHNvdXJjZTogc2FtZSBmaWxlbmFtZSAoJHtlLmZpbGVuYW1lfSksIGRpZmZlcmVudCBjb250ZW50c2ApfWVsc2UgdGhpcy51bmlxdWVTb3VyY2VJbmRleEJ5RmlsZW5hbWVbZS5maWxlbmFtZV09dGhpcy51bmlxdWVTb3VyY2VzLmxlbmd0aCx0aGlzLnVuaXF1ZVNvdXJjZXMucHVzaCh7ZmlsZW5hbWU6ZS5maWxlbmFtZSxjb250ZW50OmUuY29udGVudC5vcmlnaW5hbH0pO3JldHVybiB0aGlzLnNvdXJjZXMucHVzaChlKSx0aGlzfWFwcGVuZChlLHQpe3JldHVybiB0aGlzLmFkZFNvdXJjZSh7Y29udGVudDpuZXcgeShlKSxzZXBhcmF0b3I6dCYmdC5zZXBhcmF0b3J8fCIifSksdGhpc31jbG9uZSgpe2NvbnN0IHQ9bmV3IGUoe2ludHJvOnRoaXMuaW50cm8sc2VwYXJhdG9yOnRoaXMuc2VwYXJhdG9yfSk7cmV0dXJuIHRoaXMuc291cmNlcy5mb3JFYWNoKChlPT57dC5hZGRTb3VyY2Uoe2ZpbGVuYW1lOmUuZmlsZW5hbWUsY29udGVudDplLmNvbnRlbnQuY2xvbmUoKSxzZXBhcmF0b3I6ZS5zZXBhcmF0b3J9KTt9KSksdH1nZW5lcmF0ZURlY29kZWRNYXAoZT17fSl7Y29uc3QgdD1bXTtsZXQgczt0aGlzLnNvdXJjZXMuZm9yRWFjaCgoZT0+e09iamVjdC5rZXlzKGUuY29udGVudC5zdG9yZWROYW1lcykuZm9yRWFjaCgoZT0+e350LmluZGV4T2YoZSl8fHQucHVzaChlKTt9KSk7fSkpO2NvbnN0IGk9bmV3IGYoZS5oaXJlcyk7cmV0dXJuIHRoaXMuaW50cm8mJmkuYWR2YW5jZSh0aGlzLmludHJvKSx0aGlzLnNvdXJjZXMuZm9yRWFjaCgoKGUsbik9PntuPjAmJmkuYWR2YW5jZSh0aGlzLnNlcGFyYXRvcik7Y29uc3Qgcj1lLmZpbGVuYW1lP3RoaXMudW5pcXVlU291cmNlSW5kZXhCeUZpbGVuYW1lW2UuZmlsZW5hbWVdOi0xLG89ZS5jb250ZW50LGE9ZChvLm9yaWdpbmFsKTtvLmludHJvJiZpLmFkdmFuY2Uoby5pbnRybyksby5maXJzdENodW5rLmVhY2hOZXh0KChzPT57Y29uc3Qgbj1hKHMuc3RhcnQpO3MuaW50cm8ubGVuZ3RoJiZpLmFkdmFuY2Uocy5pbnRybyksZS5maWxlbmFtZT9zLmVkaXRlZD9pLmFkZEVkaXQocixzLmNvbnRlbnQsbixzLnN0b3JlTmFtZT90LmluZGV4T2Yocy5vcmlnaW5hbCk6LTEpOmkuYWRkVW5lZGl0ZWRDaHVuayhyLHMsby5vcmlnaW5hbCxuLG8uc291cmNlbWFwTG9jYXRpb25zKTppLmFkdmFuY2Uocy5jb250ZW50KSxzLm91dHJvLmxlbmd0aCYmaS5hZHZhbmNlKHMub3V0cm8pO30pKSxvLm91dHJvJiZpLmFkdmFuY2Uoby5vdXRybyksZS5pZ25vcmVMaXN0JiYtMSE9PXImJih2b2lkIDA9PT1zJiYocz1bXSkscy5wdXNoKHIpKTt9KSkse2ZpbGU6ZS5maWxlP2UuZmlsZS5zcGxpdCgvWy9cXF0vKS5wb3AoKTp2b2lkIDAsc291cmNlczp0aGlzLnVuaXF1ZVNvdXJjZXMubWFwKCh0PT5lLmZpbGU/YyhlLmZpbGUsdC5maWxlbmFtZSk6dC5maWxlbmFtZSkpLHNvdXJjZXNDb250ZW50OnRoaXMudW5pcXVlU291cmNlcy5tYXAoKHQ9PmUuaW5jbHVkZUNvbnRlbnQ/dC5jb250ZW50Om51bGwpKSxuYW1lczp0LG1hcHBpbmdzOmkucmF3LHhfZ29vZ2xlX2lnbm9yZUxpc3Q6c319Z2VuZXJhdGVNYXAoZSl7cmV0dXJuIG5ldyBsKHRoaXMuZ2VuZXJhdGVEZWNvZGVkTWFwKGUpKX1nZXRJbmRlbnRTdHJpbmcoKXtjb25zdCBlPXt9O3JldHVybiB0aGlzLnNvdXJjZXMuZm9yRWFjaCgodD0+e2NvbnN0IHM9dC5jb250ZW50Ll9nZXRSYXdJbmRlbnRTdHJpbmcoKTtudWxsIT09cyYmKGVbc118fChlW3NdPTApLGVbc10rPTEpO30pKSxPYmplY3Qua2V5cyhlKS5zb3J0KCgodCxzKT0+ZVt0XS1lW3NdKSlbMF18fCJcdCJ9aW5kZW50KGUpe2lmKGFyZ3VtZW50cy5sZW5ndGh8fChlPXRoaXMuZ2V0SW5kZW50U3RyaW5nKCkpLCIiPT09ZSlyZXR1cm4gdGhpcztsZXQgdD0hdGhpcy5pbnRyb3x8IlxuIj09PXRoaXMuaW50cm8uc2xpY2UoLTEpO3JldHVybiB0aGlzLnNvdXJjZXMuZm9yRWFjaCgoKHMsaSk9Pntjb25zdCBuPXZvaWQgMCE9PXMuc2VwYXJhdG9yP3Muc2VwYXJhdG9yOnRoaXMuc2VwYXJhdG9yLHI9dHx8aT4wJiYvXHI/XG4kLy50ZXN0KG4pO3MuY29udGVudC5pbmRlbnQoZSx7ZXhjbHVkZTpzLmluZGVudEV4Y2x1c2lvblJhbmdlcyxpbmRlbnRTdGFydDpyfSksdD0iXG4iPT09cy5jb250ZW50Lmxhc3RDaGFyKCk7fSkpLHRoaXMuaW50cm8mJih0aGlzLmludHJvPWUrdGhpcy5pbnRyby5yZXBsYWNlKC9eW15cbl0vZ20sKCh0LHMpPT5zPjA/ZSt0OnQpKSksdGhpc31wcmVwZW5kKGUpe3JldHVybiB0aGlzLmludHJvPWUrdGhpcy5pbnRybyx0aGlzfXRvU3RyaW5nKCl7Y29uc3QgZT10aGlzLnNvdXJjZXMubWFwKCgoZSx0KT0+e2NvbnN0IHM9dm9pZCAwIT09ZS5zZXBhcmF0b3I/ZS5zZXBhcmF0b3I6dGhpcy5zZXBhcmF0b3I7cmV0dXJuICh0PjA/czoiIikrZS5jb250ZW50LnRvU3RyaW5nKCl9KSkuam9pbigiIik7cmV0dXJuIHRoaXMuaW50cm8rZX1pc0VtcHR5KCl7cmV0dXJuICEodGhpcy5pbnRyby5sZW5ndGgmJnRoaXMuaW50cm8udHJpbSgpfHx0aGlzLnNvdXJjZXMuc29tZSgoZT0+IWUuY29udGVudC5pc0VtcHR5KCkpKSl9bGVuZ3RoKCl7cmV0dXJuIHRoaXMuc291cmNlcy5yZWR1Y2UoKChlLHQpPT5lK3QuY29udGVudC5sZW5ndGgoKSksdGhpcy5pbnRyby5sZW5ndGgpfXRyaW1MaW5lcygpe3JldHVybiB0aGlzLnRyaW0oIltcXHJcXG5dIil9dHJpbShlKXtyZXR1cm4gdGhpcy50cmltU3RhcnQoZSkudHJpbUVuZChlKX10cmltU3RhcnQoZSl7Y29uc3QgdD1uZXcgUmVnRXhwKCJeIisoZXx8IlxccyIpKyIrIik7aWYodGhpcy5pbnRybz10aGlzLmludHJvLnJlcGxhY2UodCwiIiksIXRoaXMuaW50cm8pe2xldCB0LHM9MDtkb3tpZih0PXRoaXMuc291cmNlc1tzKytdLCF0KWJyZWFrfXdoaWxlKCF0LmNvbnRlbnQudHJpbVN0YXJ0QWJvcnRlZChlKSl9cmV0dXJuIHRoaXN9dHJpbUVuZChlKXtjb25zdCB0PW5ldyBSZWdFeHAoKGV8fCJcXHMiKSsiKyQiKTtsZXQgcyxpPXRoaXMuc291cmNlcy5sZW5ndGgtMTtkb3tpZihzPXRoaXMuc291cmNlc1tpLS1dLCFzKXt0aGlzLmludHJvPXRoaXMuaW50cm8ucmVwbGFjZSh0LCIiKTticmVha319d2hpbGUoIXMuY29udGVudC50cmltRW5kQWJvcnRlZChlKSk7cmV0dXJuIHRoaXN9fSh7c2VwYXJhdG9yOmAke3d9JHt3fWB9KSxDPWZ1bmN0aW9uKGUsdCl7aWYoITAhPT10LmluZGVudClyZXR1cm4gdC5pbmRlbnQ7Zm9yKGNvbnN0IHQgb2YgZSl7Y29uc3QgZT1FYSh0Lm9yaWdpbmFsQ29kZSk7aWYobnVsbCE9PWUpcmV0dXJuIGV9cmV0dXJuICJcdCJ9KGEsaCksJD1bXTtsZXQgTj0iIjtjb25zdCBfPW5ldyBTZXQsUj1uZXcgTWFwLE09e2R5bmFtaWNJbXBvcnRGdW5jdGlvbjpiLGV4cG9ydE5hbWVzQnlWYXJpYWJsZTppLGZvcm1hdDp2LGZyZWV6ZTpTLGluZGVudDpDLG5hbWVzcGFjZVRvU3RyaW5nVGFnOkEscGx1Z2luRHJpdmVyOnAsc25pcHBldHM6Zyx1c2VPcmlnaW5hbE5hbWU6bnVsbH07bGV0IE89ITE7Zm9yKGNvbnN0IGUgb2YgYSl7bGV0IHMsaT0wO2lmKGUuaXNJbmNsdWRlZCgpfHxuLmhhcyhlKSl7Y29uc3Qgcj1lLnJlbmRlcihNKTsoKHtzb3VyY2U6c309cikpLE98fChPPXIudXNlc1RvcExldmVsQXdhaXQpLGk9cy5sZW5ndGgoKSxpJiYoRSYmcy5sYXN0TGluZSgpLmluY2x1ZGVzKCIvLyIpJiZzLmFwcGVuZCgiXG4iKSxSLnNldChlLHMpLFAuYWRkU291cmNlKHMpLCQucHVzaChlKSk7Y29uc3Qgbz1lLm5hbWVzcGFjZTtpZihuLmhhcyhlKSl7Y29uc3QgZT1vLnJlbmRlckJsb2NrKE0pO28ucmVuZGVyRmlyc3QoKT9OKz13K2U6UC5hZGRTb3VyY2UobmV3IHkoZSkpO31jb25zdCBhPXQuZ2V0KGUuc2NvcGUpO2lmKGEpZm9yKGNvbnN0IGUgb2YgYSlfLmFkZChlKTt9Y29uc3R7cmVuZGVyZWRFeHBvcnRzOnIscmVtb3ZlZEV4cG9ydHM6b309ZS5nZXRSZW5kZXJlZEV4cG9ydHMoKTttW2UuaWRdPXtnZXQgY29kZSgpe3JldHVybiBzPy50b1N0cmluZygpPz9udWxsfSxvcmlnaW5hbExlbmd0aDplLm9yaWdpbmFsQ29kZS5sZW5ndGgscmVtb3ZlZEV4cG9ydHM6byxyZW5kZXJlZEV4cG9ydHM6cixyZW5kZXJlZExlbmd0aDppfTt9TiYmUC5wcmVwZW5kKE4rdyt3KSx0aGlzLm5lZWRzRXhwb3J0c1NoaW0mJlAucHJlcGVuZChgJHt3fSR7SX0gJHtwb30ke2t9PSR7a312b2lkIDA7JHt3fSR7d31gKTtjb25zdCBEPUU/UDpQLnRyaW0oKTt2YXIgTDtyZXR1cm4gbyYmMD09PXRoaXMuZ2V0RXhwb3J0TmFtZXMoKS5sZW5ndGgmJjA9PT1zLnNpemUmJnIoU2Use2NvZGU6IkVNUFRZX0JVTkRMRSIsbWVzc2FnZTpgR2VuZXJhdGVkIGFuIGVtcHR5IGNodW5rOiAiJHtMPXRoaXMuZ2V0Q2h1bmtOYW1lKCl9Ii5gLG5hbWVzOltMXX0pLHthY2Nlc3NlZEdsb2JhbHM6XyxpbmRlbnQ6QyxtYWdpY1N0cmluZzpQLHJlbmRlcmVkU291cmNlOkQsdXNlZE1vZHVsZXM6JCx1c2VzVG9wTGV2ZWxBd2FpdDpPfX1zZXREeW5hbWljSW1wb3J0UmVzb2x1dGlvbnMoZSl7Y29uc3R7YWNjZXNzZWRHbG9iYWxzQnlTY29wZTp0LG91dHB1dE9wdGlvbnM6cyxwbHVnaW5Ecml2ZXI6aSxzbmlwcGV0czpufT10aGlzO2Zvcihjb25zdCByIG9mIHRoaXMuZ2V0SW5jbHVkZWREeW5hbWljSW1wb3J0cygpKWlmKHIuY2h1bmspe2NvbnN0e2NodW5rOm8sZmFjYWRlQ2h1bms6YSxub2RlOmwscmVzb2x1dGlvbjpjfT1yO289PT10aGlzP2wuc2V0SW50ZXJuYWxSZXNvbHV0aW9uKGMubmFtZXNwYWNlKTpsLnNldEV4dGVybmFsUmVzb2x1dGlvbigoYXx8bykuZXhwb3J0TW9kZSxjLHMsbixpLHQsYCckeyhhfHxvKS5nZXRJbXBvcnRQYXRoKGUpfSdgLCFhPy5zdHJpY3RGYWNhZGUmJm8uZXhwb3J0TmFtZXNCeVZhcmlhYmxlLmdldChjLm5hbWVzcGFjZSlbMF0sbnVsbCk7fWVsc2Uge2NvbnN0e25vZGU6byxyZXNvbHV0aW9uOmF9PXIsW2wsY109dGhpcy5nZXREeW5hbWljSW1wb3J0U3RyaW5nQW5kQXNzZXJ0aW9ucyhhLGUpO28uc2V0RXh0ZXJuYWxSZXNvbHV0aW9uKCJleHRlcm5hbCIsYSxzLG4saSx0LGwsITEsYyk7fX1zZXRJZGVudGlmaWVyUmVuZGVyUmVzb2x1dGlvbnMoKXtjb25zdHtmb3JtYXQ6ZSxpbnRlcm9wOnQsbmFtZXNwYWNlVG9TdHJpbmdUYWc6cyxwcmVzZXJ2ZU1vZHVsZXM6aSxleHRlcm5hbExpdmVCaW5kaW5nczpufT10aGlzLm91dHB1dE9wdGlvbnMscj1uZXcgU2V0O2Zvcihjb25zdCB0IG9mIHRoaXMuZ2V0RXhwb3J0TmFtZXMoKSl7Y29uc3Qgcz10aGlzLmV4cG9ydHNCeU5hbWUuZ2V0KHQpOyJlcyIhPT1lJiYic3lzdGVtIiE9PWUmJnMuaXNSZWFzc2lnbmVkJiYhcy5pc0lkP3Muc2V0UmVuZGVyTmFtZXMoImV4cG9ydHMiLHQpOnMgaW5zdGFuY2VvZiBnbz9yLmFkZChzKTpzLnNldFJlbmRlck5hbWVzKG51bGwsbnVsbCk7fWZvcihjb25zdCBlIG9mIHRoaXMub3JkZXJlZE1vZHVsZXMpaWYoZS5uZWVkc0V4cG9ydFNoaW0pe3RoaXMubmVlZHNFeHBvcnRzU2hpbT0hMDticmVha31jb25zdCBvPW5ldyBTZXQoWyJPYmplY3QiLCJQcm9taXNlIl0pO3N3aXRjaCh0aGlzLm5lZWRzRXhwb3J0c1NoaW0mJm8uYWRkKHBvKSxzJiZvLmFkZCgiU3ltYm9sIiksZSl7Y2FzZSJzeXN0ZW0iOm8uYWRkKCJtb2R1bGUiKS5hZGQoImV4cG9ydHMiKTticmVhaztjYXNlImVzIjpicmVhaztjYXNlImNqcyI6by5hZGQoIm1vZHVsZSIpLmFkZCgicmVxdWlyZSIpLmFkZCgiX19maWxlbmFtZSIpLmFkZCgiX19kaXJuYW1lIik7ZGVmYXVsdDpvLmFkZCgiZXhwb3J0cyIpO2Zvcihjb25zdCBlIG9mIFRyKW8uYWRkKGUpO31tYSh0aGlzLm9yZGVyZWRNb2R1bGVzLHRoaXMuZ2V0RGVwZW5kZW5jaWVzVG9CZURlY29uZmxpY3RlZCgiZXMiIT09ZSYmInN5c3RlbSIhPT1lLCJhbWQiPT09ZXx8InVtZCI9PT1lfHwiaWlmZSI9PT1lLHQpLHRoaXMuaW1wb3J0cyxvLGUsdCxpLG4sdGhpcy5jaHVua0J5TW9kdWxlLHRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLHIsdGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGUsdGhpcy5hY2Nlc3NlZEdsb2JhbHNCeVNjb3BlLHRoaXMuaW5jbHVkZWROYW1lc3BhY2VzKTt9c2V0SW1wb3J0TWV0YVJlc29sdXRpb25zKGUpe2NvbnN0e2FjY2Vzc2VkR2xvYmFsc0J5U2NvcGU6dCxpbmNsdWRlZE5hbWVzcGFjZXM6cyxvcmRlcmVkTW9kdWxlczppLG91dHB1dE9wdGlvbnM6e2Zvcm1hdDpufX09dGhpcztmb3IoY29uc3QgciBvZiBpKXtmb3IoY29uc3QgcyBvZiByLmltcG9ydE1ldGFzKXMuc2V0UmVzb2x1dGlvbihuLHQsZSk7cy5oYXMocikmJnIubmFtZXNwYWNlLnByZXBhcmUodCk7fX1zZXRVcENodW5rSW1wb3J0c0FuZEV4cG9ydHNGb3JNb2R1bGUoZSl7Y29uc3QgdD1uZXcgU2V0KGUuaW5jbHVkZWRJbXBvcnRzKTtpZighdGhpcy5vdXRwdXRPcHRpb25zLnByZXNlcnZlTW9kdWxlcyYmdGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMuaGFzKGUpKXtjb25zdCBzPWUubmFtZXNwYWNlLmdldE1lbWJlclZhcmlhYmxlcygpO2Zvcihjb25zdCBlIG9mIE9iamVjdC52YWx1ZXMocykpZS5pbmNsdWRlZCYmdC5hZGQoZSk7fWZvcihsZXQgcyBvZiB0KXtzIGluc3RhbmNlb2YgYW8mJihzPXMuZ2V0T3JpZ2luYWxWYXJpYWJsZSgpKSxzIGluc3RhbmNlb2YgZ28mJihzPXMuZ2V0QmFzZVZhcmlhYmxlKCkpO2NvbnN0IHQ9dGhpcy5jaHVua0J5TW9kdWxlLmdldChzLm1vZHVsZSk7dCE9PXRoaXMmJih0aGlzLmltcG9ydHMuYWRkKHMpLHMubW9kdWxlIGluc3RhbmNlb2YgQm8mJih0aGlzLmNoZWNrQ2lyY3VsYXJEZXBlbmRlbmN5SW1wb3J0KHMsZSkscyBpbnN0YW5jZW9mIG1vJiZ0aGlzLm91dHB1dE9wdGlvbnMucHJlc2VydmVNb2R1bGVzfHx0LmV4cG9ydHMuYWRkKHMpKSk7fSh0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcy5oYXMoZSl8fGUuaW5mby5pc0VudHJ5JiYhMSE9PWUucHJlc2VydmVTaWduYXR1cmV8fGUuaW5jbHVkZWREeW5hbWljSW1wb3J0ZXJzLnNvbWUoKGU9PnRoaXMuY2h1bmtCeU1vZHVsZS5nZXQoZSkhPT10aGlzKSkpJiZ0aGlzLmVuc3VyZVJlZXhwb3J0c0FyZUF2YWlsYWJsZUZvck1vZHVsZShlKTtmb3IoY29uc3R7bm9kZTp0LHJlc29sdXRpb246c31vZiBlLmR5bmFtaWNJbXBvcnRzKXQuaW5jbHVkZWQmJnMgaW5zdGFuY2VvZiBCbyYmdGhpcy5jaHVua0J5TW9kdWxlLmdldChzKT09PXRoaXMmJiF0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcy5oYXMocykmJih0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcy5hZGQocyksdGhpcy5lbnN1cmVSZWV4cG9ydHNBcmVBdmFpbGFibGVGb3JNb2R1bGUocykpO319ZnVuY3Rpb24gT2EoZSl7cmV0dXJuIERhKGUpPz9MKGUuaWQpfWZ1bmN0aW9uIERhKGUpe3JldHVybiBlLmNodW5rTmFtZXMuZmluZCgoKHtpc1VzZXJEZWZpbmVkOmV9KT0+ZSkpPy5uYW1lPz9lLmNodW5rTmFtZXNbMF0/Lm5hbWV9ZnVuY3Rpb24gTGEoZSx0KXtjb25zdCBzPXt9O2Zvcihjb25zdFtpLG5db2YgZSl7Y29uc3QgZT1uZXcgU2V0O2lmKG4uaW1wb3J0cylmb3IoY29uc3R7aW1wb3J0ZWQ6dH1vZiBuLmltcG9ydHMpZS5hZGQodCk7aWYobi5yZWV4cG9ydHMpZm9yKGNvbnN0e2ltcG9ydGVkOnR9b2Ygbi5yZWV4cG9ydHMpZS5hZGQodCk7c1t0KGkpXT1bLi4uZV07fXJldHVybiBzfWNvbnN0IFRhPS9bIz9dLyxWYT1lPT5lLmdldEZpbGVOYW1lKCk7ZnVuY3Rpb24qQmEoZSl7Zm9yKGNvbnN0IHQgb2YgZSl5aWVsZCp0O31mdW5jdGlvbiB6YShlLHQscyxpKXtjb25zdHtjaHVua0RlZmluaXRpb25zOm4sbW9kdWxlc0luTWFudWFsQ2h1bmtzOnJ9PWZ1bmN0aW9uKGUpe2NvbnN0IHQ9W10scz1uZXcgU2V0KGUua2V5cygpKSxpPU9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGNvbnN0W3Qsbl1vZiBlKUZhKHQsaVtuXXx8KGlbbl09W10pLHMpO2Zvcihjb25zdFtlLHNdb2YgT2JqZWN0LmVudHJpZXMoaSkpdC5wdXNoKHthbGlhczplLG1vZHVsZXM6c30pO3JldHVybiB7Y2h1bmtEZWZpbml0aW9uczp0LG1vZHVsZXNJbk1hbnVhbENodW5rczpzfX0odCkse2FsbEVudHJpZXM6byxkZXBlbmRlbnRFbnRyaWVzQnlNb2R1bGU6YSxkeW5hbWljYWxseURlcGVuZGVudEVudHJpZXNCeUR5bmFtaWNFbnRyeTpsLGR5bmFtaWNJbXBvcnRzQnlFbnRyeTpjfT1mdW5jdGlvbihlKXtjb25zdCB0PW5ldyBTZXQscz1uZXcgTWFwLGk9W10sbj1uZXcgU2V0KGUpO2xldCByPTA7Zm9yKGNvbnN0IGUgb2Ygbil7Y29uc3Qgbz1uZXcgU2V0O2kucHVzaChvKTtjb25zdCBhPW5ldyBTZXQoW2VdKTtmb3IoY29uc3QgZSBvZiBhKXtqKHMsZSxVJDIpLmFkZChyKTtmb3IoY29uc3QgdCBvZiBlLmdldERlcGVuZGVuY2llc1RvQmVJbmNsdWRlZCgpKXQgaW5zdGFuY2VvZiBadHx8YS5hZGQodCk7Zm9yKGNvbnN0e3Jlc29sdXRpb246c31vZiBlLmR5bmFtaWNJbXBvcnRzKXMgaW5zdGFuY2VvZiBCbyYmcy5pbmNsdWRlZER5bmFtaWNJbXBvcnRlcnMubGVuZ3RoPjAmJiFuLmhhcyhzKSYmKHQuYWRkKHMpLG4uYWRkKHMpLG8uYWRkKHMpKTtmb3IoY29uc3QgcyBvZiBlLmltcGxpY2l0bHlMb2FkZWRCZWZvcmUpbi5oYXMocyl8fCh0LmFkZChzKSxuLmFkZChzKSk7fXIrKzt9Y29uc3Qgbz1bLi4ubl0se2R5bmFtaWNFbnRyaWVzOmEsZHluYW1pY0ltcG9ydHNCeUVudHJ5Omx9PWZ1bmN0aW9uKGUsdCxzKXtjb25zdCBpPW5ldyBNYXAsbj1uZXcgU2V0O2Zvcihjb25zdFtzLHJdb2YgZS5lbnRyaWVzKCkpaS5zZXQocixzKSx0LmhhcyhyKSYmbi5hZGQocyk7Y29uc3Qgcj1bXTtmb3IoY29uc3QgZSBvZiBzKXtjb25zdCB0PW5ldyBTZXQ7Zm9yKGNvbnN0IHMgb2YgZSl0LmFkZChpLmdldChzKSk7ci5wdXNoKHQpO31yZXR1cm4ge2R5bmFtaWNFbnRyaWVzOm4sZHluYW1pY0ltcG9ydHNCeUVudHJ5OnJ9fShvLHQsaSk7cmV0dXJuIHthbGxFbnRyaWVzOm8sZGVwZW5kZW50RW50cmllc0J5TW9kdWxlOnMsZHluYW1pY2FsbHlEZXBlbmRlbnRFbnRyaWVzQnlEeW5hbWljRW50cnk6amEocyxhLG8pLGR5bmFtaWNJbXBvcnRzQnlFbnRyeTpsfX0oZSksaD1VYShmdW5jdGlvbiooZSx0KXtmb3IoY29uc3RbcyxpXW9mIGUpdC5oYXMocyl8fCh5aWVsZCB7ZGVwZW5kZW50RW50cmllczppLG1vZHVsZXM6W3NdfSk7fShhLHIpKTtyZXR1cm4gZnVuY3Rpb24oZSx0LHMsaSl7Y29uc3Qgbj1pLm1hcCgoKCk9PjBuKSkscj1pLm1hcCgoKGUscyk9PnQuaGFzKHMpPy0xbjowbikpO2xldCBvPTFuO2Zvcihjb25zdHtkZXBlbmRlbnRFbnRyaWVzOnR9b2YgZSl7Zm9yKGNvbnN0IGUgb2YgdCluW2VdfD1vO288PD0xbjt9Y29uc3QgYT10O2Zvcihjb25zdFtlLHRdb2YgYSl7YS5kZWxldGUoZSk7Y29uc3QgaT1yW2VdO2xldCBvPWk7Zm9yKGNvbnN0IGUgb2YgdClvJj1uW2VdfHJbZV07aWYobyE9PWkpe3JbZV09bztmb3IoY29uc3QgdCBvZiBzW2VdKWooYSx0LFUkMikuYWRkKGUpO319bz0xbjtmb3IoY29uc3R7ZGVwZW5kZW50RW50cmllczp0fW9mIGUpe2Zvcihjb25zdCBlIG9mIHQpKHJbZV0mbyk9PT1vJiZ0LmRlbGV0ZShlKTtvPDw9MW47fX0oaCxsLGMsbyksbi5wdXNoKC4uLmZ1bmN0aW9uKGUsdCxzLGkpe19vKCJvcHRpbWl6ZSBjaHVua3MiLDMpO2NvbnN0IG49ZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9W10sbj1bXSxyPW5ldyBNYXAsbz1bXTtsZXQgYT0wbixsPTFuO2Zvcihjb25zdHtkZXBlbmRlbnRFbnRyaWVzOnQsbW9kdWxlczpjfW9mIGUpe2NvbnN0IGU9e2NvbnRhaW5lZEF0b21zOmwsY29ycmVsYXRlZEF0b21zOjBuLGRlcGVuZGVuY2llczpuZXcgU2V0LGRlcGVuZGVudENodW5rczpuZXcgU2V0LGRlcGVuZGVudEVudHJpZXM6dCxtb2R1bGVzOmMscHVyZTohMCxzaXplOjB9O2xldCBoPTAsdT0hMDtmb3IoY29uc3QgdCBvZiBjKXIuc2V0KHQsZSksdC5pc0luY2x1ZGVkKCkmJih1JiYodT0hdC5oYXNFZmZlY3RzKCkpLGgrPXM+MT90LmVzdGltYXRlU2l6ZSgpOjEpO2UucHVyZT11LGUuc2l6ZT1oLG8ucHVzaChoKSx1fHwoYXw9bCksKGg8cz9pOm4pLnB1c2goZSksbDw8PTFuO31pZigwPT09aS5sZW5ndGgpcmV0dXJuIG51bGw7cmV0dXJuIGF8PWZ1bmN0aW9uKGUsdCxzLGkpe2NvbnN0IG49bmV3IE1hcDtsZXQgcj0wbjtjb25zdCBvPVtdO2ZvcihsZXQgZT0wO2U8cztlKyspby5wdXNoKDBuKTtmb3IoY29uc3QgcyBvZiBlKXtzLnNvcnQocWEpO2Zvcihjb25zdCBlIG9mIHMpe2NvbnN0e2RlcGVuZGVuY2llczpzLGRlcGVuZGVudEVudHJpZXM6YSxtb2R1bGVzOmx9PWU7Zm9yKGNvbnN0IG8gb2YgbClmb3IoY29uc3QgYSBvZiBvLmdldERlcGVuZGVuY2llc1RvQmVJbmNsdWRlZCgpKWlmKGEgaW5zdGFuY2VvZiBadClhLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMmJihlLmNvbnRhaW5lZEF0b21zfD1qKG4sYSwoKCk9Pntjb25zdCBlPWk7cmV0dXJuIGk8PD0xbixyfD1lLGV9KSkpO2Vsc2Uge2NvbnN0IGk9dC5nZXQoYSk7aSYmaSE9PWUmJihzLmFkZChpKSxpLmRlcGVuZGVudENodW5rcy5hZGQoZSkpO31jb25zdHtjb250YWluZWRBdG9tczpjfT1lO2Zvcihjb25zdCBlIG9mIGEpb1tlXXw9Yzt9fWZvcihjb25zdCB0IG9mIGUpZm9yKGNvbnN0IGUgb2YgdCl7Y29uc3R7ZGVwZW5kZW50RW50cmllczp0fT1lO2UuY29ycmVsYXRlZEF0b21zPS0xbjtmb3IoY29uc3QgcyBvZiB0KWUuY29ycmVsYXRlZEF0b21zJj1vW3NdO31yZXR1cm4gcn0oW24saV0scix0LGwpLHtiaWc6bmV3IFNldChuKSxzaWRlRWZmZWN0QXRvbXM6YSxzaXplQnlBdG9tOm8sc21hbGw6bmV3IFNldChpKX19KGUsdCxzKTtpZighbilyZXR1cm4gUm8oIm9wdGltaXplIGNodW5rcyIsMyksZTtyZXR1cm4gcz4xJiZpKCJpbmZvIixHdChlLmxlbmd0aCxuLnNtYWxsLnNpemUsIkluaXRpYWxseSIpKSxmdW5jdGlvbihlLHQpe2NvbnN0e3NtYWxsOnN9PWU7Zm9yKGNvbnN0IGkgb2Ygcyl7Y29uc3Qgbj1HYShpLGUsdDw9MT8xOjEvMCk7aWYobil7Y29uc3R7Y29udGFpbmVkQXRvbXM6cixjb3JyZWxhdGVkQXRvbXM6byxtb2R1bGVzOmEscHVyZTpsLHNpemU6Y309aTtzLmRlbGV0ZShpKSxXYShuLHQsZSkuZGVsZXRlKG4pLG4ubW9kdWxlcy5wdXNoKC4uLmEpLG4uc2l6ZSs9YyxuLnB1cmUmJihuLnB1cmU9bCk7Y29uc3R7ZGVwZW5kZW5jaWVzOmgsZGVwZW5kZW50Q2h1bmtzOnUsZGVwZW5kZW50RW50cmllczpkfT1uO24uY29ycmVsYXRlZEF0b21zJj1vLG4uY29udGFpbmVkQXRvbXN8PXI7Zm9yKGNvbnN0IGUgb2YgaS5kZXBlbmRlbnRFbnRyaWVzKWQuYWRkKGUpO2Zvcihjb25zdCBlIG9mIGkuZGVwZW5kZW5jaWVzKWguYWRkKGUpLGUuZGVwZW5kZW50Q2h1bmtzLmRlbGV0ZShpKSxlLmRlcGVuZGVudENodW5rcy5hZGQobik7Zm9yKGNvbnN0IGUgb2YgaS5kZXBlbmRlbnRDaHVua3MpdS5hZGQoZSksZS5kZXBlbmRlbmNpZXMuZGVsZXRlKGkpLGUuZGVwZW5kZW5jaWVzLmFkZChuKTtoLmRlbGV0ZShuKSx1LmRlbGV0ZShuKSxXYShuLHQsZSkuYWRkKG4pO319fShuLHMpLHM+MSYmaSgiaW5mbyIsR3Qobi5zbWFsbC5zaXplK24uYmlnLnNpemUsbi5zbWFsbC5zaXplLCJBZnRlciBtZXJnaW5nIGNodW5rcyIpKSxSbygib3B0aW1pemUgY2h1bmtzIiwzKSxbLi4ubi5zbWFsbCwuLi5uLmJpZ119KFVhKGgpLG8ubGVuZ3RoLHMsaSkubWFwKCgoe21vZHVsZXM6ZX0pPT4oe2FsaWFzOm51bGwsbW9kdWxlczplfSkpKSksbn1mdW5jdGlvbiBGYShlLHQscyl7Y29uc3QgaT1uZXcgU2V0KFtlXSk7Zm9yKGNvbnN0IGUgb2YgaSl7cy5hZGQoZSksdC5wdXNoKGUpO2Zvcihjb25zdCB0IG9mIGUuZGVwZW5kZW5jaWVzKXQgaW5zdGFuY2VvZiBadHx8cy5oYXModCl8fGkuYWRkKHQpO319ZnVuY3Rpb24gamEoZSx0LHMpe2NvbnN0IGk9bmV3IE1hcDtmb3IoY29uc3QgbiBvZiB0KXtjb25zdCB0PWooaSxuLFUkMikscj1zW25dO2Zvcihjb25zdCBzIG9mIEJhKFtyLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycyxyLmltcGxpY2l0bHlMb2FkZWRBZnRlcl0pKWZvcihjb25zdCBpIG9mIGUuZ2V0KHMpKXQuYWRkKGkpO31yZXR1cm4gaX1mdW5jdGlvbiBVYShlKXt2YXIgdDtjb25zdCBzPU9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGNvbnN0e2RlcGVuZGVudEVudHJpZXM6aSxtb2R1bGVzOm59b2YgZSl7bGV0IGU9MG47Zm9yKGNvbnN0IHQgb2YgaSllfD0xbjw8QmlnSW50KHQpOyhzW3Q9U3RyaW5nKGUpXXx8KHNbdF09e2RlcGVuZGVudEVudHJpZXM6bmV3IFNldChpKSxtb2R1bGVzOltdfSkpLm1vZHVsZXMucHVzaCguLi5uKTt9cmV0dXJuIE9iamVjdC52YWx1ZXMocyl9ZnVuY3Rpb24gR2EoZSx7YmlnOnQsc2lkZUVmZmVjdEF0b21zOnMsc2l6ZUJ5QXRvbTppLHNtYWxsOm59LHIpe2xldCBvPW51bGw7Zm9yKGNvbnN0IGEgb2YgQmEoW24sdF0pKXtpZihlPT09YSljb250aW51ZTtjb25zdCB0PUhhKGUsYSxyLHMsaSk7aWYodDxyKXtpZihvPWEsMD09PXQpYnJlYWs7cj10O319cmV0dXJuIG99ZnVuY3Rpb24gV2EoZSx0LHMpe3JldHVybiBlLnNpemU8dD9zLnNtYWxsOnMuYmlnfWZ1bmN0aW9uIHFhKHtzaXplOmV9LHtzaXplOnR9KXtyZXR1cm4gZS10fWZ1bmN0aW9uIEhhKGUsdCxzLGksbil7Y29uc3Qgcj1LYShlLHQscyxpLG4pO3JldHVybiByPHM/citLYSh0LGUscy1yLGksbik6MS8wfWZ1bmN0aW9uIEthKGUsdCxzLGksbil7Y29uc3R7Y29ycmVsYXRlZEF0b21zOnJ9PXQ7bGV0IG89ZS5jb250YWluZWRBdG9tcztjb25zdCBhPW8maTtpZigociZhKSE9PWEpcmV0dXJuIDEvMDtjb25zdCBsPW5ldyBTZXQoZS5kZXBlbmRlbmNpZXMpO2Zvcihjb25zdHtkZXBlbmRlbmNpZXM6ZSxjb250YWluZWRBdG9tczpzfW9mIGwpe298PXM7Y29uc3Qgbj1zJmk7aWYoKHImbikhPT1uKXJldHVybiAxLzA7Zm9yKGNvbnN0IHMgb2YgZSl7aWYocz09PXQpcmV0dXJuIDEvMDtsLmFkZChzKTt9fXJldHVybiBmdW5jdGlvbihlLHQscyl7bGV0IGk9MCxuPTAscj0xbjtjb25zdHtsZW5ndGg6b309cztmb3IoO248bztuKyspaWYoKGUmcik9PT1yJiYoaSs9c1tuXSkscjw8PTFuLGk+PXQpcmV0dXJuIDEvMDtyZXR1cm4gaX0obyZ+cixzLG4pfWNvbnN0IFlhPShlLHQpPT5lLmV4ZWNJbmRleD50LmV4ZWNJbmRleD8xOi0xO2Z1bmN0aW9uIFhhKGUsdCxzKXtjb25zdCBpPVN5bWJvbChlLmlkKSxuPVtlLmlkXTtsZXQgcj10O2ZvcihlLmN5Y2xlcy5hZGQoaSk7ciE9PWU7KXIuY3ljbGVzLmFkZChpKSxuLnB1c2goci5pZCkscj1zLmdldChyKTtyZXR1cm4gbi5wdXNoKG5bMF0pLG4ucmV2ZXJzZSgpLG59Y29uc3QgUWE9KGUsdCk9PnQ/YCgke2V9KWA6ZSxaYT0vXig/IVxkKVtcdyRdKyQvO2NsYXNzIEphe2NvbnN0cnVjdG9yKGUsdCl7dGhpcy5pc09yaWdpbmFsPSEwLHRoaXMuZmlsZW5hbWU9ZSx0aGlzLmNvbnRlbnQ9dDt9dHJhY2VTZWdtZW50KGUsdCxzKXtyZXR1cm4ge2NvbHVtbjp0LGxpbmU6ZSxuYW1lOnMsc291cmNlOnRoaXN9fX1jbGFzcyBlbHtjb25zdHJ1Y3RvcihlLHQpe3RoaXMuc291cmNlcz10LHRoaXMubmFtZXM9ZS5uYW1lcyx0aGlzLm1hcHBpbmdzPWUubWFwcGluZ3M7fXRyYWNlTWFwcGluZ3MoKXtjb25zdCBlPVtdLHQ9bmV3IE1hcCxzPVtdLGk9W10sbj1uZXcgTWFwLHI9W107Zm9yKGNvbnN0IG8gb2YgdGhpcy5tYXBwaW5ncyl7Y29uc3QgYT1bXTtmb3IoY29uc3QgciBvZiBvKXtpZigxPT09ci5sZW5ndGgpY29udGludWU7Y29uc3Qgbz10aGlzLnNvdXJjZXNbclsxXV07aWYoIW8pY29udGludWU7Y29uc3QgbD1vLnRyYWNlU2VnbWVudChyWzJdLHJbM10sNT09PXIubGVuZ3RoP3RoaXMubmFtZXNbcls0XV06IiIpO2lmKGwpe2NvbnN0e2NvbHVtbjpvLGxpbmU6YyxuYW1lOmgsc291cmNlOntjb250ZW50OnUsZmlsZW5hbWU6ZH19PWw7bGV0IHA9dC5nZXQoZCk7aWYodm9pZCAwPT09cClwPWUubGVuZ3RoLGUucHVzaChkKSx0LnNldChkLHApLHNbcF09dTtlbHNlIGlmKG51bGw9PXNbcF0pc1twXT11O2Vsc2UgaWYobnVsbCE9dSYmc1twXSE9PXUpcmV0dXJuIFhlKHF0KGQpKTtjb25zdCBmPVtyWzBdLHAsYyxvXTtpZihoKXtsZXQgZT1uLmdldChoKTt2b2lkIDA9PT1lJiYoZT1pLmxlbmd0aCxpLnB1c2goaCksbi5zZXQoaCxlKSksZls0XT1lO31hLnB1c2goZik7fX1yLnB1c2goYSk7fXJldHVybiB7bWFwcGluZ3M6cixuYW1lczppLHNvdXJjZXM6ZSxzb3VyY2VzQ29udGVudDpzfX10cmFjZVNlZ21lbnQoZSx0LHMpe2NvbnN0IGk9dGhpcy5tYXBwaW5nc1tlXTtpZighaSlyZXR1cm4gbnVsbDtsZXQgbj0wLHI9aS5sZW5ndGgtMTtmb3IoO248PXI7KXtjb25zdCBlPW4rcj4+MSxvPWlbZV07aWYob1swXT09PXR8fG49PT1yKXtpZigxPT1vLmxlbmd0aClyZXR1cm4gbnVsbDtjb25zdCBlPXRoaXMuc291cmNlc1tvWzFdXTtyZXR1cm4gZT9lLnRyYWNlU2VnbWVudChvWzJdLG9bM10sNT09PW8ubGVuZ3RoP3RoaXMubmFtZXNbb1s0XV06cyk6bnVsbH1vWzBdPnQ/cj1lLTE6bj1lKzE7fXJldHVybiBudWxsfX1mdW5jdGlvbiB0bChlKXtyZXR1cm4gZnVuY3Rpb24odCxzKXtyZXR1cm4gcy5taXNzaW5nPyhlKFNlLChpPXMucGx1Z2luLHtjb2RlOnd0LG1lc3NhZ2U6YFNvdXJjZW1hcCBpcyBsaWtlbHkgdG8gYmUgaW5jb3JyZWN0OiBhIHBsdWdpbiAoJHtpfSkgd2FzIHVzZWQgdG8gdHJhbnNmb3JtIGZpbGVzLCBidXQgZGlkbid0IGdlbmVyYXRlIGEgc291cmNlbWFwIGZvciB0aGUgdHJhbnNmb3JtYXRpb24uIENvbnN1bHQgdGhlIHBsdWdpbiBkb2N1bWVudGF0aW9uIGZvciBoZWxwYCxwbHVnaW46aSx1cmw6T2UoTGUpfSkpLG5ldyBlbCh7bWFwcGluZ3M6W10sbmFtZXM6W119LFt0XSkpOm5ldyBlbChzLFt0XSk7dmFyIGk7fX1mdW5jdGlvbiBzbChlLHQscyxpLG4pe2xldCByO2lmKHMpe2NvbnN0IHQ9cy5zb3VyY2VzLGk9cy5zb3VyY2VzQ29udGVudHx8W10sbj1DKGUpfHwiLiIsbz1zLnNvdXJjZVJvb3R8fCIuIixhPXQubWFwKCgoZSx0KT0+bmV3IEphKF8obixvLGUpLGlbdF0pKSk7cj1uZXcgZWwocyxhKTt9ZWxzZSByPW5ldyBKYShlLHQpO3JldHVybiBpLnJlZHVjZShuLHIpfXZhciBpbD17fSxubD1ybDtmdW5jdGlvbiBybChlLHQpe2lmKCFlKXRocm93IG5ldyBFcnJvcih0fHwiQXNzZXJ0aW9uIGZhaWxlZCIpfXJsLmVxdWFsPWZ1bmN0aW9uKGUsdCxzKXtpZihlIT10KXRocm93IG5ldyBFcnJvcihzfHwiQXNzZXJ0aW9uIGZhaWxlZDogIitlKyIgIT0gIit0KX07dmFyIG9sPXtleHBvcnRzOnt9fTsiZnVuY3Rpb24iPT10eXBlb2YgT2JqZWN0LmNyZWF0ZT9vbC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7dCYmKGUuc3VwZXJfPXQsZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0LnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmUsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSkpO306b2wuZXhwb3J0cz1mdW5jdGlvbihlLHQpe2lmKHQpe2Uuc3VwZXJfPXQ7dmFyIHM9ZnVuY3Rpb24oKXt9O3MucHJvdG90eXBlPXQucHJvdG90eXBlLGUucHJvdG90eXBlPW5ldyBzLGUucHJvdG90eXBlLmNvbnN0cnVjdG9yPWU7fX07dmFyIGFsPW9sLmV4cG9ydHMsbGw9bmwsY2w9YWw7ZnVuY3Rpb24gaGwoZSx0KXtyZXR1cm4gNTUyOTY9PSg2NDUxMiZlLmNoYXJDb2RlQXQodCkpJiYoISh0PDB8fHQrMT49ZS5sZW5ndGgpJiY1NjMyMD09KDY0NTEyJmUuY2hhckNvZGVBdCh0KzEpKSl9ZnVuY3Rpb24gdWwoZSl7cmV0dXJuIChlPj4+MjR8ZT4+PjgmNjUyODB8ZTw8OCYxNjcxMTY4MHwoMjU1JmUpPDwyNCk+Pj4wfWZ1bmN0aW9uIGRsKGUpe3JldHVybiAxPT09ZS5sZW5ndGg/IjAiK2U6ZX1mdW5jdGlvbiBwbChlKXtyZXR1cm4gNz09PWUubGVuZ3RoPyIwIitlOjY9PT1lLmxlbmd0aD8iMDAiK2U6NT09PWUubGVuZ3RoPyIwMDAiK2U6ND09PWUubGVuZ3RoPyIwMDAwIitlOjM9PT1lLmxlbmd0aD8iMDAwMDAiK2U6Mj09PWUubGVuZ3RoPyIwMDAwMDAiK2U6MT09PWUubGVuZ3RoPyIwMDAwMDAwIitlOmV9aWwuaW5oZXJpdHM9Y2wsaWwudG9BcnJheT1mdW5jdGlvbihlLHQpe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGUuc2xpY2UoKTtpZighZSlyZXR1cm4gW107dmFyIHM9W107aWYoInN0cmluZyI9PXR5cGVvZiBlKWlmKHQpe2lmKCJoZXgiPT09dClmb3IoKGU9ZS5yZXBsYWNlKC9bXmEtejAtOV0rL2dpLCIiKSkubGVuZ3RoJTIhPTAmJihlPSIwIitlKSxuPTA7bjxlLmxlbmd0aDtuKz0yKXMucHVzaChwYXJzZUludChlW25dK2VbbisxXSwxNikpO31lbHNlIGZvcih2YXIgaT0wLG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZS5jaGFyQ29kZUF0KG4pO3I8MTI4P3NbaSsrXT1yOnI8MjA0OD8oc1tpKytdPXI+PjZ8MTkyLHNbaSsrXT02MyZyfDEyOCk6aGwoZSxuKT8ocj02NTUzNisoKDEwMjMmcik8PDEwKSsoMTAyMyZlLmNoYXJDb2RlQXQoKytuKSksc1tpKytdPXI+PjE4fDI0MCxzW2krK109cj4+MTImNjN8MTI4LHNbaSsrXT1yPj42JjYzfDEyOCxzW2krK109NjMmcnwxMjgpOihzW2krK109cj4+MTJ8MjI0LHNbaSsrXT1yPj42JjYzfDEyOCxzW2krK109NjMmcnwxMjgpO31lbHNlIGZvcihuPTA7bjxlLmxlbmd0aDtuKyspc1tuXT0wfGVbbl07cmV0dXJuIHN9LGlsLnRvSGV4PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixzPTA7czxlLmxlbmd0aDtzKyspdCs9ZGwoZVtzXS50b1N0cmluZygxNikpO3JldHVybiB0fSxpbC5odG9ubD11bCxpbC50b0hleDMyPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBzPSIiLGk9MDtpPGUubGVuZ3RoO2krKyl7dmFyIG49ZVtpXTsibGl0dGxlIj09PXQmJihuPXVsKG4pKSxzKz1wbChuLnRvU3RyaW5nKDE2KSk7fXJldHVybiBzfSxpbC56ZXJvMj1kbCxpbC56ZXJvOD1wbCxpbC5qb2luMzI9ZnVuY3Rpb24oZSx0LHMsaSl7dmFyIG49cy10O2xsKG4lND09MCk7Zm9yKHZhciByPW5ldyBBcnJheShuLzQpLG89MCxhPXQ7bzxyLmxlbmd0aDtvKyssYSs9NCl7dmFyIGw7bD0iYmlnIj09PWk/ZVthXTw8MjR8ZVthKzFdPDwxNnxlW2ErMl08PDh8ZVthKzNdOmVbYSszXTw8MjR8ZVthKzJdPDwxNnxlW2ErMV08PDh8ZVthXSxyW29dPWw+Pj4wO31yZXR1cm4gcn0saWwuc3BsaXQzMj1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcz1uZXcgQXJyYXkoNCplLmxlbmd0aCksaT0wLG49MDtpPGUubGVuZ3RoO2krKyxuKz00KXt2YXIgcj1lW2ldOyJiaWciPT09dD8oc1tuXT1yPj4+MjQsc1tuKzFdPXI+Pj4xNiYyNTUsc1tuKzJdPXI+Pj44JjI1NSxzW24rM109MjU1JnIpOihzW24rM109cj4+PjI0LHNbbisyXT1yPj4+MTYmMjU1LHNbbisxXT1yPj4+OCYyNTUsc1tuXT0yNTUmcik7fXJldHVybiBzfSxpbC5yb3RyMzI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT4+PnR8ZTw8MzItdH0saWwucm90bDMyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU8PHR8ZT4+PjMyLXR9LGlsLnN1bTMyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdD4+PjB9LGlsLnN1bTMyXzM9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBlK3Qrcz4+PjB9LGlsLnN1bTMyXzQ9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIGUrdCtzK2k+Pj4wfSxpbC5zdW0zMl81PWZ1bmN0aW9uKGUsdCxzLGksbil7cmV0dXJuIGUrdCtzK2krbj4+PjB9LGlsLnN1bTY0PWZ1bmN0aW9uKGUsdCxzLGkpe3ZhciBuPWVbdF0scj1pK2VbdCsxXT4+PjAsbz0ocjxpPzE6MCkrcytuO2VbdF09bz4+PjAsZVt0KzFdPXI7fSxpbC5zdW02NF9oaT1mdW5jdGlvbihlLHQscyxpKXtyZXR1cm4gKHQraT4+PjA8dD8xOjApK2Urcz4+PjB9LGlsLnN1bTY0X2xvPWZ1bmN0aW9uKGUsdCxzLGkpe3JldHVybiB0K2k+Pj4wfSxpbC5zdW02NF80X2hpPWZ1bmN0aW9uKGUsdCxzLGksbixyLG8sYSl7dmFyIGw9MCxjPXQ7cmV0dXJuIGwrPShjPWMraT4+PjApPHQ/MTowLGwrPShjPWMrcj4+PjApPHI/MTowLGUrcytuK28rKGwrPShjPWMrYT4+PjApPGE/MTowKT4+PjB9LGlsLnN1bTY0XzRfbG89ZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyxhKXtyZXR1cm4gdCtpK3IrYT4+PjB9LGlsLnN1bTY0XzVfaGk9ZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyxhLGwsYyl7dmFyIGg9MCx1PXQ7cmV0dXJuIGgrPSh1PXUraT4+PjApPHQ/MTowLGgrPSh1PXUrcj4+PjApPHI/MTowLGgrPSh1PXUrYT4+PjApPGE/MTowLGUrcytuK28rbCsoaCs9KHU9dStjPj4+MCk8Yz8xOjApPj4+MH0saWwuc3VtNjRfNV9sbz1mdW5jdGlvbihlLHQscyxpLG4scixvLGEsbCxjKXtyZXR1cm4gdCtpK3IrYStjPj4+MH0saWwucm90cjY0X2hpPWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gKHQ8PDMyLXN8ZT4+PnMpPj4+MH0saWwucm90cjY0X2xvPWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gKGU8PDMyLXN8dD4+PnMpPj4+MH0saWwuc2hyNjRfaGk9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBlPj4+c30saWwuc2hyNjRfbG89ZnVuY3Rpb24oZSx0LHMpe3JldHVybiAoZTw8MzItc3x0Pj4+cyk+Pj4wfTt2YXIgZmw9e30sbWw9aWwsZ2w9bmw7ZnVuY3Rpb24geWwoKXt0aGlzLnBlbmRpbmc9bnVsbCx0aGlzLnBlbmRpbmdUb3RhbD0wLHRoaXMuYmxvY2tTaXplPXRoaXMuY29uc3RydWN0b3IuYmxvY2tTaXplLHRoaXMub3V0U2l6ZT10aGlzLmNvbnN0cnVjdG9yLm91dFNpemUsdGhpcy5obWFjU3RyZW5ndGg9dGhpcy5jb25zdHJ1Y3Rvci5obWFjU3RyZW5ndGgsdGhpcy5wYWRMZW5ndGg9dGhpcy5jb25zdHJ1Y3Rvci5wYWRMZW5ndGgvOCx0aGlzLmVuZGlhbj0iYmlnIix0aGlzLl9kZWx0YTg9dGhpcy5ibG9ja1NpemUvOCx0aGlzLl9kZWx0YTMyPXRoaXMuYmxvY2tTaXplLzMyO31mbC5CbG9ja0hhc2g9eWwseWwucHJvdG90eXBlLnVwZGF0ZT1mdW5jdGlvbihlLHQpe2lmKGU9bWwudG9BcnJheShlLHQpLHRoaXMucGVuZGluZz90aGlzLnBlbmRpbmc9dGhpcy5wZW5kaW5nLmNvbmNhdChlKTp0aGlzLnBlbmRpbmc9ZSx0aGlzLnBlbmRpbmdUb3RhbCs9ZS5sZW5ndGgsdGhpcy5wZW5kaW5nLmxlbmd0aD49dGhpcy5fZGVsdGE4KXt2YXIgcz0oZT10aGlzLnBlbmRpbmcpLmxlbmd0aCV0aGlzLl9kZWx0YTg7dGhpcy5wZW5kaW5nPWUuc2xpY2UoZS5sZW5ndGgtcyxlLmxlbmd0aCksMD09PXRoaXMucGVuZGluZy5sZW5ndGgmJih0aGlzLnBlbmRpbmc9bnVsbCksZT1tbC5qb2luMzIoZSwwLGUubGVuZ3RoLXMsdGhpcy5lbmRpYW4pO2Zvcih2YXIgaT0wO2k8ZS5sZW5ndGg7aSs9dGhpcy5fZGVsdGEzMil0aGlzLl91cGRhdGUoZSxpLGkrdGhpcy5fZGVsdGEzMik7fXJldHVybiB0aGlzfSx5bC5wcm90b3R5cGUuZGlnZXN0PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnVwZGF0ZSh0aGlzLl9wYWQoKSksZ2wobnVsbD09PXRoaXMucGVuZGluZyksdGhpcy5fZGlnZXN0KGUpfSx5bC5wcm90b3R5cGUuX3BhZD1mdW5jdGlvbigpe3ZhciBlPXRoaXMucGVuZGluZ1RvdGFsLHQ9dGhpcy5fZGVsdGE4LHM9dC0oZSt0aGlzLnBhZExlbmd0aCkldCxpPW5ldyBBcnJheShzK3RoaXMucGFkTGVuZ3RoKTtpWzBdPTEyODtmb3IodmFyIG49MTtuPHM7bisrKWlbbl09MDtpZihlPDw9MywiYmlnIj09PXRoaXMuZW5kaWFuKXtmb3IodmFyIHI9ODtyPHRoaXMucGFkTGVuZ3RoO3IrKylpW24rK109MDtpW24rK109MCxpW24rK109MCxpW24rK109MCxpW24rK109MCxpW24rK109ZT4+PjI0JjI1NSxpW24rK109ZT4+PjE2JjI1NSxpW24rK109ZT4+PjgmMjU1LGlbbisrXT0yNTUmZTt9ZWxzZSBmb3IoaVtuKytdPTI1NSZlLGlbbisrXT1lPj4+OCYyNTUsaVtuKytdPWU+Pj4xNiYyNTUsaVtuKytdPWU+Pj4yNCYyNTUsaVtuKytdPTAsaVtuKytdPTAsaVtuKytdPTAsaVtuKytdPTAscj04O3I8dGhpcy5wYWRMZW5ndGg7cisrKWlbbisrXT0wO3JldHVybiBpfTt2YXIgeGw9e30sRWw9aWwucm90cjMyO2Z1bmN0aW9uIGJsKGUsdCxzKXtyZXR1cm4gZSZ0Xn5lJnN9ZnVuY3Rpb24gdmwoZSx0LHMpe3JldHVybiBlJnReZSZzXnQmc31mdW5jdGlvbiBTbChlLHQscyl7cmV0dXJuIGVedF5zfXhsLmZ0XzE9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIDA9PT1lP2JsKHQscyxpKToxPT09ZXx8Mz09PWU/U2wodCxzLGkpOjI9PT1lP3ZsKHQscyxpKTp2b2lkIDB9LHhsLmNoMzI9YmwseGwubWFqMzI9dmwseGwucDMyPVNsLHhsLnMwXzI1Nj1mdW5jdGlvbihlKXtyZXR1cm4gRWwoZSwyKV5FbChlLDEzKV5FbChlLDIyKX0seGwuczFfMjU2PWZ1bmN0aW9uKGUpe3JldHVybiBFbChlLDYpXkVsKGUsMTEpXkVsKGUsMjUpfSx4bC5nMF8yNTY9ZnVuY3Rpb24oZSl7cmV0dXJuIEVsKGUsNyleRWwoZSwxOCleZT4+PjN9LHhsLmcxXzI1Nj1mdW5jdGlvbihlKXtyZXR1cm4gRWwoZSwxNyleRWwoZSwxOSleZT4+PjEwfTt2YXIgQWw9aWwsa2w9ZmwsSWw9eGwsd2w9bmwsUGw9QWwuc3VtMzIsQ2w9QWwuc3VtMzJfNCwkbD1BbC5zdW0zMl81LE5sPUlsLmNoMzIsX2w9SWwubWFqMzIsUmw9SWwuczBfMjU2LE1sPUlsLnMxXzI1NixPbD1JbC5nMF8yNTYsRGw9SWwuZzFfMjU2LExsPWtsLkJsb2NrSGFzaCxUbD1bMTExNjM1MjQwOCwxODk5NDQ3NDQxLDMwNDkzMjM0NzEsMzkyMTAwOTU3Myw5NjE5ODcxNjMsMTUwODk3MDk5MywyNDUzNjM1NzQ4LDI4NzA3NjMyMjEsMzYyNDM4MTA4MCwzMTA1OTg0MDEsNjA3MjI1Mjc4LDE0MjY4ODE5ODcsMTkyNTA3ODM4OCwyMTYyMDc4MjA2LDI2MTQ4ODgxMDMsMzI0ODIyMjU4MCwzODM1MzkwNDAxLDQwMjIyMjQ3NzQsMjY0MzQ3MDc4LDYwNDgwNzYyOCw3NzAyNTU5ODMsMTI0OTE1MDEyMiwxNTU1MDgxNjkyLDE5OTYwNjQ5ODYsMjU1NDIyMDg4MiwyODIxODM0MzQ5LDI5NTI5OTY4MDgsMzIxMDMxMzY3MSwzMzM2NTcxODkxLDM1ODQ1Mjg3MTEsMTEzOTI2OTkzLDMzODI0MTg5NSw2NjYzMDcyMDUsNzczNTI5OTEyLDEyOTQ3NTczNzIsMTM5NjE4MjI5MSwxNjk1MTgzNzAwLDE5ODY2NjEwNTEsMjE3NzAyNjM1MCwyNDU2OTU2MDM3LDI3MzA0ODU5MjEsMjgyMDMwMjQxMSwzMjU5NzMwODAwLDMzNDU3NjQ3NzEsMzUxNjA2NTgxNywzNjAwMzUyODA0LDQwOTQ1NzE5MDksMjc1NDIzMzQ0LDQzMDIyNzczNCw1MDY5NDg2MTYsNjU5MDYwNTU2LDg4Mzk5Nzg3Nyw5NTgxMzk1NzEsMTMyMjgyMjIxOCwxNTM3MDAyMDYzLDE3NDc4NzM3NzksMTk1NTU2MjIyMiwyMDI0MTA0ODE1LDIyMjc3MzA0NTIsMjM2MTg1MjQyNCwyNDI4NDM2NDc0LDI3NTY3MzQxODcsMzIwNDAzMTQ3OSwzMzI5MzI1Mjk4XTtmdW5jdGlvbiBWbCgpe2lmKCEodGhpcyBpbnN0YW5jZW9mIFZsKSlyZXR1cm4gbmV3IFZsO0xsLmNhbGwodGhpcyksdGhpcy5oPVsxNzc5MDMzNzAzLDMxNDQxMzQyNzcsMTAxMzkwNDI0MiwyNzczNDgwNzYyLDEzNTk4OTMxMTksMjYwMDgyMjkyNCw1Mjg3MzQ2MzUsMTU0MTQ1OTIyNV0sdGhpcy5rPVRsLHRoaXMuVz1uZXcgQXJyYXkoNjQpO31BbC5pbmhlcml0cyhWbCxMbCk7dmFyIEJsPVZsO1ZsLmJsb2NrU2l6ZT01MTIsVmwub3V0U2l6ZT0yNTYsVmwuaG1hY1N0cmVuZ3RoPTE5MixWbC5wYWRMZW5ndGg9NjQsVmwucHJvdG90eXBlLl91cGRhdGU9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHM9dGhpcy5XLGk9MDtpPDE2O2krKylzW2ldPWVbdCtpXTtmb3IoO2k8cy5sZW5ndGg7aSsrKXNbaV09Q2woRGwoc1tpLTJdKSxzW2ktN10sT2woc1tpLTE1XSksc1tpLTE2XSk7dmFyIG49dGhpcy5oWzBdLHI9dGhpcy5oWzFdLG89dGhpcy5oWzJdLGE9dGhpcy5oWzNdLGw9dGhpcy5oWzRdLGM9dGhpcy5oWzVdLGg9dGhpcy5oWzZdLHU9dGhpcy5oWzddO2Zvcih3bCh0aGlzLmsubGVuZ3RoPT09cy5sZW5ndGgpLGk9MDtpPHMubGVuZ3RoO2krKyl7dmFyIGQ9JGwodSxNbChsKSxObChsLGMsaCksdGhpcy5rW2ldLHNbaV0pLHA9UGwoUmwobiksX2wobixyLG8pKTt1PWgsaD1jLGM9bCxsPVBsKGEsZCksYT1vLG89cixyPW4sbj1QbChkLHApO310aGlzLmhbMF09UGwodGhpcy5oWzBdLG4pLHRoaXMuaFsxXT1QbCh0aGlzLmhbMV0sciksdGhpcy5oWzJdPVBsKHRoaXMuaFsyXSxvKSx0aGlzLmhbM109UGwodGhpcy5oWzNdLGEpLHRoaXMuaFs0XT1QbCh0aGlzLmhbNF0sbCksdGhpcy5oWzVdPVBsKHRoaXMuaFs1XSxjKSx0aGlzLmhbNl09UGwodGhpcy5oWzZdLGgpLHRoaXMuaFs3XT1QbCh0aGlzLmhbN10sdSk7fSxWbC5wcm90b3R5cGUuX2RpZ2VzdD1mdW5jdGlvbihlKXtyZXR1cm4gImhleCI9PT1lP0FsLnRvSGV4MzIodGhpcy5oLCJiaWciKTpBbC5zcGxpdDMyKHRoaXMuaCwiYmlnIil9O3ZhciB6bD10KEJsKTtjb25zdCBGbD0oKT0+emwoKTthc3luYyBmdW5jdGlvbiBqbChlLHQscyxpLG4pe19vKCJyZW5kZXIgY2h1bmtzIiwyKSxmdW5jdGlvbihlKXtmb3IoY29uc3QgdCBvZiBlKXQuZmFjYWRlTW9kdWxlJiZ0LmZhY2FkZU1vZHVsZS5pc1VzZXJEZWZpbmVkRW50cnlQb2ludCYmdC5nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCk7fShlKTtjb25zdCByPWF3YWl0IFByb21pc2UuYWxsKGUubWFwKChlPT5lLnJlbmRlcigpKSkpO1JvKCJyZW5kZXIgY2h1bmtzIiwyKSxfbygidHJhbnNmb3JtIGNodW5rcyIsMik7Y29uc3Qgbz1mdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKGUubWFwKChlPT57Y29uc3QgdD1lLmdldFJlbmRlcmVkQ2h1bmtJbmZvKCk7cmV0dXJuIFt0LmZpbGVOYW1lLHRdfSkpKX0oZSkse2luaXRpYWxIYXNoZXNCeVBsYWNlaG9sZGVyOmEsbm9uSGFzaGVkQ2h1bmtzV2l0aFBsYWNlaG9sZGVyczpsLHJlbmRlcmVkQ2h1bmtzQnlQbGFjZWhvbGRlcjpjLGhhc2hEZXBlbmRlbmNpZXNCeVBsYWNlaG9sZGVyOmh9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKGUsdCxzLGksbil7Y29uc3Qgcj1bXSxvPW5ldyBNYXAsYT1uZXcgTWFwLGw9bmV3IE1hcCxjPW5ldyBTZXQ7Zm9yKGNvbnN0e3ByZWxpbWluYXJ5RmlsZU5hbWU6e2hhc2hQbGFjZWhvbGRlcjp0fX1vZiBlKXQmJmMuYWRkKHQpO3JldHVybiBhd2FpdCBQcm9taXNlLmFsbChlLm1hcCgoYXN5bmMoe2NodW5rOmUscHJlbGltaW5hcnlGaWxlTmFtZTp7ZmlsZU5hbWU6aCxoYXNoUGxhY2Vob2xkZXI6dX0scHJlbGltaW5hcnlTb3VyY2VtYXBGaWxlTmFtZTpkLG1hZ2ljU3RyaW5nOnAsdXNlZE1vZHVsZXM6Zn0pPT57Y29uc3QgbT17Y2h1bms6ZSxmaWxlTmFtZTpoLHNvdXJjZW1hcEZpbGVOYW1lOmQ/LmZpbGVOYW1lPz9udWxsLC4uLmF3YWl0IFVsKHAsaCxmLHQscyxpLG4pfSx7Y29kZTpnLG1hcDp5fT1tO2lmKHUpe2NvbnN0e2NvbnRhaW5lZFBsYWNlaG9sZGVyczp0LHRyYW5zZm9ybWVkQ29kZTpzfT13YShnLGMpLG49RmwoKS51cGRhdGUocykscj1pLmhvb2tSZWR1Y2VWYWx1ZVN5bmMoImF1Z21lbnRDaHVua0hhc2giLCIiLFtlLmdldFJlbmRlcmVkQ2h1bmtJbmZvKCldLCgoZSx0KT0+KHQmJihlKz10KSxlKSkpO3ImJm4udXBkYXRlKHIpLG8uc2V0KHUsbSksYS5zZXQodSx7Y29udGFpbmVkUGxhY2Vob2xkZXJzOnQsY29udGVudEhhc2g6bi5kaWdlc3QoImhleCIpfSk7fWVsc2Ugci5wdXNoKG0pO2NvbnN0IHg9ZD8uaGFzaFBsYWNlaG9sZGVyO3kmJngmJmwuc2V0KGQuaGFzaFBsYWNlaG9sZGVyLEZsKCkudXBkYXRlKHkudG9TdHJpbmcoKSkuZGlnZXN0KCJoZXgiKS5zbGljZSgwLGQuaGFzaFBsYWNlaG9sZGVyLmxlbmd0aCkpO30pKSkse2hhc2hEZXBlbmRlbmNpZXNCeVBsYWNlaG9sZGVyOmEsaW5pdGlhbEhhc2hlc0J5UGxhY2Vob2xkZXI6bCxub25IYXNoZWRDaHVua3NXaXRoUGxhY2Vob2xkZXJzOnIscmVuZGVyZWRDaHVua3NCeVBsYWNlaG9sZGVyOm99fShyLG8saSxzLG4pLHU9ZnVuY3Rpb24oZSx0LHMsaSl7Y29uc3Qgbj1uZXcgTWFwKHMpO2Zvcihjb25zdFtzLHtmaWxlTmFtZTpyfV1vZiBlKXtsZXQgZT1GbCgpO2NvbnN0IG89bmV3IFNldChbc10pO2Zvcihjb25zdCBzIG9mIG8pe2NvbnN0e2NvbnRhaW5lZFBsYWNlaG9sZGVyczppLGNvbnRlbnRIYXNoOm59PXQuZ2V0KHMpO2UudXBkYXRlKG4pO2Zvcihjb25zdCBlIG9mIGkpby5hZGQoZSk7fWxldCBhLGw7ZG97bCYmKGU9RmwoKS51cGRhdGUobCkpLGw9ZS5kaWdlc3QoImhleCIpLnNsaWNlKDAscy5sZW5ndGgpLGE9SWEocixzLGwpO313aGlsZShpW1BhXS5oYXMoYS50b0xvd2VyQ2FzZSgpKSk7aVthXT1DYSxuLnNldChzLGwpO31yZXR1cm4gbn0oYyxoLGEsdCk7IWZ1bmN0aW9uKGUsdCxzLGksbixyKXtmb3IoY29uc3R7Y2h1bms6aSxjb2RlOm8sZmlsZU5hbWU6YSxzb3VyY2VtYXBGaWxlTmFtZTpsLG1hcDpjfW9mIGUudmFsdWVzKCkpe2xldCBlPWthKG8sdCk7Y29uc3QgaD1rYShhLHQpO2xldCB1PW51bGw7YyYmKHU9bD9rYShsLHQpOmAke2h9Lm1hcGAsYy5maWxlPWthKGMuZmlsZSx0KSxlKz1HbCh1LGMsbixyKSksc1toXT1pLmZpbmFsaXplQ2h1bmsoZSxjLHUsdCk7fWZvcihjb25zdHtjaHVuazplLGNvZGU6byxmaWxlTmFtZTphLHNvdXJjZW1hcEZpbGVOYW1lOmwsbWFwOmN9b2YgaSl7bGV0IGk9dC5zaXplPjA/a2Eobyx0KTpvLGg9bnVsbDtjJiYoaD1sP2thKGwsdCk6YCR7YX0ubWFwYCxpKz1HbChoLGMsbixyKSksc1thXT1lLmZpbmFsaXplQ2h1bmsoaSxjLGgsdCk7fX0oYyx1LHQsbCxzLGkpLFJvKCJ0cmFuc2Zvcm0gY2h1bmtzIiwyKTt9YXN5bmMgZnVuY3Rpb24gVWwoZSx0LHMsaSxuLHIsbyl7bGV0IGE9bnVsbDtjb25zdCBjPVtdO2xldCBoPWF3YWl0IHIuaG9va1JlZHVjZUFyZzAoInJlbmRlckNodW5rIixbZS50b1N0cmluZygpLGlbdF0sbix7Y2h1bmtzOml9XSwoKGUsdCxzKT0+e2lmKG51bGw9PXQpcmV0dXJuIGU7aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD17Y29kZTp0LG1hcDp2b2lkIDB9KSxudWxsIT09dC5tYXApe2NvbnN0IGU9Ym8odC5tYXApO2MucHVzaChlfHx7bWlzc2luZzohMCxwbHVnaW46cy5uYW1lfSk7fXJldHVybiB0LmNvZGV9KSk7Y29uc3R7Y29tcGFjdDp1LGRpcjpkLGZpbGU6cCxzb3VyY2VtYXA6Zixzb3VyY2VtYXBFeGNsdWRlU291cmNlczptLHNvdXJjZW1hcEZpbGU6Zyxzb3VyY2VtYXBQYXRoVHJhbnNmb3JtOnksc291cmNlbWFwSWdub3JlTGlzdDp4fT1uO2lmKHV8fCJcbiI9PT1oW2gubGVuZ3RoLTFdfHwoaCs9IlxuIiksZil7bGV0IGk7X28oInNvdXJjZW1hcHMiLDMpLGk9cD9fKGd8fHApOmQ/XyhkLHQpOl8odCk7YT1mdW5jdGlvbihlLHQscyxpLG4scil7Y29uc3Qgbz10bChyKSxhPXMuZmlsdGVyKChlPT4hZS5leGNsdWRlRnJvbVNvdXJjZW1hcCkpLm1hcCgoZT0+c2woZS5pZCxlLm9yaWdpbmFsQ29kZSxlLm9yaWdpbmFsU291cmNlbWFwLGUuc291cmNlbWFwQ2hhaW4sbykpKSxjPW5ldyBlbCh0LGEpLGg9aS5yZWR1Y2UobyxjKTtsZXR7c291cmNlczp1LHNvdXJjZXNDb250ZW50OmQsbmFtZXM6cCxtYXBwaW5nczpmfT1oLnRyYWNlTWFwcGluZ3MoKTtpZihlKXtjb25zdCB0PUMoZSk7dT11Lm1hcCgoZT0+TiQ1KHQsZSkpKSxlPVAoZSk7fWQ9bj9udWxsOmQ7Zm9yKGNvbnN0IGUgb2YgcylFbyhlLm9yaWdpbmFsU291cmNlbWFwLGUuc291cmNlbWFwQ2hhaW4pO3JldHVybiBuZXcgbCh7ZmlsZTplLG1hcHBpbmdzOmYsbmFtZXM6cCxzb3VyY2VzOnUsc291cmNlc0NvbnRlbnQ6ZH0pfShpLGUuZ2VuZXJhdGVEZWNvZGVkTWFwKHt9KSxzLGMsbSxvKTtmb3IobGV0IGU9MDtlPGEuc291cmNlcy5sZW5ndGg7KytlKXtsZXQgdD1hLnNvdXJjZXNbZV07Y29uc3Qgcz1gJHtpfS5tYXBgLG49eCh0LHMpOyJib29sZWFuIiE9dHlwZW9mIG4mJlhlKFl0KCJzb3VyY2VtYXBJZ25vcmVMaXN0IGZ1bmN0aW9uIG11c3QgcmV0dXJuIGEgYm9vbGVhbi4iKSksbiYmKHZvaWQgMD09PWEueF9nb29nbGVfaWdub3JlTGlzdCYmKGEueF9nb29nbGVfaWdub3JlTGlzdD1bXSksYS54X2dvb2dsZV9pZ25vcmVMaXN0LmluY2x1ZGVzKGUpfHxhLnhfZ29vZ2xlX2lnbm9yZUxpc3QucHVzaChlKSkseSYmKHQ9eSh0LHMpLCJzdHJpbmciIT10eXBlb2YgdCYmWGUoWXQoInNvdXJjZW1hcFBhdGhUcmFuc2Zvcm0gZnVuY3Rpb24gbXVzdCByZXR1cm4gYSBzdHJpbmcuIikpKSxhLnNvdXJjZXNbZV09dyh0KTt9Um8oInNvdXJjZW1hcHMiLDMpO31yZXR1cm4ge2NvZGU6aCxtYXA6YX19ZnVuY3Rpb24gR2woZSx0LHMse3NvdXJjZW1hcDppLHNvdXJjZW1hcEJhc2VVcmw6bn0pe2xldCByO2lmKCJpbmxpbmUiPT09aSlyPXQudG9VcmwoKTtlbHNlIHtjb25zdCBpPVAoZSk7cj1uP25ldyBVUkwoaSxuKS50b1N0cmluZygpOmkscy5lbWl0RmlsZSh7ZmlsZU5hbWU6ZSxzb3VyY2U6dC50b1N0cmluZygpLHR5cGU6ImFzc2V0In0pO31yZXR1cm4gImhpZGRlbiI9PT1pPyIiOmAvLyMgJHt6c309JHtyfVxuYH1jbGFzcyBXbHtjb25zdHJ1Y3RvcihlLHQscyxpLG4pe3RoaXMub3V0cHV0T3B0aW9ucz1lLHRoaXMudW5zZXRPcHRpb25zPXQsdGhpcy5pbnB1dE9wdGlvbnM9cyx0aGlzLnBsdWdpbkRyaXZlcj1pLHRoaXMuZ3JhcGg9bix0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGU9bmV3IE1hcCx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcz1uZXcgU2V0O31hc3luYyBnZW5lcmF0ZShlKXtfbygiR0VORVJBVEUiLDEpO2NvbnN0IHQ9T2JqZWN0LmNyZWF0ZShudWxsKSxzPShlPT57Y29uc3QgdD1uZXcgU2V0O3JldHVybiBuZXcgUHJveHkoZSx7ZGVsZXRlUHJvcGVydHk6KGUscyk9Pigic3RyaW5nIj09dHlwZW9mIHMmJnQuZGVsZXRlKHMudG9Mb3dlckNhc2UoKSksUmVmbGVjdC5kZWxldGVQcm9wZXJ0eShlLHMpKSxnZXQ6KGUscyk9PnM9PT1QYT90OlJlZmxlY3QuZ2V0KGUscyksc2V0OihlLHMsaSk9Pigic3RyaW5nIj09dHlwZW9mIHMmJnQuYWRkKHMudG9Mb3dlckNhc2UoKSksUmVmbGVjdC5zZXQoZSxzLGkpKX0pfSkodCk7dGhpcy5wbHVnaW5Ecml2ZXIuc2V0T3V0cHV0QnVuZGxlKHMsdGhpcy5vdXRwdXRPcHRpb25zKTt0cnl7X28oImluaXRpYWxpemUgcmVuZGVyIiwyKSxhd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoInJlbmRlclN0YXJ0IixbdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuaW5wdXRPcHRpb25zXSksUm8oImluaXRpYWxpemUgcmVuZGVyIiwyKSxfbygiZ2VuZXJhdGUgY2h1bmtzIiwyKTtjb25zdCBlPSgoKT0+e2xldCBlPTA7cmV0dXJuICh0LHM9OCk9PntpZihzPjY0KXJldHVybiBYZShZdChgSGFzaGVzIGNhbm5vdCBiZSBsb25nZXIgdGhhbiA2NCBjaGFyYWN0ZXJzLCByZWNlaXZlZCAke3N9LiBDaGVjayB0aGUgIiR7dH0iIG9wdGlvbi5gKSk7Y29uc3QgaT1gJHt2YX0ke09pKCsrZSkucGFkU3RhcnQocy01LCIwIil9JHtTYX1gO3JldHVybiBpLmxlbmd0aD5zP1hlKFl0KGBUbyBnZW5lcmF0ZSBoYXNoZXMgZm9yIHRoaXMgbnVtYmVyIG9mIGNodW5rcyAoY3VycmVudGx5ICR7ZX0pLCB5b3UgbmVlZCBhIG1pbmltdW0gaGFzaCBzaXplIG9mICR7aS5sZW5ndGh9LCByZWNlaXZlZCAke3N9LiBDaGVjayB0aGUgIiR7dH0iIG9wdGlvbi5gKSk6aX19KSgpLHQ9YXdhaXQgdGhpcy5nZW5lcmF0ZUNodW5rcyhzLGUpO3QubGVuZ3RoPjEmJmZ1bmN0aW9uKGUsdCl7aWYoInVtZCI9PT1lLmZvcm1hdHx8ImlpZmUiPT09ZS5mb3JtYXQpcmV0dXJuIFhlKEZ0KCJvdXRwdXQuZm9ybWF0IixGZSwiVU1EIGFuZCBJSUZFIG91dHB1dCBmb3JtYXRzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBjb2RlLXNwbGl0dGluZyBidWlsZHMiLGUuZm9ybWF0KSk7aWYoInN0cmluZyI9PXR5cGVvZiBlLmZpbGUpcmV0dXJuIFhlKEZ0KCJvdXRwdXQuZmlsZSIsVmUsJ3doZW4gYnVpbGRpbmcgbXVsdGlwbGUgY2h1bmtzLCB0aGUgIm91dHB1dC5kaXIiIG9wdGlvbiBtdXN0IGJlIHVzZWQsIG5vdCAib3V0cHV0LmZpbGUiLiBUbyBpbmxpbmUgZHluYW1pYyBpbXBvcnRzLCBzZXQgdGhlICJpbmxpbmVEeW5hbWljSW1wb3J0cyIgb3B0aW9uJykpO2lmKGUuc291cmNlbWFwRmlsZSlyZXR1cm4gWGUoRnQoIm91dHB1dC5zb3VyY2VtYXBGaWxlIixLZSwnIm91dHB1dC5zb3VyY2VtYXBGaWxlIiBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igc2luZ2xlLWZpbGUgYnVpbGRzJykpOyFlLmFtZC5hdXRvSWQmJmUuYW1kLmlkJiZ0KFNlLEZ0KCJvdXRwdXQuYW1kLmlkIixUZSwndGhpcyBvcHRpb24gaXMgb25seSBwcm9wZXJseSBzdXBwb3J0ZWQgZm9yIHNpbmdsZS1maWxlIGJ1aWxkcy4gVXNlICJvdXRwdXQuYW1kLmF1dG9JZCIgYW5kICJvdXRwdXQuYW1kLmJhc2VQYXRoIiBpbnN0ZWFkJykpO30odGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSx0aGlzLnBsdWdpbkRyaXZlci5zZXRDaHVua0luZm9ybWF0aW9uKHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSk7Zm9yKGNvbnN0IGUgb2YgdCllLmdlbmVyYXRlRXhwb3J0cygpO1JvKCJnZW5lcmF0ZSBjaHVua3MiLDIpLGF3YWl0IGpsKHQscyx0aGlzLnBsdWdpbkRyaXZlcix0aGlzLm91dHB1dE9wdGlvbnMsdGhpcy5pbnB1dE9wdGlvbnMub25Mb2cpO31jYXRjaChlKXt0aHJvdyBhd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoInJlbmRlckVycm9yIixbZV0pLGV9cmV0dXJuIChlPT57Y29uc3QgdD1uZXcgU2V0LHM9T2JqZWN0LnZhbHVlcyhlKTtmb3IoY29uc3QgZSBvZiBzKSJhc3NldCI9PT1lLnR5cGUmJmUubmVlZHNDb2RlUmVmZXJlbmNlJiZ0LmFkZChlLmZpbGVOYW1lKTtmb3IoY29uc3QgZSBvZiBzKWlmKCJjaHVuayI9PT1lLnR5cGUpZm9yKGNvbnN0IHMgb2YgZS5yZWZlcmVuY2VkRmlsZXMpdC5oYXMocykmJnQuZGVsZXRlKHMpO2Zvcihjb25zdCBzIG9mIHQpZGVsZXRlIGVbc107fSkocyksX28oImdlbmVyYXRlIGJ1bmRsZSIsMiksYXdhaXQgdGhpcy5wbHVnaW5Ecml2ZXIuaG9va1NlcSgiZ2VuZXJhdGVCdW5kbGUiLFt0aGlzLm91dHB1dE9wdGlvbnMscyxlXSksdGhpcy5maW5hbGlzZUFzc2V0cyhzKSxSbygiZ2VuZXJhdGUgYnVuZGxlIiwyKSxSbygiR0VORVJBVEUiLDEpLHR9YXN5bmMgYWRkTWFudWFsQ2h1bmtzKGUpe2NvbnN0IHQ9bmV3IE1hcCxzPWF3YWl0IFByb21pc2UuYWxsKE9iamVjdC5lbnRyaWVzKGUpLm1hcCgoYXN5bmMoW2UsdF0pPT4oe2FsaWFzOmUsZW50cmllczphd2FpdCB0aGlzLmdyYXBoLm1vZHVsZUxvYWRlci5hZGRBZGRpdGlvbmFsTW9kdWxlcyh0LCEwKX0pKSkpO2Zvcihjb25zdHthbGlhczplLGVudHJpZXM6aX1vZiBzKWZvcihjb25zdCBzIG9mIGkpcWwoZSxzLHQpO3JldHVybiB0fWFzc2lnbk1hbnVhbENodW5rcyhlKXtjb25zdCB0PVtdLHM9e2dldE1vZHVsZUlkczooKT0+dGhpcy5ncmFwaC5tb2R1bGVzQnlJZC5rZXlzKCksZ2V0TW9kdWxlSW5mbzp0aGlzLmdyYXBoLmdldE1vZHVsZUluZm99O2Zvcihjb25zdCBpIG9mIHRoaXMuZ3JhcGgubW9kdWxlc0J5SWQudmFsdWVzKCkpaWYoaSBpbnN0YW5jZW9mIEJvKXtjb25zdCBuPWUoaS5pZCxzKTsic3RyaW5nIj09dHlwZW9mIG4mJnQucHVzaChbbixpXSk7fXQuc29ydCgoKFtlXSxbdF0pPT5lPnQ/MTplPHQ/LTE6MCkpO2NvbnN0IGk9bmV3IE1hcDtmb3IoY29uc3RbZSxzXW9mIHQpcWwoZSxzLGkpO3JldHVybiBpfWZpbmFsaXNlQXNzZXRzKGUpe2lmKHRoaXMub3V0cHV0T3B0aW9ucy52YWxpZGF0ZSlmb3IoY29uc3QgdCBvZiBPYmplY3QudmFsdWVzKGUpKWlmKCJjb2RlImluIHQpdHJ5e3RoaXMuZ3JhcGguY29udGV4dFBhcnNlKHQuY29kZSx7ZWNtYVZlcnNpb246ImxhdGVzdCJ9KTt9Y2F0Y2goZSl7dGhpcy5pbnB1dE9wdGlvbnMub25Mb2coU2UsT3QodCxlKSk7fXRoaXMucGx1Z2luRHJpdmVyLmZpbmFsaXNlQXNzZXRzKCk7fWFzeW5jIGdlbmVyYXRlQ2h1bmtzKGUsdCl7Y29uc3R7ZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplOnMsaW5saW5lRHluYW1pY0ltcG9ydHM6aSxtYW51YWxDaHVua3M6bixwcmVzZXJ2ZU1vZHVsZXM6cn09dGhpcy5vdXRwdXRPcHRpb25zLG89Im9iamVjdCI9PXR5cGVvZiBuP2F3YWl0IHRoaXMuYWRkTWFudWFsQ2h1bmtzKG4pOnRoaXMuYXNzaWduTWFudWFsQ2h1bmtzKG4pLGE9ZnVuY3Rpb24oe2NvbXBhY3Q6ZSxnZW5lcmF0ZWRDb2RlOnthcnJvd0Z1bmN0aW9uczp0LGNvbnN0QmluZGluZ3M6cyxvYmplY3RTaG9ydGhhbmQ6aSxyZXNlcnZlZE5hbWVzQXNQcm9wczpufX0pe2NvbnN0e186cixuOm8sczphfT1lP3tfOiIiLG46IiIsczoiIn06e186IiAiLG46IlxuIixzOiI7In0sbD1zPyJjb25zdCI6InZhciIsYz0oZSx7aXNBc3luYzp0LG5hbWU6c30pPT5gJHt0PyJhc3luYyAiOiIifWZ1bmN0aW9uJHtzP2AgJHtzfWA6IiJ9JHtyfSgke2Uuam9pbihgLCR7cn1gKX0pJHtyfWAsaD10PyhlLHtpc0FzeW5jOnQsbmFtZTpzfSk9Pntjb25zdCBpPTE9PT1lLmxlbmd0aDtyZXR1cm4gYCR7cz9gJHtsfSAke3N9JHtyfT0ke3J9YDoiIn0ke3Q/YGFzeW5jJHtpPyIgIjpyfWA6IiJ9JHtpP2VbMF06YCgke2Uuam9pbihgLCR7cn1gKX0pYH0ke3J9PT4ke3J9YH06Yyx1PShlLHtmdW5jdGlvblJldHVybjpzLGxpbmVCcmVha0luZGVudDppLG5hbWU6bn0pPT5bYCR7aChlLHtpc0FzeW5jOiExLG5hbWU6bn0pfSR7dD9pP2Ake299JHtpLmJhc2V9JHtpLnR9YDoiIjpgeyR7aT9gJHtvfSR7aS5iYXNlfSR7aS50fWA6cn0ke3M/InJldHVybiAiOiIifWB9YCx0P2Ake24/IjsiOiIifSR7aT9gJHtvfSR7aS5iYXNlfWA6IiJ9YDpgJHthfSR7aT9gJHtvfSR7aS5iYXNlfWA6cn19YF0sZD1uP2U9PlphLnRlc3QoZSk6ZT0+IXhlLmhhcyhlKSYmWmEudGVzdChlKTtyZXR1cm4ge186cixjbnN0OmwsZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246dSxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDooZSxzLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOmksbmVlZHNXcmFwcGVkRnVuY3Rpb246bn0pPT57Y29uc3RbcixvXT11KGUse2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO3JldHVybiBgJHtRYShgJHtyfSR7UWEocyx0JiZpKX0ke299YCx0fHxuKX0oYH0sZ2V0RnVuY3Rpb25JbnRybzpoLGdldE5vbkFycm93RnVuY3Rpb25JbnRybzpjLGdldE9iamVjdChlLHtsaW5lQnJlYWtJbmRlbnQ6dH0pe2NvbnN0IHM9dD9gJHtvfSR7dC5iYXNlfSR7dC50fWA6cjtyZXR1cm4gYHske2UubWFwKCgoW2UsdF0pPT57aWYobnVsbD09PWUpcmV0dXJuIGAke3N9JHt0fWA7Y29uc3Qgbj0hZChlKTtyZXR1cm4gZT09PXQmJmkmJiFuP3MrZTpgJHtzfSR7bj9gJyR7ZX0nYDplfToke3J9JHt0fWB9KSkuam9pbigiLCIpfSR7MD09PWUubGVuZ3RoPyIiOnQ/YCR7b30ke3QuYmFzZX1gOnJ9fWB9LGdldFByb3BlcnR5QWNjZXNzOmU9PmQoZSk/YC4ke2V9YDpgWyR7SlNPTi5zdHJpbmdpZnkoZSl9XWAsbjpvLHM6YX19KHRoaXMub3V0cHV0T3B0aW9ucyksbD1mdW5jdGlvbihlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIGUudmFsdWVzKCkpcyBpbnN0YW5jZW9mIEJvJiYocy5pc0luY2x1ZGVkKCl8fHMuaW5mby5pc0VudHJ5fHxzLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5sZW5ndGg+MCkmJnQucHVzaChzKTtyZXR1cm4gdH0odGhpcy5ncmFwaC5tb2R1bGVzQnlJZCksYz1mdW5jdGlvbihlKXtpZigwPT09ZS5sZW5ndGgpcmV0dXJuICIvIjtpZigxPT09ZS5sZW5ndGgpcmV0dXJuIEMoZVswXSk7Y29uc3QgdD1lLnNsaWNlKDEpLnJlZHVjZSgoKGUsdCk9Pntjb25zdCBzPXQuc3BsaXQoL1wvK3xcXCsvKTtsZXQgaTtmb3IoaT0wO2VbaV09PT1zW2ldJiZpPE1hdGgubWluKGUubGVuZ3RoLHMubGVuZ3RoKTtpKyspO3JldHVybiBlLnNsaWNlKDAsaSl9KSxlWzBdLnNwbGl0KC9cLyt8XFwrLykpO3JldHVybiB0Lmxlbmd0aD4xP3Quam9pbigiLyIpOiIvIn0oZnVuY3Rpb24oZSx0KXtjb25zdCBzPVtdO2Zvcihjb25zdCBpIG9mIGUpKGkuaW5mby5pc0VudHJ5fHx0KSYmayhpLmlkKSYmcy5wdXNoKGkuaWQpO3JldHVybiBzfShsLHIpKSxoPWZ1bmN0aW9uKGUsdCxzKXtjb25zdCBpPW5ldyBNYXA7Zm9yKGNvbnN0IG4gb2YgZS52YWx1ZXMoKSluIGluc3RhbmNlb2YgWnQmJmkuc2V0KG4sbmV3IEYkMyhuLHQscykpO3JldHVybiBpfSh0aGlzLmdyYXBoLm1vZHVsZXNCeUlkLHRoaXMub3V0cHV0T3B0aW9ucyxjKSx1PVtdLGQ9bmV3IE1hcDtmb3IoY29uc3R7YWxpYXM6bixtb2R1bGVzOnB9b2YgaT9be2FsaWFzOm51bGwsbW9kdWxlczpsfV06cj9sLm1hcCgoZT0+KHthbGlhczpudWxsLG1vZHVsZXM6W2VdfSkpKTp6YSh0aGlzLmdyYXBoLmVudHJ5TW9kdWxlcyxvLHMsdGhpcy5pbnB1dE9wdGlvbnMub25Mb2cpKXtwLnNvcnQoWWEpO2NvbnN0IHM9bmV3IE1hKHAsdGhpcy5pbnB1dE9wdGlvbnMsdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMudW5zZXRPcHRpb25zLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMuZ3JhcGgubW9kdWxlc0J5SWQsZCxoLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcyxuLHQsZSxjLGEpO3UucHVzaChzKTt9Zm9yKGNvbnN0IGUgb2YgdSllLmxpbmsoKTtjb25zdCBwPVtdO2Zvcihjb25zdCBlIG9mIHUpcC5wdXNoKC4uLmUuZ2VuZXJhdGVGYWNhZGVzKCkpO3JldHVybiBbLi4udSwuLi5wXX19ZnVuY3Rpb24gcWwoZSx0LHMpe2NvbnN0IGk9cy5nZXQodCk7aWYoInN0cmluZyI9PXR5cGVvZiBpJiZpIT09ZSlyZXR1cm4gWGUoKG49dC5pZCxyPWUsbz1pLHtjb2RlOmN0LG1lc3NhZ2U6YENhbm5vdCBhc3NpZ24gIiR7VChuKX0iIHRvIHRoZSAiJHtyfSIgY2h1bmsgYXMgaXQgaXMgYWxyZWFkeSBpbiB0aGUgIiR7b30iIGNodW5rLmB9KSk7dmFyIG4scixvO3Muc2V0KHQsZSk7fXZhciBIbD1bNTA5LDAsMjI3LDAsMTUwLDQsMjk0LDksMTM2OCwyLDIsMSw2LDMsNDEsMiw1LDAsMTY2LDEsNTc0LDMsOSw5LDM3MCwxLDgxLDIsNzEsMTAsNTAsMywxMjMsMiw1NCwxNCwzMiwxMCwzLDEsMTEsMyw0NiwxMCw4LDAsNDYsOSw3LDIsMzcsMTMsMiw5LDYsMSw0NSwwLDEzLDIsNDksMTMsOSwzLDIsMTEsODMsMTEsNywwLDMsMCwxNTgsMTEsNiw5LDcsMyw1NiwxLDIsNiwzLDEsMywyLDEwLDAsMTEsMSwzLDYsNCw0LDE5MywxNywxMCw5LDUsMCw4MiwxOSwxMyw5LDIxNCw2LDMsOCwyOCwxLDgzLDE2LDE2LDksODIsMTIsOSw5LDg0LDE0LDUsOSwyNDMsMTQsMTY2LDksNzEsNSwyLDEsMywzLDIsMCwyLDEsMTMsOSwxMjAsNiwzLDYsNCwwLDI5LDksNDEsNiwyLDMsOSwwLDEwLDEwLDQ3LDE1LDQwNiw3LDIsNywxNyw5LDU3LDIxLDIsMTMsMTIzLDUsNCwwLDIsMSwyLDYsMiwwLDksOSw0OSw0LDIsMSwyLDQsOSw5LDMzMCwzLDEwLDEsMiwwLDQ5LDYsNCw0LDE0LDksNTM1MSwwLDcsMTQsMTM4MzUsOSw4Nyw5LDM5LDQsNjAsNiwyNiw5LDEwMTQsMCwyLDU0LDgsMyw4MiwwLDEyLDEsMTk2MjgsMSw0NzA2LDQ1LDMsMjIsNTQzLDQsNCw1LDksNywzLDYsMzEsMywxNDksMiwxNDE4LDQ5LDUxMyw1NCw1LDQ5LDksMCwxNSwwLDIzLDQsMiwxNCwxMzYxLDYsMiwxNiwzLDYsMiwxLDIsNCwxMDEsMCwxNjEsNiwxMCw5LDM1NywwLDYyLDEzLDQ5OSwxMyw5ODMsNiwxMTAsNiw2LDksNDc1OSw5LDc4NzcxOSwyMzldLEtsPVswLDExLDIsMjUsMiwxOCwyLDEsMiwxNCwzLDEzLDM1LDEyMiw3MCw1MiwyNjgsMjgsNCw0OCw0OCwzMSwxNCwyOSw2LDM3LDExLDI5LDMsMzUsNSw3LDIsNCw0MywxNTcsMTksMzUsNSwzNSw1LDM5LDksNTEsMTMsMTAsMiwxNCwyLDYsMiwxLDIsMTAsMiwxNCwyLDYsMiwxLDY4LDMxMCwxMCwyMSwxMSw3LDI1LDUsMiw0MSwyLDgsNzAsNSwzLDAsMiw0MywyLDEsNCwwLDMsMjIsMTEsMjIsMTAsMzAsNjYsMTgsMiwxLDExLDIxLDExLDI1LDcxLDU1LDcsMSw2NSwwLDE2LDMsMiwyLDIsMjgsNDMsMjgsNCwyOCwzNiw3LDIsMjcsMjgsNTMsMTEsMjEsMTEsMTgsMTQsMTcsMTExLDcyLDU2LDUwLDE0LDUwLDE0LDM1LDM0OSw0MSw3LDEsNzksMjgsMTEsMCw5LDIxLDQzLDE3LDQ3LDIwLDI4LDIyLDEzLDUyLDU4LDEsMywwLDE0LDQ0LDMzLDI0LDI3LDM1LDMwLDAsMywwLDksMzQsNCwwLDEzLDQ3LDE1LDMsMjIsMCwyLDAsMzYsMTcsMiwyNCwyMCwxLDY0LDYsMiwwLDIsMywyLDE0LDIsOSw4LDQ2LDM5LDcsMywxLDMsMjEsMiw2LDIsMSwyLDQsNCwwLDE5LDAsMTMsNCwxNTksNTIsMTksMywyMSwyLDMxLDQ3LDIxLDEsMiwwLDE4NSw0Niw0MiwzLDM3LDQ3LDIxLDAsNjAsNDIsMTQsMCw3MiwyNiwzOCw2LDE4Niw0MywxMTcsNjMsMzIsNywzLDAsMyw3LDIsMSwyLDIzLDE2LDAsMiwwLDk1LDcsMywzOCwxNywwLDIsMCwyOSwwLDExLDM5LDgsMCwyMiwwLDEyLDQ1LDIwLDAsMTksNzIsMjY0LDgsMiwzNiwxOCwwLDUwLDI5LDExMyw2LDIsMSwyLDM3LDIyLDAsMjYsNSwyLDEsMiwzMSwxNSwwLDMyOCwxOCwxNiwwLDIsMTIsMiwzMywxMjUsMCw4MCw5MjEsMTAzLDExMCwxOCwxOTUsMjYzNyw5NiwxNiwxMDcxLDE4LDUsNDAyNiw1ODIsODYzNCw1NjgsOCwzMCwxOCw3OCwxOCwyOSwxOSw0NywxNywzLDMyLDIwLDYsMTgsNjg5LDYzLDEyOSw3NCw2LDAsNjcsMTIsNjUsMSwyLDAsMjksNjEzNSw5LDEyMzcsNDMsOCw4OTM2LDMsMiw2LDIsMSwyLDI5MCwxNiwwLDMwLDIsMywwLDE1LDMsOSwzOTUsMjMwOSwxMDYsNiwxMiw0LDgsOCw5LDU5OTEsODQsMiw3MCwyLDEsMywwLDMsMSwzLDMsMiwxMSwyLDAsMiw2LDIsNjQsMiwzLDMsNywyLDYsMiwyNywyLDMsMiw0LDIsMCw0LDYsMiwzMzksMywyNCwyLDI0LDIsMzAsMiwyNCwyLDMwLDIsMjQsMiwzMCwyLDI0LDIsMzAsMiwyNCwyLDcsMTg0NSwzMCw3LDUsMjYyLDYxLDE0Nyw0NCwxMSw2LDE3LDAsMzIyLDI5LDE5LDQzLDQ4NSwyNyw3NTcsNiwyLDMsMiwxLDIsMTQsMiwxOTYsNjAsNjcsOCwwLDEyMDUsMywyLDI2LDIsMSwyLDAsMywwLDIsOSwyLDMsMiwwLDIsMCw3LDAsNSwwLDIsMCwyLDAsMiwyLDIsMSwyLDAsMywwLDIsMCwyLDAsMiwwLDIsMCwyLDEsMiwwLDMsMywyLDYsMiwzLDIsMywyLDAsMiw5LDIsMTYsNiwyLDIsNCwyLDE2LDQ0MjEsNDI3MTksMzMsNDE1Myw3LDIyMSwzLDU3NjEsMTUsNzQ3MiwzMTA0LDU0MSwxNTA3LDQ5MzgsNiw0MTkxXSxZbD0iwqrCtcK6w4Atw5bDmC3DtsO4LcuBy4Yty5HLoC3LpMusy67NsC3NtM22zbfNui3Nvc2/zobOiC3Ois6Mzo4tzqHOoy3Ptc+3LdKB0oot1K/UsS3VltWZ1aAt1ojXkC3XqtevLdey2KAt2YrZrtmv2bEt25Pbldul26bbrtuv27ot27zbv9yQ3JIt3K/djS3epd6x34ot36rftN+137rgoIAt4KCV4KCa4KCk4KCo4KGALeChmOChoC3goargobAt4KKH4KKJLeCijuCioC3go4ngpIQt4KS54KS94KWQ4KWYLeCloeClsS3gpoDgpoUt4KaM4KaP4KaQ4KaTLeCmqOCmqi3gprDgprLgprYt4Ka54Ka94KeO4Kec4Ked4KefLeCnoeCnsOCnseCnvOCohS3gqIrgqI/gqJDgqJMt4Kio4KiqLeCosOCosuCos+CoteCotuCouOCoueCpmS3gqZzgqZ7gqbIt4Km04KqFLeCqjeCqjy3gqpHgqpMt4Kqo4KqqLeCqsOCqsuCqs+CqtS3gqrngqr3gq5Dgq6Dgq6Hgq7ngrIUt4KyM4KyP4KyQ4KyTLeCsqOCsqi3grLDgrLLgrLPgrLUt4Ky54Ky94K2c4K2d4K2fLeCtoeCtseCug+CuhS3grorgro4t4K6Q4K6SLeCuleCumeCumuCunOCunuCun+Cuo+CupOCuqC3grqrgrq4t4K654K+Q4LCFLeCwjOCwji3gsJDgsJIt4LCo4LCqLeCwueCwveCxmC3gsZrgsZ3gsaDgsaHgsoDgsoUt4LKM4LKOLeCykOCyki3gsqjgsqot4LKz4LK1LeCyueCyveCzneCznuCzoOCzoeCzseCzsuC0hC3gtIzgtI4t4LSQ4LSSLeC0uuC0veC1juC1lC3gtZbgtZ8t4LWh4LW6LeC1v+C2hS3gtpbgtpot4Lax4LazLeC2u+C2veC3gC3gt4bguIEt4Liw4Liy4Liz4LmALeC5huC6geC6guC6hOC6hi3guorguowt4Lqj4Lql4LqnLeC6sOC6suC6s+C6veC7gC3gu4Tgu4bgu5wt4Luf4LyA4L2ALeC9h+C9iS3gvazgvogt4L6M4YCALeGAquGAv+GBkC3hgZXhgZot4YGd4YGh4YGl4YGm4YGuLeGBsOGBtS3hgoHhgo7hgqAt4YOF4YOH4YON4YOQLeGDuuGDvC3hiYjhiYot4YmN4YmQLeGJluGJmOGJmi3hiZ3hiaAt4YqI4YqKLeGKjeGKkC3hirDhirIt4Yq14Yq4LeGKvuGLgOGLgi3hi4Xhi4gt4YuW4YuYLeGMkOGMki3hjJXhjJgt4Y2a4Y6ALeGOj+GOoC3hj7Xhj7gt4Y+94ZCBLeGZrOGZry3hmb/hmoEt4Zqa4ZqgLeGbquGbri3hm7jhnIAt4ZyR4ZyfLeGcseGdgC3hnZHhnaAt4Z2s4Z2uLeGdsOGegC3hnrPhn5fhn5zhoKAt4aG44aKALeGiqOGiquGisC3ho7XhpIAt4aSe4aWQLeGlreGlsC3hpbThpoAt4aar4aawLeGnieGogC3hqJbhqKAt4amU4aqn4ayFLeGss+GthS3hrYzhroMt4a6g4a6u4a6v4a66LeGvpeGwgC3hsKPhsY0t4bGP4bGaLeGxveGygC3hsojhspAt4bK64bK9LeGyv+GzqS3hs6zhs64t4bOz4bO14bO24bO64bSALeG2v+G4gC3hvJXhvJgt4byd4bygLeG9heG9iC3hvY3hvZAt4b2X4b2Z4b2b4b2d4b2fLeG9veG+gC3hvrThvrYt4b684b6+4b+CLeG/hOG/hi3hv4zhv5At4b+T4b+WLeG/m+G/oC3hv6zhv7It4b+04b+2LeG/vOKBseKBv+KCkC3igpzihILihIfihIot4oST4oSV4oSYLeKEneKEpOKEpuKEqOKEqi3ihLnihLwt4oS/4oWFLeKFieKFjuKFoC3ihojisIAt4rOk4rOrLeKzruKzsuKzs+K0gC3itKXitKfitK3itLAt4rWn4rWv4raALeK2luK2oC3itqbitqgt4rau4rawLeK2tuK2uC3itr7it4At4reG4reILeK3juK3kC3it5bit5gt4ree44CFLeOAh+OAoS3jgKnjgLEt44C144C4LeOAvOOBgS3jgpbjgpst44Kf44KhLeODuuODvC3jg7/jhIUt44Sv44SxLeOGjuOGoC3jhr/jh7At44e/45CALeS2v+S4gC3qkozqk5At6pO96pSALeqYjOqYkC3qmJ/qmKrqmKvqmYAt6pmu6pm/LeqaneqaoC3qm6/qnJct6pyf6pyiLeqeiOqeiy3qn4rqn5Dqn5Hqn5Pqn5Ut6p+Z6p+yLeqggeqggy3qoIXqoIct6qCK6qCMLeqgouqhgC3qobPqooIt6qKz6qOyLeqjt+qju+qjveqjvuqkii3qpKXqpLAt6qWG6qWgLeqlvOqmhC3qprLqp4/qp6At6qek6qemLeqnr+qnui3qp77qqIAt6qio6qmALeqpguqphC3qqYvqqaAt6qm26qm66qm+Leqqr+qqseqqteqqtuqquS3qqr3qq4Dqq4Lqq5st6qud6qugLeqrquqrsi3qq7TqrIEt6qyG6qyJLeqsjuqskS3qrJbqrKAt6qym6qyoLeqsruqssC3qrZrqrZwt6q2p6q2wLeqvouqwgC3tnqPtnrAt7Z+G7Z+LLe2fu++kgC3vqa3vqbAt76uZ76yALe+shu+sky3vrJfvrJ3vrJ8t76yo76yqLe+stu+suC3vrLzvrL7vrYDvrYHvrYPvrYTvrYYt766x76+TLe+0ve+1kC3vto/vtpIt77eH77ewLe+3u++5sC3vubTvubYt77u877yhLe+8uu+9gS3vvZrvvaYt776+77+CLe+/h++/ii3vv4/vv5It77+X77+aLe+/nCIsWGw9ezM6ImFic3RyYWN0IGJvb2xlYW4gYnl0ZSBjaGFyIGNsYXNzIGRvdWJsZSBlbnVtIGV4cG9ydCBleHRlbmRzIGZpbmFsIGZsb2F0IGdvdG8gaW1wbGVtZW50cyBpbXBvcnQgaW50IGludGVyZmFjZSBsb25nIG5hdGl2ZSBwYWNrYWdlIHByaXZhdGUgcHJvdGVjdGVkIHB1YmxpYyBzaG9ydCBzdGF0aWMgc3VwZXIgc3luY2hyb25pemVkIHRocm93cyB0cmFuc2llbnQgdm9sYXRpbGUiLDU6ImNsYXNzIGVudW0gZXh0ZW5kcyBzdXBlciBjb25zdCBleHBvcnQgaW1wb3J0Iiw2OiJlbnVtIixzdHJpY3Q6ImltcGxlbWVudHMgaW50ZXJmYWNlIGxldCBwYWNrYWdlIHByaXZhdGUgcHJvdGVjdGVkIHB1YmxpYyBzdGF0aWMgeWllbGQiLHN0cmljdEJpbmQ6ImV2YWwgYXJndW1lbnRzIn0sUWw9ImJyZWFrIGNhc2UgY2F0Y2ggY29udGludWUgZGVidWdnZXIgZGVmYXVsdCBkbyBlbHNlIGZpbmFsbHkgZm9yIGZ1bmN0aW9uIGlmIHJldHVybiBzd2l0Y2ggdGhyb3cgdHJ5IHZhciB3aGlsZSB3aXRoIG51bGwgdHJ1ZSBmYWxzZSBpbnN0YW5jZW9mIHR5cGVvZiB2b2lkIGRlbGV0ZSBuZXcgaW4gdGhpcyIsWmw9ezU6UWwsIjVtb2R1bGUiOlFsKyIgZXhwb3J0IGltcG9ydCIsNjpRbCsiIGNvbnN0IGNsYXNzIGV4dGVuZHMgZXhwb3J0IGltcG9ydCBzdXBlciJ9LEpsPS9eaW4oc3RhbmNlb2YpPyQvLGVjPW5ldyBSZWdFeHAoIlsiK1lsKyJdIiksdGM9bmV3IFJlZ0V4cCgiWyIrWWwrIuKAjOKAjcK3zIAtza/Oh9KDLdKH1pEt1r3Wv9eB14LXhNeF14fYkC3YmtmLLdmp2bDbli3bnNufLduk26fbqNuqLdut27At27nckdywLd2K3qYt3rDfgC3fid+rLd+z373goJYt4KCZ4KCbLeCgo+CgpS3goKfgoKkt4KCt4KGZLeChm+CimC3gop/go4ot4KOh4KOjLeCkg+Ckui3gpLzgpL4t4KWP4KWRLeCll+ClouClo+Clpi3gpa/gpoEt4KaD4Ka84Ka+LeCnhOCnh+CniOCniy3gp43gp5fgp6Lgp6Pgp6Yt4Kev4Ke+4KiBLeCog+CovOCovi3gqYLgqYfgqYjgqYst4KmN4KmR4KmmLeCpseCpteCqgS3gqoPgqrzgqr4t4KuF4KuHLeCrieCriy3gq43gq6Lgq6Pgq6Yt4Kuv4Ku6LeCrv+CsgS3grIPgrLzgrL4t4K2E4K2H4K2I4K2LLeCtjeCtlS3grZfgraLgraPgraYt4K2v4K6C4K6+LeCvguCvhi3gr4jgr4ot4K+N4K+X4K+mLeCvr+CwgC3gsITgsLzgsL4t4LGE4LGGLeCxiOCxii3gsY3gsZXgsZbgsaLgsaPgsaYt4LGv4LKBLeCyg+CyvOCyvi3gs4Tgs4Yt4LOI4LOKLeCzjeCzleCzluCzouCzo+Czpi3gs6/gs7PgtIAt4LSD4LS74LS84LS+LeC1hOC1hi3gtYjgtYot4LWN4LWX4LWi4LWj4LWmLeC1r+C2gS3gtoPgt4rgt48t4LeU4LeW4LeYLeC3n+C3pi3gt6/gt7Lgt7PguLHguLQt4Li64LmHLeC5juC5kC3guZngurHgurQt4Lq84LuILeC7juC7kC3gu5ngvJjgvJngvKAt4Lyp4Ly14Ly34Ly54Ly+4Ly/4L2xLeC+hOC+huC+h+C+jS3gvpfgvpkt4L684L+G4YCrLeGAvuGBgC3hgYnhgZYt4YGZ4YGeLeGBoOGBoi3hgaThgact4YGt4YGxLeGBtOGCgi3hgo3hgo8t4YKd4Y2dLeGNn+GNqS3hjbHhnJIt4ZyV4ZyyLeGctOGdkuGdk+GdsuGds+GetC3hn5Phn53hn6At4Z+p4aCLLeGgjeGgjy3hoJnhoqnhpKAt4aSr4aSwLeGku+Glhi3hpY/hp5At4aea4aiXLeGom+GplS3hqZ7hqaAt4am84am/LeGqieGqkC3hqpnhqrAt4aq94aq/LeGrjuGsgC3hrIThrLQt4a2E4a2QLeGtmeGtqy3hrbPhroAt4a6C4a6hLeGureGusC3hrrnhr6Yt4a+z4bCkLeGwt+GxgC3hsYnhsZAt4bGZ4bOQLeGzkuGzlC3hs6jhs63hs7Ths7ct4bO54beALeG3v+KAv+KBgOKBlOKDkC3ig5zig6Hig6Ut4oOw4rOvLeKzseK1v+K3oC3it7/jgKot44Cv44KZ44Ka6pigLeqYqeqZr+qZtC3qmb3qmp7qmp/qm7Dqm7HqoILqoIbqoIvqoKMt6qCn6qCs6qKA6qKB6qK0LeqjheqjkC3qo5nqo6At6qOx6qO/Leqkieqkpi3qpK3qpYct6qWT6qaALeqmg+qmsy3qp4Dqp5At6qeZ6qel6qewLeqnueqoqS3qqLbqqYPqqYzqqY3qqZAt6qmZ6qm7LeqpveqqsOqqsi3qqrTqqrfqqrjqqr7qqr/qq4Hqq6st6quv6qu16qu26q+jLeqvquqvrOqvreqvsC3qr7nvrJ7vuIAt77iP77igLe+4r++4s++4tO+5jS3vuY/vvJAt77yZ77y/XSIpO2Z1bmN0aW9uIHNjKGUsdCl7Zm9yKHZhciBzPTY1NTM2LGk9MDtpPHQubGVuZ3RoO2krPTIpe2lmKChzKz10W2ldKT5lKXJldHVybiAhMTtpZigocys9dFtpKzFdKT49ZSlyZXR1cm4gITB9cmV0dXJuICExfWZ1bmN0aW9uIGljKGUsdCl7cmV0dXJuIGU8NjU/MzY9PT1lOmU8OTF8fChlPDk3Pzk1PT09ZTplPDEyM3x8KGU8PTY1NTM1P2U+PTE3MCYmZWMudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGUpKTohMSE9PXQmJnNjKGUsS2wpKSl9ZnVuY3Rpb24gbmMoZSx0KXtyZXR1cm4gZTw0OD8zNj09PWU6ZTw1OHx8IShlPDY1KSYmKGU8OTF8fChlPDk3Pzk1PT09ZTplPDEyM3x8KGU8PTY1NTM1P2U+PTE3MCYmdGMudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGUpKTohMSE9PXQmJihzYyhlLEtsKXx8c2MoZSxIbCkpKSkpfXZhciByYz1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PXt9KSx0aGlzLmxhYmVsPWUsdGhpcy5rZXl3b3JkPXQua2V5d29yZCx0aGlzLmJlZm9yZUV4cHI9ISF0LmJlZm9yZUV4cHIsdGhpcy5zdGFydHNFeHByPSEhdC5zdGFydHNFeHByLHRoaXMuaXNMb29wPSEhdC5pc0xvb3AsdGhpcy5pc0Fzc2lnbj0hIXQuaXNBc3NpZ24sdGhpcy5wcmVmaXg9ISF0LnByZWZpeCx0aGlzLnBvc3RmaXg9ISF0LnBvc3RmaXgsdGhpcy5iaW5vcD10LmJpbm9wfHxudWxsLHRoaXMudXBkYXRlQ29udGV4dD1udWxsO307ZnVuY3Rpb24gb2MoZSx0KXtyZXR1cm4gbmV3IHJjKGUse2JlZm9yZUV4cHI6ITAsYmlub3A6dH0pfXZhciBhYz17YmVmb3JlRXhwcjohMH0sbGM9e3N0YXJ0c0V4cHI6ITB9LGNjPXt9O2Z1bmN0aW9uIGhjKGUsdCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PXt9KSx0LmtleXdvcmQ9ZSxjY1tlXT1uZXcgcmMoZSx0KX12YXIgdWM9e251bTpuZXcgcmMoIm51bSIsbGMpLHJlZ2V4cDpuZXcgcmMoInJlZ2V4cCIsbGMpLHN0cmluZzpuZXcgcmMoInN0cmluZyIsbGMpLG5hbWU6bmV3IHJjKCJuYW1lIixsYykscHJpdmF0ZUlkOm5ldyByYygicHJpdmF0ZUlkIixsYyksZW9mOm5ldyByYygiZW9mIiksYnJhY2tldEw6bmV3IHJjKCJbIix7YmVmb3JlRXhwcjohMCxzdGFydHNFeHByOiEwfSksYnJhY2tldFI6bmV3IHJjKCJdIiksYnJhY2VMOm5ldyByYygieyIse2JlZm9yZUV4cHI6ITAsc3RhcnRzRXhwcjohMH0pLGJyYWNlUjpuZXcgcmMoIn0iKSxwYXJlbkw6bmV3IHJjKCIoIix7YmVmb3JlRXhwcjohMCxzdGFydHNFeHByOiEwfSkscGFyZW5SOm5ldyByYygiKSIpLGNvbW1hOm5ldyByYygiLCIsYWMpLHNlbWk6bmV3IHJjKCI7IixhYyksY29sb246bmV3IHJjKCI6IixhYyksZG90Om5ldyByYygiLiIpLHF1ZXN0aW9uOm5ldyByYygiPyIsYWMpLHF1ZXN0aW9uRG90Om5ldyByYygiPy4iKSxhcnJvdzpuZXcgcmMoIj0+IixhYyksdGVtcGxhdGU6bmV3IHJjKCJ0ZW1wbGF0ZSIpLGludmFsaWRUZW1wbGF0ZTpuZXcgcmMoImludmFsaWRUZW1wbGF0ZSIpLGVsbGlwc2lzOm5ldyByYygiLi4uIixhYyksYmFja1F1b3RlOm5ldyByYygiYCIsbGMpLGRvbGxhckJyYWNlTDpuZXcgcmMoIiR7Iix7YmVmb3JlRXhwcjohMCxzdGFydHNFeHByOiEwfSksZXE6bmV3IHJjKCI9Iix7YmVmb3JlRXhwcjohMCxpc0Fzc2lnbjohMH0pLGFzc2lnbjpuZXcgcmMoIl89Iix7YmVmb3JlRXhwcjohMCxpc0Fzc2lnbjohMH0pLGluY0RlYzpuZXcgcmMoIisrLy0tIix7cHJlZml4OiEwLHBvc3RmaXg6ITAsc3RhcnRzRXhwcjohMH0pLHByZWZpeDpuZXcgcmMoIiEvfiIse2JlZm9yZUV4cHI6ITAscHJlZml4OiEwLHN0YXJ0c0V4cHI6ITB9KSxsb2dpY2FsT1I6b2MoInx8IiwxKSxsb2dpY2FsQU5EOm9jKCImJiIsMiksYml0d2lzZU9SOm9jKCJ8IiwzKSxiaXR3aXNlWE9SOm9jKCJeIiw0KSxiaXR3aXNlQU5EOm9jKCImIiw1KSxlcXVhbGl0eTpvYygiPT0vIT0vPT09LyE9PSIsNikscmVsYXRpb25hbDpvYygiPC8+Lzw9Lz49Iiw3KSxiaXRTaGlmdDpvYygiPDwvPj4vPj4+Iiw4KSxwbHVzTWluOm5ldyByYygiKy8tIix7YmVmb3JlRXhwcjohMCxiaW5vcDo5LHByZWZpeDohMCxzdGFydHNFeHByOiEwfSksbW9kdWxvOm9jKCIlIiwxMCksc3RhcjpvYygiKiIsMTApLHNsYXNoOm9jKCIvIiwxMCksc3RhcnN0YXI6bmV3IHJjKCIqKiIse2JlZm9yZUV4cHI6ITB9KSxjb2FsZXNjZTpvYygiPz8iLDEpLF9icmVhazpoYygiYnJlYWsiKSxfY2FzZTpoYygiY2FzZSIsYWMpLF9jYXRjaDpoYygiY2F0Y2giKSxfY29udGludWU6aGMoImNvbnRpbnVlIiksX2RlYnVnZ2VyOmhjKCJkZWJ1Z2dlciIpLF9kZWZhdWx0OmhjKCJkZWZhdWx0IixhYyksX2RvOmhjKCJkbyIse2lzTG9vcDohMCxiZWZvcmVFeHByOiEwfSksX2Vsc2U6aGMoImVsc2UiLGFjKSxfZmluYWxseTpoYygiZmluYWxseSIpLF9mb3I6aGMoImZvciIse2lzTG9vcDohMH0pLF9mdW5jdGlvbjpoYygiZnVuY3Rpb24iLGxjKSxfaWY6aGMoImlmIiksX3JldHVybjpoYygicmV0dXJuIixhYyksX3N3aXRjaDpoYygic3dpdGNoIiksX3Rocm93OmhjKCJ0aHJvdyIsYWMpLF90cnk6aGMoInRyeSIpLF92YXI6aGMoInZhciIpLF9jb25zdDpoYygiY29uc3QiKSxfd2hpbGU6aGMoIndoaWxlIix7aXNMb29wOiEwfSksX3dpdGg6aGMoIndpdGgiKSxfbmV3OmhjKCJuZXciLHtiZWZvcmVFeHByOiEwLHN0YXJ0c0V4cHI6ITB9KSxfdGhpczpoYygidGhpcyIsbGMpLF9zdXBlcjpoYygic3VwZXIiLGxjKSxfY2xhc3M6aGMoImNsYXNzIixsYyksX2V4dGVuZHM6aGMoImV4dGVuZHMiLGFjKSxfZXhwb3J0OmhjKCJleHBvcnQiKSxfaW1wb3J0OmhjKCJpbXBvcnQiLGxjKSxfbnVsbDpoYygibnVsbCIsbGMpLF90cnVlOmhjKCJ0cnVlIixsYyksX2ZhbHNlOmhjKCJmYWxzZSIsbGMpLF9pbjpoYygiaW4iLHtiZWZvcmVFeHByOiEwLGJpbm9wOjd9KSxfaW5zdGFuY2VvZjpoYygiaW5zdGFuY2VvZiIse2JlZm9yZUV4cHI6ITAsYmlub3A6N30pLF90eXBlb2Y6aGMoInR5cGVvZiIse2JlZm9yZUV4cHI6ITAscHJlZml4OiEwLHN0YXJ0c0V4cHI6ITB9KSxfdm9pZDpoYygidm9pZCIse2JlZm9yZUV4cHI6ITAscHJlZml4OiEwLHN0YXJ0c0V4cHI6ITB9KSxfZGVsZXRlOmhjKCJkZWxldGUiLHtiZWZvcmVFeHByOiEwLHByZWZpeDohMCxzdGFydHNFeHByOiEwfSl9LGRjPS9cclxuP3xcbnxcdTIwMjh8XHUyMDI5LyxwYz1uZXcgUmVnRXhwKGRjLnNvdXJjZSwiZyIpO2Z1bmN0aW9uIGZjKGUpe3JldHVybiAxMD09PWV8fDEzPT09ZXx8ODIzMj09PWV8fDgyMzM9PT1lfWZ1bmN0aW9uIG1jKGUsdCxzKXt2b2lkIDA9PT1zJiYocz1lLmxlbmd0aCk7Zm9yKHZhciBpPXQ7aTxzO2krKyl7dmFyIG49ZS5jaGFyQ29kZUF0KGkpO2lmKGZjKG4pKXJldHVybiBpPHMtMSYmMTM9PT1uJiYxMD09PWUuY2hhckNvZGVBdChpKzEpP2krMjppKzF9cmV0dXJuIC0xfXZhciBnYz0vW1x1MTY4MFx1MjAwMC1cdTIwMGFcdTIwMmZcdTIwNWZcdTMwMDBcdWZlZmZdLyx5Yz0vKD86XHN8XC9cLy4qfFwvXCpbXl0qP1wqXC8pKi9nLHhjPU9iamVjdC5wcm90b3R5cGUsRWM9eGMuaGFzT3duUHJvcGVydHksYmM9eGMudG9TdHJpbmcsdmM9T2JqZWN0Lmhhc093bnx8ZnVuY3Rpb24oZSx0KXtyZXR1cm4gRWMuY2FsbChlLHQpfSxTYz1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihlKXtyZXR1cm4gIltvYmplY3QgQXJyYXldIj09PWJjLmNhbGwoZSl9O2Z1bmN0aW9uIEFjKGUpe3JldHVybiBuZXcgUmVnRXhwKCJeKD86IitlLnJlcGxhY2UoLyAvZywifCIpKyIpJCIpfWZ1bmN0aW9uIGtjKGUpe3JldHVybiBlPD02NTUzNT9TdHJpbmcuZnJvbUNoYXJDb2RlKGUpOihlLT02NTUzNixTdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2KyhlPj4xMCksNTYzMjArKDEwMjMmZSkpKX12YXIgSWM9Lyg/OltcdUQ4MDAtXHVEQkZGXSg/IVtcdURDMDAtXHVERkZGXSl8KD86W15cdUQ4MDAtXHVEQkZGXXxeKVtcdURDMDAtXHVERkZGXSkvLHdjPWZ1bmN0aW9uKGUsdCl7dGhpcy5saW5lPWUsdGhpcy5jb2x1bW49dDt9O3djLnByb3RvdHlwZS5vZmZzZXQ9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyB3Yyh0aGlzLmxpbmUsdGhpcy5jb2x1bW4rZSl9O3ZhciBQYz1mdW5jdGlvbihlLHQscyl7dGhpcy5zdGFydD10LHRoaXMuZW5kPXMsbnVsbCE9PWUuc291cmNlRmlsZSYmKHRoaXMuc291cmNlPWUuc291cmNlRmlsZSk7fTtmdW5jdGlvbiBDYyhlLHQpe2Zvcih2YXIgcz0xLGk9MDs7KXt2YXIgbj1tYyhlLGksdCk7aWYobjwwKXJldHVybiBuZXcgd2Mocyx0LWkpOysrcyxpPW47fX12YXIgJGM9e2VjbWFWZXJzaW9uOm51bGwsc291cmNlVHlwZToic2NyaXB0Iixvbkluc2VydGVkU2VtaWNvbG9uOm51bGwsb25UcmFpbGluZ0NvbW1hOm51bGwsYWxsb3dSZXNlcnZlZDpudWxsLGFsbG93UmV0dXJuT3V0c2lkZUZ1bmN0aW9uOiExLGFsbG93SW1wb3J0RXhwb3J0RXZlcnl3aGVyZTohMSxhbGxvd0F3YWl0T3V0c2lkZUZ1bmN0aW9uOm51bGwsYWxsb3dTdXBlck91dHNpZGVNZXRob2Q6bnVsbCxhbGxvd0hhc2hCYW5nOiExLGNoZWNrUHJpdmF0ZUZpZWxkczohMCxsb2NhdGlvbnM6ITEsb25Ub2tlbjpudWxsLG9uQ29tbWVudDpudWxsLHJhbmdlczohMSxwcm9ncmFtOm51bGwsc291cmNlRmlsZTpudWxsLGRpcmVjdFNvdXJjZUZpbGU6bnVsbCxwcmVzZXJ2ZVBhcmVuczohMX0sTmM9ITE7ZnVuY3Rpb24gX2MoZSl7dmFyIHQ9e307Zm9yKHZhciBzIGluICRjKXRbc109ZSYmdmMoZSxzKT9lW3NdOiRjW3NdO2lmKCJsYXRlc3QiPT09dC5lY21hVmVyc2lvbj90LmVjbWFWZXJzaW9uPTFlODpudWxsPT10LmVjbWFWZXJzaW9uPyghTmMmJiJvYmplY3QiPT10eXBlb2YgY29uc29sZSYmY29uc29sZS53YXJuJiYoTmM9ITAsY29uc29sZS53YXJuKCJTaW5jZSBBY29ybiA4LjAuMCwgb3B0aW9ucy5lY21hVmVyc2lvbiBpcyByZXF1aXJlZC5cbkRlZmF1bHRpbmcgdG8gMjAyMCwgYnV0IHRoaXMgd2lsbCBzdG9wIHdvcmtpbmcgaW4gdGhlIGZ1dHVyZS4iKSksdC5lY21hVmVyc2lvbj0xMSk6dC5lY21hVmVyc2lvbj49MjAxNSYmKHQuZWNtYVZlcnNpb24tPTIwMDkpLG51bGw9PXQuYWxsb3dSZXNlcnZlZCYmKHQuYWxsb3dSZXNlcnZlZD10LmVjbWFWZXJzaW9uPDUpLGUmJm51bGwhPWUuYWxsb3dIYXNoQmFuZ3x8KHQuYWxsb3dIYXNoQmFuZz10LmVjbWFWZXJzaW9uPj0xNCksU2ModC5vblRva2VuKSl7dmFyIGk9dC5vblRva2VuO3Qub25Ub2tlbj1mdW5jdGlvbihlKXtyZXR1cm4gaS5wdXNoKGUpfTt9cmV0dXJuIFNjKHQub25Db21tZW50KSYmKHQub25Db21tZW50PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGZ1bmN0aW9uKHMsaSxuLHIsbyxhKXt2YXIgbD17dHlwZTpzPyJCbG9jayI6IkxpbmUiLHZhbHVlOmksc3RhcnQ6bixlbmQ6cn07ZS5sb2NhdGlvbnMmJihsLmxvYz1uZXcgUGModGhpcyxvLGEpKSxlLnJhbmdlcyYmKGwucmFuZ2U9W24scl0pLHQucHVzaChsKTt9fSh0LHQub25Db21tZW50KSksdH12YXIgUmM9MjU2O2Z1bmN0aW9uIE1jKGUsdCl7cmV0dXJuIDJ8KGU/NDowKXwodD84OjApfXZhciBPYz1mdW5jdGlvbihlLHQscyl7dGhpcy5vcHRpb25zPWU9X2MoZSksdGhpcy5zb3VyY2VGaWxlPWUuc291cmNlRmlsZSx0aGlzLmtleXdvcmRzPUFjKFpsW2UuZWNtYVZlcnNpb24+PTY/NjoibW9kdWxlIj09PWUuc291cmNlVHlwZT8iNW1vZHVsZSI6NV0pO3ZhciBpPSIiOyEwIT09ZS5hbGxvd1Jlc2VydmVkJiYoaT1YbFtlLmVjbWFWZXJzaW9uPj02PzY6NT09PWUuZWNtYVZlcnNpb24/NTozXSwibW9kdWxlIj09PWUuc291cmNlVHlwZSYmKGkrPSIgYXdhaXQiKSksdGhpcy5yZXNlcnZlZFdvcmRzPUFjKGkpO3ZhciBuPShpP2krIiAiOiIiKStYbC5zdHJpY3Q7dGhpcy5yZXNlcnZlZFdvcmRzU3RyaWN0PUFjKG4pLHRoaXMucmVzZXJ2ZWRXb3Jkc1N0cmljdEJpbmQ9QWMobisiICIrWGwuc3RyaWN0QmluZCksdGhpcy5pbnB1dD1TdHJpbmcodCksdGhpcy5jb250YWluc0VzYz0hMSxzPyh0aGlzLnBvcz1zLHRoaXMubGluZVN0YXJ0PXRoaXMuaW5wdXQubGFzdEluZGV4T2YoIlxuIixzLTEpKzEsdGhpcy5jdXJMaW5lPXRoaXMuaW5wdXQuc2xpY2UoMCx0aGlzLmxpbmVTdGFydCkuc3BsaXQoZGMpLmxlbmd0aCk6KHRoaXMucG9zPXRoaXMubGluZVN0YXJ0PTAsdGhpcy5jdXJMaW5lPTEpLHRoaXMudHlwZT11Yy5lb2YsdGhpcy52YWx1ZT1udWxsLHRoaXMuc3RhcnQ9dGhpcy5lbmQ9dGhpcy5wb3MsdGhpcy5zdGFydExvYz10aGlzLmVuZExvYz10aGlzLmN1clBvc2l0aW9uKCksdGhpcy5sYXN0VG9rRW5kTG9jPXRoaXMubGFzdFRva1N0YXJ0TG9jPW51bGwsdGhpcy5sYXN0VG9rU3RhcnQ9dGhpcy5sYXN0VG9rRW5kPXRoaXMucG9zLHRoaXMuY29udGV4dD10aGlzLmluaXRpYWxDb250ZXh0KCksdGhpcy5leHByQWxsb3dlZD0hMCx0aGlzLmluTW9kdWxlPSJtb2R1bGUiPT09ZS5zb3VyY2VUeXBlLHRoaXMuc3RyaWN0PXRoaXMuaW5Nb2R1bGV8fHRoaXMuc3RyaWN0RGlyZWN0aXZlKHRoaXMucG9zKSx0aGlzLnBvdGVudGlhbEFycm93QXQ9LTEsdGhpcy5wb3RlbnRpYWxBcnJvd0luRm9yQXdhaXQ9ITEsdGhpcy55aWVsZFBvcz10aGlzLmF3YWl0UG9zPXRoaXMuYXdhaXRJZGVudFBvcz0wLHRoaXMubGFiZWxzPVtdLHRoaXMudW5kZWZpbmVkRXhwb3J0cz1PYmplY3QuY3JlYXRlKG51bGwpLDA9PT10aGlzLnBvcyYmZS5hbGxvd0hhc2hCYW5nJiYiIyEiPT09dGhpcy5pbnB1dC5zbGljZSgwLDIpJiZ0aGlzLnNraXBMaW5lQ29tbWVudCgyKSx0aGlzLnNjb3BlU3RhY2s9W10sdGhpcy5lbnRlclNjb3BlKDEpLHRoaXMucmVnZXhwU3RhdGU9bnVsbCx0aGlzLnByaXZhdGVOYW1lU3RhY2s9W107fSxEYz17aW5GdW5jdGlvbjp7Y29uZmlndXJhYmxlOiEwfSxpbkdlbmVyYXRvcjp7Y29uZmlndXJhYmxlOiEwfSxpbkFzeW5jOntjb25maWd1cmFibGU6ITB9LGNhbkF3YWl0Ontjb25maWd1cmFibGU6ITB9LGFsbG93U3VwZXI6e2NvbmZpZ3VyYWJsZTohMH0sYWxsb3dEaXJlY3RTdXBlcjp7Y29uZmlndXJhYmxlOiEwfSx0cmVhdEZ1bmN0aW9uc0FzVmFyOntjb25maWd1cmFibGU6ITB9LGFsbG93TmV3RG90VGFyZ2V0Ontjb25maWd1cmFibGU6ITB9LGluQ2xhc3NTdGF0aWNCbG9jazp7Y29uZmlndXJhYmxlOiEwfX07T2MucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcHRpb25zLnByb2dyYW18fHRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMubmV4dFRva2VuKCksdGhpcy5wYXJzZVRvcExldmVsKGUpfSxEYy5pbkZ1bmN0aW9uLmdldD1mdW5jdGlvbigpe3JldHVybiAoMiZ0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmZsYWdzKT4wfSxEYy5pbkdlbmVyYXRvci5nZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gKDgmdGhpcy5jdXJyZW50VmFyU2NvcGUoKS5mbGFncyk+MCYmIXRoaXMuY3VycmVudFZhclNjb3BlKCkuaW5DbGFzc0ZpZWxkSW5pdH0sRGMuaW5Bc3luYy5nZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gKDQmdGhpcy5jdXJyZW50VmFyU2NvcGUoKS5mbGFncyk+MCYmIXRoaXMuY3VycmVudFZhclNjb3BlKCkuaW5DbGFzc0ZpZWxkSW5pdH0sRGMuY2FuQXdhaXQuZ2V0PWZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuc2NvcGVTdGFjay5sZW5ndGgtMTtlPj0wO2UtLSl7dmFyIHQ9dGhpcy5zY29wZVN0YWNrW2VdO2lmKHQuaW5DbGFzc0ZpZWxkSW5pdHx8dC5mbGFncyZSYylyZXR1cm4gITE7aWYoMiZ0LmZsYWdzKXJldHVybiAoNCZ0LmZsYWdzKT4wfXJldHVybiB0aGlzLmluTW9kdWxlJiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEzfHx0aGlzLm9wdGlvbnMuYWxsb3dBd2FpdE91dHNpZGVGdW5jdGlvbn0sRGMuYWxsb3dTdXBlci5nZXQ9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmN1cnJlbnRUaGlzU2NvcGUoKSx0PWUuZmxhZ3Mscz1lLmluQ2xhc3NGaWVsZEluaXQ7cmV0dXJuICg2NCZ0KT4wfHxzfHx0aGlzLm9wdGlvbnMuYWxsb3dTdXBlck91dHNpZGVNZXRob2R9LERjLmFsbG93RGlyZWN0U3VwZXIuZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuICgxMjgmdGhpcy5jdXJyZW50VGhpc1Njb3BlKCkuZmxhZ3MpPjB9LERjLnRyZWF0RnVuY3Rpb25zQXNWYXIuZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudHJlYXRGdW5jdGlvbnNBc1ZhckluU2NvcGUodGhpcy5jdXJyZW50U2NvcGUoKSl9LERjLmFsbG93TmV3RG90VGFyZ2V0LmdldD1mdW5jdGlvbigpe3ZhciBlPXRoaXMuY3VycmVudFRoaXNTY29wZSgpLHQ9ZS5mbGFncyxzPWUuaW5DbGFzc0ZpZWxkSW5pdDtyZXR1cm4gKDI1OCZ0KT4wfHxzfSxEYy5pbkNsYXNzU3RhdGljQmxvY2suZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuICh0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmZsYWdzJlJjKT4wfSxPYy5leHRlbmQ9ZnVuY3Rpb24oKXtmb3IodmFyIGU9W10sdD1hcmd1bWVudHMubGVuZ3RoO3QtLTspZVt0XT1hcmd1bWVudHNbdF07Zm9yKHZhciBzPXRoaXMsaT0wO2k8ZS5sZW5ndGg7aSsrKXM9ZVtpXShzKTtyZXR1cm4gc30sT2MucGFyc2U9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IHRoaXModCxlKS5wYXJzZSgpfSxPYy5wYXJzZUV4cHJlc3Npb25BdD1mdW5jdGlvbihlLHQscyl7dmFyIGk9bmV3IHRoaXMocyxlLHQpO3JldHVybiBpLm5leHRUb2tlbigpLGkucGFyc2VFeHByZXNzaW9uKCl9LE9jLnRva2VuaXplcj1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgdGhpcyh0LGUpfSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPYy5wcm90b3R5cGUsRGMpO3ZhciBMYz1PYy5wcm90b3R5cGUsVGM9L14oPzonKCg/OlxcLnxbXidcXF0pKj8pJ3wiKCg/OlxcLnxbXiJcXF0pKj8pIikvO0xjLnN0cmljdERpcmVjdGl2ZT1mdW5jdGlvbihlKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248NSlyZXR1cm4gITE7Zm9yKDs7KXt5Yy5sYXN0SW5kZXg9ZSxlKz15Yy5leGVjKHRoaXMuaW5wdXQpWzBdLmxlbmd0aDt2YXIgdD1UYy5leGVjKHRoaXMuaW5wdXQuc2xpY2UoZSkpO2lmKCF0KXJldHVybiAhMTtpZigidXNlIHN0cmljdCI9PT0odFsxXXx8dFsyXSkpe3ljLmxhc3RJbmRleD1lK3RbMF0ubGVuZ3RoO3ZhciBzPXljLmV4ZWModGhpcy5pbnB1dCksaT1zLmluZGV4K3NbMF0ubGVuZ3RoLG49dGhpcy5pbnB1dC5jaGFyQXQoaSk7cmV0dXJuICI7Ij09PW58fCJ9Ij09PW58fGRjLnRlc3Qoc1swXSkmJiEoL1soYC5bK1wtLyolPD49LD9eJl0vLnRlc3Qobil8fCIhIj09PW4mJiI9Ij09PXRoaXMuaW5wdXQuY2hhckF0KGkrMSkpfWUrPXRbMF0ubGVuZ3RoLHljLmxhc3RJbmRleD1lLGUrPXljLmV4ZWModGhpcy5pbnB1dClbMF0ubGVuZ3RoLCI7Ij09PXRoaXMuaW5wdXRbZV0mJmUrKzt9fSxMYy5lYXQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMudHlwZT09PWUmJih0aGlzLm5leHQoKSwhMCl9LExjLmlzQ29udGV4dHVhbD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy50eXBlPT09dWMubmFtZSYmdGhpcy52YWx1ZT09PWUmJiF0aGlzLmNvbnRhaW5zRXNjfSxMYy5lYXRDb250ZXh0dWFsPWZ1bmN0aW9uKGUpe3JldHVybiAhIXRoaXMuaXNDb250ZXh0dWFsKGUpJiYodGhpcy5uZXh0KCksITApfSxMYy5leHBlY3RDb250ZXh0dWFsPWZ1bmN0aW9uKGUpe3RoaXMuZWF0Q29udGV4dHVhbChlKXx8dGhpcy51bmV4cGVjdGVkKCk7fSxMYy5jYW5JbnNlcnRTZW1pY29sb249ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50eXBlPT09dWMuZW9mfHx0aGlzLnR5cGU9PT11Yy5icmFjZVJ8fGRjLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsdGhpcy5zdGFydCkpfSxMYy5pbnNlcnRTZW1pY29sb249ZnVuY3Rpb24oKXtpZih0aGlzLmNhbkluc2VydFNlbWljb2xvbigpKXJldHVybiB0aGlzLm9wdGlvbnMub25JbnNlcnRlZFNlbWljb2xvbiYmdGhpcy5vcHRpb25zLm9uSW5zZXJ0ZWRTZW1pY29sb24odGhpcy5sYXN0VG9rRW5kLHRoaXMubGFzdFRva0VuZExvYyksITB9LExjLnNlbWljb2xvbj1mdW5jdGlvbigpe3RoaXMuZWF0KHVjLnNlbWkpfHx0aGlzLmluc2VydFNlbWljb2xvbigpfHx0aGlzLnVuZXhwZWN0ZWQoKTt9LExjLmFmdGVyVHJhaWxpbmdDb21tYT1mdW5jdGlvbihlLHQpe2lmKHRoaXMudHlwZT09PWUpcmV0dXJuIHRoaXMub3B0aW9ucy5vblRyYWlsaW5nQ29tbWEmJnRoaXMub3B0aW9ucy5vblRyYWlsaW5nQ29tbWEodGhpcy5sYXN0VG9rU3RhcnQsdGhpcy5sYXN0VG9rU3RhcnRMb2MpLHR8fHRoaXMubmV4dCgpLCEwfSxMYy5leHBlY3Q9ZnVuY3Rpb24oZSl7dGhpcy5lYXQoZSl8fHRoaXMudW5leHBlY3RlZCgpO30sTGMudW5leHBlY3RlZD1mdW5jdGlvbihlKXt0aGlzLnJhaXNlKG51bGwhPWU/ZTp0aGlzLnN0YXJ0LCJVbmV4cGVjdGVkIHRva2VuIik7fTt2YXIgVmM9ZnVuY3Rpb24oKXt0aGlzLnNob3J0aGFuZEFzc2lnbj10aGlzLnRyYWlsaW5nQ29tbWE9dGhpcy5wYXJlbnRoZXNpemVkQXNzaWduPXRoaXMucGFyZW50aGVzaXplZEJpbmQ9dGhpcy5kb3VibGVQcm90bz0tMTt9O0xjLmNoZWNrUGF0dGVybkVycm9ycz1mdW5jdGlvbihlLHQpe2lmKGUpe2UudHJhaWxpbmdDb21tYT4tMSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUudHJhaWxpbmdDb21tYSwiQ29tbWEgaXMgbm90IHBlcm1pdHRlZCBhZnRlciB0aGUgcmVzdCBlbGVtZW50Iik7dmFyIHM9dD9lLnBhcmVudGhlc2l6ZWRBc3NpZ246ZS5wYXJlbnRoZXNpemVkQmluZDtzPi0xJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUocyx0PyJBc3NpZ25pbmcgdG8gcnZhbHVlIjoiUGFyZW50aGVzaXplZCBwYXR0ZXJuIik7fX0sTGMuY2hlY2tFeHByZXNzaW9uRXJyb3JzPWZ1bmN0aW9uKGUsdCl7aWYoIWUpcmV0dXJuICExO3ZhciBzPWUuc2hvcnRoYW5kQXNzaWduLGk9ZS5kb3VibGVQcm90bztpZighdClyZXR1cm4gcz49MHx8aT49MDtzPj0wJiZ0aGlzLnJhaXNlKHMsIlNob3J0aGFuZCBwcm9wZXJ0eSBhc3NpZ25tZW50cyBhcmUgdmFsaWQgb25seSBpbiBkZXN0cnVjdHVyaW5nIHBhdHRlcm5zIiksaT49MCYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGksIlJlZGVmaW5pdGlvbiBvZiBfX3Byb3RvX18gcHJvcGVydHkiKTt9LExjLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcz1mdW5jdGlvbigpe3RoaXMueWllbGRQb3MmJighdGhpcy5hd2FpdFBvc3x8dGhpcy55aWVsZFBvczx0aGlzLmF3YWl0UG9zKSYmdGhpcy5yYWlzZSh0aGlzLnlpZWxkUG9zLCJZaWVsZCBleHByZXNzaW9uIGNhbm5vdCBiZSBhIGRlZmF1bHQgdmFsdWUiKSx0aGlzLmF3YWl0UG9zJiZ0aGlzLnJhaXNlKHRoaXMuYXdhaXRQb3MsIkF3YWl0IGV4cHJlc3Npb24gY2Fubm90IGJlIGEgZGVmYXVsdCB2YWx1ZSIpO30sTGMuaXNTaW1wbGVBc3NpZ25UYXJnZXQ9ZnVuY3Rpb24oZSl7cmV0dXJuICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI9PT1lLnR5cGU/dGhpcy5pc1NpbXBsZUFzc2lnblRhcmdldChlLmV4cHJlc3Npb24pOiJJZGVudGlmaWVyIj09PWUudHlwZXx8Ik1lbWJlckV4cHJlc3Npb24iPT09ZS50eXBlfTt2YXIgQmM9T2MucHJvdG90eXBlO0JjLnBhcnNlVG9wTGV2ZWw9ZnVuY3Rpb24oZSl7dmFyIHQ9T2JqZWN0LmNyZWF0ZShudWxsKTtmb3IoZS5ib2R5fHwoZS5ib2R5PVtdKTt0aGlzLnR5cGUhPT11Yy5lb2Y7KXt2YXIgcz10aGlzLnBhcnNlU3RhdGVtZW50KG51bGwsITAsdCk7ZS5ib2R5LnB1c2gocyk7fWlmKHRoaXMuaW5Nb2R1bGUpZm9yKHZhciBpPTAsbj1PYmplY3Qua2V5cyh0aGlzLnVuZGVmaW5lZEV4cG9ydHMpO2k8bi5sZW5ndGg7aSs9MSl7dmFyIHI9bltpXTt0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy51bmRlZmluZWRFeHBvcnRzW3JdLnN0YXJ0LCJFeHBvcnQgJyIrcisiJyBpcyBub3QgZGVmaW5lZCIpO31yZXR1cm4gdGhpcy5hZGFwdERpcmVjdGl2ZVByb2xvZ3VlKGUuYm9keSksdGhpcy5uZXh0KCksZS5zb3VyY2VUeXBlPXRoaXMub3B0aW9ucy5zb3VyY2VUeXBlLHRoaXMuZmluaXNoTm9kZShlLCJQcm9ncmFtIil9O3ZhciB6Yz17a2luZDoibG9vcCJ9LEZjPXtraW5kOiJzd2l0Y2gifTtCYy5pc0xldD1mdW5jdGlvbihlKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248Nnx8IXRoaXMuaXNDb250ZXh0dWFsKCJsZXQiKSlyZXR1cm4gITE7eWMubGFzdEluZGV4PXRoaXMucG9zO3ZhciB0PXljLmV4ZWModGhpcy5pbnB1dCkscz10aGlzLnBvcyt0WzBdLmxlbmd0aCxpPXRoaXMuaW5wdXQuY2hhckNvZGVBdChzKTtpZig5MT09PWl8fDkyPT09aSlyZXR1cm4gITA7aWYoZSlyZXR1cm4gITE7aWYoMTIzPT09aXx8aT41NTI5NSYmaTw1NjMyMClyZXR1cm4gITA7aWYoaWMoaSwhMCkpe2Zvcih2YXIgbj1zKzE7bmMoaT10aGlzLmlucHV0LmNoYXJDb2RlQXQobiksITApOykrK247aWYoOTI9PT1pfHxpPjU1Mjk1JiZpPDU2MzIwKXJldHVybiAhMDt2YXIgcj10aGlzLmlucHV0LnNsaWNlKHMsbik7aWYoIUpsLnRlc3QocikpcmV0dXJuICEwfXJldHVybiAhMX0sQmMuaXNBc3luY0Z1bmN0aW9uPWZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDh8fCF0aGlzLmlzQ29udGV4dHVhbCgiYXN5bmMiKSlyZXR1cm4gITE7eWMubGFzdEluZGV4PXRoaXMucG9zO3ZhciBlLHQ9eWMuZXhlYyh0aGlzLmlucHV0KSxzPXRoaXMucG9zK3RbMF0ubGVuZ3RoO3JldHVybiAhKGRjLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLnBvcyxzKSl8fCJmdW5jdGlvbiIhPT10aGlzLmlucHV0LnNsaWNlKHMscys4KXx8cys4IT09dGhpcy5pbnB1dC5sZW5ndGgmJihuYyhlPXRoaXMuaW5wdXQuY2hhckNvZGVBdChzKzgpKXx8ZT41NTI5NSYmZTw1NjMyMCkpfSxCYy5wYXJzZVN0YXRlbWVudD1mdW5jdGlvbihlLHQscyl7dmFyIGksbj10aGlzLnR5cGUscj10aGlzLnN0YXJ0Tm9kZSgpO3N3aXRjaCh0aGlzLmlzTGV0KGUpJiYobj11Yy5fdmFyLGk9ImxldCIpLG4pe2Nhc2UgdWMuX2JyZWFrOmNhc2UgdWMuX2NvbnRpbnVlOnJldHVybiB0aGlzLnBhcnNlQnJlYWtDb250aW51ZVN0YXRlbWVudChyLG4ua2V5d29yZCk7Y2FzZSB1Yy5fZGVidWdnZXI6cmV0dXJuIHRoaXMucGFyc2VEZWJ1Z2dlclN0YXRlbWVudChyKTtjYXNlIHVjLl9kbzpyZXR1cm4gdGhpcy5wYXJzZURvU3RhdGVtZW50KHIpO2Nhc2UgdWMuX2ZvcjpyZXR1cm4gdGhpcy5wYXJzZUZvclN0YXRlbWVudChyKTtjYXNlIHVjLl9mdW5jdGlvbjpyZXR1cm4gZSYmKHRoaXMuc3RyaWN0fHwiaWYiIT09ZSYmImxhYmVsIiE9PWUpJiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMucGFyc2VGdW5jdGlvblN0YXRlbWVudChyLCExLCFlKTtjYXNlIHVjLl9jbGFzczpyZXR1cm4gZSYmdGhpcy51bmV4cGVjdGVkKCksdGhpcy5wYXJzZUNsYXNzKHIsITApO2Nhc2UgdWMuX2lmOnJldHVybiB0aGlzLnBhcnNlSWZTdGF0ZW1lbnQocik7Y2FzZSB1Yy5fcmV0dXJuOnJldHVybiB0aGlzLnBhcnNlUmV0dXJuU3RhdGVtZW50KHIpO2Nhc2UgdWMuX3N3aXRjaDpyZXR1cm4gdGhpcy5wYXJzZVN3aXRjaFN0YXRlbWVudChyKTtjYXNlIHVjLl90aHJvdzpyZXR1cm4gdGhpcy5wYXJzZVRocm93U3RhdGVtZW50KHIpO2Nhc2UgdWMuX3RyeTpyZXR1cm4gdGhpcy5wYXJzZVRyeVN0YXRlbWVudChyKTtjYXNlIHVjLl9jb25zdDpjYXNlIHVjLl92YXI6cmV0dXJuIGk9aXx8dGhpcy52YWx1ZSxlJiYidmFyIiE9PWkmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMucGFyc2VWYXJTdGF0ZW1lbnQocixpKTtjYXNlIHVjLl93aGlsZTpyZXR1cm4gdGhpcy5wYXJzZVdoaWxlU3RhdGVtZW50KHIpO2Nhc2UgdWMuX3dpdGg6cmV0dXJuIHRoaXMucGFyc2VXaXRoU3RhdGVtZW50KHIpO2Nhc2UgdWMuYnJhY2VMOnJldHVybiB0aGlzLnBhcnNlQmxvY2soITAscik7Y2FzZSB1Yy5zZW1pOnJldHVybiB0aGlzLnBhcnNlRW1wdHlTdGF0ZW1lbnQocik7Y2FzZSB1Yy5fZXhwb3J0OmNhc2UgdWMuX2ltcG9ydDppZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+MTAmJm49PT11Yy5faW1wb3J0KXt5Yy5sYXN0SW5kZXg9dGhpcy5wb3M7dmFyIG89eWMuZXhlYyh0aGlzLmlucHV0KSxhPXRoaXMucG9zK29bMF0ubGVuZ3RoLGw9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KGEpO2lmKDQwPT09bHx8NDY9PT1sKXJldHVybiB0aGlzLnBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChyLHRoaXMucGFyc2VFeHByZXNzaW9uKCkpfXJldHVybiB0aGlzLm9wdGlvbnMuYWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlfHwodHx8dGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCInaW1wb3J0JyBhbmQgJ2V4cG9ydCcgbWF5IG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwiKSx0aGlzLmluTW9kdWxlfHx0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIidpbXBvcnQnIGFuZCAnZXhwb3J0JyBtYXkgYXBwZWFyIG9ubHkgd2l0aCAnc291cmNlVHlwZTogbW9kdWxlJyIpKSxuPT09dWMuX2ltcG9ydD90aGlzLnBhcnNlSW1wb3J0KHIpOnRoaXMucGFyc2VFeHBvcnQocixzKTtkZWZhdWx0OmlmKHRoaXMuaXNBc3luY0Z1bmN0aW9uKCkpcmV0dXJuIGUmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMubmV4dCgpLHRoaXMucGFyc2VGdW5jdGlvblN0YXRlbWVudChyLCEwLCFlKTt2YXIgYz10aGlzLnZhbHVlLGg9dGhpcy5wYXJzZUV4cHJlc3Npb24oKTtyZXR1cm4gbj09PXVjLm5hbWUmJiJJZGVudGlmaWVyIj09PWgudHlwZSYmdGhpcy5lYXQodWMuY29sb24pP3RoaXMucGFyc2VMYWJlbGVkU3RhdGVtZW50KHIsYyxoLGUpOnRoaXMucGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHIsaCl9fSxCYy5wYXJzZUJyZWFrQ29udGludWVTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0KXt2YXIgcz0iYnJlYWsiPT09dDt0aGlzLm5leHQoKSx0aGlzLmVhdCh1Yy5zZW1pKXx8dGhpcy5pbnNlcnRTZW1pY29sb24oKT9lLmxhYmVsPW51bGw6dGhpcy50eXBlIT09dWMubmFtZT90aGlzLnVuZXhwZWN0ZWQoKTooZS5sYWJlbD10aGlzLnBhcnNlSWRlbnQoKSx0aGlzLnNlbWljb2xvbigpKTtmb3IodmFyIGk9MDtpPHRoaXMubGFiZWxzLmxlbmd0aDsrK2kpe3ZhciBuPXRoaXMubGFiZWxzW2ldO2lmKG51bGw9PWUubGFiZWx8fG4ubmFtZT09PWUubGFiZWwubmFtZSl7aWYobnVsbCE9bi5raW5kJiYoc3x8Imxvb3AiPT09bi5raW5kKSlicmVhaztpZihlLmxhYmVsJiZzKWJyZWFrfX1yZXR1cm4gaT09PXRoaXMubGFiZWxzLmxlbmd0aCYmdGhpcy5yYWlzZShlLnN0YXJ0LCJVbnN5bnRhY3RpYyAiK3QpLHRoaXMuZmluaXNoTm9kZShlLHM/IkJyZWFrU3RhdGVtZW50IjoiQ29udGludWVTdGF0ZW1lbnQiKX0sQmMucGFyc2VEZWJ1Z2dlclN0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiRGVidWdnZXJTdGF0ZW1lbnQiKX0sQmMucGFyc2VEb1N0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5sYWJlbHMucHVzaCh6YyksZS5ib2R5PXRoaXMucGFyc2VTdGF0ZW1lbnQoImRvIiksdGhpcy5sYWJlbHMucG9wKCksdGhpcy5leHBlY3QodWMuX3doaWxlKSxlLnRlc3Q9dGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Nj90aGlzLmVhdCh1Yy5zZW1pKTp0aGlzLnNlbWljb2xvbigpLHRoaXMuZmluaXNoTm9kZShlLCJEb1doaWxlU3RhdGVtZW50Iil9LEJjLnBhcnNlRm9yU3RhdGVtZW50PWZ1bmN0aW9uKGUpe3RoaXMubmV4dCgpO3ZhciB0PXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmdGhpcy5jYW5Bd2FpdCYmdGhpcy5lYXRDb250ZXh0dWFsKCJhd2FpdCIpP3RoaXMubGFzdFRva1N0YXJ0Oi0xO2lmKHRoaXMubGFiZWxzLnB1c2goemMpLHRoaXMuZW50ZXJTY29wZSgwKSx0aGlzLmV4cGVjdCh1Yy5wYXJlbkwpLHRoaXMudHlwZT09PXVjLnNlbWkpcmV0dXJuIHQ+LTEmJnRoaXMudW5leHBlY3RlZCh0KSx0aGlzLnBhcnNlRm9yKGUsbnVsbCk7dmFyIHM9dGhpcy5pc0xldCgpO2lmKHRoaXMudHlwZT09PXVjLl92YXJ8fHRoaXMudHlwZT09PXVjLl9jb25zdHx8cyl7dmFyIGk9dGhpcy5zdGFydE5vZGUoKSxuPXM/ImxldCI6dGhpcy52YWx1ZTtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5wYXJzZVZhcihpLCEwLG4pLHRoaXMuZmluaXNoTm9kZShpLCJWYXJpYWJsZURlY2xhcmF0aW9uIiksKHRoaXMudHlwZT09PXVjLl9pbnx8dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZ0aGlzLmlzQ29udGV4dHVhbCgib2YiKSkmJjE9PT1pLmRlY2xhcmF0aW9ucy5sZW5ndGg/KHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmKHRoaXMudHlwZT09PXVjLl9pbj90Pi0xJiZ0aGlzLnVuZXhwZWN0ZWQodCk6ZS5hd2FpdD10Pi0xKSx0aGlzLnBhcnNlRm9ySW4oZSxpKSk6KHQ+LTEmJnRoaXMudW5leHBlY3RlZCh0KSx0aGlzLnBhcnNlRm9yKGUsaSkpfXZhciByPXRoaXMuaXNDb250ZXh0dWFsKCJsZXQiKSxvPSExLGE9bmV3IFZjLGw9dGhpcy5wYXJzZUV4cHJlc3Npb24oISh0Pi0xKXx8ImF3YWl0IixhKTtyZXR1cm4gdGhpcy50eXBlPT09dWMuX2lufHwobz10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJnRoaXMuaXNDb250ZXh0dWFsKCJvZiIpKT8odGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05JiYodGhpcy50eXBlPT09dWMuX2luP3Q+LTEmJnRoaXMudW5leHBlY3RlZCh0KTplLmF3YWl0PXQ+LTEpLHImJm8mJnRoaXMucmFpc2UobC5zdGFydCwiVGhlIGxlZnQtaGFuZCBzaWRlIG9mIGEgZm9yLW9mIGxvb3AgbWF5IG5vdCBzdGFydCB3aXRoICdsZXQnLiIpLHRoaXMudG9Bc3NpZ25hYmxlKGwsITEsYSksdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGwpLHRoaXMucGFyc2VGb3JJbihlLGwpKToodGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMoYSwhMCksdD4tMSYmdGhpcy51bmV4cGVjdGVkKHQpLHRoaXMucGFyc2VGb3IoZSxsKSl9LEJjLnBhcnNlRnVuY3Rpb25TdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiB0aGlzLm5leHQoKSx0aGlzLnBhcnNlRnVuY3Rpb24oZSxVY3wocz8wOkdjKSwhMSx0KX0sQmMucGFyc2VJZlN0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksZS50ZXN0PXRoaXMucGFyc2VQYXJlbkV4cHJlc3Npb24oKSxlLmNvbnNlcXVlbnQ9dGhpcy5wYXJzZVN0YXRlbWVudCgiaWYiKSxlLmFsdGVybmF0ZT10aGlzLmVhdCh1Yy5fZWxzZSk/dGhpcy5wYXJzZVN0YXRlbWVudCgiaWYiKTpudWxsLHRoaXMuZmluaXNoTm9kZShlLCJJZlN0YXRlbWVudCIpfSxCYy5wYXJzZVJldHVyblN0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5pbkZ1bmN0aW9ufHx0aGlzLm9wdGlvbnMuYWxsb3dSZXR1cm5PdXRzaWRlRnVuY3Rpb258fHRoaXMucmFpc2UodGhpcy5zdGFydCwiJ3JldHVybicgb3V0c2lkZSBvZiBmdW5jdGlvbiIpLHRoaXMubmV4dCgpLHRoaXMuZWF0KHVjLnNlbWkpfHx0aGlzLmluc2VydFNlbWljb2xvbigpP2UuYXJndW1lbnQ9bnVsbDooZS5hcmd1bWVudD10aGlzLnBhcnNlRXhwcmVzc2lvbigpLHRoaXMuc2VtaWNvbG9uKCkpLHRoaXMuZmluaXNoTm9kZShlLCJSZXR1cm5TdGF0ZW1lbnQiKX0sQmMucGFyc2VTd2l0Y2hTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7dmFyIHQ7dGhpcy5uZXh0KCksZS5kaXNjcmltaW5hbnQ9dGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpLGUuY2FzZXM9W10sdGhpcy5leHBlY3QodWMuYnJhY2VMKSx0aGlzLmxhYmVscy5wdXNoKEZjKSx0aGlzLmVudGVyU2NvcGUoMCk7Zm9yKHZhciBzPSExO3RoaXMudHlwZSE9PXVjLmJyYWNlUjspaWYodGhpcy50eXBlPT09dWMuX2Nhc2V8fHRoaXMudHlwZT09PXVjLl9kZWZhdWx0KXt2YXIgaT10aGlzLnR5cGU9PT11Yy5fY2FzZTt0JiZ0aGlzLmZpbmlzaE5vZGUodCwiU3dpdGNoQ2FzZSIpLGUuY2FzZXMucHVzaCh0PXRoaXMuc3RhcnROb2RlKCkpLHQuY29uc2VxdWVudD1bXSx0aGlzLm5leHQoKSxpP3QudGVzdD10aGlzLnBhcnNlRXhwcmVzc2lvbigpOihzJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5sYXN0VG9rU3RhcnQsIk11bHRpcGxlIGRlZmF1bHQgY2xhdXNlcyIpLHM9ITAsdC50ZXN0PW51bGwpLHRoaXMuZXhwZWN0KHVjLmNvbG9uKTt9ZWxzZSB0fHx0aGlzLnVuZXhwZWN0ZWQoKSx0LmNvbnNlcXVlbnQucHVzaCh0aGlzLnBhcnNlU3RhdGVtZW50KG51bGwpKTtyZXR1cm4gdGhpcy5leGl0U2NvcGUoKSx0JiZ0aGlzLmZpbmlzaE5vZGUodCwiU3dpdGNoQ2FzZSIpLHRoaXMubmV4dCgpLHRoaXMubGFiZWxzLnBvcCgpLHRoaXMuZmluaXNoTm9kZShlLCJTd2l0Y2hTdGF0ZW1lbnQiKX0sQmMucGFyc2VUaHJvd1N0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksZGMudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCx0aGlzLnN0YXJ0KSkmJnRoaXMucmFpc2UodGhpcy5sYXN0VG9rRW5kLCJJbGxlZ2FsIG5ld2xpbmUgYWZ0ZXIgdGhyb3ciKSxlLmFyZ3VtZW50PXRoaXMucGFyc2VFeHByZXNzaW9uKCksdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiVGhyb3dTdGF0ZW1lbnQiKX07dmFyIGpjPVtdO0JjLnBhcnNlQ2F0Y2hDbGF1c2VQYXJhbT1mdW5jdGlvbigpe3ZhciBlPXRoaXMucGFyc2VCaW5kaW5nQXRvbSgpLHQ9IklkZW50aWZpZXIiPT09ZS50eXBlO3JldHVybiB0aGlzLmVudGVyU2NvcGUodD8zMjowKSx0aGlzLmNoZWNrTFZhbFBhdHRlcm4oZSx0PzQ6MiksdGhpcy5leHBlY3QodWMucGFyZW5SKSxlfSxCYy5wYXJzZVRyeVN0YXRlbWVudD1mdW5jdGlvbihlKXtpZih0aGlzLm5leHQoKSxlLmJsb2NrPXRoaXMucGFyc2VCbG9jaygpLGUuaGFuZGxlcj1udWxsLHRoaXMudHlwZT09PXVjLl9jYXRjaCl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTt0aGlzLm5leHQoKSx0aGlzLmVhdCh1Yy5wYXJlbkwpP3QucGFyYW09dGhpcy5wYXJzZUNhdGNoQ2xhdXNlUGFyYW0oKToodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDEwJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0LnBhcmFtPW51bGwsdGhpcy5lbnRlclNjb3BlKDApKSx0LmJvZHk9dGhpcy5wYXJzZUJsb2NrKCExKSx0aGlzLmV4aXRTY29wZSgpLGUuaGFuZGxlcj10aGlzLmZpbmlzaE5vZGUodCwiQ2F0Y2hDbGF1c2UiKTt9cmV0dXJuIGUuZmluYWxpemVyPXRoaXMuZWF0KHVjLl9maW5hbGx5KT90aGlzLnBhcnNlQmxvY2soKTpudWxsLGUuaGFuZGxlcnx8ZS5maW5hbGl6ZXJ8fHRoaXMucmFpc2UoZS5zdGFydCwiTWlzc2luZyBjYXRjaCBvciBmaW5hbGx5IGNsYXVzZSIpLHRoaXMuZmluaXNoTm9kZShlLCJUcnlTdGF0ZW1lbnQiKX0sQmMucGFyc2VWYXJTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiB0aGlzLm5leHQoKSx0aGlzLnBhcnNlVmFyKGUsITEsdCxzKSx0aGlzLnNlbWljb2xvbigpLHRoaXMuZmluaXNoTm9kZShlLCJWYXJpYWJsZURlY2xhcmF0aW9uIil9LEJjLnBhcnNlV2hpbGVTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLGUudGVzdD10aGlzLnBhcnNlUGFyZW5FeHByZXNzaW9uKCksdGhpcy5sYWJlbHMucHVzaCh6YyksZS5ib2R5PXRoaXMucGFyc2VTdGF0ZW1lbnQoIndoaWxlIiksdGhpcy5sYWJlbHMucG9wKCksdGhpcy5maW5pc2hOb2RlKGUsIldoaWxlU3RhdGVtZW50Iil9LEJjLnBhcnNlV2l0aFN0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5zdHJpY3QmJnRoaXMucmFpc2UodGhpcy5zdGFydCwiJ3dpdGgnIGluIHN0cmljdCBtb2RlIiksdGhpcy5uZXh0KCksZS5vYmplY3Q9dGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpLGUuYm9keT10aGlzLnBhcnNlU3RhdGVtZW50KCJ3aXRoIiksdGhpcy5maW5pc2hOb2RlKGUsIldpdGhTdGF0ZW1lbnQiKX0sQmMucGFyc2VFbXB0eVN0YXRlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5maW5pc2hOb2RlKGUsIkVtcHR5U3RhdGVtZW50Iil9LEJjLnBhcnNlTGFiZWxlZFN0YXRlbWVudD1mdW5jdGlvbihlLHQscyxpKXtmb3IodmFyIG49MCxyPXRoaXMubGFiZWxzO248ci5sZW5ndGg7bis9MSl7cltuXS5uYW1lPT09dCYmdGhpcy5yYWlzZShzLnN0YXJ0LCJMYWJlbCAnIit0KyInIGlzIGFscmVhZHkgZGVjbGFyZWQiKTt9Zm9yKHZhciBvPXRoaXMudHlwZS5pc0xvb3A/Imxvb3AiOnRoaXMudHlwZT09PXVjLl9zd2l0Y2g/InN3aXRjaCI6bnVsbCxhPXRoaXMubGFiZWxzLmxlbmd0aC0xO2E+PTA7YS0tKXt2YXIgbD10aGlzLmxhYmVsc1thXTtpZihsLnN0YXRlbWVudFN0YXJ0IT09ZS5zdGFydClicmVhaztsLnN0YXRlbWVudFN0YXJ0PXRoaXMuc3RhcnQsbC5raW5kPW87fXJldHVybiB0aGlzLmxhYmVscy5wdXNoKHtuYW1lOnQsa2luZDpvLHN0YXRlbWVudFN0YXJ0OnRoaXMuc3RhcnR9KSxlLmJvZHk9dGhpcy5wYXJzZVN0YXRlbWVudChpPy0xPT09aS5pbmRleE9mKCJsYWJlbCIpP2krImxhYmVsIjppOiJsYWJlbCIpLHRoaXMubGFiZWxzLnBvcCgpLGUubGFiZWw9cyx0aGlzLmZpbmlzaE5vZGUoZSwiTGFiZWxlZFN0YXRlbWVudCIpfSxCYy5wYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5leHByZXNzaW9uPXQsdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiRXhwcmVzc2lvblN0YXRlbWVudCIpfSxCYy5wYXJzZUJsb2NrPWZ1bmN0aW9uKGUsdCxzKXtmb3Iodm9pZCAwPT09ZSYmKGU9ITApLHZvaWQgMD09PXQmJih0PXRoaXMuc3RhcnROb2RlKCkpLHQuYm9keT1bXSx0aGlzLmV4cGVjdCh1Yy5icmFjZUwpLGUmJnRoaXMuZW50ZXJTY29wZSgwKTt0aGlzLnR5cGUhPT11Yy5icmFjZVI7KXt2YXIgaT10aGlzLnBhcnNlU3RhdGVtZW50KG51bGwpO3QuYm9keS5wdXNoKGkpO31yZXR1cm4gcyYmKHRoaXMuc3RyaWN0PSExKSx0aGlzLm5leHQoKSxlJiZ0aGlzLmV4aXRTY29wZSgpLHRoaXMuZmluaXNoTm9kZSh0LCJCbG9ja1N0YXRlbWVudCIpfSxCYy5wYXJzZUZvcj1mdW5jdGlvbihlLHQpe3JldHVybiBlLmluaXQ9dCx0aGlzLmV4cGVjdCh1Yy5zZW1pKSxlLnRlc3Q9dGhpcy50eXBlPT09dWMuc2VtaT9udWxsOnRoaXMucGFyc2VFeHByZXNzaW9uKCksdGhpcy5leHBlY3QodWMuc2VtaSksZS51cGRhdGU9dGhpcy50eXBlPT09dWMucGFyZW5SP251bGw6dGhpcy5wYXJzZUV4cHJlc3Npb24oKSx0aGlzLmV4cGVjdCh1Yy5wYXJlblIpLGUuYm9keT10aGlzLnBhcnNlU3RhdGVtZW50KCJmb3IiKSx0aGlzLmV4aXRTY29wZSgpLHRoaXMubGFiZWxzLnBvcCgpLHRoaXMuZmluaXNoTm9kZShlLCJGb3JTdGF0ZW1lbnQiKX0sQmMucGFyc2VGb3JJbj1mdW5jdGlvbihlLHQpe3ZhciBzPXRoaXMudHlwZT09PXVjLl9pbjtyZXR1cm4gdGhpcy5uZXh0KCksIlZhcmlhYmxlRGVjbGFyYXRpb24iPT09dC50eXBlJiZudWxsIT10LmRlY2xhcmF0aW9uc1swXS5pbml0JiYoIXN8fHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjw4fHx0aGlzLnN0cmljdHx8InZhciIhPT10LmtpbmR8fCJJZGVudGlmaWVyIiE9PXQuZGVjbGFyYXRpb25zWzBdLmlkLnR5cGUpJiZ0aGlzLnJhaXNlKHQuc3RhcnQsKHM/ImZvci1pbiI6ImZvci1vZiIpKyIgbG9vcCB2YXJpYWJsZSBkZWNsYXJhdGlvbiBtYXkgbm90IGhhdmUgYW4gaW5pdGlhbGl6ZXIiKSxlLmxlZnQ9dCxlLnJpZ2h0PXM/dGhpcy5wYXJzZUV4cHJlc3Npb24oKTp0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSx0aGlzLmV4cGVjdCh1Yy5wYXJlblIpLGUuYm9keT10aGlzLnBhcnNlU3RhdGVtZW50KCJmb3IiKSx0aGlzLmV4aXRTY29wZSgpLHRoaXMubGFiZWxzLnBvcCgpLHRoaXMuZmluaXNoTm9kZShlLHM/IkZvckluU3RhdGVtZW50IjoiRm9yT2ZTdGF0ZW1lbnQiKX0sQmMucGFyc2VWYXI9ZnVuY3Rpb24oZSx0LHMsaSl7Zm9yKGUuZGVjbGFyYXRpb25zPVtdLGUua2luZD1zOzspe3ZhciBuPXRoaXMuc3RhcnROb2RlKCk7aWYodGhpcy5wYXJzZVZhcklkKG4scyksdGhpcy5lYXQodWMuZXEpP24uaW5pdD10aGlzLnBhcnNlTWF5YmVBc3NpZ24odCk6aXx8ImNvbnN0IiE9PXN8fHRoaXMudHlwZT09PXVjLl9pbnx8dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZ0aGlzLmlzQ29udGV4dHVhbCgib2YiKT9pfHwiSWRlbnRpZmllciI9PT1uLmlkLnR5cGV8fHQmJih0aGlzLnR5cGU9PT11Yy5faW58fHRoaXMuaXNDb250ZXh0dWFsKCJvZiIpKT9uLmluaXQ9bnVsbDp0aGlzLnJhaXNlKHRoaXMubGFzdFRva0VuZCwiQ29tcGxleCBiaW5kaW5nIHBhdHRlcm5zIHJlcXVpcmUgYW4gaW5pdGlhbGl6YXRpb24gdmFsdWUiKTp0aGlzLnVuZXhwZWN0ZWQoKSxlLmRlY2xhcmF0aW9ucy5wdXNoKHRoaXMuZmluaXNoTm9kZShuLCJWYXJpYWJsZURlY2xhcmF0b3IiKSksIXRoaXMuZWF0KHVjLmNvbW1hKSlicmVha31yZXR1cm4gZX0sQmMucGFyc2VWYXJJZD1mdW5jdGlvbihlLHQpe2UuaWQ9dGhpcy5wYXJzZUJpbmRpbmdBdG9tKCksdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGUuaWQsInZhciI9PT10PzE6MiwhMSk7fTt2YXIgVWM9MSxHYz0yO2Z1bmN0aW9uIFdjKGUsdCl7dmFyIHM9dC5rZXkubmFtZSxpPWVbc10sbj0idHJ1ZSI7cmV0dXJuICJNZXRob2REZWZpbml0aW9uIiE9PXQudHlwZXx8ImdldCIhPT10LmtpbmQmJiJzZXQiIT09dC5raW5kfHwobj0odC5zdGF0aWM/InMiOiJpIikrdC5raW5kKSwiaWdldCI9PT1pJiYiaXNldCI9PT1ufHwiaXNldCI9PT1pJiYiaWdldCI9PT1ufHwic2dldCI9PT1pJiYic3NldCI9PT1ufHwic3NldCI9PT1pJiYic2dldCI9PT1uPyhlW3NdPSJ0cnVlIiwhMSk6ISFpfHwoZVtzXT1uLCExKX1mdW5jdGlvbiBxYyhlLHQpe3ZhciBzPWUuY29tcHV0ZWQsaT1lLmtleTtyZXR1cm4gIXMmJigiSWRlbnRpZmllciI9PT1pLnR5cGUmJmkubmFtZT09PXR8fCJMaXRlcmFsIj09PWkudHlwZSYmaS52YWx1ZT09PXQpfUJjLnBhcnNlRnVuY3Rpb249ZnVuY3Rpb24oZSx0LHMsaSxuKXt0aGlzLmluaXRGdW5jdGlvbihlKSwodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05fHx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJiFpKSYmKHRoaXMudHlwZT09PXVjLnN0YXImJnQmR2MmJnRoaXMudW5leHBlY3RlZCgpLGUuZ2VuZXJhdG9yPXRoaXMuZWF0KHVjLnN0YXIpKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgmJihlLmFzeW5jPSEhaSksdCZVYyYmKGUuaWQ9NCZ0JiZ0aGlzLnR5cGUhPT11Yy5uYW1lP251bGw6dGhpcy5wYXJzZUlkZW50KCksIWUuaWR8fHQmR2N8fHRoaXMuY2hlY2tMVmFsU2ltcGxlKGUuaWQsdGhpcy5zdHJpY3R8fGUuZ2VuZXJhdG9yfHxlLmFzeW5jP3RoaXMudHJlYXRGdW5jdGlvbnNBc1Zhcj8xOjI6MykpO3ZhciByPXRoaXMueWllbGRQb3Msbz10aGlzLmF3YWl0UG9zLGE9dGhpcy5hd2FpdElkZW50UG9zO3JldHVybiB0aGlzLnlpZWxkUG9zPTAsdGhpcy5hd2FpdFBvcz0wLHRoaXMuYXdhaXRJZGVudFBvcz0wLHRoaXMuZW50ZXJTY29wZShNYyhlLmFzeW5jLGUuZ2VuZXJhdG9yKSksdCZVY3x8KGUuaWQ9dGhpcy50eXBlPT09dWMubmFtZT90aGlzLnBhcnNlSWRlbnQoKTpudWxsKSx0aGlzLnBhcnNlRnVuY3Rpb25QYXJhbXMoZSksdGhpcy5wYXJzZUZ1bmN0aW9uQm9keShlLHMsITEsbiksdGhpcy55aWVsZFBvcz1yLHRoaXMuYXdhaXRQb3M9byx0aGlzLmF3YWl0SWRlbnRQb3M9YSx0aGlzLmZpbmlzaE5vZGUoZSx0JlVjPyJGdW5jdGlvbkRlY2xhcmF0aW9uIjoiRnVuY3Rpb25FeHByZXNzaW9uIil9LEJjLnBhcnNlRnVuY3Rpb25QYXJhbXM9ZnVuY3Rpb24oZSl7dGhpcy5leHBlY3QodWMucGFyZW5MKSxlLnBhcmFtcz10aGlzLnBhcnNlQmluZGluZ0xpc3QodWMucGFyZW5SLCExLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCksdGhpcy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXMoKTt9LEJjLnBhcnNlQ2xhc3M9ZnVuY3Rpb24oZSx0KXt0aGlzLm5leHQoKTt2YXIgcz10aGlzLnN0cmljdDt0aGlzLnN0cmljdD0hMCx0aGlzLnBhcnNlQ2xhc3NJZChlLHQpLHRoaXMucGFyc2VDbGFzc1N1cGVyKGUpO3ZhciBpPXRoaXMuZW50ZXJDbGFzc0JvZHkoKSxuPXRoaXMuc3RhcnROb2RlKCkscj0hMTtmb3Iobi5ib2R5PVtdLHRoaXMuZXhwZWN0KHVjLmJyYWNlTCk7dGhpcy50eXBlIT09dWMuYnJhY2VSOyl7dmFyIG89dGhpcy5wYXJzZUNsYXNzRWxlbWVudChudWxsIT09ZS5zdXBlckNsYXNzKTtvJiYobi5ib2R5LnB1c2gobyksIk1ldGhvZERlZmluaXRpb24iPT09by50eXBlJiYiY29uc3RydWN0b3IiPT09by5raW5kPyhyJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoby5zdGFydCwiRHVwbGljYXRlIGNvbnN0cnVjdG9yIGluIHRoZSBzYW1lIGNsYXNzIikscj0hMCk6by5rZXkmJiJQcml2YXRlSWRlbnRpZmllciI9PT1vLmtleS50eXBlJiZXYyhpLG8pJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoby5rZXkuc3RhcnQsIklkZW50aWZpZXIgJyMiK28ua2V5Lm5hbWUrIicgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZCIpKTt9cmV0dXJuIHRoaXMuc3RyaWN0PXMsdGhpcy5uZXh0KCksZS5ib2R5PXRoaXMuZmluaXNoTm9kZShuLCJDbGFzc0JvZHkiKSx0aGlzLmV4aXRDbGFzc0JvZHkoKSx0aGlzLmZpbmlzaE5vZGUoZSx0PyJDbGFzc0RlY2xhcmF0aW9uIjoiQ2xhc3NFeHByZXNzaW9uIil9LEJjLnBhcnNlQ2xhc3NFbGVtZW50PWZ1bmN0aW9uKGUpe2lmKHRoaXMuZWF0KHVjLnNlbWkpKXJldHVybiBudWxsO3ZhciB0PXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbixzPXRoaXMuc3RhcnROb2RlKCksaT0iIixuPSExLHI9ITEsbz0ibWV0aG9kIixhPSExO2lmKHRoaXMuZWF0Q29udGV4dHVhbCgic3RhdGljIikpe2lmKHQ+PTEzJiZ0aGlzLmVhdCh1Yy5icmFjZUwpKXJldHVybiB0aGlzLnBhcnNlQ2xhc3NTdGF0aWNCbG9jayhzKSxzO3RoaXMuaXNDbGFzc0VsZW1lbnROYW1lU3RhcnQoKXx8dGhpcy50eXBlPT09dWMuc3Rhcj9hPSEwOmk9InN0YXRpYyI7fWlmKHMuc3RhdGljPWEsIWkmJnQ+PTgmJnRoaXMuZWF0Q29udGV4dHVhbCgiYXN5bmMiKSYmKCF0aGlzLmlzQ2xhc3NFbGVtZW50TmFtZVN0YXJ0KCkmJnRoaXMudHlwZSE9PXVjLnN0YXJ8fHRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCk/aT0iYXN5bmMiOnI9ITApLCFpJiYodD49OXx8IXIpJiZ0aGlzLmVhdCh1Yy5zdGFyKSYmKG49ITApLCFpJiYhciYmIW4pe3ZhciBsPXRoaXMudmFsdWU7KHRoaXMuZWF0Q29udGV4dHVhbCgiZ2V0Iil8fHRoaXMuZWF0Q29udGV4dHVhbCgic2V0IikpJiYodGhpcy5pc0NsYXNzRWxlbWVudE5hbWVTdGFydCgpP289bDppPWwpO31pZihpPyhzLmNvbXB1dGVkPSExLHMua2V5PXRoaXMuc3RhcnROb2RlQXQodGhpcy5sYXN0VG9rU3RhcnQsdGhpcy5sYXN0VG9rU3RhcnRMb2MpLHMua2V5Lm5hbWU9aSx0aGlzLmZpbmlzaE5vZGUocy5rZXksIklkZW50aWZpZXIiKSk6dGhpcy5wYXJzZUNsYXNzRWxlbWVudE5hbWUocyksdDwxM3x8dGhpcy50eXBlPT09dWMucGFyZW5MfHwibWV0aG9kIiE9PW98fG58fHIpe3ZhciBjPSFzLnN0YXRpYyYmcWMocywiY29uc3RydWN0b3IiKSxoPWMmJmU7YyYmIm1ldGhvZCIhPT1vJiZ0aGlzLnJhaXNlKHMua2V5LnN0YXJ0LCJDb25zdHJ1Y3RvciBjYW4ndCBoYXZlIGdldC9zZXQgbW9kaWZpZXIiKSxzLmtpbmQ9Yz8iY29uc3RydWN0b3IiOm8sdGhpcy5wYXJzZUNsYXNzTWV0aG9kKHMsbixyLGgpO31lbHNlIHRoaXMucGFyc2VDbGFzc0ZpZWxkKHMpO3JldHVybiBzfSxCYy5pc0NsYXNzRWxlbWVudE5hbWVTdGFydD1mdW5jdGlvbigpe3JldHVybiB0aGlzLnR5cGU9PT11Yy5uYW1lfHx0aGlzLnR5cGU9PT11Yy5wcml2YXRlSWR8fHRoaXMudHlwZT09PXVjLm51bXx8dGhpcy50eXBlPT09dWMuc3RyaW5nfHx0aGlzLnR5cGU9PT11Yy5icmFja2V0THx8dGhpcy50eXBlLmtleXdvcmR9LEJjLnBhcnNlQ2xhc3NFbGVtZW50TmFtZT1mdW5jdGlvbihlKXt0aGlzLnR5cGU9PT11Yy5wcml2YXRlSWQ/KCJjb25zdHJ1Y3RvciI9PT10aGlzLnZhbHVlJiZ0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIkNsYXNzZXMgY2FuJ3QgaGF2ZSBhbiBlbGVtZW50IG5hbWVkICcjY29uc3RydWN0b3InIiksZS5jb21wdXRlZD0hMSxlLmtleT10aGlzLnBhcnNlUHJpdmF0ZUlkZW50KCkpOnRoaXMucGFyc2VQcm9wZXJ0eU5hbWUoZSk7fSxCYy5wYXJzZUNsYXNzTWV0aG9kPWZ1bmN0aW9uKGUsdCxzLGkpe3ZhciBuPWUua2V5OyJjb25zdHJ1Y3RvciI9PT1lLmtpbmQ/KHQmJnRoaXMucmFpc2Uobi5zdGFydCwiQ29uc3RydWN0b3IgY2FuJ3QgYmUgYSBnZW5lcmF0b3IiKSxzJiZ0aGlzLnJhaXNlKG4uc3RhcnQsIkNvbnN0cnVjdG9yIGNhbid0IGJlIGFuIGFzeW5jIG1ldGhvZCIpKTplLnN0YXRpYyYmcWMoZSwicHJvdG90eXBlIikmJnRoaXMucmFpc2Uobi5zdGFydCwiQ2xhc3NlcyBtYXkgbm90IGhhdmUgYSBzdGF0aWMgcHJvcGVydHkgbmFtZWQgcHJvdG90eXBlIik7dmFyIHI9ZS52YWx1ZT10aGlzLnBhcnNlTWV0aG9kKHQscyxpKTtyZXR1cm4gImdldCI9PT1lLmtpbmQmJjAhPT1yLnBhcmFtcy5sZW5ndGgmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShyLnN0YXJ0LCJnZXR0ZXIgc2hvdWxkIGhhdmUgbm8gcGFyYW1zIiksInNldCI9PT1lLmtpbmQmJjEhPT1yLnBhcmFtcy5sZW5ndGgmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShyLnN0YXJ0LCJzZXR0ZXIgc2hvdWxkIGhhdmUgZXhhY3RseSBvbmUgcGFyYW0iKSwic2V0Ij09PWUua2luZCYmIlJlc3RFbGVtZW50Ij09PXIucGFyYW1zWzBdLnR5cGUmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShyLnBhcmFtc1swXS5zdGFydCwiU2V0dGVyIGNhbm5vdCB1c2UgcmVzdCBwYXJhbXMiKSx0aGlzLmZpbmlzaE5vZGUoZSwiTWV0aG9kRGVmaW5pdGlvbiIpfSxCYy5wYXJzZUNsYXNzRmllbGQ9ZnVuY3Rpb24oZSl7aWYocWMoZSwiY29uc3RydWN0b3IiKT90aGlzLnJhaXNlKGUua2V5LnN0YXJ0LCJDbGFzc2VzIGNhbid0IGhhdmUgYSBmaWVsZCBuYW1lZCAnY29uc3RydWN0b3InIik6ZS5zdGF0aWMmJnFjKGUsInByb3RvdHlwZSIpJiZ0aGlzLnJhaXNlKGUua2V5LnN0YXJ0LCJDbGFzc2VzIGNhbid0IGhhdmUgYSBzdGF0aWMgZmllbGQgbmFtZWQgJ3Byb3RvdHlwZSciKSx0aGlzLmVhdCh1Yy5lcSkpe3ZhciB0PXRoaXMuY3VycmVudFRoaXNTY29wZSgpLHM9dC5pbkNsYXNzRmllbGRJbml0O3QuaW5DbGFzc0ZpZWxkSW5pdD0hMCxlLnZhbHVlPXRoaXMucGFyc2VNYXliZUFzc2lnbigpLHQuaW5DbGFzc0ZpZWxkSW5pdD1zO31lbHNlIGUudmFsdWU9bnVsbDtyZXR1cm4gdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiUHJvcGVydHlEZWZpbml0aW9uIil9LEJjLnBhcnNlQ2xhc3NTdGF0aWNCbG9jaz1mdW5jdGlvbihlKXtlLmJvZHk9W107dmFyIHQ9dGhpcy5sYWJlbHM7Zm9yKHRoaXMubGFiZWxzPVtdLHRoaXMuZW50ZXJTY29wZSgzMjApO3RoaXMudHlwZSE9PXVjLmJyYWNlUjspe3ZhciBzPXRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCk7ZS5ib2R5LnB1c2gocyk7fXJldHVybiB0aGlzLm5leHQoKSx0aGlzLmV4aXRTY29wZSgpLHRoaXMubGFiZWxzPXQsdGhpcy5maW5pc2hOb2RlKGUsIlN0YXRpY0Jsb2NrIil9LEJjLnBhcnNlQ2xhc3NJZD1mdW5jdGlvbihlLHQpe3RoaXMudHlwZT09PXVjLm5hbWU/KGUuaWQ9dGhpcy5wYXJzZUlkZW50KCksdCYmdGhpcy5jaGVja0xWYWxTaW1wbGUoZS5pZCwyLCExKSk6KCEwPT09dCYmdGhpcy51bmV4cGVjdGVkKCksZS5pZD1udWxsKTt9LEJjLnBhcnNlQ2xhc3NTdXBlcj1mdW5jdGlvbihlKXtlLnN1cGVyQ2xhc3M9dGhpcy5lYXQodWMuX2V4dGVuZHMpP3RoaXMucGFyc2VFeHByU3Vic2NyaXB0cyhudWxsLCExKTpudWxsO30sQmMuZW50ZXJDbGFzc0JvZHk9ZnVuY3Rpb24oKXt2YXIgZT17ZGVjbGFyZWQ6T2JqZWN0LmNyZWF0ZShudWxsKSx1c2VkOltdfTtyZXR1cm4gdGhpcy5wcml2YXRlTmFtZVN0YWNrLnB1c2goZSksZS5kZWNsYXJlZH0sQmMuZXhpdENsYXNzQm9keT1mdW5jdGlvbigpe3ZhciBlPXRoaXMucHJpdmF0ZU5hbWVTdGFjay5wb3AoKSx0PWUuZGVjbGFyZWQscz1lLnVzZWQ7aWYodGhpcy5vcHRpb25zLmNoZWNrUHJpdmF0ZUZpZWxkcylmb3IodmFyIGk9dGhpcy5wcml2YXRlTmFtZVN0YWNrLmxlbmd0aCxuPTA9PT1pP251bGw6dGhpcy5wcml2YXRlTmFtZVN0YWNrW2ktMV0scj0wO3I8cy5sZW5ndGg7KytyKXt2YXIgbz1zW3JdO3ZjKHQsby5uYW1lKXx8KG4/bi51c2VkLnB1c2gobyk6dGhpcy5yYWlzZVJlY292ZXJhYmxlKG8uc3RhcnQsIlByaXZhdGUgZmllbGQgJyMiK28ubmFtZSsiJyBtdXN0IGJlIGRlY2xhcmVkIGluIGFuIGVuY2xvc2luZyBjbGFzcyIpKTt9fSxCYy5wYXJzZUV4cG9ydEFsbERlY2xhcmF0aW9uPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTEmJih0aGlzLmVhdENvbnRleHR1YWwoImFzIik/KGUuZXhwb3J0ZWQ9dGhpcy5wYXJzZU1vZHVsZUV4cG9ydE5hbWUoKSx0aGlzLmNoZWNrRXhwb3J0KHQsZS5leHBvcnRlZCx0aGlzLmxhc3RUb2tTdGFydCkpOmUuZXhwb3J0ZWQ9bnVsbCksdGhpcy5leHBlY3RDb250ZXh0dWFsKCJmcm9tIiksdGhpcy50eXBlIT09dWMuc3RyaW5nJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLnNvdXJjZT10aGlzLnBhcnNlRXhwckF0b20oKSx0aGlzLnNlbWljb2xvbigpLHRoaXMuZmluaXNoTm9kZShlLCJFeHBvcnRBbGxEZWNsYXJhdGlvbiIpfSxCYy5wYXJzZUV4cG9ydD1mdW5jdGlvbihlLHQpe2lmKHRoaXMubmV4dCgpLHRoaXMuZWF0KHVjLnN0YXIpKXJldHVybiB0aGlzLnBhcnNlRXhwb3J0QWxsRGVjbGFyYXRpb24oZSx0KTtpZih0aGlzLmVhdCh1Yy5fZGVmYXVsdCkpcmV0dXJuIHRoaXMuY2hlY2tFeHBvcnQodCwiZGVmYXVsdCIsdGhpcy5sYXN0VG9rU3RhcnQpLGUuZGVjbGFyYXRpb249dGhpcy5wYXJzZUV4cG9ydERlZmF1bHREZWNsYXJhdGlvbigpLHRoaXMuZmluaXNoTm9kZShlLCJFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24iKTtpZih0aGlzLnNob3VsZFBhcnNlRXhwb3J0U3RhdGVtZW50KCkpZS5kZWNsYXJhdGlvbj10aGlzLnBhcnNlRXhwb3J0RGVjbGFyYXRpb24oZSksIlZhcmlhYmxlRGVjbGFyYXRpb24iPT09ZS5kZWNsYXJhdGlvbi50eXBlP3RoaXMuY2hlY2tWYXJpYWJsZUV4cG9ydCh0LGUuZGVjbGFyYXRpb24uZGVjbGFyYXRpb25zKTp0aGlzLmNoZWNrRXhwb3J0KHQsZS5kZWNsYXJhdGlvbi5pZCxlLmRlY2xhcmF0aW9uLmlkLnN0YXJ0KSxlLnNwZWNpZmllcnM9W10sZS5zb3VyY2U9bnVsbDtlbHNlIHtpZihlLmRlY2xhcmF0aW9uPW51bGwsZS5zcGVjaWZpZXJzPXRoaXMucGFyc2VFeHBvcnRTcGVjaWZpZXJzKHQpLHRoaXMuZWF0Q29udGV4dHVhbCgiZnJvbSIpKXRoaXMudHlwZSE9PXVjLnN0cmluZyYmdGhpcy51bmV4cGVjdGVkKCksZS5zb3VyY2U9dGhpcy5wYXJzZUV4cHJBdG9tKCk7ZWxzZSB7Zm9yKHZhciBzPTAsaT1lLnNwZWNpZmllcnM7czxpLmxlbmd0aDtzKz0xKXt2YXIgbj1pW3NdO3RoaXMuY2hlY2tVbnJlc2VydmVkKG4ubG9jYWwpLHRoaXMuY2hlY2tMb2NhbEV4cG9ydChuLmxvY2FsKSwiTGl0ZXJhbCI9PT1uLmxvY2FsLnR5cGUmJnRoaXMucmFpc2Uobi5sb2NhbC5zdGFydCwiQSBzdHJpbmcgbGl0ZXJhbCBjYW5ub3QgYmUgdXNlZCBhcyBhbiBleHBvcnRlZCBiaW5kaW5nIHdpdGhvdXQgYGZyb21gLiIpO31lLnNvdXJjZT1udWxsO310aGlzLnNlbWljb2xvbigpO31yZXR1cm4gdGhpcy5maW5pc2hOb2RlKGUsIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iKX0sQmMucGFyc2VFeHBvcnREZWNsYXJhdGlvbj1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5wYXJzZVN0YXRlbWVudChudWxsKX0sQmMucGFyc2VFeHBvcnREZWZhdWx0RGVjbGFyYXRpb249ZnVuY3Rpb24oKXt2YXIgZTtpZih0aGlzLnR5cGU9PT11Yy5fZnVuY3Rpb258fChlPXRoaXMuaXNBc3luY0Z1bmN0aW9uKCkpKXt2YXIgdD10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoKSxlJiZ0aGlzLm5leHQoKSx0aGlzLnBhcnNlRnVuY3Rpb24odCw0fFVjLCExLGUpfWlmKHRoaXMudHlwZT09PXVjLl9jbGFzcyl7dmFyIHM9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5wYXJzZUNsYXNzKHMsIm51bGxhYmxlSUQiKX12YXIgaT10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtyZXR1cm4gdGhpcy5zZW1pY29sb24oKSxpfSxCYy5jaGVja0V4cG9ydD1mdW5jdGlvbihlLHQscyl7ZSYmKCJzdHJpbmciIT10eXBlb2YgdCYmKHQ9IklkZW50aWZpZXIiPT09dC50eXBlP3QubmFtZTp0LnZhbHVlKSx2YyhlLHQpJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUocywiRHVwbGljYXRlIGV4cG9ydCAnIit0KyInIiksZVt0XT0hMCk7fSxCYy5jaGVja1BhdHRlcm5FeHBvcnQ9ZnVuY3Rpb24oZSx0KXt2YXIgcz10LnR5cGU7aWYoIklkZW50aWZpZXIiPT09cyl0aGlzLmNoZWNrRXhwb3J0KGUsdCx0LnN0YXJ0KTtlbHNlIGlmKCJPYmplY3RQYXR0ZXJuIj09PXMpZm9yKHZhciBpPTAsbj10LnByb3BlcnRpZXM7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldO3RoaXMuY2hlY2tQYXR0ZXJuRXhwb3J0KGUscik7fWVsc2UgaWYoIkFycmF5UGF0dGVybiI9PT1zKWZvcih2YXIgbz0wLGE9dC5lbGVtZW50cztvPGEubGVuZ3RoO28rPTEpe3ZhciBsPWFbb107bCYmdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZSxsKTt9ZWxzZSAiUHJvcGVydHkiPT09cz90aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLHQudmFsdWUpOiJBc3NpZ25tZW50UGF0dGVybiI9PT1zP3RoaXMuY2hlY2tQYXR0ZXJuRXhwb3J0KGUsdC5sZWZ0KToiUmVzdEVsZW1lbnQiPT09cz90aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLHQuYXJndW1lbnQpOiJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI9PT1zJiZ0aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLHQuZXhwcmVzc2lvbik7fSxCYy5jaGVja1ZhcmlhYmxlRXhwb3J0PWZ1bmN0aW9uKGUsdCl7aWYoZSlmb3IodmFyIHM9MCxpPXQ7czxpLmxlbmd0aDtzKz0xKXt2YXIgbj1pW3NdO3RoaXMuY2hlY2tQYXR0ZXJuRXhwb3J0KGUsbi5pZCk7fX0sQmMuc2hvdWxkUGFyc2VFeHBvcnRTdGF0ZW1lbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gInZhciI9PT10aGlzLnR5cGUua2V5d29yZHx8ImNvbnN0Ij09PXRoaXMudHlwZS5rZXl3b3JkfHwiY2xhc3MiPT09dGhpcy50eXBlLmtleXdvcmR8fCJmdW5jdGlvbiI9PT10aGlzLnR5cGUua2V5d29yZHx8dGhpcy5pc0xldCgpfHx0aGlzLmlzQXN5bmNGdW5jdGlvbigpfSxCYy5wYXJzZUV4cG9ydFNwZWNpZmllcj1mdW5jdGlvbihlKXt2YXIgdD10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0LmxvY2FsPXRoaXMucGFyc2VNb2R1bGVFeHBvcnROYW1lKCksdC5leHBvcnRlZD10aGlzLmVhdENvbnRleHR1YWwoImFzIik/dGhpcy5wYXJzZU1vZHVsZUV4cG9ydE5hbWUoKTp0LmxvY2FsLHRoaXMuY2hlY2tFeHBvcnQoZSx0LmV4cG9ydGVkLHQuZXhwb3J0ZWQuc3RhcnQpLHRoaXMuZmluaXNoTm9kZSh0LCJFeHBvcnRTcGVjaWZpZXIiKX0sQmMucGFyc2VFeHBvcnRTcGVjaWZpZXJzPWZ1bmN0aW9uKGUpe3ZhciB0PVtdLHM9ITA7Zm9yKHRoaXMuZXhwZWN0KHVjLmJyYWNlTCk7IXRoaXMuZWF0KHVjLmJyYWNlUik7KXtpZihzKXM9ITE7ZWxzZSBpZih0aGlzLmV4cGVjdCh1Yy5jb21tYSksdGhpcy5hZnRlclRyYWlsaW5nQ29tbWEodWMuYnJhY2VSKSlicmVhazt0LnB1c2godGhpcy5wYXJzZUV4cG9ydFNwZWNpZmllcihlKSk7fXJldHVybiB0fSxCYy5wYXJzZUltcG9ydD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy50eXBlPT09dWMuc3RyaW5nPyhlLnNwZWNpZmllcnM9amMsZS5zb3VyY2U9dGhpcy5wYXJzZUV4cHJBdG9tKCkpOihlLnNwZWNpZmllcnM9dGhpcy5wYXJzZUltcG9ydFNwZWNpZmllcnMoKSx0aGlzLmV4cGVjdENvbnRleHR1YWwoImZyb20iKSxlLnNvdXJjZT10aGlzLnR5cGU9PT11Yy5zdHJpbmc/dGhpcy5wYXJzZUV4cHJBdG9tKCk6dGhpcy51bmV4cGVjdGVkKCkpLHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydERlY2xhcmF0aW9uIil9LEJjLnBhcnNlSW1wb3J0U3BlY2lmaWVyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gZS5pbXBvcnRlZD10aGlzLnBhcnNlTW9kdWxlRXhwb3J0TmFtZSgpLHRoaXMuZWF0Q29udGV4dHVhbCgiYXMiKT9lLmxvY2FsPXRoaXMucGFyc2VJZGVudCgpOih0aGlzLmNoZWNrVW5yZXNlcnZlZChlLmltcG9ydGVkKSxlLmxvY2FsPWUuaW1wb3J0ZWQpLHRoaXMuY2hlY2tMVmFsU2ltcGxlKGUubG9jYWwsMiksdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydFNwZWNpZmllciIpfSxCYy5wYXJzZUltcG9ydERlZmF1bHRTcGVjaWZpZXI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiBlLmxvY2FsPXRoaXMucGFyc2VJZGVudCgpLHRoaXMuY2hlY2tMVmFsU2ltcGxlKGUubG9jYWwsMiksdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydERlZmF1bHRTcGVjaWZpZXIiKX0sQmMucGFyc2VJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoKSx0aGlzLmV4cGVjdENvbnRleHR1YWwoImFzIiksZS5sb2NhbD10aGlzLnBhcnNlSWRlbnQoKSx0aGlzLmNoZWNrTFZhbFNpbXBsZShlLmxvY2FsLDIpLHRoaXMuZmluaXNoTm9kZShlLCJJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIiKX0sQmMucGFyc2VJbXBvcnRTcGVjaWZpZXJzPWZ1bmN0aW9uKCl7dmFyIGU9W10sdD0hMDtpZih0aGlzLnR5cGU9PT11Yy5uYW1lJiYoZS5wdXNoKHRoaXMucGFyc2VJbXBvcnREZWZhdWx0U3BlY2lmaWVyKCkpLCF0aGlzLmVhdCh1Yy5jb21tYSkpKXJldHVybiBlO2lmKHRoaXMudHlwZT09PXVjLnN0YXIpcmV0dXJuIGUucHVzaCh0aGlzLnBhcnNlSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyKCkpLGU7Zm9yKHRoaXMuZXhwZWN0KHVjLmJyYWNlTCk7IXRoaXMuZWF0KHVjLmJyYWNlUik7KXtpZih0KXQ9ITE7ZWxzZSBpZih0aGlzLmV4cGVjdCh1Yy5jb21tYSksdGhpcy5hZnRlclRyYWlsaW5nQ29tbWEodWMuYnJhY2VSKSlicmVhaztlLnB1c2godGhpcy5wYXJzZUltcG9ydFNwZWNpZmllcigpKTt9cmV0dXJuIGV9LEJjLnBhcnNlTW9kdWxlRXhwb3J0TmFtZT1mdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTMmJnRoaXMudHlwZT09PXVjLnN0cmluZyl7dmFyIGU9dGhpcy5wYXJzZUxpdGVyYWwodGhpcy52YWx1ZSk7cmV0dXJuIEljLnRlc3QoZS52YWx1ZSkmJnRoaXMucmFpc2UoZS5zdGFydCwiQW4gZXhwb3J0IG5hbWUgY2Fubm90IGluY2x1ZGUgYSBsb25lIHN1cnJvZ2F0ZS4iKSxlfXJldHVybiB0aGlzLnBhcnNlSWRlbnQoITApfSxCYy5hZGFwdERpcmVjdGl2ZVByb2xvZ3VlPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wO3Q8ZS5sZW5ndGgmJnRoaXMuaXNEaXJlY3RpdmVDYW5kaWRhdGUoZVt0XSk7Kyt0KWVbdF0uZGlyZWN0aXZlPWVbdF0uZXhwcmVzc2lvbi5yYXcuc2xpY2UoMSwtMSk7fSxCYy5pc0RpcmVjdGl2ZUNhbmRpZGF0ZT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj01JiYiRXhwcmVzc2lvblN0YXRlbWVudCI9PT1lLnR5cGUmJiJMaXRlcmFsIj09PWUuZXhwcmVzc2lvbi50eXBlJiYic3RyaW5nIj09dHlwZW9mIGUuZXhwcmVzc2lvbi52YWx1ZSYmKCciJz09PXRoaXMuaW5wdXRbZS5zdGFydF18fCInIj09PXRoaXMuaW5wdXRbZS5zdGFydF0pfTt2YXIgSGM9T2MucHJvdG90eXBlO0hjLnRvQXNzaWduYWJsZT1mdW5jdGlvbihlLHQscyl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZlKXN3aXRjaChlLnR5cGUpe2Nhc2UiSWRlbnRpZmllciI6dGhpcy5pbkFzeW5jJiYiYXdhaXQiPT09ZS5uYW1lJiZ0aGlzLnJhaXNlKGUuc3RhcnQsIkNhbm5vdCB1c2UgJ2F3YWl0JyBhcyBpZGVudGlmaWVyIGluc2lkZSBhbiBhc3luYyBmdW5jdGlvbiIpO2JyZWFrO2Nhc2UiT2JqZWN0UGF0dGVybiI6Y2FzZSJBcnJheVBhdHRlcm4iOmNhc2UiQXNzaWdubWVudFBhdHRlcm4iOmNhc2UiUmVzdEVsZW1lbnQiOmJyZWFrO2Nhc2UiT2JqZWN0RXhwcmVzc2lvbiI6ZS50eXBlPSJPYmplY3RQYXR0ZXJuIixzJiZ0aGlzLmNoZWNrUGF0dGVybkVycm9ycyhzLCEwKTtmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07dGhpcy50b0Fzc2lnbmFibGUocix0KSwiUmVzdEVsZW1lbnQiIT09ci50eXBlfHwiQXJyYXlQYXR0ZXJuIiE9PXIuYXJndW1lbnQudHlwZSYmIk9iamVjdFBhdHRlcm4iIT09ci5hcmd1bWVudC50eXBlfHx0aGlzLnJhaXNlKHIuYXJndW1lbnQuc3RhcnQsIlVuZXhwZWN0ZWQgdG9rZW4iKTt9YnJlYWs7Y2FzZSJQcm9wZXJ0eSI6ImluaXQiIT09ZS5raW5kJiZ0aGlzLnJhaXNlKGUua2V5LnN0YXJ0LCJPYmplY3QgcGF0dGVybiBjYW4ndCBjb250YWluIGdldHRlciBvciBzZXR0ZXIiKSx0aGlzLnRvQXNzaWduYWJsZShlLnZhbHVlLHQpO2JyZWFrO2Nhc2UiQXJyYXlFeHByZXNzaW9uIjplLnR5cGU9IkFycmF5UGF0dGVybiIscyYmdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMocywhMCksdGhpcy50b0Fzc2lnbmFibGVMaXN0KGUuZWxlbWVudHMsdCk7YnJlYWs7Y2FzZSJTcHJlYWRFbGVtZW50IjplLnR5cGU9IlJlc3RFbGVtZW50Iix0aGlzLnRvQXNzaWduYWJsZShlLmFyZ3VtZW50LHQpLCJBc3NpZ25tZW50UGF0dGVybiI9PT1lLmFyZ3VtZW50LnR5cGUmJnRoaXMucmFpc2UoZS5hcmd1bWVudC5zdGFydCwiUmVzdCBlbGVtZW50cyBjYW5ub3QgaGF2ZSBhIGRlZmF1bHQgdmFsdWUiKTticmVhaztjYXNlIkFzc2lnbm1lbnRFeHByZXNzaW9uIjoiPSIhPT1lLm9wZXJhdG9yJiZ0aGlzLnJhaXNlKGUubGVmdC5lbmQsIk9ubHkgJz0nIG9wZXJhdG9yIGNhbiBiZSB1c2VkIGZvciBzcGVjaWZ5aW5nIGRlZmF1bHQgdmFsdWUuIiksZS50eXBlPSJBc3NpZ25tZW50UGF0dGVybiIsZGVsZXRlIGUub3BlcmF0b3IsdGhpcy50b0Fzc2lnbmFibGUoZS5sZWZ0LHQpO2JyZWFrO2Nhc2UiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iOnRoaXMudG9Bc3NpZ25hYmxlKGUuZXhwcmVzc2lvbix0LHMpO2JyZWFrO2Nhc2UiQ2hhaW5FeHByZXNzaW9uIjp0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiT3B0aW9uYWwgY2hhaW5pbmcgY2Fubm90IGFwcGVhciBpbiBsZWZ0LWhhbmQgc2lkZSIpO2JyZWFrO2Nhc2UiTWVtYmVyRXhwcmVzc2lvbiI6aWYoIXQpYnJlYWs7ZGVmYXVsdDp0aGlzLnJhaXNlKGUuc3RhcnQsIkFzc2lnbmluZyB0byBydmFsdWUiKTt9ZWxzZSBzJiZ0aGlzLmNoZWNrUGF0dGVybkVycm9ycyhzLCEwKTtyZXR1cm4gZX0sSGMudG9Bc3NpZ25hYmxlTGlzdD1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcz1lLmxlbmd0aCxpPTA7aTxzO2krKyl7dmFyIG49ZVtpXTtuJiZ0aGlzLnRvQXNzaWduYWJsZShuLHQpO31pZihzKXt2YXIgcj1lW3MtMV07Nj09PXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiYmdCYmciYmIlJlc3RFbGVtZW50Ij09PXIudHlwZSYmIklkZW50aWZpZXIiIT09ci5hcmd1bWVudC50eXBlJiZ0aGlzLnVuZXhwZWN0ZWQoci5hcmd1bWVudC5zdGFydCk7fXJldHVybiBlfSxIYy5wYXJzZVNwcmVhZD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoKSx0LmFyZ3VtZW50PXRoaXMucGFyc2VNYXliZUFzc2lnbighMSxlKSx0aGlzLmZpbmlzaE5vZGUodCwiU3ByZWFkRWxlbWVudCIpfSxIYy5wYXJzZVJlc3RCaW5kaW5nPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksNj09PXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiYmdGhpcy50eXBlIT09dWMubmFtZSYmdGhpcy51bmV4cGVjdGVkKCksZS5hcmd1bWVudD10aGlzLnBhcnNlQmluZGluZ0F0b20oKSx0aGlzLmZpbmlzaE5vZGUoZSwiUmVzdEVsZW1lbnQiKX0sSGMucGFyc2VCaW5kaW5nQXRvbT1mdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Nilzd2l0Y2godGhpcy50eXBlKXtjYXNlIHVjLmJyYWNrZXRMOnZhciBlPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMubmV4dCgpLGUuZWxlbWVudHM9dGhpcy5wYXJzZUJpbmRpbmdMaXN0KHVjLmJyYWNrZXRSLCEwLCEwKSx0aGlzLmZpbmlzaE5vZGUoZSwiQXJyYXlQYXR0ZXJuIik7Y2FzZSB1Yy5icmFjZUw6cmV0dXJuIHRoaXMucGFyc2VPYmooITApfXJldHVybiB0aGlzLnBhcnNlSWRlbnQoKX0sSGMucGFyc2VCaW5kaW5nTGlzdD1mdW5jdGlvbihlLHQscyxpKXtmb3IodmFyIG49W10scj0hMDshdGhpcy5lYXQoZSk7KWlmKHI/cj0hMTp0aGlzLmV4cGVjdCh1Yy5jb21tYSksdCYmdGhpcy50eXBlPT09dWMuY29tbWEpbi5wdXNoKG51bGwpO2Vsc2Uge2lmKHMmJnRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGUpKWJyZWFrO2lmKHRoaXMudHlwZT09PXVjLmVsbGlwc2lzKXt2YXIgbz10aGlzLnBhcnNlUmVzdEJpbmRpbmcoKTt0aGlzLnBhcnNlQmluZGluZ0xpc3RJdGVtKG8pLG4ucHVzaChvKSx0aGlzLnR5cGU9PT11Yy5jb21tYSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudCIpLHRoaXMuZXhwZWN0KGUpO2JyZWFrfW4ucHVzaCh0aGlzLnBhcnNlQXNzaWduYWJsZUxpc3RJdGVtKGkpKTt9cmV0dXJuIG59LEhjLnBhcnNlQXNzaWduYWJsZUxpc3RJdGVtPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucGFyc2VNYXliZURlZmF1bHQodGhpcy5zdGFydCx0aGlzLnN0YXJ0TG9jKTtyZXR1cm4gdGhpcy5wYXJzZUJpbmRpbmdMaXN0SXRlbSh0KSx0fSxIYy5wYXJzZUJpbmRpbmdMaXN0SXRlbT1mdW5jdGlvbihlKXtyZXR1cm4gZX0sSGMucGFyc2VNYXliZURlZmF1bHQ9ZnVuY3Rpb24oZSx0LHMpe2lmKHM9c3x8dGhpcy5wYXJzZUJpbmRpbmdBdG9tKCksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDZ8fCF0aGlzLmVhdCh1Yy5lcSkpcmV0dXJuIHM7dmFyIGk9dGhpcy5zdGFydE5vZGVBdChlLHQpO3JldHVybiBpLmxlZnQ9cyxpLnJpZ2h0PXRoaXMucGFyc2VNYXliZUFzc2lnbigpLHRoaXMuZmluaXNoTm9kZShpLCJBc3NpZ25tZW50UGF0dGVybiIpfSxIYy5jaGVja0xWYWxTaW1wbGU9ZnVuY3Rpb24oZSx0LHMpe3ZvaWQgMD09PXQmJih0PTApO3ZhciBpPTAhPT10O3N3aXRjaChlLnR5cGUpe2Nhc2UiSWRlbnRpZmllciI6dGhpcy5zdHJpY3QmJnRoaXMucmVzZXJ2ZWRXb3Jkc1N0cmljdEJpbmQudGVzdChlLm5hbWUpJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwoaT8iQmluZGluZyAiOiJBc3NpZ25pbmcgdG8gIikrZS5uYW1lKyIgaW4gc3RyaWN0IG1vZGUiKSxpJiYoMj09PXQmJiJsZXQiPT09ZS5uYW1lJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwibGV0IGlzIGRpc2FsbG93ZWQgYXMgYSBsZXhpY2FsbHkgYm91bmQgbmFtZSIpLHMmJih2YyhzLGUubmFtZSkmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCJBcmd1bWVudCBuYW1lIGNsYXNoIiksc1tlLm5hbWVdPSEwKSw1IT09dCYmdGhpcy5kZWNsYXJlTmFtZShlLm5hbWUsdCxlLnN0YXJ0KSk7YnJlYWs7Y2FzZSJDaGFpbkV4cHJlc3Npb24iOnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCJPcHRpb25hbCBjaGFpbmluZyBjYW5ub3QgYXBwZWFyIGluIGxlZnQtaGFuZCBzaWRlIik7YnJlYWs7Y2FzZSJNZW1iZXJFeHByZXNzaW9uIjppJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiQmluZGluZyBtZW1iZXIgZXhwcmVzc2lvbiIpO2JyZWFrO2Nhc2UiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iOnJldHVybiBpJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiQmluZGluZyBwYXJlbnRoZXNpemVkIGV4cHJlc3Npb24iKSx0aGlzLmNoZWNrTFZhbFNpbXBsZShlLmV4cHJlc3Npb24sdCxzKTtkZWZhdWx0OnRoaXMucmFpc2UoZS5zdGFydCwoaT8iQmluZGluZyI6IkFzc2lnbmluZyB0byIpKyIgcnZhbHVlIik7fX0sSGMuY2hlY2tMVmFsUGF0dGVybj1mdW5jdGlvbihlLHQscyl7c3dpdGNoKHZvaWQgMD09PXQmJih0PTApLGUudHlwZSl7Y2FzZSJPYmplY3RQYXR0ZXJuIjpmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07dGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4ocix0LHMpO31icmVhaztjYXNlIkFycmF5UGF0dGVybiI6Zm9yKHZhciBvPTAsYT1lLmVsZW1lbnRzO288YS5sZW5ndGg7bys9MSl7dmFyIGw9YVtvXTtsJiZ0aGlzLmNoZWNrTFZhbElubmVyUGF0dGVybihsLHQscyk7fWJyZWFrO2RlZmF1bHQ6dGhpcy5jaGVja0xWYWxTaW1wbGUoZSx0LHMpO319LEhjLmNoZWNrTFZhbElubmVyUGF0dGVybj1mdW5jdGlvbihlLHQscyl7c3dpdGNoKHZvaWQgMD09PXQmJih0PTApLGUudHlwZSl7Y2FzZSJQcm9wZXJ0eSI6dGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4oZS52YWx1ZSx0LHMpO2JyZWFrO2Nhc2UiQXNzaWdubWVudFBhdHRlcm4iOnRoaXMuY2hlY2tMVmFsUGF0dGVybihlLmxlZnQsdCxzKTticmVhaztjYXNlIlJlc3RFbGVtZW50Ijp0aGlzLmNoZWNrTFZhbFBhdHRlcm4oZS5hcmd1bWVudCx0LHMpO2JyZWFrO2RlZmF1bHQ6dGhpcy5jaGVja0xWYWxQYXR0ZXJuKGUsdCxzKTt9fTt2YXIgS2M9ZnVuY3Rpb24oZSx0LHMsaSxuKXt0aGlzLnRva2VuPWUsdGhpcy5pc0V4cHI9ISF0LHRoaXMucHJlc2VydmVTcGFjZT0hIXMsdGhpcy5vdmVycmlkZT1pLHRoaXMuZ2VuZXJhdG9yPSEhbjt9LFljPXtiX3N0YXQ6bmV3IEtjKCJ7IiwhMSksYl9leHByOm5ldyBLYygieyIsITApLGJfdG1wbDpuZXcgS2MoIiR7IiwhMSkscF9zdGF0Om5ldyBLYygiKCIsITEpLHBfZXhwcjpuZXcgS2MoIigiLCEwKSxxX3RtcGw6bmV3IEtjKCJgIiwhMCwhMCwoZnVuY3Rpb24oZSl7cmV0dXJuIGUudHJ5UmVhZFRlbXBsYXRlVG9rZW4oKX0pKSxmX3N0YXQ6bmV3IEtjKCJmdW5jdGlvbiIsITEpLGZfZXhwcjpuZXcgS2MoImZ1bmN0aW9uIiwhMCksZl9leHByX2dlbjpuZXcgS2MoImZ1bmN0aW9uIiwhMCwhMSxudWxsLCEwKSxmX2dlbjpuZXcgS2MoImZ1bmN0aW9uIiwhMSwhMSxudWxsLCEwKX0sWGM9T2MucHJvdG90eXBlO1hjLmluaXRpYWxDb250ZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIFtZYy5iX3N0YXRdfSxYYy5jdXJDb250ZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGV4dFt0aGlzLmNvbnRleHQubGVuZ3RoLTFdfSxYYy5icmFjZUlzQmxvY2s9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5jdXJDb250ZXh0KCk7cmV0dXJuIHQ9PT1ZYy5mX2V4cHJ8fHQ9PT1ZYy5mX3N0YXR8fChlIT09dWMuY29sb258fHQhPT1ZYy5iX3N0YXQmJnQhPT1ZYy5iX2V4cHI/ZT09PXVjLl9yZXR1cm58fGU9PT11Yy5uYW1lJiZ0aGlzLmV4cHJBbGxvd2VkP2RjLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsdGhpcy5zdGFydCkpOmU9PT11Yy5fZWxzZXx8ZT09PXVjLnNlbWl8fGU9PT11Yy5lb2Z8fGU9PT11Yy5wYXJlblJ8fGU9PT11Yy5hcnJvd3x8KGU9PT11Yy5icmFjZUw/dD09PVljLmJfc3RhdDplIT09dWMuX3ZhciYmZSE9PXVjLl9jb25zdCYmZSE9PXVjLm5hbWUmJiF0aGlzLmV4cHJBbGxvd2VkKTohdC5pc0V4cHIpfSxYYy5pbkdlbmVyYXRvckNvbnRleHQ9ZnVuY3Rpb24oKXtmb3IodmFyIGU9dGhpcy5jb250ZXh0Lmxlbmd0aC0xO2U+PTE7ZS0tKXt2YXIgdD10aGlzLmNvbnRleHRbZV07aWYoImZ1bmN0aW9uIj09PXQudG9rZW4pcmV0dXJuIHQuZ2VuZXJhdG9yfXJldHVybiAhMX0sWGMudXBkYXRlQ29udGV4dD1mdW5jdGlvbihlKXt2YXIgdCxzPXRoaXMudHlwZTtzLmtleXdvcmQmJmU9PT11Yy5kb3Q/dGhpcy5leHByQWxsb3dlZD0hMToodD1zLnVwZGF0ZUNvbnRleHQpP3QuY2FsbCh0aGlzLGUpOnRoaXMuZXhwckFsbG93ZWQ9cy5iZWZvcmVFeHByO30sWGMub3ZlcnJpZGVDb250ZXh0PWZ1bmN0aW9uKGUpe3RoaXMuY3VyQ29udGV4dCgpIT09ZSYmKHRoaXMuY29udGV4dFt0aGlzLmNvbnRleHQubGVuZ3RoLTFdPWUpO30sdWMucGFyZW5SLnVwZGF0ZUNvbnRleHQ9dWMuYnJhY2VSLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oKXtpZigxIT09dGhpcy5jb250ZXh0Lmxlbmd0aCl7dmFyIGU9dGhpcy5jb250ZXh0LnBvcCgpO2U9PT1ZYy5iX3N0YXQmJiJmdW5jdGlvbiI9PT10aGlzLmN1ckNvbnRleHQoKS50b2tlbiYmKGU9dGhpcy5jb250ZXh0LnBvcCgpKSx0aGlzLmV4cHJBbGxvd2VkPSFlLmlzRXhwcjt9ZWxzZSB0aGlzLmV4cHJBbGxvd2VkPSEwO30sdWMuYnJhY2VMLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oZSl7dGhpcy5jb250ZXh0LnB1c2godGhpcy5icmFjZUlzQmxvY2soZSk/WWMuYl9zdGF0OlljLmJfZXhwciksdGhpcy5leHByQWxsb3dlZD0hMDt9LHVjLmRvbGxhckJyYWNlTC51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKCl7dGhpcy5jb250ZXh0LnB1c2goWWMuYl90bXBsKSx0aGlzLmV4cHJBbGxvd2VkPSEwO30sdWMucGFyZW5MLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZT09PXVjLl9pZnx8ZT09PXVjLl9mb3J8fGU9PT11Yy5fd2l0aHx8ZT09PXVjLl93aGlsZTt0aGlzLmNvbnRleHQucHVzaCh0P1ljLnBfc3RhdDpZYy5wX2V4cHIpLHRoaXMuZXhwckFsbG93ZWQ9ITA7fSx1Yy5pbmNEZWMudXBkYXRlQ29udGV4dD1mdW5jdGlvbigpe30sdWMuX2Z1bmN0aW9uLnVwZGF0ZUNvbnRleHQ9dWMuX2NsYXNzLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oZSl7IWUuYmVmb3JlRXhwcnx8ZT09PXVjLl9lbHNlfHxlPT09dWMuc2VtaSYmdGhpcy5jdXJDb250ZXh0KCkhPT1ZYy5wX3N0YXR8fGU9PT11Yy5fcmV0dXJuJiZkYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rRW5kLHRoaXMuc3RhcnQpKXx8KGU9PT11Yy5jb2xvbnx8ZT09PXVjLmJyYWNlTCkmJnRoaXMuY3VyQ29udGV4dCgpPT09WWMuYl9zdGF0P3RoaXMuY29udGV4dC5wdXNoKFljLmZfc3RhdCk6dGhpcy5jb250ZXh0LnB1c2goWWMuZl9leHByKSx0aGlzLmV4cHJBbGxvd2VkPSExO30sdWMuYmFja1F1b3RlLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oKXt0aGlzLmN1ckNvbnRleHQoKT09PVljLnFfdG1wbD90aGlzLmNvbnRleHQucG9wKCk6dGhpcy5jb250ZXh0LnB1c2goWWMucV90bXBsKSx0aGlzLmV4cHJBbGxvd2VkPSExO30sdWMuc3Rhci51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGUpe2lmKGU9PT11Yy5fZnVuY3Rpb24pe3ZhciB0PXRoaXMuY29udGV4dC5sZW5ndGgtMTt0aGlzLmNvbnRleHRbdF09PT1ZYy5mX2V4cHI/dGhpcy5jb250ZXh0W3RdPVljLmZfZXhwcl9nZW46dGhpcy5jb250ZXh0W3RdPVljLmZfZ2VuO310aGlzLmV4cHJBbGxvd2VkPSEwO30sdWMubmFtZS51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGUpe3ZhciB0PSExO3RoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmZSE9PXVjLmRvdCYmKCJvZiI9PT10aGlzLnZhbHVlJiYhdGhpcy5leHByQWxsb3dlZHx8InlpZWxkIj09PXRoaXMudmFsdWUmJnRoaXMuaW5HZW5lcmF0b3JDb250ZXh0KCkpJiYodD0hMCksdGhpcy5leHByQWxsb3dlZD10O307dmFyIFFjPU9jLnByb3RvdHlwZTtmdW5jdGlvbiBaYyhlKXtyZXR1cm4gIk1lbWJlckV4cHJlc3Npb24iPT09ZS50eXBlJiYiUHJpdmF0ZUlkZW50aWZpZXIiPT09ZS5wcm9wZXJ0eS50eXBlfHwiQ2hhaW5FeHByZXNzaW9uIj09PWUudHlwZSYmWmMoZS5leHByZXNzaW9uKX1RYy5jaGVja1Byb3BDbGFzaD1mdW5jdGlvbihlLHQscyl7aWYoISh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJiJTcHJlYWRFbGVtZW50Ij09PWUudHlwZXx8dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiYoZS5jb21wdXRlZHx8ZS5tZXRob2R8fGUuc2hvcnRoYW5kKSkpe3ZhciBpLG49ZS5rZXk7c3dpdGNoKG4udHlwZSl7Y2FzZSJJZGVudGlmaWVyIjppPW4ubmFtZTticmVhaztjYXNlIkxpdGVyYWwiOmk9U3RyaW5nKG4udmFsdWUpO2JyZWFrO2RlZmF1bHQ6cmV0dXJufXZhciByPWUua2luZDtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYpIl9fcHJvdG9fXyI9PT1pJiYiaW5pdCI9PT1yJiYodC5wcm90byYmKHM/cy5kb3VibGVQcm90bzwwJiYocy5kb3VibGVQcm90bz1uLnN0YXJ0KTp0aGlzLnJhaXNlUmVjb3ZlcmFibGUobi5zdGFydCwiUmVkZWZpbml0aW9uIG9mIF9fcHJvdG9fXyBwcm9wZXJ0eSIpKSx0LnByb3RvPSEwKTtlbHNlIHt2YXIgbz10W2k9IiQiK2ldO2lmKG8pKCJpbml0Ij09PXI/dGhpcy5zdHJpY3QmJm8uaW5pdHx8by5nZXR8fG8uc2V0Om8uaW5pdHx8b1tyXSkmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShuLnN0YXJ0LCJSZWRlZmluaXRpb24gb2YgcHJvcGVydHkiKTtlbHNlIG89dFtpXT17aW5pdDohMSxnZXQ6ITEsc2V0OiExfTtvW3JdPSEwO319fSxRYy5wYXJzZUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0KXt2YXIgcz10aGlzLnN0YXJ0LGk9dGhpcy5zdGFydExvYyxuPXRoaXMucGFyc2VNYXliZUFzc2lnbihlLHQpO2lmKHRoaXMudHlwZT09PXVjLmNvbW1hKXt2YXIgcj10aGlzLnN0YXJ0Tm9kZUF0KHMsaSk7Zm9yKHIuZXhwcmVzc2lvbnM9W25dO3RoaXMuZWF0KHVjLmNvbW1hKTspci5leHByZXNzaW9ucy5wdXNoKHRoaXMucGFyc2VNYXliZUFzc2lnbihlLHQpKTtyZXR1cm4gdGhpcy5maW5pc2hOb2RlKHIsIlNlcXVlbmNlRXhwcmVzc2lvbiIpfXJldHVybiBufSxRYy5wYXJzZU1heWJlQXNzaWduPWZ1bmN0aW9uKGUsdCxzKXtpZih0aGlzLmlzQ29udGV4dHVhbCgieWllbGQiKSl7aWYodGhpcy5pbkdlbmVyYXRvcilyZXR1cm4gdGhpcy5wYXJzZVlpZWxkKGUpO3RoaXMuZXhwckFsbG93ZWQ9ITE7fXZhciBpPSExLG49LTEscj0tMSxvPS0xO3Q/KG49dC5wYXJlbnRoZXNpemVkQXNzaWduLHI9dC50cmFpbGluZ0NvbW1hLG89dC5kb3VibGVQcm90byx0LnBhcmVudGhlc2l6ZWRBc3NpZ249dC50cmFpbGluZ0NvbW1hPS0xKToodD1uZXcgVmMsaT0hMCk7dmFyIGE9dGhpcy5zdGFydCxsPXRoaXMuc3RhcnRMb2M7dGhpcy50eXBlIT09dWMucGFyZW5MJiZ0aGlzLnR5cGUhPT11Yy5uYW1lfHwodGhpcy5wb3RlbnRpYWxBcnJvd0F0PXRoaXMuc3RhcnQsdGhpcy5wb3RlbnRpYWxBcnJvd0luRm9yQXdhaXQ9ImF3YWl0Ij09PWUpO3ZhciBjPXRoaXMucGFyc2VNYXliZUNvbmRpdGlvbmFsKGUsdCk7aWYocyYmKGM9cy5jYWxsKHRoaXMsYyxhLGwpKSx0aGlzLnR5cGUuaXNBc3NpZ24pe3ZhciBoPXRoaXMuc3RhcnROb2RlQXQoYSxsKTtyZXR1cm4gaC5vcGVyYXRvcj10aGlzLnZhbHVlLHRoaXMudHlwZT09PXVjLmVxJiYoYz10aGlzLnRvQXNzaWduYWJsZShjLCExLHQpKSxpfHwodC5wYXJlbnRoZXNpemVkQXNzaWduPXQudHJhaWxpbmdDb21tYT10LmRvdWJsZVByb3RvPS0xKSx0LnNob3J0aGFuZEFzc2lnbj49Yy5zdGFydCYmKHQuc2hvcnRoYW5kQXNzaWduPS0xKSx0aGlzLnR5cGU9PT11Yy5lcT90aGlzLmNoZWNrTFZhbFBhdHRlcm4oYyk6dGhpcy5jaGVja0xWYWxTaW1wbGUoYyksaC5sZWZ0PWMsdGhpcy5uZXh0KCksaC5yaWdodD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oZSksbz4tMSYmKHQuZG91YmxlUHJvdG89byksdGhpcy5maW5pc2hOb2RlKGgsIkFzc2lnbm1lbnRFeHByZXNzaW9uIil9cmV0dXJuIGkmJnRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHQsITApLG4+LTEmJih0LnBhcmVudGhlc2l6ZWRBc3NpZ249bikscj4tMSYmKHQudHJhaWxpbmdDb21tYT1yKSxjfSxRYy5wYXJzZU1heWJlQ29uZGl0aW9uYWw9ZnVuY3Rpb24oZSx0KXt2YXIgcz10aGlzLnN0YXJ0LGk9dGhpcy5zdGFydExvYyxuPXRoaXMucGFyc2VFeHByT3BzKGUsdCk7aWYodGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnModCkpcmV0dXJuIG47aWYodGhpcy5lYXQodWMucXVlc3Rpb24pKXt2YXIgcj10aGlzLnN0YXJ0Tm9kZUF0KHMsaSk7cmV0dXJuIHIudGVzdD1uLHIuY29uc2VxdWVudD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSx0aGlzLmV4cGVjdCh1Yy5jb2xvbiksci5hbHRlcm5hdGU9dGhpcy5wYXJzZU1heWJlQXNzaWduKGUpLHRoaXMuZmluaXNoTm9kZShyLCJDb25kaXRpb25hbEV4cHJlc3Npb24iKX1yZXR1cm4gbn0sUWMucGFyc2VFeHByT3BzPWZ1bmN0aW9uKGUsdCl7dmFyIHM9dGhpcy5zdGFydCxpPXRoaXMuc3RhcnRMb2Msbj10aGlzLnBhcnNlTWF5YmVVbmFyeSh0LCExLCExLGUpO3JldHVybiB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyh0KXx8bi5zdGFydD09PXMmJiJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI9PT1uLnR5cGU/bjp0aGlzLnBhcnNlRXhwck9wKG4scyxpLC0xLGUpfSxRYy5wYXJzZUV4cHJPcD1mdW5jdGlvbihlLHQscyxpLG4pe3ZhciByPXRoaXMudHlwZS5iaW5vcDtpZihudWxsIT1yJiYoIW58fHRoaXMudHlwZSE9PXVjLl9pbikmJnI+aSl7dmFyIG89dGhpcy50eXBlPT09dWMubG9naWNhbE9SfHx0aGlzLnR5cGU9PT11Yy5sb2dpY2FsQU5ELGE9dGhpcy50eXBlPT09dWMuY29hbGVzY2U7YSYmKHI9dWMubG9naWNhbEFORC5iaW5vcCk7dmFyIGw9dGhpcy52YWx1ZTt0aGlzLm5leHQoKTt2YXIgYz10aGlzLnN0YXJ0LGg9dGhpcy5zdGFydExvYyx1PXRoaXMucGFyc2VFeHByT3AodGhpcy5wYXJzZU1heWJlVW5hcnkobnVsbCwhMSwhMSxuKSxjLGgscixuKSxkPXRoaXMuYnVpbGRCaW5hcnkodCxzLGUsdSxsLG98fGEpO3JldHVybiAobyYmdGhpcy50eXBlPT09dWMuY29hbGVzY2V8fGEmJih0aGlzLnR5cGU9PT11Yy5sb2dpY2FsT1J8fHRoaXMudHlwZT09PXVjLmxvZ2ljYWxBTkQpKSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkxvZ2ljYWwgZXhwcmVzc2lvbnMgYW5kIGNvYWxlc2NlIGV4cHJlc3Npb25zIGNhbm5vdCBiZSBtaXhlZC4gV3JhcCBlaXRoZXIgYnkgcGFyZW50aGVzZXMiKSx0aGlzLnBhcnNlRXhwck9wKGQsdCxzLGksbil9cmV0dXJuIGV9LFFjLmJ1aWxkQmluYXJ5PWZ1bmN0aW9uKGUsdCxzLGksbixyKXsiUHJpdmF0ZUlkZW50aWZpZXIiPT09aS50eXBlJiZ0aGlzLnJhaXNlKGkuc3RhcnQsIlByaXZhdGUgaWRlbnRpZmllciBjYW4gb25seSBiZSBsZWZ0IHNpZGUgb2YgYmluYXJ5IGV4cHJlc3Npb24iKTt2YXIgbz10aGlzLnN0YXJ0Tm9kZUF0KGUsdCk7cmV0dXJuIG8ubGVmdD1zLG8ub3BlcmF0b3I9bixvLnJpZ2h0PWksdGhpcy5maW5pc2hOb2RlKG8scj8iTG9naWNhbEV4cHJlc3Npb24iOiJCaW5hcnlFeHByZXNzaW9uIil9LFFjLnBhcnNlTWF5YmVVbmFyeT1mdW5jdGlvbihlLHQscyxpKXt2YXIgbixyPXRoaXMuc3RhcnQsbz10aGlzLnN0YXJ0TG9jO2lmKHRoaXMuaXNDb250ZXh0dWFsKCJhd2FpdCIpJiZ0aGlzLmNhbkF3YWl0KW49dGhpcy5wYXJzZUF3YWl0KGkpLHQ9ITA7ZWxzZSBpZih0aGlzLnR5cGUucHJlZml4KXt2YXIgYT10aGlzLnN0YXJ0Tm9kZSgpLGw9dGhpcy50eXBlPT09dWMuaW5jRGVjO2Eub3BlcmF0b3I9dGhpcy52YWx1ZSxhLnByZWZpeD0hMCx0aGlzLm5leHQoKSxhLmFyZ3VtZW50PXRoaXMucGFyc2VNYXliZVVuYXJ5KG51bGwsITAsbCxpKSx0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhlLCEwKSxsP3RoaXMuY2hlY2tMVmFsU2ltcGxlKGEuYXJndW1lbnQpOnRoaXMuc3RyaWN0JiYiZGVsZXRlIj09PWEub3BlcmF0b3ImJiJJZGVudGlmaWVyIj09PWEuYXJndW1lbnQudHlwZT90aGlzLnJhaXNlUmVjb3ZlcmFibGUoYS5zdGFydCwiRGVsZXRpbmcgbG9jYWwgdmFyaWFibGUgaW4gc3RyaWN0IG1vZGUiKToiZGVsZXRlIj09PWEub3BlcmF0b3ImJlpjKGEuYXJndW1lbnQpP3RoaXMucmFpc2VSZWNvdmVyYWJsZShhLnN0YXJ0LCJQcml2YXRlIGZpZWxkcyBjYW4gbm90IGJlIGRlbGV0ZWQiKTp0PSEwLG49dGhpcy5maW5pc2hOb2RlKGEsbD8iVXBkYXRlRXhwcmVzc2lvbiI6IlVuYXJ5RXhwcmVzc2lvbiIpO31lbHNlIGlmKHR8fHRoaXMudHlwZSE9PXVjLnByaXZhdGVJZCl7aWYobj10aGlzLnBhcnNlRXhwclN1YnNjcmlwdHMoZSxpKSx0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhlKSlyZXR1cm4gbjtmb3IoO3RoaXMudHlwZS5wb3N0Zml4JiYhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKTspe3ZhciBjPXRoaXMuc3RhcnROb2RlQXQocixvKTtjLm9wZXJhdG9yPXRoaXMudmFsdWUsYy5wcmVmaXg9ITEsYy5hcmd1bWVudD1uLHRoaXMuY2hlY2tMVmFsU2ltcGxlKG4pLHRoaXMubmV4dCgpLG49dGhpcy5maW5pc2hOb2RlKGMsIlVwZGF0ZUV4cHJlc3Npb24iKTt9fWVsc2UgKGl8fDA9PT10aGlzLnByaXZhdGVOYW1lU3RhY2subGVuZ3RoKSYmdGhpcy5vcHRpb25zLmNoZWNrUHJpdmF0ZUZpZWxkcyYmdGhpcy51bmV4cGVjdGVkKCksbj10aGlzLnBhcnNlUHJpdmF0ZUlkZW50KCksdGhpcy50eXBlIT09dWMuX2luJiZ0aGlzLnVuZXhwZWN0ZWQoKTtyZXR1cm4gc3x8IXRoaXMuZWF0KHVjLnN0YXJzdGFyKT9uOnQ/dm9pZCB0aGlzLnVuZXhwZWN0ZWQodGhpcy5sYXN0VG9rU3RhcnQpOnRoaXMuYnVpbGRCaW5hcnkocixvLG4sdGhpcy5wYXJzZU1heWJlVW5hcnkobnVsbCwhMSwhMSxpKSwiKioiLCExKX0sUWMucGFyc2VFeHByU3Vic2NyaXB0cz1mdW5jdGlvbihlLHQpe3ZhciBzPXRoaXMuc3RhcnQsaT10aGlzLnN0YXJ0TG9jLG49dGhpcy5wYXJzZUV4cHJBdG9tKGUsdCk7aWYoIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIj09PW4udHlwZSYmIikiIT09dGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tTdGFydCx0aGlzLmxhc3RUb2tFbmQpKXJldHVybiBuO3ZhciByPXRoaXMucGFyc2VTdWJzY3JpcHRzKG4scyxpLCExLHQpO3JldHVybiBlJiYiTWVtYmVyRXhwcmVzc2lvbiI9PT1yLnR5cGUmJihlLnBhcmVudGhlc2l6ZWRBc3NpZ24+PXIuc3RhcnQmJihlLnBhcmVudGhlc2l6ZWRBc3NpZ249LTEpLGUucGFyZW50aGVzaXplZEJpbmQ+PXIuc3RhcnQmJihlLnBhcmVudGhlc2l6ZWRCaW5kPS0xKSxlLnRyYWlsaW5nQ29tbWE+PXIuc3RhcnQmJihlLnRyYWlsaW5nQ29tbWE9LTEpKSxyfSxRYy5wYXJzZVN1YnNjcmlwdHM9ZnVuY3Rpb24oZSx0LHMsaSxuKXtmb3IodmFyIHI9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04JiYiSWRlbnRpZmllciI9PT1lLnR5cGUmJiJhc3luYyI9PT1lLm5hbWUmJnRoaXMubGFzdFRva0VuZD09PWUuZW5kJiYhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSYmZS5lbmQtZS5zdGFydD09NSYmdGhpcy5wb3RlbnRpYWxBcnJvd0F0PT09ZS5zdGFydCxvPSExOzspe3ZhciBhPXRoaXMucGFyc2VTdWJzY3JpcHQoZSx0LHMsaSxyLG8sbik7aWYoYS5vcHRpb25hbCYmKG89ITApLGE9PT1lfHwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iPT09YS50eXBlKXtpZihvKXt2YXIgbD10aGlzLnN0YXJ0Tm9kZUF0KHQscyk7bC5leHByZXNzaW9uPWEsYT10aGlzLmZpbmlzaE5vZGUobCwiQ2hhaW5FeHByZXNzaW9uIik7fXJldHVybiBhfWU9YTt9fSxRYy5zaG91bGRQYXJzZUFzeW5jQXJyb3c9ZnVuY3Rpb24oKXtyZXR1cm4gIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkmJnRoaXMuZWF0KHVjLmFycm93KX0sUWMucGFyc2VTdWJzY3JpcHRBc3luY0Fycm93PWZ1bmN0aW9uKGUsdCxzLGkpe3JldHVybiB0aGlzLnBhcnNlQXJyb3dFeHByZXNzaW9uKHRoaXMuc3RhcnROb2RlQXQoZSx0KSxzLCEwLGkpfSxRYy5wYXJzZVN1YnNjcmlwdD1mdW5jdGlvbihlLHQscyxpLG4scixvKXt2YXIgYT10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExLGw9YSYmdGhpcy5lYXQodWMucXVlc3Rpb25Eb3QpO2kmJmwmJnRoaXMucmFpc2UodGhpcy5sYXN0VG9rU3RhcnQsIk9wdGlvbmFsIGNoYWluaW5nIGNhbm5vdCBhcHBlYXIgaW4gdGhlIGNhbGxlZSBvZiBuZXcgZXhwcmVzc2lvbnMiKTt2YXIgYz10aGlzLmVhdCh1Yy5icmFja2V0TCk7aWYoY3x8bCYmdGhpcy50eXBlIT09dWMucGFyZW5MJiZ0aGlzLnR5cGUhPT11Yy5iYWNrUXVvdGV8fHRoaXMuZWF0KHVjLmRvdCkpe3ZhciBoPXRoaXMuc3RhcnROb2RlQXQodCxzKTtoLm9iamVjdD1lLGM/KGgucHJvcGVydHk9dGhpcy5wYXJzZUV4cHJlc3Npb24oKSx0aGlzLmV4cGVjdCh1Yy5icmFja2V0UikpOnRoaXMudHlwZT09PXVjLnByaXZhdGVJZCYmIlN1cGVyIiE9PWUudHlwZT9oLnByb3BlcnR5PXRoaXMucGFyc2VQcml2YXRlSWRlbnQoKTpoLnByb3BlcnR5PXRoaXMucGFyc2VJZGVudCgibmV2ZXIiIT09dGhpcy5vcHRpb25zLmFsbG93UmVzZXJ2ZWQpLGguY29tcHV0ZWQ9ISFjLGEmJihoLm9wdGlvbmFsPWwpLGU9dGhpcy5maW5pc2hOb2RlKGgsIk1lbWJlckV4cHJlc3Npb24iKTt9ZWxzZSBpZighaSYmdGhpcy5lYXQodWMucGFyZW5MKSl7dmFyIHU9bmV3IFZjLGQ9dGhpcy55aWVsZFBvcyxwPXRoaXMuYXdhaXRQb3MsZj10aGlzLmF3YWl0SWRlbnRQb3M7dGhpcy55aWVsZFBvcz0wLHRoaXMuYXdhaXRQb3M9MCx0aGlzLmF3YWl0SWRlbnRQb3M9MDt2YXIgbT10aGlzLnBhcnNlRXhwckxpc3QodWMucGFyZW5SLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCwhMSx1KTtpZihuJiYhbCYmdGhpcy5zaG91bGRQYXJzZUFzeW5jQXJyb3coKSlyZXR1cm4gdGhpcy5jaGVja1BhdHRlcm5FcnJvcnModSwhMSksdGhpcy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXMoKSx0aGlzLmF3YWl0SWRlbnRQb3M+MCYmdGhpcy5yYWlzZSh0aGlzLmF3YWl0SWRlbnRQb3MsIkNhbm5vdCB1c2UgJ2F3YWl0JyBhcyBpZGVudGlmaWVyIGluc2lkZSBhbiBhc3luYyBmdW5jdGlvbiIpLHRoaXMueWllbGRQb3M9ZCx0aGlzLmF3YWl0UG9zPXAsdGhpcy5hd2FpdElkZW50UG9zPWYsdGhpcy5wYXJzZVN1YnNjcmlwdEFzeW5jQXJyb3codCxzLG0sbyk7dGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnModSwhMCksdGhpcy55aWVsZFBvcz1kfHx0aGlzLnlpZWxkUG9zLHRoaXMuYXdhaXRQb3M9cHx8dGhpcy5hd2FpdFBvcyx0aGlzLmF3YWl0SWRlbnRQb3M9Znx8dGhpcy5hd2FpdElkZW50UG9zO3ZhciBnPXRoaXMuc3RhcnROb2RlQXQodCxzKTtnLmNhbGxlZT1lLGcuYXJndW1lbnRzPW0sYSYmKGcub3B0aW9uYWw9bCksZT10aGlzLmZpbmlzaE5vZGUoZywiQ2FsbEV4cHJlc3Npb24iKTt9ZWxzZSBpZih0aGlzLnR5cGU9PT11Yy5iYWNrUXVvdGUpeyhsfHxyKSYmdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJPcHRpb25hbCBjaGFpbmluZyBjYW5ub3QgYXBwZWFyIGluIHRoZSB0YWcgb2YgdGFnZ2VkIHRlbXBsYXRlIGV4cHJlc3Npb25zIik7dmFyIHk9dGhpcy5zdGFydE5vZGVBdCh0LHMpO3kudGFnPWUseS5xdWFzaT10aGlzLnBhcnNlVGVtcGxhdGUoe2lzVGFnZ2VkOiEwfSksZT10aGlzLmZpbmlzaE5vZGUoeSwiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIik7fXJldHVybiBlfSxRYy5wYXJzZUV4cHJBdG9tPWZ1bmN0aW9uKGUsdCxzKXt0aGlzLnR5cGU9PT11Yy5zbGFzaCYmdGhpcy5yZWFkUmVnZXhwKCk7dmFyIGksbj10aGlzLnBvdGVudGlhbEFycm93QXQ9PT10aGlzLnN0YXJ0O3N3aXRjaCh0aGlzLnR5cGUpe2Nhc2UgdWMuX3N1cGVyOnJldHVybiB0aGlzLmFsbG93U3VwZXJ8fHRoaXMucmFpc2UodGhpcy5zdGFydCwiJ3N1cGVyJyBrZXl3b3JkIG91dHNpZGUgYSBtZXRob2QiKSxpPXRoaXMuc3RhcnROb2RlKCksdGhpcy5uZXh0KCksdGhpcy50eXBlIT09dWMucGFyZW5MfHx0aGlzLmFsbG93RGlyZWN0U3VwZXJ8fHRoaXMucmFpc2UoaS5zdGFydCwic3VwZXIoKSBjYWxsIG91dHNpZGUgY29uc3RydWN0b3Igb2YgYSBzdWJjbGFzcyIpLHRoaXMudHlwZSE9PXVjLmRvdCYmdGhpcy50eXBlIT09dWMuYnJhY2tldEwmJnRoaXMudHlwZSE9PXVjLnBhcmVuTCYmdGhpcy51bmV4cGVjdGVkKCksdGhpcy5maW5pc2hOb2RlKGksIlN1cGVyIik7Y2FzZSB1Yy5fdGhpczpyZXR1cm4gaT10aGlzLnN0YXJ0Tm9kZSgpLHRoaXMubmV4dCgpLHRoaXMuZmluaXNoTm9kZShpLCJUaGlzRXhwcmVzc2lvbiIpO2Nhc2UgdWMubmFtZTp2YXIgcj10aGlzLnN0YXJ0LG89dGhpcy5zdGFydExvYyxhPXRoaXMuY29udGFpbnNFc2MsbD10aGlzLnBhcnNlSWRlbnQoITEpO2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmIWEmJiJhc3luYyI9PT1sLm5hbWUmJiF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpJiZ0aGlzLmVhdCh1Yy5fZnVuY3Rpb24pKXJldHVybiB0aGlzLm92ZXJyaWRlQ29udGV4dChZYy5mX2V4cHIpLHRoaXMucGFyc2VGdW5jdGlvbih0aGlzLnN0YXJ0Tm9kZUF0KHIsbyksMCwhMSwhMCx0KTtpZihuJiYhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSl7aWYodGhpcy5lYXQodWMuYXJyb3cpKXJldHVybiB0aGlzLnBhcnNlQXJyb3dFeHByZXNzaW9uKHRoaXMuc3RhcnROb2RlQXQocixvKSxbbF0sITEsdCk7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04JiYiYXN5bmMiPT09bC5uYW1lJiZ0aGlzLnR5cGU9PT11Yy5uYW1lJiYhYSYmKCF0aGlzLnBvdGVudGlhbEFycm93SW5Gb3JBd2FpdHx8Im9mIiE9PXRoaXMudmFsdWV8fHRoaXMuY29udGFpbnNFc2MpKXJldHVybiBsPXRoaXMucGFyc2VJZGVudCghMSksIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkmJnRoaXMuZWF0KHVjLmFycm93KXx8dGhpcy51bmV4cGVjdGVkKCksdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KHIsbyksW2xdLCEwLHQpfXJldHVybiBsO2Nhc2UgdWMucmVnZXhwOnZhciBjPXRoaXMudmFsdWU7cmV0dXJuIChpPXRoaXMucGFyc2VMaXRlcmFsKGMudmFsdWUpKS5yZWdleD17cGF0dGVybjpjLnBhdHRlcm4sZmxhZ3M6Yy5mbGFnc30saTtjYXNlIHVjLm51bTpjYXNlIHVjLnN0cmluZzpyZXR1cm4gdGhpcy5wYXJzZUxpdGVyYWwodGhpcy52YWx1ZSk7Y2FzZSB1Yy5fbnVsbDpjYXNlIHVjLl90cnVlOmNhc2UgdWMuX2ZhbHNlOnJldHVybiAoaT10aGlzLnN0YXJ0Tm9kZSgpKS52YWx1ZT10aGlzLnR5cGU9PT11Yy5fbnVsbD9udWxsOnRoaXMudHlwZT09PXVjLl90cnVlLGkucmF3PXRoaXMudHlwZS5rZXl3b3JkLHRoaXMubmV4dCgpLHRoaXMuZmluaXNoTm9kZShpLCJMaXRlcmFsIik7Y2FzZSB1Yy5wYXJlbkw6dmFyIGg9dGhpcy5zdGFydCx1PXRoaXMucGFyc2VQYXJlbkFuZERpc3Rpbmd1aXNoRXhwcmVzc2lvbihuLHQpO3JldHVybiBlJiYoZS5wYXJlbnRoZXNpemVkQXNzaWduPDAmJiF0aGlzLmlzU2ltcGxlQXNzaWduVGFyZ2V0KHUpJiYoZS5wYXJlbnRoZXNpemVkQXNzaWduPWgpLGUucGFyZW50aGVzaXplZEJpbmQ8MCYmKGUucGFyZW50aGVzaXplZEJpbmQ9aCkpLHU7Y2FzZSB1Yy5icmFja2V0TDpyZXR1cm4gaT10aGlzLnN0YXJ0Tm9kZSgpLHRoaXMubmV4dCgpLGkuZWxlbWVudHM9dGhpcy5wYXJzZUV4cHJMaXN0KHVjLmJyYWNrZXRSLCEwLCEwLGUpLHRoaXMuZmluaXNoTm9kZShpLCJBcnJheUV4cHJlc3Npb24iKTtjYXNlIHVjLmJyYWNlTDpyZXR1cm4gdGhpcy5vdmVycmlkZUNvbnRleHQoWWMuYl9leHByKSx0aGlzLnBhcnNlT2JqKCExLGUpO2Nhc2UgdWMuX2Z1bmN0aW9uOnJldHVybiBpPXRoaXMuc3RhcnROb2RlKCksdGhpcy5uZXh0KCksdGhpcy5wYXJzZUZ1bmN0aW9uKGksMCk7Y2FzZSB1Yy5fY2xhc3M6cmV0dXJuIHRoaXMucGFyc2VDbGFzcyh0aGlzLnN0YXJ0Tm9kZSgpLCExKTtjYXNlIHVjLl9uZXc6cmV0dXJuIHRoaXMucGFyc2VOZXcoKTtjYXNlIHVjLmJhY2tRdW90ZTpyZXR1cm4gdGhpcy5wYXJzZVRlbXBsYXRlKCk7Y2FzZSB1Yy5faW1wb3J0OnJldHVybiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExP3RoaXMucGFyc2VFeHBySW1wb3J0KHMpOnRoaXMudW5leHBlY3RlZCgpO2RlZmF1bHQ6cmV0dXJuIHRoaXMucGFyc2VFeHByQXRvbURlZmF1bHQoKX19LFFjLnBhcnNlRXhwckF0b21EZWZhdWx0PWZ1bmN0aW9uKCl7dGhpcy51bmV4cGVjdGVkKCk7fSxRYy5wYXJzZUV4cHJJbXBvcnQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTt0aGlzLmNvbnRhaW5zRXNjJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwiRXNjYXBlIHNlcXVlbmNlIGluIGtleXdvcmQgaW1wb3J0Iik7dmFyIHM9dGhpcy5wYXJzZUlkZW50KCEwKTtyZXR1cm4gdGhpcy50eXBlIT09dWMucGFyZW5MfHxlP3RoaXMudHlwZT09PXVjLmRvdD8odC5tZXRhPXMsdGhpcy5wYXJzZUltcG9ydE1ldGEodCkpOnZvaWQgdGhpcy51bmV4cGVjdGVkKCk6dGhpcy5wYXJzZUR5bmFtaWNJbXBvcnQodCl9LFFjLnBhcnNlRHluYW1pY0ltcG9ydD1mdW5jdGlvbihlKXtpZih0aGlzLm5leHQoKSxlLnNvdXJjZT10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSwhdGhpcy5lYXQodWMucGFyZW5SKSl7dmFyIHQ9dGhpcy5zdGFydDt0aGlzLmVhdCh1Yy5jb21tYSkmJnRoaXMuZWF0KHVjLnBhcmVuUik/dGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIlRyYWlsaW5nIGNvbW1hIGlzIG5vdCBhbGxvd2VkIGluIGltcG9ydCgpIik6dGhpcy51bmV4cGVjdGVkKHQpO31yZXR1cm4gdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydEV4cHJlc3Npb24iKX0sUWMucGFyc2VJbXBvcnRNZXRhPWZ1bmN0aW9uKGUpe3RoaXMubmV4dCgpO3ZhciB0PXRoaXMuY29udGFpbnNFc2M7cmV0dXJuIGUucHJvcGVydHk9dGhpcy5wYXJzZUlkZW50KCEwKSwibWV0YSIhPT1lLnByb3BlcnR5Lm5hbWUmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnByb3BlcnR5LnN0YXJ0LCJUaGUgb25seSB2YWxpZCBtZXRhIHByb3BlcnR5IGZvciBpbXBvcnQgaXMgJ2ltcG9ydC5tZXRhJyIpLHQmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCInaW1wb3J0Lm1ldGEnIG11c3Qgbm90IGNvbnRhaW4gZXNjYXBlZCBjaGFyYWN0ZXJzIiksIm1vZHVsZSI9PT10aGlzLm9wdGlvbnMuc291cmNlVHlwZXx8dGhpcy5vcHRpb25zLmFsbG93SW1wb3J0RXhwb3J0RXZlcnl3aGVyZXx8dGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsIkNhbm5vdCB1c2UgJ2ltcG9ydC5tZXRhJyBvdXRzaWRlIGEgbW9kdWxlIiksdGhpcy5maW5pc2hOb2RlKGUsIk1ldGFQcm9wZXJ0eSIpfSxRYy5wYXJzZUxpdGVyYWw9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdC52YWx1ZT1lLHQucmF3PXRoaXMuaW5wdXQuc2xpY2UodGhpcy5zdGFydCx0aGlzLmVuZCksMTEwPT09dC5yYXcuY2hhckNvZGVBdCh0LnJhdy5sZW5ndGgtMSkmJih0LmJpZ2ludD10LnJhdy5zbGljZSgwLC0xKS5yZXBsYWNlKC9fL2csIiIpKSx0aGlzLm5leHQoKSx0aGlzLmZpbmlzaE5vZGUodCwiTGl0ZXJhbCIpfSxRYy5wYXJzZVBhcmVuRXhwcmVzc2lvbj1mdW5jdGlvbigpe3RoaXMuZXhwZWN0KHVjLnBhcmVuTCk7dmFyIGU9dGhpcy5wYXJzZUV4cHJlc3Npb24oKTtyZXR1cm4gdGhpcy5leHBlY3QodWMucGFyZW5SKSxlfSxRYy5zaG91bGRQYXJzZUFycm93PWZ1bmN0aW9uKGUpe3JldHVybiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKX0sUWMucGFyc2VQYXJlbkFuZERpc3Rpbmd1aXNoRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQpe3ZhciBzLGk9dGhpcy5zdGFydCxuPXRoaXMuc3RhcnRMb2Mscj10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTg7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02KXt0aGlzLm5leHQoKTt2YXIgbyxhPXRoaXMuc3RhcnQsbD10aGlzLnN0YXJ0TG9jLGM9W10saD0hMCx1PSExLGQ9bmV3IFZjLHA9dGhpcy55aWVsZFBvcyxmPXRoaXMuYXdhaXRQb3M7Zm9yKHRoaXMueWllbGRQb3M9MCx0aGlzLmF3YWl0UG9zPTA7dGhpcy50eXBlIT09dWMucGFyZW5SOyl7aWYoaD9oPSExOnRoaXMuZXhwZWN0KHVjLmNvbW1hKSxyJiZ0aGlzLmFmdGVyVHJhaWxpbmdDb21tYSh1Yy5wYXJlblIsITApKXt1PSEwO2JyZWFrfWlmKHRoaXMudHlwZT09PXVjLmVsbGlwc2lzKXtvPXRoaXMuc3RhcnQsYy5wdXNoKHRoaXMucGFyc2VQYXJlbkl0ZW0odGhpcy5wYXJzZVJlc3RCaW5kaW5nKCkpKSx0aGlzLnR5cGU9PT11Yy5jb21tYSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudCIpO2JyZWFrfWMucHVzaCh0aGlzLnBhcnNlTWF5YmVBc3NpZ24oITEsZCx0aGlzLnBhcnNlUGFyZW5JdGVtKSk7fXZhciBtPXRoaXMubGFzdFRva0VuZCxnPXRoaXMubGFzdFRva0VuZExvYztpZih0aGlzLmV4cGVjdCh1Yy5wYXJlblIpLGUmJnRoaXMuc2hvdWxkUGFyc2VBcnJvdyhjKSYmdGhpcy5lYXQodWMuYXJyb3cpKXJldHVybiB0aGlzLmNoZWNrUGF0dGVybkVycm9ycyhkLCExKSx0aGlzLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcygpLHRoaXMueWllbGRQb3M9cCx0aGlzLmF3YWl0UG9zPWYsdGhpcy5wYXJzZVBhcmVuQXJyb3dMaXN0KGksbixjLHQpO2MubGVuZ3RoJiYhdXx8dGhpcy51bmV4cGVjdGVkKHRoaXMubGFzdFRva1N0YXJ0KSxvJiZ0aGlzLnVuZXhwZWN0ZWQobyksdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMoZCwhMCksdGhpcy55aWVsZFBvcz1wfHx0aGlzLnlpZWxkUG9zLHRoaXMuYXdhaXRQb3M9Znx8dGhpcy5hd2FpdFBvcyxjLmxlbmd0aD4xPygocz10aGlzLnN0YXJ0Tm9kZUF0KGEsbCkpLmV4cHJlc3Npb25zPWMsdGhpcy5maW5pc2hOb2RlQXQocywiU2VxdWVuY2VFeHByZXNzaW9uIixtLGcpKTpzPWNbMF07fWVsc2Ugcz10aGlzLnBhcnNlUGFyZW5FeHByZXNzaW9uKCk7aWYodGhpcy5vcHRpb25zLnByZXNlcnZlUGFyZW5zKXt2YXIgeT10aGlzLnN0YXJ0Tm9kZUF0KGksbik7cmV0dXJuIHkuZXhwcmVzc2lvbj1zLHRoaXMuZmluaXNoTm9kZSh5LCJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiIpfXJldHVybiBzfSxRYy5wYXJzZVBhcmVuSXRlbT1mdW5jdGlvbihlKXtyZXR1cm4gZX0sUWMucGFyc2VQYXJlbkFycm93TGlzdD1mdW5jdGlvbihlLHQscyxpKXtyZXR1cm4gdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KGUsdCkscywhMSxpKX07dmFyIEpjPVtdO1FjLnBhcnNlTmV3PWZ1bmN0aW9uKCl7dGhpcy5jb250YWluc0VzYyYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkVzY2FwZSBzZXF1ZW5jZSBpbiBrZXl3b3JkIG5ldyIpO3ZhciBlPXRoaXMuc3RhcnROb2RlKCksdD10aGlzLnBhcnNlSWRlbnQoITApO2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmdGhpcy5lYXQodWMuZG90KSl7ZS5tZXRhPXQ7dmFyIHM9dGhpcy5jb250YWluc0VzYztyZXR1cm4gZS5wcm9wZXJ0eT10aGlzLnBhcnNlSWRlbnQoITApLCJ0YXJnZXQiIT09ZS5wcm9wZXJ0eS5uYW1lJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5wcm9wZXJ0eS5zdGFydCwiVGhlIG9ubHkgdmFsaWQgbWV0YSBwcm9wZXJ0eSBmb3IgbmV3IGlzICduZXcudGFyZ2V0JyIpLHMmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCInbmV3LnRhcmdldCcgbXVzdCBub3QgY29udGFpbiBlc2NhcGVkIGNoYXJhY3RlcnMiKSx0aGlzLmFsbG93TmV3RG90VGFyZ2V0fHx0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiJ25ldy50YXJnZXQnIGNhbiBvbmx5IGJlIHVzZWQgaW4gZnVuY3Rpb25zIGFuZCBjbGFzcyBzdGF0aWMgYmxvY2siKSx0aGlzLmZpbmlzaE5vZGUoZSwiTWV0YVByb3BlcnR5Iil9dmFyIGk9dGhpcy5zdGFydCxuPXRoaXMuc3RhcnRMb2M7cmV0dXJuIGUuY2FsbGVlPXRoaXMucGFyc2VTdWJzY3JpcHRzKHRoaXMucGFyc2VFeHByQXRvbShudWxsLCExLCEwKSxpLG4sITAsITEpLHRoaXMuZWF0KHVjLnBhcmVuTCk/ZS5hcmd1bWVudHM9dGhpcy5wYXJzZUV4cHJMaXN0KHVjLnBhcmVuUix0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgsITEpOmUuYXJndW1lbnRzPUpjLHRoaXMuZmluaXNoTm9kZShlLCJOZXdFeHByZXNzaW9uIil9LFFjLnBhcnNlVGVtcGxhdGVFbGVtZW50PWZ1bmN0aW9uKGUpe3ZhciB0PWUuaXNUYWdnZWQscz10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLnR5cGU9PT11Yy5pbnZhbGlkVGVtcGxhdGU/KHR8fHRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJCYWQgZXNjYXBlIHNlcXVlbmNlIGluIHVudGFnZ2VkIHRlbXBsYXRlIGxpdGVyYWwiKSxzLnZhbHVlPXtyYXc6dGhpcy52YWx1ZSxjb29rZWQ6bnVsbH0pOnMudmFsdWU9e3Jhdzp0aGlzLmlucHV0LnNsaWNlKHRoaXMuc3RhcnQsdGhpcy5lbmQpLnJlcGxhY2UoL1xyXG4/L2csIlxuIiksY29va2VkOnRoaXMudmFsdWV9LHRoaXMubmV4dCgpLHMudGFpbD10aGlzLnR5cGU9PT11Yy5iYWNrUXVvdGUsdGhpcy5maW5pc2hOb2RlKHMsIlRlbXBsYXRlRWxlbWVudCIpfSxRYy5wYXJzZVRlbXBsYXRlPWZ1bmN0aW9uKGUpe3ZvaWQgMD09PWUmJihlPXt9KTt2YXIgdD1lLmlzVGFnZ2VkO3ZvaWQgMD09PXQmJih0PSExKTt2YXIgcz10aGlzLnN0YXJ0Tm9kZSgpO3RoaXMubmV4dCgpLHMuZXhwcmVzc2lvbnM9W107dmFyIGk9dGhpcy5wYXJzZVRlbXBsYXRlRWxlbWVudCh7aXNUYWdnZWQ6dH0pO2ZvcihzLnF1YXNpcz1baV07IWkudGFpbDspdGhpcy50eXBlPT09dWMuZW9mJiZ0aGlzLnJhaXNlKHRoaXMucG9zLCJVbnRlcm1pbmF0ZWQgdGVtcGxhdGUgbGl0ZXJhbCIpLHRoaXMuZXhwZWN0KHVjLmRvbGxhckJyYWNlTCkscy5leHByZXNzaW9ucy5wdXNoKHRoaXMucGFyc2VFeHByZXNzaW9uKCkpLHRoaXMuZXhwZWN0KHVjLmJyYWNlUikscy5xdWFzaXMucHVzaChpPXRoaXMucGFyc2VUZW1wbGF0ZUVsZW1lbnQoe2lzVGFnZ2VkOnR9KSk7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMuZmluaXNoTm9kZShzLCJUZW1wbGF0ZUxpdGVyYWwiKX0sUWMuaXNBc3luY1Byb3A9ZnVuY3Rpb24oZSl7cmV0dXJuICFlLmNvbXB1dGVkJiYiSWRlbnRpZmllciI9PT1lLmtleS50eXBlJiYiYXN5bmMiPT09ZS5rZXkubmFtZSYmKHRoaXMudHlwZT09PXVjLm5hbWV8fHRoaXMudHlwZT09PXVjLm51bXx8dGhpcy50eXBlPT09dWMuc3RyaW5nfHx0aGlzLnR5cGU9PT11Yy5icmFja2V0THx8dGhpcy50eXBlLmtleXdvcmR8fHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmdGhpcy50eXBlPT09dWMuc3RhcikmJiFkYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rRW5kLHRoaXMuc3RhcnQpKX0sUWMucGFyc2VPYmo9ZnVuY3Rpb24oZSx0KXt2YXIgcz10aGlzLnN0YXJ0Tm9kZSgpLGk9ITAsbj17fTtmb3Iocy5wcm9wZXJ0aWVzPVtdLHRoaXMubmV4dCgpOyF0aGlzLmVhdCh1Yy5icmFjZVIpOyl7aWYoaSlpPSExO2Vsc2UgaWYodGhpcy5leHBlY3QodWMuY29tbWEpLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NSYmdGhpcy5hZnRlclRyYWlsaW5nQ29tbWEodWMuYnJhY2VSKSlicmVhazt2YXIgcj10aGlzLnBhcnNlUHJvcGVydHkoZSx0KTtlfHx0aGlzLmNoZWNrUHJvcENsYXNoKHIsbix0KSxzLnByb3BlcnRpZXMucHVzaChyKTt9cmV0dXJuIHRoaXMuZmluaXNoTm9kZShzLGU/Ik9iamVjdFBhdHRlcm4iOiJPYmplY3RFeHByZXNzaW9uIil9LFFjLnBhcnNlUHJvcGVydHk9ZnVuY3Rpb24oZSx0KXt2YXIgcyxpLG4scixvPXRoaXMuc3RhcnROb2RlKCk7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05JiZ0aGlzLmVhdCh1Yy5lbGxpcHNpcykpcmV0dXJuIGU/KG8uYXJndW1lbnQ9dGhpcy5wYXJzZUlkZW50KCExKSx0aGlzLnR5cGU9PT11Yy5jb21tYSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudCIpLHRoaXMuZmluaXNoTm9kZShvLCJSZXN0RWxlbWVudCIpKTooby5hcmd1bWVudD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oITEsdCksdGhpcy50eXBlPT09dWMuY29tbWEmJnQmJnQudHJhaWxpbmdDb21tYTwwJiYodC50cmFpbGluZ0NvbW1hPXRoaXMuc3RhcnQpLHRoaXMuZmluaXNoTm9kZShvLCJTcHJlYWRFbGVtZW50IikpO3RoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmKG8ubWV0aG9kPSExLG8uc2hvcnRoYW5kPSExLChlfHx0KSYmKG49dGhpcy5zdGFydCxyPXRoaXMuc3RhcnRMb2MpLGV8fChzPXRoaXMuZWF0KHVjLnN0YXIpKSk7dmFyIGE9dGhpcy5jb250YWluc0VzYztyZXR1cm4gdGhpcy5wYXJzZVByb3BlcnR5TmFtZShvKSwhZSYmIWEmJnRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmIXMmJnRoaXMuaXNBc3luY1Byb3Aobyk/KGk9ITAscz10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJnRoaXMuZWF0KHVjLnN0YXIpLHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUobykpOmk9ITEsdGhpcy5wYXJzZVByb3BlcnR5VmFsdWUobyxlLHMsaSxuLHIsdCxhKSx0aGlzLmZpbmlzaE5vZGUobywiUHJvcGVydHkiKX0sUWMucGFyc2VHZXR0ZXJTZXR0ZXI9ZnVuY3Rpb24oZSl7ZS5raW5kPWUua2V5Lm5hbWUsdGhpcy5wYXJzZVByb3BlcnR5TmFtZShlKSxlLnZhbHVlPXRoaXMucGFyc2VNZXRob2QoITEpO3ZhciB0PSJnZXQiPT09ZS5raW5kPzA6MTtpZihlLnZhbHVlLnBhcmFtcy5sZW5ndGghPT10KXt2YXIgcz1lLnZhbHVlLnN0YXJ0OyJnZXQiPT09ZS5raW5kP3RoaXMucmFpc2VSZWNvdmVyYWJsZShzLCJnZXR0ZXIgc2hvdWxkIGhhdmUgbm8gcGFyYW1zIik6dGhpcy5yYWlzZVJlY292ZXJhYmxlKHMsInNldHRlciBzaG91bGQgaGF2ZSBleGFjdGx5IG9uZSBwYXJhbSIpO31lbHNlICJzZXQiPT09ZS5raW5kJiYiUmVzdEVsZW1lbnQiPT09ZS52YWx1ZS5wYXJhbXNbMF0udHlwZSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUudmFsdWUucGFyYW1zWzBdLnN0YXJ0LCJTZXR0ZXIgY2Fubm90IHVzZSByZXN0IHBhcmFtcyIpO30sUWMucGFyc2VQcm9wZXJ0eVZhbHVlPWZ1bmN0aW9uKGUsdCxzLGksbixyLG8sYSl7KHN8fGkpJiZ0aGlzLnR5cGU9PT11Yy5jb2xvbiYmdGhpcy51bmV4cGVjdGVkKCksdGhpcy5lYXQodWMuY29sb24pPyhlLnZhbHVlPXQ/dGhpcy5wYXJzZU1heWJlRGVmYXVsdCh0aGlzLnN0YXJ0LHRoaXMuc3RhcnRMb2MpOnRoaXMucGFyc2VNYXliZUFzc2lnbighMSxvKSxlLmtpbmQ9ImluaXQiKTp0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJnRoaXMudHlwZT09PXVjLnBhcmVuTD8odCYmdGhpcy51bmV4cGVjdGVkKCksZS5raW5kPSJpbml0IixlLm1ldGhvZD0hMCxlLnZhbHVlPXRoaXMucGFyc2VNZXRob2QocyxpKSk6dHx8YXx8ISh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTUpfHxlLmNvbXB1dGVkfHwiSWRlbnRpZmllciIhPT1lLmtleS50eXBlfHwiZ2V0IiE9PWUua2V5Lm5hbWUmJiJzZXQiIT09ZS5rZXkubmFtZXx8dGhpcy50eXBlPT09dWMuY29tbWF8fHRoaXMudHlwZT09PXVjLmJyYWNlUnx8dGhpcy50eXBlPT09dWMuZXE/dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiYhZS5jb21wdXRlZCYmIklkZW50aWZpZXIiPT09ZS5rZXkudHlwZT8oKHN8fGkpJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLmNoZWNrVW5yZXNlcnZlZChlLmtleSksImF3YWl0IiE9PWUua2V5Lm5hbWV8fHRoaXMuYXdhaXRJZGVudFBvc3x8KHRoaXMuYXdhaXRJZGVudFBvcz1uKSxlLmtpbmQ9ImluaXQiLHQ/ZS52YWx1ZT10aGlzLnBhcnNlTWF5YmVEZWZhdWx0KG4scix0aGlzLmNvcHlOb2RlKGUua2V5KSk6dGhpcy50eXBlPT09dWMuZXEmJm8/KG8uc2hvcnRoYW5kQXNzaWduPDAmJihvLnNob3J0aGFuZEFzc2lnbj10aGlzLnN0YXJ0KSxlLnZhbHVlPXRoaXMucGFyc2VNYXliZURlZmF1bHQobixyLHRoaXMuY29weU5vZGUoZS5rZXkpKSk6ZS52YWx1ZT10aGlzLmNvcHlOb2RlKGUua2V5KSxlLnNob3J0aGFuZD0hMCk6dGhpcy51bmV4cGVjdGVkKCk6KChzfHxpKSYmdGhpcy51bmV4cGVjdGVkKCksdGhpcy5wYXJzZUdldHRlclNldHRlcihlKSk7fSxRYy5wYXJzZVByb3BlcnR5TmFtZT1mdW5jdGlvbihlKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYpe2lmKHRoaXMuZWF0KHVjLmJyYWNrZXRMKSlyZXR1cm4gZS5jb21wdXRlZD0hMCxlLmtleT10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSx0aGlzLmV4cGVjdCh1Yy5icmFja2V0UiksZS5rZXk7ZS5jb21wdXRlZD0hMTt9cmV0dXJuIGUua2V5PXRoaXMudHlwZT09PXVjLm51bXx8dGhpcy50eXBlPT09dWMuc3RyaW5nP3RoaXMucGFyc2VFeHByQXRvbSgpOnRoaXMucGFyc2VJZGVudCgibmV2ZXIiIT09dGhpcy5vcHRpb25zLmFsbG93UmVzZXJ2ZWQpfSxRYy5pbml0RnVuY3Rpb249ZnVuY3Rpb24oZSl7ZS5pZD1udWxsLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmKGUuZ2VuZXJhdG9yPWUuZXhwcmVzc2lvbj0hMSksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04JiYoZS5hc3luYz0hMSk7fSxRYy5wYXJzZU1ldGhvZD1mdW5jdGlvbihlLHQscyl7dmFyIGk9dGhpcy5zdGFydE5vZGUoKSxuPXRoaXMueWllbGRQb3Mscj10aGlzLmF3YWl0UG9zLG89dGhpcy5hd2FpdElkZW50UG9zO3JldHVybiB0aGlzLmluaXRGdW5jdGlvbihpKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJihpLmdlbmVyYXRvcj1lKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgmJihpLmFzeW5jPSEhdCksdGhpcy55aWVsZFBvcz0wLHRoaXMuYXdhaXRQb3M9MCx0aGlzLmF3YWl0SWRlbnRQb3M9MCx0aGlzLmVudGVyU2NvcGUoNjR8TWModCxpLmdlbmVyYXRvcil8KHM/MTI4OjApKSx0aGlzLmV4cGVjdCh1Yy5wYXJlbkwpLGkucGFyYW1zPXRoaXMucGFyc2VCaW5kaW5nTGlzdCh1Yy5wYXJlblIsITEsdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04KSx0aGlzLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcygpLHRoaXMucGFyc2VGdW5jdGlvbkJvZHkoaSwhMSwhMCwhMSksdGhpcy55aWVsZFBvcz1uLHRoaXMuYXdhaXRQb3M9cix0aGlzLmF3YWl0SWRlbnRQb3M9byx0aGlzLmZpbmlzaE5vZGUoaSwiRnVuY3Rpb25FeHByZXNzaW9uIil9LFFjLnBhcnNlQXJyb3dFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCxzLGkpe3ZhciBuPXRoaXMueWllbGRQb3Mscj10aGlzLmF3YWl0UG9zLG89dGhpcy5hd2FpdElkZW50UG9zO3JldHVybiB0aGlzLmVudGVyU2NvcGUoMTZ8TWMocywhMSkpLHRoaXMuaW5pdEZ1bmN0aW9uKGUpLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmKGUuYXN5bmM9ISFzKSx0aGlzLnlpZWxkUG9zPTAsdGhpcy5hd2FpdFBvcz0wLHRoaXMuYXdhaXRJZGVudFBvcz0wLGUucGFyYW1zPXRoaXMudG9Bc3NpZ25hYmxlTGlzdCh0LCEwKSx0aGlzLnBhcnNlRnVuY3Rpb25Cb2R5KGUsITAsITEsaSksdGhpcy55aWVsZFBvcz1uLHRoaXMuYXdhaXRQb3M9cix0aGlzLmF3YWl0SWRlbnRQb3M9byx0aGlzLmZpbmlzaE5vZGUoZSwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iKX0sUWMucGFyc2VGdW5jdGlvbkJvZHk9ZnVuY3Rpb24oZSx0LHMsaSl7dmFyIG49dCYmdGhpcy50eXBlIT09dWMuYnJhY2VMLHI9dGhpcy5zdHJpY3Qsbz0hMTtpZihuKWUuYm9keT10aGlzLnBhcnNlTWF5YmVBc3NpZ24oaSksZS5leHByZXNzaW9uPSEwLHRoaXMuY2hlY2tQYXJhbXMoZSwhMSk7ZWxzZSB7dmFyIGE9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj03JiYhdGhpcy5pc1NpbXBsZVBhcmFtTGlzdChlLnBhcmFtcyk7ciYmIWF8fChvPXRoaXMuc3RyaWN0RGlyZWN0aXZlKHRoaXMuZW5kKSkmJmEmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCJJbGxlZ2FsICd1c2Ugc3RyaWN0JyBkaXJlY3RpdmUgaW4gZnVuY3Rpb24gd2l0aCBub24tc2ltcGxlIHBhcmFtZXRlciBsaXN0Iik7dmFyIGw9dGhpcy5sYWJlbHM7dGhpcy5sYWJlbHM9W10sbyYmKHRoaXMuc3RyaWN0PSEwKSx0aGlzLmNoZWNrUGFyYW1zKGUsIXImJiFvJiYhdCYmIXMmJnRoaXMuaXNTaW1wbGVQYXJhbUxpc3QoZS5wYXJhbXMpKSx0aGlzLnN0cmljdCYmZS5pZCYmdGhpcy5jaGVja0xWYWxTaW1wbGUoZS5pZCw1KSxlLmJvZHk9dGhpcy5wYXJzZUJsb2NrKCExLHZvaWQgMCxvJiYhciksZS5leHByZXNzaW9uPSExLHRoaXMuYWRhcHREaXJlY3RpdmVQcm9sb2d1ZShlLmJvZHkuYm9keSksdGhpcy5sYWJlbHM9bDt9dGhpcy5leGl0U2NvcGUoKTt9LFFjLmlzU2ltcGxlUGFyYW1MaXN0PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHM9ZTt0PHMubGVuZ3RoO3QrPTEpe2lmKCJJZGVudGlmaWVyIiE9PXNbdF0udHlwZSlyZXR1cm4gITF9cmV0dXJuICEwfSxRYy5jaGVja1BhcmFtcz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcz1PYmplY3QuY3JlYXRlKG51bGwpLGk9MCxuPWUucGFyYW1zO2k8bi5sZW5ndGg7aSs9MSl7dmFyIHI9bltpXTt0aGlzLmNoZWNrTFZhbElubmVyUGF0dGVybihyLDEsdD9udWxsOnMpO319LFFjLnBhcnNlRXhwckxpc3Q9ZnVuY3Rpb24oZSx0LHMsaSl7Zm9yKHZhciBuPVtdLHI9ITA7IXRoaXMuZWF0KGUpOyl7aWYocilyPSExO2Vsc2UgaWYodGhpcy5leHBlY3QodWMuY29tbWEpLHQmJnRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGUpKWJyZWFrO3ZhciBvPXZvaWQgMDtzJiZ0aGlzLnR5cGU9PT11Yy5jb21tYT9vPW51bGw6dGhpcy50eXBlPT09dWMuZWxsaXBzaXM/KG89dGhpcy5wYXJzZVNwcmVhZChpKSxpJiZ0aGlzLnR5cGU9PT11Yy5jb21tYSYmaS50cmFpbGluZ0NvbW1hPDAmJihpLnRyYWlsaW5nQ29tbWE9dGhpcy5zdGFydCkpOm89dGhpcy5wYXJzZU1heWJlQXNzaWduKCExLGkpLG4ucHVzaChvKTt9cmV0dXJuIG59LFFjLmNoZWNrVW5yZXNlcnZlZD1mdW5jdGlvbihlKXt2YXIgdD1lLnN0YXJ0LHM9ZS5lbmQsaT1lLm5hbWU7KHRoaXMuaW5HZW5lcmF0b3ImJiJ5aWVsZCI9PT1pJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodCwiQ2Fubm90IHVzZSAneWllbGQnIGFzIGlkZW50aWZpZXIgaW5zaWRlIGEgZ2VuZXJhdG9yIiksdGhpcy5pbkFzeW5jJiYiYXdhaXQiPT09aSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIkNhbm5vdCB1c2UgJ2F3YWl0JyBhcyBpZGVudGlmaWVyIGluc2lkZSBhbiBhc3luYyBmdW5jdGlvbiIpLHRoaXMuY3VycmVudFRoaXNTY29wZSgpLmluQ2xhc3NGaWVsZEluaXQmJiJhcmd1bWVudHMiPT09aSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIkNhbm5vdCB1c2UgJ2FyZ3VtZW50cycgaW4gY2xhc3MgZmllbGQgaW5pdGlhbGl6ZXIiKSwhdGhpcy5pbkNsYXNzU3RhdGljQmxvY2t8fCJhcmd1bWVudHMiIT09aSYmImF3YWl0IiE9PWl8fHRoaXMucmFpc2UodCwiQ2Fubm90IHVzZSAiK2krIiBpbiBjbGFzcyBzdGF0aWMgaW5pdGlhbGl6YXRpb24gYmxvY2siKSx0aGlzLmtleXdvcmRzLnRlc3QoaSkmJnRoaXMucmFpc2UodCwiVW5leHBlY3RlZCBrZXl3b3JkICciK2krIiciKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248NiYmLTEhPT10aGlzLmlucHV0LnNsaWNlKHQscykuaW5kZXhPZigiXFwiKSl8fCh0aGlzLnN0cmljdD90aGlzLnJlc2VydmVkV29yZHNTdHJpY3Q6dGhpcy5yZXNlcnZlZFdvcmRzKS50ZXN0KGkpJiYodGhpcy5pbkFzeW5jfHwiYXdhaXQiIT09aXx8dGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIkNhbm5vdCB1c2Uga2V5d29yZCAnYXdhaXQnIG91dHNpZGUgYW4gYXN5bmMgZnVuY3Rpb24iKSx0aGlzLnJhaXNlUmVjb3ZlcmFibGUodCwiVGhlIGtleXdvcmQgJyIraSsiJyBpcyByZXNlcnZlZCIpKTt9LFFjLnBhcnNlSWRlbnQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wYXJzZUlkZW50Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoISFlKSx0aGlzLmZpbmlzaE5vZGUodCwiSWRlbnRpZmllciIpLGV8fCh0aGlzLmNoZWNrVW5yZXNlcnZlZCh0KSwiYXdhaXQiIT09dC5uYW1lfHx0aGlzLmF3YWl0SWRlbnRQb3N8fCh0aGlzLmF3YWl0SWRlbnRQb3M9dC5zdGFydCkpLHR9LFFjLnBhcnNlSWRlbnROb2RlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy50eXBlPT09dWMubmFtZT9lLm5hbWU9dGhpcy52YWx1ZTp0aGlzLnR5cGUua2V5d29yZD8oZS5uYW1lPXRoaXMudHlwZS5rZXl3b3JkLCJjbGFzcyIhPT1lLm5hbWUmJiJmdW5jdGlvbiIhPT1lLm5hbWV8fHRoaXMubGFzdFRva0VuZD09PXRoaXMubGFzdFRva1N0YXJ0KzEmJjQ2PT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMubGFzdFRva1N0YXJ0KXx8dGhpcy5jb250ZXh0LnBvcCgpKTp0aGlzLnVuZXhwZWN0ZWQoKSxlfSxRYy5wYXJzZVByaXZhdGVJZGVudD1mdW5jdGlvbigpe3ZhciBlPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMudHlwZT09PXVjLnByaXZhdGVJZD9lLm5hbWU9dGhpcy52YWx1ZTp0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLm5leHQoKSx0aGlzLmZpbmlzaE5vZGUoZSwiUHJpdmF0ZUlkZW50aWZpZXIiKSx0aGlzLm9wdGlvbnMuY2hlY2tQcml2YXRlRmllbGRzJiYoMD09PXRoaXMucHJpdmF0ZU5hbWVTdGFjay5sZW5ndGg/dGhpcy5yYWlzZShlLnN0YXJ0LCJQcml2YXRlIGZpZWxkICcjIitlLm5hbWUrIicgbXVzdCBiZSBkZWNsYXJlZCBpbiBhbiBlbmNsb3NpbmcgY2xhc3MiKTp0aGlzLnByaXZhdGVOYW1lU3RhY2tbdGhpcy5wcml2YXRlTmFtZVN0YWNrLmxlbmd0aC0xXS51c2VkLnB1c2goZSkpLGV9LFFjLnBhcnNlWWllbGQ9ZnVuY3Rpb24oZSl7dGhpcy55aWVsZFBvc3x8KHRoaXMueWllbGRQb3M9dGhpcy5zdGFydCk7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy50eXBlPT09dWMuc2VtaXx8dGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKXx8dGhpcy50eXBlIT09dWMuc3RhciYmIXRoaXMudHlwZS5zdGFydHNFeHByPyh0LmRlbGVnYXRlPSExLHQuYXJndW1lbnQ9bnVsbCk6KHQuZGVsZWdhdGU9dGhpcy5lYXQodWMuc3RhciksdC5hcmd1bWVudD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oZSkpLHRoaXMuZmluaXNoTm9kZSh0LCJZaWVsZEV4cHJlc3Npb24iKX0sUWMucGFyc2VBd2FpdD1mdW5jdGlvbihlKXt0aGlzLmF3YWl0UG9zfHwodGhpcy5hd2FpdFBvcz10aGlzLnN0YXJ0KTt2YXIgdD10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoKSx0LmFyZ3VtZW50PXRoaXMucGFyc2VNYXliZVVuYXJ5KG51bGwsITAsITEsZSksdGhpcy5maW5pc2hOb2RlKHQsIkF3YWl0RXhwcmVzc2lvbiIpfTt2YXIgZWg9T2MucHJvdG90eXBlO2VoLnJhaXNlPWZ1bmN0aW9uKGUsdCl7dmFyIHM9Q2ModGhpcy5pbnB1dCxlKTt0Kz0iICgiK3MubGluZSsiOiIrcy5jb2x1bW4rIikiO3ZhciBpPW5ldyBTeW50YXhFcnJvcih0KTt0aHJvdyBpLnBvcz1lLGkubG9jPXMsaS5yYWlzZWRBdD10aGlzLnBvcyxpfSxlaC5yYWlzZVJlY292ZXJhYmxlPWVoLnJhaXNlLGVoLmN1clBvc2l0aW9uPWZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmxvY2F0aW9ucylyZXR1cm4gbmV3IHdjKHRoaXMuY3VyTGluZSx0aGlzLnBvcy10aGlzLmxpbmVTdGFydCl9O3ZhciB0aD1PYy5wcm90b3R5cGUsc2g9ZnVuY3Rpb24oZSl7dGhpcy5mbGFncz1lLHRoaXMudmFyPVtdLHRoaXMubGV4aWNhbD1bXSx0aGlzLmZ1bmN0aW9ucz1bXSx0aGlzLmluQ2xhc3NGaWVsZEluaXQ9ITE7fTt0aC5lbnRlclNjb3BlPWZ1bmN0aW9uKGUpe3RoaXMuc2NvcGVTdGFjay5wdXNoKG5ldyBzaChlKSk7fSx0aC5leGl0U2NvcGU9ZnVuY3Rpb24oKXt0aGlzLnNjb3BlU3RhY2sucG9wKCk7fSx0aC50cmVhdEZ1bmN0aW9uc0FzVmFySW5TY29wZT1mdW5jdGlvbihlKXtyZXR1cm4gMiZlLmZsYWdzfHwhdGhpcy5pbk1vZHVsZSYmMSZlLmZsYWdzfSx0aC5kZWNsYXJlTmFtZT1mdW5jdGlvbihlLHQscyl7dmFyIGk9ITE7aWYoMj09PXQpe3ZhciBuPXRoaXMuY3VycmVudFNjb3BlKCk7aT1uLmxleGljYWwuaW5kZXhPZihlKT4tMXx8bi5mdW5jdGlvbnMuaW5kZXhPZihlKT4tMXx8bi52YXIuaW5kZXhPZihlKT4tMSxuLmxleGljYWwucHVzaChlKSx0aGlzLmluTW9kdWxlJiYxJm4uZmxhZ3MmJmRlbGV0ZSB0aGlzLnVuZGVmaW5lZEV4cG9ydHNbZV07fWVsc2UgaWYoND09PXQpe3RoaXMuY3VycmVudFNjb3BlKCkubGV4aWNhbC5wdXNoKGUpO31lbHNlIGlmKDM9PT10KXt2YXIgcj10aGlzLmN1cnJlbnRTY29wZSgpO2k9dGhpcy50cmVhdEZ1bmN0aW9uc0FzVmFyP3IubGV4aWNhbC5pbmRleE9mKGUpPi0xOnIubGV4aWNhbC5pbmRleE9mKGUpPi0xfHxyLnZhci5pbmRleE9mKGUpPi0xLHIuZnVuY3Rpb25zLnB1c2goZSk7fWVsc2UgZm9yKHZhciBvPXRoaXMuc2NvcGVTdGFjay5sZW5ndGgtMTtvPj0wOy0tbyl7dmFyIGE9dGhpcy5zY29wZVN0YWNrW29dO2lmKGEubGV4aWNhbC5pbmRleE9mKGUpPi0xJiYhKDMyJmEuZmxhZ3MmJmEubGV4aWNhbFswXT09PWUpfHwhdGhpcy50cmVhdEZ1bmN0aW9uc0FzVmFySW5TY29wZShhKSYmYS5mdW5jdGlvbnMuaW5kZXhPZihlKT4tMSl7aT0hMDticmVha31pZihhLnZhci5wdXNoKGUpLHRoaXMuaW5Nb2R1bGUmJjEmYS5mbGFncyYmZGVsZXRlIHRoaXMudW5kZWZpbmVkRXhwb3J0c1tlXSwyNTkmYS5mbGFncylicmVha31pJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUocywiSWRlbnRpZmllciAnIitlKyInIGhhcyBhbHJlYWR5IGJlZW4gZGVjbGFyZWQiKTt9LHRoLmNoZWNrTG9jYWxFeHBvcnQ9ZnVuY3Rpb24oZSl7LTE9PT10aGlzLnNjb3BlU3RhY2tbMF0ubGV4aWNhbC5pbmRleE9mKGUubmFtZSkmJi0xPT09dGhpcy5zY29wZVN0YWNrWzBdLnZhci5pbmRleE9mKGUubmFtZSkmJih0aGlzLnVuZGVmaW5lZEV4cG9ydHNbZS5uYW1lXT1lKTt9LHRoLmN1cnJlbnRTY29wZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnNjb3BlU3RhY2tbdGhpcy5zY29wZVN0YWNrLmxlbmd0aC0xXX0sdGguY3VycmVudFZhclNjb3BlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuc2NvcGVTdGFjay5sZW5ndGgtMTs7ZS0tKXt2YXIgdD10aGlzLnNjb3BlU3RhY2tbZV07aWYoMjU5JnQuZmxhZ3MpcmV0dXJuIHR9fSx0aC5jdXJyZW50VGhpc1Njb3BlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuc2NvcGVTdGFjay5sZW5ndGgtMTs7ZS0tKXt2YXIgdD10aGlzLnNjb3BlU3RhY2tbZV07aWYoMjU5JnQuZmxhZ3MmJiEoMTYmdC5mbGFncykpcmV0dXJuIHR9fTt2YXIgaWg9ZnVuY3Rpb24oZSx0LHMpe3RoaXMudHlwZT0iIix0aGlzLnN0YXJ0PXQsdGhpcy5lbmQ9MCxlLm9wdGlvbnMubG9jYXRpb25zJiYodGhpcy5sb2M9bmV3IFBjKGUscykpLGUub3B0aW9ucy5kaXJlY3RTb3VyY2VGaWxlJiYodGhpcy5zb3VyY2VGaWxlPWUub3B0aW9ucy5kaXJlY3RTb3VyY2VGaWxlKSxlLm9wdGlvbnMucmFuZ2VzJiYodGhpcy5yYW5nZT1bdCwwXSk7fSxuaD1PYy5wcm90b3R5cGU7ZnVuY3Rpb24gcmgoZSx0LHMsaSl7cmV0dXJuIGUudHlwZT10LGUuZW5kPXMsdGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKGUubG9jLmVuZD1pKSx0aGlzLm9wdGlvbnMucmFuZ2VzJiYoZS5yYW5nZVsxXT1zKSxlfW5oLnN0YXJ0Tm9kZT1mdW5jdGlvbigpe3JldHVybiBuZXcgaWgodGhpcyx0aGlzLnN0YXJ0LHRoaXMuc3RhcnRMb2MpfSxuaC5zdGFydE5vZGVBdD1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgaWgodGhpcyxlLHQpfSxuaC5maW5pc2hOb2RlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHJoLmNhbGwodGhpcyxlLHQsdGhpcy5sYXN0VG9rRW5kLHRoaXMubGFzdFRva0VuZExvYyl9LG5oLmZpbmlzaE5vZGVBdD1mdW5jdGlvbihlLHQscyxpKXtyZXR1cm4gcmguY2FsbCh0aGlzLGUsdCxzLGkpfSxuaC5jb3B5Tm9kZT1mdW5jdGlvbihlKXt2YXIgdD1uZXcgaWgodGhpcyxlLnN0YXJ0LHRoaXMuc3RhcnRMb2MpO2Zvcih2YXIgcyBpbiBlKXRbc109ZVtzXTtyZXR1cm4gdH07dmFyIG9oPSJBU0NJSSBBU0NJSV9IZXhfRGlnaXQgQUhleCBBbHBoYWJldGljIEFscGhhIEFueSBBc3NpZ25lZCBCaWRpX0NvbnRyb2wgQmlkaV9DIEJpZGlfTWlycm9yZWQgQmlkaV9NIENhc2VfSWdub3JhYmxlIENJIENhc2VkIENoYW5nZXNfV2hlbl9DYXNlZm9sZGVkIENXQ0YgQ2hhbmdlc19XaGVuX0Nhc2VtYXBwZWQgQ1dDTSBDaGFuZ2VzX1doZW5fTG93ZXJjYXNlZCBDV0wgQ2hhbmdlc19XaGVuX05GS0NfQ2FzZWZvbGRlZCBDV0tDRiBDaGFuZ2VzX1doZW5fVGl0bGVjYXNlZCBDV1QgQ2hhbmdlc19XaGVuX1VwcGVyY2FzZWQgQ1dVIERhc2ggRGVmYXVsdF9JZ25vcmFibGVfQ29kZV9Qb2ludCBESSBEZXByZWNhdGVkIERlcCBEaWFjcml0aWMgRGlhIEVtb2ppIEVtb2ppX0NvbXBvbmVudCBFbW9qaV9Nb2RpZmllciBFbW9qaV9Nb2RpZmllcl9CYXNlIEVtb2ppX1ByZXNlbnRhdGlvbiBFeHRlbmRlciBFeHQgR3JhcGhlbWVfQmFzZSBHcl9CYXNlIEdyYXBoZW1lX0V4dGVuZCBHcl9FeHQgSGV4X0RpZ2l0IEhleCBJRFNfQmluYXJ5X09wZXJhdG9yIElEU0IgSURTX1RyaW5hcnlfT3BlcmF0b3IgSURTVCBJRF9Db250aW51ZSBJREMgSURfU3RhcnQgSURTIElkZW9ncmFwaGljIElkZW8gSm9pbl9Db250cm9sIEpvaW5fQyBMb2dpY2FsX09yZGVyX0V4Y2VwdGlvbiBMT0UgTG93ZXJjYXNlIExvd2VyIE1hdGggTm9uY2hhcmFjdGVyX0NvZGVfUG9pbnQgTkNoYXIgUGF0dGVybl9TeW50YXggUGF0X1N5biBQYXR0ZXJuX1doaXRlX1NwYWNlIFBhdF9XUyBRdW90YXRpb25fTWFyayBRTWFyayBSYWRpY2FsIFJlZ2lvbmFsX0luZGljYXRvciBSSSBTZW50ZW5jZV9UZXJtaW5hbCBTVGVybSBTb2Z0X0RvdHRlZCBTRCBUZXJtaW5hbF9QdW5jdHVhdGlvbiBUZXJtIFVuaWZpZWRfSWRlb2dyYXBoIFVJZGVvIFVwcGVyY2FzZSBVcHBlciBWYXJpYXRpb25fU2VsZWN0b3IgVlMgV2hpdGVfU3BhY2Ugc3BhY2UgWElEX0NvbnRpbnVlIFhJREMgWElEX1N0YXJ0IFhJRFMiLGFoPW9oKyIgRXh0ZW5kZWRfUGljdG9ncmFwaGljIixsaD1haCsiIEVCYXNlIEVDb21wIEVNb2QgRVByZXMgRXh0UGljdCIsY2g9ezk6b2gsMTA6YWgsMTE6YWgsMTI6bGgsMTM6bGgsMTQ6bGh9LGhoPXs5OiIiLDEwOiIiLDExOiIiLDEyOiIiLDEzOiIiLDE0OiJCYXNpY19FbW9qaSBFbW9qaV9LZXljYXBfU2VxdWVuY2UgUkdJX0Vtb2ppX01vZGlmaWVyX1NlcXVlbmNlIFJHSV9FbW9qaV9GbGFnX1NlcXVlbmNlIFJHSV9FbW9qaV9UYWdfU2VxdWVuY2UgUkdJX0Vtb2ppX1pXSl9TZXF1ZW5jZSBSR0lfRW1vamkifSx1aD0iQ2FzZWRfTGV0dGVyIExDIENsb3NlX1B1bmN0dWF0aW9uIFBlIENvbm5lY3Rvcl9QdW5jdHVhdGlvbiBQYyBDb250cm9sIENjIGNudHJsIEN1cnJlbmN5X1N5bWJvbCBTYyBEYXNoX1B1bmN0dWF0aW9uIFBkIERlY2ltYWxfTnVtYmVyIE5kIGRpZ2l0IEVuY2xvc2luZ19NYXJrIE1lIEZpbmFsX1B1bmN0dWF0aW9uIFBmIEZvcm1hdCBDZiBJbml0aWFsX1B1bmN0dWF0aW9uIFBpIExldHRlciBMIExldHRlcl9OdW1iZXIgTmwgTGluZV9TZXBhcmF0b3IgWmwgTG93ZXJjYXNlX0xldHRlciBMbCBNYXJrIE0gQ29tYmluaW5nX01hcmsgTWF0aF9TeW1ib2wgU20gTW9kaWZpZXJfTGV0dGVyIExtIE1vZGlmaWVyX1N5bWJvbCBTayBOb25zcGFjaW5nX01hcmsgTW4gTnVtYmVyIE4gT3Blbl9QdW5jdHVhdGlvbiBQcyBPdGhlciBDIE90aGVyX0xldHRlciBMbyBPdGhlcl9OdW1iZXIgTm8gT3RoZXJfUHVuY3R1YXRpb24gUG8gT3RoZXJfU3ltYm9sIFNvIFBhcmFncmFwaF9TZXBhcmF0b3IgWnAgUHJpdmF0ZV9Vc2UgQ28gUHVuY3R1YXRpb24gUCBwdW5jdCBTZXBhcmF0b3IgWiBTcGFjZV9TZXBhcmF0b3IgWnMgU3BhY2luZ19NYXJrIE1jIFN1cnJvZ2F0ZSBDcyBTeW1ib2wgUyBUaXRsZWNhc2VfTGV0dGVyIEx0IFVuYXNzaWduZWQgQ24gVXBwZXJjYXNlX0xldHRlciBMdSIsZGg9IkFkbGFtIEFkbG0gQWhvbSBBbmF0b2xpYW5fSGllcm9nbHlwaHMgSGx1dyBBcmFiaWMgQXJhYiBBcm1lbmlhbiBBcm1uIEF2ZXN0YW4gQXZzdCBCYWxpbmVzZSBCYWxpIEJhbXVtIEJhbXUgQmFzc2FfVmFoIEJhc3MgQmF0YWsgQmF0ayBCZW5nYWxpIEJlbmcgQmhhaWtzdWtpIEJoa3MgQm9wb21vZm8gQm9wbyBCcmFobWkgQnJhaCBCcmFpbGxlIEJyYWkgQnVnaW5lc2UgQnVnaSBCdWhpZCBCdWhkIENhbmFkaWFuX0Fib3JpZ2luYWwgQ2FucyBDYXJpYW4gQ2FyaSBDYXVjYXNpYW5fQWxiYW5pYW4gQWdoYiBDaGFrbWEgQ2FrbSBDaGFtIENoYW0gQ2hlcm9rZWUgQ2hlciBDb21tb24gWnl5eSBDb3B0aWMgQ29wdCBRYWFjIEN1bmVpZm9ybSBYc3V4IEN5cHJpb3QgQ3BydCBDeXJpbGxpYyBDeXJsIERlc2VyZXQgRHNydCBEZXZhbmFnYXJpIERldmEgRHVwbG95YW4gRHVwbCBFZ3lwdGlhbl9IaWVyb2dseXBocyBFZ3lwIEVsYmFzYW4gRWxiYSBFdGhpb3BpYyBFdGhpIEdlb3JnaWFuIEdlb3IgR2xhZ29saXRpYyBHbGFnIEdvdGhpYyBHb3RoIEdyYW50aGEgR3JhbiBHcmVlayBHcmVrIEd1amFyYXRpIEd1anIgR3VybXVraGkgR3VydSBIYW4gSGFuaSBIYW5ndWwgSGFuZyBIYW51bm9vIEhhbm8gSGF0cmFuIEhhdHIgSGVicmV3IEhlYnIgSGlyYWdhbmEgSGlyYSBJbXBlcmlhbF9BcmFtYWljIEFybWkgSW5oZXJpdGVkIFppbmggUWFhaSBJbnNjcmlwdGlvbmFsX1BhaGxhdmkgUGhsaSBJbnNjcmlwdGlvbmFsX1BhcnRoaWFuIFBydGkgSmF2YW5lc2UgSmF2YSBLYWl0aGkgS3RoaSBLYW5uYWRhIEtuZGEgS2F0YWthbmEgS2FuYSBLYXlhaF9MaSBLYWxpIEtoYXJvc2h0aGkgS2hhciBLaG1lciBLaG1yIEtob2praSBLaG9qIEtodWRhd2FkaSBTaW5kIExhbyBMYW9vIExhdGluIExhdG4gTGVwY2hhIExlcGMgTGltYnUgTGltYiBMaW5lYXJfQSBMaW5hIExpbmVhcl9CIExpbmIgTGlzdSBMaXN1IEx5Y2lhbiBMeWNpIEx5ZGlhbiBMeWRpIE1haGFqYW5pIE1haGogTWFsYXlhbGFtIE1seW0gTWFuZGFpYyBNYW5kIE1hbmljaGFlYW4gTWFuaSBNYXJjaGVuIE1hcmMgTWFzYXJhbV9Hb25kaSBHb25tIE1lZXRlaV9NYXllayBNdGVpIE1lbmRlX0tpa2FrdWkgTWVuZCBNZXJvaXRpY19DdXJzaXZlIE1lcmMgTWVyb2l0aWNfSGllcm9nbHlwaHMgTWVybyBNaWFvIFBscmQgTW9kaSBNb25nb2xpYW4gTW9uZyBNcm8gTXJvbyBNdWx0YW5pIE11bHQgTXlhbm1hciBNeW1yIE5hYmF0YWVhbiBOYmF0IE5ld19UYWlfTHVlIFRhbHUgTmV3YSBOZXdhIE5rbyBOa29vIE51c2h1IE5zaHUgT2doYW0gT2dhbSBPbF9DaGlraSBPbGNrIE9sZF9IdW5nYXJpYW4gSHVuZyBPbGRfSXRhbGljIEl0YWwgT2xkX05vcnRoX0FyYWJpYW4gTmFyYiBPbGRfUGVybWljIFBlcm0gT2xkX1BlcnNpYW4gWHBlbyBPbGRfU291dGhfQXJhYmlhbiBTYXJiIE9sZF9UdXJraWMgT3JraCBPcml5YSBPcnlhIE9zYWdlIE9zZ2UgT3NtYW55YSBPc21hIFBhaGF3aF9IbW9uZyBIbW5nIFBhbG15cmVuZSBQYWxtIFBhdV9DaW5fSGF1IFBhdWMgUGhhZ3NfUGEgUGhhZyBQaG9lbmljaWFuIFBobnggUHNhbHRlcl9QYWhsYXZpIFBobHAgUmVqYW5nIFJqbmcgUnVuaWMgUnVuciBTYW1hcml0YW4gU2FtciBTYXVyYXNodHJhIFNhdXIgU2hhcmFkYSBTaHJkIFNoYXZpYW4gU2hhdyBTaWRkaGFtIFNpZGQgU2lnbldyaXRpbmcgU2dudyBTaW5oYWxhIFNpbmggU29yYV9Tb21wZW5nIFNvcmEgU295b21ibyBTb3lvIFN1bmRhbmVzZSBTdW5kIFN5bG90aV9OYWdyaSBTeWxvIFN5cmlhYyBTeXJjIFRhZ2Fsb2cgVGdsZyBUYWdiYW53YSBUYWdiIFRhaV9MZSBUYWxlIFRhaV9UaGFtIExhbmEgVGFpX1ZpZXQgVGF2dCBUYWtyaSBUYWtyIFRhbWlsIFRhbWwgVGFuZ3V0IFRhbmcgVGVsdWd1IFRlbHUgVGhhYW5hIFRoYWEgVGhhaSBUaGFpIFRpYmV0YW4gVGlidCBUaWZpbmFnaCBUZm5nIFRpcmh1dGEgVGlyaCBVZ2FyaXRpYyBVZ2FyIFZhaSBWYWlpIFdhcmFuZ19DaXRpIFdhcmEgWWkgWWlpaSBaYW5hYmF6YXJfU3F1YXJlIFphbmIiLHBoPWRoKyIgRG9ncmEgRG9nciBHdW5qYWxhX0dvbmRpIEdvbmcgSGFuaWZpX1JvaGluZ3lhIFJvaGcgTWFrYXNhciBNYWthIE1lZGVmYWlkcmluIE1lZGYgT2xkX1NvZ2RpYW4gU29nbyBTb2dkaWFuIFNvZ2QiLGZoPXBoKyIgRWx5bWFpYyBFbHltIE5hbmRpbmFnYXJpIE5hbmQgTnlpYWtlbmdfUHVhY2h1ZV9IbW9uZyBIbW5wIFdhbmNobyBXY2hvIixtaD1maCsiIENob3Jhc21pYW4gQ2hycyBEaWFrIERpdmVzX0FrdXJ1IEtoaXRhbl9TbWFsbF9TY3JpcHQgS2l0cyBZZXppIFllemlkaSIsZ2g9bWgrIiBDeXByb19NaW5vYW4gQ3BtbiBPbGRfVXlnaHVyIE91Z3IgVGFuZ3NhIFRuc2EgVG90byBWaXRoa3VxaSBWaXRoIix5aD17OTpkaCwxMDpwaCwxMTpmaCwxMjptaCwxMzpnaCwxNDpnaCsiIEhya3QgS2F0YWthbmFfT3JfSGlyYWdhbmEgS2F3aSBOYWdfTXVuZGFyaSBOYWdtIFVua25vd24gWnp6eiJ9LHhoPXt9O2Z1bmN0aW9uIEVoKGUpe3ZhciB0PXhoW2VdPXtiaW5hcnk6QWMoY2hbZV0rIiAiK3VoKSxiaW5hcnlPZlN0cmluZ3M6QWMoaGhbZV0pLG5vbkJpbmFyeTp7R2VuZXJhbF9DYXRlZ29yeTpBYyh1aCksU2NyaXB0OkFjKHloW2VdKX19O3Qubm9uQmluYXJ5LlNjcmlwdF9FeHRlbnNpb25zPXQubm9uQmluYXJ5LlNjcmlwdCx0Lm5vbkJpbmFyeS5nYz10Lm5vbkJpbmFyeS5HZW5lcmFsX0NhdGVnb3J5LHQubm9uQmluYXJ5LnNjPXQubm9uQmluYXJ5LlNjcmlwdCx0Lm5vbkJpbmFyeS5zY3g9dC5ub25CaW5hcnkuU2NyaXB0X0V4dGVuc2lvbnM7fWZvcih2YXIgYmg9MCx2aD1bOSwxMCwxMSwxMiwxMywxNF07Ymg8dmgubGVuZ3RoO2JoKz0xKXtFaCh2aFtiaF0pO312YXIgU2g9T2MucHJvdG90eXBlLEFoPWZ1bmN0aW9uKGUpe3RoaXMucGFyc2VyPWUsdGhpcy52YWxpZEZsYWdzPSJnaW0iKyhlLm9wdGlvbnMuZWNtYVZlcnNpb24+PTY/InV5IjoiIikrKGUub3B0aW9ucy5lY21hVmVyc2lvbj49OT8icyI6IiIpKyhlLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEzPyJkIjoiIikrKGUub3B0aW9ucy5lY21hVmVyc2lvbj49MTU/InYiOiIiKSx0aGlzLnVuaWNvZGVQcm9wZXJ0aWVzPXhoW2Uub3B0aW9ucy5lY21hVmVyc2lvbj49MTQ/MTQ6ZS5vcHRpb25zLmVjbWFWZXJzaW9uXSx0aGlzLnNvdXJjZT0iIix0aGlzLmZsYWdzPSIiLHRoaXMuc3RhcnQ9MCx0aGlzLnN3aXRjaFU9ITEsdGhpcy5zd2l0Y2hWPSExLHRoaXMuc3dpdGNoTj0hMSx0aGlzLnBvcz0wLHRoaXMubGFzdEludFZhbHVlPTAsdGhpcy5sYXN0U3RyaW5nVmFsdWU9IiIsdGhpcy5sYXN0QXNzZXJ0aW9uSXNRdWFudGlmaWFibGU9ITEsdGhpcy5udW1DYXB0dXJpbmdQYXJlbnM9MCx0aGlzLm1heEJhY2tSZWZlcmVuY2U9MCx0aGlzLmdyb3VwTmFtZXM9W10sdGhpcy5iYWNrUmVmZXJlbmNlTmFtZXM9W107fTtmdW5jdGlvbiBraChlKXtyZXR1cm4gMzY9PT1lfHxlPj00MCYmZTw9NDN8fDQ2PT09ZXx8NjM9PT1lfHxlPj05MSYmZTw9OTR8fGU+PTEyMyYmZTw9MTI1fWZ1bmN0aW9uIEloKGUpe3JldHVybiBlPj02NSYmZTw9OTB8fGU+PTk3JiZlPD0xMjJ9QWgucHJvdG90eXBlLnJlc2V0PWZ1bmN0aW9uKGUsdCxzKXt2YXIgaT0tMSE9PXMuaW5kZXhPZigidiIpLG49LTEhPT1zLmluZGV4T2YoInUiKTt0aGlzLnN0YXJ0PTB8ZSx0aGlzLnNvdXJjZT10KyIiLHRoaXMuZmxhZ3M9cyxpJiZ0aGlzLnBhcnNlci5vcHRpb25zLmVjbWFWZXJzaW9uPj0xNT8odGhpcy5zd2l0Y2hVPSEwLHRoaXMuc3dpdGNoVj0hMCx0aGlzLnN3aXRjaE49ITApOih0aGlzLnN3aXRjaFU9biYmdGhpcy5wYXJzZXIub3B0aW9ucy5lY21hVmVyc2lvbj49Nix0aGlzLnN3aXRjaFY9ITEsdGhpcy5zd2l0Y2hOPW4mJnRoaXMucGFyc2VyLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkpO30sQWgucHJvdG90eXBlLnJhaXNlPWZ1bmN0aW9uKGUpe3RoaXMucGFyc2VyLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb246IC8iK3RoaXMuc291cmNlKyIvOiAiK2UpO30sQWgucHJvdG90eXBlLmF0PWZ1bmN0aW9uKGUsdCl7dm9pZCAwPT09dCYmKHQ9ITEpO3ZhciBzPXRoaXMuc291cmNlLGk9cy5sZW5ndGg7aWYoZT49aSlyZXR1cm4gLTE7dmFyIG49cy5jaGFyQ29kZUF0KGUpO2lmKCF0JiYhdGhpcy5zd2l0Y2hVfHxuPD01NTI5NXx8bj49NTczNDR8fGUrMT49aSlyZXR1cm4gbjt2YXIgcj1zLmNoYXJDb2RlQXQoZSsxKTtyZXR1cm4gcj49NTYzMjAmJnI8PTU3MzQzPyhuPDwxMCkrci01NjYxMzg4ODpufSxBaC5wcm90b3R5cGUubmV4dEluZGV4PWZ1bmN0aW9uKGUsdCl7dm9pZCAwPT09dCYmKHQ9ITEpO3ZhciBzPXRoaXMuc291cmNlLGk9cy5sZW5ndGg7aWYoZT49aSlyZXR1cm4gaTt2YXIgbixyPXMuY2hhckNvZGVBdChlKTtyZXR1cm4gIXQmJiF0aGlzLnN3aXRjaFV8fHI8PTU1Mjk1fHxyPj01NzM0NHx8ZSsxPj1pfHwobj1zLmNoYXJDb2RlQXQoZSsxKSk8NTYzMjB8fG4+NTczNDM/ZSsxOmUrMn0sQWgucHJvdG90eXBlLmN1cnJlbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWUmJihlPSExKSx0aGlzLmF0KHRoaXMucG9zLGUpfSxBaC5wcm90b3R5cGUubG9va2FoZWFkPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0hMSksdGhpcy5hdCh0aGlzLm5leHRJbmRleCh0aGlzLnBvcyxlKSxlKX0sQWgucHJvdG90eXBlLmFkdmFuY2U9ZnVuY3Rpb24oZSl7dm9pZCAwPT09ZSYmKGU9ITEpLHRoaXMucG9zPXRoaXMubmV4dEluZGV4KHRoaXMucG9zLGUpO30sQWgucHJvdG90eXBlLmVhdD1mdW5jdGlvbihlLHQpe3JldHVybiB2b2lkIDA9PT10JiYodD0hMSksdGhpcy5jdXJyZW50KHQpPT09ZSYmKHRoaXMuYWR2YW5jZSh0KSwhMCl9LEFoLnByb3RvdHlwZS5lYXRDaGFycz1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PSExKTtmb3IodmFyIHM9dGhpcy5wb3MsaT0wLG49ZTtpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV0sbz10aGlzLmF0KHMsdCk7aWYoLTE9PT1vfHxvIT09cilyZXR1cm4gITE7cz10aGlzLm5leHRJbmRleChzLHQpO31yZXR1cm4gdGhpcy5wb3M9cywhMH0sU2gudmFsaWRhdGVSZWdFeHBGbGFncz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS52YWxpZEZsYWdzLHM9ZS5mbGFncyxpPSExLG49ITEscj0wO3I8cy5sZW5ndGg7cisrKXt2YXIgbz1zLmNoYXJBdChyKTstMT09PXQuaW5kZXhPZihvKSYmdGhpcy5yYWlzZShlLnN0YXJ0LCJJbnZhbGlkIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnIikscy5pbmRleE9mKG8scisxKT4tMSYmdGhpcy5yYWlzZShlLnN0YXJ0LCJEdXBsaWNhdGUgcmVndWxhciBleHByZXNzaW9uIGZsYWciKSwidSI9PT1vJiYoaT0hMCksInYiPT09byYmKG49ITApO310aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTE1JiZpJiZuJiZ0aGlzLnJhaXNlKGUuc3RhcnQsIkludmFsaWQgcmVndWxhciBleHByZXNzaW9uIGZsYWciKTt9LFNoLnZhbGlkYXRlUmVnRXhwUGF0dGVybj1mdW5jdGlvbihlKXt0aGlzLnJlZ2V4cF9wYXR0ZXJuKGUpLCFlLnN3aXRjaE4mJnRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmZS5ncm91cE5hbWVzLmxlbmd0aD4wJiYoZS5zd2l0Y2hOPSEwLHRoaXMucmVnZXhwX3BhdHRlcm4oZSkpO30sU2gucmVnZXhwX3BhdHRlcm49ZnVuY3Rpb24oZSl7ZS5wb3M9MCxlLmxhc3RJbnRWYWx1ZT0wLGUubGFzdFN0cmluZ1ZhbHVlPSIiLGUubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlPSExLGUubnVtQ2FwdHVyaW5nUGFyZW5zPTAsZS5tYXhCYWNrUmVmZXJlbmNlPTAsZS5ncm91cE5hbWVzLmxlbmd0aD0wLGUuYmFja1JlZmVyZW5jZU5hbWVzLmxlbmd0aD0wLHRoaXMucmVnZXhwX2Rpc2p1bmN0aW9uKGUpLGUucG9zIT09ZS5zb3VyY2UubGVuZ3RoJiYoZS5lYXQoNDEpJiZlLnJhaXNlKCJVbm1hdGNoZWQgJyknIiksKGUuZWF0KDkzKXx8ZS5lYXQoMTI1KSkmJmUucmFpc2UoIkxvbmUgcXVhbnRpZmllciBicmFja2V0cyIpKSxlLm1heEJhY2tSZWZlcmVuY2U+ZS5udW1DYXB0dXJpbmdQYXJlbnMmJmUucmFpc2UoIkludmFsaWQgZXNjYXBlIik7Zm9yKHZhciB0PTAscz1lLmJhY2tSZWZlcmVuY2VOYW1lczt0PHMubGVuZ3RoO3QrPTEpe3ZhciBpPXNbdF07LTE9PT1lLmdyb3VwTmFtZXMuaW5kZXhPZihpKSYmZS5yYWlzZSgiSW52YWxpZCBuYW1lZCBjYXB0dXJlIHJlZmVyZW5jZWQiKTt9fSxTaC5yZWdleHBfZGlzanVuY3Rpb249ZnVuY3Rpb24oZSl7Zm9yKHRoaXMucmVnZXhwX2FsdGVybmF0aXZlKGUpO2UuZWF0KDEyNCk7KXRoaXMucmVnZXhwX2FsdGVybmF0aXZlKGUpO3RoaXMucmVnZXhwX2VhdFF1YW50aWZpZXIoZSwhMCkmJmUucmFpc2UoIk5vdGhpbmcgdG8gcmVwZWF0IiksZS5lYXQoMTIzKSYmZS5yYWlzZSgiTG9uZSBxdWFudGlmaWVyIGJyYWNrZXRzIik7fSxTaC5yZWdleHBfYWx0ZXJuYXRpdmU9ZnVuY3Rpb24oZSl7Zm9yKDtlLnBvczxlLnNvdXJjZS5sZW5ndGgmJnRoaXMucmVnZXhwX2VhdFRlcm0oZSk7KTt9LFNoLnJlZ2V4cF9lYXRUZXJtPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRBc3NlcnRpb24oZSk/KGUubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlJiZ0aGlzLnJlZ2V4cF9lYXRRdWFudGlmaWVyKGUpJiZlLnN3aXRjaFUmJmUucmFpc2UoIkludmFsaWQgcXVhbnRpZmllciIpLCEwKTohIShlLnN3aXRjaFU/dGhpcy5yZWdleHBfZWF0QXRvbShlKTp0aGlzLnJlZ2V4cF9lYXRFeHRlbmRlZEF0b20oZSkpJiYodGhpcy5yZWdleHBfZWF0UXVhbnRpZmllcihlKSwhMCl9LFNoLnJlZ2V4cF9lYXRBc3NlcnRpb249ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYoZS5sYXN0QXNzZXJ0aW9uSXNRdWFudGlmaWFibGU9ITEsZS5lYXQoOTQpfHxlLmVhdCgzNikpcmV0dXJuICEwO2lmKGUuZWF0KDkyKSl7aWYoZS5lYXQoNjYpfHxlLmVhdCg5OCkpcmV0dXJuICEwO2UucG9zPXQ7fWlmKGUuZWF0KDQwKSYmZS5lYXQoNjMpKXt2YXIgcz0hMTtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJihzPWUuZWF0KDYwKSksZS5lYXQoNjEpfHxlLmVhdCgzMykpcmV0dXJuIHRoaXMucmVnZXhwX2Rpc2p1bmN0aW9uKGUpLGUuZWF0KDQxKXx8ZS5yYWlzZSgiVW50ZXJtaW5hdGVkIGdyb3VwIiksZS5sYXN0QXNzZXJ0aW9uSXNRdWFudGlmaWFibGU9IXMsITB9cmV0dXJuIGUucG9zPXQsITF9LFNoLnJlZ2V4cF9lYXRRdWFudGlmaWVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PSExKSwhIXRoaXMucmVnZXhwX2VhdFF1YW50aWZpZXJQcmVmaXgoZSx0KSYmKGUuZWF0KDYzKSwhMCl9LFNoLnJlZ2V4cF9lYXRRdWFudGlmaWVyUHJlZml4PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuZWF0KDQyKXx8ZS5lYXQoNDMpfHxlLmVhdCg2Myl8fHRoaXMucmVnZXhwX2VhdEJyYWNlZFF1YW50aWZpZXIoZSx0KX0sU2gucmVnZXhwX2VhdEJyYWNlZFF1YW50aWZpZXI9ZnVuY3Rpb24oZSx0KXt2YXIgcz1lLnBvcztpZihlLmVhdCgxMjMpKXt2YXIgaT0wLG49LTE7aWYodGhpcy5yZWdleHBfZWF0RGVjaW1hbERpZ2l0cyhlKSYmKGk9ZS5sYXN0SW50VmFsdWUsZS5lYXQoNDQpJiZ0aGlzLnJlZ2V4cF9lYXREZWNpbWFsRGlnaXRzKGUpJiYobj1lLmxhc3RJbnRWYWx1ZSksZS5lYXQoMTI1KSkpcmV0dXJuIC0xIT09biYmbjxpJiYhdCYmZS5yYWlzZSgibnVtYmVycyBvdXQgb2Ygb3JkZXIgaW4ge30gcXVhbnRpZmllciIpLCEwO2Uuc3dpdGNoVSYmIXQmJmUucmFpc2UoIkluY29tcGxldGUgcXVhbnRpZmllciIpLGUucG9zPXM7fXJldHVybiAhMX0sU2gucmVnZXhwX2VhdEF0b209ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucmVnZXhwX2VhdFBhdHRlcm5DaGFyYWN0ZXJzKGUpfHxlLmVhdCg0Nil8fHRoaXMucmVnZXhwX2VhdFJldmVyc2VTb2xpZHVzQXRvbUVzY2FwZShlKXx8dGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3MoZSl8fHRoaXMucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXAoZSl8fHRoaXMucmVnZXhwX2VhdENhcHR1cmluZ0dyb3VwKGUpfSxTaC5yZWdleHBfZWF0UmV2ZXJzZVNvbGlkdXNBdG9tRXNjYXBlPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDkyKSl7aWYodGhpcy5yZWdleHBfZWF0QXRvbUVzY2FwZShlKSlyZXR1cm4gITA7ZS5wb3M9dDt9cmV0dXJuICExfSxTaC5yZWdleHBfZWF0VW5jYXB0dXJpbmdHcm91cD1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg0MCkpe2lmKGUuZWF0KDYzKSYmZS5lYXQoNTgpKXtpZih0aGlzLnJlZ2V4cF9kaXNqdW5jdGlvbihlKSxlLmVhdCg0MSkpcmV0dXJuICEwO2UucmFpc2UoIlVudGVybWluYXRlZCBncm91cCIpO31lLnBvcz10O31yZXR1cm4gITF9LFNoLnJlZ2V4cF9lYXRDYXB0dXJpbmdHcm91cD1mdW5jdGlvbihlKXtpZihlLmVhdCg0MCkpe2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OT90aGlzLnJlZ2V4cF9ncm91cFNwZWNpZmllcihlKTo2Mz09PWUuY3VycmVudCgpJiZlLnJhaXNlKCJJbnZhbGlkIGdyb3VwIiksdGhpcy5yZWdleHBfZGlzanVuY3Rpb24oZSksZS5lYXQoNDEpKXJldHVybiBlLm51bUNhcHR1cmluZ1BhcmVucys9MSwhMDtlLnJhaXNlKCJVbnRlcm1pbmF0ZWQgZ3JvdXAiKTt9cmV0dXJuICExfSxTaC5yZWdleHBfZWF0RXh0ZW5kZWRBdG9tPWZ1bmN0aW9uKGUpe3JldHVybiBlLmVhdCg0Nil8fHRoaXMucmVnZXhwX2VhdFJldmVyc2VTb2xpZHVzQXRvbUVzY2FwZShlKXx8dGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3MoZSl8fHRoaXMucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXAoZSl8fHRoaXMucmVnZXhwX2VhdENhcHR1cmluZ0dyb3VwKGUpfHx0aGlzLnJlZ2V4cF9lYXRJbnZhbGlkQnJhY2VkUXVhbnRpZmllcihlKXx8dGhpcy5yZWdleHBfZWF0RXh0ZW5kZWRQYXR0ZXJuQ2hhcmFjdGVyKGUpfSxTaC5yZWdleHBfZWF0SW52YWxpZEJyYWNlZFF1YW50aWZpZXI9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucmVnZXhwX2VhdEJyYWNlZFF1YW50aWZpZXIoZSwhMCkmJmUucmFpc2UoIk5vdGhpbmcgdG8gcmVwZWF0IiksITF9LFNoLnJlZ2V4cF9lYXRTeW50YXhDaGFyYWN0ZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jdXJyZW50KCk7cmV0dXJuICEha2godCkmJihlLmxhc3RJbnRWYWx1ZT10LGUuYWR2YW5jZSgpLCEwKX0sU2gucmVnZXhwX2VhdFBhdHRlcm5DaGFyYWN0ZXJzPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLnBvcyxzPTA7LTEhPT0ocz1lLmN1cnJlbnQoKSkmJiFraChzKTspZS5hZHZhbmNlKCk7cmV0dXJuIGUucG9zIT09dH0sU2gucmVnZXhwX2VhdEV4dGVuZGVkUGF0dGVybkNoYXJhY3Rlcj1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gISgtMT09PXR8fDM2PT09dHx8dD49NDAmJnQ8PTQzfHw0Nj09PXR8fDYzPT09dHx8OTE9PT10fHw5ND09PXR8fDEyND09PXQpJiYoZS5hZHZhbmNlKCksITApfSxTaC5yZWdleHBfZ3JvdXBTcGVjaWZpZXI9ZnVuY3Rpb24oZSl7aWYoZS5lYXQoNjMpKXtpZih0aGlzLnJlZ2V4cF9lYXRHcm91cE5hbWUoZSkpcmV0dXJuIC0xIT09ZS5ncm91cE5hbWVzLmluZGV4T2YoZS5sYXN0U3RyaW5nVmFsdWUpJiZlLnJhaXNlKCJEdXBsaWNhdGUgY2FwdHVyZSBncm91cCBuYW1lIiksdm9pZCBlLmdyb3VwTmFtZXMucHVzaChlLmxhc3RTdHJpbmdWYWx1ZSk7ZS5yYWlzZSgiSW52YWxpZCBncm91cCIpO319LFNoLnJlZ2V4cF9lYXRHcm91cE5hbWU9ZnVuY3Rpb24oZSl7aWYoZS5sYXN0U3RyaW5nVmFsdWU9IiIsZS5lYXQoNjApKXtpZih0aGlzLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyTmFtZShlKSYmZS5lYXQoNjIpKXJldHVybiAhMDtlLnJhaXNlKCJJbnZhbGlkIGNhcHR1cmUgZ3JvdXAgbmFtZSIpO31yZXR1cm4gITF9LFNoLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyTmFtZT1mdW5jdGlvbihlKXtpZihlLmxhc3RTdHJpbmdWYWx1ZT0iIix0aGlzLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyU3RhcnQoZSkpe2ZvcihlLmxhc3RTdHJpbmdWYWx1ZSs9a2MoZS5sYXN0SW50VmFsdWUpO3RoaXMucmVnZXhwX2VhdFJlZ0V4cElkZW50aWZpZXJQYXJ0KGUpOyllLmxhc3RTdHJpbmdWYWx1ZSs9a2MoZS5sYXN0SW50VmFsdWUpO3JldHVybiAhMH1yZXR1cm4gITF9LFNoLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyU3RhcnQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3Mscz10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExLGk9ZS5jdXJyZW50KHMpO3JldHVybiBlLmFkdmFuY2UocyksOTI9PT1pJiZ0aGlzLnJlZ2V4cF9lYXRSZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2UoZSxzKSYmKGk9ZS5sYXN0SW50VmFsdWUpLGZ1bmN0aW9uKGUpe3JldHVybiBpYyhlLCEwKXx8MzY9PT1lfHw5NT09PWV9KGkpPyhlLmxhc3RJbnRWYWx1ZT1pLCEwKTooZS5wb3M9dCwhMSl9LFNoLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyUGFydD1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcyxzPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTEsaT1lLmN1cnJlbnQocyk7cmV0dXJuIGUuYWR2YW5jZShzKSw5Mj09PWkmJnRoaXMucmVnZXhwX2VhdFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZShlLHMpJiYoaT1lLmxhc3RJbnRWYWx1ZSksZnVuY3Rpb24oZSl7cmV0dXJuIG5jKGUsITApfHwzNj09PWV8fDk1PT09ZXx8ODIwND09PWV8fDgyMDU9PT1lfShpKT8oZS5sYXN0SW50VmFsdWU9aSwhMCk6KGUucG9zPXQsITEpfSxTaC5yZWdleHBfZWF0QXRvbUVzY2FwZT1mdW5jdGlvbihlKXtyZXR1cm4gISEodGhpcy5yZWdleHBfZWF0QmFja1JlZmVyZW5jZShlKXx8dGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3NFc2NhcGUoZSl8fHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckVzY2FwZShlKXx8ZS5zd2l0Y2hOJiZ0aGlzLnJlZ2V4cF9lYXRLR3JvdXBOYW1lKGUpKXx8KGUuc3dpdGNoVSYmKDk5PT09ZS5jdXJyZW50KCkmJmUucmFpc2UoIkludmFsaWQgdW5pY29kZSBlc2NhcGUiKSxlLnJhaXNlKCJJbnZhbGlkIGVzY2FwZSIpKSwhMSl9LFNoLnJlZ2V4cF9lYXRCYWNrUmVmZXJlbmNlPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKHRoaXMucmVnZXhwX2VhdERlY2ltYWxFc2NhcGUoZSkpe3ZhciBzPWUubGFzdEludFZhbHVlO2lmKGUuc3dpdGNoVSlyZXR1cm4gcz5lLm1heEJhY2tSZWZlcmVuY2UmJihlLm1heEJhY2tSZWZlcmVuY2U9cyksITA7aWYoczw9ZS5udW1DYXB0dXJpbmdQYXJlbnMpcmV0dXJuICEwO2UucG9zPXQ7fXJldHVybiAhMX0sU2gucmVnZXhwX2VhdEtHcm91cE5hbWU9ZnVuY3Rpb24oZSl7aWYoZS5lYXQoMTA3KSl7aWYodGhpcy5yZWdleHBfZWF0R3JvdXBOYW1lKGUpKXJldHVybiBlLmJhY2tSZWZlcmVuY2VOYW1lcy5wdXNoKGUubGFzdFN0cmluZ1ZhbHVlKSwhMDtlLnJhaXNlKCJJbnZhbGlkIG5hbWVkIHJlZmVyZW5jZSIpO31yZXR1cm4gITF9LFNoLnJlZ2V4cF9lYXRDaGFyYWN0ZXJFc2NhcGU9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucmVnZXhwX2VhdENvbnRyb2xFc2NhcGUoZSl8fHRoaXMucmVnZXhwX2VhdENDb250cm9sTGV0dGVyKGUpfHx0aGlzLnJlZ2V4cF9lYXRaZXJvKGUpfHx0aGlzLnJlZ2V4cF9lYXRIZXhFc2NhcGVTZXF1ZW5jZShlKXx8dGhpcy5yZWdleHBfZWF0UmVnRXhwVW5pY29kZUVzY2FwZVNlcXVlbmNlKGUsITEpfHwhZS5zd2l0Y2hVJiZ0aGlzLnJlZ2V4cF9lYXRMZWdhY3lPY3RhbEVzY2FwZVNlcXVlbmNlKGUpfHx0aGlzLnJlZ2V4cF9lYXRJZGVudGl0eUVzY2FwZShlKX0sU2gucmVnZXhwX2VhdENDb250cm9sTGV0dGVyPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDk5KSl7aWYodGhpcy5yZWdleHBfZWF0Q29udHJvbExldHRlcihlKSlyZXR1cm4gITA7ZS5wb3M9dDt9cmV0dXJuICExfSxTaC5yZWdleHBfZWF0WmVybz1mdW5jdGlvbihlKXtyZXR1cm4gNDg9PT1lLmN1cnJlbnQoKSYmIUNoKGUubG9va2FoZWFkKCkpJiYoZS5sYXN0SW50VmFsdWU9MCxlLmFkdmFuY2UoKSwhMCl9LFNoLnJlZ2V4cF9lYXRDb250cm9sRXNjYXBlPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY3VycmVudCgpO3JldHVybiAxMTY9PT10PyhlLmxhc3RJbnRWYWx1ZT05LGUuYWR2YW5jZSgpLCEwKToxMTA9PT10PyhlLmxhc3RJbnRWYWx1ZT0xMCxlLmFkdmFuY2UoKSwhMCk6MTE4PT09dD8oZS5sYXN0SW50VmFsdWU9MTEsZS5hZHZhbmNlKCksITApOjEwMj09PXQ/KGUubGFzdEludFZhbHVlPTEyLGUuYWR2YW5jZSgpLCEwKToxMTQ9PT10JiYoZS5sYXN0SW50VmFsdWU9MTMsZS5hZHZhbmNlKCksITApfSxTaC5yZWdleHBfZWF0Q29udHJvbExldHRlcj1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gISFJaCh0KSYmKGUubGFzdEludFZhbHVlPXQlMzIsZS5hZHZhbmNlKCksITApfSxTaC5yZWdleHBfZWF0UmVnRXhwVW5pY29kZUVzY2FwZVNlcXVlbmNlPWZ1bmN0aW9uKGUsdCl7dm9pZCAwPT09dCYmKHQ9ITEpO3ZhciBzLGk9ZS5wb3Msbj10fHxlLnN3aXRjaFU7aWYoZS5lYXQoMTE3KSl7aWYodGhpcy5yZWdleHBfZWF0Rml4ZWRIZXhEaWdpdHMoZSw0KSl7dmFyIHI9ZS5sYXN0SW50VmFsdWU7aWYobiYmcj49NTUyOTYmJnI8PTU2MzE5KXt2YXIgbz1lLnBvcztpZihlLmVhdCg5MikmJmUuZWF0KDExNykmJnRoaXMucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzKGUsNCkpe3ZhciBhPWUubGFzdEludFZhbHVlO2lmKGE+PTU2MzIwJiZhPD01NzM0MylyZXR1cm4gZS5sYXN0SW50VmFsdWU9MTAyNCooci01NTI5NikrKGEtNTYzMjApKzY1NTM2LCEwfWUucG9zPW8sZS5sYXN0SW50VmFsdWU9cjt9cmV0dXJuICEwfWlmKG4mJmUuZWF0KDEyMykmJnRoaXMucmVnZXhwX2VhdEhleERpZ2l0cyhlKSYmZS5lYXQoMTI1KSYmKChzPWUubGFzdEludFZhbHVlKT49MCYmczw9MTExNDExMSkpcmV0dXJuICEwO24mJmUucmFpc2UoIkludmFsaWQgdW5pY29kZSBlc2NhcGUiKSxlLnBvcz1pO31yZXR1cm4gITF9LFNoLnJlZ2V4cF9lYXRJZGVudGl0eUVzY2FwZT1mdW5jdGlvbihlKXtpZihlLnN3aXRjaFUpcmV0dXJuICEhdGhpcy5yZWdleHBfZWF0U3ludGF4Q2hhcmFjdGVyKGUpfHwhIWUuZWF0KDQ3KSYmKGUubGFzdEludFZhbHVlPTQ3LCEwKTt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gISg5OT09PXR8fGUuc3dpdGNoTiYmMTA3PT09dCkmJihlLmxhc3RJbnRWYWx1ZT10LGUuYWR2YW5jZSgpLCEwKX0sU2gucmVnZXhwX2VhdERlY2ltYWxFc2NhcGU9ZnVuY3Rpb24oZSl7ZS5sYXN0SW50VmFsdWU9MDt2YXIgdD1lLmN1cnJlbnQoKTtpZih0Pj00OSYmdDw9NTcpe2Rve2UubGFzdEludFZhbHVlPTEwKmUubGFzdEludFZhbHVlKyh0LTQ4KSxlLmFkdmFuY2UoKTt9d2hpbGUoKHQ9ZS5jdXJyZW50KCkpPj00OCYmdDw9NTcpO3JldHVybiAhMH1yZXR1cm4gITF9O2Z1bmN0aW9uIHdoKGUpe3JldHVybiBJaChlKXx8OTU9PT1lfWZ1bmN0aW9uIFBoKGUpe3JldHVybiB3aChlKXx8Q2goZSl9ZnVuY3Rpb24gQ2goZSl7cmV0dXJuIGU+PTQ4JiZlPD01N31mdW5jdGlvbiAkaChlKXtyZXR1cm4gZT49NDgmJmU8PTU3fHxlPj02NSYmZTw9NzB8fGU+PTk3JiZlPD0xMDJ9ZnVuY3Rpb24gTmgoZSl7cmV0dXJuIGU+PTY1JiZlPD03MD9lLTY1KzEwOmU+PTk3JiZlPD0xMDI/ZS05NysxMDplLTQ4fWZ1bmN0aW9uIF9oKGUpe3JldHVybiBlPj00OCYmZTw9NTV9U2gucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzRXNjYXBlPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY3VycmVudCgpO2lmKGZ1bmN0aW9uKGUpe3JldHVybiAxMDA9PT1lfHw2OD09PWV8fDExNT09PWV8fDgzPT09ZXx8MTE5PT09ZXx8ODc9PT1lfSh0KSlyZXR1cm4gZS5sYXN0SW50VmFsdWU9LTEsZS5hZHZhbmNlKCksMTt2YXIgcz0hMTtpZihlLnN3aXRjaFUmJnRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmKChzPTgwPT09dCl8fDExMj09PXQpKXt2YXIgaTtpZihlLmxhc3RJbnRWYWx1ZT0tMSxlLmFkdmFuY2UoKSxlLmVhdCgxMjMpJiYoaT10aGlzLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZUV4cHJlc3Npb24oZSkpJiZlLmVhdCgxMjUpKXJldHVybiBzJiYyPT09aSYmZS5yYWlzZSgiSW52YWxpZCBwcm9wZXJ0eSBuYW1lIiksaTtlLnJhaXNlKCJJbnZhbGlkIHByb3BlcnR5IG5hbWUiKTt9cmV0dXJuIDB9LFNoLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZUV4cHJlc3Npb249ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYodGhpcy5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5TmFtZShlKSYmZS5lYXQoNjEpKXt2YXIgcz1lLmxhc3RTdHJpbmdWYWx1ZTtpZih0aGlzLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZShlKSl7dmFyIGk9ZS5sYXN0U3RyaW5nVmFsdWU7cmV0dXJuIHRoaXMucmVnZXhwX3ZhbGlkYXRlVW5pY29kZVByb3BlcnR5TmFtZUFuZFZhbHVlKGUscyxpKSwxfX1pZihlLnBvcz10LHRoaXMucmVnZXhwX2VhdExvbmVVbmljb2RlUHJvcGVydHlOYW1lT3JWYWx1ZShlKSl7dmFyIG49ZS5sYXN0U3RyaW5nVmFsdWU7cmV0dXJuIHRoaXMucmVnZXhwX3ZhbGlkYXRlVW5pY29kZVByb3BlcnR5TmFtZU9yVmFsdWUoZSxuKX1yZXR1cm4gMH0sU2gucmVnZXhwX3ZhbGlkYXRlVW5pY29kZVByb3BlcnR5TmFtZUFuZFZhbHVlPWZ1bmN0aW9uKGUsdCxzKXt2YyhlLnVuaWNvZGVQcm9wZXJ0aWVzLm5vbkJpbmFyeSx0KXx8ZS5yYWlzZSgiSW52YWxpZCBwcm9wZXJ0eSBuYW1lIiksZS51bmljb2RlUHJvcGVydGllcy5ub25CaW5hcnlbdF0udGVzdChzKXx8ZS5yYWlzZSgiSW52YWxpZCBwcm9wZXJ0eSB2YWx1ZSIpO30sU2gucmVnZXhwX3ZhbGlkYXRlVW5pY29kZVByb3BlcnR5TmFtZU9yVmFsdWU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS51bmljb2RlUHJvcGVydGllcy5iaW5hcnkudGVzdCh0KT8xOmUuc3dpdGNoViYmZS51bmljb2RlUHJvcGVydGllcy5iaW5hcnlPZlN0cmluZ3MudGVzdCh0KT8yOnZvaWQgZS5yYWlzZSgiSW52YWxpZCBwcm9wZXJ0eSBuYW1lIil9LFNoLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlOYW1lPWZ1bmN0aW9uKGUpe3ZhciB0PTA7Zm9yKGUubGFzdFN0cmluZ1ZhbHVlPSIiO3doKHQ9ZS5jdXJyZW50KCkpOyllLmxhc3RTdHJpbmdWYWx1ZSs9a2ModCksZS5hZHZhbmNlKCk7cmV0dXJuICIiIT09ZS5sYXN0U3RyaW5nVmFsdWV9LFNoLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZT1mdW5jdGlvbihlKXt2YXIgdD0wO2ZvcihlLmxhc3RTdHJpbmdWYWx1ZT0iIjtQaCh0PWUuY3VycmVudCgpKTspZS5sYXN0U3RyaW5nVmFsdWUrPWtjKHQpLGUuYWR2YW5jZSgpO3JldHVybiAiIiE9PWUubGFzdFN0cmluZ1ZhbHVlfSxTaC5yZWdleHBfZWF0TG9uZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZShlKX0sU2gucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzPWZ1bmN0aW9uKGUpe2lmKGUuZWF0KDkxKSl7dmFyIHQ9ZS5lYXQoOTQpLHM9dGhpcy5yZWdleHBfY2xhc3NDb250ZW50cyhlKTtyZXR1cm4gZS5lYXQoOTMpfHxlLnJhaXNlKCJVbnRlcm1pbmF0ZWQgY2hhcmFjdGVyIGNsYXNzIiksdCYmMj09PXMmJmUucmFpc2UoIk5lZ2F0ZWQgY2hhcmFjdGVyIGNsYXNzIG1heSBjb250YWluIHN0cmluZ3MiKSwhMH1yZXR1cm4gITF9LFNoLnJlZ2V4cF9jbGFzc0NvbnRlbnRzPWZ1bmN0aW9uKGUpe3JldHVybiA5Mz09PWUuY3VycmVudCgpPzE6ZS5zd2l0Y2hWP3RoaXMucmVnZXhwX2NsYXNzU2V0RXhwcmVzc2lvbihlKToodGhpcy5yZWdleHBfbm9uRW1wdHlDbGFzc1JhbmdlcyhlKSwxKX0sU2gucmVnZXhwX25vbkVtcHR5Q2xhc3NSYW5nZXM9ZnVuY3Rpb24oZSl7Zm9yKDt0aGlzLnJlZ2V4cF9lYXRDbGFzc0F0b20oZSk7KXt2YXIgdD1lLmxhc3RJbnRWYWx1ZTtpZihlLmVhdCg0NSkmJnRoaXMucmVnZXhwX2VhdENsYXNzQXRvbShlKSl7dmFyIHM9ZS5sYXN0SW50VmFsdWU7IWUuc3dpdGNoVXx8LTEhPT10JiYtMSE9PXN8fGUucmFpc2UoIkludmFsaWQgY2hhcmFjdGVyIGNsYXNzIiksLTEhPT10JiYtMSE9PXMmJnQ+cyYmZS5yYWlzZSgiUmFuZ2Ugb3V0IG9mIG9yZGVyIGluIGNoYXJhY3RlciBjbGFzcyIpO319fSxTaC5yZWdleHBfZWF0Q2xhc3NBdG9tPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDkyKSl7aWYodGhpcy5yZWdleHBfZWF0Q2xhc3NFc2NhcGUoZSkpcmV0dXJuICEwO2lmKGUuc3dpdGNoVSl7dmFyIHM9ZS5jdXJyZW50KCk7KDk5PT09c3x8X2gocykpJiZlLnJhaXNlKCJJbnZhbGlkIGNsYXNzIGVzY2FwZSIpLGUucmFpc2UoIkludmFsaWQgZXNjYXBlIik7fWUucG9zPXQ7fXZhciBpPWUuY3VycmVudCgpO3JldHVybiA5MyE9PWkmJihlLmxhc3RJbnRWYWx1ZT1pLGUuYWR2YW5jZSgpLCEwKX0sU2gucmVnZXhwX2VhdENsYXNzRXNjYXBlPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDk4KSlyZXR1cm4gZS5sYXN0SW50VmFsdWU9OCwhMDtpZihlLnN3aXRjaFUmJmUuZWF0KDQ1KSlyZXR1cm4gZS5sYXN0SW50VmFsdWU9NDUsITA7aWYoIWUuc3dpdGNoVSYmZS5lYXQoOTkpKXtpZih0aGlzLnJlZ2V4cF9lYXRDbGFzc0NvbnRyb2xMZXR0ZXIoZSkpcmV0dXJuICEwO2UucG9zPXQ7fXJldHVybiB0aGlzLnJlZ2V4cF9lYXRDaGFyYWN0ZXJDbGFzc0VzY2FwZShlKXx8dGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyRXNjYXBlKGUpfSxTaC5yZWdleHBfY2xhc3NTZXRFeHByZXNzaW9uPWZ1bmN0aW9uKGUpe3ZhciB0LHM9MTtpZih0aGlzLnJlZ2V4cF9lYXRDbGFzc1NldFJhbmdlKGUpKTtlbHNlIGlmKHQ9dGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRPcGVyYW5kKGUpKXsyPT09dCYmKHM9Mik7Zm9yKHZhciBpPWUucG9zO2UuZWF0Q2hhcnMoWzM4LDM4XSk7KTM4IT09ZS5jdXJyZW50KCkmJih0PXRoaXMucmVnZXhwX2VhdENsYXNzU2V0T3BlcmFuZChlKSk/MiE9PXQmJihzPTEpOmUucmFpc2UoIkludmFsaWQgY2hhcmFjdGVyIGluIGNoYXJhY3RlciBjbGFzcyIpO2lmKGkhPT1lLnBvcylyZXR1cm4gcztmb3IoO2UuZWF0Q2hhcnMoWzQ1LDQ1XSk7KXRoaXMucmVnZXhwX2VhdENsYXNzU2V0T3BlcmFuZChlKXx8ZS5yYWlzZSgiSW52YWxpZCBjaGFyYWN0ZXIgaW4gY2hhcmFjdGVyIGNsYXNzIik7aWYoaSE9PWUucG9zKXJldHVybiBzfWVsc2UgZS5yYWlzZSgiSW52YWxpZCBjaGFyYWN0ZXIgaW4gY2hhcmFjdGVyIGNsYXNzIik7Zm9yKDs7KWlmKCF0aGlzLnJlZ2V4cF9lYXRDbGFzc1NldFJhbmdlKGUpKXtpZighKHQ9dGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRPcGVyYW5kKGUpKSlyZXR1cm4gczsyPT09dCYmKHM9Mik7fX0sU2gucmVnZXhwX2VhdENsYXNzU2V0UmFuZ2U9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYodGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRDaGFyYWN0ZXIoZSkpe3ZhciBzPWUubGFzdEludFZhbHVlO2lmKGUuZWF0KDQ1KSYmdGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRDaGFyYWN0ZXIoZSkpe3ZhciBpPWUubGFzdEludFZhbHVlO3JldHVybiAtMSE9PXMmJi0xIT09aSYmcz5pJiZlLnJhaXNlKCJSYW5nZSBvdXQgb2Ygb3JkZXIgaW4gY2hhcmFjdGVyIGNsYXNzIiksITB9ZS5wb3M9dDt9cmV0dXJuICExfSxTaC5yZWdleHBfZWF0Q2xhc3NTZXRPcGVyYW5kPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRDbGFzc1NldENoYXJhY3RlcihlKT8xOnRoaXMucmVnZXhwX2VhdENsYXNzU3RyaW5nRGlzanVuY3Rpb24oZSl8fHRoaXMucmVnZXhwX2VhdE5lc3RlZENsYXNzKGUpfSxTaC5yZWdleHBfZWF0TmVzdGVkQ2xhc3M9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYoZS5lYXQoOTEpKXt2YXIgcz1lLmVhdCg5NCksaT10aGlzLnJlZ2V4cF9jbGFzc0NvbnRlbnRzKGUpO2lmKGUuZWF0KDkzKSlyZXR1cm4gcyYmMj09PWkmJmUucmFpc2UoIk5lZ2F0ZWQgY2hhcmFjdGVyIGNsYXNzIG1heSBjb250YWluIHN0cmluZ3MiKSxpO2UucG9zPXQ7fWlmKGUuZWF0KDkyKSl7dmFyIG49dGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3NFc2NhcGUoZSk7aWYobilyZXR1cm4gbjtlLnBvcz10O31yZXR1cm4gbnVsbH0sU2gucmVnZXhwX2VhdENsYXNzU3RyaW5nRGlzanVuY3Rpb249ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYoZS5lYXRDaGFycyhbOTIsMTEzXSkpe2lmKGUuZWF0KDEyMykpe3ZhciBzPXRoaXMucmVnZXhwX2NsYXNzU3RyaW5nRGlzanVuY3Rpb25Db250ZW50cyhlKTtpZihlLmVhdCgxMjUpKXJldHVybiBzfWVsc2UgZS5yYWlzZSgiSW52YWxpZCBlc2NhcGUiKTtlLnBvcz10O31yZXR1cm4gbnVsbH0sU2gucmVnZXhwX2NsYXNzU3RyaW5nRGlzanVuY3Rpb25Db250ZW50cz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy5yZWdleHBfY2xhc3NTdHJpbmcoZSk7ZS5lYXQoMTI0KTspMj09PXRoaXMucmVnZXhwX2NsYXNzU3RyaW5nKGUpJiYodD0yKTtyZXR1cm4gdH0sU2gucmVnZXhwX2NsYXNzU3RyaW5nPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wO3RoaXMucmVnZXhwX2VhdENsYXNzU2V0Q2hhcmFjdGVyKGUpOyl0Kys7cmV0dXJuIDE9PT10PzE6Mn0sU2gucmVnZXhwX2VhdENsYXNzU2V0Q2hhcmFjdGVyPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDkyKSlyZXR1cm4gISghdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyRXNjYXBlKGUpJiYhdGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRSZXNlcnZlZFB1bmN0dWF0b3IoZSkpfHwoZS5lYXQoOTgpPyhlLmxhc3RJbnRWYWx1ZT04LCEwKTooZS5wb3M9dCwhMSkpO3ZhciBzPWUuY3VycmVudCgpO3JldHVybiAhKHM8MHx8cz09PWUubG9va2FoZWFkKCkmJmZ1bmN0aW9uKGUpe3JldHVybiAzMz09PWV8fGU+PTM1JiZlPD0zOHx8ZT49NDImJmU8PTQ0fHw0Nj09PWV8fGU+PTU4JiZlPD02NHx8OTQ9PT1lfHw5Nj09PWV8fDEyNj09PWV9KHMpKSYmKCFmdW5jdGlvbihlKXtyZXR1cm4gNDA9PT1lfHw0MT09PWV8fDQ1PT09ZXx8NDc9PT1lfHxlPj05MSYmZTw9OTN8fGU+PTEyMyYmZTw9MTI1fShzKSYmKGUuYWR2YW5jZSgpLGUubGFzdEludFZhbHVlPXMsITApKX0sU2gucmVnZXhwX2VhdENsYXNzU2V0UmVzZXJ2ZWRQdW5jdHVhdG9yPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY3VycmVudCgpO3JldHVybiAhIWZ1bmN0aW9uKGUpe3JldHVybiAzMz09PWV8fDM1PT09ZXx8Mzc9PT1lfHwzOD09PWV8fDQ0PT09ZXx8NDU9PT1lfHxlPj01OCYmZTw9NjJ8fDY0PT09ZXx8OTY9PT1lfHwxMjY9PT1lfSh0KSYmKGUubGFzdEludFZhbHVlPXQsZS5hZHZhbmNlKCksITApfSxTaC5yZWdleHBfZWF0Q2xhc3NDb250cm9sTGV0dGVyPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY3VycmVudCgpO3JldHVybiAhKCFDaCh0KSYmOTUhPT10KSYmKGUubGFzdEludFZhbHVlPXQlMzIsZS5hZHZhbmNlKCksITApfSxTaC5yZWdleHBfZWF0SGV4RXNjYXBlU2VxdWVuY2U9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYoZS5lYXQoMTIwKSl7aWYodGhpcy5yZWdleHBfZWF0Rml4ZWRIZXhEaWdpdHMoZSwyKSlyZXR1cm4gITA7ZS5zd2l0Y2hVJiZlLnJhaXNlKCJJbnZhbGlkIGVzY2FwZSIpLGUucG9zPXQ7fXJldHVybiAhMX0sU2gucmVnZXhwX2VhdERlY2ltYWxEaWdpdHM9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3Mscz0wO2ZvcihlLmxhc3RJbnRWYWx1ZT0wO0NoKHM9ZS5jdXJyZW50KCkpOyllLmxhc3RJbnRWYWx1ZT0xMCplLmxhc3RJbnRWYWx1ZSsocy00OCksZS5hZHZhbmNlKCk7cmV0dXJuIGUucG9zIT09dH0sU2gucmVnZXhwX2VhdEhleERpZ2l0cz1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcyxzPTA7Zm9yKGUubGFzdEludFZhbHVlPTA7JGgocz1lLmN1cnJlbnQoKSk7KWUubGFzdEludFZhbHVlPTE2KmUubGFzdEludFZhbHVlK05oKHMpLGUuYWR2YW5jZSgpO3JldHVybiBlLnBvcyE9PXR9LFNoLnJlZ2V4cF9lYXRMZWdhY3lPY3RhbEVzY2FwZVNlcXVlbmNlPWZ1bmN0aW9uKGUpe2lmKHRoaXMucmVnZXhwX2VhdE9jdGFsRGlnaXQoZSkpe3ZhciB0PWUubGFzdEludFZhbHVlO2lmKHRoaXMucmVnZXhwX2VhdE9jdGFsRGlnaXQoZSkpe3ZhciBzPWUubGFzdEludFZhbHVlO3Q8PTMmJnRoaXMucmVnZXhwX2VhdE9jdGFsRGlnaXQoZSk/ZS5sYXN0SW50VmFsdWU9NjQqdCs4KnMrZS5sYXN0SW50VmFsdWU6ZS5sYXN0SW50VmFsdWU9OCp0K3M7fWVsc2UgZS5sYXN0SW50VmFsdWU9dDtyZXR1cm4gITB9cmV0dXJuICExfSxTaC5yZWdleHBfZWF0T2N0YWxEaWdpdD1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gX2godCk/KGUubGFzdEludFZhbHVlPXQtNDgsZS5hZHZhbmNlKCksITApOihlLmxhc3RJbnRWYWx1ZT0wLCExKX0sU2gucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzPWZ1bmN0aW9uKGUsdCl7dmFyIHM9ZS5wb3M7ZS5sYXN0SW50VmFsdWU9MDtmb3IodmFyIGk9MDtpPHQ7KytpKXt2YXIgbj1lLmN1cnJlbnQoKTtpZighJGgobikpcmV0dXJuIGUucG9zPXMsITE7ZS5sYXN0SW50VmFsdWU9MTYqZS5sYXN0SW50VmFsdWUrTmgobiksZS5hZHZhbmNlKCk7fXJldHVybiAhMH07dmFyIFJoPWZ1bmN0aW9uKGUpe3RoaXMudHlwZT1lLnR5cGUsdGhpcy52YWx1ZT1lLnZhbHVlLHRoaXMuc3RhcnQ9ZS5zdGFydCx0aGlzLmVuZD1lLmVuZCxlLm9wdGlvbnMubG9jYXRpb25zJiYodGhpcy5sb2M9bmV3IFBjKGUsZS5zdGFydExvYyxlLmVuZExvYykpLGUub3B0aW9ucy5yYW5nZXMmJih0aGlzLnJhbmdlPVtlLnN0YXJ0LGUuZW5kXSk7fSxNaD1PYy5wcm90b3R5cGU7ZnVuY3Rpb24gT2goZSl7cmV0dXJuICJmdW5jdGlvbiIhPXR5cGVvZiBCaWdJbnQ/bnVsbDpCaWdJbnQoZS5yZXBsYWNlKC9fL2csIiIpKX1NaC5uZXh0PWZ1bmN0aW9uKGUpeyFlJiZ0aGlzLnR5cGUua2V5d29yZCYmdGhpcy5jb250YWluc0VzYyYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkVzY2FwZSBzZXF1ZW5jZSBpbiBrZXl3b3JkICIrdGhpcy50eXBlLmtleXdvcmQpLHRoaXMub3B0aW9ucy5vblRva2VuJiZ0aGlzLm9wdGlvbnMub25Ub2tlbihuZXcgUmgodGhpcykpLHRoaXMubGFzdFRva0VuZD10aGlzLmVuZCx0aGlzLmxhc3RUb2tTdGFydD10aGlzLnN0YXJ0LHRoaXMubGFzdFRva0VuZExvYz10aGlzLmVuZExvYyx0aGlzLmxhc3RUb2tTdGFydExvYz10aGlzLnN0YXJ0TG9jLHRoaXMubmV4dFRva2VuKCk7fSxNaC5nZXRUb2tlbj1mdW5jdGlvbigpe3JldHVybiB0aGlzLm5leHQoKSxuZXcgUmgodGhpcyl9LCJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiYoTWhbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3ZhciBlPXRoaXM7cmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7dmFyIHQ9ZS5nZXRUb2tlbigpO3JldHVybiB7ZG9uZTp0LnR5cGU9PT11Yy5lb2YsdmFsdWU6dH19fX0pLE1oLm5leHRUb2tlbj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuY3VyQ29udGV4dCgpO3JldHVybiBlJiZlLnByZXNlcnZlU3BhY2V8fHRoaXMuc2tpcFNwYWNlKCksdGhpcy5zdGFydD10aGlzLnBvcyx0aGlzLm9wdGlvbnMubG9jYXRpb25zJiYodGhpcy5zdGFydExvYz10aGlzLmN1clBvc2l0aW9uKCkpLHRoaXMucG9zPj10aGlzLmlucHV0Lmxlbmd0aD90aGlzLmZpbmlzaFRva2VuKHVjLmVvZik6ZS5vdmVycmlkZT9lLm92ZXJyaWRlKHRoaXMpOnZvaWQgdGhpcy5yZWFkVG9rZW4odGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpKX0sTWgucmVhZFRva2VuPWZ1bmN0aW9uKGUpe3JldHVybiBpYyhlLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Nil8fDkyPT09ZT90aGlzLnJlYWRXb3JkKCk6dGhpcy5nZXRUb2tlbkZyb21Db2RlKGUpfSxNaC5mdWxsQ2hhckNvZGVBdFBvcz1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7aWYoZTw9NTUyOTV8fGU+PTU2MzIwKXJldHVybiBlO3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtyZXR1cm4gdDw9NTYzMTl8fHQ+PTU3MzQ0P2U6KGU8PDEwKSt0LTU2NjEzODg4fSxNaC5za2lwQmxvY2tDb21tZW50PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcHRpb25zLm9uQ29tbWVudCYmdGhpcy5jdXJQb3NpdGlvbigpLHQ9dGhpcy5wb3Mscz10aGlzLmlucHV0LmluZGV4T2YoIiovIix0aGlzLnBvcys9Mik7aWYoLTE9PT1zJiZ0aGlzLnJhaXNlKHRoaXMucG9zLTIsIlVudGVybWluYXRlZCBjb21tZW50IiksdGhpcy5wb3M9cysyLHRoaXMub3B0aW9ucy5sb2NhdGlvbnMpZm9yKHZhciBpPXZvaWQgMCxuPXQ7KGk9bWModGhpcy5pbnB1dCxuLHRoaXMucG9zKSk+LTE7KSsrdGhpcy5jdXJMaW5lLG49dGhpcy5saW5lU3RhcnQ9aTt0aGlzLm9wdGlvbnMub25Db21tZW50JiZ0aGlzLm9wdGlvbnMub25Db21tZW50KCEwLHRoaXMuaW5wdXQuc2xpY2UodCsyLHMpLHQsdGhpcy5wb3MsZSx0aGlzLmN1clBvc2l0aW9uKCkpO30sTWguc2tpcExpbmVDb21tZW50PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD10aGlzLnBvcyxzPXRoaXMub3B0aW9ucy5vbkNvbW1lbnQmJnRoaXMuY3VyUG9zaXRpb24oKSxpPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcys9ZSk7dGhpcy5wb3M8dGhpcy5pbnB1dC5sZW5ndGgmJiFmYyhpKTspaT10aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnBvcyk7dGhpcy5vcHRpb25zLm9uQ29tbWVudCYmdGhpcy5vcHRpb25zLm9uQ29tbWVudCghMSx0aGlzLmlucHV0LnNsaWNlKHQrZSx0aGlzLnBvcyksdCx0aGlzLnBvcyxzLHRoaXMuY3VyUG9zaXRpb24oKSk7fSxNaC5za2lwU3BhY2U9ZnVuY3Rpb24oKXtlOmZvcig7dGhpcy5wb3M8dGhpcy5pbnB1dC5sZW5ndGg7KXt2YXIgZT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpO3N3aXRjaChlKXtjYXNlIDMyOmNhc2UgMTYwOisrdGhpcy5wb3M7YnJlYWs7Y2FzZSAxMzoxMD09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKSYmKyt0aGlzLnBvcztjYXNlIDEwOmNhc2UgODIzMjpjYXNlIDgyMzM6Kyt0aGlzLnBvcyx0aGlzLm9wdGlvbnMubG9jYXRpb25zJiYoKyt0aGlzLmN1ckxpbmUsdGhpcy5saW5lU3RhcnQ9dGhpcy5wb3MpO2JyZWFrO2Nhc2UgNDc6c3dpdGNoKHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKSl7Y2FzZSA0Mjp0aGlzLnNraXBCbG9ja0NvbW1lbnQoKTticmVhaztjYXNlIDQ3OnRoaXMuc2tpcExpbmVDb21tZW50KDIpO2JyZWFrO2RlZmF1bHQ6YnJlYWsgZX1icmVhaztkZWZhdWx0OmlmKCEoZT44JiZlPDE0fHxlPj01NzYwJiZnYy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZSkpKSlicmVhayBlOysrdGhpcy5wb3M7fX19LE1oLmZpbmlzaFRva2VuPWZ1bmN0aW9uKGUsdCl7dGhpcy5lbmQ9dGhpcy5wb3MsdGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKHRoaXMuZW5kTG9jPXRoaXMuY3VyUG9zaXRpb24oKSk7dmFyIHM9dGhpcy50eXBlO3RoaXMudHlwZT1lLHRoaXMudmFsdWU9dCx0aGlzLnVwZGF0ZUNvbnRleHQocyk7fSxNaC5yZWFkVG9rZW5fZG90PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO2lmKGU+PTQ4JiZlPD01NylyZXR1cm4gdGhpcy5yZWFkTnVtYmVyKCEwKTt2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMik7cmV0dXJuIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmNDY9PT1lJiY0Nj09PXQ/KHRoaXMucG9zKz0zLHRoaXMuZmluaXNoVG9rZW4odWMuZWxsaXBzaXMpKTooKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKHVjLmRvdCkpfSxNaC5yZWFkVG9rZW5fc2xhc2g9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSk7cmV0dXJuIHRoaXMuZXhwckFsbG93ZWQ/KCsrdGhpcy5wb3MsdGhpcy5yZWFkUmVnZXhwKCkpOjYxPT09ZT90aGlzLmZpbmlzaE9wKHVjLmFzc2lnbiwyKTp0aGlzLmZpbmlzaE9wKHVjLnNsYXNoLDEpfSxNaC5yZWFkVG9rZW5fbXVsdF9tb2R1bG9fZXhwPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKSxzPTEsaT00Mj09PWU/dWMuc3Rhcjp1Yy5tb2R1bG87cmV0dXJuIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NyYmNDI9PT1lJiY0Mj09PXQmJigrK3MsaT11Yy5zdGFyc3Rhcix0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKSksNjE9PT10P3RoaXMuZmluaXNoT3AodWMuYXNzaWduLHMrMSk6dGhpcy5maW5pc2hPcChpLHMpfSxNaC5yZWFkVG9rZW5fcGlwZV9hbXA9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO2lmKHQ9PT1lKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEyKWlmKDYxPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzIpKXJldHVybiB0aGlzLmZpbmlzaE9wKHVjLmFzc2lnbiwzKTtyZXR1cm4gdGhpcy5maW5pc2hPcCgxMjQ9PT1lP3VjLmxvZ2ljYWxPUjp1Yy5sb2dpY2FsQU5ELDIpfXJldHVybiA2MT09PXQ/dGhpcy5maW5pc2hPcCh1Yy5hc3NpZ24sMik6dGhpcy5maW5pc2hPcCgxMjQ9PT1lP3VjLmJpdHdpc2VPUjp1Yy5iaXR3aXNlQU5ELDEpfSxNaC5yZWFkVG9rZW5fY2FyZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gNjE9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSk/dGhpcy5maW5pc2hPcCh1Yy5hc3NpZ24sMik6dGhpcy5maW5pc2hPcCh1Yy5iaXR3aXNlWE9SLDEpfSxNaC5yZWFkVG9rZW5fcGx1c19taW49ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO3JldHVybiB0PT09ZT80NSE9PXR8fHRoaXMuaW5Nb2R1bGV8fDYyIT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzIpfHwwIT09dGhpcy5sYXN0VG9rRW5kJiYhZGMudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCx0aGlzLnBvcykpP3RoaXMuZmluaXNoT3AodWMuaW5jRGVjLDIpOih0aGlzLnNraXBMaW5lQ29tbWVudCgzKSx0aGlzLnNraXBTcGFjZSgpLHRoaXMubmV4dFRva2VuKCkpOjYxPT09dD90aGlzLmZpbmlzaE9wKHVjLmFzc2lnbiwyKTp0aGlzLmZpbmlzaE9wKHVjLnBsdXNNaW4sMSl9LE1oLnJlYWRUb2tlbl9sdF9ndD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSkscz0xO3JldHVybiB0PT09ZT8ocz02Mj09PWUmJjYyPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzIpPzM6Miw2MT09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcytzKT90aGlzLmZpbmlzaE9wKHVjLmFzc2lnbixzKzEpOnRoaXMuZmluaXNoT3AodWMuYml0U2hpZnQscykpOjMzIT09dHx8NjAhPT1lfHx0aGlzLmluTW9kdWxlfHw0NSE9PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKXx8NDUhPT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMyk/KDYxPT09dCYmKHM9MiksdGhpcy5maW5pc2hPcCh1Yy5yZWxhdGlvbmFsLHMpKToodGhpcy5za2lwTGluZUNvbW1lbnQoNCksdGhpcy5za2lwU3BhY2UoKSx0aGlzLm5leHRUb2tlbigpKX0sTWgucmVhZFRva2VuX2VxX2V4Y2w9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO3JldHVybiA2MT09PXQ/dGhpcy5maW5pc2hPcCh1Yy5lcXVhbGl0eSw2MT09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKT8zOjIpOjYxPT09ZSYmNjI9PT10JiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTY/KHRoaXMucG9zKz0yLHRoaXMuZmluaXNoVG9rZW4odWMuYXJyb3cpKTp0aGlzLmZpbmlzaE9wKDYxPT09ZT91Yy5lcTp1Yy5wcmVmaXgsMSl9LE1oLnJlYWRUb2tlbl9xdWVzdGlvbj1mdW5jdGlvbigpe3ZhciBlPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjtpZihlPj0xMSl7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO2lmKDQ2PT09dCl7dmFyIHM9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzIpO2lmKHM8NDh8fHM+NTcpcmV0dXJuIHRoaXMuZmluaXNoT3AodWMucXVlc3Rpb25Eb3QsMil9aWYoNjM9PT10KXtpZihlPj0xMilpZig2MT09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKSlyZXR1cm4gdGhpcy5maW5pc2hPcCh1Yy5hc3NpZ24sMyk7cmV0dXJuIHRoaXMuZmluaXNoT3AodWMuY29hbGVzY2UsMil9fXJldHVybiB0aGlzLmZpbmlzaE9wKHVjLnF1ZXN0aW9uLDEpfSxNaC5yZWFkVG9rZW5fbnVtYmVyU2lnbj1mdW5jdGlvbigpe3ZhciBlPTM1O2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTMmJigrK3RoaXMucG9zLGljKGU9dGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpLCEwKXx8OTI9PT1lKSlyZXR1cm4gdGhpcy5maW5pc2hUb2tlbih1Yy5wcml2YXRlSWQsdGhpcy5yZWFkV29yZDEoKSk7dGhpcy5yYWlzZSh0aGlzLnBvcywiVW5leHBlY3RlZCBjaGFyYWN0ZXIgJyIra2MoZSkrIiciKTt9LE1oLmdldFRva2VuRnJvbUNvZGU9ZnVuY3Rpb24oZSl7c3dpdGNoKGUpe2Nhc2UgNDY6cmV0dXJuIHRoaXMucmVhZFRva2VuX2RvdCgpO2Nhc2UgNDA6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5wYXJlbkwpO2Nhc2UgNDE6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5wYXJlblIpO2Nhc2UgNTk6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5zZW1pKTtjYXNlIDQ0OnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4odWMuY29tbWEpO2Nhc2UgOTE6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5icmFja2V0TCk7Y2FzZSA5MzpyZXR1cm4gKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKHVjLmJyYWNrZXRSKTtjYXNlIDEyMzpyZXR1cm4gKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKHVjLmJyYWNlTCk7Y2FzZSAxMjU6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5icmFjZVIpO2Nhc2UgNTg6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbih1Yy5jb2xvbik7Y2FzZSA5NjppZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248NilicmVhaztyZXR1cm4gKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKHVjLmJhY2tRdW90ZSk7Y2FzZSA0ODp2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSk7aWYoMTIwPT09dHx8ODg9PT10KXJldHVybiB0aGlzLnJlYWRSYWRpeE51bWJlcigxNik7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02KXtpZigxMTE9PT10fHw3OT09PXQpcmV0dXJuIHRoaXMucmVhZFJhZGl4TnVtYmVyKDgpO2lmKDk4PT09dHx8NjY9PT10KXJldHVybiB0aGlzLnJlYWRSYWRpeE51bWJlcigyKX1jYXNlIDQ5OmNhc2UgNTA6Y2FzZSA1MTpjYXNlIDUyOmNhc2UgNTM6Y2FzZSA1NDpjYXNlIDU1OmNhc2UgNTY6Y2FzZSA1NzpyZXR1cm4gdGhpcy5yZWFkTnVtYmVyKCExKTtjYXNlIDM0OmNhc2UgMzk6cmV0dXJuIHRoaXMucmVhZFN0cmluZyhlKTtjYXNlIDQ3OnJldHVybiB0aGlzLnJlYWRUb2tlbl9zbGFzaCgpO2Nhc2UgMzc6Y2FzZSA0MjpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fbXVsdF9tb2R1bG9fZXhwKGUpO2Nhc2UgMTI0OmNhc2UgMzg6cmV0dXJuIHRoaXMucmVhZFRva2VuX3BpcGVfYW1wKGUpO2Nhc2UgOTQ6cmV0dXJuIHRoaXMucmVhZFRva2VuX2NhcmV0KCk7Y2FzZSA0MzpjYXNlIDQ1OnJldHVybiB0aGlzLnJlYWRUb2tlbl9wbHVzX21pbihlKTtjYXNlIDYwOmNhc2UgNjI6cmV0dXJuIHRoaXMucmVhZFRva2VuX2x0X2d0KGUpO2Nhc2UgNjE6Y2FzZSAzMzpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fZXFfZXhjbChlKTtjYXNlIDYzOnJldHVybiB0aGlzLnJlYWRUb2tlbl9xdWVzdGlvbigpO2Nhc2UgMTI2OnJldHVybiB0aGlzLmZpbmlzaE9wKHVjLnByZWZpeCwxKTtjYXNlIDM1OnJldHVybiB0aGlzLnJlYWRUb2tlbl9udW1iZXJTaWduKCl9dGhpcy5yYWlzZSh0aGlzLnBvcywiVW5leHBlY3RlZCBjaGFyYWN0ZXIgJyIra2MoZSkrIiciKTt9LE1oLmZpbmlzaE9wPWZ1bmN0aW9uKGUsdCl7dmFyIHM9dGhpcy5pbnB1dC5zbGljZSh0aGlzLnBvcyx0aGlzLnBvcyt0KTtyZXR1cm4gdGhpcy5wb3MrPXQsdGhpcy5maW5pc2hUb2tlbihlLHMpfSxNaC5yZWFkUmVnZXhwPWZ1bmN0aW9uKCl7Zm9yKHZhciBlLHQscz10aGlzLnBvczs7KXt0aGlzLnBvcz49dGhpcy5pbnB1dC5sZW5ndGgmJnRoaXMucmFpc2UocywiVW50ZXJtaW5hdGVkIHJlZ3VsYXIgZXhwcmVzc2lvbiIpO3ZhciBpPXRoaXMuaW5wdXQuY2hhckF0KHRoaXMucG9zKTtpZihkYy50ZXN0KGkpJiZ0aGlzLnJhaXNlKHMsIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb24iKSxlKWU9ITE7ZWxzZSB7aWYoIlsiPT09aSl0PSEwO2Vsc2UgaWYoIl0iPT09aSYmdCl0PSExO2Vsc2UgaWYoIi8iPT09aSYmIXQpYnJlYWs7ZT0iXFwiPT09aTt9Kyt0aGlzLnBvczt9dmFyIG49dGhpcy5pbnB1dC5zbGljZShzLHRoaXMucG9zKTsrK3RoaXMucG9zO3ZhciByPXRoaXMucG9zLG89dGhpcy5yZWFkV29yZDEoKTt0aGlzLmNvbnRhaW5zRXNjJiZ0aGlzLnVuZXhwZWN0ZWQocik7dmFyIGE9dGhpcy5yZWdleHBTdGF0ZXx8KHRoaXMucmVnZXhwU3RhdGU9bmV3IEFoKHRoaXMpKTthLnJlc2V0KHMsbixvKSx0aGlzLnZhbGlkYXRlUmVnRXhwRmxhZ3MoYSksdGhpcy52YWxpZGF0ZVJlZ0V4cFBhdHRlcm4oYSk7dmFyIGw9bnVsbDt0cnl7bD1uZXcgUmVnRXhwKG4sbyk7fWNhdGNoKGUpe31yZXR1cm4gdGhpcy5maW5pc2hUb2tlbih1Yy5yZWdleHAse3BhdHRlcm46bixmbGFnczpvLHZhbHVlOmx9KX0sTWgucmVhZEludD1mdW5jdGlvbihlLHQscyl7Zm9yKHZhciBpPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTImJnZvaWQgMD09PXQsbj1zJiY0OD09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykscj10aGlzLnBvcyxvPTAsYT0wLGw9MCxjPW51bGw9PXQ/MS8wOnQ7bDxjOysrbCwrK3RoaXMucG9zKXt2YXIgaD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpLHU9dm9pZCAwO2lmKGkmJjk1PT09aCluJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5wb3MsIk51bWVyaWMgc2VwYXJhdG9yIGlzIG5vdCBhbGxvd2VkIGluIGxlZ2FjeSBvY3RhbCBudW1lcmljIGxpdGVyYWxzIiksOTU9PT1hJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5wb3MsIk51bWVyaWMgc2VwYXJhdG9yIG11c3QgYmUgZXhhY3RseSBvbmUgdW5kZXJzY29yZSIpLDA9PT1sJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5wb3MsIk51bWVyaWMgc2VwYXJhdG9yIGlzIG5vdCBhbGxvd2VkIGF0IHRoZSBmaXJzdCBvZiBkaWdpdHMiKSxhPWg7ZWxzZSB7aWYoKHU9aD49OTc/aC05NysxMDpoPj02NT9oLTY1KzEwOmg+PTQ4JiZoPD01Nz9oLTQ4OjEvMCk+PWUpYnJlYWs7YT1oLG89byplK3U7fX1yZXR1cm4gaSYmOTU9PT1hJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5wb3MtMSwiTnVtZXJpYyBzZXBhcmF0b3IgaXMgbm90IGFsbG93ZWQgYXQgdGhlIGxhc3Qgb2YgZGlnaXRzIiksdGhpcy5wb3M9PT1yfHxudWxsIT10JiZ0aGlzLnBvcy1yIT09dD9udWxsOm99LE1oLnJlYWRSYWRpeE51bWJlcj1mdW5jdGlvbihlKXt2YXIgdD10aGlzLnBvczt0aGlzLnBvcys9Mjt2YXIgcz10aGlzLnJlYWRJbnQoZSk7cmV0dXJuIG51bGw9PXMmJnRoaXMucmFpc2UodGhpcy5zdGFydCsyLCJFeHBlY3RlZCBudW1iZXIgaW4gcmFkaXggIitlKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExJiYxMTA9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpPyhzPU9oKHRoaXMuaW5wdXQuc2xpY2UodCx0aGlzLnBvcykpLCsrdGhpcy5wb3MpOmljKHRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSkmJnRoaXMucmFpc2UodGhpcy5wb3MsIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyIiksdGhpcy5maW5pc2hUb2tlbih1Yy5udW0scyl9LE1oLnJlYWROdW1iZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wb3M7ZXx8bnVsbCE9PXRoaXMucmVhZEludCgxMCx2b2lkIDAsITApfHx0aGlzLnJhaXNlKHQsIkludmFsaWQgbnVtYmVyIik7dmFyIHM9dGhpcy5wb3MtdD49MiYmNDg9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodCk7cyYmdGhpcy5zdHJpY3QmJnRoaXMucmFpc2UodCwiSW52YWxpZCBudW1iZXIiKTt2YXIgaT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpO2lmKCFzJiYhZSYmdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSYmMTEwPT09aSl7dmFyIG49T2godGhpcy5pbnB1dC5zbGljZSh0LHRoaXMucG9zKSk7cmV0dXJuICsrdGhpcy5wb3MsaWModGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpKSYmdGhpcy5yYWlzZSh0aGlzLnBvcywiSWRlbnRpZmllciBkaXJlY3RseSBhZnRlciBudW1iZXIiKSx0aGlzLmZpbmlzaFRva2VuKHVjLm51bSxuKX1zJiYvWzg5XS8udGVzdCh0aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpKSYmKHM9ITEpLDQ2IT09aXx8c3x8KCsrdGhpcy5wb3MsdGhpcy5yZWFkSW50KDEwKSxpPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykpLDY5IT09aSYmMTAxIT09aXx8c3x8KDQzIT09KGk9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KCsrdGhpcy5wb3MpKSYmNDUhPT1pfHwrK3RoaXMucG9zLG51bGw9PT10aGlzLnJlYWRJbnQoMTApJiZ0aGlzLnJhaXNlKHQsIkludmFsaWQgbnVtYmVyIikpLGljKHRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSkmJnRoaXMucmFpc2UodGhpcy5wb3MsIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyIik7dmFyIHIsbz0ocj10aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpLHM/cGFyc2VJbnQociw4KTpwYXJzZUZsb2F0KHIucmVwbGFjZSgvXy9nLCIiKSkpO3JldHVybiB0aGlzLmZpbmlzaFRva2VuKHVjLm51bSxvKX0sTWgucmVhZENvZGVQb2ludD1mdW5jdGlvbigpe3ZhciBlO2lmKDEyMz09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykpe3RoaXMub3B0aW9ucy5lY21hVmVyc2lvbjw2JiZ0aGlzLnVuZXhwZWN0ZWQoKTt2YXIgdD0rK3RoaXMucG9zO2U9dGhpcy5yZWFkSGV4Q2hhcih0aGlzLmlucHV0LmluZGV4T2YoIn0iLHRoaXMucG9zKS10aGlzLnBvcyksKyt0aGlzLnBvcyxlPjExMTQxMTEmJnRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHQsIkNvZGUgcG9pbnQgb3V0IG9mIGJvdW5kcyIpO31lbHNlIGU9dGhpcy5yZWFkSGV4Q2hhcig0KTtyZXR1cm4gZX0sTWgucmVhZFN0cmluZz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9IiIscz0rK3RoaXMucG9zOzspe3RoaXMucG9zPj10aGlzLmlucHV0Lmxlbmd0aCYmdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJVbnRlcm1pbmF0ZWQgc3RyaW5nIGNvbnN0YW50Iik7dmFyIGk9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtpZihpPT09ZSlicmVhazs5Mj09PWk/KHQrPXRoaXMuaW5wdXQuc2xpY2Uocyx0aGlzLnBvcyksdCs9dGhpcy5yZWFkRXNjYXBlZENoYXIoITEpLHM9dGhpcy5wb3MpOjgyMzI9PT1pfHw4MjMzPT09aT8odGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDEwJiZ0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIlVudGVybWluYXRlZCBzdHJpbmcgY29uc3RhbnQiKSwrK3RoaXMucG9zLHRoaXMub3B0aW9ucy5sb2NhdGlvbnMmJih0aGlzLmN1ckxpbmUrKyx0aGlzLmxpbmVTdGFydD10aGlzLnBvcykpOihmYyhpKSYmdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJVbnRlcm1pbmF0ZWQgc3RyaW5nIGNvbnN0YW50IiksKyt0aGlzLnBvcyk7fXJldHVybiB0Kz10aGlzLmlucHV0LnNsaWNlKHMsdGhpcy5wb3MrKyksdGhpcy5maW5pc2hUb2tlbih1Yy5zdHJpbmcsdCl9O3ZhciBEaD17fTtNaC50cnlSZWFkVGVtcGxhdGVUb2tlbj1mdW5jdGlvbigpe3RoaXMuaW5UZW1wbGF0ZUVsZW1lbnQ9ITA7dHJ5e3RoaXMucmVhZFRtcGxUb2tlbigpO31jYXRjaChlKXtpZihlIT09RGgpdGhyb3cgZTt0aGlzLnJlYWRJbnZhbGlkVGVtcGxhdGVUb2tlbigpO310aGlzLmluVGVtcGxhdGVFbGVtZW50PSExO30sTWguaW52YWxpZFN0cmluZ1Rva2VuPWZ1bmN0aW9uKGUsdCl7aWYodGhpcy5pblRlbXBsYXRlRWxlbWVudCYmdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05KXRocm93IERoO3RoaXMucmFpc2UoZSx0KTt9LE1oLnJlYWRUbXBsVG9rZW49ZnVuY3Rpb24oKXtmb3IodmFyIGU9IiIsdD10aGlzLnBvczs7KXt0aGlzLnBvcz49dGhpcy5pbnB1dC5sZW5ndGgmJnRoaXMucmFpc2UodGhpcy5zdGFydCwiVW50ZXJtaW5hdGVkIHRlbXBsYXRlIik7dmFyIHM9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtpZig5Nj09PXN8fDM2PT09cyYmMTIzPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpKXJldHVybiB0aGlzLnBvcyE9PXRoaXMuc3RhcnR8fHRoaXMudHlwZSE9PXVjLnRlbXBsYXRlJiZ0aGlzLnR5cGUhPT11Yy5pbnZhbGlkVGVtcGxhdGU/KGUrPXRoaXMuaW5wdXQuc2xpY2UodCx0aGlzLnBvcyksdGhpcy5maW5pc2hUb2tlbih1Yy50ZW1wbGF0ZSxlKSk6MzY9PT1zPyh0aGlzLnBvcys9Mix0aGlzLmZpbmlzaFRva2VuKHVjLmRvbGxhckJyYWNlTCkpOigrK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4odWMuYmFja1F1b3RlKSk7aWYoOTI9PT1zKWUrPXRoaXMuaW5wdXQuc2xpY2UodCx0aGlzLnBvcyksZSs9dGhpcy5yZWFkRXNjYXBlZENoYXIoITApLHQ9dGhpcy5wb3M7ZWxzZSBpZihmYyhzKSl7c3dpdGNoKGUrPXRoaXMuaW5wdXQuc2xpY2UodCx0aGlzLnBvcyksKyt0aGlzLnBvcyxzKXtjYXNlIDEzOjEwPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKSYmKyt0aGlzLnBvcztjYXNlIDEwOmUrPSJcbiI7YnJlYWs7ZGVmYXVsdDplKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHMpO310aGlzLm9wdGlvbnMubG9jYXRpb25zJiYoKyt0aGlzLmN1ckxpbmUsdGhpcy5saW5lU3RhcnQ9dGhpcy5wb3MpLHQ9dGhpcy5wb3M7fWVsc2UgKyt0aGlzLnBvczt9fSxNaC5yZWFkSW52YWxpZFRlbXBsYXRlVG9rZW49ZnVuY3Rpb24oKXtmb3IoO3RoaXMucG9zPHRoaXMuaW5wdXQubGVuZ3RoO3RoaXMucG9zKyspc3dpdGNoKHRoaXMuaW5wdXRbdGhpcy5wb3NdKXtjYXNlIlxcIjorK3RoaXMucG9zO2JyZWFrO2Nhc2UiJCI6aWYoInsiIT09dGhpcy5pbnB1dFt0aGlzLnBvcysxXSlicmVhaztjYXNlImAiOnJldHVybiB0aGlzLmZpbmlzaFRva2VuKHVjLmludmFsaWRUZW1wbGF0ZSx0aGlzLmlucHV0LnNsaWNlKHRoaXMuc3RhcnQsdGhpcy5wb3MpKX10aGlzLnJhaXNlKHRoaXMuc3RhcnQsIlVudGVybWluYXRlZCB0ZW1wbGF0ZSIpO30sTWgucmVhZEVzY2FwZWRDaGFyPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMucG9zKTtzd2l0Y2goKyt0aGlzLnBvcyx0KXtjYXNlIDExMDpyZXR1cm4gIlxuIjtjYXNlIDExNDpyZXR1cm4gIlxyIjtjYXNlIDEyMDpyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh0aGlzLnJlYWRIZXhDaGFyKDIpKTtjYXNlIDExNzpyZXR1cm4ga2ModGhpcy5yZWFkQ29kZVBvaW50KCkpO2Nhc2UgMTE2OnJldHVybiAiXHQiO2Nhc2UgOTg6cmV0dXJuICJcYiI7Y2FzZSAxMTg6cmV0dXJuICJcdiI7Y2FzZSAxMDI6cmV0dXJuICJcZiI7Y2FzZSAxMzoxMD09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykmJisrdGhpcy5wb3M7Y2FzZSAxMDpyZXR1cm4gdGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKHRoaXMubGluZVN0YXJ0PXRoaXMucG9zLCsrdGhpcy5jdXJMaW5lKSwiIjtjYXNlIDU2OmNhc2UgNTc6aWYodGhpcy5zdHJpY3QmJnRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHRoaXMucG9zLTEsIkludmFsaWQgZXNjYXBlIHNlcXVlbmNlIiksZSl7dmFyIHM9dGhpcy5wb3MtMTt0aGlzLmludmFsaWRTdHJpbmdUb2tlbihzLCJJbnZhbGlkIGVzY2FwZSBzZXF1ZW5jZSBpbiB0ZW1wbGF0ZSBzdHJpbmciKTt9ZGVmYXVsdDppZih0Pj00OCYmdDw9NTUpe3ZhciBpPXRoaXMuaW5wdXQuc3Vic3RyKHRoaXMucG9zLTEsMykubWF0Y2goL15bMC03XSsvKVswXSxuPXBhcnNlSW50KGksOCk7cmV0dXJuIG4+MjU1JiYoaT1pLnNsaWNlKDAsLTEpLG49cGFyc2VJbnQoaSw4KSksdGhpcy5wb3MrPWkubGVuZ3RoLTEsdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpLCIwIj09PWkmJjU2IT09dCYmNTchPT10fHwhdGhpcy5zdHJpY3QmJiFlfHx0aGlzLmludmFsaWRTdHJpbmdUb2tlbih0aGlzLnBvcy0xLWkubGVuZ3RoLGU/Ik9jdGFsIGxpdGVyYWwgaW4gdGVtcGxhdGUgc3RyaW5nIjoiT2N0YWwgbGl0ZXJhbCBpbiBzdHJpY3QgbW9kZSIpLFN0cmluZy5mcm9tQ2hhckNvZGUobil9cmV0dXJuIGZjKHQpPyIiOlN0cmluZy5mcm9tQ2hhckNvZGUodCl9fSxNaC5yZWFkSGV4Q2hhcj1mdW5jdGlvbihlKXt2YXIgdD10aGlzLnBvcyxzPXRoaXMucmVhZEludCgxNixlKTtyZXR1cm4gbnVsbD09PXMmJnRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHQsIkJhZCBjaGFyYWN0ZXIgZXNjYXBlIHNlcXVlbmNlIiksc30sTWgucmVhZFdvcmQxPWZ1bmN0aW9uKCl7dGhpcy5jb250YWluc0VzYz0hMTtmb3IodmFyIGU9IiIsdD0hMCxzPXRoaXMucG9zLGk9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02O3RoaXMucG9zPHRoaXMuaW5wdXQubGVuZ3RoOyl7dmFyIG49dGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpO2lmKG5jKG4saSkpdGhpcy5wb3MrPW48PTY1NTM1PzE6MjtlbHNlIHtpZig5MiE9PW4pYnJlYWs7dGhpcy5jb250YWluc0VzYz0hMCxlKz10aGlzLmlucHV0LnNsaWNlKHMsdGhpcy5wb3MpO3ZhciByPXRoaXMucG9zOzExNyE9PXRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMucG9zKSYmdGhpcy5pbnZhbGlkU3RyaW5nVG9rZW4odGhpcy5wb3MsIkV4cGVjdGluZyBVbmljb2RlIGVzY2FwZSBzZXF1ZW5jZSBcXHVYWFhYIiksKyt0aGlzLnBvczt2YXIgbz10aGlzLnJlYWRDb2RlUG9pbnQoKTsodD9pYzpuYykobyxpKXx8dGhpcy5pbnZhbGlkU3RyaW5nVG9rZW4ociwiSW52YWxpZCBVbmljb2RlIGVzY2FwZSIpLGUrPWtjKG8pLHM9dGhpcy5wb3M7fXQ9ITE7fXJldHVybiBlK3RoaXMuaW5wdXQuc2xpY2Uocyx0aGlzLnBvcyl9LE1oLnJlYWRXb3JkPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5yZWFkV29yZDEoKSx0PXVjLm5hbWU7cmV0dXJuIHRoaXMua2V5d29yZHMudGVzdChlKSYmKHQ9Y2NbZV0pLHRoaXMuZmluaXNoVG9rZW4odCxlKX07dmFyIExoPSI4LjEwLjAiO09jLmFjb3JuPXtQYXJzZXI6T2MsdmVyc2lvbjpMaCxkZWZhdWx0T3B0aW9uczokYyxQb3NpdGlvbjp3YyxTb3VyY2VMb2NhdGlvbjpQYyxnZXRMaW5lSW5mbzpDYyxOb2RlOmloLFRva2VuVHlwZTpyYyx0b2tUeXBlczp1YyxrZXl3b3JkVHlwZXM6Y2MsVG9rQ29udGV4dDpLYyx0b2tDb250ZXh0czpZYyxpc0lkZW50aWZpZXJDaGFyOm5jLGlzSWRlbnRpZmllclN0YXJ0OmljLFRva2VuOlJoLGlzTmV3TGluZTpmYyxsaW5lQnJlYWs6ZGMsbGluZUJyZWFrRzpwYyxub25BU0NJSXdoaXRlc3BhY2U6Z2N9O3ZhciBUaD1PYmplY3QuZnJlZXplKHtfX3Byb3RvX186bnVsbCxOb2RlOmloLFBhcnNlcjpPYyxQb3NpdGlvbjp3YyxTb3VyY2VMb2NhdGlvbjpQYyxUb2tDb250ZXh0OktjLFRva2VuOlJoLFRva2VuVHlwZTpyYyxkZWZhdWx0T3B0aW9uczokYyxnZXRMaW5lSW5mbzpDYyxpc0lkZW50aWZpZXJDaGFyOm5jLGlzSWRlbnRpZmllclN0YXJ0OmljLGlzTmV3TGluZTpmYyxrZXl3b3JkVHlwZXM6Y2MsbGluZUJyZWFrOmRjLGxpbmVCcmVha0c6cGMsbm9uQVNDSUl3aGl0ZXNwYWNlOmdjLHBhcnNlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIE9jLnBhcnNlKGUsdCl9LHBhcnNlRXhwcmVzc2lvbkF0OmZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gT2MucGFyc2VFeHByZXNzaW9uQXQoZSx0LHMpfSx0b2tDb250ZXh0czpZYyx0b2tUeXBlczp1Yyx0b2tlbml6ZXI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gT2MudG9rZW5pemVyKGUsdCl9LHZlcnNpb246TGh9KTtjb25zdCBWaD1lPT4oKT0+WGUoZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOiJOT19GU19JTl9CUk9XU0VSIixtZXNzYWdlOmBDYW5ub3QgYWNjZXNzIHRoZSBmaWxlIHN5c3RlbSAodmlhICIke2V9Iikgd2hlbiB1c2luZyB0aGUgYnJvd3NlciBidWlsZCBvZiBSb2xsdXAuIE1ha2Ugc3VyZSB5b3Ugc3VwcGx5IGEgcGx1Z2luIHdpdGggY3VzdG9tIHJlc29sdmVJZCBhbmQgbG9hZCBob29rcyB0byBSb2xsdXAuYCx1cmw6T2UoInBsdWdpbi1kZXZlbG9wbWVudC8jYS1zaW1wbGUtZXhhbXBsZSIpfX0oZSkpLEJoPVZoKCJmcy5ta2RpciIpLHpoPVZoKCJmcy5yZWFkRmlsZSIpLEZoPVZoKCJmcy53cml0ZUZpbGUiKTthc3luYyBmdW5jdGlvbiBqaChlLHQscyxpLG4scixvLGEsbCl7Y29uc3QgYz1hd2FpdCBmdW5jdGlvbihlLHQscyxpLG4scixvLGEpe2xldCBsPW51bGwsYz1udWxsO2lmKG4pe2w9bmV3IFNldDtmb3IoY29uc3QgcyBvZiBuKWU9PT1zLnNvdXJjZSYmdD09PXMuaW1wb3J0ZXImJmwuYWRkKHMucGx1Z2luKTtjPShlLHQpPT4oey4uLmUscmVzb2x2ZTooZSxzLHthc3NlcnRpb25zOnIsY3VzdG9tOm8saXNFbnRyeTphLHNraXBTZWxmOmx9PWZlKT0+aShlLHMsbyxhLHJ8fG1lLGw/Wy4uLm4se2ltcG9ydGVyOnMscGx1Z2luOnQsc291cmNlOmV9XTpuKX0pO31yZXR1cm4gcy5ob29rRmlyc3RBbmRHZXRQbHVnaW4oInJlc29sdmVJZCIsW2UsdCx7YXNzZXJ0aW9uczphLGN1c3RvbTpyLGlzRW50cnk6b31dLGMsbCl9KGUsdCxpLG4scixvLGEsbCk7cmV0dXJuIG51bGw9PWM/VmgoInBhdGgucmVzb2x2ZSIpKCk6Y1swXX1jb25zdCBVaD0iYXQgcG9zaXRpb24gIixHaD0iYXQgb3V0cHV0IHBvc2l0aW9uICI7Y29uc3QgV2g9e2RlbGV0ZTooKT0+ITEsZ2V0KCl7fSxoYXM6KCk9PiExLHNldCgpe319O2Z1bmN0aW9uIHFoKGUpe3JldHVybiBlLnN0YXJ0c1dpdGgoVWgpfHxlLnN0YXJ0c1dpdGgoR2gpP1hlKHtjb2RlOmV0LG1lc3NhZ2U6IkEgcGx1Z2luIGlzIHRyeWluZyB0byB1c2UgdGhlIFJvbGx1cCBjYWNoZSBidXQgaXMgbm90IGRlY2xhcmluZyBhIHBsdWdpbiBuYW1lIG9yIGNhY2hlS2V5LiJ9KTpYZSh7Y29kZTpvdCxtZXNzYWdlOmBUaGUgcGx1Z2luIG5hbWUgJHtlfSBpcyBiZWluZyB1c2VkIHR3aWNlIGluIHRoZSBzYW1lIGJ1aWxkLiBQbHVnaW4gbmFtZXMgbXVzdCBiZSBkaXN0aW5jdCBvciBwcm92aWRlIGEgY2FjaGVLZXkgKHBsZWFzZSBwb3N0IGFuIGlzc3VlIHRvIHRoZSBwbHVnaW4gaWYgeW91IGFyZSBhIHBsdWdpbiB1c2VyKS5gfSl9Y29uc3QgSGg9KGUsdCxzPVpoKT0+e2NvbnN0e29ud2FybjppLG9uTG9nOm59PWUscj1LaChzLGkpO2lmKG4pe2NvbnN0IGU9SWVbdF07cmV0dXJuICh0LHMpPT5uKHQsWWgocyksKCh0LHMpPT57aWYoImVycm9yIj09PXQpcmV0dXJuIFhlKFhoKHMpKTtJZVt0XT49ZSYmcih0LFhoKHMpKTt9KSl9cmV0dXJuIHJ9LEtoPShlLHQpPT50PyhzLGkpPT57cz09PVNlP3QoWWgoaSksKHQ9PmUoU2UsWGgodCkpKSk6ZShzLGkpO306ZSxZaD1lPT4oT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInRvU3RyaW5nIix7dmFsdWU6KCk9PlFoKGUpLHdyaXRhYmxlOiEwfSksZSksWGg9ZT0+InN0cmluZyI9PXR5cGVvZiBlP3ttZXNzYWdlOmV9OiJmdW5jdGlvbiI9PXR5cGVvZiBlP1hoKGUoKSk6ZSxRaD1lPT57bGV0IHQ9IiI7cmV0dXJuIGUucGx1Z2luJiYodCs9YCgke2UucGx1Z2lufSBwbHVnaW4pIGApLGUubG9jJiYodCs9YCR7VChlLmxvYy5maWxlKX0gKCR7ZS5sb2MubGluZX06JHtlLmxvYy5jb2x1bW59KSBgKSx0K2UubWVzc2FnZX0sWmg9KGUsdCk9Pntjb25zdCBzPVFoKHQpO3N3aXRjaChlKXtjYXNlIFNlOnJldHVybiBjb25zb2xlLndhcm4ocyk7Y2FzZSBrZTpyZXR1cm4gY29uc29sZS5kZWJ1ZyhzKTtkZWZhdWx0OnJldHVybiBjb25zb2xlLmluZm8ocyl9fTtmdW5jdGlvbiBKaChlLHQscyxpLG49LyQuLyl7Y29uc3Qgcj1uZXcgU2V0KHQpLG89T2JqZWN0LmtleXMoZSkuZmlsdGVyKChlPT4hKHIuaGFzKGUpfHxuLnRlc3QoZSkpKSk7by5sZW5ndGg+MCYmaShTZSxmdW5jdGlvbihlLHQscyl7cmV0dXJuIHtjb2RlOkN0LG1lc3NhZ2U6YFVua25vd24gJHtlfTogJHt0LmpvaW4oIiwgIil9LiBBbGxvd2VkIG9wdGlvbnM6ICR7cy5qb2luKCIsICIpfWB9fShzLG8sWy4uLnJdLnNvcnQoKSkpO31jb25zdCBldT17cmVjb21tZW5kZWQ6e2Fubm90YXRpb25zOiEwLGNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uOiExLG1hbnVhbFB1cmVGdW5jdGlvbnM6Z2UsbW9kdWxlU2lkZUVmZmVjdHM6KCk9PiEwLHByb3BlcnR5UmVhZFNpZGVFZmZlY3RzOiEwLHRyeUNhdGNoRGVvcHRpbWl6YXRpb246ITAsdW5rbm93bkdsb2JhbFNpZGVFZmZlY3RzOiExfSxzYWZlc3Q6e2Fubm90YXRpb25zOiEwLGNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uOiEwLG1hbnVhbFB1cmVGdW5jdGlvbnM6Z2UsbW9kdWxlU2lkZUVmZmVjdHM6KCk9PiEwLHByb3BlcnR5UmVhZFNpZGVFZmZlY3RzOiEwLHRyeUNhdGNoRGVvcHRpbWl6YXRpb246ITAsdW5rbm93bkdsb2JhbFNpZGVFZmZlY3RzOiEwfSxzbWFsbGVzdDp7YW5ub3RhdGlvbnM6ITAsY29ycmVjdFZhclZhbHVlQmVmb3JlRGVjbGFyYXRpb246ITEsbWFudWFsUHVyZUZ1bmN0aW9uczpnZSxtb2R1bGVTaWRlRWZmZWN0czooKT0+ITEscHJvcGVydHlSZWFkU2lkZUVmZmVjdHM6ITEsdHJ5Q2F0Y2hEZW9wdGltaXphdGlvbjohMSx1bmtub3duR2xvYmFsU2lkZUVmZmVjdHM6ITF9fSx0dT17ZXMyMDE1OnthcnJvd0Z1bmN0aW9uczohMCxjb25zdEJpbmRpbmdzOiEwLG9iamVjdFNob3J0aGFuZDohMCxyZXNlcnZlZE5hbWVzQXNQcm9wczohMCxzeW1ib2xzOiEwfSxlczU6e2Fycm93RnVuY3Rpb25zOiExLGNvbnN0QmluZGluZ3M6ITEsb2JqZWN0U2hvcnRoYW5kOiExLHJlc2VydmVkTmFtZXNBc1Byb3BzOiEwLHN5bWJvbHM6ITF9fSxzdT0oZSx0LHMsaSxuKT0+e2NvbnN0IHI9ZT8ucHJlc2V0O2lmKHIpe2NvbnN0IG49dFtyXTtpZihuKXJldHVybiB7Li4ubiwuLi5lfTtYZShGdChgJHtzfS5wcmVzZXRgLGksYHZhbGlkIHZhbHVlcyBhcmUgJHtNZShPYmplY3Qua2V5cyh0KSl9YCxyKSk7fXJldHVybiAoKGUsdCxzLGkpPT5uPT57aWYoInN0cmluZyI9PXR5cGVvZiBuKXtjb25zdCByPWVbbl07aWYocilyZXR1cm4gcjtYZShGdCh0LHMsYHZhbGlkIHZhbHVlcyBhcmUgJHtpfSR7TWUoT2JqZWN0LmtleXMoZSkpfS4gWW91IGNhbiBhbHNvIHN1cHBseSBhbiBvYmplY3QgZm9yIG1vcmUgZmluZS1ncmFpbmVkIGNvbnRyb2xgLG4pKTt9cmV0dXJuIChlPT5lJiYib2JqZWN0Ij09dHlwZW9mIGU/ZTp7fSkobil9KSh0LHMsaSxuKShlKX0saXU9YXN5bmMgZT0+KGF3YWl0IGFzeW5jIGZ1bmN0aW9uKGUpe2Rve2U9KGF3YWl0IFByb21pc2UuYWxsKGUpKS5mbGF0KDEvMCk7fXdoaWxlKGUuc29tZSgoZT0+ZT8udGhlbikpKTtyZXR1cm4gZX0oW2VdKSkuZmlsdGVyKEJvb2xlYW4pO2FzeW5jIGZ1bmN0aW9uIG51KGUsdCxzLGkpe2NvbnN0IG49dC5pZCxyPVtdO2xldCBvPW51bGw9PT1lLm1hcD9udWxsOmJvKGUubWFwKTtjb25zdCBhPWUuY29kZTtsZXQgYz1lLmFzdDtjb25zdCBoPVtdLHU9W107bGV0IGQ9ITE7Y29uc3QgcD0oKT0+ZD0hMDtsZXQgZj0iIixtPWUuY29kZTtjb25zdCBnPWU9Pih0LHMpPT57dD1YaCh0KSxzJiZRZSh0LHMsbSxuKSx0LmlkPW4sdC5ob29rPSJ0cmFuc2Zvcm0iLGUodCk7fTtsZXQgeDt0cnl7eD1hd2FpdCBzLmhvb2tSZWR1Y2VBcmcwKCJ0cmFuc2Zvcm0iLFttLG5dLChmdW5jdGlvbihlLHMsbil7bGV0IG8sYTtpZigic3RyaW5nIj09dHlwZW9mIHMpbz1zO2Vsc2Uge2lmKCFzfHwib2JqZWN0IiE9dHlwZW9mIHMpcmV0dXJuIGU7aWYodC51cGRhdGVPcHRpb25zKHMpLG51bGw9PXMuY29kZSlyZXR1cm4gKHMubWFwfHxzLmFzdCkmJmkoU2UsZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOkF0LG1lc3NhZ2U6YFRoZSBwbHVnaW4gIiR7ZX0iIHJldHVybmVkIGEgIm1hcCIgb3IgImFzdCIgd2l0aG91dCByZXR1cm5pbmcgYSAiY29kZSIuIFRoaXMgd2lsbCBiZSBpZ25vcmVkLmB9fShuLm5hbWUpKSxlOyh7Y29kZTpvLG1hcDphLGFzdDpjfT1zKTt9cmV0dXJuIG51bGwhPT1hJiZyLnB1c2goYm8oInN0cmluZyI9PXR5cGVvZiBhP0pTT04ucGFyc2UoYSk6YSl8fHttaXNzaW5nOiEwLHBsdWdpbjpuLm5hbWV9KSxtPW8sb30pLCgoZSx0KT0+e3JldHVybiBmPXQubmFtZSx7Li4uZSxhZGRXYXRjaEZpbGUodCl7aC5wdXNoKHQpLGUuYWRkV2F0Y2hGaWxlKHQpO30sY2FjaGU6ZD9lLmNhY2hlOihjPWUuY2FjaGUseD1wLHtkZWxldGU6ZT0+KHgoKSxjLmRlbGV0ZShlKSksZ2V0OmU9Pih4KCksYy5nZXQoZSkpLGhhczplPT4oeCgpLGMuaGFzKGUpKSxzZXQ6KGUsdCk9Pih4KCksYy5zZXQoZSx0KSl9KSxkZWJ1ZzpnKGUuZGVidWcpLGVtaXRGaWxlOmU9Pih1LnB1c2goZSkscy5lbWl0RmlsZShlKSksZXJyb3I6KHQscyk9Pigic3RyaW5nIj09dHlwZW9mIHQmJih0PXttZXNzYWdlOnR9KSxzJiZRZSh0LHMsbSxuKSx0LmlkPW4sdC5ob29rPSJ0cmFuc2Zvcm0iLGUuZXJyb3IodCkpLGdldENvbWJpbmVkU291cmNlbWFwKCl7Y29uc3QgZT1mdW5jdGlvbihlLHQscyxpLG4pe3JldHVybiAwPT09aS5sZW5ndGg/czpibyh7dmVyc2lvbjozLC4uLnNsKGUsdCxzLGksdGwobikpLnRyYWNlTWFwcGluZ3MoKX0pfShuLGEsbyxyLGkpO2lmKCFlKXtyZXR1cm4gbmV3IHkoYSkuZ2VuZXJhdGVNYXAoe2hpcmVzOiEwLGluY2x1ZGVDb250ZW50OiEwLHNvdXJjZTpufSl9cmV0dXJuIG8hPT1lJiYobz1lLHIubGVuZ3RoPTApLG5ldyBsKHsuLi5lLGZpbGU6bnVsbCxzb3VyY2VzQ29udGVudDplLnNvdXJjZXNDb250ZW50fSl9LGluZm86ZyhlLmluZm8pLHNldEFzc2V0U291cmNlKCl7cmV0dXJuIHRoaXMuZXJyb3Ioe2NvZGU6bXQsbWVzc2FnZToic2V0QXNzZXRTb3VyY2UgY2Fubm90IGJlIGNhbGxlZCBpbiB0cmFuc2Zvcm0gZm9yIGNhY2hpbmcgcmVhc29ucy4gVXNlIGVtaXRGaWxlIHdpdGggYSBzb3VyY2UsIG9yIGNhbGwgc2V0QXNzZXRTb3VyY2UgaW4gYW5vdGhlciBob29rLiJ9KX0sd2FybjpnKGUud2Fybil9O3ZhciBjLHg7fSkpO31jYXRjaChlKXtyZXR1cm4gWGUoV3QoZSxmLHtob29rOiJ0cmFuc2Zvcm0iLGlkOm59KSl9cmV0dXJuICFkJiZ1Lmxlbmd0aD4wJiYodC50cmFuc2Zvcm1GaWxlcz11KSx7YXN0OmMsY29kZTp4LGN1c3RvbVRyYW5zZm9ybUNhY2hlOmQsb3JpZ2luYWxDb2RlOmEsb3JpZ2luYWxTb3VyY2VtYXA6byxzb3VyY2VtYXBDaGFpbjpyLHRyYW5zZm9ybURlcGVuZGVuY2llczpofX1jb25zdCBydT0icmVzb2x2ZURlcGVuZGVuY2llcyI7Y2xhc3Mgb3V7Y29uc3RydWN0b3IoZSx0LHMsaSl7dGhpcy5ncmFwaD1lLHRoaXMubW9kdWxlc0J5SWQ9dCx0aGlzLm9wdGlvbnM9cyx0aGlzLnBsdWdpbkRyaXZlcj1pLHRoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXM9bmV3IFNldCx0aGlzLmluZGV4ZWRFbnRyeU1vZHVsZXM9W10sdGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2U9UHJvbWlzZS5yZXNvbHZlKCksdGhpcy5tb2R1bGVMb2FkUHJvbWlzZXM9bmV3IE1hcCx0aGlzLm1vZHVsZXNXaXRoTG9hZGVkRGVwZW5kZW5jaWVzPW5ldyBTZXQsdGhpcy5uZXh0Q2h1bmtOYW1lUHJpb3JpdHk9MCx0aGlzLm5leHRFbnRyeU1vZHVsZUluZGV4PTAsdGhpcy5yZXNvbHZlSWQ9YXN5bmMoZSx0LHMsaSxuLHI9bnVsbCk9PnRoaXMuZ2V0UmVzb2x2ZWRJZFdpdGhEZWZhdWx0cyh0aGlzLmdldE5vcm1hbGl6ZWRSZXNvbHZlZElkV2l0aG91dERlZmF1bHRzKCF0aGlzLm9wdGlvbnMuZXh0ZXJuYWwoZSx0LCExKSYmYXdhaXQgamgoZSx0LHRoaXMub3B0aW9ucy5wcmVzZXJ2ZVN5bWxpbmtzLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMucmVzb2x2ZUlkLHIscywiYm9vbGVhbiI9PXR5cGVvZiBpP2k6IXQsbiksdCxlKSxuKSx0aGlzLmhhc01vZHVsZVNpZGVFZmZlY3RzPXMudHJlZXNoYWtlP3MudHJlZXNoYWtlLm1vZHVsZVNpZGVFZmZlY3RzOigpPT4hMDt9YXN5bmMgYWRkQWRkaXRpb25hbE1vZHVsZXMoZSx0KXtjb25zdCBzPXRoaXMuZXh0ZW5kTG9hZE1vZHVsZXNQcm9taXNlKFByb21pc2UuYWxsKGUubWFwKChlPT50aGlzLmxvYWRFbnRyeU1vZHVsZShlLCExLHZvaWQgMCxudWxsLHQpKSkpKTtyZXR1cm4gYXdhaXQgdGhpcy5hd2FpdExvYWRNb2R1bGVzUHJvbWlzZSgpLHN9YXN5bmMgYWRkRW50cnlNb2R1bGVzKGUsdCl7Y29uc3Qgcz10aGlzLm5leHRFbnRyeU1vZHVsZUluZGV4O3RoaXMubmV4dEVudHJ5TW9kdWxlSW5kZXgrPWUubGVuZ3RoO2NvbnN0IGk9dGhpcy5uZXh0Q2h1bmtOYW1lUHJpb3JpdHk7dGhpcy5uZXh0Q2h1bmtOYW1lUHJpb3JpdHkrPWUubGVuZ3RoO2NvbnN0IG49YXdhaXQgdGhpcy5leHRlbmRMb2FkTW9kdWxlc1Byb21pc2UoUHJvbWlzZS5hbGwoZS5tYXAoKCh7aWQ6ZSxpbXBvcnRlcjp0fSk9PnRoaXMubG9hZEVudHJ5TW9kdWxlKGUsITAsdCxudWxsKSkpKS50aGVuKChuPT57Zm9yKGNvbnN0W3Isb11vZiBuLmVudHJpZXMoKSl7by5pc1VzZXJEZWZpbmVkRW50cnlQb2ludD1vLmlzVXNlckRlZmluZWRFbnRyeVBvaW50fHx0LGx1KG8sZVtyXSx0LGkrcik7Y29uc3Qgbj10aGlzLmluZGV4ZWRFbnRyeU1vZHVsZXMuZmluZCgoZT0+ZS5tb2R1bGU9PT1vKSk7bj9uLmluZGV4PU1hdGgubWluKG4uaW5kZXgscytyKTp0aGlzLmluZGV4ZWRFbnRyeU1vZHVsZXMucHVzaCh7aW5kZXg6cytyLG1vZHVsZTpvfSk7fXJldHVybiB0aGlzLmluZGV4ZWRFbnRyeU1vZHVsZXMuc29ydCgoKHtpbmRleDplfSx7aW5kZXg6dH0pPT5lPnQ/MTotMSkpLG59KSkpO3JldHVybiBhd2FpdCB0aGlzLmF3YWl0TG9hZE1vZHVsZXNQcm9taXNlKCkse2VudHJ5TW9kdWxlczp0aGlzLmluZGV4ZWRFbnRyeU1vZHVsZXMubWFwKCgoe21vZHVsZTplfSk9PmUpKSxpbXBsaWNpdEVudHJ5TW9kdWxlczpbLi4udGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlc10sbmV3RW50cnlNb2R1bGVzOm59fWFzeW5jIGVtaXRDaHVuayh7ZmlsZU5hbWU6ZSxpZDp0LGltcG9ydGVyOnMsbmFtZTppLGltcGxpY2l0bHlMb2FkZWRBZnRlck9uZU9mOm4scHJlc2VydmVTaWduYXR1cmU6cn0pe2NvbnN0IG89e2ZpbGVOYW1lOmV8fG51bGwsaWQ6dCxpbXBvcnRlcjpzLG5hbWU6aXx8bnVsbH0sYT1uP2F3YWl0IHRoaXMuYWRkRW50cnlXaXRoSW1wbGljaXREZXBlbmRhbnRzKG8sbik6KGF3YWl0IHRoaXMuYWRkRW50cnlNb2R1bGVzKFtvXSwhMSkpLm5ld0VudHJ5TW9kdWxlc1swXTtyZXR1cm4gbnVsbCE9ciYmKGEucHJlc2VydmVTaWduYXR1cmU9ciksYX1hc3luYyBwcmVsb2FkTW9kdWxlKGUpe3JldHVybiAoYXdhaXQgdGhpcy5mZXRjaE1vZHVsZSh0aGlzLmdldFJlc29sdmVkSWRXaXRoRGVmYXVsdHMoZSxtZSksdm9pZCAwLCExLCFlLnJlc29sdmVEZXBlbmRlbmNpZXN8fHJ1KSkuaW5mb31hZGRFbnRyeVdpdGhJbXBsaWNpdERlcGVuZGFudHMoZSx0KXtjb25zdCBzPXRoaXMubmV4dENodW5rTmFtZVByaW9yaXR5Kys7cmV0dXJuIHRoaXMuZXh0ZW5kTG9hZE1vZHVsZXNQcm9taXNlKHRoaXMubG9hZEVudHJ5TW9kdWxlKGUuaWQsITEsZS5pbXBvcnRlcixudWxsKS50aGVuKChhc3luYyBpPT57aWYobHUoaSxlLCExLHMpLCFpLmluZm8uaXNFbnRyeSl7dGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcy5hZGQoaSk7Y29uc3Qgcz1hd2FpdCBQcm9taXNlLmFsbCh0Lm1hcCgodD0+dGhpcy5sb2FkRW50cnlNb2R1bGUodCwhMSxlLmltcG9ydGVyLGkuaWQpKSkpO2Zvcihjb25zdCBlIG9mIHMpaS5pbXBsaWNpdGx5TG9hZGVkQWZ0ZXIuYWRkKGUpO2Zvcihjb25zdCBlIG9mIGkuaW1wbGljaXRseUxvYWRlZEFmdGVyKWUuaW1wbGljaXRseUxvYWRlZEJlZm9yZS5hZGQoaSk7fXJldHVybiBpfSkpKX1hc3luYyBhZGRNb2R1bGVTb3VyY2UoZSx0LHMpe2xldCBpO3RyeXtpPWF3YWl0IHRoaXMuZ3JhcGguZmlsZU9wZXJhdGlvblF1ZXVlLnJ1bigoYXN5bmMoKT0+YXdhaXQgdGhpcy5wbHVnaW5Ecml2ZXIuaG9va0ZpcnN0KCJsb2FkIixbZV0pPz9hd2FpdCB6aChlLCJ1dGY4IikpKTt9Y2F0Y2gocyl7bGV0IGk9YENvdWxkIG5vdCBsb2FkICR7ZX1gO3Rocm93IHQmJihpKz1gIChpbXBvcnRlZCBieSAke1QodCl9KWApLGkrPWA6ICR7cy5tZXNzYWdlfWAscy5tZXNzYWdlPWksc31jb25zdCBuPSJzdHJpbmciPT10eXBlb2YgaT97Y29kZTppfTpudWxsIT1pJiYib2JqZWN0Ij09dHlwZW9mIGkmJiJzdHJpbmciPT10eXBlb2YgaS5jb2RlP2k6WGUoZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOiJCQURfTE9BREVSIixtZXNzYWdlOmBFcnJvciBsb2FkaW5nICIke1QoZSl9IjogcGx1Z2luIGxvYWQgaG9vayBzaG91bGQgcmV0dXJuIGEgc3RyaW5nLCBhIHsgY29kZSwgbWFwIH0gb2JqZWN0LCBvciBub3RoaW5nL251bGwuYH19KGUpKSxyPXRoaXMuZ3JhcGguY2FjaGVkTW9kdWxlcy5nZXQoZSk7aWYoIXJ8fHIuY3VzdG9tVHJhbnNmb3JtQ2FjaGV8fHIub3JpZ2luYWxDb2RlIT09bi5jb2RlfHxhd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rRmlyc3QoInNob3VsZFRyYW5zZm9ybUNhY2hlZE1vZHVsZSIsW3thc3Q6ci5hc3QsY29kZTpyLmNvZGUsaWQ6ci5pZCxtZXRhOnIubWV0YSxtb2R1bGVTaWRlRWZmZWN0czpyLm1vZHVsZVNpZGVFZmZlY3RzLHJlc29sdmVkU291cmNlczpyLnJlc29sdmVkSWRzLHN5bnRoZXRpY05hbWVkRXhwb3J0czpyLnN5bnRoZXRpY05hbWVkRXhwb3J0c31dKSlzLnVwZGF0ZU9wdGlvbnMobikscy5zZXRTb3VyY2UoYXdhaXQgbnUobixzLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMub3B0aW9ucy5vbkxvZykpO2Vsc2Uge2lmKHIudHJhbnNmb3JtRmlsZXMpZm9yKGNvbnN0IGUgb2Ygci50cmFuc2Zvcm1GaWxlcyl0aGlzLnBsdWdpbkRyaXZlci5lbWl0RmlsZShlKTtzLnNldFNvdXJjZShyKTt9fWFzeW5jIGF3YWl0TG9hZE1vZHVsZXNQcm9taXNlKCl7bGV0IGU7ZG97ZT10aGlzLmxhdGVzdExvYWRNb2R1bGVzUHJvbWlzZSxhd2FpdCBlO313aGlsZShlIT09dGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2UpfWV4dGVuZExvYWRNb2R1bGVzUHJvbWlzZShlKXtyZXR1cm4gdGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2U9UHJvbWlzZS5hbGwoW2UsdGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2VdKSx0aGlzLmxhdGVzdExvYWRNb2R1bGVzUHJvbWlzZS5jYXRjaCgoKCk9Pnt9KSksZX1hc3luYyBmZXRjaER5bmFtaWNEZXBlbmRlbmNpZXMoZSx0KXtjb25zdCBzPWF3YWl0IFByb21pc2UuYWxsKHQubWFwKCh0PT50LnRoZW4oKGFzeW5jKFt0LHNdKT0+bnVsbD09PXM/bnVsbDoic3RyaW5nIj09dHlwZW9mIHM/KHQucmVzb2x1dGlvbj1zLG51bGwpOnQucmVzb2x1dGlvbj1hd2FpdCB0aGlzLmZldGNoUmVzb2x2ZWREZXBlbmRlbmN5KFQocy5pZCksZS5pZCxzKSkpKSkpO2Zvcihjb25zdCB0IG9mIHMpdCYmKGUuZHluYW1pY0RlcGVuZGVuY2llcy5hZGQodCksdC5keW5hbWljSW1wb3J0ZXJzLnB1c2goZS5pZCkpO31hc3luYyBmZXRjaE1vZHVsZSh7YXNzZXJ0aW9uczplLGlkOnQsbWV0YTpzLG1vZHVsZVNpZGVFZmZlY3RzOmksc3ludGhldGljTmFtZWRFeHBvcnRzOm59LHIsbyxhKXtjb25zdCBsPXRoaXMubW9kdWxlc0J5SWQuZ2V0KHQpO2lmKGwgaW5zdGFuY2VvZiBCbylyZXR1cm4gciYmQW8oZSxsLmluZm8uYXNzZXJ0aW9ucykmJnRoaXMub3B0aW9ucy5vbkxvZyhTZSxWdChsLmluZm8uYXNzZXJ0aW9ucyxlLHQscikpLGF3YWl0IHRoaXMuaGFuZGxlRXhpc3RpbmdNb2R1bGUobCxvLGEpLGw7aWYobCBpbnN0YW5jZW9mIFp0KXJldHVybiBYZSh7Y29kZToiRVhURVJOQUxfTU9EVUxFU19DQU5OT1RfQkVfVFJBTlNGT1JNRURfVE9fTU9EVUxFUyIsbWVzc2FnZTpgJHtsLmlkfSBpcyByZXNvbHZlZCBhcyBhIG1vZHVsZSBub3csIGJ1dCBpdCB3YXMgYW4gZXh0ZXJuYWwgbW9kdWxlIGJlZm9yZS4gUGxlYXNlIGNoZWNrIHdoZXRoZXIgdGhlcmUgYXJlIGNvbmZsaWN0cyBpbiB5b3VyIFJvbGx1cCBvcHRpb25zICJleHRlcm5hbCIgYW5kICJtYW51YWxDaHVua3MiLCBtYW51YWxDaHVua3MgY2Fubm90IGluY2x1ZGUgZXh0ZXJuYWwgbW9kdWxlcy5gfSk7Y29uc3QgYz1uZXcgQm8odGhpcy5ncmFwaCx0LHRoaXMub3B0aW9ucyxvLGksbixzLGUpO3RoaXMubW9kdWxlc0J5SWQuc2V0KHQsYyksdGhpcy5ncmFwaC53YXRjaEZpbGVzW3RdPSEwO2NvbnN0IGg9dGhpcy5hZGRNb2R1bGVTb3VyY2UodCxyLGMpLnRoZW4oKCgpPT5bdGhpcy5nZXRSZXNvbHZlU3RhdGljRGVwZW5kZW5jeVByb21pc2VzKGMpLHRoaXMuZ2V0UmVzb2x2ZUR5bmFtaWNJbXBvcnRQcm9taXNlcyhjKSx1XSkpLHU9aHUoaCkudGhlbigoKCk9PnRoaXMucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgibW9kdWxlUGFyc2VkIixbYy5pbmZvXSkpKTt1LmNhdGNoKCgoKT0+e30pKSx0aGlzLm1vZHVsZUxvYWRQcm9taXNlcy5zZXQoYyxoKTtjb25zdCBkPWF3YWl0IGg7cmV0dXJuIGE/YT09PXJ1JiZhd2FpdCB1OmF3YWl0IHRoaXMuZmV0Y2hNb2R1bGVEZXBlbmRlbmNpZXMoYywuLi5kKSxjfWFzeW5jIGZldGNoTW9kdWxlRGVwZW5kZW5jaWVzKGUsdCxzLGkpe3RoaXMubW9kdWxlc1dpdGhMb2FkZWREZXBlbmRlbmNpZXMuaGFzKGUpfHwodGhpcy5tb2R1bGVzV2l0aExvYWRlZERlcGVuZGVuY2llcy5hZGQoZSksYXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMuZmV0Y2hTdGF0aWNEZXBlbmRlbmNpZXMoZSx0KSx0aGlzLmZldGNoRHluYW1pY0RlcGVuZGVuY2llcyhlLHMpXSksZS5saW5rSW1wb3J0cygpLGF3YWl0IGkpO31mZXRjaFJlc29sdmVkRGVwZW5kZW5jeShlLHQscyl7aWYocy5leHRlcm5hbCl7Y29uc3R7YXNzZXJ0aW9uczppLGV4dGVybmFsOm4saWQ6cixtb2R1bGVTaWRlRWZmZWN0czpvLG1ldGE6YX09cztsZXQgbD10aGlzLm1vZHVsZXNCeUlkLmdldChyKTtpZihsKXtpZighKGwgaW5zdGFuY2VvZiBadCkpcmV0dXJuIFhlKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOiJJTlZBTElEX0VYVEVSTkFMX0lEIixtZXNzYWdlOmAiJHtlfSIgaXMgaW1wb3J0ZWQgYXMgYW4gZXh0ZXJuYWwgYnkgIiR7VCh0KX0iLCBidXQgaXMgYWxyZWFkeSBhbiBleGlzdGluZyBub24tZXh0ZXJuYWwgbW9kdWxlIGlkLmB9fShlLHQpKTtBbyhsLmluZm8uYXNzZXJ0aW9ucyxpKSYmdGhpcy5vcHRpb25zLm9uTG9nKFNlLFZ0KGwuaW5mby5hc3NlcnRpb25zLGksZSx0KSk7fWVsc2UgbD1uZXcgWnQodGhpcy5vcHRpb25zLHIsbyxhLCJhYnNvbHV0ZSIhPT1uJiZrKHIpLGkpLHRoaXMubW9kdWxlc0J5SWQuc2V0KHIsbCk7cmV0dXJuIFByb21pc2UucmVzb2x2ZShsKX1yZXR1cm4gdGhpcy5mZXRjaE1vZHVsZShzLHQsITEsITEpfWFzeW5jIGZldGNoU3RhdGljRGVwZW5kZW5jaWVzKGUsdCl7Zm9yKGNvbnN0IHMgb2YgYXdhaXQgUHJvbWlzZS5hbGwodC5tYXAoKHQ9PnQudGhlbigoKFt0LHNdKT0+dGhpcy5mZXRjaFJlc29sdmVkRGVwZW5kZW5jeSh0LGUuaWQscykpKSkpKSllLmRlcGVuZGVuY2llcy5hZGQocykscy5pbXBvcnRlcnMucHVzaChlLmlkKTtpZighdGhpcy5vcHRpb25zLnRyZWVzaGFrZXx8Im5vLXRyZWVzaGFrZSI9PT1lLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMpZm9yKGNvbnN0IHQgb2YgZS5kZXBlbmRlbmNpZXMpdCBpbnN0YW5jZW9mIEJvJiYodC5pbXBvcnRlZEZyb21Ob3RUcmVlc2hha2VuPSEwKTt9Z2V0Tm9ybWFsaXplZFJlc29sdmVkSWRXaXRob3V0RGVmYXVsdHMoZSx0LHMpe2NvbnN0e21ha2VBYnNvbHV0ZUV4dGVybmFsc1JlbGF0aXZlOml9PXRoaXMub3B0aW9ucztpZihlKXtpZigib2JqZWN0Ij09dHlwZW9mIGUpe2NvbnN0IG49ZS5leHRlcm5hbHx8dGhpcy5vcHRpb25zLmV4dGVybmFsKGUuaWQsdCwhMCk7cmV0dXJuIHsuLi5lLGV4dGVybmFsOm4mJigicmVsYXRpdmUiPT09bnx8IWsoZS5pZCl8fCEwPT09biYmY3UoZS5pZCxzLGkpfHwiYWJzb2x1dGUiKX19Y29uc3Qgbj10aGlzLm9wdGlvbnMuZXh0ZXJuYWwoZSx0LCEwKTtyZXR1cm4ge2V4dGVybmFsOm4mJihjdShlLHMsaSl8fCJhYnNvbHV0ZSIpLGlkOm4mJmk/YXUoZSx0KTplfX1jb25zdCBuPWk/YXUocyx0KTpzO3JldHVybiAhMT09PWV8fHRoaXMub3B0aW9ucy5leHRlcm5hbChuLHQsITApP3tleHRlcm5hbDpjdShuLHMsaSl8fCJhYnNvbHV0ZSIsaWQ6bn06bnVsbH1nZXRSZXNvbHZlRHluYW1pY0ltcG9ydFByb21pc2VzKGUpe3JldHVybiBlLmR5bmFtaWNJbXBvcnRzLm1hcCgoYXN5bmMgdD0+e2NvbnN0IHM9YXdhaXQgdGhpcy5yZXNvbHZlRHluYW1pY0ltcG9ydChlLCJzdHJpbmciPT10eXBlb2YgdC5hcmd1bWVudD90LmFyZ3VtZW50OnQuYXJndW1lbnQuZXNUcmVlTm9kZSxlLmlkLGZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5hcmd1bWVudHM/LlswXT8ucHJvcGVydGllcy5maW5kKChlPT4iYXNzZXJ0Ij09PVNvKGUpKSk/LnZhbHVlO2lmKCF0KXJldHVybiBtZTtjb25zdCBzPXQucHJvcGVydGllcy5tYXAoKGU9Pntjb25zdCB0PVNvKGUpO3JldHVybiAic3RyaW5nIj09dHlwZW9mIHQmJiJzdHJpbmciPT10eXBlb2YgZS52YWx1ZS52YWx1ZT9bdCxlLnZhbHVlLnZhbHVlXTpudWxsfSkpLmZpbHRlcigoZT0+ISFlKSk7cmV0dXJuIHMubGVuZ3RoPjA/T2JqZWN0LmZyb21FbnRyaWVzKHMpOm1lfSh0Lm5vZGUpKTtyZXR1cm4gcyYmIm9iamVjdCI9PXR5cGVvZiBzJiYodC5pZD1zLmlkKSxbdCxzXX0pKX1nZXRSZXNvbHZlU3RhdGljRGVwZW5kZW5jeVByb21pc2VzKGUpe3JldHVybiBBcnJheS5mcm9tKGUuc291cmNlc1dpdGhBc3NlcnRpb25zLChhc3luYyhbdCxzXSk9Plt0LGUucmVzb2x2ZWRJZHNbdF09ZS5yZXNvbHZlZElkc1t0XXx8dGhpcy5oYW5kbGVJbnZhbGlkUmVzb2x2ZWRJZChhd2FpdCB0aGlzLnJlc29sdmVJZCh0LGUuaWQsbWUsITEscyksdCxlLmlkLHMpXSkpfWdldFJlc29sdmVkSWRXaXRoRGVmYXVsdHMoZSx0KXtpZighZSlyZXR1cm4gbnVsbDtjb25zdCBzPWUuZXh0ZXJuYWx8fCExO3JldHVybiB7YXNzZXJ0aW9uczplLmFzc2VydGlvbnN8fHQsZXh0ZXJuYWw6cyxpZDplLmlkLG1ldGE6ZS5tZXRhfHx7fSxtb2R1bGVTaWRlRWZmZWN0czplLm1vZHVsZVNpZGVFZmZlY3RzPz90aGlzLmhhc01vZHVsZVNpZGVFZmZlY3RzKGUuaWQsISFzKSxyZXNvbHZlZEJ5OmUucmVzb2x2ZWRCeT8/InJvbGx1cCIsc3ludGhldGljTmFtZWRFeHBvcnRzOmUuc3ludGhldGljTmFtZWRFeHBvcnRzPz8hMX19YXN5bmMgaGFuZGxlRXhpc3RpbmdNb2R1bGUoZSx0LHMpe2NvbnN0IGk9dGhpcy5tb2R1bGVMb2FkUHJvbWlzZXMuZ2V0KGUpO2lmKHMpcmV0dXJuIHM9PT1ydT9odShpKTppO2lmKHQpe2UuaW5mby5pc0VudHJ5PSEwLHRoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXMuZGVsZXRlKGUpO2Zvcihjb25zdCB0IG9mIGUuaW1wbGljaXRseUxvYWRlZEFmdGVyKXQuaW1wbGljaXRseUxvYWRlZEJlZm9yZS5kZWxldGUoZSk7ZS5pbXBsaWNpdGx5TG9hZGVkQWZ0ZXIuY2xlYXIoKTt9cmV0dXJuIHRoaXMuZmV0Y2hNb2R1bGVEZXBlbmRlbmNpZXMoZSwuLi5hd2FpdCBpKX1oYW5kbGVJbnZhbGlkUmVzb2x2ZWRJZChlLHQscyxpKXtyZXR1cm4gbnVsbD09PWU/SSh0KT9YZShmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZTpOdCxleHBvcnRlcjplLGlkOnQsbWVzc2FnZTpgQ291bGQgbm90IHJlc29sdmUgIiR7ZX0iIGZyb20gIiR7VCh0KX0iYH19KHQscykpOih0aGlzLm9wdGlvbnMub25Mb2coU2UsZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2NvZGU6TnQsZXhwb3J0ZXI6ZSxpZDp0LG1lc3NhZ2U6YCIke2V9IiBpcyBpbXBvcnRlZCBieSAiJHtUKHQpfSIsIGJ1dCBjb3VsZCBub3QgYmUgcmVzb2x2ZWQg4oCTIHRyZWF0aW5nIGl0IGFzIGFuIGV4dGVybmFsIGRlcGVuZGVuY3kuYCx1cmw6T2UoInRyb3VibGVzaG9vdGluZy8jd2FybmluZy10cmVhdGluZy1tb2R1bGUtYXMtZXh0ZXJuYWwtZGVwZW5kZW5jeSIpfX0odCxzKSkse2Fzc2VydGlvbnM6aSxleHRlcm5hbDohMCxpZDp0LG1ldGE6e30sbW9kdWxlU2lkZUVmZmVjdHM6dGhpcy5oYXNNb2R1bGVTaWRlRWZmZWN0cyh0LCEwKSxyZXNvbHZlZEJ5OiJyb2xsdXAiLHN5bnRoZXRpY05hbWVkRXhwb3J0czohMX0pOihlLmV4dGVybmFsJiZlLnN5bnRoZXRpY05hbWVkRXhwb3J0cyYmdGhpcy5vcHRpb25zLm9uTG9nKFNlLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOiJFWFRFUk5BTF9TWU5USEVUSUNfRVhQT1JUUyIsZXhwb3J0ZXI6ZSxtZXNzYWdlOmBFeHRlcm5hbCAiJHtlfSIgY2Fubm90IGhhdmUgInN5bnRoZXRpY05hbWVkRXhwb3J0cyIgZW5hYmxlZCAoaW1wb3J0ZWQgYnkgIiR7VCh0KX0iKS5gfX0odCxzKSksZSl9YXN5bmMgbG9hZEVudHJ5TW9kdWxlKGUsdCxzLGksbj0hMSl7Y29uc3Qgcj1hd2FpdCBqaChlLHMsdGhpcy5vcHRpb25zLnByZXNlcnZlU3ltbGlua3MsdGhpcy5wbHVnaW5Ecml2ZXIsdGhpcy5yZXNvbHZlSWQsbnVsbCxtZSwhMCxtZSk7aWYobnVsbD09cilyZXR1cm4gWGUobnVsbD09PWk/ZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOiR0LG1lc3NhZ2U6YENvdWxkIG5vdCByZXNvbHZlIGVudHJ5IG1vZHVsZSAiJHtUKGUpfSIuYH19KGUpOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOnh0LG1lc3NhZ2U6YE1vZHVsZSAiJHtUKGUpfSIgdGhhdCBzaG91bGQgYmUgaW1wbGljaXRseSBsb2FkZWQgYmVmb3JlICIke1QodCl9IiBjb3VsZCBub3QgYmUgcmVzb2x2ZWQuYH19KGUsaSkpO2NvbnN0IG89Im9iamVjdCI9PXR5cGVvZiByJiZyLmV4dGVybmFsO3JldHVybiAhMT09PXJ8fG8/WGUobnVsbD09PWk/byYmbj97Y29kZToiRVhURVJOQUxfTU9EVUxFU19DQU5OT1RfQkVfSU5DTFVERURfSU5fTUFOVUFMX0NIVU5LUyIsbWVzc2FnZTpgIiR7ZX0iIGNhbm5vdCBiZSBpbmNsdWRlZCBpbiBtYW51YWxDaHVua3MgYmVjYXVzZSBpdCBpcyByZXNvbHZlZCBhcyBhbiBleHRlcm5hbCBtb2R1bGUgYnkgdGhlICJleHRlcm5hbCIgb3B0aW9uIG9yIHBsdWdpbnMuYH06ZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOiR0LG1lc3NhZ2U6YEVudHJ5IG1vZHVsZSAiJHtUKGUpfSIgY2Fubm90IGJlIGV4dGVybmFsLmB9fShlKTpmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZTp4dCxtZXNzYWdlOmBNb2R1bGUgIiR7VChlKX0iIHRoYXQgc2hvdWxkIGJlIGltcGxpY2l0bHkgbG9hZGVkIGJlZm9yZSAiJHtUKHQpfSIgY2Fubm90IGJlIGV4dGVybmFsLmB9fShlLGkpKTp0aGlzLmZldGNoTW9kdWxlKHRoaXMuZ2V0UmVzb2x2ZWRJZFdpdGhEZWZhdWx0cygib2JqZWN0Ij09dHlwZW9mIHI/cjp7aWQ6cn0sbWUpLHZvaWQgMCx0LCExKX1hc3luYyByZXNvbHZlRHluYW1pY0ltcG9ydChlLHQscyxpKXtjb25zdCBuPWF3YWl0IHRoaXMucGx1Z2luRHJpdmVyLmhvb2tGaXJzdCgicmVzb2x2ZUR5bmFtaWNJbXBvcnQiLFt0LHMse2Fzc2VydGlvbnM6aX1dKTtpZigic3RyaW5nIiE9dHlwZW9mIHQpcmV0dXJuICJzdHJpbmciPT10eXBlb2Ygbj9uOm4/dGhpcy5nZXRSZXNvbHZlZElkV2l0aERlZmF1bHRzKG4saSk6bnVsbDtpZihudWxsPT1uKXtjb25zdCBuPWUucmVzb2x2ZWRJZHNbdF07cmV0dXJuIG4/KEFvKG4uYXNzZXJ0aW9ucyxpKSYmdGhpcy5vcHRpb25zLm9uTG9nKFNlLFZ0KG4uYXNzZXJ0aW9ucyxpLHQscykpLG4pOmUucmVzb2x2ZWRJZHNbdF09dGhpcy5oYW5kbGVJbnZhbGlkUmVzb2x2ZWRJZChhd2FpdCB0aGlzLnJlc29sdmVJZCh0LGUuaWQsbWUsITEsaSksdCxlLmlkLGkpfXJldHVybiB0aGlzLmhhbmRsZUludmFsaWRSZXNvbHZlZElkKHRoaXMuZ2V0UmVzb2x2ZWRJZFdpdGhEZWZhdWx0cyh0aGlzLmdldE5vcm1hbGl6ZWRSZXNvbHZlZElkV2l0aG91dERlZmF1bHRzKG4scyx0KSxpKSx0LHMsaSl9fWZ1bmN0aW9uIGF1KGUsdCl7cmV0dXJuIEkoZSk/dD9fKHQsIi4uIixlKTpfKGUpOmV9ZnVuY3Rpb24gbHUoZSx7ZmlsZU5hbWU6dCxuYW1lOnN9LGksbil7aWYobnVsbCE9PXQpZS5jaHVua0ZpbGVOYW1lcy5hZGQodCk7ZWxzZSBpZihudWxsIT09cyl7bGV0IHQ9MDtmb3IoO2UuY2h1bmtOYW1lc1t0XT8ucHJpb3JpdHk8bjspdCsrO2UuY2h1bmtOYW1lcy5zcGxpY2UodCwwLHtpc1VzZXJEZWZpbmVkOmksbmFtZTpzLHByaW9yaXR5Om59KTt9fWZ1bmN0aW9uIGN1KGUsdCxzKXtyZXR1cm4gITA9PT1zfHwiaWZSZWxhdGl2ZVNvdXJjZSI9PT1zJiZJKHQpfHwhayhlKX1hc3luYyBmdW5jdGlvbiBodShlKXtjb25zdFt0LHNdPWF3YWl0IGU7cmV0dXJuIFByb21pc2UuYWxsKFsuLi50LC4uLnNdKX1jbGFzcyB1dSBleHRlbmRzIExpe2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnBhcmVudD1udWxsLHRoaXMudmFyaWFibGVzLnNldCgidW5kZWZpbmVkIixuZXcgb28pO31maW5kVmFyaWFibGUoZSl7bGV0IHQ9dGhpcy52YXJpYWJsZXMuZ2V0KGUpO3JldHVybiB0fHwodD1uZXcgYW4oZSksdGhpcy52YXJpYWJsZXMuc2V0KGUsdCkpLHR9fWZ1bmN0aW9uIGR1KGUpe3JldHVybiBGbCgpLnVwZGF0ZShlKS5kaWdlc3QoImhleCIpfWZ1bmN0aW9uIHB1KGUsdCxzLGksbil7Y29uc3Qgcj1pLnNhbml0aXplRmlsZU5hbWUoZXx8ImFzc2V0Iik7cmV0dXJuIE5hKCRhKCJmdW5jdGlvbiI9PXR5cGVvZiBpLmFzc2V0RmlsZU5hbWVzP2kuYXNzZXRGaWxlTmFtZXMoe25hbWU6ZSxzb3VyY2U6dCx0eXBlOiJhc3NldCJ9KTppLmFzc2V0RmlsZU5hbWVzLCJvdXRwdXQuYXNzZXRGaWxlTmFtZXMiLHtleHQ6KCk9PiQocikuc2xpY2UoMSksZXh0bmFtZTooKT0+JChyKSxoYXNoOmU9PnMuc2xpY2UoMCxNYXRoLm1heCgwLGV8fDgpKSxuYW1lOigpPT5yLnNsaWNlKDAsTWF0aC5tYXgoMCxyLmxlbmd0aC0kKHIpLmxlbmd0aCkpfSksbil9ZnVuY3Rpb24gZnUoZSx7YnVuZGxlOnR9LHMpe3RbUGFdLmhhcyhlLnRvTG93ZXJDYXNlKCkpP3MoU2UsZnVuY3Rpb24oZSl7cmV0dXJuIHtjb2RlOmF0LG1lc3NhZ2U6YFRoZSBlbWl0dGVkIGZpbGUgIiR7ZX0iIG92ZXJ3cml0ZXMgYSBwcmV2aW91c2x5IGVtaXR0ZWQgZmlsZSBvZiB0aGUgc2FtZSBuYW1lLmB9fShlKSk6dFtlXT1DYTt9Y29uc3QgbXU9bmV3IFNldChbImNodW5rIiwiYXNzZXQiLCJwcmVidWlsdC1jaHVuayJdKTtmdW5jdGlvbiBndShlLHQscyl7aWYoISgic3RyaW5nIj09dHlwZW9mIGV8fGUgaW5zdGFuY2VvZiBVaW50OEFycmF5KSl7Y29uc3QgZT10LmZpbGVOYW1lfHx0Lm5hbWV8fHM7cmV0dXJuIFhlKFl0KGBDb3VsZCBub3Qgc2V0IHNvdXJjZSBmb3IgJHsic3RyaW5nIj09dHlwZW9mIGU/YGFzc2V0ICIke2V9ImA6InVubmFtZWQgYXNzZXQifSwgYXNzZXQgc291cmNlIG5lZWRzIHRvIGJlIGEgc3RyaW5nLCBVaW50OEFycmF5IG9yIEJ1ZmZlci5gKSl9cmV0dXJuIGV9ZnVuY3Rpb24geXUoZSx0KXtyZXR1cm4gInN0cmluZyIhPXR5cGVvZiBlLmZpbGVOYW1lP1hlKChzPWUubmFtZXx8dCx7Y29kZTp0dCxtZXNzYWdlOmBQbHVnaW4gZXJyb3IgLSBVbmFibGUgdG8gZ2V0IGZpbGUgbmFtZSBmb3IgYXNzZXQgIiR7c30iLiBFbnN1cmUgdGhhdCB0aGUgc291cmNlIGlzIHNldCBhbmQgdGhhdCBnZW5lcmF0ZSBpcyBjYWxsZWQgZmlyc3QuIElmIHlvdSByZWZlcmVuY2UgYXNzZXRzIHZpYSBpbXBvcnQubWV0YS5ST0xMVVBfRklMRV9VUkxfPHJlZmVyZW5jZUlkPiwgeW91IG5lZWQgdG8gZWl0aGVyIGhhdmUgc2V0IHRoZWlyIHNvdXJjZSBhZnRlciAicmVuZGVyU3RhcnQiIG9yIG5lZWQgdG8gcHJvdmlkZSBhbiBleHBsaWNpdCAiZmlsZU5hbWUiIHdoZW4gZW1pdHRpbmcgdGhlbS5gfSkpOmUuZmlsZU5hbWU7dmFyIHM7fWZ1bmN0aW9uIHh1KGUsdCl7cmV0dXJuIGUuZmlsZU5hbWU/ZS5maWxlTmFtZTp0P3QuZ2V0KGUubW9kdWxlKS5nZXRGaWxlTmFtZSgpOlhlKChzPWUuZmlsZU5hbWV8fGUubmFtZSx7Y29kZTppdCxtZXNzYWdlOmBQbHVnaW4gZXJyb3IgLSBVbmFibGUgdG8gZ2V0IGZpbGUgbmFtZSBmb3IgZW1pdHRlZCBjaHVuayAiJHtzfSIuIFlvdSBjYW4gb25seSBnZXQgZmlsZSBuYW1lcyBvbmNlIGNodW5rcyBoYXZlIGJlZW4gZ2VuZXJhdGVkIGFmdGVyIHRoZSAicmVuZGVyU3RhcnQiIGhvb2suYH0pKTt2YXIgczt9Y2xhc3MgRXV7Y29uc3RydWN0b3IoZSx0LHMpe3RoaXMuZ3JhcGg9ZSx0aGlzLm9wdGlvbnM9dCx0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGU9bnVsbCx0aGlzLm5leHRJZEJhc2U9MSx0aGlzLm91dHB1dD1udWxsLHRoaXMub3V0cHV0RmlsZUVtaXR0ZXJzPVtdLHRoaXMuZW1pdEZpbGU9ZT0+ZnVuY3Rpb24oZSl7cmV0dXJuIEJvb2xlYW4oZSYmbXUuaGFzKGUudHlwZSkpfShlKT8icHJlYnVpbHQtY2h1bmsiPT09ZS50eXBlP3RoaXMuZW1pdFByZWJ1aWx0Q2h1bmsoZSk6ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmZpbGVOYW1lfHxlLm5hbWU7cmV0dXJuICF0fHwic3RyaW5nIj09dHlwZW9mIHQmJiFWKHQpfShlKT8iY2h1bmsiPT09ZS50eXBlP3RoaXMuZW1pdENodW5rKGUpOnRoaXMuZW1pdEFzc2V0KGUpOlhlKFl0KGBUaGUgImZpbGVOYW1lIiBvciAibmFtZSIgcHJvcGVydGllcyBvZiBlbWl0dGVkIGNodW5rcyBhbmQgYXNzZXRzIG11c3QgYmUgc3RyaW5ncyB0aGF0IGFyZSBuZWl0aGVyIGFic29sdXRlIG5vciByZWxhdGl2ZSBwYXRocywgcmVjZWl2ZWQgIiR7ZS5maWxlTmFtZXx8ZS5uYW1lfSIuYCkpOlhlKFl0KGBFbWl0dGVkIGZpbGVzIG11c3QgYmUgb2YgdHlwZSAiYXNzZXQiLCAiY2h1bmsiIG9yICJwcmVidWlsdC1jaHVuayIsIHJlY2VpdmVkICIke2UmJmUudHlwZX0iLmApKSx0aGlzLmZpbmFsaXNlQXNzZXRzPSgpPT57Zm9yKGNvbnN0W2UsdF1vZiB0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZClpZigiYXNzZXQiPT09dC50eXBlJiYic3RyaW5nIiE9dHlwZW9mIHQuZmlsZU5hbWUpcmV0dXJuIFhlKHtjb2RlOiJBU1NFVF9TT1VSQ0VfTUlTU0lORyIsbWVzc2FnZTpgUGx1Z2luIGVycm9yIGNyZWF0aW5nIGFzc2V0ICIke3QubmFtZXx8ZX0iIC0gbm8gYXNzZXQgc291cmNlIHNldC5gfSl9LHRoaXMuZ2V0RmlsZU5hbWU9ZT0+e2NvbnN0IHQ9dGhpcy5maWxlc0J5UmVmZXJlbmNlSWQuZ2V0KGUpO3JldHVybiB0PyJjaHVuayI9PT10LnR5cGU/eHUodCx0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGUpOiJwcmVidWlsdC1jaHVuayI9PT10LnR5cGU/dC5maWxlTmFtZTp5dSh0LGUpOlhlKHtjb2RlOiJGSUxFX05PVF9GT1VORCIsbWVzc2FnZTpgUGx1Z2luIGVycm9yIC0gVW5hYmxlIHRvIGdldCBmaWxlIG5hbWUgZm9yIHVua25vd24gZmlsZSAiJHtlfSIuYH0pfSx0aGlzLnNldEFzc2V0U291cmNlPShlLHQpPT57Y29uc3Qgcz10aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5nZXQoZSk7aWYoIXMpcmV0dXJuIFhlKHtjb2RlOiJBU1NFVF9OT1RfRk9VTkQiLG1lc3NhZ2U6YFBsdWdpbiBlcnJvciAtIFVuYWJsZSB0byBzZXQgdGhlIHNvdXJjZSBmb3IgdW5rbm93biBhc3NldCAiJHtlfSIuYH0pO2lmKCJhc3NldCIhPT1zLnR5cGUpcmV0dXJuIFhlKFl0KGBBc3NldCBzb3VyY2VzIGNhbiBvbmx5IGJlIHNldCBmb3IgZW1pdHRlZCBhc3NldHMgYnV0ICIke2V9IiBpcyBhbiBlbWl0dGVkIGNodW5rLmApKTtpZih2b2lkIDAhPT1zLnNvdXJjZSlyZXR1cm4gWGUoe2NvZGU6IkFTU0VUX1NPVVJDRV9BTFJFQURZX1NFVCIsbWVzc2FnZTpgVW5hYmxlIHRvIHNldCB0aGUgc291cmNlIGZvciBhc3NldCAiJHtzLm5hbWV8fGV9Iiwgc291cmNlIGFscmVhZHkgc2V0LmB9KTtjb25zdCBpPWd1KHQscyxlKTtpZih0aGlzLm91dHB1dCl0aGlzLmZpbmFsaXplQWRkaXRpb25hbEFzc2V0KHMsaSx0aGlzLm91dHB1dCk7ZWxzZSB7cy5zb3VyY2U9aTtmb3IoY29uc3QgZSBvZiB0aGlzLm91dHB1dEZpbGVFbWl0dGVycyllLmZpbmFsaXplQWRkaXRpb25hbEFzc2V0KHMsaSxlLm91dHB1dCk7fX0sdGhpcy5zZXRDaHVua0luZm9ybWF0aW9uPWU9Pnt0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGU9ZTt9LHRoaXMuc2V0T3V0cHV0QnVuZGxlPShlLHQpPT57Y29uc3Qgcz10aGlzLm91dHB1dD17YnVuZGxlOmUsZmlsZU5hbWVzQnlTb3VyY2U6bmV3IE1hcCxvdXRwdXRPcHRpb25zOnR9O2Zvcihjb25zdCBlIG9mIHRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkLnZhbHVlcygpKWUuZmlsZU5hbWUmJmZ1KGUuZmlsZU5hbWUscyx0aGlzLm9wdGlvbnMub25Mb2cpO2NvbnN0IGk9bmV3IE1hcDtmb3IoY29uc3QgZSBvZiB0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC52YWx1ZXMoKSlpZigiYXNzZXQiPT09ZS50eXBlJiZ2b2lkIDAhPT1lLnNvdXJjZSlpZihlLmZpbGVOYW1lKXRoaXMuZmluYWxpemVBZGRpdGlvbmFsQXNzZXQoZSxlLnNvdXJjZSxzKTtlbHNlIHtqKGksZHUoZS5zb3VyY2UpLCgoKT0+W10pKS5wdXNoKGUpO31lbHNlICJwcmVidWlsdC1jaHVuayI9PT1lLnR5cGUmJih0aGlzLm91dHB1dC5idW5kbGVbZS5maWxlTmFtZV09dGhpcy5jcmVhdGVQcmVidWlsdENodW5rKGUpKTtmb3IoY29uc3RbZSx0XW9mIGkpdGhpcy5maW5hbGl6ZUFzc2V0c1dpdGhTYW1lU291cmNlKHQsZSxzKTt9LHRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkPXM/bmV3IE1hcChzLmZpbGVzQnlSZWZlcmVuY2VJZCk6bmV3IE1hcCxzPy5hZGRPdXRwdXRGaWxlRW1pdHRlcih0aGlzKTt9YWRkT3V0cHV0RmlsZUVtaXR0ZXIoZSl7dGhpcy5vdXRwdXRGaWxlRW1pdHRlcnMucHVzaChlKTt9YXNzaWduUmVmZXJlbmNlSWQoZSx0KXtsZXQgcz10O2Rve3M9RmwoKS51cGRhdGUocykuZGlnZXN0KCJoZXgiKS5zbGljZSgwLDgpO313aGlsZSh0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5oYXMocyl8fHRoaXMub3V0cHV0RmlsZUVtaXR0ZXJzLnNvbWUoKCh7ZmlsZXNCeVJlZmVyZW5jZUlkOmV9KT0+ZS5oYXMocykpKSk7ZS5yZWZlcmVuY2VJZD1zLHRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkLnNldChzLGUpO2Zvcihjb25zdHtmaWxlc0J5UmVmZXJlbmNlSWQ6dH1vZiB0aGlzLm91dHB1dEZpbGVFbWl0dGVycyl0LnNldChzLGUpO3JldHVybiBzfWNyZWF0ZVByZWJ1aWx0Q2h1bmsoZSl7cmV0dXJuIHtjb2RlOmUuY29kZSxkeW5hbWljSW1wb3J0czpbXSxleHBvcnRzOmUuZXhwb3J0c3x8W10sZmFjYWRlTW9kdWxlSWQ6bnVsbCxmaWxlTmFtZTplLmZpbGVOYW1lLGltcGxpY2l0bHlMb2FkZWRCZWZvcmU6W10saW1wb3J0ZWRCaW5kaW5nczp7fSxpbXBvcnRzOltdLGlzRHluYW1pY0VudHJ5OiExLGlzRW50cnk6ITEsaXNJbXBsaWNpdEVudHJ5OiExLG1hcDplLm1hcHx8bnVsbCxtb2R1bGVJZHM6W10sbW9kdWxlczp7fSxuYW1lOmUuZmlsZU5hbWUscHJlbGltaW5hcnlGaWxlTmFtZTplLmZpbGVOYW1lLHJlZmVyZW5jZWRGaWxlczpbXSxzb3VyY2VtYXBGaWxlTmFtZTplLnNvdXJjZW1hcEZpbGVOYW1lfHxudWxsLHR5cGU6ImNodW5rIn19ZW1pdEFzc2V0KGUpe2NvbnN0IHQ9dm9pZCAwPT09ZS5zb3VyY2U/dm9pZCAwOmd1KGUuc291cmNlLGUsbnVsbCkscz17ZmlsZU5hbWU6ZS5maWxlTmFtZSxuYW1lOmUubmFtZSxuZWVkc0NvZGVSZWZlcmVuY2U6ISFlLm5lZWRzQ29kZVJlZmVyZW5jZSxyZWZlcmVuY2VJZDoiIixzb3VyY2U6dCx0eXBlOiJhc3NldCJ9LGk9dGhpcy5hc3NpZ25SZWZlcmVuY2VJZChzLGUuZmlsZU5hbWV8fGUubmFtZXx8U3RyaW5nKHRoaXMubmV4dElkQmFzZSsrKSk7aWYodGhpcy5vdXRwdXQpdGhpcy5lbWl0QXNzZXRXaXRoUmVmZXJlbmNlSWQocyx0aGlzLm91dHB1dCk7ZWxzZSBmb3IoY29uc3QgZSBvZiB0aGlzLm91dHB1dEZpbGVFbWl0dGVycyllLmVtaXRBc3NldFdpdGhSZWZlcmVuY2VJZChzLGUub3V0cHV0KTtyZXR1cm4gaX1lbWl0QXNzZXRXaXRoUmVmZXJlbmNlSWQoZSx0KXtjb25zdHtmaWxlTmFtZTpzLHNvdXJjZTppfT1lO3MmJmZ1KHMsdCx0aGlzLm9wdGlvbnMub25Mb2cpLHZvaWQgMCE9PWkmJnRoaXMuZmluYWxpemVBZGRpdGlvbmFsQXNzZXQoZSxpLHQpO31lbWl0Q2h1bmsoZSl7aWYodGhpcy5ncmFwaC5waGFzZT55by5MT0FEX0FORF9QQVJTRSlyZXR1cm4gWGUoe2NvZGU6ZnQsbWVzc2FnZToiQ2Fubm90IGVtaXQgY2h1bmtzIGFmdGVyIG1vZHVsZSBsb2FkaW5nIGhhcyBmaW5pc2hlZC4ifSk7aWYoInN0cmluZyIhPXR5cGVvZiBlLmlkKXJldHVybiBYZShZdChgRW1pdHRlZCBjaHVua3MgbmVlZCB0byBoYXZlIGEgdmFsaWQgc3RyaW5nIGlkLCByZWNlaXZlZCAiJHtlLmlkfSJgKSk7Y29uc3QgdD17ZmlsZU5hbWU6ZS5maWxlTmFtZSxtb2R1bGU6bnVsbCxuYW1lOmUubmFtZXx8ZS5pZCxyZWZlcmVuY2VJZDoiIix0eXBlOiJjaHVuayJ9O3JldHVybiB0aGlzLmdyYXBoLm1vZHVsZUxvYWRlci5lbWl0Q2h1bmsoZSkudGhlbigoZT0+dC5tb2R1bGU9ZSkpLmNhdGNoKCgoKT0+e30pKSx0aGlzLmFzc2lnblJlZmVyZW5jZUlkKHQsZS5pZCl9ZW1pdFByZWJ1aWx0Q2h1bmsoZSl7aWYoInN0cmluZyIhPXR5cGVvZiBlLmNvZGUpcmV0dXJuIFhlKFl0KGBFbWl0dGVkIHByZWJ1aWx0IGNodW5rcyBuZWVkIHRvIGhhdmUgYSB2YWxpZCBzdHJpbmcgY29kZSwgcmVjZWl2ZWQgIiR7ZS5jb2RlfSIuYCkpO2lmKCJzdHJpbmciIT10eXBlb2YgZS5maWxlTmFtZXx8VihlLmZpbGVOYW1lKSlyZXR1cm4gWGUoWXQoYFRoZSAiZmlsZU5hbWUiIHByb3BlcnR5IG9mIGVtaXR0ZWQgcHJlYnVpbHQgY2h1bmtzIG11c3QgYmUgc3RyaW5ncyB0aGF0IGFyZSBuZWl0aGVyIGFic29sdXRlIG5vciByZWxhdGl2ZSBwYXRocywgcmVjZWl2ZWQgIiR7ZS5maWxlTmFtZX0iLmApKTtjb25zdCB0PXtjb2RlOmUuY29kZSxleHBvcnRzOmUuZXhwb3J0cyxmaWxlTmFtZTplLmZpbGVOYW1lLG1hcDplLm1hcCxyZWZlcmVuY2VJZDoiIix0eXBlOiJwcmVidWlsdC1jaHVuayJ9LHM9dGhpcy5hc3NpZ25SZWZlcmVuY2VJZCh0LHQuZmlsZU5hbWUpO3JldHVybiB0aGlzLm91dHB1dCYmKHRoaXMub3V0cHV0LmJ1bmRsZVt0LmZpbGVOYW1lXT10aGlzLmNyZWF0ZVByZWJ1aWx0Q2h1bmsodCkpLHN9ZmluYWxpemVBZGRpdGlvbmFsQXNzZXQoZSx0LHtidW5kbGU6cyxmaWxlTmFtZXNCeVNvdXJjZTppLG91dHB1dE9wdGlvbnM6bn0pe2xldHtmaWxlTmFtZTpyLG5lZWRzQ29kZVJlZmVyZW5jZTpvLHJlZmVyZW5jZUlkOmF9PWU7aWYoIXIpe2NvbnN0IG89ZHUodCk7cj1pLmdldChvKSxyfHwocj1wdShlLm5hbWUsdCxvLG4scyksaS5zZXQobyxyKSk7fWNvbnN0IGw9ey4uLmUsZmlsZU5hbWU6cixzb3VyY2U6dH07dGhpcy5maWxlc0J5UmVmZXJlbmNlSWQuc2V0KGEsbCk7Y29uc3QgYz1zW3JdOyJhc3NldCI9PT1jPy50eXBlP2MubmVlZHNDb2RlUmVmZXJlbmNlJiYoYy5uZWVkc0NvZGVSZWZlcmVuY2U9byk6c1tyXT17ZmlsZU5hbWU6cixuYW1lOmUubmFtZSxuZWVkc0NvZGVSZWZlcmVuY2U6byxzb3VyY2U6dCx0eXBlOiJhc3NldCJ9O31maW5hbGl6ZUFzc2V0c1dpdGhTYW1lU291cmNlKGUsdCx7YnVuZGxlOnMsZmlsZU5hbWVzQnlTb3VyY2U6aSxvdXRwdXRPcHRpb25zOm59KXtsZXQgcixvPSIiLGE9ITA7Zm9yKGNvbnN0IGkgb2YgZSl7YSYmKGE9aS5uZWVkc0NvZGVSZWZlcmVuY2UpO2NvbnN0IGU9cHUoaS5uYW1lLGkuc291cmNlLHQsbixzKTsoIW98fGUubGVuZ3RoPG8ubGVuZ3RofHxlLmxlbmd0aD09PW8ubGVuZ3RoJiZlPG8pJiYobz1lLHI9aSk7fWkuc2V0KHQsbyk7Zm9yKGNvbnN0IHQgb2YgZSl7Y29uc3QgZT17Li4udCxmaWxlTmFtZTpvfTt0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5zZXQodC5yZWZlcmVuY2VJZCxlKTt9c1tvXT17ZmlsZU5hbWU6byxuYW1lOnIubmFtZSxuZWVkc0NvZGVSZWZlcmVuY2U6YSxzb3VyY2U6ci5zb3VyY2UsdHlwZToiYXNzZXQifTt9fWZ1bmN0aW9uIGJ1KGUsdCxzLGksbil7cmV0dXJuIEllW2VdPEllW25dP2ppOihuLHIpPT57bnVsbCE9ciYmcyhTZSx7Y29kZTp1dCxtZXNzYWdlOmBQbHVnaW4gIiR7aX0iIHRyaWVkIHRvIGFkZCBhIGZpbGUgcG9zaXRpb24gdG8gYSBsb2cgb3Igd2FybmluZy4gVGhpcyBpcyBvbmx5IHN1cHBvcnRlZCBpbiB0aGUgInRyYW5zZm9ybSIgaG9vayBhdCB0aGUgbW9tZW50IGFuZCB3aWxsIGJlIGlnbm9yZWQuYH0pLChuPVhoKG4pKS5jb2RlJiYhbi5wbHVnaW5Db2RlJiYobi5wbHVnaW5Db2RlPW4uY29kZSksbi5jb2RlPXQsbi5wbHVnaW49aSxzKGUsbik7fX1mdW5jdGlvbiB2dSh0LHMsaSxuLHIsbyl7Y29uc3R7bG9nTGV2ZWw6YSxvbkxvZzpsfT1uO2xldCBjLGg9ITA7aWYoInN0cmluZyIhPXR5cGVvZiB0LmNhY2hlS2V5JiYodC5uYW1lLnN0YXJ0c1dpdGgoVWgpfHx0Lm5hbWUuc3RhcnRzV2l0aChHaCl8fG8uaGFzKHQubmFtZSk/aD0hMTpvLmFkZCh0Lm5hbWUpKSxzKWlmKGgpe2NvbnN0IGU9dC5jYWNoZUtleXx8dC5uYW1lO2Q9c1tlXXx8KHNbZV09T2JqZWN0LmNyZWF0ZShudWxsKSksYz17ZGVsZXRlOmU9PmRlbGV0ZSBkW2VdLGdldChlKXtjb25zdCB0PWRbZV07aWYodClyZXR1cm4gdFswXT0wLHRbMV19LGhhcyhlKXtjb25zdCB0PWRbZV07cmV0dXJuICEhdCYmKHRbMF09MCwhMCl9LHNldChlLHQpe2RbZV09WzAsdF07fX07fWVsc2UgdT10Lm5hbWUsYz17ZGVsZXRlOigpPT5xaCh1KSxnZXQ6KCk9PnFoKHUpLGhhczooKT0+cWgodSksc2V0OigpPT5xaCh1KX07ZWxzZSBjPVdoO3ZhciB1LGQ7cmV0dXJuIHthZGRXYXRjaEZpbGUoZSl7aWYoaS5waGFzZT49eW8uR0VORVJBVEUpcmV0dXJuIHRoaXMuZXJyb3Ioe2NvZGU6ZnQsbWVzc2FnZTonQ2Fubm90IGNhbGwgImFkZFdhdGNoRmlsZSIgYWZ0ZXIgdGhlIGJ1aWxkIGhhcyBmaW5pc2hlZC4nfSk7aS53YXRjaEZpbGVzW2VdPSEwO30sY2FjaGU6YyxkZWJ1ZzpidShrZSwiUExVR0lOX0xPRyIsbCx0Lm5hbWUsYSksZW1pdEZpbGU6ci5lbWl0RmlsZS5iaW5kKHIpLGVycm9yOmU9PlhlKFd0KFhoKGUpLHQubmFtZSkpLGdldEZpbGVOYW1lOnIuZ2V0RmlsZU5hbWUsZ2V0TW9kdWxlSWRzOigpPT5pLm1vZHVsZXNCeUlkLmtleXMoKSxnZXRNb2R1bGVJbmZvOmkuZ2V0TW9kdWxlSW5mbyxnZXRXYXRjaEZpbGVzOigpPT5PYmplY3Qua2V5cyhpLndhdGNoRmlsZXMpLGluZm86YnUoQWUsIlBMVUdJTl9MT0ciLGwsdC5uYW1lLGEpLGxvYWQ6ZT0+aS5tb2R1bGVMb2FkZXIucHJlbG9hZE1vZHVsZShlKSxtZXRhOntyb2xsdXBWZXJzaW9uOmUsd2F0Y2hNb2RlOmkud2F0Y2hNb2RlfSxnZXQgbW9kdWxlSWRzKCl7Y29uc3QgZT1pLm1vZHVsZXNCeUlkLmtleXMoKTtyZXR1cm4gZnVuY3Rpb24qKCl7WHQoYEFjY2Vzc2luZyAidGhpcy5tb2R1bGVJZHMiIG9uIHRoZSBwbHVnaW4gY29udGV4dCBieSBwbHVnaW4gJHt0Lm5hbWV9IGlzIGRlcHJlY2F0ZWQuIFRoZSAidGhpcy5nZXRNb2R1bGVJZHMiIHBsdWdpbiBjb250ZXh0IGZ1bmN0aW9uIHNob3VsZCBiZSB1c2VkIGluc3RlYWQuYCwicGx1Z2luLWRldmVsb3BtZW50LyN0aGlzLWdldG1vZHVsZWlkcyIsITAsbix0Lm5hbWUpLHlpZWxkKmU7fSgpfSxwYXJzZTppLmNvbnRleHRQYXJzZS5iaW5kKGkpLHJlc29sdmU6KGUscyx7YXNzZXJ0aW9uczpuLGN1c3RvbTpyLGlzRW50cnk6byxza2lwU2VsZjphfT1mZSk9PmkubW9kdWxlTG9hZGVyLnJlc29sdmVJZChlLHMscixvLG58fG1lLGE/W3tpbXBvcnRlcjpzLHBsdWdpbjp0LHNvdXJjZTplfV06bnVsbCksc2V0QXNzZXRTb3VyY2U6ci5zZXRBc3NldFNvdXJjZSx3YXJuOmJ1KFNlLCJQTFVHSU5fV0FSTklORyIsbCx0Lm5hbWUsYSl9fWNvbnN0IFN1PU9iamVjdC5rZXlzKHtidWlsZEVuZDoxLGJ1aWxkU3RhcnQ6MSxjbG9zZUJ1bmRsZToxLGNsb3NlV2F0Y2hlcjoxLGxvYWQ6MSxtb2R1bGVQYXJzZWQ6MSxvbkxvZzoxLG9wdGlvbnM6MSxyZXNvbHZlRHluYW1pY0ltcG9ydDoxLHJlc29sdmVJZDoxLHNob3VsZFRyYW5zZm9ybUNhY2hlZE1vZHVsZToxLHRyYW5zZm9ybToxLHdhdGNoQ2hhbmdlOjF9KTtjbGFzcyBBdXtjb25zdHJ1Y3RvcihlLHQscyxpLG4pe3RoaXMuZ3JhcGg9ZSx0aGlzLm9wdGlvbnM9dCx0aGlzLnBsdWdpbkNhY2hlPWksdGhpcy5zb3J0ZWRQbHVnaW5zPW5ldyBNYXAsdGhpcy51bmZ1bGZpbGxlZEFjdGlvbnM9bmV3IFNldCx0aGlzLmZpbGVFbWl0dGVyPW5ldyBFdShlLHQsbiYmbi5maWxlRW1pdHRlciksdGhpcy5lbWl0RmlsZT10aGlzLmZpbGVFbWl0dGVyLmVtaXRGaWxlLmJpbmQodGhpcy5maWxlRW1pdHRlciksdGhpcy5nZXRGaWxlTmFtZT10aGlzLmZpbGVFbWl0dGVyLmdldEZpbGVOYW1lLmJpbmQodGhpcy5maWxlRW1pdHRlciksdGhpcy5maW5hbGlzZUFzc2V0cz10aGlzLmZpbGVFbWl0dGVyLmZpbmFsaXNlQXNzZXRzLmJpbmQodGhpcy5maWxlRW1pdHRlciksdGhpcy5zZXRDaHVua0luZm9ybWF0aW9uPXRoaXMuZmlsZUVtaXR0ZXIuc2V0Q2h1bmtJbmZvcm1hdGlvbi5iaW5kKHRoaXMuZmlsZUVtaXR0ZXIpLHRoaXMuc2V0T3V0cHV0QnVuZGxlPXRoaXMuZmlsZUVtaXR0ZXIuc2V0T3V0cHV0QnVuZGxlLmJpbmQodGhpcy5maWxlRW1pdHRlciksdGhpcy5wbHVnaW5zPVsuLi5uP24ucGx1Z2luczpbXSwuLi5zXTtjb25zdCByPW5ldyBTZXQ7aWYodGhpcy5wbHVnaW5Db250ZXh0cz1uZXcgTWFwKHRoaXMucGx1Z2lucy5tYXAoKHM9PltzLHZ1KHMsaSxlLHQsdGhpcy5maWxlRW1pdHRlcixyKV0pKSksbilmb3IoY29uc3QgZSBvZiBzKWZvcihjb25zdCBzIG9mIFN1KXMgaW4gZSYmdC5vbkxvZyhTZSwobz1lLm5hbWUse2NvZGU6IklOUFVUX0hPT0tfSU5fT1VUUFVUX1BMVUdJTiIsbWVzc2FnZTpgVGhlICIke3N9IiBob29rIHVzZWQgYnkgdGhlIG91dHB1dCBwbHVnaW4gJHtvfSBpcyBhIGJ1aWxkIHRpbWUgaG9vayBhbmQgd2lsbCBub3QgYmUgcnVuIGZvciB0aGF0IHBsdWdpbi4gRWl0aGVyIHRoaXMgcGx1Z2luIGNhbm5vdCBiZSB1c2VkIGFzIGFuIG91dHB1dCBwbHVnaW4sIG9yIGl0IHNob3VsZCBoYXZlIGFuIG9wdGlvbiB0byBjb25maWd1cmUgaXQgYXMgYW4gb3V0cHV0IHBsdWdpbi5gfSkpO3ZhciBvO31jcmVhdGVPdXRwdXRQbHVnaW5Ecml2ZXIoZSl7cmV0dXJuIG5ldyBBdSh0aGlzLmdyYXBoLHRoaXMub3B0aW9ucyxlLHRoaXMucGx1Z2luQ2FjaGUsdGhpcyl9Z2V0VW5mdWxmaWxsZWRIb29rQWN0aW9ucygpe3JldHVybiB0aGlzLnVuZnVsZmlsbGVkQWN0aW9uc31ob29rRmlyc3QoZSx0LHMsaSl7cmV0dXJuIHRoaXMuaG9va0ZpcnN0QW5kR2V0UGx1Z2luKGUsdCxzLGkpLnRoZW4oKGU9PmUmJmVbMF0pKX1hc3luYyBob29rRmlyc3RBbmRHZXRQbHVnaW4oZSx0LHMsaSl7Zm9yKGNvbnN0IG4gb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKXtpZihpPy5oYXMobikpY29udGludWU7Y29uc3Qgcj1hd2FpdCB0aGlzLnJ1bkhvb2soZSx0LG4scyk7aWYobnVsbCE9cilyZXR1cm4gW3Isbl19cmV0dXJuIG51bGx9aG9va0ZpcnN0U3luYyhlLHQscyl7Zm9yKGNvbnN0IGkgb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKXtjb25zdCBuPXRoaXMucnVuSG9va1N5bmMoZSx0LGkscyk7aWYobnVsbCE9bilyZXR1cm4gbn1yZXR1cm4gbnVsbH1hc3luYyBob29rUGFyYWxsZWwoZSx0LHMpe2NvbnN0IGk9W107Zm9yKGNvbnN0IG4gb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKW5bZV0uc2VxdWVudGlhbD8oYXdhaXQgUHJvbWlzZS5hbGwoaSksaS5sZW5ndGg9MCxhd2FpdCB0aGlzLnJ1bkhvb2soZSx0LG4scykpOmkucHVzaCh0aGlzLnJ1bkhvb2soZSx0LG4scykpO2F3YWl0IFByb21pc2UuYWxsKGkpO31ob29rUmVkdWNlQXJnMChlLFt0LC4uLnNdLGksbil7bGV0IHI9UHJvbWlzZS5yZXNvbHZlKHQpO2Zvcihjb25zdCB0IG9mIHRoaXMuZ2V0U29ydGVkUGx1Z2lucyhlKSlyPXIudGhlbigocj0+dGhpcy5ydW5Ib29rKGUsW3IsLi4uc10sdCxuKS50aGVuKChlPT5pLmNhbGwodGhpcy5wbHVnaW5Db250ZXh0cy5nZXQodCkscixlLHQpKSkpKTtyZXR1cm4gcn1ob29rUmVkdWNlQXJnMFN5bmMoZSxbdCwuLi5zXSxpLG4pe2Zvcihjb25zdCByIG9mIHRoaXMuZ2V0U29ydGVkUGx1Z2lucyhlKSl7Y29uc3Qgbz1bdCwuLi5zXSxhPXRoaXMucnVuSG9va1N5bmMoZSxvLHIsbik7dD1pLmNhbGwodGhpcy5wbHVnaW5Db250ZXh0cy5nZXQociksdCxhLHIpO31yZXR1cm4gdH1hc3luYyBob29rUmVkdWNlVmFsdWUoZSx0LHMsaSl7Y29uc3Qgbj1bXSxyPVtdO2Zvcihjb25zdCB0IG9mIHRoaXMuZ2V0U29ydGVkUGx1Z2lucyhlLHd1KSl0W2VdLnNlcXVlbnRpYWw/KG4ucHVzaCguLi5hd2FpdCBQcm9taXNlLmFsbChyKSksci5sZW5ndGg9MCxuLnB1c2goYXdhaXQgdGhpcy5ydW5Ib29rKGUscyx0KSkpOnIucHVzaCh0aGlzLnJ1bkhvb2soZSxzLHQpKTtyZXR1cm4gbi5wdXNoKC4uLmF3YWl0IFByb21pc2UuYWxsKHIpKSxuLnJlZHVjZShpLGF3YWl0IHQpfWhvb2tSZWR1Y2VWYWx1ZVN5bmMoZSx0LHMsaSxuKXtsZXQgcj10O2Zvcihjb25zdCB0IG9mIHRoaXMuZ2V0U29ydGVkUGx1Z2lucyhlKSl7Y29uc3Qgbz10aGlzLnJ1bkhvb2tTeW5jKGUscyx0LG4pO3I9aS5jYWxsKHRoaXMucGx1Z2luQ29udGV4dHMuZ2V0KHQpLHIsbyx0KTt9cmV0dXJuIHJ9aG9va1NlcShlLHQscyl7bGV0IGk9UHJvbWlzZS5yZXNvbHZlKCk7Zm9yKGNvbnN0IG4gb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKWk9aS50aGVuKCgoKT0+dGhpcy5ydW5Ib29rKGUsdCxuLHMpKSk7cmV0dXJuIGkudGhlbihQdSl9Z2V0U29ydGVkUGx1Z2lucyhlLHQpe3JldHVybiBqKHRoaXMuc29ydGVkUGx1Z2lucyxlLCgoKT0+a3UoZSx0aGlzLnBsdWdpbnMsdCkpKX1ydW5Ib29rKGUsdCxzLGkpe2NvbnN0IG49c1tlXSxyPSJvYmplY3QiPT10eXBlb2Ygbj9uLmhhbmRsZXI6bjtsZXQgbz10aGlzLnBsdWdpbkNvbnRleHRzLmdldChzKTtpJiYobz1pKG8scykpO2xldCBhPW51bGw7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCgpPT57aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHIpcmV0dXJuIHI7Y29uc3QgaT1yLmFwcGx5KG8sdCk7cmV0dXJuIGk/LnRoZW4/KGE9W3MubmFtZSxlLHRdLHRoaXMudW5mdWxmaWxsZWRBY3Rpb25zLmFkZChhKSxQcm9taXNlLnJlc29sdmUoaSkudGhlbigoZT0+KHRoaXMudW5mdWxmaWxsZWRBY3Rpb25zLmRlbGV0ZShhKSxlKSkpKTppfSkpLmNhdGNoKCh0PT4obnVsbCE9PWEmJnRoaXMudW5mdWxmaWxsZWRBY3Rpb25zLmRlbGV0ZShhKSxYZShXdCh0LHMubmFtZSx7aG9vazplfSkpKSkpfXJ1bkhvb2tTeW5jKGUsdCxzLGkpe2NvbnN0IG49c1tlXSxyPSJvYmplY3QiPT10eXBlb2Ygbj9uLmhhbmRsZXI6bjtsZXQgbz10aGlzLnBsdWdpbkNvbnRleHRzLmdldChzKTtpJiYobz1pKG8scykpO3RyeXtyZXR1cm4gci5hcHBseShvLHQpfWNhdGNoKHQpe3JldHVybiBYZShXdCh0LHMubmFtZSx7aG9vazplfSkpfX19ZnVuY3Rpb24ga3UoZSx0LHM9SXUpe2NvbnN0IGk9W10sbj1bXSxyPVtdO2Zvcihjb25zdCBvIG9mIHQpe2NvbnN0IHQ9b1tlXTtpZih0KXtpZigib2JqZWN0Ij09dHlwZW9mIHQpe2lmKHModC5oYW5kbGVyLGUsbyksInByZSI9PT10Lm9yZGVyKXtpLnB1c2gobyk7Y29udGludWV9aWYoInBvc3QiPT09dC5vcmRlcil7ci5wdXNoKG8pO2NvbnRpbnVlfX1lbHNlIHModCxlLG8pO24ucHVzaChvKTt9fXJldHVybiBbLi4uaSwuLi5uLC4uLnJdfWZ1bmN0aW9uIEl1KGUsdCxzKXsiZnVuY3Rpb24iIT10eXBlb2YgZSYmWGUoZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2NvZGU6cHQsaG9vazplLG1lc3NhZ2U6YEVycm9yIHJ1bm5pbmcgcGx1Z2luIGhvb2sgIiR7ZX0iIGZvciBwbHVnaW4gIiR7dH0iLCBleHBlY3RlZCBhIGZ1bmN0aW9uIGhvb2sgb3IgYW4gb2JqZWN0IHdpdGggYSAiaGFuZGxlciIgZnVuY3Rpb24uYCxwbHVnaW46dH19KHQscy5uYW1lKSk7fWZ1bmN0aW9uIHd1KGUsdCxzKXtpZigic3RyaW5nIiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlKXJldHVybiBYZShmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZTpwdCxob29rOmUsbWVzc2FnZTpgRXJyb3IgcnVubmluZyBwbHVnaW4gaG9vayAiJHtlfSIgZm9yIHBsdWdpbiAiJHt0fSIsIGV4cGVjdGVkIGEgc3RyaW5nLCBhIGZ1bmN0aW9uIGhvb2sgb3IgYW4gb2JqZWN0IHdpdGggYSAiaGFuZGxlciIgc3RyaW5nIG9yIGZ1bmN0aW9uLmAscGx1Z2luOnR9fSh0LHMubmFtZSkpfWZ1bmN0aW9uIFB1KCl7fWNsYXNzIEN1e2NvbnN0cnVjdG9yKGUpe3RoaXMubWF4UGFyYWxsZWw9ZSx0aGlzLnF1ZXVlPVtdLHRoaXMud29ya2VyQ291bnQ9MDt9cnVuKGUpe3JldHVybiBuZXcgUHJvbWlzZSgoKHQscyk9Pnt0aGlzLnF1ZXVlLnB1c2goe3JlamVjdDpzLHJlc29sdmU6dCx0YXNrOmV9KSx0aGlzLndvcmsoKTt9KSl9YXN5bmMgd29yaygpe2lmKHRoaXMud29ya2VyQ291bnQ+PXRoaXMubWF4UGFyYWxsZWwpcmV0dXJuO2xldCBlO2Zvcih0aGlzLndvcmtlckNvdW50Kys7ZT10aGlzLnF1ZXVlLnNoaWZ0KCk7KXtjb25zdHtyZWplY3Q6dCxyZXNvbHZlOnMsdGFzazppfT1lO3RyeXtzKGF3YWl0IGkoKSk7fWNhdGNoKGUpe3QoZSk7fX10aGlzLndvcmtlckNvdW50LS07fX1jbGFzcyAkdXtjb25zdHJ1Y3RvcihlLHQpe2lmKHRoaXMub3B0aW9ucz1lLHRoaXMuYXN0THJ1PWZ1bmN0aW9uKGUpe3ZhciB0LHMsaSxuPWV8fDE7ZnVuY3Rpb24gcihlLHIpeysrdD5uJiYoaT1zLG8oMSksKyt0KSxzW2VdPXI7fWZ1bmN0aW9uIG8oZSl7dD0wLHM9T2JqZWN0LmNyZWF0ZShudWxsKSxlfHwoaT1PYmplY3QuY3JlYXRlKG51bGwpKTt9cmV0dXJuIG8oKSx7Y2xlYXI6byxoYXM6ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMCE9PXNbZV18fHZvaWQgMCE9PWlbZV19LGdldDpmdW5jdGlvbihlKXt2YXIgdD1zW2VdO3JldHVybiB2b2lkIDAhPT10P3Q6dm9pZCAwIT09KHQ9aVtlXSk/KHIoZSx0KSx0KTp2b2lkIDB9LHNldDpmdW5jdGlvbihlLHQpe3ZvaWQgMCE9PXNbZV0/c1tlXT10OnIoZSx0KTt9fX0oNSksdGhpcy5jYWNoZWRNb2R1bGVzPW5ldyBNYXAsdGhpcy5kZW9wdGltaXphdGlvblRyYWNrZXI9bmV3IGVlLHRoaXMuZW50cnlNb2R1bGVzPVtdLHRoaXMubW9kdWxlc0J5SWQ9bmV3IE1hcCx0aGlzLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSExLHRoaXMucGhhc2U9eW8uTE9BRF9BTkRfUEFSU0UsdGhpcy5zY29wZT1uZXcgdXUsdGhpcy53YXRjaEZpbGVzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy53YXRjaE1vZGU9ITEsdGhpcy5leHRlcm5hbE1vZHVsZXM9W10sdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcz1bXSx0aGlzLm1vZHVsZXM9W10sdGhpcy5nZXRNb2R1bGVJbmZvPWU9Pntjb25zdCB0PXRoaXMubW9kdWxlc0J5SWQuZ2V0KGUpO3JldHVybiB0P3QuaW5mbzpudWxsfSwhMSE9PWUuY2FjaGUpe2lmKGUuY2FjaGU/Lm1vZHVsZXMpZm9yKGNvbnN0IHQgb2YgZS5jYWNoZS5tb2R1bGVzKXRoaXMuY2FjaGVkTW9kdWxlcy5zZXQodC5pZCx0KTt0aGlzLnBsdWdpbkNhY2hlPWUuY2FjaGU/LnBsdWdpbnN8fE9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGNvbnN0IGUgaW4gdGhpcy5wbHVnaW5DYWNoZSl7Y29uc3QgdD10aGlzLnBsdWdpbkNhY2hlW2VdO2Zvcihjb25zdCBlIG9mIE9iamVjdC52YWx1ZXModCkpZVswXSsrO319aWYodCl7dGhpcy53YXRjaE1vZGU9ITA7Y29uc3QgZT0oLi4uZSk9PnRoaXMucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgid2F0Y2hDaGFuZ2UiLGUpLHM9KCk9PnRoaXMucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiY2xvc2VXYXRjaGVyIixbXSk7dC5vbkN1cnJlbnRSdW4oImNoYW5nZSIsZSksdC5vbkN1cnJlbnRSdW4oImNsb3NlIixzKTt9dGhpcy5wbHVnaW5Ecml2ZXI9bmV3IEF1KHRoaXMsZSxlLnBsdWdpbnMsdGhpcy5wbHVnaW5DYWNoZSksdGhpcy5hY29yblBhcnNlcj1PYy5leHRlbmQoLi4uZS5hY29ybkluamVjdFBsdWdpbnMpLHRoaXMubW9kdWxlTG9hZGVyPW5ldyBvdSh0aGlzLHRoaXMubW9kdWxlc0J5SWQsdGhpcy5vcHRpb25zLHRoaXMucGx1Z2luRHJpdmVyKSx0aGlzLmZpbGVPcGVyYXRpb25RdWV1ZT1uZXcgQ3UoZS5tYXhQYXJhbGxlbEZpbGVPcHMpLHRoaXMucHVyZUZ1bmN0aW9ucz0oKHt0cmVlc2hha2U6ZX0pPT57Y29uc3QgdD1PYmplY3QuY3JlYXRlKG51bGwpO2Zvcihjb25zdCBzIG9mIGU/ZS5tYW51YWxQdXJlRnVuY3Rpb25zOltdKXtsZXQgZT10O2Zvcihjb25zdCB0IG9mIHMuc3BsaXQoIi4iKSllPWVbdF18fChlW3RdPU9iamVjdC5jcmVhdGUobnVsbCkpO2VbRmldPSEwO31yZXR1cm4gdH0pKGUpO31hc3luYyBidWlsZCgpe19vKCJnZW5lcmF0ZSBtb2R1bGUgZ3JhcGgiLDIpLGF3YWl0IHRoaXMuZ2VuZXJhdGVNb2R1bGVHcmFwaCgpLFJvKCJnZW5lcmF0ZSBtb2R1bGUgZ3JhcGgiLDIpLF9vKCJzb3J0IGFuZCBiaW5kIG1vZHVsZXMiLDIpLHRoaXMucGhhc2U9eW8uQU5BTFlTRSx0aGlzLnNvcnRNb2R1bGVzKCksUm8oInNvcnQgYW5kIGJpbmQgbW9kdWxlcyIsMiksX28oIm1hcmsgaW5jbHVkZWQgc3RhdGVtZW50cyIsMiksdGhpcy5pbmNsdWRlU3RhdGVtZW50cygpLFJvKCJtYXJrIGluY2x1ZGVkIHN0YXRlbWVudHMiLDIpLHRoaXMucGhhc2U9eW8uR0VORVJBVEU7fWNvbnRleHRQYXJzZShlLHQ9e30pe2NvbnN0IHM9dC5vbkNvbW1lbnQsaT1bXTt0Lm9uQ29tbWVudD1zJiYiZnVuY3Rpb24iPT10eXBlb2Ygcz8oZSxuLHIsbywuLi5hKT0+KGkucHVzaCh7ZW5kOm8sc3RhcnQ6cix0eXBlOmU/IkJsb2NrIjoiTGluZSIsdmFsdWU6bn0pLHMuY2FsbCh0LGUsbixyLG8sLi4uYSkpOmk7Y29uc3Qgbj10aGlzLmFjb3JuUGFyc2VyLnBhcnNlKGUsey4uLnRoaXMub3B0aW9ucy5hY29ybiwuLi50fSk7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgcyYmcy5wdXNoKC4uLmkpLHQub25Db21tZW50PXMsZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9W10sbj1bXTtmb3IoY29uc3QgdCBvZiBlKXtmb3IoY29uc3RbZSxzXW9mIFlzKXMudGVzdCh0LnZhbHVlKSYmaS5wdXNoKHsuLi50LGFubm90YXRpb25UeXBlOmV9KTtGcy50ZXN0KHQudmFsdWUpJiZuLnB1c2godCk7fWZvcihjb25zdCBlIG9mIG4pWHModCxlLCExKTtHcyh0LHthbm5vdGF0aW9uSW5kZXg6MCxhbm5vdGF0aW9uczppLGNvZGU6c30pO30oaSxuLGUpLG59Z2V0Q2FjaGUoKXtmb3IoY29uc3QgZSBpbiB0aGlzLnBsdWdpbkNhY2hlKXtjb25zdCB0PXRoaXMucGx1Z2luQ2FjaGVbZV07bGV0IHM9ITA7Zm9yKGNvbnN0W2UsaV1vZiBPYmplY3QuZW50cmllcyh0KSlpWzBdPj10aGlzLm9wdGlvbnMuZXhwZXJpbWVudGFsQ2FjaGVFeHBpcnk/ZGVsZXRlIHRbZV06cz0hMTtzJiZkZWxldGUgdGhpcy5wbHVnaW5DYWNoZVtlXTt9cmV0dXJuIHttb2R1bGVzOnRoaXMubW9kdWxlcy5tYXAoKGU9PmUudG9KU09OKCkpKSxwbHVnaW5zOnRoaXMucGx1Z2luQ2FjaGV9fWFzeW5jIGdlbmVyYXRlTW9kdWxlR3JhcGgoKXt2YXIgZTtpZigoe2VudHJ5TW9kdWxlczp0aGlzLmVudHJ5TW9kdWxlcyxpbXBsaWNpdEVudHJ5TW9kdWxlczp0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzfT1hd2FpdCB0aGlzLm1vZHVsZUxvYWRlci5hZGRFbnRyeU1vZHVsZXMoKGU9dGhpcy5vcHRpb25zLmlucHV0LEFycmF5LmlzQXJyYXkoZSk/ZS5tYXAoKGU9Pih7ZmlsZU5hbWU6bnVsbCxpZDplLGltcGxpY2l0bHlMb2FkZWRBZnRlcjpbXSxpbXBvcnRlcjp2b2lkIDAsbmFtZTpudWxsfSkpKTpPYmplY3QuZW50cmllcyhlKS5tYXAoKChbZSx0XSk9Pih7ZmlsZU5hbWU6bnVsbCxpZDp0LGltcGxpY2l0bHlMb2FkZWRBZnRlcjpbXSxpbXBvcnRlcjp2b2lkIDAsbmFtZTplfSkpKSksITApKSwwPT09dGhpcy5lbnRyeU1vZHVsZXMubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiWW91IG11c3Qgc3VwcGx5IG9wdGlvbnMuaW5wdXQgdG8gcm9sbHVwIik7Zm9yKGNvbnN0IGUgb2YgdGhpcy5tb2R1bGVzQnlJZC52YWx1ZXMoKSllIGluc3RhbmNlb2YgQm8/dGhpcy5tb2R1bGVzLnB1c2goZSk6dGhpcy5leHRlcm5hbE1vZHVsZXMucHVzaChlKTt9aW5jbHVkZVN0YXRlbWVudHMoKXtjb25zdCBlPVsuLi50aGlzLmVudHJ5TW9kdWxlcywuLi50aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzXTtmb3IoY29uc3QgdCBvZiBlKURvKHQpO2lmKHRoaXMub3B0aW9ucy50cmVlc2hha2Upe2xldCB0PTE7ZG97X28oYHRyZWVzaGFraW5nIHBhc3MgJHt0fWAsMyksdGhpcy5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMTtmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZS5pc0V4ZWN1dGVkJiYoIm5vLXRyZWVzaGFrZSI9PT1lLmluZm8ubW9kdWxlU2lkZUVmZmVjdHM/ZS5pbmNsdWRlQWxsSW5CdW5kbGUoKTplLmluY2x1ZGUoKSk7aWYoMT09PXQpZm9yKGNvbnN0IHQgb2YgZSkhMSE9PXQucHJlc2VydmVTaWduYXR1cmUmJih0LmluY2x1ZGVBbGxFeHBvcnRzKCExKSx0aGlzLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwKTtSbygidHJlZXNoYWtpbmcgcGFzcyAiK3QrKywzKTt9d2hpbGUodGhpcy5uZWVkc1RyZWVzaGFraW5nUGFzcyl9ZWxzZSBmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZS5pbmNsdWRlQWxsSW5CdW5kbGUoKTtmb3IoY29uc3QgZSBvZiB0aGlzLmV4dGVybmFsTW9kdWxlcyllLndhcm5VbnVzZWRJbXBvcnRzKCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcylmb3IoY29uc3QgdCBvZiBlLmltcGxpY2l0bHlMb2FkZWRBZnRlcil0LmluZm8uaXNFbnRyeXx8dC5pc0luY2x1ZGVkKCl8fFhlKFV0KHQpKTt9c29ydE1vZHVsZXMoKXtjb25zdHtvcmRlcmVkTW9kdWxlczplLGN5Y2xlUGF0aHM6dH09ZnVuY3Rpb24oZSl7bGV0IHQ9MDtjb25zdCBzPVtdLGk9bmV3IFNldCxuPW5ldyBTZXQscj1uZXcgTWFwLG89W10sYT1lPT57aWYoZSBpbnN0YW5jZW9mIEJvKXtmb3IoY29uc3QgdCBvZiBlLmRlcGVuZGVuY2llcylyLmhhcyh0KT9pLmhhcyh0KXx8cy5wdXNoKFhhKHQsZSxyKSk6KHIuc2V0KHQsZSksYSh0KSk7Zm9yKGNvbnN0IHQgb2YgZS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlKW4uYWRkKHQpO2Zvcihjb25zdHtyZXNvbHV0aW9uOnR9b2YgZS5keW5hbWljSW1wb3J0cyl0IGluc3RhbmNlb2YgQm8mJm4uYWRkKHQpO28ucHVzaChlKTt9ZS5leGVjSW5kZXg9dCsrLGkuYWRkKGUpO307Zm9yKGNvbnN0IHQgb2YgZSlyLmhhcyh0KXx8KHIuc2V0KHQsbnVsbCksYSh0KSk7Zm9yKGNvbnN0IGUgb2YgbilyLmhhcyhlKXx8KHIuc2V0KGUsbnVsbCksYShlKSk7cmV0dXJuIHtjeWNsZVBhdGhzOnMsb3JkZXJlZE1vZHVsZXM6b319KHRoaXMuZW50cnlNb2R1bGVzKTtmb3IoY29uc3QgZSBvZiB0KXRoaXMub3B0aW9ucy5vbkxvZyhTZSxEdChlKSk7dGhpcy5tb2R1bGVzPWU7Zm9yKGNvbnN0IGUgb2YgdGhpcy5tb2R1bGVzKWUuYmluZFJlZmVyZW5jZXMoKTt0aGlzLndhcm5Gb3JNaXNzaW5nRXhwb3J0cygpO313YXJuRm9yTWlzc2luZ0V4cG9ydHMoKXtmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZm9yKGNvbnN0IHQgb2YgZS5pbXBvcnREZXNjcmlwdGlvbnMudmFsdWVzKCkpIioiPT09dC5uYW1lfHx0Lm1vZHVsZS5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUodC5uYW1lKVswXXx8ZS5sb2coU2UsanQodC5uYW1lLGUuaWQsdC5tb2R1bGUuaWQpLHQuc3RhcnQpO319ZnVuY3Rpb24gTnUoZSx0KXtyZXR1cm4gdCgpfWZ1bmN0aW9uIF91KHQscyxpLG4pe3Q9a3UoIm9uTG9nIix0KTtjb25zdCByPUllW25dLG89KG4sYSxsPXllKT0+e2lmKCEoSWVbbl08cikpe2Zvcihjb25zdCBzIG9mIHQpe2lmKGwuaGFzKHMpKWNvbnRpbnVlO2NvbnN0e29uTG9nOnR9PXMsYz1lPT5JZVtlXTxyP2ppOnQ9Pm8oZSxYaCh0KSxuZXcgU2V0KGwpLmFkZChzKSk7aWYoITE9PT0oImhhbmRsZXIiaW4gdD90LmhhbmRsZXI6dCkuY2FsbCh7ZGVidWc6YyhrZSksZXJyb3I6ZT0+WGUoWGgoZSkpLGluZm86YyhBZSksbWV0YTp7cm9sbHVwVmVyc2lvbjplLHdhdGNoTW9kZTppfSx3YXJuOmMoU2UpfSxuLGEpKXJldHVybn1zKG4sYSk7fX07cmV0dXJuIG99Y29uc3QgUnU9InsiLmNoYXJDb2RlQXQoMCksTXU9IiAiLmNoYXJDb2RlQXQoMCksT3U9ImFzc2VydCI7ZnVuY3Rpb24gRHUoZSl7Y29uc3QgdD1lLmFjb3JufHxUaCx7dG9rVHlwZXM6cyxUb2tlblR5cGU6aX09dDtyZXR1cm4gY2xhc3MgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKC4uLmUpe3N1cGVyKC4uLmUpLHRoaXMuYXNzZXJ0VG9rZW49bmV3IGkoT3UpO31fY29kZUF0KGUpe3JldHVybiB0aGlzLmlucHV0LmNoYXJDb2RlQXQoZSl9X2VhdChlKXt0aGlzLnR5cGUhPT1lJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLm5leHQoKTt9cmVhZFRva2VuKGUpe2xldCB0PTA7Zm9yKDt0PDY7dCsrKWlmKHRoaXMuX2NvZGVBdCh0aGlzLnBvcyt0KSE9PU91LmNoYXJDb2RlQXQodCkpcmV0dXJuIHN1cGVyLnJlYWRUb2tlbihlKTtmb3IoO3RoaXMuX2NvZGVBdCh0aGlzLnBvcyt0KSE9PVJ1O3QrKylpZih0aGlzLl9jb2RlQXQodGhpcy5wb3MrdCkhPT1NdSlyZXR1cm4gc3VwZXIucmVhZFRva2VuKGUpO3JldHVybiAieyI9PT10aGlzLnR5cGUubGFiZWw/c3VwZXIucmVhZFRva2VuKGUpOih0aGlzLnBvcys9Nix0aGlzLmZpbmlzaFRva2VuKHRoaXMuYXNzZXJ0VG9rZW4pKX1wYXJzZUR5bmFtaWNJbXBvcnQoZSl7aWYodGhpcy5uZXh0KCksZS5zb3VyY2U9dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5lYXQocy5jb21tYSkpe2NvbnN0IHQ9dGhpcy5wYXJzZU9iaighMSk7ZS5hcmd1bWVudHM9W3RdO31yZXR1cm4gdGhpcy5fZWF0KHMucGFyZW5SKSx0aGlzLmZpbmlzaE5vZGUoZSwiSW1wb3J0RXhwcmVzc2lvbiIpfXBhcnNlRXhwb3J0KGUsdCl7aWYodGhpcy5uZXh0KCksdGhpcy5lYXQocy5zdGFyKSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSYmKHRoaXMuZWF0Q29udGV4dHVhbCgiYXMiKT8oZS5leHBvcnRlZD10aGlzLnBhcnNlSWRlbnQoITApLHRoaXMuY2hlY2tFeHBvcnQodCxlLmV4cG9ydGVkLm5hbWUsdGhpcy5sYXN0VG9rU3RhcnQpKTplLmV4cG9ydGVkPW51bGwpLHRoaXMuZXhwZWN0Q29udGV4dHVhbCgiZnJvbSIpLHRoaXMudHlwZSE9PXMuc3RyaW5nJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLnNvdXJjZT10aGlzLnBhcnNlRXhwckF0b20oKSx0aGlzLnR5cGU9PT10aGlzLmFzc2VydFRva2VufHx0aGlzLnR5cGU9PT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkV4cG9ydEFsbERlY2xhcmF0aW9uIil9aWYodGhpcy5lYXQocy5fZGVmYXVsdCkpe3ZhciBpO2lmKHRoaXMuY2hlY2tFeHBvcnQodCwiZGVmYXVsdCIsdGhpcy5sYXN0VG9rU3RhcnQpLHRoaXMudHlwZT09PXMuX2Z1bmN0aW9ufHwoaT10aGlzLmlzQXN5bmNGdW5jdGlvbigpKSl7dmFyIG49dGhpcy5zdGFydE5vZGUoKTt0aGlzLm5leHQoKSxpJiZ0aGlzLm5leHQoKSxlLmRlY2xhcmF0aW9uPXRoaXMucGFyc2VGdW5jdGlvbihuLDUsITEsaSk7fWVsc2UgaWYodGhpcy50eXBlPT09cy5fY2xhc3Mpe3ZhciByPXRoaXMuc3RhcnROb2RlKCk7ZS5kZWNsYXJhdGlvbj10aGlzLnBhcnNlQ2xhc3MociwibnVsbGFibGVJRCIpO31lbHNlIGUuZGVjbGFyYXRpb249dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5zZW1pY29sb24oKTtyZXR1cm4gdGhpcy5maW5pc2hOb2RlKGUsIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIpfWlmKHRoaXMuc2hvdWxkUGFyc2VFeHBvcnRTdGF0ZW1lbnQoKSllLmRlY2xhcmF0aW9uPXRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCksIlZhcmlhYmxlRGVjbGFyYXRpb24iPT09ZS5kZWNsYXJhdGlvbi50eXBlP3RoaXMuY2hlY2tWYXJpYWJsZUV4cG9ydCh0LGUuZGVjbGFyYXRpb24uZGVjbGFyYXRpb25zKTp0aGlzLmNoZWNrRXhwb3J0KHQsZS5kZWNsYXJhdGlvbi5pZC5uYW1lLGUuZGVjbGFyYXRpb24uaWQuc3RhcnQpLGUuc3BlY2lmaWVycz1bXSxlLnNvdXJjZT1udWxsO2Vsc2Uge2lmKGUuZGVjbGFyYXRpb249bnVsbCxlLnNwZWNpZmllcnM9dGhpcy5wYXJzZUV4cG9ydFNwZWNpZmllcnModCksdGhpcy5lYXRDb250ZXh0dWFsKCJmcm9tIikpe2lmKHRoaXMudHlwZSE9PXMuc3RyaW5nJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLnNvdXJjZT10aGlzLnBhcnNlRXhwckF0b20oKSx0aGlzLnR5cGU9PT10aGlzLmFzc2VydFRva2VufHx0aGlzLnR5cGU9PT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9fWVsc2Uge2Zvcih2YXIgbz0wLGE9ZS5zcGVjaWZpZXJzO288YS5sZW5ndGg7bys9MSl7dmFyIGw9YVtvXTt0aGlzLmNoZWNrVW5yZXNlcnZlZChsLmxvY2FsKSx0aGlzLmNoZWNrTG9jYWxFeHBvcnQobC5sb2NhbCk7fWUuc291cmNlPW51bGw7fXRoaXMuc2VtaWNvbG9uKCk7fXJldHVybiB0aGlzLmZpbmlzaE5vZGUoZSwiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIpfXBhcnNlSW1wb3J0KGUpe2lmKHRoaXMubmV4dCgpLHRoaXMudHlwZT09PXMuc3RyaW5nPyhlLnNwZWNpZmllcnM9W10sZS5zb3VyY2U9dGhpcy5wYXJzZUV4cHJBdG9tKCkpOihlLnNwZWNpZmllcnM9dGhpcy5wYXJzZUltcG9ydFNwZWNpZmllcnMoKSx0aGlzLmV4cGVjdENvbnRleHR1YWwoImZyb20iKSxlLnNvdXJjZT10aGlzLnR5cGU9PT1zLnN0cmluZz90aGlzLnBhcnNlRXhwckF0b20oKTp0aGlzLnVuZXhwZWN0ZWQoKSksdGhpcy50eXBlPT09dGhpcy5hc3NlcnRUb2tlbnx8dGhpcy50eXBlPT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydERlY2xhcmF0aW9uIil9cGFyc2VJbXBvcnRBc3NlcnRpb25zKCl7dGhpcy5fZWF0KHMuYnJhY2VMKTtjb25zdCBlPXRoaXMucGFyc2VBc3NlcnRFbnRyaWVzKCk7cmV0dXJuIHRoaXMuX2VhdChzLmJyYWNlUiksZX1wYXJzZUFzc2VydEVudHJpZXMoKXtjb25zdCBlPVtdLHQ9bmV3IFNldDtkb3tpZih0aGlzLnR5cGU9PT1zLmJyYWNlUilicmVhaztjb25zdCBpPXRoaXMuc3RhcnROb2RlKCk7bGV0IG47bj10aGlzLnR5cGU9PT1zLnN0cmluZz90aGlzLnBhcnNlTGl0ZXJhbCh0aGlzLnZhbHVlKTp0aGlzLnBhcnNlSWRlbnQoITApLHRoaXMubmV4dCgpLGkua2V5PW4sdC5oYXMoaS5rZXkubmFtZSkmJnRoaXMucmFpc2UodGhpcy5wb3MsIkR1cGxpY2F0ZWQga2V5IGluIGFzc2VydGlvbnMiKSx0LmFkZChpLmtleS5uYW1lKSx0aGlzLnR5cGUhPT1zLnN0cmluZyYmdGhpcy5yYWlzZSh0aGlzLnBvcywiT25seSBzdHJpbmcgaXMgc3VwcG9ydGVkIGFzIGFuIGFzc2VydGlvbiB2YWx1ZSIpLGkudmFsdWU9dGhpcy5wYXJzZUxpdGVyYWwodGhpcy52YWx1ZSksZS5wdXNoKHRoaXMuZmluaXNoTm9kZShpLCJJbXBvcnRBdHRyaWJ1dGUiKSk7fXdoaWxlKHRoaXMuZWF0KHMuY29tbWEpKTtyZXR1cm4gZX19fWZ1bmN0aW9uIEx1KGUpe3JldHVybiBBcnJheS5pc0FycmF5KGUpP2UuZmlsdGVyKEJvb2xlYW4pOmU/W2VdOltdfWNvbnN0IFR1PWU9Pih7ZWNtYVZlcnNpb246ImxhdGVzdCIsc291cmNlVHlwZToibW9kdWxlIiwuLi5lLmFjb3JufSksVnU9ZT0+W0R1LC4uLkx1KGUuYWNvcm5JbmplY3RQbHVnaW5zKV0sQnU9ZT0+ITA9PT1lLmNhY2hlP3ZvaWQgMDplLmNhY2hlPy5jYWNoZXx8ZS5jYWNoZSx6dT1lPT57aWYoITA9PT1lKXJldHVybiAoKT0+ITA7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUpcmV0dXJuICh0LC4uLnMpPT4hdC5zdGFydHNXaXRoKCJcMCIpJiZlKHQsLi4ucyl8fCExO2lmKGUpe2NvbnN0IHQ9bmV3IFNldCxzPVtdO2Zvcihjb25zdCBpIG9mIEx1KGUpKWkgaW5zdGFuY2VvZiBSZWdFeHA/cy5wdXNoKGkpOnQuYWRkKGkpO3JldHVybiAoZSwuLi5pKT0+dC5oYXMoZSl8fHMuc29tZSgodD0+dC50ZXN0KGUpKSl9cmV0dXJuICgpPT4hMX0sRnU9KGUsdCxzKT0+e2NvbnN0IGk9ZS5pbmxpbmVEeW5hbWljSW1wb3J0cztyZXR1cm4gaSYmUXQoJ1RoZSAiaW5saW5lRHluYW1pY0ltcG9ydHMiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiIG9wdGlvbiBpbnN0ZWFkLicsR2UsITAsdCxzKSxpfSxqdT1lPT57Y29uc3QgdD1lLmlucHV0O3JldHVybiBudWxsPT10P1tdOiJzdHJpbmciPT10eXBlb2YgdD9bdF06dH0sVXU9KGUsdCxzKT0+e2NvbnN0IGk9ZS5tYW51YWxDaHVua3M7cmV0dXJuIGkmJlF0KCdUaGUgIm1hbnVhbENodW5rcyIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgIm91dHB1dC5tYW51YWxDaHVua3MiIG9wdGlvbiBpbnN0ZWFkLicscWUsITAsdCxzKSxpfSxHdT0oZSx0LHMpPT57Y29uc3QgaT1lLm1heFBhcmFsbGVsRmlsZVJlYWRzOyJudW1iZXIiPT10eXBlb2YgaSYmUXQoJ1RoZSAibWF4UGFyYWxsZWxGaWxlUmVhZHMiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJtYXhQYXJhbGxlbEZpbGVPcHMiIG9wdGlvbiBpbnN0ZWFkLicsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jbWF4cGFyYWxsZWxmaWxlb3BzIiwhMCx0LHMpO2NvbnN0IG49ZS5tYXhQYXJhbGxlbEZpbGVPcHM/P2k7cmV0dXJuICJudW1iZXIiPT10eXBlb2Ygbj9uPD0wPzEvMDpuOjIwfSxXdT0oZSx0KT0+e2NvbnN0IHM9ZS5tb2R1bGVDb250ZXh0O2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBzKXJldHVybiBlPT5zKGUpPz90O2lmKHMpe2NvbnN0IGU9T2JqZWN0LmNyZWF0ZShudWxsKTtmb3IoY29uc3RbdCxpXW9mIE9iamVjdC5lbnRyaWVzKHMpKWVbXyh0KV09aTtyZXR1cm4gcz0+ZVtzXT8/dH1yZXR1cm4gKCk9PnR9LHF1PShlLHQscyk9Pntjb25zdCBpPWUucHJlc2VydmVNb2R1bGVzO3JldHVybiBpJiZRdCgnVGhlICJwcmVzZXJ2ZU1vZHVsZXMiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJvdXRwdXQucHJlc2VydmVNb2R1bGVzIiBvcHRpb24gaW5zdGVhZC4nLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1wcmVzZXJ2ZW1vZHVsZXMiLCEwLHQscyksaX0sSHU9ZT0+e2lmKCExPT09ZS50cmVlc2hha2UpcmV0dXJuICExO2NvbnN0IHQ9c3UoZS50cmVlc2hha2UsZXUsInRyZWVzaGFrZSIsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jdHJlZXNoYWtlIiwiZmFsc2UsIHRydWUsICIpO3JldHVybiB7YW5ub3RhdGlvbnM6ITEhPT10LmFubm90YXRpb25zLGNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uOiEwPT09dC5jb3JyZWN0VmFyVmFsdWVCZWZvcmVEZWNsYXJhdGlvbixtYW51YWxQdXJlRnVuY3Rpb25zOnQubWFudWFsUHVyZUZ1bmN0aW9ucz8/Z2UsbW9kdWxlU2lkZUVmZmVjdHM6S3UodC5tb2R1bGVTaWRlRWZmZWN0cykscHJvcGVydHlSZWFkU2lkZUVmZmVjdHM6ImFsd2F5cyI9PT10LnByb3BlcnR5UmVhZFNpZGVFZmZlY3RzPyJhbHdheXMiOiExIT09dC5wcm9wZXJ0eVJlYWRTaWRlRWZmZWN0cyx0cnlDYXRjaERlb3B0aW1pemF0aW9uOiExIT09dC50cnlDYXRjaERlb3B0aW1pemF0aW9uLHVua25vd25HbG9iYWxTaWRlRWZmZWN0czohMSE9PXQudW5rbm93bkdsb2JhbFNpZGVFZmZlY3RzfX0sS3U9ZT0+e2lmKCJib29sZWFuIj09dHlwZW9mIGUpcmV0dXJuICgpPT5lO2lmKCJuby1leHRlcm5hbCI9PT1lKXJldHVybiAoZSx0KT0+IXQ7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUpcmV0dXJuICh0LHMpPT4hIXQuc3RhcnRzV2l0aCgiXDAiKXx8ITEhPT1lKHQscyk7aWYoQXJyYXkuaXNBcnJheShlKSl7Y29uc3QgdD1uZXcgU2V0KGUpO3JldHVybiBlPT50LmhhcyhlKX1yZXR1cm4gZSYmWGUoRnQoInRyZWVzaGFrZS5tb2R1bGVTaWRlRWZmZWN0cyIsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jdHJlZXNoYWtlLW1vZHVsZXNpZGVlZmZlY3RzIiwncGxlYXNlIHVzZSBvbmUgb2YgZmFsc2UsICJuby1leHRlcm5hbCIsIGEgZnVuY3Rpb24gb3IgYW4gYXJyYXknKSksKCk9PiEwfSxZdT0vW1x1MDAwMC1cdTAwMUYiIyQmKissOjs8PT4/W1xdXmB7fH1cdTAwN0ZdL2csWHU9L15bYS16XTovaTtmdW5jdGlvbiBRdShlKXtjb25zdCB0PVh1LmV4ZWMoZSkscz10P3RbMF06IiI7cmV0dXJuIHMrZS5zbGljZShzLmxlbmd0aCkucmVwbGFjZShZdSwiXyIpfWNvbnN0IFp1PShlLHQscyk9Pntjb25zdHtmaWxlOml9PWU7aWYoInN0cmluZyI9PXR5cGVvZiBpKXtpZih0KXJldHVybiBYZShGdCgib3V0cHV0LmZpbGUiLFZlLCd5b3UgbXVzdCBzZXQgIm91dHB1dC5kaXIiIGluc3RlYWQgb2YgIm91dHB1dC5maWxlIiB3aGVuIHVzaW5nIHRoZSAib3V0cHV0LnByZXNlcnZlTW9kdWxlcyIgb3B0aW9uJykpO2lmKCFBcnJheS5pc0FycmF5KHMuaW5wdXQpKXJldHVybiBYZShGdCgib3V0cHV0LmZpbGUiLFZlLCd5b3UgbXVzdCBzZXQgIm91dHB1dC5kaXIiIGluc3RlYWQgb2YgIm91dHB1dC5maWxlIiB3aGVuIHByb3ZpZGluZyBuYW1lZCBpbnB1dHMnKSl9cmV0dXJuIGl9LEp1PWU9Pntjb25zdCB0PWUuZm9ybWF0O3N3aXRjaCh0KXtjYXNlIHZvaWQgMDpjYXNlImVzIjpjYXNlImVzbSI6Y2FzZSJtb2R1bGUiOnJldHVybiAiZXMiO2Nhc2UiY2pzIjpjYXNlImNvbW1vbmpzIjpyZXR1cm4gImNqcyI7Y2FzZSJzeXN0ZW0iOmNhc2Uic3lzdGVtanMiOnJldHVybiAic3lzdGVtIjtjYXNlImFtZCI6Y2FzZSJpaWZlIjpjYXNlInVtZCI6cmV0dXJuIHQ7ZGVmYXVsdDpyZXR1cm4gWGUoRnQoIm91dHB1dC5mb3JtYXQiLEZlLCdWYWxpZCB2YWx1ZXMgYXJlICJhbWQiLCAiY2pzIiwgInN5c3RlbSIsICJlcyIsICJpaWZlIiBvciAidW1kIicsdCkpfX0sZWQ9KGUsdCk9Pntjb25zdCBzPShlLmlubGluZUR5bmFtaWNJbXBvcnRzPz90LmlubGluZUR5bmFtaWNJbXBvcnRzKXx8ITEse2lucHV0Oml9PXQ7cmV0dXJuIHMmJihBcnJheS5pc0FycmF5KGkpP2k6T2JqZWN0LmtleXMoaSkpLmxlbmd0aD4xP1hlKEZ0KCJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiLEdlLCdtdWx0aXBsZSBpbnB1dHMgYXJlIG5vdCBzdXBwb3J0ZWQgd2hlbiAib3V0cHV0LmlubGluZUR5bmFtaWNJbXBvcnRzIiBpcyB0cnVlJykpOnN9LHRkPShlLHQscyk9Pntjb25zdCBpPShlLnByZXNlcnZlTW9kdWxlcz8/cy5wcmVzZXJ2ZU1vZHVsZXMpfHwhMTtpZihpKXtpZih0KXJldHVybiBYZShGdCgib3V0cHV0LmlubGluZUR5bmFtaWNJbXBvcnRzIixHZSwndGhpcyBvcHRpb24gaXMgbm90IHN1cHBvcnRlZCBmb3IgIm91dHB1dC5wcmVzZXJ2ZU1vZHVsZXMiJykpO2lmKCExPT09cy5wcmVzZXJ2ZUVudHJ5U2lnbmF0dXJlcylyZXR1cm4gWGUoRnQoInByZXNlcnZlRW50cnlTaWduYXR1cmVzIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyNwcmVzZXJ2ZWVudHJ5c2lnbmF0dXJlcyIsJ3NldHRpbmcgdGhpcyBvcHRpb24gdG8gZmFsc2UgaXMgbm90IHN1cHBvcnRlZCBmb3IgIm91dHB1dC5wcmVzZXJ2ZU1vZHVsZXMiJykpfXJldHVybiBpfSxzZD0oZSx0KT0+e2NvbnN0IHM9ZS5wcmVmZXJDb25zdDtyZXR1cm4gbnVsbCE9cyYmWHQoJ1RoZSAib3V0cHV0LnByZWZlckNvbnN0IiBvcHRpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSAib3V0cHV0LmdlbmVyYXRlZENvZGUuY29uc3RCaW5kaW5ncyIgb3B0aW9uIGluc3RlYWQuJywiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZ2VuZXJhdGVkY29kZS1jb25zdGJpbmRpbmdzIiwhMCx0KSwhIXN9LGlkPWU9Pntjb25zdHtwcmVzZXJ2ZU1vZHVsZXNSb290OnR9PWU7aWYobnVsbCE9dClyZXR1cm4gXyh0KX0sbmQ9ZT0+e2NvbnN0IHQ9e2F1dG9JZDohMSxiYXNlUGF0aDoiIixkZWZpbmU6ImRlZmluZSIsZm9yY2VKc0V4dGVuc2lvbkZvckltcG9ydHM6ITEsLi4uZS5hbWR9O3JldHVybiAodC5hdXRvSWR8fHQuYmFzZVBhdGgpJiZ0LmlkP1hlKEZ0KCJvdXRwdXQuYW1kLmlkIixUZSwndGhpcyBvcHRpb24gY2Fubm90IGJlIHVzZWQgdG9nZXRoZXIgd2l0aCAib3V0cHV0LmFtZC5hdXRvSWQiLyJvdXRwdXQuYW1kLmJhc2VQYXRoIicpKTp0LmJhc2VQYXRoJiYhdC5hdXRvSWQ/WGUoRnQoIm91dHB1dC5hbWQuYmFzZVBhdGgiLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1hbWQtYmFzZXBhdGgiLCd0aGlzIG9wdGlvbiBvbmx5IHdvcmtzIHdpdGggIm91dHB1dC5hbWQuYXV0b0lkIicpKTp0LmF1dG9JZD97YXV0b0lkOiEwLGJhc2VQYXRoOnQuYmFzZVBhdGgsZGVmaW5lOnQuZGVmaW5lLGZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzOnQuZm9yY2VKc0V4dGVuc2lvbkZvckltcG9ydHN9OnthdXRvSWQ6ITEsZGVmaW5lOnQuZGVmaW5lLGZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzOnQuZm9yY2VKc0V4dGVuc2lvbkZvckltcG9ydHMsaWQ6dC5pZH19LHJkPShlLHQpPT57Y29uc3Qgcz1lW3RdO3JldHVybiAiZnVuY3Rpb24iPT10eXBlb2Ygcz9zOigpPT5zfHwiIn0sb2Q9KGUsdCk9Pntjb25zdHtkaXI6c309ZTtyZXR1cm4gInN0cmluZyI9PXR5cGVvZiBzJiYic3RyaW5nIj09dHlwZW9mIHQ/WGUoRnQoIm91dHB1dC5kaXIiLFZlLCd5b3UgbXVzdCBzZXQgZWl0aGVyICJvdXRwdXQuZmlsZSIgZm9yIGEgc2luZ2xlLWZpbGUgYnVpbGQgb3IgIm91dHB1dC5kaXIiIHdoZW4gZ2VuZXJhdGluZyBtdWx0aXBsZSBjaHVua3MnKSk6c30sYWQ9KGUsdCxzKT0+e2NvbnN0IGk9ZS5keW5hbWljSW1wb3J0RnVuY3Rpb247cmV0dXJuIGkmJihYdCgnVGhlICJvdXRwdXQuZHluYW1pY0ltcG9ydEZ1bmN0aW9uIiBvcHRpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSAicmVuZGVyRHluYW1pY0ltcG9ydCIgcGx1Z2luIGhvb2sgaW5zdGVhZC4nLCJwbHVnaW4tZGV2ZWxvcG1lbnQvI3JlbmRlcmR5bmFtaWNpbXBvcnQiLCEwLHQpLCJlcyIhPT1zJiZ0Lm9uTG9nKFNlLEZ0KCJvdXRwdXQuZHluYW1pY0ltcG9ydEZ1bmN0aW9uIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZHluYW1pY2ltcG9ydGZ1bmN0aW9uIiwndGhpcyBvcHRpb24gaXMgaWdub3JlZCBmb3IgZm9ybWF0cyBvdGhlciB0aGFuICJlcyInKSkpLGl9LGxkPShlLHQpPT57Y29uc3Qgcz1lLmVudHJ5RmlsZU5hbWVzO3JldHVybiBudWxsPT1zJiZ0LmFkZCgiZW50cnlGaWxlTmFtZXMiKSxzPz8iW25hbWVdLmpzIn07ZnVuY3Rpb24gY2QoZSx0KXtjb25zdCBzPWUuZXhwZXJpbWVudGFsRGVlcER5bmFtaWNDaHVua09wdGltaXphdGlvbjtyZXR1cm4gbnVsbCE9cyYmWHQoJ1RoZSAib3V0cHV0LmV4cGVyaW1lbnRhbERlZXBEeW5hbWljQ2h1bmtPcHRpbWl6YXRpb24iIG9wdGlvbiBpcyBkZXByZWNhdGVkIGFzIFJvbGx1cCBhbHdheXMgcnVucyB0aGUgZnVsbCBjaHVua2luZyBhbGdvcml0aG0gbm93LiBUaGUgb3B0aW9uIHNob3VsZCBiZSByZW1vdmVkLicsamUsITAsdCksc3x8ITF9ZnVuY3Rpb24gaGQoZSx0KXtjb25zdCBzPWUuZXhwb3J0cztpZihudWxsPT1zKXQuYWRkKCJleHBvcnRzIik7ZWxzZSBpZighWyJkZWZhdWx0IiwibmFtZWQiLCJub25lIiwiYXV0byJdLmluY2x1ZGVzKHMpKXJldHVybiBYZSh7Y29kZTpodCxtZXNzYWdlOmAib3V0cHV0LmV4cG9ydHMiIG11c3QgYmUgImRlZmF1bHQiLCAibmFtZWQiLCAibm9uZSIsICJhdXRvIiwgb3IgbGVmdCB1bnNwZWNpZmllZCAoZGVmYXVsdHMgdG8gImF1dG8iKSwgcmVjZWl2ZWQgIiR7c30iLmAsdXJsOk9lKEJlKX0pO3JldHVybiBzfHwiYXV0byJ9Y29uc3QgdWQ9KGUsdCk9Pntjb25zdCBzPXN1KGUuZ2VuZXJhdGVkQ29kZSx0dSwib3V0cHV0LmdlbmVyYXRlZENvZGUiLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1nZW5lcmF0ZWRjb2RlIiwiIik7cmV0dXJuIHthcnJvd0Z1bmN0aW9uczohMD09PXMuYXJyb3dGdW5jdGlvbnMsY29uc3RCaW5kaW5nczohMD09PXMuY29uc3RCaW5kaW5nc3x8dCxvYmplY3RTaG9ydGhhbmQ6ITA9PT1zLm9iamVjdFNob3J0aGFuZCxyZXNlcnZlZE5hbWVzQXNQcm9wczohMSE9PXMucmVzZXJ2ZWROYW1lc0FzUHJvcHMsc3ltYm9sczohMD09PXMuc3ltYm9sc319LGRkPShlLHQpPT57aWYodClyZXR1cm4gIiI7Y29uc3Qgcz1lLmluZGVudDtyZXR1cm4gITE9PT1zPyIiOnM/PyEwfSxwZD1uZXcgU2V0KFsiY29tcGF0IiwiYXV0byIsImVzTW9kdWxlIiwiZGVmYXVsdCIsImRlZmF1bHRPbmx5Il0pLGZkPWU9Pntjb25zdCB0PWUuaW50ZXJvcDtpZigiZnVuY3Rpb24iPT10eXBlb2YgdCl7Y29uc3QgZT1PYmplY3QuY3JlYXRlKG51bGwpO2xldCBzPW51bGw7cmV0dXJuIGk9Pm51bGw9PT1pP3N8fG1kKHM9dChpKSk6aSBpbiBlP2VbaV06bWQoZVtpXT10KGkpKX1yZXR1cm4gdm9pZCAwPT09dD8oKT0+ImRlZmF1bHQiOigpPT5tZCh0KX0sbWQ9ZT0+cGQuaGFzKGUpP2U6WGUoRnQoIm91dHB1dC5pbnRlcm9wIixXZSxgdXNlIG9uZSBvZiAke0FycmF5LmZyb20ocGQsKGU9PkpTT04uc3RyaW5naWZ5KGUpKSkuam9pbigiLCAiKX1gLGUpKSxnZD0oZSx0LHMsaSk9Pntjb25zdCBuPWUubWFudWFsQ2h1bmtzfHxpLm1hbnVhbENodW5rcztpZihuKXtpZih0KXJldHVybiBYZShGdCgib3V0cHV0Lm1hbnVhbENodW5rcyIscWUsJ3RoaXMgb3B0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgZm9yICJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiJykpO2lmKHMpcmV0dXJuIFhlKEZ0KCJvdXRwdXQubWFudWFsQ2h1bmtzIixxZSwndGhpcyBvcHRpb24gaXMgbm90IHN1cHBvcnRlZCBmb3IgIm91dHB1dC5wcmVzZXJ2ZU1vZHVsZXMiJykpfXJldHVybiBufHx7fX0seWQ9KGUsdCxzKT0+ZS5taW5pZnlJbnRlcm5hbEV4cG9ydHM/PyhzfHwiZXMiPT09dHx8InN5c3RlbSI9PT10KSx4ZD0oZSx0LHMpPT57Y29uc3QgaT1lLm5hbWVzcGFjZVRvU3RyaW5nVGFnO3JldHVybiBudWxsIT1pPyhYdCgnVGhlICJvdXRwdXQubmFtZXNwYWNlVG9TdHJpbmdUYWciIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJvdXRwdXQuZ2VuZXJhdGVkQ29kZS5zeW1ib2xzIiBvcHRpb24gaW5zdGVhZC4nLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1nZW5lcmF0ZWRjb2RlLXN5bWJvbHMiLCEwLHMpLGkpOnQuc3ltYm9sc3x8ITF9LEVkPShlLHQpPT57Y29uc3Qgcz1lLnNvdXJjZW1hcEZpbGVOYW1lcztyZXR1cm4gbnVsbD09cyYmdC5hZGQoInNvdXJjZW1hcEZpbGVOYW1lcyIpLHN9LGJkPWU9Pntjb25zdHtzb3VyY2VtYXBCYXNlVXJsOnR9PWU7aWYodClyZXR1cm4gZnVuY3Rpb24oZSl7dHJ5e25ldyBVUkwoZSk7fWNhdGNoe3JldHVybiAhMX1yZXR1cm4gITB9KHQpPyhzPXQpLmVuZHNXaXRoKCIvIik/czpzKyIvIjpYZShGdCgib3V0cHV0LnNvdXJjZW1hcEJhc2VVcmwiLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1zb3VyY2VtYXBiYXNldXJsIixgbXVzdCBiZSBhIHZhbGlkIFVSTCwgcmVjZWl2ZWQgJHtKU09OLnN0cmluZ2lmeSh0KX1gKSk7dmFyIHM7fTtmdW5jdGlvbiB2ZCh0KXtyZXR1cm4gYXN5bmMgZnVuY3Rpb24odCxzKXtjb25zdHtvcHRpb25zOmksdW5zZXRPcHRpb25zOm59PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKHQscyl7aWYoIXQpdGhyb3cgbmV3IEVycm9yKCJZb3UgbXVzdCBzdXBwbHkgYW4gb3B0aW9ucyBvYmplY3QgdG8gcm9sbHVwIik7Y29uc3QgaT1hd2FpdCBhc3luYyBmdW5jdGlvbih0LHMpe2NvbnN0IGk9a3UoIm9wdGlvbnMiLGF3YWl0IGl1KHQucGx1Z2lucykpLG49dC5sb2dMZXZlbHx8QWUscj1fdShpLEhoKHQsbikscyxuKTtmb3IoY29uc3QgbyBvZiBpKXtjb25zdHtuYW1lOmksb3B0aW9uczphfT1vLGw9ImhhbmRsZXIiaW4gYT9hLmhhbmRsZXI6YSxjPWF3YWl0IGwuY2FsbCh7ZGVidWc6YnUoa2UsIlBMVUdJTl9MT0ciLHIsaSxuKSxlcnJvcjplPT5YZShXdChYaChlKSxpLHtob29rOiJvbkxvZyJ9KSksaW5mbzpidShBZSwiUExVR0lOX0xPRyIscixpLG4pLG1ldGE6e3JvbGx1cFZlcnNpb246ZSx3YXRjaE1vZGU6c30sd2FybjpidShTZSwiUExVR0lOX1dBUk5JTkciLHIsaSxuKX0sdCk7YyYmKHQ9Yyk7fXJldHVybiB0fSh0LHMpLHtvcHRpb25zOm4sdW5zZXRPcHRpb25zOnJ9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgcz1uZXcgU2V0LGk9ZS5jb250ZXh0Pz8idW5kZWZpbmVkIixuPWF3YWl0IGl1KGUucGx1Z2lucykscj1lLmxvZ0xldmVsfHxBZSxvPV91KG4sSGgoZSxyKSx0LHIpLGE9ZS5zdHJpY3REZXByZWNhdGlvbnN8fCExLGw9R3UoZSxvLGEpLGM9e2Fjb3JuOlR1KGUpLGFjb3JuSW5qZWN0UGx1Z2luczpWdShlKSxjYWNoZTpCdShlKSxjb250ZXh0OmksZXhwZXJpbWVudGFsQ2FjaGVFeHBpcnk6ZS5leHBlcmltZW50YWxDYWNoZUV4cGlyeT8/MTAsZXhwZXJpbWVudGFsTG9nU2lkZUVmZmVjdHM6ZS5leHBlcmltZW50YWxMb2dTaWRlRWZmZWN0c3x8ITEsZXh0ZXJuYWw6enUoZS5leHRlcm5hbCksaW5saW5lRHluYW1pY0ltcG9ydHM6RnUoZSxvLGEpLGlucHV0Omp1KGUpLGxvZ0xldmVsOnIsbWFrZUFic29sdXRlRXh0ZXJuYWxzUmVsYXRpdmU6ZS5tYWtlQWJzb2x1dGVFeHRlcm5hbHNSZWxhdGl2ZT8/ImlmUmVsYXRpdmVTb3VyY2UiLG1hbnVhbENodW5rczpVdShlLG8sYSksbWF4UGFyYWxsZWxGaWxlT3BzOmwsbWF4UGFyYWxsZWxGaWxlUmVhZHM6bCxtb2R1bGVDb250ZXh0Old1KGUsaSksb25Mb2c6byxvbndhcm46ZT0+byhTZSxlKSxwZXJmOmUucGVyZnx8ITEscGx1Z2luczpuLHByZXNlcnZlRW50cnlTaWduYXR1cmVzOmUucHJlc2VydmVFbnRyeVNpZ25hdHVyZXM/PyJleHBvcnRzLW9ubHkiLHByZXNlcnZlTW9kdWxlczpxdShlLG8sYSkscHJlc2VydmVTeW1saW5rczplLnByZXNlcnZlU3ltbGlua3N8fCExLHNoaW1NaXNzaW5nRXhwb3J0czplLnNoaW1NaXNzaW5nRXhwb3J0c3x8ITEsc3RyaWN0RGVwcmVjYXRpb25zOmEsdHJlZXNoYWtlOkh1KGUpfTtyZXR1cm4gSmgoZSxbLi4uT2JqZWN0LmtleXMoYyksIndhdGNoIl0sImlucHV0IG9wdGlvbnMiLG8sL14ob3V0cHV0KSQvKSx7b3B0aW9uczpjLHVuc2V0T3B0aW9uczpzfX0oaSxzKTtyZXR1cm4gU2Qobi5wbHVnaW5zLFVoKSx7b3B0aW9uczpuLHVuc2V0T3B0aW9uczpyfX0odCxudWxsIT09cyk7IWZ1bmN0aW9uKGUpe2UucGVyZj8od289bmV3IE1hcCxfbz1DbyxSbz0kbyxlLnBsdWdpbnM9ZS5wbHVnaW5zLm1hcChPbykpOihfbz1qaSxSbz1qaSk7fShpKTtjb25zdCByPW5ldyAkdShpLHMpLG89ITEhPT10LmNhY2hlO3QuY2FjaGUmJihpLmNhY2hlPXZvaWQgMCx0LmNhY2hlPXZvaWQgMCk7X28oIkJVSUxEIiwxKSxhd2FpdCBOdShyLnBsdWdpbkRyaXZlciwoYXN5bmMoKT0+e3RyeXtfbygiaW5pdGlhbGl6ZSIsMiksYXdhaXQgci5wbHVnaW5Ecml2ZXIuaG9va1BhcmFsbGVsKCJidWlsZFN0YXJ0IixbaV0pLFJvKCJpbml0aWFsaXplIiwyKSxhd2FpdCByLmJ1aWxkKCk7fWNhdGNoKGUpe2NvbnN0IHQ9T2JqZWN0LmtleXMoci53YXRjaEZpbGVzKTt0aHJvdyB0Lmxlbmd0aD4wJiYoZS53YXRjaEZpbGVzPXQpLGF3YWl0IHIucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiYnVpbGRFbmQiLFtlXSksYXdhaXQgci5wbHVnaW5Ecml2ZXIuaG9va1BhcmFsbGVsKCJjbG9zZUJ1bmRsZSIsW10pLGV9YXdhaXQgci5wbHVnaW5Ecml2ZXIuaG9va1BhcmFsbGVsKCJidWlsZEVuZCIsW10pO30pKSxSbygiQlVJTEQiLDEpO2NvbnN0IGE9e2NhY2hlOm8/ci5nZXRDYWNoZSgpOnZvaWQgMCxhc3luYyBjbG9zZSgpe2EuY2xvc2VkfHwoYS5jbG9zZWQ9ITAsYXdhaXQgci5wbHVnaW5Ecml2ZXIuaG9va1BhcmFsbGVsKCJjbG9zZUJ1bmRsZSIsW10pKTt9LGNsb3NlZDohMSxnZW5lcmF0ZTphc3luYyBlPT5hLmNsb3NlZD9YZShSdCgpKTpBZCghMSxpLG4sZSxyKSx3YXRjaEZpbGVzOk9iamVjdC5rZXlzKHIud2F0Y2hGaWxlcyksd3JpdGU6YXN5bmMgZT0+YS5jbG9zZWQ/WGUoUnQoKSk6QWQoITAsaSxuLGUscil9O2kucGVyZiYmKGEuZ2V0VGltaW5ncz1Obyk7cmV0dXJuIGF9KHQsbnVsbCl9ZnVuY3Rpb24gU2QoZSx0KXtmb3IoY29uc3RbcyxpXW9mIGUuZW50cmllcygpKWkubmFtZXx8KGkubmFtZT1gJHt0fSR7cysxfWApO31hc3luYyBmdW5jdGlvbiBBZChlLHQscyxpLG4pe2NvbnN0e29wdGlvbnM6cixvdXRwdXRQbHVnaW5Ecml2ZXI6byx1bnNldE9wdGlvbnM6YX09YXdhaXQgYXN5bmMgZnVuY3Rpb24oZSx0LHMsaSl7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJZb3UgbXVzdCBzdXBwbHkgYW4gb3B0aW9ucyBvYmplY3QiKTtjb25zdCBuPWF3YWl0IGl1KGUucGx1Z2lucyk7U2QobixHaCk7Y29uc3Qgcj10LmNyZWF0ZU91dHB1dFBsdWdpbkRyaXZlcihuKTtyZXR1cm4gey4uLmF3YWl0IGtkKHMsaSxlLHIpLG91dHB1dFBsdWdpbkRyaXZlcjpyfX0oaSxuLnBsdWdpbkRyaXZlcix0LHMpO3JldHVybiBOdSgwLChhc3luYygpPT57Y29uc3Qgcz1uZXcgV2wocixhLHQsbyxuKSxpPWF3YWl0IHMuZ2VuZXJhdGUoZSk7aWYoZSl7aWYoX28oIldSSVRFIiwxKSwhci5kaXImJiFyLmZpbGUpcmV0dXJuIFhlKHtjb2RlOnZ0LG1lc3NhZ2U6J1lvdSBtdXN0IHNwZWNpZnkgIm91dHB1dC5maWxlIiBvciAib3V0cHV0LmRpciIgZm9yIHRoZSBidWlsZC4nLHVybDpPZShWZSl9KTthd2FpdCBQcm9taXNlLmFsbChPYmplY3QudmFsdWVzKGkpLm1hcCgoZT0+bi5maWxlT3BlcmF0aW9uUXVldWUucnVuKCgoKT0+YXN5bmMgZnVuY3Rpb24oZSx0KXtjb25zdCBzPV8odC5kaXJ8fEModC5maWxlKSxlLmZpbGVOYW1lKTtyZXR1cm4gYXdhaXQgQmgoQyhzKSx7cmVjdXJzaXZlOiEwfSksRmgocywiYXNzZXQiPT09ZS50eXBlP2Uuc291cmNlOmUuY29kZSl9KGUscikpKSkpKSxhd2FpdCBvLmhvb2tQYXJhbGxlbCgid3JpdGVCdW5kbGUiLFtyLGldKSxSbygiV1JJVEUiLDEpO31yZXR1cm4gbD1pLHtvdXRwdXQ6T2JqZWN0LnZhbHVlcyhsKS5maWx0ZXIoKGU9Pk9iamVjdC5rZXlzKGUpLmxlbmd0aD4wKSkuc29ydCgoKGUsdCk9PndkKGUpLXdkKHQpKSl9O3ZhciBsO30pKX1mdW5jdGlvbiBrZChlLHQscyxpKXtyZXR1cm4gYXN5bmMgZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9bmV3IFNldChzKSxuPWUuY29tcGFjdHx8ITEscj1KdShlKSxvPWVkKGUsdCksYT10ZChlLG8sdCksbD1adShlLGEsdCksYz1zZChlLHQpLGg9dWQoZSxjKSx1PXthbWQ6bmQoZSksYXNzZXRGaWxlTmFtZXM6ZS5hc3NldEZpbGVOYW1lcz8/ImFzc2V0cy9bbmFtZV0tW2hhc2hdW2V4dG5hbWVdIixiYW5uZXI6cmQoZSwiYmFubmVyIiksY2h1bmtGaWxlTmFtZXM6ZS5jaHVua0ZpbGVOYW1lcz8/IltuYW1lXS1baGFzaF0uanMiLGNvbXBhY3Q6bixkaXI6b2QoZSxsKSxkeW5hbWljSW1wb3J0RnVuY3Rpb246YWQoZSx0LHIpLGR5bmFtaWNJbXBvcnRJbkNqczplLmR5bmFtaWNJbXBvcnRJbkNqcz8/ITAsZW50cnlGaWxlTmFtZXM6bGQoZSxpKSxlc01vZHVsZTplLmVzTW9kdWxlPz8iaWYtZGVmYXVsdC1wcm9wIixleHBlcmltZW50YWxEZWVwRHluYW1pY0NodW5rT3B0aW1pemF0aW9uOmNkKGUsdCksZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplOmUuZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplPz8xLGV4cG9ydHM6aGQoZSxpKSxleHRlbmQ6ZS5leHRlbmR8fCExLGV4dGVybmFsSW1wb3J0QXNzZXJ0aW9uczplLmV4dGVybmFsSW1wb3J0QXNzZXJ0aW9ucz8/ITAsZXh0ZXJuYWxMaXZlQmluZGluZ3M6ZS5leHRlcm5hbExpdmVCaW5kaW5ncz8/ITAsZmlsZTpsLGZvb3RlcjpyZChlLCJmb290ZXIiKSxmb3JtYXQ6cixmcmVlemU6ZS5mcmVlemU/PyEwLGdlbmVyYXRlZENvZGU6aCxnbG9iYWxzOmUuZ2xvYmFsc3x8e30saG9pc3RUcmFuc2l0aXZlSW1wb3J0czplLmhvaXN0VHJhbnNpdGl2ZUltcG9ydHM/PyEwLGluZGVudDpkZChlLG4pLGlubGluZUR5bmFtaWNJbXBvcnRzOm8saW50ZXJvcDpmZChlKSxpbnRybzpyZChlLCJpbnRybyIpLG1hbnVhbENodW5rczpnZChlLG8sYSx0KSxtaW5pZnlJbnRlcm5hbEV4cG9ydHM6eWQoZSxyLG4pLG5hbWU6ZS5uYW1lLG5hbWVzcGFjZVRvU3RyaW5nVGFnOnhkKGUsaCx0KSxub0NvbmZsaWN0OmUubm9Db25mbGljdHx8ITEsb3V0cm86cmQoZSwib3V0cm8iKSxwYXRoczplLnBhdGhzfHx7fSxwbHVnaW5zOmF3YWl0IGl1KGUucGx1Z2lucykscHJlZmVyQ29uc3Q6YyxwcmVzZXJ2ZU1vZHVsZXM6YSxwcmVzZXJ2ZU1vZHVsZXNSb290OmlkKGUpLHNhbml0aXplRmlsZU5hbWU6ImZ1bmN0aW9uIj09dHlwZW9mIGUuc2FuaXRpemVGaWxlTmFtZT9lLnNhbml0aXplRmlsZU5hbWU6ITE9PT1lLnNhbml0aXplRmlsZU5hbWU/ZT0+ZTpRdSxzb3VyY2VtYXA6ZS5zb3VyY2VtYXB8fCExLHNvdXJjZW1hcEJhc2VVcmw6YmQoZSksc291cmNlbWFwRXhjbHVkZVNvdXJjZXM6ZS5zb3VyY2VtYXBFeGNsdWRlU291cmNlc3x8ITEsc291cmNlbWFwRmlsZTplLnNvdXJjZW1hcEZpbGUsc291cmNlbWFwRmlsZU5hbWVzOkVkKGUsaSksc291cmNlbWFwSWdub3JlTGlzdDoiZnVuY3Rpb24iPT10eXBlb2YgZS5zb3VyY2VtYXBJZ25vcmVMaXN0P2Uuc291cmNlbWFwSWdub3JlTGlzdDohMT09PWUuc291cmNlbWFwSWdub3JlTGlzdD8oKT0+ITE6ZT0+ZS5pbmNsdWRlcygibm9kZV9tb2R1bGVzIiksc291cmNlbWFwUGF0aFRyYW5zZm9ybTplLnNvdXJjZW1hcFBhdGhUcmFuc2Zvcm0sc3RyaWN0OmUuc3RyaWN0Pz8hMCxzeXN0ZW1OdWxsU2V0dGVyczplLnN5c3RlbU51bGxTZXR0ZXJzPz8hMCx2YWxpZGF0ZTplLnZhbGlkYXRlfHwhMX07cmV0dXJuIEpoKGUsT2JqZWN0LmtleXModSksIm91dHB1dCBvcHRpb25zIix0Lm9uTG9nKSx7b3B0aW9uczp1LHVuc2V0T3B0aW9uczppfX0oaS5ob29rUmVkdWNlQXJnMFN5bmMoIm91dHB1dE9wdGlvbnMiLFtzXSwoKGUsdCk9PnR8fGUpLChlPT57Y29uc3QgdD0oKT0+ZS5lcnJvcih7Y29kZTpzdCxtZXNzYWdlOidDYW5ub3QgZW1pdCBmaWxlcyBvciBzZXQgYXNzZXQgc291cmNlcyBpbiB0aGUgIm91dHB1dE9wdGlvbnMiIGhvb2ssIHVzZSB0aGUgInJlbmRlclN0YXJ0IiBob29rIGluc3RlYWQuJ30pO3JldHVybiB7Li4uZSxlbWl0RmlsZTp0LHNldEFzc2V0U291cmNlOnR9fSkpLGUsdCl9dmFyIElkO2Z1bmN0aW9uIHdkKGUpe3JldHVybiAiYXNzZXQiPT09ZS50eXBlP0lkLkFTU0VUOmUuaXNFbnRyeT9JZC5FTlRSWV9DSFVOSzpJZC5TRUNPTkRBUllfQ0hVTkt9IWZ1bmN0aW9uKGUpe2VbZS5FTlRSWV9DSFVOSz0wXT0iRU5UUllfQ0hVTksiLGVbZS5TRUNPTkRBUllfQ0hVTks9MV09IlNFQ09OREFSWV9DSFVOSyIsZVtlLkFTU0VUPTJdPSJBU1NFVCI7fShJZHx8KElkPXt9KSk7Cgphc3luYyBmdW5jdGlvbiByZXdyaXRlTW9kdWxlKHNvdXJjZSwgcmVsYXRpdmVQYXRoLCB3aW4pIHsKICBjb25zb2xlLmxvZyhyZWxhdGl2ZVBhdGgpOwogIGNvbnN0IHByZSA9IHdpbltzTG9jYXRpb25dOwogIHdpbltzTG9jYXRpb25dID0gcmVsYXRpdmVQYXRoOwogIGNvbnN0IHByb3RvRG9tID0gbmV3IHdpbi5ET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoCiAgICAiIiwKICAgICJ0ZXh0L2h0bWwiCiAgKTsKICBjb25zdCBiYXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYmFzZSIpOwogIGJhc2UuaHJlZiA9IHJlbGF0aXZlUGF0aC50b1N0cmluZygpOwogIHByb3RvRG9tLmhlYWQuYXBwZW5kKGJhc2UpOwogIHdpbi5kb2N1bWVudC5oZWFkLmFwcGVuZChiYXNlLmNsb25lTm9kZSgpKTsKICBjb25zdCB2aXJ0dWFsU291cmNlTWFwID0ge307CiAgY29uc3QgcHVzaFZpcnR1YWxTb3VyY2UgPSAoc291cmNlMikgPT4gewogICAgY29uc3QgaiA9IE9iamVjdC5rZXlzKHZpcnR1YWxTb3VyY2VNYXApLmxlbmd0aDsKICAgIGNvbnN0IGtleSA9IGBcMHZpcnR1YWw6JHtqfWA7CiAgICB2aXJ0dWFsU291cmNlTWFwW2tleV0gPSBzb3VyY2UyOwogICAgcmV0dXJuIGtleTsKICB9OwogIGNvbnN0IGVudHJ5SW1wb3J0ID0gcHVzaFZpcnR1YWxTb3VyY2Uoc291cmNlKTsKICBjb25zdCB2aXJ0dWFsUGx1Z2luID0gewogICAgbmFtZTogImFzZHNkIiwKICAgIC8vIEB0cy1pZ25vcmUKICAgIGFzeW5jIHJlc29sdmVJZChpbXBvcnRlZSkgewogICAgICBpZiAoIShpbXBvcnRlZSBpbiB2aXJ0dWFsU291cmNlTWFwKSkKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgdmlydHVhbHRhZyA9IHByb3RvRG9tLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgICAgdmlydHVhbHRhZy5zcmMgPSBpbXBvcnRlZTsKICAgICAgICAgIGNvbnNvbGUubG9nKHZpcnR1YWx0YWcuc3JjKTsKICAgICAgICAgIGNvbnN0IHJlcSA9IGF3YWl0IHJlcXVlc3QobmV3IFJlcXVlc3QodmlydHVhbHRhZy5zcmMpLCAic2NyaXB0Iiwgd2luKTsKICAgICAgICAgIHZpcnR1YWx0YWcucmVtb3ZlKCk7CiAgICAgICAgICB2aXJ0dWFsU291cmNlTWFwW2ltcG9ydGVlXSA9IGF3YWl0IHJlcS50ZXh0KCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IGltcG9ydGVlLAogICAgICAgIGV4dGVybmFsOiAhKGltcG9ydGVlIGluIHZpcnR1YWxTb3VyY2VNYXApCiAgICAgIH07CiAgICB9LAogICAgbG9hZChpZCkgewogICAgICBjb25zb2xlLmxvZyhgbG9hZGluZyB2OiR7aWR9YCk7CiAgICAgIHJldHVybiB2aXJ0dWFsU291cmNlTWFwW2lkXTsKICAgIH0KICB9OwogIGNvbnN0IGJ1bmRsZSA9IGF3YWl0IHZkKHsKICAgIGlucHV0OiBlbnRyeUltcG9ydCwKICAgIHBsdWdpbnM6IFt2aXJ0dWFsUGx1Z2luXQogIH0pOwogIGNvbnN0IG91dCA9IGF3YWl0IGJ1bmRsZS5nZW5lcmF0ZSh7CiAgICBuYW1lOiBlbnRyeUltcG9ydCwKICAgIGZvcm1hdDogImVzIiwKICAgIHNvdXJjZW1hcDogdHJ1ZQogIH0pOwogIHdpbmRvd1siZiJdID0gb3V0OwogIGNvbnN0IGZpcnN0ID0gb3V0Lm91dHB1dFswXTsKICB3aW5bc0xvY2F0aW9uXSA9IHByZTsKICByZXR1cm4gZmlyc3QuY29kZTsKfQoKLyoqClRoaXMgcmVnZXggcmVwcmVzZW50cyBhIGxvb3NlIHJ1bGUgb2YgYW4g4oCcaW1hZ2UgY2FuZGlkYXRlIHN0cmluZ+KAnS4KCkBzZWUgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvaW1hZ2VzLmh0bWwjc3Jjc2V0LWF0dHJpYnV0ZQoKQW4g4oCcaW1hZ2UgY2FuZGlkYXRlIHN0cmluZ+KAnSByb3VnaGx5IGNvbnNpc3RzIG9mIHRoZSBmb2xsb3dpbmc6CjEuIFplcm8gb3IgbW9yZSB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuCjIuIEEgbm9uLWVtcHR5IFVSTCB0aGF0IGRvZXMgbm90IHN0YXJ0IG9yIGVuZCB3aXRoIGAsYC4KMy4gWmVybyBvciBtb3JlIHdoaXRlc3BhY2UgY2hhcmFjdGVycy4KNC4gQW4gb3B0aW9uYWwg4oCcZGVzY3JpcHRvcuKAnSB0aGF0IHN0YXJ0cyB3aXRoIGEgd2hpdGVzcGFjZSBjaGFyYWN0ZXIuCjUuIFplcm8gb3IgbW9yZSB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuCjYuIEVhY2ggaW1hZ2UgY2FuZGlkYXRlIHN0cmluZyBpcyBzZXBhcmF0ZWQgYnkgYSBgLGAuCgpXZSBpbnRlbnRpb25hbGx5IGltcGxlbWVudCBhIGxvb3NlIHJ1bGUgaGVyZSBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIG1vcmUgYWdncmVzc2l2ZSBlcnJvciBoYW5kbGluZyBhbmQgcmVwb3J0aW5nIGluIHRoZSBiZWxvdyBjb2RlLgoqLwpjb25zdCBpbWFnZUNhbmRpZGF0ZVJlZ2V4ID0gL1xzKihbXixdXFMqW14sXSg/OlxzK1teLF0rKT8pXHMqKD86LHwkKS87Cgpjb25zdCBkdXBsaWNhdGVEZXNjcmlwdG9yQ2hlY2sgPSAoYWxsRGVzY3JpcHRvcnMsIHZhbHVlLCBwb3N0Zml4KSA9PiB7CglhbGxEZXNjcmlwdG9yc1twb3N0Zml4XSA9IGFsbERlc2NyaXB0b3JzW3Bvc3RmaXhdIHx8IHt9OwoJaWYgKGFsbERlc2NyaXB0b3JzW3Bvc3RmaXhdW3ZhbHVlXSkgewoJCXRocm93IG5ldyBFcnJvcihgTm8gbW9yZSB0aGFuIG9uZSBpbWFnZSBjYW5kaWRhdGUgaXMgYWxsb3dlZCBmb3IgYSBnaXZlbiBkZXNjcmlwdG9yOiAke3ZhbHVlfSR7cG9zdGZpeH1gKTsKCX0KCglhbGxEZXNjcmlwdG9yc1twb3N0Zml4XVt2YWx1ZV0gPSB0cnVlOwp9OwoKY29uc3QgZmFsbGJhY2tEZXNjcmlwdG9yRHVwbGljYXRlQ2hlY2sgPSBhbGxEZXNjcmlwdG9ycyA9PiB7CglpZiAoYWxsRGVzY3JpcHRvcnMuZmFsbGJhY2spIHsKCQl0aHJvdyBuZXcgRXJyb3IoJ09ubHkgb25lIGZhbGxiYWNrIGltYWdlIGNhbmRpZGF0ZSBpcyBhbGxvd2VkJyk7Cgl9CgoJaWYgKGFsbERlc2NyaXB0b3JzLnhbJzEnXSkgewoJCXRocm93IG5ldyBFcnJvcignQSBmYWxsYmFjayBpbWFnZSBpcyBlcXVpdmFsZW50IHRvIGEgMXggZGVzY3JpcHRvciwgcHJvdmlkaW5nIGJvdGggaXMgaW52YWxpZC4nKTsKCX0KCglhbGxEZXNjcmlwdG9ycy5mYWxsYmFjayA9IHRydWU7Cn07Cgpjb25zdCBkZXNjcmlwdG9yQ291bnRDaGVjayA9IChhbGxEZXNjcmlwdG9ycywgY3VycmVudERlc2NyaXB0b3JzKSA9PiB7CglpZiAoY3VycmVudERlc2NyaXB0b3JzLmxlbmd0aCA9PT0gMCkgewoJCWZhbGxiYWNrRGVzY3JpcHRvckR1cGxpY2F0ZUNoZWNrKGFsbERlc2NyaXB0b3JzKTsKCX0gZWxzZSBpZiAoY3VycmVudERlc2NyaXB0b3JzLmxlbmd0aCA+IDEpIHsKCQl0aHJvdyBuZXcgRXJyb3IoYEltYWdlIGNhbmRpZGF0ZSBtYXkgaGF2ZSBubyBtb3JlIHRoYW4gb25lIGRlc2NyaXB0b3IsIGZvdW5kICR7Y3VycmVudERlc2NyaXB0b3JzLmxlbmd0aH06ICR7Y3VycmVudERlc2NyaXB0b3JzLmpvaW4oJyAnKX1gKTsKCX0KfTsKCmNvbnN0IHZhbGlkRGVzY3JpcHRvckNoZWNrID0gKHZhbHVlLCBwb3N0Zml4LCBkZXNjcmlwdG9yKSA9PiB7CglpZiAoTnVtYmVyLmlzTmFOKHZhbHVlKSkgewoJCXRocm93IG5ldyBUeXBlRXJyb3IoYCR7ZGVzY3JpcHRvciB8fCB2YWx1ZX0gaXMgbm90IGEgdmFsaWQgbnVtYmVyYCk7Cgl9CgoJc3dpdGNoIChwb3N0Zml4KSB7CgkJY2FzZSAndyc6IHsKCQkJaWYgKHZhbHVlIDw9IDApIHsKCQkJCXRocm93IG5ldyBFcnJvcignV2lkdGggZGVzY3JpcHRvciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvJyk7CgkJCX0gZWxzZSBpZiAoIU51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7CgkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdXaWR0aCBkZXNjcmlwdG9yIG11c3QgYmUgYW4gaW50ZWdlcicpOwoJCQl9CgoJCQlicmVhazsKCQl9CgoJCWNhc2UgJ3gnOiB7CgkJCWlmICh2YWx1ZSA8PSAwKSB7CgkJCQl0aHJvdyBuZXcgRXJyb3IoJ1BpeGVsIGRlbnNpdHkgZGVzY3JpcHRvciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvJyk7CgkJCX0KCgkJCWJyZWFrOwoJCX0KCgkJY2FzZSAnaCc6IHsKCQkJdGhyb3cgbmV3IEVycm9yKCdIZWlnaHQgZGVzY3JpcHRvciBpcyBubyBsb25nZXIgYWxsb3dlZCcpOwoJCX0KCgkJZGVmYXVsdDogewoJCQl0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3Jjc2V0IGRlc2NyaXB0b3I6ICR7ZGVzY3JpcHRvcn1gKTsKCQl9Cgl9Cn07CgpmdW5jdGlvbiBwYXJzZVNyY3NldChzdHJpbmcsIHtzdHJpY3QgPSBmYWxzZX0gPSB7fSkgewoJY29uc3QgYWxsRGVzY3JpcHRvcnMgPSBzdHJpY3QgPyB7fSA6IHVuZGVmaW5lZDsKCglyZXR1cm4gc3RyaW5nLnNwbGl0KGltYWdlQ2FuZGlkYXRlUmVnZXgpCgkJLmZpbHRlcigocGFydCwgaW5kZXgpID0+IGluZGV4ICUgMiA9PT0gMSkKCQkubWFwKHBhcnQgPT4gewoJCQljb25zdCBbdXJsLCAuLi5kZXNjcmlwdG9yc10gPSBwYXJ0LnRyaW0oKS5zcGxpdCgvXHMrLyk7CgoJCQljb25zdCByZXN1bHQgPSB7dXJsfTsKCgkJCWlmIChzdHJpY3QpIHsKCQkJCWRlc2NyaXB0b3JDb3VudENoZWNrKGFsbERlc2NyaXB0b3JzLCBkZXNjcmlwdG9ycyk7CgkJCX0KCgkJCWZvciAoY29uc3QgZGVzY3JpcHRvciBvZiBkZXNjcmlwdG9ycykgewoJCQkJY29uc3QgcG9zdGZpeCA9IGRlc2NyaXB0b3JbZGVzY3JpcHRvci5sZW5ndGggLSAxXTsKCQkJCWNvbnN0IHZhbHVlID0gTnVtYmVyLnBhcnNlRmxvYXQoZGVzY3JpcHRvci5zbGljZSgwLCAtMSkpOwoKCQkJCWlmIChzdHJpY3QpIHsKCQkJCQl2YWxpZERlc2NyaXB0b3JDaGVjayh2YWx1ZSwgcG9zdGZpeCwgZGVzY3JpcHRvcik7CgkJCQkJZHVwbGljYXRlRGVzY3JpcHRvckNoZWNrKGFsbERlc2NyaXB0b3JzLCB2YWx1ZSwgcG9zdGZpeCk7CgkJCQl9CgoJCQkJc3dpdGNoIChwb3N0Zml4KSB7CgkJCQkJY2FzZSAndyc6IHsKCQkJCQkJcmVzdWx0LndpZHRoID0gdmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJY2FzZSAnaCc6IHsKCQkJCQkJcmVzdWx0LmhlaWdodCA9IHZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWNhc2UgJ3gnOiB7CgkJCQkJCXJlc3VsdC5kZW5zaXR5ID0gdmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJLy8gTm8gZGVmYXVsdAoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0OwoJCX0pOwp9Cgpjb25zdCBrbm93bkRlc2NyaXB0b3JzID0gbmV3IFNldChbJ3dpZHRoJywgJ2hlaWdodCcsICdkZW5zaXR5J10pOwoKZnVuY3Rpb24gc3RyaW5naWZ5U3Jjc2V0KGFycmF5LCB7c3RyaWN0ID0gZmFsc2V9ID0ge30pIHsKCWNvbnN0IGFsbERlc2NyaXB0b3JzID0gc3RyaWN0ID8ge30gOiB1bmRlZmluZWQ7CgoJcmV0dXJuIGFycmF5Lm1hcChlbGVtZW50ID0+IHsKCQlpZiAoIWVsZW1lbnQudXJsKSB7CgkJCWlmIChzdHJpY3QpIHsKCQkJCXRocm93IG5ldyBFcnJvcignVVJMIGlzIHJlcXVpcmVkJyk7CgkJCX0KCgkJCXJldHVybiAnJzsKCQl9CgoJCWNvbnN0IGRlc2NyaXB0b3JLZXlzID0gT2JqZWN0LmtleXMoZWxlbWVudCkuZmlsdGVyKGtleSA9PiBrbm93bkRlc2NyaXB0b3JzLmhhcyhrZXkpKTsKCgkJaWYgKHN0cmljdCkgewoJCQlkZXNjcmlwdG9yQ291bnRDaGVjayhhbGxEZXNjcmlwdG9ycywgZGVzY3JpcHRvcktleXMpOwoJCX0KCgkJY29uc3QgcmVzdWx0ID0gW2VsZW1lbnQudXJsXTsKCgkJZm9yIChjb25zdCBkZXNjcmlwdG9yS2V5IG9mIGRlc2NyaXB0b3JLZXlzKSB7CgkJCWNvbnN0IHZhbHVlID0gZWxlbWVudFtkZXNjcmlwdG9yS2V5XTsKCQkJbGV0IHBvc3RmaXg7CgkJCXN3aXRjaCAoZGVzY3JpcHRvcktleSkgewoJCQkJY2FzZSAnd2lkdGgnOiB7CgkJCQkJcG9zdGZpeCA9ICd3JzsKCgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJY2FzZSAnaGVpZ2h0JzogewoJCQkJCXBvc3RmaXggPSAnaCc7CgoJCQkJCWJyZWFrOwoJCQkJfQoKCQkJCWNhc2UgJ2RlbnNpdHknOiB7CgkJCQkJcG9zdGZpeCA9ICd4JzsKCgkJCQkJYnJlYWs7CgkJCQl9CgkJCS8vIE5vIGRlZmF1bHQKCQkJfQoKCQkJY29uc3QgZGVzY3JpcHRvciA9IGAke3ZhbHVlfSR7cG9zdGZpeH1gOwoKCQkJaWYgKHN0cmljdCkgewoJCQkJdmFsaWREZXNjcmlwdG9yQ2hlY2sodmFsdWUsIHBvc3RmaXgpOwoJCQkJZHVwbGljYXRlRGVzY3JpcHRvckNoZWNrKGFsbERlc2NyaXB0b3JzLCB2YWx1ZSwgcG9zdGZpeCk7CgkJCX0KCgkJCXJlc3VsdC5wdXNoKGRlc2NyaXB0b3IpOwoJCX0KCgkJcmV0dXJuIHJlc3VsdC5qb2luKCcgJyk7Cgl9KS5qb2luKCcsICcpOwp9CgovLyBDU1MgU3ludGF4IE1vZHVsZSBMZXZlbCAzCi8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3Mtc3ludGF4LTMvCmNvbnN0IEVPRiQxID0gMDsgICAgICAgICAgICAgICAgIC8vIDxFT0YtdG9rZW4+CmNvbnN0IElkZW50ID0gMTsgICAgICAgICAgICAgICAvLyA8aWRlbnQtdG9rZW4+CmNvbnN0IEZ1bmN0aW9uJDIgPSAyOyAgICAgICAgICAgIC8vIDxmdW5jdGlvbi10b2tlbj4KY29uc3QgQXRLZXl3b3JkID0gMzsgICAgICAgICAgIC8vIDxhdC1rZXl3b3JkLXRva2VuPgpjb25zdCBIYXNoJDEgPSA0OyAgICAgICAgICAgICAgICAvLyA8aGFzaC10b2tlbj4KY29uc3QgU3RyaW5nJDIgPSA1OyAgICAgICAgICAgICAgLy8gPHN0cmluZy10b2tlbj4KY29uc3QgQmFkU3RyaW5nID0gNjsgICAgICAgICAgIC8vIDxiYWQtc3RyaW5nLXRva2VuPgpjb25zdCBVcmwkMSA9IDc7ICAgICAgICAgICAgICAgICAvLyA8dXJsLXRva2VuPgpjb25zdCBCYWRVcmwgPSA4OyAgICAgICAgICAgICAgLy8gPGJhZC11cmwtdG9rZW4+CmNvbnN0IERlbGltID0gOTsgICAgICAgICAgICAgICAvLyA8ZGVsaW0tdG9rZW4+CmNvbnN0IE51bWJlciQyID0gMTA7ICAgICAgICAgICAgIC8vIDxudW1iZXItdG9rZW4+CmNvbnN0IFBlcmNlbnRhZ2UkMSA9IDExOyAgICAgICAgIC8vIDxwZXJjZW50YWdlLXRva2VuPgpjb25zdCBEaW1lbnNpb24kMSA9IDEyOyAgICAgICAgICAvLyA8ZGltZW5zaW9uLXRva2VuPgpjb25zdCBXaGl0ZVNwYWNlJDEgPSAxMzsgICAgICAgICAvLyA8d2hpdGVzcGFjZS10b2tlbj4KY29uc3QgQ0RPJDEgPSAxNDsgICAgICAgICAgICAgICAgLy8gPENETy10b2tlbj4KY29uc3QgQ0RDJDEgPSAxNTsgICAgICAgICAgICAgICAgLy8gPENEQy10b2tlbj4KY29uc3QgQ29sb24gPSAxNjsgICAgICAgICAgICAgIC8vIDxjb2xvbi10b2tlbj4gICAgIDoKY29uc3QgU2VtaWNvbG9uID0gMTc7ICAgICAgICAgIC8vIDxzZW1pY29sb24tdG9rZW4+IDsKY29uc3QgQ29tbWEgPSAxODsgICAgICAgICAgICAgIC8vIDxjb21tYS10b2tlbj4gICAgICwKY29uc3QgTGVmdFNxdWFyZUJyYWNrZXQgPSAxOTsgIC8vIDxbLXRva2VuPgpjb25zdCBSaWdodFNxdWFyZUJyYWNrZXQgPSAyMDsgLy8gPF0tdG9rZW4+CmNvbnN0IExlZnRQYXJlbnRoZXNpcyA9IDIxOyAgICAvLyA8KC10b2tlbj4KY29uc3QgUmlnaHRQYXJlbnRoZXNpcyA9IDIyOyAgIC8vIDwpLXRva2VuPgpjb25zdCBMZWZ0Q3VybHlCcmFja2V0ID0gMjM7ICAgLy8gPHstdG9rZW4+CmNvbnN0IFJpZ2h0Q3VybHlCcmFja2V0ID0gMjQ7ICAvLyA8fS10b2tlbj4KY29uc3QgQ29tbWVudCQxID0gMjU7Cgpjb25zdCBFT0YgPSAwOwoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgtMy8KLy8gwqcgNC4yLiBEZWZpbml0aW9ucwoKLy8gZGlnaXQKLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDMwIERJR0lUIFpFUk8gKDApIGFuZCBVKzAwMzkgRElHSVQgTklORSAoOSkuCmZ1bmN0aW9uIGlzRGlnaXQoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gMHgwMDMwICYmIGNvZGUgPD0gMHgwMDM5Owp9CgovLyBoZXggZGlnaXQKLy8gQSBkaWdpdCwgb3IgYSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIGFuZCBVKzAwNDYgTEFUSU4gQ0FQSVRBTCBMRVRURVIgRiAoRiksCi8vIG9yIGEgY29kZSBwb2ludCBiZXR3ZWVuIFUrMDA2MSBMQVRJTiBTTUFMTCBMRVRURVIgQSAoYSkgYW5kIFUrMDA2NiBMQVRJTiBTTUFMTCBMRVRURVIgRiAoZikuCmZ1bmN0aW9uIGlzSGV4RGlnaXQoY29kZSkgewogICAgcmV0dXJuICgKICAgICAgICBpc0RpZ2l0KGNvZGUpIHx8IC8vIDAgLi4gOQogICAgICAgIChjb2RlID49IDB4MDA0MSAmJiBjb2RlIDw9IDB4MDA0NikgfHwgLy8gQSAuLiBGCiAgICAgICAgKGNvZGUgPj0gMHgwMDYxICYmIGNvZGUgPD0gMHgwMDY2KSAgICAvLyBhIC4uIGYKICAgICk7Cn0KCi8vIHVwcGVyY2FzZSBsZXR0ZXIKLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIGFuZCBVKzAwNUEgTEFUSU4gQ0FQSVRBTCBMRVRURVIgWiAoWikuCmZ1bmN0aW9uIGlzVXBwZXJjYXNlTGV0dGVyKGNvZGUpIHsKICAgIHJldHVybiBjb2RlID49IDB4MDA0MSAmJiBjb2RlIDw9IDB4MDA1QTsKfQoKLy8gbG93ZXJjYXNlIGxldHRlcgovLyBBIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwNjEgTEFUSU4gU01BTEwgTEVUVEVSIEEgKGEpIGFuZCBVKzAwN0EgTEFUSU4gU01BTEwgTEVUVEVSIFogKHopLgpmdW5jdGlvbiBpc0xvd2VyY2FzZUxldHRlcihjb2RlKSB7CiAgICByZXR1cm4gY29kZSA+PSAweDAwNjEgJiYgY29kZSA8PSAweDAwN0E7Cn0KCi8vIGxldHRlcgovLyBBbiB1cHBlcmNhc2UgbGV0dGVyIG9yIGEgbG93ZXJjYXNlIGxldHRlci4KZnVuY3Rpb24gaXNMZXR0ZXIoY29kZSkgewogICAgcmV0dXJuIGlzVXBwZXJjYXNlTGV0dGVyKGNvZGUpIHx8IGlzTG93ZXJjYXNlTGV0dGVyKGNvZGUpOwp9CgovLyBub24tQVNDSUkgY29kZSBwb2ludAovLyBBIGNvZGUgcG9pbnQgd2l0aCBhIHZhbHVlIGVxdWFsIHRvIG9yIGdyZWF0ZXIgdGhhbiBVKzAwODAgPGNvbnRyb2w+LgpmdW5jdGlvbiBpc05vbkFzY2lpKGNvZGUpIHsKICAgIHJldHVybiBjb2RlID49IDB4MDA4MDsKfQoKLy8gbmFtZS1zdGFydCBjb2RlIHBvaW50Ci8vIEEgbGV0dGVyLCBhIG5vbi1BU0NJSSBjb2RlIHBvaW50LCBvciBVKzAwNUYgTE9XIExJTkUgKF8pLgpmdW5jdGlvbiBpc05hbWVTdGFydChjb2RlKSB7CiAgICByZXR1cm4gaXNMZXR0ZXIoY29kZSkgfHwgaXNOb25Bc2NpaShjb2RlKSB8fCBjb2RlID09PSAweDAwNUY7Cn0KCi8vIG5hbWUgY29kZSBwb2ludAovLyBBIG5hbWUtc3RhcnQgY29kZSBwb2ludCwgYSBkaWdpdCwgb3IgVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkuCmZ1bmN0aW9uIGlzTmFtZShjb2RlKSB7CiAgICByZXR1cm4gaXNOYW1lU3RhcnQoY29kZSkgfHwgaXNEaWdpdChjb2RlKSB8fCBjb2RlID09PSAweDAwMkQ7Cn0KCi8vIG5vbi1wcmludGFibGUgY29kZSBwb2ludAovLyBBIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwMDAgTlVMTCBhbmQgVSswMDA4IEJBQ0tTUEFDRSwgb3IgVSswMDBCIExJTkUgVEFCVUxBVElPTiwKLy8gb3IgYSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDBFIFNISUZUIE9VVCBhbmQgVSswMDFGIElORk9STUFUSU9OIFNFUEFSQVRPUiBPTkUsIG9yIFUrMDA3RiBERUxFVEUuCmZ1bmN0aW9uIGlzTm9uUHJpbnRhYmxlKGNvZGUpIHsKICAgIHJldHVybiAoCiAgICAgICAgKGNvZGUgPj0gMHgwMDAwICYmIGNvZGUgPD0gMHgwMDA4KSB8fAogICAgICAgIChjb2RlID09PSAweDAwMEIpIHx8CiAgICAgICAgKGNvZGUgPj0gMHgwMDBFICYmIGNvZGUgPD0gMHgwMDFGKSB8fAogICAgICAgIChjb2RlID09PSAweDAwN0YpCiAgICApOwp9CgovLyBuZXdsaW5lCi8vIFUrMDAwQSBMSU5FIEZFRUQuIE5vdGUgdGhhdCBVKzAwMEQgQ0FSUklBR0UgUkVUVVJOIGFuZCBVKzAwMEMgRk9STSBGRUVEIGFyZSBub3QgaW5jbHVkZWQgaW4gdGhpcyBkZWZpbml0aW9uLAovLyBhcyB0aGV5IGFyZSBjb252ZXJ0ZWQgdG8gVSswMDBBIExJTkUgRkVFRCBkdXJpbmcgcHJlcHJvY2Vzc2luZy4KLy8gVE9ETzogd2UgZG9lc24ndCBkbyBhIHByZXByb2Nlc3NpbmcsIHNvIGNoZWNrIGEgY29kZSBwb2ludCBmb3IgVSswMDBEIENBUlJJQUdFIFJFVFVSTiBhbmQgVSswMDBDIEZPUk0gRkVFRApmdW5jdGlvbiBpc05ld2xpbmUoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPT09IDB4MDAwQSB8fCBjb2RlID09PSAweDAwMEQgfHwgY29kZSA9PT0gMHgwMDBDOwp9CgovLyB3aGl0ZXNwYWNlCi8vIEEgbmV3bGluZSwgVSswMDA5IENIQVJBQ1RFUiBUQUJVTEFUSU9OLCBvciBVKzAwMjAgU1BBQ0UuCmZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjb2RlKSB7CiAgICByZXR1cm4gaXNOZXdsaW5lKGNvZGUpIHx8IGNvZGUgPT09IDB4MDAyMCB8fCBjb2RlID09PSAweDAwMDk7Cn0KCi8vIMKnIDQuMy44LiBDaGVjayBpZiB0d28gY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlCmZ1bmN0aW9uIGlzVmFsaWRFc2NhcGUoZmlyc3QsIHNlY29uZCkgewogICAgLy8gSWYgdGhlIGZpcnN0IGNvZGUgcG9pbnQgaXMgbm90IFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpLCByZXR1cm4gZmFsc2UuCiAgICBpZiAoZmlyc3QgIT09IDB4MDA1QykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBzZWNvbmQgY29kZSBwb2ludCBpcyBhIG5ld2xpbmUgb3IgRU9GLCByZXR1cm4gZmFsc2UuCiAgICBpZiAoaXNOZXdsaW5lKHNlY29uZCkgfHwgc2Vjb25kID09PSBFT0YpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gdHJ1ZS4KICAgIHJldHVybiB0cnVlOwp9CgovLyDCpyA0LjMuOS4gQ2hlY2sgaWYgdGhyZWUgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYW4gaWRlbnRpZmllcgpmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydChmaXJzdCwgc2Vjb25kLCB0aGlyZCkgewogICAgLy8gTG9vayBhdCB0aGUgZmlyc3QgY29kZSBwb2ludDoKCiAgICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTCiAgICBpZiAoZmlyc3QgPT09IDB4MDAyRCkgewogICAgICAgIC8vIElmIHRoZSBzZWNvbmQgY29kZSBwb2ludCBpcyBhIG5hbWUtc3RhcnQgY29kZSBwb2ludCBvciBhIFUrMDAyRCBIWVBIRU4tTUlOVVMsCiAgICAgICAgLy8gb3IgdGhlIHNlY29uZCBhbmQgdGhpcmQgY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlLCByZXR1cm4gdHJ1ZS4gT3RoZXJ3aXNlLCByZXR1cm4gZmFsc2UuCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgaXNOYW1lU3RhcnQoc2Vjb25kKSB8fAogICAgICAgICAgICBzZWNvbmQgPT09IDB4MDAyRCB8fAogICAgICAgICAgICBpc1ZhbGlkRXNjYXBlKHNlY29uZCwgdGhpcmQpCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnQKICAgIGlmIChpc05hbWVTdGFydChmaXJzdCkpIHsKICAgICAgICAvLyBSZXR1cm4gdHJ1ZS4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQogICAgaWYgKGZpcnN0ID09PSAweDAwNUMpIHsKICAgICAgICAvLyBJZiB0aGUgZmlyc3QgYW5kIHNlY29uZCBjb2RlIHBvaW50cyBhcmUgYSB2YWxpZCBlc2NhcGUsIHJldHVybiB0cnVlLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS4KICAgICAgICByZXR1cm4gaXNWYWxpZEVzY2FwZShmaXJzdCwgc2Vjb25kKTsKICAgIH0KCiAgICAvLyBhbnl0aGluZyBlbHNlCiAgICAvLyBSZXR1cm4gZmFsc2UuCiAgICByZXR1cm4gZmFsc2U7Cn0KCi8vIMKnIDQuMy4xMC4gQ2hlY2sgaWYgdGhyZWUgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYSBudW1iZXIKZnVuY3Rpb24gaXNOdW1iZXJTdGFydChmaXJzdCwgc2Vjb25kLCB0aGlyZCkgewogICAgLy8gTG9vayBhdCB0aGUgZmlyc3QgY29kZSBwb2ludDoKCiAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKICAgIGlmIChmaXJzdCA9PT0gMHgwMDJCIHx8IGZpcnN0ID09PSAweDAwMkQpIHsKICAgICAgICAvLyBJZiB0aGUgc2Vjb25kIGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgcmV0dXJuIHRydWUuCiAgICAgICAgaWYgKGlzRGlnaXQoc2Vjb25kKSkgewogICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICB9CgogICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgVSswMDJFIEZVTEwgU1RPUCAoLikKICAgICAgICAvLyBhbmQgdGhlIHRoaXJkIGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgcmV0dXJuIHRydWUuCiAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gZmFsc2UuCiAgICAgICAgcmV0dXJuIHNlY29uZCA9PT0gMHgwMDJFICYmIGlzRGlnaXQodGhpcmQpID8gMyA6IDA7CiAgICB9CgogICAgLy8gVSswMDJFIEZVTEwgU1RPUCAoLikKICAgIGlmIChmaXJzdCA9PT0gMHgwMDJFKSB7CiAgICAgICAgLy8gSWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIHJldHVybiB0cnVlLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS4KICAgICAgICByZXR1cm4gaXNEaWdpdChzZWNvbmQpID8gMiA6IDA7CiAgICB9CgogICAgLy8gZGlnaXQKICAgIGlmIChpc0RpZ2l0KGZpcnN0KSkgewogICAgICAgIC8vIFJldHVybiB0cnVlLgogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIC8vIGFueXRoaW5nIGVsc2UKICAgIC8vIFJldHVybiBmYWxzZS4KICAgIHJldHVybiAwOwp9CgovLwovLyBNaXNjCi8vCgovLyBkZXRlY3QgQk9NIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CeXRlX29yZGVyX21hcmspCmZ1bmN0aW9uIGlzQk9NKGNvZGUpIHsKICAgIC8vIFVURi0xNkJFCiAgICBpZiAoY29kZSA9PT0gMHhGRUZGKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgLy8gVVRGLTE2TEUKICAgIGlmIChjb2RlID09PSAweEZGRkUpIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICByZXR1cm4gMDsKfQoKLy8gRmFzdCBjb2RlIGNhdGVnb3J5Ci8vIE9ubHkgQVNDSUkgY29kZSBwb2ludHMgaGFzIGEgc3BlY2lhbCBtZWFuaW5nLCB0aGF0J3Mgd2h5IHdlIGRlZmluZSBhIG1hcHMgZm9yIDAuLjEyNyBjb2RlcyBvbmx5CmNvbnN0IENBVEVHT1JZID0gbmV3IEFycmF5KDB4ODApOwpjb25zdCBFb2ZDYXRlZ29yeSA9IDB4ODA7CmNvbnN0IFdoaXRlU3BhY2VDYXRlZ29yeSA9IDB4ODI7CmNvbnN0IERpZ2l0Q2F0ZWdvcnkgPSAweDgzOwpjb25zdCBOYW1lU3RhcnRDYXRlZ29yeSA9IDB4ODQ7CmNvbnN0IE5vblByaW50YWJsZUNhdGVnb3J5ID0gMHg4NTsKCmZvciAobGV0IGkgPSAwOyBpIDwgQ0FURUdPUlkubGVuZ3RoOyBpKyspIHsKICAgIENBVEVHT1JZW2ldID0KICAgICAgICBpc1doaXRlU3BhY2UoaSkgJiYgV2hpdGVTcGFjZUNhdGVnb3J5IHx8CiAgICAgICAgaXNEaWdpdChpKSAmJiBEaWdpdENhdGVnb3J5IHx8CiAgICAgICAgaXNOYW1lU3RhcnQoaSkgJiYgTmFtZVN0YXJ0Q2F0ZWdvcnkgfHwKICAgICAgICBpc05vblByaW50YWJsZShpKSAmJiBOb25QcmludGFibGVDYXRlZ29yeSB8fAogICAgICAgIGkgfHwgRW9mQ2F0ZWdvcnk7Cn0KCmZ1bmN0aW9uIGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPCAweDgwID8gQ0FURUdPUllbY29kZV0gOiBOYW1lU3RhcnRDYXRlZ29yeTsKfQoKZnVuY3Rpb24gZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQpIHsKICAgIHJldHVybiBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoID8gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSA6IDA7Cn0KCmZ1bmN0aW9uIGdldE5ld2xpbmVMZW5ndGgoc291cmNlLCBvZmZzZXQsIGNvZGUpIHsKICAgIGlmIChjb2RlID09PSAxMyAvKiBcciAqLyAmJiBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCArIDEpID09PSAxMCAvKiBcbiAqLykgewogICAgICAgIHJldHVybiAyOwogICAgfQoKICAgIHJldHVybiAxOwp9CgpmdW5jdGlvbiBjbXBDaGFyKHRlc3RTdHIsIG9mZnNldCwgcmVmZXJlbmNlQ29kZSkgewogICAgbGV0IGNvZGUgPSB0ZXN0U3RyLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAvLyBjb2RlLnRvTG93ZXJDYXNlKCkgZm9yIEEuLloKICAgIGlmIChpc1VwcGVyY2FzZUxldHRlcihjb2RlKSkgewogICAgICAgIGNvZGUgPSBjb2RlIHwgMzI7CiAgICB9CgogICAgcmV0dXJuIGNvZGUgPT09IHJlZmVyZW5jZUNvZGU7Cn0KCmZ1bmN0aW9uIGNtcFN0cih0ZXN0U3RyLCBzdGFydCwgZW5kLCByZWZlcmVuY2VTdHIpIHsKICAgIGlmIChlbmQgLSBzdGFydCAhPT0gcmVmZXJlbmNlU3RyLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRlc3RTdHIubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVmZXJlbmNlQ29kZSA9IHJlZmVyZW5jZVN0ci5jaGFyQ29kZUF0KGkgLSBzdGFydCk7CiAgICAgICAgbGV0IHRlc3RDb2RlID0gdGVzdFN0ci5jaGFyQ29kZUF0KGkpOwoKICAgICAgICAvLyB0ZXN0Q29kZS50b0xvd2VyQ2FzZSgpIGZvciBBLi5aCiAgICAgICAgaWYgKGlzVXBwZXJjYXNlTGV0dGVyKHRlc3RDb2RlKSkgewogICAgICAgICAgICB0ZXN0Q29kZSA9IHRlc3RDb2RlIHwgMzI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdENvZGUgIT09IHJlZmVyZW5jZUNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VTdGFydChzb3VyY2UsIG9mZnNldCkgewogICAgZm9yICg7IG9mZnNldCA+PSAwOyBvZmZzZXQtLSkgewogICAgICAgIGlmICghaXNXaGl0ZVNwYWNlKHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0ICsgMTsKfQoKZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VFbmQoc291cmNlLCBvZmZzZXQpIHsKICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgIGlmICghaXNXaGl0ZVNwYWNlKHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgpmdW5jdGlvbiBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCkgewogICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7CiAgICAgICAgaWYgKCFpc0RpZ2l0KHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpyA0LjMuNy4gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQKZnVuY3Rpb24gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpIHsKICAgIC8vIEl0IGFzc3VtZXMgdGhhdCB0aGUgVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkgaGFzIGFscmVhZHkgYmVlbiBjb25zdW1lZCBhbmQKICAgIC8vIHRoYXQgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBoYXMgYWxyZWFkeSBiZWVuIHZlcmlmaWVkIHRvIGJlIHBhcnQgb2YgYSB2YWxpZCBlc2NhcGUuCiAgICBvZmZzZXQgKz0gMjsKCiAgICAvLyBoZXggZGlnaXQKICAgIGlmIChpc0hleERpZ2l0KGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0IC0gMSkpKSB7CiAgICAgICAgLy8gQ29uc3VtZSBhcyBtYW55IGhleCBkaWdpdHMgYXMgcG9zc2libGUsIGJ1dCBubyBtb3JlIHRoYW4gNS4KICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBtZWFucyAxLTYgaGV4IGRpZ2l0cyBoYXZlIGJlZW4gY29uc3VtZWQgaW4gdG90YWwuCiAgICAgICAgZm9yIChjb25zdCBtYXhPZmZzZXQgPSBNYXRoLm1pbihzb3VyY2UubGVuZ3RoLCBvZmZzZXQgKyA1KTsgb2Zmc2V0IDwgbWF4T2Zmc2V0OyBvZmZzZXQrKykgewogICAgICAgICAgICBpZiAoIWlzSGV4RGlnaXQoZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQpKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgd2hpdGVzcGFjZSwgY29uc3VtZSBpdCBhcyB3ZWxsLgogICAgICAgIGNvbnN0IGNvZGUgPSBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgaWYgKGlzV2hpdGVTcGFjZShjb2RlKSkgewogICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCwgY29kZSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQ7Cn0KCi8vIMKnNC4zLjExLiBDb25zdW1lIGEgbmFtZQovLyBOb3RlOiBUaGlzIGFsZ29yaXRobSBkb2VzIG5vdCBkbyB0aGUgdmVyaWZpY2F0aW9uIG9mIHRoZSBmaXJzdCBmZXcgY29kZSBwb2ludHMgdGhhdCBhcmUgbmVjZXNzYXJ5Ci8vIHRvIGVuc3VyZSB0aGUgcmV0dXJuZWQgY29kZSBwb2ludHMgd291bGQgY29uc3RpdHV0ZSBhbiA8aWRlbnQtdG9rZW4+LiBJZiB0aGF0IGlzIHRoZSBpbnRlbmRlZCB1c2UsCi8vIGVuc3VyZSB0aGF0IHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYW4gaWRlbnRpZmllciBiZWZvcmUgY2FsbGluZyB0aGlzIGFsZ29yaXRobS4KZnVuY3Rpb24gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQpIHsKICAgIC8vIExldCByZXN1bHQgaW5pdGlhbGx5IGJlIGFuIGVtcHR5IHN0cmluZy4KICAgIC8vIFJlcGVhdGVkbHkgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGZyb20gdGhlIHN0cmVhbToKICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpOwoKICAgICAgICAvLyBuYW1lIGNvZGUgcG9pbnQKICAgICAgICBpZiAoaXNOYW1lKGNvZGUpKSB7CiAgICAgICAgICAgIC8vIEFwcGVuZCB0aGUgY29kZSBwb2ludCB0byByZXN1bHQuCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhlIHN0cmVhbSBzdGFydHMgd2l0aCBhIHZhbGlkIGVzY2FwZQogICAgICAgIGlmIChpc1ZhbGlkRXNjYXBlKGNvZGUsIGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0ICsgMSkpKSB7CiAgICAgICAgICAgIC8vIENvbnN1bWUgYW4gZXNjYXBlZCBjb2RlIHBvaW50LiBBcHBlbmQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgdG8gcmVzdWx0LgogICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lRXNjYXBlZChzb3VyY2UsIG9mZnNldCkgLSAxOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAvLyBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4gUmV0dXJuIHJlc3VsdC4KICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpzQuMy4xMi4gQ29uc3VtZSBhIG51bWJlcgpmdW5jdGlvbiBjb25zdW1lTnVtYmVyJDEoc291cmNlLCBvZmZzZXQpIHsKICAgIGxldCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAvLyAyLiBJZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIFUrMDAyQiBQTFVTIFNJR04gKCspIG9yIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pLAogICAgLy8gY29uc3VtZSBpdCBhbmQgYXBwZW5kIGl0IHRvIHJlcHIuCiAgICBpZiAoY29kZSA9PT0gMHgwMDJCIHx8IGNvZGUgPT09IDB4MDAyRCkgewogICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKz0gMSk7CiAgICB9CgogICAgLy8gMy4gV2hpbGUgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBhIGRpZ2l0LCBjb25zdW1lIGl0IGFuZCBhcHBlbmQgaXQgdG8gcmVwci4KICAgIGlmIChpc0RpZ2l0KGNvZGUpKSB7CiAgICAgICAgb2Zmc2V0ID0gZmluZERlY2ltYWxOdW1iZXJFbmQoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKICAgIH0KCiAgICAvLyA0LiBJZiB0aGUgbmV4dCAyIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMkUgRlVMTCBTVE9QICguKSBmb2xsb3dlZCBieSBhIGRpZ2l0LCB0aGVuOgogICAgaWYgKGNvZGUgPT09IDB4MDAyRSAmJiBpc0RpZ2l0KHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCArIDEpKSkgewogICAgICAgIC8vIDQuMSBDb25zdW1lIHRoZW0uCiAgICAgICAgLy8gNC4yIEFwcGVuZCB0aGVtIHRvIHJlcHIuCiAgICAgICAgb2Zmc2V0ICs9IDI7CgogICAgICAgIC8vIDQuMyBTZXQgdHlwZSB0byAibnVtYmVyIi4KICAgICAgICAvLyBUT0RPCgogICAgICAgIC8vIDQuNCBXaGlsZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIGNvbnN1bWUgaXQgYW5kIGFwcGVuZCBpdCB0byByZXByLgoKICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCk7CiAgICB9CgogICAgLy8gNS4gSWYgdGhlIG5leHQgMiBvciAzIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwNDUgTEFUSU4gQ0FQSVRBTCBMRVRURVIgRSAoRSkKICAgIC8vIG9yIFUrMDA2NSBMQVRJTiBTTUFMTCBMRVRURVIgRSAoZSksIC4uLiAsIGZvbGxvd2VkIGJ5IGEgZGlnaXQsIHRoZW46CiAgICBpZiAoY21wQ2hhcihzb3VyY2UsIG9mZnNldCwgMTAxIC8qIGUgKi8pKSB7CiAgICAgICAgbGV0IHNpZ24gPSAwOwogICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKyAxKTsKCiAgICAgICAgLy8gLi4uIG9wdGlvbmFsbHkgZm9sbG93ZWQgYnkgVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkgb3IgVSswMDJCIFBMVVMgU0lHTiAoKykgLi4uCiAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAyRCB8fCBjb2RlID09PSAweDAwMkIpIHsKICAgICAgICAgICAgc2lnbiA9IDE7CiAgICAgICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKyAyKTsKICAgICAgICB9CgogICAgICAgIC8vIC4uLiBmb2xsb3dlZCBieSBhIGRpZ2l0CiAgICAgICAgaWYgKGlzRGlnaXQoY29kZSkpIHsKICAgICAgICAgICAgLy8gNS4xIENvbnN1bWUgdGhlbS4KICAgICAgICAgICAgLy8gNS4yIEFwcGVuZCB0aGVtIHRvIHJlcHIuCgogICAgICAgICAgICAvLyA1LjMgU2V0IHR5cGUgdG8gIm51bWJlciIuCiAgICAgICAgICAgIC8vIFRPRE8KCiAgICAgICAgICAgIC8vIDUuNCBXaGlsZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIGNvbnN1bWUgaXQgYW5kIGFwcGVuZCBpdCB0byByZXByLgogICAgICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCArIDEgKyBzaWduICsgMSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQ7Cn0KCi8vIMKnIDQuMy4xNC4gQ29uc3VtZSB0aGUgcmVtbmFudHMgb2YgYSBiYWQgdXJsCi8vIC4uLiBpdHMgc29sZSB1c2UgaXMgdG8gY29uc3VtZSBlbm91Z2ggb2YgdGhlIGlucHV0IHN0cmVhbSB0byByZWFjaCBhIHJlY292ZXJ5IHBvaW50Ci8vIHdoZXJlIG5vcm1hbCB0b2tlbml6aW5nIGNhbiByZXN1bWUuCmZ1bmN0aW9uIGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCkgewogICAgLy8gUmVwZWF0ZWRseSBjb25zdW1lIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgZnJvbSB0aGUgc3RyZWFtOgogICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7CgogICAgICAgIC8vIFUrMDAyOSBSSUdIVCBQQVJFTlRIRVNJUyAoKSkKICAgICAgICAvLyBFT0YKICAgICAgICBpZiAoY29kZSA9PT0gMHgwMDI5KSB7CiAgICAgICAgICAgIC8vIFJldHVybi4KICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQgKyAxKSkpIHsKICAgICAgICAgICAgLy8gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQuCiAgICAgICAgICAgIC8vIE5vdGU6IFRoaXMgYWxsb3dzIGFuIGVzY2FwZWQgcmlnaHQgcGFyZW50aGVzaXMgKCJcKSIpIHRvIGJlIGVuY291bnRlcmVkCiAgICAgICAgICAgIC8vIHdpdGhvdXQgZW5kaW5nIHRoZSA8YmFkLXVybC10b2tlbj4uIFRoaXMgaXMgb3RoZXJ3aXNlIGlkZW50aWNhbCB0bwogICAgICAgICAgICAvLyB0aGUgImFueXRoaW5nIGVsc2UiIGNsYXVzZS4KICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpyA0LjMuNy4gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQKLy8gTm90ZTogVGhpcyBhbGdvcml0aG0gYXNzdW1lcyB0aGF0IGVzY2FwZWQgaXMgdmFsaWQgd2l0aG91dCBsZWFkaW5nIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCmZ1bmN0aW9uIGRlY29kZUVzY2FwZWQoZXNjYXBlZCkgewogICAgLy8gU2luZ2xlIGNoYXIgZXNjYXBlZCB0aGF0J3Mgbm90IGEgaGV4IGRpZ2l0CiAgICBpZiAoZXNjYXBlZC5sZW5ndGggPT09IDEgJiYgIWlzSGV4RGlnaXQoZXNjYXBlZC5jaGFyQ29kZUF0KDApKSkgewogICAgICAgIHJldHVybiBlc2NhcGVkWzBdOwogICAgfQoKICAgIC8vIEludGVycHJldCB0aGUgaGV4IGRpZ2l0cyBhcyBhIGhleGFkZWNpbWFsIG51bWJlci4KICAgIGxldCBjb2RlID0gcGFyc2VJbnQoZXNjYXBlZCwgMTYpOwoKICAgIGlmICgKICAgICAgICAoY29kZSA9PT0gMCkgfHwgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgbnVtYmVyIGlzIHplcm8sCiAgICAgICAgKGNvZGUgPj0gMHhEODAwICYmIGNvZGUgPD0gMHhERkZGKSB8fCAvLyBvciBpcyBmb3IgYSBzdXJyb2dhdGUsCiAgICAgICAgKGNvZGUgPiAweDEwRkZGRikgICAgICAgICAgICAgICAgICAgICAvLyBvciBpcyBncmVhdGVyIHRoYW4gdGhlIG1heGltdW0gYWxsb3dlZCBjb2RlIHBvaW50CiAgICApIHsKICAgICAgICAvLyAuLi4gcmV0dXJuIFUrRkZGRCBSRVBMQUNFTUVOVCBDSEFSQUNURVIKICAgICAgICBjb2RlID0gMHhGRkZEOwogICAgfQoKICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIHRoZSBjb2RlIHBvaW50IHdpdGggdGhhdCB2YWx1ZS4KICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKfQoKY29uc3QgdG9rZW5OYW1lcyA9IFsKICAgICdFT0YtdG9rZW4nLAogICAgJ2lkZW50LXRva2VuJywKICAgICdmdW5jdGlvbi10b2tlbicsCiAgICAnYXQta2V5d29yZC10b2tlbicsCiAgICAnaGFzaC10b2tlbicsCiAgICAnc3RyaW5nLXRva2VuJywKICAgICdiYWQtc3RyaW5nLXRva2VuJywKICAgICd1cmwtdG9rZW4nLAogICAgJ2JhZC11cmwtdG9rZW4nLAogICAgJ2RlbGltLXRva2VuJywKICAgICdudW1iZXItdG9rZW4nLAogICAgJ3BlcmNlbnRhZ2UtdG9rZW4nLAogICAgJ2RpbWVuc2lvbi10b2tlbicsCiAgICAnd2hpdGVzcGFjZS10b2tlbicsCiAgICAnQ0RPLXRva2VuJywKICAgICdDREMtdG9rZW4nLAogICAgJ2NvbG9uLXRva2VuJywKICAgICdzZW1pY29sb24tdG9rZW4nLAogICAgJ2NvbW1hLXRva2VuJywKICAgICdbLXRva2VuJywKICAgICddLXRva2VuJywKICAgICcoLXRva2VuJywKICAgICcpLXRva2VuJywKICAgICd7LXRva2VuJywKICAgICd9LXRva2VuJwpdOwoKY29uc3QgTUlOX1NJWkUgPSAxNiAqIDEwMjQ7CgpmdW5jdGlvbiBhZG9wdEJ1ZmZlcihidWZmZXIgPSBudWxsLCBzaXplKSB7CiAgICBpZiAoYnVmZmVyID09PSBudWxsIHx8IGJ1ZmZlci5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVaW50MzJBcnJheShNYXRoLm1heChzaXplICsgMTAyNCwgTUlOX1NJWkUpKTsKICAgIH0KCiAgICByZXR1cm4gYnVmZmVyOwp9Cgpjb25zdCBOJDQgPSAxMDsKY29uc3QgRiQyID0gMTI7CmNvbnN0IFIkMiA9IDEzOwoKZnVuY3Rpb24gY29tcHV0ZUxpbmVzQW5kQ29sdW1ucyhob3N0KSB7CiAgICBjb25zdCBzb3VyY2UgPSBob3N0LnNvdXJjZTsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CiAgICBjb25zdCBzdGFydE9mZnNldCA9IHNvdXJjZS5sZW5ndGggPiAwID8gaXNCT00oc291cmNlLmNoYXJDb2RlQXQoMCkpIDogMDsKICAgIGNvbnN0IGxpbmVzID0gYWRvcHRCdWZmZXIoaG9zdC5saW5lcywgc291cmNlTGVuZ3RoKTsKICAgIGNvbnN0IGNvbHVtbnMgPSBhZG9wdEJ1ZmZlcihob3N0LmNvbHVtbnMsIHNvdXJjZUxlbmd0aCk7CiAgICBsZXQgbGluZSA9IGhvc3Quc3RhcnRMaW5lOwogICAgbGV0IGNvbHVtbiA9IGhvc3Quc3RhcnRDb2x1bW47CgogICAgZm9yIChsZXQgaSA9IHN0YXJ0T2Zmc2V0OyBpIDwgc291cmNlTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGxpbmVzW2ldID0gbGluZTsKICAgICAgICBjb2x1bW5zW2ldID0gY29sdW1uKys7CgogICAgICAgIGlmIChjb2RlID09PSBOJDQgfHwgY29kZSA9PT0gUiQyIHx8IGNvZGUgPT09IEYkMikgewogICAgICAgICAgICBpZiAoY29kZSA9PT0gUiQyICYmIGkgKyAxIDwgc291cmNlTGVuZ3RoICYmIHNvdXJjZS5jaGFyQ29kZUF0KGkgKyAxKSA9PT0gTiQ0KSB7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBsaW5lc1tpXSA9IGxpbmU7CiAgICAgICAgICAgICAgICBjb2x1bW5zW2ldID0gY29sdW1uOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsaW5lKys7CiAgICAgICAgICAgIGNvbHVtbiA9IDE7CiAgICAgICAgfQogICAgfQoKICAgIGxpbmVzW3NvdXJjZUxlbmd0aF0gPSBsaW5lOwogICAgY29sdW1uc1tzb3VyY2VMZW5ndGhdID0gY29sdW1uOwoKICAgIGhvc3QubGluZXMgPSBsaW5lczsKICAgIGhvc3QuY29sdW1ucyA9IGNvbHVtbnM7CiAgICBob3N0LmNvbXB1dGVkID0gdHJ1ZTsKfQoKY2xhc3MgT2Zmc2V0VG9Mb2NhdGlvbiB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmxpbmVzID0gbnVsbDsKICAgICAgICB0aGlzLmNvbHVtbnMgPSBudWxsOwogICAgICAgIHRoaXMuY29tcHV0ZWQgPSBmYWxzZTsKICAgIH0KICAgIHNldFNvdXJjZShzb3VyY2UsIHN0YXJ0T2Zmc2V0ID0gMCwgc3RhcnRMaW5lID0gMSwgc3RhcnRDb2x1bW4gPSAxKSB7CiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5zdGFydE9mZnNldCA9IHN0YXJ0T2Zmc2V0OwogICAgICAgIHRoaXMuc3RhcnRMaW5lID0gc3RhcnRMaW5lOwogICAgICAgIHRoaXMuc3RhcnRDb2x1bW4gPSBzdGFydENvbHVtbjsKICAgICAgICB0aGlzLmNvbXB1dGVkID0gZmFsc2U7CiAgICB9CiAgICBnZXRMb2NhdGlvbihvZmZzZXQsIGZpbGVuYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbXB1dGVMaW5lc0FuZENvbHVtbnModGhpcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2U6IGZpbGVuYW1lLAogICAgICAgICAgICBvZmZzZXQ6IHRoaXMuc3RhcnRPZmZzZXQgKyBvZmZzZXQsCiAgICAgICAgICAgIGxpbmU6IHRoaXMubGluZXNbb2Zmc2V0XSwKICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbnNbb2Zmc2V0XQogICAgICAgIH07CiAgICB9CiAgICBnZXRMb2NhdGlvblJhbmdlKHN0YXJ0LCBlbmQsIGZpbGVuYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbXB1dGVMaW5lc0FuZENvbHVtbnModGhpcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2U6IGZpbGVuYW1lLAogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgb2Zmc2V0OiB0aGlzLnN0YXJ0T2Zmc2V0ICsgc3RhcnQsCiAgICAgICAgICAgICAgICBsaW5lOiB0aGlzLmxpbmVzW3N0YXJ0XSwKICAgICAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5zW3N0YXJ0XQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5zdGFydE9mZnNldCArIGVuZCwKICAgICAgICAgICAgICAgIGxpbmU6IHRoaXMubGluZXNbZW5kXSwKICAgICAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5zW2VuZF0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn0KCmNvbnN0IE9GRlNFVF9NQVNLID0gMHgwMEZGRkZGRjsKY29uc3QgVFlQRV9TSElGVCA9IDI0Owpjb25zdCBiYWxhbmNlUGFpciQxID0gbmV3IE1hcChbCiAgICBbRnVuY3Rpb24kMiwgUmlnaHRQYXJlbnRoZXNpc10sCiAgICBbTGVmdFBhcmVudGhlc2lzLCBSaWdodFBhcmVudGhlc2lzXSwKICAgIFtMZWZ0U3F1YXJlQnJhY2tldCwgUmlnaHRTcXVhcmVCcmFja2V0XSwKICAgIFtMZWZ0Q3VybHlCcmFja2V0LCBSaWdodEN1cmx5QnJhY2tldF0KXSk7CgpjbGFzcyBUb2tlblN0cmVhbSB7CiAgICBjb25zdHJ1Y3Rvcihzb3VyY2UsIHRva2VuaXplKSB7CiAgICAgICAgdGhpcy5zZXRTb3VyY2Uoc291cmNlLCB0b2tlbml6ZSk7CiAgICB9CiAgICByZXNldCgpIHsKICAgICAgICB0aGlzLmVvZiA9IGZhbHNlOwogICAgICAgIHRoaXMudG9rZW5JbmRleCA9IC0xOwogICAgICAgIHRoaXMudG9rZW5UeXBlID0gMDsKICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLmZpcnN0Q2hhck9mZnNldDsKICAgICAgICB0aGlzLnRva2VuRW5kID0gdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICB9CiAgICBzZXRTb3VyY2Uoc291cmNlID0gJycsIHRva2VuaXplID0gKCkgPT4ge30pIHsKICAgICAgICBzb3VyY2UgPSBTdHJpbmcoc291cmNlIHx8ICcnKTsKCiAgICAgICAgY29uc3Qgc291cmNlTGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgICAgICBjb25zdCBvZmZzZXRBbmRUeXBlID0gYWRvcHRCdWZmZXIodGhpcy5vZmZzZXRBbmRUeXBlLCBzb3VyY2UubGVuZ3RoICsgMSk7IC8vICsxIGJlY2F1c2Ugb2YgZW9mLXRva2VuCiAgICAgICAgY29uc3QgYmFsYW5jZSA9IGFkb3B0QnVmZmVyKHRoaXMuYmFsYW5jZSwgc291cmNlLmxlbmd0aCArIDEpOwogICAgICAgIGxldCB0b2tlbkNvdW50ID0gMDsKICAgICAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICAgICAgbGV0IGJhbGFuY2VTdGFydCA9IDA7CiAgICAgICAgbGV0IGZpcnN0Q2hhck9mZnNldCA9IC0xOwoKICAgICAgICAvLyBjYXB0dXJlIGJ1ZmZlcnMKICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGUgPSBudWxsOwogICAgICAgIHRoaXMuYmFsYW5jZSA9IG51bGw7CgogICAgICAgIHRva2VuaXplKHNvdXJjZSwgKHR5cGUsIHN0YXJ0LCBlbmQpID0+IHsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBzb3VyY2VMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBiYWxhbmNlQ2xvc2VUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJhbGFuY2VQcmV2ID0gYmFsYW5jZVN0YXJ0ICYgT0ZGU0VUX01BU0s7CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZVN0YXJ0ID0gYmFsYW5jZVtiYWxhbmNlUHJldl07CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VTdGFydCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlUHJldjsKICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2KytdID0gdG9rZW5Db3VudDsKICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYmFsYW5jZVByZXYgPCB0b2tlbkNvdW50OyBiYWxhbmNlUHJldisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlW2JhbGFuY2VQcmV2XSA9PT0gc291cmNlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2XSA9IHRva2VuQ291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgICAgICBjYXNlIExlZnRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgY2FzZSBMZWZ0Q3VybHlCcmFja2V0OgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VQYWlyJDEuZ2V0KHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFydCA9IChiYWxhbmNlQ2xvc2VUeXBlIDw8IFRZUEVfU0hJRlQpIHwgdG9rZW5Db3VudDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2Zmc2V0QW5kVHlwZVt0b2tlbkNvdW50KytdID0gKHR5cGUgPDwgVFlQRV9TSElGVCkgfCBlbmQ7CiAgICAgICAgICAgIGlmIChmaXJzdENoYXJPZmZzZXQgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBmaXJzdENoYXJPZmZzZXQgPSBzdGFydDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBmaW5hbGl6ZSBidWZmZXJzCiAgICAgICAgb2Zmc2V0QW5kVHlwZVt0b2tlbkNvdW50XSA9IChFT0YkMSA8PCBUWVBFX1NISUZUKSB8IHNvdXJjZUxlbmd0aDsgLy8gPEVPRi10b2tlbj4KICAgICAgICBiYWxhbmNlW3Rva2VuQ291bnRdID0gc291cmNlTGVuZ3RoOwogICAgICAgIGJhbGFuY2Vbc291cmNlTGVuZ3RoXSA9IHNvdXJjZUxlbmd0aDsgLy8gcHJldmVudHMgZmFsc2UgcG9zaXRpdmUgYmFsYW5jZSBtYXRjaCB3aXRoIGFueSB0b2tlbgogICAgICAgIHdoaWxlIChiYWxhbmNlU3RhcnQgIT09IDApIHsKICAgICAgICAgICAgY29uc3QgYmFsYW5jZVByZXYgPSBiYWxhbmNlU3RhcnQgJiBPRkZTRVRfTUFTSzsKICAgICAgICAgICAgYmFsYW5jZVN0YXJ0ID0gYmFsYW5jZVtiYWxhbmNlUHJldl07CiAgICAgICAgICAgIGJhbGFuY2VbYmFsYW5jZVByZXZdID0gc291cmNlTGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5maXJzdENoYXJPZmZzZXQgPSBmaXJzdENoYXJPZmZzZXQgPT09IC0xID8gMCA6IGZpcnN0Q2hhck9mZnNldDsKICAgICAgICB0aGlzLnRva2VuQ291bnQgPSB0b2tlbkNvdW50OwogICAgICAgIHRoaXMub2Zmc2V0QW5kVHlwZSA9IG9mZnNldEFuZFR5cGU7CiAgICAgICAgdGhpcy5iYWxhbmNlID0gYmFsYW5jZTsKCiAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIGxvb2t1cFR5cGUob2Zmc2V0KSB7CiAgICAgICAgb2Zmc2V0ICs9IHRoaXMudG9rZW5JbmRleDsKCiAgICAgICAgaWYgKG9mZnNldCA8IHRoaXMudG9rZW5Db3VudCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXRBbmRUeXBlW29mZnNldF0gPj4gVFlQRV9TSElGVDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBFT0YkMTsKICAgIH0KICAgIGxvb2t1cE9mZnNldChvZmZzZXQpIHsKICAgICAgICBvZmZzZXQgKz0gdGhpcy50b2tlbkluZGV4OwoKICAgICAgICBpZiAob2Zmc2V0IDwgdGhpcy50b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0IC0gMV0gJiBPRkZTRVRfTUFTSzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5sZW5ndGg7CiAgICB9CiAgICBsb29rdXBWYWx1ZShvZmZzZXQsIHJlZmVyZW5jZVN0cikgewogICAgICAgIG9mZnNldCArPSB0aGlzLnRva2VuSW5kZXg7CgogICAgICAgIGlmIChvZmZzZXQgPCB0aGlzLnRva2VuQ291bnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNtcFN0cigKICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRBbmRUeXBlW29mZnNldCAtIDFdICYgT0ZGU0VUX01BU0ssCiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0XSAmIE9GRlNFVF9NQVNLLAogICAgICAgICAgICAgICAgcmVmZXJlbmNlU3RyCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBnZXRUb2tlblN0YXJ0KHRva2VuSW5kZXgpIHsKICAgICAgICBpZiAodG9rZW5JbmRleCA9PT0gdGhpcy50b2tlbkluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRva2VuU3RhcnQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW5JbmRleCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRva2VuSW5kZXggPCB0aGlzLnRva2VuQ291bnQKICAgICAgICAgICAgICAgID8gdGhpcy5vZmZzZXRBbmRUeXBlW3Rva2VuSW5kZXggLSAxXSAmIE9GRlNFVF9NQVNLCiAgICAgICAgICAgICAgICA6IHRoaXMub2Zmc2V0QW5kVHlwZVt0aGlzLnRva2VuQ291bnRdICYgT0ZGU0VUX01BU0s7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICB9CiAgICBzdWJzdHJUb0N1cnNvcihzdGFydCkgewogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHRoaXMudG9rZW5TdGFydCk7CiAgICB9CgogICAgaXNCYWxhbmNlRWRnZShwb3MpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlW3RoaXMudG9rZW5JbmRleF0gPCBwb3M7CiAgICB9CiAgICBpc0RlbGltKGNvZGUsIG9mZnNldCkgewogICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIHRoaXMubG9va3VwVHlwZShvZmZzZXQpID09PSBEZWxpbSAmJgogICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmxvb2t1cE9mZnNldChvZmZzZXQpKSA9PT0gY29kZQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgdGhpcy50b2tlblR5cGUgPT09IERlbGltICYmCiAgICAgICAgICAgIHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KSA9PT0gY29kZQogICAgICAgICk7CiAgICB9CgogICAgc2tpcCh0b2tlbkNvdW50KSB7CiAgICAgICAgbGV0IG5leHQgPSB0aGlzLnRva2VuSW5kZXggKyB0b2tlbkNvdW50OwoKICAgICAgICBpZiAobmV4dCA8IHRoaXMudG9rZW5Db3VudCkgewogICAgICAgICAgICB0aGlzLnRva2VuSW5kZXggPSBuZXh0OwogICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dCAtIDFdICYgT0ZGU0VUX01BU0s7CiAgICAgICAgICAgIG5leHQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dF07CiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gbmV4dCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICB0aGlzLnRva2VuRW5kID0gbmV4dCAmIE9GRlNFVF9NQVNLOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IHRoaXMudG9rZW5Db3VudDsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgfQogICAgfQogICAgbmV4dCgpIHsKICAgICAgICBsZXQgbmV4dCA9IHRoaXMudG9rZW5JbmRleCArIDE7CgogICAgICAgIGlmIChuZXh0IDwgdGhpcy50b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IG5leHQ7CiAgICAgICAgICAgIHRoaXMudG9rZW5TdGFydCA9IHRoaXMudG9rZW5FbmQ7CiAgICAgICAgICAgIG5leHQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dF07CiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gbmV4dCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICB0aGlzLnRva2VuRW5kID0gbmV4dCAmIE9GRlNFVF9NQVNLOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy50b2tlbkluZGV4ID0gdGhpcy50b2tlbkNvdW50OwogICAgICAgICAgICB0aGlzLnRva2VuVHlwZSA9IEVPRiQxOwogICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLnRva2VuRW5kID0gdGhpcy5zb3VyY2UubGVuZ3RoOwogICAgICAgIH0KICAgIH0KICAgIHNraXBTQygpIHsKICAgICAgICB3aGlsZSAodGhpcy50b2tlblR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0aGlzLnRva2VuVHlwZSA9PT0gQ29tbWVudCQxKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIH0KICAgIH0KICAgIHNraXBVbnRpbEJhbGFuY2VkKHN0YXJ0VG9rZW4sIHN0b3BDb25zdW1lKSB7CiAgICAgICAgbGV0IGN1cnNvciA9IHN0YXJ0VG9rZW47CiAgICAgICAgbGV0IGJhbGFuY2VFbmQ7CiAgICAgICAgbGV0IG9mZnNldDsKCiAgICAgICAgbG9vcDoKICAgICAgICBmb3IgKDsgY3Vyc29yIDwgdGhpcy50b2tlbkNvdW50OyBjdXJzb3IrKykgewogICAgICAgICAgICBiYWxhbmNlRW5kID0gdGhpcy5iYWxhbmNlW2N1cnNvcl07CgogICAgICAgICAgICAvLyBzdG9wIHNjYW5uaW5nIG9uIGJhbGFuY2UgZWRnZSB0aGF0IHBvaW50cyB0byBvZmZzZXQgYmVmb3JlIHN0YXJ0IHRva2VuCiAgICAgICAgICAgIGlmIChiYWxhbmNlRW5kIDwgc3RhcnRUb2tlbikgewogICAgICAgICAgICAgICAgYnJlYWsgbG9vcDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2Zmc2V0ID0gY3Vyc29yID4gMCA/IHRoaXMub2Zmc2V0QW5kVHlwZVtjdXJzb3IgLSAxXSAmIE9GRlNFVF9NQVNLIDogdGhpcy5maXJzdENoYXJPZmZzZXQ7CgogICAgICAgICAgICAvLyBjaGVjayBzdG9wIGNvbmRpdGlvbgogICAgICAgICAgICBzd2l0Y2ggKHN0b3BDb25zdW1lKHRoaXMuc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSkpIHsKICAgICAgICAgICAgICAgIGNhc2UgMTogLy8ganVzdCBzdG9wCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgbG9vcDsKCiAgICAgICAgICAgICAgICBjYXNlIDI6IC8vIHN0b3AgJiBpbmNsdWRlZAogICAgICAgICAgICAgICAgICAgIGN1cnNvcisrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIGxvb3A7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAvLyBmYXN0IGZvcndhcmQgdG8gdGhlIGVuZCBvZiBiYWxhbmNlZCBibG9jawogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbGFuY2VbYmFsYW5jZUVuZF0gPT09IGN1cnNvcikgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IgPSBiYWxhbmNlRW5kOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5za2lwKGN1cnNvciAtIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgZm9yRWFjaFRva2VuKGZuKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG9mZnNldCA9IHRoaXMuZmlyc3RDaGFyT2Zmc2V0OyBpIDwgdGhpcy50b2tlbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBvZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLm9mZnNldEFuZFR5cGVbaV07CiAgICAgICAgICAgIGNvbnN0IGVuZCA9IGl0ZW0gJiBPRkZTRVRfTUFTSzsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGl0ZW0gPj4gVFlQRV9TSElGVDsKCiAgICAgICAgICAgIG9mZnNldCA9IGVuZDsKCiAgICAgICAgICAgIGZuKHR5cGUsIHN0YXJ0LCBlbmQsIGkpOwogICAgICAgIH0KICAgIH0KICAgIGR1bXAoKSB7CiAgICAgICAgY29uc3QgdG9rZW5zID0gbmV3IEFycmF5KHRoaXMudG9rZW5Db3VudCk7CgogICAgICAgIHRoaXMuZm9yRWFjaFRva2VuKCh0eXBlLCBzdGFydCwgZW5kLCBpbmRleCkgPT4gewogICAgICAgICAgICB0b2tlbnNbaW5kZXhdID0gewogICAgICAgICAgICAgICAgaWR4OiBpbmRleCwKICAgICAgICAgICAgICAgIHR5cGU6IHRva2VuTmFtZXNbdHlwZV0sCiAgICAgICAgICAgICAgICBjaHVuazogdGhpcy5zb3VyY2Uuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpLAogICAgICAgICAgICAgICAgYmFsYW5jZTogdGhpcy5iYWxhbmNlW2luZGV4XQogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdG9rZW5zOwogICAgfQp9CgpmdW5jdGlvbiB0b2tlbml6ZSQxKHNvdXJjZSwgb25Ub2tlbikgewogICAgZnVuY3Rpb24gZ2V0Q2hhckNvZGUob2Zmc2V0KSB7CiAgICAgICAgcmV0dXJuIG9mZnNldCA8IHNvdXJjZUxlbmd0aCA/IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkgOiAwOwogICAgfQoKICAgIC8vIMKnIDQuMy4zLiBDb25zdW1lIGEgbnVtZXJpYyB0b2tlbgogICAgZnVuY3Rpb24gY29uc3VtZU51bWVyaWNUb2tlbigpIHsKICAgICAgICAvLyBDb25zdW1lIGEgbnVtYmVyIGFuZCBsZXQgbnVtYmVyIGJlIHRoZSByZXN1bHQuCiAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU51bWJlciQxKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gSWYgdGhlIG5leHQgMyBpbnB1dCBjb2RlIHBvaW50cyB3b3VsZCBzdGFydCBhbiBpZGVudGlmaWVyLCB0aGVuOgogICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIDxkaW1lbnNpb24tdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYW5kIHR5cGUgZmxhZyBhcyBudW1iZXIsIGFuZCBhIHVuaXQgc2V0IGluaXRpYWxseSB0byB0aGUgZW1wdHkgc3RyaW5nLgogICAgICAgICAgICAvLyBDb25zdW1lIGEgbmFtZS4gU2V0IHRoZSA8ZGltZW5zaW9uLXRva2VuPuKAmXMgdW5pdCB0byB0aGUgcmV0dXJuZWQgdmFsdWUuCiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgPGRpbWVuc2lvbi10b2tlbj4uCiAgICAgICAgICAgIHR5cGUgPSBEaW1lbnNpb24kMTsKICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgVSswMDI1IFBFUkNFTlRBR0UgU0lHTiAoJSksIGNvbnN1bWUgaXQuCiAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCkgPT09IDB4MDAyNSkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSA8cGVyY2VudGFnZS10b2tlbj4gd2l0aCB0aGUgc2FtZSB2YWx1ZSBhcyBudW1iZXIsIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgIHR5cGUgPSBQZXJjZW50YWdlJDE7CiAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UsIGNyZWF0ZSBhIDxudW1iZXItdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYW5kIHR5cGUgZmxhZyBhcyBudW1iZXIsIGFuZCByZXR1cm4gaXQuCiAgICAgICAgdHlwZSA9IE51bWJlciQyOwogICAgfQoKICAgIC8vIMKnIDQuMy40LiBDb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4KICAgIGZ1bmN0aW9uIGNvbnN1bWVJZGVudExpa2VUb2tlbigpIHsKICAgICAgICBjb25zdCBuYW1lU3RhcnRPZmZzZXQgPSBvZmZzZXQ7CgogICAgICAgIC8vIENvbnN1bWUgYSBuYW1lLCBhbmQgbGV0IHN0cmluZyBiZSB0aGUgcmVzdWx0LgogICAgICAgIG9mZnNldCA9IGNvbnN1bWVOYW1lKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gSWYgc3RyaW5n4oCZcyB2YWx1ZSBpcyBhbiBBU0NJSSBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoIGZvciAidXJsIiwKICAgICAgICAvLyBhbmQgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCksIGNvbnN1bWUgaXQuCiAgICAgICAgaWYgKGNtcFN0cihzb3VyY2UsIG5hbWVTdGFydE9mZnNldCwgb2Zmc2V0LCAndXJsJykgJiYgZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7CiAgICAgICAgICAgIC8vIFdoaWxlIHRoZSBuZXh0IHR3byBpbnB1dCBjb2RlIHBvaW50cyBhcmUgd2hpdGVzcGFjZSwgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICBvZmZzZXQgPSBmaW5kV2hpdGVTcGFjZUVuZChzb3VyY2UsIG9mZnNldCArIDEpOwoKICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgb25lIG9yIHR3byBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDIyIFFVT1RBVElPTiBNQVJLICgiKSwgVSswMDI3IEFQT1NUUk9QSEUgKCcpLAogICAgICAgICAgICAvLyBvciB3aGl0ZXNwYWNlIGZvbGxvd2VkIGJ5IFUrMDAyMiBRVU9UQVRJT04gTUFSSyAoIikgb3IgVSswMDI3IEFQT1NUUk9QSEUgKCcpLAogICAgICAgICAgICAvLyB0aGVuIGNyZWF0ZSBhIDxmdW5jdGlvbi10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHN0cmluZyBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDIyIHx8CiAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjcpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSBGdW5jdGlvbiQyOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gbmFtZVN0YXJ0T2Zmc2V0ICsgNDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBjb25zdW1lIGEgdXJsIHRva2VuLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICBjb25zdW1lVXJsVG9rZW4oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIFUrMDAyOCBMRUZUIFBBUkVOVEhFU0lTICgoKSwgY29uc3VtZSBpdC4KICAgICAgICAvLyBDcmVhdGUgYSA8ZnVuY3Rpb24tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byBzdHJpbmcgYW5kIHJldHVybiBpdC4KICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7CiAgICAgICAgICAgIHR5cGUgPSBGdW5jdGlvbiQyOwogICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYW4gPGlkZW50LXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gc3RyaW5nIGFuZCByZXR1cm4gaXQuCiAgICAgICAgdHlwZSA9IElkZW50OwogICAgfQoKICAgIC8vIMKnIDQuMy41LiBDb25zdW1lIGEgc3RyaW5nIHRva2VuCiAgICBmdW5jdGlvbiBjb25zdW1lU3RyaW5nVG9rZW4oZW5kaW5nQ29kZVBvaW50KSB7CiAgICAgICAgLy8gVGhpcyBhbGdvcml0aG0gbWF5IGJlIGNhbGxlZCB3aXRoIGFuIGVuZGluZyBjb2RlIHBvaW50LCB3aGljaCBkZW5vdGVzIHRoZSBjb2RlIHBvaW50CiAgICAgICAgLy8gdGhhdCBlbmRzIHRoZSBzdHJpbmcuIElmIGFuIGVuZGluZyBjb2RlIHBvaW50IGlzIG5vdCBzcGVjaWZpZWQsCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCBpcyB1c2VkLgogICAgICAgIGlmICghZW5kaW5nQ29kZVBvaW50KSB7CiAgICAgICAgICAgIGVuZGluZ0NvZGVQb2ludCA9IGdldENoYXJDb2RlKG9mZnNldCsrKTsKICAgICAgICB9CgogICAgICAgIC8vIEluaXRpYWxseSBjcmVhdGUgYSA8c3RyaW5nLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGVtcHR5IHN0cmluZy4KICAgICAgICB0eXBlID0gU3RyaW5nJDI7CgogICAgICAgIC8vIFJlcGVhdGVkbHkgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGZyb20gdGhlIHN0cmVhbToKICAgICAgICBmb3IgKDsgb2Zmc2V0IDwgc291cmNlLmxlbmd0aDsgb2Zmc2V0KyspIHsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7CgogICAgICAgICAgICBzd2l0Y2ggKGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkpIHsKICAgICAgICAgICAgICAgIC8vIGVuZGluZyBjb2RlIHBvaW50CiAgICAgICAgICAgICAgICBjYXNlIGVuZGluZ0NvZGVQb2ludDoKICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIDxzdHJpbmctdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gRU9GCiAgICAgICAgICAgICAgICAgICAgLy8gY2FzZSBFb2ZDYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgcGFyc2UgZXJyb3IuIFJldHVybiB0aGUgPHN0cmluZy10b2tlbj4uCiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIG5ld2xpbmUKICAgICAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZUNhdGVnb3J5OgogICAgICAgICAgICAgICAgICAgIGlmIChpc05ld2xpbmUoY29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC1zdHJpbmctdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCwgY29kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBCYWRTdHJpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDVDOgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgRU9GLCBkbyBub3RoaW5nLgogICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPT09IHNvdXJjZS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dENvZGUgPSBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgbmV3bGluZSwgY29uc3VtZSBpdC4KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXdsaW5lKG5leHRDb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCArIDEsIG5leHRDb2RlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgbmV4dENvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgKHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUpIGNvbnN1bWUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW4gZXNjYXBlZCBjb2RlIHBvaW50IGFuZCBhcHBlbmQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIDxzdHJpbmctdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpIC0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQgdG8gdGhlIDxzdHJpbmctdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyDCpyA0LjMuNi4gQ29uc3VtZSBhIHVybCB0b2tlbgogICAgLy8gTm90ZTogVGhpcyBhbGdvcml0aG0gYXNzdW1lcyB0aGF0IHRoZSBpbml0aWFsICJ1cmwoIiBoYXMgYWxyZWFkeSBiZWVuIGNvbnN1bWVkLgogICAgLy8gVGhpcyBhbGdvcml0aG0gYWxzbyBhc3N1bWVzIHRoYXQgaXTigJlzIGJlaW5nIGNhbGxlZCB0byBjb25zdW1lIGFuICJ1bnF1b3RlZCIgdmFsdWUsIGxpa2UgdXJsKGZvbykuCiAgICAvLyBBIHF1b3RlZCB2YWx1ZSwgbGlrZSB1cmwoImZvbyIpLCBpcyBwYXJzZWQgYXMgYSA8ZnVuY3Rpb24tdG9rZW4+LiBDb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4KICAgIC8vIGF1dG9tYXRpY2FsbHkgaGFuZGxlcyB0aGlzIGRpc3RpbmN0aW9uOyB0aGlzIGFsZ29yaXRobSBzaG91bGRu4oCZdCBiZSBjYWxsZWQgZGlyZWN0bHkgb3RoZXJ3aXNlLgogICAgZnVuY3Rpb24gY29uc3VtZVVybFRva2VuKCkgewogICAgICAgIC8vIEluaXRpYWxseSBjcmVhdGUgYSA8dXJsLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGVtcHR5IHN0cmluZy4KICAgICAgICB0eXBlID0gVXJsJDE7CgogICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLgogICAgICAgIG9mZnNldCA9IGZpbmRXaGl0ZVNwYWNlRW5kKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gUmVwZWF0ZWRseSBjb25zdW1lIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgZnJvbSB0aGUgc3RyZWFtOgogICAgICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgICAgICBjb25zdCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAgICAgICAgIHN3aXRjaCAoY2hhckNvZGVDYXRlZ29yeShjb2RlKSkgewogICAgICAgICAgICAgICAgLy8gVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKQogICAgICAgICAgICAgICAgY2FzZSAweDAwMjk6CiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSA8dXJsLXRva2VuPi4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIC8vIEVPRgogICAgICAgICAgICAgICAgICAgIC8vIGNhc2UgRW9mQ2F0ZWdvcnk6CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gdGhlIDx1cmwtdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIC8vIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyB3aGl0ZXNwYWNlCiAgICAgICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2VDYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICAvLyBDb25zdW1lIGFzIG11Y2ggd2hpdGVzcGFjZSBhcyBwb3NzaWJsZS4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBmaW5kV2hpdGVTcGFjZUVuZChzb3VyY2UsIG9mZnNldCk7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKSBvciBFT0YsCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc3VtZSBpdCBhbmQgcmV0dXJuIHRoZSA8dXJsLXRva2VuPgogICAgICAgICAgICAgICAgICAgIC8vIChpZiBFT0Ygd2FzIGVuY291bnRlcmVkLCB0aGlzIGlzIGEgcGFyc2UgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjkgfHwgb2Zmc2V0ID49IHNvdXJjZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldCA8IHNvdXJjZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgY29uc3VtZSB0aGUgcmVtbmFudHMgb2YgYSBiYWQgdXJsLCBjcmVhdGUgYSA8YmFkLXVybC10b2tlbj4sCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lQmFkVXJsUmVtbmFudHMoc291cmNlLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBCYWRVcmw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIFUrMDAyMiBRVU9UQVRJT04gTUFSSyAoIikKICAgICAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKQogICAgICAgICAgICAgICAgLy8gVSswMDI4IExFRlQgUEFSRU5USEVTSVMgKCgpCiAgICAgICAgICAgICAgICAvLyBub24tcHJpbnRhYmxlIGNvZGUgcG9pbnQKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOgogICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICBjYXNlIDB4MDAyODoKICAgICAgICAgICAgICAgIGNhc2UgTm9uUHJpbnRhYmxlQ2F0ZWdvcnk6CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBDb25zdW1lIHRoZSByZW1uYW50cyBvZiBhIGJhZCB1cmwsCiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEJhZFVybDsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDVDOgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUsIGNvbnN1bWUgYW4gZXNjYXBlZCBjb2RlIHBvaW50IGFuZAogICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZCB0aGUgcmV0dXJuZWQgY29kZSBwb2ludCB0byB0aGUgPHVybC10b2tlbj7igJlzIHZhbHVlLgogICAgICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkRXNjYXBlKGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lRXNjYXBlZChzb3VyY2UsIG9mZnNldCkgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBpcyBhIHBhcnNlIGVycm9yLiBDb25zdW1lIHRoZSByZW1uYW50cyBvZiBhIGJhZCB1cmwsCiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEJhZFVybDsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQgdG8gdGhlIDx1cmwtdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBlbnN1cmUgc291cmNlIGlzIGEgc3RyaW5nCiAgICBzb3VyY2UgPSBTdHJpbmcoc291cmNlIHx8ICcnKTsKCiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBzb3VyY2UubGVuZ3RoOwogICAgbGV0IHN0YXJ0ID0gaXNCT00oZ2V0Q2hhckNvZGUoMCkpOwogICAgbGV0IG9mZnNldCA9IHN0YXJ0OwogICAgbGV0IHR5cGU7CgogICAgLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgtMy8jY29uc3VtZS10b2tlbgogICAgLy8gwqcgNC4zLjEuIENvbnN1bWUgYSB0b2tlbgogICAgd2hpbGUgKG9mZnNldCA8IHNvdXJjZUxlbmd0aCkgewogICAgICAgIGNvbnN0IGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpOwoKICAgICAgICBzd2l0Y2ggKGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkpIHsKICAgICAgICAgICAgLy8gd2hpdGVzcGFjZQogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2VDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLiBSZXR1cm4gYSA8d2hpdGVzcGFjZS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gV2hpdGVTcGFjZSQxOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gZmluZFdoaXRlU3BhY2VFbmQoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDIyIFFVT1RBVElPTiBNQVJLICgiKQogICAgICAgICAgICBjYXNlIDB4MDAyMjoKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYSBzdHJpbmcgdG9rZW4gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGNvbnN1bWVTdHJpbmdUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMjMgTlVNQkVSIFNJR04gKCMpCiAgICAgICAgICAgIGNhc2UgMHgwMDIzOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBhIG5hbWUgY29kZSBwb2ludCBvciB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlLCB0aGVuOgogICAgICAgICAgICAgICAgaWYgKGlzTmFtZShnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSkgfHwgaXNWYWxpZEVzY2FwZShnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPGhhc2gtdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBIYXNoJDE7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IDMgaW5wdXQgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYW4gaWRlbnRpZmllciwgc2V0IHRoZSA8aGFzaC10b2tlbj7igJlzIHR5cGUgZmxhZyB0byAiaWQiLgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMiksIGdldENoYXJDb2RlKG9mZnNldCArIDMpKSkgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAvLyBUT0RPOiBzZXQgaWQgZmxhZwogICAgICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gQ29uc3VtZSBhIG5hbWUsIGFuZCBzZXQgdGhlIDxoYXNoLXRva2VuPuKAmXMgdmFsdWUgdG8gdGhlIHJldHVybmVkIHN0cmluZy4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lTmFtZShzb3VyY2UsIG9mZnNldCArIDEpOwoKICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIDxoYXNoLXRva2VuPi4KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKQogICAgICAgICAgICBjYXNlIDB4MDAyNzoKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYSBzdHJpbmcgdG9rZW4gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGNvbnN1bWVTdHJpbmdUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCkKICAgICAgICAgICAgY2FzZSAweDAwMjg6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8KC10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gTGVmdFBhcmVudGhlc2lzOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyOSBSSUdIVCBQQVJFTlRIRVNJUyAoKSkKICAgICAgICAgICAgY2FzZSAweDAwMjk6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8KS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gUmlnaHRQYXJlbnRoZXNpczsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgICAgICAgICBjYXNlIDB4MDAyQjoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIC4uLgogICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyU3RhcnQoY29kZSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSksIGdldENoYXJDb2RlKG9mZnNldCArIDIpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiByZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwgY29uc3VtZSBhIG51bWVyaWMgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHJldHVybiBhIDxkZWxpbS10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkMgQ09NTUEgKCwpCiAgICAgICAgICAgIGNhc2UgMHgwMDJDOgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPGNvbW1hLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBDb21tYTsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKQogICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGlmIChpc051bWJlclN0YXJ0KGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdW1lTnVtZXJpY1Rva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIG5leHQgMiBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDJEIEhZUEhFTi1NSU5VUyBVKzAwM0UgR1JFQVRFUi1USEFOIFNJR04gKC0+KSwgY29uc3VtZSB0aGVtIGFuZCByZXR1cm4gYSA8Q0RDLXRva2VuPi4KICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSkgPT09IDB4MDAyRCAmJgogICAgICAgICAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSA9PT0gMHgwMDNFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDREMkMTsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYW4gaWRlbnRpZmllciwgLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi4gcmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYW4gaWRlbnQtbGlrZSB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVJZGVudExpa2VUb2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pCiAgICAgICAgICAgIGNhc2UgMHgwMDJFOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGlucHV0IHN0cmVhbSBzdGFydHMgd2l0aCBhIG51bWJlciwgLi4uCiAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXJTdGFydChjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICBjb25zdW1lTnVtZXJpY1Rva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4KICAgICAgICAgICAgICAgICAgICB0eXBlID0gRGVsaW07CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKICAgICAgICAgICAgY2FzZSAweDAwMkY6CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludCBhcmUgVSswMDJGIFNPTElEVVMgKC8pIGZvbGxvd2VkIGJ5IGEgVSswMDJBIEFTVEVSSVNLICgqKSwKICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSA9PT0gMHgwMDJBKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIGNvbnN1bWUgdGhlbSBhbmQgYWxsIGZvbGxvd2luZyBjb2RlIHBvaW50cyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBmaXJzdCBVKzAwMkEgQVNURVJJU0sgKCopCiAgICAgICAgICAgICAgICAgICAgLy8gZm9sbG93ZWQgYnkgYSBVKzAwMkYgU09MSURVUyAoLyksIG9yIHVwIHRvIGFuIEVPRiBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDb21tZW50JDE7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gc291cmNlLmluZGV4T2YoJyovJywgb2Zmc2V0ICsgMik7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID09PSAtMSA/IHNvdXJjZS5sZW5ndGggOiBvZmZzZXQgKyAyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gRGVsaW07CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQSBDT0xPTiAoOikKICAgICAgICAgICAgY2FzZSAweDAwM0E6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8Y29sb24tdG9rZW4+LgogICAgICAgICAgICAgICAgdHlwZSA9IENvbG9uOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQiBTRU1JQ09MT04gKDspCiAgICAgICAgICAgIGNhc2UgMHgwMDNCOgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPHNlbWljb2xvbi10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gU2VtaWNvbG9uOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQyBMRVNTLVRIQU4gU0lHTiAoPCkKICAgICAgICAgICAgY2FzZSAweDAwM0M6CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCAzIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyBVKzAwMkQgSFlQSEVOLU1JTlVTIFUrMDAyRCBIWVBIRU4tTUlOVVMgKCEtLSksIC4uLgogICAgICAgICAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCArIDEpID09PSAweDAwMjEgJiYKICAgICAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSA9PT0gMHgwMDJEICYmCiAgICAgICAgICAgICAgICAgICAgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMykgPT09IDB4MDAyRCkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiBjb25zdW1lIHRoZW0gYW5kIHJldHVybiBhIDxDRE8tdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDRE8kMTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHJldHVybiBhIDxkZWxpbS10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDQwIENPTU1FUkNJQUwgQVQgKEApCiAgICAgICAgICAgIGNhc2UgMHgwMDQwOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgMyBpbnB1dCBjb2RlIHBvaW50cyB3b3VsZCBzdGFydCBhbiBpZGVudGlmaWVyLCAuLi4KICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMiksIGdldENoYXJDb2RlKG9mZnNldCArIDMpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiBjb25zdW1lIGEgbmFtZSwgY3JlYXRlIGFuIDxhdC1rZXl3b3JkLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIHJldHVybmVkIHZhbHVlLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBBdEtleXdvcmQ7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDA1QiBMRUZUIFNRVUFSRSBCUkFDS0VUIChbKQogICAgICAgICAgICBjYXNlIDB4MDA1QjoKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxbLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBMZWZ0U3F1YXJlQnJhY2tldDsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQogICAgICAgICAgICBjYXNlIDB4MDA1QzoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUsIC4uLgogICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSkpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZUlkZW50TGlrZVRva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDVEIFJJR0hUIFNRVUFSRSBCUkFDS0VUIChdKQogICAgICAgICAgICBjYXNlIDB4MDA1RDoKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxdLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBSaWdodFNxdWFyZUJyYWNrZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDdCIExFRlQgQ1VSTFkgQlJBQ0tFVCAoeykKICAgICAgICAgICAgY2FzZSAweDAwN0I6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8ey10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gTGVmdEN1cmx5QnJhY2tldDsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwN0QgUklHSFQgQ1VSTFkgQlJBQ0tFVCAofSkKICAgICAgICAgICAgY2FzZSAweDAwN0Q6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8fS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gUmlnaHRDdXJseUJyYWNrZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gZGlnaXQKICAgICAgICAgICAgY2FzZSBEaWdpdENhdGVnb3J5OgogICAgICAgICAgICAgICAgLy8gUmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYSBudW1lcmljIHRva2VuLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnQKICAgICAgICAgICAgY2FzZSBOYW1lU3RhcnRDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIFJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICBjb25zdW1lSWRlbnRMaWtlVG9rZW4oKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIC8vIEVPRgogICAgICAgICAgICAgICAgLy8gY2FzZSBFb2ZDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhbiA8RU9GLXRva2VuPi4KICAgICAgICAgICAgICAgIC8vIGJyZWFrOwoKICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4KICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgIH0KCiAgICAgICAgLy8gcHV0IHRva2VuIHRvIHN0cmVhbQogICAgICAgIG9uVG9rZW4odHlwZSwgc3RhcnQsIHN0YXJ0ID0gb2Zmc2V0KTsKICAgIH0KfQoKLy8KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkAovLyAgICAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilLzilIBoZWFkIOKUggovLyAgICAgICAgICAgICDilIIgICAgICAgICAgICAgIOKUgiB0YWls4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQCi8vICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgICAgICAgICAgICDilIIKLy8gICAgICAgICAgICAg4pa8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pa8Ci8vICAgICAgICAgICAgaXRlbSAgICAgICAgaXRlbSAgICAgICAgaXRlbSAgICAgICAgaXRlbQovLyAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSQICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkCAgICDilIzilIDilIDilIDilIDilIDilIDilJAKLy8gIG51bGwg4peA4pSA4pSA4pS84pSAcHJldiDilILil4DilIDilIDilIDilLzilIBwcmV2IOKUguKXgOKUgOKUgOKUgOKUvOKUgHByZXYg4pSC4peA4pSA4pSA4pSA4pS84pSAcHJldiDilIIKLy8gICAgICAgICAg4pSCIG5leHTilIDilLzilIDilIDilIDilrbilIIgbmV4dOKUgOKUvOKUgOKUgOKUgOKWtuKUgiBuZXh04pSA4pS84pSA4pSA4pSA4pa24pSCIG5leHTilIDilLzilIDilIDilrYgbnVsbAovLyAgICAgICAgICDilJzilIDilIDilIDilIDilIDilIDilKQgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSkICAgIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUpCAgICDilJzilIDilIDilIDilIDilIDilIDilKQKLy8gICAgICAgICAg4pSCIGRhdGEg4pSCICAgIOKUgiBkYXRhIOKUgiAgICDilIIgZGF0YSDilIIgICAg4pSCIGRhdGEg4pSCCi8vICAgICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilIDilIDilJggICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUmAovLwoKbGV0IHJlbGVhc2VkQ3Vyc29ycyA9IG51bGw7CgpjbGFzcyBMaXN0IHsKICAgIHN0YXRpYyBjcmVhdGVJdGVtKGRhdGEpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcmV2OiBudWxsLAogICAgICAgICAgICBuZXh0OiBudWxsLAogICAgICAgICAgICBkYXRhCiAgICAgICAgfTsKICAgIH0KCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgICAgIHRoaXMudGFpbCA9IG51bGw7CiAgICAgICAgdGhpcy5jdXJzb3IgPSBudWxsOwogICAgfQogICAgY3JlYXRlSXRlbShkYXRhKSB7CiAgICAgICAgcmV0dXJuIExpc3QuY3JlYXRlSXRlbShkYXRhKTsKICAgIH0KCiAgICAvLyBjdXJzb3IgaGVscGVycwogICAgYWxsb2NhdGVDdXJzb3IocHJldiwgbmV4dCkgewogICAgICAgIGxldCBjdXJzb3I7CgogICAgICAgIGlmIChyZWxlYXNlZEN1cnNvcnMgIT09IG51bGwpIHsKICAgICAgICAgICAgY3Vyc29yID0gcmVsZWFzZWRDdXJzb3JzOwogICAgICAgICAgICByZWxlYXNlZEN1cnNvcnMgPSByZWxlYXNlZEN1cnNvcnMuY3Vyc29yOwogICAgICAgICAgICBjdXJzb3IucHJldiA9IHByZXY7CiAgICAgICAgICAgIGN1cnNvci5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgY3Vyc29yLmN1cnNvciA9IHRoaXMuY3Vyc29yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnNvciA9IHsKICAgICAgICAgICAgICAgIHByZXYsCiAgICAgICAgICAgICAgICBuZXh0LAogICAgICAgICAgICAgICAgY3Vyc29yOiB0aGlzLmN1cnNvcgogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jdXJzb3IgPSBjdXJzb3I7CgogICAgICAgIHJldHVybiBjdXJzb3I7CiAgICB9CiAgICByZWxlYXNlQ3Vyc29yKCkgewogICAgICAgIGNvbnN0IHsgY3Vyc29yIH0gPSB0aGlzOwoKICAgICAgICB0aGlzLmN1cnNvciA9IGN1cnNvci5jdXJzb3I7CiAgICAgICAgY3Vyc29yLnByZXYgPSBudWxsOwogICAgICAgIGN1cnNvci5uZXh0ID0gbnVsbDsKICAgICAgICBjdXJzb3IuY3Vyc29yID0gcmVsZWFzZWRDdXJzb3JzOwogICAgICAgIHJlbGVhc2VkQ3Vyc29ycyA9IGN1cnNvcjsKICAgIH0KICAgIHVwZGF0ZUN1cnNvcnMocHJldk9sZCwgcHJldk5ldywgbmV4dE9sZCwgbmV4dE5ldykgewogICAgICAgIGxldCB7IGN1cnNvciB9ID0gdGhpczsKCiAgICAgICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoY3Vyc29yLnByZXYgPT09IHByZXZPbGQpIHsKICAgICAgICAgICAgICAgIGN1cnNvci5wcmV2ID0gcHJldk5ldzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnNvci5uZXh0ID09PSBuZXh0T2xkKSB7CiAgICAgICAgICAgICAgICBjdXJzb3IubmV4dCA9IG5leHROZXc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnNvciA9IGN1cnNvci5jdXJzb3I7CiAgICAgICAgfQogICAgfQogICAgKltTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgICAgIGZvciAobGV0IGN1cnNvciA9IHRoaXMuaGVhZDsgY3Vyc29yICE9PSBudWxsOyBjdXJzb3IgPSBjdXJzb3IubmV4dCkgewogICAgICAgICAgICB5aWVsZCBjdXJzb3IuZGF0YTsKICAgICAgICB9CiAgICB9CgogICAgLy8gZ2V0dGVycwogICAgZ2V0IHNpemUoKSB7CiAgICAgICAgbGV0IHNpemUgPSAwOwoKICAgICAgICBmb3IgKGxldCBjdXJzb3IgPSB0aGlzLmhlYWQ7IGN1cnNvciAhPT0gbnVsbDsgY3Vyc29yID0gY3Vyc29yLm5leHQpIHsKICAgICAgICAgICAgc2l6ZSsrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICBnZXQgaXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5oZWFkID09PSBudWxsOwogICAgfQogICAgZ2V0IGZpcnN0KCkgewogICAgICAgIHJldHVybiB0aGlzLmhlYWQgJiYgdGhpcy5oZWFkLmRhdGE7CiAgICB9CiAgICBnZXQgbGFzdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy50YWlsICYmIHRoaXMudGFpbC5kYXRhOwogICAgfQoKICAgIC8vIGNvbnZlcnRvcnMKICAgIGZyb21BcnJheShhcnJheSkgewogICAgICAgIGxldCBjdXJzb3IgPSBudWxsOwogICAgICAgIHRoaXMuaGVhZCA9IG51bGw7CgogICAgICAgIGZvciAobGV0IGRhdGEgb2YgYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IExpc3QuY3JlYXRlSXRlbShkYXRhKTsKCiAgICAgICAgICAgIGlmIChjdXJzb3IgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGN1cnNvci5uZXh0ID0gaXRlbTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGl0ZW0ucHJldiA9IGN1cnNvcjsKICAgICAgICAgICAgY3Vyc29yID0gaXRlbTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGFpbCA9IGN1cnNvcjsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFsuLi50aGlzXTsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgICByZXR1cm4gWy4uLnRoaXNdOwogICAgfQoKICAgIC8vIGFycmF5LWxpa2UgbWV0aG9kcwogICAgZm9yRWFjaChmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IobnVsbCwgdGhpcy5oZWFkKTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5uZXh0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IubmV4dDsKICAgICAgICAgICAgY3Vyc29yLm5leHQgPSBpdGVtLm5leHQ7CiAgICAgICAgICAgIGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KICAgIGZvckVhY2hSaWdodChmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IodGhpcy50YWlsLCBudWxsKTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5wcmV2ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IucHJldjsKICAgICAgICAgICAgY3Vyc29yLnByZXYgPSBpdGVtLnByZXY7CiAgICAgICAgICAgIGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KICAgIHJlZHVjZShmbiwgaW5pdGlhbFZhbHVlLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIC8vIHB1c2ggY3Vyc29yCiAgICAgICAgbGV0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IobnVsbCwgdGhpcy5oZWFkKTsKICAgICAgICBsZXQgYWNjID0gaW5pdGlhbFZhbHVlOwogICAgICAgIGxldCBpdGVtOwoKICAgICAgICB3aGlsZSAoY3Vyc29yLm5leHQgIT09IG51bGwpIHsKICAgICAgICAgICAgaXRlbSA9IGN1cnNvci5uZXh0OwogICAgICAgICAgICBjdXJzb3IubmV4dCA9IGl0ZW0ubmV4dDsKCiAgICAgICAgICAgIGFjYyA9IGZuLmNhbGwodGhpc0FyZywgYWNjLCBpdGVtLmRhdGEsIGl0ZW0sIHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gcG9wIGN1cnNvcgogICAgICAgIHRoaXMucmVsZWFzZUN1cnNvcigpOwoKICAgICAgICByZXR1cm4gYWNjOwogICAgfQogICAgcmVkdWNlUmlnaHQoZm4sIGluaXRpYWxWYWx1ZSwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGxldCBjdXJzb3IgPSB0aGlzLmFsbG9jYXRlQ3Vyc29yKHRoaXMudGFpbCwgbnVsbCk7CiAgICAgICAgbGV0IGFjYyA9IGluaXRpYWxWYWx1ZTsKICAgICAgICBsZXQgaXRlbTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5wcmV2ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IucHJldjsKICAgICAgICAgICAgY3Vyc29yLnByZXYgPSBpdGVtLnByZXY7CgogICAgICAgICAgICBhY2MgPSBmbi5jYWxsKHRoaXNBcmcsIGFjYywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKCiAgICAgICAgcmV0dXJuIGFjYzsKICAgIH0KICAgIHNvbWUoZm4sIHRoaXNBcmcgPSB0aGlzKSB7CiAgICAgICAgZm9yIChsZXQgY3Vyc29yID0gdGhpcy5oZWFkOyBjdXJzb3IgIT09IG51bGw7IGN1cnNvciA9IGN1cnNvci5uZXh0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbWFwKGZuLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBMaXN0KCk7CgogICAgICAgIGZvciAobGV0IGN1cnNvciA9IHRoaXMuaGVhZDsgY3Vyc29yICE9PSBudWxsOyBjdXJzb3IgPSBjdXJzb3IubmV4dCkgewogICAgICAgICAgICByZXN1bHQuYXBwZW5kRGF0YShmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmaWx0ZXIoZm4sIHRoaXNBcmcgPSB0aGlzKSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IExpc3QoKTsKCiAgICAgICAgZm9yIChsZXQgY3Vyc29yID0gdGhpcy5oZWFkOyBjdXJzb3IgIT09IG51bGw7IGN1cnNvciA9IGN1cnNvci5uZXh0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kRGF0YShjdXJzb3IuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgbmV4dFVudGlsKHN0YXJ0LCBmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICBpZiAoc3RhcnQgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcHVzaCBjdXJzb3IKICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmFsbG9jYXRlQ3Vyc29yKG51bGwsIHN0YXJ0KTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5uZXh0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IubmV4dDsKICAgICAgICAgICAgY3Vyc29yLm5leHQgPSBpdGVtLm5leHQ7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGl0ZW0uZGF0YSwgaXRlbSwgdGhpcykpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBwb3AgY3Vyc29yCiAgICAgICAgdGhpcy5yZWxlYXNlQ3Vyc29yKCk7CiAgICB9CiAgICBwcmV2VW50aWwoc3RhcnQsIGZuLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIGlmIChzdGFydCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3Ioc3RhcnQsIG51bGwpOwoKICAgICAgICB3aGlsZSAoY3Vyc29yLnByZXYgIT09IG51bGwpIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IGN1cnNvci5wcmV2OwogICAgICAgICAgICBjdXJzb3IucHJldiA9IGl0ZW0ucHJldjsKICAgICAgICAgICAgaWYgKGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KCiAgICAvLyBtdXRhdGlvbgogICAgY2xlYXIoKSB7CiAgICAgICAgdGhpcy5oZWFkID0gbnVsbDsKICAgICAgICB0aGlzLnRhaWwgPSBudWxsOwogICAgfQogICAgY29weSgpIHsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgTGlzdCgpOwoKICAgICAgICBmb3IgKGxldCBkYXRhIG9mIHRoaXMpIHsKICAgICAgICAgICAgcmVzdWx0LmFwcGVuZERhdGEoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgcHJlcGVuZChpdGVtKSB7CiAgICAgICAgLy8gICAgICBoZWFkCiAgICAgICAgLy8gICAgXgogICAgICAgIC8vIGl0ZW0KICAgICAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSwgdGhpcy5oZWFkLCBpdGVtKTsKCiAgICAgICAgLy8gaW5zZXJ0IHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGxpc3QKICAgICAgICBpZiAodGhpcy5oZWFkICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5ldyBpdGVtIDwtIGZpcnN0IGl0ZW0KICAgICAgICAgICAgdGhpcy5oZWFkLnByZXYgPSBpdGVtOwogICAgICAgICAgICAvLyBuZXcgaXRlbSAtPiBmaXJzdCBpdGVtCiAgICAgICAgICAgIGl0ZW0ubmV4dCA9IHRoaXMuaGVhZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiBsaXN0IGhhcyBubyBoZWFkLCB0aGVuIGl0IGFsc28gaGFzIG5vIHRhaWwKICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHRhaWwgcG9pbnRzIHRvIHRoZSBuZXcgaXRlbQogICAgICAgICAgICB0aGlzLnRhaWwgPSBpdGVtOwogICAgICAgIH0KCiAgICAgICAgLy8gaGVhZCBhbHdheXMgcG9pbnRzIHRvIG5ldyBpdGVtCiAgICAgICAgdGhpcy5oZWFkID0gaXRlbTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHByZXBlbmREYXRhKGRhdGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5wcmVwZW5kKExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBhcHBlbmQoaXRlbSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChpdGVtKTsKICAgIH0KICAgIGFwcGVuZERhdGEoZGF0YSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChMaXN0LmNyZWF0ZUl0ZW0oZGF0YSkpOwogICAgfQogICAgaW5zZXJ0KGl0ZW0sIGJlZm9yZSA9IG51bGwpIHsKICAgICAgICBpZiAoYmVmb3JlICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHByZXYgICBiZWZvcmUKICAgICAgICAgICAgLy8gICAgICBeCiAgICAgICAgICAgIC8vICAgICBpdGVtCiAgICAgICAgICAgIHRoaXMudXBkYXRlQ3Vyc29ycyhiZWZvcmUucHJldiwgaXRlbSwgYmVmb3JlLCBpdGVtKTsKCiAgICAgICAgICAgIGlmIChiZWZvcmUucHJldiA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRvIHRoZSBiZWdpbm5pbmcgb2YgbGlzdAogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGVhZCAhPT0gYmVmb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdiZWZvcmUgZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHNpbmNlIGhlYWQgcG9pbnRzIHRvIGJlZm9yZSB0aGVyZWZvcmUgbGlzdCBkb2Vzbid0IGVtcHR5CiAgICAgICAgICAgICAgICAvLyBubyBuZWVkIHRvIGNoZWNrIHRhaWwKICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgICAgICBiZWZvcmUucHJldiA9IGl0ZW07CiAgICAgICAgICAgICAgICBpdGVtLm5leHQgPSBiZWZvcmU7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpbnNlcnQgYmV0d2VlbiB0d28gaXRlbXMKICAgICAgICAgICAgICAgIGJlZm9yZS5wcmV2Lm5leHQgPSBpdGVtOwogICAgICAgICAgICAgICAgaXRlbS5wcmV2ID0gYmVmb3JlLnByZXY7CiAgICAgICAgICAgICAgICBiZWZvcmUucHJldiA9IGl0ZW07CiAgICAgICAgICAgICAgICBpdGVtLm5leHQgPSBiZWZvcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0YWlsCiAgICAgICAgICAgIC8vICAgICAgXgogICAgICAgICAgICAvLyAgICAgIGl0ZW0KICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKHRoaXMudGFpbCwgaXRlbSwgbnVsbCwgaXRlbSk7CgogICAgICAgICAgICAvLyBpbnNlcnQgdG8gdGhlIGVuZGluZyBvZiB0aGUgbGlzdAogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0IGl0ZW0gLT4gbmV3IGl0ZW0KICAgICAgICAgICAgICAgIHRoaXMudGFpbC5uZXh0ID0gaXRlbTsKICAgICAgICAgICAgICAgIC8vIGxhc3QgaXRlbSA8LSBuZXcgaXRlbQogICAgICAgICAgICAgICAgaXRlbS5wcmV2ID0gdGhpcy50YWlsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgbGlzdCBoYXMgbm8gdGFpbCwgdGhlbiBpdCBhbHNvIGhhcyBubyBoZWFkCiAgICAgICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2UgaGVhZCBwb2ludHMgdG8gbmV3IGl0ZW0KICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRhaWwgYWx3YXlzIHBvaW50cyB0byBuZXcgaXRlbQogICAgICAgICAgICB0aGlzLnRhaWwgPSBpdGVtOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBpbnNlcnREYXRhKGRhdGEsIGJlZm9yZSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChMaXN0LmNyZWF0ZUl0ZW0oZGF0YSksIGJlZm9yZSk7CiAgICB9CiAgICByZW1vdmUoaXRlbSkgewogICAgICAgIC8vICAgICAgaXRlbQogICAgICAgIC8vICAgICAgIF4KICAgICAgICAvLyBwcmV2ICAgICBuZXh0CiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKGl0ZW0sIGl0ZW0ucHJldiwgaXRlbSwgaXRlbS5uZXh0KTsKCiAgICAgICAgaWYgKGl0ZW0ucHJldiAhPT0gbnVsbCkgewogICAgICAgICAgICBpdGVtLnByZXYubmV4dCA9IGl0ZW0ubmV4dDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5oZWFkICE9PSBpdGVtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5oZWFkID0gaXRlbS5uZXh0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGl0ZW0ubmV4dCAhPT0gbnVsbCkgewogICAgICAgICAgICBpdGVtLm5leHQucHJldiA9IGl0ZW0ucHJldjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBpdGVtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy50YWlsID0gaXRlbS5wcmV2OwogICAgICAgIH0KCiAgICAgICAgaXRlbS5wcmV2ID0gbnVsbDsKICAgICAgICBpdGVtLm5leHQgPSBudWxsOwoKICAgICAgICByZXR1cm4gaXRlbTsKICAgIH0KICAgIHB1c2goZGF0YSkgewogICAgICAgIHRoaXMuaW5zZXJ0KExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBwb3AoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGFpbCAhPT0gbnVsbCA/IHRoaXMucmVtb3ZlKHRoaXMudGFpbCkgOiBudWxsOwogICAgfQogICAgdW5zaGlmdChkYXRhKSB7CiAgICAgICAgdGhpcy5wcmVwZW5kKExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBzaGlmdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5oZWFkICE9PSBudWxsID8gdGhpcy5yZW1vdmUodGhpcy5oZWFkKSA6IG51bGw7CiAgICB9CiAgICBwcmVwZW5kTGlzdChsaXN0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TGlzdChsaXN0LCB0aGlzLmhlYWQpOwogICAgfQogICAgYXBwZW5kTGlzdChsaXN0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TGlzdChsaXN0KTsKICAgIH0KICAgIGluc2VydExpc3QobGlzdCwgYmVmb3JlKSB7CiAgICAgICAgLy8gaWdub3JlIGVtcHR5IGxpc3RzCiAgICAgICAgaWYgKGxpc3QuaGVhZCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIGlmIChiZWZvcmUgIT09IHVuZGVmaW5lZCAmJiBiZWZvcmUgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKGJlZm9yZS5wcmV2LCBsaXN0LnRhaWwsIGJlZm9yZSwgbGlzdC5oZWFkKTsKCiAgICAgICAgICAgIC8vIGluc2VydCBpbiB0aGUgbWlkZGxlIG9mIGRpc3QgbGlzdAogICAgICAgICAgICBpZiAoYmVmb3JlLnByZXYgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGJlZm9yZS5wcmV2IDwtPiBsaXN0LmhlYWQKICAgICAgICAgICAgICAgIGJlZm9yZS5wcmV2Lm5leHQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgICAgICBsaXN0LmhlYWQucHJldiA9IGJlZm9yZS5wcmV2OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5oZWFkID0gbGlzdC5oZWFkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBiZWZvcmUucHJldiA9IGxpc3QudGFpbDsKICAgICAgICAgICAgbGlzdC50YWlsLm5leHQgPSBiZWZvcmU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKHRoaXMudGFpbCwgbGlzdC50YWlsLCBudWxsLCBsaXN0LmhlYWQpOwoKICAgICAgICAgICAgLy8gaW5zZXJ0IHRvIGVuZCBvZiB0aGUgbGlzdAogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBkZXN0aW5hdGlvbiBsaXN0IGhhcyBhIHRhaWwsIHRoZW4gaXQgYWxzbyBoYXMgYSBoZWFkLAogICAgICAgICAgICAgICAgLy8gYnV0IGhlYWQgZG9lc24ndCBjaGFuZ2UKICAgICAgICAgICAgICAgIC8vIGRlc3QgdGFpbCAtPiBzb3VyY2UgaGVhZAogICAgICAgICAgICAgICAgdGhpcy50YWlsLm5leHQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgICAgICAvLyBkZXN0IHRhaWwgPC0gc291cmNlIGhlYWQKICAgICAgICAgICAgICAgIGxpc3QuaGVhZC5wcmV2ID0gdGhpcy50YWlsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgbGlzdCBoYXMgbm8gYSB0YWlsLCB0aGVuIGl0IGFsc28gaGFzIG5vIGEgaGVhZAogICAgICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHBvaW50cyBoZWFkIHRvIG5ldyBpdGVtCiAgICAgICAgICAgICAgICB0aGlzLmhlYWQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRhaWwgYWx3YXlzIHN0YXJ0IHBvaW50IHRvIG5ldyBpdGVtCiAgICAgICAgICAgIHRoaXMudGFpbCA9IGxpc3QudGFpbDsKICAgICAgICB9CgogICAgICAgIGxpc3QuaGVhZCA9IG51bGw7CiAgICAgICAgbGlzdC50YWlsID0gbnVsbDsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJlcGxhY2Uob2xkSXRlbSwgbmV3SXRlbU9yTGlzdCkgewogICAgICAgIGlmICgnaGVhZCcgaW4gbmV3SXRlbU9yTGlzdCkgewogICAgICAgICAgICB0aGlzLmluc2VydExpc3QobmV3SXRlbU9yTGlzdCwgb2xkSXRlbSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pbnNlcnQobmV3SXRlbU9yTGlzdCwgb2xkSXRlbSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJlbW92ZShvbGRJdGVtKTsKICAgIH0KfQoKZnVuY3Rpb24gY3JlYXRlQ3VzdG9tRXJyb3IobmFtZSwgbWVzc2FnZSkgewogICAgLy8gdXNlIE9iamVjdC5jcmVhdGUoKSwgYmVjYXVzZSBzb21lIFZNcyBwcmV2ZW50IHNldHRpbmcgbGluZS9jb2x1bW4gb3RoZXJ3aXNlCiAgICAvLyAoaU9TIFNhZmFyaSAxMCBldmVuIHRocm93cyBhbiBleGNlcHRpb24pCiAgICBjb25zdCBlcnJvciA9IE9iamVjdC5jcmVhdGUoU3ludGF4RXJyb3IucHJvdG90eXBlKTsKICAgIGNvbnN0IGVycm9yU3RhY2sgPSBuZXcgRXJyb3IoKTsKCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihlcnJvciwgewogICAgICAgIG5hbWUsCiAgICAgICAgbWVzc2FnZSwKICAgICAgICBnZXQgc3RhY2soKSB7CiAgICAgICAgICAgIHJldHVybiAoZXJyb3JTdGFjay5zdGFjayB8fCAnJykucmVwbGFjZSgvXiguK1xuKXsxLDN9LywgYCR7bmFtZX06ICR7bWVzc2FnZX1cbmApOwogICAgICAgIH0KICAgIH0pOwp9Cgpjb25zdCBNQVhfTElORV9MRU5HVEggPSAxMDA7CmNvbnN0IE9GRlNFVF9DT1JSRUNUSU9OID0gNjA7CmNvbnN0IFRBQl9SRVBMQUNFTUVOVCA9ICcgICAgJzsKCmZ1bmN0aW9uIHNvdXJjZUZyYWdtZW50KHsgc291cmNlLCBsaW5lLCBjb2x1bW4gfSwgZXh0cmFMaW5lcykgewogICAgZnVuY3Rpb24gcHJvY2Vzc0xpbmVzKHN0YXJ0LCBlbmQpIHsKICAgICAgICByZXR1cm4gbGluZXMKICAgICAgICAgICAgLnNsaWNlKHN0YXJ0LCBlbmQpCiAgICAgICAgICAgIC5tYXAoKGxpbmUsIGlkeCkgPT4KICAgICAgICAgICAgICAgIFN0cmluZyhzdGFydCArIGlkeCArIDEpLnBhZFN0YXJ0KG1heE51bUxlbmd0aCkgKyAnIHwnICsgbGluZQogICAgICAgICAgICApLmpvaW4oJ1xuJyk7CiAgICB9CgogICAgY29uc3QgbGluZXMgPSBzb3VyY2Uuc3BsaXQoL1xyXG4/fFxufFxmLyk7CiAgICBjb25zdCBzdGFydExpbmUgPSBNYXRoLm1heCgxLCBsaW5lIC0gZXh0cmFMaW5lcykgLSAxOwogICAgY29uc3QgZW5kTGluZSA9IE1hdGgubWluKGxpbmUgKyBleHRyYUxpbmVzLCBsaW5lcy5sZW5ndGggKyAxKTsKICAgIGNvbnN0IG1heE51bUxlbmd0aCA9IE1hdGgubWF4KDQsIFN0cmluZyhlbmRMaW5lKS5sZW5ndGgpICsgMTsKICAgIGxldCBjdXRMZWZ0ID0gMDsKCiAgICAvLyBjb2x1bW4gY29ycmVjdGlvbiBhY2NvcmRpbmcgdG8gcmVwbGFjZWQgdGFiIGJlZm9yZSBjb2x1bW4KICAgIGNvbHVtbiArPSAoVEFCX1JFUExBQ0VNRU5ULmxlbmd0aCAtIDEpICogKGxpbmVzW2xpbmUgLSAxXS5zdWJzdHIoMCwgY29sdW1uIC0gMSkubWF0Y2goL1x0L2cpIHx8IFtdKS5sZW5ndGg7CgogICAgaWYgKGNvbHVtbiA+IE1BWF9MSU5FX0xFTkdUSCkgewogICAgICAgIGN1dExlZnQgPSBjb2x1bW4gLSBPRkZTRVRfQ09SUkVDVElPTiArIDM7CiAgICAgICAgY29sdW1uID0gT0ZGU0VUX0NPUlJFQ1RJT04gLSAyOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydExpbmU7IGkgPD0gZW5kTGluZTsgaSsrKSB7CiAgICAgICAgaWYgKGkgPj0gMCAmJiBpIDwgbGluZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZSgvXHQvZywgVEFCX1JFUExBQ0VNRU5UKTsKICAgICAgICAgICAgbGluZXNbaV0gPQogICAgICAgICAgICAgICAgKGN1dExlZnQgPiAwICYmIGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgPyAnXHUyMDI2JyA6ICcnKSArCiAgICAgICAgICAgICAgICBsaW5lc1tpXS5zdWJzdHIoY3V0TGVmdCwgTUFYX0xJTkVfTEVOR1RIIC0gMikgKwogICAgICAgICAgICAgICAgKGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgKyBNQVhfTElORV9MRU5HVEggLSAxID8gJ1x1MjAyNicgOiAnJyk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBbCiAgICAgICAgcHJvY2Vzc0xpbmVzKHN0YXJ0TGluZSwgbGluZSksCiAgICAgICAgbmV3IEFycmF5KGNvbHVtbiArIG1heE51bUxlbmd0aCArIDIpLmpvaW4oJy0nKSArICdeJywKICAgICAgICBwcm9jZXNzTGluZXMobGluZSwgZW5kTGluZSkKICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ1xuJyk7Cn0KCmZ1bmN0aW9uIFN5bnRheEVycm9yJDIobWVzc2FnZSwgc291cmNlLCBvZmZzZXQsIGxpbmUsIGNvbHVtbikgewogICAgY29uc3QgZXJyb3IgPSBPYmplY3QuYXNzaWduKGNyZWF0ZUN1c3RvbUVycm9yKCdTeW50YXhFcnJvcicsIG1lc3NhZ2UpLCB7CiAgICAgICAgc291cmNlLAogICAgICAgIG9mZnNldCwKICAgICAgICBsaW5lLAogICAgICAgIGNvbHVtbiwKICAgICAgICBzb3VyY2VGcmFnbWVudChleHRyYUxpbmVzKSB7CiAgICAgICAgICAgIHJldHVybiBzb3VyY2VGcmFnbWVudCh7IHNvdXJjZSwgbGluZSwgY29sdW1uIH0sIGlzTmFOKGV4dHJhTGluZXMpID8gMCA6IGV4dHJhTGluZXMpOwogICAgICAgIH0sCiAgICAgICAgZ2V0IGZvcm1hdHRlZE1lc3NhZ2UoKSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBgUGFyc2UgZXJyb3I6ICR7bWVzc2FnZX1cbmAgKwogICAgICAgICAgICAgICAgc291cmNlRnJhZ21lbnQoeyBzb3VyY2UsIGxpbmUsIGNvbHVtbiB9LCAyKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBlcnJvcjsKfQoKZnVuY3Rpb24gcmVhZFNlcXVlbmNlJDEocmVjb2duaXplcikgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgIGxldCBzcGFjZSA9IGZhbHNlOwogICAgY29uc3QgY29udGV4dCA9IHsKICAgICAgICByZWNvZ25pemVyCiAgICB9OwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgQ29tbWVudCQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgc3BhY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGxldCBjaGlsZCA9IHJlY29nbml6ZXIuZ2V0Tm9kZS5jYWxsKHRoaXMsIGNvbnRleHQpOwoKICAgICAgICBpZiAoY2hpbGQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChzcGFjZSkgewogICAgICAgICAgICBpZiAocmVjb2duaXplci5vbldoaXRlU3BhY2UpIHsKICAgICAgICAgICAgICAgIHJlY29nbml6ZXIub25XaGl0ZVNwYWNlLmNhbGwodGhpcywgY2hpbGQsIGNoaWxkcmVuLCBjb250ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzcGFjZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICB9CgogICAgaWYgKHNwYWNlICYmIHJlY29nbml6ZXIub25XaGl0ZVNwYWNlKSB7CiAgICAgICAgcmVjb2duaXplci5vbldoaXRlU3BhY2UuY2FsbCh0aGlzLCBudWxsLCBjaGlsZHJlbiwgY29udGV4dCk7CiAgICB9CgogICAgcmV0dXJuIGNoaWxkcmVuOwp9Cgpjb25zdCBOT09QID0gKCkgPT4ge307CmNvbnN0IEVYQ0xBTUFUSU9OTUFSSyQzID0gMHgwMDIxOyAgLy8gVSswMDIxIEVYQ0xBTUFUSU9OIE1BUksgKCEpCmNvbnN0IE5VTUJFUlNJR04kNCA9IDB4MDAyMzsgICAgICAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKQpjb25zdCBTRU1JQ09MT04gPSAweDAwM0I7ICAgICAgICAvLyBVKzAwM0IgU0VNSUNPTE9OICg7KQpjb25zdCBMRUZUQ1VSTFlCUkFDS0VUJDEgPSAweDAwN0I7IC8vIFUrMDA3QiBMRUZUIENVUkxZIEJSQUNLRVQgKHspCmNvbnN0IE5VTEwgPSAwOwoKZnVuY3Rpb24gY3JlYXRlUGFyc2VDb250ZXh0KG5hbWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpc1tuYW1lXSgpOwogICAgfTsKfQoKZnVuY3Rpb24gZmV0Y2hQYXJzZVZhbHVlcyhkaWN0KSB7CiAgICBjb25zdCByZXN1bHQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBkaWN0KSB7CiAgICAgICAgY29uc3QgaXRlbSA9IGRpY3RbbmFtZV07CiAgICAgICAgY29uc3QgZm4gPSBpdGVtLnBhcnNlIHx8IGl0ZW07CgogICAgICAgIGlmIChmbikgewogICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBmbjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gcHJvY2Vzc0NvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHBhcnNlQ29uZmlnID0gewogICAgICAgIGNvbnRleHQ6IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgc2NvcGU6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgY29uZmlnLnNjb3BlKSwKICAgICAgICBhdHJ1bGU6IGZldGNoUGFyc2VWYWx1ZXMoY29uZmlnLmF0cnVsZSksCiAgICAgICAgcHNldWRvOiBmZXRjaFBhcnNlVmFsdWVzKGNvbmZpZy5wc2V1ZG8pLAogICAgICAgIG5vZGU6IGZldGNoUGFyc2VWYWx1ZXMoY29uZmlnLm5vZGUpCiAgICB9OwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcucGFyc2VDb250ZXh0KSB7CiAgICAgICAgc3dpdGNoICh0eXBlb2YgY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXSkgewogICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgICAgICAgICBwYXJzZUNvbmZpZy5jb250ZXh0W25hbWVdID0gY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgICAgICAgIHBhcnNlQ29uZmlnLmNvbnRleHRbbmFtZV0gPSBjcmVhdGVQYXJzZUNvbnRleHQoY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBjb25maWc6IHBhcnNlQ29uZmlnLAogICAgICAgIC4uLnBhcnNlQ29uZmlnLAogICAgICAgIC4uLnBhcnNlQ29uZmlnLm5vZGUKICAgIH07Cn0KCmZ1bmN0aW9uIGNyZWF0ZVBhcnNlcihjb25maWcpIHsKICAgIGxldCBzb3VyY2UgPSAnJzsKICAgIGxldCBmaWxlbmFtZSA9ICc8dW5rbm93bj4nOwogICAgbGV0IG5lZWRQb3NpdGlvbnMgPSBmYWxzZTsKICAgIGxldCBvblBhcnNlRXJyb3IgPSBOT09QOwogICAgbGV0IG9uUGFyc2VFcnJvclRocm93ID0gZmFsc2U7CgogICAgY29uc3QgbG9jYXRpb25NYXAgPSBuZXcgT2Zmc2V0VG9Mb2NhdGlvbigpOwogICAgY29uc3QgcGFyc2VyID0gT2JqZWN0LmFzc2lnbihuZXcgVG9rZW5TdHJlYW0oKSwgcHJvY2Vzc0NvbmZpZyhjb25maWcgfHwge30pLCB7CiAgICAgICAgcGFyc2VBdHJ1bGVQcmVsdWRlOiB0cnVlLAogICAgICAgIHBhcnNlUnVsZVByZWx1ZGU6IHRydWUsCiAgICAgICAgcGFyc2VWYWx1ZTogdHJ1ZSwKICAgICAgICBwYXJzZUN1c3RvbVByb3BlcnR5OiBmYWxzZSwKCiAgICAgICAgcmVhZFNlcXVlbmNlOiByZWFkU2VxdWVuY2UkMSwKCiAgICAgICAgY29uc3VtZVVudGlsQmFsYW5jZUVuZDogKCkgPT4gMCwKICAgICAgICBjb25zdW1lVW50aWxMZWZ0Q3VybHlCcmFja2V0KGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IExFRlRDVVJMWUJSQUNLRVQkMSA/IDEgOiAwOwogICAgICAgIH0sCiAgICAgICAgY29uc3VtZVVudGlsTGVmdEN1cmx5QnJhY2tldE9yU2VtaWNvbG9uKGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IExFRlRDVVJMWUJSQUNLRVQkMSB8fCBjb2RlID09PSBTRU1JQ09MT04gPyAxIDogMDsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVVbnRpbEV4Y2xhbWF0aW9uTWFya09yU2VtaWNvbG9uKGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IEVYQ0xBTUFUSU9OTUFSSyQzIHx8IGNvZGUgPT09IFNFTUlDT0xPTiA/IDEgOiAwOwogICAgICAgIH0sCiAgICAgICAgY29uc3VtZVVudGlsU2VtaWNvbG9uSW5jbHVkZWQoY29kZSkgewogICAgICAgICAgICByZXR1cm4gY29kZSA9PT0gU0VNSUNPTE9OID8gMiA6IDA7CiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlTGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0KCk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVTaW5nbGVOb2RlTGlzdChub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdCgpLmFwcGVuZERhdGEobm9kZSk7CiAgICAgICAgfSwKICAgICAgICBnZXRGaXJzdExpc3ROb2RlKGxpc3QpIHsKICAgICAgICAgICAgcmV0dXJuIGxpc3QgJiYgbGlzdC5maXJzdDsKICAgICAgICB9LAogICAgICAgIGdldExhc3RMaXN0Tm9kZShsaXN0KSB7CiAgICAgICAgICAgIHJldHVybiBsaXN0ICYmIGxpc3QubGFzdDsKICAgICAgICB9LAoKICAgICAgICBwYXJzZVdpdGhGYWxsYmFjayhjb25zdW1lciwgZmFsbGJhY2spIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnRUb2tlbiA9IHRoaXMudG9rZW5JbmRleDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3VtZXIuY2FsbCh0aGlzKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKG9uUGFyc2VFcnJvclRocm93KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBmYWxsYmFja05vZGUgPSBmYWxsYmFjay5jYWxsKHRoaXMsIHN0YXJ0VG9rZW4pOwoKICAgICAgICAgICAgICAgIG9uUGFyc2VFcnJvclRocm93ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG9uUGFyc2VFcnJvcihlLCBmYWxsYmFja05vZGUpOwogICAgICAgICAgICAgICAgb25QYXJzZUVycm9yVGhyb3cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2tOb2RlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbG9va3VwTm9uV1NUeXBlKG9mZnNldCkgewogICAgICAgICAgICBsZXQgdHlwZTsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHR5cGUgPSB0aGlzLmxvb2t1cFR5cGUob2Zmc2V0KyspOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgIT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlICh0eXBlICE9PSBOVUxMKTsKCiAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgIH0sCgogICAgICAgIGNoYXJDb2RlQXQob2Zmc2V0KSB7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXQgPj0gMCAmJiBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoID8gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSA6IDA7CiAgICAgICAgfSwKICAgICAgICBzdWJzdHJpbmcob2Zmc2V0U3RhcnQsIG9mZnNldEVuZCkgewogICAgICAgICAgICByZXR1cm4gc291cmNlLnN1YnN0cmluZyhvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKTsKICAgICAgICB9LAogICAgICAgIHN1YnN0clRvQ3Vyc29yKHN0YXJ0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHRoaXMudG9rZW5TdGFydCk7CiAgICAgICAgfSwKCiAgICAgICAgY21wQ2hhcihvZmZzZXQsIGNoYXJDb2RlKSB7CiAgICAgICAgICAgIHJldHVybiBjbXBDaGFyKHNvdXJjZSwgb2Zmc2V0LCBjaGFyQ29kZSk7CiAgICAgICAgfSwKICAgICAgICBjbXBTdHIob2Zmc2V0U3RhcnQsIG9mZnNldEVuZCwgc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBjbXBTdHIoc291cmNlLCBvZmZzZXRTdGFydCwgb2Zmc2V0RW5kLCBzdHIpOwogICAgICAgIH0sCgogICAgICAgIGNvbnN1bWUodG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgICAgICAgICAgdGhpcy5lYXQodG9rZW5UeXBlKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVGdW5jdGlvbk5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBzb3VyY2Uuc3Vic3RyaW5nKHRoaXMudG9rZW5TdGFydCwgdGhpcy50b2tlbkVuZCAtIDEpOwoKICAgICAgICAgICAgdGhpcy5lYXQoRnVuY3Rpb24kMik7CgogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVOdW1iZXIodHlwZSkgewogICAgICAgICAgICBjb25zdCBudW1iZXIgPSBzb3VyY2Uuc3Vic3RyaW5nKHRoaXMudG9rZW5TdGFydCwgY29uc3VtZU51bWJlciQxKHNvdXJjZSwgdGhpcy50b2tlblN0YXJ0KSk7CgogICAgICAgICAgICB0aGlzLmVhdCh0eXBlKTsKCiAgICAgICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgICAgfSwKCiAgICAgICAgZWF0KHRva2VuVHlwZSkgewogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IHRva2VuVHlwZSkgewogICAgICAgICAgICAgICAgY29uc3QgdG9rZW5OYW1lID0gdG9rZW5OYW1lc1t0b2tlblR5cGVdLnNsaWNlKDAsIC02KS5yZXBsYWNlKC8tL2csICcgJykucmVwbGFjZSgvXi4vLCBtID0+IG0udG9VcHBlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IGAkey9bW1xdKCl7fV0vLnRlc3QodG9rZW5OYW1lKSA/IGAiJHt0b2tlbk5hbWV9ImAgOiB0b2tlbk5hbWV9IGlzIGV4cGVjdGVkYDsKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgICAgICAgICAgICAgLy8gdHdlYWsgbWVzc2FnZSBhbmQgb2Zmc2V0CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gaWRlbnRpZmllciBpcyBleHBlY3RlZCBidXQgdGhlcmUgaXMgYSBmdW5jdGlvbiBvciB1cmwKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBGdW5jdGlvbiQyIHx8IHRoaXMudG9rZW5UeXBlID09PSBVcmwkMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy50b2tlbkVuZCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQgYnV0IGZ1bmN0aW9uIGZvdW5kJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnSWRlbnRpZmllciBpcyBleHBlY3RlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgSGFzaCQxOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlbGltKE5VTUJFUlNJR04kNCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ05hbWUgaXMgZXhwZWN0ZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIFBlcmNlbnRhZ2UkMToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBOdW1iZXIkMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy50b2tlbkVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnUGVyY2VudCBzaWduIGlzIGV4cGVjdGVkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKG1lc3NhZ2UsIG9mZnNldCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIH0sCiAgICAgICAgZWF0SWRlbnQobmFtZSkgewogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50IHx8IHRoaXMubG9va3VwVmFsdWUoMCwgbmFtZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKGBJZGVudGlmaWVyICIke25hbWV9IiBpcyBleHBlY3RlZGApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9LAogICAgICAgIGVhdERlbGltKGNvZGUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVsaW0oY29kZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoYERlbGltICIke1N0cmluZy5mcm9tQ2hhckNvZGUoY29kZSl9IiBpcyBleHBlY3RlZGApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRMb2NhdGlvbihzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGlmIChuZWVkUG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb25SYW5nZSgKICAgICAgICAgICAgICAgICAgICBzdGFydCwKICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgZ2V0TG9jYXRpb25Gcm9tTGlzdChsaXN0KSB7CiAgICAgICAgICAgIGlmIChuZWVkUG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBoZWFkID0gdGhpcy5nZXRGaXJzdExpc3ROb2RlKGxpc3QpOwogICAgICAgICAgICAgICAgY29uc3QgdGFpbCA9IHRoaXMuZ2V0TGFzdExpc3ROb2RlKGxpc3QpOwogICAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uTWFwLmdldExvY2F0aW9uUmFuZ2UoCiAgICAgICAgICAgICAgICAgICAgaGVhZCAhPT0gbnVsbCA/IGhlYWQubG9jLnN0YXJ0Lm9mZnNldCAtIGxvY2F0aW9uTWFwLnN0YXJ0T2Zmc2V0IDogdGhpcy50b2tlblN0YXJ0LAogICAgICAgICAgICAgICAgICAgIHRhaWwgIT09IG51bGwgPyB0YWlsLmxvYy5lbmQub2Zmc2V0IC0gbG9jYXRpb25NYXAuc3RhcnRPZmZzZXQgOiB0aGlzLnRva2VuU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCgogICAgICAgIGVycm9yKG1lc3NhZ2UsIG9mZnNldCkgewogICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHR5cGVvZiBvZmZzZXQgIT09ICd1bmRlZmluZWQnICYmIG9mZnNldCA8IHNvdXJjZS5sZW5ndGgKICAgICAgICAgICAgICAgID8gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb24ob2Zmc2V0KQogICAgICAgICAgICAgICAgOiB0aGlzLmVvZgogICAgICAgICAgICAgICAgICAgID8gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb24oZmluZFdoaXRlU3BhY2VTdGFydChzb3VyY2UsIHNvdXJjZS5sZW5ndGggLSAxKSkKICAgICAgICAgICAgICAgICAgICA6IGxvY2F0aW9uTWFwLmdldExvY2F0aW9uKHRoaXMudG9rZW5TdGFydCk7CgogICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IkMigKICAgICAgICAgICAgICAgIG1lc3NhZ2UgfHwgJ1VuZXhwZWN0ZWQgaW5wdXQnLAogICAgICAgICAgICAgICAgc291cmNlLAogICAgICAgICAgICAgICAgbG9jYXRpb24ub2Zmc2V0LAogICAgICAgICAgICAgICAgbG9jYXRpb24ubGluZSwKICAgICAgICAgICAgICAgIGxvY2F0aW9uLmNvbHVtbgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnN0IHBhcnNlID0gZnVuY3Rpb24oc291cmNlXywgb3B0aW9ucykgewogICAgICAgIHNvdXJjZSA9IHNvdXJjZV87CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIHBhcnNlci5zZXRTb3VyY2Uoc291cmNlLCB0b2tlbml6ZSQxKTsKICAgICAgICBsb2NhdGlvbk1hcC5zZXRTb3VyY2UoCiAgICAgICAgICAgIHNvdXJjZSwKICAgICAgICAgICAgb3B0aW9ucy5vZmZzZXQsCiAgICAgICAgICAgIG9wdGlvbnMubGluZSwKICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW4KICAgICAgICApOwoKICAgICAgICBmaWxlbmFtZSA9IG9wdGlvbnMuZmlsZW5hbWUgfHwgJzx1bmtub3duPic7CiAgICAgICAgbmVlZFBvc2l0aW9ucyA9IEJvb2xlYW4ob3B0aW9ucy5wb3NpdGlvbnMpOwogICAgICAgIG9uUGFyc2VFcnJvciA9IHR5cGVvZiBvcHRpb25zLm9uUGFyc2VFcnJvciA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMub25QYXJzZUVycm9yIDogTk9PUDsKICAgICAgICBvblBhcnNlRXJyb3JUaHJvdyA9IGZhbHNlOwoKICAgICAgICBwYXJzZXIucGFyc2VBdHJ1bGVQcmVsdWRlID0gJ3BhcnNlQXRydWxlUHJlbHVkZScgaW4gb3B0aW9ucyA/IEJvb2xlYW4ob3B0aW9ucy5wYXJzZUF0cnVsZVByZWx1ZGUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VSdWxlUHJlbHVkZSA9ICdwYXJzZVJ1bGVQcmVsdWRlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlUnVsZVByZWx1ZGUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VWYWx1ZSA9ICdwYXJzZVZhbHVlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlVmFsdWUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VDdXN0b21Qcm9wZXJ0eSA9ICdwYXJzZUN1c3RvbVByb3BlcnR5JyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlQ3VzdG9tUHJvcGVydHkpIDogZmFsc2U7CgogICAgICAgIGNvbnN0IHsgY29udGV4dCA9ICdkZWZhdWx0Jywgb25Db21tZW50IH0gPSBvcHRpb25zOwoKICAgICAgICBpZiAoY29udGV4dCBpbiBwYXJzZXIuY29udGV4dCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNvbnRleHQgYCcgKyBjb250ZXh0ICsgJ2AnKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2Ygb25Db21tZW50ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHBhcnNlci5mb3JFYWNoVG9rZW4oKHR5cGUsIHN0YXJ0LCBlbmQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBDb21tZW50JDEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2MgPSBwYXJzZXIuZ2V0TG9jYXRpb24oc3RhcnQsIGVuZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjbXBTdHIoc291cmNlLCBlbmQgLSAyLCBlbmQsICcqLycpCiAgICAgICAgICAgICAgICAgICAgICAgID8gc291cmNlLnNsaWNlKHN0YXJ0ICsgMiwgZW5kIC0gMikKICAgICAgICAgICAgICAgICAgICAgICAgOiBzb3VyY2Uuc2xpY2Uoc3RhcnQgKyAyLCBlbmQpOwoKICAgICAgICAgICAgICAgICAgICBvbkNvbW1lbnQodmFsdWUsIGxvYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2VyLmNvbnRleHRbY29udGV4dF0uY2FsbChwYXJzZXIsIG9wdGlvbnMpOwoKICAgICAgICBpZiAoIXBhcnNlci5lb2YpIHsKICAgICAgICAgICAgcGFyc2VyLmVycm9yKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXN0OwogICAgfTsKCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihwYXJzZSwgewogICAgICAgIFN5bnRheEVycm9yOiBTeW50YXhFcnJvciQyLAogICAgICAgIGNvbmZpZzogcGFyc2VyLmNvbmZpZwogICAgfSk7Cn0KCnZhciBiYXNlNjRWbHEgPSB7fTsKCnZhciBiYXNlNjQkMSA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgaW50VG9DaGFyTWFwID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nLnNwbGl0KCcnKTsKCi8qKgogKiBFbmNvZGUgYW4gaW50ZWdlciBpbiB0aGUgcmFuZ2Ugb2YgMCB0byA2MyB0byBhIHNpbmdsZSBiYXNlIDY0IGRpZ2l0LgogKi8KYmFzZTY0JDEuZW5jb2RlID0gZnVuY3Rpb24gKG51bWJlcikgewogIGlmICgwIDw9IG51bWJlciAmJiBudW1iZXIgPCBpbnRUb0NoYXJNYXAubGVuZ3RoKSB7CiAgICByZXR1cm4gaW50VG9DaGFyTWFwW251bWJlcl07CiAgfQogIHRocm93IG5ldyBUeXBlRXJyb3IoIk11c3QgYmUgYmV0d2VlbiAwIGFuZCA2MzogIiArIG51bWJlcik7Cn07CgovKioKICogRGVjb2RlIGEgc2luZ2xlIGJhc2UgNjQgY2hhcmFjdGVyIGNvZGUgZGlnaXQgdG8gYW4gaW50ZWdlci4gUmV0dXJucyAtMSBvbgogKiBmYWlsdXJlLgogKi8KYmFzZTY0JDEuZGVjb2RlID0gZnVuY3Rpb24gKGNoYXJDb2RlKSB7CiAgdmFyIGJpZ0EgPSA2NTsgICAgIC8vICdBJwogIHZhciBiaWdaID0gOTA7ICAgICAvLyAnWicKCiAgdmFyIGxpdHRsZUEgPSA5NzsgIC8vICdhJwogIHZhciBsaXR0bGVaID0gMTIyOyAvLyAneicKCiAgdmFyIHplcm8gPSA0ODsgICAgIC8vICcwJwogIHZhciBuaW5lID0gNTc7ICAgICAvLyAnOScKCiAgdmFyIHBsdXMgPSA0MzsgICAgIC8vICcrJwogIHZhciBzbGFzaCA9IDQ3OyAgICAvLyAnLycKCiAgdmFyIGxpdHRsZU9mZnNldCA9IDI2OwogIHZhciBudW1iZXJPZmZzZXQgPSA1MjsKCiAgLy8gMCAtIDI1OiBBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWgogIGlmIChiaWdBIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IGJpZ1opIHsKICAgIHJldHVybiAoY2hhckNvZGUgLSBiaWdBKTsKICB9CgogIC8vIDI2IC0gNTE6IGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6CiAgaWYgKGxpdHRsZUEgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gbGl0dGxlWikgewogICAgcmV0dXJuIChjaGFyQ29kZSAtIGxpdHRsZUEgKyBsaXR0bGVPZmZzZXQpOwogIH0KCiAgLy8gNTIgLSA2MTogMDEyMzQ1Njc4OQogIGlmICh6ZXJvIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IG5pbmUpIHsKICAgIHJldHVybiAoY2hhckNvZGUgLSB6ZXJvICsgbnVtYmVyT2Zmc2V0KTsKICB9CgogIC8vIDYyOiArCiAgaWYgKGNoYXJDb2RlID09IHBsdXMpIHsKICAgIHJldHVybiA2MjsKICB9CgogIC8vIDYzOiAvCiAgaWYgKGNoYXJDb2RlID09IHNsYXNoKSB7CiAgICByZXR1cm4gNjM7CiAgfQoKICAvLyBJbnZhbGlkIGJhc2U2NCBkaWdpdC4KICByZXR1cm4gLTE7Cn07CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgovKgogKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwogKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQogKgogKiBCYXNlZCBvbiB0aGUgQmFzZSA2NCBWTFEgaW1wbGVtZW50YXRpb24gaW4gQ2xvc3VyZSBDb21waWxlcjoKICogaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jbG9zdXJlLWNvbXBpbGVyL3NvdXJjZS9icm93c2UvdHJ1bmsvc3JjL2NvbS9nb29nbGUvZGVidWdnaW5nL3NvdXJjZW1hcC9CYXNlNjRWTFEuamF2YQogKgogKiBDb3B5cmlnaHQgMjAxMSBUaGUgQ2xvc3VyZSBDb21waWxlciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZQogKiBtZXQ6CiAqCiAqICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICogICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZQogKiAgICBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZwogKiAgICBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQKICogICAgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKiAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEdvb2dsZSBJbmMuIG5vciB0aGUgbmFtZXMgb2YgaXRzCiAqICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZAogKiAgICBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMKICogIkFTIElTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QKICogTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SCiAqIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUCiAqIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLAogKiBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UCiAqIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAogKiBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkKICogVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UKICogT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCgp2YXIgYmFzZTY0ID0gYmFzZTY0JDE7CgovLyBBIHNpbmdsZSBiYXNlIDY0IGRpZ2l0IGNhbiBjb250YWluIDYgYml0cyBvZiBkYXRhLiBGb3IgdGhlIGJhc2UgNjQgdmFyaWFibGUKLy8gbGVuZ3RoIHF1YW50aXRpZXMgd2UgdXNlIGluIHRoZSBzb3VyY2UgbWFwIHNwZWMsIHRoZSBmaXJzdCBiaXQgaXMgdGhlIHNpZ24sCi8vIHRoZSBuZXh0IGZvdXIgYml0cyBhcmUgdGhlIGFjdHVhbCB2YWx1ZSwgYW5kIHRoZSA2dGggYml0IGlzIHRoZQovLyBjb250aW51YXRpb24gYml0LiBUaGUgY29udGludWF0aW9uIGJpdCB0ZWxscyB1cyB3aGV0aGVyIHRoZXJlIGFyZSBtb3JlCi8vIGRpZ2l0cyBpbiB0aGlzIHZhbHVlIGZvbGxvd2luZyB0aGlzIGRpZ2l0LgovLwovLyAgIENvbnRpbnVhdGlvbgovLyAgIHwgICAgU2lnbgovLyAgIHwgICAgfAovLyAgIFYgICAgVgovLyAgIDEwMTAxMQoKdmFyIFZMUV9CQVNFX1NISUZUID0gNTsKCi8vIGJpbmFyeTogMTAwMDAwCnZhciBWTFFfQkFTRSA9IDEgPDwgVkxRX0JBU0VfU0hJRlQ7CgovLyBiaW5hcnk6IDAxMTExMQp2YXIgVkxRX0JBU0VfTUFTSyA9IFZMUV9CQVNFIC0gMTsKCi8vIGJpbmFyeTogMTAwMDAwCnZhciBWTFFfQ09OVElOVUFUSU9OX0JJVCA9IFZMUV9CQVNFOwoKLyoqCiAqIENvbnZlcnRzIGZyb20gYSB0d28tY29tcGxlbWVudCB2YWx1ZSB0byBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwogKiBwbGFjZWQgaW4gdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdC4gIEZvciBleGFtcGxlLCBhcyBkZWNpbWFsczoKICogICAxIGJlY29tZXMgMiAoMTAgYmluYXJ5KSwgLTEgYmVjb21lcyAzICgxMSBiaW5hcnkpCiAqICAgMiBiZWNvbWVzIDQgKDEwMCBiaW5hcnkpLCAtMiBiZWNvbWVzIDUgKDEwMSBiaW5hcnkpCiAqLwpmdW5jdGlvbiB0b1ZMUVNpZ25lZChhVmFsdWUpIHsKICByZXR1cm4gYVZhbHVlIDwgMAogICAgPyAoKC1hVmFsdWUpIDw8IDEpICsgMQogICAgOiAoYVZhbHVlIDw8IDEpICsgMDsKfQoKLyoqCiAqIENvbnZlcnRzIHRvIGEgdHdvLWNvbXBsZW1lbnQgdmFsdWUgZnJvbSBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwogKiBwbGFjZWQgaW4gdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdC4gIEZvciBleGFtcGxlLCBhcyBkZWNpbWFsczoKICogICAyICgxMCBiaW5hcnkpIGJlY29tZXMgMSwgMyAoMTEgYmluYXJ5KSBiZWNvbWVzIC0xCiAqICAgNCAoMTAwIGJpbmFyeSkgYmVjb21lcyAyLCA1ICgxMDEgYmluYXJ5KSBiZWNvbWVzIC0yCiAqLwpmdW5jdGlvbiBmcm9tVkxRU2lnbmVkKGFWYWx1ZSkgewogIHZhciBpc05lZ2F0aXZlID0gKGFWYWx1ZSAmIDEpID09PSAxOwogIHZhciBzaGlmdGVkID0gYVZhbHVlID4+IDE7CiAgcmV0dXJuIGlzTmVnYXRpdmUKICAgID8gLXNoaWZ0ZWQKICAgIDogc2hpZnRlZDsKfQoKLyoqCiAqIFJldHVybnMgdGhlIGJhc2UgNjQgVkxRIGVuY29kZWQgdmFsdWUuCiAqLwpiYXNlNjRWbHEuZW5jb2RlID0gZnVuY3Rpb24gYmFzZTY0VkxRX2VuY29kZShhVmFsdWUpIHsKICB2YXIgZW5jb2RlZCA9ICIiOwogIHZhciBkaWdpdDsKCiAgdmFyIHZscSA9IHRvVkxRU2lnbmVkKGFWYWx1ZSk7CgogIGRvIHsKICAgIGRpZ2l0ID0gdmxxICYgVkxRX0JBU0VfTUFTSzsKICAgIHZscSA+Pj49IFZMUV9CQVNFX1NISUZUOwogICAgaWYgKHZscSA+IDApIHsKICAgICAgLy8gVGhlcmUgYXJlIHN0aWxsIG1vcmUgZGlnaXRzIGluIHRoaXMgdmFsdWUsIHNvIHdlIG11c3QgbWFrZSBzdXJlIHRoZQogICAgICAvLyBjb250aW51YXRpb24gYml0IGlzIG1hcmtlZC4KICAgICAgZGlnaXQgfD0gVkxRX0NPTlRJTlVBVElPTl9CSVQ7CiAgICB9CiAgICBlbmNvZGVkICs9IGJhc2U2NC5lbmNvZGUoZGlnaXQpOwogIH0gd2hpbGUgKHZscSA+IDApOwoKICByZXR1cm4gZW5jb2RlZDsKfTsKCi8qKgogKiBEZWNvZGVzIHRoZSBuZXh0IGJhc2UgNjQgVkxRIHZhbHVlIGZyb20gdGhlIGdpdmVuIHN0cmluZyBhbmQgcmV0dXJucyB0aGUKICogdmFsdWUgYW5kIHRoZSByZXN0IG9mIHRoZSBzdHJpbmcgdmlhIHRoZSBvdXQgcGFyYW1ldGVyLgogKi8KYmFzZTY0VmxxLmRlY29kZSA9IGZ1bmN0aW9uIGJhc2U2NFZMUV9kZWNvZGUoYVN0ciwgYUluZGV4LCBhT3V0UGFyYW0pIHsKICB2YXIgc3RyTGVuID0gYVN0ci5sZW5ndGg7CiAgdmFyIHJlc3VsdCA9IDA7CiAgdmFyIHNoaWZ0ID0gMDsKICB2YXIgY29udGludWF0aW9uLCBkaWdpdDsKCiAgZG8gewogICAgaWYgKGFJbmRleCA+PSBzdHJMZW4pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3RlZCBtb3JlIGRpZ2l0cyBpbiBiYXNlIDY0IFZMUSB2YWx1ZS4iKTsKICAgIH0KCiAgICBkaWdpdCA9IGJhc2U2NC5kZWNvZGUoYVN0ci5jaGFyQ29kZUF0KGFJbmRleCsrKSk7CiAgICBpZiAoZGlnaXQgPT09IC0xKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBiYXNlNjQgZGlnaXQ6ICIgKyBhU3RyLmNoYXJBdChhSW5kZXggLSAxKSk7CiAgICB9CgogICAgY29udGludWF0aW9uID0gISEoZGlnaXQgJiBWTFFfQ09OVElOVUFUSU9OX0JJVCk7CiAgICBkaWdpdCAmPSBWTFFfQkFTRV9NQVNLOwogICAgcmVzdWx0ID0gcmVzdWx0ICsgKGRpZ2l0IDw8IHNoaWZ0KTsKICAgIHNoaWZ0ICs9IFZMUV9CQVNFX1NISUZUOwogIH0gd2hpbGUgKGNvbnRpbnVhdGlvbik7CgogIGFPdXRQYXJhbS52YWx1ZSA9IGZyb21WTFFTaWduZWQocmVzdWx0KTsKICBhT3V0UGFyYW0ucmVzdCA9IGFJbmRleDsKfTsKCnZhciB1dGlsJDMgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCihmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCS8qKgoJICogVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbiBmb3IgZ2V0dGluZyB2YWx1ZXMgZnJvbSBwYXJhbWV0ZXIvb3B0aW9ucwoJICogb2JqZWN0cy4KCSAqCgkgKiBAcGFyYW0gYXJncyBUaGUgb2JqZWN0IHdlIGFyZSBleHRyYWN0aW5nIHZhbHVlcyBmcm9tCgkgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2UgYXJlIGdldHRpbmcuCgkgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIEFuIG9wdGlvbmFsIHZhbHVlIHRvIHJldHVybiBpZiB0aGUgcHJvcGVydHkgaXMgbWlzc2luZwoJICogZnJvbSB0aGUgb2JqZWN0LiBJZiB0aGlzIGlzIG5vdCBzcGVjaWZpZWQgYW5kIHRoZSBwcm9wZXJ0eSBpcyBtaXNzaW5nLCBhbgoJICogZXJyb3Igd2lsbCBiZSB0aHJvd24uCgkgKi8KCWZ1bmN0aW9uIGdldEFyZyhhQXJncywgYU5hbWUsIGFEZWZhdWx0VmFsdWUpIHsKCSAgaWYgKGFOYW1lIGluIGFBcmdzKSB7CgkgICAgcmV0dXJuIGFBcmdzW2FOYW1lXTsKCSAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzKSB7CgkgICAgcmV0dXJuIGFEZWZhdWx0VmFsdWU7CgkgIH0gZWxzZSB7CgkgICAgdGhyb3cgbmV3IEVycm9yKCciJyArIGFOYW1lICsgJyIgaXMgYSByZXF1aXJlZCBhcmd1bWVudC4nKTsKCSAgfQoJfQoJZXhwb3J0cy5nZXRBcmcgPSBnZXRBcmc7CgoJdmFyIHVybFJlZ2V4cCA9IC9eKD86KFtcdytcLS5dKyk6KT9cL1wvKD86KFx3KzpcdyspQCk/KFtcdy4tXSopKD86OihcZCspKT8oLiopJC87Cgl2YXIgZGF0YVVybFJlZ2V4cCA9IC9eZGF0YTouK1wsLiskLzsKCglmdW5jdGlvbiB1cmxQYXJzZShhVXJsKSB7CgkgIHZhciBtYXRjaCA9IGFVcmwubWF0Y2godXJsUmVnZXhwKTsKCSAgaWYgKCFtYXRjaCkgewoJICAgIHJldHVybiBudWxsOwoJICB9CgkgIHJldHVybiB7CgkgICAgc2NoZW1lOiBtYXRjaFsxXSwKCSAgICBhdXRoOiBtYXRjaFsyXSwKCSAgICBob3N0OiBtYXRjaFszXSwKCSAgICBwb3J0OiBtYXRjaFs0XSwKCSAgICBwYXRoOiBtYXRjaFs1XQoJICB9OwoJfQoJZXhwb3J0cy51cmxQYXJzZSA9IHVybFBhcnNlOwoKCWZ1bmN0aW9uIHVybEdlbmVyYXRlKGFQYXJzZWRVcmwpIHsKCSAgdmFyIHVybCA9ICcnOwoJICBpZiAoYVBhcnNlZFVybC5zY2hlbWUpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5zY2hlbWUgKyAnOic7CgkgIH0KCSAgdXJsICs9ICcvLyc7CgkgIGlmIChhUGFyc2VkVXJsLmF1dGgpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5hdXRoICsgJ0AnOwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLmhvc3QpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5ob3N0OwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLnBvcnQpIHsKCSAgICB1cmwgKz0gIjoiICsgYVBhcnNlZFVybC5wb3J0OwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLnBhdGgpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5wYXRoOwoJICB9CgkgIHJldHVybiB1cmw7Cgl9CglleHBvcnRzLnVybEdlbmVyYXRlID0gdXJsR2VuZXJhdGU7CgoJdmFyIE1BWF9DQUNIRURfSU5QVVRTID0gMzI7CgoJLyoqCgkgKiBUYWtlcyBzb21lIGZ1bmN0aW9uIGBmKGlucHV0KSAtPiByZXN1bHRgIGFuZCByZXR1cm5zIGEgbWVtb2l6ZWQgdmVyc2lvbiBvZgoJICogYGZgLgoJICoKCSAqIFdlIGtlZXAgYXQgbW9zdCBgTUFYX0NBQ0hFRF9JTlBVVFNgIG1lbW9pemVkIHJlc3VsdHMgb2YgYGZgIGFsaXZlLiBUaGUKCSAqIG1lbW9pemF0aW9uIGlzIGEgZHVtYi1zaW1wbGUsIGxpbmVhciBsZWFzdC1yZWNlbnRseS11c2VkIGNhY2hlLgoJICovCglmdW5jdGlvbiBscnVNZW1vaXplKGYpIHsKCSAgdmFyIGNhY2hlID0gW107CgoJICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlLmxlbmd0aDsgaSsrKSB7CgkgICAgICBpZiAoY2FjaGVbaV0uaW5wdXQgPT09IGlucHV0KSB7CgkgICAgICAgIHZhciB0ZW1wID0gY2FjaGVbMF07CgkgICAgICAgIGNhY2hlWzBdID0gY2FjaGVbaV07CgkgICAgICAgIGNhY2hlW2ldID0gdGVtcDsKCSAgICAgICAgcmV0dXJuIGNhY2hlWzBdLnJlc3VsdDsKCSAgICAgIH0KCSAgICB9CgoJICAgIHZhciByZXN1bHQgPSBmKGlucHV0KTsKCgkgICAgY2FjaGUudW5zaGlmdCh7CgkgICAgICBpbnB1dCwKCSAgICAgIHJlc3VsdCwKCSAgICB9KTsKCgkgICAgaWYgKGNhY2hlLmxlbmd0aCA+IE1BWF9DQUNIRURfSU5QVVRTKSB7CgkgICAgICBjYWNoZS5wb3AoKTsKCSAgICB9CgoJICAgIHJldHVybiByZXN1bHQ7CgkgIH07Cgl9CgoJLyoqCgkgKiBOb3JtYWxpemVzIGEgcGF0aCwgb3IgdGhlIHBhdGggcG9ydGlvbiBvZiBhIFVSTDoKCSAqCgkgKiAtIFJlcGxhY2VzIGNvbnNlY3V0aXZlIHNsYXNoZXMgd2l0aCBvbmUgc2xhc2guCgkgKiAtIFJlbW92ZXMgdW5uZWNlc3NhcnkgJy4nIHBhcnRzLgoJICogLSBSZW1vdmVzIHVubmVjZXNzYXJ5ICc8ZGlyPi8uLicgcGFydHMuCgkgKgoJICogQmFzZWQgb24gY29kZSBpbiB0aGUgTm9kZS5qcyAncGF0aCcgY29yZSBtb2R1bGUuCgkgKgoJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIHVybCB0byBub3JtYWxpemUuCgkgKi8KCXZhciBub3JtYWxpemUgPSBscnVNZW1vaXplKGZ1bmN0aW9uIG5vcm1hbGl6ZShhUGF0aCkgewoJICB2YXIgcGF0aCA9IGFQYXRoOwoJICB2YXIgdXJsID0gdXJsUGFyc2UoYVBhdGgpOwoJICBpZiAodXJsKSB7CgkgICAgaWYgKCF1cmwucGF0aCkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCSAgICBwYXRoID0gdXJsLnBhdGg7CgkgIH0KCSAgdmFyIGlzQWJzb2x1dGUgPSBleHBvcnRzLmlzQWJzb2x1dGUocGF0aCk7CgkgIC8vIFNwbGl0IHRoZSBwYXRoIGludG8gcGFydHMgYmV0d2VlbiBgL2AgY2hhcmFjdGVycy4gVGhpcyBpcyBtdWNoIGZhc3RlciB0aGFuCgkgIC8vIHVzaW5nIGAuc3BsaXQoL1wvKy9nKWAuCgkgIHZhciBwYXJ0cyA9IFtdOwoJICB2YXIgc3RhcnQgPSAwOwoJICB2YXIgaSA9IDA7CgkgIHdoaWxlICh0cnVlKSB7CgkgICAgc3RhcnQgPSBpOwoJICAgIGkgPSBwYXRoLmluZGV4T2YoIi8iLCBzdGFydCk7CgkgICAgaWYgKGkgPT09IC0xKSB7CgkgICAgICBwYXJ0cy5wdXNoKHBhdGguc2xpY2Uoc3RhcnQpKTsKCSAgICAgIGJyZWFrOwoJICAgIH0gZWxzZSB7CgkgICAgICBwYXJ0cy5wdXNoKHBhdGguc2xpY2Uoc3RhcnQsIGkpKTsKCSAgICAgIHdoaWxlIChpIDwgcGF0aC5sZW5ndGggJiYgcGF0aFtpXSA9PT0gIi8iKSB7CgkgICAgICAgIGkrKzsKCSAgICAgIH0KCSAgICB9CgkgIH0KCgkgIGZvciAodmFyIHBhcnQsIHVwID0gMCwgaSA9IHBhcnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkgICAgcGFydCA9IHBhcnRzW2ldOwoJICAgIGlmIChwYXJ0ID09PSAnLicpIHsKCSAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsKCSAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICcuLicpIHsKCSAgICAgIHVwKys7CgkgICAgfSBlbHNlIGlmICh1cCA+IDApIHsKCSAgICAgIGlmIChwYXJ0ID09PSAnJykgewoJICAgICAgICAvLyBUaGUgZmlyc3QgcGFydCBpcyBibGFuayBpZiB0aGUgcGF0aCBpcyBhYnNvbHV0ZS4gVHJ5aW5nIHRvIGdvCgkgICAgICAgIC8vIGFib3ZlIHRoZSByb290IGlzIGEgbm8tb3AuIFRoZXJlZm9yZSB3ZSBjYW4gcmVtb3ZlIGFsbCAnLi4nIHBhcnRzCgkgICAgICAgIC8vIGRpcmVjdGx5IGFmdGVyIHRoZSByb290LgoJICAgICAgICBwYXJ0cy5zcGxpY2UoaSArIDEsIHVwKTsKCSAgICAgICAgdXAgPSAwOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgcGFydHMuc3BsaWNlKGksIDIpOwoJICAgICAgICB1cC0tOwoJICAgICAgfQoJICAgIH0KCSAgfQoJICBwYXRoID0gcGFydHMuam9pbignLycpOwoKCSAgaWYgKHBhdGggPT09ICcnKSB7CgkgICAgcGF0aCA9IGlzQWJzb2x1dGUgPyAnLycgOiAnLic7CgkgIH0KCgkgIGlmICh1cmwpIHsKCSAgICB1cmwucGF0aCA9IHBhdGg7CgkgICAgcmV0dXJuIHVybEdlbmVyYXRlKHVybCk7CgkgIH0KCSAgcmV0dXJuIHBhdGg7Cgl9KTsKCWV4cG9ydHMubm9ybWFsaXplID0gbm9ybWFsaXplOwoKCS8qKgoJICogSm9pbnMgdHdvIHBhdGhzL1VSTHMuCgkgKgoJICogQHBhcmFtIGFSb290IFRoZSByb290IHBhdGggb3IgVVJMLgoJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIFVSTCB0byBiZSBqb2luZWQgd2l0aCB0aGUgcm9vdC4KCSAqCgkgKiAtIElmIGFQYXRoIGlzIGEgVVJMIG9yIGEgZGF0YSBVUkksIGFQYXRoIGlzIHJldHVybmVkLCB1bmxlc3MgYVBhdGggaXMgYQoJICogICBzY2hlbWUtcmVsYXRpdmUgVVJMOiBUaGVuIHRoZSBzY2hlbWUgb2YgYVJvb3QsIGlmIGFueSwgaXMgcHJlcGVuZGVkCgkgKiAgIGZpcnN0LgoJICogLSBPdGhlcndpc2UgYVBhdGggaXMgYSBwYXRoLiBJZiBhUm9vdCBpcyBhIFVSTCwgdGhlbiBpdHMgcGF0aCBwb3J0aW9uCgkgKiAgIGlzIHVwZGF0ZWQgd2l0aCB0aGUgcmVzdWx0IGFuZCBhUm9vdCBpcyByZXR1cm5lZC4gT3RoZXJ3aXNlIHRoZSByZXN1bHQKCSAqICAgaXMgcmV0dXJuZWQuCgkgKiAgIC0gSWYgYVBhdGggaXMgYWJzb2x1dGUsIHRoZSByZXN1bHQgaXMgYVBhdGguCgkgKiAgIC0gT3RoZXJ3aXNlIHRoZSB0d28gcGF0aHMgYXJlIGpvaW5lZCB3aXRoIGEgc2xhc2guCgkgKiAtIEpvaW5pbmcgZm9yIGV4YW1wbGUgJ2h0dHA6Ly8nIGFuZCAnd3d3LmV4YW1wbGUuY29tJyBpcyBhbHNvIHN1cHBvcnRlZC4KCSAqLwoJZnVuY3Rpb24gam9pbihhUm9vdCwgYVBhdGgpIHsKCSAgaWYgKGFSb290ID09PSAiIikgewoJICAgIGFSb290ID0gIi4iOwoJICB9CgkgIGlmIChhUGF0aCA9PT0gIiIpIHsKCSAgICBhUGF0aCA9ICIuIjsKCSAgfQoJICB2YXIgYVBhdGhVcmwgPSB1cmxQYXJzZShhUGF0aCk7CgkgIHZhciBhUm9vdFVybCA9IHVybFBhcnNlKGFSb290KTsKCSAgaWYgKGFSb290VXJsKSB7CgkgICAgYVJvb3QgPSBhUm9vdFVybC5wYXRoIHx8ICcvJzsKCSAgfQoKCSAgLy8gYGpvaW4oZm9vLCAnLy93d3cuZXhhbXBsZS5vcmcnKWAKCSAgaWYgKGFQYXRoVXJsICYmICFhUGF0aFVybC5zY2hlbWUpIHsKCSAgICBpZiAoYVJvb3RVcmwpIHsKCSAgICAgIGFQYXRoVXJsLnNjaGVtZSA9IGFSb290VXJsLnNjaGVtZTsKCSAgICB9CgkgICAgcmV0dXJuIHVybEdlbmVyYXRlKGFQYXRoVXJsKTsKCSAgfQoKCSAgaWYgKGFQYXRoVXJsIHx8IGFQYXRoLm1hdGNoKGRhdGFVcmxSZWdleHApKSB7CgkgICAgcmV0dXJuIGFQYXRoOwoJICB9CgoJICAvLyBgam9pbignaHR0cDovLycsICd3d3cuZXhhbXBsZS5jb20nKWAKCSAgaWYgKGFSb290VXJsICYmICFhUm9vdFVybC5ob3N0ICYmICFhUm9vdFVybC5wYXRoKSB7CgkgICAgYVJvb3RVcmwuaG9zdCA9IGFQYXRoOwoJICAgIHJldHVybiB1cmxHZW5lcmF0ZShhUm9vdFVybCk7CgkgIH0KCgkgIHZhciBqb2luZWQgPSBhUGF0aC5jaGFyQXQoMCkgPT09ICcvJwoJICAgID8gYVBhdGgKCSAgICA6IG5vcm1hbGl6ZShhUm9vdC5yZXBsYWNlKC9cLyskLywgJycpICsgJy8nICsgYVBhdGgpOwoKCSAgaWYgKGFSb290VXJsKSB7CgkgICAgYVJvb3RVcmwucGF0aCA9IGpvaW5lZDsKCSAgICByZXR1cm4gdXJsR2VuZXJhdGUoYVJvb3RVcmwpOwoJICB9CgkgIHJldHVybiBqb2luZWQ7Cgl9CglleHBvcnRzLmpvaW4gPSBqb2luOwoKCWV4cG9ydHMuaXNBYnNvbHV0ZSA9IGZ1bmN0aW9uIChhUGF0aCkgewoJICByZXR1cm4gYVBhdGguY2hhckF0KDApID09PSAnLycgfHwgdXJsUmVnZXhwLnRlc3QoYVBhdGgpOwoJfTsKCgkvKioKCSAqIE1ha2UgYSBwYXRoIHJlbGF0aXZlIHRvIGEgVVJMIG9yIGFub3RoZXIgcGF0aC4KCSAqCgkgKiBAcGFyYW0gYVJvb3QgVGhlIHJvb3QgcGF0aCBvciBVUkwuCgkgKiBAcGFyYW0gYVBhdGggVGhlIHBhdGggb3IgVVJMIHRvIGJlIG1hZGUgcmVsYXRpdmUgdG8gYVJvb3QuCgkgKi8KCWZ1bmN0aW9uIHJlbGF0aXZlKGFSb290LCBhUGF0aCkgewoJICBpZiAoYVJvb3QgPT09ICIiKSB7CgkgICAgYVJvb3QgPSAiLiI7CgkgIH0KCgkgIGFSb290ID0gYVJvb3QucmVwbGFjZSgvXC8kLywgJycpOwoKCSAgLy8gSXQgaXMgcG9zc2libGUgZm9yIHRoZSBwYXRoIHRvIGJlIGFib3ZlIHRoZSByb290LiBJbiB0aGlzIGNhc2UsIHNpbXBseQoJICAvLyBjaGVja2luZyB3aGV0aGVyIHRoZSByb290IGlzIGEgcHJlZml4IG9mIHRoZSBwYXRoIHdvbid0IHdvcmsuIEluc3RlYWQsIHdlCgkgIC8vIG5lZWQgdG8gcmVtb3ZlIGNvbXBvbmVudHMgZnJvbSB0aGUgcm9vdCBvbmUgYnkgb25lLCB1bnRpbCBlaXRoZXIgd2UgZmluZAoJICAvLyBhIHByZWZpeCB0aGF0IGZpdHMsIG9yIHdlIHJ1biBvdXQgb2YgY29tcG9uZW50cyB0byByZW1vdmUuCgkgIHZhciBsZXZlbCA9IDA7CgkgIHdoaWxlIChhUGF0aC5pbmRleE9mKGFSb290ICsgJy8nKSAhPT0gMCkgewoJICAgIHZhciBpbmRleCA9IGFSb290Lmxhc3RJbmRleE9mKCIvIik7CgkgICAgaWYgKGluZGV4IDwgMCkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCgkgICAgLy8gSWYgdGhlIG9ubHkgcGFydCBvZiB0aGUgcm9vdCB0aGF0IGlzIGxlZnQgaXMgdGhlIHNjaGVtZSAoaS5lLiBodHRwOi8vLAoJICAgIC8vIGZpbGU6Ly8vLCBldGMuKSwgb25lIG9yIG1vcmUgc2xhc2hlcyAoLyksIG9yIHNpbXBseSBub3RoaW5nIGF0IGFsbCwgd2UKCSAgICAvLyBoYXZlIGV4aGF1c3RlZCBhbGwgY29tcG9uZW50cywgc28gdGhlIHBhdGggaXMgbm90IHJlbGF0aXZlIHRvIHRoZSByb290LgoJICAgIGFSb290ID0gYVJvb3Quc2xpY2UoMCwgaW5kZXgpOwoJICAgIGlmIChhUm9vdC5tYXRjaCgvXihbXlwvXSs6XC8pP1wvKiQvKSkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCgkgICAgKytsZXZlbDsKCSAgfQoKCSAgLy8gTWFrZSBzdXJlIHdlIGFkZCBhICIuLi8iIGZvciBlYWNoIGNvbXBvbmVudCB3ZSByZW1vdmVkIGZyb20gdGhlIHJvb3QuCgkgIHJldHVybiBBcnJheShsZXZlbCArIDEpLmpvaW4oIi4uLyIpICsgYVBhdGguc3Vic3RyKGFSb290Lmxlbmd0aCArIDEpOwoJfQoJZXhwb3J0cy5yZWxhdGl2ZSA9IHJlbGF0aXZlOwoKCXZhciBzdXBwb3J0c051bGxQcm90byA9IChmdW5jdGlvbiAoKSB7CgkgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJICByZXR1cm4gISgnX19wcm90b19fJyBpbiBvYmopOwoJfSgpKTsKCglmdW5jdGlvbiBpZGVudGl0eSAocykgewoJICByZXR1cm4gczsKCX0KCgkvKioKCSAqIEJlY2F1c2UgYmVoYXZpb3IgZ29lcyB3YWNreSB3aGVuIHlvdSBzZXQgYF9fcHJvdG9fX2Agb24gb2JqZWN0cywgd2UKCSAqIGhhdmUgdG8gcHJlZml4IGFsbCB0aGUgc3RyaW5ncyBpbiBvdXIgc2V0IHdpdGggYW4gYXJiaXRyYXJ5IGNoYXJhY3Rlci4KCSAqCgkgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9wdWxsLzMxIGFuZAoJICogaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9pc3N1ZXMvMzAKCSAqCgkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCSAqLwoJZnVuY3Rpb24gdG9TZXRTdHJpbmcoYVN0cikgewoJICBpZiAoaXNQcm90b1N0cmluZyhhU3RyKSkgewoJICAgIHJldHVybiAnJCcgKyBhU3RyOwoJICB9CgoJICByZXR1cm4gYVN0cjsKCX0KCWV4cG9ydHMudG9TZXRTdHJpbmcgPSBzdXBwb3J0c051bGxQcm90byA/IGlkZW50aXR5IDogdG9TZXRTdHJpbmc7CgoJZnVuY3Rpb24gZnJvbVNldFN0cmluZyhhU3RyKSB7CgkgIGlmIChpc1Byb3RvU3RyaW5nKGFTdHIpKSB7CgkgICAgcmV0dXJuIGFTdHIuc2xpY2UoMSk7CgkgIH0KCgkgIHJldHVybiBhU3RyOwoJfQoJZXhwb3J0cy5mcm9tU2V0U3RyaW5nID0gc3VwcG9ydHNOdWxsUHJvdG8gPyBpZGVudGl0eSA6IGZyb21TZXRTdHJpbmc7CgoJZnVuY3Rpb24gaXNQcm90b1N0cmluZyhzKSB7CgkgIGlmICghcykgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoKCSAgdmFyIGxlbmd0aCA9IHMubGVuZ3RoOwoKCSAgaWYgKGxlbmd0aCA8IDkgLyogIl9fcHJvdG9fXyIubGVuZ3RoICovKSB7CgkgICAgcmV0dXJuIGZhbHNlOwoJICB9CgoJICBpZiAocy5jaGFyQ29kZUF0KGxlbmd0aCAtIDEpICE9PSA5NSAgLyogJ18nICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gMikgIT09IDk1ICAvKiAnXycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSAzKSAhPT0gMTExIC8qICdvJyAqLyB8fAoJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDQpICE9PSAxMTYgLyogJ3QnICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gNSkgIT09IDExMSAvKiAnbycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA2KSAhPT0gMTE0IC8qICdyJyAqLyB8fAoJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDcpICE9PSAxMTIgLyogJ3AnICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gOCkgIT09IDk1ICAvKiAnXycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA5KSAhPT0gOTUgIC8qICdfJyAqLykgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoKCSAgZm9yICh2YXIgaSA9IGxlbmd0aCAtIDEwOyBpID49IDA7IGktLSkgewoJICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgIT09IDM2IC8qICckJyAqLykgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBDb21wYXJhdG9yIGJldHdlZW4gdHdvIG1hcHBpbmdzIHdoZXJlIHRoZSBvcmlnaW5hbCBwb3NpdGlvbnMgYXJlIGNvbXBhcmVkLgoJICoKCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCSAqIG1hcHBpbmdzIHdpdGggdGhlIHNhbWUgb3JpZ2luYWwgc291cmNlL2xpbmUvY29sdW1uLCBidXQgZGlmZmVyZW50IGdlbmVyYXRlZAoJICogbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEgbWFwcGluZyB3aXRoIGEKCSAqIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICB2YXIgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkgIGlmIChjbXAgIT09IDAgfHwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCX0KCWV4cG9ydHMuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMgPSBjb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uczsKCglmdW5jdGlvbiBjb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uc05vU291cmNlKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICB2YXIgY21wOwoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCB8fCBvbmx5Q29tcGFyZU9yaWdpbmFsKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkQ29sdW1uIC0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJfQoJZXhwb3J0cy5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uc05vU291cmNlID0gY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnNOb1NvdXJjZTsKCgkvKioKCSAqIENvbXBhcmF0b3IgYmV0d2VlbiB0d28gbWFwcGluZ3Mgd2l0aCBkZWZsYXRlZCBzb3VyY2UgYW5kIG5hbWUgaW5kaWNlcyB3aGVyZQoJICogdGhlIGdlbmVyYXRlZCBwb3NpdGlvbnMgYXJlIGNvbXBhcmVkLgoJICoKCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCSAqIG1hcHBpbmdzIHdpdGggdGhlIHNhbWUgZ2VuZXJhdGVkIGxpbmUgYW5kIGNvbHVtbiwgYnV0IGRpZmZlcmVudAoJICogc291cmNlL25hbWUvb3JpZ2luYWwgbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEKCSAqIG1hcHBpbmcgd2l0aCBhIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkQ29sdW1uIC0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJICBpZiAoY21wICE9PSAwIHx8IG9ubHlDb21wYXJlR2VuZXJhdGVkKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJfQoJZXhwb3J0cy5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZCA9IGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkOwoKCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkTm9MaW5lKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCB8fCBvbmx5Q29tcGFyZUdlbmVyYXRlZCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IHN0cmNtcChtYXBwaW5nQS5zb3VyY2UsIG1hcHBpbmdCLnNvdXJjZSk7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbExpbmUgLSBtYXBwaW5nQi5vcmlnaW5hbExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbENvbHVtbiAtIG1hcHBpbmdCLm9yaWdpbmFsQ29sdW1uOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCX0KCWV4cG9ydHMuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWROb0xpbmUgPSBjb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZE5vTGluZTsKCglmdW5jdGlvbiBzdHJjbXAoYVN0cjEsIGFTdHIyKSB7CgkgIGlmIChhU3RyMSA9PT0gYVN0cjIpIHsKCSAgICByZXR1cm4gMDsKCSAgfQoKCSAgaWYgKGFTdHIxID09PSBudWxsKSB7CgkgICAgcmV0dXJuIDE7IC8vIGFTdHIyICE9PSBudWxsCgkgIH0KCgkgIGlmIChhU3RyMiA9PT0gbnVsbCkgewoJICAgIHJldHVybiAtMTsgLy8gYVN0cjEgIT09IG51bGwKCSAgfQoKCSAgaWYgKGFTdHIxID4gYVN0cjIpIHsKCSAgICByZXR1cm4gMTsKCSAgfQoKCSAgcmV0dXJuIC0xOwoJfQoKCS8qKgoJICogQ29tcGFyYXRvciBiZXR3ZWVuIHR3byBtYXBwaW5ncyB3aXRoIGluZmxhdGVkIHNvdXJjZSBhbmQgbmFtZSBzdHJpbmdzIHdoZXJlCgkgKiB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9ucyBhcmUgY29tcGFyZWQuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQikgewoJICB2YXIgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRDb2x1bW4gLSBtYXBwaW5nQi5nZW5lcmF0ZWRDb2x1bW47CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBzdHJjbXAobWFwcGluZ0Euc291cmNlLCBtYXBwaW5nQi5zb3VyY2UpOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIHJldHVybiBzdHJjbXAobWFwcGluZ0EubmFtZSwgbWFwcGluZ0IubmFtZSk7Cgl9CglleHBvcnRzLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkID0gY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQ7CgoJLyoqCgkgKiBTdHJpcCBhbnkgSlNPTiBYU1NJIGF2b2lkYW5jZSBwcmVmaXggZnJvbSB0aGUgc3RyaW5nIChhcyBkb2N1bWVudGVkCgkgKiBpbiB0aGUgc291cmNlIG1hcHMgc3BlY2lmaWNhdGlvbiksIGFuZCB0aGVuIHBhcnNlIHRoZSBzdHJpbmcgYXMKCSAqIEpTT04uCgkgKi8KCWZ1bmN0aW9uIHBhcnNlU291cmNlTWFwSW5wdXQoc3RyKSB7CgkgIHJldHVybiBKU09OLnBhcnNlKHN0ci5yZXBsYWNlKC9eXCldfSdbXlxuXSpcbi8sICcnKSk7Cgl9CglleHBvcnRzLnBhcnNlU291cmNlTWFwSW5wdXQgPSBwYXJzZVNvdXJjZU1hcElucHV0OwoKCS8qKgoJICogQ29tcHV0ZSB0aGUgVVJMIG9mIGEgc291cmNlIGdpdmVuIHRoZSB0aGUgc291cmNlIHJvb3QsIHRoZSBzb3VyY2UncwoJICogVVJMLCBhbmQgdGhlIHNvdXJjZSBtYXAncyBVUkwuCgkgKi8KCWZ1bmN0aW9uIGNvbXB1dGVTb3VyY2VVUkwoc291cmNlUm9vdCwgc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpIHsKCSAgc291cmNlVVJMID0gc291cmNlVVJMIHx8ICcnOwoKCSAgaWYgKHNvdXJjZVJvb3QpIHsKCSAgICAvLyBUaGlzIGZvbGxvd3Mgd2hhdCBDaHJvbWUgZG9lcy4KCSAgICBpZiAoc291cmNlUm9vdFtzb3VyY2VSb290Lmxlbmd0aCAtIDFdICE9PSAnLycgJiYgc291cmNlVVJMWzBdICE9PSAnLycpIHsKCSAgICAgIHNvdXJjZVJvb3QgKz0gJy8nOwoJICAgIH0KCSAgICAvLyBUaGUgc3BlYyBzYXlzOgoJICAgIC8vICAgTGluZSA0OiBBbiBvcHRpb25hbCBzb3VyY2Ugcm9vdCwgdXNlZnVsIGZvciByZWxvY2F0aW5nIHNvdXJjZQoJICAgIC8vICAgZmlsZXMgb24gYSBzZXJ2ZXIgb3IgcmVtb3ZpbmcgcmVwZWF0ZWQgdmFsdWVzIGluIHRoZQoJICAgIC8vICAg4oCcc291cmNlc+KAnSBlbnRyeS4gIFRoaXMgdmFsdWUgaXMgcHJlcGVuZGVkIHRvIHRoZSBpbmRpdmlkdWFsCgkgICAgLy8gICBlbnRyaWVzIGluIHRoZSDigJxzb3VyY2XigJ0gZmllbGQuCgkgICAgc291cmNlVVJMID0gc291cmNlUm9vdCArIHNvdXJjZVVSTDsKCSAgfQoKCSAgLy8gSGlzdG9yaWNhbGx5LCBTb3VyY2VNYXBDb25zdW1lciBkaWQgbm90IHRha2UgdGhlIHNvdXJjZU1hcFVSTCBhcwoJICAvLyBhIHBhcmFtZXRlci4gIFRoaXMgbW9kZSBpcyBzdGlsbCBzb21ld2hhdCBzdXBwb3J0ZWQsIHdoaWNoIGlzIHdoeQoJICAvLyB0aGlzIGNvZGUgYmxvY2sgaXMgY29uZGl0aW9uYWwuICBIb3dldmVyLCBpdCdzIHByZWZlcmFibGUgdG8gcGFzcwoJICAvLyB0aGUgc291cmNlIG1hcCBVUkwgdG8gU291cmNlTWFwQ29uc3VtZXIsIHNvIHRoYXQgdGhpcyBmdW5jdGlvbgoJICAvLyBjYW4gaW1wbGVtZW50IHRoZSBzb3VyY2UgVVJMIHJlc29sdXRpb24gYWxnb3JpdGhtIGFzIG91dGxpbmVkIGluCgkgIC8vIHRoZSBzcGVjLiAgVGhpcyBibG9jayBpcyBiYXNpY2FsbHkgdGhlIGVxdWl2YWxlbnQgb2Y6CgkgIC8vICAgIG5ldyBVUkwoc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpLnRvU3RyaW5nKCkKCSAgLy8gLi4uIGV4Y2VwdCBpdCBhdm9pZHMgdXNpbmcgVVJMLCB3aGljaCB3YXNuJ3QgYXZhaWxhYmxlIGluIHRoZQoJICAvLyBvbGRlciByZWxlYXNlcyBvZiBub2RlIHN0aWxsIHN1cHBvcnRlZCBieSB0aGlzIGxpYnJhcnkuCgkgIC8vCgkgIC8vIFRoZSBzcGVjIHNheXM6CgkgIC8vICAgSWYgdGhlIHNvdXJjZXMgYXJlIG5vdCBhYnNvbHV0ZSBVUkxzIGFmdGVyIHByZXBlbmRpbmcgb2YgdGhlCgkgIC8vICAg4oCcc291cmNlUm9vdOKAnSwgdGhlIHNvdXJjZXMgYXJlIHJlc29sdmVkIHJlbGF0aXZlIHRvIHRoZQoJICAvLyAgIFNvdXJjZU1hcCAobGlrZSByZXNvbHZpbmcgc2NyaXB0IHNyYyBpbiBhIGh0bWwgZG9jdW1lbnQpLgoJICBpZiAoc291cmNlTWFwVVJMKSB7CgkgICAgdmFyIHBhcnNlZCA9IHVybFBhcnNlKHNvdXJjZU1hcFVSTCk7CgkgICAgaWYgKCFwYXJzZWQpIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcigic291cmNlTWFwVVJMIGNvdWxkIG5vdCBiZSBwYXJzZWQiKTsKCSAgICB9CgkgICAgaWYgKHBhcnNlZC5wYXRoKSB7CgkgICAgICAvLyBTdHJpcCB0aGUgbGFzdCBwYXRoIGNvbXBvbmVudCwgYnV0IGtlZXAgdGhlICIvIi4KCSAgICAgIHZhciBpbmRleCA9IHBhcnNlZC5wYXRoLmxhc3RJbmRleE9mKCcvJyk7CgkgICAgICBpZiAoaW5kZXggPj0gMCkgewoJICAgICAgICBwYXJzZWQucGF0aCA9IHBhcnNlZC5wYXRoLnN1YnN0cmluZygwLCBpbmRleCArIDEpOwoJICAgICAgfQoJICAgIH0KCSAgICBzb3VyY2VVUkwgPSBqb2luKHVybEdlbmVyYXRlKHBhcnNlZCksIHNvdXJjZVVSTCk7CgkgIH0KCgkgIHJldHVybiBub3JtYWxpemUoc291cmNlVVJMKTsKCX0KCWV4cG9ydHMuY29tcHV0ZVNvdXJjZVVSTCA9IGNvbXB1dGVTb3VyY2VVUkw7IAp9ICh1dGlsJDMpKTsKCnZhciBhcnJheVNldCA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgdXRpbCQyID0gdXRpbCQzOwp2YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIGhhc05hdGl2ZU1hcCA9IHR5cGVvZiBNYXAgIT09ICJ1bmRlZmluZWQiOwoKLyoqCiAqIEEgZGF0YSBzdHJ1Y3R1cmUgd2hpY2ggaXMgYSBjb21iaW5hdGlvbiBvZiBhbiBhcnJheSBhbmQgYSBzZXQuIEFkZGluZyBhIG5ldwogKiBtZW1iZXIgaXMgTygxKSwgdGVzdGluZyBmb3IgbWVtYmVyc2hpcCBpcyBPKDEpLCBhbmQgZmluZGluZyB0aGUgaW5kZXggb2YgYW4KICogZWxlbWVudCBpcyBPKDEpLiBSZW1vdmluZyBlbGVtZW50cyBmcm9tIHRoZSBzZXQgaXMgbm90IHN1cHBvcnRlZC4gT25seQogKiBzdHJpbmdzIGFyZSBzdXBwb3J0ZWQgZm9yIG1lbWJlcnNoaXAuCiAqLwpmdW5jdGlvbiBBcnJheVNldCQxKCkgewogIHRoaXMuX2FycmF5ID0gW107CiAgdGhpcy5fc2V0ID0gaGFzTmF0aXZlTWFwID8gbmV3IE1hcCgpIDogT2JqZWN0LmNyZWF0ZShudWxsKTsKfQoKLyoqCiAqIFN0YXRpYyBtZXRob2QgZm9yIGNyZWF0aW5nIEFycmF5U2V0IGluc3RhbmNlcyBmcm9tIGFuIGV4aXN0aW5nIGFycmF5LgogKi8KQXJyYXlTZXQkMS5mcm9tQXJyYXkgPSBmdW5jdGlvbiBBcnJheVNldF9mcm9tQXJyYXkoYUFycmF5LCBhQWxsb3dEdXBsaWNhdGVzKSB7CiAgdmFyIHNldCA9IG5ldyBBcnJheVNldCQxKCk7CiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgc2V0LmFkZChhQXJyYXlbaV0sIGFBbGxvd0R1cGxpY2F0ZXMpOwogIH0KICByZXR1cm4gc2V0Owp9OwoKLyoqCiAqIFJldHVybiBob3cgbWFueSB1bmlxdWUgaXRlbXMgYXJlIGluIHRoaXMgQXJyYXlTZXQuIElmIGR1cGxpY2F0ZXMgaGF2ZSBiZWVuCiAqIGFkZGVkLCB0aGFuIHRob3NlIGRvIG5vdCBjb3VudCB0b3dhcmRzIHRoZSBzaXplLgogKgogKiBAcmV0dXJucyBOdW1iZXIKICovCkFycmF5U2V0JDEucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiBBcnJheVNldF9zaXplKCkgewogIHJldHVybiBoYXNOYXRpdmVNYXAgPyB0aGlzLl9zZXQuc2l6ZSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMuX3NldCkubGVuZ3RoOwp9OwoKLyoqCiAqIEFkZCB0aGUgZ2l2ZW4gc3RyaW5nIHRvIHRoaXMgc2V0LgogKgogKiBAcGFyYW0gU3RyaW5nIGFTdHIKICovCkFycmF5U2V0JDEucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIEFycmF5U2V0X2FkZChhU3RyLCBhQWxsb3dEdXBsaWNhdGVzKSB7CiAgdmFyIHNTdHIgPSBoYXNOYXRpdmVNYXAgPyBhU3RyIDogdXRpbCQyLnRvU2V0U3RyaW5nKGFTdHIpOwogIHZhciBpc0R1cGxpY2F0ZSA9IGhhc05hdGl2ZU1hcCA/IHRoaXMuaGFzKGFTdHIpIDogaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKICB2YXIgaWR4ID0gdGhpcy5fYXJyYXkubGVuZ3RoOwogIGlmICghaXNEdXBsaWNhdGUgfHwgYUFsbG93RHVwbGljYXRlcykgewogICAgdGhpcy5fYXJyYXkucHVzaChhU3RyKTsKICB9CiAgaWYgKCFpc0R1cGxpY2F0ZSkgewogICAgaWYgKGhhc05hdGl2ZU1hcCkgewogICAgICB0aGlzLl9zZXQuc2V0KGFTdHIsIGlkeCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9zZXRbc1N0cl0gPSBpZHg7CiAgICB9CiAgfQp9OwoKLyoqCiAqIElzIHRoZSBnaXZlbiBzdHJpbmcgYSBtZW1iZXIgb2YgdGhpcyBzZXQ/CiAqCiAqIEBwYXJhbSBTdHJpbmcgYVN0cgogKi8KQXJyYXlTZXQkMS5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gQXJyYXlTZXRfaGFzKGFTdHIpIHsKICBpZiAoaGFzTmF0aXZlTWFwKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhhU3RyKTsKICB9IGVsc2UgewogICAgdmFyIHNTdHIgPSB1dGlsJDIudG9TZXRTdHJpbmcoYVN0cik7CiAgICByZXR1cm4gaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKICB9Cn07CgovKioKICogV2hhdCBpcyB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIHN0cmluZyBpbiB0aGUgYXJyYXk/CiAqCiAqIEBwYXJhbSBTdHJpbmcgYVN0cgogKi8KQXJyYXlTZXQkMS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIEFycmF5U2V0X2luZGV4T2YoYVN0cikgewogIGlmIChoYXNOYXRpdmVNYXApIHsKICAgIHZhciBpZHggPSB0aGlzLl9zZXQuZ2V0KGFTdHIpOwogICAgaWYgKGlkeCA+PSAwKSB7CiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KICB9IGVsc2UgewogICAgdmFyIHNTdHIgPSB1dGlsJDIudG9TZXRTdHJpbmcoYVN0cik7CiAgICBpZiAoaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKSkgewogICAgICByZXR1cm4gdGhpcy5fc2V0W3NTdHJdOwogICAgfQogIH0KCiAgdGhyb3cgbmV3IEVycm9yKCciJyArIGFTdHIgKyAnIiBpcyBub3QgaW4gdGhlIHNldC4nKTsKfTsKCi8qKgogKiBXaGF0IGlzIHRoZSBlbGVtZW50IGF0IHRoZSBnaXZlbiBpbmRleD8KICoKICogQHBhcmFtIE51bWJlciBhSWR4CiAqLwpBcnJheVNldCQxLnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIEFycmF5U2V0X2F0KGFJZHgpIHsKICBpZiAoYUlkeCA+PSAwICYmIGFJZHggPCB0aGlzLl9hcnJheS5sZW5ndGgpIHsKICAgIHJldHVybiB0aGlzLl9hcnJheVthSWR4XTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKCdObyBlbGVtZW50IGluZGV4ZWQgYnkgJyArIGFJZHgpOwp9OwoKLyoqCiAqIFJldHVybnMgdGhlIGFycmF5IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgc2V0ICh3aGljaCBoYXMgdGhlIHByb3BlciBpbmRpY2VzCiAqIGluZGljYXRlZCBieSBpbmRleE9mKS4gTm90ZSB0aGF0IHRoaXMgaXMgYSBjb3B5IG9mIHRoZSBpbnRlcm5hbCBhcnJheSB1c2VkCiAqIGZvciBzdG9yaW5nIHRoZSBtZW1iZXJzIHNvIHRoYXQgbm8gb25lIGNhbiBtZXNzIHdpdGggaW50ZXJuYWwgc3RhdGUuCiAqLwpBcnJheVNldCQxLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gQXJyYXlTZXRfdG9BcnJheSgpIHsKICByZXR1cm4gdGhpcy5fYXJyYXkuc2xpY2UoKTsKfTsKCmFycmF5U2V0LkFycmF5U2V0ID0gQXJyYXlTZXQkMTsKCnZhciBtYXBwaW5nTGlzdCA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTQgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgdXRpbCQxID0gdXRpbCQzOwoKLyoqCiAqIERldGVybWluZSB3aGV0aGVyIG1hcHBpbmdCIGlzIGFmdGVyIG1hcHBpbmdBIHdpdGggcmVzcGVjdCB0byBnZW5lcmF0ZWQKICogcG9zaXRpb24uCiAqLwpmdW5jdGlvbiBnZW5lcmF0ZWRQb3NpdGlvbkFmdGVyKG1hcHBpbmdBLCBtYXBwaW5nQikgewogIC8vIE9wdGltaXplZCBmb3IgbW9zdCBjb21tb24gY2FzZQogIHZhciBsaW5lQSA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmU7CiAgdmFyIGxpbmVCID0gbWFwcGluZ0IuZ2VuZXJhdGVkTGluZTsKICB2YXIgY29sdW1uQSA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbjsKICB2YXIgY29sdW1uQiA9IG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKICByZXR1cm4gbGluZUIgPiBsaW5lQSB8fCBsaW5lQiA9PSBsaW5lQSAmJiBjb2x1bW5CID49IGNvbHVtbkEgfHwKICAgICAgICAgdXRpbCQxLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQikgPD0gMDsKfQoKLyoqCiAqIEEgZGF0YSBzdHJ1Y3R1cmUgdG8gcHJvdmlkZSBhIHNvcnRlZCB2aWV3IG9mIGFjY3VtdWxhdGVkIG1hcHBpbmdzIGluIGEKICogcGVyZm9ybWFuY2UgY29uc2Npb3VzIG1hbm5lci4gSXQgdHJhZGVzIGEgbmVnbGliYWJsZSBvdmVyaGVhZCBpbiBnZW5lcmFsCiAqIGNhc2UgZm9yIGEgbGFyZ2Ugc3BlZWR1cCBpbiBjYXNlIG9mIG1hcHBpbmdzIGJlaW5nIGFkZGVkIGluIG9yZGVyLgogKi8KZnVuY3Rpb24gTWFwcGluZ0xpc3QkMSgpIHsKICB0aGlzLl9hcnJheSA9IFtdOwogIHRoaXMuX3NvcnRlZCA9IHRydWU7CiAgLy8gU2VydmVzIGFzIGluZmltdW0KICB0aGlzLl9sYXN0ID0ge2dlbmVyYXRlZExpbmU6IC0xLCBnZW5lcmF0ZWRDb2x1bW46IDB9Owp9CgovKioKICogSXRlcmF0ZSB0aHJvdWdoIGludGVybmFsIGl0ZW1zLiBUaGlzIG1ldGhvZCB0YWtlcyB0aGUgc2FtZSBhcmd1bWVudHMgdGhhdAogKiBgQXJyYXkucHJvdG90eXBlLmZvckVhY2hgIHRha2VzLgogKgogKiBOT1RFOiBUaGUgb3JkZXIgb2YgdGhlIG1hcHBpbmdzIGlzIE5PVCBndWFyYW50ZWVkLgogKi8KTWFwcGluZ0xpc3QkMS5wcm90b3R5cGUudW5zb3J0ZWRGb3JFYWNoID0KICBmdW5jdGlvbiBNYXBwaW5nTGlzdF9mb3JFYWNoKGFDYWxsYmFjaywgYVRoaXNBcmcpIHsKICAgIHRoaXMuX2FycmF5LmZvckVhY2goYUNhbGxiYWNrLCBhVGhpc0FyZyk7CiAgfTsKCi8qKgogKiBBZGQgdGhlIGdpdmVuIHNvdXJjZSBtYXBwaW5nLgogKgogKiBAcGFyYW0gT2JqZWN0IGFNYXBwaW5nCiAqLwpNYXBwaW5nTGlzdCQxLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBNYXBwaW5nTGlzdF9hZGQoYU1hcHBpbmcpIHsKICBpZiAoZ2VuZXJhdGVkUG9zaXRpb25BZnRlcih0aGlzLl9sYXN0LCBhTWFwcGluZykpIHsKICAgIHRoaXMuX2xhc3QgPSBhTWFwcGluZzsKICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwogIH0gZWxzZSB7CiAgICB0aGlzLl9zb3J0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwogIH0KfTsKCi8qKgogKiBSZXR1cm5zIHRoZSBmbGF0LCBzb3J0ZWQgYXJyYXkgb2YgbWFwcGluZ3MuIFRoZSBtYXBwaW5ncyBhcmUgc29ydGVkIGJ5CiAqIGdlbmVyYXRlZCBwb3NpdGlvbi4KICoKICogV0FSTklORzogVGhpcyBtZXRob2QgcmV0dXJucyBpbnRlcm5hbCBkYXRhIHdpdGhvdXQgY29weWluZywgZm9yCiAqIHBlcmZvcm1hbmNlLiBUaGUgcmV0dXJuIHZhbHVlIG11c3QgTk9UIGJlIG11dGF0ZWQsIGFuZCBzaG91bGQgYmUgdHJlYXRlZCBhcwogKiBhbiBpbW11dGFibGUgYm9ycm93LiBJZiB5b3Ugd2FudCB0byB0YWtlIG93bmVyc2hpcCwgeW91IG11c3QgbWFrZSB5b3VyIG93bgogKiBjb3B5LgogKi8KTWFwcGluZ0xpc3QkMS5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uIE1hcHBpbmdMaXN0X3RvQXJyYXkoKSB7CiAgaWYgKCF0aGlzLl9zb3J0ZWQpIHsKICAgIHRoaXMuX2FycmF5LnNvcnQodXRpbCQxLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKTsKICAgIHRoaXMuX3NvcnRlZCA9IHRydWU7CiAgfQogIHJldHVybiB0aGlzLl9hcnJheTsKfTsKCm1hcHBpbmdMaXN0Lk1hcHBpbmdMaXN0ID0gTWFwcGluZ0xpc3QkMTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCi8qCiAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgogKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCiAqLwoKdmFyIGJhc2U2NFZMUSA9IGJhc2U2NFZscTsKdmFyIHV0aWwgPSB1dGlsJDM7CnZhciBBcnJheVNldCA9IGFycmF5U2V0LkFycmF5U2V0Owp2YXIgTWFwcGluZ0xpc3QgPSBtYXBwaW5nTGlzdC5NYXBwaW5nTGlzdDsKCi8qKgogKiBBbiBpbnN0YW5jZSBvZiB0aGUgU291cmNlTWFwR2VuZXJhdG9yIHJlcHJlc2VudHMgYSBzb3VyY2UgbWFwIHdoaWNoIGlzCiAqIGJlaW5nIGJ1aWx0IGluY3JlbWVudGFsbHkuIFlvdSBtYXkgcGFzcyBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nCiAqIHByb3BlcnRpZXM6CiAqCiAqICAgLSBmaWxlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIGdlbmVyYXRlZCBzb3VyY2UuCiAqICAgLSBzb3VyY2VSb290OiBBIHJvb3QgZm9yIGFsbCByZWxhdGl2ZSBVUkxzIGluIHRoaXMgc291cmNlIG1hcC4KICovCmZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcihhQXJncykgewogIGlmICghYUFyZ3MpIHsKICAgIGFBcmdzID0ge307CiAgfQogIHRoaXMuX2ZpbGUgPSB1dGlsLmdldEFyZyhhQXJncywgJ2ZpbGUnLCBudWxsKTsKICB0aGlzLl9zb3VyY2VSb290ID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdzb3VyY2VSb290JywgbnVsbCk7CiAgdGhpcy5fc2tpcFZhbGlkYXRpb24gPSB1dGlsLmdldEFyZyhhQXJncywgJ3NraXBWYWxpZGF0aW9uJywgZmFsc2UpOwogIHRoaXMuX3NvdXJjZXMgPSBuZXcgQXJyYXlTZXQoKTsKICB0aGlzLl9uYW1lcyA9IG5ldyBBcnJheVNldCgpOwogIHRoaXMuX21hcHBpbmdzID0gbmV3IE1hcHBpbmdMaXN0KCk7CiAgdGhpcy5fc291cmNlc0NvbnRlbnRzID0gbnVsbDsKfQoKU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgovKioKICogQ3JlYXRlcyBhIG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IgYmFzZWQgb24gYSBTb3VyY2VNYXBDb25zdW1lcgogKgogKiBAcGFyYW0gYVNvdXJjZU1hcENvbnN1bWVyIFRoZSBTb3VyY2VNYXAuCiAqLwpTb3VyY2VNYXBHZW5lcmF0b3IuZnJvbVNvdXJjZU1hcCA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2Zyb21Tb3VyY2VNYXAoYVNvdXJjZU1hcENvbnN1bWVyKSB7CiAgICB2YXIgc291cmNlUm9vdCA9IGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VSb290OwogICAgdmFyIGdlbmVyYXRvciA9IG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IoewogICAgICBmaWxlOiBhU291cmNlTWFwQ29uc3VtZXIuZmlsZSwKICAgICAgc291cmNlUm9vdDogc291cmNlUm9vdAogICAgfSk7CiAgICBhU291cmNlTWFwQ29uc3VtZXIuZWFjaE1hcHBpbmcoZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgdmFyIG5ld01hcHBpbmcgPSB7CiAgICAgICAgZ2VuZXJhdGVkOiB7CiAgICAgICAgICBsaW5lOiBtYXBwaW5nLmdlbmVyYXRlZExpbmUsCiAgICAgICAgICBjb2x1bW46IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uCiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKG1hcHBpbmcuc291cmNlICE9IG51bGwpIHsKICAgICAgICBuZXdNYXBwaW5nLnNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwogICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKICAgICAgICAgIG5ld01hcHBpbmcuc291cmNlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBuZXdNYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgfQoKICAgICAgICBuZXdNYXBwaW5nLm9yaWdpbmFsID0gewogICAgICAgICAgbGluZTogbWFwcGluZy5vcmlnaW5hbExpbmUsCiAgICAgICAgICBjb2x1bW46IG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KICAgICAgICB9OwoKICAgICAgICBpZiAobWFwcGluZy5uYW1lICE9IG51bGwpIHsKICAgICAgICAgIG5ld01hcHBpbmcubmFtZSA9IG1hcHBpbmcubmFtZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGdlbmVyYXRvci5hZGRNYXBwaW5nKG5ld01hcHBpbmcpOwogICAgfSk7CiAgICBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2VGaWxlKSB7CiAgICAgIHZhciBzb3VyY2VSZWxhdGl2ZSA9IHNvdXJjZUZpbGU7CiAgICAgIGlmIChzb3VyY2VSb290ICE9PSBudWxsKSB7CiAgICAgICAgc291cmNlUmVsYXRpdmUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgICB9CgogICAgICBpZiAoIWdlbmVyYXRvci5fc291cmNlcy5oYXMoc291cmNlUmVsYXRpdmUpKSB7CiAgICAgICAgZ2VuZXJhdG9yLl9zb3VyY2VzLmFkZChzb3VyY2VSZWxhdGl2ZSk7CiAgICAgIH0KCiAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CiAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHsKICAgICAgICBnZW5lcmF0b3Iuc2V0U291cmNlQ29udGVudChzb3VyY2VGaWxlLCBjb250ZW50KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZ2VuZXJhdG9yOwogIH07CgovKioKICogQWRkIGEgc2luZ2xlIG1hcHBpbmcgZnJvbSBvcmlnaW5hbCBzb3VyY2UgbGluZSBhbmQgY29sdW1uIHRvIHRoZSBnZW5lcmF0ZWQKICogc291cmNlJ3MgbGluZSBhbmQgY29sdW1uIGZvciB0aGlzIHNvdXJjZSBtYXAgYmVpbmcgY3JlYXRlZC4gVGhlIG1hcHBpbmcKICogb2JqZWN0IHNob3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKICoKICogICAtIGdlbmVyYXRlZDogQW4gb2JqZWN0IHdpdGggdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zLgogKiAgIC0gb3JpZ2luYWw6IEFuIG9iamVjdCB3aXRoIHRoZSBvcmlnaW5hbCBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zLgogKiAgIC0gc291cmNlOiBUaGUgb3JpZ2luYWwgc291cmNlIGZpbGUgKHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VSb290KS4KICogICAtIG5hbWU6IEFuIG9wdGlvbmFsIG9yaWdpbmFsIHRva2VuIG5hbWUgZm9yIHRoaXMgbWFwcGluZy4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYWRkTWFwcGluZyA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2FkZE1hcHBpbmcoYUFyZ3MpIHsKICAgIHZhciBnZW5lcmF0ZWQgPSB1dGlsLmdldEFyZyhhQXJncywgJ2dlbmVyYXRlZCcpOwogICAgdmFyIG9yaWdpbmFsID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdvcmlnaW5hbCcsIG51bGwpOwogICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJywgbnVsbCk7CiAgICB2YXIgbmFtZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbmFtZScsIG51bGwpOwoKICAgIGlmICghdGhpcy5fc2tpcFZhbGlkYXRpb24pIHsKICAgICAgdGhpcy5fdmFsaWRhdGVNYXBwaW5nKGdlbmVyYXRlZCwgb3JpZ2luYWwsIHNvdXJjZSwgbmFtZSk7CiAgICB9CgogICAgaWYgKHNvdXJjZSAhPSBudWxsKSB7CiAgICAgIHNvdXJjZSA9IFN0cmluZyhzb3VyY2UpOwogICAgICBpZiAoIXRoaXMuX3NvdXJjZXMuaGFzKHNvdXJjZSkpIHsKICAgICAgICB0aGlzLl9zb3VyY2VzLmFkZChzb3VyY2UpOwogICAgICB9CiAgICB9CgogICAgaWYgKG5hbWUgIT0gbnVsbCkgewogICAgICBuYW1lID0gU3RyaW5nKG5hbWUpOwogICAgICBpZiAoIXRoaXMuX25hbWVzLmhhcyhuYW1lKSkgewogICAgICAgIHRoaXMuX25hbWVzLmFkZChuYW1lKTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuX21hcHBpbmdzLmFkZCh7CiAgICAgIGdlbmVyYXRlZExpbmU6IGdlbmVyYXRlZC5saW5lLAogICAgICBnZW5lcmF0ZWRDb2x1bW46IGdlbmVyYXRlZC5jb2x1bW4sCiAgICAgIG9yaWdpbmFsTGluZTogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5saW5lLAogICAgICBvcmlnaW5hbENvbHVtbjogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5jb2x1bW4sCiAgICAgIHNvdXJjZTogc291cmNlLAogICAgICBuYW1lOiBuYW1lCiAgICB9KTsKICB9OwoKLyoqCiAqIFNldCB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGEgc291cmNlIGZpbGUuCiAqLwpTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLnNldFNvdXJjZUNvbnRlbnQgPQogIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9zZXRTb3VyY2VDb250ZW50KGFTb3VyY2VGaWxlLCBhU291cmNlQ29udGVudCkgewogICAgdmFyIHNvdXJjZSA9IGFTb3VyY2VGaWxlOwogICAgaWYgKHRoaXMuX3NvdXJjZVJvb3QgIT0gbnVsbCkgewogICAgICBzb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHRoaXMuX3NvdXJjZVJvb3QsIHNvdXJjZSk7CiAgICB9CgogICAgaWYgKGFTb3VyY2VDb250ZW50ICE9IG51bGwpIHsKICAgICAgLy8gQWRkIHRoZSBzb3VyY2UgY29udGVudCB0byB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAuCiAgICAgIC8vIENyZWF0ZSBhIG5ldyBfc291cmNlc0NvbnRlbnRzIG1hcCBpZiB0aGUgcHJvcGVydHkgaXMgbnVsbC4KICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9CiAgICAgIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldID0gYVNvdXJjZUNvbnRlbnQ7CiAgICB9IGVsc2UgaWYgKHRoaXMuX3NvdXJjZXNDb250ZW50cykgewogICAgICAvLyBSZW1vdmUgdGhlIHNvdXJjZSBmaWxlIGZyb20gdGhlIF9zb3VyY2VzQ29udGVudHMgbWFwLgogICAgICAvLyBJZiB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAgaXMgZW1wdHksIHNldCB0aGUgcHJvcGVydHkgdG8gbnVsbC4KICAgICAgZGVsZXRlIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldOwogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5fc291cmNlc0NvbnRlbnRzKS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBudWxsOwogICAgICB9CiAgICB9CiAgfTsKCi8qKgogKiBBcHBsaWVzIHRoZSBtYXBwaW5ncyBvZiBhIHN1Yi1zb3VyY2UtbWFwIGZvciBhIHNwZWNpZmljIHNvdXJjZSBmaWxlIHRvIHRoZQogKiBzb3VyY2UgbWFwIGJlaW5nIGdlbmVyYXRlZC4gRWFjaCBtYXBwaW5nIHRvIHRoZSBzdXBwbGllZCBzb3VyY2UgZmlsZSBpcwogKiByZXdyaXR0ZW4gdXNpbmcgdGhlIHN1cHBsaWVkIHNvdXJjZSBtYXAuIE5vdGU6IFRoZSByZXNvbHV0aW9uIGZvciB0aGUKICogcmVzdWx0aW5nIG1hcHBpbmdzIGlzIHRoZSBtaW5pbWl1bSBvZiB0aGlzIG1hcCBhbmQgdGhlIHN1cHBsaWVkIG1hcC4KICoKICogQHBhcmFtIGFTb3VyY2VNYXBDb25zdW1lciBUaGUgc291cmNlIG1hcCB0byBiZSBhcHBsaWVkLgogKiBAcGFyYW0gYVNvdXJjZUZpbGUgT3B0aW9uYWwuIFRoZSBmaWxlbmFtZSBvZiB0aGUgc291cmNlIGZpbGUuCiAqICAgICAgICBJZiBvbWl0dGVkLCBTb3VyY2VNYXBDb25zdW1lcidzIGZpbGUgcHJvcGVydHkgd2lsbCBiZSB1c2VkLgogKiBAcGFyYW0gYVNvdXJjZU1hcFBhdGggT3B0aW9uYWwuIFRoZSBkaXJuYW1lIG9mIHRoZSBwYXRoIHRvIHRoZSBzb3VyY2UgbWFwCiAqICAgICAgICB0byBiZSBhcHBsaWVkLiBJZiByZWxhdGl2ZSwgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIFNvdXJjZU1hcENvbnN1bWVyLgogKiAgICAgICAgVGhpcyBwYXJhbWV0ZXIgaXMgbmVlZGVkIHdoZW4gdGhlIHR3byBzb3VyY2UgbWFwcyBhcmVuJ3QgaW4gdGhlIHNhbWUKICogICAgICAgIGRpcmVjdG9yeSwgYW5kIHRoZSBzb3VyY2UgbWFwIHRvIGJlIGFwcGxpZWQgY29udGFpbnMgcmVsYXRpdmUgc291cmNlCiAqICAgICAgICBwYXRocy4gSWYgc28sIHRob3NlIHJlbGF0aXZlIHNvdXJjZSBwYXRocyBuZWVkIHRvIGJlIHJld3JpdHRlbgogKiAgICAgICAgcmVsYXRpdmUgdG8gdGhlIFNvdXJjZU1hcEdlbmVyYXRvci4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYXBwbHlTb3VyY2VNYXAgPQogIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9hcHBseVNvdXJjZU1hcChhU291cmNlTWFwQ29uc3VtZXIsIGFTb3VyY2VGaWxlLCBhU291cmNlTWFwUGF0aCkgewogICAgdmFyIHNvdXJjZUZpbGUgPSBhU291cmNlRmlsZTsKICAgIC8vIElmIGFTb3VyY2VGaWxlIGlzIG9taXR0ZWQsIHdlIHdpbGwgdXNlIHRoZSBmaWxlIHByb3BlcnR5IG9mIHRoZSBTb3VyY2VNYXAKICAgIGlmIChhU291cmNlRmlsZSA9PSBudWxsKSB7CiAgICAgIGlmIChhU291cmNlTWFwQ29uc3VtZXIuZmlsZSA9PSBudWxsKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgJ1NvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYXBwbHlTb3VyY2VNYXAgcmVxdWlyZXMgZWl0aGVyIGFuIGV4cGxpY2l0IHNvdXJjZSBmaWxlLCAnICsKICAgICAgICAgICdvciB0aGUgc291cmNlIG1hcFwncyAiZmlsZSIgcHJvcGVydHkuIEJvdGggd2VyZSBvbWl0dGVkLicKICAgICAgICApOwogICAgICB9CiAgICAgIHNvdXJjZUZpbGUgPSBhU291cmNlTWFwQ29uc3VtZXIuZmlsZTsKICAgIH0KICAgIHZhciBzb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKICAgIC8vIE1ha2UgInNvdXJjZUZpbGUiIHJlbGF0aXZlIGlmIGFuIGFic29sdXRlIFVybCBpcyBwYXNzZWQuCiAgICBpZiAoc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgfQogICAgLy8gQXBwbHlpbmcgdGhlIFNvdXJjZU1hcCBjYW4gYWRkIGFuZCByZW1vdmUgaXRlbXMgZnJvbSB0aGUgc291cmNlcyBhbmQKICAgIC8vIHRoZSBuYW1lcyBhcnJheS4KICAgIHZhciBuZXdTb3VyY2VzID0gbmV3IEFycmF5U2V0KCk7CiAgICB2YXIgbmV3TmFtZXMgPSBuZXcgQXJyYXlTZXQoKTsKCiAgICAvLyBGaW5kIG1hcHBpbmdzIGZvciB0aGUgInNvdXJjZUZpbGUiCiAgICB0aGlzLl9tYXBwaW5ncy51bnNvcnRlZEZvckVhY2goZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgaWYgKG1hcHBpbmcuc291cmNlID09PSBzb3VyY2VGaWxlICYmIG1hcHBpbmcub3JpZ2luYWxMaW5lICE9IG51bGwpIHsKICAgICAgICAvLyBDaGVjayBpZiBpdCBjYW4gYmUgbWFwcGVkIGJ5IHRoZSBzb3VyY2UgbWFwLCB0aGVuIHVwZGF0ZSB0aGUgbWFwcGluZy4KICAgICAgICB2YXIgb3JpZ2luYWwgPSBhU291cmNlTWFwQ29uc3VtZXIub3JpZ2luYWxQb3NpdGlvbkZvcih7CiAgICAgICAgICBsaW5lOiBtYXBwaW5nLm9yaWdpbmFsTGluZSwKICAgICAgICAgIGNvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbgogICAgICAgIH0pOwogICAgICAgIGlmIChvcmlnaW5hbC5zb3VyY2UgIT0gbnVsbCkgewogICAgICAgICAgLy8gQ29weSBtYXBwaW5nCiAgICAgICAgICBtYXBwaW5nLnNvdXJjZSA9IG9yaWdpbmFsLnNvdXJjZTsKICAgICAgICAgIGlmIChhU291cmNlTWFwUGF0aCAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5qb2luKGFTb3VyY2VNYXBQYXRoLCBtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsTGluZSA9IG9yaWdpbmFsLmxpbmU7CiAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uID0gb3JpZ2luYWwuY29sdW1uOwogICAgICAgICAgaWYgKG9yaWdpbmFsLm5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBtYXBwaW5nLm5hbWUgPSBvcmlnaW5hbC5uYW1lOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwogICAgICBpZiAoc291cmNlICE9IG51bGwgJiYgIW5ld1NvdXJjZXMuaGFzKHNvdXJjZSkpIHsKICAgICAgICBuZXdTb3VyY2VzLmFkZChzb3VyY2UpOwogICAgICB9CgogICAgICB2YXIgbmFtZSA9IG1hcHBpbmcubmFtZTsKICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiAhbmV3TmFtZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgbmV3TmFtZXMuYWRkKG5hbWUpOwogICAgICB9CgogICAgfSwgdGhpcyk7CiAgICB0aGlzLl9zb3VyY2VzID0gbmV3U291cmNlczsKICAgIHRoaXMuX25hbWVzID0gbmV3TmFtZXM7CgogICAgLy8gQ29weSBzb3VyY2VzQ29udGVudHMgb2YgYXBwbGllZCBtYXAuCiAgICBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2VGaWxlKSB7CiAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CiAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHsKICAgICAgICBpZiAoYVNvdXJjZU1hcFBhdGggIT0gbnVsbCkgewogICAgICAgICAgc291cmNlRmlsZSA9IHV0aWwuam9pbihhU291cmNlTWFwUGF0aCwgc291cmNlRmlsZSk7CiAgICAgICAgfQogICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNldFNvdXJjZUNvbnRlbnQoc291cmNlRmlsZSwgY29udGVudCk7CiAgICAgIH0KICAgIH0sIHRoaXMpOwogIH07CgovKioKICogQSBtYXBwaW5nIGNhbiBoYXZlIG9uZSBvZiB0aGUgdGhyZWUgbGV2ZWxzIG9mIGRhdGE6CiAqCiAqICAgMS4gSnVzdCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLgogKiAgIDIuIFRoZSBHZW5lcmF0ZWQgcG9zaXRpb24sIG9yaWdpbmFsIHBvc2l0aW9uLCBhbmQgb3JpZ2luYWwgc291cmNlLgogKiAgIDMuIEdlbmVyYXRlZCBhbmQgb3JpZ2luYWwgcG9zaXRpb24sIG9yaWdpbmFsIHNvdXJjZSwgYXMgd2VsbCBhcyBhIG5hbWUKICogICAgICB0b2tlbi4KICoKICogVG8gbWFpbnRhaW4gY29uc2lzdGVuY3ksIHdlIHZhbGlkYXRlIHRoYXQgYW55IG5ldyBtYXBwaW5nIGJlaW5nIGFkZGVkIGZhbGxzCiAqIGluIHRvIG9uZSBvZiB0aGVzZSBjYXRlZ29yaWVzLgogKi8KU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmFsaWRhdGVNYXBwaW5nID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdmFsaWRhdGVNYXBwaW5nKGFHZW5lcmF0ZWQsIGFPcmlnaW5hbCwgYVNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFOYW1lKSB7CiAgICAvLyBXaGVuIGFPcmlnaW5hbCBpcyB0cnV0aHkgYnV0IGhhcyBlbXB0eSB2YWx1ZXMgZm9yIC5saW5lIGFuZCAuY29sdW1uLAogICAgLy8gaXQgaXMgbW9zdCBsaWtlbHkgYSBwcm9ncmFtbWVyIGVycm9yLiBJbiB0aGlzIGNhc2Ugd2UgdGhyb3cgYSB2ZXJ5CiAgICAvLyBzcGVjaWZpYyBlcnJvciBtZXNzYWdlIHRvIHRyeSB0byBndWlkZSB0aGVtIHRoZSByaWdodCB3YXkuCiAgICAvLyBGb3IgZXhhbXBsZTogaHR0cHM6Ly9naXRodWIuY29tL1BvbHltZXIvcG9seW1lci1idW5kbGVyL3B1bGwvNTE5CiAgICBpZiAoYU9yaWdpbmFsICYmIHR5cGVvZiBhT3JpZ2luYWwubGluZSAhPT0gJ251bWJlcicgJiYgdHlwZW9mIGFPcmlnaW5hbC5jb2x1bW4gIT09ICdudW1iZXInKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAnb3JpZ2luYWwubGluZSBhbmQgb3JpZ2luYWwuY29sdW1uIGFyZSBub3QgbnVtYmVycyAtLSB5b3UgcHJvYmFibHkgbWVhbnQgdG8gb21pdCAnICsKICAgICAgICAgICAgJ3RoZSBvcmlnaW5hbCBtYXBwaW5nIGVudGlyZWx5IGFuZCBvbmx5IG1hcCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLiBJZiBzbywgcGFzcyAnICsKICAgICAgICAgICAgJ251bGwgZm9yIHRoZSBvcmlnaW5hbCBtYXBwaW5nIGluc3RlYWQgb2YgYW4gb2JqZWN0IHdpdGggZW1wdHkgb3IgbnVsbCB2YWx1ZXMuJwogICAgICAgICk7CiAgICB9CgogICAgaWYgKGFHZW5lcmF0ZWQgJiYgJ2xpbmUnIGluIGFHZW5lcmF0ZWQgJiYgJ2NvbHVtbicgaW4gYUdlbmVyYXRlZAogICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAogICAgICAgICYmICFhT3JpZ2luYWwgJiYgIWFTb3VyY2UgJiYgIWFOYW1lKSB7CiAgICAgIC8vIENhc2UgMS4KICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoYUdlbmVyYXRlZCAmJiAnbGluZScgaW4gYUdlbmVyYXRlZCAmJiAnY29sdW1uJyBpbiBhR2VuZXJhdGVkCiAgICAgICAgICAgICAmJiBhT3JpZ2luYWwgJiYgJ2xpbmUnIGluIGFPcmlnaW5hbCAmJiAnY29sdW1uJyBpbiBhT3JpZ2luYWwKICAgICAgICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAogICAgICAgICAgICAgJiYgYU9yaWdpbmFsLmxpbmUgPiAwICYmIGFPcmlnaW5hbC5jb2x1bW4gPj0gMAogICAgICAgICAgICAgJiYgYVNvdXJjZSkgewogICAgICAvLyBDYXNlcyAyIGFuZCAzLgogICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIG1hcHBpbmc6ICcgKyBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgZ2VuZXJhdGVkOiBhR2VuZXJhdGVkLAogICAgICAgIHNvdXJjZTogYVNvdXJjZSwKICAgICAgICBvcmlnaW5hbDogYU9yaWdpbmFsLAogICAgICAgIG5hbWU6IGFOYW1lCiAgICAgIH0pKTsKICAgIH0KICB9OwoKLyoqCiAqIFNlcmlhbGl6ZSB0aGUgYWNjdW11bGF0ZWQgbWFwcGluZ3MgaW4gdG8gdGhlIHN0cmVhbSBvZiBiYXNlIDY0IFZMUXMKICogc3BlY2lmaWVkIGJ5IHRoZSBzb3VyY2UgbWFwIGZvcm1hdC4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuX3NlcmlhbGl6ZU1hcHBpbmdzID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3Jfc2VyaWFsaXplTWFwcGluZ3MoKSB7CiAgICB2YXIgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSAwOwogICAgdmFyIHByZXZpb3VzR2VuZXJhdGVkTGluZSA9IDE7CiAgICB2YXIgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IDA7CiAgICB2YXIgcHJldmlvdXNPcmlnaW5hbExpbmUgPSAwOwogICAgdmFyIHByZXZpb3VzTmFtZSA9IDA7CiAgICB2YXIgcHJldmlvdXNTb3VyY2UgPSAwOwogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgdmFyIG5leHQ7CiAgICB2YXIgbWFwcGluZzsKICAgIHZhciBuYW1lSWR4OwogICAgdmFyIHNvdXJjZUlkeDsKCiAgICB2YXIgbWFwcGluZ3MgPSB0aGlzLl9tYXBwaW5ncy50b0FycmF5KCk7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbWFwcGluZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgbWFwcGluZyA9IG1hcHBpbmdzW2ldOwogICAgICBuZXh0ID0gJyc7CgogICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lICE9PSBwcmV2aW91c0dlbmVyYXRlZExpbmUpIHsKICAgICAgICBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiA9IDA7CiAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSAhPT0gcHJldmlvdXNHZW5lcmF0ZWRMaW5lKSB7CiAgICAgICAgICBuZXh0ICs9ICc7JzsKICAgICAgICAgIHByZXZpb3VzR2VuZXJhdGVkTGluZSsrOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgIGlmICghdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZChtYXBwaW5nLCBtYXBwaW5nc1tpIC0gMV0pKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgbmV4dCArPSAnLCc7CiAgICAgICAgfQogICAgICB9CgogICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBwcmV2aW91c0dlbmVyYXRlZENvbHVtbik7CiAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgogICAgICBpZiAobWFwcGluZy5zb3VyY2UgIT0gbnVsbCkgewogICAgICAgIHNvdXJjZUlkeCA9IHRoaXMuX3NvdXJjZXMuaW5kZXhPZihtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKHNvdXJjZUlkeCAtIHByZXZpb3VzU291cmNlKTsKICAgICAgICBwcmV2aW91c1NvdXJjZSA9IHNvdXJjZUlkeDsKCiAgICAgICAgLy8gbGluZXMgYXJlIHN0b3JlZCAwLWJhc2VkIGluIFNvdXJjZU1hcCBzcGVjIHZlcnNpb24gMwogICAgICAgIG5leHQgKz0gYmFzZTY0VkxRLmVuY29kZShtYXBwaW5nLm9yaWdpbmFsTGluZSAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxMaW5lKTsKICAgICAgICBwcmV2aW91c09yaWdpbmFsTGluZSA9IG1hcHBpbmcub3JpZ2luYWxMaW5lIC0gMTsKCiAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4pOwogICAgICAgIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4gPSBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uOwoKICAgICAgICBpZiAobWFwcGluZy5uYW1lICE9IG51bGwpIHsKICAgICAgICAgIG5hbWVJZHggPSB0aGlzLl9uYW1lcy5pbmRleE9mKG1hcHBpbmcubmFtZSk7CiAgICAgICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobmFtZUlkeCAtIHByZXZpb3VzTmFtZSk7CiAgICAgICAgICBwcmV2aW91c05hbWUgPSBuYW1lSWR4OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0ICs9IG5leHQ7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudCA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2dlbmVyYXRlU291cmNlc0NvbnRlbnQoYVNvdXJjZXMsIGFTb3VyY2VSb290KSB7CiAgICByZXR1cm4gYVNvdXJjZXMubWFwKGZ1bmN0aW9uIChzb3VyY2UpIHsKICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoYVNvdXJjZVJvb3QgIT0gbnVsbCkgewogICAgICAgIHNvdXJjZSA9IHV0aWwucmVsYXRpdmUoYVNvdXJjZVJvb3QsIHNvdXJjZSk7CiAgICAgIH0KICAgICAgdmFyIGtleSA9IHV0aWwudG9TZXRTdHJpbmcoc291cmNlKTsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9zb3VyY2VzQ29udGVudHMsIGtleSkKICAgICAgICA/IHRoaXMuX3NvdXJjZXNDb250ZW50c1trZXldCiAgICAgICAgOiBudWxsOwogICAgfSwgdGhpcyk7CiAgfTsKCi8qKgogKiBFeHRlcm5hbGl6ZSB0aGUgc291cmNlIG1hcC4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUudG9KU09OID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdG9KU09OKCkgewogICAgdmFyIG1hcCA9IHsKICAgICAgdmVyc2lvbjogdGhpcy5fdmVyc2lvbiwKICAgICAgc291cmNlczogdGhpcy5fc291cmNlcy50b0FycmF5KCksCiAgICAgIG5hbWVzOiB0aGlzLl9uYW1lcy50b0FycmF5KCksCiAgICAgIG1hcHBpbmdzOiB0aGlzLl9zZXJpYWxpemVNYXBwaW5ncygpCiAgICB9OwogICAgaWYgKHRoaXMuX2ZpbGUgIT0gbnVsbCkgewogICAgICBtYXAuZmlsZSA9IHRoaXMuX2ZpbGU7CiAgICB9CiAgICBpZiAodGhpcy5fc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgIG1hcC5zb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKICAgIH0KICAgIGlmICh0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgbWFwLnNvdXJjZXNDb250ZW50ID0gdGhpcy5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudChtYXAuc291cmNlcywgbWFwLnNvdXJjZVJvb3QpOwogICAgfQoKICAgIHJldHVybiBtYXA7CiAgfTsKCi8qKgogKiBSZW5kZXIgdGhlIHNvdXJjZSBtYXAgYmVpbmcgZ2VuZXJhdGVkIHRvIGEgc3RyaW5nLgogKi8KU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS50b1N0cmluZyA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX3RvU3RyaW5nKCkgewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpOwogIH07Cgp2YXIgU291cmNlTWFwR2VuZXJhdG9yXzEgPSBTb3VyY2VNYXBHZW5lcmF0b3I7Cgpjb25zdCB0cmFja05vZGVzID0gbmV3IFNldChbJ0F0cnVsZScsICdTZWxlY3RvcicsICdEZWNsYXJhdGlvbiddKTsKCmZ1bmN0aW9uIGdlbmVyYXRlU291cmNlTWFwKGhhbmRsZXJzKSB7CiAgICBjb25zdCBtYXAgPSBuZXcgU291cmNlTWFwR2VuZXJhdG9yXzEoKTsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IHsKICAgICAgICBsaW5lOiAxLAogICAgICAgIGNvbHVtbjogMAogICAgfTsKICAgIGNvbnN0IG9yaWdpbmFsID0gewogICAgICAgIGxpbmU6IDAsIC8vIHNob3VsZCBiZSB6ZXJvIHRvIGFkZCBmaXJzdCBtYXBwaW5nCiAgICAgICAgY29sdW1uOiAwCiAgICB9OwogICAgY29uc3QgYWN0aXZhdGVkR2VuZXJhdGVkID0gewogICAgICAgIGxpbmU6IDEsCiAgICAgICAgY29sdW1uOiAwCiAgICB9OwogICAgY29uc3QgYWN0aXZhdGVkTWFwcGluZyA9IHsKICAgICAgICBnZW5lcmF0ZWQ6IGFjdGl2YXRlZEdlbmVyYXRlZAogICAgfTsKICAgIGxldCBsaW5lID0gMTsKICAgIGxldCBjb2x1bW4gPSAwOwogICAgbGV0IHNvdXJjZU1hcHBpbmdBY3RpdmUgPSBmYWxzZTsKCiAgICBjb25zdCBvcmlnSGFuZGxlcnNOb2RlID0gaGFuZGxlcnMubm9kZTsKICAgIGhhbmRsZXJzLm5vZGUgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKG5vZGUubG9jICYmIG5vZGUubG9jLnN0YXJ0ICYmIHRyYWNrTm9kZXMuaGFzKG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgY29uc3Qgbm9kZUxpbmUgPSBub2RlLmxvYy5zdGFydC5saW5lOwogICAgICAgICAgICBjb25zdCBub2RlQ29sdW1uID0gbm9kZS5sb2Muc3RhcnQuY29sdW1uIC0gMTsKCiAgICAgICAgICAgIGlmIChvcmlnaW5hbC5saW5lICE9PSBub2RlTGluZSB8fAogICAgICAgICAgICAgICAgb3JpZ2luYWwuY29sdW1uICE9PSBub2RlQ29sdW1uKSB7CiAgICAgICAgICAgICAgICBvcmlnaW5hbC5saW5lID0gbm9kZUxpbmU7CiAgICAgICAgICAgICAgICBvcmlnaW5hbC5jb2x1bW4gPSBub2RlQ29sdW1uOwoKICAgICAgICAgICAgICAgIGdlbmVyYXRlZC5saW5lID0gbGluZTsKICAgICAgICAgICAgICAgIGdlbmVyYXRlZC5jb2x1bW4gPSBjb2x1bW47CgogICAgICAgICAgICAgICAgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdlbmVyYXRlZC5saW5lICE9PSBhY3RpdmF0ZWRHZW5lcmF0ZWQubGluZSB8fAogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQuY29sdW1uICE9PSBhY3RpdmF0ZWRHZW5lcmF0ZWQuY29sdW1uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKGFjdGl2YXRlZE1hcHBpbmcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKHsKICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG5vZGUubG9jLnNvdXJjZSwKICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCwKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBvcmlnSGFuZGxlcnNOb2RlLmNhbGwodGhpcywgbm9kZSk7CgogICAgICAgIGlmIChzb3VyY2VNYXBwaW5nQWN0aXZlICYmIHRyYWNrTm9kZXMuaGFzKG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgYWN0aXZhdGVkR2VuZXJhdGVkLmxpbmUgPSBsaW5lOwogICAgICAgICAgICBhY3RpdmF0ZWRHZW5lcmF0ZWQuY29sdW1uID0gY29sdW1uOwogICAgICAgIH0KICAgIH07CgogICAgY29uc3Qgb3JpZ0hhbmRsZXJzRW1pdCA9IGhhbmRsZXJzLmVtaXQ7CiAgICBoYW5kbGVycy5lbWl0ID0gZnVuY3Rpb24odmFsdWUsIHR5cGUsIGF1dG8pIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5jaGFyQ29kZUF0KGkpID09PSAxMCkgeyAvLyBcbgogICAgICAgICAgICAgICAgbGluZSsrOwogICAgICAgICAgICAgICAgY29sdW1uID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbHVtbisrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBvcmlnSGFuZGxlcnNFbWl0KHZhbHVlLCB0eXBlLCBhdXRvKTsKICAgIH07CgogICAgY29uc3Qgb3JpZ0hhbmRsZXJzUmVzdWx0ID0gaGFuZGxlcnMucmVzdWx0OwogICAgaGFuZGxlcnMucmVzdWx0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKICAgICAgICAgICAgbWFwLmFkZE1hcHBpbmcoYWN0aXZhdGVkTWFwcGluZyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjc3M6IG9yaWdIYW5kbGVyc1Jlc3VsdCgpLAogICAgICAgICAgICBtYXAKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gaGFuZGxlcnM7Cn0KCmNvbnN0IFBMVVNTSUdOJDkgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTJDYgPSAweDAwMkQ7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCgpjb25zdCBjb2RlID0gKHR5cGUsIHZhbHVlKSA9PiB7CiAgICBpZiAodHlwZSA9PT0gRGVsaW0pIHsKICAgICAgICB0eXBlID0gdmFsdWU7CiAgICB9CgogICAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gdHlwZS5jaGFyQ29kZUF0KDApOwogICAgICAgIHJldHVybiBjaGFyQ29kZSA+IDB4N0YgPyAweDgwMDAgOiBjaGFyQ29kZSA8PCA4OwogICAgfQoKICAgIHJldHVybiB0eXBlOwp9OwoKLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1zeW50YXgtMy8jc2VyaWFsaXphdGlvbgovLyBUaGUgb25seSByZXF1aXJlbWVudCBmb3Igc2VyaWFsaXphdGlvbiBpcyB0aGF0IGl0IG11c3QgInJvdW5kLXRyaXAiIHdpdGggcGFyc2luZywKLy8gdGhhdCBpcywgcGFyc2luZyB0aGUgc3R5bGVzaGVldCBtdXN0IHByb2R1Y2UgdGhlIHNhbWUgZGF0YSBzdHJ1Y3R1cmVzIGFzIHBhcnNpbmcsCi8vIHNlcmlhbGl6aW5nLCBhbmQgcGFyc2luZyBhZ2FpbiwgZXhjZXB0IGZvciBjb25zZWN1dGl2ZSA8d2hpdGVzcGFjZS10b2tlbj5zLAovLyB3aGljaCBtYXkgYmUgY29sbGFwc2VkIGludG8gYSBzaW5nbGUgdG9rZW4uCgpjb25zdCBzcGVjUGFpcnMgPSBbCiAgICBbSWRlbnQsIElkZW50XSwKICAgIFtJZGVudCwgRnVuY3Rpb24kMl0sCiAgICBbSWRlbnQsIFVybCQxXSwKICAgIFtJZGVudCwgQmFkVXJsXSwKICAgIFtJZGVudCwgJy0nXSwKICAgIFtJZGVudCwgTnVtYmVyJDJdLAogICAgW0lkZW50LCBQZXJjZW50YWdlJDFdLAogICAgW0lkZW50LCBEaW1lbnNpb24kMV0sCiAgICBbSWRlbnQsIENEQyQxXSwKICAgIFtJZGVudCwgTGVmdFBhcmVudGhlc2lzXSwKCiAgICBbQXRLZXl3b3JkLCBJZGVudF0sCiAgICBbQXRLZXl3b3JkLCBGdW5jdGlvbiQyXSwKICAgIFtBdEtleXdvcmQsIFVybCQxXSwKICAgIFtBdEtleXdvcmQsIEJhZFVybF0sCiAgICBbQXRLZXl3b3JkLCAnLSddLAogICAgW0F0S2V5d29yZCwgTnVtYmVyJDJdLAogICAgW0F0S2V5d29yZCwgUGVyY2VudGFnZSQxXSwKICAgIFtBdEtleXdvcmQsIERpbWVuc2lvbiQxXSwKICAgIFtBdEtleXdvcmQsIENEQyQxXSwKCiAgICBbSGFzaCQxLCBJZGVudF0sCiAgICBbSGFzaCQxLCBGdW5jdGlvbiQyXSwKICAgIFtIYXNoJDEsIFVybCQxXSwKICAgIFtIYXNoJDEsIEJhZFVybF0sCiAgICBbSGFzaCQxLCAnLSddLAogICAgW0hhc2gkMSwgTnVtYmVyJDJdLAogICAgW0hhc2gkMSwgUGVyY2VudGFnZSQxXSwKICAgIFtIYXNoJDEsIERpbWVuc2lvbiQxXSwKICAgIFtIYXNoJDEsIENEQyQxXSwKCiAgICBbRGltZW5zaW9uJDEsIElkZW50XSwKICAgIFtEaW1lbnNpb24kMSwgRnVuY3Rpb24kMl0sCiAgICBbRGltZW5zaW9uJDEsIFVybCQxXSwKICAgIFtEaW1lbnNpb24kMSwgQmFkVXJsXSwKICAgIFtEaW1lbnNpb24kMSwgJy0nXSwKICAgIFtEaW1lbnNpb24kMSwgTnVtYmVyJDJdLAogICAgW0RpbWVuc2lvbiQxLCBQZXJjZW50YWdlJDFdLAogICAgW0RpbWVuc2lvbiQxLCBEaW1lbnNpb24kMV0sCiAgICBbRGltZW5zaW9uJDEsIENEQyQxXSwKCiAgICBbJyMnLCBJZGVudF0sCiAgICBbJyMnLCBGdW5jdGlvbiQyXSwKICAgIFsnIycsIFVybCQxXSwKICAgIFsnIycsIEJhZFVybF0sCiAgICBbJyMnLCAnLSddLAogICAgWycjJywgTnVtYmVyJDJdLAogICAgWycjJywgUGVyY2VudGFnZSQxXSwKICAgIFsnIycsIERpbWVuc2lvbiQxXSwKICAgIFsnIycsIENEQyQxXSwgLy8gaHR0cHM6Ly9naXRodWIuY29tL3czYy9jc3N3Zy1kcmFmdHMvcHVsbC82ODc0CgogICAgWyctJywgSWRlbnRdLAogICAgWyctJywgRnVuY3Rpb24kMl0sCiAgICBbJy0nLCBVcmwkMV0sCiAgICBbJy0nLCBCYWRVcmxdLAogICAgWyctJywgJy0nXSwKICAgIFsnLScsIE51bWJlciQyXSwKICAgIFsnLScsIFBlcmNlbnRhZ2UkMV0sCiAgICBbJy0nLCBEaW1lbnNpb24kMV0sCiAgICBbJy0nLCBDREMkMV0sIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS93M2MvY3Nzd2ctZHJhZnRzL3B1bGwvNjg3NAoKICAgIFtOdW1iZXIkMiwgSWRlbnRdLAogICAgW051bWJlciQyLCBGdW5jdGlvbiQyXSwKICAgIFtOdW1iZXIkMiwgVXJsJDFdLAogICAgW051bWJlciQyLCBCYWRVcmxdLAogICAgW051bWJlciQyLCBOdW1iZXIkMl0sCiAgICBbTnVtYmVyJDIsIFBlcmNlbnRhZ2UkMV0sCiAgICBbTnVtYmVyJDIsIERpbWVuc2lvbiQxXSwKICAgIFtOdW1iZXIkMiwgJyUnXSwKICAgIFtOdW1iZXIkMiwgQ0RDJDFdLCAvLyBodHRwczovL2dpdGh1Yi5jb20vdzNjL2Nzc3dnLWRyYWZ0cy9wdWxsLzY4NzQKCiAgICBbJ0AnLCBJZGVudF0sCiAgICBbJ0AnLCBGdW5jdGlvbiQyXSwKICAgIFsnQCcsIFVybCQxXSwKICAgIFsnQCcsIEJhZFVybF0sCiAgICBbJ0AnLCAnLSddLAogICAgWydAJywgQ0RDJDFdLCAvLyBodHRwczovL2dpdGh1Yi5jb20vdzNjL2Nzc3dnLWRyYWZ0cy9wdWxsLzY4NzQKCiAgICBbJy4nLCBOdW1iZXIkMl0sCiAgICBbJy4nLCBQZXJjZW50YWdlJDFdLAogICAgWycuJywgRGltZW5zaW9uJDFdLAoKICAgIFsnKycsIE51bWJlciQyXSwKICAgIFsnKycsIFBlcmNlbnRhZ2UkMV0sCiAgICBbJysnLCBEaW1lbnNpb24kMV0sCgogICAgWycvJywgJyonXQpdOwovLyB2YWxpZGF0ZSB3aXRoIHNjcmlwdHMvZ2VuZXJhdGUtc2FmZQpjb25zdCBzYWZlUGFpcnMgPSBzcGVjUGFpcnMuY29uY2F0KFsKICAgIFtJZGVudCwgSGFzaCQxXSwKCiAgICBbRGltZW5zaW9uJDEsIEhhc2gkMV0sCgogICAgW0hhc2gkMSwgSGFzaCQxXSwKCiAgICBbQXRLZXl3b3JkLCBMZWZ0UGFyZW50aGVzaXNdLAogICAgW0F0S2V5d29yZCwgU3RyaW5nJDJdLAogICAgW0F0S2V5d29yZCwgQ29sb25dLAoKICAgIFtQZXJjZW50YWdlJDEsIFBlcmNlbnRhZ2UkMV0sCiAgICBbUGVyY2VudGFnZSQxLCBEaW1lbnNpb24kMV0sCiAgICBbUGVyY2VudGFnZSQxLCBGdW5jdGlvbiQyXSwKICAgIFtQZXJjZW50YWdlJDEsICctJ10sCgogICAgW1JpZ2h0UGFyZW50aGVzaXMsIElkZW50XSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBGdW5jdGlvbiQyXSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBQZXJjZW50YWdlJDFdLAogICAgW1JpZ2h0UGFyZW50aGVzaXMsIERpbWVuc2lvbiQxXSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBIYXNoJDFdLAogICAgW1JpZ2h0UGFyZW50aGVzaXMsICctJ10KXSk7CgpmdW5jdGlvbiBjcmVhdGVNYXAocGFpcnMpIHsKICAgIGNvbnN0IGlzV2hpdGVTcGFjZVJlcXVpcmVkID0gbmV3IFNldCgKICAgICAgICBwYWlycy5tYXAoKFtwcmV2LCBuZXh0XSkgPT4gKGNvZGUocHJldikgPDwgMTYgfCBjb2RlKG5leHQpKSkKICAgICk7CgogICAgcmV0dXJuIGZ1bmN0aW9uKHByZXZDb2RlLCB0eXBlLCB2YWx1ZSkgewogICAgICAgIGNvbnN0IG5leHRDb2RlID0gY29kZSh0eXBlLCB2YWx1ZSk7CiAgICAgICAgY29uc3QgbmV4dENoYXJDb2RlID0gdmFsdWUuY2hhckNvZGVBdCgwKTsKICAgICAgICBjb25zdCBlbWl0V3MgPQogICAgICAgICAgICAobmV4dENoYXJDb2RlID09PSBIWVBIRU5NSU5VUyQ2ICYmCiAgICAgICAgICAgICAgICB0eXBlICE9PSBJZGVudCAmJgogICAgICAgICAgICAgICAgdHlwZSAhPT0gRnVuY3Rpb24kMiAmJgogICAgICAgICAgICAgICAgdHlwZSAhPT0gQ0RDJDEpIHx8CiAgICAgICAgICAgIChuZXh0Q2hhckNvZGUgPT09IFBMVVNTSUdOJDkpCiAgICAgICAgICAgICAgICA/IGlzV2hpdGVTcGFjZVJlcXVpcmVkLmhhcyhwcmV2Q29kZSA8PCAxNiB8IG5leHRDaGFyQ29kZSA8PCA4KQogICAgICAgICAgICAgICAgOiBpc1doaXRlU3BhY2VSZXF1aXJlZC5oYXMocHJldkNvZGUgPDwgMTYgfCBuZXh0Q29kZSk7CgogICAgICAgIGlmIChlbWl0V3MpIHsKICAgICAgICAgICAgdGhpcy5lbWl0KCcgJywgV2hpdGVTcGFjZSQxLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXh0Q29kZTsKICAgIH07Cn0KCmNvbnN0IHNwZWMgPSBjcmVhdGVNYXAoc3BlY1BhaXJzKTsKY29uc3Qgc2FmZSA9IGNyZWF0ZU1hcChzYWZlUGFpcnMpOwoKY29uc3QgdG9rZW5CZWZvcmUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIHNhZmUsCiAgICBzcGVjCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgUkVWRVJTRVNPTElEVVMgPSAweDAwNWM7IC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCgpmdW5jdGlvbiBwcm9jZXNzQ2hpbGRyZW4obm9kZSwgZGVsaW1ldGVyKSB7CiAgICBpZiAodHlwZW9mIGRlbGltZXRlciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGxldCBwcmV2ID0gbnVsbDsKCiAgICAgICAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKG5vZGUgPT4gewogICAgICAgICAgICBpZiAocHJldiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGVsaW1ldGVyLmNhbGwodGhpcywgcHJldik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubm9kZShub2RlKTsKICAgICAgICAgICAgcHJldiA9IG5vZGU7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBub2RlLmNoaWxkcmVuLmZvckVhY2godGhpcy5ub2RlLCB0aGlzKTsKfQoKZnVuY3Rpb24gcHJvY2Vzc0NodW5rKGNodW5rKSB7CiAgICB0b2tlbml6ZSQxKGNodW5rLCAodHlwZSwgc3RhcnQsIGVuZCkgPT4gewogICAgICAgIHRoaXMudG9rZW4odHlwZSwgY2h1bmsuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUdlbmVyYXRvcihjb25maWcpIHsKICAgIGNvbnN0IHR5cGVzID0gbmV3IE1hcCgpOwoKICAgIGZvciAobGV0IG5hbWUgaW4gY29uZmlnLm5vZGUpIHsKICAgICAgICBjb25zdCBpdGVtID0gY29uZmlnLm5vZGVbbmFtZV07CiAgICAgICAgY29uc3QgZm4gPSBpdGVtLmdlbmVyYXRlIHx8IGl0ZW07CgogICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdHlwZXMuc2V0KG5hbWUsIGl0ZW0uZ2VuZXJhdGUgfHwgaXRlbSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihub2RlLCBvcHRpb25zKSB7CiAgICAgICAgbGV0IGJ1ZmZlciA9ICcnOwogICAgICAgIGxldCBwcmV2Q29kZSA9IDA7CiAgICAgICAgbGV0IGhhbmRsZXJzID0gewogICAgICAgICAgICBub2RlKG5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlcy5oYXMobm9kZS50eXBlKSkgewogICAgICAgICAgICAgICAgICAgIHR5cGVzLmdldChub2RlLnR5cGUpLmNhbGwocHVibGljQXBpLCBub2RlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZTogJyArIG5vZGUudHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRva2VuQmVmb3JlOiBzYWZlLAogICAgICAgICAgICB0b2tlbih0eXBlLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgcHJldkNvZGUgPSB0aGlzLnRva2VuQmVmb3JlKHByZXZDb2RlLCB0eXBlLCB2YWx1ZSk7CgogICAgICAgICAgICAgICAgdGhpcy5lbWl0KHZhbHVlLCB0eXBlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IERlbGltICYmIHZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IFJFVkVSU0VTT0xJRFVTKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdcbicsIFdoaXRlU3BhY2UkMSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVtaXQodmFsdWUpIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciArPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kZWNvcmF0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gb3B0aW9ucy5kZWNvcmF0b3IoaGFuZGxlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5zb3VyY2VNYXApIHsKICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gZ2VuZXJhdGVTb3VyY2VNYXAoaGFuZGxlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlIGluIHRva2VuQmVmb3JlKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVycy50b2tlbkJlZm9yZSA9IHRva2VuQmVmb3JlW29wdGlvbnMubW9kZV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IHB1YmxpY0FwaSA9IHsKICAgICAgICAgICAgbm9kZTogKG5vZGUpID0+IGhhbmRsZXJzLm5vZGUobm9kZSksCiAgICAgICAgICAgIGNoaWxkcmVuOiBwcm9jZXNzQ2hpbGRyZW4sCiAgICAgICAgICAgIHRva2VuOiAodHlwZSwgdmFsdWUpID0+IGhhbmRsZXJzLnRva2VuKHR5cGUsIHZhbHVlKSwKICAgICAgICAgICAgdG9rZW5pemU6IHByb2Nlc3NDaHVuawogICAgICAgIH07CgogICAgICAgIGhhbmRsZXJzLm5vZGUobm9kZSk7CgogICAgICAgIHJldHVybiBoYW5kbGVycy5yZXN1bHQoKTsKICAgIH07Cn0KCmZ1bmN0aW9uIGNyZWF0ZUNvbnZlcnRvcih3YWxrKSB7CiAgICByZXR1cm4gewogICAgICAgIGZyb21QbGFpbk9iamVjdChhc3QpIHsKICAgICAgICAgICAgd2Fsayhhc3QsIHsKICAgICAgICAgICAgICAgIGVudGVyKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuIGluc3RhbmNlb2YgTGlzdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IG5ldyBMaXN0KCkuZnJvbUFycmF5KG5vZGUuY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gYXN0OwogICAgICAgIH0sCiAgICAgICAgdG9QbGFpbk9iamVjdChhc3QpIHsKICAgICAgICAgICAgd2Fsayhhc3QsIHsKICAgICAgICAgICAgICAgIGxlYXZlKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuIGluc3RhbmNlb2YgTGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbi50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBhc3Q7CiAgICAgICAgfQogICAgfTsKfQoKY29uc3QgeyBoYXNPd25Qcm9wZXJ0eTogaGFzT3duUHJvcGVydHkkMyB9ID0gT2JqZWN0LnByb3RvdHlwZTsKY29uc3Qgbm9vcCQyID0gZnVuY3Rpb24oKSB7fTsKCmZ1bmN0aW9uIGVuc3VyZUZ1bmN0aW9uJDEodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgPyB2YWx1ZSA6IG5vb3AkMjsKfQoKZnVuY3Rpb24gaW52b2tlRm9yVHlwZShmbiwgdHlwZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICBpZiAobm9kZS50eXBlID09PSB0eXBlKSB7CiAgICAgICAgICAgIGZuLmNhbGwodGhpcywgbm9kZSwgaXRlbSwgbGlzdCk7CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0V2Fsa2Vyc0Zyb21TdHJ1Y3R1cmUobmFtZSwgbm9kZVR5cGUpIHsKICAgIGNvbnN0IHN0cnVjdHVyZSA9IG5vZGVUeXBlLnN0cnVjdHVyZTsKICAgIGNvbnN0IHdhbGtlcnMgPSBbXTsKCiAgICBmb3IgKGNvbnN0IGtleSBpbiBzdHJ1Y3R1cmUpIHsKICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMy5jYWxsKHN0cnVjdHVyZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBsZXQgZmllbGRUeXBlcyA9IHN0cnVjdHVyZVtrZXldOwogICAgICAgIGNvbnN0IHdhbGtlciA9IHsKICAgICAgICAgICAgbmFtZToga2V5LAogICAgICAgICAgICB0eXBlOiBmYWxzZSwKICAgICAgICAgICAgbnVsbGFibGU6IGZhbHNlCiAgICAgICAgfTsKCiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGZpZWxkVHlwZXMpKSB7CiAgICAgICAgICAgIGZpZWxkVHlwZXMgPSBbZmllbGRUeXBlc107CiAgICAgICAgfQoKICAgICAgICBmb3IgKGNvbnN0IGZpZWxkVHlwZSBvZiBmaWVsZFR5cGVzKSB7CiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHdhbGtlci5udWxsYWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHdhbGtlci50eXBlID0gJ25vZGUnOwogICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmllbGRUeXBlKSkgewogICAgICAgICAgICAgICAgd2Fsa2VyLnR5cGUgPSAnbGlzdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh3YWxrZXIudHlwZSkgewogICAgICAgICAgICB3YWxrZXJzLnB1c2god2Fsa2VyKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHdhbGtlcnMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY29udGV4dDogbm9kZVR5cGUud2Fsa0NvbnRleHQsCiAgICAgICAgICAgIGZpZWxkczogd2Fsa2VycwogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGdldFR5cGVzRnJvbUNvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHR5cGVzID0ge307CgogICAgZm9yIChjb25zdCBuYW1lIGluIGNvbmZpZy5ub2RlKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDMuY2FsbChjb25maWcubm9kZSwgbmFtZSkpIHsKICAgICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBjb25maWcubm9kZVtuYW1lXTsKCiAgICAgICAgICAgIGlmICghbm9kZVR5cGUuc3RydWN0dXJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NlZCBgc3RydWN0dXJlYCBmaWVsZCBpbiBgJyArIG5hbWUgKyAnYCBub2RlIHR5cGUgZGVmaW5pdGlvbicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0eXBlc1tuYW1lXSA9IGdldFdhbGtlcnNGcm9tU3RydWN0dXJlKG5hbWUsIG5vZGVUeXBlKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHR5cGVzOwp9CgpmdW5jdGlvbiBjcmVhdGVUeXBlSXRlcmF0b3IoY29uZmlnLCByZXZlcnNlKSB7CiAgICBjb25zdCBmaWVsZHMgPSBjb25maWcuZmllbGRzLnNsaWNlKCk7CiAgICBjb25zdCBjb250ZXh0TmFtZSA9IGNvbmZpZy5jb250ZXh0OwogICAgY29uc3QgdXNlQ29udGV4dCA9IHR5cGVvZiBjb250ZXh0TmFtZSA9PT0gJ3N0cmluZyc7CgogICAgaWYgKHJldmVyc2UpIHsKICAgICAgICBmaWVsZHMucmV2ZXJzZSgpOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihub2RlLCBjb250ZXh0LCB3YWxrLCB3YWxrUmVkdWNlcikgewogICAgICAgIGxldCBwcmV2Q29udGV4dFZhbHVlOwoKICAgICAgICBpZiAodXNlQ29udGV4dCkgewogICAgICAgICAgICBwcmV2Q29udGV4dFZhbHVlID0gY29udGV4dFtjb250ZXh0TmFtZV07CiAgICAgICAgICAgIGNvbnRleHRbY29udGV4dE5hbWVdID0gbm9kZTsKICAgICAgICB9CgogICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzKSB7CiAgICAgICAgICAgIGNvbnN0IHJlZiA9IG5vZGVbZmllbGQubmFtZV07CgogICAgICAgICAgICBpZiAoIWZpZWxkLm51bGxhYmxlIHx8IHJlZikgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdsaXN0JykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJyZWFrV2FsayA9IHJldmVyc2UKICAgICAgICAgICAgICAgICAgICAgICAgPyByZWYucmVkdWNlUmlnaHQod2Fsa1JlZHVjZXIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICA6IHJlZi5yZWR1Y2Uod2Fsa1JlZHVjZXIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJyZWFrV2FsaykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdhbGsocmVmKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodXNlQ29udGV4dCkgewogICAgICAgICAgICBjb250ZXh0W2NvbnRleHROYW1lXSA9IHByZXZDb250ZXh0VmFsdWU7CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gY3JlYXRlRmFzdFRyYXZlcmFsTWFwKHsKICAgIFN0eWxlU2hlZXQsCiAgICBBdHJ1bGUsCiAgICBSdWxlLAogICAgQmxvY2ssCiAgICBEZWNsYXJhdGlvbkxpc3QKfSkgewogICAgcmV0dXJuIHsKICAgICAgICBBdHJ1bGU6IHsKICAgICAgICAgICAgU3R5bGVTaGVldCwKICAgICAgICAgICAgQXRydWxlLAogICAgICAgICAgICBSdWxlLAogICAgICAgICAgICBCbG9jawogICAgICAgIH0sCiAgICAgICAgUnVsZTogewogICAgICAgICAgICBTdHlsZVNoZWV0LAogICAgICAgICAgICBBdHJ1bGUsCiAgICAgICAgICAgIFJ1bGUsCiAgICAgICAgICAgIEJsb2NrCiAgICAgICAgfSwKICAgICAgICBEZWNsYXJhdGlvbjogewogICAgICAgICAgICBTdHlsZVNoZWV0LAogICAgICAgICAgICBBdHJ1bGUsCiAgICAgICAgICAgIFJ1bGUsCiAgICAgICAgICAgIEJsb2NrLAogICAgICAgICAgICBEZWNsYXJhdGlvbkxpc3QKICAgICAgICB9CiAgICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVXYWxrZXIoY29uZmlnKSB7CiAgICBjb25zdCB0eXBlcyA9IGdldFR5cGVzRnJvbUNvbmZpZyhjb25maWcpOwogICAgY29uc3QgaXRlcmF0b3JzTmF0dXJhbCA9IHt9OwogICAgY29uc3QgaXRlcmF0b3JzUmV2ZXJzZSA9IHt9OwogICAgY29uc3QgYnJlYWtXYWxrID0gU3ltYm9sKCdicmVhay13YWxrJyk7CiAgICBjb25zdCBza2lwTm9kZSA9IFN5bWJvbCgnc2tpcC1ub2RlJyk7CgogICAgZm9yIChjb25zdCBuYW1lIGluIHR5cGVzKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDMuY2FsbCh0eXBlcywgbmFtZSkgJiYgdHlwZXNbbmFtZV0gIT09IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0b3JzTmF0dXJhbFtuYW1lXSA9IGNyZWF0ZVR5cGVJdGVyYXRvcih0eXBlc1tuYW1lXSwgZmFsc2UpOwogICAgICAgICAgICBpdGVyYXRvcnNSZXZlcnNlW25hbWVdID0gY3JlYXRlVHlwZUl0ZXJhdG9yKHR5cGVzW25hbWVdLCB0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgZmFzdFRyYXZlcnNhbEl0ZXJhdG9yc05hdHVyYWwgPSBjcmVhdGVGYXN0VHJhdmVyYWxNYXAoaXRlcmF0b3JzTmF0dXJhbCk7CiAgICBjb25zdCBmYXN0VHJhdmVyc2FsSXRlcmF0b3JzUmV2ZXJzZSA9IGNyZWF0ZUZhc3RUcmF2ZXJhbE1hcChpdGVyYXRvcnNSZXZlcnNlKTsKCiAgICBjb25zdCB3YWxrID0gZnVuY3Rpb24ocm9vdCwgb3B0aW9ucykgewogICAgICAgIGZ1bmN0aW9uIHdhbGtOb2RlKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICAgICAgY29uc3QgZW50ZXJSZXQgPSBlbnRlci5jYWxsKGNvbnRleHQsIG5vZGUsIGl0ZW0sIGxpc3QpOwoKICAgICAgICAgICAgaWYgKGVudGVyUmV0ID09PSBicmVha1dhbGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW50ZXJSZXQgPT09IHNraXBOb2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpdGVyYXRvcnMuaGFzT3duUHJvcGVydHkobm9kZS50eXBlKSkgewogICAgICAgICAgICAgICAgaWYgKGl0ZXJhdG9yc1tub2RlLnR5cGVdKG5vZGUsIGNvbnRleHQsIHdhbGtOb2RlLCB3YWxrUmVkdWNlcikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxlYXZlLmNhbGwoY29udGV4dCwgbm9kZSwgaXRlbSwgbGlzdCkgPT09IGJyZWFrV2FsaykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGxldCBlbnRlciA9IG5vb3AkMjsKICAgICAgICBsZXQgbGVhdmUgPSBub29wJDI7CiAgICAgICAgbGV0IGl0ZXJhdG9ycyA9IGl0ZXJhdG9yc05hdHVyYWw7CiAgICAgICAgbGV0IHdhbGtSZWR1Y2VyID0gKHJldCwgZGF0YSwgaXRlbSwgbGlzdCkgPT4gcmV0IHx8IHdhbGtOb2RlKGRhdGEsIGl0ZW0sIGxpc3QpOwogICAgICAgIGNvbnN0IGNvbnRleHQgPSB7CiAgICAgICAgICAgIGJyZWFrOiBicmVha1dhbGssCiAgICAgICAgICAgIHNraXA6IHNraXBOb2RlLAoKICAgICAgICAgICAgcm9vdCwKICAgICAgICAgICAgc3R5bGVzaGVldDogbnVsbCwKICAgICAgICAgICAgYXRydWxlOiBudWxsLAogICAgICAgICAgICBhdHJ1bGVQcmVsdWRlOiBudWxsLAogICAgICAgICAgICBydWxlOiBudWxsLAogICAgICAgICAgICBzZWxlY3RvcjogbnVsbCwKICAgICAgICAgICAgYmxvY2s6IG51bGwsCiAgICAgICAgICAgIGRlY2xhcmF0aW9uOiBudWxsLAogICAgICAgICAgICBmdW5jdGlvbjogbnVsbAogICAgICAgIH07CgogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBlbnRlciA9IG9wdGlvbnM7CiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgIGVudGVyID0gZW5zdXJlRnVuY3Rpb24kMShvcHRpb25zLmVudGVyKTsKICAgICAgICAgICAgbGVhdmUgPSBlbnN1cmVGdW5jdGlvbiQxKG9wdGlvbnMubGVhdmUpOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMucmV2ZXJzZSkgewogICAgICAgICAgICAgICAgaXRlcmF0b3JzID0gaXRlcmF0b3JzUmV2ZXJzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdGlvbnMudmlzaXQpIHsKICAgICAgICAgICAgICAgIGlmIChmYXN0VHJhdmVyc2FsSXRlcmF0b3JzTmF0dXJhbC5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLnZpc2l0KSkgewogICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9ycyA9IG9wdGlvbnMucmV2ZXJzZQogICAgICAgICAgICAgICAgICAgICAgICA/IGZhc3RUcmF2ZXJzYWxJdGVyYXRvcnNSZXZlcnNlW29wdGlvbnMudmlzaXRdCiAgICAgICAgICAgICAgICAgICAgICAgIDogZmFzdFRyYXZlcnNhbEl0ZXJhdG9yc05hdHVyYWxbb3B0aW9ucy52aXNpdF07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0eXBlcy5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLnZpc2l0KSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIHZhbHVlIGAnICsgb3B0aW9ucy52aXNpdCArICdgIGZvciBgdmlzaXRgIG9wdGlvbiAoc2hvdWxkIGJlOiAnICsgT2JqZWN0LmtleXModHlwZXMpLnNvcnQoKS5qb2luKCcsICcpICsgJyknKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlbnRlciA9IGludm9rZUZvclR5cGUoZW50ZXIsIG9wdGlvbnMudmlzaXQpOwogICAgICAgICAgICAgICAgbGVhdmUgPSBpbnZva2VGb3JUeXBlKGxlYXZlLCBvcHRpb25zLnZpc2l0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVudGVyID09PSBub29wJDIgJiYgbGVhdmUgPT09IG5vb3AkMikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laXRoZXIgYGVudGVyYCBub3IgYGxlYXZlYCB3YWxrZXIgaGFuZGxlciBpcyBzZXQgb3IgYm90aCBhcmVuXCd0IGEgZnVuY3Rpb24nKTsKICAgICAgICB9CgogICAgICAgIHdhbGtOb2RlKHJvb3QpOwogICAgfTsKCiAgICB3YWxrLmJyZWFrID0gYnJlYWtXYWxrOwogICAgd2Fsay5za2lwID0gc2tpcE5vZGU7CgogICAgd2Fsay5maW5kID0gZnVuY3Rpb24oYXN0LCBmbikgewogICAgICAgIGxldCBmb3VuZCA9IG51bGw7CgogICAgICAgIHdhbGsoYXN0LCBmdW5jdGlvbihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXMsIG5vZGUsIGl0ZW0sIGxpc3QpKSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IG5vZGU7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJlYWtXYWxrOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgd2Fsay5maW5kTGFzdCA9IGZ1bmN0aW9uKGFzdCwgZm4pIHsKICAgICAgICBsZXQgZm91bmQgPSBudWxsOwoKICAgICAgICB3YWxrKGFzdCwgewogICAgICAgICAgICByZXZlcnNlOiB0cnVlLAogICAgICAgICAgICBlbnRlcihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoZm4uY2FsbCh0aGlzLCBub2RlLCBpdGVtLCBsaXN0KSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJlYWtXYWxrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgd2Fsay5maW5kQWxsID0gZnVuY3Rpb24oYXN0LCBmbikgewogICAgICAgIGNvbnN0IGZvdW5kID0gW107CgogICAgICAgIHdhbGsoYXN0LCBmdW5jdGlvbihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXMsIG5vZGUsIGl0ZW0sIGxpc3QpKSB7CiAgICAgICAgICAgICAgICBmb3VuZC5wdXNoKG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgcmV0dXJuIHdhbGs7Cn0KCmZ1bmN0aW9uIG5vb3AkMSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwp9CgpmdW5jdGlvbiBnZW5lcmF0ZU11bHRpcGxpZXIobXVsdGlwbGllcikgewogICAgY29uc3QgeyBtaW4sIG1heCwgY29tbWEgfSA9IG11bHRpcGxpZXI7CgogICAgaWYgKG1pbiA9PT0gMCAmJiBtYXggPT09IDApIHsKICAgICAgICByZXR1cm4gY29tbWEgPyAnIz8nIDogJyonOwogICAgfQoKICAgIGlmIChtaW4gPT09IDAgJiYgbWF4ID09PSAxKSB7CiAgICAgICAgcmV0dXJuICc/JzsKICAgIH0KCiAgICBpZiAobWluID09PSAxICYmIG1heCA9PT0gMCkgewogICAgICAgIHJldHVybiBjb21tYSA/ICcjJyA6ICcrJzsKICAgIH0KCiAgICBpZiAobWluID09PSAxICYmIG1heCA9PT0gMSkgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICByZXR1cm4gKAogICAgICAgIChjb21tYSA/ICcjJyA6ICcnKSArCiAgICAgICAgKG1pbiA9PT0gbWF4CiAgICAgICAgICAgID8gJ3snICsgbWluICsgJ30nCiAgICAgICAgICAgIDogJ3snICsgbWluICsgJywnICsgKG1heCAhPT0gMCA/IG1heCA6ICcnKSArICd9JwogICAgICAgICkKICAgICk7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlVHlwZU9wdHMobm9kZSkgewogICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICBjYXNlICdSYW5nZSc6CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAnIFsnICsKICAgICAgICAgICAgICAgIChub2RlLm1pbiA9PT0gbnVsbCA/ICct4oieJyA6IG5vZGUubWluKSArCiAgICAgICAgICAgICAgICAnLCcgKwogICAgICAgICAgICAgICAgKG5vZGUubWF4ID09PSBudWxsID8gJ+KInicgOiBub2RlLm1heCkgKwogICAgICAgICAgICAgICAgJ10nCiAgICAgICAgICAgICk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGUgYCcgKyBub2RlLnR5cGUgKyAnYCcpOwogICAgfQp9CgpmdW5jdGlvbiBnZW5lcmF0ZVNlcXVlbmNlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCkgewogICAgY29uc3QgY29tYmluYXRvciA9IG5vZGUuY29tYmluYXRvciA9PT0gJyAnIHx8IGNvbXBhY3QgPyBub2RlLmNvbWJpbmF0b3IgOiAnICcgKyBub2RlLmNvbWJpbmF0b3IgKyAnICc7CiAgICBjb25zdCByZXN1bHQgPSBub2RlLnRlcm1zCiAgICAgICAgLm1hcCh0ZXJtID0+IGludGVybmFsR2VuZXJhdGUodGVybSwgZGVjb3JhdGUsIGZvcmNlQnJhY2VzLCBjb21wYWN0KSkKICAgICAgICAuam9pbihjb21iaW5hdG9yKTsKCiAgICBpZiAobm9kZS5leHBsaWNpdCB8fCBmb3JjZUJyYWNlcykgewogICAgICAgIHJldHVybiAoY29tcGFjdCB8fCByZXN1bHRbMF0gPT09ICcsJyA/ICdbJyA6ICdbICcpICsgcmVzdWx0ICsgKGNvbXBhY3QgPyAnXScgOiAnIF0nKTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBpbnRlcm5hbEdlbmVyYXRlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCkgewogICAgbGV0IHJlc3VsdDsKCiAgICBzd2l0Y2ggKG5vZGUudHlwZSkgewogICAgICAgIGNhc2UgJ0dyb3VwJzoKICAgICAgICAgICAgcmVzdWx0ID0KICAgICAgICAgICAgICAgIGdlbmVyYXRlU2VxdWVuY2Uobm9kZSwgZGVjb3JhdGUsIGZvcmNlQnJhY2VzLCBjb21wYWN0KSArCiAgICAgICAgICAgICAgICAobm9kZS5kaXNhbGxvd0VtcHR5ID8gJyEnIDogJycpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnTXVsdGlwbGllcic6CiAgICAgICAgICAgIC8vIHJldHVybiBzaW5jZSBub2RlIGlzIGEgY29tcG9zaXRpb24KICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGludGVybmFsR2VuZXJhdGUobm9kZS50ZXJtLCBkZWNvcmF0ZSwgZm9yY2VCcmFjZXMsIGNvbXBhY3QpICsKICAgICAgICAgICAgICAgIGRlY29yYXRlKGdlbmVyYXRlTXVsdGlwbGllcihub2RlKSwgbm9kZSkKICAgICAgICAgICAgKTsKCiAgICAgICAgY2FzZSAnVHlwZSc6CiAgICAgICAgICAgIHJlc3VsdCA9ICc8JyArIG5vZGUubmFtZSArIChub2RlLm9wdHMgPyBkZWNvcmF0ZShnZW5lcmF0ZVR5cGVPcHRzKG5vZGUub3B0cyksIG5vZGUub3B0cykgOiAnJykgKyAnPic7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdQcm9wZXJ0eSc6CiAgICAgICAgICAgIHJlc3VsdCA9ICc8XCcnICsgbm9kZS5uYW1lICsgJ1wnPic7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdLZXl3b3JkJzoKICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS5uYW1lOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnQXRLZXl3b3JkJzoKICAgICAgICAgICAgcmVzdWx0ID0gJ0AnICsgbm9kZS5uYW1lOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRnVuY3Rpb24nOgogICAgICAgICAgICByZXN1bHQgPSBub2RlLm5hbWUgKyAnKCc7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgIGNhc2UgJ1Rva2VuJzoKICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS52YWx1ZTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0NvbW1hJzoKICAgICAgICAgICAgcmVzdWx0ID0gJywnOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZSBgJyArIG5vZGUudHlwZSArICdgJyk7CiAgICB9CgogICAgcmV0dXJuIGRlY29yYXRlKHJlc3VsdCwgbm9kZSk7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEcobm9kZSwgb3B0aW9ucykgewogICAgbGV0IGRlY29yYXRlID0gbm9vcCQxOwogICAgbGV0IGZvcmNlQnJhY2VzID0gZmFsc2U7CiAgICBsZXQgY29tcGFjdCA9IGZhbHNlOwoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGRlY29yYXRlID0gb3B0aW9uczsKICAgIH0gZWxzZSBpZiAob3B0aW9ucykgewogICAgICAgIGZvcmNlQnJhY2VzID0gQm9vbGVhbihvcHRpb25zLmZvcmNlQnJhY2VzKTsKICAgICAgICBjb21wYWN0ID0gQm9vbGVhbihvcHRpb25zLmNvbXBhY3QpOwogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kZWNvcmF0ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBkZWNvcmF0ZSA9IG9wdGlvbnMuZGVjb3JhdGU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBpbnRlcm5hbEdlbmVyYXRlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCk7Cn0KCmNvbnN0IGRlZmF1bHRMb2MgPSB7IG9mZnNldDogMCwgbGluZTogMSwgY29sdW1uOiAxIH07CgpmdW5jdGlvbiBsb2NhdGVNaXNtYXRjaChtYXRjaFJlc3VsdCwgbm9kZSkgewogICAgY29uc3QgdG9rZW5zID0gbWF0Y2hSZXN1bHQudG9rZW5zOwogICAgY29uc3QgbG9uZ2VzdE1hdGNoID0gbWF0Y2hSZXN1bHQubG9uZ2VzdE1hdGNoOwogICAgY29uc3QgbWlzbWF0Y2hOb2RlID0gbG9uZ2VzdE1hdGNoIDwgdG9rZW5zLmxlbmd0aCA/IHRva2Vuc1tsb25nZXN0TWF0Y2hdLm5vZGUgfHwgbnVsbCA6IG51bGw7CiAgICBjb25zdCBiYWROb2RlID0gbWlzbWF0Y2hOb2RlICE9PSBub2RlID8gbWlzbWF0Y2hOb2RlIDogbnVsbDsKICAgIGxldCBtaXNtYXRjaE9mZnNldCA9IDA7CiAgICBsZXQgbWlzbWF0Y2hMZW5ndGggPSAwOwogICAgbGV0IGVudHJpZXMgPSAwOwogICAgbGV0IGNzcyA9ICcnOwogICAgbGV0IHN0YXJ0OwogICAgbGV0IGVuZDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldLnZhbHVlOwoKICAgICAgICBpZiAoaSA9PT0gbG9uZ2VzdE1hdGNoKSB7CiAgICAgICAgICAgIG1pc21hdGNoTGVuZ3RoID0gdG9rZW4ubGVuZ3RoOwogICAgICAgICAgICBtaXNtYXRjaE9mZnNldCA9IGNzcy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmFkTm9kZSAhPT0gbnVsbCAmJiB0b2tlbnNbaV0ubm9kZSA9PT0gYmFkTm9kZSkgewogICAgICAgICAgICBpZiAoaSA8PSBsb25nZXN0TWF0Y2gpIHsKICAgICAgICAgICAgICAgIGVudHJpZXMrKzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVudHJpZXMgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjc3MgKz0gdG9rZW47CiAgICB9CgogICAgaWYgKGxvbmdlc3RNYXRjaCA9PT0gdG9rZW5zLmxlbmd0aCB8fCBlbnRyaWVzID4gMSkgeyAvLyBsYXN0CiAgICAgICAgc3RhcnQgPSBmcm9tTG9jKGJhZE5vZGUgfHwgbm9kZSwgJ2VuZCcpIHx8IGJ1aWxkTG9jKGRlZmF1bHRMb2MsIGNzcyk7CiAgICAgICAgZW5kID0gYnVpbGRMb2Moc3RhcnQpOwogICAgfSBlbHNlIHsKICAgICAgICBzdGFydCA9IGZyb21Mb2MoYmFkTm9kZSwgJ3N0YXJ0JykgfHwKICAgICAgICAgICAgYnVpbGRMb2MoZnJvbUxvYyhub2RlLCAnc3RhcnQnKSB8fCBkZWZhdWx0TG9jLCBjc3Muc2xpY2UoMCwgbWlzbWF0Y2hPZmZzZXQpKTsKICAgICAgICBlbmQgPSBmcm9tTG9jKGJhZE5vZGUsICdlbmQnKSB8fAogICAgICAgICAgICBidWlsZExvYyhzdGFydCwgY3NzLnN1YnN0cihtaXNtYXRjaE9mZnNldCwgbWlzbWF0Y2hMZW5ndGgpKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIGNzcywKICAgICAgICBtaXNtYXRjaE9mZnNldCwKICAgICAgICBtaXNtYXRjaExlbmd0aCwKICAgICAgICBzdGFydCwKICAgICAgICBlbmQKICAgIH07Cn0KCmZ1bmN0aW9uIGZyb21Mb2Mobm9kZSwgcG9pbnQpIHsKICAgIGNvbnN0IHZhbHVlID0gbm9kZSAmJiBub2RlLmxvYyAmJiBub2RlLmxvY1twb2ludF07CgogICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuICdsaW5lJyBpbiB2YWx1ZSA/IGJ1aWxkTG9jKHZhbHVlKSA6IHZhbHVlOwogICAgfQoKICAgIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBidWlsZExvYyh7IG9mZnNldCwgbGluZSwgY29sdW1uIH0sIGV4dHJhKSB7CiAgICBjb25zdCBsb2MgPSB7CiAgICAgICAgb2Zmc2V0LAogICAgICAgIGxpbmUsCiAgICAgICAgY29sdW1uCiAgICB9OwoKICAgIGlmIChleHRyYSkgewogICAgICAgIGNvbnN0IGxpbmVzID0gZXh0cmEuc3BsaXQoL1xufFxyXG4/fFxmLyk7CgogICAgICAgIGxvYy5vZmZzZXQgKz0gZXh0cmEubGVuZ3RoOwogICAgICAgIGxvYy5saW5lICs9IGxpbmVzLmxlbmd0aCAtIDE7CiAgICAgICAgbG9jLmNvbHVtbiA9IGxpbmVzLmxlbmd0aCA9PT0gMSA/IGxvYy5jb2x1bW4gKyBleHRyYS5sZW5ndGggOiBsaW5lcy5wb3AoKS5sZW5ndGggKyAxOwogICAgfQoKICAgIHJldHVybiBsb2M7Cn0KCmNvbnN0IFN5bnRheFJlZmVyZW5jZUVycm9yID0gZnVuY3Rpb24odHlwZSwgcmVmZXJlbmNlTmFtZSkgewogICAgY29uc3QgZXJyb3IgPSBjcmVhdGVDdXN0b21FcnJvcigKICAgICAgICAnU3ludGF4UmVmZXJlbmNlRXJyb3InLAogICAgICAgIHR5cGUgKyAocmVmZXJlbmNlTmFtZSA/ICcgYCcgKyByZWZlcmVuY2VOYW1lICsgJ2AnIDogJycpCiAgICApOwoKICAgIGVycm9yLnJlZmVyZW5jZSA9IHJlZmVyZW5jZU5hbWU7CgogICAgcmV0dXJuIGVycm9yOwp9OwoKY29uc3QgU3ludGF4TWF0Y2hFcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHN5bnRheCwgbm9kZSwgbWF0Y2hSZXN1bHQpIHsKICAgIGNvbnN0IGVycm9yID0gY3JlYXRlQ3VzdG9tRXJyb3IoJ1N5bnRheE1hdGNoRXJyb3InLCBtZXNzYWdlKTsKICAgIGNvbnN0IHsKICAgICAgICBjc3MsCiAgICAgICAgbWlzbWF0Y2hPZmZzZXQsCiAgICAgICAgbWlzbWF0Y2hMZW5ndGgsCiAgICAgICAgc3RhcnQsCiAgICAgICAgZW5kCiAgICB9ID0gbG9jYXRlTWlzbWF0Y2gobWF0Y2hSZXN1bHQsIG5vZGUpOwoKICAgIGVycm9yLnJhd01lc3NhZ2UgPSBtZXNzYWdlOwogICAgZXJyb3Iuc3ludGF4ID0gc3ludGF4ID8gZ2VuZXJhdGUkRyhzeW50YXgpIDogJzxnZW5lcmljPic7CiAgICBlcnJvci5jc3MgPSBjc3M7CiAgICBlcnJvci5taXNtYXRjaE9mZnNldCA9IG1pc21hdGNoT2Zmc2V0OwogICAgZXJyb3IubWlzbWF0Y2hMZW5ndGggPSBtaXNtYXRjaExlbmd0aDsKICAgIGVycm9yLm1lc3NhZ2UgPSBtZXNzYWdlICsgJ1xuJyArCiAgICAgICAgJyAgc3ludGF4OiAnICsgZXJyb3Iuc3ludGF4ICsgJ1xuJyArCiAgICAgICAgJyAgIHZhbHVlOiAnICsgKGNzcyB8fCAnPGVtcHR5IHN0cmluZz4nKSArICdcbicgKwogICAgICAgICcgIC0tLS0tLS0tJyArIG5ldyBBcnJheShlcnJvci5taXNtYXRjaE9mZnNldCArIDEpLmpvaW4oJy0nKSArICdeJzsKCiAgICBPYmplY3QuYXNzaWduKGVycm9yLCBzdGFydCk7CiAgICBlcnJvci5sb2MgPSB7CiAgICAgICAgc291cmNlOiAobm9kZSAmJiBub2RlLmxvYyAmJiBub2RlLmxvYy5zb3VyY2UpIHx8ICc8dW5rbm93bj4nLAogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZAogICAgfTsKCiAgICByZXR1cm4gZXJyb3I7Cn07Cgpjb25zdCBrZXl3b3JkcyA9IG5ldyBNYXAoKTsKY29uc3QgcHJvcGVydGllcyA9IG5ldyBNYXAoKTsKY29uc3QgSFlQSEVOTUlOVVMkNSA9IDQ1OyAvLyAnLScuY2hhckNvZGVBdCgpCgpjb25zdCBrZXl3b3JkID0gZ2V0S2V5d29yZERlc2NyaXB0b3I7CmNvbnN0IHByb3BlcnR5ID0gZ2V0UHJvcGVydHlEZXNjcmlwdG9yOwpmdW5jdGlvbiBpc0N1c3RvbVByb3BlcnR5KHN0ciwgb2Zmc2V0KSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDsKCiAgICByZXR1cm4gc3RyLmxlbmd0aCAtIG9mZnNldCA+PSAyICYmCiAgICAgICAgICAgc3RyLmNoYXJDb2RlQXQob2Zmc2V0KSA9PT0gSFlQSEVOTUlOVVMkNSAmJgogICAgICAgICAgIHN0ci5jaGFyQ29kZUF0KG9mZnNldCArIDEpID09PSBIWVBIRU5NSU5VUyQ1Owp9CgpmdW5jdGlvbiBnZXRWZW5kb3JQcmVmaXgoc3RyLCBvZmZzZXQpIHsKICAgIG9mZnNldCA9IG9mZnNldCB8fCAwOwoKICAgIC8vIHZlcmRvciBwcmVmaXggc2hvdWxkIGJlIGF0IGxlYXN0IDMgY2hhcnMgbGVuZ3RoCiAgICBpZiAoc3RyLmxlbmd0aCAtIG9mZnNldCA+PSAzKSB7CiAgICAgICAgLy8gdmVuZG9yIHByZWZpeCBzdGFydHMgd2l0aCBoeXBlciBtaW51cyBmb2xsb3dpbmcgbm9uLWh5cGVyIG1pbnVzCiAgICAgICAgaWYgKHN0ci5jaGFyQ29kZUF0KG9mZnNldCkgPT09IEhZUEhFTk1JTlVTJDUgJiYKICAgICAgICAgICAgc3RyLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgIT09IEhZUEhFTk1JTlVTJDUpIHsKICAgICAgICAgICAgLy8gdmVuZG9yIHByZWZpeCBzaG91bGQgY29udGFpbiBhIGh5cGVyIG1pbnVzIGF0IHRoZSBlbmRpbmcKICAgICAgICAgICAgY29uc3Qgc2Vjb25kRGFzaEluZGV4ID0gc3RyLmluZGV4T2YoJy0nLCBvZmZzZXQgKyAyKTsKCiAgICAgICAgICAgIGlmIChzZWNvbmREYXNoSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnN1YnN0cmluZyhvZmZzZXQsIHNlY29uZERhc2hJbmRleCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAnJzsKfQoKZnVuY3Rpb24gZ2V0S2V5d29yZERlc2NyaXB0b3Ioa2V5d29yZCkgewogICAgaWYgKGtleXdvcmRzLmhhcyhrZXl3b3JkKSkgewogICAgICAgIHJldHVybiBrZXl3b3Jkcy5nZXQoa2V5d29yZCk7CiAgICB9CgogICAgY29uc3QgbmFtZSA9IGtleXdvcmQudG9Mb3dlckNhc2UoKTsKICAgIGxldCBkZXNjcmlwdG9yID0ga2V5d29yZHMuZ2V0KG5hbWUpOwoKICAgIGlmIChkZXNjcmlwdG9yID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjb25zdCBjdXN0b20gPSBpc0N1c3RvbVByb3BlcnR5KG5hbWUsIDApOwogICAgICAgIGNvbnN0IHZlbmRvciA9ICFjdXN0b20gPyBnZXRWZW5kb3JQcmVmaXgobmFtZSwgMCkgOiAnJzsKICAgICAgICBkZXNjcmlwdG9yID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIGJhc2VuYW1lOiBuYW1lLnN1YnN0cih2ZW5kb3IubGVuZ3RoKSwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgcHJlZml4OiB2ZW5kb3IsCiAgICAgICAgICAgIHZlbmRvciwKICAgICAgICAgICAgY3VzdG9tCiAgICAgICAgfSk7CiAgICB9CgogICAga2V5d29yZHMuc2V0KGtleXdvcmQsIGRlc2NyaXB0b3IpOwoKICAgIHJldHVybiBkZXNjcmlwdG9yOwp9CgpmdW5jdGlvbiBnZXRQcm9wZXJ0eURlc2NyaXB0b3IocHJvcGVydHkpIHsKICAgIGlmIChwcm9wZXJ0aWVzLmhhcyhwcm9wZXJ0eSkpIHsKICAgICAgICByZXR1cm4gcHJvcGVydGllcy5nZXQocHJvcGVydHkpOwogICAgfQoKICAgIGxldCBuYW1lID0gcHJvcGVydHk7CiAgICBsZXQgaGFjayA9IHByb3BlcnR5WzBdOwoKICAgIGlmIChoYWNrID09PSAnLycpIHsKICAgICAgICBoYWNrID0gcHJvcGVydHlbMV0gPT09ICcvJyA/ICcvLycgOiAnLyc7CiAgICB9IGVsc2UgaWYgKGhhY2sgIT09ICdfJyAmJgogICAgICAgICAgICAgICBoYWNrICE9PSAnKicgJiYKICAgICAgICAgICAgICAgaGFjayAhPT0gJyQnICYmCiAgICAgICAgICAgICAgIGhhY2sgIT09ICcjJyAmJgogICAgICAgICAgICAgICBoYWNrICE9PSAnKycgJiYKICAgICAgICAgICAgICAgaGFjayAhPT0gJyYnKSB7CiAgICAgICAgaGFjayA9ICcnOwogICAgfQoKICAgIGNvbnN0IGN1c3RvbSA9IGlzQ3VzdG9tUHJvcGVydHkobmFtZSwgaGFjay5sZW5ndGgpOwoKICAgIC8vIHJlLXVzZSByZXN1bHQgd2hlbiBwb3NzaWJsZSAodGhlIHNhbWUgYXMgZm9yIGxvd2VyIGNhc2UpCiAgICBpZiAoIWN1c3RvbSkgewogICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBwcm9wZXJ0aWVzLmdldChuYW1lKTsKICAgICAgICAgICAgcHJvcGVydGllcy5zZXQocHJvcGVydHksIGRlc2NyaXB0b3IpOwogICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgdmVuZG9yID0gIWN1c3RvbSA/IGdldFZlbmRvclByZWZpeChuYW1lLCBoYWNrLmxlbmd0aCkgOiAnJzsKICAgIGNvbnN0IHByZWZpeCA9IG5hbWUuc3Vic3RyKDAsIGhhY2subGVuZ3RoICsgdmVuZG9yLmxlbmd0aCk7CiAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgYmFzZW5hbWU6IG5hbWUuc3Vic3RyKHByZWZpeC5sZW5ndGgpLAogICAgICAgIG5hbWU6IG5hbWUuc3Vic3RyKGhhY2subGVuZ3RoKSwKICAgICAgICBoYWNrLAogICAgICAgIHZlbmRvciwKICAgICAgICBwcmVmaXgsCiAgICAgICAgY3VzdG9tCiAgICB9KTsKCiAgICBwcm9wZXJ0aWVzLnNldChwcm9wZXJ0eSwgZGVzY3JpcHRvcik7CgogICAgcmV0dXJuIGRlc2NyaXB0b3I7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtY2FzY2FkZS01Lwpjb25zdCBjc3NXaWRlS2V5d29yZHMgPSBbCiAgICAnaW5pdGlhbCcsCiAgICAnaW5oZXJpdCcsCiAgICAndW5zZXQnLAogICAgJ3JldmVydCcsCiAgICAncmV2ZXJ0LWxheWVyJwpdOwoKY29uc3QgUExVU1NJR04kOCA9IDB4MDAyQjsgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgSFlQSEVOTUlOVVMkNCA9IDB4MDAyRDsgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKY29uc3QgTiQzID0gMHgwMDZFOyAgICAgICAgICAgLy8gVSswMDZFIExBVElOIFNNQUxMIExFVFRFUiBOIChuKQpjb25zdCBESVNBTExPV19TSUdOJDEgPSB0cnVlOwpjb25zdCBBTExPV19TSUdOJDEgPSBmYWxzZTsKCmZ1bmN0aW9uIGlzRGVsaW0kMSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuICE9PSBudWxsICYmIHRva2VuLnR5cGUgPT09IERlbGltICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIHNraXBTQyh0b2tlbiwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pIHsKICAgIHdoaWxlICh0b2tlbiAhPT0gbnVsbCAmJiAodG9rZW4udHlwZSA9PT0gV2hpdGVTcGFjZSQxIHx8IHRva2VuLnR5cGUgPT09IENvbW1lbnQkMSkpIHsKICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK29mZnNldCk7CiAgICB9CgogICAgcmV0dXJuIG9mZnNldDsKfQoKZnVuY3Rpb24gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIHZhbHVlT2Zmc2V0LCBkaXNhbGxvd1NpZ24sIG9mZnNldCkgewogICAgaWYgKCF0b2tlbikgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGNvbnN0IGNvZGUgPSB0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KHZhbHVlT2Zmc2V0KTsKCiAgICBpZiAoY29kZSA9PT0gUExVU1NJR04kOCB8fCBjb2RlID09PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgaWYgKGRpc2FsbG93U2lnbikgewogICAgICAgICAgICAvLyBOdW1iZXIgc2lnbiBpcyBub3QgYWxsb3dlZAogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdmFsdWVPZmZzZXQrKzsKICAgIH0KCiAgICBmb3IgKDsgdmFsdWVPZmZzZXQgPCB0b2tlbi52YWx1ZS5sZW5ndGg7IHZhbHVlT2Zmc2V0KyspIHsKICAgICAgICBpZiAoIWlzRGlnaXQodG9rZW4udmFsdWUuY2hhckNvZGVBdCh2YWx1ZU9mZnNldCkpKSB7CiAgICAgICAgICAgIC8vIEludGVnZXIgaXMgZXhwZWN0ZWQKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQgKyAxOwp9CgovLyAuLi4gPHNpZ25lZC1pbnRlZ2VyPgovLyAuLi4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CmZ1bmN0aW9uIGNvbnN1bWVCJDEodG9rZW4sIG9mZnNldF8sIGdldE5leHRUb2tlbikgewogICAgbGV0IHNpZ24gPSBmYWxzZTsKICAgIGxldCBvZmZzZXQgPSBza2lwU0ModG9rZW4sIG9mZnNldF8sIGdldE5leHRUb2tlbik7CgogICAgdG9rZW4gPSBnZXROZXh0VG9rZW4ob2Zmc2V0KTsKCiAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gb2Zmc2V0XzsKICAgIH0KCiAgICBpZiAodG9rZW4udHlwZSAhPT0gTnVtYmVyJDIpIHsKICAgICAgICBpZiAoaXNEZWxpbSQxKHRva2VuLCBQTFVTU0lHTiQ4KSB8fCBpc0RlbGltJDEodG9rZW4sIEhZUEhFTk1JTlVTJDQpKSB7CiAgICAgICAgICAgIHNpZ24gPSB0cnVlOwogICAgICAgICAgICBvZmZzZXQgPSBza2lwU0MoZ2V0TmV4dFRva2VuKCsrb2Zmc2V0KSwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pOwogICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXRfOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIXNpZ24pIHsKICAgICAgICBjb25zdCBjb2RlID0gdG9rZW4udmFsdWUuY2hhckNvZGVBdCgwKTsKICAgICAgICBpZiAoY29kZSAhPT0gUExVU1NJR04kOCAmJiBjb2RlICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgIC8vIE51bWJlciBzaWduIGlzIGV4cGVjdGVkCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIHNpZ24gPyAwIDogMSwgc2lnbiwgb2Zmc2V0KTsKfQoKLy8gQW4rQiBtaWNyb3N5bnRheCBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXN5bnRheC0zLyNhbmIKZnVuY3Rpb24gYW5QbHVzQih0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBicmFjZS1zdHlsZSovCiAgICBsZXQgb2Zmc2V0ID0gMDsKCiAgICBpZiAoIXRva2VuKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy8gPGludGVnZXI+CiAgICBpZiAodG9rZW4udHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIDAsIEFMTE9XX1NJR04kMSwgb2Zmc2V0KTsgLy8gYgogICAgfQoKICAgIC8vIC1uCiAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+CiAgICAvLyAtbiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vIC1uLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vIDxkYXNobmRhc2hkaWdpdC1pZGVudD4KICAgIGVsc2UgaWYgKHRva2VuLnR5cGUgPT09IElkZW50ICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAvLyBleHBlY3QgMXN0IGNoYXIgaXMgTgogICAgICAgIGlmICghY21wQ2hhcih0b2tlbi52YWx1ZSwgMSwgTiQzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAodG9rZW4udmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIC1uCiAgICAgICAgICAgIC8vIC1uIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gLW4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiBjb25zdW1lQiQxKGdldE5leHRUb2tlbigrK29mZnNldCksIG9mZnNldCwgZ2V0TmV4dFRva2VuKTsKCiAgICAgICAgICAgIC8vIC1uLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMikgIT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvZmZzZXQgPSBza2lwU0MoZ2V0TmV4dFRva2VuKCsrb2Zmc2V0KSwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pOwogICAgICAgICAgICAgICAgdG9rZW4gPSBnZXROZXh0VG9rZW4ob2Zmc2V0KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIDAsIERJU0FMTE9XX1NJR04kMSwgb2Zmc2V0KTsKCiAgICAgICAgICAgIC8vIDxkYXNobmRhc2hkaWdpdC1pZGVudD4KICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KDIpICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrSW50ZWdlciQxKHRva2VuLCAzLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vICcrJz8gbgogICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgIC8vICcrJz8gbiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vICcrJz8gbi0gPHNpZ25sZXNzLWludGVnZXI+CiAgICAvLyAnKyc/IDxuZGFzaGRpZ2l0LWlkZW50PgogICAgZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gSWRlbnQgfHwgKGlzRGVsaW0kMSh0b2tlbiwgUExVU1NJR04kOCkgJiYgZ2V0TmV4dFRva2VuKG9mZnNldCArIDEpLnR5cGUgPT09IElkZW50KSkgewogICAgICAgIC8vIGp1c3QgaWdub3JlIGEgcGx1cwogICAgICAgIGlmICh0b2tlbi50eXBlICE9PSBJZGVudCkgewogICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK29mZnNldCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgIWNtcENoYXIodG9rZW4udmFsdWUsIDAsIE4kMykpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKHRva2VuLnZhbHVlLmxlbmd0aCkgewogICAgICAgICAgICAvLyAnKyc/IG4KICAgICAgICAgICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3VtZUIkMShnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CgogICAgICAgICAgICAvLyAnKyc/IG4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodG9rZW4udmFsdWUuY2hhckNvZGVBdCgxKSAhPT0gSFlQSEVOTUlOVVMkNCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9mZnNldCA9IHNraXBTQyhnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CiAgICAgICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0ludGVnZXIkMSh0b2tlbiwgMCwgRElTQUxMT1dfU0lHTiQxLCBvZmZzZXQpOwoKICAgICAgICAgICAgLy8gJysnPyA8bmRhc2hkaWdpdC1pZGVudD4KICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KDEpICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrSW50ZWdlciQxKHRva2VuLCAyLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIDxuZGFzaGRpZ2l0LWRpbWVuc2lvbj4KICAgIC8vIDxuZGFzaC1kaW1lbnNpb24+IDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gPG4tZGltZW5zaW9uPgogICAgLy8gPG4tZGltZW5zaW9uPiA8c2lnbmVkLWludGVnZXI+CiAgICAvLyA8bi1kaW1lbnNpb24+IFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gRGltZW5zaW9uJDEpIHsKICAgICAgICBsZXQgY29kZSA9IHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCk7CiAgICAgICAgbGV0IHNpZ24gPSBjb2RlID09PSBQTFVTU0lHTiQ4IHx8IGNvZGUgPT09IEhZUEhFTk1JTlVTJDQgPyAxIDogMDsKICAgICAgICBsZXQgaSA9IHNpZ247CgogICAgICAgIGZvciAoOyBpIDwgdG9rZW4udmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFpc0RpZ2l0KHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoaSkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGkgPT09IHNpZ24pIHsKICAgICAgICAgICAgLy8gSW50ZWdlciBpcyBleHBlY3RlZAogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmICghY21wQ2hhcih0b2tlbi52YWx1ZSwgaSwgTiQzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIDxuLWRpbWVuc2lvbj4KICAgICAgICAvLyA8bi1kaW1lbnNpb24+IDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAvLyA8bi1kaW1lbnNpb24+IFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgIGlmIChpICsgMSA9PT0gdG9rZW4udmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBjb25zdW1lQiQxKGdldE5leHRUb2tlbigrK29mZnNldCksIG9mZnNldCwgZ2V0TmV4dFRva2VuKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodG9rZW4udmFsdWUuY2hhckNvZGVBdChpICsgMSkgIT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA8bmRhc2gtZGltZW5zaW9uPiA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICAgICAgaWYgKGkgKyAyID09PSB0b2tlbi52YWx1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG9mZnNldCA9IHNraXBTQyhnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CiAgICAgICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0ludGVnZXIkMSh0b2tlbiwgMCwgRElTQUxMT1dfU0lHTiQxLCBvZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIDxuZGFzaGRpZ2l0LWRpbWVuc2lvbj4KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIGkgKyAyLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDA7Cn0KCmNvbnN0IFBMVVNTSUdOJDcgPSAweDAwMkI7ICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQpjb25zdCBIWVBIRU5NSU5VUyQzID0gMHgwMDJEOyAgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKY29uc3QgUVVFU1RJT05NQVJLJDIgPSAweDAwM0Y7IC8vIFUrMDAzRiBRVUVTVElPTiBNQVJLICg/KQpjb25zdCBVJDEgPSAweDAwNzU7ICAgICAgICAgICAgLy8gVSswMDc1IExBVElOIFNNQUxMIExFVFRFUiBVICh1KQoKZnVuY3Rpb24gaXNEZWxpbSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuICE9PSBudWxsICYmIHRva2VuLnR5cGUgPT09IERlbGltICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIHN0YXJ0c1dpdGgkMSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIGhleFNlcXVlbmNlKHRva2VuLCBvZmZzZXQsIGFsbG93RGFzaCkgewogICAgbGV0IGhleGxlbiA9IDA7CgogICAgZm9yIChsZXQgcG9zID0gb2Zmc2V0OyBwb3MgPCB0b2tlbi52YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuLnZhbHVlLmNoYXJDb2RlQXQocG9zKTsKCiAgICAgICAgaWYgKGNvZGUgPT09IEhZUEhFTk1JTlVTJDMgJiYgYWxsb3dEYXNoICYmIGhleGxlbiAhPT0gMCkgewogICAgICAgICAgICBoZXhTZXF1ZW5jZSh0b2tlbiwgb2Zmc2V0ICsgaGV4bGVuICsgMSwgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gNjsgLy8gZGlzc2FsbG93IGZvbGxvd2luZyBxdWVzdGlvbiBtYXJrcwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNvZGUpKSB7CiAgICAgICAgICAgIHJldHVybiAwOyAvLyBub3QgYSBoZXggZGlnaXQKICAgICAgICB9CgogICAgICAgIGlmICgrK2hleGxlbiA+IDYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7IC8vIHRvbyBtYW55IGhleCBkaWdpdHMKICAgICAgICB9ICAgIH0KCiAgICByZXR1cm4gaGV4bGVuOwp9CgpmdW5jdGlvbiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoY29uc3VtZWQsIGxlbmd0aCwgZ2V0TmV4dFRva2VuKSB7CiAgICBpZiAoIWNvbnN1bWVkKSB7CiAgICAgICAgcmV0dXJuIDA7IC8vIG5vdGhpbmcgY29uc3VtZWQKICAgIH0KCiAgICB3aGlsZSAoaXNEZWxpbShnZXROZXh0VG9rZW4obGVuZ3RoKSwgUVVFU1RJT05NQVJLJDIpKSB7CiAgICAgICAgaWYgKCsrY29uc3VtZWQgPiA2KSB7CiAgICAgICAgICAgIHJldHVybiAwOyAvLyB0b28gbWFueSBxdWVzdGlvbiBtYXJrcwogICAgICAgIH0KCiAgICAgICAgbGVuZ3RoKys7CiAgICB9CgogICAgcmV0dXJuIGxlbmd0aDsKfQoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgvI3VyYW5nZQovLyBJbmZvcm1hbGx5LCB0aGUgPHVyYW5nZT4gcHJvZHVjdGlvbiBoYXMgdGhyZWUgZm9ybXM6Ci8vIFUrMDAwMQovLyAgICAgIERlZmluZXMgYSByYW5nZSBjb25zaXN0aW5nIG9mIGEgc2luZ2xlIGNvZGUgcG9pbnQsIGluIHRoaXMgY2FzZSB0aGUgY29kZSBwb2ludCAiMSIuCi8vIFUrMDAwMS0wMGZmCi8vICAgICAgRGVmaW5lcyBhIHJhbmdlIG9mIGNvZGVwb2ludHMgYmV0d2VlbiB0aGUgZmlyc3QgYW5kIHRoZSBzZWNvbmQgdmFsdWUsIGluIHRoaXMgY2FzZQovLyAgICAgIHRoZSByYW5nZSBiZXR3ZWVuICIxIiBhbmQgImZmIiAoMjU1IGluIGRlY2ltYWwpIGluY2x1c2l2ZS4KLy8gVSswMD8/Ci8vICAgICAgRGVmaW5lcyBhIHJhbmdlIG9mIGNvZGVwb2ludHMgd2hlcmUgdGhlICI/IiBjaGFyYWN0ZXJzIHJhbmdlIG92ZXIgYWxsIGhleCBkaWdpdHMsCi8vICAgICAgaW4gdGhpcyBjYXNlIGRlZmluaW5nIHRoZSBzYW1lIGFzIHRoZSB2YWx1ZSBVKzAwMDAtMDBmZi4KLy8gSW4gZWFjaCBmb3JtLCBhIG1heGltdW0gb2YgNiBkaWdpdHMgaXMgYWxsb3dlZCBmb3IgZWFjaCBoZXhhZGVjaW1hbCBudW1iZXIgKGlmIHlvdSB0cmVhdCAiPyIgYXMgYSBoZXhhZGVjaW1hbCBkaWdpdCkuCi8vCi8vIDx1cmFuZ2U+ID0KLy8gICB1ICcrJyA8aWRlbnQtdG9rZW4+ICc/JyogfAovLyAgIHUgPGRpbWVuc2lvbi10b2tlbj4gJz8nKiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiAnPycqIHwKLy8gICB1IDxudW1iZXItdG9rZW4+IDxkaW1lbnNpb24tdG9rZW4+IHwKLy8gICB1IDxudW1iZXItdG9rZW4+IDxudW1iZXItdG9rZW4+IHwKLy8gICB1ICcrJyAnPycrCmZ1bmN0aW9uIHVyYW5nZSh0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBzaG91bGQgc3RhcnQgd2l0aCBgdWAgb3IgYFVgCiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gSWRlbnQgfHwgIWNtcENoYXIodG9rZW4udmFsdWUsIDAsIFUkMSkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK2xlbmd0aCk7CiAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyB1ICcrJyA8aWRlbnQtdG9rZW4+ICc/JyoKICAgIC8vIHUgJysnICc/JysKICAgIGlmIChpc0RlbGltKHRva2VuLCBQTFVTU0lHTiQ3KSkgewogICAgICAgIHRva2VuID0gZ2V0TmV4dFRva2VuKCsrbGVuZ3RoKTsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gSWRlbnQpIHsKICAgICAgICAgICAgLy8gdSAnKycgPGlkZW50LXRva2VuPiAnPycqCiAgICAgICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoaGV4U2VxdWVuY2UodG9rZW4sIDAsIHRydWUpLCArK2xlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc0RlbGltKHRva2VuLCBRVUVTVElPTk1BUkskMikpIHsKICAgICAgICAgICAgLy8gdSAnKycgJz8nKwogICAgICAgICAgICByZXR1cm4gd2l0aFF1ZXN0aW9uTWFya1NlcXVlbmNlKDEsICsrbGVuZ3RoLCBnZXROZXh0VG9rZW4pOwogICAgICAgIH0KCiAgICAgICAgLy8gSGV4IGRpZ2l0IG9yIHF1ZXN0aW9uIG1hcmsgaXMgZXhwZWN0ZWQKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyB1IDxudW1iZXItdG9rZW4+ICc/JyoKICAgIC8vIHUgPG51bWJlci10b2tlbj4gPGRpbWVuc2lvbi10b2tlbj4KICAgIC8vIHUgPG51bWJlci10b2tlbj4gPG51bWJlci10b2tlbj4KICAgIGlmICh0b2tlbi50eXBlID09PSBOdW1iZXIkMikgewogICAgICAgIGNvbnN0IGNvbnN1bWVkSGV4TGVuZ3RoID0gaGV4U2VxdWVuY2UodG9rZW4sIDEsIHRydWUpOwogICAgICAgIGlmIChjb25zdW1lZEhleExlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHRva2VuID0gZ2V0TmV4dFRva2VuKCsrbGVuZ3RoKTsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gdSA8bnVtYmVyLXRva2VuPiA8ZW9mPgogICAgICAgICAgICByZXR1cm4gbGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IERpbWVuc2lvbiQxIHx8IHRva2VuLnR5cGUgPT09IE51bWJlciQyKSB7CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gPGRpbWVuc2lvbi10b2tlbj4KICAgICAgICAgICAgLy8gdSA8bnVtYmVyLXRva2VuPiA8bnVtYmVyLXRva2VuPgogICAgICAgICAgICBpZiAoIXN0YXJ0c1dpdGgkMSh0b2tlbiwgSFlQSEVOTUlOVVMkMykgfHwgIWhleFNlcXVlbmNlKHRva2VuLCAxLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbGVuZ3RoICsgMTsKICAgICAgICB9CgogICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gJz8nKgogICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoY29uc3VtZWRIZXhMZW5ndGgsIGxlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgIH0KCiAgICAvLyB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyoKICAgIGlmICh0b2tlbi50eXBlID09PSBEaW1lbnNpb24kMSkgewogICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoaGV4U2VxdWVuY2UodG9rZW4sIDEsIHRydWUpLCArK2xlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgIH0KCiAgICByZXR1cm4gMDsKfQoKY29uc3QgY2FsY0Z1bmN0aW9uTmFtZXMgPSBbJ2NhbGMoJywgJy1tb3otY2FsYygnLCAnLXdlYmtpdC1jYWxjKCddOwpjb25zdCBiYWxhbmNlUGFpciA9IG5ldyBNYXAoWwogICAgW0Z1bmN0aW9uJDIsIFJpZ2h0UGFyZW50aGVzaXNdLAogICAgW0xlZnRQYXJlbnRoZXNpcywgUmlnaHRQYXJlbnRoZXNpc10sCiAgICBbTGVmdFNxdWFyZUJyYWNrZXQsIFJpZ2h0U3F1YXJlQnJhY2tldF0sCiAgICBbTGVmdEN1cmx5QnJhY2tldCwgUmlnaHRDdXJseUJyYWNrZXRdCl0pOwoKLy8gc2FmZSBjaGFyIGNvZGUgZ2V0dGVyCmZ1bmN0aW9uIGNoYXJDb2RlQXQoc3RyLCBpbmRleCkgewogICAgcmV0dXJuIGluZGV4IDwgc3RyLmxlbmd0aCA/IHN0ci5jaGFyQ29kZUF0KGluZGV4KSA6IDA7Cn0KCmZ1bmN0aW9uIGVxU3RyKGFjdHVhbCwgZXhwZWN0ZWQpIHsKICAgIHJldHVybiBjbXBTdHIoYWN0dWFsLCAwLCBhY3R1YWwubGVuZ3RoLCBleHBlY3RlZCk7Cn0KCmZ1bmN0aW9uIGVxU3RyQW55KGFjdHVhbCwgZXhwZWN0ZWQpIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwZWN0ZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoZXFTdHIoYWN0dWFsLCBleHBlY3RlZFtpXSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKfQoKLy8gSUUgcG9zdGZpeCBoYWNrLCBpLmUuIDEyM1wwIG9yIDEyM3B4XDkKZnVuY3Rpb24gaXNQb3N0Zml4SWVIYWNrKHN0ciwgb2Zmc2V0KSB7CiAgICBpZiAob2Zmc2V0ICE9PSBzdHIubGVuZ3RoIC0gMikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gKAogICAgICAgIGNoYXJDb2RlQXQoc3RyLCBvZmZzZXQpID09PSAweDAwNUMgJiYgIC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCiAgICAgICAgaXNEaWdpdChjaGFyQ29kZUF0KHN0ciwgb2Zmc2V0ICsgMSkpCiAgICApOwp9CgpmdW5jdGlvbiBvdXRPZlJhbmdlKG9wdHMsIHZhbHVlLCBudW1FbmQpIHsKICAgIGlmIChvcHRzICYmIG9wdHMudHlwZSA9PT0gJ1JhbmdlJykgewogICAgICAgIGNvbnN0IG51bSA9IE51bWJlcigKICAgICAgICAgICAgbnVtRW5kICE9PSB1bmRlZmluZWQgJiYgbnVtRW5kICE9PSB2YWx1ZS5sZW5ndGgKICAgICAgICAgICAgICAgID8gdmFsdWUuc3Vic3RyKDAsIG51bUVuZCkKICAgICAgICAgICAgICAgIDogdmFsdWUKICAgICAgICApOwoKICAgICAgICBpZiAoaXNOYU4obnVtKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIEZJWE1FOiB3aGVuIG9wdHMubWluIGlzIGEgc3RyaW5nIGl0J3MgYSBkaW1lbnNpb24sIHNraXAgYSByYW5nZSB2YWxpZGF0aW9uCiAgICAgICAgLy8gZm9yIG5vdyBzaW5jZSBpdCByZXF1aXJlcyBhIHR5cGUgY292ZXJ0YXRpb24gd2hpY2ggaXMgbm90IGltcGxtZW50ZWQgeWV0CiAgICAgICAgaWYgKG9wdHMubWluICE9PSBudWxsICYmIG51bSA8IG9wdHMubWluICYmIHR5cGVvZiBvcHRzLm1pbiAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBGSVhNRTogd2hlbiBvcHRzLm1heCBpcyBhIHN0cmluZyBpdCdzIGEgZGltZW5zaW9uLCBza2lwIGEgcmFuZ2UgdmFsaWRhdGlvbgogICAgICAgIC8vIGZvciBub3cgc2luY2UgaXQgcmVxdWlyZXMgYSB0eXBlIGNvdmVydGF0aW9uIHdoaWNoIGlzIG5vdCBpbXBsbWVudGVkIHlldAogICAgICAgIGlmIChvcHRzLm1heCAhPT0gbnVsbCAmJiBudW0gPiBvcHRzLm1heCAmJiB0eXBlb2Ygb3B0cy5tYXggIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNvbnN1bWVGdW5jdGlvbih0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICBsZXQgYmFsYW5jZVN0YXNoID0gW107CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBiYWxhbmNlZCB0b2tlbiBjb25zdW1pbmcKICAgIHNjYW46CiAgICBkbyB7CiAgICAgICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgUmlnaHRDdXJseUJyYWNrZXQ6CiAgICAgICAgICAgIGNhc2UgUmlnaHRQYXJlbnRoZXNpczoKICAgICAgICAgICAgY2FzZSBSaWdodFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgICAgICBpZiAodG9rZW4udHlwZSAhPT0gYmFsYW5jZUNsb3NlVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VTdGFzaC5wb3AoKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFsYW5jZVN0YXNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGxlbmd0aCsrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIGNhc2UgTGVmdFBhcmVudGhlc2lzOgogICAgICAgICAgICBjYXNlIExlZnRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICBjYXNlIExlZnRDdXJseUJyYWNrZXQ6CiAgICAgICAgICAgICAgICBiYWxhbmNlU3Rhc2gucHVzaChiYWxhbmNlQ2xvc2VUeXBlKTsKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlUGFpci5nZXQodG9rZW4udHlwZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGxlbmd0aCsrOwogICAgfSB3aGlsZSAodG9rZW4gPSBnZXROZXh0VG9rZW4obGVuZ3RoKSk7CgogICAgcmV0dXJuIGxlbmd0aDsKfQoKLy8gVE9ETzogaW1wbGVtZW50Ci8vIGNhbiBiZSB1c2VkIHdoZXJldmVyIDxsZW5ndGg+LCA8ZnJlcXVlbmN5PiwgPGFuZ2xlPiwgPHRpbWU+LCA8cGVyY2VudGFnZT4sIDxudW1iZXI+LCBvciA8aW50ZWdlcj4gdmFsdWVzIGFyZSBhbGxvd2VkCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLyNjYWxjLW5vdGF0aW9uCmZ1bmN0aW9uIGNhbGMobmV4dCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gRnVuY3Rpb24kMiAmJiBlcVN0ckFueSh0b2tlbi52YWx1ZSwgY2FsY0Z1bmN0aW9uTmFtZXMpKSB7CiAgICAgICAgICAgIHJldHVybiBjb25zdW1lRnVuY3Rpb24odG9rZW4sIGdldE5leHRUb2tlbik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV4dCh0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKTsKICAgIH07Cn0KCmZ1bmN0aW9uIHRva2VuVHlwZShleHBlY3RlZFRva2VuVHlwZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IGV4cGVjdGVkVG9rZW5UeXBlKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDE7CiAgICB9Owp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvbXBsZXggdHlwZXMKLy8KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI2N1c3RvbS1pZGVudHMKLy8gNC4yLiBBdXRob3ItZGVmaW5lZCBJZGVudGlmaWVyczogdGhlIDxjdXN0b20taWRlbnQ+IHR5cGUKLy8gU29tZSBwcm9wZXJ0aWVzIGFjY2VwdCBhcmJpdHJhcnkgYXV0aG9yLWRlZmluZWQgaWRlbnRpZmllcnMgYXMgYSBjb21wb25lbnQgdmFsdWUuCi8vIFRoaXMgZ2VuZXJpYyBkYXRhIHR5cGUgaXMgZGVub3RlZCBieSA8Y3VzdG9tLWlkZW50PiwgYW5kIHJlcHJlc2VudHMgYW55IHZhbGlkIENTUyBpZGVudGlmaWVyCi8vIHRoYXQgd291bGQgbm90IGJlIG1pc2ludGVycHJldGVkIGFzIGEgcHJlLWRlZmluZWQga2V5d29yZCBpbiB0aGF0IHByb3BlcnR54oCZcyB2YWx1ZSBkZWZpbml0aW9uLgovLwovLyBTZWUgYWxzbzogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2N1c3RvbS1pZGVudApmdW5jdGlvbiBjdXN0b21JZGVudCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IElkZW50KSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbmFtZSA9IHRva2VuLnZhbHVlLnRvTG93ZXJDYXNlKCk7CgogICAgLy8gVGhlIENTUy13aWRlIGtleXdvcmRzIGFyZSBub3QgdmFsaWQgPGN1c3RvbS1pZGVudD5zCiAgICBpZiAoZXFTdHJBbnkobmFtZSwgY3NzV2lkZUtleXdvcmRzKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8vIFRoZSBkZWZhdWx0IGtleXdvcmQgaXMgcmVzZXJ2ZWQgYW5kIGlzIGFsc28gbm90IGEgdmFsaWQgPGN1c3RvbS1pZGVudD4KICAgIGlmIChlcVN0cihuYW1lLCAnZGVmYXVsdCcpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy8gVE9ETzogaWdub3JlIHByb3BlcnR5IHNwZWNpZmljIGtleXdvcmRzIChhcyBkZXNjcmliZWQgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2N1c3RvbS1pZGVudCkKICAgIC8vIFNwZWNpZmljYXRpb25zIHVzaW5nIDxjdXN0b20taWRlbnQ+IG11c3Qgc3BlY2lmeSBjbGVhcmx5IHdoYXQgb3RoZXIga2V5d29yZHMKICAgIC8vIGFyZSBleGNsdWRlZCBmcm9tIDxjdXN0b20taWRlbnQ+LCBpZiBhbnnigJRmb3IgZXhhbXBsZSBieSBzYXlpbmcgdGhhdCBhbnkgcHJlLWRlZmluZWQga2V5d29yZHMKICAgIC8vIGluIHRoYXQgcHJvcGVydHnigJlzIHZhbHVlIGRlZmluaXRpb24gYXJlIGV4Y2x1ZGVkLiBFeGNsdWRlZCBrZXl3b3JkcyBhcmUgZXhjbHVkZWQKICAgIC8vIGluIGFsbCBBU0NJSSBjYXNlIHBlcm11dGF0aW9ucy4KCiAgICByZXR1cm4gMTsKfQoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YXJpYWJsZXMvI3R5cGVkZWYtY3VzdG9tLXByb3BlcnR5LW5hbWUKLy8gQSBjdXN0b20gcHJvcGVydHkgaXMgYW55IHByb3BlcnR5IHdob3NlIG5hbWUgc3RhcnRzIHdpdGggdHdvIGRhc2hlcyAoVSswMDJEIEhZUEhFTi1NSU5VUyksIGxpa2UgLS1mb28uCi8vIFRoZSA8Y3VzdG9tLXByb3BlcnR5LW5hbWU+IHByb2R1Y3Rpb24gY29ycmVzcG9uZHMgdG8gdGhpczogaXTigJlzIGRlZmluZWQgYXMgYW55IHZhbGlkIGlkZW50aWZpZXIKLy8gdGhhdCBzdGFydHMgd2l0aCB0d28gZGFzaGVzLCBleGNlcHQgLS0gaXRzZWxmLCB3aGljaCBpcyByZXNlcnZlZCBmb3IgZnV0dXJlIHVzZSBieSBDU1MuCi8vIE5PVEU6IEN1cnJlbnQgaW1wbGVtZW50YXRpb24gdHJlYXQgYC0tYCBhcyBhIHZhbGlkIG5hbWUgc2luY2UgbW9zdCAoYWxsPykgbWFqb3IgYnJvd3NlcnMgdHJlYXQgaXQgYXMgdmFsaWQuCmZ1bmN0aW9uIGN1c3RvbVByb3BlcnR5TmFtZSh0b2tlbikgewogICAgLy8gLi4uIGRlZmluZWQgYXMgYW55IHZhbGlkIGlkZW50aWZpZXIKICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBJZGVudCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8vIC4uLiB0aGF0IHN0YXJ0cyB3aXRoIHR3byBkYXNoZXMgKFUrMDAyRCBIWVBIRU4tTUlOVVMpCiAgICBpZiAoY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMCkgIT09IDB4MDAyRCB8fCBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAxKSAhPT0gMHgwMDJEKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtY29sb3ItNC8jaGV4LW5vdGF0aW9uCi8vIFRoZSBzeW50YXggb2YgYSA8aGV4LWNvbG9yPiBpcyBhIDxoYXNoLXRva2VuPiB0b2tlbiB3aG9zZSB2YWx1ZSBjb25zaXN0cyBvZiAzLCA0LCA2LCBvciA4IGhleGFkZWNpbWFsIGRpZ2l0cy4KLy8gSW4gb3RoZXIgd29yZHMsIGEgaGV4IGNvbG9yIGlzIHdyaXR0ZW4gYXMgYSBoYXNoIGNoYXJhY3RlciwgIiMiLCBmb2xsb3dlZCBieSBzb21lIG51bWJlciBvZiBkaWdpdHMgMC05IG9yCi8vIGxldHRlcnMgYS1mICh0aGUgY2FzZSBvZiB0aGUgbGV0dGVycyBkb2VzbuKAmXQgbWF0dGVyIC0gIzAwZmYwMCBpcyBpZGVudGljYWwgdG8gIzAwRkYwMCkuCmZ1bmN0aW9uIGhleENvbG9yKHRva2VuKSB7CiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gSGFzaCQxKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbGVuZ3RoID0gdG9rZW4udmFsdWUubGVuZ3RoOwoKICAgIC8vIHZhbGlkIHZhbHVlcyAobGVuZ3RoKTogI3JnYiAoNCksICNyZ2JhICg1KSwgI3JyZ2diYiAoNyksICNycmdnYmJhYSAoOSkKICAgIGlmIChsZW5ndGggIT09IDQgJiYgbGVuZ3RoICE9PSA1ICYmIGxlbmd0aCAhPT0gNyAmJiBsZW5ndGggIT09IDkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNoYXJDb2RlQXQodG9rZW4udmFsdWUsIGkpKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCmZ1bmN0aW9uIGlkU2VsZWN0b3IodG9rZW4pIHsKICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBIYXNoJDEpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBpZiAoIWlzSWRlbnRpZmllclN0YXJ0KGNoYXJDb2RlQXQodG9rZW4udmFsdWUsIDEpLCBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAyKSwgY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMykpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNhbnktdmFsdWUKLy8gSXQgcmVwcmVzZW50cyB0aGUgZW50aXJldHkgb2Ygd2hhdCBhIHZhbGlkIGRlY2xhcmF0aW9uIGNhbiBoYXZlIGFzIGl0cyB2YWx1ZS4KZnVuY3Rpb24gZGVjbGFyYXRpb25WYWx1ZSh0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBpZiAoIXRva2VuKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgbGV0IGJhbGFuY2VDbG9zZVR5cGUgPSAwOwogICAgbGV0IGJhbGFuY2VTdGFzaCA9IFtdOwogICAgbGV0IGxlbmd0aCA9IDA7CgogICAgLy8gVGhlIDxkZWNsYXJhdGlvbi12YWx1ZT4gcHJvZHVjdGlvbiBtYXRjaGVzIGFueSBzZXF1ZW5jZSBvZiBvbmUgb3IgbW9yZSB0b2tlbnMsCiAgICAvLyBzbyBsb25nIGFzIHRoZSBzZXF1ZW5jZSBkb2VzIG5vdCBjb250YWluIC4uLgogICAgc2NhbjoKICAgIGRvIHsKICAgICAgICBzd2l0Y2ggKHRva2VuLnR5cGUpIHsKICAgICAgICAgICAgLy8gLi4uIDxiYWQtc3RyaW5nLXRva2VuPiwgPGJhZC11cmwtdG9rZW4+LAogICAgICAgICAgICBjYXNlIEJhZFN0cmluZzoKICAgICAgICAgICAgY2FzZSBCYWRVcmw6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwoKICAgICAgICAgICAgLy8gLi4uIHVubWF0Y2hlZCA8KS10b2tlbj4sIDxdLXRva2VuPiwgb3IgPH0tdG9rZW4+LAogICAgICAgICAgICBjYXNlIFJpZ2h0Q3VybHlCcmFja2V0OgogICAgICAgICAgICBjYXNlIFJpZ2h0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgUmlnaHRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09IGJhbGFuY2VDbG9zZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlU3Rhc2gucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIC4uLiBvciB0b3AtbGV2ZWwgPHNlbWljb2xvbi10b2tlbj4gdG9rZW5zCiAgICAgICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICAgICAgaWYgKGJhbGFuY2VDbG9zZVR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gLi4uIG9yIDxkZWxpbS10b2tlbj4gdG9rZW5zIHdpdGggYSB2YWx1ZSBvZiAiISIKICAgICAgICAgICAgY2FzZSBEZWxpbToKICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlQ2xvc2VUeXBlID09PSAwICYmIHRva2VuLnZhbHVlID09PSAnIScpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBGdW5jdGlvbiQyOgogICAgICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgY2FzZSBMZWZ0U3F1YXJlQnJhY2tldDoKICAgICAgICAgICAgY2FzZSBMZWZ0Q3VybHlCcmFja2V0OgogICAgICAgICAgICAgICAgYmFsYW5jZVN0YXNoLnB1c2goYmFsYW5jZUNsb3NlVHlwZSk7CiAgICAgICAgICAgICAgICBiYWxhbmNlQ2xvc2VUeXBlID0gYmFsYW5jZVBhaXIuZ2V0KHRva2VuLnR5cGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBsZW5ndGgrKzsKICAgIH0gd2hpbGUgKHRva2VuID0gZ2V0TmV4dFRva2VuKGxlbmd0aCkpOwoKICAgIHJldHVybiBsZW5ndGg7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNhbnktdmFsdWUKLy8gVGhlIDxhbnktdmFsdWU+IHByb2R1Y3Rpb24gaXMgaWRlbnRpY2FsIHRvIDxkZWNsYXJhdGlvbi12YWx1ZT4sIGJ1dCBhbHNvCi8vIGFsbG93cyB0b3AtbGV2ZWwgPHNlbWljb2xvbi10b2tlbj4gdG9rZW5zIGFuZCA8ZGVsaW0tdG9rZW4+IHRva2VucwovLyB3aXRoIGEgdmFsdWUgb2YgIiEiLiBJdCByZXByZXNlbnRzIHRoZSBlbnRpcmV0eSBvZiB3aGF0IHZhbGlkIENTUyBjYW4gYmUgaW4gYW55IGNvbnRleHQuCmZ1bmN0aW9uIGFueVZhbHVlKHRva2VuLCBnZXROZXh0VG9rZW4pIHsKICAgIGlmICghdG9rZW4pIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICBsZXQgYmFsYW5jZVN0YXNoID0gW107CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBUaGUgPGFueS12YWx1ZT4gcHJvZHVjdGlvbiBtYXRjaGVzIGFueSBzZXF1ZW5jZSBvZiBvbmUgb3IgbW9yZSB0b2tlbnMsCiAgICAvLyBzbyBsb25nIGFzIHRoZSBzZXF1ZW5jZSAuLi4KICAgIHNjYW46CiAgICBkbyB7CiAgICAgICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgICAgICAgIC8vIC4uLiBkb2VzIG5vdCBjb250YWluIDxiYWQtc3RyaW5nLXRva2VuPiwgPGJhZC11cmwtdG9rZW4+LAogICAgICAgICAgICBjYXNlIEJhZFN0cmluZzoKICAgICAgICAgICAgY2FzZSBCYWRVcmw6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwoKICAgICAgICAgICAgLy8gLi4uIHVubWF0Y2hlZCA8KS10b2tlbj4sIDxdLXRva2VuPiwgb3IgPH0tdG9rZW4+LAogICAgICAgICAgICBjYXNlIFJpZ2h0Q3VybHlCcmFja2V0OgogICAgICAgICAgICBjYXNlIFJpZ2h0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgUmlnaHRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09IGJhbGFuY2VDbG9zZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlU3Rhc2gucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgRnVuY3Rpb24kMjoKICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgTGVmdFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgIGNhc2UgTGVmdEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFzaC5wdXNoKGJhbGFuY2VDbG9zZVR5cGUpOwogICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VQYWlyLmdldCh0b2tlbi50eXBlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgbGVuZ3RoKys7CiAgICB9IHdoaWxlICh0b2tlbiA9IGdldE5leHRUb2tlbihsZW5ndGgpKTsKCiAgICByZXR1cm4gbGVuZ3RoOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIERpbWVuc2lvbnMKLy8KCmZ1bmN0aW9uIGRpbWVuc2lvbih0eXBlKSB7CiAgICBpZiAodHlwZSkgewogICAgICAgIHR5cGUgPSBuZXcgU2V0KHR5cGUpOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbih0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKSB7CiAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IERpbWVuc2lvbiQxKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQxKHRva2VuLnZhbHVlLCAwKTsKCiAgICAgICAgLy8gY2hlY2sgdW5pdAogICAgICAgIGlmICh0eXBlICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBJRSBwb3N0Zml4IGhhY2ssIGkuZS4gMTIzcHhcMCBvciAxMjNweFw5CiAgICAgICAgICAgIGNvbnN0IHJldmVyc2VTb2xpZHVzT2Zmc2V0ID0gdG9rZW4udmFsdWUuaW5kZXhPZignXFwnLCBudW1iZXJFbmQpOwogICAgICAgICAgICBjb25zdCB1bml0ID0gcmV2ZXJzZVNvbGlkdXNPZmZzZXQgPT09IC0xIHx8ICFpc1Bvc3RmaXhJZUhhY2sodG9rZW4udmFsdWUsIHJldmVyc2VTb2xpZHVzT2Zmc2V0KQogICAgICAgICAgICAgICAgPyB0b2tlbi52YWx1ZS5zdWJzdHIobnVtYmVyRW5kKQogICAgICAgICAgICAgICAgOiB0b2tlbi52YWx1ZS5zdWJzdHJpbmcobnVtYmVyRW5kLCByZXZlcnNlU29saWR1c09mZnNldCk7CgogICAgICAgICAgICBpZiAodHlwZS5oYXModW5pdC50b0xvd2VyQ2FzZSgpKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgICAgICBpZiAob3V0T2ZSYW5nZShvcHRzLCB0b2tlbi52YWx1ZSwgbnVtYmVyRW5kKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiAxOwogICAgfTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQZXJjZW50YWdlCi8vCgovLyDCpzUuNS4gUGVyY2VudGFnZXM6IHRoZSA8cGVyY2VudGFnZT4gdHlwZQovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNwZXJjZW50YWdlcwpmdW5jdGlvbiBwZXJjZW50YWdlKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgIC8vIC4uLiBjb3JyZXNwb25kcyB0byB0aGUgPHBlcmNlbnRhZ2UtdG9rZW4+IHByb2R1Y3Rpb24KICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBQZXJjZW50YWdlJDEpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCB0b2tlbi52YWx1ZS5sZW5ndGggLSAxKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHJldHVybiAxOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIE51bWVyaWMKLy8KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI251bWJlcnMKLy8gVGhlIHZhbHVlIDx6ZXJvPiByZXByZXNlbnRzIGEgbGl0ZXJhbCBudW1iZXIgd2l0aCB0aGUgdmFsdWUgMC4gRXhwcmVzc2lvbnMgdGhhdCBtZXJlbHkKLy8gZXZhbHVhdGUgdG8gYSA8bnVtYmVyPiB3aXRoIHRoZSB2YWx1ZSAwIChmb3IgZXhhbXBsZSwgY2FsYygwKSkgZG8gbm90IG1hdGNoIDx6ZXJvPjsKLy8gb25seSBsaXRlcmFsIDxudW1iZXItdG9rZW4+cyBkby4KZnVuY3Rpb24gemVybyhuZXh0KSB7CiAgICBpZiAodHlwZW9mIG5leHQgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICBuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgICAgICBpZiAodG9rZW4gIT09IG51bGwgJiYgdG9rZW4udHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICAgICAgaWYgKE51bWJlcih0b2tlbi52YWx1ZSkgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV4dCh0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKTsKICAgIH07Cn0KCi8vIMKnIDUuMy4gUmVhbCBOdW1iZXJzOiB0aGUgPG51bWJlcj4gdHlwZQovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNudW1iZXJzCi8vIE51bWJlciB2YWx1ZXMgYXJlIGRlbm90ZWQgYnkgPG51bWJlcj4sIGFuZCByZXByZXNlbnQgcmVhbCBudW1iZXJzLCBwb3NzaWJseSB3aXRoIGEgZnJhY3Rpb25hbCBjb21wb25lbnQuCi8vIC4uLiBJdCBjb3JyZXNwb25kcyB0byB0aGUgPG51bWJlci10b2tlbj4gcHJvZHVjdGlvbgpmdW5jdGlvbiBudW1iZXIodG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQxKHRva2VuLnZhbHVlLCAwKTsKICAgIGNvbnN0IGlzTnVtYmVyID0gbnVtYmVyRW5kID09PSB0b2tlbi52YWx1ZS5sZW5ndGg7CiAgICBpZiAoIWlzTnVtYmVyICYmICFpc1Bvc3RmaXhJZUhhY2sodG9rZW4udmFsdWUsIG51bWJlckVuZCkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCBudW1iZXJFbmQpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIMKnNS4yLiBJbnRlZ2VyczogdGhlIDxpbnRlZ2VyPiB0eXBlCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI2ludGVnZXJzCmZ1bmN0aW9uIGludGVnZXIodG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykgewogICAgLy8gLi4uIGNvcnJlc3BvbmRzIHRvIGEgc3Vic2V0IG9mIHRoZSA8bnVtYmVyLXRva2VuPiBwcm9kdWN0aW9uCiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gTnVtYmVyJDIpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBUaGUgZmlyc3QgZGlnaXQgb2YgYW4gaW50ZWdlciBtYXkgYmUgaW1tZWRpYXRlbHkgcHJlY2VkZWQgYnkgYC1gIG9yIGArYCB0byBpbmRpY2F0ZSB0aGUgaW50ZWdlcuKAmXMgc2lnbi4KICAgIGxldCBpID0gY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMCkgPT09IDB4MDAyQiB8fCAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgICAgICAgICBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAwKSA9PT0gMHgwMDJEID8gMSA6IDA7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCgogICAgLy8gV2hlbiB3cml0dGVuIGxpdGVyYWxseSwgYW4gaW50ZWdlciBpcyBvbmUgb3IgbW9yZSBkZWNpbWFsIGRpZ2l0cyAwIHRocm91Z2ggOSAuLi4KICAgIGZvciAoOyBpIDwgdG9rZW4udmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIWlzRGlnaXQoY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgaSkpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCBpKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHJldHVybiAxOwp9CgovLyB0b2tlbiB0eXBlcwpjb25zdCB0b2tlblR5cGVzID0gewogICAgJ2lkZW50LXRva2VuJzogdG9rZW5UeXBlKElkZW50KSwKICAgICdmdW5jdGlvbi10b2tlbic6IHRva2VuVHlwZShGdW5jdGlvbiQyKSwKICAgICdhdC1rZXl3b3JkLXRva2VuJzogdG9rZW5UeXBlKEF0S2V5d29yZCksCiAgICAnaGFzaC10b2tlbic6IHRva2VuVHlwZShIYXNoJDEpLAogICAgJ3N0cmluZy10b2tlbic6IHRva2VuVHlwZShTdHJpbmckMiksCiAgICAnYmFkLXN0cmluZy10b2tlbic6IHRva2VuVHlwZShCYWRTdHJpbmcpLAogICAgJ3VybC10b2tlbic6IHRva2VuVHlwZShVcmwkMSksCiAgICAnYmFkLXVybC10b2tlbic6IHRva2VuVHlwZShCYWRVcmwpLAogICAgJ2RlbGltLXRva2VuJzogdG9rZW5UeXBlKERlbGltKSwKICAgICdudW1iZXItdG9rZW4nOiB0b2tlblR5cGUoTnVtYmVyJDIpLAogICAgJ3BlcmNlbnRhZ2UtdG9rZW4nOiB0b2tlblR5cGUoUGVyY2VudGFnZSQxKSwKICAgICdkaW1lbnNpb24tdG9rZW4nOiB0b2tlblR5cGUoRGltZW5zaW9uJDEpLAogICAgJ3doaXRlc3BhY2UtdG9rZW4nOiB0b2tlblR5cGUoV2hpdGVTcGFjZSQxKSwKICAgICdDRE8tdG9rZW4nOiB0b2tlblR5cGUoQ0RPJDEpLAogICAgJ0NEQy10b2tlbic6IHRva2VuVHlwZShDREMkMSksCiAgICAnY29sb24tdG9rZW4nOiB0b2tlblR5cGUoQ29sb24pLAogICAgJ3NlbWljb2xvbi10b2tlbic6IHRva2VuVHlwZShTZW1pY29sb24pLAogICAgJ2NvbW1hLXRva2VuJzogdG9rZW5UeXBlKENvbW1hKSwKICAgICdbLXRva2VuJzogdG9rZW5UeXBlKExlZnRTcXVhcmVCcmFja2V0KSwKICAgICddLXRva2VuJzogdG9rZW5UeXBlKFJpZ2h0U3F1YXJlQnJhY2tldCksCiAgICAnKC10b2tlbic6IHRva2VuVHlwZShMZWZ0UGFyZW50aGVzaXMpLAogICAgJyktdG9rZW4nOiB0b2tlblR5cGUoUmlnaHRQYXJlbnRoZXNpcyksCiAgICAney10b2tlbic6IHRva2VuVHlwZShMZWZ0Q3VybHlCcmFja2V0KSwKICAgICd9LXRva2VuJzogdG9rZW5UeXBlKFJpZ2h0Q3VybHlCcmFja2V0KQp9OwoKLy8gdG9rZW4gcHJvZHVjdGlvbiB0eXBlcwpjb25zdCBwcm9kdWN0aW9uVHlwZXMgPSB7CiAgICAvLyB0b2tlbiB0eXBlIGFsaWFzZXMKICAgICdzdHJpbmcnOiB0b2tlblR5cGUoU3RyaW5nJDIpLAogICAgJ2lkZW50JzogdG9rZW5UeXBlKElkZW50KSwKCiAgICAvLyBwZXJjZW50YWdlCiAgICAncGVyY2VudGFnZSc6IGNhbGMocGVyY2VudGFnZSksCgogICAgLy8gbnVtZXJpYwogICAgJ3plcm8nOiB6ZXJvKCksCiAgICAnbnVtYmVyJzogY2FsYyhudW1iZXIpLAogICAgJ2ludGVnZXInOiBjYWxjKGludGVnZXIpLAoKICAgIC8vIGNvbXBsZXggdHlwZXMKICAgICdjdXN0b20taWRlbnQnOiBjdXN0b21JZGVudCwKICAgICdjdXN0b20tcHJvcGVydHktbmFtZSc6IGN1c3RvbVByb3BlcnR5TmFtZSwKICAgICdoZXgtY29sb3InOiBoZXhDb2xvciwKICAgICdpZC1zZWxlY3Rvcic6IGlkU2VsZWN0b3IsIC8vIGVsZW1lbnQoIDxpZC1zZWxlY3Rvcj4gKQogICAgJ2FuLXBsdXMtYic6IGFuUGx1c0IsCiAgICAndXJhbmdlJzogdXJhbmdlLAogICAgJ2RlY2xhcmF0aW9uLXZhbHVlJzogZGVjbGFyYXRpb25WYWx1ZSwKICAgICdhbnktdmFsdWUnOiBhbnlWYWx1ZQp9OwoKLy8gZGltZW5zaW9ucyB0eXBlcyBkZXBlbmQgb24gdW5pdHMgc2V0CmZ1bmN0aW9uIGNyZWF0ZURlbWVuc2lvblR5cGVzKHVuaXRzKSB7CiAgICBjb25zdCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgZGVjaWJlbCwKICAgICAgICBmcmVxdWVuY3ksCiAgICAgICAgZmxleCwKICAgICAgICBsZW5ndGgsCiAgICAgICAgcmVzb2x1dGlvbiwKICAgICAgICBzZW1pdG9uZXMsCiAgICAgICAgdGltZQogICAgfSA9IHVuaXRzIHx8IHt9OwoKICAgIHJldHVybiB7CiAgICAgICAgJ2RpbWVuc2lvbic6IGNhbGMoZGltZW5zaW9uKG51bGwpKSwKICAgICAgICAnYW5nbGUnOiBjYWxjKGRpbWVuc2lvbihhbmdsZSkpLAogICAgICAgICdkZWNpYmVsJzogY2FsYyhkaW1lbnNpb24oZGVjaWJlbCkpLAogICAgICAgICdmcmVxdWVuY3knOiBjYWxjKGRpbWVuc2lvbihmcmVxdWVuY3kpKSwKICAgICAgICAnZmxleCc6IGNhbGMoZGltZW5zaW9uKGZsZXgpKSwKICAgICAgICAnbGVuZ3RoJzogY2FsYyh6ZXJvKGRpbWVuc2lvbihsZW5ndGgpKSksCiAgICAgICAgJ3Jlc29sdXRpb24nOiBjYWxjKGRpbWVuc2lvbihyZXNvbHV0aW9uKSksCiAgICAgICAgJ3NlbWl0b25lcyc6IGNhbGMoZGltZW5zaW9uKHNlbWl0b25lcykpLAogICAgICAgICd0aW1lJzogY2FsYyhkaW1lbnNpb24odGltZSkpCiAgICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVHZW5lcmljVHlwZXModW5pdHMpIHsKICAgIHJldHVybiB7CiAgICAgICAgLi4udG9rZW5UeXBlcywKICAgICAgICAuLi5wcm9kdWN0aW9uVHlwZXMsCiAgICAgICAgLi4uY3JlYXRlRGVtZW5zaW9uVHlwZXModW5pdHMpCiAgICB9Owp9Cgpjb25zdCBsZW5ndGggPSBbCiAgICAvLyBhYnNvbHV0ZSBsZW5ndGggdW5pdHMgaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy12YWx1ZXMtMy8jbGVuZ3RocwogICAgJ2NtJywgJ21tJywgJ3EnLCAnaW4nLCAncHQnLCAncGMnLCAncHgnLAogICAgLy8gZm9udC1yZWxhdGl2ZSBsZW5ndGggdW5pdHMgaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YWx1ZXMtNC8jZm9udC1yZWxhdGl2ZS1sZW5ndGhzCiAgICAnZW0nLCAncmVtJywKICAgICdleCcsICdyZXgnLAogICAgJ2NhcCcsICdyY2FwJywKICAgICdjaCcsICdyY2gnLAogICAgJ2ljJywgJ3JpYycsCiAgICAnbGgnLCAncmxoJywKICAgIC8vIHZpZXdwb3J0LXBlcmNlbnRhZ2UgbGVuZ3RocyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyN2aWV3cG9ydC1yZWxhdGl2ZS1sZW5ndGhzCiAgICAndncnLCAnc3Z3JywgJ2x2dycsICdkdncnLAogICAgJ3ZoJywgJ3N2aCcsICdsdmgnLCAnZHZoJywKICAgICd2aScsICdzdmknLCAnbHZpJywgJ2R2aScsCiAgICAndmInLCAnc3ZiJywgJ2x2YicsICdkdmInLAogICAgJ3ZtaW4nLCAnc3ZtaW4nLCAnbHZtaW4nLCAnZHZtaW4nLAogICAgJ3ZtYXgnLCAnc3ZtYXgnLCAnbHZtYXgnLCAnZHZtYXgnLAogICAgLy8gY29udGFpbmVyIHJlbGF0aXZlIGxlbmd0aHMgaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1jb250YWluLTMvI2NvbnRhaW5lci1sZW5ndGhzCiAgICAnY3F3JywgJ2NxaCcsICdjcWknLCAnY3FiJywgJ2NxbWluJywgJ2NxbWF4JwpdOwpjb25zdCBhbmdsZSA9IFsnZGVnJywgJ2dyYWQnLCAncmFkJywgJ3R1cm4nXTsgICAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy12YWx1ZXMtMy8jYW5nbGVzCmNvbnN0IHRpbWUgPSBbJ3MnLCAnbXMnXTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXZhbHVlcy0zLyN0aW1lCmNvbnN0IGZyZXF1ZW5jeSA9IFsnaHonLCAna2h6J107ICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXZhbHVlcy0zLyNmcmVxdWVuY3kKY29uc3QgcmVzb2x1dGlvbiA9IFsnZHBpJywgJ2RwY20nLCAnZHBweCcsICd4J107IC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTMvI3Jlc29sdXRpb24KY29uc3QgZmxleCA9IFsnZnInXTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtZ3JpZC8jZnItdW5pdApjb25zdCBkZWNpYmVsID0gWydkYiddOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2NzczMtc3BlZWNoLyNtaXhpbmctcHJvcHMtdm9pY2Utdm9sdW1lCmNvbnN0IHNlbWl0b25lcyA9IFsnc3QnXTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzMy1zcGVlY2gvI3ZvaWNlLXByb3BzLXZvaWNlLXBpdGNoCgpjb25zdCB1bml0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgYW5nbGUsCiAgICBkZWNpYmVsLAogICAgZmxleCwKICAgIGZyZXF1ZW5jeSwKICAgIGxlbmd0aCwKICAgIHJlc29sdXRpb24sCiAgICBzZW1pdG9uZXMsCiAgICB0aW1lCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKZnVuY3Rpb24gU3ludGF4RXJyb3IkMShtZXNzYWdlLCBpbnB1dCwgb2Zmc2V0KSB7CiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihjcmVhdGVDdXN0b21FcnJvcignU3ludGF4RXJyb3InLCBtZXNzYWdlKSwgewogICAgICAgIGlucHV0LAogICAgICAgIG9mZnNldCwKICAgICAgICByYXdNZXNzYWdlOiBtZXNzYWdlLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgKyAnXG4nICsKICAgICAgICAgICAgJyAgJyArIGlucHV0ICsgJ1xuJyArCiAgICAgICAgICAgICctLScgKyBuZXcgQXJyYXkoKG9mZnNldCB8fCBpbnB1dC5sZW5ndGgpICsgMSkuam9pbignLScpICsgJ14nCiAgICB9KTsKfQoKY29uc3QgVEFCJDEgPSA5Owpjb25zdCBOJDIgPSAxMDsKY29uc3QgRiQxID0gMTI7CmNvbnN0IFIkMSA9IDEzOwpjb25zdCBTUEFDRSQzID0gMzI7CgpjbGFzcyBUb2tlbml6ZXIgewogICAgY29uc3RydWN0b3Ioc3RyKSB7CiAgICAgICAgdGhpcy5zdHIgPSBzdHI7CiAgICAgICAgdGhpcy5wb3MgPSAwOwogICAgfQogICAgY2hhckNvZGVBdChwb3MpIHsKICAgICAgICByZXR1cm4gcG9zIDwgdGhpcy5zdHIubGVuZ3RoID8gdGhpcy5zdHIuY2hhckNvZGVBdChwb3MpIDogMDsKICAgIH0KICAgIGNoYXJDb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNoYXJDb2RlQXQodGhpcy5wb3MpOwogICAgfQogICAgbmV4dENoYXJDb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTsKICAgIH0KICAgIG5leHROb25Xc0NvZGUocG9zKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2hhckNvZGVBdCh0aGlzLmZpbmRXc0VuZChwb3MpKTsKICAgIH0KICAgIGZpbmRXc0VuZChwb3MpIHsKICAgICAgICBmb3IgKDsgcG9zIDwgdGhpcy5zdHIubGVuZ3RoOyBwb3MrKykgewogICAgICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5zdHIuY2hhckNvZGVBdChwb3MpOwogICAgICAgICAgICBpZiAoY29kZSAhPT0gUiQxICYmIGNvZGUgIT09IE4kMiAmJiBjb2RlICE9PSBGJDEgJiYgY29kZSAhPT0gU1BBQ0UkMyAmJiBjb2RlICE9PSBUQUIkMSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBwb3M7CiAgICB9CiAgICBzdWJzdHJpbmdUb1BvcyhlbmQpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHIuc3Vic3RyaW5nKHRoaXMucG9zLCB0aGlzLnBvcyA9IGVuZCk7CiAgICB9CiAgICBlYXQoY29kZSkgewogICAgICAgIGlmICh0aGlzLmNoYXJDb2RlKCkgIT09IGNvZGUpIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignRXhwZWN0IGAnICsgU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSArICdgJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBvcysrOwogICAgfQogICAgcGVlaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5wb3MgPCB0aGlzLnN0ci5sZW5ndGggPyB0aGlzLnN0ci5jaGFyQXQodGhpcy5wb3MrKykgOiAnJzsKICAgIH0KICAgIGVycm9yKG1lc3NhZ2UpIHsKICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IkMShtZXNzYWdlLCB0aGlzLnN0ciwgdGhpcy5wb3MpOwogICAgfQp9Cgpjb25zdCBUQUIgPSA5Owpjb25zdCBOJDEgPSAxMDsKY29uc3QgRiA9IDEyOwpjb25zdCBSID0gMTM7CmNvbnN0IFNQQUNFJDIgPSAzMjsKY29uc3QgRVhDTEFNQVRJT05NQVJLJDIgPSAzMzsgICAgLy8gIQpjb25zdCBOVU1CRVJTSUdOJDMgPSAzNTsgICAgICAgICAvLyAjCmNvbnN0IEFNUEVSU0FORCQ1ID0gMzg7ICAgICAgICAgIC8vICYKY29uc3QgQVBPU1RST1BIRSQyID0gMzk7ICAgICAgICAgLy8gJwpjb25zdCBMRUZUUEFSRU5USEVTSVMkMiA9IDQwOyAgICAvLyAoCmNvbnN0IFJJR0hUUEFSRU5USEVTSVMkMiA9IDQxOyAgIC8vICkKY29uc3QgQVNURVJJU0skNiA9IDQyOyAgICAgICAgICAgLy8gKgpjb25zdCBQTFVTU0lHTiQ2ID0gNDM7ICAgICAgICAgICAvLyArCmNvbnN0IENPTU1BID0gNDQ7ICAgICAgICAgICAgICAvLyAsCmNvbnN0IEhZUEVSTUlOVVMgPSA0NTsgICAgICAgICAvLyAtCmNvbnN0IExFU1NUSEFOU0lHTiA9IDYwOyAgICAgICAvLyA8CmNvbnN0IEdSRUFURVJUSEFOU0lHTiQyID0gNjI7ICAgIC8vID4KY29uc3QgUVVFU1RJT05NQVJLJDEgPSA2MzsgICAgICAgLy8gPwpjb25zdCBDT01NRVJDSUFMQVQgPSA2NDsgICAgICAgLy8gQApjb25zdCBMRUZUU1FVQVJFQlJBQ0tFVCA9IDkxOyAgLy8gWwpjb25zdCBSSUdIVFNRVUFSRUJSQUNLRVQgPSA5MzsgLy8gXQpjb25zdCBMRUZUQ1VSTFlCUkFDS0VUID0gMTIzOyAgLy8gewpjb25zdCBWRVJUSUNBTExJTkUkMyA9IDEyNDsgICAgICAvLyB8CmNvbnN0IFJJR0hUQ1VSTFlCUkFDS0VUID0gMTI1OyAvLyB9CmNvbnN0IElORklOSVRZID0gODczNDsgICAgICAgICAvLyDiiJ4KY29uc3QgTkFNRV9DSEFSID0gbmV3IFVpbnQ4QXJyYXkoMTI4KS5tYXAoKF8sIGlkeCkgPT4KICAgIC9bYS16QS1aMC05XC1dLy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoaWR4KSkgPyAxIDogMAopOwpjb25zdCBDT01CSU5BVE9SX1BSRUNFREVOQ0UgPSB7CiAgICAnICc6IDEsCiAgICAnJiYnOiAyLAogICAgJ3x8JzogMywKICAgICd8JzogNAp9OwoKZnVuY3Rpb24gc2NhblNwYWNlcyh0b2tlbml6ZXIpIHsKICAgIHJldHVybiB0b2tlbml6ZXIuc3Vic3RyaW5nVG9Qb3MoCiAgICAgICAgdG9rZW5pemVyLmZpbmRXc0VuZCh0b2tlbml6ZXIucG9zKQogICAgKTsKfQoKZnVuY3Rpb24gc2NhbldvcmQodG9rZW5pemVyKSB7CiAgICBsZXQgZW5kID0gdG9rZW5pemVyLnBvczsKCiAgICBmb3IgKDsgZW5kIDwgdG9rZW5pemVyLnN0ci5sZW5ndGg7IGVuZCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuaXplci5zdHIuY2hhckNvZGVBdChlbmQpOwogICAgICAgIGlmIChjb2RlID49IDEyOCB8fCBOQU1FX0NIQVJbY29kZV0gPT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0b2tlbml6ZXIucG9zID09PSBlbmQpIHsKICAgICAgICB0b2tlbml6ZXIuZXJyb3IoJ0V4cGVjdCBhIGtleXdvcmQnKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCk7Cn0KCmZ1bmN0aW9uIHNjYW5OdW1iZXIodG9rZW5pemVyKSB7CiAgICBsZXQgZW5kID0gdG9rZW5pemVyLnBvczsKCiAgICBmb3IgKDsgZW5kIDwgdG9rZW5pemVyLnN0ci5sZW5ndGg7IGVuZCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuaXplci5zdHIuY2hhckNvZGVBdChlbmQpOwogICAgICAgIGlmIChjb2RlIDwgNDggfHwgY29kZSA+IDU3KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAodG9rZW5pemVyLnBvcyA9PT0gZW5kKSB7CiAgICAgICAgdG9rZW5pemVyLmVycm9yKCdFeHBlY3QgYSBudW1iZXInKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCk7Cn0KCmZ1bmN0aW9uIHNjYW5TdHJpbmcodG9rZW5pemVyKSB7CiAgICBjb25zdCBlbmQgPSB0b2tlbml6ZXIuc3RyLmluZGV4T2YoJ1wnJywgdG9rZW5pemVyLnBvcyArIDEpOwoKICAgIGlmIChlbmQgPT09IC0xKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcyA9IHRva2VuaXplci5zdHIubGVuZ3RoOwogICAgICAgIHRva2VuaXplci5lcnJvcignRXhwZWN0IGFuIGFwb3N0cm9waGUnKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCArIDEpOwp9CgpmdW5jdGlvbiByZWFkTXVsdGlwbGllclJhbmdlKHRva2VuaXplcikgewogICAgbGV0IG1pbiA9IG51bGw7CiAgICBsZXQgbWF4ID0gbnVsbDsKCiAgICB0b2tlbml6ZXIuZWF0KExFRlRDVVJMWUJSQUNLRVQpOwoKICAgIG1pbiA9IHNjYW5OdW1iZXIodG9rZW5pemVyKTsKCiAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IENPTU1BKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSAhPT0gUklHSFRDVVJMWUJSQUNLRVQpIHsKICAgICAgICAgICAgbWF4ID0gc2Nhbk51bWJlcih0b2tlbml6ZXIpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgbWF4ID0gbWluOwogICAgfQoKICAgIHRva2VuaXplci5lYXQoUklHSFRDVVJMWUJSQUNLRVQpOwoKICAgIHJldHVybiB7CiAgICAgICAgbWluOiBOdW1iZXIobWluKSwKICAgICAgICBtYXg6IG1heCA/IE51bWJlcihtYXgpIDogMAogICAgfTsKfQoKZnVuY3Rpb24gcmVhZE11bHRpcGxpZXIodG9rZW5pemVyKSB7CiAgICBsZXQgcmFuZ2UgPSBudWxsOwogICAgbGV0IGNvbW1hID0gZmFsc2U7CgogICAgc3dpdGNoICh0b2tlbml6ZXIuY2hhckNvZGUoKSkgewogICAgICAgIGNhc2UgQVNURVJJU0skNjoKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICBtYXg6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFBMVVNTSUdOJDY6CiAgICAgICAgICAgIHRva2VuaXplci5wb3MrKzsKCiAgICAgICAgICAgIHJhbmdlID0gewogICAgICAgICAgICAgICAgbWluOiAxLAogICAgICAgICAgICAgICAgbWF4OiAwCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBRVUVTVElPTk1BUkskMToKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICBtYXg6IDEKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIE5VTUJFUlNJR04kMzoKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgY29tbWEgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBMRUZUQ1VSTFlCUkFDS0VUKSB7CiAgICAgICAgICAgICAgICByYW5nZSA9IHJlYWRNdWx0aXBsaWVyUmFuZ2UodG9rZW5pemVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gUVVFU1RJT05NQVJLJDEpIHsKICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTQvI2NvbXBvbmVudC1tdWx0aXBsaWVycwogICAgICAgICAgICAgICAgLy8gPiB0aGUgIyBhbmQgPyBtdWx0aXBsaWVycyBtYXkgYmUgc3RhY2tlZCBhcyAjPwogICAgICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlIGp1c3QgdHJlYXQgIiM/IiBhcyBhIHNpbmdsZSBtdWx0aXBsaWVyCiAgICAgICAgICAgICAgICAvLyB7IG1pbjogMCwgbWF4OiAwLCBjb21tYTogdHJ1ZSB9CiAgICAgICAgICAgICAgICB0b2tlbml6ZXIucG9zKys7CiAgICAgICAgICAgICAgICByYW5nZSA9IHsKICAgICAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICAgICAgbWF4OiAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgbWluOiAxLAogICAgICAgICAgICAgICAgICAgIG1heDogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTEVGVENVUkxZQlJBQ0tFVDoKICAgICAgICAgICAgcmFuZ2UgPSByZWFkTXVsdGlwbGllclJhbmdlKHRva2VuaXplcik7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdNdWx0aXBsaWVyJywKICAgICAgICBjb21tYSwKICAgICAgICBtaW46IHJhbmdlLm1pbiwKICAgICAgICBtYXg6IHJhbmdlLm1heCwKICAgICAgICB0ZXJtOiBudWxsCiAgICB9Owp9CgpmdW5jdGlvbiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCBub2RlKSB7CiAgICBjb25zdCBtdWx0aXBsaWVyID0gcmVhZE11bHRpcGxpZXIodG9rZW5pemVyKTsKCiAgICBpZiAobXVsdGlwbGllciAhPT0gbnVsbCkgewogICAgICAgIG11bHRpcGxpZXIudGVybSA9IG5vZGU7CgogICAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTQvI2NvbXBvbmVudC1tdWx0aXBsaWVycwogICAgICAgIC8vID4gVGhlICsgYW5kICMgbXVsdGlwbGllcnMgbWF5IGJlIHN0YWNrZWQgYXMgKyM7CiAgICAgICAgLy8gUmVwcmVzZW50ICIrIyIgYXMgbmVzdGVkIG11bHRpcGxpZXJzOgogICAgICAgIC8vIHsgLi4uPG11bHRpcGxpZXIgIz4sCiAgICAgICAgLy8gICB0ZXJtOiB7CiAgICAgICAgLy8gICAgIC4uLjxtdWx0aXBsZXIgKz4sCiAgICAgICAgLy8gICAgIHRlcm06IG5vZGUKICAgICAgICAvLyAgIH0KICAgICAgICAvLyB9CiAgICAgICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBOVU1CRVJTSUdOJDMgJiYKICAgICAgICAgICAgdG9rZW5pemVyLmNoYXJDb2RlQXQodG9rZW5pemVyLnBvcyAtIDEpID09PSBQTFVTU0lHTiQ2KSB7CiAgICAgICAgICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCBtdWx0aXBsaWVyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtdWx0aXBsaWVyOwogICAgfQoKICAgIHJldHVybiBub2RlOwp9CgpmdW5jdGlvbiBtYXliZVRva2VuKHRva2VuaXplcikgewogICAgY29uc3QgY2ggPSB0b2tlbml6ZXIucGVlaygpOwoKICAgIGlmIChjaCA9PT0gJycpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdUb2tlbicsCiAgICAgICAgdmFsdWU6IGNoCiAgICB9Owp9CgpmdW5jdGlvbiByZWFkUHJvcGVydHkkMSh0b2tlbml6ZXIpIHsKICAgIGxldCBuYW1lOwoKICAgIHRva2VuaXplci5lYXQoTEVTU1RIQU5TSUdOKTsKICAgIHRva2VuaXplci5lYXQoQVBPU1RST1BIRSQyKTsKCiAgICBuYW1lID0gc2NhbldvcmQodG9rZW5pemVyKTsKCiAgICB0b2tlbml6ZXIuZWF0KEFQT1NUUk9QSEUkMik7CiAgICB0b2tlbml6ZXIuZWF0KEdSRUFURVJUSEFOU0lHTiQyKTsKCiAgICByZXR1cm4gbWF5YmVNdWx0aXBsaWVkKHRva2VuaXplciwgewogICAgICAgIHR5cGU6ICdQcm9wZXJ0eScsCiAgICAgICAgbmFtZQogICAgfSk7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTMvI251bWVyaWMtcmFuZ2VzCi8vIDQuMS4gUmFuZ2UgUmVzdHJpY3Rpb25zIGFuZCBSYW5nZSBEZWZpbml0aW9uIE5vdGF0aW9uCi8vCi8vIFJhbmdlIHJlc3RyaWN0aW9ucyBjYW4gYmUgYW5ub3RhdGVkIGluIHRoZSBudW1lcmljIHR5cGUgbm90YXRpb24gdXNpbmcgQ1NTIGJyYWNrZXRlZAovLyByYW5nZSBub3RhdGlvbuKAlFttaW4sbWF4XeKAlHdpdGhpbiB0aGUgYW5nbGUgYnJhY2tldHMsIGFmdGVyIHRoZSBpZGVudGlmeWluZyBrZXl3b3JkLAovLyBpbmRpY2F0aW5nIGEgY2xvc2VkIHJhbmdlIGJldHdlZW4gKGFuZCBpbmNsdWRpbmcpIG1pbiBhbmQgbWF4LgovLyBGb3IgZXhhbXBsZSwgPGludGVnZXIgWzAsIDEwXT4gaW5kaWNhdGVzIGFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMCwgaW5jbHVzaXZlLgpmdW5jdGlvbiByZWFkVHlwZVJhbmdlKHRva2VuaXplcikgewogICAgLy8gdXNlIG51bGwgZm9yIEluZmluaXR5IHRvIG1ha2UgQVNUIGZvcm1hdCBKU09OIHNlcmlhbGl6YWJsZS9kZXNlcmlhbGl6YWJsZQogICAgbGV0IG1pbiA9IG51bGw7IC8vIC1JbmZpbml0eQogICAgbGV0IG1heCA9IG51bGw7IC8vIEluZmluaXR5CiAgICBsZXQgc2lnbiA9IDE7CgogICAgdG9rZW5pemVyLmVhdChMRUZUU1FVQVJFQlJBQ0tFVCk7CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBIWVBFUk1JTlVTKSB7CiAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgICAgICBzaWduID0gLTE7CiAgICB9CgogICAgaWYgKHNpZ24gPT0gLTEgJiYgdG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IElORklOSVRZKSB7CiAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbWluID0gc2lnbiAqIE51bWJlcihzY2FuTnVtYmVyKHRva2VuaXplcikpOwoKICAgICAgICBpZiAoTkFNRV9DSEFSW3Rva2VuaXplci5jaGFyQ29kZSgpXSAhPT0gMCkgewogICAgICAgICAgICBtaW4gKz0gc2NhbldvcmQodG9rZW5pemVyKTsKICAgICAgICB9CiAgICB9CgogICAgc2NhblNwYWNlcyh0b2tlbml6ZXIpOwogICAgdG9rZW5pemVyLmVhdChDT01NQSk7CiAgICBzY2FuU3BhY2VzKHRva2VuaXplcik7CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBJTkZJTklUWSkgewogICAgICAgIHRva2VuaXplci5wZWVrKCk7CiAgICB9IGVsc2UgewogICAgICAgIHNpZ24gPSAxOwoKICAgICAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IEhZUEVSTUlOVVMpIHsKICAgICAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgICAgICAgICAgc2lnbiA9IC0xOwogICAgICAgIH0KCiAgICAgICAgbWF4ID0gc2lnbiAqIE51bWJlcihzY2FuTnVtYmVyKHRva2VuaXplcikpOwoKICAgICAgICBpZiAoTkFNRV9DSEFSW3Rva2VuaXplci5jaGFyQ29kZSgpXSAhPT0gMCkgewogICAgICAgICAgICBtYXggKz0gc2NhbldvcmQodG9rZW5pemVyKTsKICAgICAgICB9CiAgICB9CgogICAgdG9rZW5pemVyLmVhdChSSUdIVFNRVUFSRUJSQUNLRVQpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1JhbmdlJywKICAgICAgICBtaW4sCiAgICAgICAgbWF4CiAgICB9Owp9CgpmdW5jdGlvbiByZWFkVHlwZSh0b2tlbml6ZXIpIHsKICAgIGxldCBuYW1lOwogICAgbGV0IG9wdHMgPSBudWxsOwoKICAgIHRva2VuaXplci5lYXQoTEVTU1RIQU5TSUdOKTsKICAgIG5hbWUgPSBzY2FuV29yZCh0b2tlbml6ZXIpOwoKICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDIgJiYKICAgICAgICB0b2tlbml6ZXIubmV4dENoYXJDb2RlKCkgPT09IFJJR0hUUEFSRU5USEVTSVMkMikgewogICAgICAgIHRva2VuaXplci5wb3MgKz0gMjsKICAgICAgICBuYW1lICs9ICcoKSc7CiAgICB9CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZUF0KHRva2VuaXplci5maW5kV3NFbmQodG9rZW5pemVyLnBvcykpID09PSBMRUZUU1FVQVJFQlJBQ0tFVCkgewogICAgICAgIHNjYW5TcGFjZXModG9rZW5pemVyKTsKICAgICAgICBvcHRzID0gcmVhZFR5cGVSYW5nZSh0b2tlbml6ZXIpOwogICAgfQoKICAgIHRva2VuaXplci5lYXQoR1JFQVRFUlRIQU5TSUdOJDIpOwoKICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCB7CiAgICAgICAgdHlwZTogJ1R5cGUnLAogICAgICAgIG5hbWUsCiAgICAgICAgb3B0cwogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlYWRLZXl3b3JkT3JGdW5jdGlvbih0b2tlbml6ZXIpIHsKICAgIGNvbnN0IG5hbWUgPSBzY2FuV29yZCh0b2tlbml6ZXIpOwoKICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDIpIHsKICAgICAgICB0b2tlbml6ZXIucG9zKys7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICdGdW5jdGlvbicsCiAgICAgICAgICAgIG5hbWUKICAgICAgICB9OwogICAgfQoKICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCB7CiAgICAgICAgdHlwZTogJ0tleXdvcmQnLAogICAgICAgIG5hbWUKICAgIH0pOwp9CgpmdW5jdGlvbiByZWdyb3VwVGVybXModGVybXMsIGNvbWJpbmF0b3JzKSB7CiAgICBmdW5jdGlvbiBjcmVhdGVHcm91cCh0ZXJtcywgY29tYmluYXRvcikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICdHcm91cCcsCiAgICAgICAgICAgIHRlcm1zLAogICAgICAgICAgICBjb21iaW5hdG9yLAogICAgICAgICAgICBkaXNhbGxvd0VtcHR5OiBmYWxzZSwKICAgICAgICAgICAgZXhwbGljaXQ6IGZhbHNlCiAgICAgICAgfTsKICAgIH0KCiAgICBsZXQgY29tYmluYXRvcjsKCiAgICBjb21iaW5hdG9ycyA9IE9iamVjdC5rZXlzKGNvbWJpbmF0b3JzKQogICAgICAgIC5zb3J0KChhLCBiKSA9PiBDT01CSU5BVE9SX1BSRUNFREVOQ0VbYV0gLSBDT01CSU5BVE9SX1BSRUNFREVOQ0VbYl0pOwoKICAgIHdoaWxlIChjb21iaW5hdG9ycy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29tYmluYXRvciA9IGNvbWJpbmF0b3JzLnNoaWZ0KCk7CgogICAgICAgIGxldCBpID0gMDsKICAgICAgICBsZXQgc3ViZ3JvdXBTdGFydCA9IDA7CgogICAgICAgIGZvciAoOyBpIDwgdGVybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwoKICAgICAgICAgICAgaWYgKHRlcm0udHlwZSA9PT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgICAgICAgICBpZiAodGVybS52YWx1ZSA9PT0gY29tYmluYXRvcikgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWJncm91cFN0YXJ0ID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJncm91cFN0YXJ0ID0gaSAtIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRlcm1zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWJncm91cFN0YXJ0ICE9PSAtMSAmJiBpIC0gc3ViZ3JvdXBTdGFydCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVybXMuc3BsaWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViZ3JvdXBTdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLSBzdWJncm91cFN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlR3JvdXAodGVybXMuc2xpY2Uoc3ViZ3JvdXBTdGFydCwgaSksIGNvbWJpbmF0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBzdWJncm91cFN0YXJ0ICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3ViZ3JvdXBTdGFydCA9IC0xOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZ3JvdXBTdGFydCAhPT0gLTEgJiYgY29tYmluYXRvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRlcm1zLnNwbGljZSgKICAgICAgICAgICAgICAgIHN1Ymdyb3VwU3RhcnQsCiAgICAgICAgICAgICAgICBpIC0gc3ViZ3JvdXBTdGFydCwKICAgICAgICAgICAgICAgIGNyZWF0ZUdyb3VwKHRlcm1zLnNsaWNlKHN1Ymdyb3VwU3RhcnQsIGkpLCBjb21iaW5hdG9yKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY29tYmluYXRvcjsKfQoKZnVuY3Rpb24gcmVhZEltcGxpY2l0R3JvdXAodG9rZW5pemVyKSB7CiAgICBjb25zdCB0ZXJtcyA9IFtdOwogICAgY29uc3QgY29tYmluYXRvcnMgPSB7fTsKICAgIGxldCB0b2tlbjsKICAgIGxldCBwcmV2VG9rZW4gPSBudWxsOwogICAgbGV0IHByZXZUb2tlblBvcyA9IHRva2VuaXplci5wb3M7CgogICAgd2hpbGUgKHRva2VuID0gcGVlayh0b2tlbml6ZXIpKSB7CiAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09ICdTcGFjZXMnKSB7CiAgICAgICAgICAgIGlmICh0b2tlbi50eXBlID09PSAnQ29tYmluYXRvcicpIHsKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBjb21iaW5hdG9yIGluIGdyb3VwIGJlZ2lubmluZyBhbmQgZG91YmxlIGNvbWJpbmF0b3Igc2VxdWVuY2UKICAgICAgICAgICAgICAgIGlmIChwcmV2VG9rZW4gPT09IG51bGwgfHwgcHJldlRva2VuLnR5cGUgPT09ICdDb21iaW5hdG9yJykgewogICAgICAgICAgICAgICAgICAgIHRva2VuaXplci5wb3MgPSBwcmV2VG9rZW5Qb3M7CiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyLmVycm9yKCdVbmV4cGVjdGVkIGNvbWJpbmF0b3InKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb21iaW5hdG9yc1t0b2tlbi52YWx1ZV0gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHByZXZUb2tlbiAhPT0gbnVsbCAmJiBwcmV2VG9rZW4udHlwZSAhPT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgICAgICAgICBjb21iaW5hdG9yc1snICddID0gdHJ1ZTsgIC8vIGEgYgogICAgICAgICAgICAgICAgdGVybXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0NvbWJpbmF0b3InLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnICcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0ZXJtcy5wdXNoKHRva2VuKTsKICAgICAgICAgICAgcHJldlRva2VuID0gdG9rZW47CiAgICAgICAgICAgIHByZXZUb2tlblBvcyA9IHRva2VuaXplci5wb3M7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGZvciBjb21iaW5hdG9yIGluIGdyb3VwIGVuZGluZwogICAgaWYgKHByZXZUb2tlbiAhPT0gbnVsbCAmJiBwcmV2VG9rZW4udHlwZSA9PT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcyAtPSBwcmV2VG9rZW5Qb3M7CiAgICAgICAgdG9rZW5pemVyLmVycm9yKCdVbmV4cGVjdGVkIGNvbWJpbmF0b3InKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdHcm91cCcsCiAgICAgICAgdGVybXMsCiAgICAgICAgY29tYmluYXRvcjogcmVncm91cFRlcm1zKHRlcm1zLCBjb21iaW5hdG9ycykgfHwgJyAnLAogICAgICAgIGRpc2FsbG93RW1wdHk6IGZhbHNlLAogICAgICAgIGV4cGxpY2l0OiBmYWxzZQogICAgfTsKfQoKZnVuY3Rpb24gcmVhZEdyb3VwKHRva2VuaXplcikgewogICAgbGV0IHJlc3VsdDsKCiAgICB0b2tlbml6ZXIuZWF0KExFRlRTUVVBUkVCUkFDS0VUKTsKICAgIHJlc3VsdCA9IHJlYWRJbXBsaWNpdEdyb3VwKHRva2VuaXplcik7CiAgICB0b2tlbml6ZXIuZWF0KFJJR0hUU1FVQVJFQlJBQ0tFVCk7CgogICAgcmVzdWx0LmV4cGxpY2l0ID0gdHJ1ZTsKCiAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IEVYQ0xBTUFUSU9OTUFSSyQyKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgIHJlc3VsdC5kaXNhbGxvd0VtcHR5ID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBwZWVrKHRva2VuaXplcikgewogICAgbGV0IGNvZGUgPSB0b2tlbml6ZXIuY2hhckNvZGUoKTsKCiAgICBpZiAoY29kZSA8IDEyOCAmJiBOQU1FX0NIQVJbY29kZV0gPT09IDEpIHsKICAgICAgICByZXR1cm4gcmVhZEtleXdvcmRPckZ1bmN0aW9uKHRva2VuaXplcik7CiAgICB9CgogICAgc3dpdGNoIChjb2RlKSB7CiAgICAgICAgY2FzZSBSSUdIVFNRVUFSRUJSQUNLRVQ6CiAgICAgICAgICAgIC8vIGRvbid0IGVhdCwgc3RvcCBzY2FuIGEgZ3JvdXAKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTEVGVFNRVUFSRUJSQUNLRVQ6CiAgICAgICAgICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCByZWFkR3JvdXAodG9rZW5pemVyKSk7CgogICAgICAgIGNhc2UgTEVTU1RIQU5TSUdOOgogICAgICAgICAgICByZXR1cm4gdG9rZW5pemVyLm5leHRDaGFyQ29kZSgpID09PSBBUE9TVFJPUEhFJDIKICAgICAgICAgICAgICAgID8gcmVhZFByb3BlcnR5JDEodG9rZW5pemVyKQogICAgICAgICAgICAgICAgOiByZWFkVHlwZSh0b2tlbml6ZXIpOwoKICAgICAgICBjYXNlIFZFUlRJQ0FMTElORSQzOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdHlwZTogJ0NvbWJpbmF0b3InLAogICAgICAgICAgICAgICAgdmFsdWU6IHRva2VuaXplci5zdWJzdHJpbmdUb1BvcygKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIucG9zICsgKHRva2VuaXplci5uZXh0Q2hhckNvZGUoKSA9PT0gVkVSVElDQUxMSU5FJDMgPyAyIDogMSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfTsKCiAgICAgICAgY2FzZSBBTVBFUlNBTkQkNToKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgICAgICB0b2tlbml6ZXIuZWF0KEFNUEVSU0FORCQ1KTsKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnQ29tYmluYXRvcicsCiAgICAgICAgICAgICAgICB2YWx1ZTogJyYmJwogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlIENPTU1BOgogICAgICAgICAgICB0b2tlbml6ZXIucG9zKys7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnQ29tbWEnCiAgICAgICAgICAgIH07CgogICAgICAgIGNhc2UgQVBPU1RST1BIRSQyOgogICAgICAgICAgICByZXR1cm4gbWF5YmVNdWx0aXBsaWVkKHRva2VuaXplciwgewogICAgICAgICAgICAgICAgdHlwZTogJ1N0cmluZycsCiAgICAgICAgICAgICAgICB2YWx1ZTogc2NhblN0cmluZyh0b2tlbml6ZXIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlIFNQQUNFJDI6CiAgICAgICAgY2FzZSBUQUI6CiAgICAgICAgY2FzZSBOJDE6CiAgICAgICAgY2FzZSBSOgogICAgICAgIGNhc2UgRjoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6ICdTcGFjZXMnLAogICAgICAgICAgICAgICAgdmFsdWU6IHNjYW5TcGFjZXModG9rZW5pemVyKQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlIENPTU1FUkNJQUxBVDoKICAgICAgICAgICAgY29kZSA9IHRva2VuaXplci5uZXh0Q2hhckNvZGUoKTsKCiAgICAgICAgICAgIGlmIChjb2RlIDwgMTI4ICYmIE5BTUVfQ0hBUltjb2RlXSA9PT0gMSkgewogICAgICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXRLZXl3b3JkJywKICAgICAgICAgICAgICAgICAgICBuYW1lOiBzY2FuV29yZCh0b2tlbml6ZXIpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbWF5YmVUb2tlbih0b2tlbml6ZXIpOwoKICAgICAgICBjYXNlIEFTVEVSSVNLJDY6CiAgICAgICAgY2FzZSBQTFVTU0lHTiQ2OgogICAgICAgIGNhc2UgUVVFU1RJT05NQVJLJDE6CiAgICAgICAgY2FzZSBOVU1CRVJTSUdOJDM6CiAgICAgICAgY2FzZSBFWENMQU1BVElPTk1BUkskMjoKICAgICAgICAgICAgLy8gcHJvaGliaXRlZCB0b2tlbnMgKHVzZWQgYXMgYSBtdWx0aXBsaWVyIHN0YXJ0KQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBMRUZUQ1VSTFlCUkFDS0VUOgogICAgICAgICAgICAvLyBMRUZUQ1VSTFlCUkFDS0VUIGlzIGFsbG93ZWQgc2luY2UgbWRuL2RhdGEgdXNlcyBpdCB3L28gcXVvdGluZwogICAgICAgICAgICAvLyBjaGVjayBuZXh0IGNoYXIgaXNuJ3QgYSBudW1iZXIsIGJlY2F1c2UgaXQncyBsaWtlbHkgYSBkaXNqb2luZWQgbXVsdGlwbGllcgogICAgICAgICAgICBjb2RlID0gdG9rZW5pemVyLm5leHRDaGFyQ29kZSgpOwoKICAgICAgICAgICAgaWYgKGNvZGUgPCA0OCB8fCBjb2RlID4gNTcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXliZVRva2VuKHRva2VuaXplcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbWF5YmVUb2tlbih0b2tlbml6ZXIpOwogICAgfQp9CgpmdW5jdGlvbiBwYXJzZSRHKHNvdXJjZSkgewogICAgY29uc3QgdG9rZW5pemVyID0gbmV3IFRva2VuaXplcihzb3VyY2UpOwogICAgY29uc3QgcmVzdWx0ID0gcmVhZEltcGxpY2l0R3JvdXAodG9rZW5pemVyKTsKCiAgICBpZiAodG9rZW5pemVyLnBvcyAhPT0gc291cmNlLmxlbmd0aCkgewogICAgICAgIHRva2VuaXplci5lcnJvcignVW5leHBlY3RlZCBpbnB1dCcpOwogICAgfQoKICAgIC8vIHJlZHVjZSByZWR1bmRhbnQgZ3JvdXBzIHdpdGggc2luZ2xlIGdyb3VwIHRlcm0KICAgIGlmIChyZXN1bHQudGVybXMubGVuZ3RoID09PSAxICYmIHJlc3VsdC50ZXJtc1swXS50eXBlID09PSAnR3JvdXAnKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC50ZXJtc1swXTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9Cgpjb25zdCBub29wID0gZnVuY3Rpb24oKSB7fTsKCmZ1bmN0aW9uIGVuc3VyZUZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nID8gdmFsdWUgOiBub29wOwp9CgpmdW5jdGlvbiB3YWxrJDEobm9kZSwgb3B0aW9ucywgY29udGV4dCkgewogICAgZnVuY3Rpb24gd2Fsayhub2RlKSB7CiAgICAgICAgZW50ZXIuY2FsbChjb250ZXh0LCBub2RlKTsKCiAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnR3JvdXAnOgogICAgICAgICAgICAgICAgbm9kZS50ZXJtcy5mb3JFYWNoKHdhbGspOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdNdWx0aXBsaWVyJzoKICAgICAgICAgICAgICAgIHdhbGsobm9kZS50ZXJtKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnVHlwZSc6CiAgICAgICAgICAgIGNhc2UgJ1Byb3BlcnR5JzoKICAgICAgICAgICAgY2FzZSAnS2V5d29yZCc6CiAgICAgICAgICAgIGNhc2UgJ0F0S2V5d29yZCc6CiAgICAgICAgICAgIGNhc2UgJ0Z1bmN0aW9uJzoKICAgICAgICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAgICAgY2FzZSAnVG9rZW4nOgogICAgICAgICAgICBjYXNlICdDb21tYSc6CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdHlwZTogJyArIG5vZGUudHlwZSk7CiAgICAgICAgfQoKICAgICAgICBsZWF2ZS5jYWxsKGNvbnRleHQsIG5vZGUpOwogICAgfQoKICAgIGxldCBlbnRlciA9IG5vb3A7CiAgICBsZXQgbGVhdmUgPSBub29wOwoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGVudGVyID0gb3B0aW9uczsKICAgIH0gZWxzZSBpZiAob3B0aW9ucykgewogICAgICAgIGVudGVyID0gZW5zdXJlRnVuY3Rpb24ob3B0aW9ucy5lbnRlcik7CiAgICAgICAgbGVhdmUgPSBlbnN1cmVGdW5jdGlvbihvcHRpb25zLmxlYXZlKTsKICAgIH0KCiAgICBpZiAoZW50ZXIgPT09IG5vb3AgJiYgbGVhdmUgPT09IG5vb3ApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laXRoZXIgYGVudGVyYCBub3IgYGxlYXZlYCB3YWxrZXIgaGFuZGxlciBpcyBzZXQgb3IgYm90aCBhcmVuXCd0IGEgZnVuY3Rpb24nKTsKICAgIH0KCiAgICB3YWxrKG5vZGUpOwp9Cgpjb25zdCBhc3RUb1Rva2VucyA9IHsKICAgIGRlY29yYXRvcihoYW5kbGVycykgewogICAgICAgIGNvbnN0IHRva2VucyA9IFtdOwogICAgICAgIGxldCBjdXJOb2RlID0gbnVsbDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgLi4uaGFuZGxlcnMsCiAgICAgICAgICAgIG5vZGUobm9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgdG1wID0gY3VyTm9kZTsKICAgICAgICAgICAgICAgIGN1ck5vZGUgPSBub2RlOwogICAgICAgICAgICAgICAgaGFuZGxlcnMubm9kZS5jYWxsKHRoaXMsIG5vZGUpOwogICAgICAgICAgICAgICAgY3VyTm9kZSA9IHRtcDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW1pdCh2YWx1ZSwgdHlwZSwgYXV0bykgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgbm9kZTogYXV0byA/IG51bGwgOiBjdXJOb2RlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuczsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn07CgpmdW5jdGlvbiBzdHJpbmdUb1Rva2VucyhzdHIpIHsKICAgIGNvbnN0IHRva2VucyA9IFtdOwoKICAgIHRva2VuaXplJDEoc3RyLCAodHlwZSwgc3RhcnQsIGVuZCkgPT4KICAgICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIHZhbHVlOiBzdHIuc2xpY2Uoc3RhcnQsIGVuZCksCiAgICAgICAgICAgIG5vZGU6IG51bGwKICAgICAgICB9KQogICAgKTsKCiAgICByZXR1cm4gdG9rZW5zOwp9CgpmdW5jdGlvbiBwcmVwYXJlVG9rZW5zKHZhbHVlLCBzeW50YXgpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHN0cmluZ1RvVG9rZW5zKHZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gc3ludGF4LmdlbmVyYXRlKHZhbHVlLCBhc3RUb1Rva2Vucyk7Cn0KCmNvbnN0IE1BVENIID0geyB0eXBlOiAnTWF0Y2gnIH07CmNvbnN0IE1JU01BVENIID0geyB0eXBlOiAnTWlzbWF0Y2gnIH07CmNvbnN0IERJU0FMTE9XX0VNUFRZID0geyB0eXBlOiAnRGlzYWxsb3dFbXB0eScgfTsKCmNvbnN0IExFRlRQQVJFTlRIRVNJUyQxID0gNDA7ICAvLyAoCmNvbnN0IFJJR0hUUEFSRU5USEVTSVMkMSA9IDQxOyAvLyApCgpmdW5jdGlvbiBjcmVhdGVDb25kaXRpb24obWF0Y2gsIHRoZW5CcmFuY2gsIGVsc2VCcmFuY2gpIHsKICAgIC8vIHJlZHVjZSBub2RlIGNvdW50CiAgICBpZiAodGhlbkJyYW5jaCA9PT0gTUFUQ0ggJiYgZWxzZUJyYW5jaCA9PT0gTUlTTUFUQ0gpIHsKICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICB9CgogICAgaWYgKG1hdGNoID09PSBNQVRDSCAmJiB0aGVuQnJhbmNoID09PSBNQVRDSCAmJiBlbHNlQnJhbmNoID09PSBNQVRDSCkgewogICAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KCiAgICBpZiAobWF0Y2gudHlwZSA9PT0gJ0lmJyAmJiBtYXRjaC5lbHNlID09PSBNSVNNQVRDSCAmJiB0aGVuQnJhbmNoID09PSBNQVRDSCkgewogICAgICAgIHRoZW5CcmFuY2ggPSBtYXRjaC50aGVuOwogICAgICAgIG1hdGNoID0gbWF0Y2gubWF0Y2g7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSWYnLAogICAgICAgIG1hdGNoLAogICAgICAgIHRoZW46IHRoZW5CcmFuY2gsCiAgICAgICAgZWxzZTogZWxzZUJyYW5jaAogICAgfTsKfQoKZnVuY3Rpb24gaXNGdW5jdGlvblR5cGUobmFtZSkgewogICAgcmV0dXJuICgKICAgICAgICBuYW1lLmxlbmd0aCA+IDIgJiYKICAgICAgICBuYW1lLmNoYXJDb2RlQXQobmFtZS5sZW5ndGggLSAyKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDEgJiYKICAgICAgICBuYW1lLmNoYXJDb2RlQXQobmFtZS5sZW5ndGggLSAxKSA9PT0gUklHSFRQQVJFTlRIRVNJUyQxCiAgICApOwp9CgpmdW5jdGlvbiBpc0VudW1DYXBhdGlibGUodGVybSkgewogICAgcmV0dXJuICgKICAgICAgICB0ZXJtLnR5cGUgPT09ICdLZXl3b3JkJyB8fAogICAgICAgIHRlcm0udHlwZSA9PT0gJ0F0S2V5d29yZCcgfHwKICAgICAgICB0ZXJtLnR5cGUgPT09ICdGdW5jdGlvbicgfHwKICAgICAgICB0ZXJtLnR5cGUgPT09ICdUeXBlJyAmJiBpc0Z1bmN0aW9uVHlwZSh0ZXJtLm5hbWUpCiAgICApOwp9CgpmdW5jdGlvbiBidWlsZEdyb3VwTWF0Y2hHcmFwaChjb21iaW5hdG9yLCB0ZXJtcywgYXRMZWFzdE9uZVRlcm1NYXRjaGVkKSB7CiAgICBzd2l0Y2ggKGNvbWJpbmF0b3IpIHsKICAgICAgICBjYXNlICcgJzogewogICAgICAgICAgICAvLyBKdXh0YXBvc2luZyBjb21wb25lbnRzIG1lYW5zIHRoYXQgYWxsIG9mIHRoZW0gbXVzdCBvY2N1ciwgaW4gdGhlIGdpdmVuIG9yZGVyLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBhIGIgYwogICAgICAgICAgICAvLyA9CiAgICAgICAgICAgIC8vIG1hdGNoIGEKICAgICAgICAgICAgLy8gICB0aGVuIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIE1BVENICiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8gICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8gICBlbHNlIE1JU01BVENICiAgICAgICAgICAgIGxldCByZXN1bHQgPSBNQVRDSDsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0ZXJtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgY2FzZSAnfCc6IHsKICAgICAgICAgICAgLy8gQSBiYXIgKHwpIHNlcGFyYXRlcyB0d28gb3IgbW9yZSBhbHRlcm5hdGl2ZXM6IGV4YWN0bHkgb25lIG9mIHRoZW0gbXVzdCBvY2N1ci4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSB8IGIgfCBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIE1BVENICiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKCiAgICAgICAgICAgIGxldCByZXN1bHQgPSBNSVNNQVRDSDsKICAgICAgICAgICAgbGV0IG1hcCA9IG51bGw7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gdGVybXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGxldCB0ZXJtID0gdGVybXNbaV07CgogICAgICAgICAgICAgICAgLy8gcmVkdWNlIHNlcXVlbmNlIG9mIGtleXdvcmRzIGludG8gYSBFbnVtCiAgICAgICAgICAgICAgICBpZiAoaXNFbnVtQ2FwYXRpYmxlKHRlcm0pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcCA9PT0gbnVsbCAmJiBpID4gMCAmJiBpc0VudW1DYXBhdGlibGUodGVybXNbaSAtIDFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0VudW0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobWFwICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IChpc0Z1bmN0aW9uVHlwZSh0ZXJtLm5hbWUpID8gdGVybS5uYW1lLnNsaWNlKDAsIC0xKSA6IHRlcm0ubmFtZSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSBpbiBtYXAgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBba2V5XSA9IHRlcm07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXAgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBjb25kaXRvbmFsIG5vZGUKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICAgICAgICAgIHJlc3VsdAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgY2FzZSAnJiYnOiB7CiAgICAgICAgICAgIC8vIEEgZG91YmxlIGFtcGVyc2FuZCAoJiYpIHNlcGFyYXRlcyB0d28gb3IgbW9yZSBjb21wb25lbnRzLAogICAgICAgICAgICAvLyBhbGwgb2Ygd2hpY2ggbXVzdCBvY2N1ciwgaW4gYW55IG9yZGVyLgoKICAgICAgICAgICAgLy8gVXNlIE1hdGNoT25jZSBmb3IgZ3JvdXBzIHdpdGggYSBsYXJnZSBudW1iZXIgb2YgdGVybXMsCiAgICAgICAgICAgIC8vIHNpbmNlICYmLWdyb3VwcyBwcm9kdWNlcyBhdCBsZWFzdCBOIS1ub2RlIHRyZWVzCiAgICAgICAgICAgIGlmICh0ZXJtcy5sZW5ndGggPiA1KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNYXRjaE9uY2UnLAogICAgICAgICAgICAgICAgICAgIHRlcm1zLAogICAgICAgICAgICAgICAgICAgIGFsbDogdHJ1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGEgY29tYmluYXRpb24gdHJlZSBmb3IgZ3JvdXBzIHdpdGggc21hbGwgbnVtYmVyIG9mIHRlcm1zCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGEgJiYgYiAmJiBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gW2IgJiYgY10KICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gW2EgJiYgY10KICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIFthICYmIGJdCiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSAmJiBiCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICAvLyAgIGVsc2UgbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBtYXRjaCBhCiAgICAgICAgICAgIC8vICAgICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICBsZXQgcmVzdWx0ID0gTUlTTUFUQ0g7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gdGVybXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlcm0gPSB0ZXJtc1tpXTsKICAgICAgICAgICAgICAgIGxldCB0aGVuQ2xhdXNlOwoKICAgICAgICAgICAgICAgIGlmICh0ZXJtcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSA9IGJ1aWxkR3JvdXBNYXRjaEdyYXBoKAogICAgICAgICAgICAgICAgICAgICAgICBjb21iaW5hdG9yLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXJtcy5maWx0ZXIoZnVuY3Rpb24obmV3R3JvdXBUZXJtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3R3JvdXBUZXJtICE9PSB0ZXJtOwogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGVuQ2xhdXNlID0gTUFUQ0g7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgICAgIHRlcm0sCiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSwKICAgICAgICAgICAgICAgICAgICByZXN1bHQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIGNhc2UgJ3x8JzogewogICAgICAgICAgICAvLyBBIGRvdWJsZSBiYXIgKHx8KSBzZXBhcmF0ZXMgdHdvIG9yIG1vcmUgb3B0aW9uczoKICAgICAgICAgICAgLy8gb25lIG9yIG1vcmUgb2YgdGhlbSBtdXN0IG9jY3VyLCBpbiBhbnkgb3JkZXIuCgogICAgICAgICAgICAvLyBVc2UgTWF0Y2hPbmNlIGZvciBncm91cHMgd2l0aCBhIGxhcmdlIG51bWJlciBvZiB0ZXJtcywKICAgICAgICAgICAgLy8gc2luY2UgfHwtZ3JvdXBzIHByb2R1Y2VzIGF0IGxlYXN0IE4hLW5vZGUgdHJlZXMKICAgICAgICAgICAgaWYgKHRlcm1zLmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ01hdGNoT25jZScsCiAgICAgICAgICAgICAgICAgICAgdGVybXMsCiAgICAgICAgICAgICAgICAgICAgYWxsOiBmYWxzZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGEgY29tYmluYXRpb24gdHJlZSBmb3IgZ3JvdXBzIHdpdGggc21hbGwgbnVtYmVyIG9mIHRlcm1zCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGEgfHwgYiB8fCBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gW2IgfHwgY10KICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gW2EgfHwgY10KICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIFthIHx8IGJdCiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSB8fCBiCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNQVRDSAogICAgICAgICAgICAvLyAgIGVsc2UgbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBtYXRjaCBhCiAgICAgICAgICAgIC8vICAgICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgICAgZWxzZSBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXRMZWFzdE9uZVRlcm1NYXRjaGVkID8gTUFUQ0ggOiBNSVNNQVRDSDsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0ZXJtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwogICAgICAgICAgICAgICAgbGV0IHRoZW5DbGF1c2U7CgogICAgICAgICAgICAgICAgaWYgKHRlcm1zLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGVuQ2xhdXNlID0gYnVpbGRHcm91cE1hdGNoR3JhcGgoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJpbmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlcm1zLmZpbHRlcihmdW5jdGlvbihuZXdHcm91cFRlcm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdHcm91cFRlcm0gIT09IHRlcm07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIHRoZW5DbGF1c2UsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBidWlsZE11bHRpcGxpZXJNYXRjaEdyYXBoKG5vZGUpIHsKICAgIGxldCByZXN1bHQgPSBNQVRDSDsKICAgIGxldCBtYXRjaFRlcm0gPSBidWlsZE1hdGNoR3JhcGhJbnRlcm5hbChub2RlLnRlcm0pOwoKICAgIGlmIChub2RlLm1heCA9PT0gMCkgewogICAgICAgIC8vIGRpc2FibGUgcmVwZWF0aW5nIG9mIGVtcHR5IG1hdGNoIHRvIHByZXZlbnQgaW5maW5pdGUgbG9vcAogICAgICAgIG1hdGNoVGVybSA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgbWF0Y2hUZXJtLAogICAgICAgICAgICBESVNBTExPV19FTVBUWSwKICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICApOwoKICAgICAgICAvLyBhbiBvY2N1cnJlbmNlIGNvdW50IGlzIG5vdCBsaW1pdGVkLCBtYWtlIGEgY3ljbGU7CiAgICAgICAgLy8gdG8gY29sbGVjdCBtb3JlIHRlcm1zIG9uIGVhY2ggZm9sbG93aW5nIG1hdGNoaW5nIG1pc21hdGNoCiAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICBtYXRjaFRlcm0sCiAgICAgICAgICAgIG51bGwsIC8vIHdpbGwgYmUgYSBsb29wCiAgICAgICAgICAgIE1JU01BVENICiAgICAgICAgKTsKCiAgICAgICAgcmVzdWx0LnRoZW4gPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICBNQVRDSCwKICAgICAgICAgICAgcmVzdWx0IC8vIG1ha2UgYSBsb29wCiAgICAgICAgKTsKCiAgICAgICAgaWYgKG5vZGUuY29tbWEpIHsKICAgICAgICAgICAgcmVzdWx0LnRoZW4uZWxzZSA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgIHsgdHlwZTogJ0NvbW1hJywgc3ludGF4OiBub2RlIH0sCiAgICAgICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY3JlYXRlIGEgbWF0Y2ggbm9kZSBjaGFpbiBmb3IgW21pbiAuLiBtYXhdIGludGVydmFsIHdpdGggb3B0aW9uYWwgbWF0Y2hlcwogICAgICAgIGZvciAobGV0IGkgPSBub2RlLm1pbiB8fCAxOyBpIDw9IG5vZGUubWF4OyBpKyspIHsKICAgICAgICAgICAgaWYgKG5vZGUuY29tbWEgJiYgcmVzdWx0ICE9PSBNQVRDSCkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ0NvbW1hJywgc3ludGF4OiBub2RlIH0sCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgICAgIE1JU01BVENICiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICBtYXRjaFRlcm0sCiAgICAgICAgICAgICAgICBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKG5vZGUubWluID09PSAwKSB7CiAgICAgICAgLy8gYWxsb3cgemVybyBtYXRjaAogICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICByZXN1bHQKICAgICAgICApOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBjcmVhdGUgYSBtYXRjaCBub2RlIGNoYWluIHRvIGNvbGxlY3QgWzAgLi4uIG1pbiAtIDFdIHJlcXVpcmVkIG1hdGNoZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUubWluIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChub2RlLmNvbW1hICYmIHJlc3VsdCAhPT0gTUFUQ0gpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICdDb21tYScsIHN5bnRheDogbm9kZSB9LAogICAgICAgICAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgbWF0Y2hUZXJtLAogICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gYnVpbGRNYXRjaEdyYXBoSW50ZXJuYWwobm9kZSkgewogICAgaWYgKHR5cGVvZiBub2RlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogJ0dlbmVyaWMnLAogICAgICAgICAgICBmbjogbm9kZQogICAgICAgIH07CiAgICB9CgogICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICBjYXNlICdHcm91cCc6IHsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGJ1aWxkR3JvdXBNYXRjaEdyYXBoKAogICAgICAgICAgICAgICAgbm9kZS5jb21iaW5hdG9yLAogICAgICAgICAgICAgICAgbm9kZS50ZXJtcy5tYXAoYnVpbGRNYXRjaEdyYXBoSW50ZXJuYWwpLAogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmIChub2RlLmRpc2FsbG93RW1wdHkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgRElTQUxMT1dfRU1QVFksCiAgICAgICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBjYXNlICdNdWx0aXBsaWVyJzoKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTXVsdGlwbGllck1hdGNoR3JhcGgobm9kZSk7CgogICAgICAgIGNhc2UgJ1R5cGUnOgogICAgICAgIGNhc2UgJ1Byb3BlcnR5JzoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIG5hbWU6IG5vZGUubmFtZSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdLZXl3b3JkJzoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIG5hbWU6IG5vZGUubmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgc3ludGF4OiBub2RlCiAgICAgICAgICAgIH07CgogICAgICAgIGNhc2UgJ0F0S2V5d29yZCc6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBuYW1lOiAnQCcgKyBub2RlLm5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdGdW5jdGlvbic6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBuYW1lOiBub2RlLm5hbWUudG9Mb3dlckNhc2UoKSArICcoJywKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgICAgICAvLyBjb252ZXJ0IGEgb25lIGNoYXIgbGVuZ3RoIFN0cmluZyB0byBhIFRva2VuCiAgICAgICAgICAgIGlmIChub2RlLnZhbHVlLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVG9rZW4nLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlLnZhbHVlLmNoYXJBdCgxKSwKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IG5vZGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB1c2UgaXQgYXMgaXMKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlLnZhbHVlLnN1YnN0cigxLCBub2RlLnZhbHVlLmxlbmd0aCAtIDIpLnJlcGxhY2UoL1xcJy9nLCAnXCcnKSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdUb2tlbic6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICB2YWx1ZTogbm9kZS52YWx1ZSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdDb21tYSc6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBzeW50YXg6IG5vZGUKICAgICAgICAgICAgfTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZTonLCBub2RlLnR5cGUpOwogICAgfQp9CgpmdW5jdGlvbiBidWlsZE1hdGNoR3JhcGgoc3ludGF4VHJlZSwgcmVmKSB7CiAgICBpZiAodHlwZW9mIHN5bnRheFRyZWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgc3ludGF4VHJlZSA9IHBhcnNlJEcoc3ludGF4VHJlZSk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTWF0Y2hHcmFwaCcsCiAgICAgICAgbWF0Y2g6IGJ1aWxkTWF0Y2hHcmFwaEludGVybmFsKHN5bnRheFRyZWUpLAogICAgICAgIHN5bnRheDogcmVmIHx8IG51bGwsCiAgICAgICAgc291cmNlOiBzeW50YXhUcmVlCiAgICB9Owp9Cgpjb25zdCB7IGhhc093blByb3BlcnR5OiBoYXNPd25Qcm9wZXJ0eSQyIH0gPSBPYmplY3QucHJvdG90eXBlOwpjb25zdCBTVFVCID0gMDsKY29uc3QgVE9LRU4gPSAxOwpjb25zdCBPUEVOX1NZTlRBWCA9IDI7CmNvbnN0IENMT1NFX1NZTlRBWCA9IDM7Cgpjb25zdCBFWElUX1JFQVNPTl9NQVRDSCA9ICdNYXRjaCc7CmNvbnN0IEVYSVRfUkVBU09OX01JU01BVENIID0gJ01pc21hdGNoJzsKY29uc3QgRVhJVF9SRUFTT05fSVRFUkFUSU9OX0xJTUlUID0gJ01heGltdW0gaXRlcmF0aW9uIG51bWJlciBleGNlZWRlZCAocGxlYXNlIGZpbGwgYW4gaXNzdWUgb24gaHR0cHM6Ly9naXRodWIuY29tL2Nzc3RyZWUvY3NzdHJlZS9pc3N1ZXMpJzsKCmNvbnN0IElURVJBVElPTl9MSU1JVCA9IDE1MDAwOwoKZnVuY3Rpb24gcmV2ZXJzZUxpc3QobGlzdCkgewogICAgbGV0IHByZXYgPSBudWxsOwogICAgbGV0IG5leHQgPSBudWxsOwogICAgbGV0IGl0ZW0gPSBsaXN0OwoKICAgIHdoaWxlIChpdGVtICE9PSBudWxsKSB7CiAgICAgICAgbmV4dCA9IGl0ZW0ucHJldjsKICAgICAgICBpdGVtLnByZXYgPSBwcmV2OwogICAgICAgIHByZXYgPSBpdGVtOwogICAgICAgIGl0ZW0gPSBuZXh0OwogICAgfQoKICAgIHJldHVybiBwcmV2Owp9CgpmdW5jdGlvbiBhcmVTdHJpbmdzRXF1YWxDYXNlSW5zZW5zaXRpdmUodGVzdFN0ciwgcmVmZXJlbmNlU3RyKSB7CiAgICBpZiAodGVzdFN0ci5sZW5ndGggIT09IHJlZmVyZW5jZVN0ci5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXN0U3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVmZXJlbmNlQ29kZSA9IHJlZmVyZW5jZVN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIGxldCB0ZXN0Q29kZSA9IHRlc3RTdHIuY2hhckNvZGVBdChpKTsKCiAgICAgICAgLy8gdGVzdENvZGUudG9Mb3dlckNhc2UoKSBmb3IgVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIC4uIFUrMDA1QSBMQVRJTiBDQVBJVEFMIExFVFRFUiBaIChaKS4KICAgICAgICBpZiAodGVzdENvZGUgPj0gMHgwMDQxICYmIHRlc3RDb2RlIDw9IDB4MDA1QSkgewogICAgICAgICAgICB0ZXN0Q29kZSA9IHRlc3RDb2RlIHwgMzI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdENvZGUgIT09IHJlZmVyZW5jZUNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gaXNDb250ZXh0RWRnZURlbGltKHRva2VuKSB7CiAgICBpZiAodG9rZW4udHlwZSAhPT0gRGVsaW0pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gRml4IG1hdGNoaW5nIGZvciB1bmljb2RlLXJhbmdlOiBVKzMwPz8sIFUrRkYwMC1GRjlGCiAgICAvLyBQcm9iYWJseSB3ZSBuZWVkIHRvIGNoZWNrIG91dCBwcmV2aW91cyBtYXRjaCBpbnN0ZWFkCiAgICByZXR1cm4gdG9rZW4udmFsdWUgIT09ICc/JzsKfQoKZnVuY3Rpb24gaXNDb21tYUNvbnRleHRTdGFydCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuICgKICAgICAgICB0b2tlbi50eXBlID09PSBDb21tYSB8fAogICAgICAgIHRva2VuLnR5cGUgPT09IEZ1bmN0aW9uJDIgfHwKICAgICAgICB0b2tlbi50eXBlID09PSBMZWZ0UGFyZW50aGVzaXMgfHwKICAgICAgICB0b2tlbi50eXBlID09PSBMZWZ0U3F1YXJlQnJhY2tldCB8fAogICAgICAgIHRva2VuLnR5cGUgPT09IExlZnRDdXJseUJyYWNrZXQgfHwKICAgICAgICBpc0NvbnRleHRFZGdlRGVsaW0odG9rZW4pCiAgICApOwp9CgpmdW5jdGlvbiBpc0NvbW1hQ29udGV4dEVuZCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuICgKICAgICAgICB0b2tlbi50eXBlID09PSBSaWdodFBhcmVudGhlc2lzIHx8CiAgICAgICAgdG9rZW4udHlwZSA9PT0gUmlnaHRTcXVhcmVCcmFja2V0IHx8CiAgICAgICAgdG9rZW4udHlwZSA9PT0gUmlnaHRDdXJseUJyYWNrZXQgfHwKICAgICAgICAodG9rZW4udHlwZSA9PT0gRGVsaW0gJiYgdG9rZW4udmFsdWUgPT09ICcvJykKICAgICk7Cn0KCmZ1bmN0aW9uIGludGVybmFsTWF0Y2godG9rZW5zLCBzdGF0ZSwgc3ludGF4ZXMpIHsKICAgIGZ1bmN0aW9uIG1vdmVUb05leHRUb2tlbigpIHsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHRva2VuSW5kZXgrKzsKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbkluZGV4IDwgdG9rZW5zLmxlbmd0aCA/IHRva2Vuc1t0b2tlbkluZGV4XSA6IG51bGw7CiAgICAgICAgfSB3aGlsZSAodG9rZW4gIT09IG51bGwgJiYgKHRva2VuLnR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0b2tlbi50eXBlID09PSBDb21tZW50JDEpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROZXh0VG9rZW4ob2Zmc2V0KSB7CiAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gdG9rZW5JbmRleCArIG9mZnNldDsKCiAgICAgICAgcmV0dXJuIG5leHRJbmRleCA8IHRva2Vucy5sZW5ndGggPyB0b2tlbnNbbmV4dEluZGV4XSA6IG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhdGVTbmFwc2hvdEZyb21TeW50YXgobmV4dFN0YXRlLCBwcmV2KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmV4dFN0YXRlLAogICAgICAgICAgICBtYXRjaFN0YWNrLAogICAgICAgICAgICBzeW50YXhTdGFjaywKICAgICAgICAgICAgdGhlblN0YWNrLAogICAgICAgICAgICB0b2tlbkluZGV4LAogICAgICAgICAgICBwcmV2CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoVGhlblN0YWNrKG5leHRTdGF0ZSkgewogICAgICAgIHRoZW5TdGFjayA9IHsKICAgICAgICAgICAgbmV4dFN0YXRlLAogICAgICAgICAgICBtYXRjaFN0YWNrLAogICAgICAgICAgICBzeW50YXhTdGFjaywKICAgICAgICAgICAgcHJldjogdGhlblN0YWNrCiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoRWxzZVN0YWNrKG5leHRTdGF0ZSkgewogICAgICAgIGVsc2VTdGFjayA9IHN0YXRlU25hcHNob3RGcm9tU3ludGF4KG5leHRTdGF0ZSwgZWxzZVN0YWNrKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRUb2tlblRvTWF0Y2goKSB7CiAgICAgICAgbWF0Y2hTdGFjayA9IHsKICAgICAgICAgICAgdHlwZTogVE9LRU4sCiAgICAgICAgICAgIHN5bnRheDogc3RhdGUuc3ludGF4LAogICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgcHJldjogbWF0Y2hTdGFjawogICAgICAgIH07CgogICAgICAgIG1vdmVUb05leHRUb2tlbigpOwogICAgICAgIHN5bnRheFN0YXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHRva2VuSW5kZXggPiBsb25nZXN0TWF0Y2gpIHsKICAgICAgICAgICAgbG9uZ2VzdE1hdGNoID0gdG9rZW5JbmRleDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb3BlblN5bnRheCgpIHsKICAgICAgICBzeW50YXhTdGFjayA9IHsKICAgICAgICAgICAgc3ludGF4OiBzdGF0ZS5zeW50YXgsCiAgICAgICAgICAgIG9wdHM6IHN0YXRlLnN5bnRheC5vcHRzIHx8IChzeW50YXhTdGFjayAhPT0gbnVsbCAmJiBzeW50YXhTdGFjay5vcHRzKSB8fCBudWxsLAogICAgICAgICAgICBwcmV2OiBzeW50YXhTdGFjawogICAgICAgIH07CgogICAgICAgIG1hdGNoU3RhY2sgPSB7CiAgICAgICAgICAgIHR5cGU6IE9QRU5fU1lOVEFYLAogICAgICAgICAgICBzeW50YXg6IHN0YXRlLnN5bnRheCwKICAgICAgICAgICAgdG9rZW46IG1hdGNoU3RhY2sudG9rZW4sCiAgICAgICAgICAgIHByZXY6IG1hdGNoU3RhY2sKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlU3ludGF4KCkgewogICAgICAgIGlmIChtYXRjaFN0YWNrLnR5cGUgPT09IE9QRU5fU1lOVEFYKSB7CiAgICAgICAgICAgIG1hdGNoU3RhY2sgPSBtYXRjaFN0YWNrLnByZXY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWF0Y2hTdGFjayA9IHsKICAgICAgICAgICAgICAgIHR5cGU6IENMT1NFX1NZTlRBWCwKICAgICAgICAgICAgICAgIHN5bnRheDogc3ludGF4U3RhY2suc3ludGF4LAogICAgICAgICAgICAgICAgdG9rZW46IG1hdGNoU3RhY2sudG9rZW4sCiAgICAgICAgICAgICAgICBwcmV2OiBtYXRjaFN0YWNrCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBzeW50YXhTdGFjayA9IHN5bnRheFN0YWNrLnByZXY7CiAgICB9CgogICAgbGV0IHN5bnRheFN0YWNrID0gbnVsbDsKICAgIGxldCB0aGVuU3RhY2sgPSBudWxsOwogICAgbGV0IGVsc2VTdGFjayA9IG51bGw7CgogICAgLy8gbnVsbCDigJMgc3Rhc2hpbmcgYWxsb3dlZCwgbm90aGluZyBzdGFzaGVkCiAgICAvLyBmYWxzZSDigJMgc3Rhc2hpbmcgZGlzYWJsZWQsIG5vdGhpbmcgc3Rhc2hlZAogICAgLy8gYW5pdGhpbmcgZWxzZSDigJMgZmFpbCBzdGFzaGFibGUgc3ludGF4ZXMsIHNvbWUgc3ludGF4IHN0YXNoZWQKICAgIGxldCBzeW50YXhTdGFzaCA9IG51bGw7CgogICAgbGV0IGl0ZXJhdGlvbkNvdW50ID0gMDsgLy8gY291bnQgaXRlcmF0aW9ucyBhbmQgcHJldmVudCBpbmZpbml0ZSBsb29wCiAgICBsZXQgZXhpdFJlYXNvbiA9IG51bGw7CgogICAgbGV0IHRva2VuID0gbnVsbDsKICAgIGxldCB0b2tlbkluZGV4ID0gLTE7CiAgICBsZXQgbG9uZ2VzdE1hdGNoID0gMDsKICAgIGxldCBtYXRjaFN0YWNrID0gewogICAgICAgIHR5cGU6IFNUVUIsCiAgICAgICAgc3ludGF4OiBudWxsLAogICAgICAgIHRva2VuOiBudWxsLAogICAgICAgIHByZXY6IG51bGwKICAgIH07CgogICAgbW92ZVRvTmV4dFRva2VuKCk7CgogICAgd2hpbGUgKGV4aXRSZWFzb24gPT09IG51bGwgJiYgKytpdGVyYXRpb25Db3VudCA8IElURVJBVElPTl9MSU1JVCkgewogICAgICAgIC8vIGZ1bmN0aW9uIG1hcExpc3QobGlzdCwgZm4pIHsKICAgICAgICAvLyAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgLy8gICAgIHdoaWxlIChsaXN0KSB7CiAgICAgICAgLy8gICAgICAgICByZXN1bHQudW5zaGlmdChmbihsaXN0KSk7CiAgICAgICAgLy8gICAgICAgICBsaXN0ID0gbGlzdC5wcmV2OwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNvbnNvbGUubG9nKCctLVxuJywKICAgICAgICAvLyAgICAgJyMnICsgaXRlcmF0aW9uQ291bnQsCiAgICAgICAgLy8gICAgIHJlcXVpcmUoJ3V0aWwnKS5pbnNwZWN0KHsKICAgICAgICAvLyAgICAgICAgIG1hdGNoOiBtYXBMaXN0KG1hdGNoU3RhY2ssIHggPT4geC50eXBlID09PSBUT0tFTiA/IHgudG9rZW4gJiYgeC50b2tlbi52YWx1ZSA6IHguc3ludGF4ID8gKHsgW09QRU5fU1lOVEFYXTogJzwnLCBbQ0xPU0VfU1lOVEFYXTogJzwvJyB9W3gudHlwZV0gfHwgeC50eXBlKSArICchJyArIHguc3ludGF4Lm5hbWUgOiBudWxsKSwKICAgICAgICAvLyAgICAgICAgIHRva2VuOiB0b2tlbiAmJiB0b2tlbi52YWx1ZSwKICAgICAgICAvLyAgICAgICAgIHRva2VuSW5kZXgsCiAgICAgICAgLy8gICAgICAgICBzeW50YXg6IHN5bnRheC50eXBlICsgKHN5bnRheC5pZCA/ICcgIycgKyBzeW50YXguaWQgOiAnJykKICAgICAgICAvLyAgICAgfSwgeyBkZXB0aDogbnVsbCB9KQogICAgICAgIC8vICk7CiAgICAgICAgc3dpdGNoIChzdGF0ZS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ01hdGNoJzoKICAgICAgICAgICAgICAgIGlmICh0aGVuU3RhY2sgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0dXJuIHRvIE1JU01BVENIIHdoZW4gc29tZSB0b2tlbnMgbGVmdCB1bm1hdGNoZWQKICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9lc24ndCBtaXNtYXRjaCBpZiBqdXN0IG9uZSB0b2tlbiBsZWZ0IGFuZCBpdCdzIGFuIElFIGhhY2sKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuSW5kZXggIT09IHRva2Vucy5sZW5ndGggLSAxIHx8ICh0b2tlbi52YWx1ZSAhPT0gJ1xcMCcgJiYgdG9rZW4udmFsdWUgIT09ICdcXDknKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBicmVhayB0aGUgbWFpbiBsb29wLCByZXR1cm4gYSByZXN1bHQgLSBNQVRDSAogICAgICAgICAgICAgICAgICAgIGV4aXRSZWFzb24gPSBFWElUX1JFQVNPTl9NQVRDSDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBnbyB0byBuZXh0IHN5bnRheCAoYHRoZW5gIGJyYW5jaCkKICAgICAgICAgICAgICAgIHN0YXRlID0gdGhlblN0YWNrLm5leHRTdGF0ZTsKCiAgICAgICAgICAgICAgICAvLyBjaGVjayBtYXRjaCBpcyBub3QgZW1wdHkKICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gRElTQUxMT1dfRU1QVFkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhlblN0YWNrLm1hdGNoU3RhY2sgPT09IG1hdGNoU3RhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gY2xvc2Ugc3ludGF4IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgd2hpbGUgKHRoZW5TdGFjay5zeW50YXhTdGFjayAhPT0gc3ludGF4U3RhY2spIHsKICAgICAgICAgICAgICAgICAgICBjbG9zZVN5bnRheCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHBvcCBzdGFjawogICAgICAgICAgICAgICAgdGhlblN0YWNrID0gdGhlblN0YWNrLnByZXY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01pc21hdGNoJzoKICAgICAgICAgICAgICAgIC8vIHdoZW4gc29tZSBzeW50YXggaXMgc3Rhc2hlZAogICAgICAgICAgICAgICAgaWYgKHN5bnRheFN0YXNoICE9PSBudWxsICYmIHN5bnRheFN0YXNoICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoZXJlIGlzIG5vIGVsc2UgYnJhbmNoZXMgb3IgYSBicmFuY2ggcmVkdWNlIG1hdGNoIHN0YWNrCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsc2VTdGFjayA9PT0gbnVsbCB8fCB0b2tlbkluZGV4ID4gZWxzZVN0YWNrLnRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVzdG9yZSBzdGF0ZSBmcm9tIHRoZSBzdGFzaAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlU3RhY2sgPSBzeW50YXhTdGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4U3Rhc2ggPSBmYWxzZTsgLy8gZGlzYWJsZSBzdGFzaGluZwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxzZVN0YWNrID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZWxzZSBicmFuY2hlcyAtPiBicmVhayB0aGUgbWFpbiBsb29wCiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGEgcmVzdWx0IC0gTUlTTUFUQ0gKICAgICAgICAgICAgICAgICAgICBleGl0UmVhc29uID0gRVhJVF9SRUFTT05fTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gZ28gdG8gbmV4dCBzeW50YXggKGBlbHNlYCBicmFuY2gpCiAgICAgICAgICAgICAgICBzdGF0ZSA9IGVsc2VTdGFjay5uZXh0U3RhdGU7CgogICAgICAgICAgICAgICAgLy8gcmVzdG9yZSBhbGwgdGhlIHJlc3Qgc3RhY2sgc3RhdGVzCiAgICAgICAgICAgICAgICB0aGVuU3RhY2sgPSBlbHNlU3RhY2sudGhlblN0YWNrOwogICAgICAgICAgICAgICAgc3ludGF4U3RhY2sgPSBlbHNlU3RhY2suc3ludGF4U3RhY2s7CiAgICAgICAgICAgICAgICBtYXRjaFN0YWNrID0gZWxzZVN0YWNrLm1hdGNoU3RhY2s7CiAgICAgICAgICAgICAgICB0b2tlbkluZGV4ID0gZWxzZVN0YWNrLnRva2VuSW5kZXg7CiAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuSW5kZXggPCB0b2tlbnMubGVuZ3RoID8gdG9rZW5zW3Rva2VuSW5kZXhdIDogbnVsbDsKCiAgICAgICAgICAgICAgICAvLyBwb3Agc3RhY2sKICAgICAgICAgICAgICAgIGVsc2VTdGFjayA9IGVsc2VTdGFjay5wcmV2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdNYXRjaEdyYXBoJzoKICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhdGUubWF0Y2g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0lmJzoKICAgICAgICAgICAgICAgIC8vIElNUE9SVEFOVDogZWxzZSBzdGFjayBwdXNoIG11c3QgZ28gZmlyc3QsCiAgICAgICAgICAgICAgICAvLyBzaW5jZSBpdCBzdG9yZXMgdGhlIHN0YXRlIG9mIHRoZW5TdGFjayBiZWZvcmUgY2hhbmdlcwogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmVsc2UgIT09IE1JU01BVENIKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaEVsc2VTdGFjayhzdGF0ZS5lbHNlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUudGhlbiAhPT0gTUFUQ0gpIHsKICAgICAgICAgICAgICAgICAgICBwdXNoVGhlblN0YWNrKHN0YXRlLnRoZW4pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhdGUubWF0Y2g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01hdGNoT25jZSc6CiAgICAgICAgICAgICAgICBzdGF0ZSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWF0Y2hPbmNlQnVmZmVyJywKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IHN0YXRlLAogICAgICAgICAgICAgICAgICAgIGluZGV4OiAwLAogICAgICAgICAgICAgICAgICAgIG1hc2s6IDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01hdGNoT25jZUJ1ZmZlcic6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gc3RhdGUuc3ludGF4LnRlcm1zOwoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5pbmRleCA9PT0gdGVybXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gbWF0Y2hlcyBhdCBhbGwgb3IgaXQncyByZXF1aXJlZCBhbGwgdGVybXMgdG8gYmUgbWF0Y2hlZAogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5tYXNrID09PSAwIHx8IHN0YXRlLnN5bnRheC5hbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBhIHBhcnRpYWwgbWF0Y2ggaXMgb2sKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGFsbCB0ZXJtcyBhcmUgbWF0Y2hlZAogICAgICAgICAgICAgICAgaWYgKHN0YXRlLm1hc2sgPT09ICgxIDw8IHRlcm1zLmxlbmd0aCkgLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgKDsgc3RhdGUuaW5kZXggPCB0ZXJtcy5sZW5ndGg7IHN0YXRlLmluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaEZsYWcgPSAxIDw8IHN0YXRlLmluZGV4OwoKICAgICAgICAgICAgICAgICAgICBpZiAoKHN0YXRlLm1hc2sgJiBtYXRjaEZsYWcpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUE9SVEFOVDogZWxzZSBzdGFjayBwdXNoIG11c3QgZ28gZmlyc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNpbmNlIGl0IHN0b3JlcyB0aGUgc3RhdGUgb2YgdGhlblN0YWNrIGJlZm9yZSBjaGFuZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hFbHNlU3RhY2soc3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBwdXNoVGhlblN0YWNrKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBZGRNYXRjaE9uY2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4OiBzdGF0ZS5zeW50YXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXNrOiBzdGF0ZS5tYXNrIHwgbWF0Y2hGbGFnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSB0ZXJtc1tzdGF0ZS5pbmRleCsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgJ0FkZE1hdGNoT25jZSc6CiAgICAgICAgICAgICAgICBzdGF0ZSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWF0Y2hPbmNlQnVmZmVyJywKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IHN0YXRlLnN5bnRheCwKICAgICAgICAgICAgICAgICAgICBpbmRleDogMCwKICAgICAgICAgICAgICAgICAgICBtYXNrOiBzdGF0ZS5tYXNrCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdFbnVtJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGxldCBuYW1lID0gdG9rZW4udmFsdWUudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBcMCBhbmQgXDkgaGFjayBmcm9tIGtleXdvcmQgbmFtZQogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoJ1xcJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1xcWzA5XS4qJC8sICcnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQyLmNhbGwoc3RhdGUubWFwLCBuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IHN0YXRlLm1hcFtuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0dlbmVyaWMnOiB7CiAgICAgICAgICAgICAgICBjb25zdCBvcHRzID0gc3ludGF4U3RhY2sgIT09IG51bGwgPyBzeW50YXhTdGFjay5vcHRzIDogbnVsbDsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RUb2tlbkluZGV4ID0gdG9rZW5JbmRleCArIE1hdGguZmxvb3Ioc3RhdGUuZm4odG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykpOwoKICAgICAgICAgICAgICAgIGlmICghaXNOYU4obGFzdFRva2VuSW5kZXgpICYmIGxhc3RUb2tlbkluZGV4ID4gdG9rZW5JbmRleCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlbkluZGV4IDwgbGFzdFRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlICdUeXBlJzoKICAgICAgICAgICAgY2FzZSAnUHJvcGVydHknOiB7CiAgICAgICAgICAgICAgICBjb25zdCBzeW50YXhEaWN0ID0gc3RhdGUudHlwZSA9PT0gJ1R5cGUnID8gJ3R5cGVzJyA6ICdwcm9wZXJ0aWVzJzsKICAgICAgICAgICAgICAgIGNvbnN0IGRpY3RTeW50YXggPSBoYXNPd25Qcm9wZXJ0eSQyLmNhbGwoc3ludGF4ZXMsIHN5bnRheERpY3QpID8gc3ludGF4ZXNbc3ludGF4RGljdF1bc3RhdGUubmFtZV0gOiBudWxsOwoKICAgICAgICAgICAgICAgIGlmICghZGljdFN5bnRheCB8fCAhZGljdFN5bnRheC5tYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgJ0JhZCBzeW50YXggcmVmZXJlbmNlOiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLnR5cGUgPT09ICdUeXBlJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnPCcgKyBzdGF0ZS5uYW1lICsgJz4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICc8XCcnICsgc3RhdGUubmFtZSArICdcJz4nKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3Rhc2ggYSBzeW50YXggZm9yIHR5cGVzIHdpdGggbG93IHByaW9yaXR5CiAgICAgICAgICAgICAgICBpZiAoc3ludGF4U3Rhc2ggIT09IGZhbHNlICYmIHRva2VuICE9PSBudWxsICYmIHN0YXRlLnR5cGUgPT09ICdUeXBlJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvd1ByaW9yaXR5TWF0Y2hpbmcgPQogICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNjdXN0b20taWRlbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gcGFyc2luZyBwb3NpdGlvbmFsbHktYW1iaWd1b3VzIGtleXdvcmRzIGluIGEgcHJvcGVydHkgdmFsdWUsIGEgPGN1c3RvbS1pZGVudD4gcHJvZHVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4gb25seSBjbGFpbSB0aGUga2V5d29yZCBpZiBubyBvdGhlciB1bmZ1bGZpbGxlZCBwcm9kdWN0aW9uIGNhbiBjbGFpbSBpdC4KICAgICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLm5hbWUgPT09ICdjdXN0b20taWRlbnQnICYmIHRva2VuLnR5cGUgPT09IElkZW50KSB8fAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YWx1ZXMtNC8jbGVuZ3RocwogICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi4gaWYgYSBgMGAgY291bGQgYmUgcGFyc2VkIGFzIGVpdGhlciBhIDxudW1iZXI+IG9yIGEgPGxlbmd0aD4gaW4gYSBwcm9wZXJ0eSAoc3VjaCBhcyBsaW5lLWhlaWdodCksCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IG11c3QgcGFyc2UgYXMgYSA8bnVtYmVyPgogICAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubmFtZSA9PT0gJ2xlbmd0aCcgJiYgdG9rZW4udmFsdWUgPT09ICcwJyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChsb3dQcmlvcml0eU1hdGNoaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzeW50YXhTdGFzaCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4U3Rhc2ggPSBzdGF0ZVNuYXBzaG90RnJvbVN5bnRheChzdGF0ZSwgZWxzZVN0YWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9wZW5TeW50YXgoKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gZGljdFN5bnRheC5tYXRjaDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlICdLZXl3b3JkJzogewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHN0YXRlLm5hbWU7CgogICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGtleXdvcmROYW1lID0gdG9rZW4udmFsdWU7CgogICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgXDAgYW5kIFw5IGhhY2sgZnJvbSBrZXl3b3JkIG5hbWUKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5d29yZE5hbWUuaW5kZXhPZignXFwnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5d29yZE5hbWUgPSBrZXl3b3JkTmFtZS5yZXBsYWNlKC9cXFswOV0uKiQvLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoYXJlU3RyaW5nc0VxdWFsQ2FzZUluc2Vuc2l0aXZlKGtleXdvcmROYW1lLCBuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAnQXRLZXl3b3JkJzoKICAgICAgICAgICAgY2FzZSAnRnVuY3Rpb24nOgogICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSBudWxsICYmIGFyZVN0cmluZ3NFcXVhbENhc2VJbnNlbnNpdGl2ZSh0b2tlbi52YWx1ZSwgc3RhdGUubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ1Rva2VuJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbi52YWx1ZSA9PT0gc3RhdGUudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0NvbW1hJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbi50eXBlID09PSBDb21tYSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbW1hQ29udGV4dFN0YXJ0KG1hdGNoU3RhY2sudG9rZW4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gaXNDb21tYUNvbnRleHRFbmQodG9rZW4pID8gTUlTTUFUQ0ggOiBNQVRDSDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gaXNDb21tYUNvbnRleHRTdGFydChtYXRjaFN0YWNrLnRva2VuKSB8fCBpc0NvbW1hQ29udGV4dEVuZCh0b2tlbikgPyBNQVRDSCA6IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAgICAgICAgIGxldCBzdHJpbmcgPSAnJzsKICAgICAgICAgICAgICAgIGxldCBsYXN0VG9rZW5JbmRleCA9IHRva2VuSW5kZXg7CgogICAgICAgICAgICAgICAgZm9yICg7IGxhc3RUb2tlbkluZGV4IDwgdG9rZW5zLmxlbmd0aCAmJiBzdHJpbmcubGVuZ3RoIDwgc3RhdGUudmFsdWUubGVuZ3RoOyBsYXN0VG9rZW5JbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IHRva2Vuc1tsYXN0VG9rZW5JbmRleF0udmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFyZVN0cmluZ3NFcXVhbENhc2VJbnNlbnNpdGl2ZShzdHJpbmcsIHN0YXRlLnZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlbkluZGV4IDwgbGFzdFRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGU6ICcgKyBzdGF0ZS50eXBlKTsKICAgICAgICB9CiAgICB9CgogICAgc3dpdGNoIChleGl0UmVhc29uKSB7CiAgICAgICAgY2FzZSBudWxsOgogICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tjc3N0cmVlLW1hdGNoXSBCUkVBSyBhZnRlciAnICsgSVRFUkFUSU9OX0xJTUlUICsgJyBpdGVyYXRpb25zJyk7CiAgICAgICAgICAgIGV4aXRSZWFzb24gPSBFWElUX1JFQVNPTl9JVEVSQVRJT05fTElNSVQ7CiAgICAgICAgICAgIG1hdGNoU3RhY2sgPSBudWxsOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBFWElUX1JFQVNPTl9NQVRDSDoKICAgICAgICAgICAgd2hpbGUgKHN5bnRheFN0YWNrICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjbG9zZVN5bnRheCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBtYXRjaFN0YWNrID0gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHRva2VucywKICAgICAgICByZWFzb246IGV4aXRSZWFzb24sCiAgICAgICAgaXRlcmF0aW9uczogaXRlcmF0aW9uQ291bnQsCiAgICAgICAgbWF0Y2g6IG1hdGNoU3RhY2ssCiAgICAgICAgbG9uZ2VzdE1hdGNoCiAgICB9Owp9CgpmdW5jdGlvbiBtYXRjaEFzVHJlZSh0b2tlbnMsIG1hdGNoR3JhcGgsIHN5bnRheGVzKSB7CiAgICBjb25zdCBtYXRjaFJlc3VsdCA9IGludGVybmFsTWF0Y2godG9rZW5zLCBtYXRjaEdyYXBoLCBzeW50YXhlcyB8fCB7fSk7CgogICAgaWYgKG1hdGNoUmVzdWx0Lm1hdGNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoUmVzdWx0OwogICAgfQoKICAgIGxldCBpdGVtID0gbWF0Y2hSZXN1bHQubWF0Y2g7CiAgICBsZXQgaG9zdCA9IG1hdGNoUmVzdWx0Lm1hdGNoID0gewogICAgICAgIHN5bnRheDogbWF0Y2hHcmFwaC5zeW50YXggfHwgbnVsbCwKICAgICAgICBtYXRjaDogW10KICAgIH07CiAgICBjb25zdCBob3N0U3RhY2sgPSBbaG9zdF07CgogICAgLy8gcmV2ZXJ0IGEgbGlzdCBhbmQgc3RhcnQgd2l0aCAybmQgaXRlbSBzaW5jZSAxc3QgaXMgYSBzdHViIGl0ZW0KICAgIGl0ZW0gPSByZXZlcnNlTGlzdChpdGVtKS5wcmV2OwoKICAgIC8vIGJ1aWxkIGEgdHJlZQogICAgd2hpbGUgKGl0ZW0gIT09IG51bGwpIHsKICAgICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkgewogICAgICAgICAgICBjYXNlIE9QRU5fU1lOVEFYOgogICAgICAgICAgICAgICAgaG9zdC5tYXRjaC5wdXNoKGhvc3QgPSB7CiAgICAgICAgICAgICAgICAgICAgc3ludGF4OiBpdGVtLnN5bnRheCwKICAgICAgICAgICAgICAgICAgICBtYXRjaDogW10KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaG9zdFN0YWNrLnB1c2goaG9zdCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgQ0xPU0VfU1lOVEFYOgogICAgICAgICAgICAgICAgaG9zdFN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgaG9zdCA9IGhvc3RTdGFja1tob3N0U3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBob3N0Lm1hdGNoLnB1c2goewogICAgICAgICAgICAgICAgICAgIHN5bnRheDogaXRlbS5zeW50YXggfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogaXRlbS50b2tlbi52YWx1ZSwKICAgICAgICAgICAgICAgICAgICBub2RlOiBpdGVtLnRva2VuLm5vZGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaXRlbSA9IGl0ZW0ucHJldjsKICAgIH0KCiAgICByZXR1cm4gbWF0Y2hSZXN1bHQ7Cn0KCmZ1bmN0aW9uIGdldFRyYWNlKG5vZGUpIHsKICAgIGZ1bmN0aW9uIHNob3VsZFB1dFRvVHJhY2Uoc3ludGF4KSB7CiAgICAgICAgaWYgKHN5bnRheCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBzeW50YXgudHlwZSA9PT0gJ1R5cGUnIHx8CiAgICAgICAgICAgIHN5bnRheC50eXBlID09PSAnUHJvcGVydHknIHx8CiAgICAgICAgICAgIHN5bnRheC50eXBlID09PSAnS2V5d29yZCcKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc01hdGNoKG1hdGNoTm9kZSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hdGNoTm9kZS5tYXRjaCkpIHsKICAgICAgICAgICAgLy8gdXNlIGZvci1sb29wIGZvciBiZXR0ZXIgcGVyZm9tYW5jZQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdGNoTm9kZS5tYXRjaC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGhhc01hdGNoKG1hdGNoTm9kZS5tYXRjaFtpXSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUHV0VG9UcmFjZShtYXRjaE5vZGUuc3ludGF4KSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQudW5zaGlmdChtYXRjaE5vZGUuc3ludGF4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaE5vZGUubm9kZSA9PT0gbm9kZSkgewogICAgICAgICAgICByZXN1bHQgPSBzaG91bGRQdXRUb1RyYWNlKG1hdGNoTm9kZS5zeW50YXgpCiAgICAgICAgICAgICAgICA/IFttYXRjaE5vZGUuc3ludGF4XQogICAgICAgICAgICAgICAgOiBbXTsKCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGxldCByZXN1bHQgPSBudWxsOwoKICAgIGlmICh0aGlzLm1hdGNoZWQgIT09IG51bGwpIHsKICAgICAgICBoYXNNYXRjaCh0aGlzLm1hdGNoZWQpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGlzVHlwZShub2RlLCB0eXBlKSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ1R5cGUnICYmIG1hdGNoLm5hbWUgPT09IHR5cGUpOwp9CgpmdW5jdGlvbiBpc1Byb3BlcnR5KG5vZGUsIHByb3BlcnR5KSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ1Byb3BlcnR5JyAmJiBtYXRjaC5uYW1lID09PSBwcm9wZXJ0eSk7Cn0KCmZ1bmN0aW9uIGlzS2V5d29yZChub2RlKSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ0tleXdvcmQnKTsKfQoKZnVuY3Rpb24gdGVzdE5vZGUobWF0Y2gsIG5vZGUsIGZuKSB7CiAgICBjb25zdCB0cmFjZSA9IGdldFRyYWNlLmNhbGwobWF0Y2gsIG5vZGUpOwoKICAgIGlmICh0cmFjZSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJhY2Uuc29tZShmbik7Cn0KCmNvbnN0IHRyYWNlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZXRUcmFjZSwKICAgIGlzS2V5d29yZCwKICAgIGlzUHJvcGVydHksCiAgICBpc1R5cGUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgpmdW5jdGlvbiBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUpIHsKICAgIGlmICgnbm9kZScgaW4gbWF0Y2hOb2RlKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoTm9kZS5ub2RlOwogICAgfQoKICAgIHJldHVybiBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUubWF0Y2hbMF0pOwp9CgpmdW5jdGlvbiBnZXRMYXN0TWF0Y2hOb2RlKG1hdGNoTm9kZSkgewogICAgaWYgKCdub2RlJyBpbiBtYXRjaE5vZGUpIHsKICAgICAgICByZXR1cm4gbWF0Y2hOb2RlLm5vZGU7CiAgICB9CgogICAgcmV0dXJuIGdldExhc3RNYXRjaE5vZGUobWF0Y2hOb2RlLm1hdGNoW21hdGNoTm9kZS5tYXRjaC5sZW5ndGggLSAxXSk7Cn0KCmZ1bmN0aW9uIG1hdGNoRnJhZ21lbnRzKGxleGVyLCBhc3QsIG1hdGNoLCB0eXBlLCBuYW1lKSB7CiAgICBmdW5jdGlvbiBmaW5kRnJhZ21lbnRzKG1hdGNoTm9kZSkgewogICAgICAgIGlmIChtYXRjaE5vZGUuc3ludGF4ICE9PSBudWxsICYmCiAgICAgICAgICAgIG1hdGNoTm9kZS5zeW50YXgudHlwZSA9PT0gdHlwZSAmJgogICAgICAgICAgICBtYXRjaE5vZGUuc3ludGF4Lm5hbWUgPT09IG5hbWUpIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUpOwogICAgICAgICAgICBjb25zdCBlbmQgPSBnZXRMYXN0TWF0Y2hOb2RlKG1hdGNoTm9kZSk7CgogICAgICAgICAgICBsZXhlci5zeW50YXgud2Fsayhhc3QsIGZ1bmN0aW9uKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBzdGFydCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gbmV3IExpc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBub2Rlcy5hcHBlbmREYXRhKGl0ZW0uZGF0YSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhID09PSBlbmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbS5uZXh0OwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGl0ZW0gIT09IG51bGwpOwoKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudDogbGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXRjaE5vZGUubWF0Y2gpKSB7CiAgICAgICAgICAgIG1hdGNoTm9kZS5tYXRjaC5mb3JFYWNoKGZpbmRGcmFnbWVudHMpOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBmcmFnbWVudHMgPSBbXTsKCiAgICBpZiAobWF0Y2gubWF0Y2hlZCAhPT0gbnVsbCkgewogICAgICAgIGZpbmRGcmFnbWVudHMobWF0Y2gubWF0Y2hlZCk7CiAgICB9CgogICAgcmV0dXJuIGZyYWdtZW50czsKfQoKY29uc3QgeyBoYXNPd25Qcm9wZXJ0eTogaGFzT3duUHJvcGVydHkkMSB9ID0gT2JqZWN0LnByb3RvdHlwZTsKCmZ1bmN0aW9uIGlzVmFsaWROdW1iZXIodmFsdWUpIHsKICAgIC8vIE51bWJlci5pc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID49IDAKICAgIHJldHVybiAoCiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJgogICAgICAgIGlzRmluaXRlKHZhbHVlKSAmJgogICAgICAgIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZSAmJgogICAgICAgIHZhbHVlID49IDAKICAgICk7Cn0KCmZ1bmN0aW9uIGlzVmFsaWRMb2NhdGlvbihsb2MpIHsKICAgIHJldHVybiAoCiAgICAgICAgQm9vbGVhbihsb2MpICYmCiAgICAgICAgaXNWYWxpZE51bWJlcihsb2Mub2Zmc2V0KSAmJgogICAgICAgIGlzVmFsaWROdW1iZXIobG9jLmxpbmUpICYmCiAgICAgICAgaXNWYWxpZE51bWJlcihsb2MuY29sdW1uKQogICAgKTsKfQoKZnVuY3Rpb24gY3JlYXRlTm9kZVN0cnVjdHVyZUNoZWNrZXIodHlwZSwgZmllbGRzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gY2hlY2tOb2RlKG5vZGUsIHdhcm4pIHsKICAgICAgICBpZiAoIW5vZGUgfHwgbm9kZS5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiB3YXJuKG5vZGUsICdUeXBlIG9mIG5vZGUgc2hvdWxkIGJlIGFuIE9iamVjdCcpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChsZXQga2V5IGluIG5vZGUpIHsKICAgICAgICAgICAgbGV0IHZhbGlkID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwobm9kZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoa2V5ID09PSAndHlwZScpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgIT09IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICB3YXJuKG5vZGUsICdXcm9uZyBub2RlIHR5cGUgYCcgKyBub2RlLnR5cGUgKyAnYCwgZXhwZWN0ZWQgYCcgKyB0eXBlICsgJ2AnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdsb2MnKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5sb2MgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5sb2MgJiYgbm9kZS5sb2MuY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5sb2Muc291cmNlICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICBrZXkgKz0gJy5zb3VyY2UnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVmFsaWRMb2NhdGlvbihub2RlLmxvYy5zdGFydCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ICs9ICcuc3RhcnQnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVmFsaWRMb2NhdGlvbihub2RlLmxvYy5lbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleSArPSAnLmVuZCc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7ICF2YWxpZCAmJiBpIDwgZmllbGRzW2tleV0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBmaWVsZHNba2V5XVtpXTsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHR5cGVvZiBub2RlW2tleV0gPT09ICdzdHJpbmcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb2xlYW46CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHR5cGVvZiBub2RlW2tleV0gPT09ICdib29sZWFuJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBudWxsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBub2RlW2tleV0gPT09IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IG5vZGVba2V5XSAmJiBub2RlW2tleV0udHlwZSA9PT0gZmllbGRUeXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpZWxkVHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IG5vZGVba2V5XSBpbnN0YW5jZW9mIExpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2Fybihub2RlLCAnVW5rbm93biBmaWVsZCBgJyArIGtleSArICdgIGZvciAnICsgdHlwZSArICcgbm9kZSB0eXBlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgIHdhcm4obm9kZSwgJ0JhZCB2YWx1ZSBmb3IgYCcgKyB0eXBlICsgJy4nICsga2V5ICsgJ2AnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRzKSB7CiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwoZmllbGRzLCBrZXkpICYmCiAgICAgICAgICAgICAgICBoYXNPd25Qcm9wZXJ0eSQxLmNhbGwobm9kZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHdhcm4obm9kZSwgJ0ZpZWxkIGAnICsgdHlwZSArICcuJyArIGtleSArICdgIGlzIG1pc3NlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gcHJvY2Vzc1N0cnVjdHVyZShuYW1lLCBub2RlVHlwZSkgewogICAgY29uc3Qgc3RydWN0dXJlID0gbm9kZVR5cGUuc3RydWN0dXJlOwogICAgY29uc3QgZmllbGRzID0gewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICBsb2M6IHRydWUKICAgIH07CiAgICBjb25zdCBkb2NzID0gewogICAgICAgIHR5cGU6ICciJyArIG5hbWUgKyAnIicKICAgIH07CgogICAgZm9yIChjb25zdCBrZXkgaW4gc3RydWN0dXJlKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDEuY2FsbChzdHJ1Y3R1cmUsIGtleSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZG9jc1R5cGVzID0gW107CiAgICAgICAgY29uc3QgZmllbGRUeXBlcyA9IGZpZWxkc1trZXldID0gQXJyYXkuaXNBcnJheShzdHJ1Y3R1cmVba2V5XSkKICAgICAgICAgICAgPyBzdHJ1Y3R1cmVba2V5XS5zbGljZSgpCiAgICAgICAgICAgIDogW3N0cnVjdHVyZVtrZXldXTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWVsZFR5cGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGZpZWxkVHlwZSA9IGZpZWxkVHlwZXNbaV07CiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IFN0cmluZyB8fCBmaWVsZFR5cGUgPT09IEJvb2xlYW4pIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKGZpZWxkVHlwZS5uYW1lKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZFR5cGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKCdudWxsJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKCc8JyArIGZpZWxkVHlwZSArICc+Jyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShmaWVsZFR5cGUpKSB7CiAgICAgICAgICAgICAgICBkb2NzVHlwZXMucHVzaCgnTGlzdCcpOyAvLyBUT0RPOiB1c2UgdHlwZSBlbnVtCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dyb25nIHZhbHVlIGAnICsgZmllbGRUeXBlICsgJ2AgaW4gYCcgKyBuYW1lICsgJy4nICsga2V5ICsgJ2Agc3RydWN0dXJlIGRlZmluaXRpb24nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZG9jc1trZXldID0gZG9jc1R5cGVzLmpvaW4oJyB8ICcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgZG9jcywKICAgICAgICBjaGVjazogY3JlYXRlTm9kZVN0cnVjdHVyZUNoZWNrZXIobmFtZSwgZmllbGRzKQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0U3RydWN0dXJlRnJvbUNvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHN0cnVjdHVyZSA9IHt9OwoKICAgIGlmIChjb25maWcubm9kZSkgewogICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcubm9kZSkgewogICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKGNvbmZpZy5ub2RlLCBuYW1lKSkgewogICAgICAgICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBjb25maWcubm9kZVtuYW1lXTsKCiAgICAgICAgICAgICAgICBpZiAobm9kZVR5cGUuc3RydWN0dXJlKSB7CiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlW25hbWVdID0gcHJvY2Vzc1N0cnVjdHVyZShuYW1lLCBub2RlVHlwZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2VkIGBzdHJ1Y3R1cmVgIGZpZWxkIGluIGAnICsgbmFtZSArICdgIG5vZGUgdHlwZSBkZWZpbml0aW9uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHN0cnVjdHVyZTsKfQoKY29uc3QgY3NzV2lkZUtleXdvcmRzU3ludGF4ID0gYnVpbGRNYXRjaEdyYXBoKGNzc1dpZGVLZXl3b3Jkcy5qb2luKCcgfCAnKSk7CgpmdW5jdGlvbiBkdW1wTWFwU3ludGF4KG1hcCwgY29tcGFjdCwgc3ludGF4QXNBc3QpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHt9OwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBtYXApIHsKICAgICAgICBpZiAobWFwW25hbWVdLnN5bnRheCkgewogICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBzeW50YXhBc0FzdAogICAgICAgICAgICAgICAgPyBtYXBbbmFtZV0uc3ludGF4CiAgICAgICAgICAgICAgICA6IGdlbmVyYXRlJEcobWFwW25hbWVdLnN5bnRheCwgeyBjb21wYWN0IH0pOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBkdW1wQXRydWxlTWFwU3ludGF4KG1hcCwgY29tcGFjdCwgc3ludGF4QXNBc3QpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHt9OwoKICAgIGZvciAoY29uc3QgW25hbWUsIGF0cnVsZV0gb2YgT2JqZWN0LmVudHJpZXMobWFwKSkgewogICAgICAgIHJlc3VsdFtuYW1lXSA9IHsKICAgICAgICAgICAgcHJlbHVkZTogYXRydWxlLnByZWx1ZGUgJiYgKAogICAgICAgICAgICAgICAgc3ludGF4QXNBc3QKICAgICAgICAgICAgICAgICAgICA/IGF0cnVsZS5wcmVsdWRlLnN5bnRheAogICAgICAgICAgICAgICAgICAgIDogZ2VuZXJhdGUkRyhhdHJ1bGUucHJlbHVkZS5zeW50YXgsIHsgY29tcGFjdCB9KQogICAgICAgICAgICApLAogICAgICAgICAgICBkZXNjcmlwdG9yczogYXRydWxlLmRlc2NyaXB0b3JzICYmIGR1bXBNYXBTeW50YXgoYXRydWxlLmRlc2NyaXB0b3JzLCBjb21wYWN0LCBzeW50YXhBc0FzdCkKICAgICAgICB9OwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIHZhbHVlSGFzVmFyKHRva2VucykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodG9rZW5zW2ldLnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICd2YXIoJykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBidWlsZE1hdGNoUmVzdWx0KG1hdGNoZWQsIGVycm9yLCBpdGVyYXRpb25zKSB7CiAgICByZXR1cm4gewogICAgICAgIG1hdGNoZWQsCiAgICAgICAgaXRlcmF0aW9ucywKICAgICAgICBlcnJvciwKICAgICAgICAuLi50cmFjZQogICAgfTsKfQoKZnVuY3Rpb24gbWF0Y2hTeW50YXgobGV4ZXIsIHN5bnRheCwgdmFsdWUsIHVzZUNzc1dpZGVLZXl3b3JkcykgewogICAgY29uc3QgdG9rZW5zID0gcHJlcGFyZVRva2Vucyh2YWx1ZSwgbGV4ZXIuc3ludGF4KTsKICAgIGxldCByZXN1bHQ7CgogICAgaWYgKHZhbHVlSGFzVmFyKHRva2VucykpIHsKICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgRXJyb3IoJ01hdGNoaW5nIGZvciBhIHRyZWUgd2l0aCB2YXIoKSBpcyBub3Qgc3VwcG9ydGVkJykpOwogICAgfQoKICAgIGlmICh1c2VDc3NXaWRlS2V5d29yZHMpIHsKICAgICAgICByZXN1bHQgPSBtYXRjaEFzVHJlZSh0b2tlbnMsIGxleGVyLmNzc1dpZGVLZXl3b3Jkc1N5bnRheCwgbGV4ZXIpOwogICAgfQoKICAgIGlmICghdXNlQ3NzV2lkZUtleXdvcmRzIHx8ICFyZXN1bHQubWF0Y2gpIHsKICAgICAgICByZXN1bHQgPSBtYXRjaEFzVHJlZSh0b2tlbnMsIHN5bnRheC5tYXRjaCwgbGV4ZXIpOwogICAgICAgIGlmICghcmVzdWx0Lm1hdGNoKSB7CiAgICAgICAgICAgIHJldHVybiBidWlsZE1hdGNoUmVzdWx0KAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIG5ldyBTeW50YXhNYXRjaEVycm9yKHJlc3VsdC5yZWFzb24sIHN5bnRheC5zeW50YXgsIHZhbHVlLCByZXN1bHQpLAogICAgICAgICAgICAgICAgcmVzdWx0Lml0ZXJhdGlvbnMKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGJ1aWxkTWF0Y2hSZXN1bHQocmVzdWx0Lm1hdGNoLCBudWxsLCByZXN1bHQuaXRlcmF0aW9ucyk7Cn0KCmNsYXNzIExleGVyIHsKICAgIGNvbnN0cnVjdG9yKGNvbmZpZywgc3ludGF4LCBzdHJ1Y3R1cmUpIHsKICAgICAgICB0aGlzLmNzc1dpZGVLZXl3b3Jkc1N5bnRheCA9IGNzc1dpZGVLZXl3b3Jkc1N5bnRheDsKICAgICAgICB0aGlzLnN5bnRheCA9IHN5bnRheDsKICAgICAgICB0aGlzLmdlbmVyaWMgPSBmYWxzZTsKICAgICAgICB0aGlzLnVuaXRzID0geyAuLi51bml0cyB9OwogICAgICAgIHRoaXMuYXRydWxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLnR5cGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLnN0cnVjdHVyZSA9IHN0cnVjdHVyZSB8fCBnZXRTdHJ1Y3R1cmVGcm9tQ29uZmlnKGNvbmZpZyk7CgogICAgICAgIGlmIChjb25maWcpIHsKICAgICAgICAgICAgaWYgKGNvbmZpZy51bml0cykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBncm91cCBvZiBPYmplY3Qua2V5cyh1bml0cykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcudW5pdHNbZ3JvdXBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXRzW2dyb3VwXSA9IGNvbmZpZy51bml0c1tncm91cF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLnR5cGVzKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gY29uZmlnLnR5cGVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRUeXBlXyhuYW1lLCBjb25maWcudHlwZXNbbmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLmdlbmVyaWMpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJpYyA9IHRydWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY3JlYXRlR2VuZXJpY1R5cGVzKHRoaXMudW5pdHMpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVHlwZV8obmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLmF0cnVsZXMpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcuYXRydWxlcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQXRydWxlXyhuYW1lLCBjb25maWcuYXRydWxlc1tuYW1lXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb25maWcucHJvcGVydGllcykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGNvbmZpZy5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRQcm9wZXJ0eV8obmFtZSwgY29uZmlnLnByb3BlcnRpZXNbbmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGNoZWNrU3RydWN0dXJlKGFzdCkgewogICAgICAgIGZ1bmN0aW9uIGNvbGxlY3RXYXJuaW5nKG5vZGUsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgd2FybnMucHVzaCh7IG5vZGUsIG1lc3NhZ2UgfSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdHJ1Y3R1cmUgPSB0aGlzLnN0cnVjdHVyZTsKICAgICAgICBjb25zdCB3YXJucyA9IFtdOwoKICAgICAgICB0aGlzLnN5bnRheC53YWxrKGFzdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICBpZiAoc3RydWN0dXJlLmhhc093blByb3BlcnR5KG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgICAgIHN0cnVjdHVyZVtub2RlLnR5cGVdLmNoZWNrKG5vZGUsIGNvbGxlY3RXYXJuaW5nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbGxlY3RXYXJuaW5nKG5vZGUsICdVbmtub3duIG5vZGUgdHlwZSBgJyArIG5vZGUudHlwZSArICdgJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdhcm5zLmxlbmd0aCA/IHdhcm5zIDogZmFsc2U7CiAgICB9CgogICAgY3JlYXRlRGVzY3JpcHRvcihzeW50YXgsIHR5cGUsIG5hbWUsIHBhcmVudCA9IG51bGwpIHsKICAgICAgICBjb25zdCByZWYgPSB7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIG5hbWUKICAgICAgICB9OwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSB7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIHBhcmVudCwKICAgICAgICAgICAgc2VyaWFsaXphYmxlOiB0eXBlb2Ygc3ludGF4ID09PSAnc3RyaW5nJyB8fCAoc3ludGF4ICYmIHR5cGVvZiBzeW50YXgudHlwZSA9PT0gJ3N0cmluZycpLAogICAgICAgICAgICBzeW50YXg6IG51bGwsCiAgICAgICAgICAgIG1hdGNoOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHR5cGVvZiBzeW50YXggPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgZGVzY3JpcHRvci5tYXRjaCA9IGJ1aWxkTWF0Y2hHcmFwaChzeW50YXgsIHJlZik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzeW50YXggPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAvLyBsYXp5IHBhcnNpbmcgb24gZmlyc3QgYWNjZXNzCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVzY3JpcHRvciwgJ3N5bnRheCcsIHsKICAgICAgICAgICAgICAgICAgICBnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZXNjcmlwdG9yLCAnc3ludGF4JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcnNlJEcoc3ludGF4KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXNjcmlwdG9yLnN5bnRheDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlc2NyaXB0b3Iuc3ludGF4ID0gc3ludGF4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsYXp5IGdyYXBoIGJ1aWxkIG9uIGZpcnN0IGFjY2VzcwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVzY3JpcHRvciwgJ21hdGNoJywgewogICAgICAgICAgICAgICAgZ2V0KCkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZXNjcmlwdG9yLCAnbWF0Y2gnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBidWlsZE1hdGNoR3JhcGgoZGVzY3JpcHRvci5zeW50YXgsIHJlZikKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3IubWF0Y2g7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICB9CiAgICBhZGRBdHJ1bGVfKG5hbWUsIHN5bnRheCkgewogICAgICAgIGlmICghc3ludGF4KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuYXRydWxlc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogJ0F0cnVsZScsCiAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgIHByZWx1ZGU6IHN5bnRheC5wcmVsdWRlID8gdGhpcy5jcmVhdGVEZXNjcmlwdG9yKHN5bnRheC5wcmVsdWRlLCAnQXRydWxlUHJlbHVkZScsIG5hbWUpIDogbnVsbCwKICAgICAgICAgICAgZGVzY3JpcHRvcnM6IHN5bnRheC5kZXNjcmlwdG9ycwogICAgICAgICAgICAgICAgPyBPYmplY3Qua2V5cyhzeW50YXguZGVzY3JpcHRvcnMpLnJlZHVjZSgKICAgICAgICAgICAgICAgICAgICAobWFwLCBkZXNjTmFtZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBtYXBbZGVzY05hbWVdID0gdGhpcy5jcmVhdGVEZXNjcmlwdG9yKHN5bnRheC5kZXNjcmlwdG9yc1tkZXNjTmFtZV0sICdBdHJ1bGVEZXNjcmlwdG9yJywgZGVzY05hbWUsIG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgOiBudWxsCiAgICAgICAgfTsKICAgIH0KICAgIGFkZFByb3BlcnR5XyhuYW1lLCBzeW50YXgpIHsKICAgICAgICBpZiAoIXN5bnRheCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnByb3BlcnRpZXNbbmFtZV0gPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnUHJvcGVydHknLCBuYW1lKTsKICAgIH0KICAgIGFkZFR5cGVfKG5hbWUsIHN5bnRheCkgewogICAgICAgIGlmICghc3ludGF4KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMudHlwZXNbbmFtZV0gPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnVHlwZScsIG5hbWUpOwogICAgfQoKICAgIGNoZWNrQXRydWxlTmFtZShhdHJ1bGVOYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFN5bnRheFJlZmVyZW5jZUVycm9yKCdVbmtub3duIGF0LXJ1bGUnLCAnQCcgKyBhdHJ1bGVOYW1lKTsKICAgICAgICB9CiAgICB9CiAgICBjaGVja0F0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZU5hbWUoYXRydWxlTmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKCiAgICAgICAgaWYgKCFhdHJ1bGUucHJlbHVkZSAmJiBwcmVsdWRlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIHNob3VsZCBub3QgY29udGFpbiBhIHByZWx1ZGUnKTsKICAgICAgICB9CgogICAgICAgIGlmIChhdHJ1bGUucHJlbHVkZSAmJiAhcHJlbHVkZSkgewogICAgICAgICAgICBpZiAoIW1hdGNoU3ludGF4KHRoaXMsIGF0cnVsZS5wcmVsdWRlLCAnJywgZmFsc2UpLm1hdGNoZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIHNob3VsZCBjb250YWluIGEgcHJlbHVkZScpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY2hlY2tBdHJ1bGVEZXNjcmlwdG9yTmFtZShhdHJ1bGVOYW1lLCBkZXNjcmlwdG9yTmFtZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZU5hbWUoYXRydWxlTmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKICAgICAgICBjb25zdCBkZXNjcmlwdG9yID0ga2V5d29yZChkZXNjcmlwdG9yTmFtZSk7CgogICAgICAgIGlmICghYXRydWxlLmRlc2NyaXB0b3JzKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIGhhcyBubyBrbm93biBkZXNjcmlwdG9ycycpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhdHJ1bGUuZGVzY3JpcHRvcnNbZGVzY3JpcHRvci5uYW1lXSAmJgogICAgICAgICAgICAhYXRydWxlLmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3IuYmFzZW5hbWVdKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gYXQtcnVsZSBkZXNjcmlwdG9yJywgZGVzY3JpcHRvck5hbWUpOwogICAgICAgIH0KICAgIH0KICAgIGNoZWNrUHJvcGVydHlOYW1lKHByb3BlcnR5TmFtZSkgewogICAgICAgIGlmICghdGhpcy5nZXRQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gcHJvcGVydHknLCBwcm9wZXJ0eU5hbWUpOwogICAgICAgIH0KICAgIH0KCiAgICBtYXRjaEF0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBlcnJvcik7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKCiAgICAgICAgaWYgKCFhdHJ1bGUucHJlbHVkZSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaFN5bnRheCh0aGlzLCBhdHJ1bGUucHJlbHVkZSwgcHJlbHVkZSB8fCAnJywgZmFsc2UpOwogICAgfQogICAgbWF0Y2hBdHJ1bGVEZXNjcmlwdG9yKGF0cnVsZU5hbWUsIGRlc2NyaXB0b3JOYW1lLCB2YWx1ZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZURlc2NyaXB0b3JOYW1lKGF0cnVsZU5hbWUsIGRlc2NyaXB0b3JOYW1lKTsKCiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBidWlsZE1hdGNoUmVzdWx0KG51bGwsIGVycm9yKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGF0cnVsZSA9IHRoaXMuZ2V0QXRydWxlKGF0cnVsZU5hbWUpOwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBrZXl3b3JkKGRlc2NyaXB0b3JOYW1lKTsKCiAgICAgICAgcmV0dXJuIG1hdGNoU3ludGF4KHRoaXMsIGF0cnVsZS5kZXNjcmlwdG9yc1tkZXNjcmlwdG9yLm5hbWVdIHx8IGF0cnVsZS5kZXNjcmlwdG9yc1tkZXNjcmlwdG9yLmJhc2VuYW1lXSwgdmFsdWUsIGZhbHNlKTsKICAgIH0KICAgIG1hdGNoRGVjbGFyYXRpb24obm9kZSkgewogICAgICAgIGlmIChub2RlLnR5cGUgIT09ICdEZWNsYXJhdGlvbicpIHsKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTWF0Y2hSZXN1bHQobnVsbCwgbmV3IEVycm9yKCdOb3QgYSBEZWNsYXJhdGlvbiBub2RlJykpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hQcm9wZXJ0eShub2RlLnByb3BlcnR5LCBub2RlLnZhbHVlKTsKICAgIH0KICAgIG1hdGNoUHJvcGVydHkocHJvcGVydHlOYW1lLCB2YWx1ZSkgewogICAgICAgIC8vIGRvbid0IG1hdGNoIHN5bnRheCBmb3IgYSBjdXN0b20gcHJvcGVydHkgYXQgdGhlIG1vbWVudAogICAgICAgIGlmIChwcm9wZXJ0eShwcm9wZXJ0eU5hbWUpLmN1c3RvbSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgRXJyb3IoJ0xleGVyIG1hdGNoaW5nIGRvZXNuXCd0IGFwcGxpY2FibGUgZm9yIGN1c3RvbSBwcm9wZXJ0aWVzJykpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLmNoZWNrUHJvcGVydHlOYW1lKHByb3BlcnR5TmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hTeW50YXgodGhpcywgdGhpcy5nZXRQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpLCB2YWx1ZSwgdHJ1ZSk7CiAgICB9CiAgICBtYXRjaFR5cGUodHlwZU5hbWUsIHZhbHVlKSB7CiAgICAgICAgY29uc3QgdHlwZVN5bnRheCA9IHRoaXMuZ2V0VHlwZSh0eXBlTmFtZSk7CgogICAgICAgIGlmICghdHlwZVN5bnRheCkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gdHlwZScsIHR5cGVOYW1lKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hTeW50YXgodGhpcywgdHlwZVN5bnRheCwgdmFsdWUsIGZhbHNlKTsKICAgIH0KICAgIG1hdGNoKHN5bnRheCwgdmFsdWUpIHsKICAgICAgICBpZiAodHlwZW9mIHN5bnRheCAhPT0gJ3N0cmluZycgJiYgKCFzeW50YXggfHwgIXN5bnRheC50eXBlKSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ0JhZCBzeW50YXgnKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHN5bnRheCA9PT0gJ3N0cmluZycgfHwgIXN5bnRheC5tYXRjaCkgewogICAgICAgICAgICBzeW50YXggPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnVHlwZScsICdhbm9ueW1vdXMnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaFN5bnRheCh0aGlzLCBzeW50YXgsIHZhbHVlLCBmYWxzZSk7CiAgICB9CgogICAgZmluZFZhbHVlRnJhZ21lbnRzKHByb3BlcnR5TmFtZSwgdmFsdWUsIHR5cGUsIG5hbWUpIHsKICAgICAgICByZXR1cm4gbWF0Y2hGcmFnbWVudHModGhpcywgdmFsdWUsIHRoaXMubWF0Y2hQcm9wZXJ0eShwcm9wZXJ0eU5hbWUsIHZhbHVlKSwgdHlwZSwgbmFtZSk7CiAgICB9CiAgICBmaW5kRGVjbGFyYXRpb25WYWx1ZUZyYWdtZW50cyhkZWNsYXJhdGlvbiwgdHlwZSwgbmFtZSkgewogICAgICAgIHJldHVybiBtYXRjaEZyYWdtZW50cyh0aGlzLCBkZWNsYXJhdGlvbi52YWx1ZSwgdGhpcy5tYXRjaERlY2xhcmF0aW9uKGRlY2xhcmF0aW9uKSwgdHlwZSwgbmFtZSk7CiAgICB9CiAgICBmaW5kQWxsRnJhZ21lbnRzKGFzdCwgdHlwZSwgbmFtZSkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwoKICAgICAgICB0aGlzLnN5bnRheC53YWxrKGFzdCwgewogICAgICAgICAgICB2aXNpdDogJ0RlY2xhcmF0aW9uJywKICAgICAgICAgICAgZW50ZXI6IChkZWNsYXJhdGlvbikgPT4gewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2guYXBwbHkocmVzdWx0LCB0aGlzLmZpbmREZWNsYXJhdGlvblZhbHVlRnJhZ21lbnRzKGRlY2xhcmF0aW9uLCB0eXBlLCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBnZXRBdHJ1bGUoYXRydWxlTmFtZSwgZmFsbGJhY2tCYXNlbmFtZSA9IHRydWUpIHsKICAgICAgICBjb25zdCBhdHJ1bGUgPSBrZXl3b3JkKGF0cnVsZU5hbWUpOwogICAgICAgIGNvbnN0IGF0cnVsZUVudHJ5ID0gYXRydWxlLnZlbmRvciAmJiBmYWxsYmFja0Jhc2VuYW1lCiAgICAgICAgICAgID8gdGhpcy5hdHJ1bGVzW2F0cnVsZS5uYW1lXSB8fCB0aGlzLmF0cnVsZXNbYXRydWxlLmJhc2VuYW1lXQogICAgICAgICAgICA6IHRoaXMuYXRydWxlc1thdHJ1bGUubmFtZV07CgogICAgICAgIHJldHVybiBhdHJ1bGVFbnRyeSB8fCBudWxsOwogICAgfQogICAgZ2V0QXRydWxlUHJlbHVkZShhdHJ1bGVOYW1lLCBmYWxsYmFja0Jhc2VuYW1lID0gdHJ1ZSkgewogICAgICAgIGNvbnN0IGF0cnVsZSA9IHRoaXMuZ2V0QXRydWxlKGF0cnVsZU5hbWUsIGZhbGxiYWNrQmFzZW5hbWUpOwoKICAgICAgICByZXR1cm4gYXRydWxlICYmIGF0cnVsZS5wcmVsdWRlIHx8IG51bGw7CiAgICB9CiAgICBnZXRBdHJ1bGVEZXNjcmlwdG9yKGF0cnVsZU5hbWUsIG5hbWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hdHJ1bGVzLmhhc093blByb3BlcnR5KGF0cnVsZU5hbWUpICYmIHRoaXMuYXRydWxlcy5kZWNsYXJhdG9ycwogICAgICAgICAgICA/IHRoaXMuYXRydWxlc1thdHJ1bGVOYW1lXS5kZWNsYXJhdG9yc1tuYW1lXSB8fCBudWxsCiAgICAgICAgICAgIDogbnVsbDsKICAgIH0KICAgIGdldFByb3BlcnR5KHByb3BlcnR5TmFtZSwgZmFsbGJhY2tCYXNlbmFtZSA9IHRydWUpIHsKICAgICAgICBjb25zdCBwcm9wZXJ0eSQxID0gcHJvcGVydHkocHJvcGVydHlOYW1lKTsKICAgICAgICBjb25zdCBwcm9wZXJ0eUVudHJ5ID0gcHJvcGVydHkkMS52ZW5kb3IgJiYgZmFsbGJhY2tCYXNlbmFtZQogICAgICAgICAgICA/IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLm5hbWVdIHx8IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLmJhc2VuYW1lXQogICAgICAgICAgICA6IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLm5hbWVdOwoKICAgICAgICByZXR1cm4gcHJvcGVydHlFbnRyeSB8fCBudWxsOwogICAgfQogICAgZ2V0VHlwZShuYW1lKSB7CiAgICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwodGhpcy50eXBlcywgbmFtZSkgPyB0aGlzLnR5cGVzW25hbWVdIDogbnVsbDsKICAgIH0KCiAgICB2YWxpZGF0ZSgpIHsKICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShzeW50YXgsIG5hbWUsIGJyb2tlbiwgZGVzY3JpcHRvcikgewogICAgICAgICAgICBpZiAoYnJva2VuLmhhcyhuYW1lKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyb2tlbi5nZXQobmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyb2tlbi5zZXQobmFtZSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoZGVzY3JpcHRvci5zeW50YXggIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHdhbGskMShkZXNjcmlwdG9yLnN5bnRheCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgIT09ICdUeXBlJyAmJiBub2RlLnR5cGUgIT09ICdQcm9wZXJ0eScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwID0gbm9kZS50eXBlID09PSAnVHlwZScgPyBzeW50YXgudHlwZXMgOiBzeW50YXgucHJvcGVydGllczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBicm9rZW5NYXAgPSBub2RlLnR5cGUgPT09ICdUeXBlJyA/IGJyb2tlblR5cGVzIDogYnJva2VuUHJvcGVydGllczsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKG1hcCwgbm9kZS5uYW1lKSB8fCB2YWxpZGF0ZShzeW50YXgsIG5vZGUubmFtZSwgYnJva2VuTWFwLCBtYXBbbm9kZS5uYW1lXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJva2VuLnNldChuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV0IGJyb2tlblR5cGVzID0gbmV3IE1hcCgpOwogICAgICAgIGxldCBicm9rZW5Qcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwoKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnR5cGVzKSB7CiAgICAgICAgICAgIHZhbGlkYXRlKHRoaXMsIGtleSwgYnJva2VuVHlwZXMsIHRoaXMudHlwZXNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdmFsaWRhdGUodGhpcywga2V5LCBicm9rZW5Qcm9wZXJ0aWVzLCB0aGlzLnByb3BlcnRpZXNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICBicm9rZW5UeXBlcyA9IFsuLi5icm9rZW5UeXBlcy5rZXlzKCldLmZpbHRlcihuYW1lID0+IGJyb2tlblR5cGVzLmdldChuYW1lKSk7CiAgICAgICAgYnJva2VuUHJvcGVydGllcyA9IFsuLi5icm9rZW5Qcm9wZXJ0aWVzLmtleXMoKV0uZmlsdGVyKG5hbWUgPT4gYnJva2VuUHJvcGVydGllcy5nZXQobmFtZSkpOwoKICAgICAgICBpZiAoYnJva2VuVHlwZXMubGVuZ3RoIHx8IGJyb2tlblByb3BlcnRpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlczogYnJva2VuVHlwZXMsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBicm9rZW5Qcm9wZXJ0aWVzCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGR1bXAoc3ludGF4QXNBc3QsIHByZXR0eSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdlbmVyaWM6IHRoaXMuZ2VuZXJpYywKICAgICAgICAgICAgdW5pdHM6IHRoaXMudW5pdHMsCiAgICAgICAgICAgIHR5cGVzOiBkdW1wTWFwU3ludGF4KHRoaXMudHlwZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KSwKICAgICAgICAgICAgcHJvcGVydGllczogZHVtcE1hcFN5bnRheCh0aGlzLnByb3BlcnRpZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KSwKICAgICAgICAgICAgYXRydWxlczogZHVtcEF0cnVsZU1hcFN5bnRheCh0aGlzLmF0cnVsZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KQogICAgICAgIH07CiAgICB9CiAgICB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5kdW1wKCkpOwogICAgfQp9CgpmdW5jdGlvbiBhcHBlbmRPclNldChhLCBiKSB7CiAgICBpZiAodHlwZW9mIGIgPT09ICdzdHJpbmcnICYmIC9eXHMqXHwvLnRlc3QoYikpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGEgPT09ICdzdHJpbmcnCiAgICAgICAgICAgID8gYSArIGIKICAgICAgICAgICAgOiBiLnJlcGxhY2UoL15ccypcfFxzKi8sICcnKTsKICAgIH0KCiAgICByZXR1cm4gYiB8fCBudWxsOwp9CgpmdW5jdGlvbiBzbGljZVByb3BzKG9iaiwgcHJvcHMpIHsKICAgIGNvbnN0IHJlc3VsdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkgewogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXModmFsdWUpKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvcHMuaW5jbHVkZXMocHJvcCkpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XVtwcm9wXSA9IHZhbHVlW3Byb3BdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIG1peChkZXN0LCBzcmMpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHsgLi4uZGVzdCB9OwoKICAgIGZvciAoY29uc3QgW3Byb3AsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzcmMpKSB7CiAgICAgICAgc3dpdGNoIChwcm9wKSB7CiAgICAgICAgICAgIGNhc2UgJ2dlbmVyaWMnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0gQm9vbGVhbih2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3VuaXRzJzoKICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IHsgLi4uZGVzdFtwcm9wXSB9OwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgcGF0Y2hdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXVtuYW1lXSA9IEFycmF5LmlzQXJyYXkocGF0Y2gpID8gcGF0Y2ggOiBbXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnYXRydWxlcyc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7IC4uLmRlc3RbcHJvcF0gfTsKCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBhdHJ1bGVdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0cyA9IHJlc3VsdFtwcm9wXVtuYW1lXSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gcmVzdWx0W3Byb3BdW25hbWVdID0gewogICAgICAgICAgICAgICAgICAgICAgICBwcmVsdWRlOiBleGlzdHMucHJlbHVkZSB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdG9yczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RzLmRlc2NyaXB0b3JzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWF0cnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQucHJlbHVkZSA9IGF0cnVsZS5wcmVsdWRlCiAgICAgICAgICAgICAgICAgICAgICAgID8gYXBwZW5kT3JTZXQoY3VycmVudC5wcmVsdWRlLCBhdHJ1bGUucHJlbHVkZSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBjdXJyZW50LnByZWx1ZGUgfHwgbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbZGVzY3JpcHRvck5hbWUsIGRlc2NyaXB0b3JWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYXRydWxlLmRlc2NyaXB0b3JzIHx8IHt9KSkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3JOYW1lXSA9IGRlc2NyaXB0b3JWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBhcHBlbmRPclNldChjdXJyZW50LmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3JOYW1lXSwgZGVzY3JpcHRvclZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhjdXJyZW50LmRlc2NyaXB0b3JzKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5kZXNjcmlwdG9ycyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICd0eXBlcyc6CiAgICAgICAgICAgIGNhc2UgJ3Byb3BlcnRpZXMnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0geyAuLi5kZXN0W3Byb3BdIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBzeW50YXhdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXVtuYW1lXSA9IGFwcGVuZE9yU2V0KHJlc3VsdFtwcm9wXVtuYW1lXSwgc3ludGF4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnc2NvcGUnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0geyAuLi5kZXN0W3Byb3BdIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBwcm9wc10gb2YgT2JqZWN0LmVudHJpZXModmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdW25hbWVdID0geyAuLi5yZXN1bHRbcHJvcF1bbmFtZV0sIC4uLnByb3BzIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3BhcnNlQ29udGV4dCc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7CiAgICAgICAgICAgICAgICAgICAgLi4uZGVzdFtwcm9wXSwKICAgICAgICAgICAgICAgICAgICAuLi52YWx1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnYXRydWxlJzoKICAgICAgICAgICAgY2FzZSAncHNldWRvJzoKICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IHsKICAgICAgICAgICAgICAgICAgICAuLi5kZXN0W3Byb3BdLAogICAgICAgICAgICAgICAgICAgIC4uLnNsaWNlUHJvcHModmFsdWUsIFsncGFyc2UnXSkgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnbm9kZSc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7CiAgICAgICAgICAgICAgICAgICAgLi4uZGVzdFtwcm9wXSwKICAgICAgICAgICAgICAgICAgICAuLi5zbGljZVByb3BzKHZhbHVlLCBbJ25hbWUnLCAnc3RydWN0dXJlJywgJ3BhcnNlJywgJ2dlbmVyYXRlJywgJ3dhbGtDb250ZXh0J10pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVN5bnRheChjb25maWcpIHsKICAgIGNvbnN0IHBhcnNlID0gY3JlYXRlUGFyc2VyKGNvbmZpZyk7CiAgICBjb25zdCB3YWxrID0gY3JlYXRlV2Fsa2VyKGNvbmZpZyk7CiAgICBjb25zdCBnZW5lcmF0ZSA9IGNyZWF0ZUdlbmVyYXRvcihjb25maWcpOwogICAgY29uc3QgeyBmcm9tUGxhaW5PYmplY3QsIHRvUGxhaW5PYmplY3QgfSA9IGNyZWF0ZUNvbnZlcnRvcih3YWxrKTsKCiAgICBjb25zdCBzeW50YXggPSB7CiAgICAgICAgbGV4ZXI6IG51bGwsCiAgICAgICAgY3JlYXRlTGV4ZXI6IGNvbmZpZyA9PiBuZXcgTGV4ZXIoY29uZmlnLCBzeW50YXgsIHN5bnRheC5sZXhlci5zdHJ1Y3R1cmUpLAoKICAgICAgICB0b2tlbml6ZTogdG9rZW5pemUkMSwKICAgICAgICBwYXJzZSwKICAgICAgICBnZW5lcmF0ZSwKCiAgICAgICAgd2FsaywKICAgICAgICBmaW5kOiB3YWxrLmZpbmQsCiAgICAgICAgZmluZExhc3Q6IHdhbGsuZmluZExhc3QsCiAgICAgICAgZmluZEFsbDogd2Fsay5maW5kQWxsLAoKICAgICAgICBmcm9tUGxhaW5PYmplY3QsCiAgICAgICAgdG9QbGFpbk9iamVjdCwKCiAgICAgICAgZm9yayhleHRlbnNpb24pIHsKICAgICAgICAgICAgY29uc3QgYmFzZSA9IG1peCh7fSwgY29uZmlnKTsgLy8gY29weSBvZiBjb25maWcKCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVTeW50YXgoCiAgICAgICAgICAgICAgICB0eXBlb2YgZXh0ZW5zaW9uID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgICAgICAgPyBleHRlbnNpb24oYmFzZSwgT2JqZWN0LmFzc2lnbikKICAgICAgICAgICAgICAgICAgICA6IG1peChiYXNlLCBleHRlbnNpb24pCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfTsKCiAgICBzeW50YXgubGV4ZXIgPSBuZXcgTGV4ZXIoewogICAgICAgIGdlbmVyaWM6IHRydWUsCiAgICAgICAgdW5pdHM6IGNvbmZpZy51bml0cywKICAgICAgICB0eXBlczogY29uZmlnLnR5cGVzLAogICAgICAgIGF0cnVsZXM6IGNvbmZpZy5hdHJ1bGVzLAogICAgICAgIHByb3BlcnRpZXM6IGNvbmZpZy5wcm9wZXJ0aWVzLAogICAgICAgIG5vZGU6IGNvbmZpZy5ub2RlCiAgICB9LCBzeW50YXgpOwoKICAgIHJldHVybiBzeW50YXg7Cn0KY29uc3QgY3JlYXRlU3ludGF4JDEgPSBjb25maWcgPT4gY3JlYXRlU3ludGF4KG1peCh7fSwgY29uZmlnKSk7Cgpjb25zdCBkZWZpbml0aW9ucyA9IHsKICAgICJnZW5lcmljIjogdHJ1ZSwKICAgICJ1bml0cyI6IHsKICAgICAgICAiYW5nbGUiOiBbCiAgICAgICAgICAgICJkZWciLAogICAgICAgICAgICAiZ3JhZCIsCiAgICAgICAgICAgICJyYWQiLAogICAgICAgICAgICAidHVybiIKICAgICAgICBdLAogICAgICAgICJkZWNpYmVsIjogWwogICAgICAgICAgICAiZGIiCiAgICAgICAgXSwKICAgICAgICAiZmxleCI6IFsKICAgICAgICAgICAgImZyIgogICAgICAgIF0sCiAgICAgICAgImZyZXF1ZW5jeSI6IFsKICAgICAgICAgICAgImh6IiwKICAgICAgICAgICAgImtoeiIKICAgICAgICBdLAogICAgICAgICJsZW5ndGgiOiBbCiAgICAgICAgICAgICJjbSIsCiAgICAgICAgICAgICJtbSIsCiAgICAgICAgICAgICJxIiwKICAgICAgICAgICAgImluIiwKICAgICAgICAgICAgInB0IiwKICAgICAgICAgICAgInBjIiwKICAgICAgICAgICAgInB4IiwKICAgICAgICAgICAgImVtIiwKICAgICAgICAgICAgInJlbSIsCiAgICAgICAgICAgICJleCIsCiAgICAgICAgICAgICJyZXgiLAogICAgICAgICAgICAiY2FwIiwKICAgICAgICAgICAgInJjYXAiLAogICAgICAgICAgICAiY2giLAogICAgICAgICAgICAicmNoIiwKICAgICAgICAgICAgImljIiwKICAgICAgICAgICAgInJpYyIsCiAgICAgICAgICAgICJsaCIsCiAgICAgICAgICAgICJybGgiLAogICAgICAgICAgICAidnciLAogICAgICAgICAgICAic3Z3IiwKICAgICAgICAgICAgImx2dyIsCiAgICAgICAgICAgICJkdnciLAogICAgICAgICAgICAidmgiLAogICAgICAgICAgICAic3ZoIiwKICAgICAgICAgICAgImx2aCIsCiAgICAgICAgICAgICJkdmgiLAogICAgICAgICAgICAidmkiLAogICAgICAgICAgICAic3ZpIiwKICAgICAgICAgICAgImx2aSIsCiAgICAgICAgICAgICJkdmkiLAogICAgICAgICAgICAidmIiLAogICAgICAgICAgICAic3ZiIiwKICAgICAgICAgICAgImx2YiIsCiAgICAgICAgICAgICJkdmIiLAogICAgICAgICAgICAidm1pbiIsCiAgICAgICAgICAgICJzdm1pbiIsCiAgICAgICAgICAgICJsdm1pbiIsCiAgICAgICAgICAgICJkdm1pbiIsCiAgICAgICAgICAgICJ2bWF4IiwKICAgICAgICAgICAgInN2bWF4IiwKICAgICAgICAgICAgImx2bWF4IiwKICAgICAgICAgICAgImR2bWF4IiwKICAgICAgICAgICAgImNxdyIsCiAgICAgICAgICAgICJjcWgiLAogICAgICAgICAgICAiY3FpIiwKICAgICAgICAgICAgImNxYiIsCiAgICAgICAgICAgICJjcW1pbiIsCiAgICAgICAgICAgICJjcW1heCIKICAgICAgICBdLAogICAgICAgICJyZXNvbHV0aW9uIjogWwogICAgICAgICAgICAiZHBpIiwKICAgICAgICAgICAgImRwY20iLAogICAgICAgICAgICAiZHBweCIsCiAgICAgICAgICAgICJ4IgogICAgICAgIF0sCiAgICAgICAgInNlbWl0b25lcyI6IFsKICAgICAgICAgICAgInN0IgogICAgICAgIF0sCiAgICAgICAgInRpbWUiOiBbCiAgICAgICAgICAgICJzIiwKICAgICAgICAgICAgIm1zIgogICAgICAgIF0KICAgIH0sCiAgICAidHlwZXMiOiB7CiAgICAgICAgImFicygpIjogImFicyggPGNhbGMtc3VtPiApIiwKICAgICAgICAiYWJzb2x1dGUtc2l6ZSI6ICJ4eC1zbWFsbHx4LXNtYWxsfHNtYWxsfG1lZGl1bXxsYXJnZXx4LWxhcmdlfHh4LWxhcmdlfHh4eC1sYXJnZSIsCiAgICAgICAgImFjb3MoKSI6ICJhY29zKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJhbHBoYS12YWx1ZSI6ICI8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJhbmdsZS1wZXJjZW50YWdlIjogIjxhbmdsZT58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAiYW5ndWxhci1jb2xvci1oaW50IjogIjxhbmdsZS1wZXJjZW50YWdlPiIsCiAgICAgICAgImFuZ3VsYXItY29sb3Itc3RvcCI6ICI8Y29sb3I+JiY8Y29sb3Itc3RvcC1hbmdsZT4/IiwKICAgICAgICAiYW5ndWxhci1jb2xvci1zdG9wLWxpc3QiOiAiWzxhbmd1bGFyLWNvbG9yLXN0b3A+IFssIDxhbmd1bGFyLWNvbG9yLWhpbnQ+XT9dIyAsIDxhbmd1bGFyLWNvbG9yLXN0b3A+IiwKICAgICAgICAiYW5pbWF0ZWFibGUtZmVhdHVyZSI6ICJzY3JvbGwtcG9zaXRpb258Y29udGVudHN8PGN1c3RvbS1pZGVudD4iLAogICAgICAgICJhc2luKCkiOiAiYXNpbiggPGNhbGMtc3VtPiApIiwKICAgICAgICAiYXRhbigpIjogImF0YW4oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgImF0YW4yKCkiOiAiYXRhbjIoIDxjYWxjLXN1bT4gLCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJhdHRhY2htZW50IjogInNjcm9sbHxmaXhlZHxsb2NhbCIsCiAgICAgICAgImF0dHIoKSI6ICJhdHRyKCA8YXR0ci1uYW1lPiA8dHlwZS1vci11bml0Pj8gWywgPGF0dHItZmFsbGJhY2s+XT8gKSIsCiAgICAgICAgImF0dHItbWF0Y2hlciI6ICJbJ34nfCd8J3wnXid8JyQnfCcqJ10/ICc9JyIsCiAgICAgICAgImF0dHItbW9kaWZpZXIiOiAiaXxzIiwKICAgICAgICAiYXR0cmlidXRlLXNlbGVjdG9yIjogIidbJyA8d3EtbmFtZT4gJ10nfCdbJyA8d3EtbmFtZT4gPGF0dHItbWF0Y2hlcj4gWzxzdHJpbmctdG9rZW4+fDxpZGVudC10b2tlbj5dIDxhdHRyLW1vZGlmaWVyPj8gJ10nIiwKICAgICAgICAiYXV0by1yZXBlYXQiOiAicmVwZWF0KCBbYXV0by1maWxsfGF1dG8tZml0XSAsIFs8bGluZS1uYW1lcz4/IDxmaXhlZC1zaXplPl0rIDxsaW5lLW5hbWVzPj8gKSIsCiAgICAgICAgImF1dG8tdHJhY2stbGlzdCI6ICJbPGxpbmUtbmFtZXM+PyBbPGZpeGVkLXNpemU+fDxmaXhlZC1yZXBlYXQ+XV0qIDxsaW5lLW5hbWVzPj8gPGF1dG8tcmVwZWF0PiBbPGxpbmUtbmFtZXM+PyBbPGZpeGVkLXNpemU+fDxmaXhlZC1yZXBlYXQ+XV0qIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJheGlzIjogImJsb2NrfGlubGluZXx2ZXJ0aWNhbHxob3Jpem9udGFsIiwKICAgICAgICAiYmFzZWxpbmUtcG9zaXRpb24iOiAiW2ZpcnN0fGxhc3RdPyBiYXNlbGluZSIsCiAgICAgICAgImJhc2ljLXNoYXBlIjogIjxpbnNldCgpPnw8Y2lyY2xlKCk+fDxlbGxpcHNlKCk+fDxwb2x5Z29uKCk+fDxwYXRoKCk+IiwKICAgICAgICAiYmctaW1hZ2UiOiAibm9uZXw8aW1hZ2U+IiwKICAgICAgICAiYmctbGF5ZXIiOiAiPGJnLWltYWdlPnx8PGJnLXBvc2l0aW9uPiBbLyA8Ymctc2l6ZT5dP3x8PHJlcGVhdC1zdHlsZT58fDxhdHRhY2htZW50Pnx8PGJveD58fDxib3g+IiwKICAgICAgICAiYmctcG9zaXRpb24iOiAiW1tsZWZ0fGNlbnRlcnxyaWdodHx0b3B8Ym90dG9tfDxsZW5ndGgtcGVyY2VudGFnZT5dfFtsZWZ0fGNlbnRlcnxyaWdodHw8bGVuZ3RoLXBlcmNlbnRhZ2U+XSBbdG9wfGNlbnRlcnxib3R0b218PGxlbmd0aC1wZXJjZW50YWdlPl18W2NlbnRlcnxbbGVmdHxyaWdodF0gPGxlbmd0aC1wZXJjZW50YWdlPj9dJiZbY2VudGVyfFt0b3B8Ym90dG9tXSA8bGVuZ3RoLXBlcmNlbnRhZ2U+P11dIiwKICAgICAgICAiYmctc2l6ZSI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxhdXRvXXsxLDJ9fGNvdmVyfGNvbnRhaW4iLAogICAgICAgICJibHVyKCkiOiAiYmx1ciggPGxlbmd0aD4gKSIsCiAgICAgICAgImJsZW5kLW1vZGUiOiAibm9ybWFsfG11bHRpcGx5fHNjcmVlbnxvdmVybGF5fGRhcmtlbnxsaWdodGVufGNvbG9yLWRvZGdlfGNvbG9yLWJ1cm58aGFyZC1saWdodHxzb2Z0LWxpZ2h0fGRpZmZlcmVuY2V8ZXhjbHVzaW9ufGh1ZXxzYXR1cmF0aW9ufGNvbG9yfGx1bWlub3NpdHkiLAogICAgICAgICJib3giOiAiYm9yZGVyLWJveHxwYWRkaW5nLWJveHxjb250ZW50LWJveCIsCiAgICAgICAgImJyaWdodG5lc3MoKSI6ICJicmlnaHRuZXNzKCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJjYWxjKCkiOiAiY2FsYyggPGNhbGMtc3VtPiApIiwKICAgICAgICAiY2FsYy1zdW0iOiAiPGNhbGMtcHJvZHVjdD4gW1snKyd8Jy0nXSA8Y2FsYy1wcm9kdWN0Pl0qIiwKICAgICAgICAiY2FsYy1wcm9kdWN0IjogIjxjYWxjLXZhbHVlPiBbJyonIDxjYWxjLXZhbHVlPnwnLycgPG51bWJlcj5dKiIsCiAgICAgICAgImNhbGMtdmFsdWUiOiAiPG51bWJlcj58PGRpbWVuc2lvbj58PHBlcmNlbnRhZ2U+fDxjYWxjLWNvbnN0YW50PnwoIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgImNhbGMtY29uc3RhbnQiOiAiZXxwaXxpbmZpbml0eXwtaW5maW5pdHl8TmFOIiwKICAgICAgICAiY2YtZmluYWwtaW1hZ2UiOiAiPGltYWdlPnw8Y29sb3I+IiwKICAgICAgICAiY2YtbWl4aW5nLWltYWdlIjogIjxwZXJjZW50YWdlPj8mJjxpbWFnZT4iLAogICAgICAgICJjaXJjbGUoKSI6ICJjaXJjbGUoIFs8c2hhcGUtcmFkaXVzPl0/IFthdCA8cG9zaXRpb24+XT8gKSIsCiAgICAgICAgImNsYW1wKCkiOiAiY2xhbXAoIDxjYWxjLXN1bT4jezN9ICkiLAogICAgICAgICJjbGFzcy1zZWxlY3RvciI6ICInLicgPGlkZW50LXRva2VuPiIsCiAgICAgICAgImNsaXAtc291cmNlIjogIjx1cmw+IiwKICAgICAgICAiY29sb3IiOiAiPHJnYigpPnw8cmdiYSgpPnw8aHNsKCk+fDxoc2xhKCk+fDxod2IoKT58PGxhYigpPnw8bGNoKCk+fDxoZXgtY29sb3I+fDxuYW1lZC1jb2xvcj58Y3VycmVudGNvbG9yfDxkZXByZWNhdGVkLXN5c3RlbS1jb2xvcj4iLAogICAgICAgICJjb2xvci1zdG9wIjogIjxjb2xvci1zdG9wLWxlbmd0aD58PGNvbG9yLXN0b3AtYW5nbGU+IiwKICAgICAgICAiY29sb3Itc3RvcC1hbmdsZSI6ICI8YW5nbGUtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImNvbG9yLXN0b3AtbGVuZ3RoIjogIjxsZW5ndGgtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImNvbG9yLXN0b3AtbGlzdCI6ICJbPGxpbmVhci1jb2xvci1zdG9wPiBbLCA8bGluZWFyLWNvbG9yLWhpbnQ+XT9dIyAsIDxsaW5lYXItY29sb3Itc3RvcD4iLAogICAgICAgICJjb21iaW5hdG9yIjogIic+J3wnKyd8J34nfFsnfHwnXSIsCiAgICAgICAgImNvbW1vbi1saWctdmFsdWVzIjogIltjb21tb24tbGlnYXR1cmVzfG5vLWNvbW1vbi1saWdhdHVyZXNdIiwKICAgICAgICAiY29tcGF0LWF1dG8iOiAic2VhcmNoZmllbGR8dGV4dGFyZWF8cHVzaC1idXR0b258c2xpZGVyLWhvcml6b250YWx8Y2hlY2tib3h8cmFkaW98c3F1YXJlLWJ1dHRvbnxtZW51bGlzdHxsaXN0Ym94fG1ldGVyfHByb2dyZXNzLWJhcnxidXR0b24iLAogICAgICAgICJjb21wb3NpdGUtc3R5bGUiOiAiY2xlYXJ8Y29weXxzb3VyY2Utb3Zlcnxzb3VyY2UtaW58c291cmNlLW91dHxzb3VyY2UtYXRvcHxkZXN0aW5hdGlvbi1vdmVyfGRlc3RpbmF0aW9uLWlufGRlc3RpbmF0aW9uLW91dHxkZXN0aW5hdGlvbi1hdG9wfHhvciIsCiAgICAgICAgImNvbXBvc2l0aW5nLW9wZXJhdG9yIjogImFkZHxzdWJ0cmFjdHxpbnRlcnNlY3R8ZXhjbHVkZSIsCiAgICAgICAgImNvbXBvdW5kLXNlbGVjdG9yIjogIls8dHlwZS1zZWxlY3Rvcj4/IDxzdWJjbGFzcy1zZWxlY3Rvcj4qIFs8cHNldWRvLWVsZW1lbnQtc2VsZWN0b3I+IDxwc2V1ZG8tY2xhc3Mtc2VsZWN0b3I+Kl0qXSEiLAogICAgICAgICJjb21wb3VuZC1zZWxlY3Rvci1saXN0IjogIjxjb21wb3VuZC1zZWxlY3Rvcj4jIiwKICAgICAgICAiY29tcGxleC1zZWxlY3RvciI6ICI8Y29tcG91bmQtc2VsZWN0b3I+IFs8Y29tYmluYXRvcj4/IDxjb21wb3VuZC1zZWxlY3Rvcj5dKiIsCiAgICAgICAgImNvbXBsZXgtc2VsZWN0b3ItbGlzdCI6ICI8Y29tcGxleC1zZWxlY3Rvcj4jIiwKICAgICAgICAiY29uaWMtZ3JhZGllbnQoKSI6ICJjb25pYy1ncmFkaWVudCggW2Zyb20gPGFuZ2xlPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8YW5ndWxhci1jb2xvci1zdG9wLWxpc3Q+ICkiLAogICAgICAgICJjb250ZXh0dWFsLWFsdC12YWx1ZXMiOiAiW2NvbnRleHR1YWx8bm8tY29udGV4dHVhbF0iLAogICAgICAgICJjb250ZW50LWRpc3RyaWJ1dGlvbiI6ICJzcGFjZS1iZXR3ZWVufHNwYWNlLWFyb3VuZHxzcGFjZS1ldmVubHl8c3RyZXRjaCIsCiAgICAgICAgImNvbnRlbnQtbGlzdCI6ICJbPHN0cmluZz58Y29udGVudHN8PGltYWdlPnw8Y291bnRlcj58PHF1b3RlPnw8dGFyZ2V0Pnw8bGVhZGVyKCk+fDxhdHRyKCk+XSsiLAogICAgICAgICJjb250ZW50LXBvc2l0aW9uIjogImNlbnRlcnxzdGFydHxlbmR8ZmxleC1zdGFydHxmbGV4LWVuZCIsCiAgICAgICAgImNvbnRlbnQtcmVwbGFjZW1lbnQiOiAiPGltYWdlPiIsCiAgICAgICAgImNvbnRyYXN0KCkiOiAiY29udHJhc3QoIFs8bnVtYmVyLXBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAiY29zKCkiOiAiY29zKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJjb3VudGVyIjogIjxjb3VudGVyKCk+fDxjb3VudGVycygpPiIsCiAgICAgICAgImNvdW50ZXIoKSI6ICJjb3VudGVyKCA8Y291bnRlci1uYW1lPiAsIDxjb3VudGVyLXN0eWxlPj8gKSIsCiAgICAgICAgImNvdW50ZXItbmFtZSI6ICI8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgImNvdW50ZXItc3R5bGUiOiAiPGNvdW50ZXItc3R5bGUtbmFtZT58c3ltYm9scyggKSIsCiAgICAgICAgImNvdW50ZXItc3R5bGUtbmFtZSI6ICI8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgImNvdW50ZXJzKCkiOiAiY291bnRlcnMoIDxjb3VudGVyLW5hbWU+ICwgPHN0cmluZz4gLCA8Y291bnRlci1zdHlsZT4/ICkiLAogICAgICAgICJjcm9zcy1mYWRlKCkiOiAiY3Jvc3MtZmFkZSggPGNmLW1peGluZy1pbWFnZT4gLCA8Y2YtZmluYWwtaW1hZ2U+PyApIiwKICAgICAgICAiY3ViaWMtYmV6aWVyLXRpbWluZy1mdW5jdGlvbiI6ICJlYXNlfGVhc2UtaW58ZWFzZS1vdXR8ZWFzZS1pbi1vdXR8Y3ViaWMtYmV6aWVyKCA8bnVtYmVyIFswLDFdPiAsIDxudW1iZXI+ICwgPG51bWJlciBbMCwxXT4gLCA8bnVtYmVyPiApIiwKICAgICAgICAiZGVwcmVjYXRlZC1zeXN0ZW0tY29sb3IiOiAiQWN0aXZlQm9yZGVyfEFjdGl2ZUNhcHRpb258QXBwV29ya3NwYWNlfEJhY2tncm91bmR8QnV0dG9uRmFjZXxCdXR0b25IaWdobGlnaHR8QnV0dG9uU2hhZG93fEJ1dHRvblRleHR8Q2FwdGlvblRleHR8R3JheVRleHR8SGlnaGxpZ2h0fEhpZ2hsaWdodFRleHR8SW5hY3RpdmVCb3JkZXJ8SW5hY3RpdmVDYXB0aW9ufEluYWN0aXZlQ2FwdGlvblRleHR8SW5mb0JhY2tncm91bmR8SW5mb1RleHR8TWVudXxNZW51VGV4dHxTY3JvbGxiYXJ8VGhyZWVERGFya1NoYWRvd3xUaHJlZURGYWNlfFRocmVlREhpZ2hsaWdodHxUaHJlZURMaWdodFNoYWRvd3xUaHJlZURTaGFkb3d8V2luZG93fFdpbmRvd0ZyYW1lfFdpbmRvd1RleHQiLAogICAgICAgICJkaXNjcmV0aW9uYXJ5LWxpZy12YWx1ZXMiOiAiW2Rpc2NyZXRpb25hcnktbGlnYXR1cmVzfG5vLWRpc2NyZXRpb25hcnktbGlnYXR1cmVzXSIsCiAgICAgICAgImRpc3BsYXktYm94IjogImNvbnRlbnRzfG5vbmUiLAogICAgICAgICJkaXNwbGF5LWluc2lkZSI6ICJmbG93fGZsb3ctcm9vdHx0YWJsZXxmbGV4fGdyaWR8cnVieSIsCiAgICAgICAgImRpc3BsYXktaW50ZXJuYWwiOiAidGFibGUtcm93LWdyb3VwfHRhYmxlLWhlYWRlci1ncm91cHx0YWJsZS1mb290ZXItZ3JvdXB8dGFibGUtcm93fHRhYmxlLWNlbGx8dGFibGUtY29sdW1uLWdyb3VwfHRhYmxlLWNvbHVtbnx0YWJsZS1jYXB0aW9ufHJ1YnktYmFzZXxydWJ5LXRleHR8cnVieS1iYXNlLWNvbnRhaW5lcnxydWJ5LXRleHQtY29udGFpbmVyIiwKICAgICAgICAiZGlzcGxheS1sZWdhY3kiOiAiaW5saW5lLWJsb2NrfGlubGluZS1saXN0LWl0ZW18aW5saW5lLXRhYmxlfGlubGluZS1mbGV4fGlubGluZS1ncmlkIiwKICAgICAgICAiZGlzcGxheS1saXN0aXRlbSI6ICI8ZGlzcGxheS1vdXRzaWRlPj8mJltmbG93fGZsb3ctcm9vdF0/JiZsaXN0LWl0ZW0iLAogICAgICAgICJkaXNwbGF5LW91dHNpZGUiOiAiYmxvY2t8aW5saW5lfHJ1bi1pbiIsCiAgICAgICAgImRyb3Atc2hhZG93KCkiOiAiZHJvcC1zaGFkb3coIDxsZW5ndGg+ezIsM30gPGNvbG9yPj8gKSIsCiAgICAgICAgImVhc3QtYXNpYW4tdmFyaWFudC12YWx1ZXMiOiAiW2ppczc4fGppczgzfGppczkwfGppczA0fHNpbXBsaWZpZWR8dHJhZGl0aW9uYWxdIiwKICAgICAgICAiZWFzdC1hc2lhbi13aWR0aC12YWx1ZXMiOiAiW2Z1bGwtd2lkdGh8cHJvcG9ydGlvbmFsLXdpZHRoXSIsCiAgICAgICAgImVsZW1lbnQoKSI6ICJlbGVtZW50KCA8Y3VzdG9tLWlkZW50PiAsIFtmaXJzdHxzdGFydHxsYXN0fGZpcnN0LWV4Y2VwdF0/ICl8ZWxlbWVudCggPGlkLXNlbGVjdG9yPiApIiwKICAgICAgICAiZWxsaXBzZSgpIjogImVsbGlwc2UoIFs8c2hhcGUtcmFkaXVzPnsyfV0/IFthdCA8cG9zaXRpb24+XT8gKSIsCiAgICAgICAgImVuZGluZy1zaGFwZSI6ICJjaXJjbGV8ZWxsaXBzZSIsCiAgICAgICAgImVudigpIjogImVudiggPGN1c3RvbS1pZGVudD4gLCA8ZGVjbGFyYXRpb24tdmFsdWU+PyApIiwKICAgICAgICAiZXhwKCkiOiAiZXhwKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJleHBsaWNpdC10cmFjay1saXN0IjogIls8bGluZS1uYW1lcz4/IDx0cmFjay1zaXplPl0rIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJmYW1pbHktbmFtZSI6ICI8c3RyaW5nPnw8Y3VzdG9tLWlkZW50PisiLAogICAgICAgICJmZWF0dXJlLXRhZy12YWx1ZSI6ICI8c3RyaW5nPiBbPGludGVnZXI+fG9ufG9mZl0/IiwKICAgICAgICAiZmVhdHVyZS10eXBlIjogIkBzdHlsaXN0aWN8QGhpc3RvcmljYWwtZm9ybXN8QHN0eWxlc2V0fEBjaGFyYWN0ZXItdmFyaWFudHxAc3dhc2h8QG9ybmFtZW50c3xAYW5ub3RhdGlvbiIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtYmxvY2siOiAiPGZlYXR1cmUtdHlwZT4gJ3snIDxmZWF0dXJlLXZhbHVlLWRlY2xhcmF0aW9uLWxpc3Q+ICd9JyIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtYmxvY2stbGlzdCI6ICI8ZmVhdHVyZS12YWx1ZS1ibG9jaz4rIiwKICAgICAgICAiZmVhdHVyZS12YWx1ZS1kZWNsYXJhdGlvbiI6ICI8Y3VzdG9tLWlkZW50PiA6IDxpbnRlZ2VyPisgOyIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtZGVjbGFyYXRpb24tbGlzdCI6ICI8ZmVhdHVyZS12YWx1ZS1kZWNsYXJhdGlvbj4iLAogICAgICAgICJmZWF0dXJlLXZhbHVlLW5hbWUiOiAiPGN1c3RvbS1pZGVudD4iLAogICAgICAgICJmaWxsLXJ1bGUiOiAibm9uemVyb3xldmVub2RkIiwKICAgICAgICAiZmlsdGVyLWZ1bmN0aW9uIjogIjxibHVyKCk+fDxicmlnaHRuZXNzKCk+fDxjb250cmFzdCgpPnw8ZHJvcC1zaGFkb3coKT58PGdyYXlzY2FsZSgpPnw8aHVlLXJvdGF0ZSgpPnw8aW52ZXJ0KCk+fDxvcGFjaXR5KCk+fDxzYXR1cmF0ZSgpPnw8c2VwaWEoKT4iLAogICAgICAgICJmaWx0ZXItZnVuY3Rpb24tbGlzdCI6ICJbPGZpbHRlci1mdW5jdGlvbj58PHVybD5dKyIsCiAgICAgICAgImZpbmFsLWJnLWxheWVyIjogIjwnYmFja2dyb3VuZC1jb2xvcic+fHw8YmctaW1hZ2U+fHw8YmctcG9zaXRpb24+IFsvIDxiZy1zaXplPl0/fHw8cmVwZWF0LXN0eWxlPnx8PGF0dGFjaG1lbnQ+fHw8Ym94Pnx8PGJveD4iLAogICAgICAgICJmaXhlZC1icmVhZHRoIjogIjxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJmaXhlZC1yZXBlYXQiOiAicmVwZWF0KCBbPGludGVnZXIgWzEs4oieXT5dICwgWzxsaW5lLW5hbWVzPj8gPGZpeGVkLXNpemU+XSsgPGxpbmUtbmFtZXM+PyApIiwKICAgICAgICAiZml4ZWQtc2l6ZSI6ICI8Zml4ZWQtYnJlYWR0aD58bWlubWF4KCA8Zml4ZWQtYnJlYWR0aD4gLCA8dHJhY2stYnJlYWR0aD4gKXxtaW5tYXgoIDxpbmZsZXhpYmxlLWJyZWFkdGg+ICwgPGZpeGVkLWJyZWFkdGg+ICkiLAogICAgICAgICJmb250LXN0cmV0Y2gtYWJzb2x1dGUiOiAibm9ybWFsfHVsdHJhLWNvbmRlbnNlZHxleHRyYS1jb25kZW5zZWR8Y29uZGVuc2VkfHNlbWktY29uZGVuc2VkfHNlbWktZXhwYW5kZWR8ZXhwYW5kZWR8ZXh0cmEtZXhwYW5kZWR8dWx0cmEtZXhwYW5kZWR8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAiZm9udC12YXJpYW50LWNzczIxIjogIltub3JtYWx8c21hbGwtY2Fwc10iLAogICAgICAgICJmb250LXdlaWdodC1hYnNvbHV0ZSI6ICJub3JtYWx8Ym9sZHw8bnVtYmVyIFsxLDEwMDBdPiIsCiAgICAgICAgImZyZXF1ZW5jeS1wZXJjZW50YWdlIjogIjxmcmVxdWVuY3k+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgImdlbmVyYWwtZW5jbG9zZWQiOiAiWzxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4gKV18KCA8aWRlbnQ+IDxhbnktdmFsdWU+ICkiLAogICAgICAgICJnZW5lcmljLWZhbWlseSI6ICJzZXJpZnxzYW5zLXNlcmlmfGN1cnNpdmV8ZmFudGFzeXxtb25vc3BhY2V8LWFwcGxlLXN5c3RlbSIsCiAgICAgICAgImdlbmVyaWMtbmFtZSI6ICJzZXJpZnxzYW5zLXNlcmlmfGN1cnNpdmV8ZmFudGFzeXxtb25vc3BhY2UiLAogICAgICAgICJnZW9tZXRyeS1ib3giOiAiPHNoYXBlLWJveD58ZmlsbC1ib3h8c3Ryb2tlLWJveHx2aWV3LWJveCIsCiAgICAgICAgImdyYWRpZW50IjogIjxsaW5lYXItZ3JhZGllbnQoKT58PHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoKT58PHJhZGlhbC1ncmFkaWVudCgpPnw8cmVwZWF0aW5nLXJhZGlhbC1ncmFkaWVudCgpPnw8Y29uaWMtZ3JhZGllbnQoKT58PHJlcGVhdGluZy1jb25pYy1ncmFkaWVudCgpPnw8LWxlZ2FjeS1ncmFkaWVudD4iLAogICAgICAgICJncmF5c2NhbGUoKSI6ICJncmF5c2NhbGUoIDxudW1iZXItcGVyY2VudGFnZT4gKSIsCiAgICAgICAgImdyaWQtbGluZSI6ICJhdXRvfDxjdXN0b20taWRlbnQ+fFs8aW50ZWdlcj4mJjxjdXN0b20taWRlbnQ+P118W3NwYW4mJls8aW50ZWdlcj58fDxjdXN0b20taWRlbnQ+XV0iLAogICAgICAgICJoaXN0b3JpY2FsLWxpZy12YWx1ZXMiOiAiW2hpc3RvcmljYWwtbGlnYXR1cmVzfG5vLWhpc3RvcmljYWwtbGlnYXR1cmVzXSIsCiAgICAgICAgImhzbCgpIjogImhzbCggPGh1ZT4gPHBlcmNlbnRhZ2U+IDxwZXJjZW50YWdlPiBbLyA8YWxwaGEtdmFsdWU+XT8gKXxoc2woIDxodWU+ICwgPHBlcmNlbnRhZ2U+ICwgPHBlcmNlbnRhZ2U+ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgImhzbGEoKSI6ICJoc2xhKCA8aHVlPiA8cGVyY2VudGFnZT4gPHBlcmNlbnRhZ2U+IFsvIDxhbHBoYS12YWx1ZT5dPyApfGhzbGEoIDxodWU+ICwgPHBlcmNlbnRhZ2U+ICwgPHBlcmNlbnRhZ2U+ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgImh1ZSI6ICI8bnVtYmVyPnw8YW5nbGU+IiwKICAgICAgICAiaHVlLXJvdGF0ZSgpIjogImh1ZS1yb3RhdGUoIDxhbmdsZT4gKSIsCiAgICAgICAgImh3YigpIjogImh3YiggWzxodWU+fG5vbmVdIFs8cGVyY2VudGFnZT58bm9uZV0gWzxwZXJjZW50YWdlPnxub25lXSBbLyBbPGFscGhhLXZhbHVlPnxub25lXV0/ICkiLAogICAgICAgICJoeXBvdCgpIjogImh5cG90KCA8Y2FsYy1zdW0+IyApIiwKICAgICAgICAiaW1hZ2UiOiAiPHVybD58PGltYWdlKCk+fDxpbWFnZS1zZXQoKT58PGVsZW1lbnQoKT58PHBhaW50KCk+fDxjcm9zcy1mYWRlKCk+fDxncmFkaWVudD4iLAogICAgICAgICJpbWFnZSgpIjogImltYWdlKCA8aW1hZ2UtdGFncz4/IFs8aW1hZ2Utc3JjPj8gLCA8Y29sb3I+P10hICkiLAogICAgICAgICJpbWFnZS1zZXQoKSI6ICJpbWFnZS1zZXQoIDxpbWFnZS1zZXQtb3B0aW9uPiMgKSIsCiAgICAgICAgImltYWdlLXNldC1vcHRpb24iOiAiWzxpbWFnZT58PHN0cmluZz5dIFs8cmVzb2x1dGlvbj58fHR5cGUoIDxzdHJpbmc+ICldIiwKICAgICAgICAiaW1hZ2Utc3JjIjogIjx1cmw+fDxzdHJpbmc+IiwKICAgICAgICAiaW1hZ2UtdGFncyI6ICJsdHJ8cnRsIiwKICAgICAgICAiaW5mbGV4aWJsZS1icmVhZHRoIjogIjxsZW5ndGgtcGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0byIsCiAgICAgICAgImluc2V0KCkiOiAiaW5zZXQoIDxsZW5ndGgtcGVyY2VudGFnZT57MSw0fSBbcm91bmQgPCdib3JkZXItcmFkaXVzJz5dPyApIiwKICAgICAgICAiaW52ZXJ0KCkiOiAiaW52ZXJ0KCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJrZXlmcmFtZXMtbmFtZSI6ICI8Y3VzdG9tLWlkZW50Pnw8c3RyaW5nPiIsCiAgICAgICAgImtleWZyYW1lLWJsb2NrIjogIjxrZXlmcmFtZS1zZWxlY3Rvcj4jIHsgPGRlY2xhcmF0aW9uLWxpc3Q+IH0iLAogICAgICAgICJrZXlmcmFtZS1ibG9jay1saXN0IjogIjxrZXlmcmFtZS1ibG9jaz4rIiwKICAgICAgICAia2V5ZnJhbWUtc2VsZWN0b3IiOiAiZnJvbXx0b3w8cGVyY2VudGFnZT4iLAogICAgICAgICJsYWIoKSI6ICJsYWIoIFs8cGVyY2VudGFnZT58PG51bWJlcj58bm9uZV0gWzxwZXJjZW50YWdlPnw8bnVtYmVyPnxub25lXSBbPHBlcmNlbnRhZ2U+fDxudW1iZXI+fG5vbmVdIFsvIFs8YWxwaGEtdmFsdWU+fG5vbmVdXT8gKSIsCiAgICAgICAgImxheWVyKCkiOiAibGF5ZXIoIDxsYXllci1uYW1lPiApIiwKICAgICAgICAibGF5ZXItbmFtZSI6ICI8aWRlbnQ+IFsnLicgPGlkZW50Pl0qIiwKICAgICAgICAibGNoKCkiOiAibGNoKCBbPHBlcmNlbnRhZ2U+fDxudW1iZXI+fG5vbmVdIFs8cGVyY2VudGFnZT58PG51bWJlcj58bm9uZV0gWzxodWU+fG5vbmVdIFsvIFs8YWxwaGEtdmFsdWU+fG5vbmVdXT8gKSIsCiAgICAgICAgImxlYWRlcigpIjogImxlYWRlciggPGxlYWRlci10eXBlPiApIiwKICAgICAgICAibGVhZGVyLXR5cGUiOiAiZG90dGVkfHNvbGlkfHNwYWNlfDxzdHJpbmc+IiwKICAgICAgICAibGVuZ3RoLXBlcmNlbnRhZ2UiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAibGluZS1uYW1lcyI6ICInWycgPGN1c3RvbS1pZGVudD4qICddJyIsCiAgICAgICAgImxpbmUtbmFtZS1saXN0IjogIls8bGluZS1uYW1lcz58PG5hbWUtcmVwZWF0Pl0rIiwKICAgICAgICAibGluZS1zdHlsZSI6ICJub25lfGhpZGRlbnxkb3R0ZWR8ZGFzaGVkfHNvbGlkfGRvdWJsZXxncm9vdmV8cmlkZ2V8aW5zZXR8b3V0c2V0IiwKICAgICAgICAibGluZS13aWR0aCI6ICI8bGVuZ3RoPnx0aGlufG1lZGl1bXx0aGljayIsCiAgICAgICAgImxpbmVhci1jb2xvci1oaW50IjogIjxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJsaW5lYXItY29sb3Itc3RvcCI6ICI8Y29sb3I+IDxjb2xvci1zdG9wLWxlbmd0aD4/IiwKICAgICAgICAibGluZWFyLWdyYWRpZW50KCkiOiAibGluZWFyLWdyYWRpZW50KCBbPGFuZ2xlPnx0byA8c2lkZS1vci1jb3JuZXI+XT8gLCA8Y29sb3Itc3RvcC1saXN0PiApIiwKICAgICAgICAibG9nKCkiOiAibG9nKCA8Y2FsYy1zdW0+ICwgPGNhbGMtc3VtPj8gKSIsCiAgICAgICAgIm1hc2stbGF5ZXIiOiAiPG1hc2stcmVmZXJlbmNlPnx8PHBvc2l0aW9uPiBbLyA8Ymctc2l6ZT5dP3x8PHJlcGVhdC1zdHlsZT58fDxnZW9tZXRyeS1ib3g+fHxbPGdlb21ldHJ5LWJveD58bm8tY2xpcF18fDxjb21wb3NpdGluZy1vcGVyYXRvcj58fDxtYXNraW5nLW1vZGU+IiwKICAgICAgICAibWFzay1wb3NpdGlvbiI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodF0gWzxsZW5ndGgtcGVyY2VudGFnZT58dG9wfGNlbnRlcnxib3R0b21dPyIsCiAgICAgICAgIm1hc2stcmVmZXJlbmNlIjogIm5vbmV8PGltYWdlPnw8bWFzay1zb3VyY2U+IiwKICAgICAgICAibWFzay1zb3VyY2UiOiAiPHVybD4iLAogICAgICAgICJtYXNraW5nLW1vZGUiOiAiYWxwaGF8bHVtaW5hbmNlfG1hdGNoLXNvdXJjZSIsCiAgICAgICAgIm1hdHJpeCgpIjogIm1hdHJpeCggPG51bWJlcj4jezZ9ICkiLAogICAgICAgICJtYXRyaXgzZCgpIjogIm1hdHJpeDNkKCA8bnVtYmVyPiN7MTZ9ICkiLAogICAgICAgICJtYXgoKSI6ICJtYXgoIDxjYWxjLXN1bT4jICkiLAogICAgICAgICJtZWRpYS1hbmQiOiAiPG1lZGlhLWluLXBhcmVucz4gW2FuZCA8bWVkaWEtaW4tcGFyZW5zPl0rIiwKICAgICAgICAibWVkaWEtY29uZGl0aW9uIjogIjxtZWRpYS1ub3Q+fDxtZWRpYS1hbmQ+fDxtZWRpYS1vcj58PG1lZGlhLWluLXBhcmVucz4iLAogICAgICAgICJtZWRpYS1jb25kaXRpb24td2l0aG91dC1vciI6ICI8bWVkaWEtbm90Pnw8bWVkaWEtYW5kPnw8bWVkaWEtaW4tcGFyZW5zPiIsCiAgICAgICAgIm1lZGlhLWZlYXR1cmUiOiAiKCBbPG1mLXBsYWluPnw8bWYtYm9vbGVhbj58PG1mLXJhbmdlPl0gKSIsCiAgICAgICAgIm1lZGlhLWluLXBhcmVucyI6ICIoIDxtZWRpYS1jb25kaXRpb24+ICl8PG1lZGlhLWZlYXR1cmU+fDxnZW5lcmFsLWVuY2xvc2VkPiIsCiAgICAgICAgIm1lZGlhLW5vdCI6ICJub3QgPG1lZGlhLWluLXBhcmVucz4iLAogICAgICAgICJtZWRpYS1vciI6ICI8bWVkaWEtaW4tcGFyZW5zPiBbb3IgPG1lZGlhLWluLXBhcmVucz5dKyIsCiAgICAgICAgIm1lZGlhLXF1ZXJ5IjogIjxtZWRpYS1jb25kaXRpb24+fFtub3R8b25seV0/IDxtZWRpYS10eXBlPiBbYW5kIDxtZWRpYS1jb25kaXRpb24td2l0aG91dC1vcj5dPyIsCiAgICAgICAgIm1lZGlhLXF1ZXJ5LWxpc3QiOiAiPG1lZGlhLXF1ZXJ5PiMiLAogICAgICAgICJtZWRpYS10eXBlIjogIjxpZGVudD4iLAogICAgICAgICJtZi1ib29sZWFuIjogIjxtZi1uYW1lPiIsCiAgICAgICAgIm1mLW5hbWUiOiAiPGlkZW50PiIsCiAgICAgICAgIm1mLXBsYWluIjogIjxtZi1uYW1lPiA6IDxtZi12YWx1ZT4iLAogICAgICAgICJtZi1yYW5nZSI6ICI8bWYtbmFtZT4gWyc8J3wnPiddPyAnPSc/IDxtZi12YWx1ZT58PG1mLXZhbHVlPiBbJzwnfCc+J10/ICc9Jz8gPG1mLW5hbWU+fDxtZi12YWx1ZT4gJzwnICc9Jz8gPG1mLW5hbWU+ICc8JyAnPSc/IDxtZi12YWx1ZT58PG1mLXZhbHVlPiAnPicgJz0nPyA8bWYtbmFtZT4gJz4nICc9Jz8gPG1mLXZhbHVlPiIsCiAgICAgICAgIm1mLXZhbHVlIjogIjxudW1iZXI+fDxkaW1lbnNpb24+fDxpZGVudD58PHJhdGlvPiIsCiAgICAgICAgIm1pbigpIjogIm1pbiggPGNhbGMtc3VtPiMgKSIsCiAgICAgICAgIm1pbm1heCgpIjogIm1pbm1heCggWzxsZW5ndGgtcGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0b10gLCBbPGxlbmd0aC1wZXJjZW50YWdlPnw8ZmxleD58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0b10gKSIsCiAgICAgICAgIm1vZCgpIjogIm1vZCggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgIm5hbWUtcmVwZWF0IjogInJlcGVhdCggWzxpbnRlZ2VyIFsxLOKInl0+fGF1dG8tZmlsbF0gLCA8bGluZS1uYW1lcz4rICkiLAogICAgICAgICJuYW1lZC1jb2xvciI6ICJ0cmFuc3BhcmVudHxhbGljZWJsdWV8YW50aXF1ZXdoaXRlfGFxdWF8YXF1YW1hcmluZXxhenVyZXxiZWlnZXxiaXNxdWV8YmxhY2t8YmxhbmNoZWRhbG1vbmR8Ymx1ZXxibHVldmlvbGV0fGJyb3dufGJ1cmx5d29vZHxjYWRldGJsdWV8Y2hhcnRyZXVzZXxjaG9jb2xhdGV8Y29yYWx8Y29ybmZsb3dlcmJsdWV8Y29ybnNpbGt8Y3JpbXNvbnxjeWFufGRhcmtibHVlfGRhcmtjeWFufGRhcmtnb2xkZW5yb2R8ZGFya2dyYXl8ZGFya2dyZWVufGRhcmtncmV5fGRhcmtraGFraXxkYXJrbWFnZW50YXxkYXJrb2xpdmVncmVlbnxkYXJrb3JhbmdlfGRhcmtvcmNoaWR8ZGFya3JlZHxkYXJrc2FsbW9ufGRhcmtzZWFncmVlbnxkYXJrc2xhdGVibHVlfGRhcmtzbGF0ZWdyYXl8ZGFya3NsYXRlZ3JleXxkYXJrdHVycXVvaXNlfGRhcmt2aW9sZXR8ZGVlcHBpbmt8ZGVlcHNreWJsdWV8ZGltZ3JheXxkaW1ncmV5fGRvZGdlcmJsdWV8ZmlyZWJyaWNrfGZsb3JhbHdoaXRlfGZvcmVzdGdyZWVufGZ1Y2hzaWF8Z2FpbnNib3JvfGdob3N0d2hpdGV8Z29sZHxnb2xkZW5yb2R8Z3JheXxncmVlbnxncmVlbnllbGxvd3xncmV5fGhvbmV5ZGV3fGhvdHBpbmt8aW5kaWFucmVkfGluZGlnb3xpdm9yeXxraGFraXxsYXZlbmRlcnxsYXZlbmRlcmJsdXNofGxhd25ncmVlbnxsZW1vbmNoaWZmb258bGlnaHRibHVlfGxpZ2h0Y29yYWx8bGlnaHRjeWFufGxpZ2h0Z29sZGVucm9keWVsbG93fGxpZ2h0Z3JheXxsaWdodGdyZWVufGxpZ2h0Z3JleXxsaWdodHBpbmt8bGlnaHRzYWxtb258bGlnaHRzZWFncmVlbnxsaWdodHNreWJsdWV8bGlnaHRzbGF0ZWdyYXl8bGlnaHRzbGF0ZWdyZXl8bGlnaHRzdGVlbGJsdWV8bGlnaHR5ZWxsb3d8bGltZXxsaW1lZ3JlZW58bGluZW58bWFnZW50YXxtYXJvb258bWVkaXVtYXF1YW1hcmluZXxtZWRpdW1ibHVlfG1lZGl1bW9yY2hpZHxtZWRpdW1wdXJwbGV8bWVkaXVtc2VhZ3JlZW58bWVkaXVtc2xhdGVibHVlfG1lZGl1bXNwcmluZ2dyZWVufG1lZGl1bXR1cnF1b2lzZXxtZWRpdW12aW9sZXRyZWR8bWlkbmlnaHRibHVlfG1pbnRjcmVhbXxtaXN0eXJvc2V8bW9jY2FzaW58bmF2YWpvd2hpdGV8bmF2eXxvbGRsYWNlfG9saXZlfG9saXZlZHJhYnxvcmFuZ2V8b3JhbmdlcmVkfG9yY2hpZHxwYWxlZ29sZGVucm9kfHBhbGVncmVlbnxwYWxldHVycXVvaXNlfHBhbGV2aW9sZXRyZWR8cGFwYXlhd2hpcHxwZWFjaHB1ZmZ8cGVydXxwaW5rfHBsdW18cG93ZGVyYmx1ZXxwdXJwbGV8cmViZWNjYXB1cnBsZXxyZWR8cm9zeWJyb3dufHJveWFsYmx1ZXxzYWRkbGVicm93bnxzYWxtb258c2FuZHlicm93bnxzZWFncmVlbnxzZWFzaGVsbHxzaWVubmF8c2lsdmVyfHNreWJsdWV8c2xhdGVibHVlfHNsYXRlZ3JheXxzbGF0ZWdyZXl8c25vd3xzcHJpbmdncmVlbnxzdGVlbGJsdWV8dGFufHRlYWx8dGhpc3RsZXx0b21hdG98dHVycXVvaXNlfHZpb2xldHx3aGVhdHx3aGl0ZXx3aGl0ZXNtb2tlfHllbGxvd3x5ZWxsb3dncmVlbnw8LW5vbi1zdGFuZGFyZC1jb2xvcj4iLAogICAgICAgICJuYW1lc3BhY2UtcHJlZml4IjogIjxpZGVudD4iLAogICAgICAgICJucy1wcmVmaXgiOiAiWzxpZGVudC10b2tlbj58JyonXT8gJ3wnIiwKICAgICAgICAibnVtYmVyLXBlcmNlbnRhZ2UiOiAiPG51bWJlcj58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAibnVtZXJpYy1maWd1cmUtdmFsdWVzIjogIltsaW5pbmctbnVtc3xvbGRzdHlsZS1udW1zXSIsCiAgICAgICAgIm51bWVyaWMtZnJhY3Rpb24tdmFsdWVzIjogIltkaWFnb25hbC1mcmFjdGlvbnN8c3RhY2tlZC1mcmFjdGlvbnNdIiwKICAgICAgICAibnVtZXJpYy1zcGFjaW5nLXZhbHVlcyI6ICJbcHJvcG9ydGlvbmFsLW51bXN8dGFidWxhci1udW1zXSIsCiAgICAgICAgIm50aCI6ICI8YW4tcGx1cy1iPnxldmVufG9kZCIsCiAgICAgICAgIm9wYWNpdHkoKSI6ICJvcGFjaXR5KCBbPG51bWJlci1wZXJjZW50YWdlPl0gKSIsCiAgICAgICAgIm92ZXJmbG93LXBvc2l0aW9uIjogInVuc2FmZXxzYWZlIiwKICAgICAgICAib3V0bGluZS1yYWRpdXMiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAicGFnZS1ib2R5IjogIjxkZWNsYXJhdGlvbj4/IFs7IDxwYWdlLWJvZHk+XT98PHBhZ2UtbWFyZ2luLWJveD4gPHBhZ2UtYm9keT4iLAogICAgICAgICJwYWdlLW1hcmdpbi1ib3giOiAiPHBhZ2UtbWFyZ2luLWJveC10eXBlPiAneycgPGRlY2xhcmF0aW9uLWxpc3Q+ICd9JyIsCiAgICAgICAgInBhZ2UtbWFyZ2luLWJveC10eXBlIjogIkB0b3AtbGVmdC1jb3JuZXJ8QHRvcC1sZWZ0fEB0b3AtY2VudGVyfEB0b3AtcmlnaHR8QHRvcC1yaWdodC1jb3JuZXJ8QGJvdHRvbS1sZWZ0LWNvcm5lcnxAYm90dG9tLWxlZnR8QGJvdHRvbS1jZW50ZXJ8QGJvdHRvbS1yaWdodHxAYm90dG9tLXJpZ2h0LWNvcm5lcnxAbGVmdC10b3B8QGxlZnQtbWlkZGxlfEBsZWZ0LWJvdHRvbXxAcmlnaHQtdG9wfEByaWdodC1taWRkbGV8QHJpZ2h0LWJvdHRvbSIsCiAgICAgICAgInBhZ2Utc2VsZWN0b3ItbGlzdCI6ICJbPHBhZ2Utc2VsZWN0b3I+I10/IiwKICAgICAgICAicGFnZS1zZWxlY3RvciI6ICI8cHNldWRvLXBhZ2U+K3w8aWRlbnQ+IDxwc2V1ZG8tcGFnZT4qIiwKICAgICAgICAicGFnZS1zaXplIjogIkE1fEE0fEEzfEI1fEI0fEpJUy1CNXxKSVMtQjR8bGV0dGVyfGxlZ2FsfGxlZGdlciIsCiAgICAgICAgInBhdGgoKSI6ICJwYXRoKCBbPGZpbGwtcnVsZT4gLF0/IDxzdHJpbmc+ICkiLAogICAgICAgICJwYWludCgpIjogInBhaW50KCA8aWRlbnQ+ICwgPGRlY2xhcmF0aW9uLXZhbHVlPj8gKSIsCiAgICAgICAgInBlcnNwZWN0aXZlKCkiOiAicGVyc3BlY3RpdmUoIFs8bGVuZ3RoIFswLOKInl0+fG5vbmVdICkiLAogICAgICAgICJwb2x5Z29uKCkiOiAicG9seWdvbiggPGZpbGwtcnVsZT4/ICwgWzxsZW5ndGgtcGVyY2VudGFnZT4gPGxlbmd0aC1wZXJjZW50YWdlPl0jICkiLAogICAgICAgICJwb3NpdGlvbiI6ICJbW2xlZnR8Y2VudGVyfHJpZ2h0XXx8W3RvcHxjZW50ZXJ8Ym90dG9tXXxbbGVmdHxjZW50ZXJ8cmlnaHR8PGxlbmd0aC1wZXJjZW50YWdlPl0gW3RvcHxjZW50ZXJ8Ym90dG9tfDxsZW5ndGgtcGVyY2VudGFnZT5dP3xbW2xlZnR8cmlnaHRdIDxsZW5ndGgtcGVyY2VudGFnZT5dJiZbW3RvcHxib3R0b21dIDxsZW5ndGgtcGVyY2VudGFnZT5dXSIsCiAgICAgICAgInBvdygpIjogInBvdyggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInBzZXVkby1jbGFzcy1zZWxlY3RvciI6ICInOicgPGlkZW50LXRva2VuPnwnOicgPGZ1bmN0aW9uLXRva2VuPiA8YW55LXZhbHVlPiAnKSciLAogICAgICAgICJwc2V1ZG8tZWxlbWVudC1zZWxlY3RvciI6ICInOicgPHBzZXVkby1jbGFzcy1zZWxlY3Rvcj4iLAogICAgICAgICJwc2V1ZG8tcGFnZSI6ICI6IFtsZWZ0fHJpZ2h0fGZpcnN0fGJsYW5rXSIsCiAgICAgICAgInF1b3RlIjogIm9wZW4tcXVvdGV8Y2xvc2UtcXVvdGV8bm8tb3Blbi1xdW90ZXxuby1jbG9zZS1xdW90ZSIsCiAgICAgICAgInJhZGlhbC1ncmFkaWVudCgpIjogInJhZGlhbC1ncmFkaWVudCggWzxlbmRpbmctc2hhcGU+fHw8c2l6ZT5dPyBbYXQgPHBvc2l0aW9uPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4gKSIsCiAgICAgICAgInJhdGlvIjogIjxudW1iZXIgWzAs4oieXT4gWy8gPG51bWJlciBbMCziiJ5dPl0/IiwKICAgICAgICAicmVsYXRpdmUtc2VsZWN0b3IiOiAiPGNvbWJpbmF0b3I+PyA8Y29tcGxleC1zZWxlY3Rvcj4iLAogICAgICAgICJyZWxhdGl2ZS1zZWxlY3Rvci1saXN0IjogIjxyZWxhdGl2ZS1zZWxlY3Rvcj4jIiwKICAgICAgICAicmVsYXRpdmUtc2l6ZSI6ICJsYXJnZXJ8c21hbGxlciIsCiAgICAgICAgInJlbSgpIjogInJlbSggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInJlcGVhdC1zdHlsZSI6ICJyZXBlYXQteHxyZXBlYXQteXxbcmVwZWF0fHNwYWNlfHJvdW5kfG5vLXJlcGVhdF17MSwyfSIsCiAgICAgICAgInJlcGVhdGluZy1jb25pYy1ncmFkaWVudCgpIjogInJlcGVhdGluZy1jb25pYy1ncmFkaWVudCggW2Zyb20gPGFuZ2xlPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8YW5ndWxhci1jb2xvci1zdG9wLWxpc3Q+ICkiLAogICAgICAgICJyZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KCkiOiAicmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCggWzxhbmdsZT58dG8gPHNpZGUtb3ItY29ybmVyPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4gKSIsCiAgICAgICAgInJlcGVhdGluZy1yYWRpYWwtZ3JhZGllbnQoKSI6ICJyZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCBbPGVuZGluZy1zaGFwZT58fDxzaXplPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8Y29sb3Itc3RvcC1saXN0PiApIiwKICAgICAgICAicmV2ZXJzZWQtY291bnRlci1uYW1lIjogInJldmVyc2VkKCA8Y291bnRlci1uYW1lPiApIiwKICAgICAgICAicmdiKCkiOiAicmdiKCA8cGVyY2VudGFnZT57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiKCA8bnVtYmVyPnszfSBbLyA8YWxwaGEtdmFsdWU+XT8gKXxyZ2IoIDxwZXJjZW50YWdlPiN7M30gLCA8YWxwaGEtdmFsdWU+PyApfHJnYiggPG51bWJlcj4jezN9ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgInJnYmEoKSI6ICJyZ2JhKCA8cGVyY2VudGFnZT57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiYSggPG51bWJlcj57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiYSggPHBlcmNlbnRhZ2U+I3szfSAsIDxhbHBoYS12YWx1ZT4/ICl8cmdiYSggPG51bWJlcj4jezN9ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgInJvdGF0ZSgpIjogInJvdGF0ZSggWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm90YXRlM2QoKSI6ICJyb3RhdGUzZCggPG51bWJlcj4gLCA8bnVtYmVyPiAsIDxudW1iZXI+ICwgWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm90YXRlWCgpIjogInJvdGF0ZVgoIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInJvdGF0ZVkoKSI6ICJyb3RhdGVZKCBbPGFuZ2xlPnw8emVybz5dICkiLAogICAgICAgICJyb3RhdGVaKCkiOiAicm90YXRlWiggWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm91bmQoKSI6ICJyb3VuZCggPHJvdW5kaW5nLXN0cmF0ZWd5Pj8gLCA8Y2FsYy1zdW0+ICwgPGNhbGMtc3VtPiApIiwKICAgICAgICAicm91bmRpbmctc3RyYXRlZ3kiOiAibmVhcmVzdHx1cHxkb3dufHRvLXplcm8iLAogICAgICAgICJzYXR1cmF0ZSgpIjogInNhdHVyYXRlKCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJzY2FsZSgpIjogInNjYWxlKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSN7MSwyfSApIiwKICAgICAgICAic2NhbGUzZCgpIjogInNjYWxlM2QoIFs8bnVtYmVyPnw8cGVyY2VudGFnZT5dI3szfSApIiwKICAgICAgICAic2NhbGVYKCkiOiAic2NhbGVYKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2NhbGVZKCkiOiAic2NhbGVZKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2NhbGVaKCkiOiAic2NhbGVaKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2Nyb2xsZXIiOiAicm9vdHxuZWFyZXN0IiwKICAgICAgICAic2VsZi1wb3NpdGlvbiI6ICJjZW50ZXJ8c3RhcnR8ZW5kfHNlbGYtc3RhcnR8c2VsZi1lbmR8ZmxleC1zdGFydHxmbGV4LWVuZCIsCiAgICAgICAgInNoYXBlLXJhZGl1cyI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+fGNsb3Nlc3Qtc2lkZXxmYXJ0aGVzdC1zaWRlIiwKICAgICAgICAic2lnbigpIjogInNpZ24oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInNrZXcoKSI6ICJza2V3KCBbPGFuZ2xlPnw8emVybz5dICwgWzxhbmdsZT58PHplcm8+XT8gKSIsCiAgICAgICAgInNrZXdYKCkiOiAic2tld1goIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInNrZXdZKCkiOiAic2tld1koIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInNlcGlhKCkiOiAic2VwaWEoIDxudW1iZXItcGVyY2VudGFnZT4gKSIsCiAgICAgICAgInNoYWRvdyI6ICJpbnNldD8mJjxsZW5ndGg+ezIsNH0mJjxjb2xvcj4/IiwKICAgICAgICAic2hhZG93LXQiOiAiWzxsZW5ndGg+ezIsM30mJjxjb2xvcj4/XSIsCiAgICAgICAgInNoYXBlIjogInJlY3QoIDx0b3A+ICwgPHJpZ2h0PiAsIDxib3R0b20+ICwgPGxlZnQ+ICl8cmVjdCggPHRvcD4gPHJpZ2h0PiA8Ym90dG9tPiA8bGVmdD4gKSIsCiAgICAgICAgInNoYXBlLWJveCI6ICI8Ym94PnxtYXJnaW4tYm94IiwKICAgICAgICAic2lkZS1vci1jb3JuZXIiOiAiW2xlZnR8cmlnaHRdfHxbdG9wfGJvdHRvbV0iLAogICAgICAgICJzaW4oKSI6ICJzaW4oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInNpbmdsZS1hbmltYXRpb24iOiAiPHRpbWU+fHw8ZWFzaW5nLWZ1bmN0aW9uPnx8PHRpbWU+fHw8c2luZ2xlLWFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ+fHw8c2luZ2xlLWFuaW1hdGlvbi1kaXJlY3Rpb24+fHw8c2luZ2xlLWFuaW1hdGlvbi1maWxsLW1vZGU+fHw8c2luZ2xlLWFuaW1hdGlvbi1wbGF5LXN0YXRlPnx8W25vbmV8PGtleWZyYW1lcy1uYW1lPl0iLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLWRpcmVjdGlvbiI6ICJub3JtYWx8cmV2ZXJzZXxhbHRlcm5hdGV8YWx0ZXJuYXRlLXJldmVyc2UiLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLWZpbGwtbW9kZSI6ICJub25lfGZvcndhcmRzfGJhY2t3YXJkc3xib3RoIiwKICAgICAgICAic2luZ2xlLWFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQiOiAiaW5maW5pdGV8PG51bWJlcj4iLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLXBsYXktc3RhdGUiOiAicnVubmluZ3xwYXVzZWQiLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLXRpbWVsaW5lIjogImF1dG98bm9uZXw8dGltZWxpbmUtbmFtZT58c2Nyb2xsKCA8YXhpcz4/IDxzY3JvbGxlcj4/ICkiLAogICAgICAgICJzaW5nbGUtdHJhbnNpdGlvbiI6ICJbbm9uZXw8c2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHk+XXx8PHRpbWU+fHw8ZWFzaW5nLWZ1bmN0aW9uPnx8PHRpbWU+IiwKICAgICAgICAic2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHkiOiAiYWxsfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2l6ZSI6ICJjbG9zZXN0LXNpZGV8ZmFydGhlc3Qtc2lkZXxjbG9zZXN0LWNvcm5lcnxmYXJ0aGVzdC1jb3JuZXJ8PGxlbmd0aD58PGxlbmd0aC1wZXJjZW50YWdlPnsyfSIsCiAgICAgICAgInNxcnQoKSI6ICJzcXJ0KCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJzdGVwLXBvc2l0aW9uIjogImp1bXAtc3RhcnR8anVtcC1lbmR8anVtcC1ub25lfGp1bXAtYm90aHxzdGFydHxlbmQiLAogICAgICAgICJzdGVwLXRpbWluZy1mdW5jdGlvbiI6ICJzdGVwLXN0YXJ0fHN0ZXAtZW5kfHN0ZXBzKCA8aW50ZWdlcj4gWywgPHN0ZXAtcG9zaXRpb24+XT8gKSIsCiAgICAgICAgInN1YmNsYXNzLXNlbGVjdG9yIjogIjxpZC1zZWxlY3Rvcj58PGNsYXNzLXNlbGVjdG9yPnw8YXR0cmlidXRlLXNlbGVjdG9yPnw8cHNldWRvLWNsYXNzLXNlbGVjdG9yPiIsCiAgICAgICAgInN1cHBvcnRzLWNvbmRpdGlvbiI6ICJub3QgPHN1cHBvcnRzLWluLXBhcmVucz58PHN1cHBvcnRzLWluLXBhcmVucz4gW2FuZCA8c3VwcG9ydHMtaW4tcGFyZW5zPl0qfDxzdXBwb3J0cy1pbi1wYXJlbnM+IFtvciA8c3VwcG9ydHMtaW4tcGFyZW5zPl0qIiwKICAgICAgICAic3VwcG9ydHMtaW4tcGFyZW5zIjogIiggPHN1cHBvcnRzLWNvbmRpdGlvbj4gKXw8c3VwcG9ydHMtZmVhdHVyZT58PGdlbmVyYWwtZW5jbG9zZWQ+IiwKICAgICAgICAic3VwcG9ydHMtZmVhdHVyZSI6ICI8c3VwcG9ydHMtZGVjbD58PHN1cHBvcnRzLXNlbGVjdG9yLWZuPiIsCiAgICAgICAgInN1cHBvcnRzLWRlY2wiOiAiKCA8ZGVjbGFyYXRpb24+ICkiLAogICAgICAgICJzdXBwb3J0cy1zZWxlY3Rvci1mbiI6ICJzZWxlY3RvciggPGNvbXBsZXgtc2VsZWN0b3I+ICkiLAogICAgICAgICJzeW1ib2wiOiAiPHN0cmluZz58PGltYWdlPnw8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgInRhbigpIjogInRhbiggPGNhbGMtc3VtPiApIiwKICAgICAgICAidGFyZ2V0IjogIjx0YXJnZXQtY291bnRlcigpPnw8dGFyZ2V0LWNvdW50ZXJzKCk+fDx0YXJnZXQtdGV4dCgpPiIsCiAgICAgICAgInRhcmdldC1jb3VudGVyKCkiOiAidGFyZ2V0LWNvdW50ZXIoIFs8c3RyaW5nPnw8dXJsPl0gLCA8Y3VzdG9tLWlkZW50PiAsIDxjb3VudGVyLXN0eWxlPj8gKSIsCiAgICAgICAgInRhcmdldC1jb3VudGVycygpIjogInRhcmdldC1jb3VudGVycyggWzxzdHJpbmc+fDx1cmw+XSAsIDxjdXN0b20taWRlbnQ+ICwgPHN0cmluZz4gLCA8Y291bnRlci1zdHlsZT4/ICkiLAogICAgICAgICJ0YXJnZXQtdGV4dCgpIjogInRhcmdldC10ZXh0KCBbPHN0cmluZz58PHVybD5dICwgW2NvbnRlbnR8YmVmb3JlfGFmdGVyfGZpcnN0LWxldHRlcl0/ICkiLAogICAgICAgICJ0aW1lLXBlcmNlbnRhZ2UiOiAiPHRpbWU+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInRpbWVsaW5lLW5hbWUiOiAiPGN1c3RvbS1pZGVudD58PHN0cmluZz4iLAogICAgICAgICJlYXNpbmctZnVuY3Rpb24iOiAibGluZWFyfDxjdWJpYy1iZXppZXItdGltaW5nLWZ1bmN0aW9uPnw8c3RlcC10aW1pbmctZnVuY3Rpb24+IiwKICAgICAgICAidHJhY2stYnJlYWR0aCI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+fDxmbGV4PnxtaW4tY29udGVudHxtYXgtY29udGVudHxhdXRvIiwKICAgICAgICAidHJhY2stbGlzdCI6ICJbPGxpbmUtbmFtZXM+PyBbPHRyYWNrLXNpemU+fDx0cmFjay1yZXBlYXQ+XV0rIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJ0cmFjay1yZXBlYXQiOiAicmVwZWF0KCBbPGludGVnZXIgWzEs4oieXT5dICwgWzxsaW5lLW5hbWVzPj8gPHRyYWNrLXNpemU+XSsgPGxpbmUtbmFtZXM+PyApIiwKICAgICAgICAidHJhY2stc2l6ZSI6ICI8dHJhY2stYnJlYWR0aD58bWlubWF4KCA8aW5mbGV4aWJsZS1icmVhZHRoPiAsIDx0cmFjay1icmVhZHRoPiApfGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJ0cmFuc2Zvcm0tZnVuY3Rpb24iOiAiPG1hdHJpeCgpPnw8dHJhbnNsYXRlKCk+fDx0cmFuc2xhdGVYKCk+fDx0cmFuc2xhdGVZKCk+fDxzY2FsZSgpPnw8c2NhbGVYKCk+fDxzY2FsZVkoKT58PHJvdGF0ZSgpPnw8c2tldygpPnw8c2tld1goKT58PHNrZXdZKCk+fDxtYXRyaXgzZCgpPnw8dHJhbnNsYXRlM2QoKT58PHRyYW5zbGF0ZVooKT58PHNjYWxlM2QoKT58PHNjYWxlWigpPnw8cm90YXRlM2QoKT58PHJvdGF0ZVgoKT58PHJvdGF0ZVkoKT58PHJvdGF0ZVooKT58PHBlcnNwZWN0aXZlKCk+IiwKICAgICAgICAidHJhbnNmb3JtLWxpc3QiOiAiPHRyYW5zZm9ybS1mdW5jdGlvbj4rIiwKICAgICAgICAidHJhbnNsYXRlKCkiOiAidHJhbnNsYXRlKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aC1wZXJjZW50YWdlPj8gKSIsCiAgICAgICAgInRyYW5zbGF0ZTNkKCkiOiAidHJhbnNsYXRlM2QoIDxsZW5ndGgtcGVyY2VudGFnZT4gLCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aD4gKSIsCiAgICAgICAgInRyYW5zbGF0ZVgoKSI6ICJ0cmFuc2xhdGVYKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJ0cmFuc2xhdGVZKCkiOiAidHJhbnNsYXRlWSggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAidHJhbnNsYXRlWigpIjogInRyYW5zbGF0ZVooIDxsZW5ndGg+ICkiLAogICAgICAgICJ0eXBlLW9yLXVuaXQiOiAic3RyaW5nfGNvbG9yfHVybHxpbnRlZ2VyfG51bWJlcnxsZW5ndGh8YW5nbGV8dGltZXxmcmVxdWVuY3l8Y2FwfGNofGVtfGV4fGljfGxofHJsaHxyZW18dmJ8dml8dnd8dmh8dm1pbnx2bWF4fG1tfFF8Y218aW58cHR8cGN8cHh8ZGVnfGdyYWR8cmFkfHR1cm58bXN8c3xIenxrSHp8JSIsCiAgICAgICAgInR5cGUtc2VsZWN0b3IiOiAiPHdxLW5hbWU+fDxucy1wcmVmaXg+PyAnKiciLAogICAgICAgICJ2YXIoKSI6ICJ2YXIoIDxjdXN0b20tcHJvcGVydHktbmFtZT4gLCA8ZGVjbGFyYXRpb24tdmFsdWU+PyApIiwKICAgICAgICAidmlld3BvcnQtbGVuZ3RoIjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInZpc3VhbC1ib3giOiAiY29udGVudC1ib3h8cGFkZGluZy1ib3h8Ym9yZGVyLWJveCIsCiAgICAgICAgIndxLW5hbWUiOiAiPG5zLXByZWZpeD4/IDxpZGVudC10b2tlbj4iLAogICAgICAgICItbGVnYWN5LWdyYWRpZW50IjogIjwtd2Via2l0LWdyYWRpZW50KCk+fDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudD58PC1sZWdhY3ktcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudD58PC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50Pnw8LWxlZ2FjeS1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50PiIsCiAgICAgICAgIi1sZWdhY3ktbGluZWFyLWdyYWRpZW50IjogIi1tb3otbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC1vLWxpbmVhci1ncmFkaWVudCggPC1sZWdhY3ktbGluZWFyLWdyYWRpZW50LWFyZ3VtZW50cz4gKSIsCiAgICAgICAgIi1sZWdhY3ktcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCI6ICItbW96LXJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoIDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHM+ICl8LXdlYmtpdC1yZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC1vLXJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoIDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHM+ICkiLAogICAgICAgICItbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHMiOiAiWzxhbmdsZT58PHNpZGUtb3ItY29ybmVyPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4iLAogICAgICAgICItbGVnYWN5LXJhZGlhbC1ncmFkaWVudCI6ICItbW96LXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtd2Via2l0LXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtby1yYWRpYWwtZ3JhZGllbnQoIDwtbGVnYWN5LXJhZGlhbC1ncmFkaWVudC1hcmd1bWVudHM+ICkiLAogICAgICAgICItbGVnYWN5LXJlcGVhdGluZy1yYWRpYWwtZ3JhZGllbnQiOiAiLW1vei1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCA8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzPiApfC13ZWJraXQtcmVwZWF0aW5nLXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtby1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCA8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzPiApIiwKICAgICAgICAiLWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzIjogIls8cG9zaXRpb24+ICxdPyBbW1s8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2hhcGU+fHw8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2l6ZT5dfFs8bGVuZ3RoPnw8cGVyY2VudGFnZT5dezJ9XSAsXT8gPGNvbG9yLXN0b3AtbGlzdD4iLAogICAgICAgICItbGVnYWN5LXJhZGlhbC1ncmFkaWVudC1zaXplIjogImNsb3Nlc3Qtc2lkZXxjbG9zZXN0LWNvcm5lcnxmYXJ0aGVzdC1zaWRlfGZhcnRoZXN0LWNvcm5lcnxjb250YWlufGNvdmVyIiwKICAgICAgICAiLWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2hhcGUiOiAiY2lyY2xlfGVsbGlwc2UiLAogICAgICAgICItbm9uLXN0YW5kYXJkLWZvbnQiOiAiLWFwcGxlLXN5c3RlbS1ib2R5fC1hcHBsZS1zeXN0ZW0taGVhZGxpbmV8LWFwcGxlLXN5c3RlbS1zdWJoZWFkbGluZXwtYXBwbGUtc3lzdGVtLWNhcHRpb24xfC1hcHBsZS1zeXN0ZW0tY2FwdGlvbjJ8LWFwcGxlLXN5c3RlbS1mb290bm90ZXwtYXBwbGUtc3lzdGVtLXNob3J0LWJvZHl8LWFwcGxlLXN5c3RlbS1zaG9ydC1oZWFkbGluZXwtYXBwbGUtc3lzdGVtLXNob3J0LXN1YmhlYWRsaW5lfC1hcHBsZS1zeXN0ZW0tc2hvcnQtY2FwdGlvbjF8LWFwcGxlLXN5c3RlbS1zaG9ydC1mb290bm90ZXwtYXBwbGUtc3lzdGVtLXRhbGwtYm9keSIsCiAgICAgICAgIi1ub24tc3RhbmRhcmQtY29sb3IiOiAiLW1vei1CdXR0b25EZWZhdWx0fC1tb3otQnV0dG9uSG92ZXJGYWNlfC1tb3otQnV0dG9uSG92ZXJUZXh0fC1tb3otQ2VsbEhpZ2hsaWdodHwtbW96LUNlbGxIaWdobGlnaHRUZXh0fC1tb3otQ29tYm9ib3h8LW1vei1Db21ib2JveFRleHR8LW1vei1EaWFsb2d8LW1vei1EaWFsb2dUZXh0fC1tb3otZHJhZ3RhcmdldHpvbmV8LW1vei1FdmVuVHJlZVJvd3wtbW96LUZpZWxkfC1tb3otRmllbGRUZXh0fC1tb3otaHRtbC1DZWxsSGlnaGxpZ2h0fC1tb3otaHRtbC1DZWxsSGlnaGxpZ2h0VGV4dHwtbW96LW1hYy1hY2NlbnRkYXJrZXN0c2hhZG93fC1tb3otbWFjLWFjY2VudGRhcmtzaGFkb3d8LW1vei1tYWMtYWNjZW50ZmFjZXwtbW96LW1hYy1hY2NlbnRsaWdodGVzdGhpZ2hsaWdodHwtbW96LW1hYy1hY2NlbnRsaWdodHNoYWRvd3wtbW96LW1hYy1hY2NlbnRyZWd1bGFyaGlnaGxpZ2h0fC1tb3otbWFjLWFjY2VudHJlZ3VsYXJzaGFkb3d8LW1vei1tYWMtY2hyb21lLWFjdGl2ZXwtbW96LW1hYy1jaHJvbWUtaW5hY3RpdmV8LW1vei1tYWMtZm9jdXNyaW5nfC1tb3otbWFjLW1lbnVzZWxlY3R8LW1vei1tYWMtbWVudXNoYWRvd3wtbW96LW1hYy1tZW51dGV4dHNlbGVjdHwtbW96LU1lbnVIb3ZlcnwtbW96LU1lbnVIb3ZlclRleHR8LW1vei1NZW51QmFyVGV4dHwtbW96LU1lbnVCYXJIb3ZlclRleHR8LW1vei1uYXRpdmVoeXBlcmxpbmt0ZXh0fC1tb3otT2RkVHJlZVJvd3wtbW96LXdpbi1jb21tdW5pY2F0aW9uc3RleHR8LW1vei13aW4tbWVkaWF0ZXh0fC1tb3otYWN0aXZlaHlwZXJsaW5rdGV4dHwtbW96LWRlZmF1bHQtYmFja2dyb3VuZC1jb2xvcnwtbW96LWRlZmF1bHQtY29sb3J8LW1vei1oeXBlcmxpbmt0ZXh0fC1tb3otdmlzaXRlZGh5cGVybGlua3RleHR8LXdlYmtpdC1hY3RpdmVsaW5rfC13ZWJraXQtZm9jdXMtcmluZy1jb2xvcnwtd2Via2l0LWxpbmt8LXdlYmtpdC10ZXh0IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1pbWFnZS1yZW5kZXJpbmciOiAib3B0aW1pemUtY29udHJhc3R8LW1vei1jcmlzcC1lZGdlc3wtby1jcmlzcC1lZGdlc3wtd2Via2l0LW9wdGltaXplLWNvbnRyYXN0IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1vdmVyZmxvdyI6ICItbW96LXNjcm9sbGJhcnMtbm9uZXwtbW96LXNjcm9sbGJhcnMtaG9yaXpvbnRhbHwtbW96LXNjcm9sbGJhcnMtdmVydGljYWx8LW1vei1oaWRkZW4tdW5zY3JvbGxhYmxlIiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC13aWR0aCI6ICJmaWxsLWF2YWlsYWJsZXxtaW4taW50cmluc2ljfGludHJpbnNpY3wtbW96LWF2YWlsYWJsZXwtbW96LWZpdC1jb250ZW50fC1tb3otbWluLWNvbnRlbnR8LW1vei1tYXgtY29udGVudHwtd2Via2l0LW1pbi1jb250ZW50fC13ZWJraXQtbWF4LWNvbnRlbnQiLAogICAgICAgICItd2Via2l0LWdyYWRpZW50KCkiOiAiLXdlYmtpdC1ncmFkaWVudCggPC13ZWJraXQtZ3JhZGllbnQtdHlwZT4gLCA8LXdlYmtpdC1ncmFkaWVudC1wb2ludD4gWywgPC13ZWJraXQtZ3JhZGllbnQtcG9pbnQ+fCwgPC13ZWJraXQtZ3JhZGllbnQtcmFkaXVzPiAsIDwtd2Via2l0LWdyYWRpZW50LXBvaW50Pl0gWywgPC13ZWJraXQtZ3JhZGllbnQtcmFkaXVzPl0/IFssIDwtd2Via2l0LWdyYWRpZW50LWNvbG9yLXN0b3A+XSogKSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtY29sb3Itc3RvcCI6ICJmcm9tKCA8Y29sb3I+ICl8Y29sb3Itc3RvcCggWzxudW1iZXItemVyby1vbmU+fDxwZXJjZW50YWdlPl0gLCA8Y29sb3I+ICl8dG8oIDxjb2xvcj4gKSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtcG9pbnQiOiAiW2xlZnR8Y2VudGVyfHJpZ2h0fDxsZW5ndGgtcGVyY2VudGFnZT5dIFt0b3B8Y2VudGVyfGJvdHRvbXw8bGVuZ3RoLXBlcmNlbnRhZ2U+XSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtcmFkaXVzIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtdHlwZSI6ICJsaW5lYXJ8cmFkaWFsIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWJveC1yZXBlYXQiOiAicmVwZWF0fHN0cmV0Y2h8cm91bmQiLAogICAgICAgICItd2Via2l0LW1hc2stY2xpcC1zdHlsZSI6ICJib3JkZXJ8Ym9yZGVyLWJveHxwYWRkaW5nfHBhZGRpbmctYm94fGNvbnRlbnR8Y29udGVudC1ib3h8dGV4dCIsCiAgICAgICAgIi1tcy1maWx0ZXItZnVuY3Rpb24tbGlzdCI6ICI8LW1zLWZpbHRlci1mdW5jdGlvbj4rIiwKICAgICAgICAiLW1zLWZpbHRlci1mdW5jdGlvbiI6ICI8LW1zLWZpbHRlci1mdW5jdGlvbi1wcm9naWQ+fDwtbXMtZmlsdGVyLWZ1bmN0aW9uLWxlZ2FjeT4iLAogICAgICAgICItbXMtZmlsdGVyLWZ1bmN0aW9uLXByb2dpZCI6ICIncHJvZ2lkOicgWzxpZGVudC10b2tlbj4gJy4nXSogWzxpZGVudC10b2tlbj58PGZ1bmN0aW9uLXRva2VuPiA8YW55LXZhbHVlPj8gKV0iLAogICAgICAgICItbXMtZmlsdGVyLWZ1bmN0aW9uLWxlZ2FjeSI6ICI8aWRlbnQtdG9rZW4+fDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4/ICkiLAogICAgICAgICItbXMtZmlsdGVyIjogIjxzdHJpbmc+IiwKICAgICAgICAiYWdlIjogImNoaWxkfHlvdW5nfG9sZCIsCiAgICAgICAgImF0dHItbmFtZSI6ICI8d3EtbmFtZT4iLAogICAgICAgICJhdHRyLWZhbGxiYWNrIjogIjxhbnktdmFsdWU+IiwKICAgICAgICAiYmctY2xpcCI6ICI8Ym94Pnxib3JkZXJ8dGV4dCIsCiAgICAgICAgImJvdHRvbSI6ICI8bGVuZ3RoPnxhdXRvIiwKICAgICAgICAiZ2VuZXJpYy12b2ljZSI6ICJbPGFnZT4/IDxnZW5kZXI+IDxpbnRlZ2VyPj9dIiwKICAgICAgICAiZ2VuZGVyIjogIm1hbGV8ZmVtYWxlfG5ldXRyYWwiLAogICAgICAgICJsZWZ0IjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJtYXNrLWltYWdlIjogIjxtYXNrLXJlZmVyZW5jZT4jIiwKICAgICAgICAicGFpbnQiOiAibm9uZXw8Y29sb3I+fDx1cmw+IFtub25lfDxjb2xvcj5dP3xjb250ZXh0LWZpbGx8Y29udGV4dC1zdHJva2UiLAogICAgICAgICJyaWdodCI6ICI8bGVuZ3RoPnxhdXRvIiwKICAgICAgICAic2Nyb2xsLXRpbWVsaW5lLWF4aXMiOiAiYmxvY2t8aW5saW5lfHZlcnRpY2FsfGhvcml6b250YWwiLAogICAgICAgICJzY3JvbGwtdGltZWxpbmUtbmFtZSI6ICJub25lfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2luZ2xlLWFuaW1hdGlvbi1jb21wb3NpdGlvbiI6ICJyZXBsYWNlfGFkZHxhY2N1bXVsYXRlIiwKICAgICAgICAic3ZnLWxlbmd0aCI6ICI8cGVyY2VudGFnZT58PGxlbmd0aD58PG51bWJlcj4iLAogICAgICAgICJzdmctd3JpdGluZy1tb2RlIjogImxyLXRifHJsLXRifHRiLXJsfGxyfHJsfHRiIiwKICAgICAgICAidG9wIjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJ4IjogIjxudW1iZXI+IiwKICAgICAgICAieSI6ICI8bnVtYmVyPiIsCiAgICAgICAgImRlY2xhcmF0aW9uIjogIjxpZGVudC10b2tlbj4gOiA8ZGVjbGFyYXRpb24tdmFsdWU+PyBbJyEnIGltcG9ydGFudF0/IiwKICAgICAgICAiZGVjbGFyYXRpb24tbGlzdCI6ICJbPGRlY2xhcmF0aW9uPj8gJzsnXSogPGRlY2xhcmF0aW9uPj8iLAogICAgICAgICJ1cmwiOiAidXJsKCA8c3RyaW5nPiA8dXJsLW1vZGlmaWVyPiogKXw8dXJsLXRva2VuPiIsCiAgICAgICAgInVybC1tb2RpZmllciI6ICI8aWRlbnQ+fDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4gKSIsCiAgICAgICAgIm51bWJlci16ZXJvLW9uZSI6ICI8bnVtYmVyIFswLDFdPiIsCiAgICAgICAgIm51bWJlci1vbmUtb3ItZ3JlYXRlciI6ICI8bnVtYmVyIFsxLOKInl0+IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1kaXNwbGF5IjogIi1tcy1pbmxpbmUtZmxleGJveHwtbXMtZ3JpZHwtbXMtaW5saW5lLWdyaWR8LXdlYmtpdC1mbGV4fC13ZWJraXQtaW5saW5lLWZsZXh8LXdlYmtpdC1ib3h8LXdlYmtpdC1pbmxpbmUtYm94fC1tb3otaW5saW5lLXN0YWNrfC1tb3otYm94fC1tb3otaW5saW5lLWJveCIKICAgIH0sCiAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAiLS0qIjogIjxkZWNsYXJhdGlvbi12YWx1ZT4iLAogICAgICAgICItbXMtYWNjZWxlcmF0b3IiOiAiZmFsc2V8dHJ1ZSIsCiAgICAgICAgIi1tcy1ibG9jay1wcm9ncmVzc2lvbiI6ICJ0YnxybHxidHxsciIsCiAgICAgICAgIi1tcy1jb250ZW50LXpvb20tY2hhaW5pbmciOiAibm9uZXxjaGFpbmVkIiwKICAgICAgICAiLW1zLWNvbnRlbnQtem9vbWluZyI6ICJub25lfHpvb20iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0IjogIjwnLW1zLWNvbnRlbnQtem9vbS1saW1pdC1taW4nPiA8Jy1tcy1jb250ZW50LXpvb20tbGltaXQtbWF4Jz4iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0LW1heCI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0LW1pbiI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICItbXMtY29udGVudC16b29tLXNuYXAiOiAiPCctbXMtY29udGVudC16b29tLXNuYXAtdHlwZSc+fHw8Jy1tcy1jb250ZW50LXpvb20tc25hcC1wb2ludHMnPiIsCiAgICAgICAgIi1tcy1jb250ZW50LXpvb20tc25hcC1wb2ludHMiOiAic25hcEludGVydmFsKCA8cGVyY2VudGFnZT4gLCA8cGVyY2VudGFnZT4gKXxzbmFwTGlzdCggPHBlcmNlbnRhZ2U+IyApIiwKICAgICAgICAiLW1zLWNvbnRlbnQtem9vbS1zbmFwLXR5cGUiOiAibm9uZXxwcm94aW1pdHl8bWFuZGF0b3J5IiwKICAgICAgICAiLW1zLWZpbHRlciI6ICI8c3RyaW5nPiIsCiAgICAgICAgIi1tcy1mbG93LWZyb20iOiAiW25vbmV8PGN1c3RvbS1pZGVudD5dIyIsCiAgICAgICAgIi1tcy1mbG93LWludG8iOiAiW25vbmV8PGN1c3RvbS1pZGVudD5dIyIsCiAgICAgICAgIi1tcy1ncmlkLWNvbHVtbnMiOiAibm9uZXw8dHJhY2stbGlzdD58PGF1dG8tdHJhY2stbGlzdD4iLAogICAgICAgICItbXMtZ3JpZC1yb3dzIjogIm5vbmV8PHRyYWNrLWxpc3Q+fDxhdXRvLXRyYWNrLWxpc3Q+IiwKICAgICAgICAiLW1zLWhpZ2gtY29udHJhc3QtYWRqdXN0IjogImF1dG98bm9uZSIsCiAgICAgICAgIi1tcy1oeXBoZW5hdGUtbGltaXQtY2hhcnMiOiAiYXV0b3w8aW50ZWdlcj57MSwzfSIsCiAgICAgICAgIi1tcy1oeXBoZW5hdGUtbGltaXQtbGluZXMiOiAibm8tbGltaXR8PGludGVnZXI+IiwKICAgICAgICAiLW1zLWh5cGhlbmF0ZS1saW1pdC16b25lIjogIjxwZXJjZW50YWdlPnw8bGVuZ3RoPiIsCiAgICAgICAgIi1tcy1pbWUtYWxpZ24iOiAiYXV0b3xhZnRlciIsCiAgICAgICAgIi1tcy1vdmVyZmxvdy1zdHlsZSI6ICJhdXRvfG5vbmV8c2Nyb2xsYmFyfC1tcy1hdXRvaGlkaW5nLXNjcm9sbGJhciIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItM2RsaWdodC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1hcnJvdy1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1iYXNlLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsYmFyLWRhcmtzaGFkb3ctY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItZmFjZS1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1oaWdobGlnaHQtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItc2hhZG93LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsYmFyLXRyYWNrLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsLWNoYWluaW5nIjogImNoYWluZWR8bm9uZSIsCiAgICAgICAgIi1tcy1zY3JvbGwtbGltaXQiOiAiPCctbXMtc2Nyb2xsLWxpbWl0LXgtbWluJz4gPCctbXMtc2Nyb2xsLWxpbWl0LXktbWluJz4gPCctbXMtc2Nyb2xsLWxpbWl0LXgtbWF4Jz4gPCctbXMtc2Nyb2xsLWxpbWl0LXktbWF4Jz4iLAogICAgICAgICItbXMtc2Nyb2xsLWxpbWl0LXgtbWF4IjogImF1dG98PGxlbmd0aD4iLAogICAgICAgICItbXMtc2Nyb2xsLWxpbWl0LXgtbWluIjogIjxsZW5ndGg+IiwKICAgICAgICAiLW1zLXNjcm9sbC1saW1pdC15LW1heCI6ICJhdXRvfDxsZW5ndGg+IiwKICAgICAgICAiLW1zLXNjcm9sbC1saW1pdC15LW1pbiI6ICI8bGVuZ3RoPiIsCiAgICAgICAgIi1tcy1zY3JvbGwtcmFpbHMiOiAibm9uZXxyYWlsZWQiLAogICAgICAgICItbXMtc2Nyb2xsLXNuYXAtcG9pbnRzLXgiOiAic25hcEludGVydmFsKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aC1wZXJjZW50YWdlPiApfHNuYXBMaXN0KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+IyApIiwKICAgICAgICAiLW1zLXNjcm9sbC1zbmFwLXBvaW50cy15IjogInNuYXBJbnRlcnZhbCggPGxlbmd0aC1wZXJjZW50YWdlPiAsIDxsZW5ndGgtcGVyY2VudGFnZT4gKXxzbmFwTGlzdCggPGxlbmd0aC1wZXJjZW50YWdlPiMgKSIsCiAgICAgICAgIi1tcy1zY3JvbGwtc25hcC10eXBlIjogIm5vbmV8cHJveGltaXR5fG1hbmRhdG9yeSIsCiAgICAgICAgIi1tcy1zY3JvbGwtc25hcC14IjogIjwnLW1zLXNjcm9sbC1zbmFwLXR5cGUnPiA8Jy1tcy1zY3JvbGwtc25hcC1wb2ludHMteCc+IiwKICAgICAgICAiLW1zLXNjcm9sbC1zbmFwLXkiOiAiPCctbXMtc2Nyb2xsLXNuYXAtdHlwZSc+IDwnLW1zLXNjcm9sbC1zbmFwLXBvaW50cy15Jz4iLAogICAgICAgICItbXMtc2Nyb2xsLXRyYW5zbGF0aW9uIjogIm5vbmV8dmVydGljYWwtdG8taG9yaXpvbnRhbCIsCiAgICAgICAgIi1tcy10ZXh0LWF1dG9zcGFjZSI6ICJub25lfGlkZW9ncmFwaC1hbHBoYXxpZGVvZ3JhcGgtbnVtZXJpY3xpZGVvZ3JhcGgtcGFyZW50aGVzaXN8aWRlb2dyYXBoLXNwYWNlIiwKICAgICAgICAiLW1zLXRvdWNoLXNlbGVjdCI6ICJncmlwcGVyc3xub25lIiwKICAgICAgICAiLW1zLXVzZXItc2VsZWN0IjogIm5vbmV8ZWxlbWVudHx0ZXh0IiwKICAgICAgICAiLW1zLXdyYXAtZmxvdyI6ICJhdXRvfGJvdGh8c3RhcnR8ZW5kfG1heGltdW18Y2xlYXIiLAogICAgICAgICItbXMtd3JhcC1tYXJnaW4iOiAiPGxlbmd0aD4iLAogICAgICAgICItbXMtd3JhcC10aHJvdWdoIjogIndyYXB8bm9uZSIsCiAgICAgICAgIi1tb3otYXBwZWFyYW5jZSI6ICJub25lfGJ1dHRvbnxidXR0b24tYXJyb3ctZG93bnxidXR0b24tYXJyb3ctbmV4dHxidXR0b24tYXJyb3ctcHJldmlvdXN8YnV0dG9uLWFycm93LXVwfGJ1dHRvbi1iZXZlbHxidXR0b24tZm9jdXN8Y2FyZXR8Y2hlY2tib3h8Y2hlY2tib3gtY29udGFpbmVyfGNoZWNrYm94LWxhYmVsfGNoZWNrbWVudWl0ZW18ZHVhbGJ1dHRvbnxncm91cGJveHxsaXN0Ym94fGxpc3RpdGVtfG1lbnVhcnJvd3xtZW51YmFyfG1lbnVjaGVja2JveHxtZW51aW1hZ2V8bWVudWl0ZW18bWVudWl0ZW10ZXh0fG1lbnVsaXN0fG1lbnVsaXN0LWJ1dHRvbnxtZW51bGlzdC10ZXh0fG1lbnVsaXN0LXRleHRmaWVsZHxtZW51cG9wdXB8bWVudXJhZGlvfG1lbnVzZXBhcmF0b3J8bWV0ZXJiYXJ8bWV0ZXJjaHVua3xwcm9ncmVzc2Jhcnxwcm9ncmVzc2Jhci12ZXJ0aWNhbHxwcm9ncmVzc2NodW5rfHByb2dyZXNzY2h1bmstdmVydGljYWx8cmFkaW98cmFkaW8tY29udGFpbmVyfHJhZGlvLWxhYmVsfHJhZGlvbWVudWl0ZW18cmFuZ2V8cmFuZ2UtdGh1bWJ8cmVzaXplcnxyZXNpemVycGFuZWx8c2NhbGUtaG9yaXpvbnRhbHxzY2FsZXRodW1iZW5kfHNjYWxldGh1bWItaG9yaXpvbnRhbHxzY2FsZXRodW1ic3RhcnR8c2NhbGV0aHVtYnRpY2t8c2NhbGV0aHVtYi12ZXJ0aWNhbHxzY2FsZS12ZXJ0aWNhbHxzY3JvbGxiYXJidXR0b24tZG93bnxzY3JvbGxiYXJidXR0b24tbGVmdHxzY3JvbGxiYXJidXR0b24tcmlnaHR8c2Nyb2xsYmFyYnV0dG9uLXVwfHNjcm9sbGJhcnRodW1iLWhvcml6b250YWx8c2Nyb2xsYmFydGh1bWItdmVydGljYWx8c2Nyb2xsYmFydHJhY2staG9yaXpvbnRhbHxzY3JvbGxiYXJ0cmFjay12ZXJ0aWNhbHxzZWFyY2hmaWVsZHxzZXBhcmF0b3J8c2hlZXR8c3Bpbm5lcnxzcGlubmVyLWRvd25idXR0b258c3Bpbm5lci10ZXh0ZmllbGR8c3Bpbm5lci11cGJ1dHRvbnxzcGxpdHRlcnxzdGF0dXNiYXJ8c3RhdHVzYmFycGFuZWx8dGFifHRhYnBhbmVsfHRhYnBhbmVsc3x0YWItc2Nyb2xsLWFycm93LWJhY2t8dGFiLXNjcm9sbC1hcnJvdy1mb3J3YXJkfHRleHRmaWVsZHx0ZXh0ZmllbGQtbXVsdGlsaW5lfHRvb2xiYXJ8dG9vbGJhcmJ1dHRvbnx0b29sYmFyYnV0dG9uLWRyb3Bkb3dufHRvb2xiYXJncmlwcGVyfHRvb2xib3h8dG9vbHRpcHx0cmVlaGVhZGVyfHRyZWVoZWFkZXJjZWxsfHRyZWVoZWFkZXJzb3J0YXJyb3d8dHJlZWl0ZW18dHJlZWxpbmV8dHJlZXR3aXN0eXx0cmVldHdpc3R5b3Blbnx0cmVldmlld3wtbW96LW1hYy11bmlmaWVkLXRvb2xiYXJ8LW1vei13aW4tYm9yZGVybGVzcy1nbGFzc3wtbW96LXdpbi1icm93c2VydGFiYmFyLXRvb2xib3h8LW1vei13aW4tY29tbXVuaWNhdGlvbnN0ZXh0fC1tb3otd2luLWNvbW11bmljYXRpb25zLXRvb2xib3h8LW1vei13aW4tZXhjbHVkZS1nbGFzc3wtbW96LXdpbi1nbGFzc3wtbW96LXdpbi1tZWRpYXRleHR8LW1vei13aW4tbWVkaWEtdG9vbGJveHwtbW96LXdpbmRvdy1idXR0b24tYm94fC1tb3otd2luZG93LWJ1dHRvbi1ib3gtbWF4aW1pemVkfC1tb3otd2luZG93LWJ1dHRvbi1jbG9zZXwtbW96LXdpbmRvdy1idXR0b24tbWF4aW1pemV8LW1vei13aW5kb3ctYnV0dG9uLW1pbmltaXplfC1tb3otd2luZG93LWJ1dHRvbi1yZXN0b3JlfC1tb3otd2luZG93LWZyYW1lLWJvdHRvbXwtbW96LXdpbmRvdy1mcmFtZS1sZWZ0fC1tb3otd2luZG93LWZyYW1lLXJpZ2h0fC1tb3otd2luZG93LXRpdGxlYmFyfC1tb3otd2luZG93LXRpdGxlYmFyLW1heGltaXplZCIsCiAgICAgICAgIi1tb3otYmluZGluZyI6ICI8dXJsPnxub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItYm90dG9tLWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItbGVmdC1jb2xvcnMiOiAiPGNvbG9yPit8bm9uZSIsCiAgICAgICAgIi1tb3otYm9yZGVyLXJpZ2h0LWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItdG9wLWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1jb250ZXh0LXByb3BlcnRpZXMiOiAibm9uZXxbZmlsbHxmaWxsLW9wYWNpdHl8c3Ryb2tlfHN0cm9rZS1vcGFjaXR5XSMiLAogICAgICAgICItbW96LWZsb2F0LWVkZ2UiOiAiYm9yZGVyLWJveHxjb250ZW50LWJveHxtYXJnaW4tYm94fHBhZGRpbmctYm94IiwKICAgICAgICAiLW1vei1mb3JjZS1icm9rZW4taW1hZ2UtaWNvbiI6ICIwfDEiLAogICAgICAgICItbW96LWltYWdlLXJlZ2lvbiI6ICI8c2hhcGU+fGF1dG8iLAogICAgICAgICItbW96LW9yaWVudCI6ICJpbmxpbmV8YmxvY2t8aG9yaXpvbnRhbHx2ZXJ0aWNhbCIsCiAgICAgICAgIi1tb3otb3V0bGluZS1yYWRpdXMiOiAiPG91dGxpbmUtcmFkaXVzPnsxLDR9IFsvIDxvdXRsaW5lLXJhZGl1cz57MSw0fV0/IiwKICAgICAgICAiLW1vei1vdXRsaW5lLXJhZGl1cy1ib3R0b21sZWZ0IjogIjxvdXRsaW5lLXJhZGl1cz4iLAogICAgICAgICItbW96LW91dGxpbmUtcmFkaXVzLWJvdHRvbXJpZ2h0IjogIjxvdXRsaW5lLXJhZGl1cz4iLAogICAgICAgICItbW96LW91dGxpbmUtcmFkaXVzLXRvcGxlZnQiOiAiPG91dGxpbmUtcmFkaXVzPiIsCiAgICAgICAgIi1tb3otb3V0bGluZS1yYWRpdXMtdG9wcmlnaHQiOiAiPG91dGxpbmUtcmFkaXVzPiIsCiAgICAgICAgIi1tb3otc3RhY2stc2l6aW5nIjogImlnbm9yZXxzdHJldGNoLXRvLWZpdCIsCiAgICAgICAgIi1tb3otdGV4dC1ibGluayI6ICJub25lfGJsaW5rIiwKICAgICAgICAiLW1vei11c2VyLWZvY3VzIjogImlnbm9yZXxub3JtYWx8c2VsZWN0LWFmdGVyfHNlbGVjdC1iZWZvcmV8c2VsZWN0LW1lbnV8c2VsZWN0LXNhbWV8c2VsZWN0LWFsbHxub25lIiwKICAgICAgICAiLW1vei11c2VyLWlucHV0IjogImF1dG98bm9uZXxlbmFibGVkfGRpc2FibGVkIiwKICAgICAgICAiLW1vei11c2VyLW1vZGlmeSI6ICJyZWFkLW9ubHl8cmVhZC13cml0ZXx3cml0ZS1vbmx5IiwKICAgICAgICAiLW1vei13aW5kb3ctZHJhZ2dpbmciOiAiZHJhZ3xuby1kcmFnIiwKICAgICAgICAiLW1vei13aW5kb3ctc2hhZG93IjogImRlZmF1bHR8bWVudXx0b29sdGlwfHNoZWV0fG5vbmUiLAogICAgICAgICItd2Via2l0LWFwcGVhcmFuY2UiOiAibm9uZXxidXR0b258YnV0dG9uLWJldmVsfGNhcHMtbG9jay1pbmRpY2F0b3J8Y2FyZXR8Y2hlY2tib3h8ZGVmYXVsdC1idXR0b258aW5uZXItc3Bpbi1idXR0b258bGlzdGJveHxsaXN0aXRlbXxtZWRpYS1jb250cm9scy1iYWNrZ3JvdW5kfG1lZGlhLWNvbnRyb2xzLWZ1bGxzY3JlZW4tYmFja2dyb3VuZHxtZWRpYS1jdXJyZW50LXRpbWUtZGlzcGxheXxtZWRpYS1lbnRlci1mdWxsc2NyZWVuLWJ1dHRvbnxtZWRpYS1leGl0LWZ1bGxzY3JlZW4tYnV0dG9ufG1lZGlhLWZ1bGxzY3JlZW4tYnV0dG9ufG1lZGlhLW11dGUtYnV0dG9ufG1lZGlhLW92ZXJsYXktcGxheS1idXR0b258bWVkaWEtcGxheS1idXR0b258bWVkaWEtc2Vlay1iYWNrLWJ1dHRvbnxtZWRpYS1zZWVrLWZvcndhcmQtYnV0dG9ufG1lZGlhLXNsaWRlcnxtZWRpYS1zbGlkZXJ0aHVtYnxtZWRpYS10aW1lLXJlbWFpbmluZy1kaXNwbGF5fG1lZGlhLXRvZ2dsZS1jbG9zZWQtY2FwdGlvbnMtYnV0dG9ufG1lZGlhLXZvbHVtZS1zbGlkZXJ8bWVkaWEtdm9sdW1lLXNsaWRlci1jb250YWluZXJ8bWVkaWEtdm9sdW1lLXNsaWRlcnRodW1ifG1lbnVsaXN0fG1lbnVsaXN0LWJ1dHRvbnxtZW51bGlzdC10ZXh0fG1lbnVsaXN0LXRleHRmaWVsZHxtZXRlcnxwcm9ncmVzcy1iYXJ8cHJvZ3Jlc3MtYmFyLXZhbHVlfHB1c2gtYnV0dG9ufHJhZGlvfHNjcm9sbGJhcmJ1dHRvbi1kb3dufHNjcm9sbGJhcmJ1dHRvbi1sZWZ0fHNjcm9sbGJhcmJ1dHRvbi1yaWdodHxzY3JvbGxiYXJidXR0b24tdXB8c2Nyb2xsYmFyZ3JpcHBlci1ob3Jpem9udGFsfHNjcm9sbGJhcmdyaXBwZXItdmVydGljYWx8c2Nyb2xsYmFydGh1bWItaG9yaXpvbnRhbHxzY3JvbGxiYXJ0aHVtYi12ZXJ0aWNhbHxzY3JvbGxiYXJ0cmFjay1ob3Jpem9udGFsfHNjcm9sbGJhcnRyYWNrLXZlcnRpY2FsfHNlYXJjaGZpZWxkfHNlYXJjaGZpZWxkLWNhbmNlbC1idXR0b258c2VhcmNoZmllbGQtZGVjb3JhdGlvbnxzZWFyY2hmaWVsZC1yZXN1bHRzLWJ1dHRvbnxzZWFyY2hmaWVsZC1yZXN1bHRzLWRlY29yYXRpb258c2xpZGVyLWhvcml6b250YWx8c2xpZGVyLXZlcnRpY2FsfHNsaWRlcnRodW1iLWhvcml6b250YWx8c2xpZGVydGh1bWItdmVydGljYWx8c3F1YXJlLWJ1dHRvbnx0ZXh0YXJlYXx0ZXh0ZmllbGR8LWFwcGxlLXBheS1idXR0b24iLAogICAgICAgICItd2Via2l0LWJvcmRlci1iZWZvcmUiOiAiPCdib3JkZXItd2lkdGgnPnx8PCdib3JkZXItc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtYm9yZGVyLWJlZm9yZS1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLXdlYmtpdC1ib3JkZXItYmVmb3JlLXN0eWxlIjogIjwnYm9yZGVyLXN0eWxlJz4iLAogICAgICAgICItd2Via2l0LWJvcmRlci1iZWZvcmUtd2lkdGgiOiAiPCdib3JkZXItd2lkdGgnPiIsCiAgICAgICAgIi13ZWJraXQtYm94LXJlZmxlY3QiOiAiW2Fib3ZlfGJlbG93fHJpZ2h0fGxlZnRdPyA8bGVuZ3RoPj8gPGltYWdlPj8iLAogICAgICAgICItd2Via2l0LWxpbmUtY2xhbXAiOiAibm9uZXw8aW50ZWdlcj4iLAogICAgICAgICItd2Via2l0LW1hc2siOiAiWzxtYXNrLXJlZmVyZW5jZT58fDxwb3NpdGlvbj4gWy8gPGJnLXNpemU+XT98fDxyZXBlYXQtc3R5bGU+fHxbPGJveD58Ym9yZGVyfHBhZGRpbmd8Y29udGVudHx0ZXh0XXx8Wzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnRdXSMiLAogICAgICAgICItd2Via2l0LW1hc2stYXR0YWNobWVudCI6ICI8YXR0YWNobWVudD4jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWNsaXAiOiAiWzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnR8dGV4dF0jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWNvbXBvc2l0ZSI6ICI8Y29tcG9zaXRlLXN0eWxlPiMiLAogICAgICAgICItd2Via2l0LW1hc2staW1hZ2UiOiAiPG1hc2stcmVmZXJlbmNlPiMiLAogICAgICAgICItd2Via2l0LW1hc2stb3JpZ2luIjogIls8Ym94Pnxib3JkZXJ8cGFkZGluZ3xjb250ZW50XSMiLAogICAgICAgICItd2Via2l0LW1hc2stcG9zaXRpb24iOiAiPHBvc2l0aW9uPiMiLAogICAgICAgICItd2Via2l0LW1hc2stcG9zaXRpb24teCI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodF0jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLXBvc2l0aW9uLXkiOiAiWzxsZW5ndGgtcGVyY2VudGFnZT58dG9wfGNlbnRlcnxib3R0b21dIyIsCiAgICAgICAgIi13ZWJraXQtbWFzay1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLXJlcGVhdC14IjogInJlcGVhdHxuby1yZXBlYXR8c3BhY2V8cm91bmQiLAogICAgICAgICItd2Via2l0LW1hc2stcmVwZWF0LXkiOiAicmVwZWF0fG5vLXJlcGVhdHxzcGFjZXxyb3VuZCIsCiAgICAgICAgIi13ZWJraXQtbWFzay1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICItd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZyI6ICJhdXRvfHRvdWNoIiwKICAgICAgICAiLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItd2Via2l0LXRleHQtZmlsbC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLXdlYmtpdC10ZXh0LXN0cm9rZSI6ICI8bGVuZ3RoPnx8PGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zdHJva2UtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zdHJva2Utd2lkdGgiOiAiPGxlbmd0aD4iLAogICAgICAgICItd2Via2l0LXRvdWNoLWNhbGxvdXQiOiAiZGVmYXVsdHxub25lIiwKICAgICAgICAiLXdlYmtpdC11c2VyLW1vZGlmeSI6ICJyZWFkLW9ubHl8cmVhZC13cml0ZXxyZWFkLXdyaXRlLXBsYWludGV4dC1vbmx5IiwKICAgICAgICAiYWNjZW50LWNvbG9yIjogImF1dG98PGNvbG9yPiIsCiAgICAgICAgImFsaWduLWNvbnRlbnQiOiAibm9ybWFsfDxiYXNlbGluZS1wb3NpdGlvbj58PGNvbnRlbnQtZGlzdHJpYnV0aW9uPnw8b3ZlcmZsb3ctcG9zaXRpb24+PyA8Y29udGVudC1wb3NpdGlvbj4iLAogICAgICAgICJhbGlnbi1pdGVtcyI6ICJub3JtYWx8c3RyZXRjaHw8YmFzZWxpbmUtcG9zaXRpb24+fFs8b3ZlcmZsb3ctcG9zaXRpb24+PyA8c2VsZi1wb3NpdGlvbj5dIiwKICAgICAgICAiYWxpZ24tc2VsZiI6ICJhdXRvfG5vcm1hbHxzdHJldGNofDxiYXNlbGluZS1wb3NpdGlvbj58PG92ZXJmbG93LXBvc2l0aW9uPj8gPHNlbGYtcG9zaXRpb24+IiwKICAgICAgICAiYWxpZ24tdHJhY2tzIjogIltub3JtYWx8PGJhc2VsaW5lLXBvc2l0aW9uPnw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IDxjb250ZW50LXBvc2l0aW9uPl0jIiwKICAgICAgICAiYWxsIjogImluaXRpYWx8aW5oZXJpdHx1bnNldHxyZXZlcnR8cmV2ZXJ0LWxheWVyIiwKICAgICAgICAiYW5pbWF0aW9uIjogIjxzaW5nbGUtYW5pbWF0aW9uPiMiLAogICAgICAgICJhbmltYXRpb24tY29tcG9zaXRpb24iOiAiPHNpbmdsZS1hbmltYXRpb24tY29tcG9zaXRpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi1kZWxheSI6ICI8dGltZT4jIiwKICAgICAgICAiYW5pbWF0aW9uLWRpcmVjdGlvbiI6ICI8c2luZ2xlLWFuaW1hdGlvbi1kaXJlY3Rpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi1kdXJhdGlvbiI6ICI8dGltZT4jIiwKICAgICAgICAiYW5pbWF0aW9uLWZpbGwtbW9kZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi1maWxsLW1vZGU+IyIsCiAgICAgICAgImFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQiOiAiPHNpbmdsZS1hbmltYXRpb24taXRlcmF0aW9uLWNvdW50PiMiLAogICAgICAgICJhbmltYXRpb24tbmFtZSI6ICJbbm9uZXw8a2V5ZnJhbWVzLW5hbWU+XSMiLAogICAgICAgICJhbmltYXRpb24tcGxheS1zdGF0ZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi1wbGF5LXN0YXRlPiMiLAogICAgICAgICJhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uIjogIjxlYXNpbmctZnVuY3Rpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi10aW1lbGluZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi10aW1lbGluZT4jIiwKICAgICAgICAiYXBwZWFyYW5jZSI6ICJub25lfGF1dG98dGV4dGZpZWxkfG1lbnVsaXN0LWJ1dHRvbnw8Y29tcGF0LWF1dG8+IiwKICAgICAgICAiYXNwZWN0LXJhdGlvIjogImF1dG98PHJhdGlvPiIsCiAgICAgICAgImF6aW11dGgiOiAiPGFuZ2xlPnxbW2xlZnQtc2lkZXxmYXItbGVmdHxsZWZ0fGNlbnRlci1sZWZ0fGNlbnRlcnxjZW50ZXItcmlnaHR8cmlnaHR8ZmFyLXJpZ2h0fHJpZ2h0LXNpZGVdfHxiZWhpbmRdfGxlZnR3YXJkc3xyaWdodHdhcmRzIiwKICAgICAgICAiYmFja2Ryb3AtZmlsdGVyIjogIm5vbmV8PGZpbHRlci1mdW5jdGlvbi1saXN0PiIsCiAgICAgICAgImJhY2tmYWNlLXZpc2liaWxpdHkiOiAidmlzaWJsZXxoaWRkZW4iLAogICAgICAgICJiYWNrZ3JvdW5kIjogIls8YmctbGF5ZXI+ICxdKiA8ZmluYWwtYmctbGF5ZXI+IiwKICAgICAgICAiYmFja2dyb3VuZC1hdHRhY2htZW50IjogIjxhdHRhY2htZW50PiMiLAogICAgICAgICJiYWNrZ3JvdW5kLWJsZW5kLW1vZGUiOiAiPGJsZW5kLW1vZGU+IyIsCiAgICAgICAgImJhY2tncm91bmQtY2xpcCI6ICI8YmctY2xpcD4jIiwKICAgICAgICAiYmFja2dyb3VuZC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiYmFja2dyb3VuZC1pbWFnZSI6ICI8YmctaW1hZ2U+IyIsCiAgICAgICAgImJhY2tncm91bmQtb3JpZ2luIjogIjxib3g+IyIsCiAgICAgICAgImJhY2tncm91bmQtcG9zaXRpb24iOiAiPGJnLXBvc2l0aW9uPiMiLAogICAgICAgICJiYWNrZ3JvdW5kLXBvc2l0aW9uLXgiOiAiW2NlbnRlcnxbW2xlZnR8cmlnaHR8eC1zdGFydHx4LWVuZF0/IDxsZW5ndGgtcGVyY2VudGFnZT4/XSFdIyIsCiAgICAgICAgImJhY2tncm91bmQtcG9zaXRpb24teSI6ICJbY2VudGVyfFtbdG9wfGJvdHRvbXx5LXN0YXJ0fHktZW5kXT8gPGxlbmd0aC1wZXJjZW50YWdlPj9dIV0jIiwKICAgICAgICAiYmFja2dyb3VuZC1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAiYmFja2dyb3VuZC1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICJibG9jay1vdmVyZmxvdyI6ICJjbGlwfGVsbGlwc2lzfDxzdHJpbmc+IiwKICAgICAgICAiYmxvY2stc2l6ZSI6ICI8J3dpZHRoJz4iLAogICAgICAgICJib3JkZXIiOiAiPGxpbmUtd2lkdGg+fHw8bGluZS1zdHlsZT58fDxjb2xvcj4iLAogICAgICAgICJib3JkZXItYmxvY2siOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWJsb2NrLWNvbG9yIjogIjwnYm9yZGVyLXRvcC1jb2xvcic+ezEsMn0iLAogICAgICAgICJib3JkZXItYmxvY2stc3R5bGUiOiAiPCdib3JkZXItdG9wLXN0eWxlJz4iLAogICAgICAgICJib3JkZXItYmxvY2std2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItYmxvY2stZW5kIjogIjwnYm9yZGVyLXRvcC13aWR0aCc+fHw8J2JvcmRlci10b3Atc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1ibG9jay1lbmQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItYmxvY2stZW5kLXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWJsb2NrLWVuZC13aWR0aCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPiIsCiAgICAgICAgImJvcmRlci1ibG9jay1zdGFydCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPnx8PCdib3JkZXItdG9wLXN0eWxlJz58fDxjb2xvcj4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtc3R5bGUiOiAiPCdib3JkZXItdG9wLXN0eWxlJz4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItYm90dG9tIjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPiIsCiAgICAgICAgImJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1zdHlsZSI6ICI8bGluZS1zdHlsZT4iLAogICAgICAgICJib3JkZXItYm90dG9tLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1jb2xsYXBzZSI6ICJjb2xsYXBzZXxzZXBhcmF0ZSIsCiAgICAgICAgImJvcmRlci1jb2xvciI6ICI8Y29sb3I+ezEsNH0iLAogICAgICAgICJib3JkZXItZW5kLWVuZC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWVuZC1zdGFydC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWltYWdlIjogIjwnYm9yZGVyLWltYWdlLXNvdXJjZSc+fHw8J2JvcmRlci1pbWFnZS1zbGljZSc+IFsvIDwnYm9yZGVyLWltYWdlLXdpZHRoJz58LyA8J2JvcmRlci1pbWFnZS13aWR0aCc+PyAvIDwnYm9yZGVyLWltYWdlLW91dHNldCc+XT98fDwnYm9yZGVyLWltYWdlLXJlcGVhdCc+IiwKICAgICAgICAiYm9yZGVyLWltYWdlLW91dHNldCI6ICJbPGxlbmd0aD58PG51bWJlcj5dezEsNH0iLAogICAgICAgICJib3JkZXItaW1hZ2UtcmVwZWF0IjogIltzdHJldGNofHJlcGVhdHxyb3VuZHxzcGFjZV17MSwyfSIsCiAgICAgICAgImJvcmRlci1pbWFnZS1zbGljZSI6ICI8bnVtYmVyLXBlcmNlbnRhZ2U+ezEsNH0mJmZpbGw/IiwKICAgICAgICAiYm9yZGVyLWltYWdlLXNvdXJjZSI6ICJub25lfDxpbWFnZT4iLAogICAgICAgICJib3JkZXItaW1hZ2Utd2lkdGgiOiAiWzxsZW5ndGgtcGVyY2VudGFnZT58PG51bWJlcj58YXV0b117MSw0fSIsCiAgICAgICAgImJvcmRlci1pbmxpbmUiOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1lbmQiOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1zdHlsZSI6ICI8J2JvcmRlci10b3Atc3R5bGUnPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLWVuZC1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtZW5kLXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1lbmQtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLXN0YXJ0IjogIjwnYm9yZGVyLXRvcC13aWR0aCc+fHw8J2JvcmRlci10b3Atc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtc3RhcnQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLXN0YXJ0LXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1zdGFydC13aWR0aCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPiIsCiAgICAgICAgImJvcmRlci1sZWZ0IjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWxlZnQtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1sZWZ0LXN0eWxlIjogIjxsaW5lLXN0eWxlPiIsCiAgICAgICAgImJvcmRlci1sZWZ0LXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDR9IFsvIDxsZW5ndGgtcGVyY2VudGFnZT57MSw0fV0/IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0IjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJib3JkZXItcmlnaHQtc3R5bGUiOiAiPGxpbmUtc3R5bGU+IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0LXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1zcGFjaW5nIjogIjxsZW5ndGg+IDxsZW5ndGg+PyIsCiAgICAgICAgImJvcmRlci1zdGFydC1lbmQtcmFkaXVzIjogIjxsZW5ndGgtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImJvcmRlci1zdGFydC1zdGFydC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXN0eWxlIjogIjxsaW5lLXN0eWxlPnsxLDR9IiwKICAgICAgICAiYm9yZGVyLXRvcCI6ICI8bGluZS13aWR0aD58fDxsaW5lLXN0eWxlPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci10b3AtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgImJvcmRlci10b3AtbGVmdC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXRvcC1yaWdodC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXRvcC1zdHlsZSI6ICI8bGluZS1zdHlsZT4iLAogICAgICAgICJib3JkZXItdG9wLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci13aWR0aCI6ICI8bGluZS13aWR0aD57MSw0fSIsCiAgICAgICAgImJvdHRvbSI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgImJveC1hbGlnbiI6ICJzdGFydHxjZW50ZXJ8ZW5kfGJhc2VsaW5lfHN0cmV0Y2giLAogICAgICAgICJib3gtZGVjb3JhdGlvbi1icmVhayI6ICJzbGljZXxjbG9uZSIsCiAgICAgICAgImJveC1kaXJlY3Rpb24iOiAibm9ybWFsfHJldmVyc2V8aW5oZXJpdCIsCiAgICAgICAgImJveC1mbGV4IjogIjxudW1iZXI+IiwKICAgICAgICAiYm94LWZsZXgtZ3JvdXAiOiAiPGludGVnZXI+IiwKICAgICAgICAiYm94LWxpbmVzIjogInNpbmdsZXxtdWx0aXBsZSIsCiAgICAgICAgImJveC1vcmRpbmFsLWdyb3VwIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgImJveC1vcmllbnQiOiAiaG9yaXpvbnRhbHx2ZXJ0aWNhbHxpbmxpbmUtYXhpc3xibG9jay1heGlzfGluaGVyaXQiLAogICAgICAgICJib3gtcGFjayI6ICJzdGFydHxjZW50ZXJ8ZW5kfGp1c3RpZnkiLAogICAgICAgICJib3gtc2hhZG93IjogIm5vbmV8PHNoYWRvdz4jIiwKICAgICAgICAiYm94LXNpemluZyI6ICJjb250ZW50LWJveHxib3JkZXItYm94IiwKICAgICAgICAiYnJlYWstYWZ0ZXIiOiAiYXV0b3xhdm9pZHxhbHdheXN8YWxsfGF2b2lkLXBhZ2V8cGFnZXxsZWZ0fHJpZ2h0fHJlY3RvfHZlcnNvfGF2b2lkLWNvbHVtbnxjb2x1bW58YXZvaWQtcmVnaW9ufHJlZ2lvbiIsCiAgICAgICAgImJyZWFrLWJlZm9yZSI6ICJhdXRvfGF2b2lkfGFsd2F5c3xhbGx8YXZvaWQtcGFnZXxwYWdlfGxlZnR8cmlnaHR8cmVjdG98dmVyc298YXZvaWQtY29sdW1ufGNvbHVtbnxhdm9pZC1yZWdpb258cmVnaW9uIiwKICAgICAgICAiYnJlYWstaW5zaWRlIjogImF1dG98YXZvaWR8YXZvaWQtcGFnZXxhdm9pZC1jb2x1bW58YXZvaWQtcmVnaW9uIiwKICAgICAgICAiY2FwdGlvbi1zaWRlIjogInRvcHxib3R0b218YmxvY2stc3RhcnR8YmxvY2stZW5kfGlubGluZS1zdGFydHxpbmxpbmUtZW5kIiwKICAgICAgICAiY2FyZXQiOiAiPCdjYXJldC1jb2xvcic+fHw8J2NhcmV0LXNoYXBlJz4iLAogICAgICAgICJjYXJldC1jb2xvciI6ICJhdXRvfDxjb2xvcj4iLAogICAgICAgICJjYXJldC1zaGFwZSI6ICJhdXRvfGJhcnxibG9ja3x1bmRlcnNjb3JlIiwKICAgICAgICAiY2xlYXIiOiAibm9uZXxsZWZ0fHJpZ2h0fGJvdGh8aW5saW5lLXN0YXJ0fGlubGluZS1lbmQiLAogICAgICAgICJjbGlwIjogIjxzaGFwZT58YXV0byIsCiAgICAgICAgImNsaXAtcGF0aCI6ICI8Y2xpcC1zb3VyY2U+fFs8YmFzaWMtc2hhcGU+fHw8Z2VvbWV0cnktYm94Pl18bm9uZSIsCiAgICAgICAgImNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJwcmludC1jb2xvci1hZGp1c3QiOiAiZWNvbm9teXxleGFjdCIsCiAgICAgICAgImNvbG9yLXNjaGVtZSI6ICJub3JtYWx8W2xpZ2h0fGRhcmt8PGN1c3RvbS1pZGVudD5dKyYmb25seT8iLAogICAgICAgICJjb2x1bW4tY291bnQiOiAiPGludGVnZXI+fGF1dG8iLAogICAgICAgICJjb2x1bW4tZmlsbCI6ICJhdXRvfGJhbGFuY2V8YmFsYW5jZS1hbGwiLAogICAgICAgICJjb2x1bW4tZ2FwIjogIm5vcm1hbHw8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAiY29sdW1uLXJ1bGUiOiAiPCdjb2x1bW4tcnVsZS13aWR0aCc+fHw8J2NvbHVtbi1ydWxlLXN0eWxlJz58fDwnY29sdW1uLXJ1bGUtY29sb3InPiIsCiAgICAgICAgImNvbHVtbi1ydWxlLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJjb2x1bW4tcnVsZS1zdHlsZSI6ICI8J2JvcmRlci1zdHlsZSc+IiwKICAgICAgICAiY29sdW1uLXJ1bGUtd2lkdGgiOiAiPCdib3JkZXItd2lkdGgnPiIsCiAgICAgICAgImNvbHVtbi1zcGFuIjogIm5vbmV8YWxsIiwKICAgICAgICAiY29sdW1uLXdpZHRoIjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJjb2x1bW5zIjogIjwnY29sdW1uLXdpZHRoJz58fDwnY29sdW1uLWNvdW50Jz4iLAogICAgICAgICJjb250YWluIjogIm5vbmV8c3RyaWN0fGNvbnRlbnR8W1tzaXplfHxpbmxpbmUtc2l6ZV18fGxheW91dHx8c3R5bGV8fHBhaW50XSIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLXNpemUiOiAiW25vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPl17MSwyfSIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLWJsb2NrLXNpemUiOiAibm9uZXw8bGVuZ3RoPnxhdXRvIDxsZW5ndGg+IiwKICAgICAgICAiY29udGFpbi1pbnRyaW5zaWMtaGVpZ2h0IjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLWlubGluZS1zaXplIjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLXdpZHRoIjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRlbnQiOiAibm9ybWFsfG5vbmV8Wzxjb250ZW50LXJlcGxhY2VtZW50Pnw8Y29udGVudC1saXN0Pl0gWy8gWzxzdHJpbmc+fDxjb3VudGVyPl0rXT8iLAogICAgICAgICJjb250ZW50LXZpc2liaWxpdHkiOiAidmlzaWJsZXxhdXRvfGhpZGRlbiIsCiAgICAgICAgImNvdW50ZXItaW5jcmVtZW50IjogIls8Y291bnRlci1uYW1lPiA8aW50ZWdlcj4/XSt8bm9uZSIsCiAgICAgICAgImNvdW50ZXItcmVzZXQiOiAiWzxjb3VudGVyLW5hbWU+IDxpbnRlZ2VyPj98PHJldmVyc2VkLWNvdW50ZXItbmFtZT4gPGludGVnZXI+P10rfG5vbmUiLAogICAgICAgICJjb3VudGVyLXNldCI6ICJbPGNvdW50ZXItbmFtZT4gPGludGVnZXI+P10rfG5vbmUiLAogICAgICAgICJjdXJzb3IiOiAiW1s8dXJsPiBbPHg+IDx5Pl0/ICxdKiBbYXV0b3xkZWZhdWx0fG5vbmV8Y29udGV4dC1tZW51fGhlbHB8cG9pbnRlcnxwcm9ncmVzc3x3YWl0fGNlbGx8Y3Jvc3NoYWlyfHRleHR8dmVydGljYWwtdGV4dHxhbGlhc3xjb3B5fG1vdmV8bm8tZHJvcHxub3QtYWxsb3dlZHxlLXJlc2l6ZXxuLXJlc2l6ZXxuZS1yZXNpemV8bnctcmVzaXplfHMtcmVzaXplfHNlLXJlc2l6ZXxzdy1yZXNpemV8dy1yZXNpemV8ZXctcmVzaXplfG5zLXJlc2l6ZXxuZXN3LXJlc2l6ZXxud3NlLXJlc2l6ZXxjb2wtcmVzaXplfHJvdy1yZXNpemV8YWxsLXNjcm9sbHx6b29tLWlufHpvb20tb3V0fGdyYWJ8Z3JhYmJpbmd8aGFuZHwtd2Via2l0LWdyYWJ8LXdlYmtpdC1ncmFiYmluZ3wtd2Via2l0LXpvb20taW58LXdlYmtpdC16b29tLW91dHwtbW96LWdyYWJ8LW1vei1ncmFiYmluZ3wtbW96LXpvb20taW58LW1vei16b29tLW91dF1dIiwKICAgICAgICAiZGlyZWN0aW9uIjogImx0cnxydGwiLAogICAgICAgICJkaXNwbGF5IjogIls8ZGlzcGxheS1vdXRzaWRlPnx8PGRpc3BsYXktaW5zaWRlPl18PGRpc3BsYXktbGlzdGl0ZW0+fDxkaXNwbGF5LWludGVybmFsPnw8ZGlzcGxheS1ib3g+fDxkaXNwbGF5LWxlZ2FjeT58PC1ub24tc3RhbmRhcmQtZGlzcGxheT4iLAogICAgICAgICJlbXB0eS1jZWxscyI6ICJzaG93fGhpZGUiLAogICAgICAgICJmaWx0ZXIiOiAibm9uZXw8ZmlsdGVyLWZ1bmN0aW9uLWxpc3Q+fDwtbXMtZmlsdGVyLWZ1bmN0aW9uLWxpc3Q+IiwKICAgICAgICAiZmxleCI6ICJub25lfFs8J2ZsZXgtZ3Jvdyc+IDwnZmxleC1zaHJpbmsnPj98fDwnZmxleC1iYXNpcyc+XSIsCiAgICAgICAgImZsZXgtYmFzaXMiOiAiY29udGVudHw8J3dpZHRoJz4iLAogICAgICAgICJmbGV4LWRpcmVjdGlvbiI6ICJyb3d8cm93LXJldmVyc2V8Y29sdW1ufGNvbHVtbi1yZXZlcnNlIiwKICAgICAgICAiZmxleC1mbG93IjogIjwnZmxleC1kaXJlY3Rpb24nPnx8PCdmbGV4LXdyYXAnPiIsCiAgICAgICAgImZsZXgtZ3JvdyI6ICI8bnVtYmVyPiIsCiAgICAgICAgImZsZXgtc2hyaW5rIjogIjxudW1iZXI+IiwKICAgICAgICAiZmxleC13cmFwIjogIm5vd3JhcHx3cmFwfHdyYXAtcmV2ZXJzZSIsCiAgICAgICAgImZsb2F0IjogImxlZnR8cmlnaHR8bm9uZXxpbmxpbmUtc3RhcnR8aW5saW5lLWVuZCIsCiAgICAgICAgImZvbnQiOiAiW1s8J2ZvbnQtc3R5bGUnPnx8PGZvbnQtdmFyaWFudC1jc3MyMT58fDwnZm9udC13ZWlnaHQnPnx8PCdmb250LXN0cmV0Y2gnPl0/IDwnZm9udC1zaXplJz4gWy8gPCdsaW5lLWhlaWdodCc+XT8gPCdmb250LWZhbWlseSc+XXxjYXB0aW9ufGljb258bWVudXxtZXNzYWdlLWJveHxzbWFsbC1jYXB0aW9ufHN0YXR1cy1iYXIiLAogICAgICAgICJmb250LWZhbWlseSI6ICJbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy1mYW1pbHk+XSMiLAogICAgICAgICJmb250LWZlYXR1cmUtc2V0dGluZ3MiOiAibm9ybWFsfDxmZWF0dXJlLXRhZy12YWx1ZT4jIiwKICAgICAgICAiZm9udC1rZXJuaW5nIjogImF1dG98bm9ybWFsfG5vbmUiLAogICAgICAgICJmb250LWxhbmd1YWdlLW92ZXJyaWRlIjogIm5vcm1hbHw8c3RyaW5nPiIsCiAgICAgICAgImZvbnQtb3B0aWNhbC1zaXppbmciOiAiYXV0b3xub25lIiwKICAgICAgICAiZm9udC12YXJpYXRpb24tc2V0dGluZ3MiOiAibm9ybWFsfFs8c3RyaW5nPiA8bnVtYmVyPl0jIiwKICAgICAgICAiZm9udC1zaXplIjogIjxhYnNvbHV0ZS1zaXplPnw8cmVsYXRpdmUtc2l6ZT58PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImZvbnQtc2l6ZS1hZGp1c3QiOiAibm9uZXxbZXgtaGVpZ2h0fGNhcC1oZWlnaHR8Y2gtd2lkdGh8aWMtd2lkdGh8aWMtaGVpZ2h0XT8gW2Zyb20tZm9udHw8bnVtYmVyPl0iLAogICAgICAgICJmb250LXNtb290aCI6ICJhdXRvfG5ldmVyfGFsd2F5c3w8YWJzb2x1dGUtc2l6ZT58PGxlbmd0aD4iLAogICAgICAgICJmb250LXN0cmV0Y2giOiAiPGZvbnQtc3RyZXRjaC1hYnNvbHV0ZT4iLAogICAgICAgICJmb250LXN0eWxlIjogIm5vcm1hbHxpdGFsaWN8b2JsaXF1ZSA8YW5nbGU+PyIsCiAgICAgICAgImZvbnQtc3ludGhlc2lzIjogIm5vbmV8W3dlaWdodHx8c3R5bGV8fHNtYWxsLWNhcHNdIiwKICAgICAgICAiZm9udC12YXJpYW50IjogIm5vcm1hbHxub25lfFs8Y29tbW9uLWxpZy12YWx1ZXM+fHw8ZGlzY3JldGlvbmFyeS1saWctdmFsdWVzPnx8PGhpc3RvcmljYWwtbGlnLXZhbHVlcz58fDxjb250ZXh0dWFsLWFsdC12YWx1ZXM+fHxzdHlsaXN0aWMoIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fGhpc3RvcmljYWwtZm9ybXN8fHN0eWxlc2V0KCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiMgKXx8Y2hhcmFjdGVyLXZhcmlhbnQoIDxmZWF0dXJlLXZhbHVlLW5hbWU+IyApfHxzd2FzaCggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8b3JuYW1lbnRzKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxhbm5vdGF0aW9uKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxbc21hbGwtY2Fwc3xhbGwtc21hbGwtY2Fwc3xwZXRpdGUtY2Fwc3xhbGwtcGV0aXRlLWNhcHN8dW5pY2FzZXx0aXRsaW5nLWNhcHNdfHw8bnVtZXJpYy1maWd1cmUtdmFsdWVzPnx8PG51bWVyaWMtc3BhY2luZy12YWx1ZXM+fHw8bnVtZXJpYy1mcmFjdGlvbi12YWx1ZXM+fHxvcmRpbmFsfHxzbGFzaGVkLXplcm98fDxlYXN0LWFzaWFuLXZhcmlhbnQtdmFsdWVzPnx8PGVhc3QtYXNpYW4td2lkdGgtdmFsdWVzPnx8cnVieV0iLAogICAgICAgICJmb250LXZhcmlhbnQtYWx0ZXJuYXRlcyI6ICJub3JtYWx8W3N0eWxpc3RpYyggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8aGlzdG9yaWNhbC1mb3Jtc3x8c3R5bGVzZXQoIDxmZWF0dXJlLXZhbHVlLW5hbWU+IyApfHxjaGFyYWN0ZXItdmFyaWFudCggPGZlYXR1cmUtdmFsdWUtbmFtZT4jICl8fHN3YXNoKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxvcm5hbWVudHMoIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fGFubm90YXRpb24oIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICldIiwKICAgICAgICAiZm9udC12YXJpYW50LWNhcHMiOiAibm9ybWFsfHNtYWxsLWNhcHN8YWxsLXNtYWxsLWNhcHN8cGV0aXRlLWNhcHN8YWxsLXBldGl0ZS1jYXBzfHVuaWNhc2V8dGl0bGluZy1jYXBzIiwKICAgICAgICAiZm9udC12YXJpYW50LWVhc3QtYXNpYW4iOiAibm9ybWFsfFs8ZWFzdC1hc2lhbi12YXJpYW50LXZhbHVlcz58fDxlYXN0LWFzaWFuLXdpZHRoLXZhbHVlcz58fHJ1YnldIiwKICAgICAgICAiZm9udC12YXJpYW50LWxpZ2F0dXJlcyI6ICJub3JtYWx8bm9uZXxbPGNvbW1vbi1saWctdmFsdWVzPnx8PGRpc2NyZXRpb25hcnktbGlnLXZhbHVlcz58fDxoaXN0b3JpY2FsLWxpZy12YWx1ZXM+fHw8Y29udGV4dHVhbC1hbHQtdmFsdWVzPl0iLAogICAgICAgICJmb250LXZhcmlhbnQtbnVtZXJpYyI6ICJub3JtYWx8WzxudW1lcmljLWZpZ3VyZS12YWx1ZXM+fHw8bnVtZXJpYy1zcGFjaW5nLXZhbHVlcz58fDxudW1lcmljLWZyYWN0aW9uLXZhbHVlcz58fG9yZGluYWx8fHNsYXNoZWQtemVyb10iLAogICAgICAgICJmb250LXZhcmlhbnQtcG9zaXRpb24iOiAibm9ybWFsfHN1YnxzdXBlciIsCiAgICAgICAgImZvbnQtd2VpZ2h0IjogIjxmb250LXdlaWdodC1hYnNvbHV0ZT58Ym9sZGVyfGxpZ2h0ZXIiLAogICAgICAgICJmb3JjZWQtY29sb3ItYWRqdXN0IjogImF1dG98bm9uZSIsCiAgICAgICAgImdhcCI6ICI8J3Jvdy1nYXAnPiA8J2NvbHVtbi1nYXAnPj8iLAogICAgICAgICJncmlkIjogIjwnZ3JpZC10ZW1wbGF0ZSc+fDwnZ3JpZC10ZW1wbGF0ZS1yb3dzJz4gLyBbYXV0by1mbG93JiZkZW5zZT9dIDwnZ3JpZC1hdXRvLWNvbHVtbnMnPj98W2F1dG8tZmxvdyYmZGVuc2U/XSA8J2dyaWQtYXV0by1yb3dzJz4/IC8gPCdncmlkLXRlbXBsYXRlLWNvbHVtbnMnPiIsCiAgICAgICAgImdyaWQtYXJlYSI6ICI8Z3JpZC1saW5lPiBbLyA8Z3JpZC1saW5lPl17MCwzfSIsCiAgICAgICAgImdyaWQtYXV0by1jb2x1bW5zIjogIjx0cmFjay1zaXplPisiLAogICAgICAgICJncmlkLWF1dG8tZmxvdyI6ICJbcm93fGNvbHVtbl18fGRlbnNlIiwKICAgICAgICAiZ3JpZC1hdXRvLXJvd3MiOiAiPHRyYWNrLXNpemU+KyIsCiAgICAgICAgImdyaWQtY29sdW1uIjogIjxncmlkLWxpbmU+IFsvIDxncmlkLWxpbmU+XT8iLAogICAgICAgICJncmlkLWNvbHVtbi1lbmQiOiAiPGdyaWQtbGluZT4iLAogICAgICAgICJncmlkLWNvbHVtbi1nYXAiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImdyaWQtY29sdW1uLXN0YXJ0IjogIjxncmlkLWxpbmU+IiwKICAgICAgICAiZ3JpZC1nYXAiOiAiPCdncmlkLXJvdy1nYXAnPiA8J2dyaWQtY29sdW1uLWdhcCc+PyIsCiAgICAgICAgImdyaWQtcm93IjogIjxncmlkLWxpbmU+IFsvIDxncmlkLWxpbmU+XT8iLAogICAgICAgICJncmlkLXJvdy1lbmQiOiAiPGdyaWQtbGluZT4iLAogICAgICAgICJncmlkLXJvdy1nYXAiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImdyaWQtcm93LXN0YXJ0IjogIjxncmlkLWxpbmU+IiwKICAgICAgICAiZ3JpZC10ZW1wbGF0ZSI6ICJub25lfFs8J2dyaWQtdGVtcGxhdGUtcm93cyc+IC8gPCdncmlkLXRlbXBsYXRlLWNvbHVtbnMnPl18WzxsaW5lLW5hbWVzPj8gPHN0cmluZz4gPHRyYWNrLXNpemU+PyA8bGluZS1uYW1lcz4/XSsgWy8gPGV4cGxpY2l0LXRyYWNrLWxpc3Q+XT8iLAogICAgICAgICJncmlkLXRlbXBsYXRlLWFyZWFzIjogIm5vbmV8PHN0cmluZz4rIiwKICAgICAgICAiZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zIjogIm5vbmV8PHRyYWNrLWxpc3Q+fDxhdXRvLXRyYWNrLWxpc3Q+fHN1YmdyaWQgPGxpbmUtbmFtZS1saXN0Pj8iLAogICAgICAgICJncmlkLXRlbXBsYXRlLXJvd3MiOiAibm9uZXw8dHJhY2stbGlzdD58PGF1dG8tdHJhY2stbGlzdD58c3ViZ3JpZCA8bGluZS1uYW1lLWxpc3Q+PyIsCiAgICAgICAgImhhbmdpbmctcHVuY3R1YXRpb24iOiAibm9uZXxbZmlyc3R8fFtmb3JjZS1lbmR8YWxsb3ctZW5kXXx8bGFzdF0iLAogICAgICAgICJoZWlnaHQiOiAiYXV0b3w8bGVuZ3RoPnw8cGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8Zml0LWNvbnRlbnR8Zml0LWNvbnRlbnQoIDxsZW5ndGgtcGVyY2VudGFnZT4gKSIsCiAgICAgICAgImh5cGhlbmF0ZS1jaGFyYWN0ZXIiOiAiYXV0b3w8c3RyaW5nPiIsCiAgICAgICAgImh5cGhlbnMiOiAibm9uZXxtYW51YWx8YXV0byIsCiAgICAgICAgImltYWdlLW9yaWVudGF0aW9uIjogImZyb20taW1hZ2V8PGFuZ2xlPnxbPGFuZ2xlPj8gZmxpcF0iLAogICAgICAgICJpbWFnZS1yZW5kZXJpbmciOiAiYXV0b3xjcmlzcC1lZGdlc3xwaXhlbGF0ZWR8b3B0aW1pemVTcGVlZHxvcHRpbWl6ZVF1YWxpdHl8PC1ub24tc3RhbmRhcmQtaW1hZ2UtcmVuZGVyaW5nPiIsCiAgICAgICAgImltYWdlLXJlc29sdXRpb24iOiAiW2Zyb20taW1hZ2V8fDxyZXNvbHV0aW9uPl0mJnNuYXA/IiwKICAgICAgICAiaW1lLW1vZGUiOiAiYXV0b3xub3JtYWx8YWN0aXZlfGluYWN0aXZlfGRpc2FibGVkIiwKICAgICAgICAiaW5pdGlhbC1sZXR0ZXIiOiAibm9ybWFsfFs8bnVtYmVyPiA8aW50ZWdlcj4/XSIsCiAgICAgICAgImluaXRpYWwtbGV0dGVyLWFsaWduIjogIlthdXRvfGFscGhhYmV0aWN8aGFuZ2luZ3xpZGVvZ3JhcGhpY10iLAogICAgICAgICJpbmxpbmUtc2l6ZSI6ICI8J3dpZHRoJz4iLAogICAgICAgICJpbnB1dC1zZWN1cml0eSI6ICJhdXRvfG5vbmUiLAogICAgICAgICJpbnNldCI6ICI8J3RvcCc+ezEsNH0iLAogICAgICAgICJpbnNldC1ibG9jayI6ICI8J3RvcCc+ezEsMn0iLAogICAgICAgICJpbnNldC1ibG9jay1lbmQiOiAiPCd0b3AnPiIsCiAgICAgICAgImluc2V0LWJsb2NrLXN0YXJ0IjogIjwndG9wJz4iLAogICAgICAgICJpbnNldC1pbmxpbmUiOiAiPCd0b3AnPnsxLDJ9IiwKICAgICAgICAiaW5zZXQtaW5saW5lLWVuZCI6ICI8J3RvcCc+IiwKICAgICAgICAiaW5zZXQtaW5saW5lLXN0YXJ0IjogIjwndG9wJz4iLAogICAgICAgICJpc29sYXRpb24iOiAiYXV0b3xpc29sYXRlIiwKICAgICAgICAianVzdGlmeS1jb250ZW50IjogIm5vcm1hbHw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IFs8Y29udGVudC1wb3NpdGlvbj58bGVmdHxyaWdodF0iLAogICAgICAgICJqdXN0aWZ5LWl0ZW1zIjogIm5vcm1hbHxzdHJldGNofDxiYXNlbGluZS1wb3NpdGlvbj58PG92ZXJmbG93LXBvc2l0aW9uPj8gWzxzZWxmLXBvc2l0aW9uPnxsZWZ0fHJpZ2h0XXxsZWdhY3l8bGVnYWN5JiZbbGVmdHxyaWdodHxjZW50ZXJdIiwKICAgICAgICAianVzdGlmeS1zZWxmIjogImF1dG98bm9ybWFsfHN0cmV0Y2h8PGJhc2VsaW5lLXBvc2l0aW9uPnw8b3ZlcmZsb3ctcG9zaXRpb24+PyBbPHNlbGYtcG9zaXRpb24+fGxlZnR8cmlnaHRdIiwKICAgICAgICAianVzdGlmeS10cmFja3MiOiAiW25vcm1hbHw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IFs8Y29udGVudC1wb3NpdGlvbj58bGVmdHxyaWdodF1dIyIsCiAgICAgICAgImxlZnQiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+fGF1dG8iLAogICAgICAgICJsZXR0ZXItc3BhY2luZyI6ICJub3JtYWx8PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImxpbmUtYnJlYWsiOiAiYXV0b3xsb29zZXxub3JtYWx8c3RyaWN0fGFueXdoZXJlIiwKICAgICAgICAibGluZS1jbGFtcCI6ICJub25lfDxpbnRlZ2VyPiIsCiAgICAgICAgImxpbmUtaGVpZ2h0IjogIm5vcm1hbHw8bnVtYmVyPnw8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJsaW5lLWhlaWdodC1zdGVwIjogIjxsZW5ndGg+IiwKICAgICAgICAibGlzdC1zdHlsZSI6ICI8J2xpc3Qtc3R5bGUtdHlwZSc+fHw8J2xpc3Qtc3R5bGUtcG9zaXRpb24nPnx8PCdsaXN0LXN0eWxlLWltYWdlJz4iLAogICAgICAgICJsaXN0LXN0eWxlLWltYWdlIjogIjxpbWFnZT58bm9uZSIsCiAgICAgICAgImxpc3Qtc3R5bGUtcG9zaXRpb24iOiAiaW5zaWRlfG91dHNpZGUiLAogICAgICAgICJsaXN0LXN0eWxlLXR5cGUiOiAiPGNvdW50ZXItc3R5bGU+fDxzdHJpbmc+fG5vbmUiLAogICAgICAgICJtYXJnaW4iOiAiWzxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvXXsxLDR9IiwKICAgICAgICAibWFyZ2luLWJsb2NrIjogIjwnbWFyZ2luLWxlZnQnPnsxLDJ9IiwKICAgICAgICAibWFyZ2luLWJsb2NrLWVuZCI6ICI8J21hcmdpbi1sZWZ0Jz4iLAogICAgICAgICJtYXJnaW4tYmxvY2stc3RhcnQiOiAiPCdtYXJnaW4tbGVmdCc+IiwKICAgICAgICAibWFyZ2luLWJvdHRvbSI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgIm1hcmdpbi1pbmxpbmUiOiAiPCdtYXJnaW4tbGVmdCc+ezEsMn0iLAogICAgICAgICJtYXJnaW4taW5saW5lLWVuZCI6ICI8J21hcmdpbi1sZWZ0Jz4iLAogICAgICAgICJtYXJnaW4taW5saW5lLXN0YXJ0IjogIjwnbWFyZ2luLWxlZnQnPiIsCiAgICAgICAgIm1hcmdpbi1sZWZ0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvIiwKICAgICAgICAibWFyZ2luLXJpZ2h0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvIiwKICAgICAgICAibWFyZ2luLXRvcCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgIm1hcmdpbi10cmltIjogIm5vbmV8aW4tZmxvd3xhbGwiLAogICAgICAgICJtYXNrIjogIjxtYXNrLWxheWVyPiMiLAogICAgICAgICJtYXNrLWJvcmRlciI6ICI8J21hc2stYm9yZGVyLXNvdXJjZSc+fHw8J21hc2stYm9yZGVyLXNsaWNlJz4gWy8gPCdtYXNrLWJvcmRlci13aWR0aCc+PyBbLyA8J21hc2stYm9yZGVyLW91dHNldCc+XT9dP3x8PCdtYXNrLWJvcmRlci1yZXBlYXQnPnx8PCdtYXNrLWJvcmRlci1tb2RlJz4iLAogICAgICAgICJtYXNrLWJvcmRlci1tb2RlIjogImx1bWluYW5jZXxhbHBoYSIsCiAgICAgICAgIm1hc2stYm9yZGVyLW91dHNldCI6ICJbPGxlbmd0aD58PG51bWJlcj5dezEsNH0iLAogICAgICAgICJtYXNrLWJvcmRlci1yZXBlYXQiOiAiW3N0cmV0Y2h8cmVwZWF0fHJvdW5kfHNwYWNlXXsxLDJ9IiwKICAgICAgICAibWFzay1ib3JkZXItc2xpY2UiOiAiPG51bWJlci1wZXJjZW50YWdlPnsxLDR9IGZpbGw/IiwKICAgICAgICAibWFzay1ib3JkZXItc291cmNlIjogIm5vbmV8PGltYWdlPiIsCiAgICAgICAgIm1hc2stYm9yZGVyLXdpZHRoIjogIls8bGVuZ3RoLXBlcmNlbnRhZ2U+fDxudW1iZXI+fGF1dG9dezEsNH0iLAogICAgICAgICJtYXNrLWNsaXAiOiAiWzxnZW9tZXRyeS1ib3g+fG5vLWNsaXBdIyIsCiAgICAgICAgIm1hc2stY29tcG9zaXRlIjogIjxjb21wb3NpdGluZy1vcGVyYXRvcj4jIiwKICAgICAgICAibWFzay1pbWFnZSI6ICI8bWFzay1yZWZlcmVuY2U+IyIsCiAgICAgICAgIm1hc2stbW9kZSI6ICI8bWFza2luZy1tb2RlPiMiLAogICAgICAgICJtYXNrLW9yaWdpbiI6ICI8Z2VvbWV0cnktYm94PiMiLAogICAgICAgICJtYXNrLXBvc2l0aW9uIjogIjxwb3NpdGlvbj4jIiwKICAgICAgICAibWFzay1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAibWFzay1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICJtYXNrLXR5cGUiOiAibHVtaW5hbmNlfGFscGhhIiwKICAgICAgICAibWFzb25yeS1hdXRvLWZsb3ciOiAiW3BhY2t8bmV4dF18fFtkZWZpbml0ZS1maXJzdHxvcmRlcmVkXSIsCiAgICAgICAgIm1hdGgtZGVwdGgiOiAiYXV0by1hZGR8YWRkKCA8aW50ZWdlcj4gKXw8aW50ZWdlcj4iLAogICAgICAgICJtYXRoLXNoaWZ0IjogIm5vcm1hbHxjb21wYWN0IiwKICAgICAgICAibWF0aC1zdHlsZSI6ICJub3JtYWx8Y29tcGFjdCIsCiAgICAgICAgIm1heC1ibG9jay1zaXplIjogIjwnbWF4LXdpZHRoJz4iLAogICAgICAgICJtYXgtaGVpZ2h0IjogIm5vbmV8PGxlbmd0aC1wZXJjZW50YWdlPnxtaW4tY29udGVudHxtYXgtY29udGVudHxmaXQtY29udGVudHxmaXQtY29udGVudCggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAibWF4LWlubGluZS1zaXplIjogIjwnbWF4LXdpZHRoJz4iLAogICAgICAgICJtYXgtbGluZXMiOiAibm9uZXw8aW50ZWdlcj4iLAogICAgICAgICJtYXgtd2lkdGgiOiAibm9uZXw8bGVuZ3RoLXBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8PC1ub24tc3RhbmRhcmQtd2lkdGg+IiwKICAgICAgICAibWluLWJsb2NrLXNpemUiOiAiPCdtaW4td2lkdGgnPiIsCiAgICAgICAgIm1pbi1oZWlnaHQiOiAiYXV0b3w8bGVuZ3RoPnw8cGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8Zml0LWNvbnRlbnR8Zml0LWNvbnRlbnQoIDxsZW5ndGgtcGVyY2VudGFnZT4gKSIsCiAgICAgICAgIm1pbi1pbmxpbmUtc2l6ZSI6ICI8J21pbi13aWR0aCc+IiwKICAgICAgICAibWluLXdpZHRoIjogImF1dG98PGxlbmd0aD58PHBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8PC1ub24tc3RhbmRhcmQtd2lkdGg+IiwKICAgICAgICAibWl4LWJsZW5kLW1vZGUiOiAiPGJsZW5kLW1vZGU+fHBsdXMtbGlnaHRlciIsCiAgICAgICAgIm9iamVjdC1maXQiOiAiZmlsbHxjb250YWlufGNvdmVyfG5vbmV8c2NhbGUtZG93biIsCiAgICAgICAgIm9iamVjdC1wb3NpdGlvbiI6ICI8cG9zaXRpb24+IiwKICAgICAgICAib2Zmc2V0IjogIls8J29mZnNldC1wb3NpdGlvbic+PyBbPCdvZmZzZXQtcGF0aCc+IFs8J29mZnNldC1kaXN0YW5jZSc+fHw8J29mZnNldC1yb3RhdGUnPl0/XT9dISBbLyA8J29mZnNldC1hbmNob3InPl0/IiwKICAgICAgICAib2Zmc2V0LWFuY2hvciI6ICJhdXRvfDxwb3NpdGlvbj4iLAogICAgICAgICJvZmZzZXQtZGlzdGFuY2UiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgIm9mZnNldC1wYXRoIjogIm5vbmV8cmF5KCBbPGFuZ2xlPiYmPHNpemU+JiZjb250YWluP10gKXw8cGF0aCgpPnw8dXJsPnxbPGJhc2ljLXNoYXBlPnx8PGdlb21ldHJ5LWJveD5dIiwKICAgICAgICAib2Zmc2V0LXBvc2l0aW9uIjogImF1dG98PHBvc2l0aW9uPiIsCiAgICAgICAgIm9mZnNldC1yb3RhdGUiOiAiW2F1dG98cmV2ZXJzZV18fDxhbmdsZT4iLAogICAgICAgICJvcGFjaXR5IjogIjxhbHBoYS12YWx1ZT4iLAogICAgICAgICJvcmRlciI6ICI8aW50ZWdlcj4iLAogICAgICAgICJvcnBoYW5zIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIm91dGxpbmUiOiAiWzwnb3V0bGluZS1jb2xvcic+fHw8J291dGxpbmUtc3R5bGUnPnx8PCdvdXRsaW5lLXdpZHRoJz5dIiwKICAgICAgICAib3V0bGluZS1jb2xvciI6ICI8Y29sb3I+fGludmVydCIsCiAgICAgICAgIm91dGxpbmUtb2Zmc2V0IjogIjxsZW5ndGg+IiwKICAgICAgICAib3V0bGluZS1zdHlsZSI6ICJhdXRvfDwnYm9yZGVyLXN0eWxlJz4iLAogICAgICAgICJvdXRsaW5lLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgIm92ZXJmbG93IjogIlt2aXNpYmxlfGhpZGRlbnxjbGlwfHNjcm9sbHxhdXRvXXsxLDJ9fDwtbm9uLXN0YW5kYXJkLW92ZXJmbG93PiIsCiAgICAgICAgIm92ZXJmbG93LWFuY2hvciI6ICJhdXRvfG5vbmUiLAogICAgICAgICJvdmVyZmxvdy1ibG9jayI6ICJ2aXNpYmxlfGhpZGRlbnxjbGlwfHNjcm9sbHxhdXRvIiwKICAgICAgICAib3ZlcmZsb3ctY2xpcC1ib3giOiAicGFkZGluZy1ib3h8Y29udGVudC1ib3giLAogICAgICAgICJvdmVyZmxvdy1jbGlwLW1hcmdpbiI6ICI8dmlzdWFsLWJveD58fDxsZW5ndGggWzAs4oieXT4iLAogICAgICAgICJvdmVyZmxvdy1pbmxpbmUiOiAidmlzaWJsZXxoaWRkZW58Y2xpcHxzY3JvbGx8YXV0byIsCiAgICAgICAgIm92ZXJmbG93LXdyYXAiOiAibm9ybWFsfGJyZWFrLXdvcmR8YW55d2hlcmUiLAogICAgICAgICJvdmVyZmxvdy14IjogInZpc2libGV8aGlkZGVufGNsaXB8c2Nyb2xsfGF1dG8iLAogICAgICAgICJvdmVyZmxvdy15IjogInZpc2libGV8aGlkZGVufGNsaXB8c2Nyb2xsfGF1dG8iLAogICAgICAgICJvdmVyc2Nyb2xsLWJlaGF2aW9yIjogIltjb250YWlufG5vbmV8YXV0b117MSwyfSIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3ItYmxvY2siOiAiY29udGFpbnxub25lfGF1dG8iLAogICAgICAgICJvdmVyc2Nyb2xsLWJlaGF2aW9yLWlubGluZSI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3IteCI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3IteSI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgInBhZGRpbmciOiAiWzxsZW5ndGg+fDxwZXJjZW50YWdlPl17MSw0fSIsCiAgICAgICAgInBhZGRpbmctYmxvY2siOiAiPCdwYWRkaW5nLWxlZnQnPnsxLDJ9IiwKICAgICAgICAicGFkZGluZy1ibG9jay1lbmQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctYmxvY2stc3RhcnQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZGRpbmctaW5saW5lIjogIjwncGFkZGluZy1sZWZ0Jz57MSwyfSIsCiAgICAgICAgInBhZGRpbmctaW5saW5lLWVuZCI6ICI8J3BhZGRpbmctbGVmdCc+IiwKICAgICAgICAicGFkZGluZy1pbmxpbmUtc3RhcnQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctbGVmdCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJwYWRkaW5nLXJpZ2h0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZGRpbmctdG9wIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZ2UtYnJlYWstYWZ0ZXIiOiAiYXV0b3xhbHdheXN8YXZvaWR8bGVmdHxyaWdodHxyZWN0b3x2ZXJzbyIsCiAgICAgICAgInBhZ2UtYnJlYWstYmVmb3JlIjogImF1dG98YWx3YXlzfGF2b2lkfGxlZnR8cmlnaHR8cmVjdG98dmVyc28iLAogICAgICAgICJwYWdlLWJyZWFrLWluc2lkZSI6ICJhdXRvfGF2b2lkIiwKICAgICAgICAicGFpbnQtb3JkZXIiOiAibm9ybWFsfFtmaWxsfHxzdHJva2V8fG1hcmtlcnNdIiwKICAgICAgICAicGVyc3BlY3RpdmUiOiAibm9uZXw8bGVuZ3RoPiIsCiAgICAgICAgInBlcnNwZWN0aXZlLW9yaWdpbiI6ICI8cG9zaXRpb24+IiwKICAgICAgICAicGxhY2UtY29udGVudCI6ICI8J2FsaWduLWNvbnRlbnQnPiA8J2p1c3RpZnktY29udGVudCc+PyIsCiAgICAgICAgInBsYWNlLWl0ZW1zIjogIjwnYWxpZ24taXRlbXMnPiA8J2p1c3RpZnktaXRlbXMnPj8iLAogICAgICAgICJwbGFjZS1zZWxmIjogIjwnYWxpZ24tc2VsZic+IDwnanVzdGlmeS1zZWxmJz4/IiwKICAgICAgICAicG9pbnRlci1ldmVudHMiOiAiYXV0b3xub25lfHZpc2libGVQYWludGVkfHZpc2libGVGaWxsfHZpc2libGVTdHJva2V8dmlzaWJsZXxwYWludGVkfGZpbGx8c3Ryb2tlfGFsbHxpbmhlcml0IiwKICAgICAgICAicG9zaXRpb24iOiAic3RhdGljfHJlbGF0aXZlfGFic29sdXRlfHN0aWNreXxmaXhlZHwtd2Via2l0LXN0aWNreSIsCiAgICAgICAgInF1b3RlcyI6ICJub25lfGF1dG98WzxzdHJpbmc+IDxzdHJpbmc+XSsiLAogICAgICAgICJyZXNpemUiOiAibm9uZXxib3RofGhvcml6b250YWx8dmVydGljYWx8YmxvY2t8aW5saW5lIiwKICAgICAgICAicmlnaHQiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+fGF1dG8iLAogICAgICAgICJyb3RhdGUiOiAibm9uZXw8YW5nbGU+fFt4fHl8enw8bnVtYmVyPnszfV0mJjxhbmdsZT4iLAogICAgICAgICJyb3ctZ2FwIjogIm5vcm1hbHw8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAicnVieS1hbGlnbiI6ICJzdGFydHxjZW50ZXJ8c3BhY2UtYmV0d2VlbnxzcGFjZS1hcm91bmQiLAogICAgICAgICJydWJ5LW1lcmdlIjogInNlcGFyYXRlfGNvbGxhcHNlfGF1dG8iLAogICAgICAgICJydWJ5LXBvc2l0aW9uIjogIlthbHRlcm5hdGV8fFtvdmVyfHVuZGVyXV18aW50ZXItY2hhcmFjdGVyIiwKICAgICAgICAic2NhbGUiOiAibm9uZXw8bnVtYmVyPnsxLDN9IiwKICAgICAgICAic2Nyb2xsYmFyLWNvbG9yIjogImF1dG98PGNvbG9yPnsyfSIsCiAgICAgICAgInNjcm9sbGJhci1ndXR0ZXIiOiAiYXV0b3xzdGFibGUmJmJvdGgtZWRnZXM/IiwKICAgICAgICAic2Nyb2xsYmFyLXdpZHRoIjogImF1dG98dGhpbnxub25lIiwKICAgICAgICAic2Nyb2xsLWJlaGF2aW9yIjogImF1dG98c21vb3RoIiwKICAgICAgICAic2Nyb2xsLW1hcmdpbiI6ICI8bGVuZ3RoPnsxLDR9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ibG9jayI6ICI8bGVuZ3RoPnsxLDJ9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ibG9jay1zdGFydCI6ICI8bGVuZ3RoPiIsCiAgICAgICAgInNjcm9sbC1tYXJnaW4tYmxvY2stZW5kIjogIjxsZW5ndGg+IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ib3R0b20iOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWlubGluZSI6ICI8bGVuZ3RoPnsxLDJ9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1pbmxpbmUtc3RhcnQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWlubGluZS1lbmQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWxlZnQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLXJpZ2h0IjogIjxsZW5ndGg+IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi10b3AiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZyI6ICJbYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+XXsxLDR9IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctYmxvY2siOiAiW2F1dG98PGxlbmd0aC1wZXJjZW50YWdlPl17MSwyfSIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLWJsb2NrLXN0YXJ0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLWJsb2NrLWVuZCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1ib3R0b20iOiAiYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctaW5saW5lIjogIlthdXRvfDxsZW5ndGgtcGVyY2VudGFnZT5dezEsMn0iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1pbmxpbmUtc3RhcnQiOiAiYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctaW5saW5lLWVuZCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1sZWZ0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLXJpZ2h0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLXRvcCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtc25hcC1hbGlnbiI6ICJbbm9uZXxzdGFydHxlbmR8Y2VudGVyXXsxLDJ9IiwKICAgICAgICAic2Nyb2xsLXNuYXAtY29vcmRpbmF0ZSI6ICJub25lfDxwb3NpdGlvbj4jIiwKICAgICAgICAic2Nyb2xsLXNuYXAtZGVzdGluYXRpb24iOiAiPHBvc2l0aW9uPiIsCiAgICAgICAgInNjcm9sbC1zbmFwLXBvaW50cy14IjogIm5vbmV8cmVwZWF0KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJzY3JvbGwtc25hcC1wb2ludHMteSI6ICJub25lfHJlcGVhdCggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAic2Nyb2xsLXNuYXAtc3RvcCI6ICJub3JtYWx8YWx3YXlzIiwKICAgICAgICAic2Nyb2xsLXNuYXAtdHlwZSI6ICJub25lfFt4fHl8YmxvY2t8aW5saW5lfGJvdGhdIFttYW5kYXRvcnl8cHJveGltaXR5XT8iLAogICAgICAgICJzY3JvbGwtc25hcC10eXBlLXgiOiAibm9uZXxtYW5kYXRvcnl8cHJveGltaXR5IiwKICAgICAgICAic2Nyb2xsLXNuYXAtdHlwZS15IjogIm5vbmV8bWFuZGF0b3J5fHByb3hpbWl0eSIsCiAgICAgICAgInNjcm9sbC10aW1lbGluZSI6ICI8c2Nyb2xsLXRpbWVsaW5lLW5hbWU+fHw8c2Nyb2xsLXRpbWVsaW5lLWF4aXM+IiwKICAgICAgICAic2Nyb2xsLXRpbWVsaW5lLWF4aXMiOiAiYmxvY2t8aW5saW5lfHZlcnRpY2FsfGhvcml6b250YWwiLAogICAgICAgICJzY3JvbGwtdGltZWxpbmUtbmFtZSI6ICJub25lfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2hhcGUtaW1hZ2UtdGhyZXNob2xkIjogIjxhbHBoYS12YWx1ZT4iLAogICAgICAgICJzaGFwZS1tYXJnaW4iOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNoYXBlLW91dHNpZGUiOiAibm9uZXxbPHNoYXBlLWJveD58fDxiYXNpYy1zaGFwZT5dfDxpbWFnZT4iLAogICAgICAgICJ0YWItc2l6ZSI6ICI8aW50ZWdlcj58PGxlbmd0aD4iLAogICAgICAgICJ0YWJsZS1sYXlvdXQiOiAiYXV0b3xmaXhlZCIsCiAgICAgICAgInRleHQtYWxpZ24iOiAic3RhcnR8ZW5kfGxlZnR8cmlnaHR8Y2VudGVyfGp1c3RpZnl8bWF0Y2gtcGFyZW50IiwKICAgICAgICAidGV4dC1hbGlnbi1sYXN0IjogImF1dG98c3RhcnR8ZW5kfGxlZnR8cmlnaHR8Y2VudGVyfGp1c3RpZnkiLAogICAgICAgICJ0ZXh0LWNvbWJpbmUtdXByaWdodCI6ICJub25lfGFsbHxbZGlnaXRzIDxpbnRlZ2VyPj9dIiwKICAgICAgICAidGV4dC1kZWNvcmF0aW9uIjogIjwndGV4dC1kZWNvcmF0aW9uLWxpbmUnPnx8PCd0ZXh0LWRlY29yYXRpb24tc3R5bGUnPnx8PCd0ZXh0LWRlY29yYXRpb24tY29sb3InPnx8PCd0ZXh0LWRlY29yYXRpb24tdGhpY2tuZXNzJz4iLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgInRleHQtZGVjb3JhdGlvbi1saW5lIjogIm5vbmV8W3VuZGVybGluZXx8b3ZlcmxpbmV8fGxpbmUtdGhyb3VnaHx8YmxpbmtdfHNwZWxsaW5nLWVycm9yfGdyYW1tYXItZXJyb3IiLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tc2tpcCI6ICJub25lfFtvYmplY3RzfHxbc3BhY2VzfFtsZWFkaW5nLXNwYWNlc3x8dHJhaWxpbmctc3BhY2VzXV18fGVkZ2VzfHxib3gtZGVjb3JhdGlvbl0iLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tc2tpcC1pbmsiOiAiYXV0b3xhbGx8bm9uZSIsCiAgICAgICAgInRleHQtZGVjb3JhdGlvbi1zdHlsZSI6ICJzb2xpZHxkb3VibGV8ZG90dGVkfGRhc2hlZHx3YXZ5IiwKICAgICAgICAidGV4dC1kZWNvcmF0aW9uLXRoaWNrbmVzcyI6ICJhdXRvfGZyb20tZm9udHw8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJ0ZXh0LWVtcGhhc2lzIjogIjwndGV4dC1lbXBoYXNpcy1zdHlsZSc+fHw8J3RleHQtZW1waGFzaXMtY29sb3InPiIsCiAgICAgICAgInRleHQtZW1waGFzaXMtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgInRleHQtZW1waGFzaXMtcG9zaXRpb24iOiAiW292ZXJ8dW5kZXJdJiZbcmlnaHR8bGVmdF0iLAogICAgICAgICJ0ZXh0LWVtcGhhc2lzLXN0eWxlIjogIm5vbmV8W1tmaWxsZWR8b3Blbl18fFtkb3R8Y2lyY2xlfGRvdWJsZS1jaXJjbGV8dHJpYW5nbGV8c2VzYW1lXV18PHN0cmluZz4iLAogICAgICAgICJ0ZXh0LWluZGVudCI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+JiZoYW5naW5nPyYmZWFjaC1saW5lPyIsCiAgICAgICAgInRleHQtanVzdGlmeSI6ICJhdXRvfGludGVyLWNoYXJhY3RlcnxpbnRlci13b3JkfG5vbmUiLAogICAgICAgICJ0ZXh0LW9yaWVudGF0aW9uIjogIm1peGVkfHVwcmlnaHR8c2lkZXdheXMiLAogICAgICAgICJ0ZXh0LW92ZXJmbG93IjogIltjbGlwfGVsbGlwc2lzfDxzdHJpbmc+XXsxLDJ9IiwKICAgICAgICAidGV4dC1yZW5kZXJpbmciOiAiYXV0b3xvcHRpbWl6ZVNwZWVkfG9wdGltaXplTGVnaWJpbGl0eXxnZW9tZXRyaWNQcmVjaXNpb24iLAogICAgICAgICJ0ZXh0LXNoYWRvdyI6ICJub25lfDxzaGFkb3ctdD4jIiwKICAgICAgICAidGV4dC1zaXplLWFkanVzdCI6ICJub25lfGF1dG98PHBlcmNlbnRhZ2U+IiwKICAgICAgICAidGV4dC10cmFuc2Zvcm0iOiAibm9uZXxjYXBpdGFsaXplfHVwcGVyY2FzZXxsb3dlcmNhc2V8ZnVsbC13aWR0aHxmdWxsLXNpemUta2FuYSIsCiAgICAgICAgInRleHQtdW5kZXJsaW5lLW9mZnNldCI6ICJhdXRvfDxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInRleHQtdW5kZXJsaW5lLXBvc2l0aW9uIjogImF1dG98ZnJvbS1mb250fFt1bmRlcnx8W2xlZnR8cmlnaHRdXSIsCiAgICAgICAgInRvcCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgInRvdWNoLWFjdGlvbiI6ICJhdXRvfG5vbmV8W1twYW4teHxwYW4tbGVmdHxwYW4tcmlnaHRdfHxbcGFuLXl8cGFuLXVwfHBhbi1kb3duXXx8cGluY2gtem9vbV18bWFuaXB1bGF0aW9uIiwKICAgICAgICAidHJhbnNmb3JtIjogIm5vbmV8PHRyYW5zZm9ybS1saXN0PiIsCiAgICAgICAgInRyYW5zZm9ybS1ib3giOiAiY29udGVudC1ib3h8Ym9yZGVyLWJveHxmaWxsLWJveHxzdHJva2UtYm94fHZpZXctYm94IiwKICAgICAgICAidHJhbnNmb3JtLW9yaWdpbiI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodHx0b3B8Ym90dG9tXXxbWzxsZW5ndGgtcGVyY2VudGFnZT58bGVmdHxjZW50ZXJ8cmlnaHRdJiZbPGxlbmd0aC1wZXJjZW50YWdlPnx0b3B8Y2VudGVyfGJvdHRvbV1dIDxsZW5ndGg+PyIsCiAgICAgICAgInRyYW5zZm9ybS1zdHlsZSI6ICJmbGF0fHByZXNlcnZlLTNkIiwKICAgICAgICAidHJhbnNpdGlvbiI6ICI8c2luZ2xlLXRyYW5zaXRpb24+IyIsCiAgICAgICAgInRyYW5zaXRpb24tZGVsYXkiOiAiPHRpbWU+IyIsCiAgICAgICAgInRyYW5zaXRpb24tZHVyYXRpb24iOiAiPHRpbWU+IyIsCiAgICAgICAgInRyYW5zaXRpb24tcHJvcGVydHkiOiAibm9uZXw8c2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHk+IyIsCiAgICAgICAgInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uIjogIjxlYXNpbmctZnVuY3Rpb24+IyIsCiAgICAgICAgInRyYW5zbGF0ZSI6ICJub25lfDxsZW5ndGgtcGVyY2VudGFnZT4gWzxsZW5ndGgtcGVyY2VudGFnZT4gPGxlbmd0aD4/XT8iLAogICAgICAgICJ1bmljb2RlLWJpZGkiOiAibm9ybWFsfGVtYmVkfGlzb2xhdGV8YmlkaS1vdmVycmlkZXxpc29sYXRlLW92ZXJyaWRlfHBsYWludGV4dHwtbW96LWlzb2xhdGV8LW1vei1pc29sYXRlLW92ZXJyaWRlfC1tb3otcGxhaW50ZXh0fC13ZWJraXQtaXNvbGF0ZXwtd2Via2l0LWlzb2xhdGUtb3ZlcnJpZGV8LXdlYmtpdC1wbGFpbnRleHQiLAogICAgICAgICJ1c2VyLXNlbGVjdCI6ICJhdXRvfHRleHR8bm9uZXxjb250YWlufGFsbCIsCiAgICAgICAgInZlcnRpY2FsLWFsaWduIjogImJhc2VsaW5lfHN1YnxzdXBlcnx0ZXh0LXRvcHx0ZXh0LWJvdHRvbXxtaWRkbGV8dG9wfGJvdHRvbXw8cGVyY2VudGFnZT58PGxlbmd0aD4iLAogICAgICAgICJ2aXNpYmlsaXR5IjogInZpc2libGV8aGlkZGVufGNvbGxhcHNlIiwKICAgICAgICAid2hpdGUtc3BhY2UiOiAibm9ybWFsfHByZXxub3dyYXB8cHJlLXdyYXB8cHJlLWxpbmV8YnJlYWstc3BhY2VzIiwKICAgICAgICAid2lkb3dzIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIndpZHRoIjogImF1dG98PGxlbmd0aD58PHBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8ZmlsbHxzdHJldGNofGludHJpbnNpY3wtbW96LW1heC1jb250ZW50fC13ZWJraXQtbWF4LWNvbnRlbnR8LW1vei1maXQtY29udGVudHwtd2Via2l0LWZpdC1jb250ZW50IiwKICAgICAgICAid2lsbC1jaGFuZ2UiOiAiYXV0b3w8YW5pbWF0ZWFibGUtZmVhdHVyZT4jIiwKICAgICAgICAid29yZC1icmVhayI6ICJub3JtYWx8YnJlYWstYWxsfGtlZXAtYWxsfGJyZWFrLXdvcmQiLAogICAgICAgICJ3b3JkLXNwYWNpbmciOiAibm9ybWFsfDxsZW5ndGg+IiwKICAgICAgICAid29yZC13cmFwIjogIm5vcm1hbHxicmVhay13b3JkIiwKICAgICAgICAid3JpdGluZy1tb2RlIjogImhvcml6b250YWwtdGJ8dmVydGljYWwtcmx8dmVydGljYWwtbHJ8c2lkZXdheXMtcmx8c2lkZXdheXMtbHJ8PHN2Zy13cml0aW5nLW1vZGU+IiwKICAgICAgICAiei1pbmRleCI6ICJhdXRvfDxpbnRlZ2VyPiIsCiAgICAgICAgInpvb20iOiAibm9ybWFsfHJlc2V0fDxudW1iZXI+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgIi1tb3otYmFja2dyb3VuZC1jbGlwIjogInBhZGRpbmd8Ym9yZGVyIiwKICAgICAgICAiLW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQiOiAiPCdib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzJz4iLAogICAgICAgICItbW96LWJvcmRlci1yYWRpdXMtYm90dG9tcmlnaHQiOiAiPCdib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1cyc+IiwKICAgICAgICAiLW1vei1ib3JkZXItcmFkaXVzLXRvcGxlZnQiOiAiPCdib3JkZXItdG9wLWxlZnQtcmFkaXVzJz4iLAogICAgICAgICItbW96LWJvcmRlci1yYWRpdXMtdG9wcmlnaHQiOiAiPCdib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1cyc+IiwKICAgICAgICAiLW1vei1jb250cm9sLWNoYXJhY3Rlci12aXNpYmlsaXR5IjogInZpc2libGV8aGlkZGVuIiwKICAgICAgICAiLW1vei1vc3gtZm9udC1zbW9vdGhpbmciOiAiYXV0b3xncmF5c2NhbGUiLAogICAgICAgICItbW96LXVzZXItc2VsZWN0IjogIm5vbmV8dGV4dHxhbGx8LW1vei1ub25lIiwKICAgICAgICAiLW1zLWZsZXgtYWxpZ24iOiAic3RhcnR8ZW5kfGNlbnRlcnxiYXNlbGluZXxzdHJldGNoIiwKICAgICAgICAiLW1zLWZsZXgtaXRlbS1hbGlnbiI6ICJhdXRvfHN0YXJ0fGVuZHxjZW50ZXJ8YmFzZWxpbmV8c3RyZXRjaCIsCiAgICAgICAgIi1tcy1mbGV4LWxpbmUtcGFjayI6ICJzdGFydHxlbmR8Y2VudGVyfGp1c3RpZnl8ZGlzdHJpYnV0ZXxzdHJldGNoIiwKICAgICAgICAiLW1zLWZsZXgtbmVnYXRpdmUiOiAiPCdmbGV4LXNocmluayc+IiwKICAgICAgICAiLW1zLWZsZXgtcGFjayI6ICJzdGFydHxlbmR8Y2VudGVyfGp1c3RpZnl8ZGlzdHJpYnV0ZSIsCiAgICAgICAgIi1tcy1mbGV4LW9yZGVyIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIi1tcy1mbGV4LXBvc2l0aXZlIjogIjwnZmxleC1ncm93Jz4iLAogICAgICAgICItbXMtZmxleC1wcmVmZXJyZWQtc2l6ZSI6ICI8J2ZsZXgtYmFzaXMnPiIsCiAgICAgICAgIi1tcy1pbnRlcnBvbGF0aW9uLW1vZGUiOiAibmVhcmVzdC1uZWlnaGJvcnxiaWN1YmljIiwKICAgICAgICAiLW1zLWdyaWQtY29sdW1uLWFsaWduIjogInN0YXJ0fGVuZHxjZW50ZXJ8c3RyZXRjaCIsCiAgICAgICAgIi1tcy1ncmlkLXJvdy1hbGlnbiI6ICJzdGFydHxlbmR8Y2VudGVyfHN0cmV0Y2giLAogICAgICAgICItbXMtaHlwaGVuYXRlLWxpbWl0LWxhc3QiOiAibm9uZXxhbHdheXN8Y29sdW1ufHBhZ2V8c3ByZWFkIiwKICAgICAgICAiLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXAiOiAiWzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnR8dGV4dF0jIiwKICAgICAgICAiLXdlYmtpdC1jb2x1bW4tYnJlYWstYWZ0ZXIiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWNvbHVtbi1icmVhay1iZWZvcmUiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWNvbHVtbi1icmVhay1pbnNpZGUiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWZvbnQtc21vb3RoaW5nIjogImF1dG98bm9uZXxhbnRpYWxpYXNlZHxzdWJwaXhlbC1hbnRpYWxpYXNlZCIsCiAgICAgICAgIi13ZWJraXQtbWFzay1ib3gtaW1hZ2UiOiAiWzx1cmw+fDxncmFkaWVudD58bm9uZV0gWzxsZW5ndGgtcGVyY2VudGFnZT57NH0gPC13ZWJraXQtbWFzay1ib3gtcmVwZWF0PnsyfV0/IiwKICAgICAgICAiLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3QiOiAiZWNvbm9teXxleGFjdCIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zZWN1cml0eSI6ICJub25lfGNpcmNsZXxkaXNjfHNxdWFyZSIsCiAgICAgICAgIi13ZWJraXQtdXNlci1kcmFnIjogIm5vbmV8ZWxlbWVudHxhdXRvIiwKICAgICAgICAiLXdlYmtpdC11c2VyLXNlbGVjdCI6ICJhdXRvfG5vbmV8dGV4dHxhbGwiLAogICAgICAgICJhbGlnbm1lbnQtYmFzZWxpbmUiOiAiYXV0b3xiYXNlbGluZXxiZWZvcmUtZWRnZXx0ZXh0LWJlZm9yZS1lZGdlfG1pZGRsZXxjZW50cmFsfGFmdGVyLWVkZ2V8dGV4dC1hZnRlci1lZGdlfGlkZW9ncmFwaGljfGFscGhhYmV0aWN8aGFuZ2luZ3xtYXRoZW1hdGljYWwiLAogICAgICAgICJiYXNlbGluZS1zaGlmdCI6ICJiYXNlbGluZXxzdWJ8c3VwZXJ8PHN2Zy1sZW5ndGg+IiwKICAgICAgICAiYmVoYXZpb3IiOiAiPHVybD4rIiwKICAgICAgICAiY2xpcC1ydWxlIjogIm5vbnplcm98ZXZlbm9kZCIsCiAgICAgICAgImN1ZSI6ICI8J2N1ZS1iZWZvcmUnPiA8J2N1ZS1hZnRlcic+PyIsCiAgICAgICAgImN1ZS1hZnRlciI6ICI8dXJsPiA8ZGVjaWJlbD4/fG5vbmUiLAogICAgICAgICJjdWUtYmVmb3JlIjogIjx1cmw+IDxkZWNpYmVsPj98bm9uZSIsCiAgICAgICAgImRvbWluYW50LWJhc2VsaW5lIjogImF1dG98dXNlLXNjcmlwdHxuby1jaGFuZ2V8cmVzZXQtc2l6ZXxpZGVvZ3JhcGhpY3xhbHBoYWJldGljfGhhbmdpbmd8bWF0aGVtYXRpY2FsfGNlbnRyYWx8bWlkZGxlfHRleHQtYWZ0ZXItZWRnZXx0ZXh0LWJlZm9yZS1lZGdlIiwKICAgICAgICAiZmlsbCI6ICI8cGFpbnQ+IiwKICAgICAgICAiZmlsbC1vcGFjaXR5IjogIjxudW1iZXItemVyby1vbmU+IiwKICAgICAgICAiZmlsbC1ydWxlIjogIm5vbnplcm98ZXZlbm9kZCIsCiAgICAgICAgImdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwiOiAiPGFuZ2xlPiIsCiAgICAgICAgImdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIjogIjxhbmdsZT4iLAogICAgICAgICJrZXJuaW5nIjogImF1dG98PHN2Zy1sZW5ndGg+IiwKICAgICAgICAibWFya2VyIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItZW5kIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItbWlkIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItc3RhcnQiOiAibm9uZXw8dXJsPiIsCiAgICAgICAgInBhdXNlIjogIjwncGF1c2UtYmVmb3JlJz4gPCdwYXVzZS1hZnRlcic+PyIsCiAgICAgICAgInBhdXNlLWFmdGVyIjogIjx0aW1lPnxub25lfHgtd2Vha3x3ZWFrfG1lZGl1bXxzdHJvbmd8eC1zdHJvbmciLAogICAgICAgICJwYXVzZS1iZWZvcmUiOiAiPHRpbWU+fG5vbmV8eC13ZWFrfHdlYWt8bWVkaXVtfHN0cm9uZ3x4LXN0cm9uZyIsCiAgICAgICAgInJlc3QiOiAiPCdyZXN0LWJlZm9yZSc+IDwncmVzdC1hZnRlcic+PyIsCiAgICAgICAgInJlc3QtYWZ0ZXIiOiAiPHRpbWU+fG5vbmV8eC13ZWFrfHdlYWt8bWVkaXVtfHN0cm9uZ3x4LXN0cm9uZyIsCiAgICAgICAgInJlc3QtYmVmb3JlIjogIjx0aW1lPnxub25lfHgtd2Vha3x3ZWFrfG1lZGl1bXxzdHJvbmd8eC1zdHJvbmciLAogICAgICAgICJzaGFwZS1yZW5kZXJpbmciOiAiYXV0b3xvcHRpbWl6ZVNwZWVkfGNyaXNwRWRnZXN8Z2VvbWV0cmljUHJlY2lzaW9uIiwKICAgICAgICAic3JjIjogIls8dXJsPiBbZm9ybWF0KCA8c3RyaW5nPiMgKV0/fGxvY2FsKCA8ZmFtaWx5LW5hbWU+ICldIyIsCiAgICAgICAgInNwZWFrIjogImF1dG98bm9uZXxub3JtYWwiLAogICAgICAgICJzcGVhay1hcyI6ICJub3JtYWx8c3BlbGwtb3V0fHxkaWdpdHN8fFtsaXRlcmFsLXB1bmN0dWF0aW9ufG5vLXB1bmN0dWF0aW9uXSIsCiAgICAgICAgInN0cm9rZSI6ICI8cGFpbnQ+IiwKICAgICAgICAic3Ryb2tlLWRhc2hhcnJheSI6ICJub25lfFs8c3ZnLWxlbmd0aD4rXSMiLAogICAgICAgICJzdHJva2UtZGFzaG9mZnNldCI6ICI8c3ZnLWxlbmd0aD4iLAogICAgICAgICJzdHJva2UtbGluZWNhcCI6ICJidXR0fHJvdW5kfHNxdWFyZSIsCiAgICAgICAgInN0cm9rZS1saW5lam9pbiI6ICJtaXRlcnxyb3VuZHxiZXZlbCIsCiAgICAgICAgInN0cm9rZS1taXRlcmxpbWl0IjogIjxudW1iZXItb25lLW9yLWdyZWF0ZXI+IiwKICAgICAgICAic3Ryb2tlLW9wYWNpdHkiOiAiPG51bWJlci16ZXJvLW9uZT4iLAogICAgICAgICJzdHJva2Utd2lkdGgiOiAiPHN2Zy1sZW5ndGg+IiwKICAgICAgICAidGV4dC1hbmNob3IiOiAic3RhcnR8bWlkZGxlfGVuZCIsCiAgICAgICAgInVuaWNvZGUtcmFuZ2UiOiAiPHVyYW5nZT4jIiwKICAgICAgICAidm9pY2UtYmFsYW5jZSI6ICI8bnVtYmVyPnxsZWZ0fGNlbnRlcnxyaWdodHxsZWZ0d2FyZHN8cmlnaHR3YXJkcyIsCiAgICAgICAgInZvaWNlLWR1cmF0aW9uIjogImF1dG98PHRpbWU+IiwKICAgICAgICAidm9pY2UtZmFtaWx5IjogIltbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy12b2ljZT5dICxdKiBbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy12b2ljZT5dfHByZXNlcnZlIiwKICAgICAgICAidm9pY2UtcGl0Y2giOiAiPGZyZXF1ZW5jeT4mJmFic29sdXRlfFtbeC1sb3d8bG93fG1lZGl1bXxoaWdofHgtaGlnaF18fFs8ZnJlcXVlbmN5Pnw8c2VtaXRvbmVzPnw8cGVyY2VudGFnZT5dXSIsCiAgICAgICAgInZvaWNlLXJhbmdlIjogIjxmcmVxdWVuY3k+JiZhYnNvbHV0ZXxbW3gtbG93fGxvd3xtZWRpdW18aGlnaHx4LWhpZ2hdfHxbPGZyZXF1ZW5jeT58PHNlbWl0b25lcz58PHBlcmNlbnRhZ2U+XV0iLAogICAgICAgICJ2b2ljZS1yYXRlIjogIltub3JtYWx8eC1zbG93fHNsb3d8bWVkaXVtfGZhc3R8eC1mYXN0XXx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAidm9pY2Utc3RyZXNzIjogIm5vcm1hbHxzdHJvbmd8bW9kZXJhdGV8bm9uZXxyZWR1Y2VkIiwKICAgICAgICAidm9pY2Utdm9sdW1lIjogInNpbGVudHxbW3gtc29mdHxzb2Z0fG1lZGl1bXxsb3VkfHgtbG91ZF18fDxkZWNpYmVsPl0iCiAgICB9LAogICAgImF0cnVsZXMiOiB7CiAgICAgICAgImNoYXJzZXQiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxzdHJpbmc+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgImNvdW50ZXItc3R5bGUiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxjb3VudGVyLXN0eWxlLW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgImFkZGl0aXZlLXN5bWJvbHMiOiAiWzxpbnRlZ2VyPiYmPHN5bWJvbD5dIyIsCiAgICAgICAgICAgICAgICAiZmFsbGJhY2siOiAiPGNvdW50ZXItc3R5bGUtbmFtZT4iLAogICAgICAgICAgICAgICAgIm5lZ2F0aXZlIjogIjxzeW1ib2w+IDxzeW1ib2w+PyIsCiAgICAgICAgICAgICAgICAicGFkIjogIjxpbnRlZ2VyPiYmPHN5bWJvbD4iLAogICAgICAgICAgICAgICAgInByZWZpeCI6ICI8c3ltYm9sPiIsCiAgICAgICAgICAgICAgICAicmFuZ2UiOiAiW1s8aW50ZWdlcj58aW5maW5pdGVdezJ9XSN8YXV0byIsCiAgICAgICAgICAgICAgICAic3BlYWstYXMiOiAiYXV0b3xidWxsZXRzfG51bWJlcnN8d29yZHN8c3BlbGwtb3V0fDxjb3VudGVyLXN0eWxlLW5hbWU+IiwKICAgICAgICAgICAgICAgICJzdWZmaXgiOiAiPHN5bWJvbD4iLAogICAgICAgICAgICAgICAgInN5bWJvbHMiOiAiPHN5bWJvbD4rIiwKICAgICAgICAgICAgICAgICJzeXN0ZW0iOiAiY3ljbGljfG51bWVyaWN8YWxwaGFiZXRpY3xzeW1ib2xpY3xhZGRpdGl2ZXxbZml4ZWQgPGludGVnZXI+P118W2V4dGVuZHMgPGNvdW50ZXItc3R5bGUtbmFtZT5dIgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiZG9jdW1lbnQiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIls8dXJsPnx1cmwtcHJlZml4KCA8c3RyaW5nPiApfGRvbWFpbiggPHN0cmluZz4gKXxtZWRpYS1kb2N1bWVudCggPHN0cmluZz4gKXxyZWdleHAoIDxzdHJpbmc+ICldIyIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJmb250LWZhY2UiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogbnVsbCwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgImFzY2VudC1vdmVycmlkZSI6ICJub3JtYWx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAgICAgICAgICJkZXNjZW50LW92ZXJyaWRlIjogIm5vcm1hbHw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgImZvbnQtZGlzcGxheSI6ICJbYXV0b3xibG9ja3xzd2FwfGZhbGxiYWNrfG9wdGlvbmFsXSIsCiAgICAgICAgICAgICAgICAiZm9udC1mYW1pbHkiOiAiPGZhbWlseS1uYW1lPiIsCiAgICAgICAgICAgICAgICAiZm9udC1mZWF0dXJlLXNldHRpbmdzIjogIm5vcm1hbHw8ZmVhdHVyZS10YWctdmFsdWU+IyIsCiAgICAgICAgICAgICAgICAiZm9udC12YXJpYXRpb24tc2V0dGluZ3MiOiAibm9ybWFsfFs8c3RyaW5nPiA8bnVtYmVyPl0jIiwKICAgICAgICAgICAgICAgICJmb250LXN0cmV0Y2giOiAiPGZvbnQtc3RyZXRjaC1hYnNvbHV0ZT57MSwyfSIsCiAgICAgICAgICAgICAgICAiZm9udC1zdHlsZSI6ICJub3JtYWx8aXRhbGljfG9ibGlxdWUgPGFuZ2xlPnswLDJ9IiwKICAgICAgICAgICAgICAgICJmb250LXdlaWdodCI6ICI8Zm9udC13ZWlnaHQtYWJzb2x1dGU+ezEsMn0iLAogICAgICAgICAgICAgICAgImZvbnQtdmFyaWFudCI6ICJub3JtYWx8bm9uZXxbPGNvbW1vbi1saWctdmFsdWVzPnx8PGRpc2NyZXRpb25hcnktbGlnLXZhbHVlcz58fDxoaXN0b3JpY2FsLWxpZy12YWx1ZXM+fHw8Y29udGV4dHVhbC1hbHQtdmFsdWVzPnx8c3R5bGlzdGljKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxoaXN0b3JpY2FsLWZvcm1zfHxzdHlsZXNldCggPGZlYXR1cmUtdmFsdWUtbmFtZT4jICl8fGNoYXJhY3Rlci12YXJpYW50KCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiMgKXx8c3dhc2goIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fG9ybmFtZW50cyggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8YW5ub3RhdGlvbiggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8W3NtYWxsLWNhcHN8YWxsLXNtYWxsLWNhcHN8cGV0aXRlLWNhcHN8YWxsLXBldGl0ZS1jYXBzfHVuaWNhc2V8dGl0bGluZy1jYXBzXXx8PG51bWVyaWMtZmlndXJlLXZhbHVlcz58fDxudW1lcmljLXNwYWNpbmctdmFsdWVzPnx8PG51bWVyaWMtZnJhY3Rpb24tdmFsdWVzPnx8b3JkaW5hbHx8c2xhc2hlZC16ZXJvfHw8ZWFzdC1hc2lhbi12YXJpYW50LXZhbHVlcz58fDxlYXN0LWFzaWFuLXdpZHRoLXZhbHVlcz58fHJ1YnldIiwKICAgICAgICAgICAgICAgICJsaW5lLWdhcC1vdmVycmlkZSI6ICJub3JtYWx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAgICAgICAgICJzaXplLWFkanVzdCI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgInNyYyI6ICJbPHVybD4gW2Zvcm1hdCggPHN0cmluZz4jICldP3xsb2NhbCggPGZhbWlseS1uYW1lPiApXSMiLAogICAgICAgICAgICAgICAgInVuaWNvZGUtcmFuZ2UiOiAiPHVyYW5nZT4jIgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiZm9udC1mZWF0dXJlLXZhbHVlcyI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPGZhbWlseS1uYW1lPiMiLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAiaW1wb3J0IjogewogICAgICAgICAgICAicHJlbHVkZSI6ICJbPHN0cmluZz58PHVybD5dIFtsYXllcnxsYXllciggPGxheWVyLW5hbWU+ICldPyBbc3VwcG9ydHMoIFs8c3VwcG9ydHMtY29uZGl0aW9uPnw8ZGVjbGFyYXRpb24+XSApXT8gPG1lZGlhLXF1ZXJ5LWxpc3Q+PyIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJrZXlmcmFtZXMiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxrZXlmcmFtZXMtbmFtZT4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAibGF5ZXIiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIls8bGF5ZXItbmFtZT4jfDxsYXllci1uYW1lPj9dIiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgIm1lZGlhIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8bWVkaWEtcXVlcnktbGlzdD4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAibmFtZXNwYWNlIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8bmFtZXNwYWNlLXByZWZpeD4/IFs8c3RyaW5nPnw8dXJsPl0iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAicGFnZSI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPHBhZ2Utc2VsZWN0b3ItbGlzdD4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiB7CiAgICAgICAgICAgICAgICAiYmxlZWQiOiAiYXV0b3w8bGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWFya3MiOiAibm9uZXxbY3JvcHx8Y3Jvc3NdIiwKICAgICAgICAgICAgICAgICJzaXplIjogIjxsZW5ndGg+ezEsMn18YXV0b3xbPHBhZ2Utc2l6ZT58fFtwb3J0cmFpdHxsYW5kc2NhcGVdXSIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInByb3BlcnR5IjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8Y3VzdG9tLXByb3BlcnR5LW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgInN5bnRheCI6ICI8c3RyaW5nPiIsCiAgICAgICAgICAgICAgICAiaW5oZXJpdHMiOiAidHJ1ZXxmYWxzZSIsCiAgICAgICAgICAgICAgICAiaW5pdGlhbC12YWx1ZSI6ICI8c3RyaW5nPiIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInNjcm9sbC10aW1lbGluZSI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPHRpbWVsaW5lLW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgInN1cHBvcnRzIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8c3VwcG9ydHMtY29uZGl0aW9uPiIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJ2aWV3cG9ydCI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiBudWxsLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiB7CiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIjx2aWV3cG9ydC1sZW5ndGg+ezEsMn0iLAogICAgICAgICAgICAgICAgIm1heC1oZWlnaHQiOiAiPHZpZXdwb3J0LWxlbmd0aD4iLAogICAgICAgICAgICAgICAgIm1heC13aWR0aCI6ICI8dmlld3BvcnQtbGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWF4LXpvb20iOiAiYXV0b3w8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgIm1pbi1oZWlnaHQiOiAiPHZpZXdwb3J0LWxlbmd0aD4iLAogICAgICAgICAgICAgICAgIm1pbi13aWR0aCI6ICI8dmlld3BvcnQtbGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWluLXpvb20iOiAiYXV0b3w8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogImF1dG98cG9ydHJhaXR8bGFuZHNjYXBlIiwKICAgICAgICAgICAgICAgICJ1c2VyLXpvb20iOiAiem9vbXxmaXhlZCIsCiAgICAgICAgICAgICAgICAidmlld3BvcnQtZml0IjogImF1dG98Y29udGFpbnxjb3ZlciIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiPHZpZXdwb3J0LWxlbmd0aD57MSwyfSIsCiAgICAgICAgICAgICAgICAiem9vbSI6ICJhdXRvfDxudW1iZXI+fDxwZXJjZW50YWdlPiIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgIm5lc3QiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxjb21wbGV4LXNlbGVjdG9yLWxpc3Q+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IFBMVVNTSUdOJDUgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTJDIgPSAweDAwMkQ7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCmNvbnN0IE4gPSAweDAwNkU7ICAgICAgICAgICAvLyBVKzAwNkUgTEFUSU4gU01BTEwgTEVUVEVSIE4gKG4pCmNvbnN0IERJU0FMTE9XX1NJR04gPSB0cnVlOwpjb25zdCBBTExPV19TSUdOID0gZmFsc2U7CgpmdW5jdGlvbiBjaGVja0ludGVnZXIob2Zmc2V0LCBkaXNhbGxvd1NpZ24pIHsKICAgIGxldCBwb3MgPSB0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQ7CiAgICBjb25zdCBjb2RlID0gdGhpcy5jaGFyQ29kZUF0KHBvcyk7CgogICAgaWYgKGNvZGUgPT09IFBMVVNTSUdOJDUgfHwgY29kZSA9PT0gSFlQSEVOTUlOVVMkMikgewogICAgICAgIGlmIChkaXNhbGxvd1NpZ24pIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignTnVtYmVyIHNpZ24gaXMgbm90IGFsbG93ZWQnKTsKICAgICAgICB9CiAgICAgICAgcG9zKys7CiAgICB9CgogICAgZm9yICg7IHBvcyA8IHRoaXMudG9rZW5FbmQ7IHBvcysrKSB7CiAgICAgICAgaWYgKCFpc0RpZ2l0KHRoaXMuY2hhckNvZGVBdChwb3MpKSkgewogICAgICAgICAgICB0aGlzLmVycm9yKCdJbnRlZ2VyIGlzIGV4cGVjdGVkJywgcG9zKTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIGNoZWNrVG9rZW5Jc0ludGVnZXIoZGlzYWxsb3dTaWduKSB7CiAgICByZXR1cm4gY2hlY2tJbnRlZ2VyLmNhbGwodGhpcywgMCwgZGlzYWxsb3dTaWduKTsKfQoKZnVuY3Rpb24gZXhwZWN0Q2hhckNvZGUob2Zmc2V0LCBjb2RlKSB7CiAgICBpZiAoIXRoaXMuY21wQ2hhcih0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQsIGNvZGUpKSB7CiAgICAgICAgbGV0IG1zZyA9ICcnOwoKICAgICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgY2FzZSBOOgogICAgICAgICAgICAgICAgbXNnID0gJ04gaXMgZXhwZWN0ZWQnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSFlQSEVOTUlOVVMkMjoKICAgICAgICAgICAgICAgIG1zZyA9ICdIeXBoZW5NaW51cyBpcyBleHBlY3RlZCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHRoaXMuZXJyb3IobXNnLCB0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQpOwogICAgfQp9CgovLyAuLi4gPHNpZ25lZC1pbnRlZ2VyPgovLyAuLi4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CmZ1bmN0aW9uIGNvbnN1bWVCKCkgewogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgc2lnbiA9IDA7CiAgICBsZXQgdHlwZSA9IHRoaXMudG9rZW5UeXBlOwoKICAgIHdoaWxlICh0eXBlID09PSBXaGl0ZVNwYWNlJDEgfHwgdHlwZSA9PT0gQ29tbWVudCQxKSB7CiAgICAgICAgdHlwZSA9IHRoaXMubG9va3VwVHlwZSgrK29mZnNldCk7CiAgICB9CgogICAgaWYgKHR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShQTFVTU0lHTiQ1LCBvZmZzZXQpIHx8CiAgICAgICAgICAgIHRoaXMuaXNEZWxpbShIWVBIRU5NSU5VUyQyLCBvZmZzZXQpKSB7CiAgICAgICAgICAgIHNpZ24gPSB0aGlzLmlzRGVsaW0oUExVU1NJR04kNSwgb2Zmc2V0KSA/IFBMVVNTSUdOJDUgOiBIWVBIRU5NSU5VUyQyOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdHlwZSA9IHRoaXMubG9va3VwVHlwZSgrK29mZnNldCk7CiAgICAgICAgICAgIH0gd2hpbGUgKHR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0eXBlID09PSBDb21tZW50JDEpOwoKICAgICAgICAgICAgaWYgKHR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNraXAob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBESVNBTExPV19TSUdOKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAob2Zmc2V0ID4gMCkgewogICAgICAgIHRoaXMuc2tpcChvZmZzZXQpOwogICAgfQoKICAgIGlmIChzaWduID09PSAwKSB7CiAgICAgICAgdHlwZSA9IHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQpOwogICAgICAgIGlmICh0eXBlICE9PSBQTFVTU0lHTiQ1ICYmIHR5cGUgIT09IEhZUEhFTk1JTlVTJDIpIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignTnVtYmVyIHNpZ24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICB9CiAgICB9CgogICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIHNpZ24gIT09IDApOwogICAgcmV0dXJuIHNpZ24gPT09IEhZUEhFTk1JTlVTJDIgPyAnLScgKyB0aGlzLmNvbnN1bWUoTnVtYmVyJDIpIDogdGhpcy5jb25zdW1lKE51bWJlciQyKTsKfQoKLy8gQW4rQiBtaWNyb3N5bnRheCBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXN5bnRheC0zLyNhbmIKY29uc3QgbmFtZSRGID0gJ0FuUGx1c0InOwpjb25zdCBzdHJ1Y3R1cmUkRSA9IHsKICAgIGE6IFtTdHJpbmcsIG51bGxdLAogICAgYjogW1N0cmluZywgbnVsbF0KfTsKCmZ1bmN0aW9uIHBhcnNlJEYoKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBicmFjZS1zdHlsZSovCiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCBhID0gbnVsbDsKICAgIGxldCBiID0gbnVsbDsKCiAgICAvLyA8aW50ZWdlcj4KICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgQUxMT1dfU0lHTik7CiAgICAgICAgYiA9IHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICB9CgogICAgLy8gLW4KICAgIC8vIC1uIDxzaWduZWQtaW50ZWdlcj4KICAgIC8vIC1uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gLW4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gPGRhc2huZGFzaGRpZ2l0LWlkZW50PgogICAgZWxzZSBpZiAodGhpcy50b2tlblR5cGUgPT09IElkZW50ICYmIHRoaXMuY21wQ2hhcih0aGlzLnRva2VuU3RhcnQsIEhZUEhFTk1JTlVTJDIpKSB7CiAgICAgICAgYSA9ICctMSc7CgogICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMSwgTik7CgogICAgICAgIHN3aXRjaCAodGhpcy50b2tlbkVuZCAtIHRoaXMudG9rZW5TdGFydCkgewogICAgICAgICAgICAvLyAtbgogICAgICAgICAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+CiAgICAgICAgICAgIC8vIC1uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyAtbi0gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMiwgSFlQSEVOTUlOVVMkMik7CgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnNraXBTQygpOwoKICAgICAgICAgICAgICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBESVNBTExPV19TSUdOKTsKCiAgICAgICAgICAgICAgICBiID0gJy0nICsgdGhpcy5jb25zdW1lKE51bWJlciQyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gPGRhc2huZGFzaGRpZ2l0LWlkZW50PgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCAyLCBIWVBIRU5NSU5VUyQyKTsKICAgICAgICAgICAgICAgIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIDMsIERJU0FMTE9XX1NJR04pOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CgogICAgICAgICAgICAgICAgYiA9IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gJysnPyBuCiAgICAvLyAnKyc/IG4gPHNpZ25lZC1pbnRlZ2VyPgogICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gJysnPyBuLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vICcrJz8gPG5kYXNoZGlnaXQtaWRlbnQ+CiAgICBlbHNlIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQgfHwgKHRoaXMuaXNEZWxpbShQTFVTU0lHTiQ1KSAmJiB0aGlzLmxvb2t1cFR5cGUoMSkgPT09IElkZW50KSkgewogICAgICAgIGxldCBzaWduID0gMDsKICAgICAgICBhID0gJzEnOwoKICAgICAgICAvLyBqdXN0IGlnbm9yZSBhIHBsdXMKICAgICAgICBpZiAodGhpcy5pc0RlbGltKFBMVVNTSUdOJDUpKSB7CiAgICAgICAgICAgIHNpZ24gPSAxOwogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9CgogICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMCwgTik7CgogICAgICAgIHN3aXRjaCAodGhpcy50b2tlbkVuZCAtIHRoaXMudG9rZW5TdGFydCkgewogICAgICAgICAgICAvLyAnKyc/IG4KICAgICAgICAgICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyAnKyc/IG4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDIpOwoKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgRElTQUxMT1dfU0lHTik7CgogICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vICcrJz8gPG5kYXNoZGlnaXQtaWRlbnQ+CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDIpOwogICAgICAgICAgICAgICAgY2hlY2tJbnRlZ2VyLmNhbGwodGhpcywgMiwgRElTQUxMT1dfU0lHTik7CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKCiAgICAgICAgICAgICAgICBiID0gdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCArIHNpZ24gKyAxKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPgogICAgLy8gPG5kYXNoLWRpbWVuc2lvbj4gPHNpZ25sZXNzLWludGVnZXI+CiAgICAvLyA8bi1kaW1lbnNpb24+CiAgICAvLyA8bi1kaW1lbnNpb24+IDxzaWduZWQtaW50ZWdlcj4KICAgIC8vIDxuLWRpbWVuc2lvbj4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CiAgICBlbHNlIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gRGltZW5zaW9uJDEpIHsKICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCk7CiAgICAgICAgY29uc3Qgc2lnbiA9IGNvZGUgPT09IFBMVVNTSUdOJDUgfHwgY29kZSA9PT0gSFlQSEVOTUlOVVMkMjsKICAgICAgICBsZXQgaSA9IHRoaXMudG9rZW5TdGFydCArIHNpZ247CgogICAgICAgIGZvciAoOyBpIDwgdGhpcy50b2tlbkVuZDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghaXNEaWdpdCh0aGlzLmNoYXJDb2RlQXQoaSkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGkgPT09IHRoaXMudG9rZW5TdGFydCArIHNpZ24pIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignSW50ZWdlciBpcyBleHBlY3RlZCcsIHRoaXMudG9rZW5TdGFydCArIHNpZ24pOwogICAgICAgIH0KCiAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCBpIC0gdGhpcy50b2tlblN0YXJ0LCBOKTsKICAgICAgICBhID0gdGhpcy5zdWJzdHJpbmcoc3RhcnQsIGkpOwoKICAgICAgICAvLyA8bi1kaW1lbnNpb24+CiAgICAgICAgLy8gPG4tZGltZW5zaW9uPiA8c2lnbmVkLWludGVnZXI+CiAgICAgICAgLy8gPG4tZGltZW5zaW9uPiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICBpZiAoaSArIDEgPT09IHRoaXMudG9rZW5FbmQpIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgaSAtIHRoaXMudG9rZW5TdGFydCArIDEsIEhZUEhFTk1JTlVTJDIpOwoKICAgICAgICAgICAgLy8gPG5kYXNoLWRpbWVuc2lvbj4gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGlmIChpICsgMiA9PT0gdGhpcy50b2tlbkVuZCkgewogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgICAgICAgICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIERJU0FMTE9XX1NJR04pOwogICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPgogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIGkgLSB0aGlzLnRva2VuU3RhcnQgKyAyLCBESVNBTExPV19TSUdOKTsKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgYiA9IHRoaXMuc3Vic3RyVG9DdXJzb3IoaSArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVycm9yKCk7CiAgICB9CgogICAgaWYgKGEgIT09IG51bGwgJiYgYS5jaGFyQ29kZUF0KDApID09PSBQTFVTU0lHTiQ1KSB7CiAgICAgICAgYSA9IGEuc3Vic3RyKDEpOwogICAgfQoKICAgIGlmIChiICE9PSBudWxsICYmIGIuY2hhckNvZGVBdCgwKSA9PT0gUExVU1NJR04kNSkgewogICAgICAgIGIgPSBiLnN1YnN0cigxKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdBblBsdXNCJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgYSwKICAgICAgICBiCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRGKG5vZGUpIHsKICAgIGlmIChub2RlLmEpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgbm9kZS5hID09PSAnKzEnICYmICduJyB8fAogICAgICAgICAgICBub2RlLmEgPT09ICAnMScgJiYgJ24nIHx8CiAgICAgICAgICAgIG5vZGUuYSA9PT0gJy0xJyAmJiAnLW4nIHx8CiAgICAgICAgICAgIG5vZGUuYSArICduJzsKCiAgICAgICAgaWYgKG5vZGUuYikgewogICAgICAgICAgICBjb25zdCBiID0gbm9kZS5iWzBdID09PSAnLScgfHwgbm9kZS5iWzBdID09PSAnKycKICAgICAgICAgICAgICAgID8gbm9kZS5iCiAgICAgICAgICAgICAgICA6ICcrJyArIG5vZGUuYjsKICAgICAgICAgICAgdGhpcy50b2tlbml6ZShhICsgYik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy50b2tlbml6ZShhKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMudG9rZW5pemUobm9kZS5iKTsKICAgIH0KfQoKY29uc3QgQW5QbHVzQiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEYsCiAgICBuYW1lOiBuYW1lJEYsCiAgICBwYXJzZTogcGFyc2UkRiwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgpmdW5jdGlvbiBjb25zdW1lUmF3JDUoc3RhcnRUb2tlbikgewogICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHRoaXMuY29uc3VtZVVudGlsTGVmdEN1cmx5QnJhY2tldE9yU2VtaWNvbG9uLCB0cnVlKTsKfQoKZnVuY3Rpb24gaXNEZWNsYXJhdGlvbkJsb2NrQXRydWxlKCkgewogICAgZm9yIChsZXQgb2Zmc2V0ID0gMSwgdHlwZTsgdHlwZSA9IHRoaXMubG9va3VwVHlwZShvZmZzZXQpOyBvZmZzZXQrKykgewogICAgICAgIGlmICh0eXBlID09PSBSaWdodEN1cmx5QnJhY2tldCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09PSBMZWZ0Q3VybHlCcmFja2V0IHx8CiAgICAgICAgICAgIHR5cGUgPT09IEF0S2V5d29yZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKfQoKCmNvbnN0IG5hbWUkRSA9ICdBdHJ1bGUnOwpjb25zdCB3YWxrQ29udGV4dCQ5ID0gJ2F0cnVsZSc7CmNvbnN0IHN0cnVjdHVyZSREID0gewogICAgbmFtZTogU3RyaW5nLAogICAgcHJlbHVkZTogWydBdHJ1bGVQcmVsdWRlJywgJ1JhdycsIG51bGxdLAogICAgYmxvY2s6IFsnQmxvY2snLCBudWxsXQp9OwoKZnVuY3Rpb24gcGFyc2UkRShpc0RlY2xhcmF0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IG5hbWU7CiAgICBsZXQgbmFtZUxvd2VyQ2FzZTsKICAgIGxldCBwcmVsdWRlID0gbnVsbDsKICAgIGxldCBibG9jayA9IG51bGw7CgogICAgdGhpcy5lYXQoQXRLZXl3b3JkKTsKCiAgICBuYW1lID0gdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCArIDEpOwogICAgbmFtZUxvd2VyQ2FzZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgLy8gcGFyc2UgcHJlbHVkZQogICAgaWYgKHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBMZWZ0Q3VybHlCcmFja2V0ICYmCiAgICAgICAgdGhpcy50b2tlblR5cGUgIT09IFNlbWljb2xvbikgewogICAgICAgIGlmICh0aGlzLnBhcnNlQXRydWxlUHJlbHVkZSkgewogICAgICAgICAgICBwcmVsdWRlID0gdGhpcy5wYXJzZVdpdGhGYWxsYmFjayh0aGlzLkF0cnVsZVByZWx1ZGUuYmluZCh0aGlzLCBuYW1lLCBpc0RlY2xhcmF0aW9uKSwgY29uc3VtZVJhdyQ1KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmVsdWRlID0gY29uc3VtZVJhdyQ1LmNhbGwodGhpcywgdGhpcy50b2tlbkluZGV4KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICB9CgogICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTGVmdEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodGhpcy5hdHJ1bGUsIG5hbWVMb3dlckNhc2UpICYmCiAgICAgICAgICAgICAgICB0eXBlb2YgdGhpcy5hdHJ1bGVbbmFtZUxvd2VyQ2FzZV0uYmxvY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5hdHJ1bGVbbmFtZUxvd2VyQ2FzZV0uYmxvY2suY2FsbCh0aGlzLCBpc0RlY2xhcmF0aW9uKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IHNob3VsZCBjb25zdW1lIGJsb2NrIGNvbnRlbnQgYXMgUmF3PwogICAgICAgICAgICAgICAgYmxvY2sgPSB0aGlzLkJsb2NrKGlzRGVjbGFyYXRpb25CbG9ja0F0cnVsZS5jYWxsKHRoaXMpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnQXRydWxlJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZSwKICAgICAgICBwcmVsdWRlLAogICAgICAgIGJsb2NrCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRFKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oQXRLZXl3b3JkLCAnQCcgKyBub2RlLm5hbWUpOwoKICAgIGlmIChub2RlLnByZWx1ZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLm5vZGUobm9kZS5wcmVsdWRlKTsKICAgIH0KCiAgICBpZiAobm9kZS5ibG9jaykgewogICAgICAgIHRoaXMubm9kZShub2RlLmJsb2NrKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b2tlbihTZW1pY29sb24sICc7Jyk7CiAgICB9Cn0KCmNvbnN0IEF0cnVsZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEUsCiAgICBuYW1lOiBuYW1lJEUsCiAgICBwYXJzZTogcGFyc2UkRSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkOQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkRCA9ICdBdHJ1bGVQcmVsdWRlJzsKY29uc3Qgd2Fsa0NvbnRleHQkOCA9ICdhdHJ1bGVQcmVsdWRlJzsKY29uc3Qgc3RydWN0dXJlJEMgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkRChuYW1lKSB7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwoKICAgIGlmIChuYW1lICE9PSBudWxsKSB7CiAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuYXRydWxlLCBuYW1lKSAmJgogICAgICAgIHR5cGVvZiB0aGlzLmF0cnVsZVtuYW1lXS5wcmVsdWRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgLy8gY3VzdG9tIGNvbnN1bWVyCiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmF0cnVsZVtuYW1lXS5wcmVsdWRlLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIGRlZmF1bHQgY29uc3VtZXIKICAgICAgICBjaGlsZHJlbiA9IHRoaXMucmVhZFNlcXVlbmNlKHRoaXMuc2NvcGUuQXRydWxlUHJlbHVkZSk7CiAgICB9CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBpZiAodGhpcy5lb2YgIT09IHRydWUgJiYKICAgICAgICB0aGlzLnRva2VuVHlwZSAhPT0gTGVmdEN1cmx5QnJhY2tldCAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBTZW1pY29sb24pIHsKICAgICAgICB0aGlzLmVycm9yKCdTZW1pY29sb24gb3IgYmxvY2sgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdBdHJ1bGVQcmVsdWRlJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEQobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKfQoKY29uc3QgQXRydWxlUHJlbHVkZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEQsCiAgICBuYW1lOiBuYW1lJEQsCiAgICBwYXJzZTogcGFyc2UkRCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEMsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkOAp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IERPTExBUlNJR04kMSA9IDB4MDAyNDsgICAgICAgLy8gVSswMDI0IERPTExBUiBTSUdOICgkKQpjb25zdCBBU1RFUklTSyQ1ID0gMHgwMDJBOyAgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgRVFVQUxTU0lHTiA9IDB4MDAzRDsgICAgICAgLy8gVSswMDNEIEVRVUFMUyBTSUdOICg9KQpjb25zdCBDSVJDVU1GTEVYQUNDRU5UID0gMHgwMDVFOyAvLyBVKzAwNUUgKF4pCmNvbnN0IFZFUlRJQ0FMTElORSQyID0gMHgwMDdDOyAgICAgLy8gVSswMDdDIFZFUlRJQ0FMIExJTkUgKHwpCmNvbnN0IFRJTERFJDIgPSAweDAwN0U7ICAgICAgICAgICAgLy8gVSswMDdFIFRJTERFICh+KQoKZnVuY3Rpb24gZ2V0QXR0cmlidXRlTmFtZSgpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICAgIHRoaXMuZXJyb3IoJ1VuZXhwZWN0ZWQgZW5kIG9mIGlucHV0Jyk7CiAgICB9CgogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgZXhwZWN0SWRlbnQgPSBmYWxzZTsKCiAgICBpZiAodGhpcy5pc0RlbGltKEFTVEVSSVNLJDUpKSB7CiAgICAgICAgZXhwZWN0SWRlbnQgPSB0cnVlOwogICAgICAgIHRoaXMubmV4dCgpOwogICAgfSBlbHNlIGlmICghdGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQyKSkgewogICAgICAgIHRoaXMuZWF0KElkZW50KTsKICAgIH0KCiAgICBpZiAodGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQyKSkgewogICAgICAgIGlmICh0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0ICsgMSkgIT09IEVRVUFMU1NJR04pIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIHRoaXMuZWF0KElkZW50KTsKICAgICAgICB9IGVsc2UgaWYgKGV4cGVjdElkZW50KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQnLCB0aGlzLnRva2VuRW5kKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cGVjdElkZW50KSB7CiAgICAgICAgdGhpcy5lcnJvcignVmVydGljYWwgbGluZSBpcyBleHBlY3RlZCcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBuYW1lOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0T3BlcmF0b3IoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQoc3RhcnQpOwoKICAgIGlmIChjb2RlICE9PSBFUVVBTFNTSUdOICYmICAgICAgICAvLyA9CiAgICAgICAgY29kZSAhPT0gVElMREUkMiAmJiAgICAgICAgICAgICAvLyB+PQogICAgICAgIGNvZGUgIT09IENJUkNVTUZMRVhBQ0NFTlQgJiYgIC8vIF49CiAgICAgICAgY29kZSAhPT0gRE9MTEFSU0lHTiQxICYmICAgICAgICAvLyAkPQogICAgICAgIGNvZGUgIT09IEFTVEVSSVNLJDUgJiYgICAgICAgICAgLy8gKj0KICAgICAgICBjb2RlICE9PSBWRVJUSUNBTExJTkUkMiAgICAgICAgIC8vIHw9CiAgICApIHsKICAgICAgICB0aGlzLmVycm9yKCdBdHRyaWJ1dGUgc2VsZWN0b3IgKD0sIH49LCBePSwgJD0sICo9LCB8PSkgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICB0aGlzLm5leHQoKTsKCiAgICBpZiAoY29kZSAhPT0gRVFVQUxTU0lHTikgewogICAgICAgIGlmICghdGhpcy5pc0RlbGltKEVRVUFMU1NJR04pKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0VxdWFsIHNpZ24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKfQoKLy8gJ1snIDx3cS1uYW1lPiAnXScKLy8gJ1snIDx3cS1uYW1lPiA8YXR0ci1tYXRjaGVyPiBbIDxzdHJpbmctdG9rZW4+IHwgPGlkZW50LXRva2VuPiBdIDxhdHRyLW1vZGlmaWVyPj8gJ10nCmNvbnN0IG5hbWUkQyA9ICdBdHRyaWJ1dGVTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSRCID0gewogICAgbmFtZTogJ0lkZW50aWZpZXInLAogICAgbWF0Y2hlcjogW1N0cmluZywgbnVsbF0sCiAgICB2YWx1ZTogWydTdHJpbmcnLCAnSWRlbnRpZmllcicsIG51bGxdLAogICAgZmxhZ3M6IFtTdHJpbmcsIG51bGxdCn07CgpmdW5jdGlvbiBwYXJzZSRDKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgbmFtZTsKICAgIGxldCBtYXRjaGVyID0gbnVsbDsKICAgIGxldCB2YWx1ZSA9IG51bGw7CiAgICBsZXQgZmxhZ3MgPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRTcXVhcmVCcmFja2V0KTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgbmFtZSA9IGdldEF0dHJpYnV0ZU5hbWUuY2FsbCh0aGlzKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgaWYgKHRoaXMudG9rZW5UeXBlICE9PSBSaWdodFNxdWFyZUJyYWNrZXQpIHsKICAgICAgICAvLyBhdm9pZCBjYXNlIGBbbmFtZSBpXWAKICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50KSB7CiAgICAgICAgICAgIG1hdGNoZXIgPSBnZXRPcGVyYXRvci5jYWxsKHRoaXMpOwoKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgIHZhbHVlID0gdGhpcy50b2tlblR5cGUgPT09IFN0cmluZyQyCiAgICAgICAgICAgICAgICA/IHRoaXMuU3RyaW5nKCkKICAgICAgICAgICAgICAgIDogdGhpcy5JZGVudGlmaWVyKCk7CgogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0KCiAgICAgICAgLy8gYXR0cmlidXRlIGZsYWdzCiAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBJZGVudCkgewogICAgICAgICAgICBmbGFncyA9IHRoaXMuY29uc3VtZShJZGVudCk7CgogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0KICAgIH0KCiAgICB0aGlzLmVhdChSaWdodFNxdWFyZUJyYWNrZXQpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0F0dHJpYnV0ZVNlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZSwKICAgICAgICBtYXRjaGVyLAogICAgICAgIHZhbHVlLAogICAgICAgIGZsYWdzCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRDKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oRGVsaW0sICdbJyk7CiAgICB0aGlzLm5vZGUobm9kZS5uYW1lKTsKCiAgICBpZiAobm9kZS5tYXRjaGVyICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy50b2tlbml6ZShub2RlLm1hdGNoZXIpOwogICAgICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTsKICAgIH0KCiAgICBpZiAobm9kZS5mbGFncyAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUuZmxhZ3MpOwogICAgfQoKICAgIHRoaXMudG9rZW4oRGVsaW0sICddJyk7Cn0KCmNvbnN0IEF0dHJpYnV0ZVNlbGVjdG9yID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkQywKICAgIG5hbWU6IG5hbWUkQywKICAgIHBhcnNlOiBwYXJzZSRDLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkQgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IEFNUEVSU0FORCQ0ID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQoKZnVuY3Rpb24gY29uc3VtZVJhdyQ0KHN0YXJ0VG9rZW4pIHsKICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCBudWxsLCB0cnVlKTsKfQpmdW5jdGlvbiBjb25zdW1lUnVsZSgpIHsKICAgIHJldHVybiB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQ0KTsKfQpmdW5jdGlvbiBjb25zdW1lUmF3RGVjbGFyYXRpb24oc3RhcnRUb2tlbikgewogICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHRoaXMuY29uc3VtZVVudGlsU2VtaWNvbG9uSW5jbHVkZWQsIHRydWUpOwp9CmZ1bmN0aW9uIGNvbnN1bWVEZWNsYXJhdGlvbigpIHsKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gU2VtaWNvbG9uKSB7CiAgICAgICAgcmV0dXJuIGNvbnN1bWVSYXdEZWNsYXJhdGlvbi5jYWxsKHRoaXMsIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgY29uc3Qgbm9kZSA9IHRoaXMucGFyc2VXaXRoRmFsbGJhY2sodGhpcy5EZWNsYXJhdGlvbiwgY29uc3VtZVJhd0RlY2xhcmF0aW9uKTsKCiAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IFNlbWljb2xvbikgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiBub2RlOwp9Cgpjb25zdCBuYW1lJEIgPSAnQmxvY2snOwpjb25zdCB3YWxrQ29udGV4dCQ3ID0gJ2Jsb2NrJzsKY29uc3Qgc3RydWN0dXJlJEEgPSB7CiAgICBjaGlsZHJlbjogW1sKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScsCiAgICAgICAgJ0RlY2xhcmF0aW9uJwogICAgXV0KfTsKCmZ1bmN0aW9uIHBhcnNlJEIoaXNTdHlsZUJsb2NrKSB7CiAgICBjb25zdCBjb25zdW1lciA9IGlzU3R5bGVCbG9jayA/IGNvbnN1bWVEZWNsYXJhdGlvbiA6IGNvbnN1bWVSdWxlOwogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLmVhdChMZWZ0Q3VybHlCcmFja2V0KTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBSaWdodEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CgogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBBdEtleXdvcmQ6CiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMucGFyc2VXaXRoRmFsbGJhY2sodGhpcy5BdHJ1bGUuYmluZCh0aGlzLCBpc1N0eWxlQmxvY2spLCBjb25zdW1lUmF3JDQpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChpc1N0eWxlQmxvY2sgJiYgdGhpcy5pc0RlbGltKEFNUEVSU0FORCQ0KSkgIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNvbnN1bWVSdWxlLmNhbGwodGhpcykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNvbnN1bWVyLmNhbGwodGhpcykpOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5lYXQoUmlnaHRDdXJseUJyYWNrZXQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0Jsb2NrJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEIobm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0Q3VybHlCcmFja2V0LCAneycpOwogICAgdGhpcy5jaGlsZHJlbihub2RlLCBwcmV2ID0+IHsKICAgICAgICBpZiAocHJldi50eXBlID09PSAnRGVjbGFyYXRpb24nKSB7CiAgICAgICAgICAgIHRoaXMudG9rZW4oU2VtaWNvbG9uLCAnOycpOwogICAgICAgIH0KICAgIH0pOwogICAgdGhpcy50b2tlbihSaWdodEN1cmx5QnJhY2tldCwgJ30nKTsKfQoKY29uc3QgQmxvY2sgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRCLAogICAgbmFtZTogbmFtZSRCLAogICAgcGFyc2U6IHBhcnNlJEIsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRBLAogICAgd2Fsa0NvbnRleHQ6IHdhbGtDb250ZXh0JDcKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJEEgPSAnQnJhY2tldHMnOwpjb25zdCBzdHJ1Y3R1cmUkeiA9IHsKICAgIGNoaWxkcmVuOiBbW11dCn07CgpmdW5jdGlvbiBwYXJzZSRBKHJlYWRTZXF1ZW5jZSwgcmVjb2duaXplcikgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRTcXVhcmVCcmFja2V0KTsKCiAgICBjaGlsZHJlbiA9IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpOwoKICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLmVhdChSaWdodFNxdWFyZUJyYWNrZXQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0JyYWNrZXRzJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEEobm9kZSkgewogICAgdGhpcy50b2tlbihEZWxpbSwgJ1snKTsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7CiAgICB0aGlzLnRva2VuKERlbGltLCAnXScpOwp9Cgpjb25zdCBCcmFja2V0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEEsCiAgICBuYW1lOiBuYW1lJEEsCiAgICBwYXJzZTogcGFyc2UkQSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHoKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJHogPSAnQ0RDJzsKY29uc3Qgc3RydWN0dXJlJHkgPSBbXTsKCmZ1bmN0aW9uIHBhcnNlJHooKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKCiAgICB0aGlzLmVhdChDREMkMSk7IC8vIC0tPgoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0NEQycsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSR6KCkgewogICAgdGhpcy50b2tlbihDREMkMSwgJy0tPicpOwp9Cgpjb25zdCBDREMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR6LAogICAgbmFtZTogbmFtZSR6LAogICAgcGFyc2U6IHBhcnNlJHosCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR5Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSR5ID0gJ0NETyc7CmNvbnN0IHN0cnVjdHVyZSR4ID0gW107CgpmdW5jdGlvbiBwYXJzZSR5KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5lYXQoQ0RPJDEpOyAvLyA8IS0tCgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnQ0RPJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHkoKSB7CiAgICB0aGlzLnRva2VuKENETyQxLCAnPCEtLScpOwp9Cgpjb25zdCBDRE8gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR5LAogICAgbmFtZTogbmFtZSR5LAogICAgcGFyc2U6IHBhcnNlJHksCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgRlVMTFNUT1AkMiA9IDB4MDAyRTsgLy8gVSswMDJFIEZVTEwgU1RPUCAoLikKCi8vICcuJyBpZGVudApjb25zdCBuYW1lJHggPSAnQ2xhc3NTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSR3ID0gewogICAgbmFtZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSR4KCkgewogICAgdGhpcy5lYXREZWxpbShGVUxMU1RPUCQyKTsKCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDbGFzc1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24odGhpcy50b2tlblN0YXJ0IC0gMSwgdGhpcy50b2tlbkVuZCksCiAgICAgICAgbmFtZTogdGhpcy5jb25zdW1lKElkZW50KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkeChub2RlKSB7CiAgICB0aGlzLnRva2VuKERlbGltLCAnLicpOwogICAgdGhpcy50b2tlbihJZGVudCwgbm9kZS5uYW1lKTsKfQoKY29uc3QgQ2xhc3NTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHgsCiAgICBuYW1lOiBuYW1lJHgsCiAgICBwYXJzZTogcGFyc2UkeCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHcKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBQTFVTU0lHTiQ0ID0gMHgwMDJCOyAgICAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgU09MSURVUyQ1ID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBHUkVBVEVSVEhBTlNJR04kMSA9IDB4MDAzRTsgLy8gVSswMDNFIEdSRUFURVItVEhBTiBTSUdOICg+KQpjb25zdCBUSUxERSQxID0gMHgwMDdFOyAgICAgICAgICAgLy8gVSswMDdFIFRJTERFICh+KQoKY29uc3QgbmFtZSR3ID0gJ0NvbWJpbmF0b3InOwpjb25zdCBzdHJ1Y3R1cmUkdiA9IHsKICAgIG5hbWU6IFN0cmluZwp9OwoKLy8gKyB8ID4gfCB+IHwgL2RlZXAvCmZ1bmN0aW9uIHBhcnNlJHcoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCBuYW1lOwoKICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgbmFtZSA9ICcgJzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRGVsaW06CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgR1JFQVRFUlRIQU5TSUdOJDE6CiAgICAgICAgICAgICAgICBjYXNlIFBMVVNTSUdOJDQ6CiAgICAgICAgICAgICAgICBjYXNlIFRJTERFJDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBTT0xJRFVTJDU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYXRJZGVudCgnZGVlcCcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWF0RGVsaW0oU09MSURVUyQ1KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0NvbWJpbmF0b3IgaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmFtZSA9IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQpOwogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDb21iaW5hdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkdyhub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUubmFtZSk7Cn0KCmNvbnN0IENvbWJpbmF0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR3LAogICAgbmFtZTogbmFtZSR3LAogICAgcGFyc2U6IHBhcnNlJHcsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQVNURVJJU0skNCA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgU09MSURVUyQ0ID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQoKCmNvbnN0IG5hbWUkdiA9ICdDb21tZW50JzsKY29uc3Qgc3RydWN0dXJlJHUgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSR2KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgZW5kID0gdGhpcy50b2tlbkVuZDsKCiAgICB0aGlzLmVhdChDb21tZW50JDEpOwoKICAgIGlmICgoZW5kIC0gc3RhcnQgKyAyKSA+PSAyICYmCiAgICAgICAgdGhpcy5jaGFyQ29kZUF0KGVuZCAtIDIpID09PSBBU1RFUklTSyQ0ICYmCiAgICAgICAgdGhpcy5jaGFyQ29kZUF0KGVuZCAtIDEpID09PSBTT0xJRFVTJDQpIHsKICAgICAgICBlbmQgLT0gMjsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDb21tZW50JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgdmFsdWU6IHRoaXMuc3Vic3RyaW5nKHN0YXJ0ICsgMiwgZW5kKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkdihub2RlKSB7CiAgICB0aGlzLnRva2VuKENvbW1lbnQkMSwgJy8qJyArIG5vZGUudmFsdWUgKyAnKi8nKTsKfQoKY29uc3QgQ29tbWVudCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHYsCiAgICBuYW1lOiBuYW1lJHYsCiAgICBwYXJzZTogcGFyc2UkdiwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBFWENMQU1BVElPTk1BUkskMSA9IDB4MDAyMTsgLy8gVSswMDIxIEVYQ0xBTUFUSU9OIE1BUksgKCEpCmNvbnN0IE5VTUJFUlNJR04kMiA9IDB4MDAyMzsgICAgICAvLyBVKzAwMjMgTlVNQkVSIFNJR04gKCMpCmNvbnN0IERPTExBUlNJR04gPSAweDAwMjQ7ICAgICAgLy8gVSswMDI0IERPTExBUiBTSUdOICgkKQpjb25zdCBBTVBFUlNBTkQkMyA9IDB4MDAyNjsgICAgICAgLy8gVSswMDI2IEFNUEVSU0FORCAoJikKY29uc3QgQVNURVJJU0skMyA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgUExVU1NJR04kMyA9IDB4MDAyQjsgICAgICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IFNPTElEVVMkMyA9IDB4MDAyRjsgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKCmZ1bmN0aW9uIGNvbnN1bWVWYWx1ZVJhdyhzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxFeGNsYW1hdGlvbk1hcmtPclNlbWljb2xvbiwgdHJ1ZSk7Cn0KCmZ1bmN0aW9uIGNvbnN1bWVDdXN0b21Qcm9wZXJ0eVJhdyhzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxFeGNsYW1hdGlvbk1hcmtPclNlbWljb2xvbiwgZmFsc2UpOwp9CgpmdW5jdGlvbiBjb25zdW1lVmFsdWUoKSB7CiAgICBjb25zdCBzdGFydFZhbHVlVG9rZW4gPSB0aGlzLnRva2VuSW5kZXg7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuVmFsdWUoKTsKCiAgICBpZiAodmFsdWUudHlwZSAhPT0gJ1JhdycgJiYKICAgICAgICB0aGlzLmVvZiA9PT0gZmFsc2UgJiYKICAgICAgICB0aGlzLnRva2VuVHlwZSAhPT0gU2VtaWNvbG9uICYmCiAgICAgICAgdGhpcy5pc0RlbGltKEVYQ0xBTUFUSU9OTUFSSyQxKSA9PT0gZmFsc2UgJiYKICAgICAgICB0aGlzLmlzQmFsYW5jZUVkZ2Uoc3RhcnRWYWx1ZVRva2VuKSA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmVycm9yKCk7CiAgICB9CgogICAgcmV0dXJuIHZhbHVlOwp9Cgpjb25zdCBuYW1lJHUgPSAnRGVjbGFyYXRpb24nOwpjb25zdCB3YWxrQ29udGV4dCQ2ID0gJ2RlY2xhcmF0aW9uJzsKY29uc3Qgc3RydWN0dXJlJHQgPSB7CiAgICBpbXBvcnRhbnQ6IFtCb29sZWFuLCBTdHJpbmddLAogICAgcHJvcGVydHk6IFN0cmluZywKICAgIHZhbHVlOiBbJ1ZhbHVlJywgJ1JhdyddCn07CgpmdW5jdGlvbiBwYXJzZSR1KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBjb25zdCBzdGFydFRva2VuID0gdGhpcy50b2tlbkluZGV4OwogICAgY29uc3QgcHJvcGVydHkgPSByZWFkUHJvcGVydHkuY2FsbCh0aGlzKTsKICAgIGNvbnN0IGN1c3RvbVByb3BlcnR5ID0gaXNDdXN0b21Qcm9wZXJ0eShwcm9wZXJ0eSk7CiAgICBjb25zdCBwYXJzZVZhbHVlID0gY3VzdG9tUHJvcGVydHkgPyB0aGlzLnBhcnNlQ3VzdG9tUHJvcGVydHkgOiB0aGlzLnBhcnNlVmFsdWU7CiAgICBjb25zdCBjb25zdW1lUmF3ID0gY3VzdG9tUHJvcGVydHkgPyBjb25zdW1lQ3VzdG9tUHJvcGVydHlSYXcgOiBjb25zdW1lVmFsdWVSYXc7CiAgICBsZXQgaW1wb3J0YW50ID0gZmFsc2U7CiAgICBsZXQgdmFsdWU7CgogICAgdGhpcy5za2lwU0MoKTsKICAgIHRoaXMuZWF0KENvbG9uKTsKCiAgICBjb25zdCB2YWx1ZVN0YXJ0ID0gdGhpcy50b2tlbkluZGV4OwoKICAgIGlmICghY3VzdG9tUHJvcGVydHkpIHsKICAgICAgICB0aGlzLnNraXBTQygpOwogICAgfQoKICAgIGlmIChwYXJzZVZhbHVlKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKGNvbnN1bWVWYWx1ZSwgY29uc3VtZVJhdyk7CiAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gY29uc3VtZVJhdy5jYWxsKHRoaXMsIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgaWYgKGN1c3RvbVByb3BlcnR5ICYmIHZhbHVlLnR5cGUgPT09ICdWYWx1ZScgJiYgdmFsdWUuY2hpbGRyZW4uaXNFbXB0eSkgewogICAgICAgIGZvciAobGV0IG9mZnNldCA9IHZhbHVlU3RhcnQgLSB0aGlzLnRva2VuSW5kZXg7IG9mZnNldCA8PSAwOyBvZmZzZXQrKykgewogICAgICAgICAgICBpZiAodGhpcy5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgdmFsdWUuY2hpbGRyZW4uYXBwZW5kRGF0YSh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1doaXRlU3BhY2UnLAogICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJyAnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLmlzRGVsaW0oRVhDTEFNQVRJT05NQVJLJDEpKSB7CiAgICAgICAgaW1wb3J0YW50ID0gZ2V0SW1wb3J0YW50LmNhbGwodGhpcyk7CiAgICAgICAgdGhpcy5za2lwU0MoKTsKICAgIH0KCiAgICAvLyBEbyBub3QgaW5jbHVkZSBzZW1pY29sb24gdG8gcmFuZ2UgcGVyIHNwZWMKICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNkZWNsYXJhdGlvbi1kaWFncmFtCgogICAgaWYgKHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBTZW1pY29sb24gJiYKICAgICAgICB0aGlzLmlzQmFsYW5jZUVkZ2Uoc3RhcnRUb2tlbikgPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5lcnJvcigpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0RlY2xhcmF0aW9uJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgaW1wb3J0YW50LAogICAgICAgIHByb3BlcnR5LAogICAgICAgIHZhbHVlCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSR1KG5vZGUpIHsKICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUucHJvcGVydHkpOwogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTsKCiAgICBpZiAobm9kZS5pbXBvcnRhbnQpIHsKICAgICAgICB0aGlzLnRva2VuKERlbGltLCAnIScpOwogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUuaW1wb3J0YW50ID09PSB0cnVlID8gJ2ltcG9ydGFudCcgOiBub2RlLmltcG9ydGFudCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHJlYWRQcm9wZXJ0eSgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIC8vIGhhY2tzCiAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IERlbGltKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KSkgewogICAgICAgICAgICBjYXNlIEFTVEVSSVNLJDM6CiAgICAgICAgICAgIGNhc2UgRE9MTEFSU0lHTjoKICAgICAgICAgICAgY2FzZSBQTFVTU0lHTiQzOgogICAgICAgICAgICBjYXNlIE5VTUJFUlNJR04kMjoKICAgICAgICAgICAgY2FzZSBBTVBFUlNBTkQkMzoKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBUT0RPOiBub3Qgc3VyZSB3ZSBzaG91bGQgc3VwcG9ydCB0aGlzIGhhY2sKICAgICAgICAgICAgY2FzZSBTT0xJRFVTJDM6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGVsaW0oU09MSURVUyQzKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSGFzaCQxKSB7CiAgICAgICAgdGhpcy5lYXQoSGFzaCQxKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lYXQoSWRlbnQpOwogICAgfQoKICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKfQoKLy8gISB3cyogaW1wb3J0YW50CmZ1bmN0aW9uIGdldEltcG9ydGFudCgpIHsKICAgIHRoaXMuZWF0KERlbGltKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgY29uc3QgaW1wb3J0YW50ID0gdGhpcy5jb25zdW1lKElkZW50KTsKCiAgICAvLyBzdG9yZSBvcmlnaW5hbCB2YWx1ZSBpbiBjYXNlIGl0IGRpZmZlciBmcm9tIGBpbXBvcnRhbnRgCiAgICAvLyBmb3IgYmV0dGVyIG9yaWdpbmFsIHNvdXJjZSByZXN0b3JpbmcgYW5kIGhhY2tzIGxpa2UgYCFpZWAgc3VwcG9ydAogICAgcmV0dXJuIGltcG9ydGFudCA9PT0gJ2ltcG9ydGFudCcgPyB0cnVlIDogaW1wb3J0YW50Owp9Cgpjb25zdCBEZWNsYXJhdGlvbiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHUsCiAgICBuYW1lOiBuYW1lJHUsCiAgICBwYXJzZTogcGFyc2UkdSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IEFNUEVSU0FORCQyID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQoKZnVuY3Rpb24gY29uc3VtZVJhdyQzKHN0YXJ0VG9rZW4pIHsKICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCB0aGlzLmNvbnN1bWVVbnRpbFNlbWljb2xvbkluY2x1ZGVkLCB0cnVlKTsKfQoKY29uc3QgbmFtZSR0ID0gJ0RlY2xhcmF0aW9uTGlzdCc7CmNvbnN0IHN0cnVjdHVyZSRzID0gewogICAgY2hpbGRyZW46IFtbCiAgICAgICAgJ0RlY2xhcmF0aW9uJywKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSR0KCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgQXRLZXl3b3JkOgogICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlLmJpbmQodGhpcywgdHJ1ZSksIGNvbnN1bWVSYXckMykpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShBTVBFUlNBTkQkMikpICB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQzKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5wYXJzZVdpdGhGYWxsYmFjayh0aGlzLkRlY2xhcmF0aW9uLCBjb25zdW1lUmF3JDMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnRGVjbGFyYXRpb25MaXN0JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHQobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlLCBwcmV2ID0+IHsKICAgICAgICBpZiAocHJldi50eXBlID09PSAnRGVjbGFyYXRpb24nKSB7CiAgICAgICAgICAgIHRoaXMudG9rZW4oU2VtaWNvbG9uLCAnOycpOwogICAgICAgIH0KICAgIH0pOwp9Cgpjb25zdCBEZWNsYXJhdGlvbkxpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR0LAogICAgbmFtZTogbmFtZSR0LAogICAgcGFyc2U6IHBhcnNlJHQsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRzCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRzID0gJ0RpbWVuc2lvbic7CmNvbnN0IHN0cnVjdHVyZSRyID0gewogICAgdmFsdWU6IFN0cmluZywKICAgIHVuaXQ6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkcygpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgdmFsdWUgPSB0aGlzLmNvbnN1bWVOdW1iZXIoRGltZW5zaW9uJDEpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0RpbWVuc2lvbicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlLAogICAgICAgIHVuaXQ6IHRoaXMuc3Vic3RyaW5nKHN0YXJ0ICsgdmFsdWUubGVuZ3RoLCB0aGlzLnRva2VuU3RhcnQpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRzKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oRGltZW5zaW9uJDEsIG5vZGUudmFsdWUgKyBub2RlLnVuaXQpOwp9Cgpjb25zdCBEaW1lbnNpb24gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRzLAogICAgbmFtZTogbmFtZSRzLAogICAgcGFyc2U6IHBhcnNlJHMsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRyCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRyID0gJ0Z1bmN0aW9uJzsKY29uc3Qgd2Fsa0NvbnRleHQkNSA9ICdmdW5jdGlvbic7CmNvbnN0IHN0cnVjdHVyZSRxID0gewogICAgbmFtZTogU3RyaW5nLAogICAgY2hpbGRyZW46IFtbXV0KfTsKCi8vIDxmdW5jdGlvbi10b2tlbj4gPHNlcXVlbmNlPiApCmZ1bmN0aW9uIHBhcnNlJHIocmVhZFNlcXVlbmNlLCByZWNvZ25pemVyKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGNvbnN0IG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTsKICAgIGNvbnN0IG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICBsZXQgY2hpbGRyZW47CgogICAgY2hpbGRyZW4gPSByZWNvZ25pemVyLmhhc093blByb3BlcnR5KG5hbWVMb3dlckNhc2UpCiAgICAgICAgPyByZWNvZ25pemVyW25hbWVMb3dlckNhc2VdLmNhbGwodGhpcywgcmVjb2duaXplcikKICAgICAgICA6IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpOwoKICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLmVhdChSaWdodFBhcmVudGhlc2lzKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdGdW5jdGlvbicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHIobm9kZSkgewogICAgdGhpcy50b2tlbihGdW5jdGlvbiQyLCBub2RlLm5hbWUgKyAnKCcpOwogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKICAgIHRoaXMudG9rZW4oUmlnaHRQYXJlbnRoZXNpcywgJyknKTsKfQoKY29uc3QgRnVuY3Rpb24kMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHIsCiAgICBuYW1lOiBuYW1lJHIsCiAgICBwYXJzZTogcGFyc2UkciwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHEsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCi8vICcjJyBpZGVudApjb25zdCB4eHggPSAnWFhYJzsKY29uc3QgbmFtZSRxID0gJ0hhc2gnOwpjb25zdCBzdHJ1Y3R1cmUkcCA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKZnVuY3Rpb24gcGFyc2UkcSgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIHRoaXMuZWF0KEhhc2gkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSGFzaCcsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0ICsgMSkKICAgIH07Cn0KZnVuY3Rpb24gZ2VuZXJhdGUkcShub2RlKSB7CiAgICB0aGlzLnRva2VuKEhhc2gkMSwgJyMnICsgbm9kZS52YWx1ZSk7Cn0KCmNvbnN0IEhhc2ggPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRxLAogICAgbmFtZTogbmFtZSRxLAogICAgcGFyc2U6IHBhcnNlJHEsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRwLAogICAgeHh4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRwID0gJ0lkZW50aWZpZXInOwpjb25zdCBzdHJ1Y3R1cmUkbyA9IHsKICAgIG5hbWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkcCgpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIG5hbWU6IHRoaXMuY29uc3VtZShJZGVudCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHAobm9kZSkgewogICAgdGhpcy50b2tlbihJZGVudCwgbm9kZS5uYW1lKTsKfQoKY29uc3QgSWRlbnRpZmllciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHAsCiAgICBuYW1lOiBuYW1lJHAsCiAgICBwYXJzZTogcGFyc2UkcCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJG8KfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJG8gPSAnSWRTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSRuID0gewogICAgbmFtZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSRvKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgLy8gVE9ETzogY2hlY2sgdmFsdWUgaXMgYW4gaWRlbnQKICAgIHRoaXMuZWF0KEhhc2gkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSWRTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWU6IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAxKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkbyhub2RlKSB7CiAgICAvLyBVc2luZyBEZWxpbSBpbnN0ZWFkIG9mIEhhc2ggaXMgYSBoYWNrIHRvIGF2b2lkIGZvciBhIHdoaXRlc3BhY2UgYmV0d2VlbiBpZGVudCBhbmQgaWQtc2VsZWN0b3IKICAgIC8vIGluIHNhZmUgbW9kZSAoZS5nLiAiYSNpZCIpLCBiZWNhdXNlIElFMTEgZG9lc24ndCBhbGxvdyBhIHNlcXVlbmNlIDxpZGVudC10b2tlbj4gPGhhc2gtdG9rZW4+CiAgICAvLyB3aXRob3V0IGEgd2hpdGVzcGFjZSBpbiB2YWx1ZXMgKGUuZy4gIjFweCBzb2xpZCMwMDAiKQogICAgdGhpcy50b2tlbihEZWxpbSwgJyMnICsgbm9kZS5uYW1lKTsKfQoKY29uc3QgSWRTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJG8sCiAgICBuYW1lOiBuYW1lJG8sCiAgICBwYXJzZTogcGFyc2UkbywKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJG4KfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJG4gPSAnTWVkaWFGZWF0dXJlJzsKY29uc3Qgc3RydWN0dXJlJG0gPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICB2YWx1ZTogWydJZGVudGlmaWVyJywgJ051bWJlcicsICdEaW1lbnNpb24nLCAnUmF0aW8nLCBudWxsXQp9OwoKZnVuY3Rpb24gcGFyc2UkbigpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IG5hbWU7CiAgICBsZXQgdmFsdWUgPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRQYXJlbnRoZXNpcyk7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIG5hbWUgPSB0aGlzLmNvbnN1bWUoSWRlbnQpOwogICAgdGhpcy5za2lwU0MoKTsKCiAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IFJpZ2h0UGFyZW50aGVzaXMpIHsKICAgICAgICB0aGlzLmVhdChDb2xvbik7CiAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgICAgICBjYXNlIE51bWJlciQyOgogICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwTm9uV1NUeXBlKDEpID09PSBEZWxpbSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5SYXRpbygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuTnVtYmVyKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIERpbWVuc2lvbiQxOgogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLkRpbWVuc2lvbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIElkZW50OgogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ051bWJlciwgZGltZW5zaW9uLCByYXRpbyBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNraXBTQygpOwogICAgfQoKICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ01lZGlhRmVhdHVyZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgdmFsdWUKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJG4obm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0UGFyZW50aGVzaXMsICcoJyk7CiAgICB0aGlzLnRva2VuKElkZW50LCBub2RlLm5hbWUpOwoKICAgIGlmIChub2RlLnZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgICAgICB0aGlzLm5vZGUobm9kZS52YWx1ZSk7CiAgICB9CgogICAgdGhpcy50b2tlbihSaWdodFBhcmVudGhlc2lzLCAnKScpOwp9Cgpjb25zdCBNZWRpYUZlYXR1cmUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRuLAogICAgbmFtZTogbmFtZSRuLAogICAgcGFyc2U6IHBhcnNlJG4sCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRtCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRtID0gJ01lZGlhUXVlcnknOwpjb25zdCBzdHJ1Y3R1cmUkbCA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdJZGVudGlmaWVyJywKICAgICAgICAnTWVkaWFGZWF0dXJlJywKICAgICAgICAnV2hpdGVTcGFjZScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSRtKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgIGxldCBjaGlsZCA9IG51bGw7CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuSWRlbnRpZmllcigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5NZWRpYUZlYXR1cmUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgfQoKICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgIH0KCiAgICBpZiAoY2hpbGQgPT09IG51bGwpIHsKICAgICAgICB0aGlzLmVycm9yKCdJZGVudGlmaWVyIG9yIHBhcmVudGhlc2lzIGlzIGV4cGVjdGVkJyk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTWVkaWFRdWVyeScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRtKG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7Cn0KCmNvbnN0IE1lZGlhUXVlcnkgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRtLAogICAgbmFtZTogbmFtZSRtLAogICAgcGFyc2U6IHBhcnNlJG0sCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRsCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRsID0gJ01lZGlhUXVlcnlMaXN0JzsKY29uc3Qgc3RydWN0dXJlJGsgPSB7CiAgICBjaGlsZHJlbjogW1sKICAgICAgICAnTWVkaWFRdWVyeScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSRsKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuTWVkaWFRdWVyeSgpKTsKCiAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlICE9PSBDb21tYSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ01lZGlhUXVlcnlMaXN0JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGwobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlLCAoKSA9PiB0aGlzLnRva2VuKENvbW1hLCAnLCcpKTsKfQoKY29uc3QgTWVkaWFRdWVyeUxpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRsLAogICAgbmFtZTogbmFtZSRsLAogICAgcGFyc2U6IHBhcnNlJGwsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRrCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQU1QRVJTQU5EJDEgPSAweDAwMjY7ICAgICAgIC8vIFUrMDAyNiBBTVBFUlNBTkQgKCYpCgpjb25zdCBuYW1lJGsgPSAnTmVzdGluZ1NlbGVjdG9yJzsKY29uc3Qgc3RydWN0dXJlJGogPSB7Cn07CgpmdW5jdGlvbiBwYXJzZSRrKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5lYXREZWxpbShBTVBFUlNBTkQkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTmVzdGluZ1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGsoKSB7CiAgICB0aGlzLnRva2VuKERlbGltLCAnJicpOwp9Cgpjb25zdCBOZXN0aW5nU2VsZWN0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRrLAogICAgbmFtZTogbmFtZSRrLAogICAgcGFyc2U6IHBhcnNlJGssCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRqCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRqID0gJ050aCc7CmNvbnN0IHN0cnVjdHVyZSRpID0gewogICAgbnRoOiBbJ0FuUGx1c0InLCAnSWRlbnRpZmllciddLAogICAgc2VsZWN0b3I6IFsnU2VsZWN0b3JMaXN0JywgbnVsbF0KfTsKCmZ1bmN0aW9uIHBhcnNlJGooKSB7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGVuZCA9IHN0YXJ0OwogICAgbGV0IHNlbGVjdG9yID0gbnVsbDsKICAgIGxldCBudGg7CgogICAgaWYgKHRoaXMubG9va3VwVmFsdWUoMCwgJ29kZCcpIHx8IHRoaXMubG9va3VwVmFsdWUoMCwgJ2V2ZW4nKSkgewogICAgICAgIG50aCA9IHRoaXMuSWRlbnRpZmllcigpOwogICAgfSBlbHNlIHsKICAgICAgICBudGggPSB0aGlzLkFuUGx1c0IoKTsKICAgIH0KCiAgICBlbmQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLmxvb2t1cFZhbHVlKDAsICdvZicpKSB7CiAgICAgICAgdGhpcy5uZXh0KCk7CgogICAgICAgIHNlbGVjdG9yID0gdGhpcy5TZWxlY3Rvckxpc3QoKTsKICAgICAgICBlbmQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTnRoJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIGVuZCksCiAgICAgICAgbnRoLAogICAgICAgIHNlbGVjdG9yCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRqKG5vZGUpIHsKICAgIHRoaXMubm9kZShub2RlLm50aCk7CiAgICBpZiAobm9kZS5zZWxlY3RvciAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsICdvZicpOwogICAgICAgIHRoaXMubm9kZShub2RlLnNlbGVjdG9yKTsKICAgIH0KfQoKY29uc3QgTnRoID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkaiwKICAgIG5hbWU6IG5hbWUkaiwKICAgIHBhcnNlOiBwYXJzZSRqLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkaQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkaSA9ICdOdW1iZXInOwpjb25zdCBzdHJ1Y3R1cmUkaCA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCmZ1bmN0aW9uIHBhcnNlJGkoKSB7CiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdOdW1iZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIHZhbHVlOiB0aGlzLmNvbnN1bWUoTnVtYmVyJDIpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRpKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oTnVtYmVyJDIsIG5vZGUudmFsdWUpOwp9Cgpjb25zdCBOdW1iZXIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGksCiAgICBuYW1lOiBuYW1lJGksCiAgICBwYXJzZTogcGFyc2UkaSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGgKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgovLyAnLycgfCAnKicgfCAnLCcgfCAnOicgfCAnKycgfCAnLScKY29uc3QgbmFtZSRoID0gJ09wZXJhdG9yJzsKY29uc3Qgc3RydWN0dXJlJGcgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSRoKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5uZXh0KCk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnT3BlcmF0b3InLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICB2YWx1ZTogdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGgobm9kZSkgewogICAgdGhpcy50b2tlbml6ZShub2RlLnZhbHVlKTsKfQoKY29uc3QgT3BlcmF0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRoLAogICAgbmFtZTogbmFtZSRoLAogICAgcGFyc2U6IHBhcnNlJGgsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRnCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRnID0gJ1BhcmVudGhlc2VzJzsKY29uc3Qgc3RydWN0dXJlJGYgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkZyhyZWFkU2VxdWVuY2UsIHJlY29nbml6ZXIpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGNoaWxkcmVuID0gbnVsbDsKCiAgICB0aGlzLmVhdChMZWZ0UGFyZW50aGVzaXMpOwoKICAgIGNoaWxkcmVuID0gcmVhZFNlcXVlbmNlLmNhbGwodGhpcywgcmVjb2duaXplcik7CgogICAgaWYgKCF0aGlzLmVvZikgewogICAgICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BhcmVudGhlc2VzJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGcobm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0UGFyZW50aGVzaXMsICcoJyk7CiAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwogICAgdGhpcy50b2tlbihSaWdodFBhcmVudGhlc2lzLCAnKScpOwp9Cgpjb25zdCBQYXJlbnRoZXNlcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGcsCiAgICBuYW1lOiBuYW1lJGcsCiAgICBwYXJzZTogcGFyc2UkZywKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGYKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJGYgPSAnUGVyY2VudGFnZSc7CmNvbnN0IHN0cnVjdHVyZSRlID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkZigpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BlcmNlbnRhZ2UnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIHZhbHVlOiB0aGlzLmNvbnN1bWVOdW1iZXIoUGVyY2VudGFnZSQxKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkZihub2RlKSB7CiAgICB0aGlzLnRva2VuKFBlcmNlbnRhZ2UkMSwgbm9kZS52YWx1ZSArICclJyk7Cn0KCmNvbnN0IFBlcmNlbnRhZ2UgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRmLAogICAgbmFtZTogbmFtZSRmLAogICAgcGFyc2U6IHBhcnNlJGYsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRlCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRlID0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InOwpjb25zdCB3YWxrQ29udGV4dCQ0ID0gJ2Z1bmN0aW9uJzsKY29uc3Qgc3RydWN0dXJlJGQgPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICBjaGlsZHJlbjogW1snUmF3J10sIG51bGxdCn07CgovLyA6IFsgPGlkZW50PiB8IDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4/ICkgXQpmdW5jdGlvbiBwYXJzZSRlKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwogICAgbGV0IG5hbWU7CiAgICBsZXQgbmFtZUxvd2VyQ2FzZTsKCiAgICB0aGlzLmVhdChDb2xvbik7CgogICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBGdW5jdGlvbiQyKSB7CiAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZUZ1bmN0aW9uTmFtZSgpOwogICAgICAgIG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMucHNldWRvLCBuYW1lTG93ZXJDYXNlKSkgewogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMucHNldWRvW25hbWVMb3dlckNhc2VdLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCgKICAgICAgICAgICAgICAgIHRoaXMuUmF3KHRoaXMudG9rZW5JbmRleCwgbnVsbCwgZmFsc2UpCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmVhdChSaWdodFBhcmVudGhlc2lzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZShJZGVudCk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnUHNldWRvQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGUobm9kZSkgewogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKCiAgICBpZiAobm9kZS5jaGlsZHJlbiA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUubmFtZSk7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMudG9rZW4oRnVuY3Rpb24kMiwgbm9kZS5uYW1lICsgJygnKTsKICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwogICAgICAgIHRoaXMudG9rZW4oUmlnaHRQYXJlbnRoZXNpcywgJyknKTsKICAgIH0KfQoKY29uc3QgUHNldWRvQ2xhc3NTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGUsCiAgICBuYW1lOiBuYW1lJGUsCiAgICBwYXJzZTogcGFyc2UkZSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNAp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkZCA9ICdQc2V1ZG9FbGVtZW50U2VsZWN0b3InOwpjb25zdCB3YWxrQ29udGV4dCQzID0gJ2Z1bmN0aW9uJzsKY29uc3Qgc3RydWN0dXJlJGMgPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICBjaGlsZHJlbjogW1snUmF3J10sIG51bGxdCn07CgovLyA6OiBbIDxpZGVudD4gfCA8ZnVuY3Rpb24tdG9rZW4+IDxhbnktdmFsdWU+PyApIF0KZnVuY3Rpb24gcGFyc2UkZCgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGNoaWxkcmVuID0gbnVsbDsKICAgIGxldCBuYW1lOwogICAgbGV0IG5hbWVMb3dlckNhc2U7CgogICAgdGhpcy5lYXQoQ29sb24pOwogICAgdGhpcy5lYXQoQ29sb24pOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gRnVuY3Rpb24kMikgewogICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTsKICAgICAgICBuYW1lTG93ZXJDYXNlID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLnBzZXVkbywgbmFtZUxvd2VyQ2FzZSkpIHsKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLnBzZXVkb1tuYW1lTG93ZXJDYXNlXS5jYWxsKHRoaXMpOwogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goCiAgICAgICAgICAgICAgICB0aGlzLlJhdyh0aGlzLnRva2VuSW5kZXgsIG51bGwsIGZhbHNlKQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5lYXQoUmlnaHRQYXJlbnRoZXNpcyk7CiAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWUoSWRlbnQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGQobm9kZSkgewogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgIHRoaXMudG9rZW4oQ29sb24sICc6Jyk7CgogICAgaWYgKG5vZGUuY2hpbGRyZW4gPT09IG51bGwpIHsKICAgICAgICB0aGlzLnRva2VuKElkZW50LCBub2RlLm5hbWUpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRva2VuKEZ1bmN0aW9uJDIsIG5vZGUubmFtZSArICcoJyk7CiAgICAgICAgdGhpcy5jaGlsZHJlbihub2RlKTsKICAgICAgICB0aGlzLnRva2VuKFJpZ2h0UGFyZW50aGVzaXMsICcpJyk7CiAgICB9Cn0KCmNvbnN0IFBzZXVkb0VsZW1lbnRTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGQsCiAgICBuYW1lOiBuYW1lJGQsCiAgICBwYXJzZTogcGFyc2UkZCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGMsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkMwp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFNPTElEVVMkMiA9IDB4MDAyRjsgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBGVUxMU1RPUCQxID0gMHgwMDJFOyAvLyBVKzAwMkUgRlVMTCBTVE9QICguKQoKLy8gVGVybXMgb2YgPHJhdGlvPiBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXJzIChub3QgemVybyBvciBuZWdhdGl2ZSkKLy8gKHNlZSBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvbWVkaWFxdWVyaWVzLTMvI3ZhbHVlcykKLy8gSG93ZXZlciwgLW8tbWluLWRldmljZS1waXhlbC1yYXRpbyB0YWtlcyBmcmFjdGlvbmFsIHZhbHVlcyBhcyBhIHJhdGlvJ3MgdGVybQovLyBhbmQgdGhpcyBpcyB1c2luZyBieSB2YXJpb3VzIHNpdGVzLiBUaGVyZWZvcmUgd2UgcmVsYXggY2hlY2tpbmcgb24gcGFyc2UKLy8gdG8gdGVzdCBhIHRlcm0gaXMgdW5zaWduZWQgbnVtYmVyIHdpdGhvdXQgYW4gZXhwb25lbnQgcGFydC4KLy8gQWRkaXRpb25hbCBjaGVja2luZyBtYXkgYmUgYXBwbGllZCBvbiBsZXhlciB2YWxpZGF0aW9uLgpmdW5jdGlvbiBjb25zdW1lTnVtYmVyKCkgewogICAgdGhpcy5za2lwU0MoKTsKCiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY29uc3VtZShOdW1iZXIkMik7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSB2YWx1ZS5jaGFyQ29kZUF0KGkpOwogICAgICAgIGlmICghaXNEaWdpdChjb2RlKSAmJiBjb2RlICE9PSBGVUxMU1RPUCQxKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1Vuc2lnbmVkIG51bWJlciBpcyBleHBlY3RlZCcsIHRoaXMudG9rZW5TdGFydCAtIHZhbHVlLmxlbmd0aCArIGkpOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoTnVtYmVyKHZhbHVlKSA9PT0gMCkgewogICAgICAgIHRoaXMuZXJyb3IoJ1plcm8gbnVtYmVyIGlzIG5vdCBhbGxvd2VkJywgdGhpcy50b2tlblN0YXJ0IC0gdmFsdWUubGVuZ3RoKTsKICAgIH0KCiAgICByZXR1cm4gdmFsdWU7Cn0KCmNvbnN0IG5hbWUkYyA9ICdSYXRpbyc7CmNvbnN0IHN0cnVjdHVyZSRiID0gewogICAgbGVmdDogU3RyaW5nLAogICAgcmlnaHQ6IFN0cmluZwp9OwoKLy8gPHBvc2l0aXZlLWludGVnZXI+IFMqICcvJyBTKiA8cG9zaXRpdmUtaW50ZWdlcj4KZnVuY3Rpb24gcGFyc2UkYygpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgbGVmdCA9IGNvbnN1bWVOdW1iZXIuY2FsbCh0aGlzKTsKICAgIGxldCByaWdodDsKCiAgICB0aGlzLnNraXBTQygpOwogICAgdGhpcy5lYXREZWxpbShTT0xJRFVTJDIpOwogICAgcmlnaHQgPSBjb25zdW1lTnVtYmVyLmNhbGwodGhpcyk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnUmF0aW8nLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBsZWZ0LAogICAgICAgIHJpZ2h0CiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRjKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oTnVtYmVyJDIsIG5vZGUubGVmdCk7CiAgICB0aGlzLnRva2VuKERlbGltLCAnLycpOwogICAgdGhpcy50b2tlbihOdW1iZXIkMiwgbm9kZS5yaWdodCk7Cn0KCmNvbnN0IFJhdGlvID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkYywKICAgIG5hbWU6IG5hbWUkYywKICAgIHBhcnNlOiBwYXJzZSRjLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkYgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmZ1bmN0aW9uIGdldE9mZnNldEV4Y2x1ZGVXUygpIHsKICAgIGlmICh0aGlzLnRva2VuSW5kZXggPiAwKSB7CiAgICAgICAgaWYgKHRoaXMubG9va3VwVHlwZSgtMSkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50b2tlbkluZGV4ID4gMQogICAgICAgICAgICAgICAgPyB0aGlzLmdldFRva2VuU3RhcnQodGhpcy50b2tlbkluZGV4IC0gMSkKICAgICAgICAgICAgICAgIDogdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzLnRva2VuU3RhcnQ7Cn0KCmNvbnN0IG5hbWUkYiA9ICdSYXcnOwpjb25zdCBzdHJ1Y3R1cmUkYSA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCmZ1bmN0aW9uIHBhcnNlJGIoc3RhcnRUb2tlbiwgY29uc3VtZVVudGlsLCBleGNsdWRlV2hpdGVTcGFjZSkgewogICAgY29uc3Qgc3RhcnRPZmZzZXQgPSB0aGlzLmdldFRva2VuU3RhcnQoc3RhcnRUb2tlbik7CiAgICBsZXQgZW5kT2Zmc2V0OwoKICAgIHRoaXMuc2tpcFVudGlsQmFsYW5jZWQoc3RhcnRUb2tlbiwgY29uc3VtZVVudGlsIHx8IHRoaXMuY29uc3VtZVVudGlsQmFsYW5jZUVuZCk7CgogICAgaWYgKGV4Y2x1ZGVXaGl0ZVNwYWNlICYmIHRoaXMudG9rZW5TdGFydCA+IHN0YXJ0T2Zmc2V0KSB7CiAgICAgICAgZW5kT2Zmc2V0ID0gZ2V0T2Zmc2V0RXhjbHVkZVdTLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIGVuZE9mZnNldCA9IHRoaXMudG9rZW5TdGFydDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdSYXcnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydE9mZnNldCwgZW5kT2Zmc2V0KSwKICAgICAgICB2YWx1ZTogdGhpcy5zdWJzdHJpbmcoc3RhcnRPZmZzZXQsIGVuZE9mZnNldCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGIobm9kZSkgewogICAgdGhpcy50b2tlbml6ZShub2RlLnZhbHVlKTsKfQoKY29uc3QgUmF3ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkYiwKICAgIG5hbWU6IG5hbWUkYiwKICAgIHBhcnNlOiBwYXJzZSRiLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkYQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmZ1bmN0aW9uIGNvbnN1bWVSYXckMihzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxMZWZ0Q3VybHlCcmFja2V0LCB0cnVlKTsKfQoKZnVuY3Rpb24gY29uc3VtZVByZWx1ZGUoKSB7CiAgICBjb25zdCBwcmVsdWRlID0gdGhpcy5TZWxlY3Rvckxpc3QoKTsKCiAgICBpZiAocHJlbHVkZS50eXBlICE9PSAnUmF3JyAmJgogICAgICAgIHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBMZWZ0Q3VybHlCcmFja2V0KSB7CiAgICAgICAgdGhpcy5lcnJvcigpOwogICAgfQoKICAgIHJldHVybiBwcmVsdWRlOwp9Cgpjb25zdCBuYW1lJGEgPSAnUnVsZSc7CmNvbnN0IHdhbGtDb250ZXh0JDIgPSAncnVsZSc7CmNvbnN0IHN0cnVjdHVyZSQ5ID0gewogICAgcHJlbHVkZTogWydTZWxlY3Rvckxpc3QnLCAnUmF3J10sCiAgICBibG9jazogWydCbG9jayddCn07CgpmdW5jdGlvbiBwYXJzZSRhKCkgewogICAgY29uc3Qgc3RhcnRUb2tlbiA9IHRoaXMudG9rZW5JbmRleDsKICAgIGNvbnN0IHN0YXJ0T2Zmc2V0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IHByZWx1ZGU7CiAgICBsZXQgYmxvY2s7CgogICAgaWYgKHRoaXMucGFyc2VSdWxlUHJlbHVkZSkgewogICAgICAgIHByZWx1ZGUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKGNvbnN1bWVQcmVsdWRlLCBjb25zdW1lUmF3JDIpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmVsdWRlID0gY29uc3VtZVJhdyQyLmNhbGwodGhpcywgc3RhcnRUb2tlbik7CiAgICB9CgogICAgYmxvY2sgPSB0aGlzLkJsb2NrKHRydWUpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1J1bGUnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydE9mZnNldCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBwcmVsdWRlLAogICAgICAgIGJsb2NrCiAgICB9Owp9CmZ1bmN0aW9uIGdlbmVyYXRlJGEobm9kZSkgewogICAgdGhpcy5ub2RlKG5vZGUucHJlbHVkZSk7CiAgICB0aGlzLm5vZGUobm9kZS5ibG9jayk7Cn0KCmNvbnN0IFJ1bGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRhLAogICAgbmFtZTogbmFtZSRhLAogICAgcGFyc2U6IHBhcnNlJGEsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ5LAogICAgd2Fsa0NvbnRleHQ6IHdhbGtDb250ZXh0JDIKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJDkgPSAnU2VsZWN0b3InOwpjb25zdCBzdHJ1Y3R1cmUkOCA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdUeXBlU2VsZWN0b3InLAogICAgICAgICdJZFNlbGVjdG9yJywKICAgICAgICAnQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgJ0F0dHJpYnV0ZVNlbGVjdG9yJywKICAgICAgICAnUHNldWRvQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicsCiAgICAgICAgJ0NvbWJpbmF0b3InLAogICAgICAgICdXaGl0ZVNwYWNlJwogICAgXV0KfTsKCmZ1bmN0aW9uIHBhcnNlJDkoKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMucmVhZFNlcXVlbmNlKHRoaXMuc2NvcGUuU2VsZWN0b3IpOwoKICAgIC8vIG5vdGhpbmcgd2VyZSBjb25zdW1lZAogICAgaWYgKHRoaXMuZ2V0Rmlyc3RMaXN0Tm9kZShjaGlsZHJlbikgPT09IG51bGwpIHsKICAgICAgICB0aGlzLmVycm9yKCdTZWxlY3RvciBpcyBleHBlY3RlZCcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJDkobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKfQoKY29uc3QgU2VsZWN0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ5LAogICAgbmFtZTogbmFtZSQ5LAogICAgcGFyc2U6IHBhcnNlJDksCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSQ4ID0gJ1NlbGVjdG9yTGlzdCc7CmNvbnN0IHdhbGtDb250ZXh0JDEgPSAnc2VsZWN0b3InOwpjb25zdCBzdHJ1Y3R1cmUkNyA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdTZWxlY3RvcicsCiAgICAgICAgJ1JhdycKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSQ4KCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLlNlbGVjdG9yKCkpOwoKICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IENvbW1hKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1NlbGVjdG9yTGlzdCcsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQ4KG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSwgKCkgPT4gdGhpcy50b2tlbihDb21tYSwgJywnKSk7Cn0KCmNvbnN0IFNlbGVjdG9yTGlzdCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDgsCiAgICBuYW1lOiBuYW1lJDgsCiAgICBwYXJzZTogcGFyc2UkOCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJDcsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkMQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFJFVkVSU0VfU09MSURVUyQxID0gMHgwMDVjOyAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQpjb25zdCBRVU9UQVRJT05fTUFSSyQxID0gMHgwMDIyOyAgLy8gIgpjb25zdCBBUE9TVFJPUEhFJDEgPSAweDAwMjc7ICAgICAgLy8gJwoKZnVuY3Rpb24gZGVjb2RlJDEoc3RyKSB7CiAgICBjb25zdCBsZW4gPSBzdHIubGVuZ3RoOwogICAgY29uc3QgZmlyc3RDaGFyID0gc3RyLmNoYXJDb2RlQXQoMCk7CiAgICBjb25zdCBzdGFydCA9IGZpcnN0Q2hhciA9PT0gUVVPVEFUSU9OX01BUkskMSB8fCBmaXJzdENoYXIgPT09IEFQT1NUUk9QSEUkMSA/IDEgOiAwOwogICAgY29uc3QgZW5kID0gc3RhcnQgPT09IDEgJiYgbGVuID4gMSAmJiBzdHIuY2hhckNvZGVBdChsZW4gLSAxKSA9PT0gZmlyc3RDaGFyID8gbGVuIC0gMiA6IGxlbiAtIDE7CiAgICBsZXQgZGVjb2RlZCA9ICcnOwoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykgewogICAgICAgIGxldCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGlmIChjb2RlID09PSBSRVZFUlNFX1NPTElEVVMkMSkgewogICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2UgYXQgdGhlIGVuZGluZwogICAgICAgICAgICBpZiAoaSA9PT0gZW5kKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIEVPRiwgZG8gbm90aGluZwogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGluY2x1ZGUgbGFzdCBxdW90ZSBhcyBlc2NhcGVkCiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBzdHIuc3Vic3RyKGkgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RlID0gc3RyLmNoYXJDb2RlQXQoKytpKTsKCiAgICAgICAgICAgIC8vIGNvbnN1bWUgZXNjYXBlZAogICAgICAgICAgICBpZiAoaXNWYWxpZEVzY2FwZShSRVZFUlNFX1NPTElEVVMkMSwgY29kZSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZVN0YXJ0ID0gaSAtIDE7CiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVFbmQgPSBjb25zdW1lRXNjYXBlZChzdHIsIGVzY2FwZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICBpID0gZXNjYXBlRW5kIC0gMTsKICAgICAgICAgICAgICAgIGRlY29kZWQgKz0gZGVjb2RlRXNjYXBlZChzdHIuc3Vic3RyaW5nKGVzY2FwZVN0YXJ0ICsgMSwgZXNjYXBlRW5kKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBcclxuCiAgICAgICAgICAgICAgICBpZiAoY29kZSA9PT0gMHgwMDBkICYmIHN0ci5jaGFyQ29kZUF0KGkgKyAxKSA9PT0gMHgwMDBhKSB7CiAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVjb2RlZCArPSBzdHJbaV07CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBkZWNvZGVkOwp9CgovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3Nzb20vI3NlcmlhbGl6ZS1hLXN0cmluZwovLyDCpyAyLjEuIENvbW1vbiBTZXJpYWxpemluZyBJZGlvbXMKZnVuY3Rpb24gZW5jb2RlJDEoc3RyLCBhcG9zdHJvcGhlKSB7CiAgICBjb25zdCBxdW90ZSA9IGFwb3N0cm9waGUgPyAnXCcnIDogJyInOwogICAgY29uc3QgcXVvdGVDb2RlID0gYXBvc3Ryb3BoZSA/IEFQT1NUUk9QSEUkMSA6IFFVT1RBVElPTl9NQVJLJDE7CiAgICBsZXQgZW5jb2RlZCA9ICcnOwogICAgbGV0IHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKCiAgICAgICAgLy8gSWYgdGhlIGNoYXJhY3RlciBpcyBOVUxMIChVKzAwMDApLCB0aGVuIHRoZSBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKFUrRkZGRCkuCiAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAwMCkgewogICAgICAgICAgICBlbmNvZGVkICs9ICdcdUZGRkQnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBjaGFyYWN0ZXIgaXMgaW4gdGhlIHJhbmdlIFtcMS1cMWZdIChVKzAwMDEgdG8gVSswMDFGKSBvciBpcyBVKzAwN0YsCiAgICAgICAgLy8gdGhlIGNoYXJhY3RlciBlc2NhcGVkIGFzIGNvZGUgcG9pbnQuCiAgICAgICAgLy8gTm90ZTogRG8gbm90IGNvbXBhcmUgd2l0aCAweDAwMDEgc2luY2UgMHgwMDAwIGlzIHByZWNlc3NlZCBiZWZvcmUKICAgICAgICBpZiAoY29kZSA8PSAweDAwMWYgfHwgY29kZSA9PT0gMHgwMDdGKSB7CiAgICAgICAgICAgIGVuY29kZWQgKz0gJ1xcJyArIGNvZGUudG9TdHJpbmcoMTYpOwogICAgICAgICAgICB3c0JlZm9yZUhleElzTmVlZGVkID0gdHJ1ZTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzICciJyAoVSswMDIyKSBvciAiXCIgKFUrMDA1QyksIHRoZSBlc2NhcGVkIGNoYXJhY3Rlci4KICAgICAgICBpZiAoY29kZSA9PT0gcXVvdGVDb2RlIHx8IGNvZGUgPT09IFJFVkVSU0VfU09MSURVUyQxKSB7CiAgICAgICAgICAgIGVuY29kZWQgKz0gJ1xcJyArIHN0ci5jaGFyQXQoaSk7CiAgICAgICAgICAgIHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAod3NCZWZvcmVIZXhJc05lZWRlZCAmJiAoaXNIZXhEaWdpdChjb2RlKSB8fCBpc1doaXRlU3BhY2UoY29kZSkpKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVkICs9ICcgJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aGUgY2hhcmFjdGVyIGl0c2VsZi4KICAgICAgICAgICAgZW5jb2RlZCArPSBzdHIuY2hhckF0KGkpOwogICAgICAgICAgICB3c0JlZm9yZUhleElzTmVlZGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBxdW90ZSArIGVuY29kZWQgKyBxdW90ZTsKfQoKY29uc3QgbmFtZSQ3ID0gJ1N0cmluZyc7CmNvbnN0IHN0cnVjdHVyZSQ2ID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkNygpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1N0cmluZycsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHRoaXMudG9rZW5TdGFydCwgdGhpcy50b2tlbkVuZCksCiAgICAgICAgdmFsdWU6IGRlY29kZSQxKHRoaXMuY29uc3VtZShTdHJpbmckMikpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQ3KG5vZGUpIHsKICAgIHRoaXMudG9rZW4oU3RyaW5nJDIsIGVuY29kZSQxKG5vZGUudmFsdWUpKTsKfQoKY29uc3QgU3RyaW5nJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ3LAogICAgbmFtZTogbmFtZSQ3LAogICAgcGFyc2U6IHBhcnNlJDcsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgRVhDTEFNQVRJT05NQVJLID0gMHgwMDIxOyAvLyBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyAoISkKCmZ1bmN0aW9uIGNvbnN1bWVSYXckMShzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgbnVsbCwgZmFsc2UpOwp9Cgpjb25zdCBuYW1lJDYgPSAnU3R5bGVTaGVldCc7CmNvbnN0IHdhbGtDb250ZXh0ID0gJ3N0eWxlc2hlZXQnOwpjb25zdCBzdHJ1Y3R1cmUkNSA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdDb21tZW50JywKICAgICAgICAnQ0RPJywKICAgICAgICAnQ0RDJywKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScsCiAgICAgICAgJ1JhdycKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSQ2KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpOwogICAgbGV0IGNoaWxkOwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgQ29tbWVudCQxOgogICAgICAgICAgICAgICAgLy8gaWdub3JlIGNvbW1lbnRzIGV4Y2VwdCBleGNsYW1hdGlvbiBjb21tZW50cyAoaS5lLiAvKiEgLi4gKi8pIG9uIHRvcCBsZXZlbAogICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQgKyAyKSAhPT0gRVhDTEFNQVRJT05NQVJLKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkNvbW1lbnQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBDRE8kMTogLy8gPCEtLQogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkNETygpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIENEQyQxOiAvLyAtLT4KICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5DREMoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gQ1NTIFN5bnRheCBNb2R1bGUgTGV2ZWwgMwogICAgICAgICAgICAvLyDCpzIuMiBFcnJvciBoYW5kbGluZwogICAgICAgICAgICAvLyBBdCB0aGUgInRvcCBsZXZlbCIgb2YgYSBzdHlsZXNoZWV0LCBhbiA8YXQta2V5d29yZC10b2tlbj4gc3RhcnRzIGFuIGF0LXJ1bGUuCiAgICAgICAgICAgIGNhc2UgQXRLZXl3b3JkOgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlLCBjb25zdW1lUmF3JDEpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBBbnl0aGluZyBlbHNlIHN0YXJ0cyBhIHF1YWxpZmllZCBydWxlIC4uLgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQxKTsKICAgICAgICB9CgogICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1N0eWxlU2hlZXQnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBjaGlsZHJlbgogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNihub2RlKSB7CiAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwp9Cgpjb25zdCBTdHlsZVNoZWV0ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkNiwKICAgIG5hbWU6IG5hbWUkNiwKICAgIHBhcnNlOiBwYXJzZSQ2LAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkNSwKICAgIHdhbGtDb250ZXh0Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQVNURVJJU0skMiA9IDB4MDAyQTsgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgVkVSVElDQUxMSU5FJDEgPSAweDAwN0M7IC8vIFUrMDA3QyBWRVJUSUNBTCBMSU5FICh8KQoKZnVuY3Rpb24gZWF0SWRlbnRpZmllck9yQXN0ZXJpc2soKSB7CiAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50ICYmCiAgICAgICAgdGhpcy5pc0RlbGltKEFTVEVSSVNLJDIpID09PSBmYWxzZSkgewogICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgb3IgYXN0ZXJpc2sgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICB0aGlzLm5leHQoKTsKfQoKY29uc3QgbmFtZSQ1ID0gJ1R5cGVTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSQ0ID0gewogICAgbmFtZTogU3RyaW5nCn07CgovLyBpZGVudAovLyBpZGVudHxpZGVudAovLyBpZGVudHwqCi8vICoKLy8gKnxpZGVudAovLyAqfCoKLy8gfGlkZW50Ci8vIHwqCmZ1bmN0aW9uIHBhcnNlJDUoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKCiAgICBpZiAodGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQxKSkgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIGVhdElkZW50aWZpZXJPckFzdGVyaXNrLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIGVhdElkZW50aWZpZXJPckFzdGVyaXNrLmNhbGwodGhpcyk7CgogICAgICAgIGlmICh0aGlzLmlzRGVsaW0oVkVSVElDQUxMSU5FJDEpKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICBlYXRJZGVudGlmaWVyT3JBc3Rlcmlzay5jYWxsKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdUeXBlU2VsZWN0b3InLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBuYW1lOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNShub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUubmFtZSk7Cn0KCmNvbnN0IFR5cGVTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDUsCiAgICBuYW1lOiBuYW1lJDUsCiAgICBwYXJzZTogcGFyc2UkNSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJDQKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBQTFVTU0lHTiQyID0gMHgwMDJCOyAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgSFlQSEVOTUlOVVMkMSA9IDB4MDAyRDsgIC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCmNvbnN0IFFVRVNUSU9OTUFSSyA9IDB4MDAzRjsgLy8gVSswMDNGIFFVRVNUSU9OIE1BUksgKD8pCgpmdW5jdGlvbiBlYXRIZXhTZXF1ZW5jZShvZmZzZXQsIGFsbG93RGFzaCkgewogICAgbGV0IGxlbiA9IDA7CgogICAgZm9yIChsZXQgcG9zID0gdGhpcy50b2tlblN0YXJ0ICsgb2Zmc2V0OyBwb3MgPCB0aGlzLnRva2VuRW5kOyBwb3MrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQocG9zKTsKCiAgICAgICAgaWYgKGNvZGUgPT09IEhZUEhFTk1JTlVTJDEgJiYgYWxsb3dEYXNoICYmIGxlbiAhPT0gMCkgewogICAgICAgICAgICBlYXRIZXhTZXF1ZW5jZS5jYWxsKHRoaXMsIG9mZnNldCArIGxlbiArIDEsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNvZGUpKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoCiAgICAgICAgICAgICAgICBhbGxvd0Rhc2ggJiYgbGVuICE9PSAwCiAgICAgICAgICAgICAgICAgICAgPyAnSHlwaGVuIG1pbnVzJyArIChsZW4gPCA2ID8gJyBvciBoZXggZGlnaXQnIDogJycpICsgJyBpcyBleHBlY3RlZCcKICAgICAgICAgICAgICAgICAgICA6IChsZW4gPCA2ID8gJ0hleCBkaWdpdCBpcyBleHBlY3RlZCcgOiAnVW5leHBlY3RlZCBpbnB1dCcpLAogICAgICAgICAgICAgICAgcG9zCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoKytsZW4gPiA2KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1RvbyBtYW55IGhleCBkaWdpdHMnLCBwb3MpOwogICAgICAgIH0gICAgfQoKICAgIHRoaXMubmV4dCgpOwogICAgcmV0dXJuIGxlbjsKfQoKZnVuY3Rpb24gZWF0UXVlc3Rpb25NYXJrU2VxdWVuY2UobWF4KSB7CiAgICBsZXQgY291bnQgPSAwOwoKICAgIHdoaWxlICh0aGlzLmlzRGVsaW0oUVVFU1RJT05NQVJLKSkgewogICAgICAgIGlmICgrK2NvdW50ID4gbWF4KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1RvbyBtYW55IHF1ZXN0aW9uIG1hcmtzJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLm5leHQoKTsKICAgIH0KfQoKZnVuY3Rpb24gc3RhcnRzV2l0aChjb2RlKSB7CiAgICBpZiAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkgIT09IGNvZGUpIHsKICAgICAgICB0aGlzLmVycm9yKChjb2RlID09PSBQTFVTU0lHTiQyID8gJ1BsdXMgc2lnbicgOiAnSHlwaGVuIG1pbnVzJykgKyAnIGlzIGV4cGVjdGVkJyk7CiAgICB9Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyN1cmFuZ2UKLy8gSW5mb3JtYWxseSwgdGhlIDx1cmFuZ2U+IHByb2R1Y3Rpb24gaGFzIHRocmVlIGZvcm1zOgovLyBVKzAwMDEKLy8gICAgICBEZWZpbmVzIGEgcmFuZ2UgY29uc2lzdGluZyBvZiBhIHNpbmdsZSBjb2RlIHBvaW50LCBpbiB0aGlzIGNhc2UgdGhlIGNvZGUgcG9pbnQgIjEiLgovLyBVKzAwMDEtMDBmZgovLyAgICAgIERlZmluZXMgYSByYW5nZSBvZiBjb2RlcG9pbnRzIGJldHdlZW4gdGhlIGZpcnN0IGFuZCB0aGUgc2Vjb25kIHZhbHVlLCBpbiB0aGlzIGNhc2UKLy8gICAgICB0aGUgcmFuZ2UgYmV0d2VlbiAiMSIgYW5kICJmZiIgKDI1NSBpbiBkZWNpbWFsKSBpbmNsdXNpdmUuCi8vIFUrMDA/PwovLyAgICAgIERlZmluZXMgYSByYW5nZSBvZiBjb2RlcG9pbnRzIHdoZXJlIHRoZSAiPyIgY2hhcmFjdGVycyByYW5nZSBvdmVyIGFsbCBoZXggZGlnaXRzLAovLyAgICAgIGluIHRoaXMgY2FzZSBkZWZpbmluZyB0aGUgc2FtZSBhcyB0aGUgdmFsdWUgVSswMDAwLTAwZmYuCi8vIEluIGVhY2ggZm9ybSwgYSBtYXhpbXVtIG9mIDYgZGlnaXRzIGlzIGFsbG93ZWQgZm9yIGVhY2ggaGV4YWRlY2ltYWwgbnVtYmVyIChpZiB5b3UgdHJlYXQgIj8iIGFzIGEgaGV4YWRlY2ltYWwgZGlnaXQpLgovLwovLyA8dXJhbmdlPiA9Ci8vICAgdSAnKycgPGlkZW50LXRva2VuPiAnPycqIHwKLy8gICB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyogfAovLyAgIHUgPG51bWJlci10b2tlbj4gJz8nKiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiA8ZGltZW5zaW9uLXRva2VuPiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiA8bnVtYmVyLXRva2VuPiB8Ci8vICAgdSAnKycgJz8nKwpmdW5jdGlvbiBzY2FuVW5pY29kZVJhbmdlKCkgewogICAgbGV0IGhleExlbmd0aCA9IDA7CgogICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgIGNhc2UgTnVtYmVyJDI6CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gJz8nKgogICAgICAgICAgICAvLyB1IDxudW1iZXItdG9rZW4+IDxkaW1lbnNpb24tdG9rZW4+CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gPG51bWJlci10b2tlbj4KICAgICAgICAgICAgaGV4TGVuZ3RoID0gZWF0SGV4U2VxdWVuY2UuY2FsbCh0aGlzLCAxLCB0cnVlKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVsaW0oUVVFU1RJT05NQVJLKSkgewogICAgICAgICAgICAgICAgZWF0UXVlc3Rpb25NYXJrU2VxdWVuY2UuY2FsbCh0aGlzLCA2IC0gaGV4TGVuZ3RoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IERpbWVuc2lvbiQxIHx8CiAgICAgICAgICAgICAgICB0aGlzLnRva2VuVHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICAgICAgICAgIHN0YXJ0c1dpdGguY2FsbCh0aGlzLCBIWVBIRU5NSU5VUyQxKTsKICAgICAgICAgICAgICAgIGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIERpbWVuc2lvbiQxOgogICAgICAgICAgICAvLyB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyoKICAgICAgICAgICAgaGV4TGVuZ3RoID0gZWF0SGV4U2VxdWVuY2UuY2FsbCh0aGlzLCAxLCB0cnVlKTsKCiAgICAgICAgICAgIGlmIChoZXhMZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBlYXRRdWVzdGlvbk1hcmtTZXF1ZW5jZS5jYWxsKHRoaXMsIDYgLSBoZXhMZW5ndGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgLy8gdSAnKycgPGlkZW50LXRva2VuPiAnPycqCiAgICAgICAgICAgIC8vIHUgJysnICc/JysKICAgICAgICAgICAgdGhpcy5lYXREZWxpbShQTFVTU0lHTiQyKTsKCiAgICAgICAgICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQpIHsKICAgICAgICAgICAgICAgIGhleExlbmd0aCA9IGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoaGV4TGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGVhdFF1ZXN0aW9uTWFya1NlcXVlbmNlLmNhbGwodGhpcywgNiAtIGhleExlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShRVUVTVElPTk1BUkspKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGVhdFF1ZXN0aW9uTWFya1NlcXVlbmNlLmNhbGwodGhpcywgNSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5lcnJvcignSGV4IGRpZ2l0IG9yIHF1ZXN0aW9uIG1hcmsgaXMgZXhwZWN0ZWQnKTsKICAgIH0KfQoKY29uc3QgbmFtZSQ0ID0gJ1VuaWNvZGVSYW5nZSc7CmNvbnN0IHN0cnVjdHVyZSQzID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkNCgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIC8vIFUgb3IgdQogICAgdGhpcy5lYXRJZGVudCgndScpOwogICAgc2NhblVuaWNvZGVSYW5nZS5jYWxsKHRoaXMpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1VuaWNvZGVSYW5nZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNChub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUudmFsdWUpOwp9Cgpjb25zdCBVbmljb2RlUmFuZ2UgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ0LAogICAgbmFtZTogbmFtZSQ0LAogICAgcGFyc2U6IHBhcnNlJDQsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQzCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgU1BBQ0UkMSA9IDB4MDAyMDsgICAgICAgICAgICAvLyBVKzAwMjAgU1BBQ0UKY29uc3QgUkVWRVJTRV9TT0xJRFVTID0gMHgwMDVjOyAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKY29uc3QgUVVPVEFUSU9OX01BUksgPSAweDAwMjI7ICAgLy8gIgpjb25zdCBBUE9TVFJPUEhFID0gMHgwMDI3OyAgICAgICAvLyAnCmNvbnN0IExFRlRQQVJFTlRIRVNJUyA9IDB4MDAyODsgIC8vIFUrMDAyOCBMRUZUIFBBUkVOVEhFU0lTICgoKQpjb25zdCBSSUdIVFBBUkVOVEhFU0lTID0gMHgwMDI5OyAvLyBVKzAwMjkgUklHSFQgUEFSRU5USEVTSVMgKCkpCgpmdW5jdGlvbiBkZWNvZGUoc3RyKSB7CiAgICBjb25zdCBsZW4gPSBzdHIubGVuZ3RoOwogICAgbGV0IHN0YXJ0ID0gNDsgLy8gbGVuZ3RoIG9mICJ1cmwoIgogICAgbGV0IGVuZCA9IHN0ci5jaGFyQ29kZUF0KGxlbiAtIDEpID09PSBSSUdIVFBBUkVOVEhFU0lTID8gbGVuIC0gMiA6IGxlbiAtIDE7CiAgICBsZXQgZGVjb2RlZCA9ICcnOwoKICAgIHdoaWxlIChzdGFydCA8IGVuZCAmJiBpc1doaXRlU3BhY2Uoc3RyLmNoYXJDb2RlQXQoc3RhcnQpKSkgewogICAgICAgIHN0YXJ0Kys7CiAgICB9CgogICAgd2hpbGUgKHN0YXJ0IDwgZW5kICYmIGlzV2hpdGVTcGFjZShzdHIuY2hhckNvZGVBdChlbmQpKSkgewogICAgICAgIGVuZC0tOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykgewogICAgICAgIGxldCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGlmIChjb2RlID09PSBSRVZFUlNFX1NPTElEVVMpIHsKICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGF0IHRoZSBlbmRpbmcKICAgICAgICAgICAgaWYgKGkgPT09IGVuZCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBFT0YsIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBpbmNsdWRlIGxhc3QgbGVmdCBwYXJlbnRoZXNpcyBhcyBlc2NhcGVkCiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBzdHIuc3Vic3RyKGkgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RlID0gc3RyLmNoYXJDb2RlQXQoKytpKTsKCiAgICAgICAgICAgIC8vIGNvbnN1bWUgZXNjYXBlZAogICAgICAgICAgICBpZiAoaXNWYWxpZEVzY2FwZShSRVZFUlNFX1NPTElEVVMsIGNvZGUpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVTdGFydCA9IGkgLSAxOwogICAgICAgICAgICAgICAgY29uc3QgZXNjYXBlRW5kID0gY29uc3VtZUVzY2FwZWQoc3RyLCBlc2NhcGVTdGFydCk7CgogICAgICAgICAgICAgICAgaSA9IGVzY2FwZUVuZCAtIDE7CiAgICAgICAgICAgICAgICBkZWNvZGVkICs9IGRlY29kZUVzY2FwZWQoc3RyLnN1YnN0cmluZyhlc2NhcGVTdGFydCArIDEsIGVzY2FwZUVuZCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gXHJcbgogICAgICAgICAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAwZCAmJiBzdHIuY2hhckNvZGVBdChpICsgMSkgPT09IDB4MDAwYSkgewogICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlY29kZWQgKz0gc3RyW2ldOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZGVjb2RlZDsKfQoKZnVuY3Rpb24gZW5jb2RlKHN0cikgewogICAgbGV0IGVuY29kZWQgPSAnJzsKICAgIGxldCB3c0JlZm9yZUhleElzTmVlZGVkID0gZmFsc2U7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIC8vIElmIHRoZSBjaGFyYWN0ZXIgaXMgTlVMTCAoVSswMDAwKSwgdGhlbiB0aGUgUkVQTEFDRU1FTlQgQ0hBUkFDVEVSIChVK0ZGRkQpLgogICAgICAgIGlmIChjb2RlID09PSAweDAwMDApIHsKICAgICAgICAgICAgZW5jb2RlZCArPSAnXHVGRkZEJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzIGluIHRoZSByYW5nZSBbXDEtXDFmXSAoVSswMDAxIHRvIFUrMDAxRikgb3IgaXMgVSswMDdGLAogICAgICAgIC8vIHRoZSBjaGFyYWN0ZXIgZXNjYXBlZCBhcyBjb2RlIHBvaW50LgogICAgICAgIC8vIE5vdGU6IERvIG5vdCBjb21wYXJlIHdpdGggMHgwMDAxIHNpbmNlIDB4MDAwMCBpcyBwcmVjZXNzZWQgYmVmb3JlCiAgICAgICAgaWYgKGNvZGUgPD0gMHgwMDFmIHx8IGNvZGUgPT09IDB4MDA3RikgewogICAgICAgICAgICBlbmNvZGVkICs9ICdcXCcgKyBjb2RlLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgd3NCZWZvcmVIZXhJc05lZWRlZCA9IHRydWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvZGUgPT09IFNQQUNFJDEgfHwKICAgICAgICAgICAgY29kZSA9PT0gUkVWRVJTRV9TT0xJRFVTIHx8CiAgICAgICAgICAgIGNvZGUgPT09IFFVT1RBVElPTl9NQVJLIHx8CiAgICAgICAgICAgIGNvZGUgPT09IEFQT1NUUk9QSEUgfHwKICAgICAgICAgICAgY29kZSA9PT0gTEVGVFBBUkVOVEhFU0lTIHx8CiAgICAgICAgICAgIGNvZGUgPT09IFJJR0hUUEFSRU5USEVTSVMpIHsKICAgICAgICAgICAgZW5jb2RlZCArPSAnXFwnICsgc3RyLmNoYXJBdChpKTsKICAgICAgICAgICAgd3NCZWZvcmVIZXhJc05lZWRlZCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh3c0JlZm9yZUhleElzTmVlZGVkICYmIGlzSGV4RGlnaXQoY29kZSkpIHsKICAgICAgICAgICAgICAgIGVuY29kZWQgKz0gJyAnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlbmNvZGVkICs9IHN0ci5jaGFyQXQoaSk7CiAgICAgICAgICAgIHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICd1cmwoJyArIGVuY29kZWQgKyAnKSc7Cn0KCmNvbnN0IG5hbWUkMyA9ICdVcmwnOwpjb25zdCBzdHJ1Y3R1cmUkMiA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCi8vIDx1cmwtdG9rZW4+IHwgPGZ1bmN0aW9uLXRva2VuPiA8c3RyaW5nPiApCmZ1bmN0aW9uIHBhcnNlJDMoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCB2YWx1ZTsKCiAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgY2FzZSBVcmwkMToKICAgICAgICAgICAgdmFsdWUgPSBkZWNvZGUodGhpcy5jb25zdW1lKFVybCQxKSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIGlmICghdGhpcy5jbXBTdHIodGhpcy50b2tlblN0YXJ0LCB0aGlzLnRva2VuRW5kLCAndXJsKCcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdGdW5jdGlvbiBuYW1lIG11c3QgYmUgYHVybGAnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5lYXQoRnVuY3Rpb24kMik7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgICAgIHZhbHVlID0gZGVjb2RlJDEodGhpcy5jb25zdW1lKFN0cmluZyQyKSk7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aGlzLmVycm9yKCdVcmwgb3IgRnVuY3Rpb24gaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdVcmwnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICB2YWx1ZQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkMyhub2RlKSB7CiAgICB0aGlzLnRva2VuKFVybCQxLCBlbmNvZGUobm9kZS52YWx1ZSkpOwp9Cgpjb25zdCBVcmwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQzLAogICAgbmFtZTogbmFtZSQzLAogICAgcGFyc2U6IHBhcnNlJDMsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQyCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSQyID0gJ1ZhbHVlJzsKY29uc3Qgc3RydWN0dXJlJDEgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkMigpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLnJlYWRTZXF1ZW5jZSh0aGlzLnNjb3BlLlZhbHVlKTsKCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdWYWx1ZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQyKG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7Cn0KCmNvbnN0IFZhbHVlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkMiwKICAgIG5hbWU6IG5hbWUkMiwKICAgIHBhcnNlOiBwYXJzZSQyLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkMQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFNQQUNFID0gT2JqZWN0LmZyZWV6ZSh7CiAgICB0eXBlOiAnV2hpdGVTcGFjZScsCiAgICBsb2M6IG51bGwsCiAgICB2YWx1ZTogJyAnCn0pOwoKY29uc3QgbmFtZSQxID0gJ1doaXRlU3BhY2UnOwpjb25zdCBzdHJ1Y3R1cmUgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSQxKCkgewogICAgdGhpcy5lYXQoV2hpdGVTcGFjZSQxKTsKICAgIHJldHVybiBTUEFDRTsKCiAgICAvLyByZXR1cm4gewogICAgLy8gICAgIHR5cGU6ICdXaGl0ZVNwYWNlJywKICAgIC8vICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24odGhpcy50b2tlblN0YXJ0LCB0aGlzLnRva2VuRW5kKSwKICAgIC8vICAgICB2YWx1ZTogdGhpcy5jb25zdW1lKFdISVRFU1BBQ0UpCiAgICAvLyB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQxKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oV2hpdGVTcGFjZSQxLCBub2RlLnZhbHVlKTsKfQoKY29uc3QgV2hpdGVTcGFjZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDEsCiAgICBuYW1lOiBuYW1lJDEsCiAgICBwYXJzZTogcGFyc2UkMSwKICAgIHN0cnVjdHVyZQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5vZGUkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgQW5QbHVzQiwKICAgIEF0cnVsZSwKICAgIEF0cnVsZVByZWx1ZGUsCiAgICBBdHRyaWJ1dGVTZWxlY3RvciwKICAgIEJsb2NrLAogICAgQnJhY2tldHMsCiAgICBDREMsCiAgICBDRE8sCiAgICBDbGFzc1NlbGVjdG9yLAogICAgQ29tYmluYXRvciwKICAgIENvbW1lbnQsCiAgICBEZWNsYXJhdGlvbiwKICAgIERlY2xhcmF0aW9uTGlzdCwKICAgIERpbWVuc2lvbiwKICAgIEZ1bmN0aW9uOiBGdW5jdGlvbiQxLAogICAgSGFzaCwKICAgIElkU2VsZWN0b3IsCiAgICBJZGVudGlmaWVyLAogICAgTWVkaWFGZWF0dXJlLAogICAgTWVkaWFRdWVyeSwKICAgIE1lZGlhUXVlcnlMaXN0LAogICAgTmVzdGluZ1NlbGVjdG9yLAogICAgTnRoLAogICAgTnVtYmVyOiBOdW1iZXIkMSwKICAgIE9wZXJhdG9yLAogICAgUGFyZW50aGVzZXMsCiAgICBQZXJjZW50YWdlLAogICAgUHNldWRvQ2xhc3NTZWxlY3RvciwKICAgIFBzZXVkb0VsZW1lbnRTZWxlY3RvciwKICAgIFJhdGlvLAogICAgUmF3LAogICAgUnVsZSwKICAgIFNlbGVjdG9yLAogICAgU2VsZWN0b3JMaXN0LAogICAgU3RyaW5nOiBTdHJpbmckMSwKICAgIFN0eWxlU2hlZXQsCiAgICBUeXBlU2VsZWN0b3IsCiAgICBVbmljb2RlUmFuZ2UsCiAgICBVcmwsCiAgICBWYWx1ZSwKICAgIFdoaXRlU3BhY2UKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBsZXhlckNvbmZpZyA9IHsKICAgIGdlbmVyaWM6IHRydWUsCiAgICAuLi5kZWZpbml0aW9ucywKICAgIG5vZGU6IG5vZGUkMQp9OwoKY29uc3QgTlVNQkVSU0lHTiQxID0gMHgwMDIzOyAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKQpjb25zdCBBU1RFUklTSyQxID0gMHgwMDJBOyAgICAvLyBVKzAwMkEgQVNURVJJU0sgKCopCmNvbnN0IFBMVVNTSUdOJDEgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTID0gMHgwMDJEOyAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKQpjb25zdCBTT0xJRFVTJDEgPSAweDAwMkY7ICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKY29uc3QgVSA9IDB4MDA3NTsgICAgICAgICAgIC8vIFUrMDA3NSBMQVRJTiBTTUFMTCBMRVRURVIgVSAodSkKCmZ1bmN0aW9uIGRlZmF1bHRSZWNvZ25pemVyKGNvbnRleHQpIHsKICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICBjYXNlIEhhc2gkMToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSGFzaCgpOwoKICAgICAgICBjYXNlIENvbW1hOgogICAgICAgICAgICByZXR1cm4gdGhpcy5PcGVyYXRvcigpOwoKICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuUGFyZW50aGVzZXModGhpcy5yZWFkU2VxdWVuY2UsIGNvbnRleHQucmVjb2duaXplcik7CgogICAgICAgIGNhc2UgTGVmdFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJyYWNrZXRzKHRoaXMucmVhZFNlcXVlbmNlLCBjb250ZXh0LnJlY29nbml6ZXIpOwoKICAgICAgICBjYXNlIFN0cmluZyQyOgogICAgICAgICAgICByZXR1cm4gdGhpcy5TdHJpbmcoKTsKCiAgICAgICAgY2FzZSBEaW1lbnNpb24kMToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuRGltZW5zaW9uKCk7CgogICAgICAgIGNhc2UgUGVyY2VudGFnZSQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5QZXJjZW50YWdlKCk7CgogICAgICAgIGNhc2UgTnVtYmVyJDI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLk51bWJlcigpOwoKICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNtcFN0cih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQsICd1cmwoJykKICAgICAgICAgICAgICAgID8gdGhpcy5VcmwoKQogICAgICAgICAgICAgICAgOiB0aGlzLkZ1bmN0aW9uKHRoaXMucmVhZFNlcXVlbmNlLCBjb250ZXh0LnJlY29nbml6ZXIpOwoKICAgICAgICBjYXNlIFVybCQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5VcmwoKTsKCiAgICAgICAgY2FzZSBJZGVudDoKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHVuaWNvZGUgcmFuZ2UsIGl0IHNob3VsZCBzdGFydCB3aXRoIHUrIG9yIFUrCiAgICAgICAgICAgIGlmICh0aGlzLmNtcENoYXIodGhpcy50b2tlblN0YXJ0LCBVKSAmJgogICAgICAgICAgICAgICAgdGhpcy5jbXBDaGFyKHRoaXMudG9rZW5TdGFydCArIDEsIFBMVVNTSUdOJDEpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Vbmljb2RlUmFuZ2UoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICBjYXNlIERlbGltOiB7CiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KTsKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBTT0xJRFVTJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IEFTVEVSSVNLJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IFBMVVNTSUdOJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IEhZUEhFTk1JTlVTKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5PcGVyYXRvcigpOyAvLyBUT0RPOiByZXBsYWNlIHdpdGggRGVsaW0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVE9ETzogcHJvZHVjZSBhIG5vZGUgd2l0aCBEZWxpbSBub2RlIHR5cGUKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBOVU1CRVJTSUdOJDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0hleCBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJywgdGhpcy50b2tlblN0YXJ0ICsgMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQoKY29uc3QgYXRydWxlUHJlbHVkZSA9IHsKICAgIGdldE5vZGU6IGRlZmF1bHRSZWNvZ25pemVyCn07Cgpjb25zdCBOVU1CRVJTSUdOID0gMHgwMDIzOyAgICAgIC8vIFUrMDAyMyBOVU1CRVIgU0lHTiAoIykKY29uc3QgQU1QRVJTQU5EID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQpjb25zdCBBU1RFUklTSyA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgUExVU1NJR04gPSAweDAwMkI7ICAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQpjb25zdCBTT0xJRFVTID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBGVUxMU1RPUCA9IDB4MDAyRTsgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pCmNvbnN0IEdSRUFURVJUSEFOU0lHTiA9IDB4MDAzRTsgLy8gVSswMDNFIEdSRUFURVItVEhBTiBTSUdOICg+KQpjb25zdCBWRVJUSUNBTExJTkUgPSAweDAwN0M7ICAgIC8vIFUrMDA3QyBWRVJUSUNBTCBMSU5FICh8KQpjb25zdCBUSUxERSA9IDB4MDA3RTsgICAgICAgICAgIC8vIFUrMDA3RSBUSUxERSAofikKCmZ1bmN0aW9uIG9uV2hpdGVTcGFjZShuZXh0LCBjaGlsZHJlbikgewogICAgaWYgKGNoaWxkcmVuLmxhc3QgIT09IG51bGwgJiYgY2hpbGRyZW4ubGFzdC50eXBlICE9PSAnQ29tYmluYXRvcicgJiYKICAgICAgICBuZXh0ICE9PSBudWxsICYmIG5leHQudHlwZSAhPT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaCh7ICAvLyBGSVhNRTogdGhpcy5Db21iaW5hdG9yKCkgc2hvdWxkIGJlIHVzZWQgaW5zdGVhZAogICAgICAgICAgICB0eXBlOiAnQ29tYmluYXRvcicsCiAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgbmFtZTogJyAnCiAgICAgICAgfSk7CiAgICB9Cn0KCmZ1bmN0aW9uIGdldE5vZGUoKSB7CiAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgY2FzZSBMZWZ0U3F1YXJlQnJhY2tldDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXR0cmlidXRlU2VsZWN0b3IoKTsKCiAgICAgICAgY2FzZSBIYXNoJDE6CiAgICAgICAgICAgIHJldHVybiB0aGlzLklkU2VsZWN0b3IoKTsKCiAgICAgICAgY2FzZSBDb2xvbjoKICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwVHlwZSgxKSA9PT0gQ29sb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBzZXVkb0VsZW1lbnRTZWxlY3RvcigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUHNldWRvQ2xhc3NTZWxlY3RvcigpOwogICAgICAgICAgICB9CgogICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLlR5cGVTZWxlY3RvcigpOwoKICAgICAgICBjYXNlIE51bWJlciQyOgogICAgICAgIGNhc2UgUGVyY2VudGFnZSQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5QZXJjZW50YWdlKCk7CgogICAgICAgIGNhc2UgRGltZW5zaW9uJDE6CiAgICAgICAgICAgIC8vIHRocm93cyB3aGVuIC4xMjNpZGVudAogICAgICAgICAgICBpZiAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkgPT09IEZVTExTVE9QKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdJZGVudGlmaWVyIGlzIGV4cGVjdGVkJywgdGhpcy50b2tlblN0YXJ0ICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRGVsaW06IHsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQpOwoKICAgICAgICAgICAgc3dpdGNoIChjb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFBMVVNTSUdOOgogICAgICAgICAgICAgICAgY2FzZSBHUkVBVEVSVEhBTlNJR046CiAgICAgICAgICAgICAgICBjYXNlIFRJTERFOgogICAgICAgICAgICAgICAgY2FzZSBTT0xJRFVTOiAgLy8gL2RlZXAvCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQ29tYmluYXRvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgRlVMTFNUT1A6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQ2xhc3NTZWxlY3RvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgQVNURVJJU0s6CiAgICAgICAgICAgICAgICBjYXNlIFZFUlRJQ0FMTElORToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5UeXBlU2VsZWN0b3IoKTsKCiAgICAgICAgICAgICAgICBjYXNlIE5VTUJFUlNJR046CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuSWRTZWxlY3RvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgQU1QRVJTQU5EOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLk5lc3RpbmdTZWxlY3RvcigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9Cn0KY29uc3Qgc2VsZWN0b3IkMSA9IHsKICAgIG9uV2hpdGVTcGFjZSwKICAgIGdldE5vZGUKfTsKCi8vIGxlZ2FjeSBJRSBmdW5jdGlvbgovLyBleHByZXNzaW9uKCA8YW55LXZhbHVlPiApCmZ1bmN0aW9uIGV4cHJlc3Npb25GbigpIHsKICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgIHRoaXMuUmF3KHRoaXMudG9rZW5JbmRleCwgbnVsbCwgZmFsc2UpCiAgICApOwp9CgovLyB2YXIoIDxpZGVudD4gLCA8dmFsdWU+PyApCmZ1bmN0aW9uIHZhckZuKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIC8vIE5PVEU6IERvbid0IGNoZWNrIG1vcmUgdGhhbiBhIGZpcnN0IGFyZ3VtZW50IGlzIGFuIGlkZW50LCByZXN0IGNoZWNrcyBhcmUgZm9yIGxleGVyCiAgICBjaGlsZHJlbi5wdXNoKHRoaXMuSWRlbnRpZmllcigpKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gQ29tbWEpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuT3BlcmF0b3IoKSk7CgogICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSB0aGlzLnRva2VuSW5kZXg7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnBhcnNlQ3VzdG9tUHJvcGVydHkKICAgICAgICAgICAgPyB0aGlzLlZhbHVlKG51bGwpCiAgICAgICAgICAgIDogdGhpcy5SYXcodGhpcy50b2tlbkluZGV4LCB0aGlzLmNvbnN1bWVVbnRpbEV4Y2xhbWF0aW9uTWFya09yU2VtaWNvbG9uLCBmYWxzZSk7CgogICAgICAgIGlmICh2YWx1ZS50eXBlID09PSAnVmFsdWUnICYmIHZhbHVlLmNoaWxkcmVuLmlzRW1wdHkpIHsKICAgICAgICAgICAgZm9yIChsZXQgb2Zmc2V0ID0gc3RhcnRJbmRleCAtIHRoaXMudG9rZW5JbmRleDsgb2Zmc2V0IDw9IDA7IG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlLmNoaWxkcmVuLmFwcGVuZERhdGEoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnV2hpdGVTcGFjZScsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcgJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjaGlsZHJlbi5wdXNoKHZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gY2hpbGRyZW47Cn0KCmZ1bmN0aW9uIGlzUGx1c01pbnVzT3BlcmF0b3Iobm9kZSkgewogICAgcmV0dXJuICgKICAgICAgICBub2RlICE9PSBudWxsICYmCiAgICAgICAgbm9kZS50eXBlID09PSAnT3BlcmF0b3InICYmCiAgICAgICAgKG5vZGUudmFsdWVbbm9kZS52YWx1ZS5sZW5ndGggLSAxXSA9PT0gJy0nIHx8IG5vZGUudmFsdWVbbm9kZS52YWx1ZS5sZW5ndGggLSAxXSA9PT0gJysnKQogICAgKTsKfQoKY29uc3QgdmFsdWUgPSB7CiAgICBnZXROb2RlOiBkZWZhdWx0UmVjb2duaXplciwKICAgIG9uV2hpdGVTcGFjZShuZXh0LCBjaGlsZHJlbikgewogICAgICAgIGlmIChpc1BsdXNNaW51c09wZXJhdG9yKG5leHQpKSB7CiAgICAgICAgICAgIG5leHQudmFsdWUgPSAnICcgKyBuZXh0LnZhbHVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNQbHVzTWludXNPcGVyYXRvcihjaGlsZHJlbi5sYXN0KSkgewogICAgICAgICAgICBjaGlsZHJlbi5sYXN0LnZhbHVlICs9ICcgJzsKICAgICAgICB9CiAgICB9LAogICAgJ2V4cHJlc3Npb24nOiBleHByZXNzaW9uRm4sCiAgICAndmFyJzogdmFyRm4KfTsKCmNvbnN0IHNjb3BlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBBdHJ1bGVQcmVsdWRlOiBhdHJ1bGVQcmVsdWRlLAogICAgU2VsZWN0b3I6IHNlbGVjdG9yJDEsCiAgICBWYWx1ZTogdmFsdWUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBmb250RmFjZSA9IHsKICAgIHBhcnNlOiB7CiAgICAgICAgcHJlbHVkZTogbnVsbCwKICAgICAgICBibG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2sodHJ1ZSk7CiAgICAgICAgfQogICAgfQp9OwoKY29uc3QgaW1wb3J0QXRydWxlID0gewogICAgcGFyc2U6IHsKICAgICAgICBwcmVsdWRlKCkgewogICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpOwoKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgU3RyaW5nJDI6CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLlN0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFVybCQxOgogICAgICAgICAgICAgICAgY2FzZSBGdW5jdGlvbiQyOgogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5VcmwoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdTdHJpbmcgb3IgdXJsKCkgaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwTm9uV1NUeXBlKDApID09PSBJZGVudCB8fAogICAgICAgICAgICAgICAgdGhpcy5sb29rdXBOb25XU1R5cGUoMCkgPT09IExlZnRQYXJlbnRoZXNpcykgewogICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLk1lZGlhUXVlcnlMaXN0KCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2hpbGRyZW47CiAgICAgICAgfSwKICAgICAgICBibG9jazogbnVsbAogICAgfQp9OwoKY29uc3QgbWVkaWEgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5NZWRpYVF1ZXJ5TGlzdCgpCiAgICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBibG9jayhpc1N0eWxlQmxvY2sgPSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5CbG9jayhpc1N0eWxlQmxvY2spOwogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IG5lc3QgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJsb2NrKHRydWUpOwogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IHBhZ2UgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJsb2NrKHRydWUpOwogICAgICAgIH0KICAgIH0KfTsKCmZ1bmN0aW9uIGNvbnN1bWVSYXcoKSB7CiAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICB0aGlzLlJhdyh0aGlzLnRva2VuSW5kZXgsIG51bGwsIGZhbHNlKQogICAgKTsKfQoKZnVuY3Rpb24gcGFyZW50aGVzZXMoKSB7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQgJiYKICAgICAgICB0aGlzLmxvb2t1cE5vbldTVHlwZSgxKSA9PT0gQ29sb24pIHsKICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICAgICAgdGhpcy5EZWNsYXJhdGlvbigpCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gcmVhZFNlcXVlbmNlLmNhbGwodGhpcyk7Cn0KCmZ1bmN0aW9uIHJlYWRTZXF1ZW5jZSgpIHsKICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7CiAgICBsZXQgY2hpbGQ7CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgRnVuY3Rpb24kMjoKICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5GdW5jdGlvbihjb25zdW1lUmF3LCB0aGlzLnNjb3BlLkF0cnVsZVByZWx1ZGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIElkZW50OgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuUGFyZW50aGVzZXMocGFyZW50aGVzZXMsIHRoaXMuc2NvcGUuQXRydWxlUHJlbHVkZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgIH0KCiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICB9CgogICAgcmV0dXJuIGNoaWxkcmVuOwp9Cgpjb25zdCBzdXBwb3J0cyA9IHsKICAgIHBhcnNlOiB7CiAgICAgICAgcHJlbHVkZSgpIHsKICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSByZWFkU2VxdWVuY2UuY2FsbCh0aGlzKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmdldEZpcnN0TGlzdE5vZGUoY2hpbGRyZW4pID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdDb25kaXRpb24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soaXNTdHlsZUJsb2NrID0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2soaXNTdHlsZUJsb2NrKTsKICAgICAgICB9CiAgICB9Cn07Cgpjb25zdCBhdHJ1bGUgPSB7CiAgICAnZm9udC1mYWNlJzogZm9udEZhY2UsCiAgICAnaW1wb3J0JzogaW1wb3J0QXRydWxlLAogICAgbWVkaWEsCiAgICBuZXN0LAogICAgcGFnZSwKICAgIHN1cHBvcnRzCn07Cgpjb25zdCBzZWxlY3Rvckxpc3QgPSB7CiAgICBwYXJzZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICk7CiAgICB9Cn07Cgpjb25zdCBzZWxlY3RvciA9IHsKICAgIHBhcnNlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICB0aGlzLlNlbGVjdG9yKCkKICAgICAgICApOwogICAgfQp9OwoKY29uc3QgaWRlbnRMaXN0ID0gewogICAgcGFyc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoCiAgICAgICAgICAgIHRoaXMuSWRlbnRpZmllcigpCiAgICAgICAgKTsKICAgIH0KfTsKCmNvbnN0IG50aCA9IHsKICAgIHBhcnNlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICB0aGlzLk50aCgpCiAgICAgICAgKTsKICAgIH0KfTsKCmNvbnN0IHBzZXVkbyA9IHsKICAgICdkaXInOiBpZGVudExpc3QsCiAgICAnaGFzJzogc2VsZWN0b3JMaXN0LAogICAgJ2xhbmcnOiBpZGVudExpc3QsCiAgICAnbWF0Y2hlcyc6IHNlbGVjdG9yTGlzdCwKICAgICdpcyc6IHNlbGVjdG9yTGlzdCwKICAgICctbW96LWFueSc6IHNlbGVjdG9yTGlzdCwKICAgICctd2Via2l0LWFueSc6IHNlbGVjdG9yTGlzdCwKICAgICd3aGVyZSc6IHNlbGVjdG9yTGlzdCwKICAgICdub3QnOiBzZWxlY3Rvckxpc3QsCiAgICAnbnRoLWNoaWxkJzogbnRoLAogICAgJ250aC1sYXN0LWNoaWxkJzogbnRoLAogICAgJ250aC1sYXN0LW9mLXR5cGUnOiBudGgsCiAgICAnbnRoLW9mLXR5cGUnOiBudGgsCiAgICAnc2xvdHRlZCc6IHNlbGVjdG9yLAogICAgJ2hvc3QnOiBzZWxlY3RvciwKICAgICdob3N0LWNvbnRleHQnOiBzZWxlY3Rvcgp9OwoKY29uc3Qgbm9kZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgQW5QbHVzQjogcGFyc2UkRiwKICAgIEF0cnVsZTogcGFyc2UkRSwKICAgIEF0cnVsZVByZWx1ZGU6IHBhcnNlJEQsCiAgICBBdHRyaWJ1dGVTZWxlY3RvcjogcGFyc2UkQywKICAgIEJsb2NrOiBwYXJzZSRCLAogICAgQnJhY2tldHM6IHBhcnNlJEEsCiAgICBDREM6IHBhcnNlJHosCiAgICBDRE86IHBhcnNlJHksCiAgICBDbGFzc1NlbGVjdG9yOiBwYXJzZSR4LAogICAgQ29tYmluYXRvcjogcGFyc2UkdywKICAgIENvbW1lbnQ6IHBhcnNlJHYsCiAgICBEZWNsYXJhdGlvbjogcGFyc2UkdSwKICAgIERlY2xhcmF0aW9uTGlzdDogcGFyc2UkdCwKICAgIERpbWVuc2lvbjogcGFyc2UkcywKICAgIEZ1bmN0aW9uOiBwYXJzZSRyLAogICAgSGFzaDogcGFyc2UkcSwKICAgIElkU2VsZWN0b3I6IHBhcnNlJG8sCiAgICBJZGVudGlmaWVyOiBwYXJzZSRwLAogICAgTWVkaWFGZWF0dXJlOiBwYXJzZSRuLAogICAgTWVkaWFRdWVyeTogcGFyc2UkbSwKICAgIE1lZGlhUXVlcnlMaXN0OiBwYXJzZSRsLAogICAgTmVzdGluZ1NlbGVjdG9yOiBwYXJzZSRrLAogICAgTnRoOiBwYXJzZSRqLAogICAgTnVtYmVyOiBwYXJzZSRpLAogICAgT3BlcmF0b3I6IHBhcnNlJGgsCiAgICBQYXJlbnRoZXNlczogcGFyc2UkZywKICAgIFBlcmNlbnRhZ2U6IHBhcnNlJGYsCiAgICBQc2V1ZG9DbGFzc1NlbGVjdG9yOiBwYXJzZSRlLAogICAgUHNldWRvRWxlbWVudFNlbGVjdG9yOiBwYXJzZSRkLAogICAgUmF0aW86IHBhcnNlJGMsCiAgICBSYXc6IHBhcnNlJGIsCiAgICBSdWxlOiBwYXJzZSRhLAogICAgU2VsZWN0b3I6IHBhcnNlJDksCiAgICBTZWxlY3Rvckxpc3Q6IHBhcnNlJDgsCiAgICBTdHJpbmc6IHBhcnNlJDcsCiAgICBTdHlsZVNoZWV0OiBwYXJzZSQ2LAogICAgVHlwZVNlbGVjdG9yOiBwYXJzZSQ1LAogICAgVW5pY29kZVJhbmdlOiBwYXJzZSQ0LAogICAgVXJsOiBwYXJzZSQzLAogICAgVmFsdWU6IHBhcnNlJDIsCiAgICBXaGl0ZVNwYWNlOiBwYXJzZSQxCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgcGFyc2VyQ29uZmlnID0gewogICAgcGFyc2VDb250ZXh0OiB7CiAgICAgICAgZGVmYXVsdDogJ1N0eWxlU2hlZXQnLAogICAgICAgIHN0eWxlc2hlZXQ6ICdTdHlsZVNoZWV0JywKICAgICAgICBhdHJ1bGU6ICdBdHJ1bGUnLAogICAgICAgIGF0cnVsZVByZWx1ZGUob3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5BdHJ1bGVQcmVsdWRlKG9wdGlvbnMuYXRydWxlID8gU3RyaW5nKG9wdGlvbnMuYXRydWxlKSA6IG51bGwpOwogICAgICAgIH0sCiAgICAgICAgbWVkaWFRdWVyeUxpc3Q6ICdNZWRpYVF1ZXJ5TGlzdCcsCiAgICAgICAgbWVkaWFRdWVyeTogJ01lZGlhUXVlcnknLAogICAgICAgIHJ1bGU6ICdSdWxlJywKICAgICAgICBzZWxlY3Rvckxpc3Q6ICdTZWxlY3Rvckxpc3QnLAogICAgICAgIHNlbGVjdG9yOiAnU2VsZWN0b3InLAogICAgICAgIGJsb2NrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5CbG9jayh0cnVlKTsKICAgICAgICB9LAogICAgICAgIGRlY2xhcmF0aW9uTGlzdDogJ0RlY2xhcmF0aW9uTGlzdCcsCiAgICAgICAgZGVjbGFyYXRpb246ICdEZWNsYXJhdGlvbicsCiAgICAgICAgdmFsdWU6ICdWYWx1ZScKICAgIH0sCiAgICBzY29wZSwKICAgIGF0cnVsZSwKICAgIHBzZXVkbywKICAgIG5vZGUKfTsKCmNvbnN0IHdhbGtlckNvbmZpZyA9IHsKICAgIG5vZGU6IG5vZGUkMQp9OwoKY29uc3Qgc3ludGF4ID0gY3JlYXRlU3ludGF4JDEoewogICAgLi4ubGV4ZXJDb25maWcsCiAgICAuLi5wYXJzZXJDb25maWcsCiAgICAuLi53YWxrZXJDb25maWcKfSk7Cgpjb25zdCB7CiAgICB0b2tlbml6ZSwKICAgIHBhcnNlLAogICAgZ2VuZXJhdGUsCiAgICBsZXhlciwKICAgIGNyZWF0ZUxleGVyLAoKICAgIHdhbGssCiAgICBmaW5kLAogICAgZmluZExhc3QsCiAgICBmaW5kQWxsLAoKICAgIHRvUGxhaW5PYmplY3QsCiAgICBmcm9tUGxhaW5PYmplY3QsCgogICAgZm9yawp9ID0gc3ludGF4OwoKYXN5bmMgZnVuY3Rpb24gZmxhdHRlbkNTUyhzY3JpcHQsIHdpbikgewogIGNvbnN0IHRyZWUgPSBwYXJzZShzY3JpcHQsIHsgcG9zaXRpb25zOiB0cnVlIH0pOwogIGNvbnN0IGFzc2V0cyA9IFtdOwogIHdhbGsodHJlZSwgZnVuY3Rpb24obm9kZSkgewogICAgaWYgKG5vZGUudHlwZSA9PT0gIlVybCIgJiYgdGhpcy5hdHJ1bGU/Lm5hbWUgPT09ICJpbXBvcnQiKQogICAgICB0cnkgewogICAgICAgIGFzc2V0cy5wdXNoKFsKICAgICAgICAgIHRoaXMuYXRydWxlLmxvYywKICAgICAgICAgIG5ldyBVUkwobm9kZS52YWx1ZSwgd2luW3NMb2NhdGlvbl0pCiAgICAgICAgXSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfQogIH0pOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3QgYXNzZXQgb2YgYXNzZXRzKSB7CiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KG5ldyBSZXF1ZXN0KGFzc2V0WzFdKSwgInN0eWxlIiwgd2luKTsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IGF3YWl0IGZsYXR0ZW5DU1MoYXdhaXQgcmVzLnRleHQoKSwgd2luKTsKICAgIHNjcmlwdCA9IHNjcmlwdC5zbGljZSgwLCBhc3NldFswXS5zdGFydC5vZmZzZXQgLSBvZmZzZXQpICsgZ2VuZXJhdGVkICsgc2NyaXB0LnNsaWNlKGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBhc3NldFswXS5zdGFydC5vZmZzZXQgLSBnZW5lcmF0ZWQubGVuZ3RoOwogIH0KICByZXR1cm4gc2NyaXB0Owp9CmFzeW5jIGZ1bmN0aW9uKiByZXdyaXRlQ1NTKHNjcmlwdCwgY29udGV4dCwgd2luKSB7CiAgaWYgKGNvbnRleHQgPT09ICJzdHlsZXNoZWV0IikKICAgIHNjcmlwdCA9IGF3YWl0IGZsYXR0ZW5DU1Moc2NyaXB0LCB3aW4pOwogIGNvbnN0IHRyZWUgPSBwYXJzZShzY3JpcHQsIHsKICAgIHBvc2l0aW9uczogdHJ1ZSwKICAgIGNvbnRleHQKICB9KTsKICBjb25zdCBhc3NldHMgPSBbXTsKICB3YWxrKHRyZWUsIChub2RlKSA9PiB7CiAgICBpZiAobm9kZS50eXBlID09PSAiVXJsIikKICAgICAgdHJ5IHsKICAgICAgICBhc3NldHMucHVzaChbCiAgICAgICAgICBub2RlLmxvYywKICAgICAgICAgIG5ldyBVUkwobm9kZS52YWx1ZSwgd2luW3NMb2NhdGlvbl0pCiAgICAgICAgXSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfQogIH0pOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3QgYXNzZXQgb2YgYXNzZXRzKSB7CiAgICBjb25zdCBsZW5ndGggPSBhc3NldFswXS5lbmQub2Zmc2V0IC0gYXNzZXRbMF0uc3RhcnQub2Zmc2V0OwogICAgc2NyaXB0ID0gc2NyaXB0LnNsaWNlKDAsIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIG9mZnNldCkgKyAvLyBlYXN5IGxvYWRpbmcgbGFjZWhvbGRlcgogICAgIiAiLnJlcGVhdChsZW5ndGgpICsgc2NyaXB0LnNsaWNlKGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBvZmZzZXQpOwogIH0KICB5aWVsZCBzY3JpcHQ7CiAgZm9yIChjb25zdCBhc3NldCBvZiBhc3NldHMpIHsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IGB1cmwoJHthd2FpdCBsb2NhbGl6ZVJlc291cmNlKGFzc2V0WzFdLCAiaW1hZ2UiLCB3aW4pfSlgOwogICAgc2NyaXB0ID0gc2NyaXB0LnNsaWNlKDAsIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIG9mZnNldCkgKyBnZW5lcmF0ZWQgKyBzY3JpcHQuc2xpY2UoYXNzZXRbMF0uZW5kLm9mZnNldCAtIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gYXNzZXRbMF0uZW5kLm9mZnNldCAtIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIGdlbmVyYXRlZC5sZW5ndGg7CiAgICB5aWVsZCBzY3JpcHQ7CiAgfQogIHJldHVybiBzY3JpcHQ7Cn0KYXN5bmMgZnVuY3Rpb24gc2ltdWxhdGVTdHlsZShzY3JpcHQsIHdpbikgewogIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICBjb25zdCBpdCA9IHJld3JpdGVDU1Moc2NyaXB0LCAic3R5bGVzaGVldCIsIHdpbik7CiAgc3R5bGUudGV4dENvbnRlbnQgPSAoYXdhaXQgaXQubmV4dCgpKS52YWx1ZTsKICAoYXN5bmMgKCkgPT4gewogICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiBpdCkKICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSB2YWx1ZTsKICB9KSgpOwogIHJldHVybiBzdHlsZTsKfQphc3luYyBmdW5jdGlvbiBzaW11bGF0ZVN0eWxlTGluayhub2RlLCB3aW4pIHsKICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KG5ldyBSZXF1ZXN0KG5vZGUuaHJlZiksICJzdHlsZSIsIHdpbik7CiAgcmV0dXJuIGF3YWl0IHNpbXVsYXRlU3R5bGUoYXdhaXQgcmVzLnRleHQoKSwgd2luKTsKfQphc3luYyBmdW5jdGlvbiByZXdyaXRlU3R5bGUoc3R5bGUsIHdpbikgewogIGZvciAobGV0IGkgPSAwOyBpIDwgc3R5bGUubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IG5hbWUgPSBzdHlsZVtpXTsKICAgIGNvbnN0IGl0ID0gcmV3cml0ZUNTUyhzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpLCAidmFsdWUiLCB3aW4pOwogICAgc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgKGF3YWl0IGl0Lm5leHQoKSkudmFsdWUpOwogICAgKGFzeW5jICgpID0+IHsKICAgICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiBpdCkKICAgICAgICBzdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICB9KSgpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmV3cml0ZVNyY3NldChzcmNzZXQsIHdpbikgewogIGNvbnN0IHBhcnNlZCA9IHBhcnNlU3Jjc2V0KHNyY3NldCk7CiAgY29uc3QgbmV3U3Jjc2V0ID0gW107CiAgZm9yIChjb25zdCBzcmMgb2YgcGFyc2VkKQogICAgbmV3U3Jjc2V0LnB1c2goewogICAgICB1cmw6IGF3YWl0IGxvY2FsaXplUmVzb3VyY2UoCiAgICAgICAgbmV3IFVSTChzcmMudXJsLCB3aW5bc0xvY2F0aW9uXSksCiAgICAgICAgImltYWdlIiwKICAgICAgICB3aW4KICAgICAgKSwKICAgICAgLi4uc3JjLmRlbnNpdHkgPyB7IGRlbnNpdHk6IHNyYy5kZW5zaXR5IH0gOiB7fSwKICAgICAgLi4uc3JjLndpZHRoID8geyB3aWR0aDogc3JjLndpZHRoIH0gOiB7fQogICAgfSk7CiAgcmV0dXJuIHN0cmluZ2lmeVNyY3NldChuZXdTcmNzZXQpOwp9CmZ1bmN0aW9uIHJld3JpdGVTVkcoc3ZnLCB3aW4pIHsKICBmb3IgKGNvbnN0IGltYWdlIG9mIHN2Zy5xdWVyeVNlbGVjdG9yQWxsKCJpbWFnZSIpKSB7CiAgICBjb25zdCBocmVmID0gaW1hZ2UuZ2V0QXR0cmlidXRlKCJ4bGluazpocmVmIik7CiAgICBpZiAoaHJlZikgewogICAgICBpbWFnZS5yZW1vdmVBdHRyaWJ1dGUoInhsaW5rOmhyZWYiKTsKICAgICAgbG9jYWxpemVSZXNvdXJjZShuZXcgVVJMKGhyZWYsIHdpbltzTG9jYXRpb25dKSwgImltYWdlIiwgd2luKS50aGVuKAogICAgICAgICh1cmwpID0+IGltYWdlLnNldEF0dHJpYnV0ZSgieGxpbms6aHJlZiIsIHVybCkKICAgICAgKTsKICAgIH0KICB9Cn0KYXN5bmMgZnVuY3Rpb24gcmV3cml0ZUVsZW1lbnQobm9kZSwgd2luLCBwdXNoU2NyaXB0LCBhbmNob3JDbGljaykgewogIHN3aXRjaCAobm9kZS50YWdOYW1lLnRvVXBwZXJDYXNlKCkpIHsKICAgIGNhc2UgIk5PU0NSSVBUIjoKICAgICAgewogICAgICAgIGNvbnN0IGZyYWdtZW50ID0gbmV3IERvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUuY2hpbGRyZW4pCiAgICAgICAgICBmcmFnbWVudC5hcHBlbmQoY2hpbGQpOwogICAgICAgIG5vZGUucmVwbGFjZVdpdGgoZnJhZ21lbnQpOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiU0NSSVBUIjoKICAgICAgewogICAgICAgIGNvbnN0IHNjcmlwdCA9IG5vZGU7CiAgICAgICAgaWYgKHNjcmlwdC5zcmMpIHsKICAgICAgICAgIGNvbnN0IHsgc3JjIH0gPSBzY3JpcHQ7CiAgICAgICAgICBjb25zdCBzc3JjID0gYXdhaXQgcmVxdWVzdChuZXcgUmVxdWVzdChzcmMpLCAic2NyaXB0Iiwgd2luKTsKICAgICAgICAgIGF3YWl0IHB1c2hTY3JpcHQoc2NyaXB0LCBhd2FpdCBzc3JjLnRleHQoKSwgc3JjLnN1YnN0cmluZygwLCBzcmMubGFzdEluZGV4T2YoIi8iKSkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2NyaXB0LmlubmVySFRNTC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBhd2FpdCBwdXNoU2NyaXB0KHNjcmlwdCwgc2NyaXB0LmlubmVySFRNTCwgd2luW3NMb2NhdGlvbl0udG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiTUVUQSI6CiAgICAgIHsKICAgICAgICBjb25zdCBtZXRhID0gbm9kZTsKICAgICAgICBpZiAoIVsiZW5jb2RpbmciLCAiY29udGVudC10eXBlIl0uaW5jbHVkZXMobWV0YS5odHRwRXF1aXYpKQogICAgICAgICAgbWV0YS5yZW1vdmUoKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkxJTksiOgogICAgICB7CiAgICAgICAgY29uc3QgbGluayA9IG5vZGU7CiAgICAgICAgc3dpdGNoIChsaW5rLnJlbCkgewogICAgICAgICAgY2FzZSAic3R5bGVzaGVldCI6IHsKICAgICAgICAgICAgbGluay5yZXBsYWNlV2l0aChhd2FpdCBzaW11bGF0ZVN0eWxlTGluayhsaW5rLCB3aW4pKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjYXNlICJwcmVsb2FkIjogewogICAgICAgICAgICBsaW5rLnJlbW92ZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJTVFlMRSI6CiAgICAgIHsKICAgICAgICBub2RlLnJlcGxhY2VXaXRoKGF3YWl0IHNpbXVsYXRlU3R5bGUobm9kZS50ZXh0Q29udGVudCB8fCAiIiwgd2luKSk7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJJRlJBTUUiOgogICAgICB7CiAgICAgICAgY29uc3QgZnJhbWUgPSBub2RlOwogICAgICAgIGZyYW1lW3NJZnJhbWVTcmNdID0gZnJhbWUuc3JjOwogICAgICAgIGZyYW1lLnNyYyA9ICIiOwogICAgICAgIGZyYW1lLnJlbW92ZUF0dHJpYnV0ZSgic2FuZGJveCIpOwogICAgICAgIGZyYW1lLnJlbW92ZUF0dHJpYnV0ZSgiYWxsb3ciKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkEiOgogICAgICB7CiAgICAgICAgY29uc3QgYW5jaG9yID0gbm9kZTsKICAgICAgICBpZiAoYW5jaG9yLnBpbmcpCiAgICAgICAgICBhbmNob3IucGluZyA9ICIiOwogICAgICAgIGFuY2hvci5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICAgImNsaWNrIiwKICAgICAgICAgIChldmVudCkgPT4gYW5jaG9yQ2xpY2soZXZlbnQsIGFuY2hvciksCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIHByZXZlbnREZWZhdWx0IHN0b3BzIG1pZGRsZSBjbGlja2luZyB3aGVuIGNhcHR1cmUgaXMgc2V0IHRvIGZhbHNlCiAgICAgICAgICAgIGNhcHR1cmU6IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIklNRyI6CiAgICAgIHsKICAgICAgICBjb25zdCBpbWcgPSBub2RlOwogICAgICAgIGlmIChpbWcuc3JjKSB7CiAgICAgICAgICBjb25zdCB7IHNyYyB9ID0gaW1nOwogICAgICAgICAgaW1nLnNyYyA9ICIiOwogICAgICAgICAgbG9jYWxpemVSZXNvdXJjZShzcmMsICJpbWFnZSIsIHdpbikudGhlbigodXJsKSA9PiBpbWcuc3JjID0gdXJsKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJWSURFTyI6CiAgICAgIHsKICAgICAgICBjb25zdCB2aWRlbyA9IG5vZGU7CiAgICAgICAgaWYgKHZpZGVvLnBvc3RlcikgewogICAgICAgICAgY29uc3QgeyBwb3N0ZXIgfSA9IHZpZGVvOwogICAgICAgICAgbG9jYWxpemVSZXNvdXJjZShwb3N0ZXIsICJpbWFnZSIsIHdpbikudGhlbigKICAgICAgICAgICAgKHVybCkgPT4gdmlkZW8ucG9zdGVyID0gdXJsCiAgICAgICAgICApOwogICAgICAgICAgdmlkZW8ucG9zdGVyID0gIiI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHNvdXJjZXMgPSBbLi4udmlkZW8ucXVlcnlTZWxlY3RvckFsbCgic291cmNlIildLm1hcCgoc291cmNlMikgPT4gKHsKICAgICAgICAgIHR5cGU6IHNvdXJjZTIudHlwZSwKICAgICAgICAgIHNyYzogc291cmNlMi5zcmMKICAgICAgICB9KSk7CiAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB2aWRlby5xdWVyeVNlbGVjdG9yQWxsKCJ0cmFjayIpKQogICAgICAgICAgaWYgKHRyYWNrLnNyYykgewogICAgICAgICAgICBjb25zdCB7IHNyYyB9ID0gdHJhY2s7CiAgICAgICAgICAgIHRyYWNrLnNyYyA9ICIiOwogICAgICAgICAgICBsb2NhbGl6ZVJlc291cmNlKHNyYywgInRyYWNrIiwgd2luKS50aGVuKCh1cmwpID0+IHRyYWNrLnNyYyA9IHVybCk7CiAgICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBzb3VyY2UyIG9mIHZpZGVvLnF1ZXJ5U2VsZWN0b3JBbGwoInNvdXJjZSIpKQogICAgICAgICAgc291cmNlMi5yZW1vdmUoKTsKICAgICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLmZpbmQoCiAgICAgICAgICAoc291cmNlMikgPT4gTWVkaWFTb3VyY2UuaXNUeXBlU3VwcG9ydGVkKHNvdXJjZTIudHlwZSkKICAgICAgICApOwogICAgICAgIGlmICghc291cmNlKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgcmVxdWVzdChuZXcgUmVxdWVzdChzb3VyY2Uuc3JjKSwgInZpZGVvIiwgd2luKS50aGVuKGFzeW5jIChyZXMpID0+IHsKICAgICAgICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGF3YWl0IHJlcy5ibG9iKCkpOwogICAgICAgICAgdmlkZW8uc3JjID0gYmxvYlVybDsKICAgICAgICAgIHdpbltzQmxvYlVybHNdLnB1c2goYmxvYlVybCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJTVkciOgogICAgICB7CiAgICAgICAgY29uc3Qgc3ZnID0gbm9kZTsKICAgICAgICByZXdyaXRlU1ZHKHN2Zywgd2luKTsKICAgICAgfQogICAgICBicmVhazsKICB9CiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IG5vZGUgaW5zdGFuY2VvZiBIVE1MU291cmNlRWxlbWVudCkgewogICAgaWYgKG5vZGUuc3Jjc2V0KSB7CiAgICAgIGNvbnN0IHsgc3Jjc2V0IH0gPSBub2RlOwogICAgICBub2RlLnNyY3NldCA9ICIiOwogICAgICByZXdyaXRlU3Jjc2V0KHNyY3NldCwgd2luKS50aGVuKChzcmNzZXQyKSA9PiBub2RlLnNyY3NldCA9IHNyY3NldDIpOwogICAgfQogIH0KICBpZiAobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICBjb25zdCBlbG0gPSBub2RlOwogICAgaWYgKGVsbS5zdHlsZSkgewogICAgICBhd2FpdCByZXdyaXRlU3R5bGUobm9kZS5zdHlsZSwgd2luKTsKICAgIH0KICB9Cn0KCmNvbnN0IGhpc3RvcnlJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpOwpjb25zdCBjb250ZW50SGlzdG9yeSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CmZ1bmN0aW9uIGdldENvbnRlbnRIaXN0b3J5SWQoKSB7CiAgZm9yIChsZXQgaSA9IDA7IDsgaSsrKSB7CiAgICBjb25zdCBpZCA9IGBQb3J0YVByb3h5XyR7aGlzdG9yeUlkfV8ke2l9YDsKICAgIGlmICghY29udGVudEhpc3RvcnkuaGFzKGlkKSkKICAgICAgcmV0dXJuIGlkOwogIH0KfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9wc3RhdGUiLCAoZXZlbnQpID0+IHsKICBjb25zdCBkYXRhID0gY29udGVudEhpc3RvcnkuZ2V0KGV2ZW50LnN0YXRlKTsKICBpZiAoZGF0YSkKICAgIG9wZW5XaW5kb3coZGF0YS5yZXEsICJfc2VsZiIsIGRhdGEud2luLCBkYXRhLmNsaWVudCwgZmFsc2UpOwp9KTsKYXN5bmMgZnVuY3Rpb24gZGVsZXRlV2luZG93KHdpbiwgZGVsZXRlSGlzdG9yeSA9IHRydWUpIHsKICBpZiAoZGVsZXRlSGlzdG9yeSkgewogICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIGNvbnRlbnRIaXN0b3J5KQogICAgICBpZiAodmFsLndpbiA9PT0gd2luKQogICAgICAgIGNvbnRlbnRIaXN0b3J5LmRlbGV0ZShrZXkpOwogIH0KICBpZiAoc0Fib3J0IGluIHdpbikKICAgIHdpbltzQWJvcnRdLmFib3J0KCk7CiAgaWYgKHNCbG9iVXJscyBpbiB3aW4pCiAgICBmb3IgKGNvbnN0IHVybCBvZiB3aW5bc0Jsb2JVcmxzXSkKICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogIGlmIChzVGltZW91dHMgaW4gd2luKQogICAgZm9yIChjb25zdCB0aW1lb3V0IG9mIHdpbltzVGltZW91dHNdKQogICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgZm9yIChjb25zdCBpZnJhbWUgb2Ygd2luLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlmcmFtZSIpKQogICAgaWYgKGlmcmFtZS5jb250ZW50V2luZG93KQogICAgICBkZWxldGVXaW5kb3coaWZyYW1lLmNvbnRlbnRXaW5kb3cpOwp9CmFzeW5jIGZ1bmN0aW9uIG9wZW5XaW5kb3cocmVxLCB0YXJnZXQsIHdpbiwgY2xpZW50LCBzZXRIaXN0b3J5ID0gInB1c2giKSB7CiAgd2luLnNyYyA9ICIiOwogIGNvbnN0IG4gPSB3aW4ub3Blbih2b2lkIDAsIHRhcmdldCk7CiAgaWYgKCFuKQogICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoImZhaWx1cmUiKTsKICBkZWxldGVXaW5kb3cobiwgZmFsc2UpOwogIHNldFRpbWVvdXQoKCkgPT4gewogICAgaWYgKGhpc3RvcnkpIHsKICAgICAgY29uc3QgaWQgPSBnZXRDb250ZW50SGlzdG9yeUlkKCk7CiAgICAgIGNvbnRlbnRIaXN0b3J5LnNldChpZCwgewogICAgICAgIGNsaWVudCwKICAgICAgICByZXEsCiAgICAgICAgd2luOiBuCiAgICAgIH0pOwogICAgICBpZiAoc2V0SGlzdG9yeSA9PT0gInB1c2giKQogICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKGlkLCAiIiwgdm9pZCAwKTsKICAgICAgZWxzZSBpZiAoc2V0SGlzdG9yeSA9PT0gInJlcGxhY2UiKQogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKGlkLCAiIiwgdm9pZCAwKTsKICAgIH0KICAgIGxvYWRET00ocmVxLCBuLCBjbGllbnQpOwogIH0sIDEwKTsKfQphc3luYyBmdW5jdGlvbiBsb2FkRE9NKHJlcSwgd2luLCBjbGllbnQpIHsKICBpZiAoIWNsaWVudCkKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImJhZCBjbGllbnQiKTsKICB3aW5bc0Fib3J0XSA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICB3aW5bc0NsaWVudF0gPSBjbGllbnQ7CiAgd2luW3NCbG9iVXJsc10gPSBbXTsKICB3aW5bc1RpbWVvdXRzXSA9IFtdOwogIGNvbnN0IHNjcmlwdHMgPSBbXTsKICBjb25zdCBzY3JpcHRzRGVmZXJyZWQgPSBbXTsKICBjb25zdCBwdXNoU2NyaXB0ID0gYXN5bmMgKHNjcmlwdCwgY29kZSwgcmVsYXRpdmVQYXRoKSA9PiB7CiAgICBpZiAoc2NyaXB0LnR5cGUgIT09ICJtb2R1bGUiKSB7CiAgICAgIGlmIChzY3JpcHQuZGVmZXIpCiAgICAgICAgc2NyaXB0c0RlZmVycmVkLnB1c2gocmV3cml0ZShjb2RlKSk7CiAgICAgIGVsc2UKICAgICAgICBzY3JpcHRzLnB1c2gocmV3cml0ZShjb2RlKSk7CiAgICB9IGVsc2UgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBhY2tlZCA9IGF3YWl0IHJld3JpdGVNb2R1bGUoY29kZSwgbmV3IFVSTChgJHtyZWxhdGl2ZVBhdGh9L2R1bW15LmpzYCksIHdpbik7CiAgICAgICAgaWYgKHNjcmlwdC5kZWZlcikKICAgICAgICAgIHNjcmlwdHNEZWZlcnJlZC5wdXNoKHJld3JpdGUocGFja2VkKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgc2NyaXB0cy5wdXNoKHJld3JpdGUocGFja2VkKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBwYWNrZXIgZmFpbGVkISAtICR7ZX1gKTsKICAgICAgfQogICAgfQogIH07CiAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChyZXEsICJkb2N1bWVudCIsIHdpbik7CiAgd2luW3NMb2NhdGlvbl0gPSBuZXcgVVJMKHJlcy5maW5hbFVSTCk7CiAgY29uc3QgcHJvdG9Eb20gPSBuZXcgd2luLkRPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZygKICAgIGF3YWl0IHJlcy50ZXh0KCksCiAgICAidGV4dC9odG1sIgogICk7CiAgY29uc3QgYmFzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJhc2UiKTsKICBiYXNlLmhyZWYgPSB3aW5bc0xvY2F0aW9uXS50b1N0cmluZygpOwogIHByb3RvRG9tLmhlYWQuYXBwZW5kKGJhc2UpOwogIHdpbi5kb2N1bWVudC5oZWFkLmFwcGVuZChiYXNlLmNsb25lTm9kZSgpKTsKICBmb3IgKGNvbnN0IGVsbSBvZiBwcm90b0RvbS5xdWVyeVNlbGVjdG9yQWxsKCIqIikpIHsKICAgIGF3YWl0IHJld3JpdGVFbGVtZW50KGVsbSwgd2luLCBwdXNoU2NyaXB0LCAoZXZlbnQsIG5vZGUpID0+IHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgY29uc3QgcHJvdG9jb2wgPSBuZXcgVVJMKG5vZGUuaHJlZikucHJvdG9jb2w7CiAgICAgIGlmIChwcm90b2NvbCA9PT0gImphdmFzY3JpcHQ6IikKICAgICAgICByZXR1cm47CiAgICAgIGxldCB3aW5UYXJnZXQgPSBldmVudC5zaGlmdEtleSA/ICJuZXciIDogZXZlbnQuY3RybEtleSB8fCBldmVudC5idXR0b24gPT09IDEgPyAiX2JsYW5rIiA6IG5vZGUudGFyZ2V0IHx8ICJfc2VsZiI7CiAgICAgIGlmICh3aW5UYXJnZXQgPT09ICJfdG9wIiAmJiB3aW4udG9wID09PSB3aW5kb3cgfHwgd2luVGFyZ2V0ID09PSAiX3BhcmVudCIgJiYgd2luLnBhcmVudCA9PT0gd2luZG93KQogICAgICAgIHdpblRhcmdldCA9ICJfc2VsZiI7CiAgICAgIGlmICghdmFsaWRQcm90b2NvbHMuaW5jbHVkZXMocHJvdG9jb2wpKQogICAgICAgIHJldHVybiB3aW4ub3Blbihub2RlLmhyZWYsIHdpblRhcmdldCk7CiAgICAgIG9wZW5XaW5kb3cobmV3IFJlcXVlc3Qobm9kZS5ocmVmKSwgd2luVGFyZ2V0LCB3aW4sIGNsaWVudCk7CiAgICB9KTsKICB9CiAgY29uc3QgcmVmcmVzaEhlYWRlciA9IHByb3RvRG9tLnF1ZXJ5U2VsZWN0b3IoIm1ldGFbaHR0cC1lcXVpdj0ncmVmcmVzaCddIik/LmNvbnRlbnQgfHwgcmVzLmhlYWRlcnMuZ2V0KCJyZWZyZXNoIik7CiAgaWYgKHJlZnJlc2hIZWFkZXIpIHsKICAgIGNvbnN0IHJlZnJlc2ggPSBwYXJzZVJlZnJlc2hIZWFkZXIocmVmcmVzaEhlYWRlciwgd2luKTsKICAgIGlmIChyZWZyZXNoKQogICAgICB3aW5bc1RpbWVvdXRzXS5wdXNoKAogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBvcGVuV2luZG93KG5ldyBSZXF1ZXN0KHJlZnJlc2gudXJsKSwgIl9zZWxmIiwgd2luLCBjbGllbnQpLAogICAgICAgICAgcmVmcmVzaC5kdXJhdGlvbgogICAgICAgICkKICAgICAgKTsKICB9CiAgd2luLmRvY3VtZW50Lm9wZW4oKTsKICBob29rKHdpbi53aW5kb3cpOwogIGlmIChwcm90b0RvbS5kb2N0eXBlKQogICAgd2luLmRvY3VtZW50LndyaXRlKGA8IURPQ1RZUEUgJHtwcm90b0RvbS5kb2N0eXBlLm5hbWV9PmApOwogIHdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ/LnJlbW92ZSgpOwogIHdpbi5kb2N1bWVudC5hcHBlbmQocHJvdG9Eb20uZG9jdW1lbnRFbGVtZW50KTsKICB3aW5kb3dbInNjcnMiXSA9IHNjcmlwdHM7CiAgZm9yIChjb25zdCBjb2RlIG9mIHNjcmlwdHMpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICBzY3JpcHQudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICBzY3JpcHQuaW5uZXJIVE1MID0gY29kZTsKICAgICAgd2luLmRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgIH0KICB9CiAgd2luLmRvY3VtZW50LmNsb3NlKCk7CiAgZm9yIChjb25zdCBjb2RlIG9mIHNjcmlwdHNEZWZlcnJlZCkgewogICAgdHJ5IHsKICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgIHNjcmlwdC5pbm5lckhUTUwgPSBjb2RlOwogICAgICBzY3JpcHQuZGVmZXIgPSB0cnVlOwogICAgICB3aW4uZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgfQogIH0KfQoKY29uc3QgUHJveHlfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIHNyYy9Qcm94eS5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCi8vICg5NTowKSA8RGlhbG9nIGJpbmQ6b3Blbj17c2V0dGluZ3NlbmFibGVkfSBoZWFkbGluZT0iUHJveHkgU2V0dGluZ3MiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90JDIoY3R4KSB7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoJbGV0IGN1cnJlbnQ7CglsZXQgaWZfYmxvY2sgPSAhIjEiIDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWlmX2Jsb2NrX2FuY2hvciA9IGVtcHR5KCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGlmX2Jsb2NrX2FuY2hvciwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChpZl9ibG9ja19hbmNob3IpOwoJCQl9CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDIoY3R4KSB7CglsZXQgZGl2MjsKCWxldCBkaXYxOwoJbGV0IGJ1dHRvbjA7CglsZXQgaWNvbjA7CglsZXQgdDA7CglsZXQgYnV0dG9uMTsKCWxldCBpY29uMTsKCWxldCB0MTsKCWxldCBidXR0b24yOwoJbGV0IGljb24yOwoJbGV0IHQyOwoJbGV0IGRpdjA7CglsZXQgYnV0dG9uMzsKCWxldCBpY29uMzsKCWxldCB0MzsKCWxldCBpbnB1dDsKCWxldCB0NDsKCWxldCBidXR0b240OwoJbGV0IGljb240OwoJbGV0IHQ1OwoJbGV0IGlmcmFtZTsKCWxldCB0NjsKCWxldCBkaWFsb2c7CglsZXQgdXBkYXRpbmdfb3BlbjsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWljb24wID0gbmV3IEljb24oeyBwcm9wczogeyBpY29uOiAiaWM6cm91bmQtYXJyb3ctYmFjayIgfSB9KTsKCglpY29uMSA9IG5ldyBJY29uKHsKCQkJcHJvcHM6IHsgaWNvbjogImljOnJvdW5kLWFycm93LWZvcndhcmQiIH0KCQl9KTsKCglpY29uMiA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogImljOnJvdW5kLXJlZnJlc2giIH0gfSk7CglpY29uMyA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogImljOnJvdW5kLXNlYXJjaCIgfSB9KTsKCWljb240ID0gbmV3IEljb24oeyBwcm9wczogeyBpY29uOiAiaWM6cm91bmQtc2V0dGluZ3MiIH0gfSk7CgoJZnVuY3Rpb24gZGlhbG9nX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCS8qZGlhbG9nX29wZW5fYmluZGluZyovIGN0eFsxOV0odmFsdWUpOwoJfQoKCWxldCBkaWFsb2dfcHJvcHMgPSB7CgkJaGVhZGxpbmU6ICJQcm94eSBTZXR0aW5ncyIsCgkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdCQyXSB9LAoJCSQkc2NvcGU6IHsgY3R4IH0KCX07CgoJaWYgKC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzJdICE9PSB2b2lkIDApIHsKCQlkaWFsb2dfcHJvcHMub3BlbiA9IC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzJdOwoJfQoKCWRpYWxvZyA9IG5ldyBEaWFsb2ckMSh7IHByb3BzOiBkaWFsb2dfcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQoZGlhbG9nLCAnb3BlbicsIGRpYWxvZ19vcGVuX2JpbmRpbmcpKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjIgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQlidXR0b24wID0gZWxlbWVudCgiYnV0dG9uIik7CgkJCWNyZWF0ZV9jb21wb25lbnQoaWNvbjAuJCQuZnJhZ21lbnQpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCWJ1dHRvbjEgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMS4kJC5mcmFnbWVudCk7CgkJCXQxID0gc3BhY2UoKTsKCQkJYnV0dG9uMiA9IGVsZW1lbnQoImJ1dHRvbiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24yLiQkLmZyYWdtZW50KTsKCQkJdDIgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCWJ1dHRvbjMgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMy4kJC5mcmFnbWVudCk7CgkJCXQzID0gc3BhY2UoKTsKCQkJaW5wdXQgPSBlbGVtZW50KCJpbnB1dCIpOwoJCQl0NCA9IHNwYWNlKCk7CgkJCWJ1dHRvbjQgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uNC4kJC5mcmFnbWVudCk7CgkJCXQ1ID0gc3BhY2UoKTsKCQkJaWZyYW1lID0gZWxlbWVudCgiaWZyYW1lIik7CgkJCXQ2ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChkaWFsb2cuJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGJ1dHRvbjAsICJjbGFzcyIsICJ0ZXh0LTJ4bCBwLTIgaG92ZXI6dGV4dC1wcmltYXJ5Iik7CgkJCWF0dHIoYnV0dG9uMSwgImNsYXNzIiwgInRleHQtMnhsIHAtMiBob3Zlcjp0ZXh0LXByaW1hcnkiKTsKCQkJYXR0cihidXR0b24yLCAiY2xhc3MiLCAidGV4dC0yeGwgcC0yIGhvdmVyOnRleHQtcHJpbWFyeSIpOwoJCQlhdHRyKGJ1dHRvbjMsICJjbGFzcyIsICJ0ZXh0LTJ4bCBweC0yIGhvdmVyOnRleHQtcHJpbWFyeSIpOwoJCQlhdHRyKGlucHV0LCAidHlwZSIsICJ0ZXh0Iik7CgkJCWF0dHIoaW5wdXQsICJjbGFzcyIsICJmbGV4LTEgdy0wIHByLTIgdGV4dC14bCBzdmVsdGUtMWoxa2ZsayIpOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJmbGV4IGZsZXgtMSBteC0yIGJvcmRlciBib3JkZXItb3V0bGluZSByb3VuZGVkLXhsIik7CgkJCWF0dHIoYnV0dG9uNCwgImNsYXNzIiwgInRleHQtMnhsIHAtMiBob3Zlcjp0ZXh0LXByaW1hcnkiKTsKCQkJYXR0cihkaXYxLCAiY2xhc3MiLCAiZmxleCBwLTIiKTsKCQkJYXR0cihpZnJhbWUsICJjbGFzcyIsICJmbGV4LTEgc3ZlbHRlLTFqMWtmbGsiKTsKCQkJYXR0cihkaXYyLCAiY2xhc3MiLCAiaC1mdWxsIGZsZXggZmxleC1jb2wiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2MiwgYW5jaG9yKTsKCQkJYXBwZW5kKGRpdjIsIGRpdjEpOwoJCQlhcHBlbmQoZGl2MSwgYnV0dG9uMCk7CgkJCW1vdW50X2NvbXBvbmVudChpY29uMCwgYnV0dG9uMCwgbnVsbCk7CgkJCWFwcGVuZChkaXYxLCB0MCk7CgkJCWFwcGVuZChkaXYxLCBidXR0b24xKTsKCQkJbW91bnRfY29tcG9uZW50KGljb24xLCBidXR0b24xLCBudWxsKTsKCQkJYXBwZW5kKGRpdjEsIHQxKTsKCQkJYXBwZW5kKGRpdjEsIGJ1dHRvbjIpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjIsIGJ1dHRvbjIsIG51bGwpOwoJCQlhcHBlbmQoZGl2MSwgdDIpOwoJCQlhcHBlbmQoZGl2MSwgZGl2MCk7CgkJCWFwcGVuZChkaXYwLCBidXR0b24zKTsKCQkJbW91bnRfY29tcG9uZW50KGljb24zLCBidXR0b24zLCBudWxsKTsKCQkJYXBwZW5kKGRpdjAsIHQzKTsKCQkJYXBwZW5kKGRpdjAsIGlucHV0KTsKCQkJc2V0X2lucHV0X3ZhbHVlKGlucHV0LCAvKnVybCovIGN0eFswXSk7CgkJCWFwcGVuZChkaXYxLCB0NCk7CgkJCWFwcGVuZChkaXYxLCBidXR0b240KTsKCQkJbW91bnRfY29tcG9uZW50KGljb240LCBidXR0b240LCBudWxsKTsKCQkJYXBwZW5kKGRpdjIsIHQ1KTsKCQkJYXBwZW5kKGRpdjIsIGlmcmFtZSk7CgkJCS8qaWZyYW1lX2JpbmRpbmcqLyBjdHhbMTRdKGlmcmFtZSk7CgkJCWluc2VydCh0YXJnZXQsIHQ2LCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoZGlhbG9nLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gWwoJCQkJCWxpc3RlbihidXR0b24wLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXIqLyBjdHhbN10pLAoJCQkJCWxpc3RlbihidXR0b24xLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfMSovIGN0eFs4XSksCgkJCQkJbGlzdGVuKGJ1dHRvbjIsICJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8yKi8gY3R4WzldKSwKCQkJCQlsaXN0ZW4oYnV0dG9uMywgImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzMqLyBjdHhbMTBdKSwKCQkJCQlsaXN0ZW4oaW5wdXQsICJpbnB1dCIsIC8qaW5wdXRfaW5wdXRfaGFuZGxlciovIGN0eFsxMV0pLAoJCQkJCWxpc3RlbihpbnB1dCwgImtleWRvd24iLCAvKmtleWRvd25faGFuZGxlciovIGN0eFsxMl0pLAoJCQkJCWxpc3RlbihidXR0b240LCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfNCovIGN0eFsxM10pLAoJCQkJCWxpc3RlbihpZnJhbWUsICJsb2FkIiwgLypmcmFtZUxvYWQqLyBjdHhbNV0pCgkJCQldOwoKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGlydHkgJiAvKnVybCovIDEgJiYgaW5wdXQudmFsdWUgIT09IC8qdXJsKi8gY3R4WzBdKSB7CgkJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIC8qdXJsKi8gY3R4WzBdKTsKCQkJfQoKCQkJY29uc3QgZGlhbG9nX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eSAmIC8qJCRzY29wZSwgc2VhcmNoZW5naW5lLCBzZWxlY3RlZFByb3h5Ki8gMTA0ODYwMCkgewoJCQkJZGlhbG9nX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlpZiAoIXVwZGF0aW5nX29wZW4gJiYgZGlydHkgJiAvKnNldHRpbmdzZW5hYmxlZCovIDQpIHsKCQkJCXVwZGF0aW5nX29wZW4gPSB0cnVlOwoJCQkJZGlhbG9nX2NoYW5nZXMub3BlbiA9IC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzJdOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX29wZW4gPSBmYWxzZSk7CgkJCX0KCgkJCWRpYWxvZy4kc2V0KGRpYWxvZ19jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGljb24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oaWNvbjIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihpY29uMy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGljb240LiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oZGlhbG9nLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uNC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChkaWFsb2cuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjIpOwoJCQkJZGV0YWNoKHQ2KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbjApOwoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uMSk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGljb24yKTsKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbjMpOwoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uNCk7CgkJCS8qaWZyYW1lX2JpbmRpbmcqLyBjdHhbMTRdKG51bGwpOwoJCQlkZXN0cm95X2NvbXBvbmVudChkaWFsb2csIGRldGFjaGluZyk7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJcnVuX2FsbChkaXNwb3NlKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQyKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgdXJsID0gImh0dHA6Ly9nb29nbGUuY29tIjsKCWxldCBwcm94eUlmcmFtZTsKCWxldCBzZXR0aW5nc2VuYWJsZWQgPSBmYWxzZTsKCWxldCBzZWxlY3RlZFByb3h5ID0gInVsdHJhdmlvbGV0IjsKCWxldCBzZWFyY2hlbmdpbmUgPSAiaHR0cHM6Ly9nb29nbGUuY29tL3NlYXJjaD9xPSI7CgoJZnVuY3Rpb24gZnJhbWVMb2FkKCkgewoJfQoKCWZ1bmN0aW9uIHZpc2l0VVJMKHVybCkgewoJCWlmICghdXJsLmluY2x1ZGVzKCI6Ly8iKSkgewoJCQl1cmwgPSBzZWFyY2hlbmdpbmUgKyB1cmw7CgkJfQoKCQl7CgkJCWxldCBiYXJlID0gbmV3IEJhcmVDbGllbnQoKTsKCQkJb3BlbldpbmRvdyhuZXcgUmVxdWVzdCh1cmwpLCAiX3NlbGYiLCBwcm94eUlmcmFtZS5jb250ZW50V2luZG93LCBiYXJlLCAicmVwbGFjZSIpOwoJCX0KCX0KCglvbk1vdW50KCgpID0+IHsKCQl2aXNpdFVSTCh1cmwpOwoJfSk7CgoJY29uc3QgJCRiaW5kaW5nX2dyb3VwcyA9IFtbXV07CgoJY29uc3QgY2xpY2tfaGFuZGxlciA9ICgpID0+IHsKCQlwcm94eUlmcmFtZS5jb250ZW50V2luZG93Py5oaXN0b3J5LmJhY2soKTsKCX07CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8xID0gKCkgPT4gewoJCXByb3h5SWZyYW1lLmNvbnRlbnRXaW5kb3c/Lmhpc3RvcnkuZm9yd2FyZCgpOwoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyXzIgPSAoKSA9PiB7CgkJdmlzaXRVUkwodXJsKTsKCX07CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8zID0gKCkgPT4gewoJCXZpc2l0VVJMKHVybCk7Cgl9OwoKCWZ1bmN0aW9uIGlucHV0X2lucHV0X2hhbmRsZXIoKSB7CgkJdXJsID0gdGhpcy52YWx1ZTsKCQkkJGludmFsaWRhdGUoMCwgdXJsKTsKCX0KCgljb25zdCBrZXlkb3duX2hhbmRsZXIgPSBlID0+IHsKCQlpZiAoZS5rZXkgPT09ICJFbnRlciIpIHsKCQkJdmlzaXRVUkwodXJsKTsKCQl9Cgl9OwoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfNCA9ICgpID0+ICQkaW52YWxpZGF0ZSgyLCBzZXR0aW5nc2VuYWJsZWQgPSB0cnVlKTsKCglmdW5jdGlvbiBpZnJhbWVfYmluZGluZygkJHZhbHVlKSB7CgkJYmluZGluZ19jYWxsYmFja3NbJCR2YWx1ZSA/ICd1bnNoaWZ0JyA6ICdwdXNoJ10oKCkgPT4gewoJCQlwcm94eUlmcmFtZSA9ICQkdmFsdWU7CgkJCSQkaW52YWxpZGF0ZSgxLCBwcm94eUlmcmFtZSk7CgkJfSk7Cgl9CgoJZnVuY3Rpb24gaW5wdXQwX2NoYW5nZV9oYW5kbGVyKCkgewoJCXNlbGVjdGVkUHJveHkgPSB0aGlzLl9fdmFsdWU7CgkJJCRpbnZhbGlkYXRlKDMsIHNlbGVjdGVkUHJveHkpOwoJfQoKCWZ1bmN0aW9uIGlucHV0MV9jaGFuZ2VfaGFuZGxlcigpIHsKCQlzZWxlY3RlZFByb3h5ID0gdGhpcy5fX3ZhbHVlOwoJCSQkaW52YWxpZGF0ZSgzLCBzZWxlY3RlZFByb3h5KTsKCX0KCglmdW5jdGlvbiB0ZXh0ZmllbGRfdmFsdWVfYmluZGluZyh2YWx1ZSkgewoJCXNlYXJjaGVuZ2luZSA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg0LCBzZWFyY2hlbmdpbmUpOwoJfQoKCWZ1bmN0aW9uIGRpYWxvZ19vcGVuX2JpbmRpbmcodmFsdWUpIHsKCQlzZXR0aW5nc2VuYWJsZWQgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMiwgc2V0dGluZ3NlbmFibGVkKTsKCX0KCglyZXR1cm4gWwoJCXVybCwKCQlwcm94eUlmcmFtZSwKCQlzZXR0aW5nc2VuYWJsZWQsCgkJc2VsZWN0ZWRQcm94eSwKCQlzZWFyY2hlbmdpbmUsCgkJZnJhbWVMb2FkLAoJCXZpc2l0VVJMLAoJCWNsaWNrX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl8xLAoJCWNsaWNrX2hhbmRsZXJfMiwKCQljbGlja19oYW5kbGVyXzMsCgkJaW5wdXRfaW5wdXRfaGFuZGxlciwKCQlrZXlkb3duX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl80LAoJCWlmcmFtZV9iaW5kaW5nLAoJCWlucHV0MF9jaGFuZ2VfaGFuZGxlciwKCQkkJGJpbmRpbmdfZ3JvdXBzLAoJCWlucHV0MV9jaGFuZ2VfaGFuZGxlciwKCQl0ZXh0ZmllbGRfdmFsdWVfYmluZGluZywKCQlkaWFsb2dfb3Blbl9iaW5kaW5nCgldOwp9CgpsZXQgUHJveHkkMSA9IGNsYXNzIFByb3h5IGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkMiwgY3JlYXRlX2ZyYWdtZW50JDIsIHNhZmVfbm90X2VxdWFsLCB7fSk7Cgl9Cn07Cgp2YXIgbmFtZSA9ICJmaXJlYmFzZSI7CnZhciB2ZXJzaW9uID0gIjEwLjMuMSI7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpyZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpOwoKbGV0IHRyYWNrZXJzID0gewogICJ1cy1jZW50cmFsLTEiOiB7CiAgICBmaXJlYmFzZTogewogICAgICBhcGlLZXk6ICJBSXphU3lDczFMT3FzYnJBanltSWNqdmJLeFBoRlFXWGxTUGlMVHMiLAogICAgICBhdXRoRG9tYWluOiAiYWRyaWZ0LTZjMWY2LmZpcmViYXNlYXBwLmNvbSIsCiAgICAgIHByb2plY3RJZDogImFkcmlmdC02YzFmNiIsCiAgICAgIHN0b3JhZ2VCdWNrZXQ6ICJhZHJpZnQtNmMxZjYuYXBwc3BvdC5jb20iLAogICAgICBtZXNzYWdpbmdTZW5kZXJJZDogIjE3NTg0NjUxMjQxNCIsCiAgICAgIGFwcElkOiAiMToxNzU4NDY1MTI0MTQ6d2ViOjVjNmUwNmQyMzFhYjU4ZTkwMjliMGYiLAogICAgICBtZWFzdXJlbWVudElkOiAiRy1MMFAyRUY2UTcyIgogICAgfSwKICAgIHRyYWNrZXI6ICJ3c3M6Ly9sYjEubWVyY3VyeXdvcmsuc2hvcCIsCiAgICBkZXNjcmlwdGlvbjogInRoZSBvZmZpY2lhbCBjZW50cmFsIHRyYWNrZXIiCiAgfSwKICAicmFmZnRyYWNrZXIiOiB7CiAgICBmaXJlYmFzZTogewogICAgICBhcGlLZXk6ICJBSXphU3lEa2NkYTByLWdkaUpvVFE3RWJPTDlxNy1OQlF3aUtsUGciLAogICAgICBhdXRoRG9tYWluOiAicmFmZnRyYWNrZXIuZmlyZWJhc2VhcHAuY29tIiwKICAgICAgZGF0YWJhc2VVUkw6ICJodHRwczovL3JhZmZ0cmFja2VyLWRlZmF1bHQtcnRkYi5maXJlYmFzZWlvLmNvbSIsCiAgICAgIHByb2plY3RJZDogInJhZmZ0cmFja2VyIiwKICAgICAgc3RvcmFnZUJ1Y2tldDogInJhZmZ0cmFja2VyLmFwcHNwb3QuY29tIiwKICAgICAgbWVzc2FnaW5nU2VuZGVySWQ6ICI5OTQ5NDgwMzkwMTQiLAogICAgICBhcHBJZDogIjE6OTk0OTQ4MDM5MDE0OndlYjpmOTY5NzBhYTRmNjI2ZTk2OWRjOGE3IiwKICAgICAgbWVhc3VyZW1lbnRJZDogIkctUEQ5NlpLWDMxRCIKICAgIH0sCiAgICB0cmFja2VyOiAid3NzOi8vcmFmZnRyYWNrZXIubWVyY3VyeXdvcmsuc2hvcCIsCiAgICBkZXNjcmlwdGlvbjogImEgc2Vjb25kIG9mZmljaWFsIGJhY2t1cCB0cmFja2VyIgogIH0KfTsKCnZhciBVSVN0YXRlID0gLyogQF9fUFVSRV9fICovICgoVUlTdGF0ZTIpID0+IHsKICBVSVN0YXRlMltVSVN0YXRlMlsiSWRsZSJdID0gMF0gPSAiSWRsZSI7CiAgVUlTdGF0ZTJbVUlTdGF0ZTJbIkNvbm5lY3RpbmciXSA9IDFdID0gIkNvbm5lY3RpbmciOwogIFVJU3RhdGUyW1VJU3RhdGUyWyJDb25uZWN0ZWQiXSA9IDJdID0gIkNvbm5lY3RlZCI7CiAgcmV0dXJuIFVJU3RhdGUyOwp9KShVSVN0YXRlIHx8IHt9KTsKCmNvbnN0IENvbm5lY3Rpb25fc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIHNyYy9Db25uZWN0aW9uLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gZ2V0X2VhY2hfY29udGV4dChjdHgsIGxpc3QsIGkpIHsKCWNvbnN0IGNoaWxkX2N0eCA9IGN0eC5zbGljZSgpOwoJY2hpbGRfY3R4WzI3XSA9IGxpc3RbaV1bMF07CgljaGlsZF9jdHhbMjhdID0gbGlzdFtpXVsxXTsKCWNoaWxkX2N0eFszMF0gPSBpOwoJcmV0dXJuIGNoaWxkX2N0eDsKfQoKLy8gKDkwOjYpIHsjaWYgaSAhPSAwfQpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2skMShjdHgpIHsKCWxldCBkaXZpZGVyOwoJbGV0IGN1cnJlbnQ7CglkaXZpZGVyID0gbmV3IERpdmlkZXIkMSh7fSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KGRpdmlkZXIuJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQoZGl2aWRlciwgdGFyZ2V0LCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihkaXZpZGVyLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChkaXZpZGVyLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGRpdmlkZXIsIGRldGFjaGluZyk7CgkJfQoJfTsKfQoKLy8gKDEwMTo4KSA8UmFkaW9BbmltMiBzbG90PSJsZWFkaW5nIj4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF82KGN0eCkgewoJbGV0IGlucHV0OwoJbGV0IHQ7CglsZXQgYmluZGluZ19ncm91cDsKCWxldCBtb3VudGVkOwoJbGV0IGRpc3Bvc2U7CgliaW5kaW5nX2dyb3VwID0gaW5pdF9iaW5kaW5nX2dyb3VwKC8qJCRiaW5kaW5nX2dyb3VwcyovIGN0eFsxNF1bMF0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJaW5wdXQgPSBlbGVtZW50KCJpbnB1dCIpOwoJCQl0ID0gc3BhY2UoKTsKCQkJYXR0cihpbnB1dCwgInR5cGUiLCAicmFkaW8iKTsKCQkJYXR0cihpbnB1dCwgIm5hbWUiLCAidHJhY2tlciIpOwoJCQlpbnB1dC5fX3ZhbHVlID0gLyp0cmFja2VySWQqLyBjdHhbMjddOwoJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIGlucHV0Ll9fdmFsdWUpOwoJCQliaW5kaW5nX2dyb3VwLnAoaW5wdXQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBpbnB1dCwgYW5jaG9yKTsKCQkJaW5wdXQuY2hlY2tlZCA9IGlucHV0Ll9fdmFsdWUgPT09IC8qc2VsZWN0ZWRUcmFja2VyKi8gY3R4WzFdOwoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gbGlzdGVuKGlucHV0LCAiY2hhbmdlIiwgLyppbnB1dF9jaGFuZ2VfaGFuZGxlciovIGN0eFsxM10pOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlpZiAoZGlydHlbMF0gJiAvKnNlbGVjdGVkVHJhY2tlciovIDIpIHsKCQkJCWlucHV0LmNoZWNrZWQgPSBpbnB1dC5fX3ZhbHVlID09PSAvKnNlbGVjdGVkVHJhY2tlciovIGN0eFsxXTsKCQkJfQoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGlucHV0KTsKCQkJCWRldGFjaCh0KTsKCQkJfQoKCQkJYmluZGluZ19ncm91cC5yKCk7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJZGlzcG9zZSgpOwoJCX0KCX07Cn0KCi8vICgxMDE6OCkgCmZ1bmN0aW9uIGNyZWF0ZV9sZWFkaW5nX3Nsb3QoY3R4KSB7CglsZXQgcmFkaW9hbmltMjsKCWxldCBjdXJyZW50OwoKCXJhZGlvYW5pbTIgPSBuZXcgUmFkaW9BbmltMiQxKHsKCQkJcHJvcHM6IHsKCQkJCXNsb3Q6ICJsZWFkaW5nIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfNl0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJY3JlYXRlX2NvbXBvbmVudChyYWRpb2FuaW0yLiQkLmZyYWdtZW50KTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJbW91bnRfY29tcG9uZW50KHJhZGlvYW5pbTIsIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgcmFkaW9hbmltMl9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMF0gJiAvKnNlbGVjdGVkVHJhY2tlciovIDIgfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDEpIHsKCQkJCXJhZGlvYW5pbTJfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCXJhZGlvYW5pbTIuJHNldChyYWRpb2FuaW0yX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKHJhZGlvYW5pbTIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KHJhZGlvYW5pbTIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJZGVzdHJveV9jb21wb25lbnQocmFkaW9hbmltMiwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoODk6NCkgeyNlYWNoIE9iamVjdC5lbnRyaWVzKHRyYWNrZXJMaXN0KSBhcyBbdHJhY2tlcklkLCB0cmFja2VyXSwgaX0KZnVuY3Rpb24gY3JlYXRlX2VhY2hfYmxvY2soY3R4KSB7CglsZXQgdDsKCWxldCBsaXN0aXRlbWxhYmVsOwoJbGV0IGN1cnJlbnQ7CglsZXQgaWZfYmxvY2sgPSAvKmkqLyBjdHhbMzBdICE9IDAgJiYgY3JlYXRlX2lmX2Jsb2NrJDEoKTsKCglsaXN0aXRlbWxhYmVsID0gbmV3IExpc3RJdGVtTGFiZWwkMSh7CgkJCXByb3BzOiB7CgkJCQloZWFkbGluZTogLyp0cmFja2VySWQqLyBjdHhbMjddLAoJCQkJc3VwcG9ydGluZzogLyp0cmFja2VyU3RhdHMqLyBjdHhbMl1bLyp0cmFja2VySWQqLyBjdHhbMjddXQoJCQkJPyBgJHsvKnRyYWNrZXIqLyBjdHhbMjhdLmRlc2NyaXB0aW9ufSAtICR7Lyp0cmFja2VyU3RhdHMqLyBjdHhbMl1bLyp0cmFja2VySWQqLyBjdHhbMjddXS5tZW1iZXJzLmxlbmd0aH0gJHsvKnRyYWNrZXJTdGF0cyovIGN0eFsyXVsvKnRyYWNrZXJJZCovIGN0eFsyN11dLm1lbWJlcnMubGVuZ3RoID09IDEKCQkJCQk/ICJub2RlIgoJCQkJCTogIm5vZGVzIn1gCgkJCQk6IC8qdHJhY2tlciovIGN0eFsyOF0uZGVzY3JpcHRpb24sCgkJCQkkJHNsb3RzOiB7IGxlYWRpbmc6IFtjcmVhdGVfbGVhZGluZ19zbG90XSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmMoKTsKCQkJdCA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQobGlzdGl0ZW1sYWJlbC4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2subSh0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChsaXN0aXRlbWxhYmVsLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IGxpc3RpdGVtbGFiZWxfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzBdICYgLyp0cmFja2VyU3RhdHMqLyA0KSBsaXN0aXRlbWxhYmVsX2NoYW5nZXMuc3VwcG9ydGluZyA9IC8qdHJhY2tlclN0YXRzKi8gY3R4WzJdWy8qdHJhY2tlcklkKi8gY3R4WzI3XV0KCQkJPyBgJHsvKnRyYWNrZXIqLyBjdHhbMjhdLmRlc2NyaXB0aW9ufSAtICR7Lyp0cmFja2VyU3RhdHMqLyBjdHhbMl1bLyp0cmFja2VySWQqLyBjdHhbMjddXS5tZW1iZXJzLmxlbmd0aH0gJHsvKnRyYWNrZXJTdGF0cyovIGN0eFsyXVsvKnRyYWNrZXJJZCovIGN0eFsyN11dLm1lbWJlcnMubGVuZ3RoID09IDEKCQkJCT8gIm5vZGUiCgkJCQk6ICJub2RlcyJ9YAoJCQk6IC8qdHJhY2tlciovIGN0eFsyOF0uZGVzY3JpcHRpb247CgoJCQlpZiAoZGlydHlbMF0gJiAvKnNlbGVjdGVkVHJhY2tlciovIDIgfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDEpIHsKCQkJCWxpc3RpdGVtbGFiZWxfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWxpc3RpdGVtbGFiZWwuJHNldChsaXN0aXRlbWxhYmVsX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrKTsKCQkJdHJhbnNpdGlvbl9pbihsaXN0aXRlbWxhYmVsLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25fb3V0KGxpc3RpdGVtbGFiZWwuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmQoZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQobGlzdGl0ZW1sYWJlbCwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMTE4OjQpIDxCdXR0b24gICAgICAgdHlwZT0idGV4dCIgICAgICAgb246Y2xpY2s9eygpID0+IHsgICAgICAgICBjb25uZWN0VG9BcHAodHJhY2tlckxpc3Rbc2VsZWN0ZWRUcmFja2VyXSk7ICAgICAgICAgc2V0UGVyc2lzdGVuY2UoYXV0aCwgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UpOyAgICAgICAgIGNvbnNvbGUubG9nKGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlLCBhdXRoLmN1cnJlbnRVc2VyKTsgICAgICAgICAgaWYgKGF1dGguY3VycmVudFVzZXIpIHsgICAgICAgICAgIGNvbm5lY3ROb2RlKCk7ICAgICAgICAgfSBlbHNlIHsgICAgICAgICAgIGRpYWxvZ0FjY291bnQgPSB0cnVlOyAgICAgICAgIH0gICAgICAgfX0gICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF81KGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ29ubmVjdCB0byBob21lIG5vZGUiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0KTsKCQkJfQoJCX0KCX07Cn0KCi8vICgxMzQ6NCkgPEJ1dHRvbiAgICAgICB0eXBlPSJ0b25hbCIgICAgICAgb246Y2xpY2s9eygpID0+IHsgICAgICAgICBpZiAodGxzV2FybmluZ1Nob3duKSB7ICAgICAgICAgICBjb25uZWN0U3dhcm0oKTsgICAgICAgICB9ICAgICAgICAgdGxzV2FybmluZ1Nob3duID0gdHJ1ZTsgICAgICAgfX0gICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF80JDEoY3R4KSB7CglsZXQgdDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCXQgPSB0ZXh0KCJDb25uZWN0Iik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMTQ3OjApIDxEaWFsb2cgYmluZDpvcGVuPXtkaWFsb2dBY2NvdW50fSBoZWFkbGluZT0iU2lnbiBpbiI+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMyQxKGN0eCkgewoJbGV0IGRpdjsKCWxldCB0ZXh0ZmllbGQwOwoJbGV0IHVwZGF0aW5nX3ZhbHVlOwoJbGV0IHQ7CglsZXQgdGV4dGZpZWxkMTsKCWxldCB1cGRhdGluZ192YWx1ZV8xOwoJbGV0IGN1cnJlbnQ7CgoJZnVuY3Rpb24gdGV4dGZpZWxkMF92YWx1ZV9iaW5kaW5nKHZhbHVlKSB7CgkJLyp0ZXh0ZmllbGQwX3ZhbHVlX2JpbmRpbmcqLyBjdHhbMjBdKHZhbHVlKTsKCX0KCglsZXQgdGV4dGZpZWxkMF9wcm9wcyA9IHsgbmFtZTogIkVtYWlsIiB9OwoKCWlmICgvKmVtYWlsKi8gY3R4WzVdICE9PSB2b2lkIDApIHsKCQl0ZXh0ZmllbGQwX3Byb3BzLnZhbHVlID0gLyplbWFpbCovIGN0eFs1XTsKCX0KCgl0ZXh0ZmllbGQwID0gbmV3IFRleHRGaWVsZCQxKHsgcHJvcHM6IHRleHRmaWVsZDBfcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQodGV4dGZpZWxkMCwgJ3ZhbHVlJywgdGV4dGZpZWxkMF92YWx1ZV9iaW5kaW5nKSk7CgoJZnVuY3Rpb24gdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nKHZhbHVlKSB7CgkJLyp0ZXh0ZmllbGQxX3ZhbHVlX2JpbmRpbmcqLyBjdHhbMjFdKHZhbHVlKTsKCX0KCglsZXQgdGV4dGZpZWxkMV9wcm9wcyA9IHsKCQluYW1lOiAiUGFzc3dvcmQiLAoJCWV4dHJhT3B0aW9uczogeyB0eXBlOiAicGFzc3dvcmQiIH0KCX07CgoJaWYgKC8qcGFzc3dvcmQqLyBjdHhbNl0gIT09IHZvaWQgMCkgewoJCXRleHRmaWVsZDFfcHJvcHMudmFsdWUgPSAvKnBhc3N3b3JkKi8gY3R4WzZdOwoJfQoKCXRleHRmaWVsZDEgPSBuZXcgVGV4dEZpZWxkJDEoeyBwcm9wczogdGV4dGZpZWxkMV9wcm9wcyB9KTsKCWJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gYmluZCh0ZXh0ZmllbGQxLCAndmFsdWUnLCB0ZXh0ZmllbGQxX3ZhbHVlX2JpbmRpbmcpKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KHRleHRmaWVsZDAuJCQuZnJhZ21lbnQpOwoJCQl0ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudCh0ZXh0ZmllbGQxLiQkLmZyYWdtZW50KTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJmbGV4IGdhcC00IGZsZXgtY29sIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KHRleHRmaWVsZDAsIGRpdiwgbnVsbCk7CgkJCWFwcGVuZChkaXYsIHQpOwoJCQltb3VudF9jb21wb25lbnQodGV4dGZpZWxkMSwgZGl2LCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgdGV4dGZpZWxkMF9jaGFuZ2VzID0ge307CgoJCQlpZiAoIXVwZGF0aW5nX3ZhbHVlICYmIGRpcnR5WzBdICYgLyplbWFpbCovIDMyKSB7CgkJCQl1cGRhdGluZ192YWx1ZSA9IHRydWU7CgkJCQl0ZXh0ZmllbGQwX2NoYW5nZXMudmFsdWUgPSAvKmVtYWlsKi8gY3R4WzVdOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX3ZhbHVlID0gZmFsc2UpOwoJCQl9CgoJCQl0ZXh0ZmllbGQwLiRzZXQodGV4dGZpZWxkMF9jaGFuZ2VzKTsKCQkJY29uc3QgdGV4dGZpZWxkMV9jaGFuZ2VzID0ge307CgoJCQlpZiAoIXVwZGF0aW5nX3ZhbHVlXzEgJiYgZGlydHlbMF0gJiAvKnBhc3N3b3JkKi8gNjQpIHsKCQkJCXVwZGF0aW5nX3ZhbHVlXzEgPSB0cnVlOwoJCQkJdGV4dGZpZWxkMV9jaGFuZ2VzLnZhbHVlID0gLypwYXNzd29yZCovIGN0eFs2XTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ192YWx1ZV8xID0gZmFsc2UpOwoJCQl9CgoJCQl0ZXh0ZmllbGQxLiRzZXQodGV4dGZpZWxkMV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbih0ZXh0ZmllbGQwLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4odGV4dGZpZWxkMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQodGV4dGZpZWxkMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dCh0ZXh0ZmllbGQxLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudCh0ZXh0ZmllbGQwKTsKCQkJZGVzdHJveV9jb21wb25lbnQodGV4dGZpZWxkMSk7CgkJfQoJfTsKfQoKLy8gKDE1Nzo0KSA8QnV0dG9uIHR5cGU9InRleHQiIG9uOmNsaWNrPXsoKSA9PiAoZGlhbG9nQWNjb3VudCA9IGZhbHNlKX0+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMiQxKGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ2FuY2VsIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMTU4OjQpIDxCdXR0b24gICAgICAgdHlwZT0idGV4dCIgICAgICAgb246Y2xpY2s9e2FzeW5jICgpID0+IHsgICAgICAgICB0cnkgeyAgICAgICAgICAgYXdhaXQgY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7ICAgICAgICAgICBhd2FpdCBjb25uZWN0Tm9kZSgpOyAgICAgICAgIH0gY2F0Y2ggKGUpIHsgICAgICAgICAgIHNuYWNrYmFyKHsgbWVzc2FnZTogZS5tZXNzYWdlLCBjbG9zYWJsZTogdHJ1ZSB9KTsgICAgICAgICB9ICAgICAgIH19ICAgICA+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMSQxKGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiU2lnbiB1cCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDE3MTo0KSA8QnV0dG9uICAgICAgIHR5cGU9InRleHQiICAgICAgIG9uOmNsaWNrPXthc3luYyAoKSA9PiB7ICAgICAgICAgdHJ5IHsgICAgICAgICAgIGF3YWl0IHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7ICAgICAgICAgICBhd2FpdCBjb25uZWN0Tm9kZSgpOyAgICAgICAgIH0gY2F0Y2ggKGUpIHsgICAgICAgICAgIHNuYWNrYmFyKHsgbWVzc2FnZTogZS5tZXNzYWdlLCBjbG9zYWJsZTogdHJ1ZSB9KTsgICAgICAgICB9ICAgICAgIH19ICAgICA+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3QkMShjdHgpIHsKCWxldCB0OwoKCXJldHVybiB7CgkJYygpIHsKCQkJdCA9IHRleHQoIkxvZyBpbiIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDE1NjoyKSA8c3ZlbHRlOmZyYWdtZW50IHNsb3Q9ImJ1dHRvbnMiPgpmdW5jdGlvbiBjcmVhdGVfYnV0dG9uc19zbG90KGN0eCkgewoJbGV0IGJ1dHRvbjA7CglsZXQgdDA7CglsZXQgYnV0dG9uMTsKCWxldCB0MTsKCWxldCBidXR0b24yOwoJbGV0IGN1cnJlbnQ7CgoJYnV0dG9uMCA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAidGV4dCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzIkMV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjAuJG9uKCJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8yKi8gY3R4WzE3XSk7CgoJYnV0dG9uMSA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAidGV4dCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzEkMV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjEuJG9uKCJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8zKi8gY3R4WzE4XSk7CgoJYnV0dG9uMiA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAidGV4dCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90JDFdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglidXR0b24yLiRvbigiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfNCovIGN0eFsxOV0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24wLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KGJ1dHRvbjEuJCQuZnJhZ21lbnQpOwoJCQl0MSA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMi4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24wLCB0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQwLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoYnV0dG9uMSwgdGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MSwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjIsIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgYnV0dG9uMF9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyAxKSB7CgkJCQlidXR0b24wX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24wLiRzZXQoYnV0dG9uMF9jaGFuZ2VzKTsKCQkJY29uc3QgYnV0dG9uMV9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyAxKSB7CgkJCQlidXR0b24xX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24xLiRzZXQoYnV0dG9uMV9jaGFuZ2VzKTsKCQkJY29uc3QgYnV0dG9uMl9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyAxKSB7CgkJCQlidXR0b24yX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24yLiRzZXQoYnV0dG9uMl9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbjIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGJ1dHRvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChidXR0b24yLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0MCk7CgkJCQlkZXRhY2godDEpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24wLCBkZXRhY2hpbmcpOwoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24xLCBkZXRhY2hpbmcpOwoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24yLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCQxKGN0eCkgewoJbGV0IGRpdjI7CglsZXQgaWNvbjsKCWxldCB0MDsKCWxldCBwMDsKCWxldCB0MjsKCWxldCBkaXYwOwoJbGV0IHQzOwoJbGV0IHAxOwoJbGV0IHQ1OwoJbGV0IGRpdjE7CglsZXQgYnV0dG9uMDsKCWxldCB0NjsKCWxldCBidXR0b24xOwoJbGV0IHQ3OwoJbGV0IGRpYWxvZzsKCWxldCB1cGRhdGluZ19vcGVuOwoJbGV0IHQ4OwoJbGV0IHNuYWNrYmFyYW5pbTsKCWxldCB1cGRhdGluZ19zaG93OwoJbGV0IGN1cnJlbnQ7CgoJaWNvbiA9IG5ldyBJY29uKHsKCQkJcHJvcHM6IHsKCQkJCWljb246ICJpYzpyb3VuZC1jYWJsZSIsCgkJCQloZWlnaHQ6IDI0LAoJCQkJY2xhc3M6ICJ0ZXh0LXNlY29uZGFyeSIKCQkJfQoJCX0pOwoKCWxldCBlYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoT2JqZWN0LmVudHJpZXModHJhY2tlcnMpKTsKCWxldCBlYWNoX2Jsb2NrcyA9IFtdOwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkgewoJCWVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2soZ2V0X2VhY2hfY29udGV4dChjdHgsIGVhY2hfdmFsdWUsIGkpKTsKCX0KCgljb25zdCBvdXQgPSBpID0+IHRyYW5zaXRpb25fb3V0KGVhY2hfYmxvY2tzW2ldLCAxLCAxLCAoKSA9PiB7CgkJZWFjaF9ibG9ja3NbaV0gPSBudWxsOwoJfSk7CgoJYnV0dG9uMCA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAidGV4dCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzVdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglidXR0b24wLiRvbigiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXIqLyBjdHhbMTVdKTsKCglidXR0b24xID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJ0b25hbCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzQkMV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjEuJG9uKCJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8xKi8gY3R4WzE2XSk7CgoJZnVuY3Rpb24gZGlhbG9nX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCS8qZGlhbG9nX29wZW5fYmluZGluZyovIGN0eFsyMl0odmFsdWUpOwoJfQoKCWxldCBkaWFsb2dfcHJvcHMgPSB7CgkJaGVhZGxpbmU6ICJTaWduIGluIiwKCQkkJHNsb3RzOiB7CgkJCWJ1dHRvbnM6IFtjcmVhdGVfYnV0dG9uc19zbG90XSwKCQkJZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMyQxXQoJCX0sCgkJJCRzY29wZTogeyBjdHggfQoJfTsKCglpZiAoLypkaWFsb2dBY2NvdW50Ki8gY3R4WzRdICE9PSB2b2lkIDApIHsKCQlkaWFsb2dfcHJvcHMub3BlbiA9IC8qZGlhbG9nQWNjb3VudCovIGN0eFs0XTsKCX0KCglkaWFsb2cgPSBuZXcgRGlhbG9nJDEoeyBwcm9wczogZGlhbG9nX3Byb3BzIH0pOwoJYmluZGluZ19jYWxsYmFja3MucHVzaCgoKSA9PiBiaW5kKGRpYWxvZywgJ29wZW4nLCBkaWFsb2dfb3Blbl9iaW5kaW5nKSk7CgoJZnVuY3Rpb24gc25hY2tiYXJhbmltX3Nob3dfYmluZGluZyh2YWx1ZSkgewoJCS8qc25hY2tiYXJhbmltX3Nob3dfYmluZGluZyovIGN0eFsyM10odmFsdWUpOwoJfQoKCWxldCBzbmFja2JhcmFuaW1fcHJvcHMgPSB7fTsKCglpZiAoLypzbmFja2JhciovIGN0eFs3XSAhPT0gdm9pZCAwKSB7CgkJc25hY2tiYXJhbmltX3Byb3BzLnNob3cgPSAvKnNuYWNrYmFyKi8gY3R4WzddOwoJfQoKCXNuYWNrYmFyYW5pbSA9IG5ldyBTbmFja2JhckFuaW0kMSh7IHByb3BzOiBzbmFja2JhcmFuaW1fcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQoc25hY2tiYXJhbmltLCAnc2hvdycsIHNuYWNrYmFyYW5pbV9zaG93X2JpbmRpbmcpKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjIgPSBlbGVtZW50KCJkaXYiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQlwMCA9IGVsZW1lbnQoInAiKTsKCQkJcDAudGV4dENvbnRlbnQgPSAiQ29ubmVjdCB0byBhIHRyYWNrZXIiOwoJCQl0MiA9IHNwYWNlKCk7CgkJCWRpdjAgPSBlbGVtZW50KCJkaXYiKTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHsKCQkJCWVhY2hfYmxvY2tzW2ldLmMoKTsKCQkJfQoKCQkJdDMgPSBzcGFjZSgpOwoJCQlwMSA9IGVsZW1lbnQoInAiKTsKCQkJcDEudGV4dENvbnRlbnQgPSAiWW91ciBkYXRhIGlzIG5vdCBlbmQtdG8tZW5kIGVuY3J5cHRlZCwgYW5kIHdpbGwgbm90IGJlIHByaXZhdGUuIFdoaWxlIFRMU1xuICAgIHdpbGwgYmUgaW1wbGVtZW50ZWQgbGF0ZXIsIGZvciBub3cgZG8gbm90IGVudGVyIGFueSBwcml2YXRlIGluZm9ybWF0aW9uLlxuICAgIENsaWNrIGNvbm5lY3QgYWdhaW4gdG8gY29udGludWUuIjsKCQkJdDUgPSBzcGFjZSgpOwoJCQlkaXYxID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMC4kJC5mcmFnbWVudCk7CgkJCXQ2ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24xLiQkLmZyYWdtZW50KTsKCQkJdDcgPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KGRpYWxvZy4kJC5mcmFnbWVudCk7CgkJCXQ4ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChzbmFja2JhcmFuaW0uJCQuZnJhZ21lbnQpOwoJCQlhdHRyKHAwLCAiY2xhc3MiLCAibTMtZm9udC1oZWFkbGluZS1zbWFsbCIpOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJmbGV4IGZsZXgtY29sIHctZnVsbCAtbXgtNCIpOwoJCQlhdHRyKHAxLCAiY2xhc3MiLCAidGxzLXdhcm5pbmcgbXQtNCBzdmVsdGUtMWZsbjB6ayIpOwoJCQl0b2dnbGVfY2xhc3MocDEsICJoaWRkZW4iLCAhLyp0bHNXYXJuaW5nU2hvd24qLyBjdHhbMF0pOwoJCQlhdHRyKGRpdjEsICJjbGFzcyIsICJmbGV4IGdhcC0yIGl0ZW1zLWNlbnRlciBtdC0yIHB4LTYiKTsKCQkJYXR0cihkaXYyLCAiY2xhc3MiLCAidmVydGljYWwtY29udGFpbmVyIG0tYXV0byByb3VuZGVkLTJ4bCBiZy1zdXJmYWNlLWNvbnRhaW5lci1oaWdoIHAtNiBzdmVsdGUtMWZsbjB6ayIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYyLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbiwgZGl2MiwgbnVsbCk7CgkJCWFwcGVuZChkaXYyLCB0MCk7CgkJCWFwcGVuZChkaXYyLCBwMCk7CgkJCWFwcGVuZChkaXYyLCB0Mik7CgkJCWFwcGVuZChkaXYyLCBkaXYwKTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHsKCQkJCWlmIChlYWNoX2Jsb2Nrc1tpXSkgewoJCQkJCWVhY2hfYmxvY2tzW2ldLm0oZGl2MCwgbnVsbCk7CgkJCQl9CgkJCX0KCgkJCWFwcGVuZChkaXYyLCB0Myk7CgkJCWFwcGVuZChkaXYyLCBwMSk7CgkJCWFwcGVuZChkaXYyLCB0NSk7CgkJCWFwcGVuZChkaXYyLCBkaXYxKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjAsIGRpdjEsIG51bGwpOwoJCQlhcHBlbmQoZGl2MSwgdDYpOwoJCQltb3VudF9jb21wb25lbnQoYnV0dG9uMSwgZGl2MSwgbnVsbCk7CgkJCWluc2VydCh0YXJnZXQsIHQ3LCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoZGlhbG9nLCB0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQ4LCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoc25hY2tiYXJhbmltLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChkaXJ0eVswXSAmIC8qdHJhY2tlclN0YXRzLCBzZWxlY3RlZFRyYWNrZXIqLyA2KSB7CgkJCQllYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoT2JqZWN0LmVudHJpZXModHJhY2tlcnMpKTsKCQkJCWxldCBpOwoKCQkJCWZvciAoaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJY29uc3QgY2hpbGRfY3R4ID0gZ2V0X2VhY2hfY29udGV4dChjdHgsIGVhY2hfdmFsdWUsIGkpOwoKCQkJCQlpZiAoZWFjaF9ibG9ja3NbaV0pIHsKCQkJCQkJZWFjaF9ibG9ja3NbaV0ucChjaGlsZF9jdHgsIGRpcnR5KTsKCQkJCQkJdHJhbnNpdGlvbl9pbihlYWNoX2Jsb2Nrc1tpXSwgMSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayhjaGlsZF9jdHgpOwoJCQkJCQllYWNoX2Jsb2Nrc1tpXS5jKCk7CgkJCQkJCXRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0sIDEpOwoJCQkJCQllYWNoX2Jsb2Nrc1tpXS5tKGRpdjAsIG51bGwpOwoJCQkJCX0KCQkJCX0KCgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQlmb3IgKGkgPSBlYWNoX3ZhbHVlLmxlbmd0aDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJb3V0KGkpOwoJCQkJfQoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgoJCQlpZiAoIWN1cnJlbnQgfHwgZGlydHlbMF0gJiAvKnRsc1dhcm5pbmdTaG93biovIDEpIHsKCQkJCXRvZ2dsZV9jbGFzcyhwMSwgImhpZGRlbiIsICEvKnRsc1dhcm5pbmdTaG93biovIGN0eFswXSk7CgkJCX0KCgkJCWNvbnN0IGJ1dHRvbjBfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gMSkgewoJCQkJYnV0dG9uMF9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJYnV0dG9uMC4kc2V0KGJ1dHRvbjBfY2hhbmdlcyk7CgkJCWNvbnN0IGJ1dHRvbjFfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gMSkgewoJCQkJYnV0dG9uMV9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJYnV0dG9uMS4kc2V0KGJ1dHRvbjFfY2hhbmdlcyk7CgkJCWNvbnN0IGRpYWxvZ19jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMF0gJiAvKmF1dGgsIGVtYWlsLCBwYXNzd29yZCwgc25hY2tiYXIsIGRpYWxvZ0FjY291bnQqLyAyNDggfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDEpIHsKCQkJCWRpYWxvZ19jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJaWYgKCF1cGRhdGluZ19vcGVuICYmIGRpcnR5WzBdICYgLypkaWFsb2dBY2NvdW50Ki8gMTYpIHsKCQkJCXVwZGF0aW5nX29wZW4gPSB0cnVlOwoJCQkJZGlhbG9nX2NoYW5nZXMub3BlbiA9IC8qZGlhbG9nQWNjb3VudCovIGN0eFs0XTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ19vcGVuID0gZmFsc2UpOwoJCQl9CgoJCQlkaWFsb2cuJHNldChkaWFsb2dfY2hhbmdlcyk7CgkJCWNvbnN0IHNuYWNrYmFyYW5pbV9jaGFuZ2VzID0ge307CgoJCQlpZiAoIXVwZGF0aW5nX3Nob3cgJiYgZGlydHlbMF0gJiAvKnNuYWNrYmFyKi8gMTI4KSB7CgkJCQl1cGRhdGluZ19zaG93ID0gdHJ1ZTsKCQkJCXNuYWNrYmFyYW5pbV9jaGFuZ2VzLnNob3cgPSAvKnNuYWNrYmFyKi8gY3R4WzddOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX3Nob3cgPSBmYWxzZSk7CgkJCX0KCgkJCXNuYWNrYmFyYW5pbS4kc2V0KHNuYWNrYmFyYW5pbV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfdmFsdWUubGVuZ3RoOyBpICs9IDEpIHsKCQkJCXRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0pOwoJCQl9CgoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oZGlhbG9nLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oc25hY2tiYXJhbmltLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWVhY2hfYmxvY2tzID0gZWFjaF9ibG9ja3MuZmlsdGVyKEJvb2xlYW4pOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQkJdHJhbnNpdGlvbl9vdXQoZWFjaF9ibG9ja3NbaV0pOwoJCQl9CgoJCQl0cmFuc2l0aW9uX291dChidXR0b24wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGJ1dHRvbjEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoZGlhbG9nLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KHNuYWNrYmFyYW5pbS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2Mik7CgkJCQlkZXRhY2godDcpOwoJCQkJZGV0YWNoKHQ4KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbik7CgkJCWRlc3Ryb3lfZWFjaChlYWNoX2Jsb2NrcywgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMCk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGJ1dHRvbjEpOwoJCQlkZXN0cm95X2NvbXBvbmVudChkaWFsb2csIGRldGFjaGluZyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KHNuYWNrYmFyYW5pbSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQxKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgdGxzV2FybmluZ1Nob3duID0gZmFsc2U7CglsZXQgc2VsZWN0ZWRUcmFja2VyID0gT2JqZWN0LmtleXModHJhY2tlcnMpWzBdOwoJbGV0IHRyYWNrZXJTdGF0cyA9IHt9OwoKCWNvbnN0IGdldFN0YXRzID0gYXN5bmMgdHJhY2tlciA9PiB7CgkJY29uc3QgdXJsID0gbmV3IFVSTChgJHt0cmFja2VyLnRyYWNrZXJ9L3N0YXRzYCk7CgkJdXJsLnByb3RvY29sID0gImh0dHBzOi8vIjsKCQljb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsKTsKCQlyZXR1cm4gYXdhaXQgcmVzcC5qc29uKCk7Cgl9OwoKCU9iamVjdC5lbnRyaWVzKHRyYWNrZXJzKS5tYXAoYXN5bmMgKFt0cmFja2VySWQsIHRyYWNrZXJdKSA9PiB7CgkJY29uc3Qgc3RhdHMgPSBhd2FpdCBnZXRTdGF0cyh0cmFja2VyKTsKCQkkJGludmFsaWRhdGUoMiwgdHJhY2tlclN0YXRzW3RyYWNrZXJJZF0gPSBzdGF0cywgdHJhY2tlclN0YXRzKTsKCX0pOwoKCWxldCB7IHN0YXRlIH0gPSAkJHByb3BzOwoJbGV0IHsgc3RhdGVTdHIgfSA9ICQkcHJvcHM7CglsZXQgYXV0aDsKCWxldCB0cmFuc3BvcnQ7CgoJZnVuY3Rpb24gY3JlYXRlUlRDVHJhbnNwb3J0KCkgewoJCXJldHVybiBuZXcgUlRDVHJhbnNwb3J0KGFzeW5jICgpID0+IHsKCQkJCSQkaW52YWxpZGF0ZSgxMiwgc3RhdGVTdHIgPSAiVHJhbnNwb3J0IG9wZW5lZCIpOwoJCQkJY29uc29sZS5sb2coIltUUkFOU1BPUlRdIG9wZW5lZCIpOwoJCQkJY29uc3QgY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uJDEodHJhbnNwb3J0KTsKCQkJCWF3YWl0IGNvbm5lY3Rpb24uaW5pdGlhbGl6ZSgpOwoJCQkJY29uc3QgYmFyZSA9IG5ldyBBZHJpZnRCYXJlQ2xpZW50KGNvbm5lY3Rpb24pOwoJCQkJc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEoYmFyZSk7CgkJCQkkJGludmFsaWRhdGUoMTEsIHN0YXRlID0gVUlTdGF0ZS5Db25uZWN0ZWQpOwoJCQl9LAoJCSgpID0+IGNvbnNvbGUud2FybigiW1RSQU5TUE9SVF0gY2xvc2VkIiksCgkJKCkgPT4gewoJCQkJJCRpbnZhbGlkYXRlKDEyLCBzdGF0ZVN0ciA9IGBDb25uZWN0aW9uICR7dHJhbnNwb3J0LnBlZXIuY29ubmVjdGlvblN0YXRlfS4uLmApOwoJCQl9LAoJCSgpID0+IHsKCQkJCSQkaW52YWxpZGF0ZSgxMiwgc3RhdGVTdHIgPSBgU2lnbmFsaW5nICR7dHJhbnNwb3J0LnBlZXIuY29ubmVjdGlvblN0YXRlfS4uLmApOwoJCQl9LAoJCSgpID0+IHsKCQkJCWlmICh0cmFuc3BvcnQucGVlci5jb25uZWN0aW9uU3RhdGUgPT0gIm5ldyIpIHsKCQkJCQkkJGludmFsaWRhdGUoMTIsIHN0YXRlU3RyID0gYENyZWF0aW5nIGFuIG9mZmVyLi4uYCk7CgkJCQl9IGVsc2UgewoJCQkJCSQkaW52YWxpZGF0ZSgxMiwgc3RhdGVTdHIgPSBgR2F0aGVyaW5nICR7dHJhbnNwb3J0LnBlZXIuY29ubmVjdGlvblN0YXRlfS4uLmApOwoJCQkJfQoJCQl9KTsKCX0KCglmdW5jdGlvbiBjb25uZWN0VG9BcHAodHJhY2tlcikgewoJCWluaXRpYWxpemVBcHAodHJhY2tlci5maXJlYmFzZSk7CgkJJCRpbnZhbGlkYXRlKDMsIGF1dGggPSBnZXRBdXRoKCkpOwoJfQoKCWFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RTd2FybSgpIHsKCQljb25uZWN0VG9BcHAodHJhY2tlcnNbc2VsZWN0ZWRUcmFja2VyXSk7CgkJJCRpbnZhbGlkYXRlKDExLCBzdGF0ZSA9IFVJU3RhdGUuQ29ubmVjdGluZyk7CgkJdHJhbnNwb3J0ID0gY3JlYXRlUlRDVHJhbnNwb3J0KCk7CgkJY29uc3Qgb2ZmZXIgPSBhd2FpdCB0cmFuc3BvcnQuY3JlYXRlT2ZmZXIoKTsKCQkkJGludmFsaWRhdGUoMTIsIHN0YXRlU3RyID0gIkZpbmRpbmcgYSBub2RlLi4uIik7CgoJCXRyeSB7CgkJCWNvbnN0IGFuc3dlciA9IGF3YWl0IHNpZ25hbFN3YXJtKEpTT04uc3RyaW5naWZ5KG9mZmVyKSk7CgkJCSQkaW52YWxpZGF0ZSgxMiwgc3RhdGVTdHIgPSAiTGlua2luZyB0byB0aGUgbm9kZS4uLiIpOwoJCQl0cmFuc3BvcnQuYW5zd2VyKGFuc3dlci5hbnN3ZXIsIGFuc3dlci5jYW5kaWRhdGVzKTsKCQl9IGNhdGNoKGUpIHsKCQkJY29uc29sZS5lcnJvcigiV2hpbGUgY29ubmVjdGluZyB0byBzd2FybSIsIGUpOwoJCQkkJGludmFsaWRhdGUoMTIsIHN0YXRlU3RyID0gZSk7CgkJfQoJfQoKCWxldCBkaWFsb2dBY2NvdW50ID0gZmFsc2U7CglsZXQgZW1haWwgPSAiIjsKCWxldCBwYXNzd29yZCA9ICIiOwoJbGV0IHNuYWNrYmFyOwoKCWFzeW5jIGZ1bmN0aW9uIGNvbm5lY3ROb2RlKCkgewoJCSQkaW52YWxpZGF0ZSgxMSwgc3RhdGUgPSBVSVN0YXRlLkNvbm5lY3RpbmcpOwoJCXRyYW5zcG9ydCA9IGNyZWF0ZVJUQ1RyYW5zcG9ydCgpOwoJCWNvbnN0IG9mZmVyID0gYXdhaXQgdHJhbnNwb3J0LmNyZWF0ZU9mZmVyKCk7CgkJJCRpbnZhbGlkYXRlKDEyLCBzdGF0ZVN0ciA9ICJGaW5kaW5nIHlvdXIgbm9kZS4uLiIpOwoJCWxldCBhbnN3ZXIgPSBhd2FpdCBzaWduYWxBY2NvdW50KEpTT04uc3RyaW5naWZ5KG9mZmVyKSk7CgkJJCRpbnZhbGlkYXRlKDEyLCBzdGF0ZVN0ciA9ICJMaW5raW5nIHRvIHRoZSBub2RlLi4uIik7CgkJdHJhbnNwb3J0LmFuc3dlcihhbnN3ZXIuYW5zd2VyLCBhbnN3ZXIuY2FuZGlkYXRlcyk7Cgl9CgoJY29uc3QgJCRiaW5kaW5nX2dyb3VwcyA9IFtbXV07CgoJZnVuY3Rpb24gaW5wdXRfY2hhbmdlX2hhbmRsZXIoKSB7CgkJc2VsZWN0ZWRUcmFja2VyID0gdGhpcy5fX3ZhbHVlOwoJCSQkaW52YWxpZGF0ZSgxLCBzZWxlY3RlZFRyYWNrZXIpOwoJfQoKCWNvbnN0IGNsaWNrX2hhbmRsZXIgPSAoKSA9PiB7CgkJY29ubmVjdFRvQXBwKHRyYWNrZXJzW3NlbGVjdGVkVHJhY2tlcl0pOwoJCXNldFBlcnNpc3RlbmNlKGF1dGgsIGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlKTsKCQljb25zb2xlLmxvZyhicm93c2VyTG9jYWxQZXJzaXN0ZW5jZSwgYXV0aC5jdXJyZW50VXNlcik7CgoJCWlmIChhdXRoLmN1cnJlbnRVc2VyKSB7CgkJCWNvbm5lY3ROb2RlKCk7CgkJfSBlbHNlIHsKCQkJJCRpbnZhbGlkYXRlKDQsIGRpYWxvZ0FjY291bnQgPSB0cnVlKTsKCQl9Cgl9OwoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfMSA9ICgpID0+IHsKCQlpZiAodGxzV2FybmluZ1Nob3duKSB7CgkJCWNvbm5lY3RTd2FybSgpOwoJCX0KCgkJJCRpbnZhbGlkYXRlKDAsIHRsc1dhcm5pbmdTaG93biA9IHRydWUpOwoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyXzIgPSAoKSA9PiAkJGludmFsaWRhdGUoNCwgZGlhbG9nQWNjb3VudCA9IGZhbHNlKTsKCgljb25zdCBjbGlja19oYW5kbGVyXzMgPSBhc3luYyAoKSA9PiB7CgkJdHJ5IHsKCQkJYXdhaXQgY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7CgkJCWF3YWl0IGNvbm5lY3ROb2RlKCk7CgkJfSBjYXRjaChlKSB7CgkJCXNuYWNrYmFyKHsgbWVzc2FnZTogZS5tZXNzYWdlLCBjbG9zYWJsZTogdHJ1ZSB9KTsKCQl9Cgl9OwoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfNCA9IGFzeW5jICgpID0+IHsKCQl0cnkgewoJCQlhd2FpdCBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpOwoJCQlhd2FpdCBjb25uZWN0Tm9kZSgpOwoJCX0gY2F0Y2goZSkgewoJCQlzbmFja2Jhcih7IG1lc3NhZ2U6IGUubWVzc2FnZSwgY2xvc2FibGU6IHRydWUgfSk7CgkJfQoJfTsKCglmdW5jdGlvbiB0ZXh0ZmllbGQwX3ZhbHVlX2JpbmRpbmcodmFsdWUpIHsKCQllbWFpbCA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg1LCBlbWFpbCk7Cgl9CgoJZnVuY3Rpb24gdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nKHZhbHVlKSB7CgkJcGFzc3dvcmQgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoNiwgcGFzc3dvcmQpOwoJfQoKCWZ1bmN0aW9uIGRpYWxvZ19vcGVuX2JpbmRpbmcodmFsdWUpIHsKCQlkaWFsb2dBY2NvdW50ID0gdmFsdWU7CgkJJCRpbnZhbGlkYXRlKDQsIGRpYWxvZ0FjY291bnQpOwoJfQoKCWZ1bmN0aW9uIHNuYWNrYmFyYW5pbV9zaG93X2JpbmRpbmcodmFsdWUpIHsKCQlzbmFja2JhciA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg3LCBzbmFja2Jhcik7Cgl9CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdzdGF0ZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDExLCBzdGF0ZSA9ICQkcHJvcHMuc3RhdGUpOwoJCWlmICgnc3RhdGVTdHInIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxMiwgc3RhdGVTdHIgPSAkJHByb3BzLnN0YXRlU3RyKTsKCX07CgoJcmV0dXJuIFsKCQl0bHNXYXJuaW5nU2hvd24sCgkJc2VsZWN0ZWRUcmFja2VyLAoJCXRyYWNrZXJTdGF0cywKCQlhdXRoLAoJCWRpYWxvZ0FjY291bnQsCgkJZW1haWwsCgkJcGFzc3dvcmQsCgkJc25hY2tiYXIsCgkJY29ubmVjdFRvQXBwLAoJCWNvbm5lY3RTd2FybSwKCQljb25uZWN0Tm9kZSwKCQlzdGF0ZSwKCQlzdGF0ZVN0ciwKCQlpbnB1dF9jaGFuZ2VfaGFuZGxlciwKCQkkJGJpbmRpbmdfZ3JvdXBzLAoJCWNsaWNrX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl8xLAoJCWNsaWNrX2hhbmRsZXJfMiwKCQljbGlja19oYW5kbGVyXzMsCgkJY2xpY2tfaGFuZGxlcl80LAoJCXRleHRmaWVsZDBfdmFsdWVfYmluZGluZywKCQl0ZXh0ZmllbGQxX3ZhbHVlX2JpbmRpbmcsCgkJZGlhbG9nX29wZW5fYmluZGluZywKCQlzbmFja2JhcmFuaW1fc2hvd19iaW5kaW5nCgldOwp9CgpjbGFzcyBDb25uZWN0aW9uXzEgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewoJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCXN1cGVyKCk7CgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQxLCBjcmVhdGVfZnJhZ21lbnQkMSwgc2FmZV9ub3RfZXF1YWwsIHsgc3RhdGU6IDExLCBzdGF0ZVN0cjogMTIgfSwgbnVsbCwgWy0xLCAtMV0pOwoJfQp9Cgpjb25zdCBBcHBfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIHNyYy9BcHAuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZWxzZV9ibG9jayhjdHgpIHsKCWxldCBkaXY0OwoJbGV0IGRpdjM7CglsZXQgZGl2MDsKCWxldCBpY29uOwoJbGV0IHQwOwoJbGV0IHAwOwoJbGV0IHQyOwoJbGV0IGRpdjE7CglsZXQgdDQ7CglsZXQgZGl2MjsKCWxldCB0NTsKCWxldCBjb25uZWN0aW9uY21wOwoJbGV0IHVwZGF0aW5nX3N0YXRlOwoJbGV0IHVwZGF0aW5nX3N0YXRlU3RyOwoJbGV0IHQ2OwoJbGV0IGNhcmQ7CglsZXQgY3VycmVudDsKCglpY29uID0gbmV3IEljb24oewoJCQlwcm9wczogeyBpY29uOiAibWF0ZXJpYWwtc3ltYm9sczpzYWlsaW5nIiB9CgkJfSk7CgoJbGV0IGlmX2Jsb2NrID0gISIxIiA7CgoJZnVuY3Rpb24gY29ubmVjdGlvbmNtcF9zdGF0ZV9iaW5kaW5nKHZhbHVlKSB7CgkJLypjb25uZWN0aW9uY21wX3N0YXRlX2JpbmRpbmcqLyBjdHhbNV0odmFsdWUpOwoJfQoKCWZ1bmN0aW9uIGNvbm5lY3Rpb25jbXBfc3RhdGVTdHJfYmluZGluZyh2YWx1ZSkgewoJCS8qY29ubmVjdGlvbmNtcF9zdGF0ZVN0cl9iaW5kaW5nKi8gY3R4WzZdKHZhbHVlKTsKCX0KCglsZXQgY29ubmVjdGlvbmNtcF9wcm9wcyA9IHt9OwoKCWlmICgvKnN0YXRlKi8gY3R4WzBdICE9PSB2b2lkIDApIHsKCQljb25uZWN0aW9uY21wX3Byb3BzLnN0YXRlID0gLypzdGF0ZSovIGN0eFswXTsKCX0KCglpZiAoLypzdGF0ZVN0ciovIGN0eFsxXSAhPT0gdm9pZCAwKSB7CgkJY29ubmVjdGlvbmNtcF9wcm9wcy5zdGF0ZVN0ciA9IC8qc3RhdGVTdHIqLyBjdHhbMV07Cgl9CgoJY29ubmVjdGlvbmNtcCA9IG5ldyBDb25uZWN0aW9uXzEoeyBwcm9wczogY29ubmVjdGlvbmNtcF9wcm9wcyB9KTsKCWJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gYmluZChjb25uZWN0aW9uY21wLCAnc3RhdGUnLCBjb25uZWN0aW9uY21wX3N0YXRlX2JpbmRpbmcpKTsKCWJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gYmluZChjb25uZWN0aW9uY21wLCAnc3RhdGVTdHInLCBjb25uZWN0aW9uY21wX3N0YXRlU3RyX2JpbmRpbmcpKTsKCgljYXJkID0gbmV3IENhcmQkMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAiZWxldmF0ZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF80XSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXY0ID0gZWxlbWVudCgiZGl2Iik7CgkJCWRpdjMgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24uJCQuZnJhZ21lbnQpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCXAwID0gZWxlbWVudCgicCIpOwoJCQlwMC50ZXh0Q29udGVudCA9ICJBZHJpZnQiOwoJCQl0MiA9IHNwYWNlKCk7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MS5pbm5lckhUTUwgPSBgPHAgY2xhc3M9InNtOnRleHQteGwgbGc6dGV4dC14bCI+QSBmYXN0IGFuZCBtb2Rlcm4gZGVjZW50cmFsaXplZCBwcm94eSBuZXR3b3JrPC9wPmA7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJZGl2MiA9IGVsZW1lbnQoImRpdiIpOwoJCQl0NSA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQoY29ubmVjdGlvbmNtcC4kJC5mcmFnbWVudCk7CgkJCXQ2ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChjYXJkLiQkLmZyYWdtZW50KTsKCQkJYXR0cihkaXYwLCAiY2xhc3MiLCAiZmxleCBnYXAtMiB0ZXh0LTJ4bCIpOwoJCQlhdHRyKGRpdjEsICJjbGFzcyIsICJmbGV4IGZsZXgtY29sIHRleHQtY2VudGVyIGp1c3RpZnktZW5kIHB4LTIiKTsKCQkJYXR0cihkaXYyLCAiY2xhc3MiLCAiIik7CgkJCWF0dHIoZGl2MywgImNsYXNzIiwgImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciIpOwoJCQlhdHRyKGRpdjQsICJjbGFzcyIsICJoLWZ1bGwgZmxleCBmbGV4LWNvbCBwLTYgZ2FwLTYganVzdGlmeS1jZW50ZXIiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2NCwgYW5jaG9yKTsKCQkJYXBwZW5kKGRpdjQsIGRpdjMpOwoJCQlhcHBlbmQoZGl2MywgZGl2MCk7CgkJCW1vdW50X2NvbXBvbmVudChpY29uLCBkaXYwLCBudWxsKTsKCQkJYXBwZW5kKGRpdjAsIHQwKTsKCQkJYXBwZW5kKGRpdjAsIHAwKTsKCQkJYXBwZW5kKGRpdjMsIHQyKTsKCQkJYXBwZW5kKGRpdjMsIGRpdjEpOwoJCQlhcHBlbmQoZGl2MywgdDQpOwoJCQlhcHBlbmQoZGl2MywgZGl2Mik7CgkJCWFwcGVuZChkaXY0LCB0NSk7CgkJCW1vdW50X2NvbXBvbmVudChjb25uZWN0aW9uY21wLCBkaXY0LCBudWxsKTsKCQkJYXBwZW5kKGRpdjQsIHQ2KTsKCQkJbW91bnRfY29tcG9uZW50KGNhcmQsIGRpdjQsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBjb25uZWN0aW9uY21wX2NoYW5nZXMgPSB7fTsKCgkJCWlmICghdXBkYXRpbmdfc3RhdGUgJiYgZGlydHkgJiAvKnN0YXRlKi8gMSkgewoJCQkJdXBkYXRpbmdfc3RhdGUgPSB0cnVlOwoJCQkJY29ubmVjdGlvbmNtcF9jaGFuZ2VzLnN0YXRlID0gLypzdGF0ZSovIGN0eFswXTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ19zdGF0ZSA9IGZhbHNlKTsKCQkJfQoKCQkJaWYgKCF1cGRhdGluZ19zdGF0ZVN0ciAmJiBkaXJ0eSAmIC8qc3RhdGVTdHIqLyAyKSB7CgkJCQl1cGRhdGluZ19zdGF0ZVN0ciA9IHRydWU7CgkJCQljb25uZWN0aW9uY21wX2NoYW5nZXMuc3RhdGVTdHIgPSAvKnN0YXRlU3RyKi8gY3R4WzFdOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX3N0YXRlU3RyID0gZmFsc2UpOwoJCQl9CgoJCQljb25uZWN0aW9uY21wLiRzZXQoY29ubmVjdGlvbmNtcF9jaGFuZ2VzKTsKCQkJY29uc3QgY2FyZF9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHkgJiAvKiQkc2NvcGUqLyA1MTIpIHsKCQkJCWNhcmRfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWNhcmQuJHNldChjYXJkX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25faW4oY29ubmVjdGlvbmNtcC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2spOwoJCQl0cmFuc2l0aW9uX291dChjb25uZWN0aW9uY21wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjQpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uKTsKCQkJZGVzdHJveV9jb21wb25lbnQoY29ubmVjdGlvbmNtcCk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGNhcmQpOwoJCX0KCX07Cn0KCi8vICg3Mzo0MikgCmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9ja18yKGN0eCkgewoJbGV0IGRpdjsKCWxldCBjYXJkOwoJbGV0IGN1cnJlbnQ7CgoJY2FyZCA9IG5ldyBDYXJkJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogIm91dGxpbmVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoY2FyZC4kJC5mcmFnbWVudCk7CgkJCWF0dHIoZGl2LCAiY2xhc3MiLCAiaC1mdWxsIGZsZXgganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGNhcmQsIGRpdiwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IGNhcmRfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5ICYgLyokJHNjb3BlKi8gNTEyKSB7CgkJCQljYXJkX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQljYXJkLiRzZXQoY2FyZF9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihjYXJkLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChjYXJkLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChjYXJkKTsKCQl9Cgl9Owp9CgovLyAoNTk6MzgpIApmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMShjdHgpIHsKCWxldCBkaXY7CglsZXQgY2FyZDsKCWxldCBjdXJyZW50OwoKCWNhcmQgPSBuZXcgQ2FyZCQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJvdXRsaW5lZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChjYXJkLiQkLmZyYWdtZW50KTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJoLWZ1bGwgZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoY2FyZCwgZGl2LCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgY2FyZF9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHkgJiAvKiQkc2NvcGUsIHN0YXRlU3RyKi8gNTE0KSB7CgkJCQljYXJkX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQljYXJkLiRzZXQoY2FyZF9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihjYXJkLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChjYXJkLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChjYXJkKTsKCQl9Cgl9Owp9CgovLyAoNTc6MCkgeyNpZiBzdGF0ZSA9PSBVSVN0YXRlLkNvbm5lY3RlZH0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrKGN0eCkgewoJbGV0IHByb3h5OwoJbGV0IGN1cnJlbnQ7Cglwcm94eSA9IG5ldyBQcm94eSQxKHt9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQocHJveHkuJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQocHJveHksIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwOiBub29wJDQsCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKHByb3h5LiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChwcm94eS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChwcm94eSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMTExOjQpIDxDYXJkIHR5cGU9ImVsZXZhdGVkIj4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF80KGN0eCkgewoJbGV0IGRpdjsKCWxldCBhMDsKCWxldCB0MTsKCWxldCBhMTsKCWxldCBpY29uMDsKCWxldCB0MjsKCWxldCBhMjsKCWxldCBpY29uMTsKCWxldCBjdXJyZW50OwoJaWNvbjAgPSBuZXcgSWNvbih7IHByb3BzOiB7IGljb246ICJpYzpyb3VuZC1kaXNjb3JkIiB9IH0pOwoJaWNvbjEgPSBuZXcgSWNvbih7IHByb3BzOiB7IGljb246ICJtZGk6Z2l0aHViIiB9IH0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWEwID0gZWxlbWVudCgiYSIpOwoJCQlhMC50ZXh0Q29udGVudCA9ICLCqSAyMDIzIE1lcmN1cnkgV29ya3Nob3AiOwoJCQl0MSA9IHNwYWNlKCk7CgkJCWExID0gZWxlbWVudCgiYSIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24wLiQkLmZyYWdtZW50KTsKCQkJdDIgPSBzcGFjZSgpOwoJCQlhMiA9IGVsZW1lbnQoImEiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMS4kJC5mcmFnbWVudCk7CgkJCWF0dHIoYTAsICJjbGFzcyIsICJtci1hdXRvIik7CgkJCWF0dHIoYTAsICJocmVmIiwgImh0dHBzOi8vbWVyY3VyeXdvcmsuc2hvcCIpOwoJCQlhdHRyKGExLCAiaHJlZiIsICJodHRwczovL2Rpc2NvcmQuZ2cvYkFnTnlHcFhTeCIpOwoJCQlhdHRyKGExLCAiY2xhc3MiLCAidGV4dC0yeGwiKTsKCQkJYXR0cihhMiwgImhyZWYiLCAiaHR0cHM6Ly9naXRodWIuY29tL01lcmN1cnlXb3Jrc2hvcC9hZHJpZnQiKTsKCQkJYXR0cihhMiwgImNsYXNzIiwgInRleHQtMnhsIik7CgkJCWF0dHIoZGl2LCAiY2xhc3MiLCAiZmxleCBnYXAtOCBpdGVtcy1jZW50ZXIiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoJCQlhcHBlbmQoZGl2LCBhMCk7CgkJCWFwcGVuZChkaXYsIHQxKTsKCQkJYXBwZW5kKGRpdiwgYTEpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjAsIGExLCBudWxsKTsKCQkJYXBwZW5kKGRpdiwgdDIpOwoJCQlhcHBlbmQoZGl2LCBhMik7CgkJCW1vdW50X2NvbXBvbmVudChpY29uMSwgYTIsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXA6IG5vb3AkNCwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihpY29uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbjEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGljb24wKTsKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbjEpOwoJCX0KCX07Cn0KCi8vICg3ODo4KSA8QnV0dG9uIHR5cGU9ImZpbGxlZCIgb246Y2xpY2s9e2Nvbm5lY3REZXZIdHRwfT4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8zKGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ29ubmVjdCB3aXRoIGxvY2FsaG9zdCBXZWJSVEMgdHJhbnNwb3J0IG92ZXIgSFRUUCBzaWduYWxpbmciKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0KTsKCQkJfQoJCX0KCX07Cn0KCi8vICg4MTo4KSA8QnV0dG9uIHR5cGU9ImZpbGxlZCIgb246Y2xpY2s9e2Nvbm5lY3REZXZXU30+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMihjdHgpIHsKCWxldCB0OwoKCXJldHVybiB7CgkJYygpIHsKCQkJdCA9IHRleHQoIkNvbm5lY3Qgd2l0aCBsb2NhbGhvc3Qgd2Vic29ja2V0IHRyYW5zcG9ydCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDc1OjQpIDxDYXJkIHR5cGU9Im91dGxpbmVkIj4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8xKGN0eCkgewoJbGV0IGgyOwoJbGV0IHQxOwoJbGV0IGRpdjsKCWxldCBidXR0b24wOwoJbGV0IHQyOwoJbGV0IGJ1dHRvbjE7CglsZXQgY3VycmVudDsKCglidXR0b24wID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJmaWxsZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF8zXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMC4kb24oImNsaWNrIiwgLypjb25uZWN0RGV2SHR0cCovIGN0eFsyXSk7CgoJYnV0dG9uMSA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAiZmlsbGVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMl0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjEuJG9uKCJjbGljayIsIC8qY29ubmVjdERldldTKi8gY3R4WzNdKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWgyID0gZWxlbWVudCgiaDIiKTsKCQkJaDIudGV4dENvbnRlbnQgPSAiQWRyaWZ0IERFViI7CgkJCXQxID0gc3BhY2UoKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMC4kJC5mcmFnbWVudCk7CgkJCXQyID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24xLiQkLmZyYWdtZW50KTsKCQkJYXR0cihoMiwgImNsYXNzIiwgIm0zLWZvbnQtaGVhZGxpbmUtbGFyZ2UgbWItNCIpOwoJCQlhdHRyKGRpdiwgImNsYXNzIiwgImZsZXggZ2FwLTQiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgaDIsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQxLCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24wLCBkaXYsIG51bGwpOwoJCQlhcHBlbmQoZGl2LCB0Mik7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24xLCBkaXYsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBidXR0b24wX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eSAmIC8qJCRzY29wZSovIDUxMikgewoJCQkJYnV0dG9uMF9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJYnV0dG9uMC4kc2V0KGJ1dHRvbjBfY2hhbmdlcyk7CgkJCWNvbnN0IGJ1dHRvbjFfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5ICYgLyokJHNjb3BlKi8gNTEyKSB7CgkJCQlidXR0b24xX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24xLiRzZXQoYnV0dG9uMV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChidXR0b24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChoMik7CgkJCQlkZXRhY2godDEpOwoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGJ1dHRvbjApOwoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24xKTsKCQl9Cgl9Owp9CgovLyAoNjE6NCkgPENhcmQgdHlwZT0ib3V0bGluZWQiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90KGN0eCkgewoJbGV0IGRpdjsKCWxldCBjaXJjdWxhcnByb2dyZXNzaW5kZXRlcm1pbmF0ZTsKCWxldCB0MDsKCWxldCBoMjsKCWxldCB0MTsKCWxldCB0MjsKCWxldCBwOwoJbGV0IGN1cnJlbnQ7CgljaXJjdWxhcnByb2dyZXNzaW5kZXRlcm1pbmF0ZSA9IG5ldyBDaXJjdWxhclByb2dyZXNzSW5kZXRlcm1pbmF0ZSQxKHt9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQloMiA9IGVsZW1lbnQoImgyIik7CgkJCXQxID0gdGV4dCgvKnN0YXRlU3RyKi8gY3R4WzFdKTsKCQkJdDIgPSBzcGFjZSgpOwoJCQlwID0gZWxlbWVudCgicCIpOwoKCQkJcC5pbm5lckhUTUwgPSBgQWRyaWZ0IGlzIHJvdXRpbmcgeW91IHRvIGEgc2VydmVyIGF2YWlsYWJsZSB0byB0YWtlIHlvdXIgcmVxdWVzdHMuPGJyLz5UaGUgaW5pdGlhbCBjb25uZWN0aW9uIG1heSB0YWtlIHNldmVyYWwgbWludXRlcyBkZXBlbmRpbmcgb24gc2VydmVyCiAgICAgICAgbG9hZGA7CgoJCQlhdHRyKGgyLCAiY2xhc3MiLCAidGV4dC14bCIpOwoJCQlhdHRyKGRpdiwgImNsYXNzIiwgImZsZXggaXRlbXMtY2VudGVyIG1iLTQgZ2FwLTQiKTsKCQkJYXR0cihwLCAiY2xhc3MiLCAidGV4dC1zbSB0ZXh0LW9uLXN1cmZhY2UtdmFyaWFudCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChjaXJjdWxhcnByb2dyZXNzaW5kZXRlcm1pbmF0ZSwgZGl2LCBudWxsKTsKCQkJYXBwZW5kKGRpdiwgdDApOwoJCQlhcHBlbmQoZGl2LCBoMik7CgkJCWFwcGVuZChoMiwgdDEpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MiwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgcCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJaWYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLypzdGF0ZVN0ciovIDIpIHNldF9kYXRhKHQxLCAvKnN0YXRlU3RyKi8gY3R4WzFdKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihjaXJjdWxhcnByb2dyZXNzaW5kZXRlcm1pbmF0ZS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoY2lyY3VsYXJwcm9ncmVzc2luZGV0ZXJtaW5hdGUuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCQlkZXRhY2godDIpOwoJCQkJZGV0YWNoKHApOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChjaXJjdWxhcnByb2dyZXNzaW5kZXRlcm1pbmF0ZSk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50KGN0eCkgewoJbGV0IHQwOwoJbGV0IGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleDsKCWxldCBpZl9ibG9jazsKCWxldCB0MTsKCWxldCBzdHlsZWZyb21zY2hlbWU7CglsZXQgY3VycmVudDsKCWNvbnN0IGlmX2Jsb2NrX2NyZWF0b3JzID0gW2NyZWF0ZV9pZl9ibG9jaywgY3JlYXRlX2lmX2Jsb2NrXzEsIGNyZWF0ZV9pZl9ibG9ja18yLCBjcmVhdGVfZWxzZV9ibG9ja107Cgljb25zdCBpZl9ibG9ja3MgPSBbXTsKCglmdW5jdGlvbiBzZWxlY3RfYmxvY2tfdHlwZShjdHgsIGRpcnR5KSB7CgkJaWYgKC8qc3RhdGUqLyBjdHhbMF0gPT0gVUlTdGF0ZS5Db25uZWN0ZWQpIHJldHVybiAwOwoJCWlmICgvKnN0YXRlKi8gY3R4WzBdID09IFVJU3RhdGUuQ29ubmVjdGluZykgcmV0dXJuIDE7CgkJcmV0dXJuIDM7Cgl9CgoJY3VycmVudF9ibG9ja190eXBlX2luZGV4ID0gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4KTsKCWlmX2Jsb2NrID0gaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0gPSBpZl9ibG9ja19jcmVhdG9yc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdKGN0eCk7CgoJc3R5bGVmcm9tc2NoZW1lID0gbmV3IFN0eWxlRnJvbVNjaGVtZSQxKHsKCQkJcHJvcHM6IHsKCQkJCWxpZ2h0U2NoZW1lOiB7CgkJCQkJcHJpbWFyeTogNDI4MjQxMTA2MiwKCQkJCQlvblByaW1hcnk6IDQyOTQ5NjcyOTUsCgkJCQkJcHJpbWFyeUNvbnRhaW5lcjogNDI5MDgzNDM1MiwKCQkJCQlvblByaW1hcnlDb250YWluZXI6IDQyNzgxOTg3ODQsCgkJCQkJaW52ZXJzZVByaW1hcnk6IDQyODkwNTc2ODUsCgkJCQkJc2Vjb25kYXJ5OiA0MjgzNzIwNTI1LAoJCQkJCW9uU2Vjb25kYXJ5OiA0Mjk0OTY3Mjk1LAoJCQkJCXNlY29uZGFyeUNvbnRhaW5lcjogNDI5MjMzOTkxNywKCQkJCQlvblNlY29uZGFyeUNvbnRhaW5lcjogNDI3OTM3NzY3OCwKCQkJCQl0ZXJ0aWFyeTogNDI4MTg4NjA1NiwKCQkJCQlvblRlcnRpYXJ5OiA0Mjk0OTY3Mjk1LAoJCQkJCXRlcnRpYXJ5Q29udGFpbmVyOiA0MjkwNTcxMjQ2LAoJCQkJCW9uVGVydGlhcnlDb250YWluZXI6IDQyNzgxOTgzMDYsCgkJCQkJZXJyb3I6IDQyOTAzODY0NTgsCgkJCQkJb25FcnJvcjogNDI5NDk2NzI5NSwKCQkJCQllcnJvckNvbnRhaW5lcjogNDI5NDk1Nzc4MiwKCQkJCQlvbkVycm9yQ29udGFpbmVyOiA0MjgyNDQ5OTIyLAoJCQkJCWJhY2tncm91bmQ6IDQyOTQ1MDc1MDUsCgkJCQkJb25CYWNrZ3JvdW5kOiA0Mjc5ODM1OTI3LAoJCQkJCXN1cmZhY2U6IDQyOTQ1MDc1MDUsCgkJCQkJb25TdXJmYWNlOiA0Mjc5ODM1OTI3LAoJCQkJCXN1cmZhY2VWYXJpYW50OiA0MjkyODYzMTkxLAoJCQkJCW9uU3VyZmFjZVZhcmlhbnQ6IDQyODI1OTk0ODcsCgkJCQkJaW52ZXJzZVN1cmZhY2U6IDQyODEyMTc1NzksCgkJCQkJaW52ZXJzZU9uU3VyZmFjZTogNDI5MzkxNTM2OCwKCQkJCQlvdXRsaW5lOiA0Mjg1NzU3ODA2LAoJCQkJCW91dGxpbmVWYXJpYW50OiA0MjkxMDIwOTg4LAoJCQkJCXNoYWRvdzogNDI3ODE5MDA4MCwKCQkJCQlzY3JpbTogNDI3ODE5MDA4MCwKCQkJCQlzdXJmYWNlRGltOiA0MjkyNDAyMTMwLAoJCQkJCXN1cmZhY2VCcmlnaHQ6IDQyOTQ1MDc1MDUsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckxvd2VzdDogNDI5NDk2NzI5NSwKCQkJCQlzdXJmYWNlQ29udGFpbmVyTG93OiA0Mjk0MTEyNzQ3LAoJCQkJCXN1cmZhY2VDb250YWluZXI6IDQyOTM3MTc5ODksCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2g6IDQyOTMzMjMyMzIsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2hlc3Q6IDQyOTI5OTQyNjYsCgkJCQkJc3VyZmFjZVRpbnQ6IDQyODI0MTEwNjIKCQkJCX0sCgkJCQlkYXJrU2NoZW1lOiB7CgkJCQkJcHJpbWFyeTogNDI5NDk0NTc3OSwKCQkJCQlvblByaW1hcnk6IDQyODQxNTM5NDcsCgkJCQkJcHJpbWFyeUNvbnRhaW5lcjogNDI5MTY5MDcwMiwKCQkJCQlvblByaW1hcnlDb250YWluZXI6IDQyOTQ5NjcyOTUsCgkJCQkJaW52ZXJzZVByaW1hcnk6IDQyODkyNjU4MzMsCgkJCQkJc2Vjb25kYXJ5OiA0Mjk0OTQ1Nzc5LAoJCQkJCW9uU2Vjb25kYXJ5OiA0Mjg0MTUzOTQ3LAoJCQkJCXNlY29uZGFyeUNvbnRhaW5lcjogNDI4NjcwOTg5MCwKCQkJCQlvblNlY29uZGFyeUNvbnRhaW5lcjogNDI5NDk1NjUzMywKCQkJCQl0ZXJ0aWFyeTogNDI5NDk0Nzc2NCwKCQkJCQlvblRlcnRpYXJ5OiA0Mjg1MDA1ODQ2LAoJCQkJCXRlcnRpYXJ5Q29udGFpbmVyOiA0MjkyMjk0MjE4LAoJCQkJCW9uVGVydGlhcnlDb250YWluZXI6IDQyOTQ5NjcyOTUsCgkJCQkJZXJyb3I6IDQyOTQ5NDgwMTEsCgkJCQkJb25FcnJvcjogNDI4NTA3MTM2NSwKCQkJCQllcnJvckNvbnRhaW5lcjogNDI4NzgyMzg4MiwKCQkJCQlvbkVycm9yQ29udGFpbmVyOiA0Mjk0OTU3NzgyLAoJCQkJCWJhY2tncm91bmQ6IDQyNzk3MDIwMzgsCgkJCQkJb25CYWNrZ3JvdW5kOiA0MjkzNzEzODkzLAoJCQkJCXN1cmZhY2U6IDQyNzk3MDIwMzgsCgkJCQkJb25TdXJmYWNlOiA0MjkzNzEzODkzLAoJCQkJCXN1cmZhY2VWYXJpYW50OiA0MjgzMzE5MzcxLAoJCQkJCW9uU3VyZmFjZVZhcmlhbnQ6IDQyOTE5MzY5NzEsCgkJCQkJaW52ZXJzZVN1cmZhY2U6IDQyOTM3MTM4OTMsCgkJCQkJaW52ZXJzZU9uU3VyZmFjZTogNDI4MTY3NTMxNSwKCQkJCQlvdXRsaW5lOiA0Mjg4MzE4ODY5LAoJCQkJCW91dGxpbmVWYXJpYW50OiA0MjgzMzE5MzcxLAoJCQkJCXNoYWRvdzogNDI3ODE5MDA4MCwKCQkJCQlzY3JpbTogNDI3ODE5MDA4MCwKCQkJCQlzdXJmYWNlRGltOiA0Mjc5NzAyMDM4LAoJCQkJCXN1cmZhY2VCcmlnaHQ6IDQyODIyNjc0NTIsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckxvd2VzdDogNDI3OTM3MzA3MywKCQkJCQlzdXJmYWNlQ29udGFpbmVyTG93OiA0MjgwMjkzOTE4LAoJCQkJCXN1cmZhY2VDb250YWluZXI6IDQyODA1NTcwOTAsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2g6IDQyODEyODA1NTcsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2hlc3Q6IDQyODIwMDQyODAsCgkJCQkJc3VyZmFjZVRpbnQ6IDQyOTQwMzAzMTAKCQkJCX0KCQkJfQoJCX0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJdDAgPSBzcGFjZSgpOwoJCQlpZl9ibG9jay5jKCk7CgkJCXQxID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChzdHlsZWZyb21zY2hlbWUuJCQuZnJhZ21lbnQpOwoJCQlkb2N1bWVudC50aXRsZSA9ICJBZHJpZnQiOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0MCwgYW5jaG9yKTsKCQkJaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0ubSh0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQxLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoc3R5bGVmcm9tc2NoZW1lLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJbGV0IHByZXZpb3VzX2Jsb2NrX2luZGV4ID0gY3VycmVudF9ibG9ja190eXBlX2luZGV4OwoJCQljdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXggPSBzZWxlY3RfYmxvY2tfdHlwZShjdHgpOwoKCQkJaWYgKGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleCA9PT0gcHJldmlvdXNfYmxvY2tfaW5kZXgpIHsKCQkJCWlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdLnAoY3R4LCBkaXJ0eSk7CgkJCX0gZWxzZSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9ja3NbcHJldmlvdXNfYmxvY2tfaW5kZXhdLCAxLCAxLCAoKSA9PiB7CgkJCQkJaWZfYmxvY2tzW3ByZXZpb3VzX2Jsb2NrX2luZGV4XSA9IG51bGw7CgkJCQl9KTsKCgkJCQljaGVja19vdXRyb3MoKTsKCQkJCWlmX2Jsb2NrID0gaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF07CgoJCQkJaWYgKCFpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrID0gaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0gPSBpZl9ibG9ja19jcmVhdG9yc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdKGN0eCk7CgkJCQkJaWZfYmxvY2suYygpOwoJCQkJfSBlbHNlIHsKCQkJCQlpZl9ibG9jay5wKGN0eCwgZGlydHkpOwoJCQkJfQoKCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJaWZfYmxvY2subSh0MS5wYXJlbnROb2RlLCB0MSk7CgkJCX0KCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25faW4oc3R5bGVmcm9tc2NoZW1lLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25fb3V0KHN0eWxlZnJvbXNjaGVtZS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godDApOwoJCQkJZGV0YWNoKHQxKTsKCQkJfQoKCQkJaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0uZChkZXRhY2hpbmcpOwoJCQlkZXN0cm95X2NvbXBvbmVudChzdHlsZWZyb21zY2hlbWUsIGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCBzdGF0ZSA9IFVJU3RhdGUuSWRsZTsKCWxldCBzdGF0ZVN0ciA9ICIiOwoJbGV0IGRldlRyYW5zcG9ydDsKCglhc3luYyBmdW5jdGlvbiBvbk9wZW4oKSB7CgkJY29uc29sZS5sb2coIltUUkFOU1BPUlQgREVWXSBvcGVuZWQiKTsKCQljb25zdCBjb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24kMShkZXZUcmFuc3BvcnQpOwoJCWF3YWl0IGNvbm5lY3Rpb24uaW5pdGlhbGl6ZSgpOwoJCWNvbnN0IGJhcmUgPSBuZXcgQWRyaWZ0QmFyZUNsaWVudChjb25uZWN0aW9uKTsKCQlzZXRCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24kMShiYXJlKTsKCQkkJGludmFsaWRhdGUoMCwgc3RhdGUgPSBVSVN0YXRlLkNvbm5lY3RlZCk7Cgl9CgoJYXN5bmMgZnVuY3Rpb24gY29ubmVjdERldkh0dHAoKSB7CgkJJCRpbnZhbGlkYXRlKDAsIHN0YXRlID0gVUlTdGF0ZS5Db25uZWN0aW5nKTsKCgkJY29uc3QgdHJhbnNwb3J0ID0gbmV3IFJUQ1RyYW5zcG9ydChvbk9wZW4sCgkJKCkgPT4gY29uc29sZS53YXJuKCJbVFJBTlNQT1JUXSBjbG9zZWQiKSwKCQkoKSA9PiB7CgkJCQkkJGludmFsaWRhdGUoMSwgc3RhdGVTdHIgPSBgQ29ubmVjdGlvbiAke3RyYW5zcG9ydC5wZWVyLmNvbm5lY3Rpb25TdGF0ZX0uLi5gKTsKCQkJfSwKCQkoKSA9PiB7CgkJCQkkJGludmFsaWRhdGUoMSwgc3RhdGVTdHIgPSBgU2lnbmFsaW5nICR7dHJhbnNwb3J0LnBlZXIuY29ubmVjdGlvblN0YXRlfS4uLmApOwoJCQl9LAoJCSgpID0+IHsKCQkJCWlmICh0cmFuc3BvcnQucGVlci5jb25uZWN0aW9uU3RhdGUgPT0gIm5ldyIpIHsKCQkJCQkkJGludmFsaWRhdGUoMSwgc3RhdGVTdHIgPSBgQ3JlYXRpbmcgYW4gb2ZmZXIuLi5gKTsKCQkJCX0gZWxzZSB7CgkJCQkJJCRpbnZhbGlkYXRlKDEsIHN0YXRlU3RyID0gYEdhdGhlcmluZyAke3RyYW5zcG9ydC5wZWVyLmNvbm5lY3Rpb25TdGF0ZX0uLi5gKTsKCQkJCX0KCQkJfSk7CgoJCWRldlRyYW5zcG9ydCA9IHRyYW5zcG9ydDsKCQlsZXQgb2ZmZXIgPSBhd2FpdCB0cmFuc3BvcnQuY3JlYXRlT2ZmZXIoKTsKCQljb25zb2xlLmxvZygib2ZmZXIiLCBvZmZlcik7CgoJCWNvbnN0IHIgPSBhd2FpdCBmZXRjaCgiaHR0cDovL2xvY2FsaG9zdDozMDAwL2Nvbm5lY3QiLCB7CgkJCW1ldGhvZDogIlBPU1QiLAoJCQloZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIgfSwKCQkJYm9keTogSlNPTi5zdHJpbmdpZnkob2ZmZXIpCgkJfSk7CgoJCWlmIChyLnN0YXR1cyAhPSAyMDApIHsKCQkJdGhyb3cgbmV3IEVycm9yKCJjb25uZWN0OiAiICsgci5zdGF0dXMgKyAiICIgKyByLnN0YXR1c1RleHQpOwoJCX0KCgkJY29uc3QgeyBhbnN3ZXIsIGNhbmRpZGF0ZXMgfSA9IGF3YWl0IHIuanNvbigpOwoJCWF3YWl0IHRyYW5zcG9ydC5hbnN3ZXIoYW5zd2VyLCBjYW5kaWRhdGVzKTsKCX0KCglhc3luYyBmdW5jdGlvbiBjb25uZWN0RGV2V1MoKSB7CgkJJCRpbnZhbGlkYXRlKDAsIHN0YXRlID0gVUlTdGF0ZS5Db25uZWN0aW5nKTsKCQlkZXZUcmFuc3BvcnQgPSBuZXcgRGV2V3NUcmFuc3BvcnQob25PcGVuLCAoKSA9PiBjb25zb2xlLmxvZygiW1RSQU5TUE9SVCBERVZdIGNsb3NlZCIpKTsKCX0KCgljb25zdCBjbGlja19oYW5kbGVyID0gKCkgPT4gZG93bmxvYWRTaG9ydGN1dCgiYWRyaWZ0Lmh0bWwiLCAiSG9tZXdvcmsiKTsKCglmdW5jdGlvbiBjb25uZWN0aW9uY21wX3N0YXRlX2JpbmRpbmcodmFsdWUpIHsKCQlzdGF0ZSA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSgwLCBzdGF0ZSk7Cgl9CgoJZnVuY3Rpb24gY29ubmVjdGlvbmNtcF9zdGF0ZVN0cl9iaW5kaW5nKHZhbHVlKSB7CgkJc3RhdGVTdHIgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMSwgc3RhdGVTdHIpOwoJfQoKCXJldHVybiBbCgkJc3RhdGUsCgkJc3RhdGVTdHIsCgkJY29ubmVjdERldkh0dHAsCgkJY29ubmVjdERldldTLAoJCWNsaWNrX2hhbmRsZXIsCgkJY29ubmVjdGlvbmNtcF9zdGF0ZV9iaW5kaW5nLAoJCWNvbm5lY3Rpb25jbXBfc3RhdGVTdHJfYmluZGluZwoJXTsKfQoKY2xhc3MgQXBwIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UsIGNyZWF0ZV9mcmFnbWVudCwgc2FmZV9ub3RfZXF1YWwsIHt9KTsKCX0KfQoKY29uc3QgaW5kZXggPSAnJzsKCnsKICBjb25zb2xlLmxvZygKICAgICIlY0FEUklGVCBSVU5OSU5HIElOIFBST0RVQ1RJT04gTU9ERSIsCiAgICAiYmFja2dyb3VuZDogYmx1ZTsgY29sb3I6IHdoaXRlOyBmb250LXNpemU6IHgtbGFyZ2UiCiAgKTsKfQpuZXcgQXBwKHsKICB0YXJnZXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhcHAiKQp9KTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgtNjFhYjUxYTEuanMubWFwCg==";
</script>
    <style>
:root{--m3-util-elevation-0: none;--m3-util-elevation-1: 0px 3px 1px -2px rgb(var(--m3-scheme-shadow) / .2), 0px 2px 2px 0px rgb(var(--m3-scheme-shadow) / .14), 0px 1px 5px 0px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-2: 0px 2px 4px -1px rgb(var(--m3-scheme-shadow) / .2), 0px 4px 5px 0px rgb(var(--m3-scheme-shadow) / .14), 0px 1px 10px 0px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-3: 0px 5px 5px -3px rgb(var(--m3-scheme-shadow) / .2), 0px 8px 10px 1px rgb(var(--m3-scheme-shadow) / .14), 0px 3px 14px 2px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-4: 0px 5px 5px -3px rgb(var(--m3-scheme-shadow) / .2), 0px 8px 10px 1px rgb(var(--m3-scheme-shadow) / .14), 0px 3px 14px 2px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-5: 0px 8px 10px -6px rgb(var(--m3-scheme-shadow) / .2), 0px 16px 24px 2px rgb(var(--m3-scheme-shadow) / .14), 0px 6px 30px 5px rgb(var(--m3-scheme-shadow) / .12);--m3-util-bottom-offset: 0}.m3-font-display-large,.m3-font-display-medium,.m3-font-display-small{font-family:var(--m3-font-display, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-display-weight, 400)}.m3-font-display-large{font-size:var(--m3-font-display-large-size, 3.5625rem);line-height:var(--m3-font-display-large-height, 4rem);letter-spacing:var(--m3-font-display-large-tracking, 0)}.m3-font-display-medium{font-size:var(--m3-font-display-medium-size, 2.8125rem);line-height:var(--m3-font-display-medium-height, 3.25rem);letter-spacing:var(--m3-font-display-medium-tracking, 0)}.m3-font-display-small{font-size:var(--m3-font-display-small-size, 2.25rem);line-height:var(--m3-font-display-small-height, 2.75rem);letter-spacing:var(--m3-font-display-small-tracking, 0)}.m3-font-headline-large,.m3-font-headline-medium,.m3-font-headline-small{font-family:var(--m3-font-headline, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-headline-weight, 400)}.m3-font-headline-large{font-size:var(--m3-font-headline-large-size, 2rem);line-height:var(--m3-font-headline-large-height, 2.5rem);letter-spacing:var(--m3-font-headline-large-tracking, 0)}.m3-font-headline-medium{font-size:var(--m3-font-headline-medium-size, 1.75rem);line-height:var(--m3-font-headline-medium-height, 2.25rem);letter-spacing:var(--m3-font-headline-medium-tracking, 0)}.m3-font-headline-small{font-size:var(--m3-font-headline-small-size, 1.5rem);line-height:var(--m3-font-headline-small-height, 2rem);letter-spacing:var(--m3-font-headline-small-tracking, 0)}.m3-font-title-large,.m3-font-title-medium,.m3-font-title-small{font-family:var(--m3-font-title, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-title-weight, 400)}.m3-font-title-large{font-size:var(--m3-font-title-large-size, 1.375rem);line-height:var(--m3-font-title-large-height, 1.75rem);letter-spacing:var(--m3-font-title-large-tracking, 0)}.m3-font-title-medium{font-size:var(--m3-font-title-medium-size, 1rem);line-height:var(--m3-font-title-medium-height, 1.5rem);letter-spacing:var(--m3-font-title-medium-tracking, .15)}.m3-font-title-small{font-size:var(--m3-font-title-small-size, .875rem);line-height:var(--m3-font-title-small-height, 1.25rem);letter-spacing:var(--m3-font-title-small-tracking, .1)}.m3-font-label-large,.m3-font-label-medium,.m3-font-label-small{font-family:var(--m3-font-label, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-label-weight, 500)}.m3-font-label-large{font-size:var(--m3-font-label-large-size, .875rem);line-height:var(--m3-font-label-large-height, 1.25rem);letter-spacing:var(--m3-font-label-large-tracking, .1)}.m3-font-label-medium{font-size:var(--m3-font-label-medium-size, .75rem);line-height:var(--m3-font-label-medium-height, 1rem);letter-spacing:var(--m3-font-label-medium-tracking, .5)}.m3-font-label-small{font-size:var(--m3-font-label-small-size, .6875rem);line-height:var(--m3-font-label-small-height, 1rem);letter-spacing:var(--m3-font-label-small-tracking, .5)}.m3-font-body-large,.m3-font-body-medium,.m3-font-body-small{font-family:var(--m3-font-body, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-body-weight, 400)}.m3-font-body-large{font-size:var(--m3-font-body-large-size, 1rem);line-height:var(--m3-font-body-large-height, 1.5rem);letter-spacing:var(--m3-font-body-large-tracking, .5)}.m3-font-body-medium{font-size:var(--m3-font-body-medium-size, .875rem);line-height:var(--m3-font-body-medium-height, 1.25rem);letter-spacing:var(--m3-font-body-medium-tracking, .25)}.m3-font-body-small{font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}.m3-container{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}.m3-container a,a.m3-container{text-decoration:none}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{border:none;height:2.5rem;padding:0 1.5rem;border-radius:2.5rem;color:rgb(var(--text));transition:all .2s;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden}.layer.svelte-1nfjcdr.svelte-1nfjcdr{position:absolute;inset:0;transition:all .2s}.m3-container.svelte-1nfjcdr>*{flex-shrink:0}.icon-left.svelte-1nfjcdr.svelte-1nfjcdr{padding-left:1rem;gap:.5rem}.icon-left.svelte-1nfjcdr>svg{width:1.125rem;height:1.125rem}.icon-full.svelte-1nfjcdr.svelte-1nfjcdr{width:2.5rem;padding:0}.icon-full.svelte-1nfjcdr>svg{width:1.5rem;height:1.5rem}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:disabled{background-color:rgb(var(--m3-scheme-on-surface) / .12);color:rgb(var(--m3-scheme-on-surface) / .38);cursor:auto}.m3-container:enabled.elevated.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-surface-container-low));--text:var(--m3-scheme-primary);box-shadow:var(--m3-util-elevation-1)}.m3-container:enabled.filled.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-primary));--text:var(--m3-scheme-on-primary)}.m3-container:enabled.tonal.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-secondary-container));--text:var(--m3-scheme-on-secondary-container)}.m3-container.outlined.svelte-1nfjcdr.svelte-1nfjcdr{background-color:transparent;border:.0625rem solid rgb(var(--m3-scheme-on-surface) / .12)}.m3-container:enabled.outlined.svelte-1nfjcdr.svelte-1nfjcdr{border:.0625rem solid rgb(var(--m3-scheme-outline));--text:var(--m3-scheme-primary)}.m3-container.text.svelte-1nfjcdr.svelte-1nfjcdr{background-color:transparent;padding:0 .75rem;--text:var(--m3-scheme-primary)}.m3-container.text.icon-left.svelte-1nfjcdr.svelte-1nfjcdr{padding-right:1rem}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{-webkit-tap-highlight-color:transparent}@media (hover: hover){.m3-container.svelte-1nfjcdr:enabled:hover>.layer.svelte-1nfjcdr{background-color:rgb(var(--text) / .08)}.m3-container:enabled.elevated.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-2)}.m3-container:enabled.filled.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-1)}.m3-container:enabled.tonal.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-1)}}.m3-container.svelte-1nfjcdr:enabled:focus-visible>.layer.svelte-1nfjcdr,.m3-container.svelte-1nfjcdr:enabled:active>.layer.svelte-1nfjcdr{background-color:rgb(var(--text) / .12)}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:is(.elevated,.filled,.tonal){background-color:transparent;border:.0625rem solid}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:disabled{opacity:.38}}.m3-container.svelte-czr52d{flex-direction:column;position:relative;padding:1rem;border:none;border-radius:.75rem;background-color:rgb(var(--m3-scheme-surface));color:rgb(var(--m3-scheme-on-surface));transition:all .2s}.type-elevated.svelte-czr52d{background-color:rgb(var(--m3-scheme-surface-container-low))}.type-filled.svelte-czr52d{background-color:rgb(var(--m3-scheme-surface-container-highest))}.type-outlined.svelte-czr52d{border:solid .0625rem rgb(var(--m3-scheme-outline))}.type-elevated.svelte-czr52d{box-shadow:var(--m3-util-elevation-1)}@media print,(forced-colors: active){.type-filled.svelte-czr52d{outline:solid .125rem}}@media (forced-colors: active){.type-elevated.svelte-czr52d{outline:solid .125rem}}dialog.svelte-bufvve.svelte-bufvve{background-color:rgb(var(--m3-scheme-surface-container-high));border:none;border-radius:1.75rem;min-width:17.5rem;max-width:35rem;padding:0;overflow:auto}.m3-container.svelte-bufvve.svelte-bufvve{display:flex;flex-direction:column;padding:1.5rem;width:100%}.m3-container.svelte-bufvve>svg{color:rgb(var(--m3-scheme-secondary));width:1.5rem;height:1.5rem;margin:0 auto 1rem}.headline.svelte-bufvve.svelte-bufvve{color:rgb(var(--m3-scheme-on-surface));margin-top:0;margin-bottom:1rem}.headline.center.svelte-bufvve.svelte-bufvve{text-align:center}.content.svelte-bufvve.svelte-bufvve{color:rgb(var(--m3-scheme-on-surface-variant));margin-bottom:1.5rem}.buttons.svelte-bufvve.svelte-bufvve{display:flex;justify-content:flex-end;gap:.5rem}dialog.svelte-bufvve.svelte-bufvve{position:fixed;inset:0;opacity:0;visibility:hidden;pointer-events:none;transition:opacity .2s,visibility .2s}dialog[open].svelte-bufvve.svelte-bufvve{opacity:1;visibility:visible;pointer-events:auto;animation:svelte-bufvve-dialogIn .5s cubic-bezier(.05,.7,.1,1),svelte-bufvve-opacity .1s cubic-bezier(.05,.7,.1,1)}dialog[open].svelte-bufvve .headline.svelte-bufvve{animation:svelte-bufvve-opacity .15s}dialog[open].svelte-bufvve .content.svelte-bufvve{animation:svelte-bufvve-opacity .2s}dialog[open].svelte-bufvve .buttons.svelte-bufvve{position:relative;animation:svelte-bufvve-buttonsIn .5s cubic-bezier(.05,.7,.1,1),svelte-bufvve-opacity .2s .1s backwards}dialog.svelte-bufvve.svelte-bufvve::backdrop{background-color:rgb(var(--m3-scheme-scrim) / .3);animation:svelte-bufvve-opacity .4s}@keyframes svelte-bufvve-dialogIn{0%{transform:translateY(-3rem) scaleY(.9);-webkit-clip-path:inset(0 0 100% 0 round 1.75rem);clip-path:inset(0 0 100% 0 round 1.75rem)}to{transform:translateY(0) scaleY(1);-webkit-clip-path:inset(0 0 0 0 round 1.75rem);clip-path:inset(0 0 0 0 round 1.75rem)}}@keyframes svelte-bufvve-buttonsIn{0%{bottom:100%}to{bottom:0}}@keyframes svelte-bufvve-opacity{0%{opacity:0}to{opacity:1}}@media print,(forced-colors: active){dialog.svelte-bufvve.svelte-bufvve{outline:solid .125rem canvastext}}.m3-container.svelte-xbv0dm{padding:.5rem 1.5rem .5rem 1rem;align-items:center;gap:1rem;-webkit-tap-highlight-color:transparent;cursor:pointer;transition:background-color .2s}.lines-1.svelte-xbv0dm{height:3.5rem}.lines-2.svelte-xbv0dm{height:4.5rem}.lines-3.svelte-xbv0dm{height:5.5rem;padding-top:.75rem;padding-bottom:.75rem;align-items:flex-start}.leading.svelte-xbv0dm,.trailing.svelte-xbv0dm{display:contents;color:rgb(var(--m3-scheme-on-surface-variant))}.leading.svelte-xbv0dm>svg,.trailing.svelte-xbv0dm>svg{width:1.5rem;height:1.5rem;flex-shrink:0}p.svelte-xbv0dm{margin:0}.supporting.svelte-xbv0dm,.overline.svelte-xbv0dm{color:rgb(var(--m3-scheme-on-surface-variant))}.headline.svelte-xbv0dm{color:rgb(var(--m3-scheme-on-surface))}@media (hover: hover){.m3-container.svelte-xbv0dm:hover{background-color:rgb(var(--m3-scheme-on-surface) / .08)}}.m3-container.svelte-xbv0dm:focus-visible,.m3-container.svelte-xbv0dm:active{background-color:rgb(var(--m3-scheme-on-surface) / .12)}.m3-container.svelte-l92rtn{display:flex;align-items:center;padding:0 1rem;min-width:20rem;max-width:60rem;min-height:3rem;border-radius:.25rem;box-shadow:var(--m3-util-elevation-3);background-color:rgb(var(--m3-scheme-inverse-surface));color:rgb(var(--m3-scheme-inverse-on-surface));animation:svelte-l92rtn-snackbarIn .5s cubic-bezier(.05,.7,.1,1),svelte-l92rtn-opacity .1s cubic-bezier(.05,.7,.1,1)}@keyframes svelte-l92rtn-snackbarIn{0%{-webkit-clip-path:polygon(-100% 150%,-100% calc(100% + .25rem),0% calc(100% + .25rem),.033rem calc(100% + .125rem),.125rem calc(100% + .033rem),.25rem 100%,calc(100% - .25rem) 100%,calc(100% - .125rem) calc(100% + .033rem),calc(100% - .033rem) calc(100% + .125rem),100% calc(100% + .25rem),200% calc(100% + .25rem),200% 150%);clip-path:polygon(-100% 150%,-100% calc(100% + .25rem),0% calc(100% + .25rem),.033rem calc(100% + .125rem),.125rem calc(100% + .033rem),.25rem 100%,calc(100% - .25rem) 100%,calc(100% - .125rem) calc(100% + .033rem),calc(100% - .033rem) calc(100% + .125rem),100% calc(100% + .25rem),200% calc(100% + .25rem),200% 150%)}to{-webkit-clip-path:polygon(-100% 150%,-100% .25rem,0% .25rem,.033rem .125rem,.125rem .033rem,.25rem 0%,calc(100% - .25rem) 0%,calc(100% - .125rem) .033rem,calc(100% - .033rem) .125rem,100% .25rem,200% .25rem,200% 150%);clip-path:polygon(-100% 150%,-100% .25rem,0% .25rem,.033rem .125rem,.125rem .033rem,.25rem 0%,calc(100% - .25rem) 0%,calc(100% - .125rem) .033rem,calc(100% - .033rem) .125rem,100% .25rem,200% .25rem,200% 150%)}}@keyframes svelte-l92rtn-opacity{0%{opacity:0}to{opacity:1}}.holder.svelte-kdzpyg{position:fixed;padding-bottom:1rem;bottom:var(--m3-util-bottom-offset);left:50%;transform:translate(-50%);z-index:3}p.svelte-kdzpyg{margin-right:auto}button.svelte-kdzpyg{display:flex;align-self:stretch;align-items:center;margin:0;padding:0;border:none;background-color:transparent;color:rgb(var(--text));-webkit-tap-highlight-color:transparent;cursor:pointer;transition:all .2s}button.svelte-kdzpyg svg{width:1.5rem;height:1.5rem}.action.svelte-kdzpyg{--text:var(--m3-scheme-inverse-primary);padding:0 .5rem}.close.svelte-kdzpyg{--text:var(--m3-scheme-inverse-on-surface);padding:0 .75rem;margin-right:-1rem}@media (hover: hover){button.svelte-kdzpyg:hover{background-color:rgb(var(--text) / .08)}}button.svelte-kdzpyg:focus-visible,button.svelte-kdzpyg:active{background-color:rgb(var(--text) / .12)}svg.svelte-1lrxrhm{width:3rem;height:3rem;animation:svelte-1lrxrhm-progressRotate 2.5s infinite linear}circle.svelte-1lrxrhm{transition:all .2s;animation:svelte-1lrxrhm-progressSize 2.5s infinite linear}@keyframes svelte-1lrxrhm-progressRotate{0%{transform:rotate(0)}50%{transform:rotate(360deg)}to{transform:rotate(1080deg)}}@keyframes svelte-1lrxrhm-progressSize{0%{stroke-dashoffset:125.66}50%{stroke-dashoffset:62.83}to{stroke-dashoffset:125.66}}.m3-container.svelte-j01lhi{position:relative;width:1.25rem;height:1.25rem}.m3-container.svelte-j01lhi input{position:absolute;opacity:0}.layer.svelte-j01lhi{position:absolute;inset:-.625rem;width:2.5rem;height:2.5rem;border-radius:2.5rem;transition:all .2s;cursor:pointer;--color:var(--m3-scheme-on-surface-variant);-webkit-tap-highlight-color:transparent}.layer.svelte-j01lhi:before{content:" ";display:block;position:absolute;inset:.625rem;width:1.25rem;height:1.25rem;border-radius:1.25rem;border:solid .125rem rgb(var(--color));transition:all .3s}.layer.svelte-j01lhi:after{content:" ";display:block;position:absolute;inset:1.25rem;width:0rem;height:0rem;border-radius:.625rem;background-color:rgb(var(--color))}@media (hover: hover){.layer.svelte-j01lhi:hover{--color:var(--m3-scheme-on-surface);background-color:rgb(var(--color) / .08)}}.layer.svelte-j01lhi:active,input:focus-visible+.layer.svelte-j01lhi{--color:var(--m3-scheme-on-surface);background-color:rgb(var(--color) / .12)}input:enabled+.layer.svelte-j01lhi:active:before{transform:scale(.9)}input:checked+.layer.svelte-j01lhi{--color:var(--m3-scheme-primary)}input:checked+.layer.svelte-j01lhi:after{inset:.9375rem;width:.625rem;height:.625rem;transition:all .3s}input:disabled+.layer.svelte-j01lhi{background-color:transparent;--color:var(--m3-scheme-on-surface) / .38;pointer-events:none}.m3-container.svelte-j01lhi{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){input:checked+.layer.svelte-j01lhi:before{border-color:selecteditem}.layer.svelte-j01lhi:after{background-color:selecteditem}input:disabled+.layer.svelte-j01lhi{opacity:.38}}.m3-container.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:relative;align-items:center;height:3.5rem;min-width:15rem}input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;inset:0;width:100%;height:100%;border:none;outline:none;padding:1.5rem 1rem .5rem;border-radius:.25rem .25rem 0 0;background-color:rgb(var(--m3-scheme-surface-container-highest));color:rgb(var(--m3-scheme-on-surface))}label.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;left:1rem;top:1rem;color:rgb(var(--error, var(--m3-scheme-on-surface-variant)));pointer-events:none;transition:all .2s,font-size .3s,line-height .3s,letter-spacing .3s}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;inset:0;border-radius:.25rem .25rem 0 0;pointer-events:none;transition:all .2s}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:after{position:absolute;content:" ";display:block;width:100%;bottom:0;height:.0625rem;background-color:rgb(var(--error, var(--m3-scheme-on-surface-variant)));transition:all .2s}.m3-container.svelte-gav3jy svg{width:1.5rem;height:1.5rem;color:rgb(var(--m3-scheme-on-surface-variant));pointer-events:none}.m3-container.svelte-gav3jy>.leading{position:relative;margin-left:.75rem}.trailing.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;padding-left:.75rem;padding-right:.75rem;height:100%;right:0;display:flex;align-items:center;justify-content:center;border:none;background-color:transparent;border-top-right-radius:.25rem;border-bottom-right-radius:.25rem;-webkit-tap-highlight-color:transparent;cursor:pointer;transition:all .2s}input.svelte-gav3jy:enabled:hover~.layer.svelte-gav3jy.svelte-gav3jy{background-color:rgb(var(--m3-scheme-on-surface) / .08)}input.svelte-gav3jy:hover~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--error, var(--m3-scheme-on-surface)))}input.svelte-gav3jy:not(:-moz-placeholder-shown)~label.svelte-gav3jy.svelte-gav3jy{top:.5rem;font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}input.svelte-gav3jy:focus~label.svelte-gav3jy.svelte-gav3jy,input.svelte-gav3jy:not(:placeholder-shown)~label.svelte-gav3jy.svelte-gav3jy{top:.5rem;font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}input.svelte-gav3jy:focus~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--error, var(--m3-scheme-primary)))}input.svelte-gav3jy:focus~.layer.svelte-gav3jy.svelte-gav3jy:after{height:.125rem;background-color:rgb(var(--error, var(--m3-scheme-primary)))}@media (hover: hover){button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:hover{background-color:rgb(var(--m3-scheme-on-surface-variant) / .08)}}button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:focus-visible,button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:active{background-color:rgb(var(--m3-scheme-on-surface-variant) / .12)}.leading-icon.svelte-gav3jy>input.svelte-gav3jy.svelte-gav3jy{padding-left:3.25rem}.leading-icon.svelte-gav3jy>label.svelte-gav3jy.svelte-gav3jy{left:3.25rem}.trailing-icon.svelte-gav3jy>input.svelte-gav3jy.svelte-gav3jy{padding-right:3.25rem}.error.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{--error:var(--m3-scheme-error)}.error.svelte-gav3jy>input.svelte-gav3jy:hover~label.svelte-gav3jy,.error.svelte-gav3jy>input.svelte-gav3jy:hover~.layer.svelte-gav3jy{--error:var(--m3-scheme-on-error-container)}input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:disabled{background-color:rgb(var(--m3-scheme-on-surface) / .04);color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~.layer.svelte-gav3jy.svelte-gav3jy:after{background-color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~svg{color:rgb(var(--m3-scheme-on-surface) / .38)}.m3-container.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{background-color:field}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:after,input.svelte-gav3jy:focus~.layer.svelte-gav3jy.svelte-gav3jy:after{background-color:canvastext}}hr.svelte-qs87rr{margin:0;height:0;border:none;border-bottom:solid 1px rgb(var(--m3-scheme-outline-variant))}.inset.svelte-qs87rr{margin-left:1rem;margin-right:1rem}input.svelte-1j1kflk{background-color:transparent;outline:none;border:none}iframe.svelte-1j1kflk{outline:none;border:none}.vertical-container.svelte-1fln0zk{display:flex;flex-direction:column;align-items:center;gap:1rem}.tls-warning.svelte-1fln0zk{font-weight:700;max-width:60ch}body,html{height:100vh;margin:0}*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.m-auto{margin:auto}.-mx-4{margin-left:-1rem;margin-right:-1rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mb-4{margin-bottom:1rem}.mr-auto{margin-right:auto}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.flex{display:flex}.hidden{display:none}.h-full{height:100%}.w-0{width:0px}.w-full{width:100%}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.rounded-2xl{border-radius:1rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-outline{--tw-border-opacity: 1;border-color:rgb(var(--m3-scheme-outline) / var(--tw-border-opacity))}.bg-surface-container-high{--tw-bg-opacity: 1;background-color:rgb(var(--m3-scheme-surface-container-high) / var(--tw-bg-opacity))}.p-2{padding:.5rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.pr-2{padding-right:.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-on-surface-variant{--tw-text-opacity: 1;color:rgb(var(--m3-scheme-on-surface-variant) / var(--tw-text-opacity))}.text-secondary{--tw-text-opacity: 1;color:rgb(var(--m3-scheme-secondary) / var(--tw-text-opacity))}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}html{background-color:rgb(var(--m3-scheme-background));color:rgb(var(--m3-scheme-on-background));--m3-font-display: Cabin, system-ui, sans-serif;--m3-font-headline: Cabin, system-ui, sans-serif;--m3-font-title: Cabin, system-ui, sans-serif;--m3-font-label: Cabin, system-ui, sans-serif;--m3-font-label-large-tracking: .25px;--m3-font-label-medium-tracking: 1px;--m3-font-label-small-tracking: 1px;--m3-font-body: Cabin, system-ui, sans-serif}#app{display:contents}.hover\:text-primary:hover{--tw-text-opacity: 1;color:rgb(var(--m3-scheme-primary) / var(--tw-text-opacity))}@media (min-width: 640px){.sm\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media (min-width: 1024px){.lg\:text-xl{font-size:1.25rem;line-height:1.75rem}}

</style>
  </head>

  <body>
    <div id="app" class="m3-font-body-large"></div>
  </body>
</html>
